const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/editor.api.CbdTRBW9.js","../chunks/iconRegistry.BJgxFQLY.js","../chunks/editorContextKeys.Cdn_dJhV.js","../assets/iconRegistry.DaOXeWeJ.css","../chunks/stableEditorScroll.DHPB0mmN.js","../chunks/codeEditorWidget.CXeIzSuq.js","../assets/codeEditorWidget.Bg48Qpty.css","../chunks/preload-helper.BwRTzghu.js","../chunks/entry.5Y1xI-BT.js","../chunks/toolbar.BTiJf7ch.js","../assets/toolbar.CglUw5ev.css","../chunks/editorBrowser.CzkYJKPy.js","../chunks/clipboardService.BTmHAzm-.js","../chunks/format.Bb1_og6G.js","../assets/editor.BcE45i8R.css","../chunks/monaco.contribution.yTjmHKxc.js","../chunks/monaco.contribution.C8bAK3tb.js","../chunks/monaco.contribution.DYavRcjr.js","../chunks/monaco.contribution.TNax1u8L.js","../chunks/suggestController.TAqXY2ko.js","../chunks/resizable.CSJhciM7.js","../assets/resizable.BfBUCCsp.css","../assets/suggestController.ChoziUlt.css","../chunks/parameterHints.StIp-S_A.js","../assets/parameterHints.BBE0dURY.css","../chunks/hoverContribution.CisGEAg6.js","../assets/hoverContribution.NSOZYWNZ.css","../chunks/formatActions.BuL_rer4.js"])))=>i.map(i=>d[i]);
var cC=Object.defineProperty;var uC=Object.getPrototypeOf;var dC=Reflect.get;var w6=n=>{throw TypeError(n)};var fC=(n,e,t)=>e in n?cC(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Te=(n,e,t)=>fC(n,typeof e!="symbol"?e+"":e,t),k6=(n,e,t)=>e.has(n)||w6("Cannot "+t);var Lm=(n,e,t)=>(k6(n,e,"read from private field"),t?t.call(n):e.get(n)),N1=(n,e,t)=>e.has(n)?w6("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t);var sb=(n,e,t)=>(k6(n,e,"access private method"),t);var S6=(n,e,t)=>dC(uC(n),t,e);import{r as Ox,v as pC,w as C6,x as mC,y as M2,e as Qn,a as q,z as ta,b as tt,l as Ip,s as sm,A as vd,t as ke,c as wl,B as Dc,n as a3,C as q2,D as l3,f as Y0,E as hC,p as c3}from"../chunks/stores.3I_hvxaz.js";import{v as vC,E as gC,w as _C,F as u3,J as Qg,K as i2,H as d3,Q as ty,aB as yC,aS as bC,aR as xC,O as zx,at as f3,as as p3,L as m3,al as wC,P as I6,C as Vx,aY as h3,I as kC,G as SC,l as N2,e as qo,aZ as CC,a_ as IC,a$ as PC,a6 as MC,q as Wx,aC as m_,b0 as NC,b1 as AC,aK as P6,Z as M6,av as TC,ai as FC,m as Lw,aL as v3,B as LC,A as x,aJ as $m,c as y,f as fn,b2 as Zi,r as _,t as Ce,ag as vm,p as Ed,af as id,ad as nm,ae as x0,i,s as v,a as $d,j as tm,ab as ge,k as Bt,b3 as N6,a2 as ov,aI as gd,b as Fr,b4 as _p,b5 as ob,aa as r2,b6 as f0,y as L_,b7 as EC,aH as P0,a5 as $C}from"../chunks/entry.5Y1xI-BT.js";import{b as g3,l as uo,p as hi,i as Ue,a as V,c as _m,s as ch}from"../chunks/runtime.Injoh0w-.js";import{i as rv}from"../chunks/lifecycle.DMr8Z4pO.js";import{s as Ot,t as wr,e as Yo,i as Ii,r as xn,h as pi,j as Gf,l as v_,f as DC,m as a_,b as Dm,n as A6,o as Mv,p as _3,A as RC,k as jC,q as BC}from"../chunks/alert.x3_FH-Kr.js";import{c as Fh,o as Th,a as b0,b as tp,_ as Bg}from"../chunks/preload-helper.BwRTzghu.js";const OC=[];function p0(n,e=!1){return Rb(n,new Map,"",OC)}function Rb(n,e,t,s,o=null){if(typeof n=="object"&&n!==null){const a=e.get(n);if(a!==void 0)return a;if(n instanceof Map)return new Map(n);if(n instanceof Set)return new Set(n);if(vC(n)){const l=[];e.set(n,l),o!==null&&e.set(o,l);for(let c=0;c<n.length;c+=1)l.push(Rb(n[c],e,t,s));return l}if(gC(n)===_C){const l={};e.set(n,l),o!==null&&e.set(o,l);for(var r in n)l[r]=Rb(n[r],e,t,s);return l}if(n instanceof Date)return structuredClone(n);if(typeof n.toJSON=="function")return Rb(n.toJSON(),e,t,s,n)}if(n instanceof EventTarget)return n;try{return structuredClone(n)}catch{return n}}function zC(n,e,t,s,o){var r=n,a="",l;u3(()=>{if(a===(a=e()??"")){Qg&&i2();return}l!==void 0&&(p3(l),l=void 0),a!==""&&(l=d3(()=>{if(Qg){ty.data;for(var c=i2(),f=c;c!==null&&(c.nodeType!==8||c.data!=="");)f=c,c=yC(c);if(c===null)throw bC(),xC;Ox(ty,f),r=zx(c);return}var u=a+"",d=pC(u);Ox(f3(d),d.lastChild),r.before(d)}))})}function VC(n,e,t,s,o,r){let a=Qg;Qg&&i2();var l,c,f=null;Qg&&ty.nodeType===1&&(f=ty,i2());var u=Qg?ty:n,d;u3(()=>{const h=e()||null;var m=h3;h!==l&&(d&&(h===null?kC(d,()=>{d=null,c=null}):h===c?SC(d):(p3(d),C6(!1))),h&&h!==c&&(d=d3(()=>{if(f=Qg?f:document.createElementNS(m,h),Ox(f,f),s){var g=Qg?f3(f):f.appendChild(wC());Qg&&(g===null?I6(!1):zx(g)),s(f,g)}Vx.nodes_end=f,u.before(f)})),l=h,l&&(c=l),C6(!0))},m3),a&&(I6(!0),zx(u))}function T6(n,e,t){N2(()=>{var s=qo(()=>e(n,t==null?void 0:t())||{});if(s!=null&&s.destroy)return()=>s.destroy()})}const WC=()=>performance.now(),J0={tick:n=>requestAnimationFrame(n),now:()=>WC(),tasks:new Set};function y3(n){J0.tasks.forEach(e=>{e.c(n)||(J0.tasks.delete(e),e.f())}),J0.tasks.size!==0&&J0.tick(y3)}function HC(n){let e;return J0.tasks.size===0&&J0.tick(y3),{promise:new Promise(t=>{J0.tasks.add(e={c:n,f:t})}),abort(){J0.tasks.delete(e)}}}function ib(n,e){n.dispatchEvent(new CustomEvent(e))}function qC(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const e=n.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function F6(n){const e={},t=n.split(";");for(const s of t){const[o,r]=s.split(":");if(!o||r===void 0)break;const a=qC(o.trim());e[a]=r.trim()}return e}const UC=n=>n;function wg(n,e,t,s){var o=(n&PC)!==0,r=(n&NC)!==0,a=o&&r,l=(n&AC)!==0,c=a?"both":o?"in":"out",f,u=e.inert,d,h;function m(){var I=TC,A=Vx;P6(null),M6(null);try{return f??(f=t()(e,(s==null?void 0:s())??{},{direction:c}))}finally{P6(I),M6(A)}}var g={is_global:l,in(){var I;if(e.inert=u,!o){h==null||h.abort(),(I=h==null?void 0:h.reset)==null||I.call(h);return}r||d==null||d.abort(),ib(e,"introstart"),d=Hx(e,m(),h,1,()=>{ib(e,"introend"),d==null||d.abort(),d=f=void 0})},out(I){if(!r){I==null||I(),f=void 0;return}e.inert=!0,ib(e,"outrostart"),h=Hx(e,m(),d,0,()=>{ib(e,"outroend"),I==null||I()})},stop:()=>{d==null||d.abort(),h==null||h.abort()}},w=Vx;if((w.transitions??(w.transitions=[])).push(g),o&&mC){var C=l;if(!C){for(var P=w.parent;P&&P.f&m3;)for(;(P=P.parent)&&!(P.f&CC););C=!P||(P.f&IC)!==0}C&&N2(()=>{qo(()=>g.in())})}}function Hx(n,e,t,s,o){var r=s===1;if(MC(e)){var a,l=!1;return Wx(()=>{if(!l){var C=e({direction:r?"in":"out"});a=Hx(n,C,t,s,o)}}),{abort:()=>{l=!0,a==null||a.abort()},deactivate:()=>a.deactivate(),reset:()=>a.reset(),t:()=>a.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return o(),{abort:m_,deactivate:m_,reset:m_,t:()=>s};const{delay:c=0,css:f,tick:u,easing:d=UC}=e;var h=[];if(r&&t===void 0&&(u&&u(0,1),f)){var m=F6(f(0,1));h.push(m,m)}var g=()=>1-s,w=n.animate(h,{duration:c});return w.onfinish=()=>{var C=(t==null?void 0:t.t())??1-s;t==null||t.abort();var P=s-C,I=e.duration*Math.abs(P),A=[];if(I>0){if(f)for(var M=Math.ceil(I/16.666666666666668),F=0;F<=M;F+=1){var B=C+P*d(F/M),$=f(B,1-B);A.push(F6($))}g=()=>{var L=w.currentTime;return C+P*d(L/I)},u&&HC(()=>{if(w.playState!=="running")return!1;var L=g();return u(L,1-L),!0})}w=n.animate(A,{duration:I,fill:"forwards"}),w.onfinish=()=>{g=()=>s,u==null||u(s,1-s),o()}},{abort:()=>{w&&(w.cancel(),w.effect=null,w.onfinish=m_)},deactivate:()=>{o=m_},reset:()=>{s===0&&(u==null||u(1,0))},t:()=>g()}}function Bs(n,e,t=e){var s=FC();M2(n,"input",()=>{var o=G2(n)?Y2(n.value):n.value;t(o),s&&o!==(o=e())&&(n.value=o??"")}),Lw(()=>{var o=e();if(Qg&&n.defaultValue!==n.value){t(G2(n)?Y2(n.value):n.value);return}G2(n)&&o===Y2(n.value)||n.type==="date"&&!o&&!n.value||o!==n.value&&(n.value=o??"")})}const U2=new Set;function GC(n,e,t,s,o=s){var r=t.getAttribute("type")==="checkbox",a=n;let l=!1;if(e!==null)for(var c of e)a=a[c]??(a[c]=[]);a.push(t),M2(t,"change",()=>{var f=t.__value;r&&(f=L6(a,f,t.checked)),o(f)},()=>o(r?[]:null)),Lw(()=>{var f=s();if(Qg&&t.defaultChecked!==t.checked){l=!0;return}r?(f=f||[],t.checked=f.includes(t.__value)):t.checked=g3(t.__value,f)}),v3(()=>{var f=a.indexOf(t);f!==-1&&a.splice(f,1)}),U2.has(a)||(U2.add(a),Wx(()=>{a.sort((f,u)=>f.compareDocumentPosition(u)===4?-1:1),U2.delete(a)})),Wx(()=>{if(l){var f;if(r)f=L6(a,f,t.checked);else{var u=a.find(d=>d.checked);f=u==null?void 0:u.__value}o(f)}})}function Uv(n,e,t=e){M2(n,"change",()=>{var s=n.checked;t(s)}),e()==null&&t(!1),Lw(()=>{var s=e();n.checked=!!s})}function L6(n,e,t){for(var s=new Set,o=0;o<n.length;o+=1)n[o].checked&&s.add(n[o].__value);return t||s.delete(e),Array.from(s)}function G2(n){var e=n.type;return e==="number"||e==="range"}function Y2(n){return n===""?null:+n}function E6(n,e,t){var s=LC(n,e);s&&s.set&&(n[e]=t,v3(()=>{n[e]=null}))}function _0(n,e,t){if(n.multiple)return YC(n,e);for(var s of n.options){var o=ny(s);if(g3(o,e)){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function e_(n,e){let t=!0;N2(()=>{e&&_0(n,qo(e),t),t=!1;var s=new MutationObserver(()=>{var o=n.__value;_0(n,o)});return s.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{s.disconnect()}})}function xo(n,e,t=e){var s=!0;M2(n,"change",()=>{var o;if(n.multiple)o=[].map.call(n.querySelectorAll(":checked"),ny);else{var r=n.querySelector(":checked");o=r&&ny(r)}t(o)}),N2(()=>{var o=e();if(_0(n,o,s),s&&o===void 0){var r=n.querySelector(":checked");r!==null&&(o=ny(r),t(o))}n.__value=o,s=!1}),e_(n)}function YC(n,e){for(var t of n.options)t.selected=~e.indexOf(ny(t))}function ny(n){return"__value"in n?n.__value:n.value}function A1(n){x(n,n.v+1)}const X_={},rb={},jb={},Bb={};function KC(n){if(n)return X_[n]}function XC(n){const e=Bb[n];!e||e.size===0||e.forEach(t=>{try{t()}catch{}})}async function ZC(n,e=2){if(X_[n])return X_[n];if(rb[n])return rb[n];jb[n]="loading";const t=new Promise((s,o)=>{let r=0;const a=()=>{const l=new Image;l.crossOrigin="anonymous";try{l.referrerPolicy="no-referrer"}catch{}const c=async()=>{var u;try{await((u=l.decode)==null?void 0:u.call(l))}catch{}X_[n]=l,jb[n]="loaded",XC(n),s(l)},f=()=>{if(r+=1,r<=e){const u=Math.min(500*r,1500);setTimeout(a,u)}else jb[n]="error",o(new Error("load error"))};l.onload=c,l.onerror=f,l.src=n};a()});rb[n]=t;try{return await t}finally{delete rb[n]}}function qx(n){if(n&&!(X_[n]||jb[n]==="loading"))try{ZC(n)}catch{}}function JC(n,e){if(Bb[n]||(Bb[n]=new Set),Bb[n].add(e),X_[n])try{e()}catch{}}function b3(n){n&&(qx(n.logo),qx(n.logo2))}function lh(n,e){if(!(!kg(n)&&!kg(e))){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const s=n[t],o=e[t];kg(o)&&kg(s)?lh(s,o):$s(e[t])&&(n[t]=n1(e[t]))}}}function n1(n){if(!kg(n))return n;let e=null;t0(n)?e=[]:e={};for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=n[t];kg(s)?e[t]=n1(s):e[t]=s}return e}function t0(n){return Object.prototype.toString.call(n)==="[object Array]"}function eg(n){return typeof n=="function"}function kg(n){return typeof n=="object"&&$s(n)}function Ca(n){return typeof n=="number"&&Number.isFinite(n)}function $s(n){return n!=null}function fy(n){return typeof n=="boolean"}function hd(n){return typeof n=="string"}const $6=new Map,QC=/\\(\\)?/g,e9=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g");function Nh(n,e,t){if($s(n)){const s=[];e.replace(e9,(l,...c)=>{let f=l;return $s(c[1])?f=c[2].replace(QC,"$1"):$s(c[0])&&(f=c[0].trim()),s.push(f),""});let o=n,r=0;const a=s.length;for(;$s(o)&&r<a;)o=o==null?void 0:o[s[r++]];return $s(o)?o:t??"--"}return t??"--"}function x3(n,e){const t={};return n.formatToParts(new Date(e)).forEach(({type:s,value:o})=>{switch(s){case"year":{t.YYYY=o;break}case"month":{t.MM=o;break}case"day":{t.DD=o;break}case"hour":{t.HH=o==="24"?"00":o;break}case"minute":{t.mm=o;break}case"second":{t.ss=o;break}}}),t}function w3(n,e,t){const s=x3(n,e),o=/YYYY|YY|MMM|MM|DD|ddd|HH|mm|ss/g,r=t.match(o)??[],a=r.includes("MMM")||r.includes("ddd")||r.includes("YY");let l={};if(a){const f=n.resolvedOptions(),u=`${f.locale??"en"}|${f.timeZone??""}`;let d=$6.get(u);if(!d){const m={weekday:"short",year:"2-digit",month:"short",day:"2-digit"};f.timeZone&&(m.timeZone=f.timeZone),d=new Intl.DateTimeFormat(f.locale??"en",m),$6.set(u,d)}d.formatToParts(new Date(e)).forEach(({type:m,value:g})=>{switch(m){case"weekday":{l.ddd=g;break}case"month":{l.MMM=g;break}case"year":{l.YY=g;break}}})}const c={...s,YY:l.YY??s.YYYY.slice(-2),MMM:l.MMM??s.MM,ddd:l.ddd??""};return t.replace(o,f=>c[f])}function Mh(n,e){const t=+n;return Ca(t)?t.toFixed(e??2):`${n}`}function k3(n){const e=`${n}`,t=+e;if(!Ca(t))return e;let s=3;const o=e.indexOf("."),r=o>=0;if(o>=0&&o<e.length-1&&(s=e.length-o-1),t>1e9){const a=(t/1e9).toFixed(s);return`${r?a:a.replace(/\.?0+$/,"")}B`}if(t>1e6){const a=(t/1e6).toFixed(s);return`${r?a:a.replace(/\.?0+$/,"")}M`}if(t>1e3){const a=(t/1e3).toFixed(s);return`${r?a:a.replace(/\.?0+$/,"")}K`}return e}function S3(n,e){const t=`${n}`;if(e.length===0)return t;if(t.includes(".")){const s=t.split(".");return`${s[0].replace(/(\d)(?=(\d{3})+$)/g,o=>`${o}${e}`)}.${s[1]}`}return t.replace(/(\d)(?=(\d{3})+$)/g,s=>`${s}${e}`)}function C3(n,e){const t=`${n}`;if(new RegExp("\\.0{"+e+",}[1-9][0-9]*$").test(t)){const o=t.split("."),r=o.length-1,a=o[r],l=/0*/.exec(a);if($s(l)){const c=l[0].length;return o[r]=a.replace(/0*/,`0{${c}}`),o.join(".")}}return t}function D6(n,e){return n.replace(/\{(\w+)\}/g,(t,s)=>{const o=e[s];return $s(o)?o:`{${s}}`})}let T1=null;function t_(n){var e;return((e=n.ownerDocument.defaultView)==null?void 0:e.devicePixelRatio)??1}function o_(n,e,t){return`${e??"normal"} ${n??12}px ${t??"Helvetica Neue"}`}function Em(n,e,t,s){if(!$s(T1)){const o=document.createElement("canvas"),r=t_(o);T1=o.getContext("2d"),T1.scale(r,r)}return T1.font=o_(e,t,s),Math.round(T1.measureText(n).width)}function a2(n){const e={width:0,height:0,left:0,right:0,top:0,bottom:0};return $s(n)&&lh(e,n),e}var Ff=(n=>(n[n.Main=0]="Main",n[n.Overlay=1]="Overlay",n[n.Separator=2]="Separator",n[n.Drawer=3]="Drawer",n[n.All=4]="All",n))(Ff||{});const K2=-1;function D0(n){return eg(window.requestAnimationFrame)?window.requestAnimationFrame(n):window.setTimeout(n,20)}function Ob(n){eg(window.cancelAnimationFrame)?window.cancelAnimationFrame(n):window.clearTimeout(n)}class Ux{constructor(e){Te(this,"_options",{duration:500,iterationCount:1});Te(this,"_doFrameCallback");Te(this,"_currentIterationCount",0);Te(this,"_running",!1);Te(this,"_time",0);lh(this._options,e)}_loop(){this._running=!0;const e=()=>{var t;if(this._running){const s=new Date().getTime()-this._time;s<this._options.duration?((t=this._doFrameCallback)==null||t.call(this,s),D0(e)):(this.stop(),this._currentIterationCount++,this._currentIterationCount<this._options.iterationCount&&this.start())}};D0(e)}doFrame(e){return this._doFrameCallback=e,this}setDuration(e){return this._options.duration=e,this}setIterationCount(e){return this._options.iterationCount=e,this}start(){this._running||(this._time=new Date().getTime(),this._loop())}stop(){var e;this._running&&((e=this._doFrameCallback)==null||e.call(this,this._options.duration)),this._running=!1}}let X2=1,R6=new Date().getTime();function G1(n){const e=new Date().getTime();return e===R6?++X2:X2=1,R6=e,`${n??""}${e}_${X2}`}function B0(n,e){const t=document.createElement(n),s=e??{};for(const o in s)t.style[o]=s[o]??"";return t}function Gx(n,e,t){let s=0,o=0;for(o=n.length-1;s!==o;){const r=Math.floor((o+s)/2),a=o-s,l=n[r][e];if(t===n[s][e])return s;if(t===n[o][e])return o;if(t===l)return r;if(t>l?s=r:o=r,a<=2)break}return s}function j6(n,e){e=Math.max(0,e??0);const t=Math.pow(10,e);return Math.round(n*t)/t}function t9(n){const e=n.toString(),t=e.indexOf("e");if(t>0){const o=+e.slice(t+1);return o<0?-o:0}const s=e.indexOf(".");return s<0?0:e.length-1-s}function I3(n,e,t){const s=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],o=n.length;let r=0;for(;r<o;){const a=n[r];s[0]=Math.max(a[e]??Number.MIN_SAFE_INTEGER,s[0]),s[1]=Math.min(a[t]??Number.MAX_SAFE_INTEGER,s[1]),++r}return s}function q0(n){return n===0?0:Math.log10(n)}function z_(n){return Math.pow(10,n)}function B6(){return{from:0,to:0,realFrom:0,realTo:0}}function O6(...n){return n.join("_")}const n9=5;class s9{constructor(e){Te(this,"_limit");Te(this,"_running",0);Te(this,"_queue",[]);Te(this,"_taskMap",new Map);this._limit=e??n9}async add(e){return await new Promise((t,s)=>{const{id:o,handler:r}=e,a=()=>{this._running++,r().then(c=>{t(c)}).catch(()=>{s("failed")}).finally(()=>{this._running--,this._taskMap.delete(o),this._next()})},l=this._taskMap.get(o);if($s(l)){l.reject("canceled");const c=this._queue.indexOf(l.run);c>-1&&this._queue.splice(c,1)}this._taskMap.set(o,{run:a,reject:s}),this._queue.push(a),this._next()})}_next(){for(;this._running<this._limit&&this._queue.length>0;){const e=this._queue.shift();e==null||e()}}remove(e){const t=this._taskMap.get(e);if($s(t)){this._taskMap.delete(e);const s=this._queue.indexOf(t.run);s>-1&&this._queue.splice(s,1),t.reject("canceled")}}clear(){for(const[,{reject:e}]of this._taskMap)e("canceled");this._taskMap.clear(),this._queue=[]}}const Ah={PRICE:2,VOLUME:0};class o9{constructor(){Te(this,"_callbacks",[])}subscribe(e){this._callbacks.indexOf(e)<0&&this._callbacks.push(e)}unsubscribe(e){if(eg(e)){const t=this._callbacks.indexOf(e);t>-1&&this._callbacks.splice(t,1)}else this._callbacks=[]}execute(e){this._callbacks.forEach(t=>{t(e)})}isEmpty(){return this._callbacks.length===0}}function i_(n){return n==="transparent"||n==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(n)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(n)}function R0(n,e){const t=n.replace(/^#/,""),s=parseInt(t,16),o=s>>16&255,r=s>>8&255,a=s&255;return`rgba(${o}, ${r}, ${a}, ${e??1})`}function Z2(n){return Number.isNaN(n)?0:Math.max(0,Math.min(255,n))}function i9(n){const e=n.replace(/^#/,"").trim();if(![3,4,6,8].includes(e.length))return null;const t=e.length<=4?e.split("").map(r=>`${r}${r}`).join(""):e,s=t.length===8?t:`${t}ff`,o=Number.parseInt(s,16);return Number.isFinite(o)?{r:o>>>24&255,g:o>>>16&255,b:o>>>8&255,a:(o&255)/255}:null}function r9(n){const e=n.trim().match(/^rgba?\(([^)]+)\)$/i);if(!e)return null;const t=e[1].split(",").map(l=>l.trim());if(t.length<3)return null;const s=Z2(Number(t[0])),o=Z2(Number(t[1])),r=Z2(Number(t[2])),a=t.length>=4&&t[3]!==""?Math.max(0,Math.min(1,Number(t[3]))):1;return{r:s,g:o,b:r,a}}function a9(n){return n?n.startsWith("#")?i9(n):n.toLowerCase().startsWith("rgb")?r9(n):null:null}function E0(n,e,{light:t="#FFFFFF",dark:s="#111111",threshold:o=.6}={}){if(!n||i_(n))return e;const r=a9(n);return!r||r.a===0?e:(.2126*r.r+.7152*r.g+.0722*r.b)/255>o?s:t}const Zc={RED:"#F92855",GREEN:"#2DC08E",WHITE:"#FFFFFF",GREY:"#76808F",BLUE:"#1677FF"};function l9(){return{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]}}}function c9(){const n={show:!0,color:Zc.GREY,textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"};return{type:"candle_solid",bar:{compareRule:"current_open",upColor:Zc.GREEN,downColor:Zc.RED,noChangeColor:Zc.GREY,upBorderColor:Zc.GREEN,downBorderColor:Zc.RED,noChangeBorderColor:Zc.GREY,upWickColor:Zc.GREEN,downWickColor:Zc.RED,noChangeWickColor:Zc.GREY},area:{lineSize:2,lineColor:Zc.BLUE,smooth:!1,value:"close",backgroundColor:[{offset:0,color:R0(Zc.BLUE,.01)},{offset:1,color:R0(Zc.BLUE,.2)}],point:{show:!0,color:Zc.BLUE,radius:4,rippleColor:R0(Zc.BLUE,.3),rippleRadius:8,animation:!0,animationDuration:1e3}},priceMark:{show:!0,high:{...n},low:{...n},last:{show:!0,compareRule:"current_open",upColor:Zc.GREEN,downColor:Zc.RED,noChangeColor:Zc.GREY,line:{show:!0,style:"dashed",dashedValue:[4,4],size:1},text:{show:!0,style:"fill",size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderColor:"transparent",borderStyle:"solid",borderSize:0,borderDashedValue:[2,2],color:Zc.WHITE,family:"Helvetica Neue",weight:"normal",borderRadius:2},extendTexts:[]}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",rect:{position:"fixed",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,offsetLeft:4,offsetTop:4,offsetRight:4,offsetBottom:4,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},title:{show:!0,size:14,family:"Helvetica Neue",weight:"normal",color:Zc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,template:"{ticker} · {period}"},legend:{size:13,family:"Helvetica Neue",weight:"normal",color:Zc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a",template:[{title:"open",value:"{open}"},{title:"high",value:"{high}"},{title:"low",value:"{low}"},{title:"close",value:"{close}"},{title:"volume",value:"{volume}"}]},features:[]}}}function u9(){const n=R0(Zc.GREEN,.7),e=R0(Zc.RED,.7);return{ohlc:{compareRule:"current_open",upColor:n,downColor:e,noChangeColor:Zc.GREY},bars:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:n,downColor:e,noChangeColor:Zc.GREY}],lines:["#FF9600","#935EBD",Zc.BLUE,"#E11D74","#01C5C4"].map(t=>({style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:t})),circles:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:n,downColor:e,noChangeColor:Zc.GREY}],lastValueMark:{show:!1,text:{show:!1,style:"fill",color:Zc.WHITE,size:13,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderColor:"transparent",borderSize:0,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",title:{show:!0,showName:!0,showParams:!0,size:13,family:"Helvetica Neue",weight:"normal",color:Zc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:Zc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a"},features:[]}}}function z6(){return{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:Zc.GREY,size:14,family:'"IBM Plex Sans", "Helvetica Neue", Arial, sans-serif',weight:"normal",marginStart:4,marginEnd:6},ticduty:{show:!0,size:1,length:3,color:"#DDDDDD"}}}function d9(){return{show:!0,horizontal:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:Zc.GREY},text:{show:!0,style:"fill",color:Zc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:Zc.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:Zc.GREY},features:[]},vertical:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:Zc.GREY},text:{show:!0,style:"fill",color:Zc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:Zc.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:Zc.GREY}}}}function f9(){const n=R0(Zc.BLUE,.35),e=R0(Zc.BLUE,.25);function t(){return{style:"fill",color:Zc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:Zc.BLUE,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:Zc.BLUE}}return{point:{color:Zc.BLUE,borderColor:n,borderSize:1,radius:5,activeColor:Zc.BLUE,activeBorderColor:n,activeBorderSize:3,activeRadius:5},line:{style:"solid",smooth:!1,color:Zc.BLUE,size:1,dashedValue:[2,2]},rect:{style:"fill",color:e,borderColor:Zc.BLUE,borderSize:1,borderRadius:0,borderStyle:"solid",borderDashedValue:[2,2]},polygon:{style:"fill",color:Zc.BLUE,borderColor:Zc.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},circle:{style:"fill",color:e,borderColor:Zc.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},arc:{style:"solid",color:Zc.BLUE,size:1,dashedValue:[2,2]},text:t()}}function p9(){return{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:R0(Zc.BLUE,.08)}}function m9(){const n=z6(),e=z6();return e.tickText.family="sans-serif",e.tickText.size=12,e.tickText.weight="normal",e.tickText.color="#6b7280",e.tickText.weight="normal",{grid:l9(),candle:c9(),indicator:u9(),xAxis:n,yAxis:e,separator:p9(),crosshair:d9(),overlay:f9()}}function Ew(n,e,t,s){const o=n.result,r=n.figures,a=n.styles,l=Nh(a,"circles",t.circles),c=l.length,f=Nh(a,"bars",t.bars),u=f.length,d=Nh(a,"lines",t.lines),h=d.length;let m=0,g=0,w=0,C,P=0;r.forEach(I=>{var A;switch(I.type){case"circle":{P=m;const M=l[m%c];C={...M,color:M.noChangeColor},m++;break}case"bar":{P=g;const M=f[g%u];C={...M,color:M.noChangeColor},g++;break}case"line":{P=w,C=d[w%h],w++;break}}if($s(I.type)){const M=(A=I.styles)==null?void 0:A.call(I,{data:{prev:o[e.prev??""],current:o[e.current??""],next:o[e.next??""]},indicator:n,defaultStyles:t});s(I,{...C,...M},P)}})}class A2{constructor(e){Te(this,"id");Te(this,"paneId");Te(this,"name");Te(this,"shortName");Te(this,"precision",4);Te(this,"calcParams",[]);Te(this,"shouldOhlc",!1);Te(this,"shouldFormatBigNumber",!1);Te(this,"visible",!0);Te(this,"zLevel",-10);Te(this,"extendData");Te(this,"series","normal");Te(this,"figures",[]);Te(this,"minValue",null);Te(this,"maxValue",null);Te(this,"styles",null);Te(this,"shouldUpdate",(e,t)=>{const s=JSON.stringify(e.calcParams)!==JSON.stringify(t.calcParams)||e.figures!==t.figures||e.calc!==t.calc,o=s||e.shortName!==t.shortName||e.series!==t.series||e.minValue!==t.minValue||e.maxValue!==t.maxValue||e.precision!==t.precision||e.shouldOhlc!==t.shouldOhlc||e.shouldFormatBigNumber!==t.shouldFormatBigNumber||e.visible!==t.visible||e.zLevel!==t.zLevel||e.extendData!==t.extendData||e.regenerateFigures!==t.regenerateFigures||e.createTooltipDataSource!==t.createTooltipDataSource||e.draw!==t.draw;return{calc:s,draw:o}});Te(this,"calc",()=>({}));Te(this,"regenerateFigures",null);Te(this,"createTooltipDataSource",null);Te(this,"draw",null);Te(this,"onDataStateChange",null);Te(this,"result",{});Te(this,"_prevIndicator");Te(this,"_lockSeriesPrecision",!1);this.override(e),this._lockSeriesPrecision=!1}override(e){const{result:t,...s}=this;this._prevIndicator={...n1(s),result:t};const{id:o,name:r,shortName:a,precision:l,styles:c,figures:f,calcParams:u,...d}=e;!hd(this.id)&&hd(o)&&(this.id=o),hd(this.name)||(this.name=r??""),this.shortName=a??this.shortName??this.name,Ca(l)&&(this.precision=l,this._lockSeriesPrecision=!0),$s(c)&&(this.styles??(this.styles={}),lh(this.styles,c)),lh(this,d),$s(u)&&(this.calcParams=u,eg(this.regenerateFigures)&&(this.figures=this.regenerateFigures(this.calcParams))),this.figures=f??this.figures}setSeriesPrecision(e){this._lockSeriesPrecision||(this.precision=e)}shouldUpdateImp(){const e=this._prevIndicator.zLevel!==this.zLevel,t=this.shouldUpdate(this._prevIndicator,this);return fy(t)?{calc:t,draw:t,sort:e}:{...t,sort:e}}async calcImp(e){try{const t=await this.calc(e,this);return this.result=t,!0}catch{return!1}}static extend(e){class t extends A2{constructor(){super(e)}}return t}}const h9={name:"AVP",shortName:"AVP",series:"price",precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:n=>{let e=0,t=0;return n.reduce((s,o)=>{const r={},a=o.turnover??0,l=o.volume??0;return e+=a,t+=l,t!==0&&(r.avp=e/t),s[o.timestamp]=r,s},{})}},v9={name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{const{prev:s,current:o}=n,r=(s==null?void 0:s.ao)??Number.MIN_SAFE_INTEGER,a=(o==null?void 0:o.ao)??Number.MIN_SAFE_INTEGER;let l="";a>r?l=Nh(e.styles,"bars[0].upColor",t.bars[0].upColor):l=Nh(e.styles,"bars[0].downColor",t.bars[0].downColor);const c=a>r?"stroke":"fill";return{color:l,style:c,borderColor:l}}}],calc:(n,e)=>{const t=e.calcParams,s=Math.max(t[0],t[1]);let o=0,r=0,a=0,l=0;return n.reduce((c,f,u)=>{const d={},h=(f.low+f.high)/2;if(o+=h,r+=h,u>=t[0]-1){a=o/t[0];const m=n[u-(t[0]-1)];o-=(m.low+m.high)/2}if(u>=t[1]-1){l=r/t[1];const m=n[u-(t[1]-1)];r-=(m.low+m.high)/2}return u>=s-1&&(d.ao=a-l),c[f.timestamp]=d,c},{})}},g9={name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`bias${t+1}`,title:`BIAS${e}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:s}=e,o=[];return n.reduce((r,a,l)=>{const c={},f=a.close;return t.forEach((u,d)=>{if(o[d]=(o[d]??0)+f,l>=u-1){const h=o[d]/t[d];c[s[d].key]=(f-h)/h*100,o[d]-=n[l-(u-1)].close}}),r[a.timestamp]=c,r},{})}};function _9(n,e){const t=n.length;let s=0;return n.forEach(o=>{const r=o.close-e;s+=r*r}),s=Math.abs(s),Math.sqrt(s/t)}const y9={name:"BOLL",shortName:"BOLL",series:"price",calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=t[0]-1;let o=0;return n.reduce((r,a,l)=>{const c=a.close,f={};if(o+=c,l>=s){f.mid=o/t[0];const u=_9(n.slice(l-s,l+1),f.mid);f.up=f.mid+t[1]*u,f.dn=f.mid-t[1]*u,o-=n[l-s].close}return r[a.timestamp]=f,r},{})}},b9={name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0,r=0,a=0;return n.reduce((l,c,f)=>{const u={},d=c.high,h=c.low,m=c.open,g=(n[f-1]??c).close;if(r+=d-m,a+=m-h,s+=d-g,o+=g-h,f>=t[0]-1){a!==0?u.ar=r/a*100:u.ar=0,o!==0?u.br=s/o*100:u.br=0;const w=n[f-(t[0]-1)],C=w.high,P=w.low,I=w.open,A=(n[f-t[0]]??n[f-(t[0]-1)]).close;s-=C-A,o-=A-P,r-=C-I,a-=I-P}return l[c.timestamp]=u,l},{})}},x9={name:"BBI",shortName:"BBI",series:"price",precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=Math.max(...t),o=[],r=[];return n.reduce((a,l,c)=>{const f={},u=l.close;if(t.forEach((d,h)=>{o[h]=(o[h]??0)+u,c>=d-1&&(r[h]=o[h]/d,o[h]-=n[c-(d-1)].close)}),c>=s-1){let d=0;r.forEach(h=>{d+=h}),f.bbi=d/4}return a[l.timestamp]=f,a},{})}},w9={name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=t[0]-1;let o=0;const r=[];return n.reduce((a,l,c)=>{const f={},u=(l.high+l.low+l.close)/3;if(o+=u,r.push(u),c>=s){const d=o/t[0],h=r.slice(c-s,c+1);let m=0;h.forEach(C=>{m+=Math.abs(C-d)});const g=m/t[0];f.cci=g!==0?(u-d)/g/.015:0;const w=(n[c-s].high+n[c-s].low+n[c-s].close)/3;o-=w}return a[l.timestamp]=f,a},{})}},k9={name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=Math.ceil(t[1]/2.5+1),o=Math.ceil(t[2]/2.5+1),r=Math.ceil(t[3]/2.5+1),a=Math.ceil(t[4]/2.5+1);let l=0;const c=[];let f=0;const u=[];let d=0;const h=[];let m=0;const g=[],w=[],C={};return n.forEach((P,I)=>{const A={},M=n[I-1]??P,F=(M.high+M.close+M.low+M.open)/4,B=Math.max(0,P.high-F),$=Math.max(0,F-P.low);I>=t[0]-1&&($!==0?A.cr=B/$*100:A.cr=0,l+=A.cr,f+=A.cr,d+=A.cr,m+=A.cr,I>=t[0]+t[1]-2&&(c.push(l/t[1]),I>=t[0]+t[1]+s-3&&(A.ma1=c[c.length-1-s]),l-=w[I-(t[1]-1)].cr??0),I>=t[0]+t[2]-2&&(u.push(f/t[2]),I>=t[0]+t[2]+o-3&&(A.ma2=u[u.length-1-o]),f-=w[I-(t[2]-1)].cr??0),I>=t[0]+t[3]-2&&(h.push(d/t[3]),I>=t[0]+t[3]+r-3&&(A.ma3=h[h.length-1-r]),d-=w[I-(t[3]-1)].cr??0),I>=t[0]+t[4]-2&&(g.push(m/t[4]),I>=t[0]+t[4]+a-3&&(A.ma4=g[g.length-1-a]),m-=w[I-(t[4]-1)].cr??0)),w.push(A),C[P.timestamp]=A}),C}},S9={name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=Math.max(t[0],t[1]);let o=0,r=0,a=0;const l=[],c={};return n.forEach((f,u)=>{const d={},h=f.close;o+=h,r+=h;let m=0,g=0;if(u>=t[0]-1&&(m=o/t[0],o-=n[u-(t[0]-1)].close),u>=t[1]-1&&(g=r/t[1],r-=n[u-(t[1]-1)].close),u>=s-1){const w=m-g;d.dma=w,a+=w,u>=s+t[2]-2&&(d.ama=a/t[2],a-=l[u-(t[2]-1)].dma??0)}l.push(d),c[f.timestamp]=d}),c}},C9={name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0,r=0,a=0,l=0,c=0,f=0,u=0;const d=[],h={};return n.forEach((m,g)=>{const w={},C=n[g-1]??m,P=C.close,I=m.high,A=m.low,M=I-A,F=Math.abs(I-P),B=Math.abs(P-A),$=I-C.high,L=C.low-A,O=Math.max(Math.max(M,F),B),Y=$>0&&$>L?$:0,ce=L>0&&L>$?L:0;if(s+=O,o+=Y,r+=ce,g>=t[0]-1){g>t[0]-1?(a=a-a/t[0]+O,l=l-l/t[0]+Y,c=c-c/t[0]+ce):(a=s,l=o,c=r);let Q=0,le=0;a!==0&&(Q=l*100/a,le=c*100/a),w.pdi=Q,w.mdi=le;let ue=0;le+Q!==0&&(ue=Math.abs(le-Q)/(le+Q)*100),f+=ue,g>=t[0]*2-2&&(g>t[0]*2-2?u=(u*(t[0]-1)+ue)/t[0]:u=f/t[0],w.adx=u,g>=t[0]*2+t[1]-3&&(w.adxr=((d[g-(t[1]-1)].adx??0)+u)/2))}d.push(w),h[m.timestamp]=w}),h}},I9={name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0;const o=[];return n.reduce((r,a,l)=>{const c={};if(l>0){const f=n[l-1],u=a.high,d=a.low,h=a.volume??0,m=(u+d)/2-(f.high+f.low)/2;if(h===0||u-d===0)c.emv=0;else{const g=h/1e8/(u-d);c.emv=m/g}s+=c.emv,o.push(c.emv),l>=t[0]&&(c.maEmv=s/t[0],s-=o[l-t[0]])}return r[a.timestamp]=c,r},{})}},P9={name:"EMA",shortName:"EMA",series:"price",calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`ema${t+1}`,title:`EMA${e}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:s}=e;let o=0;const r=[];return n.reduce((a,l,c)=>{const f={},u=l.close;return o+=u,t.forEach((d,h)=>{c>=d-1&&(c>d-1?r[h]=(2*u+(d-1)*r[h])/(d+1):r[h]=o/d,f[s[h].key]=r[h])}),a[l.timestamp]=f,a},{})}},M9={name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0;const o=[],r={};return n.forEach((a,l)=>{const c={};if(l>=t[0]){const f=a.close,u=n[l-t[0]].close;c.mtm=f-u,s+=c.mtm,l>=t[0]+t[1]-1&&(c.maMtm=s/t[1],s-=o[l-(t[1]-1)].mtm??0)}o.push(c),r[a.timestamp]=c}),r}},N9={name:"MA",shortName:"MA",series:"price",calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA30: ",type:"line"},{key:"ma4",title:"MA60: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`ma${t+1}`,title:`MA${e}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:s}=e,o=[];return n.reduce((r,a,l)=>{const c={},f=a.close;return t.forEach((u,d)=>{o[d]=(o[d]??0)+f,l>=u-1&&(c[s[d].key]=o[d]/u,o[d]-=n[l-(u-1)].close)}),r[a.timestamp]=c,r},{})}},A9={name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{const{prev:s,current:o}=n,r=(s==null?void 0:s.macd)??Number.MIN_SAFE_INTEGER,a=(o==null?void 0:o.macd)??Number.MIN_SAFE_INTEGER;let l="";return a>0?l=Nh(e.styles,"bars[0].upColor",t.bars[0].upColor):a<0?l=Nh(e.styles,"bars[0].downColor",t.bars[0].downColor):l=Nh(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor),{style:r<a?"stroke":"fill",color:l,borderColor:l}}}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0,r=0,a=0,l=0,c=0;const f=Math.max(t[0],t[1]);return n.reduce((u,d,h)=>{const m={},g=d.close;return s+=g,h>=t[0]-1&&(h>t[0]-1?o=(2*g+(t[0]-1)*o)/(t[0]+1):o=s/t[0]),h>=t[1]-1&&(h>t[1]-1?r=(2*g+(t[1]-1)*r)/(t[1]+1):r=s/t[1]),h>=f-1&&(a=o-r,m.dif=a,l+=a,h>=f+t[2]-2&&(h>f+t[2]-2?c=(a*2+c*(t[2]-1))/(t[2]+1):c=l/t[2],m.macd=(a-c)*2,m.dea=c)),u[d.timestamp]=m,u},{})}},T9={name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0;const r=[],a={};return n.forEach((l,c)=>{const f=n[c-1]??l;l.close<f.close?o-=l.volume??0:l.close>f.close&&(o+=l.volume??0);const u={obv:o};s+=o,c>=t[0]-1&&(u.maObv=s/t[0],s-=r[c-(t[0]-1)].obv??0),r.push(u),a[l.timestamp]=u}),a}},F9={name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:n=>{let e=0;return n.reduce((t,s,o)=>{const r={},a=s.close,l=s.volume??1,c=(n[o-1]??s).close;let f=0;const u=c*l;return u!==0&&(f=(a-c)/u),e+=f,r.pvt=e,t[s.timestamp]=r,t},{})}},L9={name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0;const r=[],a=[],l={};return n.forEach((c,f)=>{const u={},d=(n[f-1]??c).close,h=c.close-d>0?1:0;r.push(h),s+=h,f>=t[0]-1&&(u.psy=s/t[0]*100,o+=u.psy,f>=t[0]+t[1]-2&&(u.maPsy=o/t[1],o-=a[f-(t[1]-1)].psy??0),s-=r[f-(t[0]-1)]),a.push(u),l[c.timestamp]=u}),l}},E9={name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=[],o={};let r=0;return n.forEach((a,l)=>{const c={};if(l>=t[0]-1){const f=a.close,u=(n[l-t[0]]??n[l-(t[0]-1)]).close;u!==0?c.roc=(f-u)/u*100:c.roc=0,r+=c.roc,l>=t[0]-1+t[1]-1&&(c.maRoc=r/t[1],r-=s[l-(t[1]-1)].roc??0)}s.push(c),o[a.timestamp]=c}),o}},$9={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>{const s=t+1;return{key:`rsi${s}`,title:`RSI${s}: `,type:"line"}}),calc:(n,e)=>{const{calcParams:t,figures:s}=e,o=[],r=[];return n.reduce((a,l,c)=>{const f={},u=(n[c-1]??l).close,d=l.close-u;return t.forEach((h,m)=>{if(d>0?o[m]=(o[m]??0)+d:r[m]=(r[m]??0)+Math.abs(d),c>=h-1){r[m]!==0?f[s[m].key]=100-100/(1+o[m]/r[m]):f[s[m].key]=0;const g=n[c-(h-1)],w=n[c-h]??g,C=g.close-w.close;C>0?o[m]-=C:r[m]-=Math.abs(C)}}),a[l.timestamp]=f,a},{})}},D9={name:"SMA",shortName:"SMA",series:"price",calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:(n,e)=>{const t=e.calcParams;let s=0,o=0;return n.reduce((r,a,l)=>{const c={},f=a.close;return s+=f,l>=t[0]-1&&(l>t[0]-1?o=(f*t[1]+o*(t[0]-t[1]+1))/(t[0]+1):o=s/t[0],c.sma=o),r[a.timestamp]=c,r},{})}},R9={name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=[],o={};return n.forEach((r,a)=>{var f,u;const l={},c=r.close;if(a>=t[0]-1){const d=I3(n.slice(a-(t[0]-1),a+1),"high","low"),h=d[0],m=d[1],g=h-m,w=(c-m)/(g===0?1:g)*100;l.k=((t[1]-1)*(((f=s[a-1])==null?void 0:f.k)??50)+w)/t[1],l.d=((t[2]-1)*(((u=s[a-1])==null?void 0:u.d)??50)+l.k)/t[2],l.j=3*l.k-2*l.d}s.push(l),o[r.timestamp]=l}),o}},j9={name:"SAR",shortName:"SAR",series:"price",calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:({data:n,indicator:e,defaultStyles:t})=>{const{current:s}=n,o=(s==null?void 0:s.sar)??Number.MIN_SAFE_INTEGER,r=(((s==null?void 0:s.high)??0)+((s==null?void 0:s.low)??0))/2;return{color:o<r?Nh(e.styles,"circles[0].upColor",t.circles[0].upColor):Nh(e.styles,"circles[0].downColor",t.circles[0].downColor)}}}],calc:(n,e)=>{const t=e.calcParams,s=t[0]/100,o=t[1]/100,r=t[2]/100;let a=s,l=-100,c=!1,f=0;return n.reduce((u,d,h)=>{const m=f,g=d.high,w=d.low;if(c){(l===-100||l<g)&&(l=g,a=Math.min(a+o,r)),f=m+a*(l-m);const C=Math.min(n[Math.max(1,h)-1].low,w);f>d.low?(f=l,a=s,l=-100,c=!c):f>C&&(f=C)}else{(l===-100||l>w)&&(l=w,a=Math.min(a+o,r)),f=m+a*(l-m);const C=Math.max(n[Math.max(1,h)-1].high,g);f<d.high?(f=l,a=0,l=-100,c=!c):f<C&&(f=C)}return u[d.timestamp]={high:g,low:w,sar:f},u},{})}},B9={name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0,r=0,a=0,l=0,c=0,f=0;const u=[],d={};return n.forEach((h,m)=>{const g={},w=h.close;if(s+=w,m>=t[0]-1&&(m>t[0]-1?o=(2*w+(t[0]-1)*o)/(t[0]+1):o=s/t[0],l+=o,m>=t[0]*2-2&&(m>t[0]*2-2?r=(2*o+(t[0]-1)*r)/(t[0]+1):r=l/t[0],c+=r,m>=t[0]*3-3))){let C=0,P=0;m>t[0]*3-3?(C=(2*r+(t[0]-1)*a)/(t[0]+1),P=(C-a)/a*100):C=c/t[0],a=C,g.trix=P,f+=P,m>=t[0]*3+t[1]-4&&(g.maTrix=f/t[1],f-=u[m-(t[1]-1)].trix??0)}u.push(g),d[h.timestamp]=g}),d}};function V6(){return{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{const s=n.current;let o=Nh(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor);return $s(s)&&(s.close>s.open?o=Nh(e.styles,"bars[0].upColor",t.bars[0].upColor):s.close<s.open&&(o=Nh(e.styles,"bars[0].downColor",t.bars[0].downColor))),{color:o}}}}const O9={name:"VOL",shortName:"VOL",series:"volume",calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},V6()],regenerateFigures:n=>{const e=n.map((t,s)=>({key:`ma${s+1}`,title:`MA${t}: `,type:"line"}));return e.push(V6()),e},calc:(n,e)=>{const{calcParams:t,figures:s}=e,o=[];return n.reduce((r,a,l)=>{const c=a.volume??0,f={volume:c,open:a.open,close:a.close};return t.forEach((u,d)=>{o[d]=(o[d]??0)+c,l>=u-1&&(f[s[d].key]=o[d]/u,o[d]-=n[l-(u-1)].volume??0)}),r[a.timestamp]=f,r},{})}},z9={name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0,r=0,a=0;const l=[],c={};return n.forEach((f,u)=>{const d={},h=f.close,m=(n[u-1]??f).close,g=f.volume??0;if(h>m?s+=g:h<m?o+=g:r+=g,u>=t[0]-1){const w=r/2;o+w===0?d.vr=0:d.vr=(s+w)/(o+w)*100,a+=d.vr,u>=t[0]+t[1]-2&&(d.maVr=a/t[1],a-=l[u-(t[1]-1)].vr??0);const C=n[u-(t[0]-1)],P=n[u-t[0]]??C,I=C.close,A=C.volume??0;I>P.close?s-=A:I<P.close?o-=A:r-=A}l.push(d),c[f.timestamp]=d}),c}},V9={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`wr${t+1}`,title:`WR${t+1}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:s}=e;return n.reduce((o,r,a)=>{const l={},c=r.close;return t.forEach((f,u)=>{const d=f-1;if(a>=d){const h=I3(n.slice(a-d,a+1),"high","low"),m=h[0],g=h[1],w=m-g;l[s[u].key]=w===0?0:(c-m)/w*100}}),o[r.timestamp]=l,o},{})}},$w={},W9=[h9,v9,g9,y9,b9,x9,w9,k9,S9,C9,I9,P9,M9,N9,A9,T9,F9,L9,E9,$9,D9,R9,j9,B9,O9,z9,V9];W9.forEach(n=>{$w[n.name]=A2.extend(n)});function J2(n){$w[n.name]=A2.extend(n)}function P3(n){return $w[n]??null}function Gg(n,e){const t=(e==null?void 0:e.ignoreEvent)??!1;return fy(t)?!t:!t.includes(n)}const W6=1,F1=-1,H9="overlay_",E_="overlay_figure_";class T2{constructor(e){Te(this,"id");Te(this,"groupId","");Te(this,"paneId");Te(this,"name");Te(this,"totalStep",1);Te(this,"currentStep",W6);Te(this,"lock",!1);Te(this,"visible",!0);Te(this,"zLevel",0);Te(this,"needDefaultPointFigure",!1);Te(this,"needDefaultXAxisFigure",!1);Te(this,"needDefaultYAxisFigure",!1);Te(this,"mode","normal");Te(this,"modeSensitivity",8);Te(this,"points",[]);Te(this,"extendData");Te(this,"styles",null);Te(this,"createPointFigures",null);Te(this,"createXAxisFigures",null);Te(this,"createYAxisFigures",null);Te(this,"performEventPressedMove",null);Te(this,"performEventMoveForDrawing",null);Te(this,"onDrawStart",null);Te(this,"onDrawing",null);Te(this,"onDrawEnd",null);Te(this,"onClick",null);Te(this,"onDoubleClick",null);Te(this,"onRightClick",null);Te(this,"onPressedMoveStart",null);Te(this,"onPressedMoving",null);Te(this,"onPressedMoveEnd",null);Te(this,"onMouseMove",null);Te(this,"onMouseEnter",null);Te(this,"onMouseLeave",null);Te(this,"onRemoved",null);Te(this,"onSelected",null);Te(this,"onDeselected",null);Te(this,"_prevZLevel",0);Te(this,"_prevOverlay");Te(this,"_prevPressedPoint",null);Te(this,"_prevPressedPoints",[]);this.override(e)}override(e){var c;this._prevOverlay=n1(this);const{id:t,name:s,currentStep:o,points:r,styles:a,...l}=e;if(lh(this,l),hd(this.name)||(this.name=s??""),!hd(this.id)&&hd(t)&&(this.id=t),$s(a)&&(this.styles??(this.styles={}),lh(this.styles,a)),t0(r)&&r.length>0){let f=0;if(this.points=[...r],r.length>=this.totalStep-1?(this.currentStep=F1,f=this.totalStep-1):(this.currentStep=r.length+1,f=r.length),eg(this.performEventMoveForDrawing))for(let u=0;u<f;u++)this.performEventMoveForDrawing({currentStep:u+2,mode:this.mode,points:this.points,performPointIndex:u,performPoint:this.points[u]});this.currentStep===F1&&((c=this.performEventPressedMove)==null||c.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}))}}getPrevZLevel(){return this._prevZLevel}setPrevZLevel(e){this._prevZLevel=e}shouldUpdate(){const e=this._prevOverlay.zLevel!==this.zLevel,t=e||JSON.stringify(this._prevOverlay.points)!==JSON.stringify(this.points)||this._prevOverlay.visible!==this.visible||this._prevOverlay.extendData!==this.extendData||this._prevOverlay.styles!==this.styles;return{sort:e,draw:t}}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=F1:this.currentStep++}forceComplete(){this.currentStep=F1}isDrawing(){return this.currentStep!==F1}isStart(){return this.currentStep===W6}eventMoveForDrawing(e){var o;const t=this.currentStep-1,s={};Ca(e.timestamp)&&(s.timestamp=e.timestamp),Ca(e.dataIndex)&&(s.dataIndex=e.dataIndex),Ca(e.value)&&(s.value=e.value),this.points[t]=s,(o=this.performEventMoveForDrawing)==null||o.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:t,performPoint:s})}eventPressedPointMove(e,t){var s;this.points[t].timestamp=e.timestamp,Ca(e.value)&&(this.points[t].value=e.value),(s=this.performEventPressedMove)==null||s.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:t,performPoint:this.points[t]})}startPressedMove(e){this._prevPressedPoint={...e},this._prevPressedPoints=n1(this.points)}eventPressedOtherMove(e,t){if(this._prevPressedPoint!==null){let s=null;Ca(e.dataIndex)&&Ca(this._prevPressedPoint.dataIndex)&&(s=e.dataIndex-this._prevPressedPoint.dataIndex);let o=null;Ca(e.value)&&Ca(this._prevPressedPoint.value)&&(o=e.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map(r=>{Ca(r.timestamp)&&(r.dataIndex=t.timestampToDataIndex(r.timestamp));const a={...r};return Ca(s)&&Ca(r.dataIndex)&&(a.dataIndex=r.dataIndex+s,a.timestamp=t.dataIndexToTimestamp(a.dataIndex)??void 0),Ca(o)&&Ca(r.value)&&(a.value=r.value+o),a})}}static extend(e){class t extends T2{constructor(){super(e)}}return t}}const q9={name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:n,coordinates:e,bounding:t,overlay:s,yAxis:o})=>{var a;const r=s.points;if(e.length>0){let l=0;(o==null?void 0:o.isInCandle())??!0?l=((a=n.getSymbol())==null?void 0:a.pricePrecision)??Ah.PRICE:n.getIndicators({paneId:s.paneId}).forEach(m=>{l=Math.max(l,m.precision)});const c=[],f=[],u=0,d=t.width;if(e.length>1&&Ca(r[0].value)&&Ca(r[1].value)){const h=[1,.786,.618,.5,.382,.236,0],m=e[0].y-e[1].y,g=r[0].value-r[1].value;h.forEach(w=>{const C=e[1].y+m*w,P=n.getDecimalFold().format(n.getThousandsSeparator().format(((r[1].value??0)+g*w).toFixed(l)));c.push({coordinates:[{x:u,y:C},{x:d,y:C}]}),f.push({x:u,y:C,text:`${P} (${(w*100).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:c},{type:"text",isCheckEvent:!1,attrs:f}]}return[]}},U9={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s={x:0,y:n[0].y};$s(n[1])&&n[0].x<n[1].x&&(s.x=e.width);const o=[n[0],s];return[{type:"line",attrs:{coordinates:o},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:o}}]},performEventPressedMove:({points:n,performPoint:e})=>{n[0].value=e.value,n[1].value=e.value},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].value=t.value)}},G9={name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=[];return n.length===2&&t.push({coordinates:n}),[{type:"line",attrs:t,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:t}]},performEventPressedMove:({points:n,performPoint:e})=>{n[0].value=e.value,n[1].value=e.value},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].value=t.value)}},Y9={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s=[{x:0,y:n[0].y},{x:e.width,y:n[0].y}];return[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}}]}},ah=(n,e,t,s)=>{if(!t||!t.from&&!t.to)return null;const o=t.from||s,r=t.to||s;if(!o&&!r)return null;const a=Number.isFinite(e.minX)?e.minX:0,l=Number.isFinite(e.maxX)&&e.maxX!==e.minX?e.maxX:a+1,c=Number.isFinite(e.minY)?e.minY:0,f=Number.isFinite(e.maxY)&&e.maxY!==e.minY?e.maxY:c+1,u=String(t.mode||"vertical").toLowerCase();let d;if(u==="horizontal")d=n.createLinearGradient(a,c,l,c);else if(u==="radial"){const h=(a+l)/2,m=(c+f)/2,g=Math.max(l-a,f-c)/2;d=n.createRadialGradient(h,m,0,h,m,Math.max(1,g))}else d=n.createLinearGradient(a,c,a,f);return d.addColorStop(0,o),d.addColorStop(1,r),d};class Dw{constructor(){Te(this,"_children",[]);Te(this,"_callbacks",new Map)}registerEvent(e,t){return this._callbacks.set(e,t),this}onEvent(e,t){const s=this._callbacks.get(e);return $s(s)&&this.checkEventOn(t)?s(t):!1}dispatchEventToChildren(e,t){const s=this._children.length-1;if(s>-1){for(let o=s;o>-1;o--)if(this._children[o].dispatchEvent(e,t))return!0}return!1}dispatchEvent(e,t){return this.dispatchEventToChildren(e,t)?!0:this.onEvent(e,t)}addChild(e){return this._children.push(e),this}clear(){this._children=[]}}const K9=8,X9=12;function l1(n){return n.isTouch?X9:K9}class F2 extends Dw{constructor(t){super();Te(this,"attrs");Te(this,"styles");this.attrs=t.attrs,this.styles=t.styles}checkEventOn(t){return this.checkEventOnImp(t,this.attrs,this.styles)}setAttrs(t){return this.attrs=t,this}setStyles(t){return this.styles=t,this}draw(t){this.drawImp(t,this.attrs,this.styles)}static extend(t){class s extends F2{checkEventOnImp(r,a,l){return t.checkEventOn(r,a,l)}drawImp(r,a,l){t.draw(r,a,l)}}return s}}function M3(n,e,t){let s=[];s=s.concat(e);const o=l1(n),r=Math.max(0,Ca(t==null?void 0:t.size)?t.size:0),a=o+(r>1?r/2:0);for(const l of s){const{coordinates:c}=l;if(c.length>1)for(let f=1;f<c.length;f++){const u=c[f-1],d=c[f];if(u.x===d.x){if(Math.abs(u.y-n.y)+Math.abs(d.y-n.y)-Math.abs(u.y-d.y)<a+a&&Math.abs(n.x-u.x)<a)return!0}else{const h=L2(u,d),m=Rw(h,n),g=Math.abs(m-n.y);if(Math.abs(u.x-n.x)+Math.abs(d.x-n.x)-Math.abs(u.x-d.x)<a+a&&g*g/(h[0]*h[0]+1)<a*a)return!0}}}return!1}function Rw(n,e){return n!==null?e.x*n[0]+n[1]:e.y}function py(n,e,t){const s=L2(n,e);return Rw(s,t)}function L2(n,e){const t=n.x-e.x;if(t!==0){const s=(n.y-e.y)/t,o=n.y-s*n.x;return[s,o]}return null}function N3(n,e,t){const s=e.length,o=Ca(t)?t>0&&t<1?t:0:t?.5:0;if(o>0&&s>2){let r=e[0].x,a=e[0].y;for(let c=1;c<s-1;c++){const f=e[c-1],u=e[c],d=e[c+1],h=u.x-f.x,m=u.y-f.y,g=d.x-u.x,w=d.y-u.y;let C=d.x-f.x,P=d.y-f.y;const I=Math.sqrt(h*h+m*m),A=Math.sqrt(g*g+w*w),M=A/(A+I);let F=u.x+C*o*M,B=u.y+P*o*M;F=Math.min(F,Math.max(d.x,u.x)),B=Math.min(B,Math.max(d.y,u.y)),F=Math.max(F,Math.min(d.x,u.x)),B=Math.max(B,Math.min(d.y,u.y)),C=F-u.x,P=B-u.y;let $=u.x-C*I/A,L=u.y-P*I/A;$=Math.min($,Math.max(f.x,u.x)),L=Math.min(L,Math.max(f.y,u.y)),$=Math.max($,Math.min(f.x,u.x)),L=Math.max(L,Math.min(f.y,u.y)),C=u.x-$,P=u.y-L,F=u.x+C*A/I,B=u.y+P*A/I,n.bezierCurveTo(r,a,$,L,u.x,u.y),r=F,a=B}const l=e[s-1];n.bezierCurveTo(r,a,l.x,l.y,l.x,l.y)}else for(let r=1;r<s;r++)n.lineTo(e[r].x,e[r].y)}function Z9(n,e,t){let s=[];s=s.concat(e);const{style:o="solid",smooth:r=!1,size:a=1,color:l="currentColor",gradient:c,dashedValue:f=[2,2]}=t,u=!!(c&&(c.from||c.to));n.lineWidth=a,o==="dashed"?n.setLineDash(f):n.setLineDash([]);const d=a%2===1?.5:0;s.forEach(({coordinates:h})=>{if(h.length>1){if(u){let m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,w=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY;for(const I of h)!Number.isFinite(I.x)||!Number.isFinite(I.y)||(I.x<m&&(m=I.x),I.x>g&&(g=I.x),I.y<w&&(w=I.y),I.y>C&&(C=I.y));const P=ah(n,{minX:Number.isFinite(m)?m:0,maxX:Number.isFinite(g)&&g!==m?g:Number.isFinite(m)?m+1:1,minY:Number.isFinite(w)?w:0,maxY:Number.isFinite(C)&&C!==w?C:Number.isFinite(w)?w+1:1},c,String(l||"#000000"));P?n.strokeStyle=P:n.strokeStyle=l}else n.strokeStyle=l;h.length===2&&(h[0].x===h[1].x||h[0].y===h[1].y)?(n.beginPath(),h[0].x===h[1].x?(n.moveTo(h[0].x+d,h[0].y),n.lineTo(h[1].x+d,h[1].y)):(n.moveTo(h[0].x,h[0].y+d),n.lineTo(h[1].x,h[1].y+d)),n.stroke(),n.closePath()):(n.save(),a%2===1&&n.translate(.5,.5),n.beginPath(),n.moveTo(h[0].x,h[0].y),N3(n,h,r),n.stroke(),n.closePath(),n.restore())}})}const J9={name:"line",checkEventOn:M3,draw:(n,e,t)=>{Z9(n,e,t)}};function A3(n,e,t){const s=t??0,o=[];if(n.length>1)if(n[0].x===n[1].x){const a=e.height;if(o.push({coordinates:[{x:n[0].x,y:0},{x:n[0].x,y:a}]}),n.length>2){o.push({coordinates:[{x:n[2].x,y:0},{x:n[2].x,y:a}]});const l=n[0].x-n[2].x;for(let c=0;c<s;c++){const f=l*(c+1);o.push({coordinates:[{x:n[0].x+f,y:0},{x:n[0].x+f,y:a}]})}}}else{const a=e.width,l=L2(n[0],n[1]),c=l[0],f=l[1];if(o.push({coordinates:[{x:0,y:0*c+f},{x:a,y:a*c+f}]}),n.length>2){const u=n[2].y-c*n[2].x;o.push({coordinates:[{x:0,y:0*c+u},{x:a,y:a*c+u}]});const d=f-u;for(let h=0;h<s;h++){const m=f+d*(h+1);o.push({coordinates:[{x:0,y:0*c+m},{x:a,y:a*c+m}]})}}}return o}const Q9={name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s=A3(n,e);return[{type:"line",attrs:s,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:s}]}},eI={name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s=A3(n,e,1);return[{type:"line",attrs:s,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:s}]}},tI={name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:n,coordinates:e,bounding:t,overlay:s,yAxis:o})=>{var f;let a=0;(o==null?void 0:o.isInCandle())??!0?a=((f=n.getSymbol())==null?void 0:f.pricePrecision)??Ah.PRICE:n.getIndicators({paneId:s.paneId}).forEach(d=>{a=Math.max(a,d.precision)});const{value:l=0}=s.points[0],c=[e[0],{x:t.width,y:e[0].y}];return[{type:"line",attrs:{coordinates:c},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:c}},{type:"text",ignoreEvent:!0,attrs:{x:e[0].x,y:e[0].y,text:n.getDecimalFold().format(n.getThousandsSeparator().format(l.toFixed(a))),baseline:"bottom"}}]}};function nI(n,e){if(n.length>1){let t={x:0,y:0};return n[0].x===n[1].x&&n[0].y!==n[1].y?n[0].y<n[1].y?t={x:n[0].x,y:e.height}:t={x:n[0].x,y:0}:n[0].x>n[1].x?t={x:0,y:py(n[0],n[1],{x:0,y:n[0].y})}:t={x:e.width,y:py(n[0],n[1],{x:e.width,y:n[0].y})},{coordinates:[n[0],t]}}return[]}const sI={name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s=nI(n,e);return[{type:"line",attrs:s,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:s}]}},oI={name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length===2?[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}}]:[]},iI={name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{if(n.length===2){if(n[0].x===n[1].x){const o=[{x:n[0].x,y:0},{x:n[0].x,y:e.height}];return[{type:"line",attrs:{coordinates:o},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:o}}]}const s=[{x:0,y:py(n[0],n[1],{x:0,y:n[0].y})},{x:e.width,y:py(n[0],n[1],{x:e.width,y:n[0].y})}];return[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}}]}return[]}},rI={name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{if(n.length===2){const s={x:n[0].x,y:0};n[0].y<n[1].y&&(s.y=e.height);const o=[n[0],s];return[{type:"line",attrs:{coordinates:o},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:o}}]}return[]},performEventPressedMove:({points:n,performPoint:e})=>{n[0].timestamp=e.timestamp,n[0].dataIndex=e.dataIndex,n[1].timestamp=e.timestamp,n[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex)}},aI={name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length===2?[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}}]:[],performEventPressedMove:({points:n,performPoint:e})=>{n[0].timestamp=e.timestamp,n[0].dataIndex=e.dataIndex,n[1].timestamp=e.timestamp,n[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex)}},lI={name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s=[{x:n[0].x,y:0},{x:n[0].x,y:e.height}];return[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}}]}},cI={name:"simpleAnnotation",totalStep:2,styles:{line:{style:"dashed"}},createPointFigures:({overlay:n,coordinates:e})=>{let t="";$s(n.extendData)&&(eg(n.extendData)?t=n.extendData(n):t=n.extendData??"");const s=e[0].x,o=e[0].y-6,r=o-50,a=r-5;return[{type:"line",attrs:{coordinates:[{x:s,y:o},{x:s,y:r}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:s,y:r},{x:s-4,y:a},{x:s+4,y:a}]},ignoreEvent:!0},{type:"text",attrs:{x:s,y:a,text:t,align:"center",baseline:"bottom"},ignoreEvent:!0}]}},uI={name:"simpleTag",totalStep:2,styles:{line:{style:"dashed"}},createPointFigures:({bounding:n,coordinates:e})=>({type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:n.width,y:e[0].y}]},ignoreEvent:!0}),createYAxisFigures:({chart:n,overlay:e,coordinates:t,bounding:s,yAxis:o})=>{var f;const r=(o==null?void 0:o.isFromZero())??!1;let a="left",l=0;r?(a="left",l=0):(a="right",l=s.width);let c="";return $s(e.extendData)&&(eg(e.extendData)?c=e.extendData(e):c=e.extendData??""),!$s(c)&&Ca(e.points[0].value)&&(c=Mh(e.points[0].value,((f=n.getSymbol())==null?void 0:f.pricePrecision)??Ah.PRICE)),{type:"text",attrs:{x:l,y:t[0].y,text:c,align:a,baseline:"middle"}}}},jw={},dI=[q9,U9,G9,Y9,Q9,eI,tI,sI,oI,iI,rI,aI,lI,cI,uI];dI.forEach(n=>{jw[n.name]=T2.extend(n)});function T3(n){jw[n.name]=T2.extend(n)}function fI(n){return jw[n]??null}const pI={grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},title:{color:"#76808F"},legend:{color:"#76808F"}}},indicator:{tooltip:{title:{color:"#76808F"},legend:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},ticduty:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#6b7280"},ticduty:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},mI={grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},title:{color:"#929AA5"},legend:{color:"#929AA5"}}},indicator:{tooltip:{title:{color:"#929AA5"},legend:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},ticduty:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#9aa0a6"},ticduty:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}},hI={light:pI,dark:mI};function vI(n){return hI[n]??null}const sy=30,F3=100,td={CANDLE:"candle_pane",INDICATOR:"indicator_pane_",X_AXIS:"x_axis_pane"},H6={MIN:1,MAX:900},gI=10,_I=80,yI=.2,Yx=10,ab=Number.MAX_SAFE_INTEGER,bI=-1e4,Tp=24*60*60*1e3;function Q2(n){if(n.length===0)return 0;const e=n.slice().sort((t,s)=>t-s);return e[Math.floor(e.length/2)]}function ex(n,e){if(n.length===0)return 0;const t=Math.max(0,Math.min(1,e)),s=Math.floor(t*(n.length-1));return n[s]}function xI(n){if(n.length===0)return 0;let e=0,t=0;for(const r of n){const a=2*Math.PI*(r/Tp);e+=Math.sin(a),t+=Math.cos(a)}const s=Math.atan2(e/n.length,t/n.length);return(s<0?s+2*Math.PI:s)/(2*Math.PI)*Tp}function b_(n,e){return Math.floor((n-e)/Tp)*Tp+e}function s1(n){return new Date(n).getUTCDay()}function L3(n,e,t){if(e<=0)return 0;const s=t.reduce((l,c)=>l+(c?1:0),0);if(s<=0)return 0;let r=Math.floor(e/7)*s;const a=e%7;for(let l=0;l<a;l++){const c=(n+1+l)%7;t[c]&&r++}return r}function wI(n,e,t){if(e<=0)return 0;const s=t.reduce((l,c)=>l+(c?1:0),0);if(s<=0)return 0;let r=Math.floor(e/7)*s;const a=e%7;for(let l=0;l<a;l++){const c=(n+7-(1+l)%7)%7;t[c]&&r++}return r}function kI(n){try{if(!Array.isArray(n)||n.length<20)return null;const e=n.slice(Math.max(0,n.length-2500)),t=[];for(const M of e){const F=M==null?void 0:M.timestamp;typeof F=="number"&&isFinite(F)&&t.push(F)}if(t.length<20)return null;t.sort((M,F)=>M-F);const s=[];for(let M=1;M<t.length;M++){const F=t[M]-t[M-1];F>0&&isFinite(F)&&s.push(F)}if(s.length<10)return null;s.sort((M,F)=>M-F);const o=ex(s,.1)||s[0];if(!o||!isFinite(o)||o<=0)return null;const r=Math.max(o*6,o*3+6e4),a=[];for(let M=1;M<t.length;M++)if(t[M]-t[M-1]>r){const $=((t[M]+t[M-1])/2%Tp+Tp)%Tp;a.push($)}const l=a.length>=4?xI(a):0,c=new Map;for(const M of t){const F=b_(M,l),B=c.get(F);B?(B.count++,M<B.minTs&&(B.minTs=M),M>B.maxTs&&(B.maxTs=M)):c.set(F,{minTs:M,maxTs:M,count:1})}const f=Array.from(c.keys()).sort((M,F)=>M-F),u=f.slice(Math.max(0,f.length-40)),d=[],h=[],m=new Array(7).fill(!1),g=[];for(const M of u){const F=c.get(M);F!=null&&F.count&&g.push(F.count)}const w=Q2(g.filter(M=>M>0)),C=Math.max(2,Math.floor(w*.6));for(const M of u){const F=c.get(M);if(!F)continue;const B=s1(M);m[B]=!0;const $=F.minTs-M,L=F.maxTs-M+o;F.count>=C&&isFinite($)&&isFinite(L)&&$>=0&&L>=0&&$<Tp&&L<=Tp&&L>$&&(d.push($),h.push(L))}let P=0,I=Tp;if(d.length>=5&&h.length>=5)P=Q2(d),I=Q2(h);else{const M=[];for(const $ of t){const L=(($-l)%Tp+Tp)%Tp;M.push(L)}M.sort(($,L)=>$-L);const F=ex(M,.05),B=ex(M,.95);P=F,I=Math.min(Tp,B+o)}if(P>=0&&I>P&&I<=Tp||(P=0,I=Tp),I-P>Tp*.92&&(P=0,I=Tp),!m.some(Boolean))for(let M=0;M<7;M++)m[M]=!0;return{boundaryOffsetMs:l,openMs:P,closeMs:I,activeWeekdays:m}}catch{return null}}function tx(n,e,t){if(n===e)return 0;let s=1,o=n,r=e;o>r&&(s=-1,o=e,r=n);const{boundaryOffsetMs:a,openMs:l,closeMs:c,activeWeekdays:f}=t,u=Math.max(0,c-l);if(u<=0)return 0;const d=b_(o,a),h=b_(r,a),m=o-d,g=r-h,w=s1(d),C=s1(h);if(d===h){if(!f[w])return 0;const M=Math.max(m,l),F=Math.min(g,c);return s*Math.max(0,F-M)}let P=0;f[w]&&(P+=Math.max(0,c-Math.max(m,l))),f[C]&&(P+=Math.max(0,Math.min(g,c)-l));const I=Math.max(0,Math.round((h-d)/Tp)),A=Math.max(0,I-1);if(A>0){const M=L3(w,A,f);P+=M*u}return s*P}function oy(n,e,t){let s=n,o=e;for(let r=0;r<14;r++)if(s+=Tp,o=(o+1)%7,t[o])return{dayStart:s,weekday:o};return{dayStart:n+Tp,weekday:(e+1)%7}}function iy(n,e,t){let s=n,o=e;for(let r=0;r<14;r++)if(s-=Tp,o=(o+6)%7,t[o])return{dayStart:s,weekday:o};return{dayStart:n-Tp,weekday:(e+6)%7}}function nx(n,e,t){if(e===0||!Number.isFinite(e))return n;const{boundaryOffsetMs:s,openMs:o,closeMs:r,activeWeekdays:a}=t;if(Math.max(0,r-o)<=0)return n;let c=n,f=e;const u=f>0;for(f=Math.abs(f);f>0;){let d=b_(c,s),h=s1(d),m=c-d;if(!a[h]){const g=u?oy(d,h,a):iy(d,h,a);d=g.dayStart,h=g.weekday,m=u?o:r,c=d+m}if(u){if(m<o)m=o,c=d+m;else if(m>=r){const C=oy(d,h,a);d=C.dayStart,h=C.weekday,m=o,c=d+m}const g=Math.max(0,r-m);if(f<g)return c+f;f-=g,c=oy(d,h,a).dayStart+o}else{if(m>r)m=r,c=d+m;else if(m<=o){const C=iy(d,h,a);d=C.dayStart,h=C.weekday,m=r,c=d+m}const g=Math.max(0,m-o);if(f<g)return c-f;f-=g,c=iy(d,h,a).dayStart+r}}return c}function SI(n,e,t){if(n===e)return 0;const{boundaryOffsetMs:s,activeWeekdays:o}=t,r=b_(n,s),a=b_(e,s);if(r===a)return 0;const l=s1(r),c=Math.round((a-r)/Tp);return c>0?L3(l,c,o):-wI(l,Math.abs(c),o)}function CI(n,e,t){if(e===0||!Number.isFinite(e))return n;const{boundaryOffsetMs:s,activeWeekdays:o}=t,r=o.reduce((h,m)=>h+(m?1:0),0);if(r<=0)return n;let a=b_(n,s),l=s1(a),c=n-a;if(!o[l])if(e>0){const h=oy(a,l,o);a=h.dayStart,l=h.weekday}else{const h=iy(a,l,o);a=h.dayStart,l=h.weekday}let f=Math.abs(e);const u=e>0,d=Math.floor(f/r);for(d>0&&(a+=(u?1:-1)*d*7*Tp,f-=d*r);f>0;){const h=u?oy(a,l,o):iy(a,l,o);a=h.dayStart,l=h.weekday,f--}return c=Math.max(0,Math.min(Tp-1,c)),a+c}class II{constructor(e,t){Te(this,"_chart");Te(this,"_styles",m9());Te(this,"_formatter",{formatDate:({dateTimeFormat:e,timestamp:t,template:s})=>w3(e,t,s),formatBigNumber:k3,formatExtendText:e=>""});Te(this,"_innerFormatter",{formatDate:(e,t,s)=>this._formatter.formatDate({dateTimeFormat:this._dateTimeFormat,timestamp:e,template:t,type:s}),formatBigNumber:e=>this._formatter.formatBigNumber(e),formatExtendText:e=>this._formatter.formatExtendText(e)});Te(this,"_locale","en-US");Te(this,"_thousandsSeparator",{sign:",",format:e=>S3(e,this._thousandsSeparator.sign)});Te(this,"_decimalFold",{threshold:3,format:e=>C3(e,this._decimalFold.threshold)});Te(this,"_symbol",null);Te(this,"_period",null);Te(this,"_sessionCacheKey",null);Te(this,"_sessionCache",null);Te(this,"_sessionBySymbol",new Map);Te(this,"_dataList",[]);Te(this,"_dataLoader",null);Te(this,"_loading",!1);Te(this,"_dataLoadMore",{forward:!1,backward:!1});Te(this,"_dateTimeFormat");Te(this,"_zoomEnabled",!0);Te(this,"_scrollEnabled",!0);Te(this,"_totalBarSpace",0);Te(this,"_barSpace",gI);Te(this,"_gapBarSpace",0);Te(this,"_offsetRightDistance",_I);Te(this,"_lastBarRightSideDiffBarCount");Te(this,"_startLastBarRightSideDiffBarCount",0);Te(this,"_scrollLimitRole","bar_count");Te(this,"_minVisibleBarCount",{left:2,right:2});Te(this,"_maxOffsetDistance",{left:50,right:50});Te(this,"_visibleRange",B6());Te(this,"_visibleRangeDataList",[]);Te(this,"_visibleRangeHighLowPrice",[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}]);Te(this,"_crosshair",{});Te(this,"_actions",new Map);Te(this,"_indicators",new Map);Te(this,"_taskScheduler",new s9);Te(this,"_overlays",new Map);Te(this,"_progressOverlayInfo",null);Te(this,"_lastPriceMarkExtendTextUpdateTimers",[]);Te(this,"_pressedOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});Te(this,"_hoverOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});Te(this,"_clickOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});Te(this,"_layoutRafId",null);Te(this,"_pendingLayoutOptions",{measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1});Te(this,"_overlayRafId",null);Te(this,"_perfScrollCalls",0);Te(this,"_perfZoomCalls",0);Te(this,"_perfLayoutSchedules",0);Te(this,"_perfLastWindowTs",typeof performance<"u"?performance.now():Date.now());this._chart=e,this._calcOptimalBarSpace(),this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace;const{styles:s,locale:o,timezone:r,formatter:a,thousandsSeparator:l,decimalFold:c}=t??{};$s(s)&&this.setStyles(s),hd(o)&&this.setLocale(o),this.setTimezone(r??""),$s(a)&&this.setFormatter(a),$s(l)&&this.setThousandsSeparator(l),$s(c)&&this.setDecimalFold(c)}setStyles(e){var s,o,r,a,l,c;let t=null;if(hd(e)?t=vI(e):t=e,lh(this._styles,t),t0((r=(o=(s=t==null?void 0:t.candle)==null?void 0:s.tooltip)==null?void 0:o.legend)==null?void 0:r.template)&&(this._styles.candle.tooltip.legend.template=t.candle.tooltip.legend.template),$s((c=(l=(a=t==null?void 0:t.candle)==null?void 0:a.priceMark)==null?void 0:l.last)==null?void 0:c.extendTexts)){this._clearLastPriceMarkExtendTextUpdateTimer();const f=[];this._styles.candle.priceMark.last.extendTexts.forEach(u=>{const d=u.updateInterval;if(u.show&&d>0&&!f.includes(d)){f.push(d);const h=setInterval(()=>{this._chart.updatePane(Ff.Main,td.CANDLE)},d);this._lastPriceMarkExtendTextUpdateTimers.push(h)}})}}getStyles(){return this._styles}setFormatter(e){lh(this._formatter,e)}getFormatter(){return this._formatter}getInnerFormatter(){return this._innerFormatter}setLocale(e){this._locale=e}getLocale(){return this._locale}setTimezone(e){if(!$s(this._dateTimeFormat)||this.getTimezone()!==e){const t={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};e.length>0&&(t.timeZone=e);let s=null;try{s=new Intl.DateTimeFormat("en",t)}catch{}s!==null&&(this._dateTimeFormat=s)}}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getDateTimeFormat(){return this._dateTimeFormat}setThousandsSeparator(e){lh(this._thousandsSeparator,e)}getThousandsSeparator(){return this._thousandsSeparator}setDecimalFold(e){lh(this._decimalFold,e)}getDecimalFold(){return this._decimalFold}setSymbol(e){this.resetData(()=>{this._symbol={pricePrecision:Ah.PRICE,volumePrecision:Ah.VOLUME,...this._symbol,...e},this._synchronizeIndicatorSeriesPrecision()})}getSymbol(){return this._symbol}setPeriod(e){this.resetData(()=>{this._period=e})}getPeriod(){return this._period}_getSessionSymbolKey(){var s,o;const e=(s=this._symbol)==null?void 0:s.ticker;if(!e||typeof e!="string")return"";const t=(o=this._symbol)==null?void 0:o.exchange;return`${typeof t=="string"?t:""}:${e}`}_getInferredSession(){var e,t;try{const s=this._getSessionSymbolKey(),o=this._dataList.length,r=o>0?(e=this._dataList[0])==null?void 0:e.timestamp:0,a=o>0?(t=this._dataList[o-1])==null?void 0:t.timestamp:0,l=`${s}|${o}|${r}|${a}`;if(this._sessionCacheKey===l)return this._sessionCache;let c=kI(this._dataList);return c&&s?this._sessionBySymbol.set(s,c):!c&&s&&(c=this._sessionBySymbol.get(s)??null),this._sessionCacheKey=l,this._sessionCache=c,c}catch{return null}}_refineDataIndexByTimestamp(e,t,s){const o=Math.max(0,Math.min(50,Math.floor(s)));let r=t,a=Number.POSITIVE_INFINITY;for(let l=t-o;l<=t+o;l++){const c=this.dataIndexToTimestamp(l);if(!Ca(c))continue;const f=Math.abs(c-e);f<a&&(a=f,r=l)}return r}_inferPeriodFromData(){const e=this._dataList.length;if(e<2)return null;const t=this._dataList[e-2].timestamp,s=this._dataList[e-1].timestamp,o=Math.max(1,s-t),r=1e3,a=60*r,l=60*a,c=24*l,f=7*c,u=30*c,d=365*c,h=[{type:"second",unit:r},{type:"minute",unit:a},{type:"hour",unit:l},{type:"day",unit:c},{type:"week",unit:f},{type:"month",unit:u},{type:"year",unit:d}];let m=null,g=Number.MAX_VALUE;for(const w of h){const C=Math.max(1,Math.round(o/w.unit)),P=C*w.unit,I=Math.abs(P-o);I<g&&(g=I,m={type:w.type,span:C})}return m}getDataList(){return this._dataList}getVisibleRangeDataList(){return this._visibleRangeDataList}getVisibleRangeHighLowPrice(){return this._visibleRangeHighLowPrice}_addData(e,t,s){let o=!1,r=!1,a=0;if(t0(e)){const l={backward:!1,forward:!1};switch(fy(s)?(l.backward=s,l.forward=s):(l.backward=(s==null?void 0:s.backward)??!1,l.forward=(s==null?void 0:s.forward)??!1),a=e.length,t){case"init":{this._clearData(),this._dataList=e,this._dataLoadMore.backward=l.backward,this._dataLoadMore.forward=l.forward,this.setOffsetRightDistance(this._offsetRightDistance),r=!0;break}case"backward":{this._dataList=this._dataList.concat(e),this._dataLoadMore.backward=l.backward,this._lastBarRightSideDiffBarCount-=a,r=a>0;break}case"forward":{this._dataList=e.concat(this._dataList),this._dataLoadMore.forward=l.forward,r=a>0;break}}o=!0}else{const l=this._dataList.length,c=e.timestamp,f=Nh(this._dataList[l-1],"timestamp",0);if(c>f){this._dataList.push(e);let u=this.getLastBarRightSideDiffBarCount();u<0&&this.setLastBarRightSideDiffBarCount(--u),a=1,o=!0,r=!0}else c===f&&(this._dataList[l-1]=e,o=!0,r=!0)}o&&r&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this.getIndicatorsByFilter({}).forEach(c=>{this._addIndicatorCalcTask(c,t)}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:t!=="init"}))}setDataLoader(e){this.resetData(()=>{this._dataLoader=e})}_calcOptimalBarSpace(){const t=1-yI*Math.atan(Math.max(4,this._barSpace)-4)/(Math.PI*.5);let s=Math.min(Math.floor(this._barSpace*t),Math.floor(this._barSpace));s%2===0&&s+2>=this._barSpace&&--s,this._gapBarSpace=Math.max(1,s)}_adjustVisibleRange(){const e=this._dataList.length,t=this._totalBarSpace/this._barSpace;let s=0,o=0;this._scrollLimitRole==="distance"?(s=(this._totalBarSpace-this._maxOffsetDistance.right)/this._barSpace,o=(this._totalBarSpace-this._maxOffsetDistance.left)/this._barSpace):(s=this._minVisibleBarCount.left,o=this._minVisibleBarCount.right),s=Math.max(0,s),o=Math.max(0,o);const r=t-Math.min(s,e);this._lastBarRightSideDiffBarCount>r&&(this._lastBarRightSideDiffBarCount=r);const a=-e+Math.min(o,e);this._lastBarRightSideDiffBarCount<a&&(this._lastBarRightSideDiffBarCount=a);let l=Math.round(this._lastBarRightSideDiffBarCount+e+.5);const c=l;l>e&&(l=e);let f=Math.round(l-t)-1;f<0&&(f=0);const u=this._lastBarRightSideDiffBarCount>0?Math.round(e+this._lastBarRightSideDiffBarCount-t)-1:f;this._visibleRange={from:f,to:l,realFrom:u,realTo:c},this.executeAction("onVisibleRangeChange",this._visibleRange),this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}];for(let d=u;d<c;d++){const h=this._dataList[d],m=this.dataIndexToCoordinate(d);this._visibleRangeDataList.push({dataIndex:d,x:m,data:{prev:this._dataList[d-1]??h,current:h,next:this._dataList[d+1]??h}}),$s(h)&&(this._visibleRangeHighLowPrice[0].price<h.high&&(this._visibleRangeHighLowPrice[0].price=h.high,this._visibleRangeHighLowPrice[0].x=m),this._visibleRangeHighLowPrice[1].price>h.low&&(this._visibleRangeHighLowPrice[1].price=h.low,this._visibleRangeHighLowPrice[1].x=m))}f===0?this._dataLoadMore.forward&&this._processDataLoad("forward"):l===e&&this._dataLoadMore.backward&&this._processDataLoad("backward")}_processDataLoad(e){var t,s;if(!this._loading&&$s(this._dataLoader)&&$s(this._symbol)&&$s(this._period)){this._loading=!0;const o={type:e,symbol:this._symbol,period:this._period,timestamp:null,callback:(r,a)=>{var c,f;this._loading=!1,!(t0(r)&&r.length>0)&&(e==="forward"?this._dataLoadMore.forward=!1:e==="backward"&&(this._dataLoadMore.backward=!1)),this._addData(r,e,a),e==="init"&&((f=(c=this._dataLoader)==null?void 0:c.subscribeBar)==null||f.call(c,{symbol:this._symbol,period:this._period,callback:u=>{this._addData(u,"update")}}))}};switch(e){case"backward":{o.timestamp=((t=this._dataList[this._dataList.length-1])==null?void 0:t.timestamp)??null;break}case"forward":{o.timestamp=((s=this._dataList[0])==null?void 0:s.timestamp)??null;break}}try{this._dataLoader.getBars(o)}catch{this._loading=!1}}}_processDataUnsubscribe(){var e,t;$s(this._dataLoader)&&$s(this._symbol)&&$s(this._period)&&((t=(e=this._dataLoader).unsubscribeBar)==null||t.call(e,{symbol:this._symbol,period:this._period}))}resetData(e){this._processDataUnsubscribe(),e==null||e(),this._loading=!1,this._processDataLoad("init")}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:Math.floor(this._gapBarSpace/2)}}setBarSpace(e,t){e<H6.MIN||e>H6.MAX||this._barSpace===e||(this._barSpace=e,this._calcOptimalBarSpace(),t==null||t(),this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}setTotalBarSpace(e){this._totalBarSpace!==e&&(this._totalBarSpace=e,this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}setOffsetRightDistance(e,t){return this._offsetRightDistance=this._scrollLimitRole==="distance"?Math.min(this._maxOffsetDistance.right,e):e,this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace,(t??!1)&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0})),this}getInitialOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightDistance(){return Math.max(0,this._lastBarRightSideDiffBarCount*this._barSpace)}getLastBarRightSideDiffBarCount(){return this._lastBarRightSideDiffBarCount}setLastBarRightSideDiffBarCount(e){this._lastBarRightSideDiffBarCount=e}setMaxOffsetLeftDistance(e){this._scrollLimitRole="distance",this._maxOffsetDistance.left=e}setMaxOffsetRightDistance(e){this._scrollLimitRole="distance",this._maxOffsetDistance.right=e}setLeftMinVisibleBarCount(e){this._scrollLimitRole="bar_count",this._minVisibleBarCount.left=e}setRightMinVisibleBarCount(e){this._scrollLimitRole="bar_count",this._minVisibleBarCount.right=e}getVisibleRange(){return this._visibleRange}startScroll(){this._startLastBarRightSideDiffBarCount=this._lastBarRightSideDiffBarCount}scroll(e){if(!this._scrollEnabled)return;const t=typeof performance<"u"?performance.now():Date.now();t-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=t),this._perfScrollCalls++;const s=e/this._barSpace,o=this._lastBarRightSideDiffBarCount*this._barSpace;this._lastBarRightSideDiffBarCount=this._startLastBarRightSideDiffBarCount-s;const r=Math.round(o-this._lastBarRightSideDiffBarCount*this._barSpace);r!==0&&(this._chart.getDrawPanes().forEach(a=>{var c,f;const l=a.getAxisComponent();(c=l==null?void 0:l.setAutoscaleEaseOverride)==null||c.call(l,200,220),(f=l==null?void 0:l.forceAutoscaleSmoothOnce)==null||f.call(l)}),this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}),this.executeAction("onScroll",{distance:r}))}getDataByDataIndex(e){return this._dataList[e]??null}coordinateToFloatIndex(e){const t=this._dataList.length,s=(this._totalBarSpace-e)/this._barSpace,o=t+this._lastBarRightSideDiffBarCount-s;return Math.round(o*1e6)/1e6}dataIndexToTimestamp(e){const t=this._dataList.length;if(t===0)return null;const s=this.getDataByDataIndex(e);if($s(s))return s.timestamp;if($s(this._period)||this._dataList.length>0){const o=t-1;let r=null,a=0;if(e>o?(r=this._dataList[o].timestamp,a=e-o):e<0&&(r=this._dataList[0].timestamp,a=e),Ca(r)){const l=this._period??this._inferPeriodFromData();if($s(l)){const{type:c,span:f}=l;switch(c){case"second":{const u=this._getInferredSession();return u?nx(r,f*1e3*a,u):r+f*1e3*a}case"minute":{const u=this._getInferredSession();return u?nx(r,f*60*1e3*a,u):r+f*60*1e3*a}case"hour":{const u=this._getInferredSession();return u?nx(r,f*60*60*1e3*a,u):r+f*60*60*1e3*a}case"day":{const u=this._getInferredSession();return u?CI(r,f*a,u):r+f*24*60*60*1e3*a}case"week":return r+f*7*24*60*60*1e3*a;case"month":{const u=new Date(r),d=u.getDate();u.setDate(1),u.setMonth(u.getMonth()+f*a);const h=new Date(u.getFullYear(),u.getMonth()+1,0).getDate();return u.setDate(Math.min(d,h)),u.getTime()}case"year":{const u=new Date(r);return u.setFullYear(u.getFullYear()+f*a),u.getTime()}}}}}return null}timestampToDataIndex(e){const t=this._dataList.length;if(t===0)return 0;if($s(this._period)||this._dataList.length>0){let s=null,o=0;const r=t-1,a=this._dataList[r].timestamp;e>a&&(s=a,o=r);const l=this._dataList[0].timestamp;if(e<l&&(s=l,o=0),Ca(s)){const c=this._period??this._inferPeriodFromData();if($s(c)){const{type:f,span:u}=c;switch(f){case"second":{const d=this._getInferredSession();if(d){const h=tx(s,e,d),m=u*1e3,g=o+h/m;return Math.round(g*1e6)/1e6}return o+(e-s)/(u*1e3)}case"minute":{const d=this._getInferredSession();if(d){const h=tx(s,e,d),m=u*60*1e3,g=o+h/m;return Math.round(g*1e6)/1e6}return o+(e-s)/(u*60*1e3)}case"hour":{const d=this._getInferredSession();if(d){const h=tx(s,e,d),m=u*60*60*1e3,g=o+h/m;return Math.round(g*1e6)/1e6}return o+(e-s)/(u*60*60*1e3)}case"day":{const d=this._getInferredSession();if(d){const h=SI(s,e,d),m=o+Math.floor(h/u);return this._refineDataIndexByTimestamp(e,m,6)}return o+Math.floor((e-s)/(u*24*60*60*1e3))}case"week":return o+Math.floor((e-s)/(u*7*24*60*60*1e3));case"month":{const d=new Date(s),h=new Date(e),m=d.getFullYear(),g=h.getFullYear(),w=d.getMonth(),C=h.getMonth();return o+Math.floor(((g-m)*12+(C-w))/u)}case"year":{const d=new Date(s).getFullYear(),h=new Date(e).getFullYear();return o+Math.floor((h-d)/u)}}}}}return Gx(this._dataList,"timestamp",e)}dataIndexToCoordinate(e){const s=this._dataList.length+this._lastBarRightSideDiffBarCount-e;return Math.floor(this._totalBarSpace-(s-.5)*this._barSpace+.5)}coordinateToDataIndex(e){return Math.ceil(this.coordinateToFloatIndex(e))-1}zoom(e,t){if(!this._zoomEnabled)return;this._chart.getDrawPanes().forEach(u=>{var d,h,m,g;(h=(d=u.getAxisComponent())==null?void 0:d.setAutoscaleEaseOverride)==null||h.call(d,90,160),(g=(m=u.getAxisComponent())==null?void 0:m.forceAutoscaleSmoothOnce)==null||g.call(m)});const s=typeof performance<"u"?performance.now():Date.now();s-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=s),this._perfZoomCalls++;let o=t??null;Ca(o==null?void 0:o.x)||(o={x:this._crosshair.x??this._totalBarSpace/2});const r=Number.isFinite(this._totalBarSpace)&&this._totalBarSpace>0?this._totalBarSpace:o.x,a=this.coordinateToFloatIndex(r),l=this._barSpace,c=this._barSpace+e*(this._barSpace/Yx);this.setBarSpace(c,()=>{this._lastBarRightSideDiffBarCount+=a-this.coordinateToFloatIndex(r)});const f=this._barSpace/l;f!==1&&this.executeAction("onZoom",{scale:f})}setZoomEnabled(e){this._zoomEnabled=e}isZoomEnabled(){return this._zoomEnabled}setScrollEnabled(e){this._scrollEnabled=e}isScrollEnabled(){return this._scrollEnabled}setCrosshair(e,t){const{notInvalidate:s,notExecuteAction:o,forceInvalidate:r}=t??{},a=e??{};let l=0,c=0;Ca(a.x)?(l=this.coordinateToDataIndex(a.x),l<0?c=0:l>this._dataList.length-1?c=this._dataList.length-1:c=l):(l=this._dataList.length-1,c=l);const f=this._dataList[c],u=this.dataIndexToCoordinate(l),d={x:this._crosshair.x,y:this._crosshair.y,paneId:this._crosshair.paneId};this._crosshair={...a,realX:u,dutyData:f,realDataIndex:l,dataIndex:c,timestamp:this.dataIndexToTimestamp(l)??void 0},(d.x!==a.x||d.y!==a.y||d.paneId!==a.paneId||(r??!1))&&($s(f)&&!(o??!1)&&this.hasAction("onCrosshairChange")&&hd(this._crosshair.paneId)&&this.executeAction("onCrosshairChange",e),(s??!1)||this._scheduleOverlayUpdate())}getCrosshair(){return this._crosshair}executeAction(e,t){var s;(s=this._actions.get(e))==null||s.execute(t)}subscribeAction(e,t){var s;this._actions.has(e)||this._actions.set(e,new o9),(s=this._actions.get(e))==null||s.subscribe(t)}unsubscribeAction(e,t){const s=this._actions.get(e);$s(s)&&(s.unsubscribe(t),s.isEmpty()&&this._actions.delete(e))}hasAction(e){const t=this._actions.get(e);return $s(t)&&!t.isEmpty()}_sortIndicators(e){var t;hd(e)?(t=this._indicators.get(e))==null||t.sort((s,o)=>s.zLevel-o.zLevel):this._indicators.forEach(s=>{s.sort((o,r)=>o.zLevel-r.zLevel)})}_addIndicatorCalcTask(e,t){var s;(s=e.onDataStateChange)==null||s.call(e,{state:"loading",type:t,indicator:e}),this._taskScheduler.add({id:O6(e.id),handler:async()=>{typeof performance<"u"?performance.now():Date.now();const o=await e.calcImp(this._dataList).then(r=>r);return typeof performance<"u"?performance.now():Date.now(),o}}).then(o=>{var r;o&&(this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:t!=="init"}),(r=e.onDataStateChange)==null||r.call(e,{state:"ready",type:t,indicator:e}))}).catch(o=>{var r;o!=="canceled"&&((r=e.onDataStateChange)==null||r.call(e,{state:"error",type:t,indicator:e}))})}addIndicator(e,t,s){const{name:o}=e;if(this.getIndicatorsByFilter(e).length>0)return!1;let a=this.getIndicatorsByPaneId(t);const l=P3(o),c=new l;return this._synchronizeIndicatorSeriesPrecision(c),c.paneId=t,c.override(e),s||(this.removeIndicator({paneId:t}),a=[]),a.push(c),this._indicators.set(t,a),this._sortIndicators(t),this._addIndicatorCalcTask(c,"init"),!0}getIndicatorsByPaneId(e){return this._indicators.get(e)??[]}getIndicatorsByFilter(e){const{paneId:t,name:s,id:o}=e,r=$s(s)?s.split("(")[0].trim():void 0,a=c=>$s(o)?c.id===o:$s(r)?c.name===r||c.shortName===r:!0;let l=[];return $s(t)?l=l.concat(this.getIndicatorsByPaneId(t).filter(a)):this._indicators.forEach(c=>{l=l.concat(c.filter(a))}),l}removeIndicator(e){let t=!1;return this.getIndicatorsByFilter(e??{}).forEach(o=>{const r=this.getIndicatorsByPaneId(o.paneId),a=r.findIndex(l=>l.id===o.id);a>-1&&(this._taskScheduler.remove(O6(o.id)),r.splice(a,1),t=!0),r.length===0&&this._indicators.delete(o.paneId)}),t}hasIndicators(e){return this._indicators.has(e)}_synchronizeIndicatorSeriesPrecision(e){if($s(this._symbol)){const{pricePrecision:t=Ah.PRICE,volumePrecision:s=Ah.VOLUME}=this._symbol,o=r=>{switch(r.series){case"price":{r.setSeriesPrecision(t);break}case"volume":{r.setSeriesPrecision(s);break}}};$s(e)?o(e):this._indicators.forEach(r=>{r.forEach(a=>{o(a)})})}}overrideIndicator(e){let t=!1,s=!1;return this.getIndicatorsByFilter(e).forEach(r=>{r.override(e);const{calc:a,draw:l,sort:c}=r.shouldUpdateImp();c&&(s=!0),a?this._addIndicatorCalcTask(r,"update"):l&&(t=!0)}),s&&this._sortIndicators(),t?(this._scheduleLayout({update:!0}),!0):!1}_scheduleLayout(e){this._pendingLayoutOptions.measureWidth=this._pendingLayoutOptions.measureWidth||(e.measureWidth??!1),this._pendingLayoutOptions.update=this._pendingLayoutOptions.update||(e.update??!1),this._pendingLayoutOptions.buildYAxisTick=this._pendingLayoutOptions.buildYAxisTick||(e.buildYAxisTick??!1),this._pendingLayoutOptions.cacheYAxisWidth=this._pendingLayoutOptions.cacheYAxisWidth||(e.cacheYAxisWidth??!1);const t=typeof performance<"u"?performance.now():Date.now();t-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=t),this._perfLayoutSchedules++,this._layoutRafId===null&&(this._layoutRafId=D0(()=>{const s={...this._pendingLayoutOptions};this._pendingLayoutOptions={measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1},this._layoutRafId=null,this._chart.layout(s)}))}_scheduleOverlayUpdate(){this._overlayRafId===null&&(this._overlayRafId=D0(()=>{this._overlayRafId=null,this._chart.updatePane(Ff.Overlay)}))}getOverlaysByFilter(e){var f;const{id:t,groupId:s,paneId:o,name:r}=e,a=u=>$s(t)?u.id===t:$s(s)?u.groupId===s&&(!$s(r)||u.name===r):!$s(r)||u.name===r;let l=[];$s(o)?l=l.concat(this.getOverlaysByPaneId(o).filter(a)):this._overlays.forEach(u=>{l=l.concat(u.filter(a))});const c=(f=this._progressOverlayInfo)==null?void 0:f.overlay;return $s(c)&&a(c)&&l.push(c),l}getOverlaysByPaneId(e){if(!hd(e)){let t=[];return this._overlays.forEach(s=>{t=t.concat(s)}),t}return this._overlays.get(e)??[]}_sortOverlays(e){var t;hd(e)?(t=this._overlays.get(e))==null||t.sort((s,o)=>s.zLevel-o.zLevel):this._overlays.forEach(s=>{s.sort((o,r)=>o.zLevel-r.zLevel)})}addOverlays(e,t){const s=[],o=e.map((r,a)=>{var c,f;if($s(r.id)){let u=null;for(const d of this._overlays){const m=d[1].find(g=>g.id===r.id);if($s(m)){u=m;break}}if($s(u))return r.id}const l=fI(r.name);if($s(l)){const u=r.id??G1(H9),d=new l,h=r.paneId??td.CANDLE;r.id=u,r.groupId??(r.groupId=u);const m=this.getOverlaysByPaneId(h).length;if(!$s(r.zLevel)){const g=r.extendData,w=(g==null?void 0:g.origin)==="user";r.zLevel=w?bI+m:m}return d.override(r),s.includes(h)||s.push(h),d.isDrawing()?this._progressOverlayInfo={paneId:h,overlay:d,appointPaneFlag:t[a]}:(this._overlays.has(h)||this._overlays.set(h,[]),(c=this._overlays.get(h))==null||c.push(d)),d.isStart()&&((f=d.onDrawStart)==null||f.call(d,{overlay:d,chart:this._chart})),u}return null});return s.length>0&&(this._sortOverlays(),s.forEach(r=>{this._chart.updatePane(Ff.Overlay,r)}),this._chart.updatePane(Ff.Overlay,td.X_AXIS)),o}getProgressOverlayInfo(){return this._progressOverlayInfo}progressOverlayComplete(){var e;if(this._progressOverlayInfo!==null){const{overlay:t,paneId:s}=this._progressOverlayInfo;t.isDrawing()||(this._overlays.has(s)||this._overlays.set(s,[]),(e=this._overlays.get(s))==null||e.push(t),this._sortOverlays(s),this._progressOverlayInfo=null)}}updateProgressOverlayInfo(e,t){this._progressOverlayInfo!==null&&(fy(t)&&t&&(this._progressOverlayInfo.appointPaneFlag=t),this._progressOverlayInfo.paneId=e,this._progressOverlayInfo.overlay.override({paneId:e}))}overrideOverlay(e){var a;let t=!1;const s=[];let o=this.getOverlaysByFilter(e);if(hd(e.id)&&o.length>0){const l=o[0],c=(a=l.extendData)==null?void 0:a.crossPaneGroup;hd(c)&&(o=this.getOverlaysByFilter({groupId:l.groupId}).filter(f=>{var u;return((u=f.extendData)==null?void 0:u.crossPaneGroup)===c}))}const r=e.extendData;return o.forEach(l=>{let c=e;if($s(r)&&hd(e.id)&&l.id!==e.id&&($s(r.crossPaneRole)||$s(r.mirrorOf))){const{crossPaneRole:d,mirrorOf:h,...m}=r;c={...e,extendData:m}}l.override(c);const{sort:f,draw:u}=l.shouldUpdate();f&&(t=!0),(f||u)&&(s.includes(l.paneId)||s.push(l.paneId))}),t&&this._sortOverlays(),s.length>0?(s.forEach(l=>{this._chart.updatePane(Ff.Overlay,l)}),this._chart.updatePane(Ff.Overlay,td.X_AXIS),!0):!1}removeOverlay(e){const t=[];let s=this.getOverlaysByFilter(e??{});if(hd(e==null?void 0:e.id)&&s.length>0){const o=s[0],r=o.extendData,a=r==null?void 0:r.crossPaneGroup,l=(r==null?void 0:r.crossPaneRole)==="mirror";hd(a)&&!l&&(s=this.getOverlaysByFilter({groupId:o.groupId}).filter(c=>{var f;return((f=c.extendData)==null?void 0:f.crossPaneGroup)===a}))}return s.forEach(o=>{var l;const r=o.paneId,a=this.getOverlaysByPaneId(o.paneId);if((l=o.onRemoved)==null||l.call(o,{overlay:o,chart:this._chart}),t.includes(r)||t.push(r),o.isDrawing())this._progressOverlayInfo=null;else{const c=a.findIndex(f=>f.id===o.id);c>-1&&a.splice(c,1)}a.length===0&&this._overlays.delete(r)}),t.length>0?(t.forEach(o=>{this._chart.updatePane(Ff.Overlay,o)}),this._chart.updatePane(Ff.Overlay,td.X_AXIS),!0):!1}setPressedOverlayInfo(e){this._pressedOverlayInfo=e}getPressedOverlayInfo(){return this._pressedOverlayInfo}setHoverOverlayInfo(e,t,s){const{overlay:o,figureType:r,figureIndex:a,figure:l}=this._hoverOverlayInfo,c=e.overlay;if(((o==null?void 0:o.id)!==(c==null?void 0:c.id)||r!==e.figureType||a!==e.figureIndex)&&(this._hoverOverlayInfo=e,(o==null?void 0:o.id)!==(c==null?void 0:c.id))){let f=!1,u=!1;const d=this._clickOverlayInfo.overlay;o!==null&&(o.id!==(d==null?void 0:d.id)&&(o.override({zLevel:o.getPrevZLevel()}),u=!0),s(o,l)&&(f=!0)),c!==null&&(c.id!==(d==null?void 0:d.id)&&(c.zLevel!==ab&&c.setPrevZLevel(c.zLevel),c.override({zLevel:ab}),u=!0),t(c,e.figure)&&(f=!0)),u&&this._sortOverlays(),f||this._chart.updatePane(Ff.Overlay)}}getHoverOverlayInfo(){return this._hoverOverlayInfo}setClickOverlayInfo(e,t,s){const{paneId:o,overlay:r,figureType:a,figure:l,figureIndex:c}=this._clickOverlayInfo,f=e.overlay;if(((r==null?void 0:r.id)!==(f==null?void 0:f.id)||a!==e.figureType||c!==e.figureIndex)&&(this._clickOverlayInfo=e,(r==null?void 0:r.id)!==(f==null?void 0:f.id))){let u=!1;const d=this._hoverOverlayInfo.overlay;$s(r)&&(s(r,l),r.id!==(d==null?void 0:d.id)&&(r.override({zLevel:r.getPrevZLevel()}),u=!0)),$s(f)&&(t(f,e.figure),f.zLevel!==ab&&(f.setPrevZLevel(f.zLevel),f.override({zLevel:ab}),u=!0)),u&&this._sortOverlays(),this._chart.updatePane(Ff.Overlay,e.paneId),o!==e.paneId&&this._chart.updatePane(Ff.Overlay,o),this._chart.updatePane(Ff.Overlay,td.X_AXIS)}}getClickOverlayInfo(){return this._clickOverlayInfo}isOverlayEmpty(){return this._overlays.size===0&&this._progressOverlayInfo===null}isOverlayDrawing(){var e;return((e=this._progressOverlayInfo)==null?void 0:e.overlay.isDrawing())??!1}_clearLastPriceMarkExtendTextUpdateTimer(){this._lastPriceMarkExtendTextUpdateTimers.forEach(e=>{clearInterval(e)}),this._lastPriceMarkExtendTextUpdateTimers=[]}_clearData(){this._dataLoadMore.backward=!1,this._dataLoadMore.forward=!1,this._loading=!1,this._dataList=[],this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}],this._visibleRange=B6(),this._crosshair={}}getChart(){return this._chart}destroy(){this._clearData(),this._clearLastPriceMarkExtendTextUpdateTimer(),this._taskScheduler.clear(),this._overlays.clear(),this._indicators.clear(),this._actions.clear()}applyNewData(e,t){this._addData(e,"init",t)}addData(e,t,s){this._addData(e,t,s)}}const od={MAIN:"main",X_AXIS:"xAxis",Y_AXIS:"yAxis",SEPARATOR:"separator"},zb=7;async function PI(){return await new Promise(n=>{const e=new ResizeObserver(t=>{n(t.every(s=>"devicePixelContentBoxSize"in s)),e.disconnect()});e.observe(document.body,{box:"device-pixel-content-box"})}).catch(()=>!1)}class sx{constructor(e,t){Te(this,"_element");Te(this,"_resizeObserver");Te(this,"_mediaQueryList");Te(this,"_ctx");Te(this,"_listener");Te(this,"_supportedDevicePixelContentBox",!1);Te(this,"_width",0);Te(this,"_height",0);Te(this,"_pixelWidth",0);Te(this,"_pixelHeight",0);Te(this,"_nextPixelWidth",0);Te(this,"_nextPixelHeight",0);Te(this,"_requestAnimationId",K2);Te(this,"_mediaQueryListener",()=>{const e=t_(this._element);this._nextPixelWidth=Math.round(this._element.clientWidth*e),this._nextPixelHeight=Math.round(this._element.clientHeight*e),this._resetPixelRatio()});this._listener=t,this._element=B0("canvas",e),this._ctx=this._element.getContext("2d"),PI().then(s=>{this._supportedDevicePixelContentBox=s,s?(this._resizeObserver=new ResizeObserver(o=>{const r=o.find(l=>l.target===this._element),a=r==null?void 0:r.devicePixelContentBoxSize[0];$s(a)&&(this._nextPixelWidth=a.inlineSize,this._nextPixelHeight=a.blockSize,(this._pixelWidth!==this._nextPixelWidth||this._pixelHeight!==this._nextPixelHeight)&&this._resetPixelRatio())}),this._resizeObserver.observe(this._element,{box:"device-pixel-content-box"})):(this._mediaQueryList=window.matchMedia(`(resolution: ${t_(this._element)}dppx)`),this._mediaQueryList.addListener(this._mediaQueryListener))}).catch(s=>!1)}_resetPixelRatio(){this._executeListener(()=>{const e=this._element.clientWidth,t=this._element.clientHeight;if(this._width=e,this._height=t,this._pixelWidth=this._nextPixelWidth,this._pixelHeight=this._nextPixelHeight,this._element.width=this._nextPixelWidth,this._element.height=this._nextPixelHeight,e<=0||t<=0||this._nextPixelWidth<=0||this._nextPixelHeight<=0)return;const s=this._nextPixelWidth/e,o=this._nextPixelHeight/t;this._ctx.scale(s,o)})}_executeListener(e){this._requestAnimationId===K2&&(this._requestAnimationId=D0(()=>{try{this._ctx.clearRect(0,0,this._width,this._height),e==null||e(),this._listener()}catch(t){console.error("Canvas draw error",t)}finally{this._requestAnimationId=K2}}))}update(e,t){if(this._width!==e||this._height!==t){this._element.style.width=`${e}px`,this._element.style.height=`${t}px`;const s=t_(this._element);this._nextPixelWidth=Math.round(e*s),this._nextPixelHeight=Math.round(t*s),this._resetPixelRatio()}else this._executeListener()}getElement(){return this._element}getContext(){return this._ctx}destroy(){$s(this._resizeObserver)&&this._resizeObserver.unobserve(this._element),$s(this._mediaQueryList)&&this._mediaQueryList.removeListener(this._mediaQueryListener)}}class E3 extends Dw{constructor(t,s){super();Te(this,"_rootContainer");Te(this,"_pane");Te(this,"_container");Te(this,"_bounding",a2());Te(this,"_cursor","crosshair");Te(this,"_forceCursor",null);this._pane=s,this._rootContainer=t,this._container=this.createContainer(),t.appendChild(this._container)}setBounding(t){return lh(this._bounding,t),this}getContainer(){return this._container}getBounding(){return this._bounding}getPane(){return this._pane}checkEventOn(t){return!0}setCursor(t){hd(this._forceCursor)||t!==this._cursor&&(this._cursor=t,this._container.style.cursor=this._cursor)}setForceCursor(t){t!==this._forceCursor&&(this._forceCursor=t,this._container.style.cursor=this._forceCursor??this._cursor)}getForceCursor(){return this._forceCursor}update(t){this.updateImp(this._container,this._bounding,t??Ff.Drawer)}destroy(){this._rootContainer.removeChild(this._container)}}class Bw extends E3{constructor(t,s){super(t,s);Te(this,"_underlayCanvas");Te(this,"_mainCanvas");Te(this,"_overlayCanvas");this._underlayCanvas=new sx({position:"absolute",top:"0",left:"0",zIndex:"1",boxSizing:"border-box"},()=>{this.updateUnderlay(this._underlayCanvas.getContext())}),this._mainCanvas=new sx({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},()=>{this.updateMain(this._mainCanvas.getContext())}),this._overlayCanvas=new sx({position:"absolute",top:"0",left:"0",zIndex:"3",boxSizing:"border-box"},()=>{this.updateOverlay(this._overlayCanvas.getContext())});const o=this.getContainer();o.appendChild(this._underlayCanvas.getElement()),o.appendChild(this._mainCanvas.getElement()),o.appendChild(this._overlayCanvas.getElement())}createContainer(){return B0("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box",zIndex:"1"})}updateImp(t,s,o){const{width:r,height:a,left:l}=s;t.style.left=`${l}px`;let c=o;const f=t.clientWidth,u=t.clientHeight;switch((r!==f||a!==u)&&(t.style.width=`${r}px`,t.style.height=`${a}px`,c=Ff.Drawer),c){case Ff.Main:{this._underlayCanvas.update(r,a),this._mainCanvas.update(r,a);break}case Ff.Overlay:{this._underlayCanvas.update(r,a),this._overlayCanvas.update(r,a);break}case Ff.Drawer:case Ff.All:{this._underlayCanvas.update(r,a),this._mainCanvas.update(r,a),this._overlayCanvas.update(r,a);break}}}destroy(){this._underlayCanvas.destroy(),this._mainCanvas.destroy(),this._overlayCanvas.destroy()}getImage(t){const{width:s,height:o}=this.getBounding(),r=B0("canvas",{width:`${s}px`,height:`${o}px`,boxSizing:"border-box"}),a=r.getContext("2d"),l=t_(r);return r.width=s*l,r.height=o*l,a.scale(l,l),t&&a.drawImage(this._underlayCanvas.getElement(),0,0,s,o),a.drawImage(this._mainCanvas.getElement(),0,0,s,o),t&&a.drawImage(this._overlayCanvas.getElement(),0,0,s,o),r}}function $3(n,e){let t=[];t=t.concat(e);const s=l1(n);for(const o of t){const{x:r,y:a,r:l}=o,c=l+s,f=n.x-r,u=n.y-a;if(!(f*f+u*u>c*c))return!0}return!1}function MI(n,e,t){let s=[];s=s.concat(e);const{style:o="fill",color:r="currentColor",gradient:a,borderSize:l=1,borderColor:c="currentColor",borderStyle:f="solid",borderDashedValue:u=[2,2]}=t,d=!!(a&&(a.from||a.to)),h=(o==="fill"||t.style==="stroke_fill")&&(d||!hd(r)||!i_(r));h&&s.forEach(({x:m,y:g,r:w})=>{if(d){const C=ah(n,{minX:m-w,maxX:m+w,minY:g-w,maxY:g+w},a,hd(r)?r:"#000000");C&&(n.fillStyle=C)}else n.fillStyle=r;n.beginPath(),n.arc(m,g,w,0,Math.PI*2),n.closePath(),n.fill()}),(o==="stroke"||t.style==="stroke_fill")&&l>0&&!i_(c)&&(n.strokeStyle=c,n.lineWidth=l,f==="dashed"?n.setLineDash(u):n.setLineDash([]),s.forEach(({x:m,y:g,r:w})=>{(!h||w>l)&&(n.beginPath(),n.arc(m,g,w,0,Math.PI*2),n.closePath(),n.stroke())}))}const NI={name:"circle",checkEventOn:$3,draw:(n,e,t)=>{MI(n,e,t)}};function D3(n,e){let t=[];t=t.concat(e);const s=l1(n);for(const o of t){let r=!1;const{coordinates:a}=o;for(let l=0,c=a.length-1;l<a.length;c=l++)a[l].y>n.y!=a[c].y>n.y&&n.x<(a[c].x-a[l].x)*(n.y-a[l].y)/(a[c].y-a[l].y)+a[l].x&&(r=!r);if(r)return!0;for(let l=0;l<a.length;l++){const c=a[l],f=a[(l+1)%a.length],u=f.x-c.x,d=f.y-c.y,h=u*u+d*d;let m=0;h>0&&(m=((n.x-c.x)*u+(n.y-c.y)*d)/h,m=Math.max(0,Math.min(1,m)));const g=c.x+m*u,w=c.y+m*d,C=n.x-g,P=n.y-w;if(C*C+P*P<=s*s)return!0}}return!1}function AI(n,e,t){let s=[];s=s.concat(e);const{style:o="fill",color:r="currentColor",gradient:a,borderSize:l=1,borderColor:c="currentColor",borderStyle:f="solid",borderDashedValue:u=[2,2]}=t,d=!!(a&&(a.from||a.to));(o==="fill"||t.style==="stroke_fill")&&(d||!hd(r)||!i_(r))&&s.forEach(({coordinates:h})=>{if(d){let m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,w=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY;for(const I of h)!Number.isFinite(I.x)||!Number.isFinite(I.y)||(I.x<m&&(m=I.x),I.x>g&&(g=I.x),I.y<w&&(w=I.y),I.y>C&&(C=I.y));const P=ah(n,{minX:Number.isFinite(m)?m:0,maxX:Number.isFinite(g)&&g!==m?g:Number.isFinite(m)?m+1:1,minY:Number.isFinite(w)?w:0,maxY:Number.isFinite(C)&&C!==w?C:Number.isFinite(w)?w+1:1},a,hd(r)?r:"#000000");P&&(n.fillStyle=P)}else n.fillStyle=r;n.beginPath(),n.moveTo(h[0].x,h[0].y);for(let m=1;m<h.length;m++)n.lineTo(h[m].x,h[m].y);n.closePath(),n.fill()}),(o==="stroke"||t.style==="stroke_fill")&&l>0&&!i_(c)&&(n.strokeStyle=c,n.lineWidth=l,f==="dashed"?n.setLineDash(u):n.setLineDash([]),s.forEach(({coordinates:h})=>{n.beginPath(),n.moveTo(h[0].x,h[0].y);for(let m=1;m<h.length;m++)n.lineTo(h[m].x,h[m].y);n.closePath(),n.stroke()}))}const TI={name:"polygon",checkEventOn:D3,draw:(n,e,t)=>{AI(n,e,t)}};function Ow(n,e){let t=[];t=t.concat(e);const s=l1(n);for(const o of t){let r=o.x,a=o.width;a<s*2&&(r-=s,a=s*2);let l=o.y,c=o.height;if(c<s*2&&(l-=s,c=s*2),n.x>=r&&n.x<=r+a&&n.y>=l&&n.y<=l+c)return!0}return!1}function R3(n,e,t){let s=[];s=s.concat(e);const{style:o="fill",color:r="transparent",gradient:a,borderSize:l=1,borderColor:c="transparent",borderStyle:f="solid",borderRadius:u=0,borderDashedValue:d=[2,2]}=t,h=n.roundRect??n.rect,m=!!(a&&(a.from||a.to)),g=(o==="fill"||t.style==="stroke_fill")&&(m||!hd(r)||!i_(r));if(g&&s.forEach(({x:w,y:C,width:P,height:I})=>{if(m){const A=ah(n,{minX:w,maxX:w+P,minY:C,maxY:C+I},a,hd(r)?r:"#000000");A&&(n.fillStyle=A)}else n.fillStyle=r;n.beginPath(),h.call(n,w,C,P,I,u),n.closePath(),n.fill()}),(o==="stroke"||t.style==="stroke_fill")&&l>0&&!i_(c)){n.strokeStyle=c,n.fillStyle=c,n.lineWidth=l,f==="dashed"?n.setLineDash(d):n.setLineDash([]);const w=l%2===1?.5:0,C=Math.round(w*2);s.forEach(({x:P,y:I,width:A,height:M})=>{A>l*2&&M>l*2?(n.beginPath(),h.call(n,P+w,I+w,A-C,M-C,u),n.closePath(),n.stroke()):g||n.fillRect(P,I,A,M)})}}const FI={name:"rect",checkEventOn:Ow,draw:(n,e,t)=>{R3(n,e,t)}};function zw(n,e){const{size:t=12,paddingLeft:s=0,paddingTop:o=0,paddingRight:r=0,paddingBottom:a=0,weight:l="normal",family:c}=e,{x:f,y:u,text:d,align:h="left",baseline:m="top",width:g,height:w}=n,C=g??s+Em(d,t,l,c)+r,P=w??o+t+a;let I=0;switch(h){case"left":case"start":{I=f;break}case"right":case"end":{I=f-C;break}default:{I=f-C/2;break}}let A=0;switch(m){case"top":case"hanging":{A=u;break}case"bottom":case"ideographic":case"alphabetic":{A=u-P;break}default:{A=u-P/2;break}}return{x:I,y:A,width:C,height:P}}function j3(n,e,t){let s=[];s=s.concat(e);const o=l1(n);for(const r of s){const{x:a,y:l,width:c,height:f}=zw(r,t);if(n.x>=a-o&&n.x<=a+c+o&&n.y>=l-o&&n.y<=l+f+o)return!0}return!1}function LI(n,e,t){let s=[];s=s.concat(e);const{color:o="currentColor",size:r=12,family:a,weight:l,paddingLeft:c=0,paddingTop:f=0,paddingRight:u=0}=t,d=s.map(h=>zw(h,t));R3(n,d,{...t,color:t.backgroundColor}),n.textAlign="left",n.textBaseline="top",n.font=o_(r,l,a),n.fillStyle=o,s.forEach((h,m)=>{const g=d[m];n.fillText(h.text,g.x+c,g.y+f,g.width-c-u)})}const EI={name:"text",checkEventOn:j3,draw:(n,e,t)=>{LI(n,e,t)}};function $I(n,e){const t=n.x-e.x,s=n.y-e.y;return Math.sqrt(t*t+s*s)}function B3(n,e){let t=[];t=t.concat(e);const s=l1(n);for(const o of t)if(Math.abs($I(n,o)-o.r)<s){const{r,startAngle:a,endAngle:l}=o,c=r*Math.cos(a)+o.x,f=r*Math.sin(a)+o.y,u=r*Math.cos(l)+o.x,d=r*Math.sin(l)+o.y;if(n.x<=Math.max(c,u)+s&&n.x>=Math.min(c,u)-s&&n.y<=Math.max(f,d)+s&&n.y>=Math.min(f,d)-s)return!0}return!1}function DI(n,e,t){let s=[];s=s.concat(e);const{style:o="solid",size:r=1,color:a="currentColor",dashedValue:l=[2,2]}=t;n.lineWidth=r,n.strokeStyle=a,o==="dashed"?n.setLineDash(l):n.setLineDash([]),s.forEach(({x:c,y:f,r:u,startAngle:d,endAngle:h})=>{n.beginPath(),n.arc(c,f,u,d,h),n.stroke(),n.closePath()})}const RI={name:"arc",checkEventOn:B3,draw:(n,e,t)=>{DI(n,e,t)}};function q6(n,e,t,s,o,r,a){const[l,c,f,u,d,h,m]=s,g=a?e+h:h+o,w=a?t+m:m+r;jI(e,t,l,c,f,u,d,g,w).forEach(P=>{n.bezierCurveTo(P[0],P[1],P[2],P[3],P[4],P[5])})}function jI(n,e,t,s,o,r,a,l,c){const{cx:f,cy:u,startAngle:d,deltaAngle:h}=BI(n,e,t,s,o,r,a,l,c),m=[],g=Math.ceil(Math.abs(h)/(Math.PI/2));for(let w=0;w<g;w++){const C=d+w*h/g,P=d+(w+1)*h/g,I=OI(f,u,t,s,o,C,P);m.push(I)}return m}function BI(n,e,t,s,o,r,a,l,c){const f=o*Math.PI/180,u=(n-l)/2,d=(e-c)/2,h=Math.cos(f)*u+Math.sin(f)*d,m=-Math.sin(f)*u+Math.cos(f)*d,g=h**2/t**2+m**2/s**2;g>1&&(t*=Math.sqrt(g),s*=Math.sqrt(g));const w=r===a?-1:1,C=t**2*s**2-t**2*m**2-s**2*h**2,P=t**2*m**2+s**2*h**2,I=w*Math.sqrt(Math.abs(C/P))*(t*m/s),A=w*Math.sqrt(Math.abs(C/P))*(-s*h/t),M=Math.cos(f)*I-Math.sin(f)*A+(n+l)/2,F=Math.sin(f)*I+Math.cos(f)*A+(e+c)/2,B=Math.atan2((m-A)/s,(h-I)/t);let $=Math.atan2((-m-A)/s,(-h-I)/t)-B;return $<0&&a===1?$+=2*Math.PI:$>0&&a===0&&($-=2*Math.PI),{cx:M,cy:F,startAngle:B,deltaAngle:$}}function OI(n,e,t,s,o,r,a){const l=Math.sin(a-r)*(Math.sqrt(4+3*Math.tan((a-r)/2)**2)-1)/3,c=Math.cos(o),f=Math.sin(o),u=n+t*Math.cos(r)*c-s*Math.sin(r)*f,d=e+t*Math.cos(r)*f+s*Math.sin(r)*c,h=n+t*Math.cos(a)*c-s*Math.sin(a)*f,m=e+t*Math.cos(a)*f+s*Math.sin(a)*c,g=u+l*(-t*Math.sin(r)*c-s*Math.cos(r)*f),w=d+l*(-t*Math.sin(r)*f+s*Math.cos(r)*c),C=h-l*(-t*Math.sin(a)*c-s*Math.cos(a)*f),P=m-l*(-t*Math.sin(a)*f+s*Math.cos(a)*c);return[g,w,C,P,h,m]}function zI(n,e,t){let s=[];s=s.concat(e);const{lineWidth:o=1,color:r="currentColor"}=t;n.lineWidth=o,n.strokeStyle=r,n.setLineDash([]),s.forEach(({x:a,y:l,path:c})=>{const f=c.match(/[MLHVCSQTAZ][^MLHVCSQTAZ]*/gi);if($s(f)){const u=a,d=l;n.beginPath(),f.forEach(h=>{let m=0,g=0,w=0,C=0;const P=h[0],I=h.slice(1).trim().split(/[\s,]+/).map(Number);switch(P){case"M":m=I[0]+u,g=I[1]+d,n.moveTo(m,g),w=m,C=g;break;case"m":m+=I[0],g+=I[1],n.moveTo(m,g),w=m,C=g;break;case"L":m=I[0]+u,g=I[1]+d,n.lineTo(m,g);break;case"l":m+=I[0],g+=I[1],n.lineTo(m,g);break;case"H":m=I[0]+u,n.lineTo(m,g);break;case"h":m+=I[0],n.lineTo(m,g);break;case"V":g=I[0]+d,n.lineTo(m,g);break;case"v":g+=I[0],n.lineTo(m,g);break;case"C":n.bezierCurveTo(I[0]+u,I[1]+d,I[2]+u,I[3]+d,I[4]+u,I[5]+d),m=I[4]+u,g=I[5]+d;break;case"c":n.bezierCurveTo(m+I[0],g+I[1],m+I[2],g+I[3],m+I[4],g+I[5]),m+=I[4],g+=I[5];break;case"S":n.bezierCurveTo(m,g,I[0]+u,I[1]+d,I[2]+u,I[3]+d),m=I[2]+u,g=I[3]+d;break;case"s":n.bezierCurveTo(m,g,m+I[0],g+I[1],m+I[2],g+I[3]),m+=I[2],g+=I[3];break;case"Q":n.quadraticCurveTo(I[0]+u,I[1]+d,I[2]+u,I[3]+d),m=I[2]+u,g=I[3]+d;break;case"q":n.quadraticCurveTo(m+I[0],g+I[1],m+I[2],g+I[3]),m+=I[2],g+=I[3];break;case"T":n.quadraticCurveTo(m,g,I[0]+u,I[1]+d),m=I[0]+u,g=I[1]+d;break;case"t":n.quadraticCurveTo(m,g,m+I[0],g+I[1]),m+=I[0],g+=I[1];break;case"A":q6(n,m,g,I,u,d,!1),m=I[5]+u,g=I[6]+d;break;case"a":q6(n,m,g,I,u,d,!0),m+=I[5],g+=I[6];break;case"Z":case"z":n.closePath(),m=w,g=C;break}}),t.style==="fill"?n.fill():n.stroke()}})}const VI={name:"path",checkEventOn:Ow,draw:(n,e,t)=>{zI(n,e,t)}},WI={name:"image",draw:(n,e)=>{const{x:t,y:s,width:o,height:r,image:a,borderRadius:l=0}=e;if(!(!a||!a.complete||a.naturalWidth===0))if(l&&l>0){n.save();const c=Math.min(l,Math.floor(Math.min(o,r)/2));n.beginPath(),n.moveTo(t+c,s),n.arcTo(t+o,s,t+o,s+r,c),n.arcTo(t+o,s+r,t,s+r,c),n.arcTo(t,s+r,t,s,c),n.arcTo(t,s,t+o,s,c),n.closePath(),n.clip(),n.drawImage(a,t,s,o,r),n.restore()}else n.drawImage(a,t,s,o,r)},checkEventOn:(n,e)=>!1},Vw={},HI=[NI,J9,TI,FI,EI,RI,VI,WI];HI.forEach(n=>{Vw[n.name]=F2.extend(n)});function qI(n){Vw[n.name]=F2.extend(n)}function UI(n){return Vw[n]??null}class Vg extends Dw{constructor(t){super();Te(this,"_widget");this._widget=t}getWidget(){return this._widget}createFigure(t,s){const o=UI(t.name);if(o!==null){const r=new o(t);if($s(s)){for(const a in s)s.hasOwnProperty(a)&&r.registerEvent(a,s[a]);this.addChild(r)}return r}return null}draw(t,...s){this.clear(),this.drawImp(t,s)}checkEventOn(t){return!0}}class GI extends Vg{drawImp(e){var c,f;const t=this.getWidget(),s=this.getWidget().getPane(),o=s.getChart(),r=t.getBounding(),a=o.getStyles().grid;if(a.show){e.save(),e.globalCompositeOperation="destination-over";const u=a.horizontal;if(u.show){const w=s.getAxisComponent().getTicks(),C=w.map(P=>({coordinates:[{x:0,y:P.coord},{x:r.width,y:P.coord}]}));if(w.length>=2){const P=[],I=[...w].sort((A,M)=>A.coord-M.coord);for(let A=1;A<I.length;A+=1){const M=I[A].coord-I[A-1].coord;M>0&&P.push(M)}if(P.length>0){P.sort(($,L)=>$-L);const A=Math.floor(P.length/2),M=P.length%2===0?(P[A-1]+P[A])/2:P[A],F=I[0].coord,B=I[I.length-1].coord;if(M>0){let $=F-M;for(;$>=0;)C.push({coordinates:[{x:0,y:$},{x:r.width,y:$}]}),$-=M;let L=B+M;for(;L<=r.height;)C.push({coordinates:[{x:0,y:L},{x:r.width,y:L}]}),L+=M}}}(c=this.createFigure({name:"line",attrs:C,styles:u}))==null||c.draw(e)}const h=a.vertical;if(h.show){const w=o.getXAxisPane().getAxisComponent().getTicks(),C=w.map(P=>({coordinates:[{x:P.coord,y:0},{x:P.coord,y:r.height}]}));if(w.length>=2){const P=[],I=[...w].sort((A,M)=>A.coord-M.coord);for(let A=1;A<I.length;A+=1){const M=I[A].coord-I[A-1].coord;M>0&&P.push(M)}if(P.length>0){P.sort(($,L)=>$-L);const A=Math.floor(P.length/2),M=P.length%2===0?(P[A-1]+P[A])/2:P[A],F=I[0].coord,B=I[I.length-1].coord;if(M>0){let $=F-M;for(;$>=0;)C.push({coordinates:[{x:$,y:0},{x:$,y:r.height}]}),$-=M;let L=B+M;for(;L<=r.width;)C.push({coordinates:[{x:L,y:0},{x:L,y:r.height}]}),L+=M}}}(f=this.createFigure({name:"line",attrs:C,styles:h}))==null||f.draw(e)}e.restore()}}}class O3 extends Vg{eachChildren(e){const s=this.getWidget().getPane().getChart().getChartStore(),o=s.getVisibleRangeDataList(),r=s.getBarSpace(),a=o.length;let l=0;for(;l<a;)e(o[l],r,l),++l}}class z3 extends O3{constructor(){super(...arguments);Te(this,"_boundCandleBarClickEvent",t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCandleBarClick",t),!1))}drawImp(t){const s=this.getWidget().getPane(),o=s.getId()===td.CANDLE,r=s.getChart().getChartStore(),a=this.getCandleBarOptions();if(a!==null){const{type:l,styles:c}=a;let f=0,u=0;if(a.type==="ohlc"){const{gapBar:h}=r.getBarSpace();f=Math.min(Math.max(Math.round(h*.2),1),8),f>2&&f%2===1&&f--,u=Math.floor(f/2)}const d=s.getAxisComponent();this.eachChildren((h,m)=>{const{x:g,data:{current:w,prev:C}}=h;if($s(w)){const{open:P,high:I,low:A,close:M}=w,F=c.compareRule==="current_open"?P:(C==null?void 0:C.close)??M,$=M===P||M>=F,L=$?c.upGradient:c.downGradient,O=[];$?(O[0]=c.upColor,O[1]=c.upBorderColor,O[2]=c.upWickColor):(O[0]=c.downColor,O[1]=c.downBorderColor,O[2]=c.downWickColor);const Y=d.convertToPixel(P),ce=d.convertToPixel(M),Q=[Y,ce,d.convertToPixel(I),d.convertToPixel(A)];Q.sort((fe,pe)=>fe-pe);const le=m.gapBar%2===0?1:0;let ue=[];switch(l){case"candle_solid":{ue=this._createSolidBar(g,Q,m,O,le,L);break}case"candle_stroke":{ue=this._createStrokeBar(g,Q,m,O,le);break}case"candle_up_stroke":{M>P?ue=this._createStrokeBar(g,Q,m,O,le):ue=this._createSolidBar(g,Q,m,O,le,L);break}case"candle_down_stroke":{P>M?ue=this._createStrokeBar(g,Q,m,O,le):ue=this._createSolidBar(g,Q,m,O,le,L);break}case"ohlc":{ue=[{name:"rect",attrs:[{x:g-u,y:Q[0],width:f,height:Q[3]-Q[0]},{x:g-m.halfGapBar,y:Y+f>Q[3]?Q[3]-f:Y,width:m.halfGapBar-u,height:f},{x:g+u,y:ce+f>Q[3]?Q[3]-f:ce,width:m.halfGapBar-u,height:f}],styles:{color:O[0]}}];break}}ue.forEach(fe=>{var Z;let pe=null;o&&(pe={mouseClickEvent:this._boundCandleBarClickEvent(h)}),(Z=this.createFigure(fe,pe??void 0))==null||Z.draw(t)})}})}}getCandleBarOptions(){const t=this.getWidget().getPane().getChart().getStyles().candle;return{type:t.type,styles:t.bar}}_createSolidBar(t,s,o,r,a,l){return[{name:"rect",attrs:{x:t,y:s[0],width:1,height:s[3]-s[0]},styles:{color:r[2]}},{name:"rect",attrs:{x:t-o.halfGapBar,y:s[1],width:o.gapBar+a,height:Math.max(1,s[2]-s[1])},styles:{style:"stroke_fill",color:r[0],gradient:l,borderColor:r[1]}}]}_createStrokeBar(t,s,o,r,a){return[{name:"rect",attrs:[{x:t,y:s[0],width:1,height:s[1]-s[0]},{x:t,y:s[2],width:1,height:s[3]-s[2]}],styles:{color:r[2]}},{name:"rect",attrs:{x:t-o.halfGapBar,y:s[1],width:o.gapBar+a,height:Math.max(1,s[2]-s[1])},styles:{style:"stroke",borderColor:r[1]}}]}}class YI extends z3{getCandleBarOptions(){const e=this.getWidget().getPane();if(!e.getAxisComponent().isInCandle()){const s=e.getChart().getChartStore(),o=s.getIndicatorsByPaneId(e.getId());for(const r of o)if(r.shouldOhlc&&r.visible){const a=r.styles,l=s.getStyles().indicator,c=Nh(a,"ohlc.compareRule",l.ohlc.compareRule),f=Nh(a,"ohlc.upColor",l.ohlc.upColor),u=Nh(a,"ohlc.downColor",l.ohlc.downColor),d=Nh(a,"ohlc.noChangeColor",l.ohlc.noChangeColor);return{type:"ohlc",styles:{compareRule:c,upColor:f,downColor:u,noChangeColor:d,upBorderColor:f,downBorderColor:u,noChangeBorderColor:d,upWickColor:f,downWickColor:u,noChangeWickColor:d}}}}return null}drawImp(e){super.drawImp(e);const t=this.getWidget(),s=t.getPane(),o=s.getChart(),r=t.getBounding(),a=o.getXAxisPane().getAxisComponent(),l=s.getAxisComponent(),c=o.getChartStore(),f=c.getIndicatorsByPaneId(s.getId()),u=c.getStyles().indicator;e.save(),f.forEach(d=>{if(d.visible){d.zLevel<0?e.globalCompositeOperation="destination-over":e.globalCompositeOperation="source-over";let h=!1;if(d.draw!==null&&(e.save(),h=d.draw({ctx:e,chart:o,indicator:d,bounding:r,xAxis:a,yAxis:l}),e.restore()),!h){const m=d.result,g=[];this.eachChildren((w,C)=>{var le,ue,fe,pe,Z,xe;const{halfGapBar:P}=C,{dataIndex:I,x:A,data:M}=w,F=a.convertToPixel(I-1),B=a.convertToPixel(I+1),$=m[((le=M.prev)==null?void 0:le.timestamp)??""]??{},L=m[((ue=M.current)==null?void 0:ue.timestamp)??""]??{},O=m[((fe=M.next)==null?void 0:fe.timestamp)??""]??{},Y={x:F},ce={x:A},Q={x:B};d.figures.forEach(({key:oe})=>{const Pe=$[oe];Ca(Pe)&&(Y[oe]=l.convertToPixel(Pe));const $e=L[oe];Ca($e)&&(ce[oe]=l.convertToPixel($e));const ze=O[oe];Ca(ze)&&(Q[oe]=l.convertToPixel(ze))}),Ew(d,{prev:((pe=M.prev)==null?void 0:pe.timestamp)??null,current:((Z=M.current)==null?void 0:Z.timestamp)??null,next:((xe=M.next)==null?void 0:xe.timestamp)??null},u,(oe,Pe,$e)=>{var ze,Ke;if($s(L[oe.key])){const qe=ce[oe.key];let nt=(ze=oe.attrs)==null?void 0:ze.call(oe,{data:{prev:$,current:L,next:O},coordinate:{prev:Y,current:ce,next:Q},bounding:r,barSpace:C,xAxis:a,yAxis:l});if(!$s(nt))switch(oe.type){case"circle":{nt={x:A,y:qe,r:Math.max(1,P)};break}case"rect":case"bar":{const ut=oe.baseValue??l.getRange().from,bt=l.convertToPixel(ut);let Pt=Math.abs(bt-qe);ut!==L[oe.key]&&(Pt=Math.max(1,Pt));let Et=0;qe>bt?Et=bt:Et=qe,nt={x:A-P,y:Et,width:Math.max(1,P*2),height:Pt};break}case"line":{$s(g[$e])||(g[$e]=[]),Ca(ce[oe.key])&&Ca(Q[oe.key])&&g[$e].push({coordinates:[{x:ce.x,y:ce[oe.key]},{x:Q.x,y:Q[oe.key]}],styles:Pe});break}}const ft=oe.type;$s(nt)&&ft!=="line"&&((Ke=this.createFigure({name:ft==="bar"?"rect":ft,attrs:nt,styles:Pe}))==null||Ke.draw(e))}})}),g.forEach(w=>{var C,P,I,A,M,F,B,$,L,O;if(w.length>1){const Y=[{coordinates:[w[0].coordinates[0],w[0].coordinates[1]],styles:w[0].styles}];for(let ce=1;ce<w.length;ce++){const Q=Y[Y.length-1],le=w[ce],ue=Q.coordinates[Q.coordinates.length-1];ue.x===le.coordinates[0].x&&ue.y===le.coordinates[0].y&&Q.styles.style===le.styles.style&&Q.styles.color===le.styles.color&&((C=Q.styles.gradient)==null?void 0:C.from)===((P=le.styles.gradient)==null?void 0:P.from)&&((I=Q.styles.gradient)==null?void 0:I.to)===((A=le.styles.gradient)==null?void 0:A.to)&&((M=Q.styles.gradient)==null?void 0:M.mode)===((F=le.styles.gradient)==null?void 0:F.mode)&&Q.styles.size===le.styles.size&&Q.styles.smooth===le.styles.smooth&&((B=Q.styles.dashedValue)==null?void 0:B[0])===(($=le.styles.dashedValue)==null?void 0:$[0])&&((L=Q.styles.dashedValue)==null?void 0:L[1])===((O=le.styles.dashedValue)==null?void 0:O[1])?Q.coordinates.push(le.coordinates[1]):Y.push({coordinates:[le.coordinates[0],le.coordinates[1]],styles:le.styles})}Y.forEach(({coordinates:ce,styles:Q})=>{var le;(le=this.createFigure({name:"line",attrs:{coordinates:ce},styles:Q}))==null||le.draw(e)})}})}}}),e.restore()}}class KI extends Vg{drawImp(e){const t=this.getWidget(),s=t.getPane(),o=t.getBounding(),r=t.getPane().getChart().getChartStore(),a=r.getCrosshair(),l=r.getStyles().crosshair;if(hd(a.paneId)&&l.show){if(a.paneId===s.getId()){const f=a.y;this._drawLine(e,[{x:0,y:f},{x:o.width,y:f}],l.horizontal)}const c=a.realX;this._drawLine(e,[{x:c,y:0},{x:c,y:o.height}],l.vertical)}}_drawLine(e,t,s){var o;if(s.show){const r=s.line;r.show&&((o=this.createFigure({name:"line",attrs:{coordinates:t},styles:r}))==null||o.draw(e))}}}class V3 extends Vg{constructor(t){super(t);Te(this,"_activeFeatureInfo",null);Te(this,"_featureClickEvent",(t,s)=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction(t,s),!0));Te(this,"_featureMouseMoveEvent",t=>()=>(this._activeFeatureInfo=t,!0));this.registerEvent("mouseMoveEvent",s=>(this._activeFeatureInfo=null,!1))}drawImp(t){const s=this.getWidget(),o=s.getPane(),r=o.getChart().getChartStore(),a=r.getCrosshair();if(!(typeof window<"u"&&window.innerWidth<=768&&!hd(a.paneId)&&o.getId()===td.CANDLE)&&$s(a.dutyData)){const c=s.getBounding(),{offsetLeft:f,offsetTop:u,offsetRight:d}=r.getStyles().indicator.tooltip;this.drawIndicatorTooltip(t,f,u,c.width-d)}}drawIndicatorTooltip(t,s,o,r){const a=this.getWidget().getPane(),l=a.getChart().getChartStore(),f=l.getStyles().indicator.tooltip;if(this.isDrawTooltip(l.getCrosshair(),f)){const u=l.getIndicatorsByPaneId(a.getId()),d=f.title,h=f.legend;u.forEach(m=>{let g=0;const w={x:s,y:o},{name:C,calcParamsText:P,legends:I,features:A}=this.getIndicatorTooltipData(m),M=C.length>0,F=I.length>0;if(M||F){const B=this.classifyTooltipFeatures(A);if(g=this.drawStandardTooltipFeatures(t,B[0],w,m,s,g,r),M){let $=C;P.length>0&&($=`${$}${P}`);const L=d.color;g=this.drawStandardTooltipLegends(t,[{title:{text:"",color:L},value:{text:$,color:L}}],w,s,g,r,d)}g=this.drawStandardTooltipFeatures(t,B[1],w,m,s,g,r),F&&(g=this.drawStandardTooltipLegends(t,I,w,s,g,r,h)),g=this.drawStandardTooltipFeatures(t,B[2],w,m,s,g,r),o=w.y+g}})}return o}drawStandardTooltipFeatures(t,s,o,r,a,l,c){if(s.length>0){let f=0,u=0;s.forEach(m=>{const{marginLeft:g=0,marginTop:w=0,marginRight:C=0,marginBottom:P=0,paddingLeft:I=0,paddingTop:A=0,paddingRight:M=0,paddingBottom:F=0,size:B=0,type:$,content:L}=m;let O=0;if($==="icon_font"){const Y=L;t.font=o_(B,"normal",Y.family),O=t.measureText(Y.code).width}else O=B;f+=g+I+O+M+C,u=Math.max(u,w+A+B+F+P)}),o.x+f>c?(o.x=a,o.y+=l,l=u):l=Math.max(l,u);const h=this.getWidget().getPane().getId();s.forEach(m=>{var oe,Pe,$e,ze,Ke;const{marginLeft:g=0,marginTop:w=0,marginRight:C=0,paddingLeft:P=0,paddingTop:I=0,paddingRight:A=0,paddingBottom:M=0,backgroundColor:F,activeBackgroundColor:B,borderRadius:$,size:L=0,color:O,activeColor:Y,type:ce,content:Q}=m;let le=O,ue=F;((oe=this._activeFeatureInfo)==null?void 0:oe.paneId)===h&&((Pe=this._activeFeatureInfo.indicator)==null?void 0:Pe.id)===(r==null?void 0:r.id)&&this._activeFeatureInfo.feature.id===m.id&&(le=Y??O,ue=B??F);let fe="onCandleTooltipFeatureClick";const pe={paneId:h,feature:m};$s(r)&&(fe="onIndicatorTooltipFeatureClick",pe.indicator=r);const Z={mouseClickEvent:this._featureClickEvent(fe,pe),mouseMoveEvent:this._featureMouseMoveEvent(pe)};let xe=0;if(ce==="icon_font"){const qe=Q;($e=this.createFigure({name:"text",attrs:{text:qe.code,x:o.x+g,y:o.y+w},styles:{paddingLeft:P,paddingTop:I,paddingRight:A,paddingBottom:M,borderRadius:$,size:L,family:qe.family,color:le,backgroundColor:ue}},Z))==null||$e.draw(t),xe=t.measureText(qe.code).width}else{(ze=this.createFigure({name:"rect",attrs:{x:o.x+g,y:o.y+w,width:L,height:L},styles:{paddingLeft:P,paddingTop:I,paddingRight:A,paddingBottom:M,color:ue}},Z))==null||ze.draw(t);const qe=Q;(Ke=this.createFigure({name:"path",attrs:{path:qe.path,x:o.x+g+P,y:o.y+w+I,width:L,height:L},styles:{style:qe.style,lineWidth:qe.lineWidth,color:le}}))==null||Ke.draw(t),xe=L}o.x+=g+P+xe+A+C})}return l}drawStandardTooltipLegends(t,s,o,r,a,l,c){if(s.length>0){const{marginLeft:f,marginTop:u,marginRight:d,marginBottom:h,size:m,family:g,weight:w}=c;t.font=o_(m,w,g),s.forEach(C=>{var O,Y;!!C.forceNewLine&&(o.x!==r||a>0)&&(o.x=r,o.y+=a,a=0);const I=C.title,A=C.value,M=t.measureText(I.text).width,F=t.measureText(A.text).width,B=(I.text.length>0&&A.text.length>0,0),$=M+B+F,L=u+m+h;o.x+f+$+d>l?(o.x=r,o.y+=a,a=L):a=Math.max(a,L),I.text.length>0&&((O=this.createFigure({name:"text",attrs:{x:o.x+f,y:o.y+u,text:I.text},styles:{color:I.color,size:m,family:g,weight:w}}))==null||O.draw(t)),(Y=this.createFigure({name:"text",attrs:{x:o.x+f+M+B,y:o.y+u,text:A.text},styles:{color:A.color,size:m,family:g,weight:w}}))==null||Y.draw(t),o.x+=f+$+d})}return a}isDrawTooltip(t,s){const o=s.showRule;return o==="always"||o==="follow_cross"&&hd(t.paneId)}getIndicatorTooltipData(t){var A,M;const s=this.getWidget().getPane().getChart().getChartStore(),o=s.getStyles().indicator,r=o.tooltip,a=r.title,l=!!((A=r.legend)!=null&&A.hideTitle),c=(t.shortName==="EMA"||t.shortName==="MA")&&t.calcParams.length>1,f=l&&!c;let u="",d="";if(a.show&&(a.showName&&(u=t.shortName),a.showParams)){const F=t.calcParams;F.length>0&&(d=`(${F.join(",")})`)}c&&(u="",d="");const h={name:u,calcParamsText:d,legends:[],features:r.features},m=s.getCrosshair().dataIndex,g=t.result,w=s.getInnerFormatter(),C=s.getDecimalFold(),P=s.getThousandsSeparator(),I=[];if(t.visible){const F=s.getDataList(),B=F[m]??{},$=F[m-1]??{};let L=g[B.timestamp];!$s(L)&&m===F.length-1&&(L=g[$.timestamp]);const O=r.legend.defaultValue;Ew(t,{prev:$.timestamp,current:B.timestamp,next:(M=F[m])==null?void 0:M.timestamp},o,(Y,ce,Q)=>{var le;if(hd(Y.title)){const ue=ce.color,fe=c?`${t.shortName}(${String(((le=t.calcParams)==null?void 0:le[Q])??"")})`:f?"":Y.title,pe=c?a.color:ue;let Z=L==null?void 0:L[Y.key];Ca(Z)&&(Z=Mh(Z,t.precision),t.shouldFormatBigNumber&&(Z=w.formatBigNumber(Z)),Z=C.format(P.format(Z)));const xe={title:{text:fe,color:pe},value:{text:Z??O,color:ue}};c&&(xe.forceNewLine=!0),I.push(xe)}}),h.legends=I}if(eg(t.createTooltipDataSource)){const F=this.getWidget(),B=F.getPane(),$=B.getChart(),{name:L,calcParamsText:O,legends:Y,features:ce}=t.createTooltipDataSource({chart:$,indicator:t,crosshair:s.getCrosshair(),bounding:F.getBounding(),xAxis:B.getChart().getXAxisPane().getAxisComponent(),yAxis:B.getAxisComponent()});if(a.show&&(hd(L)&&a.showName&&(h.name=L),hd(O)&&a.showParams&&(h.calcParamsText=O)),$s(ce)&&(h.features=ce),$s(Y)&&t.visible){const Q=[],le=o.tooltip.legend.color;Y.forEach(ue=>{let fe={text:"",color:le};kg(ue.title)?fe=ue.title:fe.text=ue.title;let pe={text:"",color:le};kg(ue.value)?pe=ue.value:pe.text=ue.value,f&&(fe.text=""),Ca(Number(pe.text))&&(pe.text=C.format(P.format(pe.text))),Q.push({title:fe,value:pe})}),h.legends=Q}}return h}classifyTooltipFeatures(t){const s=[],o=[],r=[];return t.forEach(a=>{switch(a.position){case"left":{s.push(a);break}case"middle":{o.push(a);break}case"right":{r.push(a);break}}}),[s,o,r]}}const XI=new Set(["verticalStraightLine"]);class Kx extends Vg{constructor(t,s){super(t);Te(this,"_overlayFilter");this._overlayFilter=s==null?void 0:s.overlayFilter,((s==null?void 0:s.enableBaseEvent)??!0)&&this._initEvent()}_initEvent(){const t=this.getWidget(),s=t.getPane(),o=s.getId(),r=s.getChart(),a=r.getChartStore();this.registerEvent("mouseMoveEvent",l=>{var f;const c=a.getProgressOverlayInfo();if(c!==null){const u=c.overlay;let d=c.paneId;u.isStart()&&(a.updateProgressOverlayInfo(o),d=o);const h=u.points.length-1;if(u.isDrawing()&&d===o){const m=this._coordinateToPoint(u,l);u.eventMoveForDrawing(m),(f=u.onDrawing)==null||f.call(u,{chart:r,overlay:u,...l})}return this._figureMouseMoveEvent(u,"point",h,{key:`${E_}point_${h}`,type:"circle",attrs:{}})(l)}return a.setHoverOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null},(u,d)=>this._processOverlayMouseEnterEvent(u,d,l),(u,d)=>this._processOverlayMouseLeaveEvent(u,d,l)),t.setForceCursor(null),!1}).registerEvent("mouseClickEvent",l=>{var f,u;const c=a.getProgressOverlayInfo();if(c!==null){const d=c.overlay;let h=c.paneId;d.isStart()&&(a.updateProgressOverlayInfo(o,!0),h=o);const m=d.points.length-1;if(d.isDrawing()&&h===o){const g=this._coordinateToPoint(d,l);d.eventMoveForDrawing(g),(f=d.onDrawing)==null||f.call(d,{chart:r,overlay:d,...l}),d.nextStep(),d.isDrawing()||(a.progressOverlayComplete(),(u=d.onDrawEnd)==null||u.call(d,{chart:r,overlay:d,...l}))}return this._figureMouseClickEvent(d,"point",m,{key:`${E_}point_${m}`,type:"circle",attrs:{}})(l)}return a.setClickOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null},(d,h)=>this._processOverlaySelectedEvent(d,h,l),(d,h)=>this._processOverlayDeselectedEvent(d,h,l)),!1}).registerEvent("mouseDoubleClickEvent",l=>{var f;const c=a.getProgressOverlayInfo();if(c!==null){const u=c.overlay,d=c.paneId;u.isDrawing()&&d===o&&(u.forceComplete(),u.isDrawing()||(a.progressOverlayComplete(),(f=u.onDrawEnd)==null||f.call(u,{chart:r,overlay:u,...l})));const h=u.points.length-1;return this._figureMouseClickEvent(u,"point",h,{key:`${E_}point_${h}`,type:"circle",attrs:{}})(l)}return!1}).registerEvent("mouseRightClickEvent",l=>{const c=a.getProgressOverlayInfo();if(c!==null){const f=c.overlay;if(f.isDrawing()){const u=f.points.length-1;return this._figureMouseRightClickEvent(f,"point",u,{key:`${E_}point_${u}`,type:"circle",attrs:{}})(l)}}return!1}).registerEvent("mouseUpEvent",l=>{var u;const{overlay:c,figure:f}=a.getPressedOverlayInfo();return c!==null&&Gg("onPressedMoveEnd",f)&&((u=c.onPressedMoveEnd)==null||u.call(c,{chart:r,overlay:c,figure:f??void 0,...l})),a.setPressedOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null}),!1}).registerEvent("pressedMouseMoveEvent",l=>{var h;const{overlay:c,figureType:f,figureIndex:u,figure:d}=a.getPressedOverlayInfo();if(c!==null&&Gg("onPressedMoving",d)){if(!c.lock){const m=this._coordinateToPoint(c,l);f==="point"?c.eventPressedPointMove(m,u):c.eventPressedOtherMove(m,this.getWidget().getPane().getChart().getChartStore());let g=!1;(h=c.onPressedMoving)==null||h.call(c,{chart:r,overlay:c,figure:d??void 0,...l,preventDefault:()=>{g=!0}}),g?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return!0}return this.getWidget().setForceCursor(null),!1})}_createFigureEvents(t,s,o,r){return t.isDrawing()?null:{mouseMoveEvent:this._figureMouseMoveEvent(t,s,o,r),mouseDownEvent:this._figureMouseDownEvent(t,s,o,r),mouseClickEvent:this._figureMouseClickEvent(t,s,o,r),mouseRightClickEvent:this._figureMouseRightClickEvent(t,s,o,r),mouseDoubleClickEvent:this._figureMouseDoubleClickEvent(t,s,o,r)}}_processOverlayMouseEnterEvent(t,s,o){return eg(t.onMouseEnter)&&Gg("onMouseEnter",s)?(t.onMouseEnter({chart:this.getWidget().getPane().getChart(),overlay:t,figure:s??void 0,...o}),!0):!1}_processOverlayMouseLeaveEvent(t,s,o){return eg(t.onMouseLeave)&&Gg("onMouseLeave",s)?(t.onMouseLeave({chart:this.getWidget().getPane().getChart(),overlay:t,figure:s??void 0,...o}),!0):!1}_processOverlaySelectedEvent(t,s,o){var r;return Gg("onSelected",s)?((r=t.onSelected)==null||r.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:s??void 0,...o}),!0):!1}_processOverlayDeselectedEvent(t,s,o){var r;return Gg("onDeselected",s)?((r=t.onDeselected)==null||r.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:s??void 0,...o}),!0):!1}_figureMouseMoveEvent(t,s,o,r){return a=>{var f;const l=this.getWidget().getPane(),c=!t.isDrawing()&&Gg("onMouseMove",r);if(c){let u=!1;(f=t.onMouseMove)==null||f.call(t,{chart:l.getChart(),overlay:t,figure:r,...a,preventDefault:()=>{u=!0}}),u?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return l.getChart().getChartStore().setHoverOverlayInfo({paneId:l.getId(),overlay:t,figureType:s,figure:r,figureIndex:o},(u,d)=>this._processOverlayMouseEnterEvent(u,d,a),(u,d)=>this._processOverlayMouseLeaveEvent(u,d,a)),c}}_figureMouseDownEvent(t,s,o,r){return a=>{var f;const l=this.getWidget().getPane(),c=l.getId();return t.startPressedMove(this._coordinateToPoint(t,a)),Gg("onPressedMoveStart",r)?((f=t.onPressedMoveStart)==null||f.call(t,{chart:l.getChart(),overlay:t,figure:r,...a}),l.getChart().getChartStore().setPressedOverlayInfo({paneId:c,overlay:t,figureType:s,figureIndex:o,figure:r}),!t.isDrawing()):!1}}_figureMouseClickEvent(t,s,o,r){return a=>{var u;const l=this.getWidget().getPane(),c=l.getId(),f=!t.isDrawing()&&Gg("onClick",r);return f&&((u=t.onClick)==null||u.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:r,...a})),l.getChart().getChartStore().setClickOverlayInfo({paneId:c,overlay:t,figureType:s,figureIndex:o,figure:r},(d,h)=>this._processOverlaySelectedEvent(d,h,a),(d,h)=>this._processOverlayDeselectedEvent(d,h,a)),f}}_figureMouseDoubleClickEvent(t,s,o,r){return a=>{var l;return Gg("onDoubleClick",r)?((l=t.onDoubleClick)==null||l.call(t,{...a,chart:this.getWidget().getPane().getChart(),figure:r,overlay:t}),!t.isDrawing()):!1}}_figureMouseRightClickEvent(t,s,o,r){return a=>{var l;if(Gg("onRightClick",r)){let c=!1;return(l=t.onRightClick)==null||l.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:r,...a,preventDefault:()=>{c=!0}}),c||this.getWidget().getPane().getChart().getChartStore().removeOverlay(t),!t.isDrawing()}return!1}}_coordinateToPoint(t,s){const o={},r=this.getWidget().getPane(),a=r.getChart(),l=r.getId(),c=a.getChartStore();if(this.coordinateToPointTimestampDataIndexFlag()){const u=a.getXAxisPane().getAxisComponent().convertFromPixel(s.x),d=c.dataIndexToTimestamp(u)??void 0;o.timestamp=d,o.dataIndex=u}if(this.coordinateToPointValueFlag()){const f=r.getAxisComponent();let u=f.convertFromPixel(s.y);if(t.mode!=="normal"&&l===td.CANDLE&&Ca(o.dataIndex)){const d=c.getDataByDataIndex(o.dataIndex);if(d!==null){const h=t.modeSensitivity;if(u>d.high)if(t.mode==="weak_magnet"){const m=f.convertToPixel(d.high),g=f.convertFromPixel(m-h);u<g&&(u=d.high)}else u=d.high;else if(u<d.low)if(t.mode==="weak_magnet"){const m=f.convertToPixel(d.low),g=f.convertFromPixel(m-h);u>g&&(u=d.low)}else u=d.low;else{const m=Math.max(d.open,d.close),g=Math.min(d.open,d.close);u>m?u-m<d.high-u?u=m:u=d.high:u<g?u-d.low<g-u?u=d.low:u=g:m-u<u-g?u=m:u=g}}}o.value=u}return o}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(t,s){return this.getWidget().getPane().getChart().getChartStore().isOverlayDrawing()?this.onEvent(t,s):super.dispatchEvent(t,s)}drawImp(t){this.getCompleteOverlays().forEach(r=>{r.visible&&this._allowOverlay(r)&&this._drawOverlay(t,r)});const o=this.getProgressOverlay();$s(o)&&o.visible&&this._allowOverlay(o)&&this._drawOverlay(t,o)}_allowOverlay(t){const s=t.extendData;return((s==null?void 0:s.crossPaneRole)==="mirror"||typeof(s==null?void 0:s.mirrorOf)=="string")&&(s==null?void 0:s.crossPaneEnabled)===!1?!1:this._overlayFilter?this._overlayFilter(t):!0}_drawOverlay(t,s){const{points:o}=s,r=this.getWidget().getPane(),a=r.getChart(),l=a.getChartStore(),c=r.getAxisComponent(),f=a.getXAxisPane().getAxisComponent(),d=l.getDataList().length,h=d-1,m=o.map((g,w)=>{let C=null;Ca(g.timestamp)?C=l.timestampToDataIndex(g.timestamp):Ca(g.dataIndex)?C=g.dataIndex:d>0&&(C=h);const P={x:0,y:0};return Ca(C)&&(P.x=f.convertToPixel(C)),Ca(g.value)&&(P.y=(c==null?void 0:c.convertToPixel(g.value))??0),P});if(m.length>0){const g=[].concat(this.getFigures(s,m));this.drawFigures(t,s,g)}this.drawDefaultFigures(t,s,m)}drawFigures(t,s,o){const r=this.getWidget().getPane().getChart().getStyles().overlay;o.forEach((a,l)=>{const{type:c,styles:f,attrs:u}=a;[].concat(u).forEach(h=>{var w,C;const m=this._createFigureEvents(s,"other",l,a),g={...r[c],...(w=s.styles)==null?void 0:w[c],...f};(C=this.createFigure({name:c,attrs:h,styles:g},m??void 0))==null||C.draw(t)})})}getCompleteOverlays(){const t=this.getWidget().getPane();return t.getChart().getChartStore().getOverlaysByPaneId(t.getId())}getProgressOverlay(){const t=this.getWidget().getPane(),s=t.getChart().getChartStore().getProgressOverlayInfo();return $s(s)&&s.paneId===t.getId()?s.overlay:null}getFigures(t,s){var u;const o=this.getWidget(),r=o.getPane(),a=r.getChart(),l=r.getAxisComponent(),c=a.getXAxisPane().getAxisComponent(),f=o.getBounding();return((u=t.createPointFigures)==null?void 0:u.call(t,{chart:a,overlay:t,coordinates:s,bounding:f,xAxis:c,yAxis:l}))??[]}drawDefaultFigures(t,s,o){var r,a;if(s.needDefaultPointFigure){const l=this.getWidget().getPane().getChart().getChartStore(),c=l.getHoverOverlayInfo(),f=l.getClickOverlayInfo();let u=o;if(XI.has(s.name)){const d=this.getWidget().getBounding(),h=d.height>0?d.height/2:0;u=o.map(m=>({...m,y:h}))}if(((r=c.overlay)==null?void 0:r.id)===s.id&&c.figureType!=="none"||((a=f.overlay)==null?void 0:a.id)===s.id&&f.figureType!=="none"){const d=l.getStyles().overlay,h=s.styles,m={...d.point,...h==null?void 0:h.point};u.forEach(({x:g,y:w},C)=>{var F,B,$,L;let P=m.radius,I=m.color,A=m.borderColor,M=m.borderSize;((F=c.overlay)==null?void 0:F.id)===s.id&&c.figureType==="point"&&((B=c.figure)==null?void 0:B.key)===`${E_}point_${C}`&&(P=m.activeRadius,I=m.activeColor,A=m.activeBorderColor,M=m.activeBorderSize),($=this.createFigure({name:"circle",attrs:{x:g,y:w,r:P+M},styles:{color:A}},this._createFigureEvents(s,"point",C,{key:`${E_}point_${C}`,type:"circle",attrs:{x:g,y:w,r:P+M},styles:{color:A}})??void 0))==null||$.draw(t),(L=this.createFigure({name:"circle",attrs:{x:g,y:w,r:P},styles:{color:I}}))==null||L.draw(t)})}}}}class W3 extends Bw{constructor(t,s){super(t,s);Te(this,"_gridView",new GI(this));Te(this,"_indicatorView",new YI(this));Te(this,"_crosshairLineView",new KI(this));Te(this,"_tooltipView",this.createTooltipView());Te(this,"_overlayView",new Kx(this,{overlayFilter:t=>t.isDrawing()||t.zLevel>=0}));Te(this,"_overlayBackgroundView",new Kx(this,{overlayFilter:t=>!t.isDrawing()&&t.zLevel<0,enableBaseEvent:!1}));this.addChild(this._tooltipView),this.addChild(this._overlayBackgroundView),this.addChild(this._overlayView)}getName(){return od.MAIN}updateMain(t){this.getPane().getOptions().state!=="minimize"&&(this.updateMainContent(t),this._indicatorView.draw(t))}createTooltipView(){return new V3(this)}updateMainContent(t){}updateOverlayContent(t){}updateUnderlay(t){this.getPane().getOptions().state!=="minimize"&&(this._gridView.draw(t),this._overlayBackgroundView.draw(t))}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this._overlayView.draw(t),this._crosshairLineView.draw(t),this.updateOverlayContent(t)),this._tooltipView.draw(t)}}class ZI extends O3{constructor(){super(...arguments);Te(this,"_ripplePoint",this.createFigure({name:"circle",attrs:{x:0,y:0,r:0},styles:{style:"fill"}}));Te(this,"_animationFrameTime",0);Te(this,"_animation",new Ux({iterationCount:1/0}).doFrame(t=>{this._animationFrameTime=t;const s=this.getWidget().getPane();s.getChart().updatePane(Ff.Main,s.getId())}))}drawImp(t){var C,P,I;const s=this.getWidget(),o=s.getPane(),r=o.getChart(),l=r.getDataList().length-1,c=s.getBounding(),f=o.getAxisComponent(),u=r.getStyles().candle.area,d=[];let h=Number.MAX_SAFE_INTEGER,m=Number.MIN_SAFE_INTEGER,g=null;if(this.eachChildren(A=>{const M=A.x,{current:F}=A.data,B=F==null?void 0:F[u.value];if(Ca(B)){const $=f.convertToPixel(B);m===Number.MIN_SAFE_INTEGER&&(m=M),d.push({x:M,y:$}),h=Math.min(h,$),A.dataIndex===l&&(g={x:M,y:$})}}),d.length>0){(C=this.createFigure({name:"line",attrs:{coordinates:d},styles:{color:u.lineColor,size:u.lineSize,smooth:u.smooth}}))==null||C.draw(t);const A=u.backgroundColor;let M="";if(t0(A)){const F=t.createLinearGradient(0,c.height,0,h);try{A.forEach(({offset:B,color:$})=>{F.addColorStop(B,$)})}catch{}M=F}else M=A;t.fillStyle=M,t.beginPath(),t.moveTo(m,c.height),t.lineTo(d[0].x,d[0].y),N3(t,d,u.smooth),t.lineTo(d[d.length-1].x,c.height),t.closePath(),t.fill()}const w=u.point;if(w.show&&$s(g)){(P=this.createFigure({name:"circle",attrs:{x:g.x,y:g.y,r:w.radius},styles:{style:"fill",color:w.color}}))==null||P.draw(t);let A=w.rippleRadius;w.animation&&(A=w.radius+this._animationFrameTime/w.animationDuration*(w.rippleRadius-w.radius),this._animation.setDuration(w.animationDuration).start()),(I=this._ripplePoint)==null||I.setAttrs({x:g.x,y:g.y,r:A}).setStyles({style:"fill",color:w.rippleColor}).draw(t)}else this.stopAnimation()}stopAnimation(){this._animation.stop()}}class JI extends Vg{drawImp(e){var c;const s=this.getWidget().getPane(),o=s.getChart().getChartStore(),r=o.getStyles().candle.priceMark,a=r.high,l=r.low;if(r.show&&(a.show||l.show)){const f=o.getVisibleRangeHighLowPrice(),u=((c=o.getSymbol())==null?void 0:c.pricePrecision)??Ah.PRICE,d=s.getAxisComponent(),{price:h,x:m}=f[0],{price:g,x:w}=f[1],C=d.convertToPixel(h),P=d.convertToPixel(g),I=o.getDecimalFold(),A=o.getThousandsSeparator();a.show&&h!==Number.MIN_SAFE_INTEGER&&this._drawMark(e,I.format(A.format(Mh(h,u))),{x:m,y:C},C<P?[-2,-5]:[2,5],a),l.show&&g!==Number.MAX_SAFE_INTEGER&&this._drawMark(e,I.format(A.format(Mh(g,u))),{x:w,y:P},C<P?[2,5]:[-2,-5],l)}}_drawMark(e,t,s,o,r){var m,g,w;const a=s.x,l=s.y+o[0];(m=this.createFigure({name:"line",attrs:{coordinates:[{x:a-2,y:l+o[0]},{x:a,y:l},{x:a+2,y:l+o[0]}]},styles:{color:r.color}}))==null||m.draw(e);let c=0,f=0,u="left";const{width:d}=this.getWidget().getBounding();a>d/2?(c=a-5,f=c-r.textOffset,u="right"):(c=a+5,u="left",f=c+r.textOffset);const h=l+o[1];(g=this.createFigure({name:"line",attrs:{coordinates:[{x:a,y:l},{x:a,y:h},{x:c,y:h}]},styles:{color:r.color}}))==null||g.draw(e),(w=this.createFigure({name:"text",attrs:{x:f,y:h,text:t,align:u,baseline:"middle"},styles:{color:r.color,size:r.textSize,family:r.textFamily,weight:r.textWeight}}))==null||w.draw(e)}}class QI extends Vg{drawImp(e){var f,u;const t=this.getWidget(),s=t.getPane(),o=t.getBounding(),r=s.getChart().getChartStore(),a=r.getStyles().candle.priceMark,l=a.last,c=l.line;if(a.show&&l.show&&c.show){const d=s.getAxisComponent(),h=r.getDataList(),m=h[h.length-1];if($s(m)){const{close:g,open:w}=m,C=l.compareRule==="current_open"?w:((f=h[h.length-2])==null?void 0:f.close)??g,P=d.convertToPixel(g);let I="";g>C?I=l.upColor:g<C?I=l.downColor:I=l.noChangeColor,(u=this.createFigure({name:"line",attrs:{coordinates:[{x:0,y:P},{x:o.width,y:P}]},styles:{style:c.style,color:I,size:c.size,dashedValue:c.dashedValue}}))==null||u.draw(e)}}}}const H3={second:"HH:mm:ss",minute:"YYYY-MM-DD HH:mm",hour:"YYYY-MM-DD HH:mm",day:"YYYY-MM-DD",week:"YYYY-MM-DD",month:"YYYY-MM",year:"YYYY"},e7={time:"时间：",open:"开：",high:"高：",low:"低：",close:"收：",volume:"成交量：",turnover:"成交额：",change:"涨幅：",second:"秒",minute:"",hour:"小时",day:"天",week:"周",month:"月",year:"年"},t7={time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: ",turnover:"Turnover: ",change:"Change: ",second:"S",minute:"",hour:"H",day:"D",week:"W",month:"M",year:"Y"},n7={"zh-CN":e7,"en-US":t7};function s7(n,e){return n7[e][n]??n}class o7 extends V3{constructor(){super(...arguments);Te(this,"_logoCache",{});Te(this,"_logoSubscribed",{})}drawImp(t){const s=this.getWidget(),o=s.getPane().getChart().getChartStore(),r=o.getCrosshair();if($s(r.dutyData)){const a=s.getBounding(),l=o.getStyles(),c=l.candle,f=l.indicator;if(c.tooltip.showType==="rect"&&f.tooltip.showType==="rect"){const u=this.isDrawTooltip(r,c.tooltip),d=this.isDrawTooltip(r,f.tooltip);this._drawRectTooltip(t,u,d,c.tooltip.offsetTop)}else if(c.tooltip.showType==="standard"&&f.tooltip.showType==="standard"){const{offsetLeft:u,offsetTop:d,offsetRight:h}=c.tooltip,m=a.width-h,g=this._drawCandleStandardTooltip(t,u,d,m);this.drawIndicatorTooltip(t,u,g,m)}else if(c.tooltip.showType==="rect"&&f.tooltip.showType==="standard"){const{offsetLeft:u,offsetTop:d,offsetRight:h}=c.tooltip,m=a.width-h,g=this.drawIndicatorTooltip(t,u,d,m),w=this.isDrawTooltip(r,c.tooltip);this._drawRectTooltip(t,w,!1,g)}else{const{offsetLeft:u,offsetTop:d,offsetRight:h}=c.tooltip,m=a.width-h,g=this._drawCandleStandardTooltip(t,u,d,m),w=this.isDrawTooltip(r,f.tooltip);this._drawRectTooltip(t,!1,w,g)}}}_drawCandleStandardTooltip(t,s,o,r){var I;const a=this.getWidget().getPane().getChart().getChartStore(),c=a.getStyles().candle.tooltip,f=c.legend,u=c.title,d=typeof window<"u"&&window.innerWidth<=768,h=(u==null?void 0:u.marginLeft)??0,m=f.marginLeft??0,g=d&&(u!=null&&u.show)?s+h-m:s;let w=0;const C={x:s,y:o},P=a.getCrosshair();if(this.isDrawTooltip(P,c)){if(u.show){const{type:F="",span:B=""}=a.getPeriod()??{},$=a.getSymbol(),L=(($==null?void 0:$.type)||"").toLowerCase(),O=(($==null?void 0:$.exchange)||"").toUpperCase();let Y=L;(Y==="forex"||Y==="crypto")&&(Y="");const ce={second:"s",minute:"m",hour:"h",day:"d",week:"w",month:"mo",year:"y"},Q=(B?`${B}`:"")+(ce[F]??"");let le=u.template;!Y&&typeof le=="string"&&(le=le.replace(/(?:\s*[·\.]\s*)\{segment\}/i,""));let ue=D6(le,{...$,period:Q,exchange:O,segment:Y});try{if(d){const xe=($==null?void 0:$.name)||($==null?void 0:$.ticker)||"",oe=u.marginLeft??0,Pe=u.marginRight??0,$e=20,Ke=!!($!=null&&$.logo2)?$e*2-6+6:$e+6,qe=Math.max(0,r-Ke-oe-Pe),nt=u.size??14,ft=u.family,ut=u.weight,bt="...",Pt=Em(bt,nt,ut,ft);let Et=xe;if(Em(Et,nt,ut,ft)>qe&&qe>Pt){let Je=0,Ct=Et.length;for(;Je<Ct;){const Xe=Math.floor((Je+Ct)/2),Ae=Et.slice(0,Xe)+bt;Em(Ae,nt,ut,ft)<=qe?Je=Xe+1:Ct=Xe}const Ze=Math.max(1,Je-1);Et=Et.slice(0,Ze)+bt}ue=Et}}catch{}const fe=u.color;let pe={...u};try{const xe=($==null?void 0:$.logo)||"",oe=($==null?void 0:$.logo2)||"",Pe=20,$e=Math.floor(C.x+(pe.marginLeft??0)),ze=pe.marginTop??0,Ke=pe.marginBottom??0,qe=pe.size??12,nt=ze+qe+Ke,ft=Math.floor(C.y+(nt-Pe)/2),ut=[xe].filter(Boolean);oe&&ut.push(oe);const bt=a.getStyles(),Pt=((I=bt==null?void 0:bt.pane)==null?void 0:I.backgroundColor)||"#ffffff";let Et=255,Mt=255,Je=255;if(Pt.startsWith("#")){const gt=Pt.replace(/^#/,""),Ft=parseInt(gt.length===3?gt.split("").map(ot=>ot+ot).join(""):gt,16);Et=Ft>>16&255,Mt=Ft>>8&255,Je=Ft&255}else if(/rgba?\(/i.test(Pt)){const gt=Pt.match(/rgba?\(([^)]+)\)/i);if(gt){const Ft=gt[1].split(",").map(ot=>parseFloat(ot.trim()));Et=Ft[0]??Et,Mt=Ft[1]??Mt,Je=Ft[2]??Je}}const Ct=.299*Et+.587*Mt+.114*Je,Ze=Ct>186?"#CBD5E1":"#4B5563",Xe=Ct>186?"rgba(255,255,255,0.7)":"rgba(17,24,39,0.6)",Ae=gt=>{var gn,hn;const ot=(($==null?void 0:$.shortName)||($==null?void 0:$.ticker)||($==null?void 0:$.name)||""||"").toString().trim().charAt(0).toUpperCase(),ve=2,Ie=Math.max(8,Pe-ve*2),It=Em(ot,Ie,pe.weight,pe.family),Dt=Math.max(0,Math.floor((Pe-ve*2-It)/2)),Zt=ve;(gn=this.createFigure({name:"rect",attrs:{x:gt,y:ft,width:Pe,height:Pe},styles:{style:"stroke_fill",color:Xe,borderColor:Ze,borderSize:1,borderRadius:Pe/2}}))==null||gn.draw(t),(hn=this.createFigure({name:"text",attrs:{x:gt+ve,y:ft+ve,text:ot,width:Pe-ve*2,height:Pe-ve*2},styles:{backgroundColor:Xe,borderRadius:(Pe-ve*2)/2,size:Ie,family:pe.family,weight:pe.weight,color:Ze,paddingLeft:Dt,paddingTop:Zt,paddingRight:0,paddingBottom:0}}))==null||hn.draw(t)};let Qe=Pe;ut.forEach((gt,Ft)=>{var ve,Ie;const ot=Math.floor($e+(Ft===0?0:Pe-8));if(gt){if(!this._logoSubscribed[gt]){this._logoSubscribed[gt]=!0;try{JC(gt,()=>{try{this.getWidget().getPane().getChart().updatePane(Ff.Overlay,td.CANDLE)}catch{}})}catch{}}qx(gt);let It=KC(gt)||this._logoCache[gt];It.complete&&It.naturalWidth>0?((ve=this.createFigure({name:"rect",attrs:{x:ot,y:ft,width:Pe,height:Pe},styles:{style:"stroke_fill",color:Xe,borderColor:Ze,borderSize:1,borderRadius:Pe/2}}))==null||ve.draw(t),(Ie=this.createFigure({name:"image",attrs:{x:ot+2,y:ft+2,width:Pe-4,height:Pe-4,image:It,borderRadius:(Pe-4)/2},styles:{}}))==null||Ie.draw(t)):Ae(ot)}else Ae(ot)}),Qe=ut.length===2?Pe*2-8:Pe,pe.marginLeft=(pe.marginLeft??0)+Qe+6}catch{}const Z=this.drawStandardTooltipLegends(t,[{title:{text:"",color:fe},value:{text:ue,color:fe}}],C,s,0,typeof window<"u"&&window.innerWidth<=768?r-($!=null&&$.logo2?20*2-6:20):r,pe);w=Math.max(w,Z)}const A=this._getCandleTooltipLegends(),M=this.classifyTooltipFeatures(c.features);w=this.drawStandardTooltipFeatures(t,M[0],C,null,s,w,r),w=this.drawStandardTooltipFeatures(t,M[1],C,null,s,w,r);try{d&&(C.x=g,C.y+=w,w=0)}catch{}if(A.length>0){let F={...f};try{if(d){let $=F.marginLeft??0,L=F.marginRight??0;$=Math.min($,4),L=Math.min(L,4),F.marginLeft=$,F.marginRight=L}}catch{}const B={...F,marginTop:Math.max(F.marginTop??0,Math.floor((w-F.size)/2))};w=this.drawStandardTooltipLegends(t,A,C,g,w,r,B)}w=this.drawStandardTooltipFeatures(t,M[2],C,null,g,w,r)}return C.y+w}_drawRectTooltip(t,s,o,r){var g;const a=this.getWidget(),l=a.getPane(),c=l.getChart().getChartStore(),f=c.getStyles(),u=f.candle,d=f.indicator,h=u.tooltip,m=d.tooltip;if(s||o){const w=this._getCandleTooltipLegends(),{offsetLeft:C,offsetTop:P,offsetRight:I,offsetBottom:A}=h,{marginLeft:M,marginRight:F,marginTop:B,marginBottom:$,size:L,weight:O,family:Y}=h.legend,{position:ce,paddingLeft:Q,paddingRight:le,paddingTop:ue,paddingBottom:fe,offsetLeft:pe,offsetRight:Z,offsetTop:xe,offsetBottom:oe,borderSize:Pe,borderRadius:$e,borderColor:ze,color:Ke}=h.rect;let qe=0,nt=0,ft=0;s&&(t.font=o_(L,O,Y),w.forEach(Xe=>{const Ae=Xe.title,Qe=Xe.value,gt=`${Ae.text}${Qe.text}`,Ft=t.measureText(gt).width+M+F;qe=Math.max(qe,Ft)}),ft+=($+B+L)*w.length);const{marginLeft:ut,marginRight:bt,marginTop:Pt,marginBottom:Et,size:Mt,weight:Je,family:Ct}=m.legend,Ze=[];if(o){const Xe=c.getIndicatorsByPaneId(l.getId());t.font=o_(Mt,Je,Ct),Xe.forEach(Ae=>{const Qe=this.getIndicatorTooltipData(Ae).legends;Ze.push(Qe),Qe.forEach(gt=>{const Ft=gt.title,ot=gt.value,ve=`${Ft.text}${ot.text}`,Ie=t.measureText(ve).width+ut+bt;qe=Math.max(qe,Ie),ft+=Pt+Et+Mt})})}if(nt+=qe,nt!==0&&ft!==0){const Xe=c.getCrosshair(),Ae=a.getBounding(),Qe=l.getYAxisWidget().getBounding();nt+=Pe*2+Q+le,ft+=Pe*2+ue+fe;const gt=Ae.width/2,Ft=ce==="pointer"&&Xe.paneId===td.CANDLE,ot=(Xe.realX??0)>gt;let ve=0;if(Ft){const Zt=Xe.realX;ot?ve=Zt-Z-nt:ve=Zt+pe}else{const Zt=this.getWidget().getPane().getAxisComponent();ot?(ve=pe+C,Zt.inside&&Zt.position==="left"&&(ve+=Qe.width)):(ve=Ae.width-Z-nt-I,Zt.inside&&Zt.position==="right"&&(ve-=Qe.width))}let Ie=r+xe;Ft&&(Ie=Xe.y-ft/2,Ie+ft>Ae.height-oe-A&&(Ie=Ae.height-oe-ft-A),Ie<r+xe&&(Ie=r+xe+P)),(g=this.createFigure({name:"rect",attrs:{x:ve,y:Ie,width:nt,height:ft},styles:{style:"stroke_fill",color:Ke,borderColor:ze,borderSize:Pe,borderRadius:$e}}))==null||g.draw(t);const It=ve+Pe+Q+M;let Dt=Ie+Pe+ue;if(s&&w.forEach(Zt=>{var qn,On;Dt+=B;const gn=Zt.title;(qn=this.createFigure({name:"text",attrs:{x:It,y:Dt,text:gn.text},styles:{color:gn.color,size:L,family:Y,weight:O}}))==null||qn.draw(t);const hn=Zt.value;(On=this.createFigure({name:"text",attrs:{x:ve+nt-Pe-F-le,y:Dt,text:hn.text,align:"right"},styles:{color:hn.color,size:L,family:Y,weight:O}}))==null||On.draw(t),Dt+=L+$}),o){const Zt=ve+Pe+Q+ut;Ze.forEach(gn=>{gn.forEach(hn=>{var bn,Fn;Dt+=Pt;const qn=hn.title,On=hn.value;(bn=this.createFigure({name:"text",attrs:{x:Zt,y:Dt,text:qn.text},styles:{color:qn.color,size:Mt,family:Ct,weight:Je}}))==null||bn.draw(t),(Fn=this.createFigure({name:"text",attrs:{x:ve+nt-Pe-bt-le,y:Dt,text:On.text,align:"right"},styles:{color:On.color,size:Mt,family:Ct,weight:Je}}))==null||Fn.draw(t),Dt+=Mt+Et})})}}}}_getCandleTooltipLegends(){const t=this.getWidget().getPane().getChart().getChartStore(),s=t.getStyles().candle,o=t.getDataList(),r=t.getCrosshair(),a=t.getInnerFormatter(),l=t.getDecimalFold(),c=t.getThousandsSeparator(),f=t.getLocale(),u=typeof window<"u"&&window.innerWidth<=768,d=hd(r.paneId),{pricePrecision:h=Ah.PRICE,volumePrecision:m=Ah.VOLUME}=t.getSymbol()??{},g=t.getPeriod(),w=t.getCrosshair().dataIndex??0,C=t.getSymbol(),I=((C==null?void 0:C.type)||"").toLowerCase()==="stock",M=s.tooltip.legend,{color:F,defaultValue:B}=M,$=M.template,L=o[w-1]??null,O=o[w],Y=(L==null?void 0:L.close)??O.close,ce=O.close-Y,Q=Math.abs(ce),le=l.format(c.format(Mh(Q,h))),ue=ce>0?`+${le}`:ce<0?`-${le}`:le,fe={...O,time:a.formatDate(O.timestamp,H3[(g==null?void 0:g.type)??"day"],"tooltip"),open:l.format(c.format(Mh(O.open,h))),high:l.format(c.format(Mh(O.high,h))),low:l.format(c.format(Mh(O.low,h))),close:l.format(c.format(Mh(O.close,h))),volume:l.format(c.format(a.formatBigNumber(Mh(O.volume??B,m)))),turnover:l.format(c.format(Mh(O.turnover??B,h))),changeValue:ue,change:Y===0?B:`${c.format(Mh(ce/Y*100))}%`};let pe=eg($)?$({prev:L,current:O,next:o[w+1]??null},s):$;return u&&!d&&(pe=[{title:"",value:"{close} {changeValue} ({change})"}]),(I?pe:pe.filter(xe=>{const oe=kg(xe.title)?xe.title.text:xe.title,Pe=kg(xe.value)?xe.value.text:xe.value,$e=(oe||"").toString().trim().toLowerCase(),ze=(Pe||"").toString();return!($e==="volume"||/\{volume\}/i.test(ze))})).map(xe=>{const{title:oe,value:Pe}=xe;let $e={text:"",color:F};kg(oe)?$e=oe:$e.text=oe,$e.text=s7($e.text,f);let ze={text:B,color:F};return kg(Pe)?ze=Pe:ze.text=Pe,$s(/{change}/.exec(ze.text))&&(ze.color=ce===0?s.priceMark.last.noChangeColor:ce>0?s.priceMark.last.upColor:s.priceMark.last.downColor),ze.text=D6(ze.text,fe),{title:$e,value:ze}})}}class i7 extends Vg{constructor(t){super(t);Te(this,"_activeFeatureInfo",null);Te(this,"_featureClickEvent",t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCrosshairFeatureClick",t),!0));Te(this,"_featureMouseMoveEvent",t=>()=>(this._activeFeatureInfo=t,this.getWidget().setForceCursor("pointer"),!0));this.registerEvent("mouseMoveEvent",s=>(this._activeFeatureInfo=null,this.getWidget().setForceCursor(null),!1))}drawImp(t){var f;const s=this.getWidget(),o=s.getPane(),r=s.getPane().getChart().getChartStore(),a=r.getCrosshair(),l=this.getWidget(),c=l.getPane().getAxisComponent();if(hd(a.paneId)&&a.paneId===o.getId()&&c.isInCandle()){const u=r.getStyles().crosshair,d=u.horizontal.features;if(u.show&&u.horizontal.show&&d.length>0){const h=c.position==="right",m=l.getBounding();let g=0;const w=u.horizontal.text;if(c.inside&&w.show){const I=c.convertFromPixel(a.y),A=c.getRange();let M=c.displayValueToText(c.realValueToDisplayValue(c.valueToRealValue(I,{range:A}),{range:A}),((f=r.getSymbol())==null?void 0:f.pricePrecision)??Ah.PRICE);M=r.getDecimalFold().format(r.getThousandsSeparator().format(M)),g=w.paddingLeft+Em(M,w.size,w.weight,w.family)+w.paddingRight}let C=g;h&&(C=m.width-g);const P=a.y;d.forEach(I=>{var ze,Ke,qe,nt;const{marginLeft:A=0,marginTop:M=0,marginRight:F=0,paddingLeft:B=0,paddingTop:$=0,paddingRight:L=0,paddingBottom:O=0,color:Y,activeColor:ce,backgroundColor:Q,activeBackgroundColor:le,borderRadius:ue,size:fe=0,type:pe,content:Z}=I;let xe=fe;if(pe==="icon_font"){const ft=Z;xe=B+Em(ft.code,fe,"normal",ft.family)+L}h?C-=xe+F:C+=A;let oe=Y,Pe=Q;((ze=this._activeFeatureInfo)==null?void 0:ze.feature.id)===I.id&&(oe=ce??Y,Pe=le??Q);const $e={mouseClickEvent:this._featureClickEvent({crosshair:a,feature:I}),mouseMoveEvent:this._featureMouseMoveEvent({crosshair:a,feature:I})};if(pe==="icon_font"){const ft=Z;(Ke=this.createFigure({name:"text",attrs:{text:ft.code,x:C,y:P+M,baseline:"middle"},styles:{paddingLeft:B,paddingTop:$,paddingRight:L,paddingBottom:O,borderRadius:ue,size:fe,family:ft.family,color:oe,backgroundColor:Pe}},$e))==null||Ke.draw(t)}else{(qe=this.createFigure({name:"rect",attrs:{x:C,y:P+M-fe/2,width:fe,height:fe},styles:{paddingLeft:B,paddingTop:$,paddingRight:L,paddingBottom:O,color:Pe}},$e))==null||qe.draw(t);const ft=Z;(nt=this.createFigure({name:"path",attrs:{path:ft.path,x:C,y:P+M+$-fe/2,width:fe,height:fe},styles:{style:ft.style,lineWidth:ft.lineWidth,color:oe}}))==null||nt.draw(t)}h?C-=A:C+=xe+F})}}}}class r7 extends W3{constructor(t,s){super(t,s);Te(this,"_candleBarView",new z3(this));Te(this,"_candleAreaView",new ZI(this));Te(this,"_candleHighLowPriceView",new JI(this));Te(this,"_candleLastPriceLineView",new QI(this));Te(this,"_crosshairFeatureView",new i7(this));this.addChild(this._candleBarView),this.addChild(this._crosshairFeatureView)}updateMainContent(t){this.getPane().getChart().getStyles().candle.type!=="area"?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleAreaView.stopAnimation()):this._candleAreaView.draw(t),this._candleLastPriceLineView.draw(t)}updateOverlayContent(t){this._crosshairFeatureView.draw(t)}createTooltipView(){return new o7(this)}}class q3 extends Vg{drawImp(e,t){var c,f;const s=this.getWidget(),o=s.getPane(),r=s.getBounding(),a=o.getAxisComponent(),l=this.getAxisStyles(o.getChart().getStyles());if(l.show&&(l.axisLine.show&&((c=this.createFigure({name:"line",attrs:this.createAxisLine(r,l),styles:l.axisLine}))==null||c.draw(e)),!t[0])){const u=a.getTicks();if(l.ticduty.show&&this.createTicdutys(u,r,l).forEach(h=>{var m;(m=this.createFigure({name:"line",attrs:h,styles:l.ticduty}))==null||m.draw(e)}),l.tickText.show){const d=this.createTickTexts(u,r,l);(f=this.createFigure({name:"text",attrs:d,styles:l.tickText}))==null||f.draw(e)}}}}class a7 extends q3{getAxisStyles(e){return e.yAxis}createAxisLine(e,t){const s=this.getWidget().getPane().getAxisComponent(),o=t.axisLine.size;let r=0;return s.isFromZero()?r=0:r=e.width-o,{coordinates:[{x:r,y:0},{x:r,y:e.height}]}}createTicdutys(e,t,s){const o=this.getWidget().getPane().getAxisComponent(),r=s.axisLine,a=s.ticduty;let l=0,c=0;return o.isFromZero()?(l=0,r.show&&(l+=r.size),c=l+a.length):(l=t.width,r.show&&(l-=r.size),c=l-a.length),e.map(f=>({coordinates:[{x:l,y:f.coord},{x:c,y:f.coord}]}))}createTickTexts(e,t,s){const o=this.getWidget().getPane().getAxisComponent(),r=s.axisLine,a=s.ticduty,l=s.tickText;let c=0;o.isFromZero()?(c=l.marginStart,r.show&&(c+=r.size),a.show&&(c+=a.length)):(c=t.width-l.marginEnd,r.show&&(c-=r.size),a.show&&(c-=a.length));const f=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return e.map(u=>({x:c,y:u.coord,text:u.text,align:f,baseline:"middle"}))}}class l7 extends Vg{drawImp(e){var u,d,h,m,g,w,C;const t=this.getWidget(),s=t.getPane(),o=t.getBounding(),r=s.getChart().getChartStore(),a=r.getStyles().candle.priceMark,l=a.last,c=l.text,f=l.line;if(a.show&&l.show&&c.show){const P=r.getStyles().yAxis,I=P.axisLine.show?P.axisLine.size:0,A=P.ticduty.show?P.ticduty.length:0,M=P.tickText.marginStart,F=P.tickText.marginEnd,B=1,$=((u=r.getSymbol())==null?void 0:u.pricePrecision)??Ah.PRICE,L=s.getAxisComponent(),O=r.getVisibleRangeDataList(),Y=L.position==="right"?O.length-1:0,ce=r.getDataList(),Q=ce[ce.length-1];if($s(Q)){const{close:le,open:ue}=Q,fe=l.compareRule==="current_open"?ue:((d=ce[ce.length-2])==null?void 0:d.close)??le,pe=L.convertToPixel(le);let Z="";le>fe?Z=l.upColor:le<fe?Z=l.downColor:Z=l.noChangeColor,f.show&&((h=this.createFigure({name:"line",attrs:{coordinates:[{x:0,y:pe},{x:o.width,y:pe}]},styles:{style:f.style,color:Z,size:f.size,dashedValue:f.dashedValue}}))==null||h.draw(e));let xe=0,oe="left";const Pe=c.color,$e={...c};if(L.isFromZero())xe=I+B,oe="left",$e.paddingLeft=A+M-B;else{xe=o.width-I-B,oe="right";const ve=o.width-I-B,Ie=o.width-(P.axisLine.show?P.axisLine.size:0)-(P.ticduty.show?P.ticduty.length:0)-F;$e.paddingRight=ve-Ie}const ze=[],Ke=L.getRange();let qe=L.displayValueToText(L.realValueToDisplayValue(L.valueToRealValue(le,{range:Ke}),{range:Ke}),$);qe=r.getDecimalFold().format(r.getThousandsSeparator().format(qe));const{paddingLeft:nt,paddingRight:ft,paddingTop:ut,paddingBottom:bt,size:Pt,family:Et,weight:Mt}=$e;let Je=nt+Em(qe,Pt,Mt,Et)+ft;const Ct=ut+Pt+bt,Ze=Math.max(Je,o.width-I-B),Xe=E0(Z,Pe);ze.push({name:"text",attrs:{x:xe,y:pe,width:Ze,height:Ct,text:qe,align:oe,baseline:"middle"},styles:{...$e,color:Xe,backgroundColor:Z}});const Ae=r.getInnerFormatter().formatExtendText,Qe=Pt/2;let gt=pe-Qe-ut,Ft=pe+Qe+bt;l.extendTexts.forEach((ve,Ie)=>{const It=Ae({type:"last_price",data:Q,index:Ie});if(It.length>0&&ve.show){const Dt=ve.size/2;let Zt=0;ve.position==="above_price"?(gt-=ve.paddingBottom+Dt,Zt=gt,gt-=Dt+ve.paddingTop):(Ft+=ve.paddingTop+Dt,Zt=Ft,Ft+=Dt+ve.paddingBottom),Je=Math.max(Je,ve.paddingLeft+Em(It,ve.size,ve.weight,ve.family)+ve.paddingRight);const gn=Math.max(Je,o.width-I-B);ze.push({name:"text",attrs:{x:xe,y:Zt,width:gn,height:ve.paddingTop+ve.size+ve.paddingBottom,text:It,align:oe,baseline:"middle"},styles:{...ve,color:E0(Z,ve.color??Pe),backgroundColor:Z}})}});const ot=(m=O[Y])==null?void 0:m.data.current;if($s(ot)&&ot.timestamp!==Q.timestamp){const{close:ve,open:Ie}=ot,It=L.position==="right"?(g=O[Y-1])==null?void 0:g.data.current:(w=O[Y+1])==null?void 0:w.data.current,Dt=l.compareRule==="current_open"?Ie:(It==null?void 0:It.close)??((C=ce[ce.length-2])==null?void 0:C.close)??ve,Zt=L.convertToPixel(ve);let gn="";ve>Dt?gn=l.upColor:ve<Dt?gn=l.downColor:gn=l.noChangeColor;let hn=L.displayValueToText(L.realValueToDisplayValue(L.valueToRealValue(ve,{range:Ke}),{range:Ke}),$);hn=r.getDecimalFold().format(r.getThousandsSeparator().format(hn));let qn=nt+Em(hn,Pt,Mt,Et)+ft;const On=ut+Pt+bt,bn=Math.max(qn,o.width-I-B);ze.push({name:"text",attrs:{x:xe,y:Zt,width:bn,height:On,text:hn,align:oe,baseline:"middle"},styles:{...$e,color:E0(gn,Pe),backgroundColor:gn}});const Fn=Pt/2;let Xs=Zt-Fn-ut,oo=Zt+Fn+bt;l.extendTexts.forEach((Yn,_o)=>{const xs=Ae({type:"last_price",data:ot,index:_o});if(xs.length>0&&Yn.show){const Rt=Yn.size/2;let un=0;Yn.position==="above_price"?(Xs-=Yn.paddingBottom+Rt,un=Xs,Xs-=Rt+Yn.paddingTop):(oo+=Yn.paddingTop+Rt,un=oo,oo+=Rt+Yn.paddingBottom),qn=Math.max(qn,Yn.paddingLeft+Em(xs,Yn.size,Yn.weight,Yn.family)+Yn.paddingRight);const qs=Math.max(qn,o.width-I-B);ze.push({name:"text",attrs:{x:xe,y:un,width:qs,height:Yn.paddingTop+Yn.size+Yn.paddingBottom,text:xs,align:oe,baseline:"middle"},styles:{...Yn,color:E0(gn,Yn.color??Pe),backgroundColor:gn}})}})}ze.forEach(ve=>{var qn,On,bn,Fn;const Ie=ve.attrs,It=Ie.y,Dt=Ie.height??(((qn=ve.styles)==null?void 0:qn.paddingTop)??0)+(((On=ve.styles)==null?void 0:On.size)??0)+(((bn=ve.styles)==null?void 0:bn.paddingBottom)??0),Zt=Dt/2,hn=It<-Zt||It>o.height+Zt?It:s.placeYAxisLabel(It,Dt,o.height);hn!==null&&((Fn=this.createFigure({...ve,attrs:{...Ie,y:Ie.y+(hn-It)}}))==null||Fn.draw(e))})}}}}class c7 extends Vg{drawImp(e){var f,u,d;const t=this.getWidget(),s=t.getPane(),o=t.getBounding(),r=s.getChart().getChartStore(),a=r.getStyles().indicator,l=a.lastValueMark,c=l.text;if(l.show){const h=r.getStyles().yAxis,m=h.axisLine.show?h.axisLine.size:0,g=h.ticduty.show?h.ticduty.length:0,w=h.tickText.marginStart,C=h.tickText.marginEnd,P=1,I=s.getAxisComponent(),A=I.getRange(),M=r.getVisibleRangeDataList(),F=I.position==="right"?M.length-1:0,B=r.getDataList(),$=((f=M[F])==null?void 0:f.data.current)??B[B.length-1]??{},L=((u=M[F-(I.position==="right"?1:-1)])==null?void 0:u.data.current)??B[B.length-2]??{},O=r.getIndicatorsByPaneId(s.getId()),Y=r.getInnerFormatter(),ce=r.getDecimalFold(),Q=r.getThousandsSeparator(),le=((d=r.getSymbol())==null?void 0:d.pricePrecision)??Ah.PRICE,ue=[];O.forEach(fe=>{var xe,oe,Pe,$e,ze,Ke,qe,nt,ft;const pe=fe.result,Z=pe[$.timestamp]??pe[L.timestamp]??{};if($s(Z)&&fe.visible){if(fe.series==="volume"&&s.getId()===td.CANDLE){const bt=Z.volume;if(Ca(bt)){let Pt=0;if(M.forEach(Et=>{var Ze;const Mt=(Ze=Et==null?void 0:Et.data)==null?void 0:Ze.current,Je=Mt==null?void 0:Mt.timestamp;if(Je==null)return;const Ct=pe[Je];Ct&&(Ca(Ct.volume)&&(Pt=Math.max(Pt,Ct.volume)),Ca(Ct.ema)&&(Pt=Math.max(Pt,Ct.ema)))}),Pt>0){const Je=Math.max(10,Math.floor(o.height*.22)),Ct=Math.max(1,Math.floor(Je*.56)),Ze=o.height-1,Xe=Math.min(1,bt/Pt),Ae=Ze-Math.floor(Xe*Ct),Qe=((Pe=(oe=(xe=fe.styles)==null?void 0:xe.bars)==null?void 0:oe[0])==null?void 0:Pe.upColor)??"#26a69a",gt=((Ke=(ze=($e=fe.styles)==null?void 0:$e.bars)==null?void 0:ze[0])==null?void 0:Ke.downColor)??"#ef5350";let ot=((ft=(nt=(qe=fe.styles)==null?void 0:qe.bars)==null?void 0:nt[0])==null?void 0:ft.noChangeColor)??Qe;$s($)&&$s(L)&&Ca($.close)&&Ca(L.close)&&($.close>L.close?ot=Qe:$.close<L.close&&(ot=gt));let ve=Mh(bt,fe.precision);fe.shouldFormatBigNumber&&(ve=Y.formatBigNumber(ve)),ve=ce.format(Q.format(ve));let Ie=0,It="left";const Dt={...c};if(I.isFromZero())Ie=m+P,It="left",Dt.paddingLeft=g+w-P;else{Ie=o.width-m-P,It="right";const _o=o.width-m-P,xs=o.width-(h.axisLine.show?h.axisLine.size:0)-(h.ticduty.show?h.ticduty.length:0)-C;Dt.paddingRight=_o-xs}const{paddingLeft:Zt,paddingRight:gn,paddingTop:hn,paddingBottom:qn,size:On,weight:bn,family:Fn}=Dt,Xs=Zt+Em(ve,On,bn,Fn)+gn,oo=hn+On+qn,Yn=Math.max(Xs,o.width-m-P);ue.push({desiredY:Ae,x:Ie,y:Ae,text:ve,align:It,width:Yn,height:oo,styles:{...Dt,color:E0(ot,Dt.color),backgroundColor:ot}})}}return}const ut=le;Ew(fe,{prev:L.timestamp,current:$.timestamp,next:null},a,(bt,Pt)=>{const Et=Z[bt.key];if(Ca(Et)){const Mt=I.convertToPixel(Et);let Je=I.displayValueToText(I.realValueToDisplayValue(I.valueToRealValue(Et,{range:A}),{range:A}),ut);fe.shouldFormatBigNumber&&(Je=Y.formatBigNumber(Je)),Je=ce.format(Q.format(Je));let Ct=0,Ze="left";const Xe={...c};if(I.isFromZero())Ct=m+P,Ze="left",Xe.paddingLeft=g+w-P;else{Ct=o.width-m-P,Ze="right";const gn=o.width-m-P,hn=o.width-(h.axisLine.show?h.axisLine.size:0)-(h.ticduty.show?h.ticduty.length:0)-C;Xe.paddingRight=gn-hn}const{paddingLeft:Ae,paddingRight:Qe,paddingTop:gt,paddingBottom:Ft,size:ot,weight:ve,family:Ie}=Xe,It=Ae+Em(Je,ot,ve,Ie)+Qe,Dt=gt+ot+Ft,Zt=Math.max(It,o.width-m-P);ue.push({desiredY:Mt,x:Ct,y:Mt,text:Je,align:Ze,width:Zt,height:Dt,styles:{...Xe,color:E0(Pt.color,Xe.color),backgroundColor:Pt.color}})}})}}),ue.length>0&&ue.sort((fe,pe)=>fe.desiredY-pe.desiredY).forEach(fe=>{var oe;const pe=fe.height/2,xe=fe.desiredY<-pe||fe.desiredY>o.height+pe?fe.desiredY:s.placeYAxisLabel(fe.desiredY,fe.height,o.height);xe!==null&&((oe=this.createFigure({name:"text",attrs:{x:fe.x,y:xe,text:fe.text,width:fe.width,height:fe.height,align:fe.align,baseline:"middle"},styles:fe.styles}))==null||oe.draw(e))})}}}class U3 extends Kx{getAxisLabelTextStyle(e){var a,l,c,f;const s=((l=(a=this.getWidget().getPane().getChart().getStyles().overlay)==null?void 0:a.text)==null?void 0:l.backgroundColor)||"#1677FF";let r=String(((f=(c=e.styles)==null?void 0:c.line)==null?void 0:f.color)||s||"").trim()||s;if(!r||i_(r))r=s;else if(r.startsWith("#"))r=R0(r,.7);else{const u=r.match(/^rgba?\(([^)]+)\)$/i);if(u){const d=u[1].split(",").map(h=>h.trim());if(d.length>=3){const h=Number(d[0]),m=Number(d[1]),g=Number(d[2]),w=d.length>=4&&d[3]!==""?Math.max(0,Math.min(1,Number(d[3]))):1;Number.isFinite(h)&&Number.isFinite(m)&&Number.isFinite(g)&&(r=`rgba(${h}, ${m}, ${g}, ${Math.max(.7,w)})`)}}}return{backgroundColor:r,borderColor:r,borderRadius:3,paddingLeft:6,paddingRight:6,paddingTop:3,paddingBottom:3}}coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(e,t,s){this.drawFigures(e,t,this.getDefaultFigures(t,s))}getDefaultFigures(e,t){var c;const s=this.getWidget(),o=s.getPane(),r=o.getChart().getChartStore(),a=r.getClickOverlayInfo(),l=[];if(e.needDefaultYAxisFigure&&e.id===((c=a.overlay)==null?void 0:c.id)&&a.paneId===o.getId()){const f=o.getAxisComponent(),u=s.getBounding();let d=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;const m=f.isFromZero(),g=r.getStyles().yAxis,w=g.axisLine,C=g.ticduty,P=g.tickText,I=w.show?w.size:0,A=C.show?C.length:0,M=P.marginStart,F=P.marginEnd,B=1;let $="left",L=0;m?($="left",L=I+B):($="right",L=u.width-I-B);const O=r.getDecimalFold(),Y=r.getThousandsSeparator();t.forEach((ce,Q)=>{var ue;const le=e.points[Q];if(Ca(le.value)){d=Math.min(d,ce.y),h=Math.max(h,ce.y);const fe=O.format(Y.format(Mh(le.value,((ue=r.getSymbol())==null?void 0:ue.pricePrecision)??Ah.PRICE))),pe={...this.getAxisLabelTextStyle(e)};if(m)pe.paddingLeft=Math.max(2,A+M-B);else{const ut=u.width-I-A-F;pe.paddingRight=Math.max(2,L-ut)}const{paddingLeft:Z=0,paddingRight:xe=0,paddingTop:oe=0,paddingBottom:Pe=0,size:$e=12,weight:ze="normal",family:Ke}=pe,qe=Z+Em(fe,$e,ze,Ke)+xe,nt=oe+$e+Pe,ft=Math.max(qe,u.width-I-B);l.push({type:"text",attrs:{x:L,y:ce.y,text:fe,align:$,baseline:"middle",width:ft,height:nt},styles:pe,ignoreEvent:!0})}}),t.length>1&&l.unshift({type:"rect",attrs:{x:0,y:d,width:u.width,height:h-d},ignoreEvent:!0})}return l}drawFigures(e,t,s){const o=this.getWidget().getPane().getChart().getStyles().overlay,r=this.getWidget().getBounding(),a=this.getWidget().getPane();if(a.getId()===td.X_AXIS){super.drawFigures(e,t,s);return}const l=s.flatMap(c=>{var h;if(c.type!=="text")return[c];const f=[].concat(c.attrs),u={...o.text,...(h=t.styles)==null?void 0:h.text,...c.styles};typeof u.backgroundColor=="string"&&(u.color=E0(u.backgroundColor,u.color));const d=f.map(m=>{const g=zw(m,u),w=g.y+g.height/2,C=a.placeYAxisLabel(w,g.height,r.height);return C===null?null:{...m,y:m.y+(C-w)}}).filter(Boolean);return d.length===0?[]:[{...c,attrs:Array.isArray(c.attrs)?d:d[0]}]});super.drawFigures(e,t,l)}getFigures(e,t){var f;const s=this.getWidget(),o=s.getPane(),r=o.getChart(),a=o.getAxisComponent(),l=r.getXAxisPane().getAxisComponent(),c=s.getBounding();return((f=e.createYAxisFigures)==null?void 0:f.call(e,{chart:r,overlay:e,coordinates:t,bounding:c,xAxis:l,yAxis:a}))??[]}}class G3 extends Vg{drawImp(e){var a;const t=this.getWidget(),s=t.getPane(),o=t.getPane().getChart().getChartStore(),r=o.getCrosshair();if(hd(r.paneId)&&this.compare(r,s.getId())){const l=o.getStyles().crosshair;if(l.show){const c=this.getDirectionStyles(l),f=c.text;if(c.show&&f.show){const u=t.getBounding(),d=s.getAxisComponent(),h=this.getText(r,o,d),m=o.getStyles().yAxis,g=m.axisLine.show?m.axisLine.size:0,w=m.ticduty.show?m.ticduty.length:0,C=m.tickText.marginStart,P=m.tickText.marginEnd,I=1,A=d,M={...f};if(A.isFromZero())M.paddingLeft=w+C-I;else{const F=u.width-g-I,B=u.width-(m.axisLine.show?m.axisLine.size:0)-(m.ticduty.show?m.ticduty.length:0)-P;M.paddingRight=F-B}e.font=o_(M.size,M.weight,M.family),(a=this.createFigure({name:"text",attrs:this.getTextAttrs(h,e.measureText(h).width,r,u,d,M),styles:M}))==null||a.draw(e)}}}}compare(e,t){return e.paneId===t}getDirectionStyles(e){return e.horizontal}getText(e,t,s){var d;const o=s,r=s.convertFromPixel(e.y);let a=0,l=!1;const c=((d=t.getSymbol())==null?void 0:d.pricePrecision)??Ah.PRICE;if(o.isInCandle())a=c;else{const h=t.getIndicatorsByPaneId(e.paneId);a=c,h.forEach(m=>{l||(l=m.shouldFormatBigNumber)})}const f=o.getRange();let u=o.displayValueToText(o.realValueToDisplayValue(o.valueToRealValue(r,{range:f}),{range:f}),a);return l&&(u=t.getInnerFormatter().formatBigNumber(u)),t.getDecimalFold().format(t.getThousandsSeparator().format(u))}getTextAttrs(e,t,s,o,r,a){const l=r,c=this.getWidget().getPane().getChart().getStyles(),f=c.yAxis.axisLine.show?c.yAxis.axisLine.size:0,u=1;let d=0,h="left";l.isFromZero()?(d=f+u,h="left"):(d=o.width-f-u,h="right");const{paddingLeft:m=0,paddingRight:g=0,paddingTop:w=0,paddingBottom:C=0,size:P=12}=a,I=m+t+g,A=w+P+C,M=Math.max(I,o.width-f-u);return{x:d,y:s.y,text:e,width:M,height:A,align:h,baseline:"middle"}}}class u7 extends Bw{constructor(t,s){super(t,s);Te(this,"_yAxisView",new a7(this));Te(this,"_candleLastPriceLabelView",new l7(this));Te(this,"_indicatorLastValueView",new c7(this));Te(this,"_overlayYAxisView",new U3(this));Te(this,"_crosshairHorizontalLabelView",new G3(this));this.setCursor("ns-resize"),this.addChild(this._overlayYAxisView)}getName(){return od.Y_AXIS}updateMain(t){const s=this.getPane().getOptions().state==="minimize";this.getPane().resetYAxisLabelSlots(),this._yAxisView.draw(t,s),s||(this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t)),s||this.getPane().commitYAxisLabelSlots()}updateUnderlay(t){}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this.getPane().resetYAxisOverlaySlots(),this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t))}}const f_=[1,2,2.5,5,10];function d7(n,e,t){return Math.min(Math.max(n,e),t)}function U6(n,e){if(!Number.isFinite(n)||n<=0)return 0;const t=Math.floor(Math.log10(n)),s=Math.pow(10,t),o=n/s;let r=f_[f_.length-1];if(e==="floor")for(let a=f_.length-1;a>=0;a--){const l=f_[a];if(o>=l){r=l;break}}else for(let a=0;a<f_.length;a++){const l=f_[a];if(o<=l){r=l;break}}return r*s}function f7({pixelPerValue:n,targetPx:e=60,minPx:t=45,maxPx:s=75,hysteresis:o=.15,prevInterval:r=null}){const a=Math.max(1e-12,n),l=e/a,c=Math.floor(Math.log10(l));let f=l,u=l*a,d=Number.POSITIVE_INFINITY,h=!1;for(let m=c-6;m<=c+6;m++){const g=Math.pow(10,m);for(const w of f_){const C=w*g,P=C*a;if(!Number.isFinite(P))continue;const I=P>=t&&P<=s,A=Math.abs(P-e);(I&&(!h||A<d)||!h&&A<d)&&(f=C,u=P,d=A,h=I)}}if(u<t?(f=U6(t/a,"ceil"),u=f*a):u>s&&(f=U6(s/a,"floor"),u=f*a),r&&r>0){const m=r*a,g=t*(1-o),w=s*(1+o);if(m>=g&&m<=w)return{interval:r,stepPx:d7(m,0,Number.POSITIVE_INFINITY),changed:!1}}return{interval:f,stepPx:u,changed:!0}}function G6(){return{from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0,displayFrom:0,displayTo:0,displayRange:0}}class Y3{constructor(e){Te(this,"name");Te(this,"scrollZoomEnabled",!0);Te(this,"createTicks");Te(this,"_parent");Te(this,"_range",G6());Te(this,"_prevRange",G6());Te(this,"_ticks",[]);Te(this,"_autoCalcTickFlag",!0);this._parent=e}getParent(){return this._parent}buildTicks(e){return this._autoCalcTickFlag&&(this._range=this.createRangeImp()),this._prevRange.from!==this._range.from||this._prevRange.to!==this._range.to||e?(this._prevRange=this._range,typeof performance<"u"?performance.now():Date.now(),this._ticks=this.createTicksImp(),typeof performance<"u"?performance.now():Date.now(),!0):!1}getTicks(){return this._ticks}setRange(e){this._autoCalcTickFlag=!1,this._range=e}getRange(){return this._range}setAutoCalcTickFlag(e){this._autoCalcTickFlag=e}getAutoCalcTickFlag(){return this._autoCalcTickFlag}}const ox=8,p7=.49,Y6=.01,m7=.18,h7=220,v7=.2,g7=1.2,K6=5,_7=2.6;class Z_ extends Y3{constructor(t,s){super(t);Te(this,"_gridInterval",null);Te(this,"_autoscaleRafId",null);Te(this,"_autoscaleLastTs",0);Te(this,"_autoscaleInstantOnce",!1);Te(this,"_autoscaleForceSmoothOnce",!1);Te(this,"_autoscaleEaseOverrideMs",null);Te(this,"_autoscaleEaseOverrideUntil",0);Te(this,"reverse",!1);Te(this,"inside",!1);Te(this,"position","right");Te(this,"gap",{top:.2,bottom:.1});Te(this,"createRange",t=>t.defaultRange);Te(this,"minSpan",t=>z_(-t));Te(this,"valueToRealValue",t=>t);Te(this,"realValueToDisplayValue",t=>t);Te(this,"displayValueToRealValue",t=>t);Te(this,"realValueToValue",t=>t);Te(this,"displayValueToText",(t,s)=>Mh(t,s));this.override(s)}_scheduleAutoscaleFrame(){this._autoscaleRafId===null&&this.getAutoCalcTickFlag()&&(this._autoscaleRafId=D0(()=>{if(this._autoscaleRafId=null,!this.getAutoCalcTickFlag())return;this.buildTicks(!0);const t=this.getParent();t.getChart().updatePane(Ff.All,t.getId())}))}forceAutoscaleInstant(){this._autoscaleInstantOnce=!0,this._autoscaleForceSmoothOnce=!1,this._autoscaleLastTs=0,this._autoscaleEaseOverrideMs=null,this._autoscaleEaseOverrideUntil=0,this._autoscaleRafId!==null&&(Ob(this._autoscaleRafId),this._autoscaleRafId=null)}setAutoscaleEaseOverride(t,s){if(!Number.isFinite(t)||t<=0)return;const o=typeof performance<"u"?performance.now():Date.now(),r=Number.isFinite(s)&&s>0?s:t;this._autoscaleEaseOverrideMs=t,this._autoscaleEaseOverrideUntil=o+r}forceAutoscaleSmoothOnce(){this._autoscaleForceSmoothOnce=!0}override(t){const{name:s,gap:o,...r}=t;hd(this.name)||(this.name=s),lh(this.gap,o),lh(this,r)}createRangeImp(){var Et;const t=this.getParent(),s=t.getChart(),o=s.getChartStore(),r=t.getId();let a=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,c=!1,f=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;const d=o.getIndicatorsByPaneId(r),h=this.isInCandle(),m=h?d.filter(Mt=>Mt.series!=="volume"):d,g=!h||m.length>0;let C=((Et=o.getSymbol())==null?void 0:Et.pricePrecision)??Ah.PRICE;d.forEach(Mt=>{c||(c=Mt.shouldOhlc),g&&m.includes(Mt)&&(Ca(Mt.minValue)&&(f=Math.min(f,Mt.minValue)),Ca(Mt.maxValue)&&(u=Math.max(u,Mt.maxValue)))});const P=o.getVisibleRangeDataList(),I=s.getStyles().candle,A=I.type==="area",M=I.area.value,F=h&&!A||!h&&c;P.forEach(Mt=>{const Je=Mt.data.current;if($s(Je)){if(F){const Ct=Je.low,Ze=Je.high;a=Math.min(a,Ct),l=Math.max(l,Ze)}if(h&&A){const Ct=Je[M];Ca(Ct)&&(a=Math.min(a,Ct),l=Math.max(l,Ct))}g&&m.forEach(({result:Ct,figures:Ze})=>{const Xe=Ct[Je.timestamp]??{};Ze.forEach(Ae=>{const Qe=Xe[Ae.key];Ca(Qe)&&(a=Math.min(a,Qe),l=Math.max(l,Qe))})})}}),a!==Number.MAX_SAFE_INTEGER&&l!==Number.MIN_SAFE_INTEGER?(a=Math.min(f,a),l=Math.max(u,l)):(a=0,l=10);const B=l-a,$={from:a,to:l,range:B,realFrom:a,realTo:l,realRange:B,displayFrom:a,displayTo:l,displayRange:B},L=this.createRange({chart:s,paneId:r,defaultRange:$});let O=L.realFrom,Y=L.realTo,ce=L.realRange;const Q=this.minSpan(C);if(O===Y||ce<Q){const Mt=f===O,Je=u===Y,Ct=ox/2;O=Mt?O:Je?O-ox*Q:O-Ct*Q,Y=Je?Y:Mt?Y+ox*Q:Y+Ct*Q}const le=this.getEffectiveHeight(),{top:ue,bottom:fe}=this.gap;let pe=ue;pe>=1&&(pe=pe/le);let Z=fe;Z>=1&&(Z=Z/le),ce=Y-O,O=O-ce*Z,Y=Y+ce*pe,ce=Y-O;const xe=O,oe=Y,Pe=this._autoscaleInstantOnce;Pe&&(this._autoscaleInstantOnce=!1,this._autoscaleLastTs=0);const $e=this._autoscaleForceSmoothOnce;this._autoscaleForceSmoothOnce=!1;const ze=this.getRange(),Ke=ze.realFrom,qe=ze.realTo,nt=ze.realRange;if(Number.isFinite(nt)&&nt>0&&Number.isFinite(ce)&&ce>0){const Mt=(O+Y)/2,Je=(Ke+qe)/2,Ct=Math.abs(Mt-Je),Ze=ce/nt;if(($e||Ze>=1/K6&&Ze<=K6&&Ct<=nt*_7)&&!Pe){const Ae=typeof performance<"u"?performance.now():Date.now(),Qe=this._autoscaleEaseOverrideMs!=null&&Ae<=this._autoscaleEaseOverrideUntil?this._autoscaleEaseOverrideMs:h7;this._autoscaleEaseOverrideMs!=null&&Ae>this._autoscaleEaseOverrideUntil&&(this._autoscaleEaseOverrideMs=null);const gt=this._autoscaleLastTs>0?Math.max(0,Ae-this._autoscaleLastTs):Qe;let Ft=1-Math.exp(-gt/Qe);Ft=1-Math.pow(1-Ft,3),Ft=Math.min(1,Ft*Math.max(.1,p7*2));const ot=Math.max(Q,nt*Y6),ve=nt*m7,Ie=gn=>{if(!Number.isFinite(gn)||gn<=0)return 0;if(ot<=0)return Ft;const hn=ot*v7,qn=Math.max(1e-12,ot-hn),On=gn<=hn?0:(gn-hn)/qn,bn=Math.min(1,Math.max(0,On));return Ft*bn},It=gn=>!Number.isFinite(gn)||gn<=0?0:Math.min(1,gn*g7),Dt=(gn,hn)=>{if(!Number.isFinite(gn)||gn<=0)return 0;if(!Number.isFinite(hn)||hn<=0||ve<=0)return gn;const qn=Math.min(1,hn/ve);return Math.min(1,gn+(1-gn)*qn*.5)};let Zt=!1;if(O>Ke){const gn=O-Ke,hn=It(Ie(gn));hn>0&&(O=Ke+gn*hn,Zt=hn<1)}else if(O<Ke){const gn=Ke-O,hn=Dt(Ie(gn),gn);hn>0&&(O=Ke-gn*hn,Zt=hn<1)}if(Y<qe){const gn=qe-Y,hn=It(Ie(gn));hn>0&&(Y=qe-gn*hn,Zt=Zt||hn<1)}else if(Y>qe){const gn=Y-qe,hn=Dt(Ie(gn),gn);hn>0&&(Y=qe+gn*hn,Zt=Zt||hn<1)}if(ce=Y-O,Zt){const gn=Math.max(Q,nt*Y6*.25);Math.abs(xe-O)<=gn&&Math.abs(oe-Y)<=gn?(O=xe,Y=oe,ce=Y-O,this._autoscaleLastTs=0):(this._autoscaleLastTs=Ae,this._scheduleAutoscaleFrame())}else this._autoscaleLastTs=0}else this._autoscaleLastTs=0}Number.isFinite(xe)&&Number.isFinite(oe)&&(O>xe&&(O=xe),Y<oe&&(Y=oe),ce=Y-O);const ft=this.realValueToValue(O,{range:L}),ut=this.realValueToValue(Y,{range:L}),bt=this.realValueToDisplayValue(O,{range:L}),Pt=this.realValueToDisplayValue(Y,{range:L});return{from:ft,to:ut,range:ut-ft,realFrom:O,realTo:Y,realRange:Y-O,displayFrom:bt,displayTo:Pt,displayRange:Pt-bt}}isInCandle(){return this.getParent().getId()===td.CANDLE}isFromZero(){return this.position==="left"&&this.inside||this.position==="right"&&!this.inside}createTicksImp(){var ue;const t=this.getRange(),{displayFrom:s,displayTo:o}=t,r=Math.min(s,o),a=Math.max(s,o),l=this.getParent(),c=this.getEffectiveHeight(),f=40,u=50,d=45,h=c/Math.max(1e-12,t.realRange);let g=f7({pixelPerValue:h,targetPx:d,minPx:f,maxPx:u,hysteresis:.15,prevInterval:this._gridInterval}).interval;if(this._gridInterval=g,globalThis.__SMARTCHART_GRID_DEBUG__){const fe=g*h;console.log("[grid:y]",{interval:g,stepPx:Math.round(fe*100)/100,height:c})}const w=t9(g),C=[];if(g>0){let fe=j6(Math.floor(r/g)*g,w);const pe=j6(Math.ceil(a/g)*g,w);let Z=0;const xe=Math.ceil(c/Math.max(1,f))+10;for(;fe<=pe&&Z<xe;){const oe=fe.toFixed(w);C.push({text:oe,coord:0,value:oe}),fe+=g,Z+=1}}const P=l.getChart().getChartStore(),I=[],A=P.getIndicatorsByPaneId(l.getId()),M=P.getStyles();let F=0,B=!1;const $=((ue=P.getSymbol())==null?void 0:ue.pricePrecision)??Ah.PRICE;this.isInCandle()?F=$:(F=$,A.forEach(fe=>{B||(B=fe.shouldFormatBigNumber)}));const L=P.getInnerFormatter(),O=P.getThousandsSeparator(),Y=P.getDecimalFold(),ce=M.yAxis.tickText.size,Q=Math.max(2,Math.round(ce*.35));C.forEach(({value:fe})=>{let pe=this.displayValueToText(+fe,F);const Z=this.convertToPixel(this.realValueToValue(this.displayValueToRealValue(+fe,{range:t}),{range:t}));B&&(pe=L.formatBigNumber(pe)),pe=Y.format(O.format(pe)),Z>=-Q&&Z<=c+Q&&I.push({text:pe,coord:Z,value:fe})});const le=y7({ticks:I,height:c,interval:g,shouldFormatBigNumber:B,formatter:L,thousandsSeparator:O,decimalFold:Y,displayValueToText:fe=>this.displayValueToText(fe,F),valueToRealValue:fe=>this.valueToRealValue(fe,{range:t}),realValueToDisplayValue:fe=>this.realValueToDisplayValue(fe,{range:t}),convertFromPixel:fe=>this.convertFromPixel(fe)});return eg(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:le}):le}getAutoSize(){var w,C;const t=this.getParent(),o=t.getChart().getChartStore(),r=o.getStyles(),a=r.yAxis,l=a.size;if(l!=="auto")return l;let c=0;if(a.show&&(a.axisLine.show&&(c+=a.axisLine.size),a.ticduty.show&&(c+=a.ticduty.length),a.tickText.show)){let P=0;this.getTicks().forEach(I=>{P=Math.max(P,Em(I.text,a.tickText.size,a.tickText.weight,a.tickText.family))}),c+=a.tickText.marginStart+a.tickText.marginEnd+P}const f=r.candle.priceMark,u=f.show&&f.last.show&&f.last.text.show;let d=0;const h=r.crosshair,m=h.show&&h.horizontal.show&&h.horizontal.text.show;let g=0;if(u||m){const P=((w=o.getSymbol())==null?void 0:w.pricePrecision)??Ah.PRICE,I=this.getRange().displayTo;if(u){const A=o.getDataList(),M=A[A.length-1];if($s(M)){const{paddingLeft:F,paddingRight:B,size:$,family:L,weight:O}=f.last.text;d=F+Em(Mh(M.close,P),$,O,L)+B;const Y=o.getInnerFormatter().formatExtendText;f.last.extendTexts.forEach((ce,Q)=>{const le=Y({type:"last_price",data:M,index:Q});le.length>0&&ce.show&&(d=Math.max(d,ce.paddingLeft+Em(le,ce.size,ce.weight,ce.family)+ce.paddingRight))})}}if(m){const A=o.getIndicatorsByPaneId(t.getId());let M=0,F=!1;A.forEach(O=>{M=Math.max(O.precision,M),F||(F=O.shouldFormatBigNumber)});const B=((C=o.getSymbol())==null?void 0:C.pricePrecision)??Ah.PRICE;let $=2;if(this.isInCandle()){const O=r.indicator.lastValueMark;O.show&&O.text.show?$=Math.max(M,B):$=B}else $=B;let L=Mh(I,$);F&&(L=o.getInnerFormatter().formatBigNumber(L)),L=o.getDecimalFold().format(L),g+=h.horizontal.text.paddingLeft+h.horizontal.text.paddingRight+h.horizontal.text.borderSize*2+Em(L,h.horizontal.text.size,h.horizontal.text.weight,h.horizontal.text.family)}}return Math.max(c,d,g)}getBounding(){return this.getParent().getYAxisWidget().getBounding()}convertFromPixel(t){const s=this.getEffectiveHeight(),o=this.getRange(),{realFrom:r,realRange:a}=o;if(!Number.isFinite(s)||s<=0||!Number.isFinite(a)||a===0)return this.realValueToValue(r,{range:o});const c=(this.reverse?t/s:1-t/s)*a+r;return this.realValueToValue(c,{range:o})}convertToPixel(t){const s=this.getRange(),o=this.valueToRealValue(t,{range:s}),r=this.getEffectiveHeight(),{realFrom:a,realRange:l}=s;if(!Number.isFinite(r)||r<=0||!Number.isFinite(l)||l===0)return 0;const c=(o-a)/l;return this.reverse?Math.round(c*r):Math.round((1-c)*r)}convertToNicePixel(t){const s=this.getEffectiveHeight(),o=this.convertToPixel(t);return Math.round(Math.max(s*.05,Math.min(o,s*.98)))}getEffectiveHeight(){var o,r;const t=this.getParent(),s=((o=t.getYAxisWidget())==null?void 0:o.getBounding().height)??0;return s>0?s:((r=t.getMainWidget())==null?void 0:r.getBounding().height)??0}static extend(t){class s extends Z_{constructor(r){super(r,t)}}return s}}function y7({ticks:n,height:e,interval:t,shouldFormatBigNumber:s,formatter:o,thousandsSeparator:r,decimalFold:a,displayValueToText:l,valueToRealValue:c,realValueToDisplayValue:f,convertFromPixel:u}){if(n.length<2||e<=0||!Number.isFinite(t))return n;const d=[...n].sort((M,F)=>M.coord-F.coord),h=[];for(let M=1;M<d.length;M+=1){const F=d[M].coord-d[M-1].coord;F>0&&h.push(F)}if(h.length===0)return n;h.sort((M,F)=>M-F);const m=Math.floor(h.length/2),g=h.length%2===0?(h[m-1]+h[m])/2:h[m];if(!Number.isFinite(g)||g<=0)return n;const w=new Set;d.forEach(M=>w.add(Math.round(M.coord)));const C=[],P=M=>{const F=Math.round(M);if(w.has(F)||M<0||M>e)return;const B=u(M),$=f(c(B));let L=l($);s&&(L=o.formatBigNumber(L)),L=a.format(r.format(L)),C.push({text:L,coord:M,value:$}),w.add(F)};let I=d[0].coord-g;for(;I>=0;)P(I),I-=g;let A=d[d.length-1].coord+g;for(;A<=e;)P(A),A+=g;return C.length===0?n:[...d,...C].sort((M,F)=>M.coord-F.coord)}const b7={name:"normal"},x7={name:"percentage",minSpan:()=>Math.pow(10,-2),displayValueToText:n=>`${Mh(n,2)}%`,valueToRealValue:(n,{range:e})=>(n-e.from)/e.range*e.realRange+e.realFrom,realValueToValue:(n,{range:e})=>(n-e.realFrom)/e.realRange*e.range+e.from,createRange:({chart:n,defaultRange:e})=>{const t=n.getDataList(),s=n.getVisibleRange(),o=t[s.from];if($s(o)){const{from:r,to:a,range:l}=e,c=(e.from-o.close)/o.close*100,f=(e.to-o.close)/o.close*100,u=f-c;return{from:r,to:a,range:l,realFrom:c,realTo:f,realRange:u,displayFrom:c,displayTo:f,displayRange:u}}return e}},w7={name:"logarithm",minSpan:n=>.05*z_(-n),valueToRealValue:n=>n<0?-q0(Math.abs(n)):q0(n),realValueToDisplayValue:n=>n<0?-z_(Math.abs(n)):z_(n),displayValueToRealValue:n=>n<0?-q0(Math.abs(n)):q0(n),realValueToValue:n=>n<0?-z_(Math.abs(n)):z_(n),createRange:({defaultRange:n})=>{const{from:e,to:t,range:s}=n,o=e<0?-q0(Math.abs(e)):q0(e),r=t<0?-q0(Math.abs(t)):q0(t);return{from:e,to:t,range:s,realFrom:o,realTo:r,realRange:r-o,displayFrom:e,displayTo:t,displayRange:s}}},X6={normal:Z_.extend(b7),percentage:Z_.extend(x7),logarithm:Z_.extend(w7)};function k7(n){return X6[n]??X6.normal}class K3{constructor(e,t){Te(this,"_container");Te(this,"_id");Te(this,"_chart");Te(this,"_bounding",a2());Te(this,"_originalBounding",a2());Te(this,"_visible",!0);this._chart=e,this._id=t,this._container=B0("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"}),this._container.classList.add("dutycharts-pane",`dutycharts-pane-${t}`),this._container.setAttribute("data-pane-id",t)}getContainer(){return this._container}setVisible(e){this._visible!==e&&(this._container.style.display=e?"block":"none",this._visible=e)}getVisible(){return this._visible}getId(){return this._id}getChart(){return this._chart}getBounding(){return this._bounding}setOriginalBounding(e){lh(this._originalBounding,e)}getOriginalBounding(){return this._originalBounding}update(e){this._bounding.height!==this._container.clientHeight&&(this._container.style.height=`${this._bounding.height}px`),this.updateImp(e??Ff.Drawer,this._container,this._bounding)}}class X3 extends K3{constructor(t,s,o){super(t,s);Te(this,"_mainWidget");Te(this,"_yAxisWidget",null);Te(this,"_yAxisLabelSlots",[]);Te(this,"_yAxisBaseLabelSlots",[]);Te(this,"_axis");Te(this,"_options",{id:"",minHeight:sy,dragEnabled:!0,order:0,height:F3,state:"normal",axis:{name:"normal",scrollZoomEnabled:!0}});const r=this.getContainer();this._mainWidget=this.createMainWidget(r),this._yAxisWidget=this.createYAxisWidget(r),this.setOptions(o)}setOptions(t){var a,l,c;const s=this.getId();if(s===td.CANDLE||s===td.X_AXIS){const f=(a=t.axis)==null?void 0:a.name;(!$s(this._axis)||$s(f)&&this._options.axis.name!==f)&&(this._axis=this.createAxisComponent(f??"normal"))}else $s(this._axis)||(this._axis=this.createAxisComponent("normal"));this._axis instanceof Z_&&this._axis.setAutoCalcTickFlag(!0),lh(this._options,t),this._axis.override({...this._options.axis,name:((l=t.axis)==null?void 0:l.name)??"normal"});let o=null,r="default";return this.getId()===td.X_AXIS?(o=this.getMainWidget().getContainer(),r="ew-resize"):(o=this.getYAxisWidget().getContainer(),r="ns-resize"),((c=t.axis)==null?void 0:c.scrollZoomEnabled)??!0?o.style.cursor=r:o.style.cursor="default",this}getOptions(){return this._options}getAxisComponent(){return this._axis}setBounding(t,s,o,r){lh(this.getBounding(),t);const a={};$s(t.height)&&(a.height=t.height),$s(t.top)&&(a.top=t.top),this._mainWidget.setBounding(a);const l=$s(s);return l&&this._mainWidget.setBounding(s),$s(this._yAxisWidget)&&(this._yAxisWidget.setBounding(a),this._axis.position==="left"?$s(o)&&this._yAxisWidget.setBounding({...o,left:0}):$s(r)&&(this._yAxisWidget.setBounding(r),l&&this._yAxisWidget.setBounding({left:(s.left??0)+(s.width??0)+(s.right??0)-(r.width??0)}))),this}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}resetYAxisLabelSlots(){this._yAxisLabelSlots=[],this._yAxisBaseLabelSlots=[]}commitYAxisLabelSlots(){this._yAxisBaseLabelSlots=this._yAxisLabelSlots.map(t=>({top:t.top,bottom:t.bottom}))}resetYAxisOverlaySlots(){this._yAxisLabelSlots=this._yAxisBaseLabelSlots.map(t=>({top:t.top,bottom:t.bottom}))}placeYAxisLabel(t,s,o){const r=s/2,a=r,l=o-r;if(!Number.isFinite(a)||!Number.isFinite(l)||a>l)return null;const c=2,f=this._yAxisLabelSlots.map(w=>({start:w.top-c-r,end:w.bottom+c+r})).sort((w,C)=>w.start-C.start),u=[];f.forEach(w=>{const C=Math.max(w.start,a),P=Math.min(w.end,l);if(P<=a||C>=l)return;const I=u[u.length-1];I&&C<=I.end?I.end=Math.max(I.end,P):u.push({start:C,end:P})});const d=[];let h=a;if(u.forEach(w=>{w.start>h&&d.push({start:h,end:w.start}),h=Math.max(h,w.end)}),h<l&&d.push({start:h,end:l}),d.length===0)return null;let m=null,g=Number.POSITIVE_INFINITY;return d.forEach(w=>{let C=t;C<w.start&&(C=w.start),C>w.end&&(C=w.end);const P=Math.abs(C-t);P<g&&(g=P,m=C)}),m===null?null:(this._yAxisLabelSlots.push({top:m-r,bottom:m+r}),m)}updateImp(t){var s;this._mainWidget.update(t),(s=this._yAxisWidget)==null||s.update(t)}destroy(){var t;this._mainWidget.destroy(),(t=this._yAxisWidget)==null||t.destroy()}getImage(t){const{width:s,height:o}=this.getBounding(),r=B0("canvas",{width:`${s}px`,height:`${o}px`,boxSizing:"border-box"}),a=r.getContext("2d"),l=t_(r);r.width=s*l,r.height=o*l,a.scale(l,l);const c=this._mainWidget.getBounding();if(a.drawImage(this._mainWidget.getImage(t),c.left,0,c.width,c.height),this._yAxisWidget!==null){const f=this._yAxisWidget.getBounding();a.drawImage(this._yAxisWidget.getImage(t),f.left,0,f.width,f.height)}return r}createYAxisWidget(t){return null}}class Z3 extends X3{createAxisComponent(e){const t=k7(e??"default");return new t(this)}createMainWidget(e){return new W3(e,this)}createYAxisWidget(e){return new u7(e,this)}}class S7 extends Z3{createMainWidget(e){return new r7(e,this)}}class C7 extends q3{drawImp(e,t){var f,u,d;const s=this.getWidget(),o=s.getPane(),r=s.getBounding(),a=o.getAxisComponent(),l=this.getAxisStyles(o.getChart().getStyles());if(!l.show||(l.axisLine.show&&((f=this.createFigure({name:"line",attrs:this.createAxisLine(r,l),styles:l.axisLine}))==null||f.draw(e)),t[0]))return;const c=a.getTicks();if(l.ticduty.show&&this.createTicdutys(c,r,l).forEach(m=>{var g;(g=this.createFigure({name:"line",attrs:m,styles:l.ticduty}))==null||g.draw(e)}),l.tickText.show){const h=this.createTickTexts(c,r,l),m=h.filter((w,C)=>{var P;return(P=c[C])==null?void 0:P.isYear}),g=h.filter((w,C)=>{var P;return!((P=c[C])!=null&&P.isYear)});g.length>0&&((u=this.createFigure({name:"text",attrs:g,styles:l.tickText}))==null||u.draw(e)),m.length>0&&((d=this.createFigure({name:"text",attrs:m,styles:{...l.tickText,weight:"600"}}))==null||d.draw(e))}}getAxisStyles(e){return e.xAxis}createAxisLine(e){return{coordinates:[{x:0,y:0},{x:e.width,y:0}]}}createTicdutys(e,t,s){const o=s.ticduty,r=s.axisLine.size;return e.map(a=>({coordinates:[{x:a.coord,y:0},{x:a.coord,y:r+o.length}]}))}createTickTexts(e,t,s){const o=s.tickText,r=s.axisLine.size,a=s.ticduty.length;return e.map(l=>({x:l.coord,y:r+a+o.marginStart+(l.textOffset??0),text:l.text,align:"center",baseline:"top"}))}}class I7 extends U3{constructor(){super(...arguments);Te(this,"_persistentLabelNames",new Set(["verticalStraightLine","verticalRayLine","verticalSegment"]))}coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(){return this.getWidget().getPane().getChart().getChartStore().getOverlaysByPaneId()}getProgressOverlay(){var t;return((t=this.getWidget().getPane().getChart().getChartStore().getProgressOverlayInfo())==null?void 0:t.overlay)??null}getDefaultFigures(t,s){var w;const o=[],r=this.getWidget(),l=r.getPane().getChart().getChartStore(),c=l.getClickOverlayInfo(),f=hd(t.name)?t.name:"",u=t.extendData;if((u==null?void 0:u.crossPaneRole)==="mirror")return o;const h=this._persistentLabelNames.has(f),m=h&&(u==null?void 0:u.showTimeLabel)!==!1,g=!h||(u==null?void 0:u.showTimeLabel)!==!1;if(t.needDefaultXAxisFigure&&(t.id===((w=c.overlay)==null?void 0:w.id)&&g||m)){let C=Number.MAX_SAFE_INTEGER,P=Number.MIN_SAFE_INTEGER;s.forEach((I,A)=>{var F,B;C=Math.min(C,I.x),P=Math.max(P,I.x);const M=t.points[A];if(Ca(M.timestamp)){const $=l.getInnerFormatter().formatDate(M.timestamp,"YYYY-MM-DD HH:mm","crosshair"),L=r.getBounding().height,O=this.getAxisLabelTextStyle(t),Y=((B=(F=t.styles)==null?void 0:F.text)==null?void 0:B.size)??(l.getStyles().overlay.text.size||12),ce=Math.max(0,Math.round((L-Y)/2));o.push({type:"text",attrs:{x:I.x,y:0,text:$,align:"center",baseline:"top",height:L},styles:{...O,size:Y,paddingTop:ce,paddingBottom:ce},ignoreEvent:!0})}}),s.length>1&&o.unshift({type:"rect",attrs:{x:C,y:0,width:P-C,height:r.getBounding().height},ignoreEvent:!0})}return o}getFigures(t,s){var u;const o=this.getWidget(),r=o.getPane(),a=r.getChart(),l=r.getAxisComponent(),c=a.getXAxisPane().getAxisComponent(),f=o.getBounding();return((u=t.createXAxisFigures)==null?void 0:u.call(t,{chart:a,overlay:t,coordinates:s,bounding:f,xAxis:c,yAxis:l}))??[]}}class P7 extends G3{drawImp(e){var a;const t=this.getWidget(),s=t.getPane().getChart().getChartStore(),o=s.getCrosshair(),r=s.getStyles().crosshair;if(r.show){const l=this.getDirectionStyles(r),c=l.text;if(l.show&&c.show&&this.compare(o)){const f=t.getBounding(),u=t.getPane().getAxisComponent(),d=this.getText(o,s),h=s.getStyles().xAxis.tickText,m={...c,size:h.size,family:h.family,weight:h.weight};e.font=o_(m.size,m.weight,m.family),(a=this.createFigure({name:"text",attrs:this.getTextAttrs(d,e.measureText(d).width,o,f,u,m),styles:m}))==null||a.draw(e)}}}compare(e){return $s(e.timestamp)}getDirectionStyles(e){return e.vertical}getText(e,t){var a;const s=e.timestamp,o=((a=t.getPeriod())==null?void 0:a.type)??"day";let r;switch(o){case"second":r="ddd DD MMM 'YY HH:mm:ss";break;case"minute":case"hour":r="ddd DD MMM 'YY HH:mm";break;case"day":case"week":r="ddd DD MMM 'YY";break;case"month":r="ddd DD MMM 'YY";break;case"year":r="YYYY";break;default:r=H3[o];break}return t.getInnerFormatter().formatDate(s,r,"crosshair")}getTextAttrs(e,t,s,o,r,a){const c=this.getWidget().getPane().getChart().getStyles().xAxis,f=c.axisLine.size,u=c.ticduty.length,d=f+u+c.tickText.marginStart-(a.paddingTop??0),h=s.realX;let m=0,g="center";return h-t/2-a.paddingLeft<0?(m=0,g="left"):h+t/2+a.paddingRight>o.width?(m=o.width,g="right"):m=h,{x:m,y:d,text:e,align:g,baseline:"top"}}}class M7 extends Bw{constructor(t,s){super(t,s);Te(this,"_xAxisView",new C7(this));Te(this,"_overlayXAxisView",new I7(this));Te(this,"_crosshairVerticalLabelView",new P7(this));this.setCursor("ew-resize"),this.addChild(this._overlayXAxisView)}getName(){return od.X_AXIS}updateMain(t){this._xAxisView.draw(t)}updateUnderlay(t){}updateOverlay(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)}}var L0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yy(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var J3={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(L0,function(){var t=1e3,s=6e4,o=36e5,r="millisecond",a="second",l="minute",c="hour",f="day",u="week",d="month",h="quarter",m="year",g="date",w="Invalid Date",C=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,P=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,I={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(ue){var fe=["th","st","nd","rd"],pe=ue%100;return"["+ue+(fe[(pe-20)%10]||fe[pe]||fe[0])+"]"}},A=function(ue,fe,pe){var Z=String(ue);return!Z||Z.length>=fe?ue:""+Array(fe+1-Z.length).join(pe)+ue},M={s:A,z:function(ue){var fe=-ue.utcOffset(),pe=Math.abs(fe),Z=Math.floor(pe/60),xe=pe%60;return(fe<=0?"+":"-")+A(Z,2,"0")+":"+A(xe,2,"0")},m:function ue(fe,pe){if(fe.date()<pe.date())return-ue(pe,fe);var Z=12*(pe.year()-fe.year())+(pe.month()-fe.month()),xe=fe.clone().add(Z,d),oe=pe-xe<0,Pe=fe.clone().add(Z+(oe?-1:1),d);return+(-(Z+(pe-xe)/(oe?xe-Pe:Pe-xe))||0)},a:function(ue){return ue<0?Math.ceil(ue)||0:Math.floor(ue)},p:function(ue){return{M:d,y:m,w:u,d:f,D:g,h:c,m:l,s:a,ms:r,Q:h}[ue]||String(ue||"").toLowerCase().replace(/s$/,"")},u:function(ue){return ue===void 0}},F="en",B={};B[F]=I;var $="$isDayjsObject",L=function(ue){return ue instanceof Q||!(!ue||!ue[$])},O=function ue(fe,pe,Z){var xe;if(!fe)return F;if(typeof fe=="string"){var oe=fe.toLowerCase();B[oe]&&(xe=oe),pe&&(B[oe]=pe,xe=oe);var Pe=fe.split("-");if(!xe&&Pe.length>1)return ue(Pe[0])}else{var $e=fe.name;B[$e]=fe,xe=$e}return!Z&&xe&&(F=xe),xe||!Z&&F},Y=function(ue,fe){if(L(ue))return ue.clone();var pe=typeof fe=="object"?fe:{};return pe.date=ue,pe.args=arguments,new Q(pe)},ce=M;ce.l=O,ce.i=L,ce.w=function(ue,fe){return Y(ue,{locale:fe.$L,utc:fe.$u,x:fe.$x,$offset:fe.$offset})};var Q=function(){function ue(pe){this.$L=O(pe.locale,null,!0),this.parse(pe),this.$x=this.$x||pe.x||{},this[$]=!0}var fe=ue.prototype;return fe.parse=function(pe){this.$d=function(Z){var xe=Z.date,oe=Z.utc;if(xe===null)return new Date(NaN);if(ce.u(xe))return new Date;if(xe instanceof Date)return new Date(xe);if(typeof xe=="string"&&!/Z$/i.test(xe)){var Pe=xe.match(C);if(Pe){var $e=Pe[2]-1||0,ze=(Pe[7]||"0").substring(0,3);return oe?new Date(Date.UTC(Pe[1],$e,Pe[3]||1,Pe[4]||0,Pe[5]||0,Pe[6]||0,ze)):new Date(Pe[1],$e,Pe[3]||1,Pe[4]||0,Pe[5]||0,Pe[6]||0,ze)}}return new Date(xe)}(pe),this.init()},fe.init=function(){var pe=this.$d;this.$y=pe.getFullYear(),this.$M=pe.getMonth(),this.$D=pe.getDate(),this.$W=pe.getDay(),this.$H=pe.getHours(),this.$m=pe.getMinutes(),this.$s=pe.getSeconds(),this.$ms=pe.getMilliseconds()},fe.$utils=function(){return ce},fe.isValid=function(){return this.$d.toString()!==w},fe.isSame=function(pe,Z){var xe=Y(pe);return this.startOf(Z)<=xe&&xe<=this.endOf(Z)},fe.isAfter=function(pe,Z){return Y(pe)<this.startOf(Z)},fe.isBefore=function(pe,Z){return this.endOf(Z)<Y(pe)},fe.$g=function(pe,Z,xe){return ce.u(pe)?this[Z]:this.set(xe,pe)},fe.unix=function(){return Math.floor(this.valueOf()/1e3)},fe.valueOf=function(){return this.$d.getTime()},fe.startOf=function(pe,Z){var xe=this,oe=!!ce.u(Z)||Z,Pe=ce.p(pe),$e=function(Pt,Et){var Mt=ce.w(xe.$u?Date.UTC(xe.$y,Et,Pt):new Date(xe.$y,Et,Pt),xe);return oe?Mt:Mt.endOf(f)},ze=function(Pt,Et){return ce.w(xe.toDate()[Pt].apply(xe.toDate("s"),(oe?[0,0,0,0]:[23,59,59,999]).slice(Et)),xe)},Ke=this.$W,qe=this.$M,nt=this.$D,ft="set"+(this.$u?"UTC":"");switch(Pe){case m:return oe?$e(1,0):$e(31,11);case d:return oe?$e(1,qe):$e(0,qe+1);case u:var ut=this.$locale().weekStart||0,bt=(Ke<ut?Ke+7:Ke)-ut;return $e(oe?nt-bt:nt+(6-bt),qe);case f:case g:return ze(ft+"Hours",0);case c:return ze(ft+"Minutes",1);case l:return ze(ft+"Seconds",2);case a:return ze(ft+"Milliseconds",3);default:return this.clone()}},fe.endOf=function(pe){return this.startOf(pe,!1)},fe.$set=function(pe,Z){var xe,oe=ce.p(pe),Pe="set"+(this.$u?"UTC":""),$e=(xe={},xe[f]=Pe+"Date",xe[g]=Pe+"Date",xe[d]=Pe+"Month",xe[m]=Pe+"FullYear",xe[c]=Pe+"Hours",xe[l]=Pe+"Minutes",xe[a]=Pe+"Seconds",xe[r]=Pe+"Milliseconds",xe)[oe],ze=oe===f?this.$D+(Z-this.$W):Z;if(oe===d||oe===m){var Ke=this.clone().set(g,1);Ke.$d[$e](ze),Ke.init(),this.$d=Ke.set(g,Math.min(this.$D,Ke.daysInMonth())).$d}else $e&&this.$d[$e](ze);return this.init(),this},fe.set=function(pe,Z){return this.clone().$set(pe,Z)},fe.get=function(pe){return this[ce.p(pe)]()},fe.add=function(pe,Z){var xe,oe=this;pe=Number(pe);var Pe=ce.p(Z),$e=function(qe){var nt=Y(oe);return ce.w(nt.date(nt.date()+Math.round(qe*pe)),oe)};if(Pe===d)return this.set(d,this.$M+pe);if(Pe===m)return this.set(m,this.$y+pe);if(Pe===f)return $e(1);if(Pe===u)return $e(7);var ze=(xe={},xe[l]=s,xe[c]=o,xe[a]=t,xe)[Pe]||1,Ke=this.$d.getTime()+pe*ze;return ce.w(Ke,this)},fe.subtract=function(pe,Z){return this.add(-1*pe,Z)},fe.format=function(pe){var Z=this,xe=this.$locale();if(!this.isValid())return xe.invalidDate||w;var oe=pe||"YYYY-MM-DDTHH:mm:ssZ",Pe=ce.z(this),$e=this.$H,ze=this.$m,Ke=this.$M,qe=xe.weekdays,nt=xe.months,ft=xe.meridiem,ut=function(Et,Mt,Je,Ct){return Et&&(Et[Mt]||Et(Z,oe))||Je[Mt].slice(0,Ct)},bt=function(Et){return ce.s($e%12||12,Et,"0")},Pt=ft||function(Et,Mt,Je){var Ct=Et<12?"AM":"PM";return Je?Ct.toLowerCase():Ct};return oe.replace(P,function(Et,Mt){return Mt||function(Je){switch(Je){case"YY":return String(Z.$y).slice(-2);case"YYYY":return ce.s(Z.$y,4,"0");case"M":return Ke+1;case"MM":return ce.s(Ke+1,2,"0");case"MMM":return ut(xe.monthsShort,Ke,nt,3);case"MMMM":return ut(nt,Ke);case"D":return Z.$D;case"DD":return ce.s(Z.$D,2,"0");case"d":return String(Z.$W);case"dd":return ut(xe.weekdaysMin,Z.$W,qe,2);case"ddd":return ut(xe.weekdaysShort,Z.$W,qe,3);case"dddd":return qe[Z.$W];case"H":return String($e);case"HH":return ce.s($e,2,"0");case"h":return bt(1);case"hh":return bt(2);case"a":return Pt($e,ze,!0);case"A":return Pt($e,ze,!1);case"m":return String(ze);case"mm":return ce.s(ze,2,"0");case"s":return String(Z.$s);case"ss":return ce.s(Z.$s,2,"0");case"SSS":return ce.s(Z.$ms,3,"0");case"Z":return Pe}return null}(Et)||Pe.replace(":","")})},fe.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},fe.diff=function(pe,Z,xe){var oe,Pe=this,$e=ce.p(Z),ze=Y(pe),Ke=(ze.utcOffset()-this.utcOffset())*s,qe=this-ze,nt=function(){return ce.m(Pe,ze)};switch($e){case m:oe=nt()/12;break;case d:oe=nt();break;case h:oe=nt()/3;break;case u:oe=(qe-Ke)/6048e5;break;case f:oe=(qe-Ke)/864e5;break;case c:oe=qe/o;break;case l:oe=qe/s;break;case a:oe=qe/t;break;default:oe=qe}return xe?oe:ce.a(oe)},fe.daysInMonth=function(){return this.endOf(d).$D},fe.$locale=function(){return B[this.$L]},fe.locale=function(pe,Z){if(!pe)return this.$L;var xe=this.clone(),oe=O(pe,Z,!0);return oe&&(xe.$L=oe),xe},fe.clone=function(){return ce.w(this.$d,this)},fe.toDate=function(){return new Date(this.valueOf())},fe.toJSON=function(){return this.isValid()?this.toISOString():null},fe.toISOString=function(){return this.$d.toISOString()},fe.toString=function(){return this.$d.toUTCString()},ue}(),le=Q.prototype;return Y.prototype=le,[["$ms",r],["$s",a],["$m",l],["$H",c],["$W",f],["$M",d],["$y",m],["$D",g]].forEach(function(ue){le[ue[1]]=function(fe){return this.$g(fe,ue[0],ue[1])}}),Y.extend=function(ue,fe){return ue.$i||(ue(fe,Q,Y),ue.$i=!0),Y},Y.locale=O,Y.isDayjs=L,Y.unix=function(ue){return Y(1e3*ue)},Y.en=B[F],Y.Ls=B,Y.p={},Y})})(J3);var N7=J3.exports;const yp=yy(N7);var Q3={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(L0,function(){var t="minute",s=/[+-]\d\d(?::?\d\d)?/g,o=/([+-]|\d\d)/g;return function(r,a,l){var c=a.prototype;l.utc=function(w){var C={date:w,utc:!0,args:arguments};return new a(C)},c.utc=function(w){var C=l(this.toDate(),{locale:this.$L,utc:!0});return w?C.add(this.utcOffset(),t):C},c.local=function(){return l(this.toDate(),{locale:this.$L,utc:!1})};var f=c.parse;c.parse=function(w){w.utc&&(this.$u=!0),this.$utils().u(w.$offset)||(this.$offset=w.$offset),f.call(this,w)};var u=c.init;c.init=function(){if(this.$u){var w=this.$d;this.$y=w.getUTCFullYear(),this.$M=w.getUTCMonth(),this.$D=w.getUTCDate(),this.$W=w.getUTCDay(),this.$H=w.getUTCHours(),this.$m=w.getUTCMinutes(),this.$s=w.getUTCSeconds(),this.$ms=w.getUTCMilliseconds()}else u.call(this)};var d=c.utcOffset;c.utcOffset=function(w,C){var P=this.$utils().u;if(P(w))return this.$u?0:P(this.$offset)?d.call(this):this.$offset;if(typeof w=="string"&&(w=function(F){F===void 0&&(F="");var B=F.match(s);if(!B)return null;var $=(""+B[0]).match(o)||["-",0,0],L=$[0],O=60*+$[1]+ +$[2];return O===0?0:L==="+"?O:-O}(w),w===null))return this;var I=Math.abs(w)<=16?60*w:w,A=this;if(C)return A.$offset=I,A.$u=w===0,A;if(w!==0){var M=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(A=this.local().add(I+M,t)).$offset=I,A.$x.$localOffset=M}else A=this.utc();return A};var h=c.format;c.format=function(w){var C=w||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return h.call(this,C)},c.valueOf=function(){var w=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*w},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var m=c.toDate;c.toDate=function(w){return w==="s"&&this.$offset?l(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():m.call(this)};var g=c.diff;c.diff=function(w,C,P){if(w&&this.$u===w.$u)return g.call(this,w,C,P);var I=this.local(),A=l(w).local();return g.call(I,A,C,P)}}})})(Q3);var A7=Q3.exports;const Ww=yy(A7);var e4={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(L0,function(){var t={year:0,month:1,day:2,hour:3,minute:4,second:5},s={};return function(o,r,a){var l,c=function(h,m,g){g===void 0&&(g={});var w=new Date(h),C=function(P,I){I===void 0&&(I={});var A=I.timeZoneName||"short",M=P+"|"+A,F=s[M];return F||(F=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:P,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:A}),s[M]=F),F}(m,g);return C.formatToParts(w)},f=function(h,m){for(var g=c(h,m),w=[],C=0;C<g.length;C+=1){var P=g[C],I=P.type,A=P.value,M=t[I];M>=0&&(w[M]=parseInt(A,10))}var F=w[3],B=F===24?0:F,$=w[0]+"-"+w[1]+"-"+w[2]+" "+B+":"+w[4]+":"+w[5]+":000",L=+h;return(a.utc($).valueOf()-(L-=L%1e3))/6e4},u=r.prototype;u.tz=function(h,m){h===void 0&&(h=l);var g,w=this.utcOffset(),C=this.toDate(),P=C.toLocaleString("en-US",{timeZone:h}),I=Math.round((C-new Date(P))/1e3/60),A=15*-Math.round(C.getTimezoneOffset()/15)-I;if(!Number(A))g=this.utcOffset(0,m);else if(g=a(P,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(A,!0),m){var M=g.utcOffset();g=g.add(w-M,"minute")}return g.$x.$timezone=h,g},u.offsetName=function(h){var m=this.$x.$timezone||a.tz.guess(),g=c(this.valueOf(),m,{timeZoneName:h}).find(function(w){return w.type.toLowerCase()==="timezonename"});return g&&g.value};var d=u.startOf;u.startOf=function(h,m){if(!this.$x||!this.$x.$timezone)return d.call(this,h,m);var g=a(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return d.call(g,h,m).tz(this.$x.$timezone,!0)},a.tz=function(h,m,g){var w=g&&m,C=g||m||l,P=f(+a(),C);if(typeof h!="string")return a(h).tz(C);var I=function(B,$,L){var O=B-60*$*1e3,Y=f(O,L);if($===Y)return[O,$];var ce=f(O-=60*(Y-$)*1e3,L);return Y===ce?[O,Y]:[B-60*Math.min(Y,ce)*1e3,Math.max(Y,ce)]}(a.utc(h,w).valueOf(),P,C),A=I[0],M=I[1],F=a(A).utcOffset(M);return F.$x.$timezone=C,F},a.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},a.tz.setDefault=function(h){l=h}}})})(e4);var T7=e4.exports;const Hw=yy(T7);yp.extend(Ww);yp.extend(Hw);const l2=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c2=["minute","hour","day","month","year"],Xx={minute:60*1e3,hour:60*60*1e3,day:24*60*60*1e3,month:30*24*60*60*1e3,year:365*24*60*60*1e3},Z6={minute:[1,2,5,10,15,30],hour:[1,2,3,4,6,8,12],day:[1],month:[1],year:[1]},lb={year:"2024",month:"Sep",day:"30",time:"00:00"};function Y1(n){const e=c2.indexOf(n);return e===-1?0:e}function F7(n){return c2.includes(n)?n:"minute"}function L7(n){switch(n){case"hour":return"hour";case"day":case"week":return"day";case"month":return"month";case"year":return"year";case"minute":case"second":default:return"minute"}}function t4(n){const e=Number((n==null?void 0:n.size)??12);return Math.max(6,Math.round(e*.45))}function E7(n,e){const t=n(lb.year,e),s=n(lb.month,e),o=n(lb.day,e),r=n(lb.time,e),a=t4(e);return{padding:a,minLabelPxByUnit:{minute:r+a,hour:r+a,day:Math.max(o,s,t)+a,month:Math.max(s,t)+a,year:t+a}}}function $7(n,e,t,s){const o=s.targetPx,r=s.minPx,a=s.maxPx,l=Y1(e);let c=null;for(let d=l;d<c2.length;d++){const h=c2[d],m=Z6[h],g=Xx[h],w=Math.max(t[h],r);let C=null,P=Number.POSITIVE_INFINITY,I=!1;if(m.forEach(A=>{const M=g*A*n;if(M<w)return;const F=M>=r&&M<=a,B=Math.abs(M-o);(F&&(!I||B<P)||!I&&B<P)&&(C=A,P=B,I=F)}),C!==null){if(I)return{unit:h,step:C,minLabelPx:w};c||(c={unit:h,step:C,minLabelPx:w})}}if(c)return c;const f="year",u=Z6[f];return{unit:f,step:u[u.length-1],minLabelPx:Math.max(t[f],r)}}function D7(n,e,t,s,o,r){if(!n)return e;const a=Y1(o);if(Y1(n.unit)<a)return e;const l=r.hysteresis,c=n.unit,f=e.unit,u=Xx[c]*n.step*t,d=Xx[f]*e.step*t,h=Math.max(s[c],r.minPx),m=Math.max(s[f],r.minPx),g=Y1(c),w=Y1(f),C=r.minPx,P=r.maxPx,I=u>=C*(1-l)&&u<=P*(1+l);if(w>g){if(u>=h*(1-l)&&I)return{...n,minLabelPx:h}}else if(w<g){if(d<m*(1+l)&&I)return{...n,minLabelPx:h}}else if(e.step!==n.step&&u>=Math.max(h,C)*(1-l)&&u<=Math.max(h,C)*(1+l))return{...n,minLabelPx:h};return e}function J6(n){const e=n.date(),t=n.month();return e===1?t===0?String(n.year()):l2[t]:String(e)}function R7(n,e){switch(e){case"year":return{text:String(n.year()),isMajor:!0,isYear:!0};case"month":return n.month()===0?{text:String(n.year()),isMajor:!0,isYear:!0}:{text:l2[n.month()],isMajor:!1,isYear:!1};case"day":{const t=n.date();return t===1?n.month()===0?{text:String(n.year()),isMajor:!0,isYear:!0}:{text:J6(n),isMajor:!0,isYear:!1}:{text:String(t),isMajor:!1,isYear:!1}}case"hour":case"minute":return n.hour()===0&&n.minute()===0?n.date()===1&&n.month()===0?{text:String(n.year()),isMajor:!0,isYear:!0}:{text:J6(n),isMajor:!0,isYear:!1}:{text:n.format("HH:mm"),isMajor:!1,isYear:!1};default:return{text:"",isMajor:!1,isYear:!1}}}function j7(n,e,t,s){if(s&&e.isYearBoundary)return{text:String(n.year()),isMajor:!0,isYear:!0,labelType:"year"};if(s&&e.isMonthBoundary)return{text:l2[n.month()],isMajor:!0,isYear:!1,labelType:"month"};if(s&&e.isDayBoundary&&(t.unit==="hour"||t.unit==="minute"))return{text:String(n.date()),isMajor:!0,isYear:!1,labelType:"day"};if(s&&t.unit==="year"&&!e.isYearBoundary)return{text:l2[n.month()],isMajor:!1,isYear:!1,labelType:"fallback-month"};if(s&&t.unit==="month"&&!e.isMonthBoundary)return{text:String(n.date()),isMajor:!1,isYear:!1,labelType:"fallback-day"};const o=R7(n,t.unit);return o.text?{text:o.text,isMajor:o.isMajor,isYear:o.isYear,labelType:t.unit}:{text:"",isMajor:!1,isYear:!1,labelType:""}}function B7(n,e,t){return Number.isFinite(n)?n<-t||n>e+t:!0}function O7({from:n,to:e,width:t,textStyles:s,measureText:o,minUnit:r,prevState:a,gridTargetPx:l=60,gridMinPx:c=45,gridMaxPx:f=75,gridHysteresis:u=.15,pxPerMsOverride:d}){if(!Number.isFinite(n)||!Number.isFinite(e)||!Number.isFinite(t)||t<=0)return{state:a??null,padding:0,pxPerMs:0};const h=Math.min(n,e),m=Math.max(n,e),g=Math.max(1,m-h),w=Number.isFinite(d)?d:t/g,C=F7(r??"minute"),{padding:P,minLabelPxByUnit:I}=E7(o,s),A={targetPx:l,minPx:c,maxPx:f,hysteresis:u},M=$7(w,C,I,A);return{state:D7(a,M,w,I,C,A),padding:P,pxPerMs:w}}function z7({ticks:n,timezone:e,width:t,textStyles:s,measureText:o,state:r,paddingOverride:a}){if(!r||!Array.isArray(n)||n.length===0)return n;const l=e||yp.tz.guess(),c=typeof a=="number"?a:t4(s);n.sort((u,d)=>u.coord-d.coord),n.forEach(u=>{u.text="",u.textOffset=0,u.isMajor=!1,u.isYear=!1});let f=n.some(u=>u.isYearBoundary||u.isMonthBoundary||u.isDayBoundary);if(!f){n.forEach(d=>{d.isYearBoundary=!1,d.isMonthBoundary=!1,d.isDayBoundary=!1});let u=null;n.forEach(d=>{const h=d.value;if(!Number.isFinite(h))return;const m=yp.tz(h,l),g={year:m.year(),month:m.month(),day:m.date()};u&&(g.year!==u.year?(d.isYearBoundary=!0,d.isMonthBoundary=!0,d.isDayBoundary=!0):g.month!==u.month?(d.isMonthBoundary=!0,d.isDayBoundary=!0):g.day!==u.day&&(d.isDayBoundary=!0)),u=g}),f=n.some(d=>d.isYearBoundary||d.isMonthBoundary||d.isDayBoundary)}return n.forEach(u=>{const d=u.value;if(!Number.isFinite(d)||B7(u.coord,t,c))return;const h=yp.tz(d,l),m=j7(h,u,r,f);m.text&&(u.text=m.text,u.textOffset=0,u.isMajor=m.isMajor,u.isYear=m.isYear)}),n}class qw extends Y3{constructor(t,s){super(t);Te(this,"_timeAxisState",null);this.override(s)}override(t){const{name:s,scrollZoomEnabled:o,createTicks:r}=t;hd(this.name)||(this.name=s),this.scrollZoomEnabled=o??this.scrollZoomEnabled,this.createTicks=r??this.createTicks}createRangeImp(){const s=this.getParent().getChart().getChartStore().getVisibleRange(),{realFrom:o,realTo:r}=s,a=o,l=r,c=r-o+1;return{from:a,to:l,range:c,realFrom:a,realTo:l,realRange:c,displayFrom:a,displayTo:l,displayRange:c}}createTicksImp(){const{realFrom:t,realTo:s}=this.getRange(),o=this.getParent().getChart().getChartStore(),r=o.getPeriod(),a=o.getStyles().xAxis.tickText,l=this.getBounding().width,c=o.dataIndexToTimestamp(t),f=o.dataIndexToTimestamp(s);if(!Ca(c)||!Ca(f)||l<=0)return[];const u=o.getBarSpace().bar,d=V7(r),h=Ca(d)&&d>0?u/d:void 0,m=L7(r==null?void 0:r.type),g=60,w=50,C=140,I=O7({from:c,to:f,width:l,textStyles:a,minUnit:m,prevState:this._timeAxisState,gridTargetPx:g,gridMinPx:w,gridMaxPx:C,gridHysteresis:.15,pxPerMsOverride:h,measureText:F=>Em(F,a.size,a.weight,a.family)});this._timeAxisState=I.state;const A=[],M=o.getDateTimeFormat();return W7({ticks:A,barSpace:u,chartStore:o,dateTimeFormat:M,state:I.state,width:l,fromTimestamp:c,toTimestamp:f,gridMinPx:w,gridMaxPx:C}),U7({ticks:A,chartStore:o,barSpace:u,width:l,minSpacingPx:Math.max(50,w),gapThresholdPx:Math.max(90,w*1.6),targetSpacingPx:Math.max(60,g)}),z7({ticks:A,timezone:o.getTimezone(),width:l,textStyles:a,measureText:F=>Em(F,a.size,a.weight,a.family),state:I.state,paddingOverride:I.padding}),eg(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:A}):A}getAutoSize(){const t=this.getParent().getChart().getStyles(),s=t.xAxis,o=s.size;if(o!=="auto")return o;const r=t.crosshair;let a=0;s.show&&(s.axisLine.show&&(a+=s.axisLine.size),s.ticduty.show&&(a+=s.ticduty.length),s.tickText.show&&(a+=s.tickText.marginStart+s.tickText.marginEnd+s.tickText.size));let l=0;return r.show&&r.vertical.show&&r.vertical.text.show&&(l+=r.vertical.text.paddingTop+r.vertical.text.paddingBottom+r.vertical.text.borderSize*2+r.vertical.text.size),Math.max(a,l)}getBounding(){return this.getParent().getMainWidget().getBounding()}convertTimestampFromPixel(t){const s=this.getParent().getChart().getChartStore(),o=s.coordinateToDataIndex(t);return s.dataIndexToTimestamp(o)}convertTimestampToPixel(t){const s=this.getParent().getChart().getChartStore(),o=s.timestampToDataIndex(t);return s.dataIndexToCoordinate(o)}convertFromPixel(t){return this.getParent().getChart().getChartStore().coordinateToDataIndex(t)}convertToPixel(t){return this.getParent().getChart().getChartStore().dataIndexToCoordinate(t)}static extend(t){class s extends qw{constructor(r){super(r,t)}}return s}}function V7(n){if(!n||!Ca(n.span))return 0;const e=n.span;switch(n.type){case"second":return e*1e3;case"minute":return e*60*1e3;case"hour":return e*60*60*1e3;case"day":return e*24*60*60*1e3;case"week":return e*7*24*60*60*1e3;case"month":return e*30*24*60*60*1e3;case"year":return e*365*24*60*60*1e3;default:return 0}}function Q6(n,e){const t=x3(e,n),s=Number(t.YYYY),o=Number(t.MM),r=Number(t.DD);return{year:Number.isFinite(s)?s:0,month:Number.isFinite(o)?o:0,day:Number.isFinite(r)?r:0}}function Uw(n,e,t){const s=n.getDataByDataIndex(e);if(!s||!Ca(s.timestamp))return null;const o=Q6(s.timestamp,t),r=n.getDataByDataIndex(e-1);let a=!1,l=!1,c=!1;if(r&&Ca(r.timestamp)){const f=Q6(r.timestamp,t);o.year!==f.year?(a=!0,l=!0,c=!0):o.month!==f.month?(l=!0,c=!0):o.day!==f.day&&(c=!0)}else a=!0,l=!0,c=!0;return{timestamp:s.timestamp,isYearBoundary:a,isMonthBoundary:l,isDayBoundary:c}}yp.extend(Ww);yp.extend(Hw);function W7({ticks:n,barSpace:e,chartStore:t,dateTimeFormat:s,state:o,width:r,fromTimestamp:a,toTimestamp:l,gridMinPx:c,gridMaxPx:f}){var O,Y,ce;if(!o)return;const u=t.getDataList();if(!Array.isArray(u)||u.length===0)return;const d=(O=u[0])==null?void 0:O.timestamp,h=(Y=u[u.length-1])==null?void 0:Y.timestamp,m=Math.min(a,l),g=Math.max(a,l);if(!Number.isFinite(m)||!Number.isFinite(g)||m>g)return;const w=o.unit,C=o.step,P=t.getTimezone()||yp.tz.guess();let I=Y7(yp.tz(m,P),w,C);const A=yp.tz(g,P).add(C,w).valueOf(),M=Math.max(50,c),F=Math.max(r,e);let B=null,$=null,L=-1;for(;I.valueOf()<=A;){const Q=I.valueOf(),le=s4({boundaryTs:Q,dataList:u,firstTs:d,lastTs:h,chartStore:t});if(le){const ue=le.index;if(B===null||ue!==B){const fe=t.dataIndexToCoordinate(ue);if(fe>=-F&&fe<=r+F){const pe=le.fromData?Uw(t,ue,s):n4(Q,w,P),Z=t.dataIndexToTimestamp(ue)??((ce=u[ue])==null?void 0:ce.timestamp);if(Ca(Z)){const xe=H7(pe),oe=$===null||Math.abs(fe-$)>=M;!oe&&xe>L?(n.pop(),n.push({coord:fe,value:Z,text:"",isYearBoundary:(pe==null?void 0:pe.isYearBoundary)??!1,isMonthBoundary:(pe==null?void 0:pe.isMonthBoundary)??!1,isDayBoundary:(pe==null?void 0:pe.isDayBoundary)??!1,dataIndex:ue}),B=ue,$=fe,L=xe):oe&&(n.push({coord:fe,value:Z,text:"",isYearBoundary:(pe==null?void 0:pe.isYearBoundary)??!1,isMonthBoundary:(pe==null?void 0:pe.isMonthBoundary)??!1,isDayBoundary:(pe==null?void 0:pe.isDayBoundary)??!1,dataIndex:ue}),B=ue,$=fe,L=xe)}}}}I=I.add(C,w)}q7({ticks:n,primaryUnit:w,chartStore:t,dateTimeFormat:s,timezoneId:P,dataList:u,firstTs:d,lastTs:h,barSpace:e,width:r,minSpacingPx:Math.max(50,c),maxGapPx:Math.max(f,120)})}function H7(n){return n?n.isYearBoundary?3:n.isMonthBoundary?2:n.isDayBoundary?1:0:0}function n4(n,e,t){const s=yp.tz(n,t),o=s.hour()===0&&s.minute()===0;let r=e==="day",a=e==="month",l=e==="year";return(e==="hour"||e==="minute")&&(r=o),r&&s.date()===1&&(a=!0),a&&s.month()===0&&(l=!0),e==="month"&&(r=!0),e==="year"&&(a=!0,r=!0),{isYearBoundary:l,isMonthBoundary:a,isDayBoundary:r}}function q7({ticks:n,primaryUnit:e,chartStore:t,dateTimeFormat:s,timezoneId:o,dataList:r,firstTs:a,lastTs:l,barSpace:c,width:f,minSpacingPx:u,maxGapPx:d}){var C;const h=e==="year"?"month":e==="month"?"day":null;if(!h||n.length<2)return;const m=[...n].sort((P,I)=>P.coord-I.coord),g=new Set;m.forEach(P=>{Number.isFinite(P.dataIndex)&&g.add(P.dataIndex)});const w=[];for(let P=0;P<m.length-1;P+=1){const I=m[P],A=m[P+1];if(!Number.isFinite(I.value)||!Number.isFinite(A.value))continue;const M=A.coord-I.coord;if(M<=d)continue;const F=yp.tz(I.value,o).startOf(h),B=yp.tz(A.value,o).startOf(h),$=B.diff(F,h);if($<=1)continue;const L=M/$,O=Math.max(1,Math.ceil(u/L));let Y=F.add(O,h),ce=I.coord;for(;Y.isBefore(B);){const Q=Y.valueOf(),le=s4({boundaryTs:Q,dataList:r,firstTs:a,lastTs:l,chartStore:t});if(!le||g.has(le.index)){Y=Y.add(O,h);continue}const ue=le.index,fe=t.dataIndexToCoordinate(ue);if(fe<-c||fe>f+c){Y=Y.add(O,h);continue}if(fe-ce<u||A.coord-fe<u){Y=Y.add(O,h);continue}const pe=le.fromData?Uw(t,ue,s):n4(Q,h,o),Z=t.dataIndexToTimestamp(ue)??((C=r[ue])==null?void 0:C.timestamp);Ca(Z)&&(w.push({coord:fe,value:Z,text:"",isYearBoundary:(pe==null?void 0:pe.isYearBoundary)??!1,isMonthBoundary:(pe==null?void 0:pe.isMonthBoundary)??!1,isDayBoundary:(pe==null?void 0:pe.isDayBoundary)??!1,dataIndex:ue}),g.add(ue),ce=fe),Y=Y.add(O,h)}}w.length>0&&n.push(...w)}function U7({ticks:n,chartStore:e,barSpace:t,width:s,minSpacingPx:o,gapThresholdPx:r,targetSpacingPx:a}){if(n.length<2)return;const l=[...n].sort((u,d)=>u.coord-d.coord),c=new Set;l.forEach(u=>{Number.isFinite(u.dataIndex)&&c.add(u.dataIndex)});const f=[];for(let u=0;u<l.length-1;u+=1){const d=l[u],m=l[u+1].coord-d.coord;if(!Number.isFinite(m)||m<=r)continue;let g=Math.max(2,Math.round(m/a)),w=m/g;if(w<o){if(g=Math.floor(m/o),g<2)continue;w=m/g}for(let C=1;C<g;C+=1){const P=d.coord+w*C;if(P<-t||P>s+t)continue;const I=e.coordinateToDataIndex(P);if(c.has(I))continue;const A=e.dataIndexToTimestamp(I);if(!Ca(A))continue;const M=Uw(e,I,e.getDateTimeFormat());f.push({coord:P,value:A,text:"",isYearBoundary:(M==null?void 0:M.isYearBoundary)??!1,isMonthBoundary:(M==null?void 0:M.isMonthBoundary)??!1,isDayBoundary:(M==null?void 0:M.isDayBoundary)??!1,dataIndex:I}),c.add(I)}}f.length>0&&n.push(...f)}function s4({boundaryTs:n,dataList:e,firstTs:t,lastTs:s,chartStore:o}){if(Ca(t)&&Ca(s)&&n>=t&&n<=s){const a=G7(e,n);if(a!==null)return{index:a,fromData:!0}}const r=o.timestampToDataIndex(n);return Number.isFinite(r)?{index:Math.ceil(r),fromData:!1}:null}function G7(n,e){var r;let t=0,s=n.length-1,o=n.length;for(;t<=s;){const a=Math.floor((t+s)/2),l=(r=n[a])==null?void 0:r.timestamp;if(!Ca(l))return null;l>=e?(o=a,s=a-1):t=a+1}return o>=n.length?null:o}function Y7(n,e,t){let s=n.startOf(e);switch(e){case"year":{const o=s.year(),r=o-o%t;s=s.year(r).startOf("year");break}case"month":{const o=s.month(),r=o-o%t;s=s.month(r).startOf("month");break}case"day":{const o=s.date(),r=o-(o-1)%t;s=s.date(r).startOf("day");break}case"hour":{const o=s.hour(),r=o-o%t;s=s.hour(r).startOf("hour");break}case"minute":{const o=s.minute(),r=o-o%t;s=s.minute(r).startOf("minute");break}}return s}const K7={name:"normal"},ek={normal:qw.extend(K7)};function X7(n){return ek[n]??ek.normal}class Z7 extends X3{createAxisComponent(e){const t=X7(e);return new t(this)}createMainWidget(e){return new M7(e,this)}}function J7(n,e){let t=0;return function(){const s=Date.now();s-t>e&&(n.apply(this,arguments),t=s)}}class Q7 extends E3{constructor(t,s){super(t,s);Te(this,"_dragFlag",!1);Te(this,"_dragStartY",0);Te(this,"_topPaneHeight",0);Te(this,"_bottomPaneHeight",0);Te(this,"_topPane",null);Te(this,"_bottomPane",null);Te(this,"_pressedMouseMoveEvent",J7(this._pressedTouchMouseMoveEvent,20));this.registerEvent("touchStartEvent",this._mouseDownEvent.bind(this)).registerEvent("touchMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("touchEndEvent",this._mouseUpEvent.bind(this)).registerEvent("mouseDownEvent",this._mouseDownEvent.bind(this)).registerEvent("mouseUpEvent",this._mouseUpEvent.bind(this)).registerEvent("pressedMouseMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("mouseEnterEvent",this._mouseEnterEvent.bind(this)).registerEvent("mouseLeaveEvent",this._mouseLeaveEvent.bind(this))}getName(){return od.SEPARATOR}_mouseDownEvent(t){this._dragFlag=!0,this._dragStartY=t.pageY;const s=this.getPane(),o=s.getChart();this._topPane=s.getTopPane(),this._bottomPane=s.getBottomPane();const r=o.getDrawPanes();if(this._topPane.getOptions().state==="minimize"){const a=r.findIndex(l=>{var c;return l.getId()===((c=this._topPane)==null?void 0:c.getId())});for(let l=a-1;l>-1;l--){const c=r[l];if(c.getOptions().state!=="minimize"){this._topPane=c;break}}}if(this._bottomPane.getOptions().state==="minimize"){const a=r.findIndex(l=>{var c;return l.getId()===((c=this._bottomPane)==null?void 0:c.getId())});for(let l=a+1;l<r.length;l++){const c=r[l];if(c.getOptions().state!=="minimize"){this._bottomPane=c;break}}}return this._topPaneHeight=this._topPane.getBounding().height,this._bottomPaneHeight=this._bottomPane.getBounding().height,!0}_mouseUpEvent(){this._dragFlag=!1,this._topPane=null,this._bottomPane=null,this._topPaneHeight=0,this._bottomPaneHeight=0;try{this.getPane().getChart().layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}catch{}return this._mouseLeaveEvent()}_pressedTouchMouseMoveEvent(t){const s=t.pageY-this._dragStartY,o=s<0;if($s(this._topPane)&&$s(this._bottomPane)){const r=this._bottomPane.getOptions();if(this._topPane.getOptions().state!=="minimize"&&r.state!=="minimize"&&r.dragEnabled){let a=null,l=null,c=0,f=0;o?(a=this._topPane,l=this._bottomPane,c=this._topPaneHeight,f=this._bottomPaneHeight):(a=this._bottomPane,l=this._topPane,c=this._bottomPaneHeight,f=this._topPaneHeight);const u=a.getOptions().minHeight;if(c>u){const d=Math.max(c-Math.abs(s),u),h=c-d;a.setBounding({height:d}),l.setBounding({height:f+h});const m=this.getPane(),g=m.getChart();g.getChartStore().executeAction("onPaneDrag",{paneId:m.getId()}),g.layout({measureHeight:!0,update:!0,cacheYAxisWidth:!0})}}}return!0}_mouseEnterEvent(){const t=this.getPane();if(t.getBottomPane().getOptions().dragEnabled){const r=t.getChart().getStyles().separator;return this.getContainer().style.background=r.activeBackgroundColor,!0}return!1}_mouseLeaveEvent(){return this._dragFlag?!1:(this.getContainer().style.background="transparent",!0)}createContainer(){const t=B0("div",{width:"100%",height:`${zb}px`,margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize",touchAction:"none"});return t.classList.add("dutycharts-pane-separator"),t}updateImp(t,s,o){if(o===Ff.All||o===Ff.Separator){const r=this.getPane().getChart().getStyles().separator;t.style.top=`${-Math.floor((zb-r.size)/2)}px`,t.style.height=`${zb}px`}}}class eP extends K3{constructor(t,s,o,r){super(t,s);Te(this,"_topPane");Te(this,"_bottomPane");Te(this,"_separatorWidget");this.getContainer().style.overflow="",this._topPane=o,this._bottomPane=r,this._separatorWidget=new Q7(this.getContainer(),this)}setBounding(t){return lh(this.getBounding(),t),this}getTopPane(){return this._topPane}setTopPane(t){return this._topPane=t,this}getBottomPane(){return this._bottomPane}setBottomPane(t){return this._bottomPane=t,this}getWidget(){return this._separatorWidget}getImage(t){const{width:s,height:o}=this.getBounding(),r=this.getChart().getStyles().separator,a=B0("canvas",{width:`${s}px`,height:`${o}px`,boxSizing:"border-box"}),l=a.getContext("2d"),c=t_(a);return a.width=s*c,a.height=o*c,l.scale(c,c),l.fillStyle=r.color,l.fillRect(0,0,s,o),a}updateImp(t,s,o){if(t===Ff.All||t===Ff.Separator){const r=this.getChart().getStyles().separator;s.style.backgroundColor=r.color,s.style.height=`${o.height}px`,s.style.marginLeft=`${o.left}px`,s.style.width=`${o.width}px`,this._separatorWidget.update(t)}}}function tk(){return typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes("firefox")}function ix(){return typeof window>"u"?!1:/iPhone|iPad|iPod|iOS/.test(window.navigator.userAgent)}const cb={ResetClick:500,LongTap:500,PreventFiresTouchEvents:500},$_={CancelClick:5,CancelTap:5,DoubleClick:5,DoubleTap:30},L1={Left:0,Middle:1,Right:2},tP=10;class nP{constructor(e,t,s){Te(this,"_target");Te(this,"_handler");Te(this,"_options");Te(this,"_clickCount",0);Te(this,"_clickTimeoutId",null);Te(this,"_clickCoordinate",{x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY});Te(this,"_tapCount",0);Te(this,"_tapTimeoutId",null);Te(this,"_tapCoordinate",{x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY});Te(this,"_longTapTimeoutId",null);Te(this,"_longTapActive",!1);Te(this,"_mouseMoveStartCoordinate",null);Te(this,"_touchMoveStartCoordinate",null);Te(this,"_touchMoveExceededManhattanDistance",!1);Te(this,"_cancelClick",!1);Te(this,"_cancelTap",!1);Te(this,"_unsubscribeOutsideMouseEvents",null);Te(this,"_unsubscribeOutsideTouchEvents",null);Te(this,"_unsubscribeMobileSafariEvents",null);Te(this,"_unsubscribeMousemove",null);Te(this,"_unsubscribeMouseWheel",null);Te(this,"_unsubscribeContextMenu",null);Te(this,"_unsubscribeRootMouseEvents",null);Te(this,"_unsubscribeRootTouchEvents",null);Te(this,"_startPinchMiddleCoordinate",null);Te(this,"_startPinchDistance",0);Te(this,"_pinchPrevented",!1);Te(this,"_preventTouchDragProcess",!1);Te(this,"_mousePressed",!1);Te(this,"_lastTouchEventTimeStamp",0);Te(this,"_activeTouchId",null);Te(this,"_acceptMouseLeave",!ix());Te(this,"_onFirefoxOutsideMouseUp",e=>{this._mouseUpHandler(e)});Te(this,"_onMobileSafariDoubleClick",e=>{if(this._firesTouchEvents(e)){if(++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._tapCoordinate);t<$_.DoubleTap&&!this._cancelTap&&this._processEvent(this._makeCompatEvent(e),this._handler.doubleTapEvent),this._resetTapTimeout()}}else if(++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate);t<$_.DoubleClick&&!this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}});this._target=e,this._handler=t,this._options=s,this._init()}destroy(){this._unsubscribeOutsideMouseEvents!==null&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),this._unsubscribeOutsideTouchEvents!==null&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),this._unsubscribeMousemove!==null&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),this._unsubscribeMouseWheel!==null&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),this._unsubscribeContextMenu!==null&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),this._unsubscribeMobileSafariEvents!==null&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(e){var r,a,l;(r=this._unsubscribeMousemove)==null||r.call(this),(a=this._unsubscribeMouseWheel)==null||a.call(this),(l=this._unsubscribeContextMenu)==null||l.call(this);const t=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",t)},this._target.addEventListener("mousemove",t);const s=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",s)},this._target.addEventListener("wheel",s,{passive:!1});const o=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",o)},this._target.addEventListener("contextmenu",o,{passive:!1}),!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)}_resetClickTimeout(){this._clickTimeoutId!==null&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){this._tapTimeoutId!==null&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(e){this._mousePressed||this._touchMoveStartCoordinate!==null||this._firesTouchEvents(e)||(this._processEvent(this._makeCompatEvent(e),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)}_mouseWheelHandler(e){if(Math.abs(e.deltaX)>Math.abs(e.deltaY)){if(!$s(this._handler.mouseWheelHortEvent)||(this._preventDefault(e),Math.abs(e.deltaX)===0))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(e),-e.deltaX)}else{if(!$s(this._handler.mouseWheelVertEvent))return;let t=-(e.deltaY/100);if(t===0)return;switch(this._preventDefault(e),e.deltaMode){case e.DOM_DELTA_PAGE:{t*=120;break}case e.DOM_DELTA_LINE:{t*=32;break}}if(t!==0){const s=Math.sign(t)*Math.min(1,Math.abs(t));this._handler.mouseWheelVertEvent(this._makeCompatEvent(e),s)}}}_contextMenuHandler(e){this._preventDefault(e)}_touchMoveHandler(e){const t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null||(this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._startPinchMiddleCoordinate!==null)||this._preventTouchDragProcess)return;this._pinchPrevented=!0;const s=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._touchMoveStartCoordinate),{xOffset:o,yOffset:r,manhattanDistance:a}=s;if(!(!this._touchMoveExceededManhattanDistance&&a<$_.CancelTap)){if(!this._touchMoveExceededManhattanDistance){const l=o*.5,c=r>=l&&!this._options.treatVertDragAsPageScroll(),f=l>r&&!this._options.treatHorzDragAsPageScroll();!c&&!f&&(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(e,t),this._handler.touchMoveEvent)}}_mouseMoveWithDownHandler(e){if(e.button!==L1.Left)return;const t=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._mouseMoveStartCoordinate),{manhattanDistance:s}=t;s>=$_.CancelClick&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.pressedMouseMoveEvent)}_mouseTouchMoveWithDownInfo(e,t){const s=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y),r=s+o;return{xOffset:s,yOffset:o,manhattanDistance:r}}_touchEndHandler(e){let t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null&&e.touches.length===0&&(t=e.changedTouches[0]),t===null)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const s=this._makeCompatEvent(e,t);if(this._processEvent(s,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:o}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._tapCoordinate);o<$_.DoubleTap&&!this._cancelTap&&this._processEvent(s,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(s,this._handler.tapEvent),$s(this._handler.tapEvent)&&this._preventDefault(e));this._tapCount===0&&this._preventDefault(e),e.touches.length===0&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(e))}_mouseUpHandler(e){if(e.button!==L1.Left)return;const t=this._makeCompatEvent(e);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),tk()&&this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp),!this._firesTouchEvents(e))if(this._processEvent(t,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:s}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate);s<$_.DoubleClick&&!this._cancelClick&&this._processEvent(t,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(t,this._handler.mouseClickEvent)}_clearLongTapTimeout(){this._longTapTimeoutId!==null&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(e){if(this._activeTouchId!==null)return;const t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(e);const s=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(t),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const o=this._touchMoveHandler.bind(this),r=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{s.removeEventListener("touchmove",o),s.removeEventListener("touchend",r)},s.addEventListener("touchmove",o,{passive:!1}),s.addEventListener("touchend",r,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),cb.LongTap)}this._processEvent(this._makeCompatEvent(e,t),this._handler.touchStartEvent),this._tapTimeoutId===null&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),cb.ResetClick),this._tapCoordinate=this._getCoordinate(t))}_mouseDownHandler(e){if(e.button===L1.Right){this._preventDefault(e),this._processEvent(this._makeCompatEvent(e),this._handler.mouseRightClickEvent);return}if(e.button!==L1.Left)return;const t=this._target.ownerDocument.documentElement;tk()&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(e),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const s=this._mouseMoveWithDownHandler.bind(this),o=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{t.removeEventListener("mousemove",s),t.removeEventListener("mouseup",o)},t.addEventListener("mousemove",s),t.addEventListener("mouseup",o)}this._mousePressed=!0,!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseDownEvent),this._clickTimeoutId===null&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),cb.ResetClick),this._clickCoordinate=this._getCoordinate(e)))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const e=this._target.ownerDocument,t=s=>{this._handler.mouseDownOutsideEvent!=null&&(s.composed&&this._target.contains(s.composedPath()[0])||s.target!==null&&this._target.contains(s.target)||this._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=()=>{e.removeEventListener("touchstart",t)},this._unsubscribeOutsideMouseEvents=()=>{e.removeEventListener("mousedown",t)},e.addEventListener("mousedown",t),e.addEventListener("touchstart",t,{passive:!0})}ix()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),this._target.addEventListener("mousedown",e=>{if(e.button===L1.Middle)return e.preventDefault(),!1}),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",()=>{},{passive:!1})}_initPinch(){!$s(this._handler.pinchStartEvent)&&!$s(this._handler.pinchEvent)&&!$s(this._handler.pinchEndEvent)||(this._target.addEventListener("touchstart",e=>{this._checkPinchState(e.touches)},{passive:!0}),this._target.addEventListener("touchmove",e=>{if(!(e.touches.length!==2||this._startPinchMiddleCoordinate===null)&&$s(this._handler.pinchEvent)){const s=this._getTouchDistance(e.touches[0],e.touches[1])/this._startPinchDistance;this._handler.pinchEvent({...this._startPinchMiddleCoordinate,pageX:0,pageY:0},s),this._preventDefault(e)}},{passive:!1}),this._target.addEventListener("touchend",e=>{this._checkPinchState(e.touches)}))}_checkPinchState(e){e.length===1&&(this._pinchPrevented=!1),e.length!==2||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)}_startPinch(e){const t=this._target.getBoundingClientRect();this._startPinchMiddleCoordinate={x:(e[0].clientX-t.left+(e[1].clientX-t.left))/2,y:(e[0].clientY-t.top+(e[1].clientY-t.top))/2},this._startPinchDistance=this._getTouchDistance(e[0],e[1]),$s(this._handler.pinchStartEvent)&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()}_stopPinch(){this._startPinchMiddleCoordinate!==null&&(this._startPinchMiddleCoordinate=null,$s(this._handler.pinchEndEvent)&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))}_mouseLeaveHandler(e){var t,s,o;(t=this._unsubscribeMousemove)==null||t.call(this),(s=this._unsubscribeMouseWheel)==null||s.call(this),(o=this._unsubscribeContextMenu)==null||o.call(this),!this._firesTouchEvents(e)&&this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!ix())}_longTapHandler(e){const t=this._touchWithId(e.touches,this._activeTouchId);t!==null&&(this._processEvent(this._makeCompatEvent(e,t),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)}_firesTouchEvents(e){var t;return $s((t=e.sourceCapabilities)==null?void 0:t.firesTouchEvents)?e.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(e)<this._lastTouchEventTimeStamp+cb.PreventFiresTouchEvents}_processEvent(e,t){t==null||t.call(this._handler,e)}_makeCompatEvent(e,t){const s=t??e,o=this._target.getBoundingClientRect();return{x:s.clientX-o.left,y:s.clientY-o.top,pageX:s.pageX,pageY:s.pageY,isTouch:!e.type.startsWith("mouse")&&e.type!=="contextmenu"&&e.type!=="click"&&e.type!=="wheel",preventDefault:()=>{e.type!=="touchstart"&&this._preventDefault(e)}}}_getTouchDistance(e,t){const s=e.clientX-t.clientX,o=e.clientY-t.clientY;return Math.sqrt(s*s+o*o)}_preventDefault(e){e.cancelable&&e.preventDefault()}_getCoordinate(e){return{x:e.pageX,y:e.pageY}}_eventTimeStamp(e){return e.timeStamp??performance.now()}_touchWithId(e,t){for(let s=0;s<e.length;++s)if(e[s].identifier===t)return e[s];return null}}class sP{constructor(e,t){Te(this,"_container");Te(this,"_chart");Te(this,"_event");Te(this,"_flingStartTime",new Date().getTime());Te(this,"_flingScrollRequestId",null);Te(this,"_startScrollCoordinate",null);Te(this,"_touchCoordinate",null);Te(this,"_touchCancelCrosshair",!1);Te(this,"_touchZoomed",!1);Te(this,"_pinchScale",1);Te(this,"_mouseDownWidget",null);Te(this,"_prevYAxisRange",null);Te(this,"_xAxisStartScaleCoordinate",null);Te(this,"_xAxisStartScaleDistance",0);Te(this,"_xAxisScale",1);Te(this,"_yAxisStartScaleDistance",0);Te(this,"_mouseMoveTriggerWidgetInfo",{pane:null,widget:null});Te(this,"_wheelScrollAccum",0);Te(this,"_wheelScrollRafId",null);Te(this,"_wheelZoomAccum",0);Te(this,"_wheelZoomRafId",null);Te(this,"_wheelZoomLastCoord",null);Te(this,"_overlayUpdateRafId",null);Te(this,"_yAxisScaleLayoutTimer",null);Te(this,"_boundKeyBoardDownEvent",e=>{if(e.shiftKey)switch(e.code){case"Equal":{this._chart.getChartStore().zoom(.5);break}case"Minus":{this._chart.getChartStore().zoom(-.5);break}case"ArrowLeft":{const t=this._chart.getChartStore();t.startScroll(),t.scroll(-3*t.getBarSpace().bar);break}case"ArrowRight":{const t=this._chart.getChartStore();t.startScroll(),t.scroll(3*t.getBarSpace().bar);break}}});this._container=e,this._chart=t,this._event=new nP(e,this,{treatVertDragAsPageScroll:()=>!1,treatHorzDragAsPageScroll:()=>!1}),e.addEventListener("keydown",this._boundKeyBoardDownEvent)}pinchStartEvent(){return this._touchZoomed=!0,this._pinchScale=1,!0}pinchEvent(e,t){const{pane:s,widget:o}=this._findWidgetByEvent(e);if((s==null?void 0:s.getId())!==td.X_AXIS&&(o==null?void 0:o.getName())===od.MAIN){const r=this._makeWidgetEvent(e,o),a=(t-this._pinchScale)*5;return this._pinchScale=t,this._chart.getChartStore().zoom(a,{x:r.x,y:r.y}),!0}return!1}mouseWheelHortEvent(e,t){if(this._wheelScrollAccum+=t,this._wheelScrollRafId===null){const s=this._chart.getChartStore();this._wheelScrollRafId=D0(()=>{const o=this._wheelScrollAccum;this._wheelScrollAccum=0,this._wheelScrollRafId=null,s.startScroll(),s.scroll(o)})}return!0}mouseWheelVertEvent(e,t){const{widget:s}=this._findWidgetByEvent(e),o=this._makeWidgetEvent(e,s);return(s==null?void 0:s.getName())===od.MAIN?(this._wheelZoomAccum+=t,this._wheelZoomLastCoord={x:o.x,y:o.y},this._wheelZoomRafId===null&&(this._wheelZoomRafId=D0(()=>{const a=this._wheelZoomAccum,l=this._wheelZoomLastCoord??{x:o.x,y:o.y};this._wheelZoomAccum=0,this._wheelZoomLastCoord=null,this._wheelZoomRafId=null,this._chart.getChartStore().zoom(a,l)})),!0):!1}mouseDownEvent(e){const{pane:t,widget:s}=this._findWidgetByEvent(e);if(this._mouseDownWidget=s,s!==null){const o=this._makeWidgetEvent(e,s);switch(s.getName()){case od.SEPARATOR:return s.dispatchEvent("mouseDownEvent",o);case od.MAIN:{const a=t.getAxisComponent();if(!a.getAutoCalcTickFlag()){const l=a.getRange();this._prevYAxisRange={...l}}return this._startScrollCoordinate={x:o.x,y:o.y},this._chart.getChartStore().startScroll(),s.dispatchEvent("mouseDownEvent",o)}case od.X_AXIS:return this._processXAxisScrollStartEvent(s,o);case od.Y_AXIS:return this._processYAxisScaleStartEvent(s,o)}}return!1}mouseMoveEvent(e){var r,a,l;const{pane:t,widget:s}=this._findWidgetByEvent(e),o=this._makeWidgetEvent(e,s);if((((r=this._mouseMoveTriggerWidgetInfo.pane)==null?void 0:r.getId())!==(t==null?void 0:t.getId())||((a=this._mouseMoveTriggerWidgetInfo.widget)==null?void 0:a.getName())!==(s==null?void 0:s.getName()))&&(s==null||s.dispatchEvent("mouseEnterEvent",o),(l=this._mouseMoveTriggerWidgetInfo.widget)==null||l.dispatchEvent("mouseLeaveEvent",o),this._mouseMoveTriggerWidgetInfo={pane:t,widget:s}),s!==null){const c=s.getName();switch(c){case od.MAIN:{const f=s.dispatchEvent("mouseMoveEvent",o);let u={x:o.x,y:o.y,paneId:t==null?void 0:t.getId()};return f?(s.getForceCursor()!=="pointer"&&(u=void 0),s.setCursor("pointer")):s.setCursor("crosshair"),this._chart.getChartStore().setCrosshair(u),f}case od.SEPARATOR:case od.X_AXIS:case od.Y_AXIS:{const f=s.dispatchEvent("mouseMoveEvent",o);return c===od.X_AXIS?this._chart.getChartStore().setCrosshair({x:o.x,paneId:t==null?void 0:t.getId()}):this._chart.getChartStore().setCrosshair(),f}}}return!1}pressedMouseMoveEvent(e){var o,r;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===od.SEPARATOR)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",e);const{pane:t,widget:s}=this._findWidgetByEvent(e);if(s!==null&&((o=this._mouseDownWidget)==null?void 0:o.getPane().getId())===(t==null?void 0:t.getId())&&((r=this._mouseDownWidget)==null?void 0:r.getName())===s.getName()){const a=this._makeWidgetEvent(e,s);switch(s.getName()){case od.MAIN:{let c;const f=s.dispatchEvent("pressedMouseMoveEvent",a);return f||this._processMainScrollingEvent(s,a),(!f||s.getForceCursor()==="pointer")&&(c={x:a.x,y:a.y,paneId:t==null?void 0:t.getId()}),this._chart.getChartStore().setCrosshair(c,{forceInvalidate:!0}),f}case od.X_AXIS:return this._processXAxisScrollingEvent(s,a);case od.Y_AXIS:return this._processYAxisScalingEvent(s,a)}}return!1}mouseUpEvent(e){const{widget:t}=this._findWidgetByEvent(e),s=this._mouseDownWidget??t;let o=!1;if(s!==null){const r=this._makeWidgetEvent(e,s);switch(s.getName()){case od.MAIN:case od.SEPARATOR:case od.X_AXIS:case od.Y_AXIS:{o=s.dispatchEvent("mouseUpEvent",r);break}}o&&this._scheduleOverlayUpdate()}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._finalizeYAxisScaleLayout(),o}mouseClickEvent(e){const{widget:t}=this._findWidgetByEvent(e);if(t!==null){const s=this._makeWidgetEvent(e,t);return t.dispatchEvent("mouseClickEvent",s)}return!1}mouseRightClickEvent(e){const{widget:t}=this._findWidgetByEvent(e);let s=!1;if(t!==null){const o=this._makeWidgetEvent(e,t);switch(t.getName()){case od.MAIN:case od.X_AXIS:case od.Y_AXIS:{s=t.dispatchEvent("mouseRightClickEvent",o);break}}s&&this._scheduleOverlayUpdate()}return!1}mouseDoubleClickEvent(e){const{pane:t,widget:s}=this._findWidgetByEvent(e);if(s!==null)switch(s.getName()){case od.MAIN:{const r=this._makeWidgetEvent(e,s);return s.dispatchEvent("mouseDoubleClickEvent",r)}case od.Y_AXIS:{const r=t.getAxisComponent();if(!r.getAutoCalcTickFlag())return r.setAutoCalcTickFlag(!0),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}),!0;break}}return!1}mouseLeaveEvent(){return this._chart.getChartStore().setCrosshair(),!0}touchStartEvent(e){var o;const{pane:t,widget:s}=this._findWidgetByEvent(e);if(s!==null){const r=this._makeWidgetEvent(e,s);switch((o=r.preventDefault)==null||o.call(r),s.getName()){case od.SEPARATOR:return this._flingScrollRequestId!==null&&(Ob(this._flingScrollRequestId),this._flingScrollRequestId=null),this._mouseDownWidget=s,s.dispatchEvent("touchStartEvent",r);case od.MAIN:{const l=this._chart.getChartStore();if(s.dispatchEvent("mouseDownEvent",r))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,l.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(Ff.Overlay),!0;this._flingScrollRequestId!==null&&(Ob(this._flingScrollRequestId),this._flingScrollRequestId=null),this._flingStartTime=new Date().getTime();const c=t.getAxisComponent();if(!c.getAutoCalcTickFlag()){const f=c.getRange();this._prevYAxisRange={...f}}if(this._startScrollCoordinate={x:r.x,y:r.y},l.startScroll(),this._touchZoomed=!1,this._touchCoordinate!==null){const f=r.x-this._touchCoordinate.x,u=r.y-this._touchCoordinate.y;Math.sqrt(f*f+u*u)<tP?(this._touchCoordinate={x:r.x,y:r.y},l.setCrosshair({x:r.x,y:r.y,paneId:t==null?void 0:t.getId()})):(this._touchCoordinate=null,this._touchCancelCrosshair=!0,l.setCrosshair())}return!0}case od.X_AXIS:return this._processXAxisScrollStartEvent(s,r);case od.Y_AXIS:return this._processYAxisScaleStartEvent(s,r)}}return!1}touchMoveEvent(e){var o,r;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===od.SEPARATOR){const a=this._makeWidgetEvent(e,this._mouseDownWidget);return(o=a.preventDefault)==null||o.call(a),this._mouseDownWidget.dispatchEvent("touchMoveEvent",a)}const{pane:t,widget:s}=this._findWidgetByEvent(e);if(s!==null){const a=this._makeWidgetEvent(e,s);(r=a.preventDefault)==null||r.call(a);const l=s.getName(),c=this._chart.getChartStore();switch(l){case od.MAIN:return s.dispatchEvent("pressedMouseMoveEvent",a)?(c.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(Ff.Overlay),!0):(this._touchCoordinate!==null?c.setCrosshair({x:a.x,y:a.y,paneId:t==null?void 0:t.getId()}):this._processMainScrollingEvent(s,a),!0);case od.X_AXIS:return this._processXAxisScrollingEvent(s,a);case od.Y_AXIS:return this._processYAxisScalingEvent(s,a);case od.SEPARATOR:return s.dispatchEvent("touchMoveEvent",a)}}return!1}touchEndEvent(e){if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===od.SEPARATOR){const s=this._makeWidgetEvent(e,this._mouseDownWidget),o=this._mouseDownWidget.dispatchEvent("touchEndEvent",s);return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._finalizeYAxisScaleLayout(),o}const{widget:t}=this._findWidgetByEvent(e);if(t!==null){const s=this._makeWidgetEvent(e,t);switch(t.getName()){case od.MAIN:{if(t.dispatchEvent("mouseUpEvent",s),this._startScrollCoordinate!==null){const r=new Date().getTime()-this._flingStartTime;let l=(s.x-this._startScrollCoordinate.x)/(r>0?r:1)*20;if(r<200&&Math.abs(l)>0){const c=this._chart.getChartStore(),f=()=>{this._flingScrollRequestId=D0(()=>{c.startScroll(),c.scroll(l),l=l*(1-.025),Math.abs(l)<1?this._flingScrollRequestId!==null&&(Ob(this._flingScrollRequestId),this._flingScrollRequestId=null):f()})};f()}}return!0}case od.X_AXIS:case od.Y_AXIS:{t.dispatchEvent("mouseUpEvent",s)&&this._chart.updatePane(Ff.Overlay);break}case od.SEPARATOR:{t.dispatchEvent("touchEndEvent",s);break}}this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._finalizeYAxisScaleLayout()}return!1}tapEvent(e){const{pane:t,widget:s}=this._findWidgetByEvent(e);let o=!1;if(s!==null){const r=this._makeWidgetEvent(e,s),a=s.dispatchEvent("mouseClickEvent",r);if(s.getName()===od.MAIN){const l=this._makeWidgetEvent(e,s),c=this._chart.getChartStore();a?(this._touchCancelCrosshair=!0,this._touchCoordinate=null,c.setCrosshair(void 0,{notInvalidate:!0}),o=!0):(!this._touchCancelCrosshair&&!this._touchZoomed&&(this._touchCoordinate={x:l.x,y:l.y},c.setCrosshair({x:l.x,y:l.y,paneId:t==null?void 0:t.getId()},{notInvalidate:!0}),o=!0),this._touchCancelCrosshair=!1)}(o||a)&&this._scheduleOverlayUpdate()}return o}doubleTapEvent(e){return this.mouseDoubleClickEvent(e)}longTapEvent(e){const{pane:t,widget:s}=this._findWidgetByEvent(e);if(s!==null&&s.getName()===od.MAIN){const o=this._makeWidgetEvent(e,s);return this._touchCoordinate={x:o.x,y:o.y},this._chart.getChartStore().setCrosshair({x:o.x,y:o.y,paneId:t==null?void 0:t.getId()}),!0}return!1}_processMainScrollingEvent(e,t){if(this._startScrollCoordinate!==null){const s=e.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&!s.getAutoCalcTickFlag()&&s.scrollZoomEnabled){const{from:r,to:a,range:l}=this._prevYAxisRange;let c=0;s.reverse?c=this._startScrollCoordinate.y-t.y:c=t.y-this._startScrollCoordinate.y;const f=e.getBounding(),u=c/f.height,d=l*u,h=r+d,m=a+d,g=s.valueToRealValue(h,{range:this._prevYAxisRange}),w=s.valueToRealValue(m,{range:this._prevYAxisRange}),C=s.realValueToDisplayValue(g,{range:this._prevYAxisRange}),P=s.realValueToDisplayValue(w,{range:this._prevYAxisRange});s.setRange({from:h,to:m,range:m-h,realFrom:g,realTo:w,realRange:w-g,displayFrom:C,displayTo:P,displayRange:P-C}),s.buildTicks(!0),this._chart.updatePane(Ff.All,e.getPane().getId())}const o=t.x-this._startScrollCoordinate.x;o!==0&&this._chart.getChartStore().scroll(o)}}_processXAxisScrollStartEvent(e,t){const s=e.dispatchEvent("mouseDownEvent",t);return s&&this._scheduleOverlayUpdate(),this._xAxisStartScaleCoordinate={x:t.x,y:t.y},this._xAxisStartScaleDistance=t.pageX,s}_processXAxisScrollingEvent(e,t){const s=e.dispatchEvent("pressedMouseMoveEvent",t);if(s)this._scheduleOverlayUpdate();else if(e.getPane().getAxisComponent().scrollZoomEnabled&&this._xAxisStartScaleDistance!==0){const r=this._xAxisStartScaleDistance/t.pageX;if(Number.isFinite(r)){const a=(r-this._xAxisScale)*10;this._xAxisScale=r,this._chart.getChartStore().zoom(a,this._xAxisStartScaleCoordinate??void 0)}}return s}_processYAxisScaleStartEvent(e,t){const s=e.dispatchEvent("mouseDownEvent",t);s&&this._scheduleOverlayUpdate();const o=e.getPane().getAxisComponent().getRange();return this._prevYAxisRange={...o},this._yAxisStartScaleDistance=t.pageY,s}_processYAxisScalingEvent(e,t){const s=e.dispatchEvent("pressedMouseMoveEvent",t);if(s)this._chart.updatePane(Ff.Overlay);else{const o=e.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&o.scrollZoomEnabled&&this._yAxisStartScaleDistance!==0){const{from:r,to:a,range:l}=this._prevYAxisRange,c=t.pageY/this._yAxisStartScaleDistance,f=Number.isFinite(c)?Math.min(5,Math.max(.2,c)):1,u=l*f,d=(u-l)/2,h=r-d,m=a+d,g=o.valueToRealValue(h,{range:this._prevYAxisRange}),w=o.valueToRealValue(m,{range:this._prevYAxisRange}),C=o.realValueToDisplayValue(g,{range:this._prevYAxisRange}),P=o.realValueToDisplayValue(w,{range:this._prevYAxisRange});o.setRange({from:h,to:m,range:u,realFrom:g,realTo:w,realRange:w-g,displayFrom:C,displayTo:P,displayRange:P-C}),o.buildTicks(!0),this._chart.updatePane(Ff.All,e.getPane().getId()),this._scheduleYAxisScaleLayout()}}return s}_findWidgetByEvent(e){const{x:t,y:s}=e,o=this._chart.getSeparatorPanes(),r=this._chart.getStyles().separator.size,a=zb,l=e.isTouch?Math.max(a,r+14):Math.max(a,r+6);for(const d of o){const h=d[1],m=h.getBounding(),g=m.top-Math.round((l-r)/2);if(t>=m.left&&t<=m.left+m.width&&s>=g&&s<=g+l)return{pane:h,widget:h.getWidget()}}const c=this._chart.getDrawPanes();let f=null;for(const d of c){const h=d.getBounding();if(t>=h.left&&t<=h.left+h.width&&s>=h.top&&s<=h.top+h.height){f=d;break}}let u=null;if(f!==null){if(!$s(u)){const d=f.getMainWidget(),h=d.getBounding();t>=h.left&&t<=h.left+h.width&&s>=h.top&&s<=h.top+h.height&&(u=d)}if(!$s(u)){const d=f.getYAxisWidget();if(d!==null){const h=d.getBounding();t>=h.left&&t<=h.left+h.width&&s>=h.top&&s<=h.top+h.height&&(u=d)}}}return{pane:f,widget:u}}_makeWidgetEvent(e,t){const s=(t==null?void 0:t.getBounding())??null;return{...e,x:e.x-((s==null?void 0:s.left)??0),y:e.y-((s==null?void 0:s.top)??0)}}_scheduleYAxisScaleLayout(){this._yAxisScaleLayoutTimer!==null&&clearTimeout(this._yAxisScaleLayoutTimer),this._yAxisScaleLayoutTimer=window.setTimeout(()=>{this._yAxisScaleLayoutTimer=null,this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0})},60)}_finalizeYAxisScaleLayout(){this._yAxisScaleLayoutTimer!==null&&(clearTimeout(this._yAxisScaleLayoutTimer),this._yAxisScaleLayoutTimer=null,this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}))}destroy(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._yAxisScaleLayoutTimer!==null&&(clearTimeout(this._yAxisScaleLayoutTimer),this._yAxisScaleLayoutTimer=null),this._event.destroy()}}class oP{constructor(e,t){Te(this,"id");Te(this,"_container");Te(this,"_chartContainer");Te(this,"_chartBounding",a2());Te(this,"_chartEvent");Te(this,"_chartStore");Te(this,"_drawPanes",[]);Te(this,"_candlePane");Te(this,"_xAxisPane");Te(this,"_separatorPanes",new Map);Te(this,"_layoutOptions",{sort:!0,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1});Te(this,"_layoutPending",!1);Te(this,"_cacheYAxisWidth",{left:0,right:0});this.id=G1("chart"),this._initContainer(e),this._chartEvent=new sP(this._chartContainer,this),this._chartStore=new II(this,t),this._initPanes(t),this._layout()}_initContainer(e){this._container=e,this._chartContainer=B0("div",{position:"relative",width:"100%",height:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",overflow:"hidden",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,e.appendChild(this._chartContainer),this._cacheChartBounding()}_cacheChartBounding(){this._chartBounding.width=Math.floor(this._chartContainer.clientWidth),this._chartBounding.height=Math.floor(this._chartContainer.clientHeight)}_initPanes(e){const t=(e==null?void 0:e.layout)??[{type:"candle"}],s=r=>{if(!$s(this._candlePane)){const a=r.options??{};lh(a,{id:td.CANDLE}),this._candlePane=this._createPane(S7,td.CANDLE,a),(r.content??[]).forEach(c=>{this.createIndicator(c,!0,a)})}},o=r=>{if(!$s(this._xAxisPane)){const a=this._createPane(Z7,td.X_AXIS,r??{});this._xAxisPane=a}};t.forEach(r=>{var a;switch(r.type){case"candle":{s(r);break}case"indicator":{const l=r.content??[];if(l.length>0){let c=((a=r.options)==null?void 0:a.id)??null;$s(c)&&(c=G1(td.INDICATOR));const f={...r.options,id:c};l.forEach(u=>{this.createIndicator(u,!0,f)})}break}case"xAxis":{o(r.options);break}}}),s({type:"candle"}),o({order:Number.MAX_SAFE_INTEGER})}_createPane(e,t,s){const o=new e(this,t,s??{});return this._drawPanes.push(o),o}_recalculatePaneHeight(e,t,s){if(s===0)return!1;const o=this._drawPanes.filter(a=>{const l=a.getId();return a.getOptions().state==="normal"&&l!==e.getId()&&l!==td.X_AXIS}),r=o.length;if(r===0)return!1;if(e.getId()!==td.CANDLE&&$s(this._candlePane)&&this._candlePane.getOptions().state==="normal"){const a=this._candlePane.getBounding().height;if(a>0){const l=this._candlePane.getOptions().minHeight;let c=a+s;c<l&&(c=l,t-=a+s-c),this._candlePane.setBounding({height:c})}}else{let a=s;const l=Math.floor(s/r);o.forEach((c,f)=>{const u=c.getBounding().height;let d=0;f===r-1?d=u+a:d=u+l,d<c.getOptions().minHeight&&(d=c.getOptions().minHeight),c.setBounding({height:d}),a-=d-u}),Math.abs(a)>0&&(t-=a)}return e.setBounding({height:t}),!0}getDrawPaneById(e){return e===td.CANDLE?this._candlePane:e===td.X_AXIS?this._xAxisPane:this._drawPanes.find(s=>s.getId()===e)??null}getContainer(){return this._container}getChartStore(){return this._chartStore}getXAxisPane(){return this._xAxisPane}getDrawPanes(){return this._drawPanes}getSeparatorPanes(){return this._separatorPanes}layout(e){(e.sort??!1)&&(this._layoutOptions.sort=e.sort),(e.measureHeight??!1)&&(this._layoutOptions.measureHeight=e.measureHeight),(e.measureWidth??!1)&&(this._layoutOptions.measureWidth=e.measureWidth),(e.update??!1)&&(this._layoutOptions.update=e.update),(e.buildYAxisTick??!1)&&(this._layoutOptions.buildYAxisTick=e.buildYAxisTick),(e.cacheYAxisWidth??!1)&&(this._layoutOptions.cacheYAxisWidth=e.cacheYAxisWidth),(e.buildYAxisTick??!1)&&(this._layoutOptions.forceBuildYAxisTick=e.forceBuildYAxisTick),this._layoutPending||(this._layoutPending=!0,Promise.resolve().then(t=>{try{this._layout()}finally{this._layoutPending=!1}}).catch(t=>{}))}_layout(){const{sort:e,measureHeight:t,measureWidth:s,update:o,buildYAxisTick:r,cacheYAxisWidth:a,forceBuildYAxisTick:l}=this._layoutOptions;if(typeof performance<"u"?performance.now():Date.now(),e){for(;$s(this._chartContainer.firstChild);)this._chartContainer.removeChild(this._chartContainer.firstChild);this._separatorPanes.clear(),this._drawPanes.sort((u,d)=>u.getOptions().order-d.getOptions().order);let f=null;this._drawPanes.forEach(u=>{if(u.getId()!==td.X_AXIS){if($s(f)){const d=new eP(this,"",f,u);this._chartContainer.appendChild(d.getContainer()),this._separatorPanes.set(u,d)}f=u}this._chartContainer.appendChild(u.getContainer())})}if(t){const f=this._chartBounding.height,u=this.getStyles().separator.size,d=this._xAxisPane.getAxisComponent().getAutoSize();let h=f-d;h<0&&(h=0),this._drawPanes.forEach(g=>{const w=g.getId();if($s(this._separatorPanes.get(g))&&(h-=u),w!==td.X_AXIS&&w!==td.CANDLE&&g.getVisible()){let C=g.getBounding().height;C>h?(C=h,h=0):h-=C,g.setBounding({height:C})}}),this._candlePane.setBounding({height:Math.max(h,0)}),this._xAxisPane.setBounding({height:d});let m=0;this._drawPanes.forEach(g=>{const w=this._separatorPanes.get(g);$s(w)&&(w.setBounding({height:u,top:m}),m+=u),g.setBounding({top:m}),m+=g.getBounding().height})}let c=s;if((r||l)&&this._drawPanes.forEach(f=>{const u=f.getAxisComponent().buildTicks(l);c||(c=u)}),c){const f=this._chartBounding.width,u=this.getStyles();let d=0,h=!0,m=0,g=!0;this._drawPanes.forEach(L=>{if(L.getId()!==td.X_AXIS&&L.getVisible()){const O=L.getAxisComponent(),Y=O.inside,ce=O.getAutoSize();O.position==="left"?(d=Math.max(d,ce),Y&&(h=!1)):(m=Math.max(m,ce),Y&&(g=!1))}}),a&&(d=Math.max(this._cacheYAxisWidth.left,d),m=Math.max(this._cacheYAxisWidth.right,m)),this._cacheYAxisWidth.left=d,this._cacheYAxisWidth.right=m;let w=f,C=0,P=0;h&&(w-=d,C=d),g&&(w-=m,P=m),this._chartStore.setTotalBarSpace(w);const I={width:f},A={width:w,left:C,right:P},M={width:d},F={width:m},B=u.separator.fill;let $={};B?$=I:$=A,this._drawPanes.forEach(L=>{var O;(O=this._separatorPanes.get(L))==null||O.setBounding($),L.setBounding(I,A,M,F)})}o&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(Ff.All)),this._layoutOptions={sort:!1,measureHeight:!1,measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1},typeof performance<"u"?performance.now():Date.now()}updatePane(e,t){if($s(t)){const s=this.getDrawPaneById(t);s==null||s.update(e)}else this._drawPanes.forEach(s=>{var o;s.update(e),(o=this._separatorPanes.get(s))==null||o.update(e)})}getDom(e,t){var s;if($s(e)){const o=this.getDrawPaneById(e);if($s(o))switch(t??"root"){case"root":return o.getContainer();case"main":return o.getMainWidget().getContainer();case"yAxis":return((s=o.getYAxisWidget())==null?void 0:s.getContainer())??null}}else return this._chartContainer;return null}getSize(e,t){var s;if($s(e)){const o=this.getDrawPaneById(e);if($s(o))switch(t??"root"){case"root":return o.getBounding();case"main":return o.getMainWidget().getBounding();case"yAxis":return((s=o.getYAxisWidget())==null?void 0:s.getBounding())??null}}else return this._chartBounding;return null}_resetYAxisAutoCalcTickFlag(){this._drawPanes.forEach(e=>{e.getAxisComponent().setAutoCalcTickFlag(!0)})}setSymbol(e){e!==this.getSymbol()&&(this._resetYAxisAutoCalcTickFlag(),this._chartStore.setSymbol(e))}getSymbol(){return this._chartStore.getSymbol()}setPeriod(e){e!==this.getPeriod()&&(this._resetYAxisAutoCalcTickFlag(),this._chartStore.setPeriod(e))}getPeriod(){return this._chartStore.getPeriod()}setStyles(e){this._setOptions(()=>{this._chartStore.setStyles(e)})}getStyles(){return this._chartStore.getStyles()}setFormatter(e){this._setOptions(()=>{this._chartStore.setFormatter(e)})}getFormatter(){return this._chartStore.getFormatter()}setLocale(e){this._setOptions(()=>{this._chartStore.setLocale(e)})}getLocale(){return this._chartStore.getLocale()}setTimezone(e){this._setOptions(()=>{this._chartStore.setTimezone(e)})}getTimezone(){return this._chartStore.getTimezone()}setThousandsSeparator(e){this._setOptions(()=>{this._chartStore.setThousandsSeparator(e)})}getThousandsSeparator(){return this._chartStore.getThousandsSeparator()}setDecimalFold(e){this._setOptions(()=>{this._chartStore.setDecimalFold(e)})}getDecimalFold(){return this._chartStore.getDecimalFold()}_setOptions(e){e(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}setOffsetRightDistance(e){this._chartStore.setOffsetRightDistance(e,!0)}getOffsetRightDistance(){return this._chartStore.getOffsetRightDistance()}setMaxOffsetLeftDistance(e){e<0||this._chartStore.setMaxOffsetLeftDistance(e)}setMaxOffsetRightDistance(e){e<0||this._chartStore.setMaxOffsetRightDistance(e)}setLeftMinVisibleBarCount(e){e<0||this._chartStore.setLeftMinVisibleBarCount(Math.ceil(e))}setRightMinVisibleBarCount(e){e<0||this._chartStore.setRightMinVisibleBarCount(Math.ceil(e))}setBarSpace(e){this._chartStore.setBarSpace(e)}getBarSpace(){return this._chartStore.getBarSpace()}getVisibleRange(){return this._chartStore.getVisibleRange()}resetData(){this._chartStore.resetData()}applyNewData(e,t){this._chartStore.applyNewData(e,t)}addData(e,t,s){this._chartStore.addData(e,t,s)}getDataList(){return this._chartStore.getDataList()}setDataLoader(e){this._resetYAxisAutoCalcTickFlag(),this._chartStore.setDataLoader(e)}createIndicator(e,t,s){const o=hd(e)?{name:e}:e;if(P3(o.name)===null)return null;const r=s??{};if(hd(r.id)||(r.id=G1(td.INDICATOR)),hd(o.id)||(o.id=G1(o.name)),this._chartStore.addIndicator(o,r.id,t??!1)){let l=!1;return $s(this.getDrawPaneById(r.id))||(this._createPane(Z3,r.id,r),r.height??(r.height=F3),l=!0),this.setPaneOptions(r),this.layout({sort:l,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0}),o.id}return null}overrideIndicator(e){return this._chartStore.overrideIndicator(e)}getIndicators(e){return this._chartStore.getIndicatorsByFilter(e??{})}removeIndicator(e){let t=this._chartStore.removeIndicator(e??{});if(!t&&e){const{name:s,id:o}=e,r=typeof s=="string"?s.split("(")[0].trim():void 0;if(o||r){const a={};o&&(a.id=o),r&&(a.name=r),t=this._chartStore.removeIndicator(a),!t&&r&&(t=this._chartStore.removeIndicator({name:r}))}}if(t){let s=!1;const o=[];this._drawPanes.forEach(r=>{const a=r.getId();a!==td.CANDLE&&a!==td.X_AXIS&&o.push(a)}),o.forEach(r=>{if(!this._chartStore.hasIndicators(r)){const a=this._drawPanes.findIndex(c=>c.getId()===r),l=this._drawPanes[a];$s(l)&&(s=!0,this._recalculatePaneHeight(l,0,l.getBounding().height),this._drawPanes.splice(a,1),l.destroy())}}),this._drawPanes.length===2&&(this._candlePane.setVisible(!0),this._candlePane.setBounding({height:this._chartBounding.height-this._xAxisPane.getBounding().height})),this.layout({sort:s,measureHeight:s,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}return t}createOverlay(e){const t=[],s=[],o=a=>{!$s(a.paneId)||this.getDrawPaneById(a.paneId)===null?(a.paneId=td.CANDLE,s.push(!1)):s.push(!0),t.push(a)};hd(e)?o({name:e}):t0(e)?e.forEach(a=>{let l=null;hd(a)?l={name:a}:l=a,o(l)}):o(e);const r=this._chartStore.addOverlays(t,s);return t0(e)?r:r[0]}getOverlays(e){return this._chartStore.getOverlaysByFilter(e??{})}overrideOverlay(e){return this._chartStore.overrideOverlay(e)}removeOverlay(e){return this._chartStore.removeOverlay(e??{})}setPaneOptions(e){let t=!1,s=!1;const o=$s(e.id);for(const r of this._drawPanes){const a=r.getId();if(o&&e.id===a||!o){if(a!==td.X_AXIS){if(Ca(e.height)&&e.height>0){const c=Math.max(e.minHeight??r.getOptions().minHeight,0),f=Math.max(c,e.height);s=!0,t=!0,r.setOriginalBounding({height:f}),this._recalculatePaneHeight(r,f,-f)}if($s(e.state)&&r.getOptions().state!==e.state){t=!0,s=!0;const c=e.state;switch(c){case"maximize":{const f=this._drawPanes.find(u=>{const d=u.getId();return u.getOptions().state==="maximize"&&d!==td.X_AXIS});if(!$s(f)){r.getOptions().state==="normal"&&r.setOriginalBounding({height:r.getBounding().height}),r.setOptions({state:c});const u=this._chartBounding.height;r.setBounding({height:u-this._xAxisPane.getBounding().height}),this._drawPanes.forEach(d=>{var h;d.getId()!==td.X_AXIS&&d.getId()!==a&&(d.setBounding({height:d.getOriginalBounding().height}),d.setVisible(!1),(h=this._separatorPanes.get(d))==null||h.setVisible(!1))})}break}case"minimize":{const f=r.getBounding().height,u=r.getOptions().state;let d=f-sy;u==="maximize"&&(d=r.getOriginalBounding().height-sy),this._recalculatePaneHeight(r,sy,d)&&(u==="normal"&&r.setOriginalBounding({height:f}),r.setOptions({state:c})),this._drawPanes.forEach(h=>{var m;h.getId()!==td.X_AXIS&&(h.setVisible(!0),(m=this._separatorPanes.get(h))==null||m.setVisible(!0))});break}default:{const f=r.getOriginalBounding().height;r.getOptions().state==="maximize"?(r.setOptions({state:c}),this._drawPanes.forEach(d=>{var h;d.getId()!==td.X_AXIS&&(d.setBounding({height:d.getOriginalBounding().height}),d.setVisible(!0),(h=this._separatorPanes.get(d))==null||h.setVisible(!0))})):this._recalculatePaneHeight(r,f,r.getBounding().height-f)&&(r.setOptions({state:c}),this._drawPanes.forEach(d=>{var h;d.getId()!==td.X_AXIS&&(d.setVisible(!0),(h=this._separatorPanes.get(d))==null||h.setVisible(!0))}));break}}}}$s(e.axis)&&(s=!0);const l={...e};if(delete l.state,r.setOptions(l),a===e.id)break}}s&&this.layout({measureHeight:t,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}getPaneOptions(e){if($s(e)){const t=this.getDrawPaneById(e);return(t==null?void 0:t.getOptions())??null}return this._drawPanes.map(t=>t.getOptions())}setZoomEnabled(e){this._chartStore.setZoomEnabled(e)}isZoomEnabled(){return this._chartStore.isZoomEnabled()}setScrollEnabled(e){this._chartStore.setScrollEnabled(e)}isScrollEnabled(){return this._chartStore.isScrollEnabled()}scrollByDistance(e,t){const s=Ca(t)&&t>0?t:0;if(this._chartStore.startScroll(),s>0){const o=new Ux({duration:s});o.doFrame(r=>{const a=e*(r/s);this._chartStore.scroll(a)}),o.start()}else this._chartStore.scroll(e)}scrollToRealTime(e){const{bar:t}=this._chartStore.getBarSpace(),o=(this._chartStore.getLastBarRightSideDiffBarCount()-this._chartStore.getInitialOffsetRightDistance()/t)*t;this.scrollByDistance(o,e)}scrollToDataIndex(e,t){const s=(this._chartStore.getLastBarRightSideDiffBarCount()+(this.getDataList().length-1-e))*this._chartStore.getBarSpace().bar;this.scrollByDistance(s,t)}scrollToTimestamp(e,t){const s=Gx(this.getDataList(),"timestamp",e);this.scrollToDataIndex(s,t)}zoomAtCoordinate(e,t,s){const o=Ca(s)&&s>0?s:0,{bar:r}=this._chartStore.getBarSpace(),l=r*e-r;if(o>0){let c=0;const f=new Ux({duration:o});f.doFrame(u=>{const d=l*(u/o),h=(d-c)/this._chartStore.getBarSpace().bar*Yx;this._chartStore.zoom(h,t),c=d}),f.start()}else this._chartStore.zoom(l/r*Yx,t)}zoomAtDataIndex(e,t,s){const o=this._chartStore.dataIndexToCoordinate(t);this.zoomAtCoordinate(e,{x:o,y:0},s)}zoomAtTimestamp(e,t,s){const o=Gx(this.getDataList(),"timestamp",t);this.zoomAtDataIndex(e,o,s)}convertToPixel(e,t){const{paneId:s=td.CANDLE,absolute:o=!1}=t??{};let r=[];if(s!==td.X_AXIS){const a=this.getDrawPaneById(s);if(a!==null){const l=a.getBounding(),c=[].concat(e),f=this._xAxisPane.getAxisComponent(),u=a.getAxisComponent();r=c.map(d=>{const h={};let m=d.dataIndex;if(Ca(d.timestamp)&&(m=this._chartStore.timestampToDataIndex(d.timestamp)),Ca(m)&&(h.x=f.convertToPixel(m)),Ca(d.value)){const g=u.convertToPixel(d.value);h.y=o?l.top+g:g}return h})}}return t0(e)?r:r[0]??{}}convertFromPixel(e,t){const{paneId:s=td.CANDLE,absolute:o=!1}=t??{};let r=[];if(s!==td.X_AXIS){const a=this.getDrawPaneById(s);if(a!==null){const l=a.getBounding(),c=[].concat(e),f=this._xAxisPane.getAxisComponent(),u=a.getAxisComponent();r=c.map(d=>{const h={};if(Ca(d.x)){const m=f.convertFromPixel(d.x);h.dataIndex=m,h.timestamp=this._chartStore.dataIndexToTimestamp(m)??void 0}if(Ca(d.y)){const m=o?d.y-l.top:d.y;h.value=u.convertFromPixel(m)}return h})}}return t0(e)?r:r[0]??{}}executeAction(e,t){switch(e){case"onCrosshairChange":{const s={...t};s.paneId??(s.paneId=td.CANDLE),this._chartStore.setCrosshair(s,{notExecuteAction:!0});break}}}subscribeAction(e,t){this._chartStore.subscribeAction(e,t)}unsubscribeAction(e,t){this._chartStore.unsubscribeAction(e,t)}getConvertPictureUrl(e,t,s){const{width:o,height:r}=this._chartBounding,a=B0("canvas",{width:`${o}px`,height:`${r}px`,boxSizing:"border-box"}),l=a.getContext("2d"),c=t_(a);a.width=o*c,a.height=r*c,l.scale(c,c),l.fillStyle=s??"#FFFFFF",l.fillRect(0,0,o,r);const f=e??!1;return this._drawPanes.forEach(u=>{const d=this._separatorPanes.get(u);if($s(d)){const m=d.getBounding();l.drawImage(d.getImage(f),m.left,m.top,m.width,m.height)}const h=u.getBounding();l.drawImage(u.getImage(f),0,h.top,o,h.height)}),a.toDataURL(`image/${t??"jpeg"}`)}resize(){this._cacheChartBounding(),!(this._chartBounding.width<=0||this._chartBounding.height<=0)&&this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}destroy(){this._chartEvent.destroy(),this._drawPanes.forEach(e=>{e.destroy()}),this._drawPanes=[],this._separatorPanes.clear(),this._chartStore.destroy(),this._container.removeChild(this._chartContainer)}}const rx={Main:0,Overlay:1,Separator:2,Drawer:3,All:4},nk=new Map;let iP=1;function rP(n,e){let t=null;if(hd(n)?t=document.getElementById(n):t=n,t===null)return null;let s=nk.get(t.id);if($s(s))return s;const o=`k_line_chart_${iP++}`;return s=new oP(t,e),s.id=o,t.setAttribute("duty-chart-id",o),nk.set(o,s),s}const Xv={clone:n1,merge:lh,isString:hd,isNumber:Ca,isValid:$s,isObject:kg,isArray:t0,isFunction:eg,isBoolean:fy,formatValue:Nh,formatPrecision:Mh,formatBigNumber:k3,formatDate:w3,formatThousands:S3,formatFoldDecimal:C3,calcTextWidth:Em,getLinearSlopeIntercept:L2,getLinearYFromSlopeIntercept:Rw,getLinearYFromCoordinates:py,checkCoordinateOnArc:B3,checkCoordinateOnCircle:$3,checkCoordinateOnLine:M3,checkCoordinateOnPolygon:D3,checkCoordinateOnRect:Ow,checkCoordinateOnText:j3},wt={Solid:"solid",Dashed:"dashed"},V_={Fill:"fill",Stroke:"stroke",StrokeFill:"stroke_fill"},Jg={OnZoom:"onZoom",OnScroll:"onScroll",OnVisibleRangeChange:"onVisibleRangeChange",OnCandleTooltipFeatureClick:"onCandleTooltipFeatureClick",OnIndicatorTooltipFeatureClick:"onIndicatorTooltipFeatureClick",OnCrosshairFeatureClick:"onCrosshairFeatureClick",OnCrosshairChange:"onCrosshairChange",OnCandleBarClick:"onCandleBarClick",OnPaneDrag:"onPaneDrag"},aP={Normal:"normal",WeakMagnet:"weak_magnet",StrongMagnet:"strong_magnet"},lP={Left:"left",Middle:"middle",Right:"right"},sk={Always:"always",FollowCross:"follow_cross",None:"none"},cP={CandleSolid:"candle_solid",CandleStroke:"candle_stroke",CandleUpStroke:"candle_up_stroke",CandleDownStroke:"candle_down_stroke",Ohlc:"ohlc",Area:"area"},uP={Tooltip:"tooltip",Crosshair:"crosshair",XAxis:"xAxis"};var ax={local:{},session:{}};function dP(n){return n==="local"?localStorage:sessionStorage}function Gw(n,e,t){var s,o,r,a,l,c,f,u;const d=(s=void 0)!=null?s:JSON,h=(o=void 0)!=null?o:"local",m=(r=void 0)!=null?r:!0,g=(l=(a=void 0)!=null?a:void 0)!=null?l:B=>console.error(`Error when writing value from persisted store "${n}" to ${h}`,B),w=(c=void 0)!=null?c:(B,$)=>console.error(`Error when parsing ${B?'"'+B+'"':"value"} from persisted store "${n}"`,$),C=(f=void 0)!=null?f:B=>B,P=(u=void 0)!=null?u:B=>B,I=typeof window<"u"&&typeof document<"u",A=I?dP(h):null;function M(B,$){const L=P($);try{A==null||A.setItem(B,d.stringify(L))}catch(O){g(O)}}function F(){function B(Y){try{return d.parse(Y)}catch(ce){w(Y,ce)}}const $=A==null?void 0:A.getItem(n);if($==null)return e;const L=B($);return L==null?e:C(L)}if(!ax[h][n]){const B=F(),$=$m(B,Y=>{if(I&&h=="local"&&m){const ce=Q=>{if(Q.key===n&&Q.newValue){let le;try{le=d.parse(Q.newValue)}catch(fe){w(Q.newValue,fe);return}const ue=C(le);Y(ue)}};return window.addEventListener("storage",ce),()=>window.removeEventListener("storage",ce)}}),{subscribe:L,set:O}=$;ax[h][n]={set(Y){O(Y),M(n,Y)},update(Y){return $.update(ce=>{const Q=Y(ce);return M(n,Q),Q})},reset(){this.set(e)},subscribe:L}}return ax[h][n]}const D_=uP,gg=Xv.formatDate;let Yw=!0,Kw="UTC";yp.extend(Hw);yp.extend(Ww);yp.tz.setDefault("UTC");const Zx=60,Jx=Zx*60,my=Jx*24,ok=my*7,ik=my*30,rk=my*365,fP={"Africa/Abidjan":"utc","Pacific/Honolulu":"honolulu","America/Juneau":"juneau","America/Los_Angeles":"los_angeles","America/Chicago":"chicago","America/Toronto":"toronto","America/Sao_Paulo":"sao_paulo","Europe/London":"london","Europe/Berlin":"berlin","Asia/Bahrain":"bahrain","Asia/Dubai":"dubai","Asia/Ashkhabad":"ashkhabad","Asia/Almaty":"almaty","Asia/Dhaka":"dhaka","Asia/Bangkok":"bangkok","Asia/Shanghai":"shanghai","Asia/Tokyo":"tokyo","Australia/Sydney":"sydney","Pacific/Guadalcanal":"guadalcanal","Pacific/Auckland":"auckland"};function pP(){return yp().valueOf()}function ak(n){if(!n)return 0;n=n.trim();const e=/^\d+$/.test(n);let t=null;if(e){const s=n.length;if(s==4){const o=new Date().getFullYear();t=yp(`${o}${n}`,"YYYYMMDD")}else if(s==6){const o=parseInt(n.substring(0,2)),r=o>50?1900+o:2e3+o,a=n.substring(2);t=yp(`${r}${a}`,"YYYYMMDD")}else if(s==8)t=yp(n,"YYYYMMDD");else if(s==10)t=yp.unix(parseInt(n));else if(s==12)t=yp(n,"YYYYMMDDHHmm");else if(s==13)t=yp(parseInt(n));else if(s==14)t=yp(n,"YYYYMMDDHHmmss");else return console.error("invalid date format:",n),0}else t=yp(n,["YYYY/MM/DD","YYYY/MM/DD HH:mm","YYYY/MM/DD HH:mm:ss","YYYY-MM-DD","YYYY-MM-DD HH:mm","YYYY-MM-DD HH:mm:ss"],!0);return!t||!t.isValid()?(console.error("Invalid date format or value:",n),0):(Yw||console.error("local timezone not applied"),t=t.tz(Kw,!0),t.valueOf())}function lk(n,e="YYYY-MM-DD HH:mm:ss",t=void 0){if(!n)return"--";let s=null;return n>1e12?s=yp(n):s=yp.unix(n),s=s.tz(t||Kw,!0),Yw||console.error("local timezone not applied"),s.format(e)}function mP(n,e,t){let s=e,o=s;switch(n.timespan){case"minute":{s=s-s%(60*1e3),o=s-t*n.multiplier*60*1e3;break}case"hour":{s=s-s%(60*60*1e3),o=s-t*n.multiplier*60*60*1e3;break}case"day":{s=s-s%(60*60*1e3),o=s-t*n.multiplier*24*60*60*1e3;break}case"week":{const a=new Date(s).getDay(),l=a===0?6:a-1;s=s-l*60*60*24;const c=new Date(s);s=new Date(`${c.getFullYear()}-${c.getMonth()+1}-${c.getDate()}`).getTime(),o=t*n.multiplier*7*24*60*60*1e3;break}case"month":{const r=new Date(s),a=r.getFullYear(),l=r.getMonth()+1;s=new Date(`${a}-${l}-01`).getTime(),o=t*n.multiplier*30*24*60*60*1e3;const c=new Date(o);o=new Date(`${c.getFullYear()}-${c.getMonth()+1}-01`).getTime();break}}return[o,s]}function gp(n){if(!n)return 0;const e=n.substring(n.length-1),t=parseInt(n.substring(0,n.length-1));let s=0;if(e=="y")s=31536e3;else if(e=="M")s=2592e3;else if(e=="w")s=604800;else if(e=="d")s=86400;else if(e=="h")s=3600;else if(e=="m")s=60;else if(e=="s")s=1;else throw Error(`unsupport timeframe: ${n}`);return s*t}function hP(n){return n>rk?`${Math.floor(n/rk)}y`:n>ik?`${Math.floor(n/ik)}M`:n>ok?`${Math.floor(n/ok)}w`:n>my?`${Math.floor(n/my)}d`:n>Jx?`${Math.floor(n/Jx)}h`:n>Zx?`${Math.floor(n/Zx)}m`:`${Math.floor(n)}s`}function Qx(n){const e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};n!==void 0&&(e.timeZone=n);let t=null;try{t=new Intl.DateTimeFormat("en",e)}catch{console.error("","","Timezone is error!!!")}return t}const vP=Qx()||new Intl.DateTimeFormat("en");let Iv=vP;function ck(n){function e(t,s,o){if(!t||isNaN(t)||t<=0)return new Date().toISOString().slice(0,19).replace("T"," ");if(o===D_.Crosshair&&s)return gg(Iv,t,s);switch(n){case"second":return o===D_.XAxis?gg(Iv,t,"HH:mm:ss"):gg(Iv,t,"YYYY-MM-DD HH:mm:ss");case"minute":return o===D_.XAxis?gg(Iv,t,"HH:mm"):gg(Iv,t,"YYYY-MM-DD HH:mm");case"hour":return o===D_.XAxis?gg(Iv,t,"MM-DD HH:mm"):gg(Iv,t,"YYYY-MM-DD HH:mm");case"day":case"week":return gg(Iv,t,"YYYY-MM-DD");case"month":return o===D_.XAxis?gg(Iv,t,"YYYY-MM"):gg(Iv,t,"YYYY-MM-DD");case"year":return o===D_.XAxis?gg(Iv,t,"YYYY"):gg(Iv,t,"YYYY-MM-DD")}return gg(Iv,t,"YYYY-MM-DD HH:mm")}return e}async function uk(n){let e=(n||"").trim();if(e&&(e==="Africa/Abidjan"||e.toLowerCase().indexOf("utc")>=0)&&(e="UTC"),!e)try{e=yp.tz.guess()}catch{try{e=Intl.DateTimeFormat().resolvedOptions().timeZone}catch{}}e||(e="UTC"),yp.tz.setDefault(e),Kw=e,Yw=!0;const t=Qx(e)||Qx()||Iv;t&&(Iv=t)}function gP(){return Object.entries(fP).map(([n,e])=>({key:n,text:e}))}const _P=()=>"Time",yP=()=>"时间",bP=(n={},e={})=>({en:_P,"zh-CN":yP})[e.languageTag??uo()](),xP=()=>"O",wP=()=>"开",kP=(n={},e={})=>({en:xP,"zh-CN":wP})[e.languageTag??uo()](),SP=()=>"H",CP=()=>"高",IP=(n={},e={})=>({en:SP,"zh-CN":CP})[e.languageTag??uo()](),PP=()=>"L",MP=()=>"低",NP=(n={},e={})=>({en:PP,"zh-CN":MP})[e.languageTag??uo()](),AP=()=>"C",TP=()=>"收",FP=(n={},e={})=>({en:AP,"zh-CN":TP})[e.languageTag??uo()](),LP=()=>"vol",EP=()=>"量",$P=(n={},e={})=>({en:LP,"zh-CN":EP})[e.languageTag??uo()](),DP=()=>"Chg",RP=()=>"涨跌",jP=(n={},e={})=>({en:DP,"zh-CN":RP})[e.languageTag??uo()](),BP=()=>"Timeframe",OP=()=>"周期",o4=(n={},e={})=>({en:BP,"zh-CN":OP})[e.languageTag??uo()](),zP=()=>"No Data",VP=()=>"数据为空",WP=(n={},e={})=>({en:zP,"zh-CN":VP})[e.languageTag??uo()](),HP=()=>"Indicator",qP=()=>"指标",Xw=(n={},e={})=>({en:HP,"zh-CN":qP})[e.languageTag??uo()](),UP=()=>"Timezone",GP=()=>"时区",i4=(n={},e={})=>({en:UP,"zh-CN":GP})[e.languageTag??uo()](),YP=()=>"Setting",KP=()=>"设置",XP=(n={},e={})=>({en:YP,"zh-CN":KP})[e.languageTag??uo()](),ZP=()=>"Confirm",JP=()=>"确认",QP=(n={},e={})=>({en:ZP,"zh-CN":JP})[e.languageTag??uo()](),eM=()=>"Cancel",tM=()=>"取消",nM=(n={},e={})=>({en:eM,"zh-CN":tM})[e.languageTag??uo()](),sM=()=>"Search Symbol",oM=()=>"搜索品种",r4=(n={},e={})=>({en:sM,"zh-CN":oM})[e.languageTag??uo()](),iM=()=>"This indicator has no parameters",rM=()=>"该指标没有参数",a4=(n={},e={})=>({en:iM,"zh-CN":rM})[e.languageTag??uo()](),aM=()=>"Search",lM=()=>"搜索",l4=(n={},e={})=>({en:aM,"zh-CN":lM})[e.languageTag??uo()](),cM=()=>"Settings",uM=()=>"设置",c4=(n={},e={})=>({en:cM,"zh-CN":uM})[e.languageTag??uo()](),dM=()=>"Screenshot",fM=()=>"截图",pM=(n={},e={})=>({en:dM,"zh-CN":fM})[e.languageTag??uo()](),mM=()=>"Grid Show",hM=()=>"显示网格",vM=(n={},e={})=>({en:mM,"zh-CN":hM})[e.languageTag??uo()](),gM=()=>"Restore",_M=()=>"恢复",yM=(n={},e={})=>({en:gM,"zh-CN":_M})[e.languageTag??uo()](),bM=()=>"Reset",xM=()=>"重置",wM=(n={},e={})=>({en:bM,"zh-CN":xM})[e.languageTag??uo()](),kM=()=>"Candlestick Type",SM=()=>"蜡烛图类型",CM=(n={},e={})=>({en:kM,"zh-CN":SM})[e.languageTag??uo()](),IM=()=>"Candlestick",PM=()=>"全实心",MM=(n={},e={})=>({en:IM,"zh-CN":PM})[e.languageTag??uo()](),NM=()=>"Hollow",AM=()=>"全空心",TM=(n={},e={})=>({en:NM,"zh-CN":AM})[e.languageTag??uo()](),FM=()=>"Up Hollow",LM=()=>"涨空心",EM=(n={},e={})=>({en:FM,"zh-CN":LM})[e.languageTag??uo()](),$M=()=>"Down Hollow",DM=()=>"跌空心",RM=(n={},e={})=>({en:$M,"zh-CN":DM})[e.languageTag??uo()](),jM=()=>"OHLC",BM=()=>"OHLC",OM=(n={},e={})=>({en:jM,"zh-CN":BM})[e.languageTag??uo()](),zM=()=>"Area",VM=()=>"面积图",WM=(n={},e={})=>({en:zM,"zh-CN":VM})[e.languageTag??uo()](),HM=()=>"Price Axis Type",qM=()=>"价格轴类型",UM=(n={},e={})=>({en:HM,"zh-CN":qM})[e.languageTag??uo()](),GM=()=>"Reverse Coordinate",YM=()=>"反转坐标",KM=(n={},e={})=>({en:GM,"zh-CN":YM})[e.languageTag??uo()](),XM=()=>"Show Last Price",ZM=()=>"显示最新价",JM=(n={},e={})=>({en:XM,"zh-CN":ZM})[e.languageTag??uo()](),QM=()=>"Show High Price",eN=()=>"显示最高价",tN=(n={},e={})=>({en:QM,"zh-CN":eN})[e.languageTag??uo()](),nN=()=>"Show Low Price",sN=()=>"显示最低价",oN=(n={},e={})=>({en:nN,"zh-CN":sN})[e.languageTag??uo()](),iN=()=>"Show Indicator Last Value",rN=()=>"显示指标最新值",aN=(n={},e={})=>({en:iN,"zh-CN":rN})[e.languageTag??uo()](),lN=()=>"Param ",cN=()=>"参数",u4=(n={},e={})=>({en:lN,"zh-CN":cN})[e.languageTag??uo()](),uN=()=>"Period",dN=()=>"周期",ew=(n={},e={})=>({en:uN,"zh-CN":dN})[e.languageTag??uo()](),fN=()=>"StdDev",pN=()=>"标准差",d4=(n={},e={})=>({en:fN,"zh-CN":pN})[e.languageTag??uo()](),mN=()=>"Normal",hN=()=>"正常",vN=(n={},e={})=>({en:mN,"zh-CN":hN})[e.languageTag??uo()](),gN=()=>"Percentage",_N=()=>"百分比",yN=(n={},e={})=>({en:gN,"zh-CN":_N})[e.languageTag??uo()](),bN=()=>"Log",xN=()=>"对数",wN=(n={},e={})=>({en:bN,"zh-CN":xN})[e.languageTag??uo()](),kN=()=>" Bars",SN=()=>"根",f4=(n={},e={})=>({en:kN,"zh-CN":SN})[e.languageTag??uo()](),CN=()=>"days",IN=()=>"天",p4=(n={},e={})=>({en:CN,"zh-CN":IN})[e.languageTag??uo()](),PN=()=>"hours",MN=()=>"时",m4=(n={},e={})=>({en:PN,"zh-CN":MN})[e.languageTag??uo()](),NN=()=>"mins",AN=()=>"分",tw=(n={},e={})=>({en:NN,"zh-CN":AN})[e.languageTag??uo()](),TN=()=>"Minutes",FN=()=>"分钟",h4=(n={},e={})=>({en:TN,"zh-CN":FN})[e.languageTag??uo()](),LN=()=>"Hours",EN=()=>"小时",v4=(n={},e={})=>({en:LN,"zh-CN":EN})[e.languageTag??uo()](),$N=()=>"Days",DN=()=>"日",g4=(n={},e={})=>({en:$N,"zh-CN":DN})[e.languageTag??uo()](),RN=()=>"Weeks",jN=()=>"周",_4=(n={},e={})=>({en:RN,"zh-CN":jN})[e.languageTag??uo()](),BN=()=>"Months",ON=()=>"月",y4=(n={},e={})=>({en:BN,"zh-CN":ON})[e.languageTag??uo()](),zN=()=>"Horizontal Straight Line",VN=()=>"水平直线",WN=(n={},e={})=>({en:zN,"zh-CN":VN})[e.languageTag??uo()](),HN=()=>"Horizontal Ray Line",qN=()=>"水平射线",UN=(n={},e={})=>({en:HN,"zh-CN":qN})[e.languageTag??uo()](),GN=()=>"Horizontal Segment",YN=()=>"水平线段",KN=(n={},e={})=>({en:GN,"zh-CN":YN})[e.languageTag??uo()](),XN=()=>"Vertical Straight Line",ZN=()=>"垂直直线",JN=(n={},e={})=>({en:XN,"zh-CN":ZN})[e.languageTag??uo()](),QN=()=>"Vertical Ray Line",eA=()=>"垂直射线",tA=(n={},e={})=>({en:QN,"zh-CN":eA})[e.languageTag??uo()](),nA=()=>"Vertical Segment",sA=()=>"垂直线段",oA=(n={},e={})=>({en:nA,"zh-CN":sA})[e.languageTag??uo()](),iA=()=>"Straight Line",rA=()=>"直线",aA=(n={},e={})=>({en:iA,"zh-CN":rA})[e.languageTag??uo()](),lA=()=>"Ray Line",cA=()=>"射线",uA=(n={},e={})=>({en:lA,"zh-CN":cA})[e.languageTag??uo()](),dA=()=>"Segment",fA=()=>"线段",pA=(n={},e={})=>({en:dA,"zh-CN":fA})[e.languageTag??uo()](),mA=()=>"Arrow",hA=()=>"箭头",vA=(n={},e={})=>({en:mA,"zh-CN":hA})[e.languageTag??uo()](),gA=()=>"Price Line",_A=()=>"价格线",yA=(n={},e={})=>({en:gA,"zh-CN":_A})[e.languageTag??uo()](),bA=()=>"Price Channel Line",xA=()=>"价格通道线",wA=(n={},e={})=>({en:bA,"zh-CN":xA})[e.languageTag??uo()](),kA=()=>"Parallel Straight Line",SA=()=>"平行直线",CA=(n={},e={})=>({en:kA,"zh-CN":SA})[e.languageTag??uo()](),IA=()=>"Fibonacci Retracement Segment",PA=()=>"斐波那契回调线段",MA=(n={},e={})=>({en:IA,"zh-CN":PA})[e.languageTag??uo()](),NA=()=>"Fibonacci Circle",AA=()=>"斐波那契圆环",TA=(n={},e={})=>({en:NA,"zh-CN":AA})[e.languageTag??uo()](),FA=()=>"Fibonacci Spiral",LA=()=>"斐波那契螺旋",EA=(n={},e={})=>({en:FA,"zh-CN":LA})[e.languageTag??uo()](),$A=()=>"Fibonacci Speed Resistance Fan",DA=()=>"斐波那契速度阻力扇",RA=(n={},e={})=>({en:$A,"zh-CN":DA})[e.languageTag??uo()](),jA=()=>"Fibonacci Extension",BA=()=>"斐波那契趋势扩展",OA=(n={},e={})=>({en:jA,"zh-CN":BA})[e.languageTag??uo()](),zA=()=>"Gann Box",VA=()=>"江恩箱",WA=(n={},e={})=>({en:zA,"zh-CN":VA})[e.languageTag??uo()](),HA=()=>"Rectangle",qA=()=>"矩形",UA=(n={},e={})=>({en:HA,"zh-CN":qA})[e.languageTag??uo()](),GA=()=>"Parallelogram",YA=()=>"平行四边形",KA=(n={},e={})=>({en:GA,"zh-CN":YA})[e.languageTag??uo()](),XA=()=>"Circle",ZA=()=>"圆",JA=(n={},e={})=>({en:XA,"zh-CN":ZA})[e.languageTag??uo()](),QA=()=>"Triangle",eT=()=>"三角形",tT=(n={},e={})=>({en:QA,"zh-CN":eT})[e.languageTag??uo()](),nT=()=>"Three Waves",sT=()=>"三浪",oT=(n={},e={})=>({en:nT,"zh-CN":sT})[e.languageTag??uo()](),iT=()=>"Five Waves",rT=()=>"五浪",aT=(n={},e={})=>({en:iT,"zh-CN":rT})[e.languageTag??uo()](),lT=()=>"Eight Waves",cT=()=>"八浪",uT=(n={},e={})=>({en:lT,"zh-CN":cT})[e.languageTag??uo()](),dT=()=>"Any Waves",fT=()=>"任意浪",pT=(n={},e={})=>({en:dT,"zh-CN":fT})[e.languageTag??uo()](),mT=()=>"ABCD Pattern",hT=()=>"ABCD形态",vT=(n={},e={})=>({en:mT,"zh-CN":hT})[e.languageTag??uo()](),gT=()=>"XABCD Pattern",_T=()=>"XABCD形态",yT=(n={},e={})=>({en:gT,"zh-CN":_T})[e.languageTag??uo()](),bT=()=>"Weak Magnet Mode",xT=()=>"弱磁模式",wT=(n={},e={})=>({en:bT,"zh-CN":xT})[e.languageTag??uo()](),kT=()=>"Strong Magnet Mode",ST=()=>"强磁模式",CT=(n={},e={})=>({en:kT,"zh-CN":ST})[e.languageTag??uo()](),IT=()=>"Moving Average",PT=()=>"移动平均",MT=(n={},e={})=>({en:IT,"zh-CN":PT})[e.languageTag??uo()](),NT=()=>"Exponential Moving Average",AT=()=>"指数移动平均",TT=(n={},e={})=>({en:NT,"zh-CN":AT})[e.languageTag??uo()](),FT=()=>"Simple Moving Average",LT=()=>"简单移动平均",ET=(n={},e={})=>({en:FT,"zh-CN":LT})[e.languageTag??uo()](),$T=()=>"Bollinger Bands",DT=()=>"布林线",RT=(n={},e={})=>({en:$T,"zh-CN":DT})[e.languageTag??uo()](),jT=()=>"Parabolic SAR",BT=()=>"抛物线转向",OT=(n={},e={})=>({en:jT,"zh-CN":BT})[e.languageTag??uo()](),zT=()=>"Bull and Bear Index",VT=()=>"多空指标",WT=(n={},e={})=>({en:zT,"zh-CN":VT})[e.languageTag??uo()](),HT=()=>"Volume",qT=()=>"成交量",UT=(n={},e={})=>({en:HT,"zh-CN":qT})[e.languageTag??uo()](),GT=()=>"Moving Average Convergence Divergence",YT=()=>"平滑异同移动平均线",KT=(n={},e={})=>({en:GT,"zh-CN":YT})[e.languageTag??uo()](),XT=()=>"KDJ Index",ZT=()=>"随机指标",JT=(n={},e={})=>({en:XT,"zh-CN":ZT})[e.languageTag??uo()](),QT=()=>"Relative Strength Index",eF=()=>"相对强弱指数",tF=(n={},e={})=>({en:QT,"zh-CN":eF})[e.languageTag??uo()](),nF=()=>"Bias",sF=()=>"乖离率",oF=(n={},e={})=>({en:nF,"zh-CN":sF})[e.languageTag??uo()](),iF=()=>"Bull and Bear Ratio",rF=()=>"人气意愿指标",aF=(n={},e={})=>({en:iF,"zh-CN":rF})[e.languageTag??uo()](),lF=()=>"Commodity Channel Index",cF=()=>"顺势指标",uF=(n={},e={})=>({en:lF,"zh-CN":cF})[e.languageTag??uo()](),dF=()=>"Energy",fF=()=>"能量指标",pF=(n={},e={})=>({en:dF,"zh-CN":fF})[e.languageTag??uo()](),mF=()=>"Psychological Line",hF=()=>"心理线",vF=(n={},e={})=>({en:mF,"zh-CN":hF})[e.languageTag??uo()](),gF=()=>"Parallel Line Difference",_F=()=>"平行线差指标",yF=(n={},e={})=>({en:gF,"zh-CN":_F})[e.languageTag??uo()](),bF=()=>"Triple Exponential Moving Average",xF=()=>"三重指数平滑移动平均线",wF=(n={},e={})=>({en:bF,"zh-CN":xF})[e.languageTag??uo()](),kF=()=>"On Balance Volume",SF=()=>"能量潮",CF=(n={},e={})=>({en:kF,"zh-CN":SF})[e.languageTag??uo()](),IF=()=>"Volume Variation Rate",PF=()=>"成交量变异率",MF=(n={},e={})=>({en:IF,"zh-CN":PF})[e.languageTag??uo()](),NF=()=>"Williams Percentage Range",AF=()=>"威廉指标",TF=(n={},e={})=>({en:NF,"zh-CN":AF})[e.languageTag??uo()](),FF=()=>"Momentum",LF=()=>"动量指标",EF=(n={},e={})=>({en:FF,"zh-CN":LF})[e.languageTag??uo()](),$F=()=>"Ease of Movement",DF=()=>"简易波动指标",RF=(n={},e={})=>({en:$F,"zh-CN":DF})[e.languageTag??uo()](),jF=()=>"Rate of Change",BF=()=>"变动率指标",OF=(n={},e={})=>({en:jF,"zh-CN":BF})[e.languageTag??uo()](),zF=()=>"Price Volume Trend",VF=()=>"量价趋势",WF=(n={},e={})=>({en:zF,"zh-CN":VF})[e.languageTag??uo()](),HF=()=>"Awesome Oscillator",qF=()=>"震荡指标",UF=(n={},e={})=>({en:HF,"zh-CN":qF})[e.languageTag??uo()](),GF=()=>"Directional Movement Index",YF=()=>"趋向指标",KF=(n={},e={})=>({en:GF,"zh-CN":YF})[e.languageTag??uo()](),XF=()=>"Coordinated Universal Time (UTC)",ZF=()=>"世界统一时间",JF=(n={},e={})=>({en:XF,"zh-CN":ZF})[e.languageTag??uo()](),QF=()=>"(UTC-10) Honolulu",eL=()=>"(UTC-10) 檀香山",tL=(n={},e={})=>({en:QF,"zh-CN":eL})[e.languageTag??uo()](),nL=()=>"(UTC-8) Juneau",sL=()=>"(UTC-8) 朱诺",oL=(n={},e={})=>({en:nL,"zh-CN":sL})[e.languageTag??uo()](),iL=()=>"(UTC-7) Los Angeles",rL=()=>"(UTC-7) 洛杉矶",aL=(n={},e={})=>({en:iL,"zh-CN":rL})[e.languageTag??uo()](),lL=()=>"(UTC-5) Chicago",cL=()=>"(UTC-5) 芝加哥",uL=(n={},e={})=>({en:lL,"zh-CN":cL})[e.languageTag??uo()](),dL=()=>"(UTC-4) Toronto",fL=()=>"(UTC-4) 多伦多",pL=(n={},e={})=>({en:dL,"zh-CN":fL})[e.languageTag??uo()](),mL=()=>"(UTC-3) São Paulo",hL=()=>"(UTC-3) 圣保罗",vL=(n={},e={})=>({en:mL,"zh-CN":hL})[e.languageTag??uo()](),gL=()=>"(UTC+1) London",_L=()=>"(UTC+1) 伦敦",yL=(n={},e={})=>({en:gL,"zh-CN":_L})[e.languageTag??uo()](),bL=()=>"(UTC+2) Berlin",xL=()=>"(UTC+2) 柏林",wL=(n={},e={})=>({en:bL,"zh-CN":xL})[e.languageTag??uo()](),kL=()=>"(UTC+3) Bahrain",SL=()=>"(UTC+3) 巴林",CL=(n={},e={})=>({en:kL,"zh-CN":SL})[e.languageTag??uo()](),IL=()=>"(UTC+4) Dubai",PL=()=>"(UTC+4) 迪拜",ML=(n={},e={})=>({en:IL,"zh-CN":PL})[e.languageTag??uo()](),NL=()=>"(UTC+5) Ashkhabad",AL=()=>"(UTC+5) 阿什哈巴德",TL=(n={},e={})=>({en:NL,"zh-CN":AL})[e.languageTag??uo()](),FL=()=>"(UTC+5) Almaty",LL=()=>"(UTC+5) 阿拉木图",EL=(n={},e={})=>({en:FL,"zh-CN":LL})[e.languageTag??uo()](),$L=()=>"(UTC+6) Dhaka",DL=()=>"(UTC+6) 达卡",RL=(n={},e={})=>({en:$L,"zh-CN":DL})[e.languageTag??uo()](),jL=()=>"(UTC+7) Bangkok",BL=()=>"(UTC+7) 曼谷",OL=(n={},e={})=>({en:jL,"zh-CN":BL})[e.languageTag??uo()](),zL=()=>"(UTC+8) Shanghai",VL=()=>"(UTC+8) 上海",WL=(n={},e={})=>({en:zL,"zh-CN":VL})[e.languageTag??uo()](),HL=()=>"(UTC+9) Tokyo",qL=()=>"(UTC+9) 东京",UL=(n={},e={})=>({en:HL,"zh-CN":qL})[e.languageTag??uo()](),GL=()=>"(UTC+10) Sydney",YL=()=>"(UTC+10) 悉尼",KL=(n={},e={})=>({en:GL,"zh-CN":YL})[e.languageTag??uo()](),XL=()=>"(UTC+11) Solomon Islands",ZL=()=>"(UTC+11) 所罗门群岛",JL=(n={},e={})=>({en:XL,"zh-CN":ZL})[e.languageTag??uo()](),QL=()=>"(UTC+12) Auckland",eE=()=>"(UTC+12) 奥克兰",tE=(n={},e={})=>({en:QL,"zh-CN":eE})[e.languageTag??uo()](),Og=Object.freeze(Object.defineProperty({__proto__:null,AO:UF,BBI:WT,BIAS:oF,BOLL:RT,BRAR:aF,CCI:uF,CR:pF,DMA:yF,DMI:KF,EMA:TT,EMV:RF,KDJ:JT,MA:MT,MACD:KT,MTM:EF,OBV:CF,PSY:vF,PVT:WF,ROC:OF,RSI:tF,SAR:OT,SMA:ET,TRIX:wF,VOL:UT,VR:MF,WR:TF,abcd:vT,almaty:EL,any_waves:pT,area:WM,arrow:vA,ashkhabad:TL,auckland:tE,bahrain:CL,bangkok:OL,berlin:wL,cancel:nM,candle_down_stroke:RM,candle_solid:MM,candle_stroke:TM,candle_type:CM,candle_up_stroke:EM,change_:jP,chicago:uL,circle:JA,close_:FP,confirm:QP,day:g4,days:p4,dhaka:RL,dubai:ML,eight_waves:uT,fibonacci_circle:TA,fibonacci_extension:OA,fibonacci_segment:MA,fibonacci_speed_resistance_fan:RA,fibonacci_spiral:EA,five_waves:aT,gann_box:WA,grid_show:vM,guadalcanal:JL,high_:IP,high_price_show:tN,honolulu:tL,horizontal_ray_line:UN,horizontal_segment:KN,horizontal_straight_line:WN,hour:v4,hours:m4,indicator:Xw,indicator_last_value_show:aN,juneau:oL,last_price_show:JM,log:wN,london:yL,los_angeles:aL,low_:NP,low_price_show:oN,mins:tw,minute:h4,month:y4,no_data:WP,no_ind_params:a4,normal:vN,num_bar:f4,ohlc:OM,open_:kP,parallel_straight_line:CA,parallelogram:KA,param:u4,percentage:yN,period:ew,price_axis_type:UM,price_channel_line:wA,price_line:yA,ray_line:uA,rect:UA,reset:wM,restore:yM,reverse_coordinate:KM,sao_paulo:vL,screenshot:pM,search:l4,segment:pA,setting:XP,settings:c4,shanghai:WL,standard_deviation:d4,straight_line:aA,strongMagnet:CT,sydney:KL,symbol_search:r4,three_waves:oT,time_:bP,timeframe:o4,timezone:i4,tokyo:UL,toronto:pL,triangle:tT,utc:JF,vertical_ray_line:tA,vertical_segment:oA,vertical_straight_line:JN,volume_:$P,weakMagnet:wT,week:_4,xabcd:yT},Symbol.toStringTag,{value:"Module"})),nE=["MA","EMA","SMA","BOLL","SAR","BBI"],sE=["VOL","MACD","KDJ","RSI","BIAS","BRAR","CCI","DMI","CR","PSY","TRIX","OBV","VR","WR","MTM","EMV","ROC","PVT","AO"];class b4{constructor(){Te(this,"editPaneId");Te(this,"editIndName");Te(this,"modalIndCfg");Te(this,"fireOhlcv");Te(this,"dutyLoaded");Te(this,"cloudIndLoaded");Te(this,"initDone");Te(this,"clickChart");Te(this,"loadingDuty");Te(this,"loadingPairs");Te(this,"timeStart");Te(this,"timeEnd");Te(this,"allInds");Te(this,"isApplyingManualStyles");Te(this,"applyCanvasColors");Te(this,"clearCciGroups");Te(this,"clearEmvGroups");Te(this,"clearMtmGroups");Te(this,"clearObvGroups");Te(this,"clearPsyGroups");Te(this,"clearPvtGroups");Te(this,"clearRocGroups");Te(this,"clearVolGroups");Te(this,"clearWrGroups");this.editPaneId="",this.editIndName="",this.modalIndCfg=!1,this.fireOhlcv=0,this.dutyLoaded=0,this.cloudIndLoaded=0,this.initDone=0,this.clickChart=0,this.loadingDuty=!1,this.loadingPairs=!1,this.timeStart=0,this.timeEnd=0,this.allInds=[],this.isApplyingManualStyles=!1,this.clearCciGroups=0,this.clearEmvGroups=0,this.clearMtmGroups=0,this.clearObvGroups=0,this.clearPsyGroups=0,this.clearPvtGroups=0,this.clearRocGroups=0,this.clearVolGroups=0,this.clearWrGroups=0;for(let e of nE){const t=`${e} (${Og[e]()})`;this.allInds.push({name:e,title:t,cloud:!1,is_main:!0})}for(let e of sE){const t=`${e} (${Og[e]()})`;this.allInds.push({name:e,title:t,cloud:!1,is_main:!1})}}}class Vb{constructor(){Te(this,"showDrawBar");Te(this,"showSidebar");Te(this,"period");Te(this,"symbol");Te(this,"dateStart");Te(this,"dateEnd");Te(this,"timezone");Te(this,"curSymbols");Te(this,"allSymbols");Te(this,"allExgs");Te(this,"colorLong");Te(this,"colorShort");Te(this,"saveInds");Te(this,"key");Te(this,"theme");Te(this,"styles");Te(this,"options");this.showDrawBar=!0,this.showSidebar=!0,this.symbol={name:"Grameen Phone Limited",ticker:"GP",market:"stock",exchange:"DSEBD",type:"stock",priceCurrency:"BDT"},this.period={multiplier:1,timespan:"day",timeframe:"1d",secs:86400};const e=pP();this.dateEnd=lk(e,"YYYYMMDD");const t=e-this.period.secs*1e3*500;this.dateStart=lk(t,"YYYYMMDD"),this.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,this.curSymbols=[],this.allSymbols=[],this.allExgs=new Set,this.colorLong="#0000FF",this.colorShort="#FF0000",this.saveInds={},this.key="",this.theme="dark",this.styles={pane:{backgroundColor:"#0A0F1A"},candle:{pane:{backgroundColor:"#0A0F1A"},type:"candle_solid",bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",upBorderColor:"#26A69A",downBorderColor:"#EF5350",noChangeBorderColor:"#888888",upWickColor:"#26A69A",downWickColor:"#EF5350",noChangeWickColor:"#888888"},renko:{method:"ATR",atrLength:14,source:"close",wick:!1},pnf:{boxSizeMode:"absolute",boxSize:1,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"}},grid:{horizontal:{color:"#111B2B"},vertical:{color:"#111B2B"}}},this.options={enableRealtime:!1,datafeed:{sessionMode:"regular",adjustMode:"none"}}}}function nw(n,e){const t=e.x>n.x?0:1,s=Xv.getLinearSlopeIntercept(n,e);let o;s?o=Math.atan(s[0])+Math.PI*t:e.y>n.y?o=Math.PI/2:o=Math.PI/2*3;const r=ry({x:e.x-8,y:e.y+4},e,o),a=ry({x:e.x-8,y:e.y-4},e,o);return[{type:"line",attrs:{coordinates:[n,e]}},{type:"line",ignoreEvent:!0,attrs:{coordinates:[r,e,a]}}]}function ry(n,e,t){const s=(n.x-e.x)*Math.cos(t)-(n.y-e.y)*Math.sin(t)+e.x,o=(n.x-e.x)*Math.sin(t)+(n.y-e.y)*Math.cos(t)+e.y;return{x:s,y:o}}function sw(n,e){if(n.length>1){let t;const s=n[0],o=n[1];return s.x===o.x&&s.y!==o.y?s.y<o.y?t={x:s.x,y:e.height}:t={x:s.x,y:0}:s.x>o.x?t={x:0,y:Xv.getLinearYFromCoordinates(s,o,{x:0,y:s.y})}:t={x:e.width,y:Xv.getLinearYFromCoordinates(s,o,{x:e.width,y:s.y})},{coordinates:[s,t]}}return[]}function x4(n,e){const t=Math.abs(n.x-e.x),s=Math.abs(n.y-e.y);return Math.sqrt(t*t+s*s)}function Zw(n,e,t){let s=2;try{(t==null?void 0:t.isInCandle())??!0?s=2:s=4}catch{s=2}return s}const w4={name:"arrow",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length>1?nw(n[0],n[1]):[]},k4={name:"circle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{circle:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:n})=>{if(n.length>1){const e=x4(n[0],n[1]),t=[];return t.push({type:"circle",attrs:{...n[0],r:e+30},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),t.push({type:"circle",attrs:{...n[0],r:e},styles:{style:"stroke_fill"}}),t}return[]}},S4={name:"rect",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.1)"}},createPointFigures:({coordinates:n})=>{if(n.length>1){const e=[],s=[{x:n[0].x-30,y:n[0].y-30},{x:n[1].x+30,y:n[0].y-30},{x:n[1].x+30,y:n[1].y+30},{x:n[0].x-30,y:n[1].y+30}];return e.push({type:"polygon",attrs:{coordinates:s},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),e.push({type:"polygon",attrs:{coordinates:[n[0],{x:n[1].x,y:n[0].y},n[1],{x:n[0].x,y:n[1].y}]},styles:{style:"stroke_fill"}}),e}return[]}},C4={name:"parallelogram",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.1)"}},createPointFigures:({coordinates:n})=>{if(n.length===2)return[{type:"line",ignoreEvent:!0,attrs:{coordinates:n}}];if(n.length===3){const e={x:n[0].x+(n[2].x-n[1].x),y:n[2].y};return[{type:"polygon",attrs:{coordinates:[n[0],n[1],n[2],e]},styles:{style:"stroke_fill"}}]}return[]},performEventPressedMove:({points:n,performPointIndex:e,performPoint:t})=>{e<2&&(n[0].price=t.price,n[1].price=t.price)},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].price=t.price)}},I4={name:"triangle",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.1)"}},createPointFigures:({coordinates:n})=>[{type:"polygon",attrs:{coordinates:n},styles:{style:"stroke_fill"}}]},P4={name:"fibonacciCircle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,overlay:e})=>{var t,s,o,r;if(n.length>1){const a=Math.abs(n[0].x-n[1].x),l=Math.abs(n[0].y-n[1].y),c=Math.sqrt(a*a+l*l),f=[.236,.382,.5,.618,.786,1],u=[],d=[];return f.forEach(h=>{const m=c*h;u.push({...n[0],r:m}),d.push({x:n[0].x,y:n[0].y+m+6,text:`${(h*100).toFixed(1)}%`})}),[{type:"circle",attrs:u,styles:{style:"stroke",borderSize:((s=(t=e.styles)==null?void 0:t.line)==null?void 0:s.size)??2}},{type:"text",ignoreEvent:!0,attrs:d,styles:{color:((r=(o=e.styles)==null?void 0:o.line)==null?void 0:r.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}return[]}},oE=[{value:0,color:"#FF6B6B",visible:!0},{value:.236,color:"#4ECDC4",visible:!0},{value:.382,color:"#45B7D1",visible:!0},{value:.5,color:"#96CEB4",visible:!0},{value:.618,color:"#FFEAA7",visible:!0},{value:1,color:"#98D8C8",visible:!0},{value:1.618,color:"#85C1E9",visible:!0}],iE=15;function M4(n){return typeof n!="number"||Number.isNaN(n)?iE:Math.max(0,Math.min(100,n))}function rE(n){const e=(n||"").trim();if(!e)return null;if(/^#([0-9a-f]{6})$/i.test(e))return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)};if(/^#([0-9a-f]{3})$/i.test(e)){const s=e[1],o=e[2],r=e[3];return{r:parseInt(s+s,16),g:parseInt(o+o,16),b:parseInt(r+r,16)}}const t=e.match(/^rgba?\(([^)]+)\)$/i);if(t){const s=t[1].split(",").map(o=>parseFloat(o.trim()));if(s.length>=3&&s.every(o=>!Number.isNaN(o)))return{r:Math.round(s[0]),g:Math.round(s[1]),b:Math.round(s[2])}}return null}function aE(n,e){const t=rE(n);if(!t)return n;const s=M4(e)/100;return`rgba(${t.r}, ${t.g}, ${t.b}, ${s})`}const N4={name:"fibonacciSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{line:{size:1,color:"#1e88e5"},polygon:{color:"rgba(30, 136, 229, 0.1)"}},createPointFigures:({chart:n,coordinates:e,overlay:t,yAxis:s})=>{var a,l,c,f,u,d,h,m,g,w,C,P,I;const o=Zw(n,t,s),r=[];if(e.length>1){const A=t.points,M=(a=A[0])==null?void 0:a.value,F=(l=A[1])==null?void 0:l.value;if(M===void 0||F===void 0)return r;const B=F-M,$=e[0].y,L=e[1].y,O=L-$,ce=(((c=t.extendData)==null?void 0:c.fibonacciLevels)||t.fibonacciLevels||oE).filter(Ke=>Ke.visible);for(let Ke=0;Ke<ce.length-1;Ke++){const qe=ce[Ke],nt=ce[Ke+1],ft=L-O*qe.value,ut=L-O*nt.value,bt=M4(qe.opacity);r.push({type:"polygon",attrs:{coordinates:[{x:e[0].x,y:ft},{x:e[1].x,y:ft},{x:e[1].x,y:ut},{x:e[0].x,y:ut}]},styles:{style:"fill",color:aE(qe.color,bt)}})}const Q=[],le=[],ue=t.extendData||{},fe=String(ue.labelSide??ue.labelPosition??"left").trim().toLowerCase(),pe=ue.labelGap??ue.labelOffset??12,Z=typeof pe=="number"&&Number.isFinite(pe)?Math.max(0,pe):12,xe=String(ue.labelAlign||"").trim().toLowerCase(),oe=Math.min(e[0].x,e[1].x),Pe=Math.max(e[0].x,e[1].x),$e=fe==="right"?Pe+Z:oe-Z,ze=xe==="left"||xe==="center"||xe==="right"?xe:fe==="right"?"left":"right";ce.forEach(Ke=>{const qe=L-O*Ke.value,nt=(F-B*Ke.value).toFixed(o);Q.push({coordinates:[{x:e[0].x,y:qe},{x:e[1].x,y:qe}]}),le.push({x:$e,y:qe,text:`${(Ke.value*100).toFixed(1)}% (${nt})`,baseline:"middle",align:ze})}),r.push({type:"line",attrs:Q,styles:{size:24,color:"transparent"}}),r.push({type:"line",attrs:Q,styles:{size:((u=(f=t.styles)==null?void 0:f.line)==null?void 0:u.size)||1,color:((h=(d=t.styles)==null?void 0:d.line)==null?void 0:h.color)||"#1e88e5"}}),r.push({type:"text",ignoreEvent:!0,attrs:le,styles:{color:((g=(m=t.styles)==null?void 0:m.text)==null?void 0:g.color)||"#666666",backgroundColor:"transparent"}}),r.push({type:"line",attrs:{coordinates:[e[0],e[1]]},styles:{style:"solid",size:24,color:"transparent"}}),r.push({type:"line",attrs:{coordinates:[e[0],e[1]]},styles:{style:"dashed",size:((C=(w=t.styles)==null?void 0:w.line)==null?void 0:C.size)||1,color:((I=(P=t.styles)==null?void 0:P.line)==null?void 0:I.color)||"#1e88e5"}})}return r}},A4={name:"fibonacciSpiral",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{if(n.length>1){const t=x4(n[0],n[1])/Math.sqrt(24),s=n[1].x>n[0].x?0:1,o=Xv.getLinearSlopeIntercept(n[0],n[1]);let r;o?r=Math.atan(o[0])+Math.PI*s:n[1].y>n[0].y?r=Math.PI/2:r=Math.PI/2*3;const a=ry({x:n[0].x-t,y:n[0].y},n[0],r),l=ry({x:n[0].x-t,y:n[0].y-t},n[0],r),c=[{...a,r:t,startAngle:r,endAngle:r+Math.PI/2},{...l,r:t*2,startAngle:r+Math.PI/2,endAngle:r+Math.PI}];let f=n[0].x-t,u=n[0].y-t;for(let d=2;d<9;d++){const h=c[d-2].r+c[d-1].r;let m=0;switch(d%4){case 0:{m=r,f-=c[d-2].r;break}case 1:{m=r+Math.PI/2,u-=c[d-2].r;break}case 2:{m=r+Math.PI,f+=c[d-2].r;break}case 3:{m=r+Math.PI/2*3,u+=c[d-2].r;break}}const g=m+Math.PI/2,w=ry({x:f,y:u},n[0],r);c.push({...w,r:h,startAngle:m,endAngle:g})}return[{type:"arc",attrs:c,styles:{size:2}},{type:"line",attrs:sw(n,e),styles:{size:2}}]}return[]}},T4={name:"fibonacciSpeedResistanceFan",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e,overlay:t})=>{var a,l,c,f,u,d;const s=[];let o=[];const r=[];if(n.length>1){const h=n[1].x>n[0].x?-38:4,m=n[1].y>n[0].y?-2:20,g=n[1].x-n[0].x,w=n[1].y-n[0].y;[1,.75,.618,.5,.382,.25,0].forEach(P=>{const I=n[1].x-g*P,A=n[1].y-w*P;s.push({coordinates:[{x:I,y:n[0].y},{x:I,y:n[1].y}]}),s.push({coordinates:[{x:n[0].x,y:A},{x:n[1].x,y:A}]}),o=o.concat(sw([n[0],{x:I,y:n[1].y}],e)),o=o.concat(sw([n[0],{x:n[1].x,y:A}],e)),r.unshift({x:n[0].x+h,y:A+10,text:`${P.toFixed(3)}`}),r.unshift({x:I-18,y:n[0].y+m,text:`${P.toFixed(3)}`})})}return[{type:"line",attrs:s,styles:{size:((l=(a=t.styles)==null?void 0:a.line)==null?void 0:l.size)??2}},{type:"line",attrs:o,styles:{size:((f=(c=t.styles)==null?void 0:c.line)==null?void 0:f.size)??2}},{type:"text",ignoreEvent:!0,attrs:r,styles:{color:((d=(u=t.styles)==null?void 0:u.line)==null?void 0:d.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}},F4={name:"fibonacciExtension",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:n,coordinates:e,overlay:t,yAxis:s})=>{var l,c,f,u,d,h;const o=Zw(n,t,s),r=[],a=[];if(e.length>2){const m=t.points,g=m[1].value-m[0].value,w=e[1].y-e[0].y,C=[0,.236,.382,.5,.618,.786,1,1.618,2.618],I=Math.min(e[1].x,e[2].x)-16;C.forEach(A=>{const M=e[2].y+w*A,F=(m[2].value+g*A).toFixed(o);r.push({coordinates:[{x:e[1].x,y:M},{x:e[2].x,y:M}]}),a.push({x:I,y:M,text:`${F} (${(A*100).toFixed(1)}%)`,baseline:"middle",align:"right"})})}return[{type:"line",attrs:{coordinates:e},styles:{style:"dashed",size:((c=(l=t.styles)==null?void 0:l.line)==null?void 0:c.size)??2}},{type:"line",attrs:r,styles:{size:((u=(f=t.styles)==null?void 0:f.line)==null?void 0:u.size)??2}},{type:"text",ignoreEvent:!0,attrs:a,styles:{color:((h=(d=t.styles)==null?void 0:d.line)==null?void 0:h.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}},L4={name:"gannBox",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.1)"}},createPointFigures:({coordinates:n,overlay:e})=>{var t,s,o,r;if(n.length>1){const a=(n[1].y-n[0].y)/4,l=n[1].x-n[0].x,c=[{coordinates:[n[0],{x:n[1].x,y:n[1].y-a}]},{coordinates:[n[0],{x:n[1].x,y:n[1].y-a*2}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[1].x,y:n[0].y+a}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[1].x,y:n[0].y+a*2}]},{coordinates:[{...n[0]},{x:n[0].x+l*.236,y:n[1].y}]},{coordinates:[{...n[0]},{x:n[0].x+l*.5,y:n[1].y}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[0].x+l*.236,y:n[0].y}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[0].x+l*.5,y:n[0].y}]}],f=[{coordinates:[n[0],n[1]]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[1].x,y:n[0].y}]}];return[{type:"line",attrs:[{coordinates:[n[0],{x:n[1].x,y:n[0].y}]},{coordinates:[{x:n[1].x,y:n[0].y},n[1]]},{coordinates:[n[1],{x:n[0].x,y:n[1].y}]},{coordinates:[{x:n[0].x,y:n[1].y},n[0]]}]},{type:"polygon",attrs:{coordinates:[n[0],{x:n[1].x,y:n[0].y},n[1],{x:n[0].x,y:n[1].y}]},styles:{style:"fill"}},{type:"line",attrs:c,styles:{style:"dashed",size:((s=(t=e.styles)==null?void 0:t.line)==null?void 0:s.size)??1}},{type:"line",attrs:f,styles:{size:((r=(o=e.styles)==null?void 0:o.line)==null?void 0:r.size)??1}}]}return[]}},E4={name:"threeWaves",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=n.map((s,o)=>({...s,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:t}]}},$4={name:"fiveWaves",totalStep:7,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=n.map((s,o)=>({...s,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:t}]}},D4={name:"eightWaves",totalStep:10,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=n.map((s,o)=>({...s,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:t}]}},R4={name:"anyWaves",totalStep:Number.MAX_SAFE_INTEGER,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=n.map((s,o)=>({...s,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:t}]}},j4={name:"abcd",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{let t=[],s=[];const o=["A","B","C","D"],r=n.map((a,l)=>({...a,baseline:"bottom",text:`(${o[l]})`}));return n.length>2&&(t=[n[0],n[2]],n.length>3&&(s=[n[1],n[3]])),[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:[{coordinates:t},{coordinates:s}],styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"line",attrs:[{coordinates:t},{coordinates:s}],styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:r}]}},B4={name:"xabcd",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.1)"}},createPointFigures:({coordinates:n,overlay:e})=>{const s=[],o=[],r=["X","A","B","C","D"],a=n.map((l,c)=>({...l,baseline:"bottom",text:`(${r[c]})`}));return n.length>2&&(s.push({coordinates:[n[0],n[2]]}),o.push({coordinates:[n[0],n[1],n[2]]}),n.length>3&&(s.push({coordinates:[n[1],n[3]]}),n.length>4&&(s.push({coordinates:[n[2],n[4]]}),o.push({coordinates:[n[2],n[3],n[4]]})))),[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:s,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"line",attrs:s,styles:{style:"dashed"}},{type:"polygon",attrs:o},{type:"text",ignoreEvent:!0,attrs:a}]}};function lE(n,e,t,s){const o=e==="bottom"?1:-1,r=n.x,a=r+200,l=n.y+3*o,c=l+50*o,f=c+5*o,u=s?{color:s}:{},d=s?{backgroundColor:s,borderColor:s}:{};return[{type:"line",attrs:{coordinates:[{x:r,y:l},{x:r,y:c}]},ignoreEvent:!0},{type:"line",attrs:{coordinates:[{x:r,y:n.y},{x:a,y:n.y}]},ignoreEvent:!0,styles:{...u}},{type:"polygon",attrs:{coordinates:[{x:r,y:c},{x:r-4,y:f},{x:r+4,y:f}]},ignoreEvent:!0,styles:u},{type:"rectText",attrs:{x:r,y:f,text:t??"",align:"center",baseline:"bottom"},ignoreEvent:!0,styles:d}]}const O4={name:"barSignal",totalStep:2,createPointFigures:({overlay:n,coordinates:e})=>{let{postion:t,text:s,bgColor:o}=n.extendData,r=[];return e.forEach(a=>{r.push(...lE(a,t,s,o))}),r}};function cE(n){let o=[];if(n>86400){const r=Math.floor(n/86400);o.push(r.toString(),p4()),n=n%86400}if(n>3600){const r=Math.floor(n/3600);o.push(r.toString(),m4()),n=n%3600}if(n>60){const r=Math.floor(n/60);o.push(r.toString(),tw()),n=n%60}return n>0&&o.push("1",tw()),o.join("")}const z4={name:"ruler",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},onDeselected:n=>{var e;return(e=n.chart)==null||e.removeOverlay({id:n.overlay.id}),!0},createPointFigures:({chart:n,coordinates:e,overlay:t,yAxis:s})=>{const o=Zw(n,t,s);if(e.length>1){const r=e[0],a=e[1],l=(r.x+a.x)/2,c=(r.y+a.y)/2,f=nw({x:l,y:r.y},{x:l,y:a.y}),u=nw({x:r.x,y:c},{x:a.x,y:c}),d=r.y>a.y?"#F7525F":"#2962FF",h={color:"#ffffff",backgroundColor:d,borderColor:d,paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},m=t.points,g=m[0].value-m[1].value,w=g.toFixed(o),C=(g/m[0].value*100).toFixed(2),P=m[1].dataIndex-m[0].dataIndex,I=(m[1].timestamp-m[0].timestamp)/1e3,A=`${w} (${C}%)
${P}${f4()}, ${cE(I)}`;let M=a.y+10,F="top";r.y>a.y&&(M=a.y-10,F="bottom");const B=[],$=30,L=[{x:r.x-$,y:r.y-$},{x:a.x+$,y:r.y-$},{x:a.x+$,y:a.y+$},{x:r.x-$,y:a.y+$}];return B.push({type:"polygon",attrs:{coordinates:L},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),B.push({type:"polygon",attrs:{coordinates:[r,{x:a.x,y:r.y},a,{x:r.x,y:a.y}]},styles:{style:"stroke_fill"}}),B.push({type:"textBox",attrs:{x:l,y:M,text:A,align:"center",baseline:F},ignoreEvent:!0,styles:h}),B.push(...f),B.push(...u),B}return[]}},E1=(n,e)=>{try{const t=typeof window<"u"?window.drawBarRef:null,s=t==null?void 0:t[n];typeof s=="function"&&s(e)}catch{}},dk=n=>{try{typeof document<"u"&&(document.body.style.cursor=n)}catch{}},fk=n=>{try{typeof window<"u"&&(window.__overlayHover=n)}catch{}},pk={color:"#ffffff",paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},V4={name:"trade",lock:!1,zLevel:90,totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,overlay:e})=>{if(n.length<=1)return[];const t=e.extendData,s=n[0],o=n[1],r={size:.5};t&&t.line_color&&(r.color=t.line_color);const a=[],l={type:"line",attrs:{coordinates:[s,o]},styles:{color:"transparent",size:40},ignoreEvent:!1};a.push(l);const c={type:"line",attrs:{coordinates:[s,o]},styles:r};if(a.push(c),!t.active&&!t.selected)return a;const f=t.distance??15;let u="bottom",d=s.y-f,h="top",m=o.y+f;s.y>o.y&&(u="top",d=s.y+f,h="bottom",m=o.y-f);const g={type:"textBox",attrs:{x:s.x,y:d,text:t.in_text,align:"center",baseline:u},ignoreEvent:!0,styles:{...pk,backgroundColor:t.in_color,borderColor:t.in_color}},w={type:"textBox",attrs:{x:o.x,y:m,text:t.out_text,align:"center",baseline:h},ignoreEvent:!0,styles:{...pk,backgroundColor:t.out_color,borderColor:t.out_color}},C={type:"line",attrs:{coordinates:[s,{x:s.x,y:d}]},ignoreEvent:!0,styles:r},P={type:"line",attrs:{coordinates:[o,{x:o.x,y:m}]},ignoreEvent:!0,styles:r};return[l,c,g,w,C,P]},onSelected:n=>{const e=n.overlay.extendData;return e.selected=!0,E1("externalSelectOverlay",n.overlay),!0},onClick:n=>{const e=n.overlay.extendData;return e.selected=!0,E1("externalSelectOverlay",n.overlay),!0},onDeselected:n=>{const e=n.overlay.extendData;return e.selected=!1,E1("externalDeselectOverlay",n.overlay),!0},onMouseEnter:n=>{const e=n.overlay.extendData;return e.active=!0,fk(!0),dk("pointer"),!0},onMouseLeave:n=>{const e=n.overlay.extendData;return e.active=!1,fk(!1),dk(""),!0},onPressedMoveEnd:n=>(E1("externalSyncOverlay",n.overlay),!0),onRemoved:n=>(E1("externalRemoved",n.overlay.id),!0)},$1={color:"#ffffff",size:12,paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},lx=(n,e)=>{try{const t=n.extendData||{};t.selected=e,n.extendData=t}catch{}},D1=(n,e)=>{try{const t=typeof window<"u"?window.drawBarRef:null,s=t==null?void 0:t[n];typeof s=="function"&&s(e)}catch{}},mk=n=>{try{typeof document<"u"&&(document.body.style.cursor=n)}catch{}},hk=n=>{try{typeof window<"u"&&(window.__overlayHover=n)}catch{}},W4={name:"note",lock:!1,zLevel:100,totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,overlay:e})=>{if(n.length==0)return[];const t=e.extendData,s=n[0],o={size:.5};t&&t.line_color&&(o.color=t.line_color);const r=t.distance??15,a=typeof t.offsetX=="number"?t.offsetX:0,l=typeof t.offsetY=="number"?t.offsetY:0;let c="bottom",f=s.y-r+l;const u=t.align||(a>0?"left":a<0?"right":"center"),d=(t==null?void 0:t.in_text)??"",h={type:"textBox",attrs:{x:s.x+a,y:f,text:d,align:u,baseline:c},ignoreEvent:!1,styles:{...$1,backgroundColor:t.in_color,borderColor:t.in_color}},m=12,g=Math.round(m*1.4),w=Xv.calcTextWidth(d,m),C=Math.max(36,w+($1.paddingLeft+$1.paddingRight)+12),P=Math.max(18,g+($1.paddingTop+$1.paddingBottom)),I=u==="left"?s.x+a:u==="right"?s.x+a-C:s.x+a-C/2,A=c==="top"?f:c==="bottom"?f-P:f-P/2,M={type:"rect",attrs:{x:I,y:A,width:C,height:P},ignoreEvent:!1,styles:{style:"fill",color:"transparent"}},F={type:"line",attrs:{coordinates:[s,{x:s.x+a,y:f}]},ignoreEvent:!0,styles:o};return[M,h,F]},onSelected:n=>{var e;return lx(n.overlay,!0),(e=n.chart)==null||e.overrideOverlay({id:n.overlay.id,extendData:n.overlay.extendData}),D1("externalSelectOverlay",n.overlay),!0},onClick:n=>{var e;return lx(n.overlay,!0),(e=n.chart)==null||e.overrideOverlay({id:n.overlay.id,extendData:n.overlay.extendData}),D1("externalSelectOverlay",n.overlay),!0},onDeselected:n=>{var e;return lx(n.overlay,!1),(e=n.chart)==null||e.overrideOverlay({id:n.overlay.id,extendData:n.overlay.extendData}),D1("externalDeselectOverlay",n.overlay),!0},onPressedMoveEnd:n=>(D1("externalSyncOverlay",n.overlay),!0),onRemoved:n=>(D1("externalRemoved",n.overlay.id),!0),onMouseEnter:()=>(hk(!0),mk("pointer"),!0),onMouseLeave:()=>(hk(!1),mk(""),!0)},H4={name:"emoji",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,styles:{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}},createPointFigures:({coordinates:n,overlay:e})=>{if(n.length===0)return[];const t=e.extendData;if(!t||!t.emoji)return[];const s=n[0],o=t.size||24;t.rotation;const r=t.selected||!1;t.active;const a=[],l=e.styles||{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}},c={type:"text",attrs:{x:s.x,y:s.y,text:t.emoji,align:"center",baseline:"middle"},styles:{size:o,family:"Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, sans-serif",weight:"normal",backgroundColor:"transparent"}};if(a.push(c),r){const f=o/2,u=4,d={type:"rect",attrs:{x:s.x-f-u,y:s.y-f-u,width:o+u*2,height:o+u*2},styles:{stroke:l.box.stroke,strokeWidth:l.box.width,fill:"transparent",backgroundColor:"transparent"}};a.push(d);const h=l.handles.size,m=f+u;[{x:s.x-m-h/2,y:s.y-m-h/2},{x:s.x+m-h/2,y:s.y-m-h/2},{x:s.x-m-h/2,y:s.y+m-h/2},{x:s.x+m-h/2,y:s.y+m-h/2}].forEach(w=>{const C={type:"rect",attrs:{x:w.x,y:w.y,width:h,height:h},styles:{fill:l.handles.fill,stroke:l.handles.stroke,strokeWidth:1,backgroundColor:"transparent"}};a.push(C)})}return a},onDrawStart:n=>!0,onDrawing:n=>!0,onDrawEnd:n=>!0,onPressedMoveStart:n=>!0,onPressedMoving:n=>!0,onPressedMoveEnd:n=>!0,onSelected:n=>{const e=n.overlay.extendData;return e&&(e.selected=!0),!1},onDeselected:n=>{const e=n.overlay.extendData;return e&&(e.selected=!1),!1},onMouseEnter:n=>{const e=n.overlay.extendData;return e&&(e.active=!0),!1},onMouseLeave:n=>{const e=n.overlay.extendData;return e&&(e.active=!1),!1}},c_="Add text";class uE{constructor(){Te(this,"editor",null);Te(this,"chart",null);Te(this,"overlay",null);Te(this,"pos",{x:0,y:0});Te(this,"raf",null);Te(this,"lastCommitted","");Te(this,"boundPointerHandler",null);Te(this,"boundKeydownShield",null);Te(this,"placeholderCssInjected",!1)}startEditing(e,t){var s;this.chart=e,this.overlay=t,this.lastCommitted=((s=t.extendData)==null?void 0:s.text)??"",this.ensureEditor(),this.updateOverlayEditing(!0),this.syncPosition(),this.addOutsideListeners(),this.addKeydownShield(),setTimeout(()=>{var a,l;(a=this.editor)==null||a.focus();const o=((l=t.extendData)==null?void 0:l.text)??"",r=!o||o===c_;this.editor&&(this.editor.innerText=r?"":o,this.editor.setAttribute("data-placeholder",c_),this.editor.classList.add("kc-inline-text-editor"),this.injectPlaceholderCss());try{const c=window.getSelection();if(c&&this.editor){const f=this.editor.innerText.length;this.editor.firstChild&&c.collapse(this.editor.firstChild,Math.min(f,(this.editor.firstChild.textContent||"").length))}}catch{}},0),this.loop()}reEdit(e,t){this.startEditing(e,t)}updateEditorStyle(e){e&&(this.overlay=e),this.applyStylesFromOverlay()}ensureEditor(){if(this.editor)return;const e=document.createElement("div");e.contentEditable="true",e.style.position="fixed",e.style.zIndex="10000",e.style.outline="none",e.style.padding="8px",e.style.whiteSpace="pre-wrap",e.style.wordBreak="break-word",e.style.userSelect="text",e.style.transform="translate(0, -50%)",e.style.boxSizing="border-box",e.addEventListener("keydown",t=>this.onKeyDown(t)),e.addEventListener("input",()=>this.onInput()),e.addEventListener("blur",()=>this.commit()),document.body.appendChild(e),this.editor=e,this.applyStylesFromOverlay()}applyStylesFromOverlay(){var c;if(!this.editor||!this.overlay)return;const e=this.overlay.extendData||{},t=((c=this.overlay.styles)==null?void 0:c.text)||{},s=e.fontSize??t.size??32,o=e.fontWeight??t.weight??"bold",r=e.textColor??t.color??"#FFFFFF",a=e.backgroundColor??t.backgroundColor??"#00000033",l=e.fontFamily??t.family??'system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif';this.editor.style.fontSize=`${s}px`,this.editor.style.lineHeight=`${Math.round(s*1.4)}px`,this.editor.style.fontWeight=o,this.editor.style.color=r,this.editor.style.background=a,this.editor.style.border="none",this.editor.style.fontFamily=l,this.editor.style.minWidth="0px",this.editor.style.minHeight=`${Math.round(s*1.4)}px`}loop(){this.raf&&cancelAnimationFrame(this.raf);const e=()=>{this.syncPosition(),this.raf=requestAnimationFrame(e)};this.raf=requestAnimationFrame(e)}syncPosition(){var s;if(!this.chart||!this.overlay||!((s=this.overlay.points)!=null&&s.length))return;const e=this.overlay.paneId||"candle_pane",t=this.chart.convertToPixel(this.overlay.points[0],{paneId:e});t&&typeof t.x=="number"&&typeof t.y=="number"&&(this.pos={x:t.x,y:t.y},this.editor&&(this.editor.style.left=`${this.pos.x}px`,this.editor.style.top=`${this.pos.y}px`))}addOutsideListeners(){if(this.boundPointerHandler)return;const e=t=>{const s=t.target;if(!this.editor||s&&this.editor.contains(s))return;const o=s;o&&(o.closest(".context-menu-container")||o.closest(".premium-submenu"))||this.finishFromOutside()};this.boundPointerHandler=e,document.addEventListener("pointerdown",e,{capture:!0}),document.addEventListener("touchstart",e,{capture:!0}),document.addEventListener("mousedown",e,{capture:!0})}removeOutsideListeners(){this.boundPointerHandler&&(document.removeEventListener("pointerdown",this.boundPointerHandler,{capture:!0}),document.removeEventListener("touchstart",this.boundPointerHandler,{capture:!0}),document.removeEventListener("mousedown",this.boundPointerHandler,{capture:!0}),this.boundPointerHandler=null)}addKeydownShield(){if(this.boundKeydownShield)return;const e=t=>{if(!this.editor)return;const s=t.target;s&&(s===this.editor||this.editor.contains(s))&&t.stopPropagation()};this.boundKeydownShield=e,document.addEventListener("keydown",e,{capture:!0})}removeKeydownShield(){this.boundKeydownShield&&(document.removeEventListener("keydown",this.boundKeydownShield,{capture:!0}),this.boundKeydownShield=null)}finishFromOutside(){if(!this.editor)return;const e=this.editor.innerText||"";try{this.editor.blur()}catch{}!e||e===c_?this.deleteOverlay():this.commit()}onKeyDown(e){var t;if(e.stopPropagation(),e.key==="Escape"){e.preventDefault();const s=(((t=this.editor)==null?void 0:t.innerText)||"").trim();!s||s===c_?this.deleteOverlay():this.revert()}e.key==="Backspace"||e.key==="Delete"||e.key}onInput(){if(!this.editor||!this.chart||!this.overlay)return;this.editor.innerText.length>0?this.editor.setAttribute("data-placeholder",c_):this.editor.setAttribute("data-placeholder",c_);const e=Math.max(12,this.editor.scrollWidth),t=Math.max(this.editor.scrollHeight,Math.round(parseInt(this.editor.style.lineHeight)||32)),s=getComputedStyle(this.editor),o=parseFloat(s.paddingLeft||"0")+parseFloat(s.paddingRight||"0"),r=parseFloat(s.paddingTop||"0")+parseFloat(s.paddingBottom||"0"),a=Math.max(0,e-o),l=Math.max(0,t-r),c={...this.overlay.extendData||{},text:this.editor.innerText,boxWidth:e,boxHeight:t,contentWidth:a,contentHeight:l};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:c})}catch{}}updateOverlayEditing(e){if(!this.chart||!this.overlay)return;const t={...this.overlay.extendData||{},editing:e};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:t})}catch{}}commit(){var c;if(!this.chart||!this.overlay){this.cleanup();return}const e=((c=this.editor)==null?void 0:c.innerText)||"";if(!e||e===c_){this.deleteOverlay();return}this.lastCommitted=e;const t=this.editor?Math.max(12,this.editor.scrollWidth):void 0,s=this.editor?Math.max(this.editor.scrollHeight,Math.round(parseInt(this.editor.style.lineHeight)||32)):void 0,o=this.editor?getComputedStyle(this.editor):null,r=o?parseFloat(o.paddingLeft||"0")+parseFloat(o.paddingRight||"0"):0,a=o?parseFloat(o.paddingTop||"0")+parseFloat(o.paddingBottom||"0"):0,l={...this.overlay.extendData||{},text:e,editing:!1,...t?{boxWidth:t}:{},...s?{boxHeight:s}:{},...t?{contentWidth:Math.max(0,t-r)}:{},...s?{contentHeight:Math.max(0,s-a)}:{}};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:l})}catch{}this.cleanup()}revert(){if(!this.chart||!this.overlay){this.cleanup();return}const e={...this.overlay.extendData||{},text:this.lastCommitted,editing:!1};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:e})}catch{}this.cleanup()}deleteOverlay(){var e;if(!this.chart||!this.overlay){this.cleanup();return}try{(e=this.editor)==null||e.blur()}catch{}try{this.chart.removeOverlay({id:this.overlay.id})}catch{}this.cleanup()}cleanup(){if(this.raf&&cancelAnimationFrame(this.raf),this.raf=null,this.overlay=null,this.removeOutsideListeners(),this.removeKeydownShield(),this.editor)try{this.editor.remove()}catch{}this.editor=null}getEditorRect(){try{return this.editor?this.editor.getBoundingClientRect():null}catch{return null}}injectPlaceholderCss(){if(!this.placeholderCssInjected)try{const e="kc-inline-text-editor-placeholder-style";if(document.getElementById(e)){this.placeholderCssInjected=!0;return}const t=document.createElement("style");t.id=e,t.textContent=`
        .kc-inline-text-editor:empty::before {
          content: attr(data-placeholder);
          color: rgba(255,255,255,0.6);
        }
      `,document.head.appendChild(t),this.placeholderCssInjected=!0}catch{}}}const T0=new uE,vk="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif",ub=new Map,dE=4,q4={name:"text",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,zLevel:100,styles:{text:{color:"#FFFFFF",backgroundColor:"#00000033",borderColor:"#1677FF",size:32,weight:"bold",family:vk,paddingLeft:8,paddingRight:8,paddingTop:8,paddingBottom:8,borderSize:1},box:{stroke:"#1677FF",width:1,fill:"transparent"},handles:{size:6,fill:"#1677FF",stroke:"#1677FF"}},createPointFigures:({coordinates:n,overlay:e})=>{var fe,pe,Z,xe,oe,Pe,$e,ze,Ke,qe,nt,ft,ut,bt,Pt,Et,Mt,Je;if(n.length===0)return[];const t=n[0],s=e.extendData||{},o=!!s.editing,r=s.text??"",a=s.fontSize??((pe=(fe=e.styles)==null?void 0:fe.text)==null?void 0:pe.size)??32,l=s.fontWeight??((xe=(Z=e.styles)==null?void 0:Z.text)==null?void 0:xe.weight)??"bold",c=s.fontFamily??((Pe=(oe=e.styles)==null?void 0:oe.text)==null?void 0:Pe.family)??vk,f=s.textColor??((ze=($e=e.styles)==null?void 0:$e.text)==null?void 0:ze.color)??"#FFFFFF",u=s.backgroundColor??((qe=(Ke=e.styles)==null?void 0:Ke.text)==null?void 0:qe.backgroundColor)??"#00000033",d=((ft=(nt=e.styles)==null?void 0:nt.text)==null?void 0:ft.paddingLeft)??8,h=((bt=(ut=e.styles)==null?void 0:ut.text)==null?void 0:bt.paddingRight)??8,m=((Et=(Pt=e.styles)==null?void 0:Pt.text)==null?void 0:Et.paddingTop)??4,g=((Je=(Mt=e.styles)==null?void 0:Mt.text)==null?void 0:Je.paddingBottom)??4;if(o)return[];if(!(r&&r.length>0&&r!=="Add text"))return[];const C=Math.round(a*1.4),P=String(r).split(/\r?\n/),I=P.map(Ct=>Xv.calcTextWidth(Ct,a,l,c)),M=I.length?Math.max(...I):Xv.calcTextWidth(r,a,l,c),F=(P.length||1)*C,B=M+d+h,$=F+m+g,L=B,O=$,Y=t.x,ce=t.y-Math.round(O/2),Q=[];Q.push({type:"rect",attrs:{x:Y,y:ce,width:L,height:O},styles:{style:V_.Fill,color:u,borderColor:"transparent",borderSize:0}});const le=Y+Math.round(L/2),ue=ce+m+Math.round(C/2);return P.forEach((Ct,Ze)=>{const Xe=ue+Ze*C;Q.push({type:"text",attrs:{x:le,y:Xe,text:Ct,align:"center",baseline:"middle"},styles:{size:a,family:c,weight:l,color:f,backgroundColor:"transparent"}})}),Q},onSelected:n=>{var t;const e=n.overlay.extendData||{};e.selected=!0,(t=n.chart)==null||t.overrideOverlay({id:n.overlay.id,extendData:e});try{typeof navigator<"u"&&(navigator.maxTouchPoints||0)>0&&n.chart&&T0.startEditing(n.chart,n.overlay)}catch{}return!0},onClick:n=>{var t;const e=n.overlay.extendData||{};return e.editing||n.overlay.lock||(e.selected=!0,(t=n.chart)==null||t.overrideOverlay({id:n.overlay.id,extendData:e}),n.chart&&T0.startEditing(n.chart,n.overlay)),!0},onDeselected:n=>{var t;const e=n.overlay.extendData||{};return e.selected=!1,(t=n.chart)==null||t.overrideOverlay({id:n.overlay.id,extendData:e}),!0},onPressedMoveStart:n=>{var o;const e=n.overlay.extendData||{};if(e.editing||n.overlay.lock)return!1;const t=(o=n.overlay)==null?void 0:o.id;t&&typeof n.x=="number"&&typeof n.y=="number"&&ub.set(t,{x:n.x,y:n.y,moved:!1});const s=n.overlay.paneId;try{const r=n.chart.convertToPixel(n.overlay.points[0],{paneId:s});r&&typeof n.x=="number"&&typeof n.y=="number"&&(e.__dragOffX=n.x-(r.x||0),e.__dragOffY=n.y-(r.y||0),n.chart.overrideOverlay({id:n.overlay.id,extendData:e}))}catch{}return!0},onPressedMoving:n=>{var f;const e=n.overlay.extendData||{};if(e.editing||n.overlay.lock)return!1;const t=(f=n.overlay)==null?void 0:f.id,s=t?ub.get(t):null;if(s&&!s.moved&&typeof n.x=="number"&&typeof n.y=="number"){const u=n.x-s.x,d=n.y-s.y;Math.hypot(u,d)>dE&&(s.moved=!0)}const o=e.__dragOffX||0,r=e.__dragOffY||0,a=n.overlay.paneId;if(typeof n.x!="number"||typeof n.y!="number")return!0;const l=n.x-o,c=n.y-r;try{const u=n.chart.convertFromPixel([{x:l,y:c}],{paneId:a}),d=Array.isArray(u)?u[0]:u;d&&n.chart.overrideOverlay({id:n.overlay.id,points:[{timestamp:d.timestamp,value:d.value}]})}catch{}return!0},onPressedMoveEnd:n=>{var o;const e=n.overlay.extendData||{};if(e.editing||n.overlay.lock)return!1;const t=(o=n.overlay)==null?void 0:o.id,s=t?ub.get(t):null;if(t&&ub.delete(t),"__dragOffX"in e||"__dragOffY"in e){delete e.__dragOffX,delete e.__dragOffY;try{n.chart.overrideOverlay({id:n.overlay.id,extendData:e})}catch{}}return s&&!s.moved&&n.chart&&n.overlay&&T0.startEditing(n.chart,n.overlay),!0}};function fE(n,e){if(n.length>0){const t=n[0].y;return{coordinates:[{x:0,y:t},{x:e.width,y:t}]}}return{coordinates:[]}}function pE(n,e){if(n.length>1){const t=n[0].y,s=n[0],o=n[1];return s.x>o.x?{coordinates:[{x:0,y:t},s]}:{coordinates:[s,{x:e.width,y:t}]}}return{coordinates:[]}}const U4={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:({coordinates:n,overlay:e,bounding:t})=>{var l,c,f;if(n.length<1)return[];console.log("horizontalStraightLine createPointFigures called",{overlayId:e.id,hasExtendData:!!e.extendData,extendData:e.extendData,selected:e.selected===!0}),!e.extendData||typeof e.extendData!="object"?e.extendData={showDot:!1}:"showDot"in e.extendData||(e.extendData.showDot=!1);const s=e.extendData,o=s.interactive!==!1,r=[],a=fE(n,t);if(a.coordinates.length>0){r.push({type:"line",attrs:a,styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!o}),r.push({type:"line",attrs:a,ignoreEvent:!o});const u=e.selected===!0;if(s.showDot||u){const d=t.width/2,h=n[0].y,m=((c=(l=e.styles)==null?void 0:l.line)==null?void 0:c.color)||((f=e.styles)==null?void 0:f.color)||"#1677FF";console.log("Drawing dot for horizontalStraightLine:",{x:d,y:h,showDot:s.showDot,selected:u,color:m}),r.push({type:"circle",attrs:{x:d,y:h,r:6},styles:{style:"fill",color:m}}),r.push({type:"circle",attrs:{x:d,y:h,r:7},styles:{style:"stroke",color:"#ffffff",borderSize:2}})}}return r},createYAxisFigures:({chart:n,overlay:e,coordinates:t,yAxis:s,bounding:o})=>{var B,$,L,O,Y,ce;if(t.length<1||!e.points||e.points.length<1)return[];const r=(B=e.points[0])==null?void 0:B.value;if(r===void 0)return[];const a=n.getStyles(),l=a.yAxis,c=l.axisLine.show?l.axisLine.size:0,f=l.ticduty.show?l.ticduty.length:0,u=l.tickText.marginStart,d=l.tickText.marginEnd,h=1,g={...a.crosshair.horizontal.text};let w=0,C="left";if(($=s==null?void 0:s.isFromZero)!=null&&$.call(s))w=c+h,C="left",g.paddingLeft=f+u-h;else{w=((o==null?void 0:o.width)??0)-c-h,C="right";const Q=((o==null?void 0:o.width)??0)-c-h,le=((o==null?void 0:o.width)??0)-(l.axisLine.show?l.axisLine.size:0)-(l.ticduty.show?l.ticduty.length:0)-d;g.paddingRight=Q-le}const P=s.getRange();let I=s.displayValueToText(s.realValueToDisplayValue(s.valueToRealValue(r,{range:P}),{range:P}),((L=n.getSymbol())==null?void 0:L.pricePrecision)??2);I=n.getDecimalFold().format(n.getThousandsSeparator().format(I));const A=((Y=(O=e.styles)==null?void 0:O.line)==null?void 0:Y.color)||((ce=e.styles)==null?void 0:ce.color)||"#1677FF",M=E0(A,g.color),F=t[0].y;return typeof(o==null?void 0:o.height)=="number"&&(F<0||F>o.height)?[]:[{type:"text",attrs:{x:w,y:F,text:I,align:C,baseline:"middle"},styles:{...g,color:M,backgroundColor:A},ignoreEvent:!0}]},onClick:n=>{console.log("🟢 horizontalStraightLine onClick called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!e.showDot,console.log("✅ Toggled showDot to:",e.showDot,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onSelected:n=>{console.log("🟢 horizontalStraightLine onSelected called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!0,console.log("✅ Set showDot to true:",e,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onDeselected:n=>{console.log("🔴 horizontalStraightLine onDeselected called"),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!1,n.chart&&n.chart.overrideOverlay({id:n.overlay.id,extendData:e}),!0}},G4={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:({coordinates:n,overlay:e,bounding:t})=>{var a,l,c;if(n.length<2)return[];console.log("horizontalRayLine createPointFigures called",{overlayId:e.id,hasExtendData:!!e.extendData,extendData:e.extendData,selected:e.selected===!0}),!e.extendData||typeof e.extendData!="object"?e.extendData={showDot:!1}:"showDot"in e.extendData||(e.extendData.showDot=!1);const s=e.extendData,o=[],r=pE(n,t);if(r.coordinates.length>0){o.push({type:"line",attrs:r,styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),o.push({type:"line",attrs:r});const f=e.selected===!0;if(s.showDot||f){const u=n[0].x,d=n[0].y,h=((l=(a=e.styles)==null?void 0:a.line)==null?void 0:l.color)||((c=e.styles)==null?void 0:c.color)||"#1677FF";console.log("Drawing dot for horizontalRayLine:",{x:u,y:d,showDot:s.showDot,selected:f,color:h}),o.push({type:"circle",attrs:{x:u,y:d,r:6},styles:{style:"fill",color:h}}),o.push({type:"circle",attrs:{x:u,y:d,r:7},styles:{style:"stroke",color:"#ffffff",borderSize:2}})}}return o},createYAxisFigures:({chart:n,overlay:e,coordinates:t,yAxis:s,bounding:o})=>{var B,$,L,O,Y,ce;if(t.length<1||!e.points||e.points.length<1)return[];const r=(B=e.points[0])==null?void 0:B.value;if(r===void 0)return[];const a=n.getStyles(),l=a.yAxis,c=l.axisLine.show?l.axisLine.size:0,f=l.ticduty.show?l.ticduty.length:0,u=l.tickText.marginStart,d=l.tickText.marginEnd,h=1,g={...a.crosshair.horizontal.text};let w=0,C="left";if(($=s==null?void 0:s.isFromZero)!=null&&$.call(s))w=c+h,C="left",g.paddingLeft=f+u-h;else{w=((o==null?void 0:o.width)??0)-c-h,C="right";const Q=((o==null?void 0:o.width)??0)-c-h,le=((o==null?void 0:o.width)??0)-(l.axisLine.show?l.axisLine.size:0)-(l.ticduty.show?l.ticduty.length:0)-d;g.paddingRight=Q-le}const P=s.getRange();let I=s.displayValueToText(s.realValueToDisplayValue(s.valueToRealValue(r,{range:P}),{range:P}),((L=n.getSymbol())==null?void 0:L.pricePrecision)??2);I=n.getDecimalFold().format(n.getThousandsSeparator().format(I));const A=((Y=(O=e.styles)==null?void 0:O.line)==null?void 0:Y.color)||((ce=e.styles)==null?void 0:ce.color)||"#1677FF",M=E0(A,g.color),F=t[0].y;return typeof(o==null?void 0:o.height)=="number"&&(F<0||F>o.height)?[]:[{type:"text",attrs:{x:w,y:F,text:I,align:C,baseline:"middle"},styles:{...g,color:M,backgroundColor:A},ignoreEvent:!0}]},onClick:n=>{console.log("🟢 horizontalRayLine onClick called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!e.showDot,console.log("✅ Toggled showDot to:",e.showDot,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onSelected:n=>{console.log("🟢 horizontalRayLine onSelected called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!0,console.log("✅ Set showDot to true:",e,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onDeselected:n=>{console.log("🔴 horizontalRayLine onDeselected called"),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!1,n.chart&&n.chart.overrideOverlay({id:n.overlay.id,extendData:e}),!0}};function mE(n,e,t,s,o,r,a){const l=s*.4,c=o*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.lineJoin="round",n.beginPath(),n.moveTo(e-l,t-c),n.lineTo(e+l,t+c),n.moveTo(e+l,t-c),n.lineTo(e-l,t+c),n.stroke(),n.restore()}function hE(n,e,t,s,o,r,a){const l=s*.4,c=o*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.beginPath(),n.ellipse(e,t,l,c,0,0,Math.PI*2),n.stroke(),n.restore()}const Y4={name:"pointAndFigure",totalStep:0,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:()=>[],draw:n=>{var P,I,A;const{ctx:e,chart:t,bounding:s,xAxis:o,yAxis:r,overlay:a}=n;if(!t||!e||!(o!=null&&o.convertToPixel)||!(r!=null&&r.convertToPixel))return[];const l=(P=t.getVisibleRange)==null?void 0:P.call(t);if(!l)return[];const c=((I=t.getDataList)==null?void 0:I.call(t))||[];if(c.length===0)return[];const f=o.convertToPixel(0),u=o.convertToPixel(1),d=Math.max(1,Math.abs(u-f));let h=d;for(let M=l.from;M<=l.to&&M<c.length;M++){const F=(A=c[M])==null?void 0:A._pnf;if(F!=null&&F.boxes&&F.boxes.length>=2){const B=r.convertToPixel(F.boxes[0].price),$=r.convertToPixel(F.boxes[1].price);if(B!==void 0&&$!==void 0&&!isNaN(B)&&!isNaN($)){const L=Math.abs(B-$);if(L>0){h=L;break}}}}const m=d*.85,g=h*.85,w=(m+g)/2,C=Math.max(.8,w*.08);for(let M=l.from;M<=l.to&&M<c.length;M++){const F=c[M];if(!F)continue;const B=F==null?void 0:F._pnf;if(!B||!B.boxes)continue;const{direction:$,boxes:L,upColor:O="#00E6D8",downColor:Y="#FF4D4D"}=B,ce=o.convertToPixel(M);if(!(ce==null||isNaN(ce)))for(const Q of L){const le=r.convertToPixel(Q.price);le==null||isNaN(le)||($==="up"?mE(e,ce,le,m,g,O,C):hE(e,ce,le,m,g,Y,C))}}return[]}},K4={name:"script-layer",totalStep:0,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,styles:{},createPointFigures:()=>[]},vE=[w4,k4,S4,I4,C4,P4,N4,A4,T4,F4,L4,E4,$4,D4,R4,j4,B4,O4,z4,V4,W4,H4,q4,U4,G4,Y4,K4],R1={arrow:w4,circle:k4,rect:S4,triangle:I4,parallelogram:C4,fibonacciCircle:P4,fibonacciSegment:N4,fibonacciSpiral:A4,fibonacciSpeedResistanceFan:T4,fibonacciExtension:F4,gannBox:L4,threeWaves:E4,fiveWaves:$4,eightWaves:D4,anyWaves:R4,abcd:j4,xabcd:B4,barSignal:O4,ruler:z4,trade:V4,note:W4,emoji:H4,text:q4,horizontalStraightLine:U4,horizontalRayLine:G4,pointAndFigure:Y4,scriptLayer:K4};function X4(n,e,t){const{size:s=12,paddingLeft:o=0,paddingTop:r=0,paddingRight:a=0,paddingBottom:l=0}=e,{x:c,y:f,text:u,align:d="left",baseline:h="top"}=n;t=t??s*u.length;let m;switch(d){case"left":case"start":{m=c;break}case"right":case"end":{m=c-a-t-o;break}default:{m=c-t/2-o;break}}return m}function Z4(n,e,t,s,o){const{size:r=12,paddingLeft:a=0,paddingTop:l=0,paddingRight:c=0,paddingBottom:f=0}=e,{x:u,y:d,text:h,align:m="left",baseline:g="top"}=n,w=h.length;t=t??r*w,s=s??1,o=o??1.5;const C=r*s*o-(o-1)*r,P=X4(n,e,t);let I;switch(g){case"top":case"hanging":{I=d;break}case"bottom":case"ideographic":case"alphabetic":{I=d-C-l-f;break}default:{I=d-C/2-l;break}}return{x:P,y:I,width:a+t+c,height:l+C+f}}const J4=Xv.calcTextWidth;function gE(n,e,t){return`${e??"normal"} ${n??12}px ${t??"Helvetica Neue"}`}function _E(n){return typeof n=="string"}function gk(n){return n==="transparent"||n==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(n)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(n)}function yE(n,e,t){let s=[];s=s.concat(e);const{style:o=V_.Fill,color:r="transparent",borderSize:a=1,borderColor:l="transparent",borderStyle:c=wt.Solid,borderRadius:f=0,borderDashedValue:u=[2,2]}=t,d=n.roundRect??n.rect,h=(o===V_.Fill||t.style===V_.StrokeFill)&&(!_E(r)||!gk(r));if(h&&(n.fillStyle=r,s.forEach(({x:m,y:g,width:w,height:C})=>{n.beginPath(),d.call(n,m,g,w,C,f),n.closePath(),n.fill()})),(o===V_.Stroke||t.style===V_.StrokeFill)&&a>0&&!gk(l)){n.strokeStyle=l,n.fillStyle=l,n.lineWidth=a,c===wt.Dashed?n.setLineDash(u):n.setLineDash([]);const m=a%2===1?.5:0,g=Math.round(m*2);s.forEach(({x:w,y:C,width:P,height:I})=>{P>a*2&&I>a*2?(n.beginPath(),d.call(n,w+m,C+m,P-g,I-g,f),n.closePath(),n.stroke()):h||n.fillRect(w,C,P,I)})}}function bE(n,e,t){const{text:s}=e,{size:o=12,family:r,weight:a,paddingLeft:l=0,paddingTop:c=0,paddingRight:f=0}=t,u=s.split(`
`),d=u.map(P=>J4(P,o,a,r)),h=1.5,m=o*h,g=Math.max(...d),w=Z4(e,t,g,u.length,h);yE(n,w,{...t,color:t.backgroundColor});let C=w.y+c;u.forEach((P,I)=>{const A=X4(e,t,d[I])+l;n.textAlign="left",n.textBaseline="top",n.font=gE(o,a,r),n.fillStyle=t.color||"currentColor",n.fillText(P,A,C,w.width-l-f),C+=m})}function xE(n,e,t){const{size:s=12,family:o,weight:r,paddingLeft:a=0,paddingTop:l=0}=t,c=e.text.split(`
`),f=c.map(C=>J4(C,s,r,o)),u=1.5,d=Math.max(...f),{x:h,y:m,width:g,height:w}=Z4(e,t,d,c.length,u);return n.x>=h&&n.x<=h+g&&n.y>=m&&n.y<=m+w}const wE={name:"textBox",checkEventOn:(n,e,t)=>xE(n,e,t),draw:(n,e,t)=>{bE(n,e,t)}},kE=[wE],SE={name:"BIAS",shortName:"BIAS",precision:2,calcParams:[6],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"bias",title:"BIAS: ",type:"line"}],styles:{lines:[{color:"#2196F3",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||6;return n.reduce((s,o,r)=>{if(r>=t-1){let a=0;for(let c=r-t+1;c<=r;c++)a+=n[c].close;const l=a/t;s[o.timestamp]={bias:(o.close-l)/l*100}}else s[o.timestamp]={};return s},{})}},CE={name:"CCI",shortName:"CCI",precision:2,calcParams:[20],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"cci",title:"CCI: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#2563eb",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[s]=t;return n.reduce((o,r,a)=>(o[r.timestamp]={cci:IE(n,a,s)},o),{})}};function IE(n,e,t){if(e<t-1)return null;const s=[];for(let f=e-t+1;f<=e;f++){const u=n[f],d=(u.high+u.low+u.close)/3;s.push(d)}const o=s.reduce((f,u)=>f+u,0)/t,r=s.reduce((f,u)=>f+Math.abs(u-o),0)/t;if(r===0)return 0;const a=n[e];return((a.high+a.low+a.close)/3-o)/(.015*r)}const PE={name:"ICHIMOKU",shortName:"ICHIMOKU",precision:4,calcParams:[9,26,52],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"tenkan",title:"Tenkan: ",type:"line"},{key:"kijun",title:"Kijun: ",type:"line"},{key:"senkouA",title:"Senkou A: ",type:"line"},{key:"senkouB",title:"Senkou B: ",type:"line"},{key:"chikou",title:"Chikou: ",type:"line"}],styles:{lines:[{color:"#FF6B6B",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#4ECDC4",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#45B7D1",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#FFA07A",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#9B59B6",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||9,s=e.calcParams[1]||26,o=e.calcParams[2]||52,r=s,a=[],l=(f,u)=>{let d=-1/0,h=1/0;for(let m=f;m<f+u&&m<n.length;m++)n[m].high>d&&(d=n[m].high),n[m].low<h&&(h=n[m].low);return{high:d,low:h}};for(let f=0;f<n.length;f++){const u={};if(f>=t-1){const{high:d,low:h}=l(f-t+1,t);u.tenkan=(d+h)/2}if(f>=s-1){const{high:d,low:h}=l(f-s+1,s);u.kijun=(d+h)/2}if(f>=s-1){const d=f,h=f;if(d>=t-1&&h>=s-1){const{high:m,low:g}=l(d-t+1,t),{high:w,low:C}=l(h-s+1,s),P=(m+g)/2,I=(w+C)/2;u.senkouA=(P+I)/2}}if(f>=o-1){const{high:d,low:h}=l(f-o+1,o);u.senkouB=(d+h)/2}u.chikou=n[f].close,a.push(u)}const c=a.map((f,u)=>{var h,m,g;const d={...f};return u>=r?(d.senkouA=(h=a[u-r])==null?void 0:h.senkouA,d.senkouB=(m=a[u-r])==null?void 0:m.senkouB):(d.senkouA=void 0,d.senkouB=void 0),u+r<a.length?d.chikou=(g=n[u+r])==null?void 0:g.close:d.chikou=void 0,d});return n.reduce((f,u,d)=>(f[u.timestamp]=c[d],f),{})},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var h;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l,u=t.result;n.save();const d=[];for(let m=c;m<f;m++){const g=(h=a[m])==null?void 0:h.timestamp,w=u[g];if(w&&w.senkouA!==void 0&&w.senkouB!==void 0){const C=o.convertToPixel(m),P=r.convertToPixel(w.senkouA),I=r.convertToPixel(w.senkouB);d.push({x:C,yA:P,yB:I})}}if(d.length>1){n.globalAlpha=.2;const m=d[0].yA<d[0].yB;n.fillStyle=m?"#4CAF50":"#F44336",n.beginPath(),n.moveTo(d[0].x,Math.min(d[0].yA,d[0].yB));for(let g=1;g<d.length;g++)n.lineTo(d[g].x,Math.min(d[g].yA,d[g].yB));for(let g=d.length-1;g>=0;g--)n.lineTo(d[g].x,Math.max(d[g].yA,d[g].yB));n.closePath(),n.fill()}return n.restore(),!1}},ME={name:"PVT",shortName:"PVT",precision:2,calcParams:[],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"pvt",title:"PVT: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t={};if(n.length===0)return t;let s=0;for(let o=0;o<n.length;o++){const r=n[o];if(o===0){t[r.timestamp]={pvt:0};continue}const a=n[o-1];if(r.close==null||a.close==null||r.volume==null||r.close<=0||a.close<=0){t[r.timestamp]={};continue}const l=(r.close-a.close)/a.close,c=s+(r.volume||0)*l;t[r.timestamp]={pvt:c},s=c}return t}},tv=new Map,Wb=n=>({id:n,period:14,lineColor:"#8B5CF6",lineThickness:2,lineStyle:"solid",overboughtLevel:70,oversoldLevel:30,middleLevel:50,overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",overboughtFillColor:"#EF4444",oversoldFillColor:"#22C55E",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed",fillOpacity:.15,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:70,color:"#EF4444",lineStyle:"dashed",thickness:1,label:"70",visible:!0},{id:"middle",value:50,color:"#6B7280",lineStyle:"dashed",thickness:1,label:"50",visible:!0},{id:"oversold",value:30,color:"#22C55E",lineStyle:"dashed",thickness:1,label:"30",visible:!0}]}),NE=(n,e)=>{const t=[];if(n.length<e+1)return n.map(()=>NaN);let s=[],o=[];for(let f=1;f<=e;f++){const u=n[f].close-n[f-1].close;s.push(u>0?u:0),o.push(u<0?Math.abs(u):0)}let r=s.reduce((f,u)=>f+u,0)/e,a=o.reduce((f,u)=>f+u,0)/e;for(let f=0;f<e;f++)t.push(NaN);let l=r/(a||1e-4),c=100-100/(1+l);t.push(c);for(let f=e+1;f<n.length;f++){const u=n[f].close-n[f-1].close,d=u>0?u:0,h=u<0?Math.abs(u):0;r=(r*(e-1)+d)/e,a=(a*(e-1)+h)/e,l=r/(a||1e-4),c=100-100/(1+l),t.push(c)}return t};function AE(n){if(!n)return null;const e=n.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i);if(e)return{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)};const t=n.match(/^#?([a-f\d])([a-f\d])([a-f\d])$/i);if(t)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16)};const s=n.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*[\d.]+\s*)?\)/i);return s?{r:parseInt(s[1],10),g:parseInt(s[2],10),b:parseInt(s[3],10)}:null}function db(n,e,t,s,o){if(e<=o&&s>=o||e>=o&&s<=o){if(e===s)return null;const r=(o-e)/(s-e);return{x:n+r*(t-n),y:o}}return null}const Q4={name:"RSI",shortName:"RSI",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:0,maxValue:100,figures:[{key:"rsi",title:"RSI: ",type:"line"}],styles:{lines:[{color:"#8B5CF6",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||14,s=NE(n,t);return n.reduce((o,r,a)=>{const l=s[a];return o[r.timestamp]={rsi:isNaN(l)?null:l},o},{})},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var g,w,C,P;const a=t.paneId||"default";let l=tv.get(a);l||(l=Wb(a),tv.set(a,l));const{left:c,width:f}=s,u=e.getVisibleRange(),d=e.getDataList();n.save();const h=r.convertToPixel(l.overboughtLevel),m=r.convertToPixel(l.oversoldLevel);if(l.showFill){const I=[],A=[];let M=!1,F=!1;for(let B=u.from;B<=u.to;B++){const $=(g=d[B])==null?void 0:g.timestamp,L=t.result[$];if(!L||L.rsi===null||L.rsi===void 0)continue;const O=o.convertToPixel(B),Y=r.convertToPixel(L.rsi);if(O===null||Y===null)continue;const ce=(w=d[B-1])==null?void 0:w.timestamp,Q=B>0?t.result[ce]:null,le=Q==null?void 0:Q.rsi,ue=B>0?o.convertToPixel(B-1):null,fe=le!=null?r.convertToPixel(le):null;if(L.rsi>l.overboughtLevel){if(!M&&(M=!0,ue!==null&&fe!==null&&le!==null&&le!==void 0&&le<=l.overboughtLevel)){const pe=db(ue,fe,O,Y,h);pe&&(I.push({x:pe.x,y:h}),pe.x)}I.push({x:O,y:Y})}else if(M){if(ue!==null&&fe!==null&&le!==null&&le!==void 0){const pe=db(ue,fe,O,Y,h);pe&&I.push({x:pe.x,y:h})}I.length>=2&&fb(n,I,h,l.overboughtFillColor,l.fillOpacity,"above"),I.length=0,M=!1}if(L.rsi<l.oversoldLevel){if(!F&&(F=!0,ue!==null&&fe!==null&&le!==null&&le!==void 0&&le>=l.oversoldLevel)){const pe=db(ue,fe,O,Y,m);pe&&(A.push({x:pe.x,y:m}),pe.x)}A.push({x:O,y:Y})}else if(F){if(ue!==null&&fe!==null&&le!==null&&le!==void 0){const pe=db(ue,fe,O,Y,m);pe&&A.push({x:pe.x,y:m})}A.length>=2&&fb(n,A,m,l.oversoldFillColor,l.fillOpacity,"below"),A.length=0,F=!1}}M&&I.length>=2&&fb(n,I,h,l.overboughtFillColor,l.fillOpacity,"above"),F&&A.length>=2&&fb(n,A,m,l.oversoldFillColor,l.fillOpacity,"below")}l.showLevels&&l.levels.forEach(I=>{if(!I.visible)return;const A=r.convertToPixel(I.value);if(A===null)return;n.save(),n.strokeStyle=I.color;let M=1,F="dashed";I.id==="overbought"?(M=l.overboughtThickness??1,F=l.overboughtLineStyle??"dashed"):I.id==="oversold"?(M=l.oversoldThickness??1,F=l.oversoldLineStyle??"dashed"):I.id==="middle"&&(M=l.middleLineThickness??1,F=l.middleLineStyle??"dashed"),M=Math.max(1,Math.round(M)),n.lineWidth=M;const B=M%2===1?Math.floor(A)+.5:Math.round(A);F==="dashed"?n.setLineDash([6*M,4*M]):F==="dotted"?n.setLineDash([M,M*2]):n.setLineDash([]),n.beginPath(),n.moveTo(Math.floor(c),B),n.lineTo(Math.floor(c+f),B),n.stroke(),n.restore()}),n.lineCap="round",n.lineJoin="round";for(let I=u.from;I<u.to;I++){const A=(C=d[I])==null?void 0:C.timestamp,M=(P=d[I+1])==null?void 0:P.timestamp,F=t.result[A],B=t.result[M];if(!F||!B||F.rsi===null||F.rsi===void 0||B.rsi===null||B.rsi===void 0)continue;const $=o.convertToPixel(I),L=o.convertToPixel(I+1),O=r.convertToPixel(F.rsi),Y=r.convertToPixel(B.rsi);if($===null||L===null||O===null||Y===null)continue;let ce=l.lineColor;F.rsi>l.overboughtLevel?ce=l.overboughtColor:F.rsi<l.oversoldLevel&&(ce=l.oversoldColor),n.strokeStyle=ce,n.lineWidth=l.lineThickness,l.lineStyle==="dashed"?n.setLineDash([6,4]):l.lineStyle==="dotted"?n.setLineDash([2,2]):n.setLineDash([]),n.beginPath(),n.moveTo($,O),n.lineTo(L,Y),n.stroke()}return n.restore(),!0}};function fb(n,e,t,s,o,r){if(e.length<2)return;n.save();let a=AE(s);a||(a=r==="above"?{r:239,g:68,b:68}:{r:34,g:197,b:94});const l=Math.min(...e.map(u=>u.y)),c=Math.max(...e.map(u=>u.y));let f;r==="above"?(f=n.createLinearGradient(0,t,0,l),f.addColorStop(0,`rgba(${a.r}, ${a.g}, ${a.b}, 0.02)`),f.addColorStop(.5,`rgba(${a.r}, ${a.g}, ${a.b}, ${o*.5})`),f.addColorStop(1,`rgba(${a.r}, ${a.g}, ${a.b}, ${o})`)):(f=n.createLinearGradient(0,t,0,c),f.addColorStop(0,`rgba(${a.r}, ${a.g}, ${a.b}, 0.02)`),f.addColorStop(.5,`rgba(${a.r}, ${a.g}, ${a.b}, ${o*.5})`),f.addColorStop(1,`rgba(${a.r}, ${a.g}, ${a.b}, ${o})`)),n.fillStyle=f,n.beginPath(),n.moveTo(e[0].x,e[0].y);for(let u=1;u<e.length;u++)n.lineTo(e[u].x,e[u].y);n.lineTo(e[e.length-1].x,t),n.lineTo(e[0].x,t),n.closePath(),n.fill(),n.restore()}const m0={createInstance:(n,e)=>{const t=Wb(n);return e&&(e.levels&&(t.levels=e.levels),Object.keys(e).forEach(s=>{s!=="levels"&&e[s]!==void 0&&(t[s]=e[s])})),tv.set(n,t),t},getInstance:n=>tv.get(n),getInstanceConfig:n=>tv.get(n)||null,updateInstance:(n,e)=>{const t=tv.get(n);if(!t){const s=Wb(n);return Object.assign(s,e),tv.set(n,s),!0}return e.levels&&(t.levels=e.levels),Object.keys(e).forEach(s=>{s!=="levels"&&e[s]!==void 0&&(t[s]=e[s])}),tv.set(n,t),!0},deleteInstance:n=>tv.delete(n),getAllInstances:()=>new Map(tv),clearAllInstances:()=>{tv.clear()},resetInstance:n=>{const e=Wb(n);tv.set(n,e)},exportInstanceConfig:n=>tv.get(n)||null,importInstanceConfig:n=>{try{if(!n||!n.id)return!1;const e={id:n.id,period:n.period??14,lineColor:n.lineColor??"#8B5CF6",lineThickness:n.lineThickness??2,lineStyle:n.lineStyle??"solid",overboughtLevel:n.overboughtLevel??70,oversoldLevel:n.oversoldLevel??30,middleLevel:n.middleLevel??50,overboughtColor:n.overboughtColor??"#EF4444",overboughtThickness:n.overboughtThickness??1,overboughtLineStyle:n.overboughtLineStyle??"dashed",oversoldColor:n.oversoldColor??"#22C55E",oversoldThickness:n.oversoldThickness??1,oversoldLineStyle:n.oversoldLineStyle??"dashed",overboughtFillColor:n.overboughtFillColor??n.overboughtColor??"#EF4444",oversoldFillColor:n.oversoldFillColor??n.oversoldColor??"#22C55E",middleLineColor:n.middleLineColor??"#6B7280",middleLineThickness:n.middleLineThickness??1,middleLineStyle:n.middleLineStyle??"dashed",fillOpacity:n.fillOpacity??.15,showLevels:n.showLevels??!0,showFill:n.showFill??!0,levels:n.levels??[{id:"overbought",value:n.overboughtLevel??70,color:n.overboughtColor??"#EF4444",lineStyle:n.overboughtLineStyle??"dashed",thickness:n.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:n.middleLevel??50,color:n.middleLineColor??"#6B7280",lineStyle:n.middleLineStyle??"dashed",thickness:n.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:n.oversoldLevel??30,color:n.oversoldColor??"#22C55E",lineStyle:n.oversoldLineStyle??"dashed",thickness:n.oversoldThickness??1,label:"30",visible:!0}]};return tv.set(n.id,e),!0}catch(e){return console.error("Failed to import RSI instance config:",e),!1}},updateLevel:(n,e,t)=>{const s=tv.get(n);if(!s)return!1;const o=s.levels.find(r=>r.id===e);return o?(Object.assign(o,t),e==="overbought"&&t.value!==void 0?s.overboughtLevel=t.value:e==="oversold"&&t.value!==void 0?s.oversoldLevel=t.value:e==="middle"&&t.value!==void 0&&(s.middleLevel=t.value),!0):!1},addLevel:(n,e)=>{const t=tv.get(n);if(!t)throw new Error(`RSI instance ${n} not found`);const s=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={...e,id:s,value:Math.max(0,Math.min(100,e.value))};return t.levels.push(o),s},removeLevel:(n,e)=>{const t=tv.get(n);if(!t)return!1;const s=t.levels.findIndex(o=>o.id===e);return s===-1?!1:(t.levels.splice(s,1),!0)}},_k=Object.freeze(Object.defineProperty({__proto__:null,RSIManager:m0,rsi:Q4},Symbol.toStringTag,{value:"Module"})),TE={name:"SAR",shortName:"SAR",precision:4,calcParams:[.02,.02,.2],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"sar",title:"SAR: ",type:"line"}],styles:{lines:[{color:"#2563eb",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||.02,s=e.calcParams[1]||.02,o=e.calcParams[2]||.2,r={};if(n.length<2)return n.map(()=>({}));let a=!0,l=t,c=n[0].high,f=n[0].low;r[n[0].timestamp]={sar:f};for(let u=1;u<n.length;u++){const d=n[u],h=n[u-1];a?(f=f+l*(c-f),f=Math.min(f,d.low,h.low),d.low<=f?(a=!1,f=c,c=d.low,l=t):d.high>c&&(c=d.high,l=Math.min(l+s,o))):(f=f-l*(f-c),f=Math.max(f,d.high,h.high),d.high>=f?(a=!0,f=c,c=d.high,l=t):d.low<c&&(c=d.low,l=Math.min(l+s,o))),r[n[u].timestamp]={sar:f}}return r},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var h,m,g;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l;n.save();const u=((m=(h=t.styles)==null?void 0:h.lines)==null?void 0:m[0])||{color:"#2563eb",size:1},d=u.size||1;for(let w=c;w<=f;w++){const C=(g=a[w])==null?void 0:g.timestamp,P=t.result[C];if(!P||typeof P.sar!="number")continue;const I=o.convertToPixel(w),A=r.convertToPixel(P.sar);I>=s.left&&I<=s.left+s.width&&A>=s.top&&A<=s.top+s.height&&(n.beginPath(),n.arc(I,A,d,0,2*Math.PI),n.fillStyle=u.color,n.fill(),n.strokeStyle=u.color,n.lineWidth=1,n.stroke())}return n.restore(),!0}},Ph=new Map,ow=n=>({id:n,period:14,lineColor:"#2563eb",lineThickness:1,lineStyle:"solid",showLevels:!0,showZones:!0,yAxisSync:!0,enableDynamicColoring:!0,overboughtColor:"#EF4444",oversoldColor:"#10B981",overboughtThreshold:-20,oversoldThreshold:-80,levels:[{id:"overbought",value:-20,color:"#EF4444",lineStyle:"solid",thickness:1,label:"Overbought",visible:!0},{id:"middle",value:-50,color:"#6B7280",lineStyle:"dashed",thickness:1,label:"Middle",visible:!0},{id:"oversold",value:-80,color:"#10B981",lineStyle:"solid",thickness:1,label:"Oversold",visible:!0}],zones:[{id:"overbought_zone",topLevel:0,bottomLevel:-20,fillColor:"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold_zone",topLevel:-80,bottomLevel:-100,fillColor:"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}]}),FE=(n,e)=>{const t=[];if(n.length<e)return n.map(()=>NaN);for(let s=0;s<n.length;s++){if(s<e-1){t.push(NaN);continue}let o=n[s-e+1].high,r=n[s-e+1].low;for(let c=s-e+2;c<=s;c++)n[c].high>o&&(o=n[c].high),n[c].low<r&&(r=n[c].low);const a=n[s].close,l=(o-a)/(o-r)*-100;t.push(isNaN(l)?0:l)}return t},LE={name:"WR",shortName:"WR",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:-100,maxValue:0,figures:[{key:"wr",title:"WR: ",type:"line"}],styles:{lines:[{color:"#2563eb",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||14,s=FE(n,t);return n.reduce((o,r,a)=>{const l=s[a];return o[r.timestamp]={wr:isNaN(l)?null:l},o},{})},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var m,g;const a=t.paneId||"default";let l=Ph.get(a);l||(l=ow(a),Ph.set(a,l));const{left:c,top:f,width:u,height:d}=s,h=e.getVisibleRange();if(n.save(),l.showZones&&l.zones.forEach(w=>{if(!w.visible)return;const C=r.convertToPixel(w.topLevel),P=r.convertToPixel(w.bottomLevel);if(C!==null&&P!==null){n.save();const I=Math.abs(C-P),A=Math.min(C,P),M=n.createLinearGradient(c,A,c,A+I),B=w.fillColor.match(/\w\w/g);if(B){const $=parseInt(B[0],16),L=parseInt(B[1],16),O=parseInt(B[2],16);M.addColorStop(0,`rgba(${$}, ${L}, ${O}, ${w.fillOpacity*.8})`),M.addColorStop(.3,`rgba(${$}, ${L}, ${O}, ${w.fillOpacity*.6})`),M.addColorStop(.7,`rgba(${$}, ${L}, ${O}, ${w.fillOpacity*.3})`),M.addColorStop(1,`rgba(${$}, ${L}, ${O}, ${w.fillOpacity*.1})`)}else M.addColorStop(0,w.fillColor+Math.floor(w.fillOpacity*255).toString(16).padStart(2,"0")),M.addColorStop(.5,w.fillColor+Math.floor(w.fillOpacity*128).toString(16).padStart(2,"0")),M.addColorStop(1,w.fillColor+Math.floor(w.fillOpacity*32).toString(16).padStart(2,"0"));n.fillStyle=M,n.fillRect(c,A,u,I),n.strokeStyle=w.fillColor+"40",n.lineWidth=.5,n.strokeRect(c,A,u,I),n.restore()}}),l.showLevels&&l.levels.forEach(w=>{if(!w.visible)return;const C=r.convertToPixel(w.value);C!==null&&(n.save(),n.strokeStyle=w.color,n.lineWidth=w.thickness,w.lineStyle==="dashed"?n.setLineDash([4,4]):w.lineStyle==="dotted"?n.setLineDash([2,2]):n.setLineDash([]),n.beginPath(),n.moveTo(c,C),n.lineTo(c+u,C),n.stroke(),l.yAxisSync&&(n.font="11px Arial",n.textAlign="left",n.fillStyle=w.color,n.fillText(`WR ${w.value}`,c+u+5,C+4)),n.restore())}),l.enableDynamicColoring&&t.result){const{from:w,to:C}=h,P=e.getDataList();for(let I=w;I<C;I++){const A=(m=P[I])==null?void 0:m.timestamp,M=(g=t.result[A])==null?void 0:g.wr;if(M!=null){const F=o.convertToPixel(I),B=r.convertToPixel(M);if(F!==null&&B!==null){n.save();let $=l.lineColor;M>l.overboughtThreshold?$=l.overboughtColor:M<l.oversoldThreshold&&($=l.oversoldColor),n.fillStyle=$,n.beginPath(),n.arc(F,B,1,0,2*Math.PI),n.fill(),n.restore()}}}}return n.restore(),!1}},cx={createInstance:(n,e)=>{const t=ow(n);return e&&Object.assign(t,e),Ph.set(n,t),t},getInstance:n=>Ph.get(n),updateInstance:(n,e)=>{const t=Ph.get(n);return t?(Object.assign(t,e),Ph.set(n,t),!0):!1},deleteInstance:n=>Ph.delete(n),addLevel:(n,e)=>{const t=Ph.get(n);if(!t)throw new Error(`WR instance ${n} not found`);const s=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={...e,id:s,value:Math.max(-100,Math.min(0,e.value))};return t.levels.push(o),s},removeLevel:(n,e)=>{const t=Ph.get(n);if(!t)return!1;const s=t.levels.findIndex(o=>o.id===e);return s===-1?!1:(t.levels.splice(s,1),!0)},updateLevel:(n,e,t)=>{const s=Ph.get(n);if(!s)return!1;const o=s.levels.find(r=>r.id===e);return o?(t.value!==void 0&&(t.value=Math.max(-100,Math.min(0,t.value))),t.thickness!==void 0&&(t.thickness=Math.max(1,Math.min(5,t.thickness))),Object.assign(o,t),!0):!1},addZone:(n,e)=>{const t=Ph.get(n);if(!t)throw new Error(`WR instance ${n} not found`);const s=Math.max(-100,Math.min(0,Math.max(e.topLevel,e.bottomLevel))),o=Math.max(-100,Math.min(0,Math.min(e.topLevel,e.bottomLevel))),r=`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={...e,id:r,topLevel:s,bottomLevel:o,fillOpacity:Math.max(0,Math.min(1,e.fillOpacity||.15))};return t.zones.push(a),r},removeZone:(n,e)=>{const t=Ph.get(n);if(!t)return!1;const s=t.zones.findIndex(o=>o.id===e);return s===-1?!1:(t.zones.splice(s,1),!0)},updateZone:(n,e,t)=>{const s=Ph.get(n);if(!s)return!1;const o=s.zones.find(r=>r.id===e);if(!o)return!1;if(t.topLevel!==void 0&&(t.topLevel=Math.max(-100,Math.min(0,t.topLevel))),t.bottomLevel!==void 0&&(t.bottomLevel=Math.max(-100,Math.min(0,t.bottomLevel))),t.fillOpacity!==void 0&&(t.fillOpacity=Math.max(0,Math.min(1,t.fillOpacity))),Object.assign(o,t),o.topLevel<o.bottomLevel){const r=o.topLevel;o.topLevel=o.bottomLevel,o.bottomLevel=r}return!0},getInstanceConfig:n=>Ph.get(n)||null,resetInstance:n=>{const e=ow(n);Ph.set(n,e)},exportInstanceConfig:n=>{const e=Ph.get(n);return e?{id:n,period:e.period,lineColor:e.lineColor,lineThickness:e.lineThickness,lineStyle:e.lineStyle,showLevels:e.showLevels,showZones:e.showZones,yAxisSync:e.yAxisSync,levels:e.levels.map(t=>({...t})),zones:e.zones.map(t=>({...t}))}:null},importInstanceConfig:n=>{try{const e={id:n.id,period:n.period||14,lineColor:n.lineColor||"#FF6B35",lineThickness:n.lineThickness||2,lineStyle:n.lineStyle||"solid",showLevels:n.showLevels??!0,showZones:n.showZones??!0,yAxisSync:n.yAxisSync??!0,enableDynamicColoring:n.enableDynamicColoring??!0,overboughtColor:n.overboughtColor||"#EF4444",oversoldColor:n.oversoldColor||"#10B981",overboughtThreshold:n.overboughtThreshold||-20,oversoldThreshold:n.oversoldThreshold||-80,levels:n.levels||[],zones:n.zones||[]};return Ph.set(n.id,e),!0}catch(e){return console.error("Failed to import WR instance config:",e),!1}},getAllInstances:()=>new Map(Ph),clearAllInstances:()=>{Ph.clear()}},EE={name:"VR",shortName:"VR",precision:2,calcParams:[26,6,12],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:100-1e-9,maxValue:100+1e-9,figures:[{key:"vr",title:"VR: ",type:"line"},{key:"vrShort",title:"VR Short: ",type:"line"},{key:"vrLong",title:"VR Long: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#4CAF50",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||26,s=e.calcParams[1]||6,o=e.calcParams[2]||12,r={};if(n.length<Math.max(t,s,o)+1)return n.reduce((l,c)=>(l[c.timestamp]={},l),{});const a=(l,c)=>{if(l<c)return 100;let f=0,u=0,d=0;for(let g=l-c+1;g<=l;g++){if(g===0)continue;const w=n[g],C=n[g-1];w.close>C.close?f+=w.volume||0:w.close<C.close?u+=w.volume||0:d+=w.volume||0}const h=f+d/2,m=u+d/2;return m===0?100:h/m*100};for(let l=0;l<n.length;l++){const c=a(l,t),f=a(l,s),u=a(l,o);r[n[l].timestamp]={vr:c,vrShort:f,vrLong:u}}return r},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{e.getVisibleRange(),n.save(),n.lineWidth=1,n.setLineDash([2,2]),n.strokeStyle="rgba(107, 114, 128, 0.6)",n.beginPath();const a=r.convertToPixel(100);n.moveTo(s.left,a),n.lineTo(s.left+s.width,a),n.stroke(),n.strokeStyle="rgba(239, 68, 68, 0.6)",n.beginPath();const l=r.convertToPixel(150);n.moveTo(s.left,l),n.lineTo(s.left+s.width,l),n.stroke(),n.strokeStyle="rgba(34, 197, 94, 0.6)",n.beginPath();const c=r.convertToPixel(70);return n.moveTo(s.left,c),n.lineTo(s.left+s.width,c),n.stroke(),n.restore(),!1}},$E={name:"ROC",shortName:"ROC",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"roc",title:"ROC: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#FF6B6B",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[s]=t;return n.reduce((o,r,a)=>(o[r.timestamp]={roc:DE(n,a,s)},o),{})}};function DE(n,e,t){if(e<t)return null;const s=n[e].close,o=n[e-t].close;return o===0?null:(s-o)/o*100}const RE={name:"PSY",shortName:"PSY",precision:2,calcParams:[12,6],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"mapsy",title:"MAPSY: ",type:"line"}],minValue:0,maxValue:100,styles:{lines:[{color:"#2563eb",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#dc2626",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[s,o]=t;return n.reduce((r,a,l)=>(r[a.timestamp]={psy:eS(n,l,s),mapsy:jE(n,l,s,o)},r),{})}};function eS(n,e,t){if(e<t)return null;let s=0;for(let o=e-t+1;o<=e;o++)o>0&&n[o].close>n[o-1].close&&s++;return s/t*100}function jE(n,e,t,s){if(e<t+s-1)return null;let o=0,r=0;for(let a=e-s+1;a<=e;a++){const l=eS(n,a,t);l!==null&&(o+=l,r++)}return r>0?o/r:null}const BE={name:"OBV",shortName:"OBV",precision:0,calcParams:[30,10],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maobv",title:"MAOBV: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[1]||10,s={};if(n.length===0)return s;let o=0;const r=[];for(let a=0;a<n.length;a++){const l=n[a];if(a===0)o=0;else{const f=n[a-1],u=l.volume||0;l.close>f.close?o+=u:l.close<f.close&&(o-=u)}r.push(o);let c;if(a>=t-1){let f=0;for(let u=a-t+1;u<=a;u++)f+=r[u];c=f/t}s[l.timestamp]={obv:o,maobv:c}}return s}},OE={name:"ZIGZAG",shortName:"ZIGZAG",precision:2,calcParams:[5,5],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:1,extendData:void 0,figures:[],styles:{lines:[{color:"#2962FF",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]}],circles:[{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888"}]},calc:(n,e)=>{const t=(e.calcParams[0]||5)/100,s=e.calcParams[1]||5,o=[];if(n.length<s*2)return n.map(()=>({}));let r=0,a=n[0].high,l="high",c=!1;for(let f=0;f<n.length;f++)o.push({});o[0]={zigzag:n[0].close};for(let f=s;f<n.length;f++){const u=n[f].high,d=n[f].low,h=Math.abs(u-a)/a,m=Math.abs(d-a)/a;if(h>=t){r=f,a=u,l="high",c=!1,o[f]={zigzag:u,isHigh:!0};break}else if(m>=t){r=f,a=d,l="low",c=!0,o[f]={zigzag:d,isLow:!0};break}}for(let f=r+s;f<n.length;f++){const u=n[f].high,d=n[f].low;c?(u-a)/a>=t?(r=f,a=u,l="high",c=!1,o[f]={zigzag:u,isHigh:!0}):l==="low"&&d<a&&(o[r]={},r=f,a=d,o[f]={zigzag:d,isLow:!0}):(a-d)/a>=t?(r=f,a=d,l="low",c=!0,o[f]={zigzag:d,isLow:!0}):l==="high"&&u>a&&(o[r]={},r=f,a=u,o[f]={zigzag:u,isHigh:!0})}return o},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var m,g,w,C;if(!t.result||t.result.length===0)return!1;const a=e.getVisibleRange(),{from:l,to:c}=a,f=t.result;n.save();const u=((g=(m=t.styles)==null?void 0:m.lines)==null?void 0:g[0])||{color:"#2962FF",size:2,style:wt.Solid,dashedValue:[2,2]},d=((C=(w=t.styles)==null?void 0:w.circles)==null?void 0:C[0])||{upColor:"#26A69A",downColor:"#EF5350"},h=[];for(let P=Math.max(0,l-50);P<Math.min(c+1,f.length);P++){const I=f[P];I&&typeof I.zigzag=="number"&&h.push({index:P,price:I.zigzag,isHigh:I.isHigh||!1,isLow:I.isLow||!1})}if(n.strokeStyle=u.color||"#2962FF",n.lineWidth=u.size||2,u.style===wt.Dashed){const P=Array.isArray(u.dashedValue)?u.dashedValue:[4,4];n.setLineDash(P)}else n.setLineDash([]);for(let P=0;P<h.length-1;P++){const I=h[P],A=h[P+1],M=o.convertToPixel(I.index),F=r.convertToPixel(I.price),B=o.convertToPixel(A.index),$=r.convertToPixel(A.price);n.beginPath(),n.moveTo(M,F),n.lineTo(B,$),n.stroke()}return h.forEach(P=>{if(P.index<l||P.index>=c)return;const I=o.convertToPixel(P.index),A=r.convertToPixel(P.price);I>=s.left&&I<=s.left+s.width&&A>=s.top&&A<=s.top+s.height&&(n.beginPath(),n.arc(I,A,4,0,2*Math.PI),P.isHigh?n.fillStyle=d.downColor:P.isLow?n.fillStyle=d.upColor:n.fillStyle=u.color,n.fill(),n.strokeStyle="#FFFFFF",n.lineWidth=1.5,n.stroke())}),n.restore(),!0}},zE={name:"Custom Momentum",shortName:"CM",calcParams:[12,26],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:5,styles:{lines:[{color:"#26a69a",size:2,style:"solid"}],bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575",size:3,borderColor:"#26a69a",borderSize:0,borderStyle:"solid"}]},figures:[{key:"momentum",title:"Momentum: ",type:"line",baseValue:0},{key:"histogram",title:"Histogram: ",type:"bar",baseValue:0,styles:{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575"}}],calc:(n,e)=>{const t=e.calcParams[0]||12,s=e.calcParams[1]||26,o=[];for(let r=0;r<n.length;r++){const l=n[r].close;if(r>=s-1){let c=0;if(r===s-1){let h=0;for(let m=r-t+1;m<=r;m++)h+=n[m].close;c=h/t}else{const h=2/(t+1);c=l*h+(o[r-1].momentum||0)*(1-h)}let f=0;if(r===s-1){let h=0;for(let m=r-s+1;m<=r;m++)h+=n[m].close;f=h/s}else{const h=2/(s+1);f=l*h+(o[r-1].momentum||0)*(1-h)}const u=c-f,d=u;o.push({momentum:u,histogram:d})}else o.push({})}return o}},VE={name:"AO",shortName:"AO",calcParams:[5,34],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:5,styles:{bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575",reverseColor:"#c4c4c4",size:3,borderColor:"#26a69a",borderSize:0,borderStyle:"solid",fillColor:"#26a69a",strokeColor:"#26a69a"}]},figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{var h,m,g,w,C,P;const{prev:s,current:o}=n,r=typeof(s==null?void 0:s.ao)=="number"?s.ao:null,a=typeof(o==null?void 0:o.ao)=="number"?o.ao:null,l=Xv.formatValue(e.styles,"bars[0].upColor",((m=(h=t==null?void 0:t.bars)==null?void 0:h[0])==null?void 0:m.upColor)??"#26a69a"),c=Xv.formatValue(e.styles,"bars[0].downColor",((w=(g=t==null?void 0:t.bars)==null?void 0:g[0])==null?void 0:w.downColor)??"#ef5350"),f=Xv.formatValue(e.styles,"bars[0].noChangeColor",((P=(C=t==null?void 0:t.bars)==null?void 0:C[0])==null?void 0:P.noChangeColor)??"#757575"),u=Xv.formatValue(e.styles,"bars[0].reverseColor",f);let d=u;return a!==null&&(a>=0?r===null||a>=r?d=l:d=u:r===null||a<=r?d=c:d=u),{color:d,style:"fill",borderColor:d}}}],calc:(n,e)=>{const t=e.calcParams[0]||5,s=e.calcParams[1]||34,o={};for(let r=0;r<n.length;r++){const a=n[r].timestamp;if(r>=s-1){const l=[],c=[];for(let h=r-t+1;h<=r;h++){const m=(n[h].high+n[h].low)/2;l.push(m)}for(let h=r-s+1;h<=r;h++){const m=(n[h].high+n[h].low)/2;c.push(m)}const f=l.reduce((h,m)=>h+m,0)/t,u=c.reduce((h,m)=>h+m,0)/s,d=f-u;o[a]={ao:d}}else o[a]={}}return o},draw:({ctx:n,chart:e,indicator:t,xAxis:s,yAxis:o})=>{var g,w,C,P,I,A,M,F,B,$;const r=e.getDataList();if(!t.result||r.length===0)return!1;const a=t.styles||{},l=((w=(g=a==null?void 0:a.bars)==null?void 0:g[0])==null?void 0:w.upColor)||"#26a69a",c=((P=(C=a==null?void 0:a.bars)==null?void 0:C[0])==null?void 0:P.downColor)||"#ef5350",f=((A=(I=a==null?void 0:a.bars)==null?void 0:I[0])==null?void 0:A.noChangeColor)||"#757575",u=((F=(M=a==null?void 0:a.bars)==null?void 0:M[0])==null?void 0:F.reverseColor)||f,d=e.getVisibleRange(),h=Math.max(d.from,0),m=Math.min(d.to,r.length-1);n.save();for(let L=h;L<=m;L++){const O=(B=r[L])==null?void 0:B.timestamp,Y=O!=null?t.result[O]:void 0;if(!Y||typeof Y.ao!="number")continue;const ce=s.convertToPixel(L),Q=o.convertToPixel(0),le=o.convertToPixel(Y.ao),ue=s.convertToPixel(1)-s.convertToPixel(0),pe=Math.max(1,Math.floor(ue-1)),Z=Math.min(Q,le),xe=Math.abs(Q-le);let oe=u;const Pe=($=r[L-1])==null?void 0:$.timestamp,$e=Pe!=null?t.result[Pe]:void 0,ze=$e&&typeof $e.ao=="number"?$e.ao:null;Y.ao>=0?(ze===null||Y.ao>=ze)&&(oe=l):(ze===null||Y.ao<=ze)&&(oe=c),n.fillStyle=oe;const Ke=Math.round(ce)-Math.floor(pe/2),qe=Math.round(Z),nt=Math.max(1,Math.round(xe));n.fillRect(Ke,qe,pe,nt)}return n.restore(),!0}},WE={name:"BOLL",shortName:"BOLL",precision:2,calcParams:[20,2],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"upper",title:"Upper: ",type:"line"},{key:"middle",title:"Middle: ",type:"line"},{key:"lower",title:"Lower: ",type:"line"}],styles:{lines:[{color:"#f23645",size:1,style:wt.Solid,smooth:!1,dashedValue:[0,0]},{color:"#2962ff",size:1,style:wt.Solid,smooth:!1,dashedValue:[0,0]},{color:"#089981",size:1,style:wt.Solid,smooth:!1,dashedValue:[0,0]}],fill:{color:"#2196F3",opacity:.05}},calc:(n,e)=>{const t=e.calcParams[0]||20,s=e.calcParams[1]||2,o={};for(let r=0;r<n.length;r++){const a=n[r].timestamp;if(r<t-1){o[a]={};continue}let l=0;for(let m=r-t+1;m<=r;m++)l+=n[m].close;const c=l/t;let f=0;for(let m=r-t+1;m<=r;m++)f+=Math.pow(n[m].close-c,2);const u=Math.sqrt(f/t),d=c+s*u,h=c-s*u;o[a]={upper:d,middle:c,lower:h}}return o},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var w,C,P,I,A,M,F,B,$,L,O,Y,ce,Q,le,ue,fe,pe,Z,xe,oe,Pe,$e,ze,Ke,qe,nt,ft,ut,bt,Pt,Et,Mt,Je,Ct,Ze;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),c=Math.max(l.from,0),f=Math.min(l.to,a.length-1);n.save();const u={color:((P=(C=(w=t.styles)==null?void 0:w.lines)==null?void 0:C[0])==null?void 0:P.color)||"#2196F3",size:((M=(A=(I=t.styles)==null?void 0:I.lines)==null?void 0:A[0])==null?void 0:M.size)||1,style:(($=(B=(F=t.styles)==null?void 0:F.lines)==null?void 0:B[0])==null?void 0:$.style)||wt.Solid},d={color:((Y=(O=(L=t.styles)==null?void 0:L.lines)==null?void 0:O[1])==null?void 0:Y.color)||"#FF9800",size:((le=(Q=(ce=t.styles)==null?void 0:ce.lines)==null?void 0:Q[1])==null?void 0:le.size)||1,style:((pe=(fe=(ue=t.styles)==null?void 0:ue.lines)==null?void 0:fe[1])==null?void 0:pe.style)||wt.Solid},h={color:((oe=(xe=(Z=t.styles)==null?void 0:Z.lines)==null?void 0:xe[2])==null?void 0:oe.color)||"#2196F3",size:((ze=($e=(Pe=t.styles)==null?void 0:Pe.lines)==null?void 0:$e[2])==null?void 0:ze.size)||1,style:((nt=(qe=(Ke=t.styles)==null?void 0:Ke.lines)==null?void 0:qe[2])==null?void 0:nt.style)||wt.Solid},m={color:((ut=(ft=t.styles)==null?void 0:ft.fill)==null?void 0:ut.color)||"rgba(33, 150, 243, 0.1)",opacity:((Pt=(bt=t.styles)==null?void 0:bt.fill)==null?void 0:Pt.opacity)||.1};n.beginPath();let g=!0;for(let Xe=c;Xe<=f;Xe++){const Ae=(Et=a[Xe])==null?void 0:Et.timestamp,Qe=t.result[Ae];if(!Qe||typeof Qe.upper!="number")continue;const gt=o.convertToPixel(Xe),Ft=r.convertToPixel(Qe.upper);g?(n.moveTo(gt,Ft),g=!1):n.lineTo(gt,Ft)}for(let Xe=f;Xe>=c;Xe--){const Ae=(Mt=a[Xe])==null?void 0:Mt.timestamp,Qe=t.result[Ae];if(!Qe||typeof Qe.lower!="number")continue;const gt=o.convertToPixel(Xe),Ft=r.convertToPixel(Qe.lower);n.lineTo(gt,Ft)}n.closePath(),n.globalAlpha=m.opacity,n.fillStyle=m.color,n.fill(),n.globalAlpha=1,n.beginPath(),g=!0;for(let Xe=c;Xe<=f;Xe++){const Ae=(Je=a[Xe])==null?void 0:Je.timestamp,Qe=t.result[Ae];if(!Qe||typeof Qe.upper!="number")continue;const gt=o.convertToPixel(Xe),Ft=r.convertToPixel(Qe.upper);g?(n.moveTo(gt,Ft),g=!1):n.lineTo(gt,Ft)}n.strokeStyle=u.color,n.lineWidth=u.size,n.setLineDash(u.style===wt.Dashed?[4,4]:[]),n.stroke(),n.beginPath(),g=!0;for(let Xe=c;Xe<=f;Xe++){const Ae=(Ct=a[Xe])==null?void 0:Ct.timestamp,Qe=t.result[Ae];if(!Qe||typeof Qe.lower!="number")continue;const gt=o.convertToPixel(Xe),Ft=r.convertToPixel(Qe.lower);g?(n.moveTo(gt,Ft),g=!1):n.lineTo(gt,Ft)}n.strokeStyle=h.color,n.lineWidth=h.size,n.setLineDash(h.style===wt.Dashed?[4,4]:[]),n.stroke(),n.beginPath(),g=!0;for(let Xe=c;Xe<=f;Xe++){const Ae=(Ze=a[Xe])==null?void 0:Ze.timestamp,Qe=t.result[Ae];if(!Qe||typeof Qe.middle!="number")continue;const gt=o.convertToPixel(Xe),Ft=r.convertToPixel(Qe.middle);g?(n.moveTo(gt,Ft),g=!1):n.lineTo(gt,Ft)}return n.strokeStyle=d.color,n.lineWidth=d.size,n.setLineDash(d.style===wt.Dashed?[4,4]:[]),n.stroke(),n.restore(),!0}};function HE(n,e){const t=e.calcParams||[26,10,20,40,60],[s,o,r,a,l]=t,c={};if(n.length<s+1)return n.reduce((u,d,h)=>(u[d.timestamp]={},u),{});const f=[];for(let u=1;u<n.length;u++){n[u];const d=n[u-1];(d.high+d.low+d.close)/3;let h=0,m=0;const g=Math.max(0,u-s+1);for(let M=g;M<=u;M++){const F=n[M],B=M>0?n[M-1]:F,$=(B.high+B.low+B.close)/3,L=F.high-$,O=$-F.low;L>0&&(h+=L),O>0&&(m+=O)}const w=m!==0?h/m*100:100;f.push(w);const C=pb(f,o),P=pb(f,r),I=pb(f,a),A=pb(f,l);c[n[u].timestamp]={cr:w,ma1:C!==null?C:void 0,ma2:P!==null?P:void 0,ma3:I!==null?I:void 0,ma4:A!==null?A:void 0}}return c}function pb(n,e){return n.length<e?null:n.slice(-e).reduce((s,o)=>s+o,0)/e}const qE={name:"CR",shortName:"CR",precision:2,calcParams:[26,10,20,40,60],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:HE,regenerateFigures:n=>{const[,e,t,s,o]=n;return[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:`MA${e}: `,type:"line"},{key:"ma2",title:`MA${t}: `,type:"line"},{key:"ma3",title:`MA${s}: `,type:"line"},{key:"ma4",title:`MA${o}: `,type:"line"}]},styles:{lines:[{color:"#FF6B35",size:2,style:wt.Solid},{color:"#2196F3",size:1,style:wt.Solid},{color:"#4CAF50",size:1,style:wt.Solid},{color:"#FF9800",size:1,style:wt.Solid},{color:"#9C27B0",size:1,style:wt.Solid}]}},UE={name:"EMV",shortName:"EMV",precision:4,calcParams:[14,9],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{e.calcParams[0];const t=e.calcParams[1]||9,s={};if(n.length<2)return n.reduce((r,a)=>(r[a.timestamp]={},r),{});const o=[];for(let r=0;r<n.length;r++){const a=n[r];if(r===0){s[a.timestamp]={};continue}const l=n[r-1],c=(a.high+a.low)/2,f=(l.high+l.low)/2,u=c-f,d=a.high-a.low,h=a.volume||0;let m=0;if(d>0&&h>0){const w=h/d;m=u/w}o.push(m);let g;if(o.length>=t){let w=0;for(let C=o.length-t;C<o.length;C++)w+=o[C];g=w/t}s[a.timestamp]={emv:m,maEmv:g}}return s},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{e.getVisibleRange(),n.save(),n.lineWidth=1,n.setLineDash([2,2]),n.strokeStyle="rgba(107, 114, 128, 0.6)",n.beginPath();const a=r.convertToPixel(0);return n.moveTo(s.left,a),n.lineTo(s.left+s.width,a),n.stroke(),n.restore(),!1}},GE={name:"MTM",shortName:"MTM",precision:4,calcParams:[12],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"mtm",title:"MTM: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||12;return n.reduce((s,o,r)=>{if(r>=t){const a=o.close,l=n[r-t].close;s[o.timestamp]={mtm:a-l}}else s[o.timestamp]={};return s},{})}},YE={name:"TRIX",shortName:"TRIX",precision:4,calcParams:[14,9],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"signal",title:"Signal: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#2563eb",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#dc2626",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[s,o]=t,r=KE(n,s),a=Hb(r,o);return n.reduce((l,c,f)=>(l[c.timestamp]={trix:r[f],signal:a[f]},l),{})}};function KE(n,e){const t=n.map(l=>l.close),s=Hb(t,e),o=Hb(s,e),r=Hb(o,e),a=[];for(let l=0;l<r.length;l++)if(l===0||r[l]===null||r[l-1]===null||r[l-1]===0)a.push(null);else{const c=(r[l]-r[l-1])/r[l-1]*1e4;a.push(c)}return a}function Hb(n,e){const t=[],s=2/(e+1);let o=null;for(let r=0;r<n.length;r++){if(n[r]===null){t.push(null);continue}if(o===null){if(r>=e-1){let a=0,l=0;for(let c=r-e+1;c<=r;c++)n[c]!==null&&(a+=n[c],l++);o=l>0?a/l:null}}else o=n[r]*s+o*(1-s);t.push(o)}return t}const XE={name:"VOL",shortName:"VOL",series:"volume",precision:10,calcParams:[20],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:-1,extendData:void 0,figures:[],styles:{bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#26a69a"}],lines:[{color:"#8B5CF6",size:1,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{var r,a;const s=e.calcParams[0]||20,o={};for(let l=0;l<n.length;l++){const c=n[l],f=c.volume||0;let u=0;if(l===0)u=f;else{const d=2/(s+1),h=(r=n[l-1])==null?void 0:r.timestamp,m=(h!=null?(a=o[h])==null?void 0:a.ema:void 0)??f;u=f*d+m*(1-d)}o[c.timestamp]={volume:f,ema:u}}return o},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o})=>{var M,F,B,$,L,O,Y,ce,Q,le,ue,fe,pe,Z,xe,oe,Pe,$e,ze,Ke,qe,nt,ft,ut,bt,Pt,Et,Mt,Je,Ct;if(!t.result||Object.keys(t.result).length===0)return!1;const r=e.getVisibleRange();if(!r)return!1;const{from:a,to:l}=r,c=e.getDataList();if(!c||c.length===0)return!1;const f=((B=(F=(M=t.styles)==null?void 0:M.bars)==null?void 0:F[0])==null?void 0:B.upColor)||"#26a69a",u=((O=(L=($=t.styles)==null?void 0:$.bars)==null?void 0:L[0])==null?void 0:O.downColor)||"#ef5350",d=((Q=(ce=(Y=t.styles)==null?void 0:Y.bars)==null?void 0:ce[0])==null?void 0:Q.noChangeColor)||"#26a69a",h=((fe=(ue=(le=t.styles)==null?void 0:le.lines)==null?void 0:ue[0])==null?void 0:fe.color)||"#8B5CF6";n.save();let m=0;for(let Ze=a;Ze<=l&&Ze<c.length;Ze++){const Xe=(pe=c[Ze])==null?void 0:pe.timestamp,Ae=Xe!=null?t.result[Xe]:void 0;Ae&&(Ae.volume!=null&&Ae.volume>m&&(m=Ae.volume),Ae.ema!=null&&Ae.ema>m&&(m=Math.max(m,Ae.ema)))}if(m<=0)return n.restore(),!0;const w=Math.max(10,Math.floor(s.height*.22)),C=s.top+s.height-1,I=Math.max(1,Math.floor(w*.56));for(let Ze=a;Ze<=l&&Ze<c.length;Ze++){const Xe=(Z=c[Ze])==null?void 0:Z.timestamp,Ae=Xe!=null?t.result[Xe]:void 0;if(!Ae||Ae.volume==null)continue;const Qe=c[Ze],gt=Ze>0&&Ze-1<c.length?c[Ze-1]:null;let Ft=d;gt&&Qe&&typeof Qe.close=="number"&&typeof gt.close=="number"&&(Qe.close>gt.close?Ft=f:Qe.close<gt.close&&(Ft=u));const ot=o.convertToPixel(Ze),ve=Math.min(1,Ae.volume/m),Ie=Math.max(1,Math.floor(ve*I)),It=C-Ie,Dt=o.convertToPixel(1)-o.convertToPixel(0),Zt=Dt<2,hn=Dt-(Zt?.5:1),qn=Zt?Math.max(.5,hn):Math.max(1,Math.floor(hn)),On=(Pe=(oe=(xe=t==null?void 0:t.styles)==null?void 0:xe.bars)==null?void 0:oe[0])==null?void 0:Pe.opacity;let bn=typeof On=="number"?On:void 0;if(bn==null){const Xs=(Ft||"").toString().match(/^rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+(?:\s*,\s*([0-9]*\.?[0-9]+))?\s*\)$/i);if(Xs){const oo=Xs[1]!=null?parseFloat(Xs[1]):1;bn=isNaN(oo)?.7:oo}else bn=.7}n.globalAlpha=Math.max(0,Math.min(1,bn)),n.fillStyle=Ft;const Fn=Zt?Math.round((ot-qn/2)*2)/2:Math.round(ot)-Math.floor(qn/2);n.fillRect(Fn,It,qn,Ie)}if(n.globalAlpha=1,((Ke=(ze=($e=t==null?void 0:t.styles)==null?void 0:$e.lines)==null?void 0:ze[0])==null?void 0:Ke.visible)===!0){const Ze=((ft=(nt=(qe=t.styles)==null?void 0:qe.lines)==null?void 0:nt[0])==null?void 0:ft.style)||wt.Solid,Xe=((Pt=(bt=(ut=t.styles)==null?void 0:ut.lines)==null?void 0:bt[0])==null?void 0:Pt.size)||1,Ae=((Je=(Mt=(Et=t.styles)==null?void 0:Et.lines)==null?void 0:Mt[0])==null?void 0:Je.dashedValue)||[2,2];n.lineWidth=Xe,n.strokeStyle=h,Ze===wt.Dashed?n.setLineDash(Ae):n.setLineDash([]);const Qe=[];for(let gt=a;gt<=l&&gt<c.length;gt++){const Ft=(Ct=c[gt])==null?void 0:Ct.timestamp,ot=Ft!=null?t.result[Ft]:void 0;if(!ot||ot.ema==null)continue;const ve=o.convertToPixel(gt),Ie=Math.min(1,ot.ema/m),It=C-Math.floor(Ie*I);Qe.push({x:ve,y:It})}if(Qe.length>1){n.save(),n.beginPath(),n.moveTo(Qe[0].x,C);for(const gt of Qe)n.lineTo(gt.x,gt.y);n.lineTo(Qe[Qe.length-1].x,C),n.closePath(),n.globalAlpha=.25,n.fillStyle=h,n.fill(),n.globalAlpha=1,n.restore(),n.beginPath(),n.moveTo(Qe[0].x,Qe[0].y);for(let gt=1;gt<Qe.length;gt++)n.lineTo(Qe[gt].x,Qe[gt].y);n.stroke()}}return n.restore(),!0}},ZE={name:"SMA",shortName:"SMA",precision:2,calcParams:[20],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"sma",title:"SMA: ",type:"line"}],styles:{lines:[{color:"#FF6C37",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||20,s={};for(let o=0;o<n.length;o++){const r=n[o].timestamp;if(o<t-1){s[r]={};continue}let a=0;for(let c=o-t+1;c<=o;c++)a+=n[c].close;const l=a/t;s[r]={sma:l}}return s},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var h,m,g,w,C,P,I,A,M,F;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l;n.save();const u={color:((g=(m=(h=t.styles)==null?void 0:h.lines)==null?void 0:m[0])==null?void 0:g.color)??"#FF6C37",size:((P=(C=(w=t.styles)==null?void 0:w.lines)==null?void 0:C[0])==null?void 0:P.size)??2,style:((M=(A=(I=t.styles)==null?void 0:I.lines)==null?void 0:A[0])==null?void 0:M.style)??wt.Solid};n.beginPath();let d=!0;for(let B=c;B<=f;B++){const $=(F=a[B])==null?void 0:F.timestamp,L=t.result[$];if(!L||typeof L.sma!="number")continue;const O=o.convertToPixel(B),Y=r.convertToPixel(L.sma);d?(n.moveTo(O,Y),d=!1):n.lineTo(O,Y)}return n.strokeStyle=u.color,n.lineWidth=u.size,u.style===wt.Dashed?n.setLineDash([8,4]):n.setLineDash([]),n.stroke(),n.restore(),!0}},Uh=new Map,K1=n=>({id:n,kPeriod:14,dPeriod:3,dutyColor:"#1E90FF",dutyThickness:2,dutyStyle:"solid",dLineColor:"#FF1493",dLineThickness:2,dLineStyle:"dashed",showLevels:!0,showZones:!0,overboughtLevel:80,oversoldLevel:20,midlineLevel:50,showOverbought:!0,showOversold:!0,showMidline:!1,levels:[{id:"overbought",value:80,color:"#EF4444",lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:20,color:"#10B981",lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"midline",value:50,color:"#6B7280",lineStyle:"dotted",thickness:1,label:"Midline",visible:!1}],zones:[{id:"overbought_zone",topLevel:100,bottomLevel:80,fillColor:"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold_zone",topLevel:20,bottomLevel:0,fillColor:"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}]}),JE=(n,e,t)=>{const s=[],o=[];if(n.length<e)return{k:n.map(()=>NaN),d:n.map(()=>NaN)};for(let r=0;r<n.length;r++){if(r<e-1){s.push(NaN);continue}let a=n[r-e+1].high,l=n[r-e+1].low;for(let u=r-e+2;u<=r;u++)n[u].high>a&&(a=n[u].high),n[u].low<l&&(l=n[u].low);const c=n[r].close,f=a-l;if(f===0)s.push(50);else{const u=100*((c-l)/f);s.push(u)}}for(let r=0;r<s.length;r++){if(r<e-1+t-1){o.push(NaN);continue}let a=0,l=0;for(let c=r-t+1;c<=r;c++)isNaN(s[c])||(a+=s[c],l++);l===0?o.push(NaN):o.push(a/l)}return{k:s,d:o}},QE={name:"STOCH",shortName:"Stoch",precision:2,calcParams:[14,3],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:0,maxValue:100,figures:[{key:"k",title:"%K: ",type:"line"},{key:"d",title:"%D: ",type:"line"}],styles:{lines:[{color:"#1E90FF",size:2,style:wt.Solid,smooth:!1,dashedValue:[0,0]},{color:"#FF1493",size:2,style:wt.Dashed,smooth:!1,dashedValue:[4,4]}]},calc:(n,e)=>{const t=e.calcParams[0]||14,s=e.calcParams[1]||3,{k:o,d:r}=JE(n,t,s);return n.reduce((a,l,c)=>{const f=o[c],u=r[c];return a[l.timestamp]={k:isNaN(f)?null:f,d:isNaN(u)?null:u},a},{})},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{const a=t.paneId||"default";let l=Uh.get(a);l||(l=K1(a),Uh.set(a,l));const{left:c,top:f,width:u,height:d}=s;return e.getVisibleRange(),n.save(),l.showZones&&l.zones.forEach(h=>{if(!h.visible)return;const m=r.convertToPixel(h.topLevel),g=r.convertToPixel(h.bottomLevel);if(m!==null&&g!==null&&isFinite(m)&&isFinite(g)&&isFinite(c)&&isFinite(u)){n.save();const w=Math.abs(m-g),C=Math.min(m,g);if(!isFinite(w)||!isFinite(C)||w===0){n.restore();return}const P=n.createLinearGradient(c,C,c,C+w),A=h.fillColor.match(/\w\w/g);if(A){const M=parseInt(A[0],16),F=parseInt(A[1],16),B=parseInt(A[2],16);P.addColorStop(0,`rgba(${M}, ${F}, ${B}, ${h.fillOpacity*.8})`),P.addColorStop(.3,`rgba(${M}, ${F}, ${B}, ${h.fillOpacity*.6})`),P.addColorStop(.7,`rgba(${M}, ${F}, ${B}, ${h.fillOpacity*.3})`),P.addColorStop(1,`rgba(${M}, ${F}, ${B}, ${h.fillOpacity*.1})`)}else P.addColorStop(0,h.fillColor+Math.floor(h.fillOpacity*255).toString(16).padStart(2,"0")),P.addColorStop(.5,h.fillColor+Math.floor(h.fillOpacity*128).toString(16).padStart(2,"0")),P.addColorStop(1,h.fillColor+Math.floor(h.fillOpacity*32).toString(16).padStart(2,"0"));n.fillStyle=P,n.fillRect(c,C,u,w),n.strokeStyle=h.fillColor+"40",n.lineWidth=.5,n.strokeRect(c,C,u,w),n.restore()}}),l.showLevels&&l.levels.forEach(h=>{if(!h.visible)return;const m=r.convertToPixel(h.value);m!==null&&isFinite(m)&&m>=f&&m<=f+d&&isFinite(c)&&isFinite(u)&&(n.save(),n.strokeStyle=h.color,n.lineWidth=h.thickness,h.lineStyle==="dashed"?n.setLineDash([4,4]):h.lineStyle==="dotted"?n.setLineDash([2,6]):n.setLineDash([]),n.beginPath(),n.moveTo(c,m),n.lineTo(c+u,m),n.stroke(),n.fillStyle=h.color,n.font="10px Arial",n.textAlign="left",n.fillText(`${h.value}`,c+5,m-3),n.restore())}),n.restore(),!1}},mb={createInstance:(n,e)=>{const t={...K1(n),...e};return Uh.set(n,t),t},getInstance:n=>Uh.get(n),updateInstance:(n,e)=>{const t=Uh.get(n);return t?(Object.assign(t,e),!0):!1},deleteInstance:n=>Uh.delete(n),addLevel:(n,e)=>{const t=Uh.get(n);if(t){const s=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:s,...e};return t.levels.push(o),s}throw new Error(`Stochastic instance ${n} not found`)},removeLevel:(n,e)=>{const t=Uh.get(n);if(t){const s=t.levels.findIndex(o=>o.id===e);if(s!==-1)return t.levels.splice(s,1),!0}return!1},updateLevel:(n,e,t)=>{const s=Uh.get(n);if(s){const o=s.levels.find(r=>r.id===e);if(o)return Object.assign(o,t),e==="overbought"?s.overboughtLevel=o.value:e==="oversold"?s.oversoldLevel=o.value:e==="midline"&&(s.midlineLevel=o.value),!0}return!1},addZone:(n,e)=>{const t=Uh.get(n);if(t){const s=`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:s,...e};return t.zones.push(o),s}throw new Error(`Stochastic instance ${n} not found`)},removeZone:(n,e)=>{const t=Uh.get(n);if(t){const s=t.zones.findIndex(o=>o.id===e);if(s!==-1)return t.zones.splice(s,1),!0}return!1},updateZone:(n,e,t)=>{const s=Uh.get(n);if(s){const o=s.zones.find(r=>r.id===e);if(o)return Object.assign(o,t),!0}return!1},getInstanceConfig:n=>Uh.get(n)||null,resetInstance:n=>{const e=K1(n);Uh.set(n,e)},exportInstanceConfig:n=>{const e=Uh.get(n);return e?{id:e.id,kPeriod:e.kPeriod,dPeriod:e.dPeriod,dutyColor:e.dutyColor,dutyThickness:e.dutyThickness,dutyStyle:e.dutyStyle,dLineColor:e.dLineColor,dLineThickness:e.dLineThickness,dLineStyle:e.dLineStyle,showLevels:e.showLevels,showZones:e.showZones,overboughtLevel:e.overboughtLevel,oversoldLevel:e.oversoldLevel,midlineLevel:e.midlineLevel,showOverbought:e.showOverbought,showOversold:e.showOversold,showMidline:e.showMidline,levels:e.levels.map(t=>({...t})),zones:e.zones.map(t=>({...t}))}:null},importInstanceConfig:n=>{try{const e={id:n.id,kPeriod:n.kPeriod||14,dPeriod:n.dPeriod||3,dutyColor:n.dutyColor||"#1E90FF",dutyThickness:n.dutyThickness||2,dutyStyle:n.dutyStyle||"solid",dLineColor:n.dLineColor||"#FF1493",dLineThickness:n.dLineThickness||2,dLineStyle:n.dLineStyle||"dashed",showLevels:n.showLevels!==!1,showZones:n.showZones!==!1,overboughtLevel:n.overboughtLevel||80,oversoldLevel:n.oversoldLevel||20,midlineLevel:n.midlineLevel||50,showOverbought:n.showOverbought!==!1,showOversold:n.showOversold!==!1,showMidline:n.showMidline||!1,levels:n.levels||K1(n.id).levels,zones:n.zones||K1(n.id).zones};return Uh.set(n.id,e),!0}catch(e){return console.error("Failed to import Stochastic instance config:",e),!1}},getAllInstances:()=>new Map(Uh),clearAllInstances:()=>{Uh.clear()}},e$={name:"SMARTTREND",shortName:"Smart Trend",precision:2,calcParams:[10,3],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,extendData:{showLabels:!0},figures:[{key:"superTrend",title:"Smart Trend: ",type:"line"}],styles:{lines:[{color:"#00FF00",size:2,style:wt.Solid,smooth:!1,dashedValue:[0,0]}]},calc:(n,e)=>{var g;const t=e.calcParams[0]||10,s=e.calcParams[1]||3,o={},r=(w,C)=>{if(!C)return w.high-w.low;const P=w.high-w.low,I=Math.abs(w.high-C.close),A=Math.abs(w.low-C.close);return Math.max(P,I,A)},a=w=>{if(w<t-1)return 0;let C=0;for(let P=w-t+1;P<=w;P++){const I=n[P],A=P>0?n[P-1]:void 0;C+=r(I,A)}return C/t};let l=1,c=0,f=0,u=-1,d,h=-1,m;for(let w=0;w<n.length;w++){const C=n[w].timestamp;if(w<t-1){o[C]={};continue}const P=n[w],I=w>0?n[w-1]:P,A=a(w),M=(P.high+P.low)/2,F=M+s*A,B=M-s*A;if(w===t-1)c=F,f=B;else{o[w-1];const Z=I.close;(F<c||Z>c)&&(c=F),(B>f||Z<f)&&(f=B)}let $=l,L=0,O,Y,ce,Q,le,ue,fe,pe;if(w>t-1){const Z=n[w-1].timestamp;if((g=o[Z])!=null&&g.superTrend,l===1&&P.close<=f?$=-1:l===-1&&P.close>=c&&($=1),$!==l){if($===1){if(O=f,ce=P.close,u=w,d=P.close,m!==void 0&&h>=0){ue=P.close,pe=m-ue;const xe=n[h].timestamp,oe=o[xe];oe.sellExit=ue,oe.sellProfit=pe,m=void 0,h=-1}}else if(Y=c,Q=P.close,h=w,m=P.close,d!==void 0&&u>=0){le=P.close,fe=le-d;const xe=n[u].timestamp,oe=o[xe];oe.buyExit=le,oe.buyProfit=fe,d=void 0,u=-1}}}$===1?L=f:L=c,o[C]={superTrend:L,trend:$,buySignal:O,sellSignal:Y,buyEntry:ce,sellEntry:Q,buyExit:le,sellExit:ue,buyProfit:fe,sellProfit:pe},l=$}return o},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var L,O,Y,ce,Q,le,ue;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l;n.save();const u=(fe,pe,Z,xe,oe,Pe)=>{const $e=Math.min(Pe,xe/2,oe/2);fe.beginPath(),fe.moveTo(pe+$e,Z),fe.arcTo(pe+xe,Z,pe+xe,Z+oe,$e),fe.arcTo(pe+xe,Z+oe,pe,Z+oe,$e),fe.arcTo(pe,Z+oe,pe,Z,$e),fe.arcTo(pe,Z,pe+xe,Z,$e),fe.closePath()},d=(fe,pe)=>{if(!fe)return`rgba(0,0,0,${pe})`;if(fe.startsWith("rgb"))return fe.startsWith("rgba")?fe.replace(/rgba\(([^)]+)\)/,($e,ze)=>{const Ke=ze.split(",").map(qe=>qe.trim());return`rgba(${Ke[0]}, ${Ke[1]}, ${Ke[2]}, ${pe})`}):fe.replace(/rgb\(([^)]+)\)/,($e,ze)=>`rgba(${ze}, ${pe})`);const Z=fe.replace("#",""),xe=parseInt(Z.substring(0,2),16),oe=parseInt(Z.substring(2,4),16),Pe=parseInt(Z.substring(4,6),16);return`rgba(${xe}, ${oe}, ${Pe}, ${pe})`},h=(fe,pe,Z,xe)=>{const oe="bold 10px Arial";n.font=oe;const Pe=n.measureText(Z),$e=Pe.actualBoundingBoxAscent&&Pe.actualBoundingBoxDescent?Pe.actualBoundingBoxAscent+Pe.actualBoundingBoxDescent:10,ze=6,Ke=4,qe=Math.ceil(Pe.width)+ze*2,nt=Math.ceil($e)+Ke*2,ft=Math.round(fe-qe/2),ut=Math.round(pe-nt/2),bt=typeof performance<"u"?performance.now():Date.now(),Pt=.35+.25*Math.sin(bt/450);n.save(),n.shadowColor=d(xe,Math.max(0,Pt)),n.shadowBlur=12,n.fillStyle=d(xe,.14),u(n,ft,ut,qe,nt,6),n.fill(),n.restore(),n.lineWidth=1,n.strokeStyle=d(xe,.9),u(n,ft,ut,qe,nt,6),n.stroke(),n.fillStyle=d(xe,.95),n.textAlign="center",n.textBaseline="middle",n.font=oe,n.fillText(Z,fe,pe+.5)},m=t.extendData,g=(m==null?void 0:m.showLabels)!==!1,w=(m==null?void 0:m.uptrendColor)||"#00FF00",C=(m==null?void 0:m.downtrendColor)||"#FF0000",P=(m==null?void 0:m.uptrendThickness)??2,I=(m==null?void 0:m.downtrendThickness)??2,A=(m==null?void 0:m.uptrendLineStyle)||"solid",M=(m==null?void 0:m.downtrendLineStyle)||"solid";let F=[],B=c,$=((O=t.result[(L=a[c])==null?void 0:L.timestamp])==null?void 0:O.trend)||1;for(let fe=c+1;fe<=f;fe++){const pe=(Y=a[fe])==null?void 0:Y.timestamp,Z=t.result[pe],xe=(Z==null?void 0:Z.trend)??$,oe=fe===f;if(xe!==$||oe){const Pe=oe&&xe===$?fe:fe-1;F.push({start:B,end:Pe,trend:$}),B=fe,$=xe}}if(F.forEach(fe=>{var $e,ze;const pe=fe.trend===1,Z=pe?w:C,xe=pe?P:I,oe=pe?A:M;n.strokeStyle=Z,n.lineWidth=Number(xe)||2,n.lineCap="round",n.lineJoin="round",oe==="dashed"?n.setLineDash([4,4]):oe==="dotted"?n.setLineDash([2,6]):n.setLineDash([]),n.beginPath();let Pe=!0;for(let Ke=fe.start;Ke<=fe.end;Ke++){const qe=($e=a[Ke])==null?void 0:$e.timestamp,nt=t.result[qe];if(nt&&typeof nt.superTrend=="number"){const ft=o.convertToPixel(Ke),ut=r.convertToPixel(nt.superTrend);Pe?(n.moveTo(ft,ut),Pe=!1):n.lineTo(ft,ut)}}if(n.stroke(),g){const Ke=(ze=a[fe.end])==null?void 0:ze.timestamp,qe=t.result[Ke];if(qe&&typeof qe.superTrend=="number"){const ft=fe===F[F.length-1]?"HOLD":"EXIT",ut=o.convertToPixel(fe.end),bt=r.convertToPixel(qe.superTrend);h(ut,bt+(pe?22:-22),ft,Z)}}}),g){let fe=0;try{const Z=(ce=e==null?void 0:e.getDataList)==null?void 0:ce.call(e);if(Z&&Z.length>0)fe=((Q=Z[Z.length-1])==null?void 0:Q.close)??0;else{const xe=(le=a[f])==null?void 0:le.timestamp,oe=t.result[xe];fe=(oe==null?void 0:oe.superTrend)??0}}catch{}const pe=(t==null?void 0:t.precision)??2;for(let Z=c;Z<=f;Z++){const xe=(ue=a[Z])==null?void 0:ue.timestamp,oe=t.result[xe];if(!oe)continue;const Pe=o.convertToPixel(Z);if(oe.buySignal!==void 0){const $e=r.convertToPixel(oe.buySignal);n.fillStyle="#00FF00",n.beginPath(),n.arc(Pe,$e-10,4,0,2*Math.PI),n.fill();const ze=oe.buyEntry??oe.buySignal,Ke=oe.buyExit!==void 0?oe.buyExit-ze:fe?fe-ze:0,qe=`${Ke>=0?"+":""}${Number(Ke).toFixed(pe)}`;h(Pe,$e+22,`BUY ${qe}`,"#10B981")}if(oe.sellSignal!==void 0){const $e=r.convertToPixel(oe.sellSignal);n.fillStyle="#FF0000",n.beginPath(),n.arc(Pe,$e+10,4,0,2*Math.PI),n.fill();const ze=oe.sellEntry??oe.sellSignal,Ke=oe.sellExit!==void 0?ze-oe.sellExit:fe?ze-fe:0,qe=`${Ke>=0?"+":""}${Number(Ke).toFixed(pe)}`;h(Pe,$e-22,`SELL ${qe}`,"#EF4444")}}}return n.restore(),!0}},t$={name:"MACD",shortName:"MACD",calcParams:[12,26,9],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:4,minValue:-1e-9,maxValue:1e-9,styles:{lines:[{color:"#2563eb",size:1,style:wt.Solid,dashedValue:[2,2]},{color:"#dc2626",size:1,style:wt.Solid,dashedValue:[2,2]}],bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575",reverseColor:"#c4c4c4"}]},figures:[{key:"macd",title:"MACD: ",type:"line",baseValue:0},{key:"signal",title:"Signal: ",type:"line",baseValue:0},{key:"hist",title:"Hist: ",type:"bar",baseValue:0}],calc:(n,e)=>{var h,m,g;const t=((h=e.calcParams)==null?void 0:h[0])||12,s=((m=e.calcParams)==null?void 0:m[1])||26,o=((g=e.calcParams)==null?void 0:g[2])||9,r=(w,C)=>{const P=2/(w+1),I=[];let A;for(let M=0;M<C.length;M++){const F=C[M];A===void 0?A=F:A=F*P+A*(1-P),I.push(A)}return I},a=n.map(w=>w.close),l=r(t,a),c=r(s,a),f=a.map((w,C)=>(l[C]??NaN)-(c[C]??NaN)),u=r(o,f.map(w=>Number.isFinite(w)?w:0)),d={};for(let w=0;w<n.length;w++){const C=n[w].timestamp;if(!Number.isFinite(f[w])||!Number.isFinite(u[w])){d[C]={};continue}const P=f[w],I=u[w],A=P-I;d[C]={macd:P,signal:I,hist:A}}return d},draw:({ctx:n,chart:e,indicator:t,xAxis:s,yAxis:o})=>{var w,C,P,I,A,M,F,B,$,L;const r=e.getDataList();if(!t.result||r.length===0)return!1;const a=t.styles||{},l=((C=(w=a==null?void 0:a.bars)==null?void 0:w[0])==null?void 0:C.upColor)||"#2563eb",c=((I=(P=a==null?void 0:a.bars)==null?void 0:P[0])==null?void 0:I.downColor)||"#ef4444",f=((M=(A=a==null?void 0:a.bars)==null?void 0:A[0])==null?void 0:M.reverseColor)||((B=(F=a==null?void 0:a.bars)==null?void 0:F[0])==null?void 0:B.noChangeColor)||"#c4c4c4",u=(a==null?void 0:a.lines)||[],d=e.getVisibleRange(),h=Math.max(d.from,0),m=Math.min(d.to,r.length-1);n.save();for(let O=h;O<=m;O++){const Y=($=r[O])==null?void 0:$.timestamp,ce=t.result[Y];if(!ce||typeof ce.hist!="number")continue;const Q=s.convertToPixel(O),le=o.convertToPixel(0),ue=o.convertToPixel(ce.hist),fe=s.convertToPixel(1)-s.convertToPixel(0),Z=Math.max(1,Math.floor(fe-1)),xe=Math.min(le,ue),oe=Math.abs(le-ue);let Pe=f;const $e=(L=r[O-1])==null?void 0:L.timestamp,ze=$e!=null?t.result[$e]:void 0,Ke=ze&&typeof ze.hist=="number"?ze.hist:null;ce.hist>=0?Ke===null||ce.hist>=Ke?Pe=l:Pe=f:Ke===null||ce.hist<=Ke?Pe=c:Pe=f,n.fillStyle=Pe;const qe=Math.round(Q)-Math.floor(Z/2),nt=Math.round(xe),ft=Math.max(1,Math.round(oe));n.fillRect(qe,nt,Z,ft)}n.restore();const g=(O,Y)=>{var ue;n.save(),n.beginPath(),n.lineWidth=(Y==null?void 0:Y.size)??1,(Y==null?void 0:Y.style)===wt.Dashed?n.setLineDash((Y==null?void 0:Y.dashedValue)??[4,4]):n.setLineDash([]),n.strokeStyle=(Y==null?void 0:Y.color)||"#ffffff";const Q=n.lineWidth%2?.5:0;n.lineCap="butt",n.lineJoin="miter";let le=!0;for(let fe=h;fe<=m;fe++){const pe=(ue=r[fe])==null?void 0:ue.timestamp,Z=t.result[pe];if(!Z||typeof Z[O]!="number")continue;const xe=Math.round(s.convertToPixel(fe))+Q,oe=Math.round(o.convertToPixel(Z[O]))+Q;le?(n.moveTo(xe,oe),le=!1):n.lineTo(xe,oe)}n.stroke(),n.restore()};return g("macd",u[0]),g("signal",u[1]),!0}};function l0(n,e,t){return Math.max(e,Math.min(t,n))}function n$(n,e){const t=new Array(n.length).fill(0);if(e<=1){for(let o=0;o<n.length;o++)t[o]=n[o]??0;return t}let s=0;for(let o=0;o<n.length;o++)s+=n[o]??0,o>=e&&(s-=n[o-e]??0),t[o]=o>=e-1?s/e:0;return t}function s$(n,e,t){const s=Math.max(0,e-t);let o=-1/0;for(let r=s;r<e;r++)n[r]&&n[r].high>o&&(o=n[r].high);return o===-1/0?0:o}function o$(n,e,t){const s=Math.max(0,e-t);let o=1/0;for(let r=s;r<e;r++)n[r]&&n[r].low<o&&(o=n[r].low);return o===1/0?0:o}function hb(n){const e=Math.max(0,(n.high??0)-(n.low??0)),t=Math.abs((n.close??0)-(n.open??0)),s=Math.max(0,(n.high??0)-Math.max(n.open??0,n.close??0)),o=Math.max(0,Math.min(n.open??0,n.close??0)-(n.low??0)),r=e>0?s/e:0,a=e>0?o/e:0;return{range:e,body:t,upperWick:s,lowerWick:o,upperWickRatio:r,lowerWickRatio:a}}const i$={name:"TRAP_HUNTER",shortName:"TRAP",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,figures:[],styles:{texts:[{color:"#ffffff",size:10}]},calc:(n,e)=>{var F,B;const t=e.calcParams||[],s=t[0]??20,o=t[1]??20,r=Math.max(1,t[2]??3),a=Math.max(1,t[3]??5),l=Math.max(1,t[4]??20),c=t[5]??1.3,f=t[6]??7e-4,u=t[7]??.35,d=t[8]??.5,h=(t[9]??1)>0?1:0,m=Math.max(1,t[10]??5),g=n.map($=>($==null?void 0:$.volume)??0),w=n$(g,l),C=new Array(n.length).fill(null).map(()=>({}));let P=-1e3,I=-1e3,A=-1e3,M=-1e3;for(let $=0;$<n.length;$++){const L=n[$];if(!L||$===0)continue;const O=s$(n,$,s),Y=o$(n,$,o);if(O===0||Y===0)continue;const ce=w[$]||0,Q=ce>0?(L.volume??0)/ce:0,{range:le,upperWickRatio:ue,lowerWickRatio:fe}=hb(L),pe=le>0?(L.high-L.close)/le<.4:!1,Z=le>0?(L.close-L.low)/le<.4:!1,xe=(L.high??0)>=O*(1+f),oe=(L.close??0)>(L.open??0)||pe,Pe=Q>=c;if(xe&&oe&&Pe){let ft=-1;(L.close??0)<O&&(ft=$);const ut=Math.min(n.length-1,$+r);if(ft===-1){for(let bt=$+1;bt<=ut;bt++)if((((F=n[bt])==null?void 0:F.close)??0)<O){ft=bt;break}}if(ft!==-1){const bt=Math.min(ft,$+a);let Pt=ue,Et=!1;for(let Qe=$;Qe<=bt;Qe++){const gt=hb(n[Qe]);gt.upperWickRatio>Pt&&(Pt=gt.upperWickRatio),(n[Qe].close??0)<(n[Qe].open??0)&&(gt.range>0&&gt.body/gt.range>=.45)&&(Et=!0)}const Mt=l0((L.high-O)/Math.max(1e-8,O)/(f*3),0,1),Je=l0(Q/(c*2),0,1),Ct=l0(Pt,0,1),Ze=l0((L.high-(n[ft].close??0))/Math.max(1e-8,L.high),0,1),Xe=l0(.3*Mt+.3*Je+.2*Ct+.2*Ze,0,1);(Pt>=u||Et)&&Xe>=d&&ft-P>=2&&(P=ft,A=ft,C[ft]={...C[ft],bullTrap:!0,type:"bull",score:Xe,breakoutLevel:O,reversalClose:n[ft].close,time:n[ft].timestamp})}}const $e=f*.85,ze=c*.9,Ke=(L.low??0)<=Y*(1-$e),qe=(L.close??0)<(L.open??0)||Z||fe>=u,nt=Q>=ze;if(Ke&&qe&&nt){const ft=Math.min(n.length-1,$+r);let ut=-1;if((L.close??0)>Y&&(ut=$),ut===-1){for(let bt=$+1;bt<=ft;bt++)if((((B=n[bt])==null?void 0:B.close)??0)>Y){ut=bt;break}}if(ut!==-1){const bt=Math.min(ut,$+a);let Pt=fe,Et=!1;for(let Qe=$;Qe<=bt;Qe++){const gt=hb(n[Qe]);gt.lowerWickRatio>Pt&&(Pt=gt.lowerWickRatio),(n[Qe].close??0)>(n[Qe].open??0)&&(gt.range>0&&gt.body/gt.range>=.45)&&(Et=!0)}const Mt=l0((Y-L.low)/Math.max(1e-8,Y)/($e*3),0,1),Je=l0(Q/(ze*2),0,1),Ct=l0(Pt,0,1),Ze=l0(((n[ut].close??0)-L.low)/Math.max(1e-8,n[ut].close??0),0,1),Xe=l0(.3*Mt+.3*Je+.2*Ct+.2*Ze,0,1);(Pt>=u||Et)&&Xe>=d&&ut-I>=2&&(I=ut,A=ut,C[ut]={...C[ut],bearTrap:!0,type:"bear",score:Xe,breakoutLevel:Y,reversalClose:n[ut].close,time:n[ut].timestamp})}}if(h){const ft=w[$]>0?(L.volume??0)/w[$]:0,{upperWickRatio:ut,lowerWickRatio:bt}=hb(L),Pt=Math.max(.1,u*.8),Et=Math.max(1,c*.85),Mt=(L.close??0)<=O*(1+f*.5)&&(L.close??0)>=Y*(1-f*.5),Je=ft<=Et&&ut<=Pt&&bt<=Pt&&Mt,Ct=$-A,Ze=$-M,Xe=Math.max(8,m);Je&&Ct>=m&&Ze>=Xe&&(M=$,C[$]={...C[$],normal:!0,time:n[$].timestamp})}}return C},draw:({ctx:n,chart:e,indicator:t,xAxis:s,yAxis:o})=>{const r=t.result;if(!r||r.length===0)return!1;const a=e.getDataList(),l=e.getVisibleRange(),c=Math.max(0,l.from),f=Math.min(r.length-1,l.to);function u(m,g,w,C){n.save(),n.fillStyle=w,n.strokeStyle=w,n.lineWidth=1,C==="normal"?(n.beginPath(),n.arc(m,g,3.5,0,2*Math.PI),n.fill()):(n.beginPath(),C==="bull"?(n.moveTo(m,g-6),n.lineTo(m-5,g+4),n.lineTo(m+5,g+4)):(n.moveTo(m,g+6),n.lineTo(m-5,g-4),n.lineTo(m+5,g-4)),n.closePath(),n.fill()),n.restore()}function d(m,g,w,C){n.save(),n.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillStyle=C,n.strokeStyle="rgba(0,0,0,0.2)";const P=6,I=n.measureText(w),A=Math.ceil(I.width)+P*2,M=16,F=4,B=m-A/2,$=g-M/2;n.beginPath(),n.moveTo(B+F,$),n.lineTo(B+A-F,$),n.quadraticCurveTo(B+A,$,B+A,$+F),n.lineTo(B+A,$+M-F),n.quadraticCurveTo(B+A,$+M,B+A-F,$+M),n.lineTo(B+F,$+M),n.quadraticCurveTo(B,$+M,B,$+M-F),n.lineTo(B,$+F),n.quadraticCurveTo(B,$,B+F,$),n.closePath(),n.fillStyle="rgba(0,0,0,0.6)",n.fill(),n.fillStyle=C,n.fillText(w,m,g+.5),n.restore()}function h(m,g,w){n.save(),n.strokeStyle=w,n.lineWidth=1,n.setLineDash([4,3]),n.beginPath(),n.moveTo(m-10,g),n.lineTo(m+10,g),n.stroke(),n.setLineDash([]),n.restore()}for(let m=c;m<=f;m++){const g=r[m];if(!g||!g.bullTrap&&!g.bearTrap&&!g.normal)continue;const w=s.convertToPixel(m),C=a[m];if(C){if(g.bullTrap){const P=o.convertToPixel(C.high)-12;u(w,P,"#EF4444","bull");const A=P-16,M=`Bull Trap ${((g.score??0)*100).toFixed(0)}%`;if(d(w,A,M,"#F59E0B"),g.breakoutLevel){const F=o.convertToPixel(g.breakoutLevel);h(w,F,"#F59E0B")}}if(g.bearTrap){const P=o.convertToPixel(C.low)+12;u(w,P,"#10B981","bear");const A=P+16,M=`Bear Trap ${((g.score??0)*100).toFixed(0)}%`;if(d(w,A,M,"#34D399"),g.breakoutLevel){const F=o.convertToPixel(g.breakoutLevel);h(w,F,"#34D399")}}if(g.normal){const P=(C.high+C.low)/2,I=o.convertToPixel(P);u(w,I,"#3B82F6","normal"),d(w,I-16,"Stable","#60A5FA")}}}return!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{var c;const s=(c=e.result)==null?void 0:c[n];if(!s||!s.bullTrap&&!s.bearTrap&&!s.normal)return{values:[]};const o=s.normal?"Stable":s.bullTrap?"Bull Trap":"Bear Trap",r=s.score!==void 0?Number(s.score).toFixed(2):"—",a=s.breakoutLevel!==void 0?Number(s.breakoutLevel).toFixed(e.precision??2):"—",l=s.reversalClose!==void 0?Number(s.reversalClose).toFixed(e.precision??2):"—";return{styles:t,values:[{title:"Trap",value:o},...s.normal?[]:[{title:"Score",value:r},{title:"Level",value:a},{title:"Reversal",value:l}]]}}};function M0(n,e,t){return Math.max(e,Math.min(t,n))}function tS(n,e){const t=n.length,s=new Array(t).fill(0);if(e<=1){for(let r=0;r<t;r++)s[r]=n[r]??0;return s}let o=0;for(let r=0;r<t;r++)o+=n[r]??0,r>=e&&(o-=n[r-e]??0),s[r]=r>=e-1?o/e:0;return s}function r$(n,e){var o,r,a;const t=n.length,s=new Array(t).fill(0);for(let l=0;l<t;l++){const c=((o=n[l])==null?void 0:o.high)??0,f=((r=n[l])==null?void 0:r.low)??0;if(l===0)s[l]=Math.max(0,c-f);else{const u=((a=n[l-1])==null?void 0:a.close)??0;s[l]=Math.max(c-f,Math.abs(c-u),Math.abs(f-u))}}return tS(s,Math.max(1,e))}function a$(n){var o,r,a;const e=n.length,t=new Array(e).fill(0);let s=0;for(let l=0;l<e;l++){if(l===0)s=0;else{const c=((o=n[l])==null?void 0:o.close)??0,f=((r=n[l-1])==null?void 0:r.close)??0,u=((a=n[l])==null?void 0:a.volume)??0;c>f?s+=u:c<f&&(s-=u)}t[l]=s}return t}function ux(n,e,t){let s=0,o=0;for(let r=e;r<=t;r++)s+=n[r]??0,o++;return o>0?s/o:0}function l$(n,e,t,s){if(t<=e)return 0;const o=(n[t]-n[e])/(t-e),r=s>0?o/(s*5):0;return M0(r,-1,1)}function c$(n,e,t){var l,c;const s=Math.max(0,e-t),o=Math.max(0,e-1),r=((l=n[s])==null?void 0:l.close)??0,a=((c=n[o])==null?void 0:c.close)??0;return r<=0?0:(a-r)/r}function yk(n,e,t,s,o,r,a){var ze,Ke,qe,nt,ft,ut,bt,Pt,Et;const l=[],c=[],f=[];for(let Mt=o;Mt<=r;Mt++)l.push(((ze=n[Mt])==null?void 0:ze.high)??0),c.push(((Ke=n[Mt])==null?void 0:Ke.low)??0),f.push(((qe=n[Mt])==null?void 0:qe.close)??0);const u=Math.max(...l),d=Math.min(...c),h=(u+d)/2,m=u-d;if(h<=0)return null;const g=m/h;if(!isFinite(g)||g<=0||g>a.maxZoneWidthPct)return null;const w=ux(s,o,r);if(!(w>=a.minVolumeFactor))return null;const C=[];for(let Mt=o;Mt<=r;Mt++)C.push((((nt=n[Mt])==null?void 0:nt.high)??0)-(((ft=n[Mt])==null?void 0:ft.low)??0));const P=C.length?C.reduce((Mt,Je)=>Mt+Je,0)/C.length:0,I=ux(t,o,r);if(I>0&&P/I>1.8)return null;let A=0;for(let Mt=o;Mt<=r;Mt++){const Je=((ut=n[Mt])==null?void 0:ut.close)??0;(bt=n[Mt])==null||bt.open;const Ct=m>0?M0((Je-d)/m,0,1):.5;A+=Ct}const M=A/Math.max(1,r-o+1)||.5,F=c$(n,o,a.priorTrendLookback),B=F<=-.05,$=F>=.05,L=B?M0(Math.abs(F)/.15,0,1):0,O=$?M0(Math.abs(F)/.15,0,1):0,Y=ux(n.map(Mt=>(Mt==null?void 0:Mt.volume)??0),o,r),ce=l$(e,o,r,Y),Q=M0((M-.5)/.3+.5,0,1),le=M0((w-a.minVolumeFactor)/Math.max(1e-6,a.minVolumeFactor),0,1),ue=.3,fe=.3,pe=.2,Z=.2,xe=ue*L+fe*M0((ce-a.minOBVTrendStrength)/(1-a.minOBVTrendStrength),0,1)+pe*Q+Z*le,oe=ue*O+fe*M0((-ce-a.minOBVTrendStrength)/(1-a.minOBVTrendStrength),0,1)+pe*(1-Q)+Z*le,Pe=M0(Math.max(xe,oe),0,1);if(Pe<a.minZoneScore)return null;const $e=xe>oe?"accumulation":"distribution";return{startIndex:o,endIndex:r,startTime:((Pt=n[o])==null?void 0:Pt.timestamp)??0,endTime:((Et=n[r])==null?void 0:Et.timestamp)??0,low:d,high:u,type:$e,score:Pe,priorReturn:F,avgVolumeFactor:w,obvTrendScore:ce}}function bk(n,e){if(!e.mergeNearbyZones||n.length<=1)return n.slice(0,e.maxZonesDisplayed);const t=n.slice().sort((l,c)=>l.startIndex-c.startIndex),s=[],o=Math.max(2,Math.floor(e.minZoneBars/2)),r=Math.max(.01,e.maxZoneWidthPct*1.5);function a(l,c){const f=(l.low+l.high)/2,u=(c.low+c.high)/2;return f<=0||u<=0?!1:Math.abs(f-u)/((f+u)/2)<=r}for(const l of t){if(s.length===0){s.push(l);continue}const c=s[s.length-1];if(l.startIndex<=c.endIndex+o&&l.type===c.type&&a(c,l)){const u=Math.min(c.low,l.low),d=Math.max(c.high,l.high);s[s.length-1]={startIndex:Math.min(c.startIndex,l.startIndex),endIndex:Math.max(c.endIndex,l.endIndex),startTime:Math.min(c.startTime,l.startTime),endTime:Math.max(c.endTime,l.endTime),low:u,high:d,type:c.type,score:Math.max(c.score,l.score),priorReturn:Math.abs(l.score)>=Math.abs(c.score)?l.priorReturn:c.priorReturn,avgVolumeFactor:(c.avgVolumeFactor+l.avgVolumeFactor)/2,obvTrendScore:(c.obvTrendScore+l.obvTrendScore)/2}}else s.push(l)}return s.sort((l,c)=>c.score-l.score).slice(0,e.maxZonesDisplayed).sort((l,c)=>l.startIndex-c.startIndex)}const u$={name:"SMART_MONEY",shortName:"SMF",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,figures:[],styles:{},calc:(n,e)=>{const t=e.calcParams||[],s={zoneLookbackBars:Math.max(10,t[0]??40),minZoneBars:Math.max(3,t[1]??5),maxZoneBars:Math.max(5,t[2]??25),atrPeriod:Math.max(1,t[3]??14),volumeMAPeriod:Math.max(1,t[4]??20),minVolumeFactor:t[5]??1.2,maxZoneWidthPct:t[6]??.03,priorTrendLookback:Math.max(1,t[7]??20),minOBVTrendStrength:t[8]??.2,minZoneScore:t[9]??.6,mergeNearbyZones:(t[10]??1)>0,maxZonesDisplayed:Math.max(1,t[11]??20),showLabels:(t[12]??1)>0},o=n.length,r=new Array(o).fill({});if(o===0)return e.zones=[],e.cfg=s,r;const a=r$(n,s.atrPeriod),l=n.map(m=>(m==null?void 0:m.volume)??0),c=tS(l,s.volumeMAPeriod),f=l.map((m,g)=>{const w=c[g]||0;return w>0?m/w:0}),u=a$(n);let d=[];for(let m=0;m<o;m++){const g=m,w=Math.min(s.zoneLookbackBars,g+1),C=[],P=s.minZoneBars,I=Math.min(s.maxZoneBars,w);if(I>=P){const A=Math.floor((P+I)/2);C.push(P),A!==P&&A!==I&&C.push(A),I!==P&&C.push(I)}for(const A of C){const M=g-A+1;if(M<0)continue;const F=yk(n,u,a,f,M,g,s);F&&d.push(F)}}let h=bk(d,s);if(h.length===0&&o>=Math.max(60,s.minZoneBars*4)){const m={...s,maxZoneWidthPct:s.maxZoneWidthPct*2,minVolumeFactor:Math.min(s.minVolumeFactor,.9),minOBVTrendStrength:Math.max(.05,s.minOBVTrendStrength*.5),minZoneScore:Math.max(.4,s.minZoneScore-.15)};d=[];for(let g=0;g<o;g++){const w=g,C=Math.min(m.zoneLookbackBars,w+1),P=[],I=m.minZoneBars,A=Math.min(m.maxZoneBars,C);if(A>=I){const M=Math.floor((I+A)/2);P.push(I),M!==I&&M!==A&&P.push(M),A!==I&&P.push(A)}for(const M of P){const F=w-M+1;if(F<0)continue;const B=yk(n,u,a,f,F,w,m);B&&d.push(B)}}h=bk(d,m)}return e.zones=h,e.cfg=s,r},draw:({ctx:n,chart:e,indicator:t,xAxis:s,yAxis:o})=>{const r=t.zones||[];if(!r.length)return!1;const a=t.cfg||{},l=e.getVisibleRange(),c=Math.max(0,l.from),f=l.to,u="rgba(16, 185, 129, 0.28)",d="rgba(16, 185, 129, 0.7)",h="rgba(239, 68, 68, 0.28)",m="rgba(239, 68, 68, 0.7)";n.save();for(const g of r){if(g.endIndex<c||g.startIndex>f)continue;const w=s.convertToPixel(g.startIndex),C=s.convertToPixel(g.endIndex),P=o.convertToPixel(g.high),I=o.convertToPixel(g.low);if(!isFinite(w)||!isFinite(C)||P==null||I==null)continue;const A=Math.min(w,C),M=Math.max(1,Math.abs(C-w)),F=Math.min(P,I),B=Math.abs(P-I);n.fillStyle=g.type==="accumulation"?u:h;const $=n.roundRect??n.rect;n.beginPath();try{$.call(n,A,F,M,B,4)}catch{n.rect(A,F,M,B)}if(n.closePath(),n.fill(),n.strokeStyle=g.type==="accumulation"?d:m,n.lineWidth=1.5,n.setLineDash([]),n.stroke(),a.showLabels){const L=`${g.type==="accumulation"?"Accumulation":"Distribution"} (${g.score.toFixed(2)})`,O=A+M+6,Y=F+B/2;n.save(),n.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",n.textAlign="left",n.textBaseline="middle";const ce=g.type==="accumulation"?"#10B981":"#EF4444",Q="rgba(0,0,0,0.55)",le=6,ue=n.measureText(L),fe=Math.ceil(ue.width)+le*2,pe=16,Z=4,xe=O,oe=Y-pe/2;n.beginPath(),n.moveTo(xe+Z,oe),n.lineTo(xe+fe-Z,oe),n.quadraticCurveTo(xe+fe,oe,xe+fe,oe+Z),n.lineTo(xe+fe,oe+pe-Z),n.quadraticCurveTo(xe+fe,oe+pe,xe+fe-Z,oe+pe),n.lineTo(xe+Z,oe+pe),n.quadraticCurveTo(xe,oe+pe,xe,oe+pe-Z),n.lineTo(xe,oe+Z),n.quadraticCurveTo(xe,oe,xe+Z,oe),n.closePath(),n.fillStyle=Q,n.fill(),n.fillStyle=ce,n.fillText(L,xe+le,Y+.5),n.restore()}}return n.restore(),!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{const o=(e.zones||[]).find(l=>n>=l.startIndex&&n<=l.endIndex);if(!o)return{values:[]};const r=o.type==="accumulation"?"Accumulation":"Distribution",a=o.endIndex-o.startIndex+1;return{styles:t,values:[{title:"Footprint",value:r},{title:"Score",value:o.score.toFixed(2)},{title:"Price",value:`${o.low.toFixed(e.precision??2)}–${o.high.toFixed(e.precision??2)}`},{title:"Duration",value:`${a} bars`},{title:"Prior Trend",value:`${(o.priorReturn*100).toFixed(1)}%`},{title:"Avg Volume x",value:o.avgVolumeFactor.toFixed(2)},{title:"OBV Trend",value:o.obvTrendScore>.05?"Up":o.obvTrendScore<-.05?"Down":"Flat"}]}}},Vd={bbPeriod:16,bbStdDev:2,atrPeriod:14,volMAPeriod:20,lookbackForNorm:60,pressureSMA:2,minPressureForAlert:.55,eruptionConfirmBars:1,minVolExpansion:1,minRangeExpansion:1,minBreakoutBodyPct:.5,breakoutLookback:10,w1:.5,w2:.3,w3:.2,minBarsBetweenEruptions:1,trendEMAPeriod:30,requireTrendAlign:0,breakoutBufferPct:7e-4,requireBBBandBreak:0,retestWindow:1};function qb(n,e,t){return Math.max(e,Math.min(t,n))}function dx(n,e){const t=new Array(n.length).fill(0);if(e<=1){for(let o=0;o<n.length;o++)t[o]=n[o]??0;return t}let s=0;for(let o=0;o<n.length;o++)s+=n[o]??0,o>=e&&(s-=n[o-e]??0),t[o]=o>=e-1?s/e:NaN;return t}function d$(n,e){const t=new Array(n.length).fill(NaN);if(e<=1)return n.map(()=>0);for(let s=0;s<n.length;s++){if(s<e-1)continue;let o=0;for(let l=s-e+1;l<=s;l++)o+=n[l]??0;const r=o/e;let a=0;for(let l=s-e+1;l<=s;l++){const c=(n[l]??0)-r;a+=c*c}t[s]=Math.sqrt(a/e)}return t}function f$(n,e){const t=new Array(n.length).fill(NaN);if(e<=1)return n.slice();const s=2/(e+1);let o=NaN;for(let r=0;r<n.length;r++){const a=n[r]??0;if(Number.isFinite(o))o=a*s+o*(1-s),t[r]=o;else if(r>=e-1){let l=0;for(let c=r-e+1;c<=r;c++)l+=n[c]??0;o=l/e,t[r]=o}}return t}function nS(n,e){if(!n)return 0;const t=n.high??0,s=n.low??0,o=(e==null?void 0:e.close)??n.close??0;return Math.max(t-s,Math.abs(t-o),Math.abs(s-o))}function p$(n,e){const t=n.map((r,a)=>nS(r,a>0?n[a-1]:void 0)),s=new Array(n.length).fill(NaN);if(e<=1)return t;let o=0;for(let r=0;r<t.length;r++)o+=t[r]??0,r===e-1?s[r]=o/e:r>=e&&(s[r]=((s[r-1]??0)*(e-1)+(t[r]??0))/e);return s}function xk(n,e){const t=new Array(n.length).fill(NaN);for(let s=0;s<n.length;s++){const o=Math.max(0,s-e+1);let r=1/0;for(let a=o;a<=s;a++)Number.isFinite(n[a])&&n[a]<r&&(r=n[a]);t[s]=r===1/0?NaN:r}return t}function wk(n,e){const t=new Array(n.length).fill(NaN);for(let s=0;s<n.length;s++){const o=Math.max(0,s-e+1);let r=-1/0;for(let a=o;a<=s;a++)Number.isFinite(n[a])&&n[a]>r&&(r=n[a]);t[s]=r===-1/0?NaN:r}return t}function kk(n,e,t){return!Number.isFinite(e)||!Number.isFinite(t)||t===e?.5:qb((n-e)/(t-e),0,1)}function m$(n,e,t){const s=Math.max(0,e-t);let o=-1/0;for(let r=s;r<e;r++)n[r]&&(n[r].high??-1/0)>o&&(o=n[r].high);return o===-1/0?NaN:o}function h$(n,e,t){const s=Math.max(0,e-t);let o=1/0;for(let r=s;r<e;r++)n[r]&&(n[r].low??1/0)<o&&(o=n[r].low);return o===1/0?NaN:o}function sS(n,e){const t={...Vd,...e},s=n.length,o=n.map(oe=>(oe==null?void 0:oe.close)??0),r=n.map(oe=>(oe==null?void 0:oe.volume)??0);if(s===0)return{pressure:[],pressureSmoothed:[],eruptions:[]};const a=dx(o,t.bbPeriod),l=d$(o,t.bbPeriod),c=new Array(s).fill(NaN),f=new Array(s).fill(NaN),u=new Array(s).fill(NaN);for(let oe=0;oe<s;oe++)if(Number.isFinite(a[oe])&&Number.isFinite(l[oe])){c[oe]=a[oe]+t.bbStdDev*l[oe],f[oe]=a[oe]-t.bbStdDev*l[oe];const Pe=c[oe]-f[oe],$e=o[oe]||1;u[oe]=$e!==0?Pe/Math.abs($e):0}const d=Math.max(2,t.trendEMAPeriod??50),h=f$(o,d),m=p$(n,t.atrPeriod),g=m.map((oe,Pe)=>{const $e=o[Pe]||1;return $e!==0?(oe??0)/Math.abs($e):0}),w=dx(r,t.volMAPeriod),C=r.map((oe,Pe)=>{const $e=w[Pe]??0;return $e>0?oe/$e:0}),P=Math.max(10,t.lookbackForNorm),I=xk(u,P),A=wk(u,P),M=xk(g,P),F=wk(g,P),B=new Array(s).fill(0),$=new Array(s).fill(0),L=new Array(s).fill(0);for(let oe=0;oe<s;oe++){const Pe=kk(u[oe]??0,I[oe],A[oe]),$e=kk(g[oe]??0,M[oe],F[oe]);B[oe]=1-Pe,$[oe]=1-$e;const ze=Math.max(C[oe]??0,1e-8),Ke=qb(1/ze,0,2);L[oe]=qb(Ke/2,0,1)}const O=t.w1??.5,Y=t.w2??.3,ce=t.w3??.2,Q=new Array(s).fill(0);for(let oe=0;oe<s;oe++){const Pe=O*B[oe]+Y*$[oe]+ce*L[oe];Q[oe]=qb(Pe,0,1)}const le=dx(Q,Math.max(1,t.pressureSMA)).map(oe=>Number.isFinite(oe)?oe:0),ue=[],fe=Math.max(1,t.minBarsBetweenEruptions??8);let pe=-1e4,Z=!1,xe=-1;for(let oe=0;oe<s;oe++){const Pe=le[oe]??0;if(Pe>=t.minPressureForAlert?Z||(Z=!0,xe=oe):Z=!1,!(Z||xe>=0&&oe-xe<=t.eruptionConfirmBars+2)||oe-pe<fe)continue;const ze=nS(n[oe],oe>0?n[oe-1]:void 0),Ke=m[oe]??ze,qe=Ke>0?ze/Ke:0;if(qe<t.minRangeExpansion)continue;const nt=C[oe]??0;if(nt<t.minVolExpansion)continue;const ft=n[oe],ut=Math.max(0,(ft.high??0)-(ft.low??0)),bt=Math.abs((ft.close??0)-(ft.open??0));if((ut>0?bt/ut:0)<t.minBreakoutBodyPct)continue;const Et=m$(n,oe,t.breakoutLookback),Mt=h$(n,oe,t.breakoutLookback),Je=Math.max(0,t.breakoutBufferPct??.001),Ct=(t.requireBBBandBreak??1)>0,Ze=(t.requireTrendAlign??1)>0,Xe=h[oe],Ae=oe>0?h[oe-1]:Xe,Qe=Number.isFinite(Xe)&&Number.isFinite(Ae)&&(ft.close??0)>Xe&&Xe>=Ae,gt=Number.isFinite(Xe)&&Number.isFinite(Ae)&&(ft.close??0)<Xe&&Xe<=Ae,Ft=c[oe],ot=f[oe];let ve=Number.isFinite(Et)&&(ft.close??0)>Et*(1+Je),Ie=Number.isFinite(Mt)&&(ft.close??0)<Mt*(1-Je);if(Ct&&(ve=ve&&Number.isFinite(Ft)&&(ft.close??0)>Ft,Ie=Ie&&Number.isFinite(ot)&&(ft.close??0)<ot),Ze&&(ve=ve&&Qe,Ie=Ie&&gt),!ve&&!Ie)continue;const It=oe,Dt=Math.min(s-1,It+Math.max(1,t.eruptionConfirmBars));let Zt=0,gn=!0;const hn=Math.max(1,t.retestWindow??2);if(ve)for(let On=It;On<=Dt;On++){const bn=n[On];(bn.close??0)>=(ft.high??0)&&Zt++,On<=It+hn&&Number.isFinite(Et)&&(bn.close??0)<Et&&(gn=!1)}else if(Ie)for(let On=It;On<=Dt;On++){const bn=n[On];(bn.close??0)<=(ft.low??0)&&Zt++,On<=It+hn&&Number.isFinite(Mt)&&(bn.close??0)>Mt&&(gn=!1)}const qn=Math.ceil((Dt-It+1)/2);if(gn&&Zt>=qn){const On=ve?"bullish":"bearish",bn=ve?Et:Mt;ue.push({index:It,time:ft.timestamp??0,direction:On,pressureAtSignal:Pe,rangeExpansion:qe,volumeFactor:nt,breakoutLevel:bn}),pe=It}}return{pressure:Q,pressureSmoothed:le,eruptions:ue}}const v$={name:"VOLCANIC",shortName:"VOLC",precision:2,shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,minValue:0,maxValue:1,figures:[{key:"pressure",title:"Pressure: ",type:"line"}],styles:{lines:[{color:"#60A5FA",size:2,style:wt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams,s={bbPeriod:(t==null?void 0:t[0])??Vd.bbPeriod,bbStdDev:(t==null?void 0:t[1])??Vd.bbStdDev,atrPeriod:(t==null?void 0:t[2])??Vd.atrPeriod,volMAPeriod:(t==null?void 0:t[3])??Vd.volMAPeriod,lookbackForNorm:(t==null?void 0:t[4])??Vd.lookbackForNorm,pressureSMA:(t==null?void 0:t[5])??Vd.pressureSMA,minPressureForAlert:(t==null?void 0:t[6])??Vd.minPressureForAlert,eruptionConfirmBars:(t==null?void 0:t[7])??Vd.eruptionConfirmBars,minVolExpansion:(t==null?void 0:t[8])??Vd.minVolExpansion,minRangeExpansion:(t==null?void 0:t[9])??Vd.minRangeExpansion,minBreakoutBodyPct:(t==null?void 0:t[10])??Vd.minBreakoutBodyPct,breakoutLookback:(t==null?void 0:t[11])??Vd.breakoutLookback,minBarsBetweenEruptions:(t==null?void 0:t[12])??Vd.minBarsBetweenEruptions,trendEMAPeriod:(t==null?void 0:t[13])??Vd.trendEMAPeriod??30,requireTrendAlign:(t==null?void 0:t[14])??Vd.requireTrendAlign??0,breakoutBufferPct:(t==null?void 0:t[15])??Vd.breakoutBufferPct??7e-4,requireBBBandBreak:(t==null?void 0:t[16])??Vd.requireBBBandBreak??0,retestWindow:(t==null?void 0:t[17])??Vd.retestWindow??1},{pressureSmoothed:o}=sS(n,s);return o.map(r=>({pressure:Number.isFinite(r)?r:null}))},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var A,M,F,B,$,L,O;const a=t.result;if(!a||a.length===0)return!1;const l=e.getVisibleRange(),c=Math.max(0,l.from),f=Math.min(a.length-1,l.to),u=t.calcParams,d=(u==null?void 0:u[6])??Vd.minPressureForAlert,h=((F=(M=(A=t.styles)==null?void 0:A.lines)==null?void 0:M[0])==null?void 0:F.color)||"#60A5FA",m="#F59E0B",g=((L=($=(B=t.styles)==null?void 0:B.lines)==null?void 0:$[0])==null?void 0:L.size)||2;n.save(),n.lineCap="round",n.lineJoin="round";const w=r.convertToPixel(d);w!==null&&(n.strokeStyle="#9CA3AF",n.lineWidth=1,n.setLineDash([4,4]),n.beginPath(),n.moveTo(s.left,w),n.lineTo(s.left+s.width,w),n.stroke(),n.setLineDash([]));let C=null,P=null,I=null;for(let Y=c;Y<=f;Y++){const ce=((O=a[Y])==null?void 0:O.pressure)??null;if(ce==null){C=P=I=null;continue}const Q=o.convertToPixel(Y),le=r.convertToPixel(ce);if(Q===null||le===null){C=P=I=null;continue}if(C!==null&&P!==null&&I!==null){const ue=(I+ce)/2;n.strokeStyle=ue>=d?m:h,n.lineWidth=g,n.beginPath(),n.moveTo(C,P),n.lineTo(Q,le),n.stroke()}C=Q,P=le,I=ce}return n.restore(),!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{const s=e.result[n];if(!s)return{values:[]};const o=e.calcParams,r=(o==null?void 0:o[6])??Vd.minPressureForAlert,a=s.pressure!==null&&s.pressure!==void 0?Number(s.pressure).toFixed(2):"—";return{styles:t,values:[{title:"Pressure",value:a},{title:"Alert ≥",value:Number(r).toFixed(2)}]}}},g$={name:"VOLCANIC_SIG",shortName:"VOLCSIG",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,figures:[],styles:{texts:[{color:"#ffffff",size:10}]},calc:(n,e)=>{const t=e.calcParams,s={bbPeriod:(t==null?void 0:t[0])??Vd.bbPeriod,bbStdDev:(t==null?void 0:t[1])??Vd.bbStdDev,atrPeriod:(t==null?void 0:t[2])??Vd.atrPeriod,volMAPeriod:(t==null?void 0:t[3])??Vd.volMAPeriod,lookbackForNorm:(t==null?void 0:t[4])??Vd.lookbackForNorm,pressureSMA:(t==null?void 0:t[5])??Vd.pressureSMA,minPressureForAlert:(t==null?void 0:t[6])??Vd.minPressureForAlert,eruptionConfirmBars:(t==null?void 0:t[7])??Vd.eruptionConfirmBars,minVolExpansion:(t==null?void 0:t[8])??Vd.minVolExpansion,minRangeExpansion:(t==null?void 0:t[9])??Vd.minRangeExpansion,minBreakoutBodyPct:(t==null?void 0:t[10])??Vd.minBreakoutBodyPct,breakoutLookback:(t==null?void 0:t[11])??Vd.breakoutLookback,minBarsBetweenEruptions:(t==null?void 0:t[12])??Vd.minBarsBetweenEruptions,trendEMAPeriod:(t==null?void 0:t[13])??Vd.trendEMAPeriod??30,requireTrendAlign:(t==null?void 0:t[14])??Vd.requireTrendAlign??0,breakoutBufferPct:(t==null?void 0:t[15])??Vd.breakoutBufferPct??7e-4,requireBBBandBreak:(t==null?void 0:t[16])??Vd.requireBBBandBreak??0,retestWindow:(t==null?void 0:t[17])??Vd.retestWindow??1},{eruptions:o}=sS(n,s),r=new Array(n.length).fill(null).map(()=>({}));return o.forEach(a=>{const l=r[a.index]||{};a.direction==="bullish"&&(l.bull=!0),a.direction==="bearish"&&(l.bear=!0),l.pressure=a.pressureAtSignal,l.rangeExpansion=a.rangeExpansion,l.volumeFactor=a.volumeFactor,l.breakoutLevel=a.breakoutLevel,r[a.index]=l}),r},draw:({ctx:n,chart:e,indicator:t,xAxis:s,yAxis:o})=>{const r=t.result;if(!r||r.length===0)return!1;const a=e.getDataList(),l=e.getVisibleRange(),c=Math.max(0,l.from),f=Math.min(r.length-1,l.to);function u(h,m,g,w){n.save(),n.fillStyle=g,n.beginPath(),w?(n.moveTo(h,m+6),n.lineTo(h-5,m-4),n.lineTo(h+5,m-4)):(n.moveTo(h,m-6),n.lineTo(h-5,m+4),n.lineTo(h+5,m+4)),n.closePath(),n.fill(),n.restore()}function d(h,m,g,w){n.save(),n.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",n.textAlign="center",n.textBaseline="middle";const C=6,P=16,I=n.measureText(g),A=Math.ceil(I.width)+C*2,M=4,F=h-A/2,B=m-P/2;n.fillStyle="rgba(0,0,0,0.6)",n.beginPath(),n.moveTo(F+M,B),n.lineTo(F+A-M,B),n.quadraticCurveTo(F+A,B,F+A,B+M),n.lineTo(F+A,B+P-M),n.quadraticCurveTo(F+A,B+P,F+A-M,B+P),n.lineTo(F+M,B+P),n.quadraticCurveTo(F,B+P,F,B+P-M),n.lineTo(F,B+M),n.quadraticCurveTo(F,B,F+M,B),n.closePath(),n.fill(),n.fillStyle=w,n.fillText(g,h,m+.5),n.restore()}for(let h=c;h<=f;h++){const m=r[h];if(!m||!m.bull&&!m.bear)continue;const g=s.convertToPixel(h),w=a[h];if(w){if(m.bull){const C=o.convertToPixel(w.low)+12;u(g,C,"#F59E0B",!0),d(g,C+16,"Volcanic Move (Bullish)","#F59E0B")}if(m.bear){const C=o.convertToPixel(w.high)-12;u(g,C,"#EF4444",!1),d(g,C-16,"Volcanic Move (Bearish)","#EF4444")}}}return!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{var c;const s=(c=e.result)==null?void 0:c[n];if(!s||!s.bull&&!s.bear)return{values:[]};const o=s.bull?"Bullish":"Bearish",r=s.pressure!==void 0?Number(s.pressure).toFixed(2):"—",a=s.rangeExpansion!==void 0?Number(s.rangeExpansion).toFixed(2):"—",l=s.volumeFactor!==void 0?Number(s.volumeFactor).toFixed(2):"—";return{styles:t,values:[{title:"Eruption",value:o},{title:"Pressure",value:r},{title:"Range x",value:a},{title:"Volume x",value:l}]}}};function _$(n,e,t,s,o,r,a){const l=s*.4,c=o*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.lineJoin="round",n.beginPath(),n.moveTo(e-l,t-c),n.lineTo(e+l,t+c),n.moveTo(e+l,t-c),n.lineTo(e-l,t+c),n.stroke(),n.restore()}function y$(n,e,t,s,o,r,a){const l=s*.4,c=o*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.beginPath(),n.ellipse(e,t,l,c,0,0,Math.PI*2),n.stroke(),n.restore()}const b$={name:"PNF",shortName:"P&F",calcParams:[],figures:[],calc:(n,e)=>n.map(t=>{const s=t==null?void 0:t._pnf;return s?{direction:s.direction,boxes:s.boxes,upColor:s.upColor,downColor:s.downColor,boxSize:s.boxSize}:{}}),draw:n=>{var P,I;const{ctx:e,visibleRange:t,indicator:s,xAxis:o,yAxis:r}=n,a=s.result||[];if(!(o!=null&&o.convertToPixel)||!(r!=null&&r.convertToPixel))return!1;const l=o.convertToPixel(0),c=o.convertToPixel(1),f=Math.max(1,Math.abs(c-l));let u=f;for(const A of a)if(A!=null&&A.boxes&&A.boxes.length>=2&&(r!=null&&r.convertToPixel)){const M=A.boxes[0],F=A.boxes[1],B=r.convertToPixel(M.price),$=r.convertToPixel(F.price);if(B!==void 0&&$!==void 0&&!isNaN(B)&&!isNaN($)){const L=Math.abs(B-$);if(L>0){u=L;break}}}if(u===f){const A=a.find(M=>(M==null?void 0:M.boxSize)&&M.boxSize>0);if(A!=null&&A.boxSize){const M=((I=(P=A.boxes)==null?void 0:P[0])==null?void 0:I.price)||100,F=r.convertToPixel(M),B=r.convertToPixel(M+A.boxSize);if(F!==void 0&&B!==void 0&&!isNaN(F)&&!isNaN(B)){const $=Math.abs(F-B);$>0&&(u=$)}}}const d=f*.85,h=u*.85,m=(d+h)/2,g=Math.max(.8,m*.08),w=(t==null?void 0:t.from)||0,C=(t==null?void 0:t.to)||a.length;for(let A=w;A<C;A++){const M=a[A];if(!M||!M.boxes||!Array.isArray(M.boxes))continue;const{direction:F,boxes:B,upColor:$="#00E6D8",downColor:L="#FF4D4D"}=M,O=o.convertToPixel(A);if(!(O===void 0||isNaN(O)))for(const Y of B){const ce=r.convertToPixel(Y.price);ce===void 0||isNaN(ce)||(F==="up"?_$(e,O,ce,d,h,$,g):y$(e,O,ce,d,h,L,g))}}return!1}},x$=[SE,CE,PE,ME,Q4,TE,LE,EE,$E,RE,BE,OE,zE,VE,WE,qE,UE,GE,YE,XE,ZE,QE,e$,t$,i$,u$,v$,g$,b$];function w$(n,e){e?console.log(n,e):console.log(n)}function j1(){return Date.now()}function vb(n,e){const t=n.country||"__";return`${n.ticker}_${t}_${e}`}function gb(n){return{key:n.key,symbol:n.symbol.ticker,timeframe:n.timeframe,candles:n.candles,oldestTimestampLoaded:n.oldest,newestTimestampLoaded:n.newest,isComplete:n.isComplete,isRunning:n.isRunning,pipelineStarts:n.starts,apiCalls:n.apiCalls,lastUpdatedAt:n.lastUpdatedAt,error:n.error}}function k$(n,e){var o;let t=0,s=n.length;for(;t<s;){const r=t+s>>>1;(((o=n[r])==null?void 0:o.timestamp)??0)>=e?s=r:t=r+1}return t}function Sk(n,e){return n<=0?Promise.resolve():new Promise((t,s)=>{const o=setTimeout(t,n);if(!e)return;const r=()=>{clearTimeout(o),s(new DOMException("Aborted","AbortError"))};if(e.aborted)return r();e.addEventListener("abort",r,{once:!0})})}class S${constructor(e,t={}){Te(this,"entries",new Map);Te(this,"fetchPage");Te(this,"opt");this.fetchPage=e,this.opt={maxKeys:t.maxKeys??16,ttlMs:t.ttlMs??20*6e4,initialLimit:t.initialLimit??600,pageLimit:t.pageLimit??800,pageDelayMs:t.pageDelayMs??75,maxRetries:t.maxRetries??2,retryBaseDelayMs:t.retryBaseDelayMs??400,log:t.log??w$}}start(e,t){const s=vb(e,t),o=this.getOrCreate(e,t);return this.touch(o),this.ensureRunning(o),{key:s,getSnapshot:()=>this.getSnapshot(e,t),subscribe:r=>this.subscribe(e,t,r)}}getSnapshot(e,t){const s=vb(e,t),o=this.entries.get(s);return o?(this.touch(o),gb(o)):{key:s,symbol:e.ticker,timeframe:t,candles:[],oldestTimestampLoaded:null,newestTimestampLoaded:null,isComplete:!1,isRunning:!1,pipelineStarts:0,apiCalls:0,lastUpdatedAt:0,error:null}}async waitForInitial(e,t){const s=this.getOrCreate(e,t);return this.touch(s),this.ensureRunning(s),await this.ensureInitialLoaded(s,s.generation),gb(s)}requestVisibleRange(e){const t=this.entries.get(vb(e.symbol,e.timeframe));if(!t||t.candles.length===0)return[];this.touch(t);const s=k$(t.candles,e.beforeTimestamp),o=Math.max(0,s-Math.max(1,e.limit));return t.candles.slice(o,s)}stopSymbol(e){for(const t of this.entries.values())t.symbol.ticker===e&&this.stopEntry(t)}stopAll(){for(const e of this.entries.values())this.stopEntry(e)}clear(){this.stopAll(),this.entries.clear()}subscribe(e,t,s){const o=this.getOrCreate(e,t);this.touch(o),o.subs.add(s);try{s(gb(o))}catch{}return()=>{o.subs.delete(s)}}getMetrics(){const e=[];for(const t of this.entries.values())e.push({key:t.key,pipelineStarts:t.starts,apiCalls:t.apiCalls,isRunning:t.isRunning,isComplete:t.isComplete,error:t.error});return e}emit(e){const t=gb(e);for(const s of e.subs)try{s(t)}catch{}}touch(e){e.lastAccessAt=j1(),this.entries.get(e.key)===e&&(this.entries.delete(e.key),this.entries.set(e.key,e)),this.evictIfNeeded()}evictIfNeeded(){const e=j1()-this.opt.ttlMs;for(;;){const t=this.entries.keys().next().value;if(!t)break;const s=this.entries.get(t);if(!s){this.entries.delete(t);continue}if(s.lastAccessAt>=e)break;this.stopEntry(s),this.entries.delete(t)}for(;this.entries.size>this.opt.maxKeys;){const t=this.entries.keys().next().value;if(!t)break;const s=this.entries.get(t);if(!s){this.entries.delete(t);continue}this.stopEntry(s),this.entries.delete(t)}}getOrCreate(e,t){const s=vb(e,t),o=this.entries.get(s);if(o)return o;const r={key:s,symbol:e,timeframe:t,candles:[],ts:new Set,oldest:null,newest:null,isComplete:!1,isRunning:!1,starts:0,apiCalls:0,lastUpdatedAt:0,lastAccessAt:j1(),error:null,nextSkip:0,generation:0,initialPromise:null,runPromise:null,abort:null,subs:new Set};return this.entries.set(s,r),r}ensureRunning(e){if(e.isComplete||e.runPromise)return;e.isRunning=!0,e.error=null,e.generation+=1,e.starts+=1,e.abort||(e.abort=new AbortController);const t=e.generation;this.opt.log("📡 [pipeline:start]",{key:e.key,gen:t});const s=this.runLoop(e,t).finally(()=>{e.runPromise===s&&(e.runPromise=null),e.isRunning=!1,e.abort=null,this.emit(e),this.opt.log("⏹️ [pipeline:stop]",{key:e.key,gen:t,complete:e.isComplete})});e.runPromise=s}stopEntry(e){var t;e.generation+=1,e.isRunning=!1,e.initialPromise=null;try{(t=e.abort)==null||t.abort()}catch{}e.abort=null}async ensureInitialLoaded(e,t){e.candles.length>0||e.isComplete||(e.initialPromise||(e.initialPromise=(async()=>{const s=e.abort??new AbortController;e.abort=s;const o=e.nextSkip,r=this.opt.initialLimit;try{const a=await this.fetchPageWithRetry(e,{skip:o,limit:r,gen:t,signal:s.signal});if(e.generation!==t)return;const l=this.mergePage(e,a);e.nextSkip=o+a.length,(!a||a.length===0||l===0)&&(e.isComplete=!0),this.emit(e)}finally{e.initialPromise=null}})()),await e.initialPromise.catch(()=>{}))}async runLoop(e,t){for(await this.ensureInitialLoaded(e,t);e.isRunning&&!e.isComplete&&e.generation===t;){const s=e.abort??new AbortController;e.abort=s;const o=e.nextSkip,r=this.opt.pageLimit;let a=[];try{a=await this.fetchPageWithRetry(e,{skip:o,limit:r,gen:t,signal:s.signal})}catch(c){if(e.generation!==t||c instanceof DOMException&&c.name==="AbortError")return;e.error=c instanceof Error?c.message:"Fetch failed",this.emit(e);return}if(e.generation!==t)return;if(!a||a.length===0){e.isComplete=!0,this.emit(e);return}const l=this.mergePage(e,a);if(e.nextSkip=o+a.length,this.emit(e),l===0){e.isComplete=!0,this.emit(e);return}await Sk(this.opt.pageDelayMs,s.signal).catch(()=>{})}}async fetchPageWithRetry(e,t){let s=0;for(;;)try{e.apiCalls+=1,this.opt.log("🌐 [pipeline:page]",{key:e.key,skip:t.skip,limit:t.limit,calls:e.apiCalls});const o=await this.fetchPage({symbol:e.symbol,timeframe:e.timeframe,skip:t.skip,limit:t.limit,signal:t.signal});return e.lastUpdatedAt=j1(),e.error=null,Array.isArray(o)?o:[]}catch(o){if(o instanceof DOMException&&o.name==="AbortError"||e.generation!==t.gen||s>=this.opt.maxRetries)throw o;const r=this.opt.retryBaseDelayMs*Math.pow(2,s);s+=1,await Sk(r,t.signal)}}mergePage(e,t){if(!Array.isArray(t)||t.length===0)return 0;const s=[];for(const o of t){const r=o==null?void 0:o.timestamp;typeof r=="number"&&(e.ts.has(r)||(e.ts.add(r),s.push(o),(e.oldest==null||r<e.oldest)&&(e.oldest=r),(e.newest==null||r>e.newest)&&(e.newest=r)))}if(s.length>0){if(s.sort((o,r)=>o.timestamp-r.timestamp),e.candles.length===0)e.candles=s;else{const o=new Array(e.candles.length+s.length);let r=0,a=0,l=0;for(;r<e.candles.length&&a<s.length;)e.candles[r].timestamp<=s[a].timestamp?o[l++]=e.candles[r++]:o[l++]=s[a++];for(;r<e.candles.length;)o[l++]=e.candles[r++];for(;a<s.length;)o[l++]=s[a++];o.length=l,e.candles=o}e.lastUpdatedAt=j1()}return s.length}}const oS=n=>{if(n==null)return 0;if(typeof n=="number")return Number.isFinite(n)?n<1e11?n*1e3:n:0;const e=String(n).trim();if(!e)return 0;const t=Number(e);if(Number.isFinite(t))return t<1e11?t*1e3:t;const s=Date.parse(e);return Number.isFinite(s)?s:0},Ck=n=>{if(!Number.isFinite(n))return 1;const e=Number(n);return e>0?e:1};function C$(n){if(!Array.isArray(n)||n.length===0)return[];const e=[];for(const t of n){const s=(t==null?void 0:t.type)??"adjustment",o=oS(t==null?void 0:t.date);if(!o)continue;let r=1,a=1,l=0;if(s==="split"){let c=Number(t==null?void 0:t.ratio);if(!Number.isFinite(c)||c<=0){const f=Number(t==null?void 0:t.numerator),u=Number(t==null?void 0:t.denominator);Number.isFinite(f)&&Number.isFinite(u)&&u!==0&&(c=f/u)}Number.isFinite(t==null?void 0:t.factor)&&Number(t.factor)>0?r=Ck(Number(t.factor)):Number.isFinite(c)&&c>0&&(r=1/c),a=r>0?1/r:1}else s==="dividend"?l=Number((t==null?void 0:t.cash)??0)||0:r=Ck(Number(t==null?void 0:t.factor));e.push({type:s,ts:o,priceFactor:r,volumeFactor:a,cash:l})}return e.sort((t,s)=>t.ts-s.ts),e}function I$(n,e,t){if(!Array.isArray(n)||n.length===0||!e||e.length===0)return n;const s=t||"none";if(s==="none")return n;const o=C$(e);return o.length?n.map(r=>{const a=oS((r==null?void 0:r.timestamp)??(r==null?void 0:r.time));if(!a)return r;let l=r.open,c=r.high,f=r.low,u=r.close,d=r.volume;for(const h of o)if(!(a>=h.ts)){if(h.type==="split"&&(s==="split"||s==="all")){const m=h.priceFactor,g=h.volumeFactor;Number.isFinite(l)&&(l=Number(l)*m),Number.isFinite(c)&&(c=Number(c)*m),Number.isFinite(f)&&(f=Number(f)*m),Number.isFinite(u)&&(u=Number(u)*m),Number.isFinite(d)&&(d=Number(d)*g)}else if(h.type==="dividend"&&(s==="dividend"||s==="all")){const m=h.cash;Number.isFinite(m)&&m!==0&&(Number.isFinite(l)&&(l=Number(l)-m),Number.isFinite(c)&&(c=Number(c)-m),Number.isFinite(f)&&(f=Number(f)-m),Number.isFinite(u)&&(u=Number(u)-m))}else if(h.type==="adjustment"&&s==="all"){const m=h.priceFactor;Number.isFinite(l)&&(l=Number(l)*m),Number.isFinite(c)&&(c=Number(c)*m),Number.isFinite(f)&&(f=Number(f)*m),Number.isFinite(u)&&(u=Number(u)*m)}}return{...r,open:l,high:c,low:f,close:u,volume:d}}):n}const P$={BD:{timezone:"Asia/Dhaka",regular:"1000-1430"},US:{timezone:"America/New_York",regular:"0930-1600",extended:"0400-2000"},GB:{timezone:"Europe/London",regular:"0800-1630"},JP:{timezone:"Asia/Tokyo",regular:"0900-1500"},SG:{timezone:"Asia/Singapore",regular:"0900-1700"},HK:{timezone:"Asia/Hong_Kong",regular:"0930-1600"}},M$={DSEBD:{timezone:"Asia/Dhaka",regular:"1000-1430"},NYSE:{timezone:"America/New_York",regular:"0930-1600",extended:"0400-2000"},NASDAQ:{timezone:"America/New_York",regular:"0930-1600",extended:"0400-2000"},LSE:{timezone:"Europe/London",regular:"0800-1630"},TSE:{timezone:"Asia/Tokyo",regular:"0900-1500"},HKEX:{timezone:"Asia/Hong_Kong",regular:"0930-1600"}},Ik=n=>{const e=n.trim();if(!e)return null;const t=e.match(/^(\d{1,2}):?(\d{2})$/);if(!t)return null;const s=Math.max(0,Math.min(23,Number(t[1]))),o=Math.max(0,Math.min(59,Number(t[2])));return`${String(s).padStart(2,"0")}${String(o).padStart(2,"0")}`};function o1(n){const e=String(n??"").trim();if(!e)return;if(e.toLowerCase()==="24x7"||e==="0000-2359")return"24x7";const t=e.split(/[;,]/).map(o=>o.trim()).filter(Boolean),s=[];for(const o of t){const r=o.match(/(\d{1,2}:?\d{2})\s*-\s*(\d{1,2}:?\d{2})/);if(!r)continue;const a=Ik(r[1]),l=Ik(r[2]);!a||!l||s.push(`${a}-${l}`)}if(s.length)return s.join(";")}function iS(n){const e=n.exchange?M$[String(n.exchange).toUpperCase()]:void 0;if(e)return e;const t=n.country?P$[String(n.country).toUpperCase()]:void 0;return t||{}}function B1(n,e){return n.timezone||n.sessionTimezone||e||"UTC"}function N$(n,e){const t=o1(n.session),s=o1(n.sessionExtended);return e==="all"?"24x7":e==="extended"?s||t||"24x7":t||"24x7"}const O1=n=>n>="0"&&n<="9",Pk=n=>n>="a"&&n<="z"||n>="A"&&n<="Z"||n==="_"||n==="$";class A${constructor(e){Te(this,"pos",0);this.input=e}next(){const e=this.input,t=e.length;for(;this.pos<t&&/\s/.test(e[this.pos]??"");)this.pos++;if(this.pos>=t)return{type:"eof",start:this.pos,end:this.pos};const s=e[this.pos],o=this.pos;if(s==='"'||s==="'"){const r=s;this.pos++;let a="",l=!1;for(;this.pos<t;){const c=e[this.pos];if(this.pos++,l){switch(c){case"n":a+=`
`;break;case"t":a+="	";break;case"r":a+="\r";break;case"\\":case"'":case'"':a+=c;break;default:a+=c;break}l=!1;continue}if(c==="\\"){l=!0;continue}if(c===r)break;a+=c}return{type:"string",value:a,start:o,end:this.pos}}if(O1(s)||s==="."&&O1(e[this.pos+1]??"")){let r=s===".";for(this.pos++;this.pos<t;){const a=e[this.pos];if(O1(a))this.pos++;else if(a==="."&&!r)r=!0,this.pos++;else break}if(e[this.pos]==="e"||e[this.pos]==="E"){let l=this.pos+1;(e[l]==="+"||e[l]==="-")&&l++;const c=l;for(;l<t&&O1(e[l]);)l++;l>c&&(this.pos=l)}return{type:"number",value:e.slice(o,this.pos),start:o,end:this.pos}}if(Pk(s)){for(this.pos++;this.pos<t;){const l=e[this.pos];if(Pk(l)||O1(l))this.pos++;else break}const r=e.slice(o,this.pos),a=r.toLowerCase();return a==="and"?{type:"and",start:o,end:this.pos}:a==="or"?{type:"or",start:o,end:this.pos}:a==="not"?{type:"not",start:o,end:this.pos}:a==="true"||a==="false"?{type:"boolean",value:a,start:o,end:this.pos}:{type:"identifier",value:r,start:o,end:this.pos}}switch(this.pos++,s){case".":return{type:"dot",start:o,end:this.pos};case">":return e[this.pos]==="="?(this.pos++,{type:"gte",start:o,end:this.pos}):{type:"gt",start:o,end:this.pos};case"<":return e[this.pos]==="="?(this.pos++,{type:"lte",start:o,end:this.pos}):{type:"lt",start:o,end:this.pos};case"=":if(e[this.pos]==="=")return this.pos++,{type:"eq",start:o,end:this.pos};throw new Error(`Unexpected '=' at position ${o}`);case"!":if(e[this.pos]==="=")return this.pos++,{type:"neq",start:o,end:this.pos};throw new Error(`Unexpected '!' at position ${o}`);case"+":return{type:"plus",start:o,end:this.pos};case"-":return{type:"minus",start:o,end:this.pos};case"*":return{type:"star",start:o,end:this.pos};case"/":return{type:"slash",start:o,end:this.pos};case"%":return{type:"percent",start:o,end:this.pos};case"(":return{type:"lparen",start:o,end:this.pos};case")":return{type:"rparen",start:o,end:this.pos};case",":return{type:"comma",start:o,end:this.pos};case"?":return{type:"qmark",start:o,end:this.pos};case":":return{type:"colon",start:o,end:this.pos};case"[":return{type:"lbracket",start:o,end:this.pos};case"]":return{type:"rbracket",start:o,end:this.pos};default:throw new Error(`Unexpected character "${s}" at position ${o}`)}}}class Zv extends Error{constructor(e,t){super(e),this.position=t,this.name="ParseError"}}class T${constructor(e){Te(this,"current");this.tokenizer=e,this.current=e.next()}eat(e){if(this.current.type!==e)throw new Zv(`Expected ${e} but found ${this.current.type}`,this.current.start);const t=this.current;return this.current=this.tokenizer.next(),t}match(e){return this.current.type===e?(this.current=this.tokenizer.next(),!0):!1}parseExpression(){return this.parseTernary()}parseTernary(){const e=this.parseOr();if(this.current.type==="qmark"){this.current=this.tokenizer.next();const t=this.parseExpression();this.eat("colon");const s=this.parseExpression();return{kind:"CallExpression",callee:"iff",args:[e,t,s]}}return e}parseOr(){let e=this.parseAnd();for(;this.current.type==="or";){this.current=this.tokenizer.next();const t=this.parseAnd();e={kind:"BinaryExpression",operator:"or",left:e,right:t}}return e}parseAnd(){let e=this.parseComparison();for(;this.current.type==="and";){this.current=this.tokenizer.next();const t=this.parseComparison();e={kind:"BinaryExpression",operator:"and",left:e,right:t}}return e}parseComparison(){let e=this.parseAddSub();for(;this.current.type==="gt"||this.current.type==="lt"||this.current.type==="gte"||this.current.type==="lte"||this.current.type==="eq"||this.current.type==="neq";){const t=this.current;this.current=this.tokenizer.next();const s=this.parseAddSub();let o="==";t.type==="gt"?o=">":t.type==="lt"?o="<":t.type==="gte"?o=">=":t.type==="lte"?o="<=":t.type==="neq"&&(o="!="),e={kind:"BinaryExpression",operator:o,left:e,right:s}}return e}parseAddSub(){let e=this.parseTerm();for(;this.current.type==="plus"||this.current.type==="minus";){const t=this.current;this.current=this.tokenizer.next();const s=this.parseTerm();e={kind:"BinaryExpression",operator:t.type==="plus"?"+":"-",left:e,right:s}}return e}parseTerm(){let e=this.parseFactor();for(;this.current.type==="star"||this.current.type==="slash"||this.current.type==="percent";){const t=this.current;this.current=this.tokenizer.next();const s=this.parseFactor();e={kind:"BinaryExpression",operator:t.type==="star"?"*":t.type==="slash"?"/":"%",left:e,right:s}}return e}parseFactor(){if(this.current.type==="not")return this.current=this.tokenizer.next(),{kind:"UnaryExpression",operator:"not",expr:this.parseFactor()};if(this.current.type==="plus"||this.current.type==="minus"){const e=this.current.type==="minus";this.current=this.tokenizer.next();const t=this.parseFactor();return e?{kind:"BinaryExpression",operator:"*",left:{kind:"NumberLiteral",value:-1},right:t}:t}return this.parsePostfix(this.parsePrimary())}parsePostfix(e){var s;let t=e;for(;;){if(this.current.type==="dot"){if(this.current=this.tokenizer.next(),this.current.type!=="identifier")throw new Zv("Expected identifier after '.'",this.current.start);const o=((s=this.current.value)==null?void 0:s.toString())??"";this.current=this.tokenizer.next(),t={kind:"MemberExpression",object:t,property:{kind:"Identifier",name:o}};continue}if(this.current.type==="lbracket"){this.current=this.tokenizer.next();const o=this.parseExpression();this.eat("rbracket"),t={kind:"IndexExpression",object:t,index:o};continue}break}return t}parsePrimary(){const e=this.current;switch(e.type){case"number":{this.current=this.tokenizer.next();const t=Number(e.value);if(!Number.isFinite(t))throw new Zv("Invalid number literal",e.start);return{kind:"NumberLiteral",value:t}}case"string":return this.current=this.tokenizer.next(),{kind:"StringLiteral",value:String(e.value??"")};case"boolean":return this.current=this.tokenizer.next(),{kind:"NumberLiteral",value:String(e.value||"").toLowerCase()==="true"?1:0};case"identifier":{this.current=this.tokenizer.next();const t=(e.value||"").toString();if(this.current.type==="lparen"){this.eat("lparen");const s=[];if(this.current.type!=="rparen")for(;s.push(this.parseExpression()),!!this.match("comma"););return this.eat("rparen"),{kind:"CallExpression",callee:t,args:s}}return{kind:"Identifier",name:t}}case"lparen":{this.eat("lparen");const t=this.parseExpression();return this.eat("rparen"),t}default:throw new Zv(`Unexpected token ${e.type}`,e.start)}}}function Lp(n){const e=new T$(new A$(n)),t=e.parseExpression();if(e.current.type!=="eof")throw new Zv("Unexpected input after end of expression",e.current.start);return t}function x_(n,e){const t=[];let s=0;for(let o=0;o<n.length;o++){const r=n[o];s+=r??0,o>=e&&(s-=n[o-e]??0),t.push(o>=e-1?s/e:void 0)}return t}function F$(n,e){const t=[],s=e*(e+1)/2;for(let o=0;o<n.length;o++){if(o<e-1){t.push(void 0);continue}let r=0;for(let a=0;a<e;a++)r+=(n[o-a]??0)*(e-a);t.push(r/s)}return t}function L$(n,e){const t=[];let s,o=0;for(let r=0;r<n.length;r++){const a=n[r];if(a==null){t.push(void 0);continue}if(s===void 0){if(o+=a,r<e-1){t.push(void 0);continue}s=o/e,t.push(s);continue}s=(s*(e-1)+a)/e,t.push(s)}return t}function n0(n,e){const t=[],s=2/(e+1);let o;for(let r=0;r<n.length;r++){const a=n[r];if(a==null){t.push(void 0);continue}o=o===void 0?a:a*s+o*(1-s),t.push(o)}return t}function E$(n,e){const t=[];let s,o=0,r=0,a=!1;const l=[],c=[];for(let f=0;f<n.length;f++){const u=n[f];if(u==null){t.push(void 0);continue}if(s===void 0){s=u,t.push(void 0);continue}const d=u-s;s=u;const h=d>0?d:0,m=d<0?-d:0;if(a)o=(o*(e-1)+h)/e,r=(r*(e-1)+m)/e;else{if(l.push(h),c.push(m),l.length<e){t.push(void 0);continue}o=l.reduce((g,w)=>g+w,0)/e,r=c.reduce((g,w)=>g+w,0)/e,a=!0}if(r===0)t.push(100);else{const g=o/r;t.push(100-100/(1+g))}}return t}function u2(n,e,t,s){const o=t.length,r=new Array(o).fill(0);let a;for(let f=0;f<o;f++){const u=n[f]??t[f]??NaN,d=e[f]??t[f]??NaN,h=t[f]??NaN;let m=Math.max(0,u-d);a!==void 0&&(m=Math.max(m,Math.abs(u-a),Math.abs(d-a))),r[f]=m,a=h}const l=new Array(o);let c=0;for(let f=0;f<o;f++)c+=r[f],f===s-1?l[f]=c/s:f>=s?l[f]=(l[f-1]*(s-1)+r[f])/s:l[f]=void 0;return l}function rS(n,e){const t=new Array(n.length);let s=0,o;for(let r=0;r<n.length;r++){const a=n[r],l=e[r]??0;if(o===void 0||a===void 0){t[r]=void 0,o=a;continue}a>o?s+=l:a<o&&(s-=l),t[r]=s,o=a}return t}function aS(n,e,t,s){const o=t.length,r=new Array(o);for(let c=0;c<o;c++)r[c]=((n[c]??t[c]??0)+(e[c]??t[c]??0)+(t[c]??0))/3;const a=x_(r.map(c=>c),s).map(c=>c),l=new Array(o);for(let c=0;c<o;c++){if(c<s-1){l[c]=void 0;continue}let f=0;for(let d=c-s+1;d<=c;d++)f+=Math.abs(r[d]-a[c]);f=f/s;const u=.015*f;l[c]=u===0?void 0:(r[c]-a[c])/u}return l}function lS(n,e,t,s,o){const r=t.length,a=new Array(r),l=new Array(r);for(let f=0;f<r;f++)l[f]=((n[f]??t[f]??0)+(e[f]??t[f]??0)+(t[f]??0))/3;const c=new Array(r);for(let f=0;f<r;f++)c[f]=l[f]*(s[f]??0);for(let f=0;f<r;f++){if(f<o){a[f]=void 0;continue}let u=0,d=0;for(let m=f-o+1;m<=f;m++)l[m]>=l[m-1]?u+=c[m]:d+=c[m];const h=d===0?1/0:u/d;a[f]=100-100/(1+h)}return a}function $$(n,e){const t=n.map((a,l)=>((a??0)+(e[l]??0))/2),s=x_(t,5),o=x_(t,34),r=new Array(t.length);for(let a=0;a<t.length;a++){const l=s[a],c=o[a];r[a]=l===void 0||c===void 0?void 0:l-c}return r}function D$(n,e){const t=n0(n,e).map(a=>a??NaN),s=n0(t,e).map(a=>a??NaN),o=n0(s,e).map(a=>a??NaN),r=new Array(n.length);for(let a=1;a<n.length;a++){const l=o[a-1],c=o[a];r[a]=l===void 0||c===void 0||l===0?void 0:(c/l-1)*100}return r[0]=void 0,r}function Mk(n,e){const t=new Array(n.length);let s=0,o=0;for(let r=0;r<n.length;r++){const a=n[r],l=e[r]??0;if(a===void 0){t[r]=void 0;continue}s+=a*l,o+=l,t[r]=o===0?void 0:s/o}return t}function R$(n,e,t){const s=new Array(n.length);let o=0,r=0;for(let a=0;a<n.length;a++){const l=n[a],c=e[a]??0;if(l!==void 0&&(o+=l*c,r+=c),a>=t){const f=n[a-t],u=e[a-t]??0;f!==void 0&&(o-=f*u,r-=u)}s[a]=a>=t-1&&r!==0?o/r:void 0}return s}function iw(n,e,t){const s=n.map(c=>c??NaN),o=x_(s,e),r=[];for(let c=0;c<s.length;c++){if(c<e-1){r.push(void 0);continue}let f=0;for(let h=c-e+1;h<=c;h++)f+=s[h];const u=f/e;let d=0;for(let h=c-e+1;h<=c;h++){const m=s[h]-u;d+=m*m}r.push(Math.sqrt(d/e))}const a=new Array(s.length),l=new Array(s.length);for(let c=0;c<s.length;c++){const f=o[c],u=r[c];a[c]=f===void 0||u===void 0?void 0:f+t*u,l[c]=f===void 0||u===void 0?void 0:f-t*u}return{mid:o,upper:a,lower:l}}function j$(n,e,t,s,o){const r=t.length,a=u2(n,e,t,s).map(m=>m??NaN),l=new Array(r),c=new Array(r);for(let m=0;m<r;m++){const g=((n[m]??t[m]??0)+(e[m]??t[m]??0))/2,w=a[m];l[m]=g+o*w,c[m]=g-o*w}const f=new Array(r);let u=NaN,d=NaN,h=!0;for(let m=0;m<r;m++){u=Number.isFinite(u)?Math.min(l[m],u):l[m],d=Number.isFinite(d)?Math.max(c[m],d):c[m];const g=t[m]??NaN;if(!Number.isFinite(g)){f[m]=void 0;continue}h?(g<d&&(h=!1,u=l[m]),f[m]=d):(g>u&&(h=!0,d=c[m]),f[m]=u)}return f}function B$(n,e,t,s,o){const r=n0(t,s).map(u=>u??NaN),a=u2(n,e,t,s).map(u=>u??NaN),l=t.length,c=new Array(l),f=new Array(l);for(let u=0;u<l;u++){const d=r[u],h=a[u];c[u]=Number.isFinite(d)&&Number.isFinite(h)?d+o*h:void 0,f[u]=Number.isFinite(d)&&Number.isFinite(h)?d-o*h:void 0}return{mid:r,upper:c,lower:f}}function O$(n,e,t){const s=n.length,o=new Array(s),r=new Array(s),a=new Array(s);for(let l=0;l<s;l++){if(l<t-1){o[l]=void 0,r[l]=void 0,a[l]=void 0;continue}let c=-1/0,f=1/0;for(let u=l-t+1;u<=l;u++){const d=n[u]??e[u]??NaN,h=e[u]??n[u]??NaN;Number.isFinite(d)&&d>c&&(c=d),Number.isFinite(h)&&h<f&&(f=h)}o[l]=c,r[l]=f,a[l]=Number.isFinite(c)&&Number.isFinite(f)?(c+f)/2:void 0}return{upper:o,lower:r,mid:a}}function cS(n,e){const t=n.length,s=new Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=void 0;continue}let r=0;for(let u=o-e+1;u<=o;u++)r+=n[u]??0;const a=r/e;let l=0;for(let u=o-e+1;u<=o;u++){const d=(n[u]??0)-a;l+=d*d}const c=Math.sqrt(l/e),f=n[o]??NaN;s[o]=Number.isFinite(c)&&c!==0?(f-a)/c:void 0}return s}function Nk(n,e){const t=n.length,s=new Array(t);let o=n[0];for(let r=0;r<t;r++){const a=n[r],l=e[r]??0;if(a==null){s[r]=void 0;continue}const c=a>=(o??a)?1:-1;s[r]=c*l,o=a}return s}function z$(n){const e=n.length,t=new Array(e);let s=0;for(let o=0;o<e;o++){const r=n[o];if(r==null){t[o]=void 0;continue}s+=r,t[o]=s}return t}function V$(n,e){const t=n.length,s=new Array(t),o=new Array(t),r=new Array(t);for(let a=0;a<t;a++){if(a<e-1){s[a]=void 0,o[a]=void 0,r[a]=void 0;continue}let l=0,c=0,f=0,u=0,d=0;for(let A=a-e+1;A<=a;A++){const M=A-(a-e+1),F=n[A]??NaN;Number.isFinite(F)&&(l+=M,c+=F,f+=M*M,u+=M*F,d++)}const h=d*f-l*l;if(h===0||d===0){s[a]=void 0,o[a]=void 0,r[a]=void 0;continue}const m=(d*u-l*c)/h,g=(c-m*l)/d,w=e-1,C=m*w+g;s[a]=C;const P=cS(n.slice(a-e+1,a+1).map(A=>A??NaN),e).pop(),I=Number(P)*(n[a]??0?1:0);o[a]=Number.isFinite(C)?C+Math.abs(I||0):void 0,r[a]=Number.isFinite(C)?C-Math.abs(I||0):void 0}return{mid:s,upper:o,lower:r}}function uS(n,e,t){const s=n.length,o=new Array(s);let r=0;for(let a=0;a<s;a++){const l=n[a],c=e[a]??0;if(l==null){o[a]=void 0;continue}const f=c/Math.max(1,e[a-1]??c);r=(r*(t-1)+l*f)/t,o[a]=r}return o}function vv(n){if(!n)return 0;let e=2166136261;for(let s=0;s<n.length;s++)e^=n.charCodeAt(s),e=Math.imul(e,16777619);const t=e>>>0;return t===0?1:t}function by(n){return Number.isFinite(n)?n.toFixed(2):""}function rw(n,e){if(!Number.isFinite(n))return"";if(!e)return by(n);const t=String(e),s=t.includes("%"),o=t.split(".");let r=0;o.length>1&&(r=o[1].replace(/[^0-9#]/g,"").length);const a=s?n*100:n,l=r>0?a.toFixed(r):String(Math.round(a));return s?`${l}%`:l}class Tt extends Error{constructor(e){super(e),this.name="ExpressionEngineError"}}function Kv(n,e){const t=n.length,s=new Float32Array(t);let o=0;for(let r=0;r<t;r++){const a=n[r];if(Number.isFinite(a)&&(o+=a),r>=e){const l=n[r-e];Number.isFinite(l)&&(o-=l)}s[r]=r>=e-1?o:NaN}return s}function dS(n,e,t){const s=n.length,o=new Float32Array(s),r=e-1,a=t==="rising";for(let l=0;l<s;l++){if(l<r){o[l]=NaN;continue}let c=!0,f=!0;const u=l-r;for(let d=u;d<=l;d++){const h=n[d];if(!Number.isFinite(h)){f=!1;break}if(d===u)continue;const m=n[d-1];if(!Number.isFinite(m)){f=!1;break}(a?!(h>m):!(h<m))&&(c=!1)}o[l]=f?c?1:0:NaN}return o}function fS(n,e,t){let s=-1/0;for(let o=e;o<=t;o++){const r=n[o];Number.isFinite(r)&&r>s&&(s=r)}return s}function pS(n,e,t){let s=1/0;for(let o=e;o<=t;o++){const r=n[o];Number.isFinite(r)&&r<s&&(s=r)}return s}function W$(n,e){const t=n.length,s=new Float32Array(t),o=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-o,l=n[r],c=a>=0?n[a]:NaN;s[r]=Number.isFinite(l)&&Number.isFinite(c)?l-c:NaN}return s}function X1(n,e){const t=n.length,s=new Float32Array(t),o=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-o,l=n[r],c=a>=0?n[a]:NaN;!Number.isFinite(l)||!Number.isFinite(c)||c===0?s[r]=NaN:s[r]=(l-c)/c*100}return s}function H$(n,e){const t=n.length,s=new Float32Array(t),o=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-o,l=n[r],c=a>=0?n[a]:NaN;s[r]=Number.isFinite(l)&&Number.isFinite(c)?l-c:NaN}return s}function yg(n){const e=new Array(n.length);for(let t=0;t<n.length;t++){const s=n[t];e[t]=Number.isFinite(s)?s:void 0}return e}function g0(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;t++){const s=n[t];e[t]=s==null||!Number.isFinite(s)?NaN:s}return e}function q$(n,e,t,s){const o=yg(n),r=n0(o,e),a=n0(o,t),l=new Array(o.length);for(let u=0;u<o.length;u++){const d=r[u],h=a[u];l[u]=d==null||h==null?void 0:d-h}const c=n0(l,s),f=new Array(o.length);for(let u=0;u<o.length;u++){const d=l[u],h=c[u];f[u]=d==null||h==null?void 0:d-h}return{line:g0(l),signal:g0(c),hist:g0(f)}}function U$(n,e,t,s,o){const r=t.length,a=new Array(r);for(let u=0;u<r;u++){const d=Math.max(0,u-s+1);let h=-1/0,m=1/0;for(let C=d;C<=u;C++){const P=Number.isFinite(n[C])?n[C]:t[C],I=Number.isFinite(e[C])?e[C]:t[C];Number.isFinite(P)&&P>h&&(h=P),Number.isFinite(I)&&I<m&&(m=I)}const g=t[u],w=h-m;!Number.isFinite(g)||!Number.isFinite(h)||!Number.isFinite(m)||w===0?a[u]=void 0:a[u]=100*((g-m)/w)}const l=a.map(u=>u??NaN),c=x_(l,o),f=new Array(r);for(let u=0;u<r;u++){const d=c[u];f[u]=Number.isFinite(d)?d:void 0}return{k:g0(a),d:g0(f)}}function mS(n,e,t,s){const o=t.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=Math.max(0,a-s+1);let c=-1/0,f=1/0,u=!1;for(let m=l;m<=a;m++){const g=Number.isFinite(n[m])?n[m]:t[m],w=Number.isFinite(e[m])?e[m]:t[m];Number.isFinite(g)&&(g>c&&(c=g),u=!0),Number.isFinite(w)&&(w<f&&(f=w),u=!0)}const d=t[a],h=c-f;if(!u||!Number.isFinite(d)||!Number.isFinite(c)||!Number.isFinite(f)||h===0){r[a]=NaN;continue}r[a]=-100*((c-d)/h)}return r}function d2(n,e,t){const s=JS(n,t),o=QS(e,t),r=n.length,a=new Float32Array(r),l=new Float32Array(r);for(let c=0;c<r;c++){const f=s[c],u=o[c];if(!Number.isFinite(f)||!Number.isFinite(u)){a[c]=NaN,l[c]=NaN;continue}a[c]=100*((t-f)/t),l[c]=100*((t-u)/t)}return{up:a,down:l}}function G$(n,e,t){const{up:s,down:o}=d2(n,e,t),r=s.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=s[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)?c-f:NaN}return a}function X0(n,e,t,s,o){const r=t.length,a=new Float32Array(r),l=new Float32Array(r),c=new Float32Array(r);for(let C=0;C<r;C++){const P=n[C],I=e[C],A=t[C];if(!Number.isFinite(P)||!Number.isFinite(I)||!Number.isFinite(A)){a[C]=NaN,l[C]=NaN,c[C]=NaN;continue}if(C===0){a[C]=Math.max(0,P-I),l[C]=0,c[C]=0;continue}const M=n[C-1],F=e[C-1],B=t[C-1];if(!Number.isFinite(M)||!Number.isFinite(F)||!Number.isFinite(B)){a[C]=NaN,l[C]=NaN,c[C]=NaN;continue}const $=P-M,L=F-I;l[C]=$>L&&$>0?$:0,c[C]=L>$&&L>0?L:0;const O=P-I,Y=Math.abs(P-B),ce=Math.abs(I-B);a[C]=Math.max(0,O,Y,ce)}const f=H_(a,s),u=H_(l,s),d=H_(c,s),h=new Float32Array(r),m=new Float32Array(r),g=new Float32Array(r);for(let C=0;C<r;C++){const P=f[C],I=u[C],A=d[C];if(!Number.isFinite(P)||P===0||!Number.isFinite(I)||!Number.isFinite(A)){h[C]=NaN,m[C]=NaN,g[C]=NaN;continue}h[C]=100*(I/P),m[C]=100*(A/P);const M=h[C]+m[C];g[C]=M===0?NaN:100*(Math.abs(h[C]-m[C])/M)}const w=H_(g,o);return{plus:h,minus:m,adx:w}}function hS(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){const r=n[o],a=e[o],l=r+a;s[o]=Number.isFinite(r)&&Number.isFinite(a)&&l!==0?100*(Math.abs(r-a)/l):NaN}return s}function vS(n,e,t,s){const o=n.length,r=new Float32Array(o),a=Math.max(1,t+1),l=new Array(a);let c=0,f=0;const u=s||(d=>Number.isFinite(d)&&d!==0);for(let d=0;d<o;d++){const h=n[d];if(u(h)&&(l[f]=d,f=(f+1)%a,c<a&&(c+=1)),c>t){const m=l[(f-1-t+a)%a],g=e[m];r[d]=Number.isFinite(g)?g:NaN}else r[d]=NaN}return r}function gS(n,e){if(!Number.isFinite(n)||!Number.isFinite(e)||!Number.isInteger(n)||!Number.isInteger(e)||n<1||e<1)throw new Tt("pivot left/right must be positive integers");return{left:n,right:e}}function Y$(n,e,t,s){const o=n.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=a-t;if(l-e<0){r[a]=NaN;continue}const c=n[l];if(!Number.isFinite(c)){r[a]=NaN;continue}const f=l-e,u=l+t;let d=!0;for(let h=f;h<=u;h++){const m=n[h];if(!Number.isFinite(m)){d=!1;break}if(s==="high"){if(m>c){d=!1;break}}else if(m<c){d=!1;break}}r[a]=d?c:NaN}return r}const _S="time function args must be integers",yS="timestamp month out of range";function aw(n){return Number.isFinite(n)?(new Date(n).getUTCDay()+6)%7+1:NaN}function lw(n,e){if(!Number.isFinite(n))return NaN;const t=new Date(n);switch(e){case"year":return t.getUTCFullYear();case"month":return t.getUTCMonth()+1;case"hour":return t.getUTCHours();case"minute":return t.getUTCMinutes();default:return t.getUTCSeconds()}}function K0(n){if(!Number.isFinite(n)||!Number.isInteger(n))throw new Tt(_S)}function Ak(n){for(let e=0;e<n.length;e++){const t=n[e];if(Number.isFinite(t)&&!Number.isInteger(t))throw new Tt(_S)}}function bS(n,e,t,s,o,r){if(K0(n),K0(e),K0(t),K0(s),K0(o),K0(r),e<1||e>12)throw new Tt(yS);return Date.UTC(n,e-1,t,s,o,r)}function xS(n){var s,o;const e=(s=n.scalars)==null?void 0:s.__bardurationms;if(Number.isFinite(e)&&e>0)return e;const t=(o=n.series)==null?void 0:o.time;if(t&&t.length>1)for(let r=t.length-1;r>0;r--){const a=t[r],l=t[r-1];if(!Number.isFinite(a)||!Number.isFinite(l))continue;const c=a-l;if(Number.isFinite(c)&&c>0)return c}return 0}function wS(n){var t;const e=(t=n.scalars)==null?void 0:t.__nowms;return Number.isFinite(e)?e:Date.now()}const f2="session.isin session must be in HHMM-HHMM",cw="session.isin time must be a number",Tk=new Map;function kS(n){const e=String(n||"").trim(),t=Tk.get(e);if(t)return t;const s=e.match(/^(\d{2})(\d{2})-(\d{2})(\d{2})$/);if(!s)throw new Tt(f2);const o=Number(s[1]),r=Number(s[2]),a=Number(s[3]),l=Number(s[4]);if(![o,r,a,l].every(Number.isFinite)||o<0||o>23||a<0||a>23||r<0||r>59||l<0||l>59)throw new Tt(f2);const c=o*60+r,f=a*60+l,u={start:c,end:f};return Tk.set(e,u),u}function uw(n){const e=new Date(n);return e.getUTCHours()*60+e.getUTCMinutes()}function dw(n,e,t){return e<=t?n>=e&&n<=t:n>=e||n<=t}function eo(n,e){if(n.kind==="series")return n.value;const t=new Float32Array(e.length);return t.fill(n.value),t}function yi(n){if(n.kind==="scalar")return n.value;const e=n.value;return e.length?e[e.length-1]:NaN}function z1(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++)s[o]=e(n[o]);return s}function _b(n,e,t){const s=n.length,o=new Float32Array(s);for(let r=0;r<s;r++)o[r]=t(n[r],e[r]);return o}const K$="unsafe division: divisor is 0/na",n_="math domain error: sqrt/log/pow/asin/acos",SS="ternary branches must both be numeric or both non-numeric",ay="history index must be integer >= 0",CS="array index must be integer >= 0",X$="array index must be an integer",Z$="Negative array index not allowed",J$="array.set index must be within array size",IS="array.push value must be a string",Q$="condition is na; treated as false",p2="condition must be bool or number",eD="math.mod divisor is 0/na",tD="math.fmod divisor is 0/na",nD="atr length must be integer >= 1",PS="williamsr length must be integer >= 1",MS="aroon length must be integer >= 1",NS="dmi length must be integer >= 1",AS="dmi smoothing must be integer >= 1",TS="adx length must be integer >= 1",FS="plus_di length must be integer >= 1",LS="minus_di length must be integer >= 1",ES="dx length must be integer >= 1",$S="aroonosc length must be integer >= 1",DS="highest length must be integer >= 1",RS="lowest length must be integer >= 1",jS="sum length must be integer >= 1",BS="rising length must be integer >= 1",OS="falling length must be integer >= 1",m2="valuewhen occurrence must be integer >= 0",sD=new Set(["syminfo","strategy","barstate","timeframe"]),S_=n=>{const e=[];let t=n;for(;t.kind==="MemberExpression";)e.unshift(t.property.name),t=t.object;if(t.kind!=="Identifier")return null;const s=t.name.toLowerCase();return sD.has(s)?[s,...e].join("_"):null},r_=n=>Number.isFinite(n)?n===0?0:1:NaN,fw=n=>{const e=r_(n);return Number.isFinite(e)?e===0?1:0:NaN},J_=(n,e)=>{const t=r_(n);if(t===0)return 0;const s=r_(e);return t===1?s:s===0?0:Number.isFinite(s)?NaN:NaN},Q_=(n,e)=>{const t=r_(n);if(t===1)return 1;const s=r_(e);return t===0?s:s===1?1:Number.isFinite(s)?NaN:NaN},y0=(n,e,t)=>Number.isFinite(n)?n!==0:(e&&t&&e.emitOnce(t,Q$),!1),pw=(n,e,t)=>y0(n,e==null?void 0:e.diagnostics,t),Ld=(n,e,t)=>{var s;(s=n==null?void 0:n.diagnostics)==null||s.emitOnce(e,t)},oD=n=>Number.isFinite(n)&&Math.floor(n)===n,E2=n=>n===">"||n==="<"||n===">="||n==="<="||n==="=="||n==="!=",w_=(n,e,t,s)=>t?Number.isFinite(n)?!Number.isFinite(e)||e===0?(Ld(s,"div_zero",K$),NaN):n/e:NaN:e===0?NaN:n/e,zS=(n,e,t,s)=>t&&(!Number.isFinite(n)||!Number.isFinite(e)||e===0)?(Ld(s,"fmod_div_zero",tD),NaN):n%e,VS=(n,e,t,s)=>t&&(!Number.isFinite(n)||!Number.isFinite(e)||e===0)?(Ld(s,"mod_div_zero",eD),NaN):(n%e+e)%e,mw=(n,e,t,s)=>{if(!t)return Math.pow(n,e);if(!Number.isFinite(n)||!Number.isFinite(e))return Ld(s,"math_domain",n_),NaN;if(n<0&&!oD(e))return Ld(s,"math_domain",n_),NaN;const o=Math.pow(n,e);return Number.isFinite(o)?o:(Ld(s,"math_domain",n_),NaN)},WS=(n,e,t)=>e&&(!Number.isFinite(n)||n<0)?(Ld(t,"math_domain",n_),NaN):Math.sqrt(n),HS=(n,e,t)=>{if(!e)return Math.log(n);if(!Number.isFinite(n)||n<=0)return Ld(t,"math_domain",n_),NaN;const s=Math.log(n);return Number.isFinite(s)?s:NaN},qS=(n,e,t)=>{if(!e)return Math.log10(n);if(!Number.isFinite(n)||n<=0)return Ld(t,"math_domain",n_),NaN;const s=Math.log10(n);return Number.isFinite(s)?s:NaN},US=(n,e,t)=>e&&(!Number.isFinite(n)||n<-1||n>1)?(Ld(t,"math_domain",n_),NaN):Math.asin(n),GS=(n,e,t)=>e&&(!Number.isFinite(n)||n<-1||n>1)?(Ld(t,"math_domain",n_),NaN):Math.acos(n),YS=(n,e)=>{if(!e)return Math.tan(n);if(!Number.isFinite(n))return NaN;const t=Math.tan(n);return Number.isFinite(t)?t:NaN},KS=(n,e)=>{if(!e)return Math.exp(n);if(!Number.isFinite(n))return NaN;const t=Math.exp(n);return Number.isFinite(t)?t:NaN},Z0=(n,e,t,s)=>!Number.isFinite(n)||!Number.isInteger(n)||n<0?(Ld(s,e,t),NaN):n,h2=(n,e,t)=>!Number.isFinite(n)||!Number.isInteger(n)?(Ld(t,`${e}:int`,X$),NaN):n<0?(Ld(t,`${e}:neg`,Z$),NaN):n,hw=(n,e,t,s)=>{const o=h2(n,t,s);return!Number.isFinite(o)||!Number.isFinite(e)?0:o>=e?(Ld(s,`${t}:oob`,J$),0):1},Kp=(n,e,t,s)=>!Number.isFinite(n)||!Number.isInteger(n)||n<1?(Ld(s,e,t),NaN):n,Hv=n=>{const e=new Float32Array(n);return e.fill(NaN),e},iD=new Set(["tostring","format","upper","lower","trim","replace","replace_all","contains","startswith","endswith","length","substring","repeat"]),rD=new Set(["tostring","format","upper","lower","trim","replace","replace_all","substring","repeat"]),Fk=new WeakMap,Fd=n=>{const e=Fk.get(n);if(e)return e;let t="";switch(n.kind){case"NumberLiteral":t=`n:${n.value}`;break;case"StringLiteral":t=`s:${n.value}`;break;case"Identifier":t=`id:${n.name}`;break;case"UnaryExpression":t=`u:${n.operator}:${Fd(n.expr)}`;break;case"BinaryExpression":t=`b:${n.operator}:${Fd(n.left)}:${Fd(n.right)}`;break;case"CallExpression":t=`c:${n.callee}:${n.args.map(Fd).join(",")}`;break;case"MemberExpression":t=`m:${Fd(n.object)}:${n.property.name}`;break;case"IndexExpression":t=`i:${Fd(n.object)}:${Fd(n.index)}`;break;default:t="expr"}return Fk.set(n,t),t},N0=n=>{switch(n.kind){case"Identifier":return n.name;case"NumberLiteral":return Number.isFinite(n.value)?String(n.value):"na";case"StringLiteral":return JSON.stringify(n.value);case"MemberExpression":return`${N0(n.object)}.${n.property.name}`;case"IndexExpression":return`${N0(n.object)}[${N0(n.index)}]`;case"CallExpression":return`${n.callee}(${n.args.map(N0).join(", ")})`;case"UnaryExpression":return`${n.operator} ${N0(n.expr)}`;case"BinaryExpression":return`${N0(n.left)} ${n.operator} ${N0(n.right)}`;default:return"expr"}},Jw=(n,e)=>{Ld(n,`member:${Fd(e)}`,`Unsupported member access: ${N0(e)}`)},Qw=(n,e)=>{Ld(n,`index:${Fd(e)}`,`Unsupported indexing: ${N0(e)}`)},Lk=new WeakMap,o0=n=>{const e=Lk.get(n);if(e!=null)return e;let t=!1;switch(n.kind){case"StringLiteral":t=!0;break;case"CallExpression":{const s=n.callee.toLowerCase();if(rD.has(s)){t=!0;break}(s==="iff"||s==="iif"||s==="if")&&n.args.length===3&&(t=o0(n.args[1])||o0(n.args[2]));break}default:t=!1}return Lk.set(n,t),t},Q0=(n,e,t)=>`cond:${e!=null&&e.selfKey?e.selfKey:"cond"}:${Fd(n)}:${t}`,aD=(n,e)=>{let t=!1;const s=o=>{if(!t)switch(o.kind){case"Identifier":{const r=o.name.replace(/\s+/g,"_").toLowerCase();e.series[r]&&(t=!0);return}case"MemberExpression":{const r=S_(o);if(r){const a=r.replace(/\s+/g,"_").toLowerCase();e.series[a]&&(t=!0);return}s(o.object);return}case"IndexExpression":s(o.object),s(o.index);return;case"UnaryExpression":s(o.expr);return;case"BinaryExpression":s(o.left),s(o.right);return;case"CallExpression":o.args.forEach(r=>s(r));return;default:return}};return s(n),t},i1=n=>{switch(n.kind){case"StringLiteral":return"nonNumeric";case"NumberLiteral":return"numeric";case"Identifier":{const e=n.name.replace(/\s+/g,"_").toLowerCase();return e==="true"||e==="false"?"nonNumeric":"numeric"}case"MemberExpression":{const e=S_(n);if(e){const t=e.replace(/\s+/g,"_").toLowerCase();if(t==="true"||t==="false")return"nonNumeric"}return"numeric"}case"IndexExpression":return"numeric";case"UnaryExpression":return n.operator==="not"?"nonNumeric":"numeric";case"BinaryExpression":return E2(n.operator)||n.operator==="and"||n.operator==="or"?"nonNumeric":"numeric";case"CallExpression":{const e=n.callee.toLowerCase();if((e==="iff"||e==="iif"||e==="if")&&n.args.length===3){const t=i1(n.args[1]),s=i1(n.args[2]);return t===s?t:"numeric"}return iD.has(e)?"nonNumeric":"numeric"}default:return"numeric"}};function XS(n,e,t,s){var m;const o=e.kind==="series",r=t.kind==="series",a=((m=s.scalars)==null?void 0:m.__pinev2)===1,l=a&&E2(n),c=g=>Number.isFinite(g)&&g!==0;if(!o&&!r){const g=e.value,w=t.value;if(l&&(!Number.isFinite(g)||!Number.isFinite(w)))return{kind:"scalar",value:NaN};switch(n){case"+":return{kind:"scalar",value:g+w};case"-":return{kind:"scalar",value:g-w};case"*":return{kind:"scalar",value:g*w};case"/":return{kind:"scalar",value:w_(g,w,a,s)};case"%":return{kind:"scalar",value:w===0?NaN:g%w};case">":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&g>w?1:0};case"<":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&g<w?1:0};case">=":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&g>=w?1:0};case"<=":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&g<=w?1:0};case"==":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&Math.abs(g-w)<1e-9?1:0};case"!=":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&Math.abs(g-w)>=1e-9?1:0};case"and":return{kind:"scalar",value:a?J_(g,w):c(g)&&c(w)?1:0};case"or":return{kind:"scalar",value:a?Q_(g,w):c(g)||c(w)?1:0}}}const f=eo(e,s),u=eo(t,s),d=s.length,h=new Float32Array(d);for(let g=0;g<d;g++){const w=f[g],C=u[g];if(l&&(!Number.isFinite(w)||!Number.isFinite(C))){h[g]=NaN;continue}switch(n){case"+":h[g]=w+C;break;case"-":h[g]=w-C;break;case"*":h[g]=w*C;break;case"/":h[g]=w_(w,C,a,s);break;case"%":h[g]=C===0?NaN:w%C;break;case">":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&w>C?1:0;break;case"<":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&w<C?1:0;break;case">=":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&w>=C?1:0;break;case"<=":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&w<=C?1:0;break;case"==":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&Math.abs(w-C)<1e-9?1:0;break;case"!=":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&Math.abs(w-C)>=1e-9?1:0;break;case"and":h[g]=a?J_(w,C):c(w)&&c(C)?1:0;break;case"or":h[g]=a?Q_(w,C):c(w)||c(C)?1:0;break}}return{kind:"series",value:h}}function lD(n,e){var f;if(!(((f=e.scalars)==null?void 0:f.__pinev2)===1)||n.operator!=="and"&&n.operator!=="or")return XS(n.operator,s0(n.left,e),s0(n.right,e),e);const s=s0(n.left,e),o=n.operator;if(s.kind==="scalar"){const u=r_(s.value);if(o==="and"&&u===0)return{kind:"scalar",value:0};if(o==="or"&&u===1)return{kind:"scalar",value:1};const d=s0(n.right,e);if(d.kind==="scalar")return{kind:"scalar",value:o==="and"?J_(u,d.value):Q_(u,d.value)};const h=eo(d,e),m=new Float32Array(h.length);for(let g=0;g<h.length;g++){const w=h[g];m[g]=o==="and"?J_(u,w):Q_(u,w)}return{kind:"series",value:m}}const r=eo(s,e),a=r.length,l=new Float32Array(a),c={series:e.series,scalars:e.scalars,strings:e.strings,draw:e.draw,diagnostics:e.diagnostics,strategy:e.strategy,loopRuntime:e.loopRuntime,funcRuntime:e.funcRuntime,length:a,index:0};for(let u=0;u<a;u++){const d=r[u],h=r_(d);if(o==="and"&&h===0){l[u]=0;continue}if(o==="or"&&h===1){l[u]=1;continue}c.index=u;const m=_r(n.right,c);l[u]=o==="and"?J_(d,m):Q_(d,m)}return{kind:"series",value:l}}function hv(n,e){const t=n.length,s=new Float32Array(t);let o=0,r=0;for(let a=0;a<t;a++){const l=n[a];if(Number.isFinite(l)&&(o+=l,r+=1),a>=e){const c=n[a-e];Number.isFinite(c)&&(o-=c,r-=1)}a>=e-1?s[a]=r>0?o/r:NaN:s[a]=NaN}return s}function gm(n,e){const t=n.length,s=new Float32Array(t),o=2/(e+1);let r;for(let a=0;a<t;a++){const l=n[a];if(!Number.isFinite(l)){s[a]=r===void 0?NaN:r;continue}if(r===void 0||!Number.isFinite(r)){r=l,s[a]=l;continue}r=l*o+r*(1-o),s[a]=r}return s}function e6(n,e,t){const s=n.length,o=new Float32Array(s);let r=NaN;for(let a=0;a<s;a++){const l=n[a],c=e[a],f=t[a];let u=Math.max(0,l-c);Number.isFinite(r)&&(u=Math.max(u,Math.abs(l-r),Math.abs(c-r))),o[a]=u,r=f}return o}function H_(n,e){const t=n.length,s=new Float32Array(t);let o,r=0,a=0;for(let l=0;l<t;l++){const c=n[l];if(o===void 0){if(Number.isFinite(c)&&(r+=c,a+=1),a<e){s[l]=NaN;continue}o=r/e,s[l]=o;continue}Number.isFinite(c)&&(o=(o*(e-1)+c)/e),s[l]=o}return s}function ZS(n,e){const t=n.length,s=new Float32Array(t);let o,r=0,a=0,l=!1;const c=[],f=[];for(let u=0;u<t;u++){const d=n[u];if(!Number.isFinite(d)){s[u]=NaN;continue}if(o===void 0){o=d,s[u]=NaN;continue}if(!Number.isFinite(o)){o=d,s[u]=NaN;continue}const h=d-o;o=d;const m=h>0?h:0,g=h<0?-h:0;if(l)r=(r*(e-1)+m)/e,a=(a*(e-1)+g)/e;else{c.push(m),f.push(g);const w=c.length,C=Math.max(1,Math.min(e,w));r=c.reduce((P,I)=>P+I,0)/C,a=f.reduce((P,I)=>P+I,0)/C,w>=e&&(l=!0)}if(a===0)s[u]=100;else{const w=r/a;s[u]=100-100/(1+w)}}return s}function t6(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=0,a=0;for(let f=o-e+1;f<=o;f++){const u=n[f];Number.isFinite(u)&&(r+=u,a+=1)}if(a<2){s[o]=NaN;continue}const l=r/a;let c=0;for(let f=o-e+1;f<=o;f++){const u=n[f];if(!Number.isFinite(u))continue;const d=u-l;c+=d*d}s[o]=Math.sqrt(c/a)}return s}function Ub(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=0,a=0;for(let l=0;l<e;l++){const c=n[o-l],f=e-l;Number.isFinite(c)&&(r+=c*f,a+=f)}s[o]=a>0?r/a:NaN}return s}function cD(n,e){const t=gm(n,e),s=gm(t,e),o=n.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=t[a],c=s[a];r[a]=Number.isFinite(l)&&Number.isFinite(c)?2*l-c:NaN}return r}function uD(n,e){const t=gm(n,e),s=gm(t,e),o=gm(s,e),r=n.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=t[l],f=s[l],u=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&Number.isFinite(u)?3*c-3*f+u:NaN}return a}function dD(n,e){const t=Math.ceil((e+1)/2),s=Math.floor((e+1)/2);return hv(hv(n,t),s)}function fD(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=0,a=0;for(let l=0;l<e;l++){const c=n[o-l];if(!Number.isFinite(c))continue;const f=Math.min(l+1,e-l);r+=c*f,a+=f}s[o]=a>0?r/a:NaN}return s}function pD(n,e){const t=Math.max(1,Math.floor(e/2)),s=Math.max(1,Math.round(Math.sqrt(e))),o=Ub(n,t),r=Ub(n,e),a=n.length,l=new Float32Array(a);for(let c=0;c<a;c++){const f=o[c],u=r[c];l[c]=Number.isFinite(f)&&Number.isFinite(u)?2*f-u:NaN}return Ub(l,s)}function mD(n,e,t,s){const o=n.length,r=new Float32Array(o),a=2/(t+1),l=2/(s+1);let c=NaN;for(let f=0;f<o;f++){const u=n[f];if(!Number.isFinite(u)||f<e){r[f]=NaN;continue}const d=n[f-e];if(!Number.isFinite(d)){r[f]=NaN;continue}let h=0,m=!0;for(let P=f-e+1;P<=f;P++){const I=n[P],A=n[P-1];if(!Number.isFinite(I)||!Number.isFinite(A)){m=!1;break}h+=Math.abs(I-A)}if(!m||h===0){r[f]=NaN;continue}const w=Math.abs(u-d)/h,C=Math.pow(w*(a-l)+l,2);Number.isFinite(c)||(c=u),c=c+C*(u-c),r[f]=c}return r}function hD(n,e,t,s){const o=n.length,r=new Float32Array(o),a=t*(e-1),l=e/s,c=[];for(let f=0;f<e;f++){const u=Math.exp(-((f-a)*(f-a))/(2*l*l));c.push(u)}for(let f=0;f<o;f++){if(f<e-1){r[f]=NaN;continue}let u=0,d=0;for(let h=0;h<e;h++){const m=n[f-e+1+h];if(!Number.isFinite(m))continue;const g=c[h];u+=m*g,d+=g}r[f]=d>0?u/d:NaN}return r}function vD(n,e,t){const s=gm(n,e),o=gm(s,e),r=gm(o,e),a=gm(r,e),l=gm(a,e),c=gm(l,e),f=t,u=f*f,d=u*f,h=-d,m=3*u+3*d,g=-6*u-3*f-3*d,w=1+3*f+d+3*u,C=n.length,P=new Float32Array(C);for(let I=0;I<C;I++){const A=r[I],M=l[I],F=c[I],B=a[I];P[I]=Number.isFinite(A)&&Number.isFinite(B)&&Number.isFinite(M)&&Number.isFinite(F)?h*F+m*M+g*B+w*A:NaN}return P}function n6(n,e,t,s){const o=e6(n,e,t),r=o.length,a=new Float32Array(r);let l=0;for(let c=0;c<r;c++)l+=o[c],c===s-1?a[c]=l/s:c>=s?a[c]=(a[c-1]*(s-1)+o[c])/s:a[c]=NaN;return a}function gD(n,e,t,s){const o=n6(n,e,t,s),r=o.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=o[l],f=t[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&f!==0?c/f*100:NaN}return a}function _D(n,e){const t=n.length,s=new Float32Array(t),o=[],r=[];for(let a=0;a<t;a++){const l=n[a],c=a>0?n[a-1]:NaN;if(!Number.isFinite(l)||!Number.isFinite(c))o.push(0),r.push(0);else{const h=l-c;o.push(h>0?h:0),r.push(h<0?-h:0)}if(a<e){s[a]=NaN;continue}let f=0,u=0;for(let h=a-e+1;h<=a;h++)f+=o[h],u+=r[h];const d=f+u;s[a]=d===0?NaN:100*(f-u)/d}return s}function yD(n,e,t){const s=n.length,o=new Float32Array(s);for(let d=0;d<s;d++){const h=n[d],m=d>0?n[d-1]:NaN;o[d]=Number.isFinite(h)&&Number.isFinite(m)?h-m:NaN}const r=gm(o,e),a=gm(r,t),l=new Float32Array(s);for(let d=0;d<s;d++)l[d]=Math.abs(o[d]);const c=gm(l,e),f=gm(c,t),u=new Float32Array(s);for(let d=0;d<s;d++){const h=a[d],m=f[d];u[d]=Number.isFinite(h)&&Number.isFinite(m)&&m!==0?100*h/m:NaN}return u}function bD(n,e,t,s){const o=ZS(n,e),r=r1(o,e),a=a1(o,e),l=n.length,c=new Float32Array(l);for(let u=0;u<l;u++){const d=o[u],h=r[u],m=a[u],g=h-m;c[u]=Number.isFinite(d)&&Number.isFinite(g)&&g!==0?(d-m)/g*100:NaN}let f=c;return t&&t>1&&(f=hv(f,t)),s&&s>1&&(f=hv(f,s)),f}function xD(n,e,t){const s=gm(n,e),o=gm(n,t),r=n.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=s[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&f!==0?(c-f)/f*100:NaN}return a}function wD(n,e){const t=n.length,s=new Float32Array(t);for(let l=0;l<t;l++)s[l]=(n[l]+e[l])/2;const o=hv(s,5),r=hv(s,34),a=new Float32Array(t);for(let l=0;l<t;l++){const c=o[l],f=r[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)?c-f:NaN}return a}function kD(n,e){const t=gm(n,e),s=gm(t,e),o=gm(s,e),r=n.length,a=new Float32Array(r);a[0]=NaN;for(let l=1;l<r;l++){const c=o[l-1],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&c!==0?(f/c-1)*100:NaN}return a}function SD(n,e){const t=hv(n,e),s=t6(n,e),o=n.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=t[a],c=s[a],f=n[a];r[a]=Number.isFinite(f)&&Number.isFinite(l)&&Number.isFinite(c)&&c!==0?(f-l)/c:NaN}return r}function CD(n,e,t,s){const o=t.length,r=new Float32Array(o);let a=0;for(let l=0;l<o;l++){const c=n[l],f=e[l],u=t[l],d=s[l];if(!Number.isFinite(c)||!Number.isFinite(f)||!Number.isFinite(u)){r[l]=NaN;continue}const h=c-f,m=Number.isFinite(h)&&h!==0?(2*u-c-f)/h:0;Number.isFinite(d)&&(a+=m*d),r[l]=a}return r}function ID(n,e,t,s,o){const r=t.length,a=new Float32Array(r);for(let u=0;u<r;u++){const d=n[u],h=e[u],m=t[u],g=s[u];if(!Number.isFinite(d)||!Number.isFinite(h)||!Number.isFinite(m)){a[u]=NaN;continue}const w=d-h,C=Number.isFinite(w)&&w!==0?(2*m-d-h)/w:0;a[u]=Number.isFinite(g)?C*g:NaN}const l=Kv(a,o),c=Kv(s,o),f=new Float32Array(r);for(let u=0;u<r;u++){const d=l[u],h=c[u];f[u]=Number.isFinite(d)&&Number.isFinite(h)&&h!==0?d/h:NaN}return f}function PD(n,e,t,s,o){const r=t.length,a=n6(n,e,t,s),l=new Float32Array(r),c=new Float32Array(r);let f=NaN,u=NaN,d=!0;for(let h=0;h<r;h++){const m=n[h],g=e[h],w=t[h],C=a[h];if(!Number.isFinite(m)||!Number.isFinite(g)||!Number.isFinite(C)){l[h]=NaN,c[h]=NaN;continue}const P=(m+g)/2,I=P+o*C,A=P-o*C;if(f=Number.isFinite(f)?Math.min(I,f):I,u=Number.isFinite(u)?Math.max(A,u):A,!Number.isFinite(w)){l[h]=NaN,c[h]=NaN;continue}d?w<u?(d=!1,f=I,l[h]=f,c[h]=-1):(l[h]=u,c[h]=1):w>f?(d=!0,u=A,l[h]=u,c[h]=1):(l[h]=f,c[h]=-1)}return{line:l,dir:c}}function MD(n,e,t,s,o){const r=gm(t,s),a=n6(n,e,t,s),l=t.length,c=new Float32Array(l),f=new Float32Array(l);for(let u=0;u<l;u++){const d=r[u],h=a[u];c[u]=Number.isFinite(d)&&Number.isFinite(h)?d+o*h:NaN,f[u]=Number.isFinite(d)&&Number.isFinite(h)?d-o*h:NaN}return{mid:r,upper:c,lower:f}}function ND(n,e,t){const s=r1(n,t),o=a1(e,t),r=n.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=s[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)?(c+f)/2:NaN}return{upper:s,lower:o,mid:a}}function AD(n,e,t,s,o){const r=n.length,a=new Float32Array(r);if(!r)return a;let l=!0;r>1&&Number.isFinite(n[1])&&Number.isFinite(n[0])&&(l=n[1]>=n[0]);let c=t,f=l?n[0]:e[0],u=l?e[0]:n[0];a[0]=u;for(let d=1;d<r;d++){const h=n[d],m=e[d];if(!Number.isFinite(h)||!Number.isFinite(m)){a[d]=NaN;continue}if(u=u+c*(f-u),l){const g=e[d-1],w=d>1?e[d-2]:g;Number.isFinite(g)&&(u=Math.min(u,g)),Number.isFinite(w)&&(u=Math.min(u,w)),m<u?(l=!1,u=f,f=m,c=t):h>f&&(f=h,c=Math.min(c+s,o))}else{const g=n[d-1],w=d>1?n[d-2]:g;Number.isFinite(g)&&(u=Math.max(u,g)),Number.isFinite(w)&&(u=Math.max(u,w)),h>u?(l=!0,u=f,f=h,c=t):m<f&&(f=m,c=Math.min(c+s,o))}a[d]=u}return a}function TD(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=0,a=0,l=!0;for(let c=0;c<e;c++){const f=n[o-c];if(!Number.isFinite(f)){l=!1;break}const u=c+1;r+=f,a+=f*u}if(!l||r===0){s[o]=NaN;continue}s[o]=-(a/r)+(e+1)/2}return s}function FD(n,e,t,s,o,r){const a=r1(n,s),l=a1(e,s),c=t.length,f=new Float32Array(c);for(let m=0;m<c;m++){const g=t[m],w=a[m],C=l[m],P=w-C;f[m]=Number.isFinite(g)&&Number.isFinite(w)&&Number.isFinite(C)&&P!==0?(g-C)/P*100:NaN}const u=hv(f,o),d=hv(u,r),h=new Float32Array(c);for(let m=0;m<c;m++){const g=u[m],w=d[m];h[m]=Number.isFinite(g)&&Number.isFinite(w)?3*g-2*w:NaN}return{k:u,d,j:h}}function LD(n,e,t,s,o,r,a,l,c,f){const u=X1(n,e),d=X1(n,t),h=X1(n,s),m=X1(n,o),g=hv(u,r),w=hv(d,a),C=hv(h,l),P=hv(m,c),I=n.length,A=new Float32Array(I);for(let F=0;F<I;F++){const B=g[F],$=w[F],L=C[F],O=P[F];A[F]=Number.isFinite(B)&&Number.isFinite($)&&Number.isFinite(L)&&Number.isFinite(O)?B+2*$+3*L+4*O:NaN}const M=hv(A,f);return{kst:A,signal:M}}function ED(n,e,t,s,o,r){const a=t.length,l=new Float32Array(a),c=new Float32Array(a);let f=NaN;for(let P=0;P<a;P++){const I=n[P],A=e[P],M=t[P];if(!Number.isFinite(I)||!Number.isFinite(A)||!Number.isFinite(M)){l[P]=NaN,c[P]=NaN,f=M;continue}const F=Math.min(A,Number.isFinite(f)?f:A),B=Math.max(I,Number.isFinite(f)?f:I);l[P]=M-F,c[P]=B-F,f=M}const u=Kv(l,s),d=Kv(l,o),h=Kv(l,r),m=Kv(c,s),g=Kv(c,o),w=Kv(c,r),C=new Float32Array(a);for(let P=0;P<a;P++){const I=u[P],A=d[P],M=h[P],F=m[P],B=g[P],$=w[P];if(!Number.isFinite(I)||!Number.isFinite(A)||!Number.isFinite(M)||!Number.isFinite(F)||!Number.isFinite(B)||!Number.isFinite($)||F===0||B===0||$===0){C[P]=NaN;continue}const L=I/F,O=A/B,Y=M/$;C[P]=100*(4*L+2*O+Y)/7}return C}function $D(n,e,t){const s=hv(n,e),o=t6(n,e),r=n.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=s[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&c!==0?2*t*f/c:NaN}return a}function DD(n,e,t){const s=n.length,o=new Float32Array(s);let r=t;o[0]=r;for(let a=1;a<s;a++){const l=n[a],c=n[a-1],f=e[a],u=e[a-1];if(!Number.isFinite(l)||!Number.isFinite(c)||!Number.isFinite(f)||!Number.isFinite(u)||c===0){o[a]=r;continue}f>u&&(r=r+(l-c)/c*r),o[a]=r}return o}function RD(n,e,t){const s=n.length,o=new Float32Array(s);let r=t;o[0]=r;for(let a=1;a<s;a++){const l=n[a],c=n[a-1],f=e[a],u=e[a-1];if(!Number.isFinite(l)||!Number.isFinite(c)||!Number.isFinite(f)||!Number.isFinite(u)||c===0){o[a]=r;continue}f<u&&(r=r+(l-c)/c*r),o[a]=r}return o}function jD(n,e,t,s){const o=t.length,r=new Float32Array(o),a=new Float32Array(o);for(let m=0;m<o;m++){if(m===0){r[m]=NaN,a[m]=NaN;continue}const g=n[m],w=e[m],C=n[m-1],P=e[m-1];r[m]=Number.isFinite(g)&&Number.isFinite(P)?Math.abs(g-P):NaN,a[m]=Number.isFinite(w)&&Number.isFinite(C)?Math.abs(w-C):NaN}const l=e6(n,e,t),c=Kv(r,s),f=Kv(a,s),u=Kv(l,s),d=new Float32Array(o),h=new Float32Array(o);for(let m=0;m<o;m++){const g=c[m],w=f[m],C=u[m];d[m]=Number.isFinite(g)&&Number.isFinite(C)&&C!==0?g/C:NaN,h[m]=Number.isFinite(w)&&Number.isFinite(C)&&C!==0?w/C:NaN}return{plus:d,minus:h}}function r1(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){let r=-1/0,a=!1;const l=Math.max(0,o-e+1);for(let c=l;c<=o;c++){const f=n[c];Number.isFinite(f)&&(a=!0,f>r&&(r=f))}s[o]=a?r:NaN}return s}function a1(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){let r=1/0,a=!1;const l=Math.max(0,o-e+1);for(let c=l;c<=o;c++){const f=n[c];Number.isFinite(f)&&(a=!0,f<r&&(r=f))}s[o]=a?r:NaN}return s}function JS(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=-1/0,a=NaN;for(let l=0;l<e;l++){const c=o-l,f=n[c];Number.isFinite(f)&&f>r&&(r=f,a=l)}s[o]=Number.isFinite(a)?a:NaN}return s}function QS(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=1/0,a=NaN;for(let l=0;l<e;l++){const c=o-l,f=n[c];Number.isFinite(f)&&f<r&&(r=f,a=l)}s[o]=Number.isFinite(a)?a:NaN}return s}function BD(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=0,a=0,l=0;const c=o-e+1;for(let d=c;d<=o;d++){const h=n[d];Number.isFinite(h)&&(r+=h,a+=h*h,l+=1)}if(l<2){s[o]=NaN;continue}const f=r/l,u=a/l-f*f;s[o]=Number.isFinite(u)?u:NaN}return s}function OD(n,e,t){const s=n.length,o=new Float32Array(s);for(let r=0;r<s;r++){if(r<t-1){o[r]=NaN;continue}let a=0,l=0,c=0,f=0,u=0,d=0;const h=r-t+1;for(let A=h;A<=r;A++){const M=n[A],F=e[A];!Number.isFinite(M)||!Number.isFinite(F)||(a+=M,l+=F,c+=M*M,f+=F*F,u+=M*F,d+=1)}if(d<2){o[r]=NaN;continue}const m=a/d,g=l/d,w=u/d-m*g,C=c/d-m*m,P=f/d-g*g,I=Math.sqrt(C*P);o[r]=I>0?w/I:NaN}return o}function zD(n,e,t){const s=n.length,o=new Float32Array(s),r=Math.max(1,Math.floor(e)),a=Math.floor(t),l=(r-1)*r/2,c=(r-1)*r*(2*r-1)/6,f=r*c-l*l;for(let u=0;u<s;u++){if(u<r-1||f===0){o[u]=NaN;continue}let d=0,h=0,m=0;for(let P=0;P<r;P++){const I=u-(r-1-P),A=n[I];Number.isFinite(A)&&(d+=A,h+=A*P,m+=1)}if(m<2){o[u]=NaN;continue}const g=(r*h-l*d)/f,w=(d-g*l)/r,C=r-1+a;o[u]=w+g*C}return o}function e8(n,e){var f;const t=e.funcRuntime;if(t){const u=t.funcs.get(n.callee.toLowerCase());if(u){const d=e.length,h=new Float32Array(d),m={series:e.series,scalars:e.scalars,strings:e.strings,diagnostics:e.diagnostics,draw:e.draw,strategy:e.strategy,loopRuntime:e.loopRuntime,funcRuntime:e.funcRuntime,length:d,index:0};for(let g=0;g<d;g++)m.index=g,h[g]=n8(u,n,m);return{kind:"series",value:h}}}const s=((f=e.scalars)==null?void 0:f.__pinev2)===1,o=i6(n.callee.toLowerCase(),s),r=o6(o);if(r){if(!e.draw)return{kind:"scalar",value:NaN};const u=n.args[0];let d="";if(u&&u.kind==="Identifier"&&(d=u.name),u&&u.kind==="StringLiteral"&&(d=u.value),!d)return{kind:"scalar",value:NaN};const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++){const w=e.draw.get(r.kind,r.prop,d,g);typeof w=="string"?m[g]=vv(w):typeof w=="number"&&Number.isFinite(w)?m[g]=w:m[g]=NaN}return{kind:"series",value:m}}const a=n.args.map(u=>s0(u,e)),l=s8(o);if(l){if(!e.strategy)return{kind:"scalar",value:NaN};if(!a.length)throw new Tt(`${n.callee} expects (index)`);const u=eo(a[0],e),d=e.length,h=new Float32Array(d);for(let m=0;m<d;m++){const g=u[m],w=Number.isFinite(g)?Math.floor(g):NaN;if(!Number.isFinite(w)){h[m]=NaN;continue}h[m]=o8(e,l.kind,l.prop,m,w)}return{kind:"series",value:h}}const c=()=>{if(a.length!==2)throw new Tt(`${o} expects (series, period)`);const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1])));return[u,d]};switch(o){case"__hist_index":case"__arr_index":{if(a.length!==1)throw new Tt(`${n.callee} expects (index)`);const u=a[0];if(!s)return u;const d=o==="__hist_index"?"history_index":"array_index",h=o==="__hist_index"?ay:CS;if(u.kind==="scalar")return{kind:"scalar",value:Z0(u.value,d,h,e)};const m=eo(u,e),g=new Float32Array(e.length);for(let w=0;w<g.length;w++)g[w]=Z0(m[w],d,h,e);return{kind:"series",value:g}}case"__arr_index_str":{if(a.length!==1)throw new Tt(`${n.callee} expects (index)`);const u=a[0];if(!s)return u;const d=`arr_idx_str:${Fd(n)}`;if(u.kind==="scalar")return{kind:"scalar",value:h2(u.value,d,e)};const h=eo(u,e),m=new Float32Array(e.length);for(let g=0;g<m.length;g++)m[g]=h2(h[g],d,e);return{kind:"series",value:m}}case"__arr_set_guard":{if(a.length!==2)throw new Tt(`${n.callee} expects (index, size)`);if(!s)return{kind:"scalar",value:1};const u=a[0],d=a[1],h=`arr_set_guard:${Fd(n)}`;if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:hw(u.value,d.value,h,e)};const m=eo(u,e),g=eo(d,e),w=new Float32Array(e.length);for(let C=0;C<w.length;C++)w[C]=hw(m[C],g[C],h,e);return{kind:"series",value:w}}case"__arr_str_valid":{if(a.length!==1)throw new Tt(`${n.callee} expects (value)`);if(!s)return{kind:"scalar",value:1};const u=o0(n.args[0]);return u||Ld(e,`arr_str_val:${Fd(n)}`,IS),{kind:"scalar",value:u?1:0}}case"__str_num":{if(a.length!==1)throw new Tt(`${n.callee} expects (value)`);return a[0]}case"iff":case"iif":case"if":{if(a.length!==3)throw new Tt(`${n.callee} expects (cond, a, b)`);const u=a[0],d=a[1],h=a[2],m=n.args[0];if(s){const L=i1(n.args[1]),O=i1(n.args[2]);if(L!==O){if(Ld(e,"ternary_type",SS),u.kind==="scalar"&&d.kind==="scalar"&&h.kind==="scalar")return{kind:"scalar",value:NaN};const Y=new Float32Array(e.length);return Y.fill(NaN),{kind:"series",value:Y}}}const g=s&&o0(m),w=s?Q0(m,e,"na"):void 0;g&&Ld(e,Q0(m,e,"type"),p2);const C=u.kind==="series",P=d.kind==="series",I=h.kind==="series";if(!C&&!P&&!I){const L=u.value;return g?{kind:"scalar",value:h.value}:{kind:"scalar",value:pw(L,e,w)?d.value:h.value}}const A=eo(u,e),M=eo(d,e),F=eo(h,e),B=e.length,$=new Float32Array(B);for(let L=0;L<B;L++){if(g){$[L]=F[L];continue}const O=A[L],Y=pw(O,e,w);$[L]=Y?M[L]:F[L]}return{kind:"series",value:$}}case"nz":{if(a.length<1||a.length>2)throw new Tt("nz expects (series[, fallback])");const u=a[0],d=a[1]??{kind:"scalar",value:0};if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Number.isFinite(u.value)?u.value:d.value};const h=eo(u,e),m=eo(d,e),g=e.length,w=new Float32Array(g);for(let C=0;C<g;C++){const P=h[C];w[C]=Number.isFinite(P)?P:m[C]}return{kind:"series",value:w}}case"between":{if(a.length!==3)throw new Tt("between expects (x, a, b)");const u=eo(a[0],e),d=eo(a[1],e),h=eo(a[2],e),m=e.length,g=new Float32Array(m);for(let w=0;w<m;w++){const C=u[w],P=d[w],I=h[w];if(!Number.isFinite(C)||!Number.isFinite(P)||!Number.isFinite(I)){g[w]=s?NaN:0;continue}const A=Math.min(P,I),M=Math.max(P,I);g[w]=C>=A&&C<=M?1:0}return{kind:"series",value:g}}case"above":case"below":{if(a.length<2||a.length>3)throw new Tt(`${o} expects (a, b[, tol])`);const u=eo(a[0],e),d=eo(a[1],e),h=a[2]?eo(a[2],e):null,m=e.length,g=new Float32Array(m);for(let w=0;w<m;w++){const C=u[w],P=d[w],I=h?h[w]:0,A=Number.isFinite(I)?Math.max(0,I):0;if(!Number.isFinite(C)||!Number.isFinite(P)){g[w]=s?NaN:0;continue}g[w]=o==="above"?C>P+A?1:0:C<P-A?1:0}return{kind:"series",value:g}}case"higherhigh":{const u=a.length?Math.max(1,Math.floor(yi(a[0]))):1,d=e.series.high;if(!d)throw new Tt("higherhigh requires high series");const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++){const w=d[g];if(!Number.isFinite(w)){m[g]=s?NaN:0;continue}const C=Math.max(0,g-u),P=fS(d,C,Math.max(0,g-1));m[g]=w>P?1:0}return{kind:"series",value:m}}case"lowerlow":{const u=a.length?Math.max(1,Math.floor(yi(a[0]))):1,d=e.series.low;if(!d)throw new Tt("lowerlow requires low series");const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++){const w=d[g];if(!Number.isFinite(w)){m[g]=s?NaN:0;continue}const C=Math.max(0,g-u),P=pS(d,C,Math.max(0,g-1));m[g]=w<P?1:0}return{kind:"series",value:m}}case"swinghigh":{const u=a.length?Math.max(1,Math.floor(yi(a[0]))):3,d=e.series.high;if(!d)throw new Tt("swinghigh requires high series");const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++){const w=d[g];if(!Number.isFinite(w)){m[g]=s?NaN:0;continue}let C=!0;for(let P=g-u;P<=g+u;P++){if(P===g||P<0||P>=h)continue;const I=d[P];if(Number.isFinite(I)&&I>=w){C=!1;break}}m[g]=C?1:0}return{kind:"series",value:m}}case"swinglow":{const u=a.length?Math.max(1,Math.floor(yi(a[0]))):3,d=e.series.low;if(!d)throw new Tt("swinglow requires low series");const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++){const w=d[g];if(!Number.isFinite(w)){m[g]=s?NaN:0;continue}let C=!0;for(let P=g-u;P<=g+u;P++){if(P===g||P<0||P>=h)continue;const I=d[P];if(Number.isFinite(I)&&I<=w){C=!1;break}}m[g]=C?1:0}return{kind:"series",value:m}}case"volspike":{const u=a.length?Math.max(1,yi(a[0])):1,d=e.series.volume;if(!d)throw new Tt("volspike requires volume series");const h=e.length,m=new Float32Array(h),g=20;for(let w=0;w<h;w++){const C=d[w];if(!Number.isFinite(C)){m[w]=s?NaN:0;continue}const P=Math.max(0,w-g+1);let I=0,A=0;for(let F=P;F<=w;F++){const B=d[F];Number.isFinite(B)&&(I+=B,A+=1)}const M=A?I/A:NaN;m[w]=Number.isFinite(M)&&C>u*M?1:0}return{kind:"series",value:m}}case"atrspike":{const u=a.length?Math.max(1,yi(a[0])):1,d=e.series.high,h=e.series.low,m=e.series.close;if(!d||!h||!m)throw new Tt("atrspike requires high/low/close series");const g=e.length,w=new Float32Array(g),C=14,P=I=>{const A=d[I],M=h[I],F=I>0?m[I-1]:NaN;let B=Number.isFinite(A)&&Number.isFinite(M)?Math.max(0,A-M):NaN;return Number.isFinite(F)&&(B=Math.max(B,Math.abs(A-F),Math.abs(M-F))),B};for(let I=0;I<g;I++){let A=NaN,M=0;for(let L=0;L<=I;L++){const O=P(L);M+=Number.isFinite(O)?O:0,L===C-1?A=M/C:L>=C&&(A=(A*(C-1)+O)/C)}let F=NaN,B=0,$=0;for(let L=Math.max(0,I-C+1);L<=I;L++){const O=P(L);Number.isFinite(O)&&(B+=O,$+=1)}$&&(F=B/$),w[I]=Number.isFinite(A)&&Number.isFinite(F)&&A>u*F?1:0}return{kind:"series",value:w}}case"trend":{const u=n.args[0],d=u&&u.kind==="StringLiteral"?u.value:u&&u.kind==="Identifier"?u.name:"",h=String(d||"").toLowerCase()||"up",m=e.series.close;if(!m)throw new Tt("trend requires close series");const g=e.length,w=new Float32Array(g),C=10;for(let P=0;P<g;P++){const I=Math.max(0,P-C+1);let A=0,M=0,F=0,B=0,$=0;for(let Y=I;Y<=P;Y++){const ce=Y-I,Q=m[Y];Number.isFinite(Q)&&(A+=ce,M+=Q,F+=ce*ce,B+=ce*Q,$+=1)}const L=$*F-A*A,O=L===0||$===0?0:($*B-A*M)/L;w[P]=h==="up"?O>0?1:0:O<0?1:0}return{kind:"series",value:w}}case"add":case"sub":case"mul":case"div":{if(a.length!==2)throw new Tt(`${o} expects 2 arguments`);const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar"){const C=u.value,P=d.value;return o==="add"?{kind:"scalar",value:C+P}:o==="sub"?{kind:"scalar",value:C-P}:o==="mul"?{kind:"scalar",value:C*P}:{kind:"scalar",value:w_(C,P,s,e)}}const h=eo(u,e),m=eo(d,e),g=e.length,w=new Float32Array(g);for(let C=0;C<g;C++){const P=h[C],I=m[C];o==="add"?w[C]=P+I:o==="sub"?w[C]=P-I:o==="mul"?w[C]=P*I:w[C]=w_(P,I,s,e)}return{kind:"series",value:w}}case"mod":case"fmod":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==2)throw new Tt(`${n.callee} expects 2 arguments`);const u=a[0],d=a[1],h=o==="mod"?VS:zS;if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:h(u.value,d.value,!0,e)};const m=eo(u,e),g=eo(d,e);return{kind:"series",value:_b(m,g,(w,C)=>h(w,C,!0,e))}}case"pow":{if(a.length!==2)throw new Tt("pow expects 2 arguments");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:mw(u.value,d.value,s,e)};const h=eo(u,e),m=eo(d,e);return{kind:"series",value:_b(h,m,(g,w)=>mw(g,w,s,e))}}case"sqrt":case"log":case"ln":case"log10":case"exp":case"floor":case"ceil":case"round":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"sign":{if(a.length!==1)throw new Tt(`${o} expects 1 argument`);const u=o==="sqrt"?h=>WS(h,s,e):o==="log"||o==="ln"?h=>HS(h,s,e):o==="log10"?h=>qS(h,s,e):o==="exp"?h=>KS(h,s):o==="floor"?Math.floor:o==="ceil"?Math.ceil:o==="round"?Math.round:o==="sin"?Math.sin:o==="cos"?Math.cos:o==="tan"?h=>YS(h,s):o==="asin"?h=>US(h,s,e):o==="acos"?h=>GS(h,s,e):o==="atan"?Math.atan:Math.sign,d=a[0];return d.kind==="scalar"?{kind:"scalar",value:u(d.value)}:{kind:"series",value:z1(eo(d,e),u)}}case"todegrees":case"toradians":{if(a.length!==1)throw new Tt(`${o} expects 1 argument`);const u=a[0],d=o==="todegrees"?180/Math.PI:Math.PI/180;return u.kind==="scalar"?{kind:"scalar",value:u.value*d}:{kind:"series",value:z1(eo(u,e),h=>h*d)}}case"atan2":{if(a.length!==2)throw new Tt("atan2 expects (y, x)");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Math.atan2(u.value,d.value)};const h=eo(u,e),m=eo(d,e);return{kind:"series",value:_b(h,m,(g,w)=>Math.atan2(g,w))}}case"avg":{if(a.length!==2)throw new Tt("avg expects (a, b)");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:(u.value+d.value)/2};const h=eo(u,e),m=eo(d,e);return{kind:"series",value:_b(h,m,(g,w)=>(g+w)/2)}}case"clamp":{if(a.length!==3)throw new Tt("clamp expects (x, min, max)");const u=a[0],d=a[1],h=a[2],m=(A,M,F)=>Math.min(F,Math.max(M,A));if(u.kind==="scalar"&&d.kind==="scalar"&&h.kind==="scalar")return{kind:"scalar",value:m(u.value,d.value,h.value)};const g=eo(u,e),w=eo(d,e),C=eo(h,e),P=e.length,I=new Float32Array(P);for(let A=0;A<P;A++)I[A]=m(g[A],w[A],C[A]);return{kind:"series",value:I}}case"cum":case"cumsum":{if(a.length!==1)throw new Tt(`${o} expects 1 argument`);const u=eo(a[0],e),d=e.length,h=new Float32Array(d);let m=0;for(let g=0;g<d;g++){const w=u[g];Number.isFinite(w)&&(m+=w),h[g]=m}return{kind:"series",value:h}}case"barssince":{if(a.length!==1)throw new Tt("barssince expects (condition)");const u=eo(a[0],e),d=e.length,h=new Float32Array(d);let m=NaN;for(let g=0;g<d;g++){const w=u[g];Number.isFinite(w)&&w!==0?(m=0,h[g]=0):Number.isFinite(m)?(m+=1,h[g]=m):h[g]=NaN}return{kind:"series",value:h}}case"sma":{const[u,d]=c();return{kind:"series",value:hv(u,d)}}case"wma":{const[u,d]=c();return{kind:"series",value:Ub(u,d)}}case"ema":{const[u,d]=c();return{kind:"series",value:gm(u,d)}}case"smma":{const[u,d]=c();return{kind:"series",value:H_(u,d)}}case"rsi":{const[u,d]=c();return{kind:"series",value:ZS(u,d)}}case"rma":{const[u,d]=c();return{kind:"series",value:H_(u,d)}}case"dema":{const[u,d]=c();return{kind:"series",value:cD(u,d)}}case"tema":{const[u,d]=c();return{kind:"series",value:uD(u,d)}}case"trima":{const[u,d]=c();return{kind:"series",value:dD(u,d)}}case"swma":{const[u,d]=c();return{kind:"series",value:fD(u,d)}}case"hma":{const[u,d]=c();return{kind:"series",value:pD(u,d)}}case"kama":{if(a.length<2||a.length>4)throw new Tt("kama expects (series, period[, fast, slow])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]))),h=a[2]?Math.max(1,Math.floor(yi(a[2]))):2,m=a[3]?Math.max(1,Math.floor(yi(a[3]))):30;return{kind:"series",value:mD(u,d,h,m)}}case"alma":{if(a.length<2||a.length>4)throw new Tt("alma expects (series, period[, offset, sigma])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]))),h=a[2]?yi(a[2]):.85,m=a[3]?Math.max(.1,yi(a[3])):6;return{kind:"series",value:hD(u,d,h,m)}}case"t3":{if(a.length<2||a.length>3)throw new Tt("t3 expects (series, period[, factor])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]))),h=a[2]?yi(a[2]):.7;return{kind:"series",value:vD(u,d,h)}}case"cmo":{const[u,d]=c();return{kind:"series",value:_D(u,d)}}case"tsi":{if(a.length!==3)throw new Tt("tsi expects (series, long, short)");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]))),h=Math.max(1,Math.floor(yi(a[2])));return{kind:"series",value:yD(u,d,h)}}case"stochrsi":{if(a.length<2||a.length>4)throw new Tt("stochrsi expects (series, length[, smoothK, smoothD])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]))),h=a[2]?Math.max(1,Math.floor(yi(a[2]))):0,m=a[3]?Math.max(1,Math.floor(yi(a[3]))):0;return{kind:"series",value:bD(u,d,h||void 0,m||void 0)}}case"ppo":{if(a.length!==3)throw new Tt("ppo expects (series, fast, slow)");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]))),h=Math.max(1,Math.floor(yi(a[2])));return{kind:"series",value:xD(u,d,h)}}case"cog":{if(a.length!==1&&a.length!==2)throw new Tt("cog expects (length) or (series, length)");const u=a.length===1?e.series.close:eo(a[0],e);if(!u)throw new Tt("cog requires a source series");const d=Math.max(1,Math.floor(yi(a[a.length===1?0:1])));return{kind:"series",value:xg(e,`cog:${d}:${Fd(n)}`,()=>TD(u,d))}}case"bbw":{if(a.length!==2&&a.length!==3)throw new Tt("bbw expects (length, mult) or (series, length, mult)");const u=a.length===2?e.series.close:eo(a[0],e);if(!u)throw new Tt("bbw requires a source series");const d=Math.max(1,Math.floor(yi(a[a.length===2?0:1]))),h=yi(a[a.length===2?1:2]);return{kind:"series",value:xg(e,`bbw:${d}:${Fd(n)}`,()=>$D(u,d,h))}}case"uo":{if(a.length!==3&&a.length!==6)throw new Tt("uo expects (len1, len2, len3) or (high, low, close, len1, len2, len3)");const u=a.length===6?eo(a[0],e):e.series.high,d=a.length===6?eo(a[1],e):e.series.low,h=a.length===6?eo(a[2],e):e.series.close;if(!u||!d||!h)throw new Tt("uo requires high/low/close series");const m=Math.max(1,Math.floor(yi(a[a.length===6?3:0]))),g=Math.max(1,Math.floor(yi(a[a.length===6?4:1]))),w=Math.max(1,Math.floor(yi(a[a.length===6?5:2])));return{kind:"series",value:xg(e,`uo:${m}:${g}:${w}:${Fd(n)}`,()=>ED(u,d,h,m,g,w))}}case"pvi":case"nvi":{if(a.length!==0&&a.length!==2&&a.length!==3)throw new Tt(`${n.callee} expects () or (close, volume[, start])`);const u=a.length?eo(a[0],e):e.series.close,d=a.length?eo(a[1],e):e.series.volume,h=a.length===3?yi(a[2]):1e3;if(!u||!d)throw new Tt(`${n.callee} requires close/volume series`);const m=`${o}:${Fd(n)}`;return{kind:"series",value:xg(e,m,()=>o==="pvi"?DD(u,d,h):RD(u,d,h))}}case"kdj":{const u=a.length===6||a.length===7,d=a.length===3||a.length===4;if(!u&&!d)throw new Tt("kdj expects (len, smoothK, smoothD[, output]) or (high, low, close, len, smoothK, smoothD[, output])");const h=u,m=h?eo(a[0],e):e.series.high,g=h?eo(a[1],e):e.series.low,w=h?eo(a[2],e):e.series.close;if(!m||!g||!w)throw new Tt("kdj requires high/low/close series");const C=h?3:0,P=Math.max(1,Math.floor(yi(a[C+0]))),I=Math.max(1,Math.floor(yi(a[C+1]))),A=Math.max(1,Math.floor(yi(a[C+2]))),M=a[C+3]?Math.floor(yi(a[C+3])):0;if(!Number.isFinite(M)||M<0||M>2)throw new Tt("kdj output must be 0, 1, or 2");const F=`kdj:${P}:${I}:${A}:${Fd(n)}`,B=Gb(e,F,()=>{const L=FD(m,g,w,P,I,A);return{a:L.k,b:L.d,c:L.j}});return{kind:"series",value:M===0?B.a:M===1?B.b:B.c}}case"kst":{if(a.length<9||a.length>11)throw new Tt("kst expects (src, r1, r2, r3, r4, n1, n2, n3, n4[, signal, output])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]))),h=Math.max(1,Math.floor(yi(a[2]))),m=Math.max(1,Math.floor(yi(a[3]))),g=Math.max(1,Math.floor(yi(a[4]))),w=Math.max(1,Math.floor(yi(a[5]))),C=Math.max(1,Math.floor(yi(a[6]))),P=Math.max(1,Math.floor(yi(a[7]))),I=Math.max(1,Math.floor(yi(a[8]))),A=a[9]?Math.max(1,Math.floor(yi(a[9]))):9,M=a[10]?Math.floor(yi(a[10])):0;if(!Number.isFinite(M)||M<0||M>1)throw new Tt("kst output must be 0 or 1");const F=`kst:${d}:${h}:${m}:${g}:${w}:${C}:${P}:${I}:${A}:${Fd(n)}`,B=v2(e,F,()=>{const $=LD(u,d,h,m,g,w,C,P,I,A);return{a:$.kst,b:$.signal}});return{kind:"series",value:M===0?B.a:B.b}}case"vortex":{const u=a.length===4||a.length===5,d=a.length===1||a.length===2;if(!u&&!d)throw new Tt("vortex expects (length[, output]) or (high, low, close, length[, output])");const h=u,m=h?eo(a[0],e):e.series.high,g=h?eo(a[1],e):e.series.low,w=h?eo(a[2],e):e.series.close;if(!m||!g||!w)throw new Tt("vortex requires high/low/close series");const C=h?3:0,P=Math.max(1,Math.floor(yi(a[C]))),I=a[C+1]?Math.floor(yi(a[C+1])):0;if(!Number.isFinite(I)||I<0||I>1)throw new Tt("vortex output must be 0 or 1");const A=`vortex:${P}:${Fd(n)}`,M=v2(e,A,()=>{const F=jD(m,g,w,P);return{a:F.plus,b:F.minus}});return{kind:"series",value:I===0?M.a:M.b}}case"linreg":{if(a.length<2||a.length>3)throw new Tt("linreg expects (series, period[, offset])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]))),h=a[2]?Math.floor(yi(a[2])):0;return{kind:"series",value:zD(u,d,h)}}case"tr":case"trange":case"true_range":{if(a.length!==0&&a.length!==3)throw new Tt("tr expects () or (high, low, close)");const u=a.length===3?eo(a[0],e):e.series.high,d=a.length===3?eo(a[1],e):e.series.low,h=a.length===3?eo(a[2],e):e.series.close;if(!u||!d||!h)throw new Tt("tr requires high/low/close series");const m=e.length,g=new Float32Array(m);let w=NaN;for(let C=0;C<m;C++){const P=u[C],I=d[C],A=h[C];let M=Math.max(0,P-I);Number.isFinite(w)&&(M=Math.max(M,Math.abs(P-w),Math.abs(I-w))),g[C]=M,w=A}return{kind:"series",value:g}}case"atr":{if(a.length!==1&&a.length!==4)throw new Tt("atr expects (length) or (high, low, close, length)");const u=yi(a[a.length===1?0:3]),d=s?Kp(u,`atr_len:${Fd(n)}`,nD,e):Math.max(1,Math.floor(u));if(!Number.isFinite(d))return{kind:"series",value:Hv(e.length)};const h=a.length===1?e.series.high:eo(a[0],e),m=a.length===1?e.series.low:eo(a[1],e),g=a.length===1?e.series.close:eo(a[2],e);if(!h||!m||!g)throw new Tt("atr requires high/low/close series");const w=e.length,C=e6(h,m,g),P=new Float32Array(w);let I=0;for(let A=0;A<w;A++)I+=C[A],A===d-1?P[A]=I/d:A>=d?P[A]=(P[A-1]*(d-1)+C[A])/d:P[A]=NaN;return{kind:"series",value:P}}case"atrp":case"natr":{if(a.length!==1&&a.length!==4)throw new Tt(`${n.callee} expects (length) or (high, low, close, length)`);const u=yi(a[a.length===1?0:3]),d=Math.max(1,Math.floor(u));if(!Number.isFinite(d))return{kind:"series",value:Hv(e.length)};const h=a.length===1?e.series.high:eo(a[0],e),m=a.length===1?e.series.low:eo(a[1],e),g=a.length===1?e.series.close:eo(a[2],e);if(!h||!m||!g)throw new Tt(`${n.callee} requires high/low/close series`);return{kind:"series",value:gD(h,m,g,d)}}case"stdev":case"stddev":case"dev":{const[u,d]=c();return{kind:"series",value:t6(u,d)}}case"variance":case"var":{const[u,d]=c();return{kind:"series",value:BD(u,d)}}case"zscore":{const[u,d]=c();return{kind:"series",value:SD(u,d)}}case"correlation":case"corr":{if(a.length!==3)throw new Tt(`${n.callee} expects (a, b, period)`);const u=eo(a[0],e),d=eo(a[1],e),h=Math.max(1,Math.floor(yi(a[2])));return{kind:"series",value:OD(u,d,h)}}case"highest":{if(!s){const[m,g]=c();return{kind:"series",value:r1(m,g)}}if(a.length!==2)throw new Tt("highest expects (series, period)");const u=eo(a[0],e),d=yi(a[1]),h=Kp(d,`highest_len:${Fd(n)}`,DS,e);return Number.isFinite(h)?{kind:"series",value:r1(u,h)}:{kind:"series",value:Hv(e.length)}}case"highestbars":{const[u,d]=c();return{kind:"series",value:JS(u,d)}}case"lowest":{if(!s){const[m,g]=c();return{kind:"series",value:a1(m,g)}}if(a.length!==2)throw new Tt("lowest expects (series, period)");const u=eo(a[0],e),d=yi(a[1]),h=Kp(d,`lowest_len:${Fd(n)}`,RS,e);return Number.isFinite(h)?{kind:"series",value:a1(u,h)}:{kind:"series",value:Hv(e.length)}}case"lowestbars":{const[u,d]=c();return{kind:"series",value:QS(u,d)}}case"sum":{if(!s){const[m,g]=c();return{kind:"series",value:Kv(m,g)}}if(a.length!==2)throw new Tt("sum expects (series, period)");const u=eo(a[0],e),d=yi(a[1]),h=Kp(d,`sum_len:${Fd(n)}`,jS,e);if(!Number.isFinite(h)){const m=new Float32Array(e.length);return m.fill(NaN),{kind:"series",value:m}}return{kind:"series",value:Kv(u,h)}}case"rising":case"falling":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==2)throw new Tt(`${n.callee} expects (series, length)`);const u=eo(a[0],e),d=yi(a[1]),h=`${o}_len:${Fd(n)}`,g=Kp(d,h,o==="rising"?BS:OS,e);if(!Number.isFinite(g)){const w=new Float32Array(e.length);return w.fill(NaN),{kind:"series",value:w}}return{kind:"series",value:dS(u,g,o)}}case"lag":{if(a.length!==2)throw new Tt("lag expects (series, n)");const u=eo(a[0],e),d=yi(a[1]);if(s){const m=Z0(d,"history_index",ay,e);if(!Number.isFinite(m)){const g=new Float32Array(e.length);return g.fill(NaN),{kind:"series",value:g}}return{kind:"series",value:bb(u,m)}}const h=Math.max(1,Math.floor(d));return{kind:"series",value:bb(u,h)}}case"prev":{if(a.length<1||a.length>2)throw new Tt("prev expects (series[, n])");const u=eo(a[0],e),d=yi(a[1]??{kind:"scalar",value:1});if(s){const m=Z0(d,"history_index",ay,e);if(!Number.isFinite(m)){const g=new Float32Array(e.length);return g.fill(NaN),{kind:"series",value:g}}return{kind:"series",value:bb(u,m)}}const h=Math.max(1,Math.floor(d));return{kind:"series",value:bb(u,h)}}case"change":{if(a.length<1||a.length>2)throw new Tt("change expects (series[, n])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]??{kind:"scalar",value:1})));return{kind:"series",value:W$(u,d)}}case"roc":{if(a.length<1||a.length>2)throw new Tt("roc expects (series[, n])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]??{kind:"scalar",value:1})));return{kind:"series",value:X1(u,d)}}case"mom":case"momentum":{if(a.length<1||a.length>2)throw new Tt("mom expects (series[, n])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]??{kind:"scalar",value:1})));return{kind:"series",value:H$(u,d)}}case"crossover":case"crossunder":{if(a.length<2||a.length>3)throw new Tt(`${n.callee} expects (series, series[, tol])`);const u=eo(a[0],e),d=a[1],h=d.kind==="series",m=eo(d,e),g=a[2]?Math.max(0,yi(a[2])):0,w=e.length,C=new Float32Array(w);C[0]=0;for(let P=1;P<w;P++){const I=u[P-1],A=u[P],M=h?m[P-1]:m[0],F=h?m[P]:m[0];if(![I,A,M,F].every(Number.isFinite)){C[P]=0;continue}o==="crossover"?C[P]=I<=M+g&&A>F+g?1:0:C[P]=I>=M-g&&A<F-g?1:0}return{kind:"series",value:C}}case"hl2":{if(a.length!==0)throw new Tt("hl2 expects no arguments");const u=e.series.high,d=e.series.low;if(!u||!d)throw new Tt("hl2 requires high/low series");const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++)m[g]=(u[g]+d[g])/2;return{kind:"series",value:m}}case"hlc3":{if(a.length!==0)throw new Tt("hlc3 expects no arguments");const u=e.series.high,d=e.series.low,h=e.series.close;if(!u||!d||!h)throw new Tt("hlc3 requires high/low/close series");const m=e.length,g=new Float32Array(m);for(let w=0;w<m;w++)g[w]=(u[w]+d[w]+h[w])/3;return{kind:"series",value:g}}case"ohlc4":{if(a.length!==0)throw new Tt("ohlc4 expects no arguments");const u=e.series.open,d=e.series.high,h=e.series.low,m=e.series.close;if(!u||!d||!h||!m)throw new Tt("ohlc4 requires open/high/low/close series");const g=e.length,w=new Float32Array(g);for(let C=0;C<g;C++)w[C]=(u[C]+d[C]+h[C]+m[C])/4;return{kind:"series",value:w}}case"vwap":{if(a.length!==0&&a.length!==2)throw new Tt("vwap expects () or (close, volume)");const u=a.length===0?e.series.close:eo(a[0],e),d=a.length===0?e.series.volume:eo(a[1],e);if(!u||!d)throw new Tt("vwap requires close/volume series");const h=a.length===0?e.series.high:void 0,m=a.length===0?e.series.low:void 0,g=a.length===0?e.series.time:void 0;if(a.length===0&&(!h||!m))throw new Tt("vwap requires high/low/close series");const w=e.length,C=new Float32Array(w);let P=0,I=0,A=Number.NaN;for(let M=0;M<w;M++){if(a.length===0&&g){const $=g[M];if(Number.isFinite($)){const L=Math.floor($/864e5);(!Number.isFinite(A)||L!==A)&&(P=0,I=0,A=L)}}const F=d[M],B=a.length===0?(h[M]+m[M]+u[M])/3:u[M];if(!Number.isFinite(B)||!Number.isFinite(F)){C[M]=NaN;continue}P+=B*F,I+=F,C[M]=I===0?NaN:P/I}return{kind:"series",value:C}}case"vwma":{if(a.length!==3)throw new Tt("vwma expects (close, volume, period)");const u=eo(a[0],e),d=eo(a[1],e),h=Math.max(1,Math.floor(yi(a[2]))),m=e.length,g=new Float32Array(m);let w=0,C=0;for(let P=0;P<m;P++){const I=u[P],A=d[P];if(Number.isFinite(I)&&Number.isFinite(A)&&(w+=I*A,C+=A),P>=h){const M=u[P-h],F=d[P-h];Number.isFinite(M)&&Number.isFinite(F)&&(w-=M*F,C-=F)}g[P]=P>=h-1&&C!==0?w/C:NaN}return{kind:"series",value:g}}case"evwma":{if(a.length!==3)throw new Tt("evwma expects (close, volume, period)");const u=eo(a[0],e),d=eo(a[1],e),h=Math.max(1,Math.floor(yi(a[2]))),m=uS(yg(u),yg(d),h);return{kind:"series",value:g0(m)}}case"bbands":case"bollinger":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length<3||a.length>4)throw new Tt("bbands expects (series, period, mult[, output])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]))),h=yi(a[2]),m=a[3]?Math.floor(yi(a[3])):0;if(!Number.isFinite(m)||m<0||m>2)throw new Tt("bbands output must be 0, 1, or 2");const g=iw(yg(u),d,h),w=m===0?g.mid:m===1?g.upper:g.lower;return{kind:"series",value:g0(w)}}case"keltner":case"kc":{if(a.length<2||a.length>6)throw new Tt("keltner expects (period, mult[, output]) or (high, low, close, period, mult[, output])");let u,d,h,m=0,g=1,w=2;if(a.length>=5?(u=eo(a[0],e),d=eo(a[1],e),h=eo(a[2],e),m=3,g=4,w=5):(u=e.series.high,d=e.series.low,h=e.series.close),!u||!d||!h)throw new Tt("keltner requires high/low/close series");const C=Math.max(1,Math.floor(yi(a[m]))),P=yi(a[g]),I=a[w]?Math.floor(yi(a[w])):0;if(!Number.isFinite(I)||I<0||I>2)throw new Tt("keltner output must be 0, 1, or 2");const A=MD(u,d,h,C,P);return{kind:"series",value:I===0?A.mid:I===1?A.upper:A.lower}}case"donchian":{if(a.length<1||a.length>4)throw new Tt("donchian expects (period[, output]) or (high, low, period[, output])");let u,d,h=0,m=1;if(a.length>=3?(u=eo(a[0],e),d=eo(a[1],e),h=2,m=3):(u=e.series.high,d=e.series.low),!u||!d)throw new Tt("donchian requires high/low series");const g=Math.max(1,Math.floor(yi(a[h]))),w=a[m]?Math.floor(yi(a[m])):0;if(!Number.isFinite(w)||w<0||w>2)throw new Tt("donchian output must be 0, 1, or 2");const C=ND(u,d,g);return{kind:"series",value:w===0?C.upper:w===1?C.lower:C.mid}}case"supertrend":{if(a.length<2||a.length>3)throw new Tt("supertrend expects (factor, period[, output])");const u=yi(a[0]),d=Math.max(1,Math.floor(yi(a[1]))),h=a[2]?Math.floor(yi(a[2])):0;if(!Number.isFinite(h)||h<0||h>1)throw new Tt("supertrend output must be 0 or 1");const m=e.series.high,g=e.series.low,w=e.series.close;if(!m||!g||!w)throw new Tt("supertrend requires high/low/close series");const C=PD(m,g,w,d,u);return{kind:"series",value:h===0?C.line:C.dir}}case"sar":{if(a.length!==0&&a.length!==3)throw new Tt("sar expects () or (start, increment, maximum)");const u=a.length===3?yi(a[0]):.02,d=a.length===3?yi(a[1]):.02,h=a.length===3?yi(a[2]):.2,m=e.series.high,g=e.series.low;if(!m||!g)throw new Tt("sar requires high/low series");return{kind:"series",value:AD(m,g,u,d,h)}}case"macd":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length<4||a.length>5)throw new Tt("macd expects (series, fast, slow, signal[, output])");const u=eo(a[0],e),d=Math.max(1,Math.floor(yi(a[1]))),h=Math.max(1,Math.floor(yi(a[2]))),m=Math.max(1,Math.floor(yi(a[3]))),g=a[4]?Math.floor(yi(a[4])):0;if(!Number.isFinite(g)||g<0||g>2)throw new Tt("macd output must be 0, 1, or 2");const w=q$(u,d,h,m);return{kind:"series",value:g===0?w.line:g===1?w.signal:w.hist}}case"stoch":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length<5||a.length>6)throw new Tt("stoch expects (high, low, close, k, d[, output])");const u=eo(a[0],e),d=eo(a[1],e),h=eo(a[2],e),m=Math.max(1,Math.floor(yi(a[3]))),g=Math.max(1,Math.floor(yi(a[4]))),w=a[5]?Math.floor(yi(a[5])):0;if(!Number.isFinite(w)||w<0||w>1)throw new Tt("stoch output must be 0 or 1");const C=U$(u,d,h,m,g);return{kind:"series",value:w===0?C.k:C.d}}case"ao":{if(a.length!==0&&a.length!==2)throw new Tt("ao expects () or (high, low)");const u=a.length===2?eo(a[0],e):e.series.high,d=a.length===2?eo(a[1],e):e.series.low;if(!u||!d)throw new Tt("ao requires high/low series");return{kind:"series",value:wD(u,d)}}case"trix":{const[u,d]=c();return{kind:"series",value:kD(u,d)}}case"williamsr":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==1&&a.length!==4)throw new Tt("williamsr expects (length) or (high, low, close, length)");const u=a.length===1?yi(a[0]):yi(a[3]),d=Kp(u,"williamsr_len",PS,e);if(!Number.isFinite(d))return{kind:"series",value:Hv(e.length)};const h=a.length===1?e.series.high:eo(a[0],e),m=a.length===1?e.series.low:eo(a[1],e),g=a.length===1?e.series.close:eo(a[2],e);if(!h||!m||!g)throw new Tt("williamsr requires high/low/close series");return{kind:"series",value:mS(h,m,g,d)}}case"aroon":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length<1||a.length>2)throw new Tt("aroon expects (length[, output])");const u=yi(a[0]),d=Kp(u,"aroon_len",MS,e);if(!Number.isFinite(d))return{kind:"series",value:Hv(e.length)};const h=a[1]?Math.floor(yi(a[1])):0;if(!Number.isFinite(h)||h<0||h>1)throw new Tt("aroon output must be 0 or 1");const m=e.series.high,g=e.series.low;if(!m||!g)throw new Tt("aroon requires high/low series");const w=d2(m,g,d);return{kind:"series",value:h===0?w.up:w.down}}case"aroonosc":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new Tt("aroonosc expects (length)");const u=yi(a[0]),d=Kp(u,"aroonosc_len",$S,e);if(!Number.isFinite(d))return{kind:"series",value:Hv(e.length)};const h=e.series.high,m=e.series.low;if(!h||!m)throw new Tt("aroonosc requires high/low series");return{kind:"series",value:G$(h,m,d)}}case"dmi":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length<2||a.length>3)throw new Tt("dmi expects (length, smoothing[, output])");const u=yi(a[0]),d=yi(a[1]),h=Kp(u,"dmi_len",NS,e),m=Kp(d,"dmi_smooth",AS,e);if(!Number.isFinite(h)||!Number.isFinite(m))return{kind:"series",value:Hv(e.length)};const g=a[2]?Math.floor(yi(a[2])):0;if(!Number.isFinite(g)||g<0||g>2)throw new Tt("dmi output must be 0, 1, or 2");const w=e.series.high,C=e.series.low,P=e.series.close;if(!w||!C||!P)throw new Tt("dmi requires high/low/close series");const I=X0(w,C,P,h,m);return{kind:"series",value:g===0?I.plus:g===1?I.minus:I.adx}}case"plus_di":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new Tt("plus_di expects (length)");const u=yi(a[0]),d=Kp(u,"plus_di_len",FS,e);if(!Number.isFinite(d))return{kind:"series",value:Hv(e.length)};const h=e.series.high,m=e.series.low,g=e.series.close;if(!h||!m||!g)throw new Tt("plus_di requires high/low/close series");return{kind:"series",value:X0(h,m,g,d,d).plus}}case"minus_di":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new Tt("minus_di expects (length)");const u=yi(a[0]),d=Kp(u,"minus_di_len",LS,e);if(!Number.isFinite(d))return{kind:"series",value:Hv(e.length)};const h=e.series.high,m=e.series.low,g=e.series.close;if(!h||!m||!g)throw new Tt("minus_di requires high/low/close series");return{kind:"series",value:X0(h,m,g,d,d).minus}}case"dx":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new Tt("dx expects (length)");const u=yi(a[0]),d=Kp(u,"dx_len",ES,e);if(!Number.isFinite(d))return{kind:"series",value:Hv(e.length)};const h=e.series.high,m=e.series.low,g=e.series.close;if(!h||!m||!g)throw new Tt("dx requires high/low/close series");const w=X0(h,m,g,d,d);return{kind:"series",value:hS(w.plus,w.minus)}}case"adx":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new Tt("adx expects (length)");const u=yi(a[0]),d=Kp(u,"adx_len",TS,e);if(!Number.isFinite(d))return{kind:"series",value:Hv(e.length)};const h=e.series.high,m=e.series.low,g=e.series.close;if(!h||!m||!g)throw new Tt("adx requires high/low/close series");return{kind:"series",value:X0(h,m,g,d,d).adx}}case"valuewhen":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==3)throw new Tt("valuewhen expects (condition, source, occurrence)");const u=n.args[0],d=o0(u);d&&Ld(e,Q0(u,e,"type"),p2);const h=`valuewhen_occ:${Fd(n)}`;if(a[2].kind!=="scalar")return Ld(e,h,m2),{kind:"series",value:Hv(e.length)};const m=Z0(a[2].value,h,m2,e);if(!Number.isFinite(m)||d)return{kind:"series",value:Hv(e.length)};const g=eo(a[0],e),w=eo(a[1],e),C=Q0(u,e,"na");return{kind:"series",value:vS(g,w,m,A=>y0(A,e.diagnostics,C))}}case"pivothigh":case"pivotlow":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==3)throw new Tt(`${n.callee} expects (source, left, right)`);const u=yi(a[1]),d=yi(a[2]),{left:h,right:m}=gS(u,d),g=eo(a[0],e);return{kind:"series",value:Y$(g,h,m,o==="pivothigh"?"high":"low")}}case"year":case"month":case"dayofweek":case"hour":case"minute":case"second":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new Tt(`${n.callee} expects (time)`);const u=a[0];if(u.kind==="scalar"){if(K0(u.value),o==="dayofweek")return{kind:"scalar",value:aw(u.value)};const m=o==="year"||o==="month"?o:o==="hour"?"hour":o==="minute"?"minute":"second";return{kind:"scalar",value:lw(u.value,m)}}const d=eo(u,e);if(Ak(d),o==="dayofweek")return{kind:"series",value:z1(d,aw)};const h=o==="year"||o==="month"?o:o==="hour"?"hour":o==="minute"?"minute":"second";return{kind:"series",value:z1(d,m=>lw(m,h))}}case"timestamp":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length<5||a.length>6)throw new Tt("timestamp expects (year, month, day, hour, minute[, second])");const u=a.length===6?a[5]:{kind:"scalar",value:0};if([a[0],a[1],a[2],a[3],a[4],u].every(M=>(M==null?void 0:M.kind)==="scalar")){const M=a[0].value,F=a[1].value,B=a[2].value,$=a[3].value,L=a[4].value,O=u.value;return{kind:"scalar",value:bS(M,F,B,$,L,O)}}const h=eo(a[0],e),m=eo(a[1],e),g=eo(a[2],e),w=eo(a[3],e),C=eo(a[4],e),P=eo(u,e);[h,m,g,w,C,P].forEach(Ak);const I=e.length,A=new Float32Array(I);for(let M=0;M<I;M++){const F=h[M],B=m[M],$=g[M],L=w[M],O=C[M],Y=P[M];if(![F,B,$,L,O,Y].every(Number.isFinite)){A[M]=NaN;continue}if(B<1||B>12)throw new Tt(yS);A[M]=Date.UTC(F,B-1,$,L,O,Y)}return{kind:"series",value:A}}case"timenow":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==0)throw new Tt("timenow expects ()");return{kind:"scalar",value:wS(e)}}case"time_close":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==0)throw new Tt("time_close expects ()");const u=e.series.time;if(!u)throw new Tt("time_close requires time series");const d=xS(e);return{kind:"series",value:z1(u,h=>Number.isFinite(h)?h+d:NaN)}}case"isin":case"session_isin":case"session.isin":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==2)throw new Tt("session.isin expects (time, session)");const u=n.args[1];if(!u||u.kind!=="StringLiteral")throw new Tt(f2);const{start:d,end:h}=kS(u.value),m=a[0];if(m.kind==="scalar"){const C=m.value;if(!Number.isFinite(C))throw new Tt(cw);const P=uw(C);return{kind:"scalar",value:dw(P,d,h)?1:0}}const g=eo(m,e),w=new Float32Array(g.length);for(let C=0;C<g.length;C++){const P=g[C];if(!Number.isFinite(P))throw new Tt(cw);const I=uw(P);w[C]=dw(I,d,h)?1:0}return{kind:"series",value:w}}case"cci":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==4)throw new Tt("cci expects (high, low, close, period)");const u=eo(a[0],e),d=eo(a[1],e),h=eo(a[2],e),m=Math.max(1,Math.floor(yi(a[3]))),g=aS(yg(u),yg(d),yg(h),m);return{kind:"series",value:g0(g)}}case"mfi":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==5)throw new Tt("mfi expects (high, low, close, volume, period)");const u=eo(a[0],e),d=eo(a[1],e),h=eo(a[2],e),m=eo(a[3],e),g=Math.max(1,Math.floor(yi(a[4]))),w=lS(yg(u),yg(d),yg(h),yg(m),g);return{kind:"series",value:g0(w)}}case"obv":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==2)throw new Tt("obv expects (close, volume)");const u=eo(a[0],e),d=eo(a[1],e),h=rS(yg(u),yg(d));return{kind:"series",value:g0(h)}}case"ad":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==0&&a.length!==4)throw new Tt("ad expects () or (high, low, close, volume)");const u=a.length===4?eo(a[0],e):e.series.high,d=a.length===4?eo(a[1],e):e.series.low,h=a.length===4?eo(a[2],e):e.series.close,m=a.length===4?eo(a[3],e):e.series.volume;if(!u||!d||!h||!m)throw new Tt("ad requires high/low/close/volume series");return{kind:"series",value:CD(u,d,h,m)}}case"cmf":{if(!s)throw new Tt(`Unknown function "${n.callee}"`);if(a.length!==1&&a.length!==5)throw new Tt("cmf expects (length) or (high, low, close, volume, length)");const u=Math.max(1,Math.floor(yi(a[a.length===1?0:4]))),d=a.length===5?eo(a[0],e):e.series.high,h=a.length===5?eo(a[1],e):e.series.low,m=a.length===5?eo(a[2],e):e.series.close,g=a.length===5?eo(a[3],e):e.series.volume;if(!d||!h||!m||!g)throw new Tt("cmf requires high/low/close/volume series");return{kind:"series",value:ID(d,h,m,g,u)}}case"min":{if(a.length!==2)throw new Tt("min expects 2 arguments");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Math.min(u.value,d.value)};const h=eo(u,e),m=eo(d,e),g=e.length,w=new Float32Array(g);for(let C=0;C<g;C++)w[C]=Math.min(h[C],m[C]);return{kind:"series",value:w}}case"max":{if(a.length!==2)throw new Tt("max expects 2 arguments");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Math.max(u.value,d.value)};const h=eo(u,e),m=eo(d,e),g=e.length,w=new Float32Array(g);for(let C=0;C<g;C++)w[C]=Math.max(h[C],m[C]);return{kind:"series",value:w}}case"abs":{if(a.length!==1)throw new Tt("abs expects 1 argument");const u=a[0];if(u.kind==="scalar")return{kind:"scalar",value:Math.abs(u.value)};const d=u.value,h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++)m[g]=Math.abs(d[g]);return{kind:"series",value:m}}default:throw new Tt(`Unknown function "${n.callee}"`)}}function s0(n,e){var t,s;switch(n.kind){case"NumberLiteral":return{kind:"scalar",value:n.value};case"StringLiteral":return{kind:"scalar",value:vv(n.value)};case"Identifier":{const o=n.name.replace(/\s+/g,"_").toLowerCase();if(o==="na"||o==="nan")return{kind:"scalar",value:NaN};if(o==="pi")return{kind:"scalar",value:Math.PI};if(o==="e")return{kind:"scalar",value:Math.E};const r=e.series[o];if(r)return{kind:"series",value:r};const a=(t=e.scalars)==null?void 0:t[o];if(typeof a=="number"&&Number.isFinite(a))return{kind:"scalar",value:a};throw e.seriesNames.has(o)?new Tt(`Series "${n.name}" is used before it is defined (circular or forward reference)`):new Tt(`Unknown identifier "${n.name}"`)}case"MemberExpression":{const o=S_(n);return o?s0({kind:"Identifier",name:o},e):(Jw(e,n),{kind:"scalar",value:NaN})}case"IndexExpression":return Qw(e,n),{kind:"scalar",value:NaN};case"UnaryExpression":{const o=s0(n.expr,e);if(n.operator==="not"){const r=((s=e.scalars)==null?void 0:s.__pinev2)===1;if(o.kind==="scalar"){const c=o.value;return{kind:"scalar",value:r?fw(c):Number.isFinite(c)&&c!==0?0:1}}const a=o.value,l=new Float32Array(a.length);for(let c=0;c<a.length;c++){const f=a[c];l[c]=r?fw(f):Number.isFinite(f)&&f!==0?0:1}return{kind:"series",value:l}}throw new Tt("Unsupported unary operator")}case"BinaryExpression":return n.operator==="and"||n.operator==="or"?lD(n,e):XS(n.operator,s0(n.left,e),s0(n.right,e),e);case"CallExpression":return e8(n,e);default:throw new Tt("Unsupported expression node")}}function __(n,e,t,s,o,r){var L;const a=new Set;for(const O of n){const Y=O.name.replace(/\s+/g,"_").toLowerCase();a.add(Y)}const l=Object.entries(e),c=((L=l[0])==null?void 0:L[1].length)??0;for(const[,O]of l)if(O.length!==c)throw new Tt("All base series must have the same length");const f=n.map(O=>{try{const Y=Lp(O.expr);return{name:O.name.replace(/\s+/g,"_").toLowerCase(),expr:O.expr,ast:Y}}catch(Y){throw Y instanceof Zv?new Tt(`Syntax error in series "${O.name}" at position ${Y.position}: ${Y.message}`):Y}}),u=(()=>{if(!t||typeof t!="object")return;const O={};return Object.entries(t).forEach(([Y,ce])=>{const Q=Y.replace(/\s+/g,"_").toLowerCase();if(typeof ce=="number"&&Number.isFinite(ce)){O[Q]=ce;return}if(typeof ce=="string"){const le=Number(ce);O[Q]=Number.isFinite(le)?le:vv(ce)}}),Object.keys(O).length?O:void 0})(),d=(()=>{if(!t||typeof t!="object")return;const O={};return Object.entries(t).forEach(([Y,ce])=>{typeof ce=="string"&&(O[Y.replace(/\s+/g,"_").toLowerCase()]=ce)}),Object.keys(O).length?O:void 0})(),h=$2(r==null?void 0:r.loopPlans,u,!!(r!=null&&r.userFunctions)),m=D2(r==null?void 0:r.userFunctions),g={length:c,series:{...e},seriesNames:a,scalars:u,diagnostics:o,strategy:s,strings:d,loopRuntime:h,funcRuntime:m},w={},C=O=>{const Y=new Set,ce=Q=>{switch(Q.kind){case"Identifier":{const le=Q.name.replace(/\s+/g,"_").toLowerCase();Y.add(le);break}case"MemberExpression":{const le=S_(Q);if(le){const ue=le.replace(/\s+/g,"_").toLowerCase();Y.add(ue);break}ce(Q.object);break}case"IndexExpression":ce(Q.object),ce(Q.index);break;case"BinaryExpression":ce(Q.left),ce(Q.right);break;case"UnaryExpression":ce(Q.expr);break;case"CallExpression":Q.args.forEach(le=>ce(le));break}};return ce(O),Y},P=new Set(f.map(O=>O.name)),I={},A={};f.forEach(O=>{I[O.name]=new Set,A[O.name]=new Set}),f.forEach(O=>{C(O.ast).forEach(ce=>{P.has(ce)&&ce!==O.name&&(I[O.name].add(ce),A[ce].add(O.name))})});const M={};Object.keys(I).forEach(O=>{var Y;M[O]=((Y=I[O])==null?void 0:Y.size)??0});const F=Object.keys(M).filter(O=>(M[O]||0)===0),B=[];for(;F.length;){const O=F.shift();B.push(O);for(const Y of A[O]||[])M[Y]=(M[Y]||0)-1,M[Y]===0&&F.push(Y)}if(B.length!==f.length){const O=f.map(Y=>Y.name).filter(Y=>!B.includes(Y));throw new Tt(`Circular dependency detected among series: ${O.join(" -> ")}`)}const $={};f.forEach(O=>{$[O.name]=O});for(const O of B){const Y=$[O];if(g.series[Y.name])throw new Tt(`Series name "${Y.name}" conflicts with an existing base series`);const ce=s0(Y.ast,g),Q=eo(ce,g);g.series[Y.name]=Q,w[Y.name]=Q}return w}const xg=(n,e,t)=>{if(!n.memo)return t();const s=n.memo.get(e);if(s)return s;const o=t();return n.memo.set(e,o),o},U0=(n,e)=>{if(n.kind==="Identifier"){const t=n.name.replace(/\s+/g,"_").toLowerCase();return e.series[t]??null}if(n.kind==="MemberExpression"){const t=S_(n);if(!t)return null;const s=t.replace(/\s+/g,"_").toLowerCase();return e.series[s]??null}if(n.kind==="NumberLiteral")return xg(e,`const:${n.value}`,()=>{const t=new Float32Array(e.length);return t.fill(n.value),t});if(n.kind==="StringLiteral"){const t=vv(n.value);return xg(e,`const_str:${n.value}`,()=>{const s=new Float32Array(e.length);return s.fill(t),s})}return null},v2=(n,e,t)=>{if(!n.memo)return t();const s=`${e}:a`,o=n.memo.get(s);if(o)return{a:o,b:n.memo.get(`${e}:b`)};const r=t();return n.memo.set(s,r.a),n.memo.set(`${e}:b`,r.b),r},Gb=(n,e,t)=>{if(!n.memo)return t();const s=`${e}:a`,o=n.memo.get(s);if(o)return{a:o,b:n.memo.get(`${e}:b`),c:n.memo.get(`${e}:c`)};const r=t();return n.memo.set(s,r.a),n.memo.set(`${e}:b`,r.b),n.memo.set(`${e}:c`,r.c),r};function Ek(n,e){var r;const t=n.replace(/\s+/g,"_").toLowerCase();if(t==="na"||t==="nan")return NaN;if(t==="pi")return Math.PI;if(t==="e")return Math.E;if(e.locals&&Object.prototype.hasOwnProperty.call(e.locals,t))return e.locals[t];if(e.selfKey&&e.selfOut&&t===e.selfKey){if(e.selfMode==="current"){const l=e.selfOut[e.index];if(Number.isFinite(l))return l}const a=e.index-1;return a>=0?e.selfOut[a]:NaN}const s=e.series[t];if(s)return s[e.index]??NaN;const o=(r=e.scalars)==null?void 0:r[t];if(typeof o=="number"&&Number.isFinite(o))return o;throw new Tt(`Unknown identifier "${n}"`)}const s6=1e3,VD=1e6,t8=(n,e,t)=>{if(!Number.isFinite(n)||!Number.isFinite(e)||!Number.isFinite(t)||t===0)return null;if(t>0){if(n>e)return 0;const s=(e-n)/t;return Math.floor(s+1+1e-12)}if(t<0){if(n<e)return 0;const s=(n-e)/Math.abs(t);return Math.floor(s+1+1e-12)}return null},sv=(n,e)=>{try{return Lp(n)}catch(t){throw t instanceof Zv?new Tt(`Syntax error in ${e} at position ${t.position}: ${t.message}`):t}},Yb=n=>n.map(e=>e.kind==="assign"?{kind:"assign",name:e.name,expr:sv(e.expr,`loop assignment "${e.name}"`),lineNo:e.lineNo}:e.kind==="if"?{kind:"if",lineNo:e.lineNo,branches:e.branches.map(t=>({cond:t.cond?sv(t.cond,"loop if condition"):void 0,body:Yb(t.body),lineNo:t.lineNo}))}:e.kind==="for"?{kind:"for",lineNo:e.lineNo,varName:e.varName,startExpr:sv(e.startExpr,"loop for start"),endExpr:sv(e.endExpr,"loop for end"),stepExpr:sv(e.stepExpr,"loop for step"),body:Yb(e.body)}:e.kind==="while"?{kind:"while",lineNo:e.lineNo,condExpr:sv(e.condExpr,"loop while condition"),body:Yb(e.body)}:{kind:e.kind,lineNo:e.lineNo}),vw=(n,e)=>{for(const t of n){if(t.kind==="assign"){e.add(t.name);continue}if(t.kind==="if"){t.branches.forEach(s=>vw(s.body,e));continue}(t.kind==="for"||t.kind==="while")&&vw(t.body,e)}},WD=n=>{const e=Yb(n.body||[]),t=new Set;return vw(e,t),{id:n.id,kind:n.kind,lineNo:n.lineNo,varName:n.varName,startExpr:n.startExpr?sv(n.startExpr,"loop start"):void 0,endExpr:n.endExpr?sv(n.endExpr,"loop end"):void 0,stepExpr:n.stepExpr?sv(n.stepExpr,"loop step"):void 0,condExpr:n.condExpr?sv(n.condExpr,"loop condition"):void 0,body:e,targets:Array.from(t)}},$2=(n,e,t)=>{if((!n||!n.length)&&!t)return;const s=e==null?void 0:e.__loop_max_iters,o=typeof s=="number"&&Number.isFinite(s),r=o&&s<=0?Number.POSITIVE_INFINITY:o?Math.min(VD,Math.max(1,Math.floor(s))):s6,a=new Map;return(n||[]).forEach(l=>{if(!l||typeof l!="object")return;const c=String(l.id||"").trim();c&&a.set(c,WD(l))}),{plans:a,maxIters:r,hasCustomMax:o,running:new Set}},Kb=n=>n.map(e=>e.kind==="assign"?{kind:"assign",name:e.name,op:e.op,decl:e.decl,expr:sv(e.expr,`function assignment "${e.name}"`),lineNo:e.lineNo}:e.kind==="return"?{kind:"return",expr:sv(e.expr,"function return"),lineNo:e.lineNo}:e.kind==="if"?{kind:"if",lineNo:e.lineNo,branches:e.branches.map(t=>({cond:t.cond?sv(t.cond,"function if condition"):void 0,body:Kb(t.body),lineNo:t.lineNo}))}:e.kind==="for"?{kind:"for",lineNo:e.lineNo,varName:e.varName,startExpr:sv(e.startExpr,"function for start"),endExpr:sv(e.endExpr,"function for end"),stepExpr:sv(e.stepExpr,"function for step"),body:Kb(e.body)}:e.kind==="while"?{kind:"while",lineNo:e.lineNo,condExpr:sv(e.condExpr,"function while condition"),body:Kb(e.body)}:{kind:e.kind,lineNo:e.lineNo}),gw=(n,e)=>{for(const t of n){if(t.kind==="assign"){if(t.decl==="var"||t.decl==="varip"){const s=t.name.replace(/\s+/g,"_").toLowerCase();e.add(s)}continue}if(t.kind==="if"){t.branches.forEach(s=>gw(s.body,e));continue}(t.kind==="for"||t.kind==="while")&&gw(t.body,e)}},HD=n=>{const e=Kb(n.body||[]),t=new Set;return gw(e,t),{name:n.name,args:n.args||[],lineNo:n.lineNo,body:e,statefulVars:t}},D2=n=>{if(!n||!n.length)return;const e=new Map;return n.forEach(t=>{if(!t||typeof t!="object")return;const s=String(t.name||"").trim();if(s)try{e.set(s.toLowerCase(),HD(t))}catch{}}),{funcs:e,callState:new WeakMap,running:new Set}},q_=(n,e,t,s,o)=>_r(n,{...e,locals:t,selfKey:s,selfOut:o,selfMode:"current"}),_w=(n,e,t)=>{for(const s of n){if(s.kind==="assign"){const o=s.name.replace(/\s+/g,"_").toLowerCase();let r=e.series[o];r||(r=new Float32Array(e.length),r.fill(NaN),e.series[o]=r);const a=q_(s.expr,e,t,o,r);r[e.index]=a;continue}if(s.kind==="break")return"break";if(s.kind==="continue")return"continue";if(s.kind==="if"){let o=!1;for(const r of s.branches){if(o)break;if(r.cond){const l=q_(r.cond,e,t);if(!y0(l,e.diagnostics,`loop_cond_na:${s.lineNo}`))continue}o=!0;const a=_w(r.body,e,t);if(a!=="none")return a}continue}if(s.kind==="for"){g2({kind:"for",varName:s.varName,startExpr:s.startExpr,endExpr:s.endExpr,stepExpr:s.stepExpr,body:s.body,lineNo:s.lineNo},e,t);continue}if(s.kind==="while"){g2({kind:"while",condExpr:s.condExpr,body:s.body,lineNo:s.lineNo},e,t);continue}}return"none"},g2=(n,e,t)=>{const s=e.loopRuntime,o=(s==null?void 0:s.maxIters)??s6,r=(s==null?void 0:s.hasCustomMax)??!1,a=`loop_max:${n.lineNo}`,l=`Loop exceeded max iterations (${o})`;if(n.kind==="for"){const u=Object.prototype.hasOwnProperty.call(t,n.varName)?t[n.varName]:void 0,d=q_(n.startExpr,e,t),h=q_(n.endExpr,e,t),m=q_(n.stepExpr,e,t);if(!Number.isFinite(m)||m===0){Ld(e,`loop_step_zero:${n.lineNo}`,"for-loop step must not be 0");return}const g=t8(d,h,m),w=Number.isFinite(o)?o:null;let C=null,P=!1;r&&w!=null?g==null?(C=w,P=!0):(C=Math.min(w,g),P=g>w):g!=null&&(C=g);const I=m>0;let A=d,M=0;for(;(C==null||M<C)&&!(!Number.isFinite(A)||!Number.isFinite(h)||I&&A>h+1e-12||!I&&A<h-1e-12);){t[n.varName]=A;const F=_w(n.body,e,t);if(F==="break")break;A+=m,M+=1}P&&C!=null&&M>=C&&Ld(e,a,l),u===void 0?delete t[n.varName]:t[n.varName]=u;return}let c=0;const f=Number.isFinite(o)?o:null;for(;f==null||c<f;){const u=q_(n.condExpr,e,t);if(!y0(u,e.diagnostics,`loop_cond_na:${n.lineNo}`))break;const h=_w(n.body,e,t);if(h==="break")break;c+=1}f!=null&&c>=f&&Ld(e,a,l)},qD=(n,e)=>{const t=e.locals?{...e.locals}:{},s=e.scalars??{};n.targets.forEach(r=>{const a=r.replace(/\s+/g,"_").toLowerCase();let l=e.series[a];l||(l=new Float32Array(e.length),l.fill(NaN),e.series[a]=l);const c=l[e.index];if(Number.isFinite(c))return;const f=s[a];if(typeof f=="number"&&Number.isFinite(f)){l[e.index]=f;return}if(e.index>0){const u=l[e.index-1];Number.isFinite(u)&&(l[e.index]=u)}}),n.kind==="for"?n.varName&&n.startExpr&&n.endExpr&&n.stepExpr&&g2({kind:"for",varName:n.varName,startExpr:n.startExpr,endExpr:n.endExpr,stepExpr:n.stepExpr,body:n.body,lineNo:n.lineNo??0},{...e,locals:t},t):n.condExpr&&g2({kind:"while",condExpr:n.condExpr,body:n.body,lineNo:n.lineNo??0},{...e,locals:t},t);const o={};return n.targets.forEach(r=>{const a=r.replace(/\s+/g,"_").toLowerCase(),l=e.series[a];o[a]=l?l[e.index]??NaN:NaN}),o},g_=(n,e,t)=>_r(n,{...e,locals:t,selfMode:"current"}),_2=(n,e,t,s,o,r)=>{const a=(l,c)=>Ld(e,l,c);for(const l of n){if(l.kind==="assign"){const c=l.name.replace(/\s+/g,"_").toLowerCase(),f=g_(l.expr,e,t);l.decl==="var"||l.decl==="varip"||o.has(c)?l.decl&&l.op==="="?(s.inited.has(c)||(s.vars[c]=f,s.inited.add(c)),t[c]=s.vars[c]??NaN):(!s.inited.has(c)&&l.op===":="&&a(`fn_var_uninit:${c}`,`Function var "${l.name}" is used before initialization`),s.vars[c]=f,s.inited.add(c),t[c]=f):(l.op===":="&&!Object.prototype.hasOwnProperty.call(t,c)&&a(`fn_local_uninit:${c}`,`Function local "${l.name}" is used before initialization`),t[c]=f);continue}if(l.kind==="return")return{kind:"return",value:g_(l.expr,e,t)};if(l.kind==="break"){if(!r){a(`fn_break_outside:${l.lineNo}`,"break used outside of a loop");continue}return{kind:"break"}}if(l.kind==="continue"){if(!r){a(`fn_continue_outside:${l.lineNo}`,"continue used outside of a loop");continue}return{kind:"continue"}}if(l.kind==="if"){let c=!1;for(const f of l.branches){if(c)break;if(f.cond){const d=g_(f.cond,e,t);if(!y0(d,e.diagnostics,`fn_cond_na:${l.lineNo}`))continue}c=!0;const u=_2(f.body,e,t,s,o,r);if(u.kind!=="none")return u}continue}if(l.kind==="for"){const c=$k({kind:"for",varName:l.varName,startExpr:l.startExpr,endExpr:l.endExpr,stepExpr:l.stepExpr,body:l.body,lineNo:l.lineNo},e,t,s,o);if(c.kind==="return")return c;continue}if(l.kind==="while"){const c=$k({kind:"while",condExpr:l.condExpr,body:l.body,lineNo:l.lineNo},e,t,s,o);if(c.kind==="return")return c;continue}}return{kind:"none"}},$k=(n,e,t,s,o)=>{const r=e.loopRuntime,a=(r==null?void 0:r.maxIters)??s6,l=(r==null?void 0:r.hasCustomMax)??!1,c=`fn_loop_max:${n.lineNo}`,f=`Loop exceeded max iterations (${a})`;if(n.kind==="for"){const h=n.varName.replace(/\s+/g,"_").toLowerCase(),m=Object.prototype.hasOwnProperty.call(t,h),g=t[h],w=g_(n.startExpr,e,t),C=g_(n.endExpr,e,t),P=g_(n.stepExpr,e,t);if(!Number.isFinite(P)||P===0)return Ld(e,`fn_loop_step_zero:${n.lineNo}`,"for-loop step must not be 0"),{kind:"none"};const I=t8(w,C,P),A=Number.isFinite(a)?a:null;let M=null,F=!1;l&&A!=null?I==null?(M=A,F=!0):(M=Math.min(A,I),F=I>A):I!=null&&(M=I);const B=P>0;let $=w,L=0;for(;(M==null||L<M)&&!(!Number.isFinite($)||!Number.isFinite(C)||B&&$>C+1e-12||!B&&$<C-1e-12);){t[h]=$;const O=_2(n.body,e,t,s,o,!0);if(O.kind==="return")return O;if(O.kind==="break")break;$+=P,L+=1,O.kind}return F&&M!=null&&L>=M&&Ld(e,c,f),m?t[h]=g:delete t[h],{kind:"none"}}let u=0;const d=Number.isFinite(a)?a:null;for(;d==null||u<d;){const h=g_(n.condExpr,e,t);if(!y0(h,e.diagnostics,`fn_loop_cond_na:${n.lineNo}`))break;const g=_2(n.body,e,t,s,o,!0);if(g.kind==="return")return g;if(g.kind==="break")break;u+=1,g.kind}return d!=null&&u>=d&&Ld(e,c,f),{kind:"none"}},n8=(n,e,t)=>{const s=t.funcRuntime;if(!s)return NaN;const o=s.callState.get(e)??(()=>{const f={vars:{},inited:new Set};return s.callState.set(e,f),f})();if(o.lastIndex===t.index)return o.lastValue??NaN;const r=n.name.toLowerCase();if(s.running.has(r))return Ld(t,`fn_recursion:${r}`,`Function "${n.name}" is recursive`),NaN;s.running.add(r);const a={};n.args.forEach((f,u)=>{const d=f.replace(/\s+/g,"_").toLowerCase(),h=e.args[u];a[d]=h?_r(h,t):NaN}),n.statefulVars.forEach(f=>{Object.prototype.hasOwnProperty.call(o.vars,f)&&(a[f]=o.vars[f])});const l=_2(n.body,t,a,o,n.statefulVars,!1);s.running.delete(r);const c=l.kind==="return"?l.value:NaN;return o.lastIndex=t.index,o.lastValue=c,c};function o6(n){const e=n.match(/^(line|label|box|table)_get_([a-z0-9_]+)$/i);return e?{kind:e[1].toLowerCase(),prop:e[2].toLowerCase()}:null}function s8(n){const e=n.match(/^strategy_(closedtrades|opentrades)_([a-z0-9_]+)$/i);return e?{kind:e[1].toLowerCase(),prop:e[2].toLowerCase()}:null}function i6(n,e){return e?n==="session.isin"?"session_isin":n.startsWith("ta_")?n.slice(3):n.startsWith("math_")?n.slice(5):n:n}const UD={profit_pct:"profit_percent",pnl:"profit",net_pnl:"net_profit",net_pnl_pct:"net_profit_percent",net_pnl_percent:"net_profit_percent",fee:"fees",max_profit:"max_runup",max_profit_pct:"max_runup_percent",max_profit_percent:"max_runup_percent",max_runup_pct:"max_runup_percent",max_drawdown_pct:"max_drawdown_percent",max_loss:"max_drawdown",max_loss_pct:"max_drawdown_percent",max_loss_percent:"max_drawdown_percent"};function GD(n){const e=n.toLowerCase();return UD[e]??e}function o8(n,e,t,s,o){const r=GD(t),a=n.strategy;if(!a)return NaN;if(o<0)return NaN;if(e==="closedtrades"){const Y=a.closedTrades||[];if(!Y.length)return 0;const ce=n.series.strategy_closedtrades,Q=ce?ce[s]:NaN,ue=(typeof Q=="number"&&Number.isFinite(Q)?Math.floor(Q):0)-1-o;if(ue<0||ue>=Y.length)return 0;const fe=Y[ue],pe=Number.isFinite(fe.entryPrice)&&Number.isFinite(fe.qty)&&fe.entryPrice>0&&fe.qty>0?fe.entryPrice*fe.qty:NaN,Z=Number.isFinite(fe.netPnl)?fe.netPnl:Number.isFinite(fe.pnl)?fe.pnl-(fe.fees??0):NaN,xe=Number.isFinite(pe)&&pe!==0?Z/pe*100:NaN;switch(r){case"entry_price":return fe.entryPrice;case"entry_time":return fe.entryTimestamp;case"entry_bar_index":return fe.entryIndex;case"exit_price":return fe.exitPrice;case"exit_time":return fe.exitTimestamp;case"exit_bar_index":return fe.exitIndex;case"size":return fe.qty;case"profit":return Number.isFinite(fe.pnl)?fe.pnl:0;case"profit_percent":return Number.isFinite(fe.pnlPct)?fe.pnlPct:0;case"net_profit":return Number.isFinite(Z)?Z:0;case"net_profit_percent":return Number.isFinite(xe)?xe:0;case"fees":return Number.isFinite(fe.fees)?fe.fees:0;case"entry_fee":return Number.isFinite(fe.entryFee)?fe.entryFee:0;case"exit_fee":return Number.isFinite(fe.exitFee)?fe.exitFee:0;case"max_runup":return typeof fe.mfePct!="number"||!Number.isFinite(fe.mfePct)?0:fe.mfePct/100*fe.entryPrice*fe.qty;case"max_runup_percent":return typeof fe.mfePct=="number"&&Number.isFinite(fe.mfePct)?fe.mfePct:0;case"max_drawdown":return typeof fe.maePct!="number"||!Number.isFinite(fe.maePct)?0:fe.maePct/100*fe.entryPrice*fe.qty;case"max_drawdown_percent":return typeof fe.maePct=="number"&&Number.isFinite(fe.maePct)?fe.maePct:0;case"is_long":return fe.side==="long"?1:0;case"is_short":return fe.side==="short"?1:0;case"entry_id":return vv(String(fe.entryOrderId??fe.entrySignalId??""));case"exit_id":return vv(String(fe.exitOrderId??fe.exitSignalId??""));default:return 0}}const l=a.openTradesByBar||[];if(s<0||s>=l.length)return 0;const c=l[s]||[];if(o>=c.length)return 0;const f=c[o],u=n.series.close,d=u&&Number.isFinite(u[s])?u[s]:NaN,h=f.qty,m=f.entryPrice,g=m>0&&h>0?m*h:NaN,w=typeof f.entryFee=="number"&&Number.isFinite(f.entryFee)?f.entryFee:0,C=Number.isFinite(d)&&Number.isFinite(m)?f.side==="long"?(d-m)*h:(m-d)*h:NaN,P=Number.isFinite(g)&&g!==0?C/g*100:NaN,I=Number.isFinite(C)&&Number.isFinite(w)?C-w:NaN,A=Number.isFinite(g)&&g!==0?I/g*100:NaN,M=f.maxFav,F=f.maxAdv,B=Number.isFinite(m)&&Number.isFinite(h)&&Number.isFinite(M)?f.side==="long"?(M-m)*h:(m-M)*h:NaN,$=Number.isFinite(m)&&m>0&&Number.isFinite(M)?f.side==="long"?(M-m)/m*100:(m-M)/m*100:NaN,L=Number.isFinite(m)&&Number.isFinite(h)&&Number.isFinite(F)?f.side==="long"?(F-m)*h:(m-F)*h:NaN,O=Number.isFinite(m)&&m>0&&Number.isFinite(F)?f.side==="long"?(F-m)/m*100:(m-F)/m*100:NaN;switch(r){case"entry_price":return m;case"entry_time":return f.entryTimestamp;case"entry_bar_index":return f.entryIndex;case"size":return h;case"profit":return Number.isFinite(C)?C:0;case"profit_percent":return Number.isFinite(P)?P:0;case"net_profit":return Number.isFinite(I)?I:0;case"net_profit_percent":return Number.isFinite(A)?A:0;case"fees":return Number.isFinite(w)?w:0;case"entry_fee":return Number.isFinite(w)?w:0;case"max_runup":return Number.isFinite(B)?B:0;case"max_runup_percent":return Number.isFinite($)?$:0;case"max_drawdown":return Number.isFinite(L)?L:0;case"max_drawdown_percent":return Number.isFinite(O)?O:0;case"is_long":return f.side==="long"?1:0;case"is_short":return f.side==="short"?1:0;case"entry_id":return vv(String(f.entryOrderId??f.entrySignalId??""));default:return 0}}function _r(n,e){var s,o,r,a,l,c,f,u,d,h;const t=((s=e.scalars)==null?void 0:s.__pinev2)===1;switch(n.kind){case"NumberLiteral":return n.value;case"StringLiteral":return vv(n.value);case"Identifier":return Ek(n.name,e);case"MemberExpression":{const m=S_(n);return m?Ek(m,e):(Jw(e,n),NaN)}case"IndexExpression":return Qw(e,n),NaN;case"UnaryExpression":{if(n.operator==="not"){const m=_r(n.expr,e);return t?fw(m):Number.isFinite(m)&&m!==0?0:1}return NaN}case"BinaryExpression":{if(n.operator==="and"||n.operator==="or"){if(t){const P=_r(n.left,e),I=r_(P);if(n.operator==="and"){if(I===0)return 0;const M=_r(n.right,e);return J_(P,M)}if(I===1)return 1;const A=_r(n.right,e);return Q_(P,A)}const w=_r(n.left,e),C=_r(n.right,e);return n.operator==="and"?Number.isFinite(w)&&w!==0&&Number.isFinite(C)&&C!==0?1:0:Number.isFinite(w)&&w!==0||Number.isFinite(C)&&C!==0?1:0}const m=_r(n.left,e),g=_r(n.right,e);if(t&&E2(n.operator)&&(!Number.isFinite(m)||!Number.isFinite(g)))return NaN;switch(n.operator){case"+":return m+g;case"-":return m-g;case"*":return m*g;case"/":return w_(m,g,t,e);case"%":return g===0?NaN:m%g;case">":return Number.isFinite(m)&&Number.isFinite(g)&&m>g?1:0;case"<":return Number.isFinite(m)&&Number.isFinite(g)&&m<g?1:0;case">=":return Number.isFinite(m)&&Number.isFinite(g)&&m>=g?1:0;case"<=":return Number.isFinite(m)&&Number.isFinite(g)&&m<=g?1:0;case"==":return Number.isFinite(m)&&Number.isFinite(g)&&Math.abs(m-g)<1e-9?1:0;case"!=":return Number.isFinite(m)&&Number.isFinite(g)&&Math.abs(m-g)>=1e-9?1:0;default:return NaN}}case"CallExpression":{const m=e.funcRuntime;if(m){const M=m.funcs.get(n.callee.toLowerCase());if(M)return n8(M,n,e)}const g=i6(n.callee.toLowerCase(),t);if(g==="__loop_exec"){const M=Y=>Y?Y.kind==="StringLiteral"?Y.value:Y.kind==="Identifier"?Y.name:null:null,F=M(n.args[0]);if(!F)return Ld(e,`loop_exec_missing:${Fd(n)}`,"__loop_exec requires loop id"),NaN;const B=e.loopRuntime;if(!B)return Ld(e,`loop_runtime_missing:${F}`,"Loop runtime not configured"),NaN;const $=B.plans.get(F);if(!$)return Ld(e,`loop_missing:${F}`,`Unknown loop "${F}"`),NaN;if($.lastIndex!==e.index){if(B.running.has(F))return Ld(e,`loop_recursion:${F}`,`Loop "${F}" is recursive`),NaN;B.running.add(F);const Y=qD($,e);$.lastIndex=e.index,$.lastValues=Y,B.running.delete(F)}const L=M(n.args[1]);if(!L)return 0;const O=L.replace(/\s+/g,"_").toLowerCase();return((o=$.lastValues)==null?void 0:o[O])??NaN}const w=o6(g);if(w&&e.draw){const M=n.args[0];let F="";if(M&&M.kind==="Identifier"&&(F=M.name),M&&M.kind==="StringLiteral"&&(F=M.value),!F)return NaN;const B=e.draw.get(w.kind,w.prop,F,e.index);return typeof B=="string"?vv(B):typeof B=="number"&&Number.isFinite(B)?B:NaN}const C=s8(g);if(C){if(!e.strategy)return NaN;if(!n.args.length)throw new Tt(`${n.callee} expects (index)`);const M=_r(n.args[0],e),F=Number.isFinite(M)?Math.floor(M):NaN;return Number.isFinite(F)?o8(e,C.kind,C.prop,e.index,F):NaN}const P=n.args[0],I=n.args[1];if(g==="__hist_index"||g==="__arr_index"){if(n.args.length!==1)throw new Tt(`${n.callee} expects (index)`);const M=_r(P,e);return t?Z0(M,g==="__hist_index"?"history_index":"array_index",g==="__hist_index"?ay:CS,e):M}if(g==="__arr_index_str"){if(n.args.length!==1)throw new Tt(`${n.callee} expects (index)`);const M=_r(P,e);if(!t)return M;const F=`arr_idx_str:${Fd(n)}`;return h2(M,F,e)}if(g==="__arr_set_guard"){if(n.args.length!==2)throw new Tt(`${n.callee} expects (index, size)`);if(!t)return 1;const M=_r(P,e),F=_r(I,e),B=`arr_set_guard:${Fd(n)}`;return hw(M,F,B,e)}if(g==="__arr_str_valid"){if(n.args.length!==1)throw new Tt(`${n.callee} expects (value)`);if(!t)return 1;const M=o0(n.args[0]);return M||Ld(e,`arr_str_val:${Fd(n)}`,IS),M?1:0}if(g==="__str_num"){if(n.args.length!==1)throw new Tt(`${n.callee} expects (value)`);return _r(P,e)}if(g==="nz"){if(n.args.length<1||n.args.length>2)throw new Tt("nz expects (x[, fallback])");const M=_r(P,e);return Number.isFinite(M)?M:n.args.length===2?_r(I,e):0}if(g==="between"){if(n.args.length!==3)throw new Tt("between expects (x, a, b)");const M=_r(P,e),F=_r(I,e),B=_r(n.args[2],e);if(!Number.isFinite(M)||!Number.isFinite(F)||!Number.isFinite(B))return t?NaN:0;const $=Math.min(F,B),L=Math.max(F,B);return M>=$&&M<=L?1:0}if(g==="above"||g==="below"){if(n.args.length<2||n.args.length>3)throw new Tt(`${n.callee} expects (a, b[, tol])`);const M=_r(P,e),F=_r(I,e),B=n.args.length===3?_r(n.args[2],e):0,$=Number.isFinite(B)?Math.max(0,B):0;return!Number.isFinite(M)||!Number.isFinite(F)?t?NaN:0:g==="above"?M>F+$?1:0:M<F-$?1:0}if(g==="higherhigh"){const M=n.args.length>=1?Math.max(1,Math.floor(_r(n.args[0],e))):1,F=e.series.high;if(!F)throw new Tt("higherhigh requires high series");const B=F[e.index];if(!Number.isFinite(B))return t?NaN:0;const $=Math.max(0,e.index-M),L=fS(F,$,Math.max(0,e.index-1));return B>L?1:0}if(g==="lowerlow"){const M=n.args.length>=1?Math.max(1,Math.floor(_r(n.args[0],e))):1,F=e.series.low;if(!F)throw new Tt("lowerlow requires low series");const B=F[e.index];if(!Number.isFinite(B))return t?NaN:0;const $=Math.max(0,e.index-M),L=pS(F,$,Math.max(0,e.index-1));return B<L?1:0}if(g==="swinghigh"){const M=n.args.length>=1?Math.max(1,Math.floor(_r(n.args[0],e))):3,F=e.series.high;if(!F)throw new Tt("swinghigh requires high series");const B=F[e.index];if(!Number.isFinite(B))return t?NaN:0;for(let $=e.index-M;$<=e.index+M;$++){if($===e.index||$<0||$>=F.length)continue;const L=F[$];if(Number.isFinite(L)&&L>=B)return 0}return 1}if(g==="swinglow"){const M=n.args.length>=1?Math.max(1,Math.floor(_r(n.args[0],e))):3,F=e.series.low;if(!F)throw new Tt("swinglow requires low series");const B=F[e.index];if(!Number.isFinite(B))return t?NaN:0;for(let $=e.index-M;$<=e.index+M;$++){if($===e.index||$<0||$>=F.length)continue;const L=F[$];if(Number.isFinite(L)&&L<=B)return 0}return 1}if(g==="volspike"){const M=n.args.length>=1?Math.max(1,_r(n.args[0],e)):1,F=e.series.volume;if(!F)throw new Tt("volspike requires volume series");const B=F[e.index];if(!Number.isFinite(B))return t?NaN:0;const L=Math.max(0,e.index-20+1);let O=0,Y=0;for(let Q=L;Q<=e.index;Q++){const le=F[Q];Number.isFinite(le)&&(O+=le,Y+=1)}const ce=Y?O/Y:NaN;return Number.isFinite(ce)&&B>M*ce?1:0}if(g==="atrspike"){const M=n.args.length>=1?Math.max(1,_r(n.args[0],e)):1,F=e.series.high,B=e.series.low,$=e.series.close;if(!F||!B||!$)throw new Tt("atrspike requires high/low/close series");const L=ue=>{const fe=F[ue],pe=B[ue],Z=ue>0?$[ue-1]:NaN;let xe=Number.isFinite(fe)&&Number.isFinite(pe)?Math.max(0,fe-pe):NaN;return Number.isFinite(Z)&&(xe=Math.max(xe,Math.abs(fe-Z),Math.abs(pe-Z))),xe};let O=NaN,Y=0;for(let ue=0;ue<=e.index;ue++){const fe=L(ue);Y+=Number.isFinite(fe)?fe:0,ue===13?O=Y/14:ue>=14&&(O=(O*13+fe)/14)}let ce=NaN,Q=0,le=0;for(let ue=Math.max(0,e.index-13);ue<=e.index;ue++){const fe=L(ue);Number.isFinite(fe)&&(Q+=fe,le+=1)}return le&&(ce=Q/le),Number.isFinite(O)&&Number.isFinite(ce)&&O>M*ce?1:0}if(g==="trend"){const M=n.args[0],F=M&&M.kind==="StringLiteral"?M.value:M&&M.kind==="Identifier"?M.name:"",B=String(F||"").toLowerCase()||"up",$=e.series.close;if(!$)throw new Tt("trend requires close series");const O=Math.max(0,e.index-10+1);let Y=0,ce=0,Q=0,le=0,ue=0;for(let Z=O;Z<=e.index;Z++){const xe=Z-O,oe=$[Z];Number.isFinite(oe)&&(Y+=xe,ce+=oe,Q+=xe*xe,le+=xe*oe,ue+=1)}const fe=ue*Q-Y*Y,pe=fe===0||ue===0?0:(ue*le-Y*ce)/fe;return B==="up"?pe>0?1:0:pe<0?1:0}if(g==="iff"||g==="iif"||g==="if"){if(n.args.length!==3)throw new Tt(`${n.callee} expects (cond, a, b)`);if(t){const ce=i1(n.args[1]),Q=i1(n.args[2]);if(ce!==Q)return Ld(e,"ternary_type",SS),NaN}const M=n.args[0],F=t&&o0(M),B=t?Q0(M,e,"na"):void 0;F&&Ld(e,Q0(M,e,"type"),p2);const $=_r(P,e),L=F?!1:pw($,e,B),O=_r(n.args[1],e),Y=_r(n.args[2],e);return L?O:Y}if(g==="tostring"||g==="format"||g==="upper"||g==="lower"||g==="trim"||g==="replace"||g==="replace_all"||g==="contains"||g==="startswith"||g==="endswith"||g==="length"||g==="substring"||g==="repeat"){const M=$=>Number.isFinite($)?String($):"",F=$=>vv($),B=$=>{var Y;const L=n.args[$];if(!L)return"";if(L.kind==="StringLiteral")return L.value;if(L.kind==="Identifier"){const ce=L.name.replace(/\s+/g,"_").toLowerCase(),Q=(Y=e.strings)==null?void 0:Y[ce];if(typeof Q=="string")return Q}const O=_r(L,e);return M(O)};if(g==="tostring"){if(n.args.length<1||n.args.length>2)throw new Tt("tostring expects (x[, format])");const $=_r(n.args[0],e),L=n.args[1];let O="";if(L){if(L.kind==="StringLiteral")O=L.value;else if(L.kind==="Identifier"){const ce=L.name.replace(/\s+/g,"_").toLowerCase(),Q=(r=e.strings)==null?void 0:r[ce];typeof Q=="string"&&(O=Q)}}const Y=rw($,O||void 0);return F(Y)}if(g==="format"){if(n.args.length<1)throw new Tt("format expects (fmt, ...)");const $=B(0),L=n.args.slice(1).map(Y=>by(_r(Y,e))),O=$.replace(/\{(\d+)\}/g,(Y,ce)=>L[Number(ce)]??"");return F(O.replace(/{{/g,"{").replace(/}}/g,"}"))}if(g==="upper")return F(B(0).toUpperCase());if(g==="lower")return F(B(0).toLowerCase());if(g==="trim")return F(B(0).trim());if(g==="replace"||g==="replace_all"){if(n.args.length<3)throw new Tt("replace expects (s, from, to)");const $=B(0),L=B(1),O=B(2);return F($.split(L).join(O))}if(g==="contains"){if(n.args.length<2)throw new Tt("contains expects (s, sub)");const $=B(0),L=B(1);return $.includes(L)?1:0}if(g==="startswith"){if(n.args.length<2)throw new Tt("startswith expects (s, sub)");const $=B(0),L=B(1);return $.startsWith(L)?1:0}if(g==="endswith"){if(n.args.length<2)throw new Tt("endswith expects (s, sub)");const $=B(0),L=B(1);return $.endsWith(L)?1:0}if(g==="length"){if(n.args.length!==1)throw new Tt("length expects (s)");return B(0).length}if(g==="substring"){if(n.args.length<2)throw new Tt("substring expects (s, from[, to])");const $=B(0),L=_r(n.args[1],e),O=n.args.length>2?_r(n.args[2],e):NaN,Y=Math.max(0,Math.floor(L)),ce=Number.isFinite(O)?Math.max(Y,Math.floor(O)):void 0;return F(ce==null?$.slice(Y):$.slice(Y,ce))}if(g==="repeat"){if(n.args.length<2)throw new Tt("repeat expects (s, count)");const $=B(0),L=Math.max(0,Math.floor(_r(n.args[1],e)));return F($.repeat(L))}}if(g==="add"||g==="sub"||g==="mul"||g==="div"){if(n.args.length!==2)throw new Tt(`${n.callee} expects 2 arguments`);const M=_r(P,e),F=_r(I,e);return g==="add"?M+F:g==="sub"?M-F:g==="mul"?M*F:w_(M,F,t,e)}if(g==="mod"||g==="fmod"){if(!t)throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==2)throw new Tt(`${n.callee} expects 2 arguments`);const M=_r(P,e),F=_r(I,e);return g==="mod"?VS(M,F,!0,e):zS(M,F,!0,e)}if(g==="min"||g==="max"){if(n.args.length!==2)throw new Tt(`${n.callee} expects 2 arguments`);const M=_r(P,e),F=_r(I,e);return g==="min"?Math.min(M,F):Math.max(M,F)}if(g==="abs"){if(n.args.length!==1)throw new Tt("abs expects 1 argument");return Math.abs(_r(P,e))}if(g==="pow"){if(n.args.length!==2)throw new Tt("pow expects 2 arguments");const M=_r(P,e),F=_r(I,e);return mw(M,F,t,e)}if(g==="sqrt"||g==="log"||g==="ln"||g==="log10"||g==="exp"||g==="floor"||g==="ceil"||g==="round"||g==="sin"||g==="cos"||g==="tan"||g==="asin"||g==="acos"||g==="atan"||g==="sign"){if(n.args.length!==1)throw new Tt(`${n.callee} expects 1 argument`);const M=_r(P,e);switch(g){case"sqrt":return WS(M,t,e);case"log":case"ln":return HS(M,t,e);case"log10":return qS(M,t,e);case"exp":return KS(M,t);case"floor":return Math.floor(M);case"ceil":return Math.ceil(M);case"round":return Math.round(M);case"sin":return Math.sin(M);case"cos":return Math.cos(M);case"tan":return YS(M,t);case"asin":return US(M,t,e);case"acos":return GS(M,t,e);case"atan":return Math.atan(M);default:return Math.sign(M)}}if(g==="cum"||g==="cumsum"){if(n.args.length!==1)throw new Tt(`${n.callee} expects 1 argument`);const M=P;if(M.kind!=="Identifier")throw new Tt(`${n.callee} expects a series identifier`);const F=M.name.replace(/\s+/g,"_").toLowerCase(),B=e.series[F];if(!B)throw new Tt(`Unknown identifier "${M.name}"`);let $=0;for(let L=0;L<=e.index;L++){const O=B[L];Number.isFinite(O)&&($+=O)}return $}if(g==="barssince"){if(n.args.length!==1)throw new Tt("barssince expects (condition)");const M=P;if(M.kind!=="Identifier")throw new Tt("barssince expects a series identifier");const F=M.name.replace(/\s+/g,"_").toLowerCase(),B=e.series[F];if(!B)throw new Tt(`Unknown identifier "${M.name}"`);for(let $=e.index;$>=0;$--){const L=B[$];if(Number.isFinite(L)&&L!==0)return e.index-$}return NaN}if(g==="tr"){if(n.args.length!==0&&n.args.length!==3)throw new Tt("tr expects () or (high, low, close)");const M=(Q,le)=>{if(!Q){const pe=e.series[le];if(!pe)throw new Tt(`Unknown identifier "${le}"`);return pe}if(Q.kind!=="Identifier")throw new Tt("tr expects series identifiers");const ue=Q.name.replace(/\s+/g,"_").toLowerCase(),fe=e.series[ue];if(!fe)throw new Tt(`Unknown identifier "${Q.name}"`);return fe},F=M(n.args[0],"high"),B=M(n.args[1],"low"),$=M(n.args[2],"close"),L=F[e.index],O=B[e.index],Y=e.index>0?$[e.index-1]:NaN;let ce=Math.max(0,L-O);return Number.isFinite(Y)&&(ce=Math.max(ce,Math.abs(L-Y),Math.abs(O-Y))),ce}if(g==="prev"||g==="lag"||g==="change"){if(n.args.length!==2)throw new Tt(`${n.callee} expects (series, n)`);const M=P;if(M.kind!=="Identifier")throw new Tt(`${n.callee} expects first argument to be a series identifier`);const F=M.name.replace(/\s+/g,"_").toLowerCase(),B=_r(I,e),$=t?Z0(B,"history_index",ay,e):Math.max(1,Math.floor(B));if(!Number.isFinite($))return NaN;const L=e.index-$,O=Q=>{if(Q<0)return NaN;if(e.selfKey&&e.selfOut&&F===e.selfKey)return e.selfOut[Q]??NaN;const le=e.series[F];if(!le)throw new Tt(`Unknown identifier "${M.name}"`);return le[Q]??NaN};if(g==="prev"||g==="lag")return O(L);const Y=O(e.index),ce=O(L);return Number.isFinite(Y)&&Number.isFinite(ce)?Y-ce:NaN}if(g==="sum"){if(n.args.length!==2)throw new Tt("sum expects (series, period)");const M=U0(P,e);if(!M)throw new Tt("sum expects first argument to be a series identifier");const F=_r(I,e),B=t?Kp(F,`sum_len:${Fd(n)}`,jS,e):Math.max(1,Math.floor(F));return Number.isFinite(B)?xg(e,`sum:${B}:${Fd(P)}`,()=>Kv(M,B))[e.index]??NaN:NaN}if(g==="highest"||g==="lowest"){if(n.args.length!==2)throw new Tt(`${n.callee} expects (series, period)`);const M=U0(P,e);if(!M)throw new Tt(`${n.callee} expects first argument to be a series identifier`);const F=_r(I,e),B=`${g}_len:${Fd(n)}`,L=t?Kp(F,B,g==="highest"?DS:RS,e):Math.max(1,Math.floor(F));return Number.isFinite(L)?xg(e,`${g}:${L}:${Fd(P)}`,()=>g==="highest"?r1(M,L):a1(M,L))[e.index]??NaN:NaN}if(g==="rising"||g==="falling"){if(!t)throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==2)throw new Tt(`${n.callee} expects (series, length)`);const M=U0(P,e);if(!M)throw new Tt(`${n.callee} expects first argument to be a series identifier`);const F=_r(I,e),B=`${g}_len:${Fd(n)}`,L=Kp(F,B,g==="rising"?BS:OS,e);return Number.isFinite(L)?xg(e,`${g}:${L}:${Fd(P)}`,()=>dS(M,L,g))[e.index]??NaN:NaN}if(g==="crossover"||g==="crossunder"){if(n.args.length<2||n.args.length>3)throw new Tt(`${n.callee} expects (series, series[, tol])`);const M=P;if(M.kind!=="Identifier")throw new Tt(`${n.callee} expects first argument to be a series identifier`);const F=M.name.replace(/\s+/g,"_").toLowerCase(),B=e.series[F];if(!B)throw new Tt(`Unknown identifier "${M.name}"`);const $=n.args[1];let L=null,O=NaN;if($.kind==="Identifier"){const fe=$.name.replace(/\s+/g,"_").toLowerCase();if(L=e.series[fe]||null,!L){const pe=Number($.name);O=Number.isFinite(pe)?pe:NaN}}else O=_r($,e);const Y=n.args[2]?Math.max(0,_r(n.args[2],e)):0;if(e.index<=0)return 0;const ce=B[e.index-1],Q=B[e.index],le=L?L[e.index-1]:O,ue=L?L[e.index]:O;return[ce,Q,le,ue].every(Number.isFinite)?g==="crossover"?ce<=le+Y&&Q>ue+Y?1:0:ce>=le-Y&&Q<ue-Y?1:0:0}if(g==="williamsr"){if(!t)throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==1&&n.args.length!==4)throw new Tt("williamsr expects (length) or (high, low, close, length)");const M=n.args.length===1?_r(n.args[0],e):_r(n.args[3],e),F=Kp(M,"williamsr_len",PS,e);if(!Number.isFinite(F))return NaN;const B=n.args.length===1?e.series.high:U0(n.args[0],e),$=n.args.length===1?e.series.low:U0(n.args[1],e),L=n.args.length===1?e.series.close:U0(n.args[2],e);if(!B||!$||!L)throw new Tt("williamsr requires high/low/close series");const O=n.args.length===1?`williamsr:${F}`:`williamsr:${F}:${n.args.map(ce=>ce.kind==="Identifier"?ce.name:ce.kind==="NumberLiteral"||ce.kind==="StringLiteral"?ce.value:"expr").join("|")}`;return xg(e,O,()=>mS(B,$,L,F))[e.index]??NaN}if(g==="aroon"){if(!t)throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length<1||n.args.length>2)throw new Tt("aroon expects (length[, output])");const M=_r(n.args[0],e),F=Kp(M,"aroon_len",MS,e);if(!Number.isFinite(F))return NaN;const B=n.args[1]?Math.floor(_r(n.args[1],e)):0;if(!Number.isFinite(B)||B<0||B>1)throw new Tt("aroon output must be 0 or 1");const $=e.series.high,L=e.series.low;if(!$||!L)throw new Tt("aroon requires high/low series");const O=`aroon:${F}`,Y=v2(e,O,()=>{const Q=d2($,L,F);return{a:Q.up,b:Q.down}});return(B===0?Y.a:Y.b)[e.index]??NaN}if(g==="aroonosc"){if(!t)throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==1)throw new Tt("aroonosc expects (length)");const M=_r(n.args[0],e),F=Kp(M,"aroonosc_len",$S,e);if(!Number.isFinite(F))return NaN;const B=e.series.high,$=e.series.low;if(!B||!$)throw new Tt("aroonosc requires high/low series");const L=`aroon:${F}`,O=v2(e,L,()=>{const Q=d2(B,$,F);return{a:Q.up,b:Q.down}}),Y=O.a[e.index],ce=O.b[e.index];return Number.isFinite(Y)&&Number.isFinite(ce)?Y-ce:NaN}if(g==="dmi"){if(!t)throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length<2||n.args.length>3)throw new Tt("dmi expects (length, smoothing[, output])");const M=_r(n.args[0],e),F=_r(n.args[1],e),B=Kp(M,"dmi_len",NS,e),$=Kp(F,"dmi_smooth",AS,e);if(!Number.isFinite(B)||!Number.isFinite($))return NaN;const L=n.args[2]?Math.floor(_r(n.args[2],e)):0;if(!Number.isFinite(L)||L<0||L>2)throw new Tt("dmi output must be 0, 1, or 2");const O=e.series.high,Y=e.series.low,ce=e.series.close;if(!O||!Y||!ce)throw new Tt("dmi requires high/low/close series");const Q=`dmi:${B}:${$}`,le=Gb(e,Q,()=>{const fe=X0(O,Y,ce,B,$);return{a:fe.plus,b:fe.minus,c:fe.adx}});return(L===0?le.a:L===1?le.b:le.c)[e.index]??NaN}if(g==="plus_di"||g==="minus_di"||g==="dx"){if(!t)throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==1)throw new Tt(`${n.callee} expects (length)`);const M=_r(n.args[0],e),$=Kp(M,g==="plus_di"?"plus_di_len":g==="minus_di"?"minus_di_len":"dx_len",g==="plus_di"?FS:g==="minus_di"?LS:ES,e);if(!Number.isFinite($))return NaN;const L=e.series.high,O=e.series.low,Y=e.series.close;if(!L||!O||!Y)throw new Tt(`${g} requires high/low/close series`);const ce=`dmi:${$}:${$}`,Q=Gb(e,ce,()=>{const ue=X0(L,O,Y,$,$);return{a:ue.plus,b:ue.minus,c:ue.adx}});return g==="plus_di"?Q.a[e.index]??NaN:g==="minus_di"?Q.b[e.index]??NaN:xg(e,`dx:${$}`,()=>hS(Q.a,Q.b))[e.index]??NaN}if(g==="adx"){if(!t)throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==1)throw new Tt("adx expects (length)");const M=_r(n.args[0],e),F=Kp(M,"adx_len",TS,e);if(!Number.isFinite(F))return NaN;const B=e.series.high,$=e.series.low,L=e.series.close;if(!B||!$||!L)throw new Tt("adx requires high/low/close series");const O=`dmi:${F}:${F}`;return Gb(e,O,()=>{const ce=X0(B,$,L,F,F);return{a:ce.plus,b:ce.minus,c:ce.adx}}).c[e.index]??NaN}if(g==="valuewhen"){if(!(((a=e.scalars)==null?void 0:a.__pinev2)===1))throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==3)throw new Tt("valuewhen expects (condition, source, occurrence)");const F=n.args[0],B=o0(F);B&&Ld(e,Q0(F,e,"type"),p2);const $=n.args[2],L=`valuewhen_occ:${Fd(n)}`;if(aD($,e))return Ld(e,L,m2),NaN;const O=_r($,e),Y=Z0(O,L,m2,e);if(!Number.isFinite(Y)||B)return NaN;const ce=Q0(F,e,"na"),Q=pe=>y0(pe,e.diagnostics,ce),le=U0(F,e),ue=U0(n.args[1],e);if(le&&ue)return xg(e,`valuewhen:${Y}:${Fd(F)}:${Fd(n.args[1])}`,()=>vS(le,ue,Y,Q))[e.index]??NaN;let fe=0;for(let pe=e.index;pe>=0;pe--){const Z={...e,index:pe},xe=_r(F,Z);if(Q(xe)){if(fe===Y)return _r(n.args[1],Z);fe+=1}}return NaN}if(g==="pivothigh"||g==="pivotlow"){if(!(((l=e.scalars)==null?void 0:l.__pinev2)===1))throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==3)throw new Tt(`${n.callee} expects (source, left, right)`);const F=_r(n.args[1],e),B=_r(n.args[2],e),{left:$,right:L}=gS(F,B),O=e.index-L;if(O-$<0)return NaN;const Y=fe=>_r(n.args[0],{...e,index:fe}),ce=Y(O);if(!Number.isFinite(ce))return NaN;const Q=O-$,le=O+L,ue=g==="pivothigh";for(let fe=Q;fe<=le;fe++){const pe=Y(fe);if(!Number.isFinite(pe))return NaN;if(ue){if(pe>ce)return NaN}else if(pe<ce)return NaN}return ce}if(g==="isin"||g==="session_isin"||g==="session.isin"){if(!(((c=e.scalars)==null?void 0:c.__pinev2)===1))throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==2)throw new Tt("session.isin expects (time, session)");const F=n.args[1];if(!F||F.kind!=="StringLiteral")throw new Tt(f2);const{start:B,end:$}=kS(F.value),L=_r(n.args[0],e);if(!Number.isFinite(L))throw new Tt(cw);const O=uw(L);return dw(O,B,$)?1:0}if(g==="year"||g==="month"||g==="dayofweek"||g==="hour"||g==="minute"||g==="second"){if(!(((f=e.scalars)==null?void 0:f.__pinev2)===1))throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==1)throw new Tt(`${n.callee} expects (time)`);const F=_r(n.args[0],e);return K0(F),g==="dayofweek"?aw(F):lw(F,g==="year"||g==="month"?g:g==="hour"?"hour":g==="minute"?"minute":"second")}if(g==="timestamp"){if(!(((u=e.scalars)==null?void 0:u.__pinev2)===1))throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length<5||n.args.length>6)throw new Tt("timestamp expects (year, month, day, hour, minute[, second])");const F=_r(n.args[0],e),B=_r(n.args[1],e),$=_r(n.args[2],e),L=_r(n.args[3],e),O=_r(n.args[4],e),Y=n.args[5]?_r(n.args[5],e):0;return bS(F,B,$,L,O,Y)}if(g==="timenow"){if(!(((d=e.scalars)==null?void 0:d.__pinev2)===1))throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==0)throw new Tt("timenow expects ()");return wS(e)}if(g==="time_close"){if(!(((h=e.scalars)==null?void 0:h.__pinev2)===1))throw new Tt(`Unknown function "${n.callee}"`);if(n.args.length!==0)throw new Tt("time_close expects ()");const F=e.series.time;if(!F)throw new Tt("time_close requires time series");const B=xS(e),$=F[e.index];return Number.isFinite($)?$+B:NaN}const A={length:e.length,series:e.series,seriesNames:new Set(Object.keys(e.series)),scalars:e.scalars,strings:e.strings,diagnostics:e.diagnostics,draw:e.draw,strategy:e.strategy,loopRuntime:e.loopRuntime,funcRuntime:e.funcRuntime};try{const M=`call:${Fd(n)}`;return xg(e,M,()=>{const B=e8(n,A);if(B.kind==="series")return B.value;const $=new Float32Array(e.length);return $.fill(B.value),$})[e.index]??NaN}catch(M){if(M instanceof Tt)throw M}throw new Tt(`Unknown function "${n.callee}"`)}default:return NaN}}function Dk(n,e,t,s,o){var P;const r=Object.entries(e),a=((P=r[0])==null?void 0:P[1].length)??0;for(const[,I]of r)if(I.length!==a)throw new Tt("All base series must have the same length");const l=(()=>{if(!t||typeof t!="object")return;const I={};return Object.entries(t).forEach(([A,M])=>{const F=A.replace(/\s+/g,"_").toLowerCase();if(typeof M=="number"&&Number.isFinite(M)){I[F]=M;return}if(typeof M=="string"){const B=Number(M);I[F]=Number.isFinite(B)?B:vv(M)}}),Object.keys(I).length?I:void 0})(),c=(()=>{if(!t||typeof t!="object")return;const I={};return Object.entries(t).forEach(([A,M])=>{typeof M=="string"&&(I[A.replace(/\s+/g,"_").toLowerCase()]=M)}),Object.keys(I).length?I:void 0})(),f=n.map(I=>{const A=I.name.replace(/\s+/g,"_").toLowerCase();try{const M=I.initExpr?Lp(I.initExpr):null,F=Lp(I.updateExpr);return{name:A,initAst:M,updateAst:F,initExpr:I.initExpr,updateExpr:I.updateExpr,selfMode:I.selfMode}}catch(M){throw M instanceof Zv?new Tt(`Syntax error in series "${I.name}" at position ${M.position}: ${M.message}`):M}}),u=(()=>{if(!(o!=null&&o.autoSort)||f.length<=1)return f;const I=new Set(f.map(ue=>ue.name)),A={},M={},F=new Map;f.forEach((ue,fe)=>{A[ue.name]=new Set,M[ue.name]=new Set,F.set(ue.name,fe)});const B=ue=>ue.replace(/\s+/g,"_").toLowerCase(),$=ue=>{const fe=new Set,pe=(Z,xe)=>{switch(Z.kind){case"Identifier":{const oe=B(Z.name);xe||fe.add(oe);break}case"BinaryExpression":pe(Z.left,xe),pe(Z.right,xe);break;case"UnaryExpression":pe(Z.expr,xe);break;case"CallExpression":{const oe=String(Z.callee||"").toLowerCase(),Pe=oe==="prev"||oe==="lag";Z.args.forEach(($e,ze)=>{pe($e,xe||Pe&&ze===0)});break}}};return ue&&pe(ue,!1),{direct:fe}},L=(ue,fe)=>{if(!fe)return;const{direct:pe}=$(fe);pe.forEach(Z=>{!I.has(Z)||Z===ue||(A[ue].add(Z),M[Z].add(ue))})};f.forEach(ue=>{L(ue.name,ue.updateAst),L(ue.name,ue.initAst)});const O={};Object.keys(A).forEach(ue=>{var fe;O[ue]=((fe=A[ue])==null?void 0:fe.size)??0});const Y=Object.keys(O).filter(ue=>(O[ue]||0)===0);Y.sort((ue,fe)=>(F.get(ue)??0)-(F.get(fe)??0));const ce=[],Q=ue=>{const fe=Y.findIndex(pe=>(F.get(pe)??0)>(F.get(ue)??0));fe===-1?Y.push(ue):Y.splice(fe,0,ue)};for(;Y.length;){const ue=Y.shift();ce.push(ue);const fe=Array.from(M[ue]||[]).sort((pe,Z)=>(F.get(pe)??0)-(F.get(Z)??0));for(const pe of fe)O[pe]=(O[pe]||0)-1,O[pe]===0&&Q(pe)}if(ce.length!==f.length){const ue=f.map(fe=>fe.name).filter(fe=>!ce.includes(fe));throw new Tt(`Circular dependency detected among state series: ${ue.join(" -> ")}`)}const le={};return f.forEach(ue=>{le[ue.name]=ue}),ce.map(ue=>le[ue])})(),d={},h={...e},m=new Set(Object.keys(e));for(const I of f){if(m.has(I.name))throw new Tt(`Series name "${I.name}" conflicts with an existing base series`);if(h[I.name])d[I.name]||(d[I.name]=h[I.name]);else{const A=new Float32Array(a);A.fill(NaN),h[I.name]=A,d[I.name]=A}}const g=o==null?void 0:o.diagnostics,w=$2(o==null?void 0:o.loopPlans,l,!!(o!=null&&o.userFunctions)),C=D2(o==null?void 0:o.userFunctions);for(let I=0;I<a;I++)for(const A of u){const M=d[A.name],F={series:h,scalars:l,strings:c,diagnostics:g,length:a,index:I,selfKey:A.name,selfOut:M,selfMode:A.selfMode,strategy:s,loopRuntime:w,funcRuntime:C},B=I===0&&A.initAst?A.initAst:A.updateAst,$=_r(B,F);M[I]=$}return d}function yb(n,e,t,s,o,r){var w;const a=Object.entries(e),l=((w=a[0])==null?void 0:w[1].length)??0;for(const[,C]of a)if(C.length!==l)throw new Tt("All base series must have the same length");const c=(()=>{if(!t||typeof t!="object")return;const C={};return Object.entries(t).forEach(([P,I])=>{const A=P.replace(/\s+/g,"_").toLowerCase();if(typeof I=="number"&&Number.isFinite(I)){C[A]=I;return}if(typeof I=="string"){const M=Number(I);C[A]=Number.isFinite(M)?M:vv(I)}}),Object.keys(C).length?C:void 0})(),f=(()=>{if(!t||typeof t!="object")return;const C={};return Object.entries(t).forEach(([P,I])=>{typeof I=="string"&&(C[P.replace(/\s+/g,"_").toLowerCase()]=I)}),Object.keys(C).length?C:void 0})(),u=$2(r==null?void 0:r.loopPlans,c,!!(r!=null&&r.userFunctions)),d=D2(r==null?void 0:r.userFunctions);let h;try{h=Lp(n)}catch(C){throw C instanceof Zv?new Tt(`Syntax error at position ${C.position}: ${C.message}`):C}const m=new Float32Array(l),g=new Map;for(let C=0;C<l;C++){const P={series:e,scalars:c,strings:f,diagnostics:o,memo:g,length:l,index:C,strategy:s,loopRuntime:u,funcRuntime:d};m[C]=_r(h,P)}return m}function YD(n,e,t,s,o,r,a,l){var P;const c=Object.entries(e),f=((P=c[0])==null?void 0:P[1].length)??0;if(s<0||s>=f)return NaN;for(const[,I]of c)if(I.length!==f)throw new Tt("All base series must have the same length");const u=(()=>{if(!t||typeof t!="object")return;const I={};return Object.entries(t).forEach(([A,M])=>{const F=A.replace(/\s+/g,"_").toLowerCase();if(typeof M=="number"&&Number.isFinite(M)){I[F]=M;return}if(typeof M=="string"){const B=Number(M);I[F]=Number.isFinite(B)?B:vv(M)}}),Object.keys(I).length?I:void 0})(),d=(()=>{if(!t||typeof t!="object")return;const I={};return Object.entries(t).forEach(([A,M])=>{typeof M=="string"&&(I[A.replace(/\s+/g,"_").toLowerCase()]=M)}),Object.keys(I).length?I:void 0})(),h=$2(l==null?void 0:l.loopPlans,u,!!(l!=null&&l.userFunctions)),m=D2(l==null?void 0:l.userFunctions);let g;if(typeof n=="string")try{g=Lp(n)}catch(I){throw I instanceof Zv?new Tt(`Syntax error at position ${I.position}: ${I.message}`):I}else g=n;return _r(g,{series:e,scalars:u,strings:d,diagnostics:a,memo:new Map,length:f,index:s,draw:o,strategy:r,loopRuntime:h,funcRuntime:m})}function Rk(n,e){var a,l;const t=n.replace(/\s+/g,"_").toLowerCase();if(t==="na"||t==="nan")return NaN;if(t==="pi")return Math.PI;if(t==="e")return Math.E;if(e.locals&&Object.prototype.hasOwnProperty.call(e.locals,t))return e.locals[t];const s=e.series[t];if(s)return s[e.index]??NaN;const o=(a=e.strings)==null?void 0:a[t];if(typeof o=="string")return o;const r=(l=e.scalars)==null?void 0:l[t];if(typeof r=="number"&&Number.isFinite(r))return r;throw new Tt(`Unknown identifier "${n}"`)}function up(n,e,t,s){var f;const o=((f=t.scalars)==null?void 0:f.__pinev2)===1,r=u=>typeof u=="number"?u:vv(u),a=u=>typeof u=="string"?u:Number.isFinite(u)?String(u):"",l=(u,d)=>typeof u=="string"?u:rw(u,d),c=u=>{let d=s.get(u);return d||(d=s0(u,t),s.set(u,d)),d.kind==="scalar"?d.value:d.value[e.index]??NaN};switch(n.kind){case"NumberLiteral":return n.value;case"StringLiteral":return n.value;case"Identifier":return Rk(n.name,e);case"MemberExpression":{const u=S_(n);return u?Rk(u,e):(Jw(t,n),NaN)}case"IndexExpression":return Qw(t,n),NaN;case"UnaryExpression":{if(n.operator==="not"){const u=r(up(n.expr,e,t,s));return Number.isFinite(u)&&u!==0?0:1}return NaN}case"BinaryExpression":{const u=up(n.left,e,t,s),d=up(n.right,e,t,s);if(n.operator==="+")return typeof u=="string"||typeof d=="string"?`${a(u)}${a(d)}`:r(u)+r(d);const h=r(u),m=r(d);if(o&&E2(n.operator)&&(!Number.isFinite(h)||!Number.isFinite(m)))return NaN;switch(n.operator){case"-":return h-m;case"*":return h*m;case"/":return w_(h,m,o,t);case"%":return m===0?NaN:h%m;case">":return Number.isFinite(h)&&Number.isFinite(m)&&h>m?1:0;case"<":return Number.isFinite(h)&&Number.isFinite(m)&&h<m?1:0;case">=":return Number.isFinite(h)&&Number.isFinite(m)&&h>=m?1:0;case"<=":return Number.isFinite(h)&&Number.isFinite(m)&&h<=m?1:0;case"==":return Number.isFinite(h)&&Number.isFinite(m)&&Math.abs(h-m)<1e-9?1:0;case"!=":return Number.isFinite(h)&&Number.isFinite(m)&&Math.abs(h-m)>=1e-9?1:0;case"and":return Number.isFinite(h)&&h!==0&&Number.isFinite(m)&&m!==0?1:0;case"or":return Number.isFinite(h)&&h!==0||Number.isFinite(m)&&m!==0?1:0;default:return NaN}}case"CallExpression":{const u=i6(n.callee.toLowerCase(),o),d=o6(u);if(d&&e.draw){const h=n.args[0];let m="";if(h&&h.kind==="Identifier"&&(m=h.name),h&&h.kind==="StringLiteral"&&(m=h.value),!m)return"";const g=e.draw.get(d.kind,d.prop,m,e.index);return g??""}if(u==="iff"||u==="iif"||u==="if"){if(n.args.length!==3)throw new Tt(`${n.callee} expects (cond, a, b)`);const h=r(up(n.args[0],e,t,s)),m=o?Number.isFinite(h)&&h!==0:h!==0;return up(m?n.args[1]:n.args[2],e,t,s)}if(u==="tostring"){if(n.args.length<1||n.args.length>2)throw new Tt("tostring expects (x[, format])");const h=up(n.args[0],e,t,s);let m;if(n.args[1]){const g=up(n.args[1],e,t,s);m=typeof g=="string"?g:String(g)}return l(h,m)}if(u==="format"){if(n.args.length<1)throw new Tt("format expects (fmt, ...)");const h=up(n.args[0],e,t,s),m=a(h),g=n.args.slice(1).map(C=>up(C,e,t,s));return m.replace(/\{(\d+)(?:,([^,}]+))?(?:,([^}]+))?\}/g,(C,P,I,A)=>{const M=Number(P),F=g[M];return F==null?"":typeof F=="number"?I&&String(I).trim().toLowerCase()==="number"?rw(F,String(A??"")):by(F):String(F)}).replace(/{{/g,"{").replace(/}}/g,"}")}if(u==="upper")return a(up(n.args[0],e,t,s)).toUpperCase();if(u==="lower")return a(up(n.args[0],e,t,s)).toLowerCase();if(u==="trim")return a(up(n.args[0],e,t,s)).trim();if(u==="replace"||u==="replace_all"){if(n.args.length<3)throw new Tt("replace expects (s, from, to)");const h=a(up(n.args[0],e,t,s)),m=a(up(n.args[1],e,t,s)),g=a(up(n.args[2],e,t,s));return h.split(m).join(g)}if(u==="contains"){if(n.args.length<2)throw new Tt("contains expects (s, sub)");const h=a(up(n.args[0],e,t,s)),m=a(up(n.args[1],e,t,s));return h.includes(m)?1:0}if(u==="startswith"){if(n.args.length<2)throw new Tt("startswith expects (s, sub)");const h=a(up(n.args[0],e,t,s)),m=a(up(n.args[1],e,t,s));return h.startsWith(m)?1:0}if(u==="endswith"){if(n.args.length<2)throw new Tt("endswith expects (s, sub)");const h=a(up(n.args[0],e,t,s)),m=a(up(n.args[1],e,t,s));return h.endsWith(m)?1:0}if(u==="length"){if(n.args.length!==1)throw new Tt("length expects (s)");return a(up(n.args[0],e,t,s)).length}if(u==="substring"){if(n.args.length<2)throw new Tt("substring expects (s, from[, to])");const h=a(up(n.args[0],e,t,s)),m=r(up(n.args[1],e,t,s)),g=n.args.length>2?r(up(n.args[2],e,t,s)):NaN,w=Math.max(0,Math.floor(m)),C=Number.isFinite(g)?Math.max(w,Math.floor(g)):void 0;return C==null?h.slice(w):h.slice(w,C)}if(u==="repeat"){if(n.args.length<2)throw new Tt("repeat expects (s, count)");const h=a(up(n.args[0],e,t,s)),m=r(up(n.args[1],e,t,s)),g=Math.max(0,Math.floor(m));return h.repeat(g)}return c(n)}default:return c(n)}}function jk(n,e,t,s,o){var m;const r=Object.entries(e),a=((m=r[0])==null?void 0:m[1].length)??0;for(const[,g]of r)if(g.length!==a)throw new Tt("All base series must have the same length");const l=(()=>{if(!t||typeof t!="object")return;const g={};return Object.entries(t).forEach(([w,C])=>{const P=w.replace(/\s+/g,"_").toLowerCase();if(typeof C=="number"&&Number.isFinite(C)){g[P]=C;return}if(typeof C=="string"){const I=Number(C);g[P]=Number.isFinite(I)?I:vv(C)}}),Object.keys(g).length?g:void 0})(),c=(()=>{if(!t||typeof t!="object")return;const g={};return Object.entries(t).forEach(([w,C])=>{typeof C=="string"&&(g[w.replace(/\s+/g,"_").toLowerCase()]=C)}),Object.keys(g).length?g:void 0})();let f;try{f=Lp(n)}catch(g){throw g instanceof Zv?new Tt(`Syntax error at position ${g.position}: ${g.message}`):g}const u={length:a,series:e,seriesNames:new Set(Object.keys(e)),scalars:l,diagnostics:o,strategy:s},d=new WeakMap,h=new Array(a);for(let g=0;g<a;g++){const C=up(f,{series:e,scalars:l,strings:c,length:a,index:g,strategy:s},u,d);typeof C=="string"?h[g]=C:h[g]=by(C)}return h}function KD(n,e,t,s,o,r){var w;const a=Object.entries(e),l=((w=a[0])==null?void 0:w[1].length)??0;if(s<0||s>=l)return"";for(const[,C]of a)if(C.length!==l)throw new Tt("All base series must have the same length");const c=(()=>{if(!t||typeof t!="object")return;const C={};return Object.entries(t).forEach(([P,I])=>{const A=P.replace(/\s+/g,"_").toLowerCase();if(typeof I=="number"&&Number.isFinite(I)){C[A]=I;return}if(typeof I=="string"){const M=Number(I);C[A]=Number.isFinite(M)?M:vv(I)}}),Object.keys(C).length?C:void 0})(),f=(()=>{if(!t||typeof t!="object")return;const C={};return Object.entries(t).forEach(([P,I])=>{typeof I=="string"&&(C[P.replace(/\s+/g,"_").toLowerCase()]=I)}),Object.keys(C).length?C:void 0})();let u;if(typeof n=="string")try{u=Lp(n)}catch(C){throw C instanceof Zv?new Tt(`Syntax error at position ${C.position}: ${C.message}`):C}else u=n;const d={length:l,series:e,seriesNames:new Set(Object.keys(e)),scalars:c,strategy:r},g=up(u,{series:e,scalars:c,strings:f,length:l,index:s,draw:o,strategy:r},d,new WeakMap);return typeof g=="string"?g:by(g)}function bb(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){const r=o-e;s[o]=r>=0?n[r]:NaN}return s}const Xb=n=>/[A-Za-z_$]/.test(n),Zb=n=>/[A-Za-z0-9_$]/.test(n);function XD(n){return String(n||"").replace(/\u00A0/g," ")}function r6(n){const e=String(n||"");let t="",s=null,o=!1;for(let r=0;r<e.length;r++){const a=e[r],l=e[r+1];if(s){if(t+=a,o){o=!1;continue}if(a==="\\"){o=!0;continue}a===s&&(s=null);continue}if(a==="'"||a==='"'){s=a,t+=a;continue}if(a==="/"&&l==="/"){for(r+=1;r+1<e.length;){const c=e[r+1];if(c===`
`||c==="\r")break;r+=1}continue}t+=a}return t}function ZD(n,e){const t=String(n||""),s=t.length;let o="",r=null,a=0;for(;a<s;){const l=t[a];if(r){o+=l,l===r&&t[a-1]!=="\\"&&(r=null),a+=1;continue}if(l==="'"||l==='"'){r=l,o+=l,a+=1;continue}if(Xb(l)){let c=a+1;for(;c<s&&Zb(t[c]);)c+=1;const f=t.slice(a,c),u=f.toLowerCase();let d=c;for(;d<s&&/\s/.test(t[d]);)d+=1;if(t[d]==="."){let h=d+1;for(;h<s&&/\s/.test(t[h]);)h+=1;if(h<s&&Xb(t[h])){let m=h+1;for(;m<s&&Zb(t[m]);)m+=1;const g=t.slice(h,m),w=g.toLowerCase();if(u==="strategy"&&(w==="closedtrades"||w==="opentrades")){let P=m;for(;P<s&&/\s/.test(t[P]);)P+=1;if(t[P]==="."){let I=P+1;for(;I<s&&/\s/.test(t[I]);)I+=1;if(I<s&&Xb(t[I])){let A=I+1;for(;A<s&&Zb(t[A]);)A+=1;const M=t.slice(I,A);o+=`strategy_${w}_${M}`,a=A;continue}}}if(u==="barstate"||u==="timeframe"||u==="syminfo"||u==="strategy"){o+=`${u}_${g}`,a=m;continue}if(e){if(u==="ta"||u==="math"||u==="session"||u==="color"){o+=`${u}_${g}`,a=m;continue}}else if(u==="ta"||u==="math"){o+=g,a=m;continue}}}o+=f,a=c;continue}o+=l,a+=1}return o}function JD(n,e){const t=String(n||"");let s="",o=null,r=0;for(;r<t.length;){const a=t[r];if(o){s+=a,a===o&&t[r-1]!=="\\"&&(o=null),r+=1;continue}if(a==="'"||a==='"'){o=a,s+=a,r+=1;continue}if(Xb(a)){let l=r+1;for(;l<t.length&&Zb(t[l]);)l+=1;const c=t.slice(r,l);let f=r-1;for(;f>=0&&/\s/.test(t[f]);)f-=1;if(f>=0&&t[f]==="."){s+=c,r=l;continue}let u=l;for(;u<t.length&&/\s/.test(t[u]);)u+=1;if(t[u]==="["&&e){let d=0,h=u,m=null;for(;h<t.length;h++){const g=t[h];if(m){g===m&&t[h-1]!=="\\"&&(m=null);continue}if(g==="'"||g==='"'){m=g;continue}if(g==="[")d+=1;else if(g==="]"&&(d-=1,d===0))break}if(h<t.length&&d===0){const g=t.slice(u+1,h).trim();if(g){s+=`prev(${c}, __hist_index(${g}))`,r=h+1;continue}}}else if(t[u]==="["){let d=u+1;for(;d<t.length&&/\s/.test(t[d]);)d+=1;let h=1;t[d]==="-"&&(h=-1,d+=1);let m=d;for(;m<t.length&&/[0-9]/.test(t[m]);)m+=1;const g=t.slice(d,m);for(;m<t.length&&/\s/.test(t[m]);)m+=1;if(g&&t[m]==="]"){const w=h*Number(g);if(Number.isFinite(w)&&w>=1){s+=`prev(${c}, ${Math.floor(w)})`,r=m+1;continue}if(Number.isFinite(w)&&w===0){s+=c,r=m+1;continue}}}s+=c,r=l;continue}s+=a,r+=1}return s}function QD(n){if(!n)return 0;let e=2166136261;for(let s=0;s<n.length;s++)e^=n.charCodeAt(s),e=Math.imul(e,16777619);const t=e>>>0;return t===0?1:t}function eR(n){const e=String(n||"");let t="",s=0;for(;s<e.length;){const o=e[s];if(o==='"'||o==="'"){const r=o;s+=1;let a="",l=!1;for(;s<e.length;){const c=e[s];if(l){a+=c,l=!1,s+=1;continue}if(c==="\\"){l=!0,s+=1;continue}if(c===r){s+=1;break}a+=c,s+=1}t+=String(QD(a));continue}t+=o,s+=1}return t}function e1(n,e){const t=!!(e!=null&&e.pineV2);let s=XD(String(n||""));return s=r6(s),s=ZD(s,t),t||(s=eR(s)),s=JD(s,t),{expr:s}}function A0(n){return!Number.isFinite(n)||n<=0?0:n<1e11?n*1e3:n}function tR(n){const e=new Date(n);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0)}function nR(n){const e=new Date(n);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),1,0,0,0,0)}function sR(n){const e=String(n||"").trim(),t=e.toUpperCase();if(!t)return null;if(t==="D"||t==="1D")return{kind:"calendar",unit:"D"};if(t==="W"||t==="1W")return{kind:"calendar",unit:"W"};if(e==="M"||e==="1M")return{kind:"calendar",unit:"M"};if(/^\d+$/.test(t))return{kind:"fixed",ms:Math.max(1,Number(t))*60*1e3};const s=t.match(/^(\d+)\s*([A-Z]+)$/);if(s){const o=Math.max(1,Number(s[1])),r=s[2];if(r==="S"||r==="SEC"||r==="SECS"||r==="SECOND"||r==="SECONDS")return{kind:"fixed",ms:o*1e3};if(r==="H"||r==="HR"||r==="HRS")return{kind:"fixed",ms:o*60*60*1e3};if(r==="MIN"||r==="MINS")return{kind:"fixed",ms:o*60*1e3};if(r==="M"&&e.toLowerCase().endsWith("m"))return{kind:"fixed",ms:o*60*1e3};if(r==="D"||r==="DAY"||r==="DAYS")return{kind:"fixed",ms:o*24*60*60*1e3};if(r==="W"||r==="WK"||r==="WEEK"||r==="WEEKS")return{kind:"fixed",ms:o*7*24*60*60*1e3}}return null}const Bk=new Map,Ok=new Map;function oR(n){const e=n||"UTC",t=Bk.get(e);if(t)return t;const s=new Intl.DateTimeFormat("en-GB",{timeZone:e,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return Bk.set(e,s),s}function iR(n){const e=n||"UTC",t=Ok.get(e);if(t)return t;const s=new Intl.DateTimeFormat("en-GB",{timeZone:e,weekday:"short"});return Ok.set(e,s),s}function R2(n,e){if(!Number.isFinite(n))return null;const s=oR(e).formatToParts(new Date(n)),o={};for(const d of s)(d.type==="year"||d.type==="month"||d.type==="day"||d.type==="hour"||d.type==="minute"||d.type==="second")&&(o[d.type]=d.value);const r=Number(o.year),a=Number(o.month),l=Number(o.day),c=Number(o.hour),f=Number(o.minute),u=Number(o.second);return[r,a,l,c,f,u].every(d=>Number.isFinite(d))?{y:r,m:a,d:l,h:c,min:f,s:u}:null}function rR(n,e){const s=iR(e).format(new Date(n));return{Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6}[s]??null}function y2(n,e){const t=R2(n,e);return t?Date.UTC(t.y,t.m-1,t.d,t.h,t.min,t.s,0)-n:0}function i8(n,e){const t=R2(n,e);if(!t)return tR(n);let s=Date.UTC(t.y,t.m-1,t.d,0,0,0,0);const o=y2(s,e);s=s-o;const r=y2(s,e);return s-r}function aR(n,e){const t=i8(n,e),s=rR(n,e);return t-(typeof s=="number"?s:0)*24*60*60*1e3}function lR(n,e){const t=R2(n,e);if(!t)return nR(n);let s=Date.UTC(t.y,t.m-1,1,0,0,0,0);const o=y2(s,e);s=s-o;const r=y2(s,e);return s-r}function V1(n,e,t){if(!e)return n;if(e.kind==="fixed")return Math.floor(n/e.ms)*e.ms;const s=t||"UTC";return e.unit==="D"?i8(n,s):e.unit==="W"?aR(n,s):lR(n,s)}function cR(n){const e=String(n||"").trim();if(!e)return[];if(e.toLowerCase()==="24x7"||e==="0000-2359")return[];const t=e.split(/[;,]/).map(o=>o.trim()).filter(Boolean),s=[];for(const o of t){const r=o.match(/(\d{1,2}):?(\d{2})\s*-\s*(\d{1,2}):?(\d{2})/);if(!r)continue;const a=Number(r[1]),l=Number(r[2]),c=Number(r[3]),f=Number(r[4]);if([a,l,c,f].some(h=>!Number.isFinite(h)))continue;const u=a*60+l,d=c*60+f;s.push({start:u,end:d})}return s}function Jb(n,e,t){const s=cR(e);if(!s.length)return!0;const r=R2(n,t||"UTC");if(!r)return!0;const a=r.h*60+r.min;for(const l of s)if(l.start<=l.end){if(a>=l.start&&a<=l.end)return!0}else if(a>=l.start||a<=l.end)return!0;return!1}function zk(n){const e=[];let t=null;for(let s=0;s<n.length;s++){const o=A0(n[s]??0);if(o){if(t!=null){const r=o-t;r>0&&Number.isFinite(r)&&e.push(r)}if(t=o,e.length>=200)break}}return e.length<3?null:(e.sort((s,o)=>s-o),e[Math.floor(e.length/2)]??null)}function uR(n,e){let t=0,s=n.length;for(;t<s;){const o=t+s>>>1;n[o]>e?s=o:t=o+1}return t}function dR(n){const e=n.length,t=new Float32Array(e),s=new Float32Array(e),o=new Float32Array(e),r=new Float32Array(e),a=new Float32Array(e),l=new Float32Array(e);for(let c=0;c<e;c++){const f=n[c],u=A0((f==null?void 0:f.timestamp)??(f==null?void 0:f.time)??(f==null?void 0:f.t)??0),d=Number(f==null?void 0:f.close),h=Number(f==null?void 0:f.open),m=Number(f==null?void 0:f.high),g=Number(f==null?void 0:f.low);t[c]=Number.isFinite(h)?h:Number.isFinite(d)?d:NaN,r[c]=Number.isFinite(d)?d:NaN,s[c]=Number.isFinite(m)?m:Number.isFinite(d)?d:t[c],o[c]=Number.isFinite(g)?g:Number.isFinite(d)?d:t[c];const w=Number(f==null?void 0:f.volume);a[c]=Number.isFinite(w)?w:0,l[c]=u||0}return{open:t,high:s,low:o,close:r,volume:a,time:l}}function fR(n){var O,Y,ce,Q;const e=n.timestamps.length,t=n.lookahead||"off",s=n.gaps||"off",o=String(n.timeframe||"").trim(),r=((O=n.scalars)==null?void 0:O.__pinev2)===1,a=String(n.expr||"close"),l=le=>r?e1(le,{pineV2:!0}).expr:String(le??"");if(/\b(?:request\.)?security(?:_lower_tf)?\s*\(/i.test(a))throw new Error("request.security: nested request.security inside security expression is not supported");if(!o||o.toLowerCase()==="current"||o==="__CURRENT__"){const le={open:new Float32Array(e),high:new Float32Array(e),low:new Float32Array(e),close:new Float32Array(e),volume:new Float32Array(e),time:new Float32Array(e)};for(let Z=0;Z<e;Z++)le.open[Z]=n.open[Z]??NaN,le.high[Z]=n.high[Z]??NaN,le.low[Z]=n.low[Z]??NaN,le.close[Z]=n.close[Z]??NaN,le.volume[Z]=((Y=n.volume)==null?void 0:Y[Z])??0,le.time[Z]=A0(n.timestamps[Z]??0);const fe=__([{name:"__out",expr:l(a)}],le,n.scalars,void 0,void 0,{userFunctions:n.userFunctions}).__out||new Float32Array(e),pe=new Array(e);for(let Z=0;Z<e;Z++){const xe=fe[Z],oe=A0(n.timestamps[Z]??0);if(s==="on"&&!Jb(oe,n.session,n.timezone)){pe[Z]=void 0;continue}pe[Z]=Number.isFinite(xe)?xe:void 0}return pe}const c=sR(o);if(!c)throw new Error(`request.security: invalid timeframe "${o}"`);if(n.sourceCandles&&n.sourceCandles.length>1){const le=n.sourceCandles,ue=le.length,fe=dR(le),Z=__([{name:"__out",expr:l(a)}],fe,n.scalars,void 0,void 0,{userFunctions:n.userFunctions}).__out||new Float32Array(ue),xe=fe.time,oe=zk(n.timestamps),Pe=new Array(e);for(let Ke=0;Ke<e;Ke++){const qe=A0(n.timestamps[Ke]??0);if(!qe){Pe[Ke]=-1;continue}let nt=qe;if(Ke+1<e){const ut=A0(n.timestamps[Ke+1]??0);ut&&ut>qe&&(nt=ut-1)}else oe!=null&&oe>0&&(nt=qe+oe-1);const ft=uR(xe,nt);Pe[Ke]=ft-1}const $e=new Array(e);for(let Ke=0;Ke<e;Ke++){const qe=Pe[Ke],nt=Ke+1<e?Pe[Ke+1]:qe;$e[Ke]=qe>=0&&Ke+1<e&&qe!==nt}const ze=new Array(e);for(let Ke=0;Ke<e;Ke++){const qe=Pe[Ke];if(qe<0||qe>=ue){ze[Ke]=void 0;continue}const nt=A0(n.timestamps[Ke]??0);if(s==="on"&&!Jb(nt,n.session,n.timezone)){ze[Ke]=void 0;continue}const ft=t==="on"||$e[Ke]?Z[qe]:qe>0?Z[qe-1]:NaN;let ut=Number.isFinite(ft)?ft:void 0;if(s==="on"){const bt=V1(nt,c,n.timezone),Pt=V1(xe[qe]??0,c,n.timezone);bt!==Pt&&(ut=void 0)}ze[Ke]=ut}return ze}const f=zk(n.timestamps);if(c.kind==="fixed"&&f!=null&&c.ms<f)throw new Error(`request.security: lower timeframe "${o}" is not available from current chart data (base ~${Math.round(f/6e4)}m). Switch chart timeframe lower or provide lower-TF datafeed.`);const u=new Array(e),d=new Array(e),h=[],m=[],g=[],w=[],C=[],P=[];let I=NaN,A=-1;for(let le=0;le<e;le++){const ue=A0(n.timestamps[le]??0);if(!ue){u[le]=-1;continue}const fe=V1(ue,c,n.timezone);if(!Number.isFinite(I)||fe!==I){I=fe,A+=1,P[A]=fe,h[A]=n.open[le]??n.close[le]??NaN;const pe=n.close[le]??NaN;m[A]=n.high[le]??pe,g[A]=n.low[le]??pe,w[A]=n.close[le]??NaN,C[A]=((ce=n.volume)==null?void 0:ce[le])??0}else{const pe=n.high[le],Z=n.low[le],xe=n.close[le];pe!=null&&Number.isFinite(pe)&&(m[A]=Math.max(m[A],pe)),Z!=null&&Number.isFinite(Z)&&(g[A]=Math.min(g[A],Z)),xe!=null&&Number.isFinite(xe)&&(w[A]=xe);const oe=(Q=n.volume)==null?void 0:Q[le];oe!=null&&Number.isFinite(oe)&&(C[A]+=oe)}u[le]=A}for(let le=0;le<e;le++){const ue=u[le],fe=le+1<e?u[le+1]:ue;d[le]=ue>=0&&le+1<e&&ue!==fe}const M=A+1;if(M<=0)return new Array(e);const F={open:new Float32Array(M),high:new Float32Array(M),low:new Float32Array(M),close:new Float32Array(M),volume:new Float32Array(M),time:new Float32Array(M)};for(let le=0;le<M;le++)F.open[le]=h[le]??NaN,F.high[le]=m[le]??NaN,F.low[le]=g[le]??NaN,F.close[le]=w[le]??NaN,F.volume[le]=C[le]??0,F.time[le]=P[le]??0;const $=__([{name:"__out",expr:l(a)}],F,n.scalars,void 0,void 0,{userFunctions:n.userFunctions}).__out||new Float32Array(M),L=new Array(e);for(let le=0;le<e;le++){const ue=u[le];if(ue<0){L[le]=void 0;continue}const fe=A0(n.timestamps[le]??0);if(s==="on"&&!Jb(fe,n.session,n.timezone)){L[le]=void 0;continue}const pe=t==="on"||d[le]?$[ue]:ue>0?$[ue-1]:NaN,Z=Number.isFinite(pe)?pe:void 0;if(s==="on"){const xe=V1(fe,c,n.timezone),oe=V1(P[ue]??0,c,n.timezone);L[le]=xe===oe?Z:void 0}else L[le]=Z}return L}const Vk=n=>`https://noti.dutyai.app${n}`,Wk=n=>{const e=typeof n=="number"?n:Number(n);return!Number.isFinite(e)||e<=0?null:e<1e11?e*1e3:e},pR=n=>{if(!n)return null;if(Array.isArray(n)){if(n.length<5)return null;let e,t,s,o,r,a;if(n.length>=6){const c=Number(n[0]),f=Number(n[n.length-1]),u=Number.isFinite(c)&&Math.abs(c)>1e10,d=Number.isFinite(f)&&Math.abs(f)>1e10;u&&!d?(e=n[0],t=n[1],s=n[2],o=n[3],r=n[4],a=n[5]):!u&&d?(t=n[0],s=n[1],o=n[2],r=n[3],a=n[4],e=n[5]):(e=n[0],t=n[1],s=n[2],o=n[3],r=n[4],a=n[5])}else e=n[0],t=n[1],s=n[2],o=n[3],r=n[4],a=0;const l=Wk(e);return l?{timestamp:l,open:Number(t)||0,high:Number(s)||0,low:Number(o)||0,close:Number(r)||0,volume:Number(a)||0}:null}if(typeof n=="object"){const e=Wk(n.timestamp??n.time??n.t??n.ts??n.date);return e?{timestamp:e,open:Number(n.open??n.o)||0,high:Number(n.high??n.h)||0,low:Number(n.low??n.l)||0,close:Number(n.close??n.c)||0,volume:Number(n.volume??n.v)||0}:null}return null};class mR{constructor(){Te(this,"_prevSymbol");Te(this,"_ws");Te(this,"listens",{});Te(this,"polygonApiKey","k2hPDhLy8gIpP4lMCU0gwo92xNRxE2XI");Te(this,"currentPriceCache",new Map);Te(this,"pipeline");Te(this,"corporateActionsCache",new Map);Te(this,"corporateActionsInflight",new Map);Te(this,"dataOptions",{sessionMode:"regular",adjustMode:"none",timezone:"UTC"});this.pipeline=new S$(this.fetchHistoryPage.bind(this),{initialLimit:800,pageLimit:1e3,pageDelayMs:60,maxKeys:24,ttlMs:25*6e4})}async getHistoryDutyData({symbol:e,period:t,from:s,to:o,strategy:r,sessionMode:a,adjustMode:l,timezone:c}){const f=(t==null?void 0:t.timeframe)||"1m",u=this.normalizeSessionMode(a||e.sessionMode||this.dataOptions.sessionMode),d=this.normalizeAdjustMode(l||e.adjustMode||this.dataOptions.adjustMode),h=B1(e,c||this.dataOptions.timezone);this.dataOptions={sessionMode:u,adjustMode:d,timezone:h};const m=await this.pipeline.waitForInitial(e,f);await this.ensureCorporateActions(e);const g=this.applyTransforms(m.candles.slice(),e,u,d,h,f);if(g.length>0){const w=g[g.length-1].close;this.currentPriceCache.set(e.ticker,w)}return{data:g.slice(),lays:[]}}startBackgroundPrefetch(e,t){this.pipeline.start(e,t.timeframe)}hasMoreServerHistory(e,t){return!this.pipeline.getSnapshot(e,t.timeframe).isComplete}async loadMoreHistoricalData(e,t,s,o=2){const a=this.pipeline.requestVisibleRange({symbol:e,timeframe:t.timeframe,beforeTimestamp:s,limit:350}),l=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),c=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),f=B1(e,this.dataOptions.timezone);return await this.ensureCorporateActions(e),{data:this.applyTransforms(a.slice(),e,l,c,f,t.timeframe),lays:[]}}removeDuplicateData(e){const t=new Set;return e.filter(s=>t.has(s[0])?!1:(t.add(s[0]),!0))}getTimeframeInMs(e){return e.endsWith("m")?parseInt(e.slice(0,-1))*60*1e3:e.endsWith("h")?parseInt(e.slice(0,-1))*60*60*1e3:e.endsWith("d")?parseInt(e.slice(0,-1))*24*60*60*1e3:e.endsWith("w")?parseInt(e.slice(0,-1))*7*24*60*60*1e3:60*1e3}shouldFilterBySession(e){const t=String(e||"").trim();if(!t)return!0;const s=t.slice(-1);return!(s==="d"||s==="D"||s==="w"||s==="W"||s==="M"||s==="y"||s==="Y")}canLoadMoreData(e,t){const s=this.pipeline.getSnapshot(e,t.timeframe);return s.candles.length>0&&!s.isComplete}convertResolutionForStockNow(e){return e==="1d"?"1D":e==="1w"?"1W":e==="1M"?"1M":e.endsWith("m")?e.slice(0,-1):e.endsWith("h")?(parseInt(e.slice(0,-1))*60).toString():e.endsWith("d")?(parseInt(e.slice(0,-1))*24*60).toString():e.endsWith("w")?(parseInt(e.slice(0,-1))*7*24*60).toString():e}async fetchHistoryPage(e){const t=this.convertResolutionForStockNow(e.timeframe),s=encodeURIComponent(e.symbol.ticker),o=e.symbol.country||"BD",r=`/finance/get/chart/${s}/${t}?skip=${e.skip}&limit=${e.limit}&country=${o}`,a=Vk(r),l=await fetch(a,{signal:e.signal});if(!l.ok)return[];const c=await l.text();if(!c||c.trim()==="")return[];try{const f=JSON.parse(c),u=Array.isArray(f)?f:Array.isArray(f==null?void 0:f.data)?f.data:Array.isArray(f==null?void 0:f.candles)?f.candles:Array.isArray(f==null?void 0:f.result)?f.result:[],d=Array.isArray(u)?u:[];if(!d.length)return[];const h=[];for(const m of d){const g=pR(m);g&&h.push(g)}return h}catch{return[]}}async getSymbols(){console.log("🚀 getSymbols() method called");try{console.log("🌐 Fetching symbols from API...");const t=await fetch(Vk("/finance/get/stock/list/latest"));if(!t.ok)return console.warn(`⚠️ API request failed with status: ${t.status}`),[];let s=await t.json();const o=Array.isArray(s)?s:Array.isArray(s==null?void 0:s.data)?s.data:Array.isArray(s==null?void 0:s.symbols)?s.symbols:null;if(!o||!Array.isArray(o))return console.warn("⚠️ API response is not an array, using fallback symbols"),[];o.push({ticker:"DSEX",name:"Dhaka Stock Exchange",shortName:"DSEX",market:"stock",exchange:"DSEBD",priceCurrency:"BDT",type:"stock",logo:"",country:"BD"}),console.log(`📊 Received ${o.length} symbols from API`);const a=o.map(l=>{const c={ticker:l.symbol||l.ticker||"",name:l.description||l.fullName||l.name||l.symbol||l.ticker||"",shortName:l.name||l.symbol||l.ticker||"",market:l.market||"stock",country:l.country||"BD",exchange:l.exchange||"UNKNOWN",priceCurrency:l.currency||(l.country==="US"?"USD":"BDT"),type:l.type||"stock",logo:l.logo?l.logo.trim():l.symbol||l.ticker?`https://s3-api.bayah.app/cdn/symbol/logo/${l.symbol||l.ticker}.svg`:"",logo2:l.logo2,pricePrecision:l.pricePrecision,volumePrecision:l.volumePrecision,tickSize:l.tickSize??l.minTick??l.priceStep,lotSize:l.lotSize,contractSize:l.contractSize,minOrderSize:l.minOrderSize,corporateActions:Array.isArray(l.corporateActions)?l.corporateActions:Array.isArray(l.corporate_actions)?l.corporate_actions:void 0,corporateActionsUrl:l.corporateActionsUrl||l.corporate_actions_url||l.corporateActionsURL,adjustMode:l.adjustMode||l.adjust_mode},f=iS(c),u=o1(l.sessionRegular||l.session||f.regular)||void 0,d=o1(l.sessionExtended||l.extendedSession||f.extended)||void 0;return{...c,timezone:l.timezone||l.exchangeTimezone||f.timezone,session:u,sessionExtended:d,sessionTimezone:l.sessionTimezone||l.timezone}}).filter(l=>l.ticker&&l.ticker.trim()!=="");return console.log(`✅ Successfully processed ${a.length} valid symbols`),console.log("📋 Sample symbols:",a.slice(0,5)),a.length>0?a:[]}catch(e){return console.error("❌ Error fetching symbols from API:",e),console.log("🔄 Falling back to hardcoded symbols"),[]}}watch(e,t){var s;this._ws&&((s=this._ws)==null||s.send(JSON.stringify({action:"watch",key:e})),this.listens[e]=t)}subscribe(e,t){var o;if(((o=this._prevSymbol)==null?void 0:o.ticker)===e.ticker)return;this._prevSymbol=e,this.unsubscribe(),console.log(`Subscribing to real-time updates for ${e.ticker}`);const s=setInterval(()=>{const r=this.currentPriceCache.get(e.ticker)||Math.random()*100+10,a=(Math.random()-.5)*2,l=r+a;this.currentPriceCache.set(e.ticker,l);const f=[Date.now(),r,Math.max(r,l)+Math.random()*.5,Math.min(r,l)-Math.random()*.5,l,Math.random()*1e3];t({bars:[f],secs:1})},2e3);this.listens[e.ticker]=s}unsubscribe(e){this._ws&&(this._ws.close(),this._ws=void 0),Object.values(this.listens).forEach(s=>{typeof s=="number"&&clearInterval(s)}),this.listens={};const t=e==null?void 0:e.ticker;t&&this.pipeline.stopSymbol(t)}getCurrentPrice(e){return this.currentPriceCache.get(e)||null}clearCache(){this.pipeline.clear(),this.currentPriceCache.clear()}getPipelineMetrics(){return this.pipeline.getMetrics()}stopSymbolPipelines(e){this.pipeline.stopSymbol(e)}stopAllPipelines(){this.pipeline.stopAll()}getHistorySnapshot(e,t){const s=this.pipeline.getSnapshot(e,t);if(!s.candles.length)return s;const o=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),r=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),a=B1(e,this.dataOptions.timezone),l=this.applyTransforms(s.candles.slice(),e,o,r,a,t);return{...s,candles:l}}async ensureHistoryBefore(e,t,s,o=2500){if(!(e!=null&&e.ticker))return this.pipeline.getSnapshot(e,t);this.pipeline.start(e,t);const r=l=>{const c=l.oldestTimestampLoaded;return typeof s!="number"||!Number.isFinite(s)||s<=0?l.candles.length>0:c!=null&&c<=s},a=this.pipeline.getSnapshot(e,t);return r(a)||a.isComplete?a:await new Promise(l=>{let c=!1,f=null,u=null;const d=h=>{if(c)return;c=!0;try{f&&clearTimeout(f)}catch{}try{u==null||u()}catch{}const m=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),g=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),w=B1(e,this.dataOptions.timezone),C=this.applyTransforms(h.candles.slice(),e,m,g,w,t);l({...h,candles:C})};u=this.pipeline.subscribe(e,t,h=>{(r(h)||h.isComplete||h.error)&&d(h)}),f=setTimeout(()=>{d(this.pipeline.getSnapshot(e,t))},Math.max(100,o))})}async ensureHistoryCovers(e,t,s,o,r=3500){if(!(e!=null&&e.ticker))return this.pipeline.getSnapshot(e,t);this.pipeline.start(e,t);const a=c=>{const f=c.oldestTimestampLoaded,u=c.newestTimestampLoaded;return typeof s!="number"||!Number.isFinite(s)||s<=0||typeof o!="number"||!Number.isFinite(o)||o<=0?c.candles.length>0:f!=null&&u!=null&&f<=s&&u>=o},l=this.pipeline.getSnapshot(e,t);return a(l)||l.isComplete?l:await new Promise(c=>{let f=!1,u=null,d=null;const h=m=>{if(f)return;f=!0;try{u&&clearTimeout(u)}catch{}try{d==null||d()}catch{}const g=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),w=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),C=B1(e,this.dataOptions.timezone),P=this.applyTransforms(m.candles.slice(),e,g,w,C,t);c({...m,candles:P})};d=this.pipeline.subscribe(e,t,m=>{(a(m)||m.isComplete||m.error)&&h(m)}),u=setTimeout(()=>{h(this.pipeline.getSnapshot(e,t))},Math.max(100,r))})}normalizeSessionMode(e){const t=String(e||"").toLowerCase();return t==="extended"?"extended":t==="all"?"all":"regular"}normalizeAdjustMode(e){const t=String(e||"").toLowerCase();return t==="split"?"split":t==="dividend"?"dividend":t==="all"||t==="split_dividend"||t==="split+dividend"?"all":"none"}async ensureCorporateActions(e){const t=`${e.ticker}@${e.exchange||e.market||""}`,s=this.corporateActionsCache.get(t);if(s)return s;if(Array.isArray(e.corporateActions))return this.corporateActionsCache.set(t,e.corporateActions),e.corporateActions;if(this.corporateActionsInflight.has(t))return await this.corporateActionsInflight.get(t);const o=e.corporateActionsUrl;if(!o)return this.corporateActionsCache.set(t,[]),[];const r=(async()=>{try{const a=await fetch(o);if(!a.ok)return[];const l=await a.json(),c=Array.isArray(l)?l:Array.isArray(l==null?void 0:l.actions)?l.actions:Array.isArray(l==null?void 0:l.corporateActions)?l.corporateActions:[],f=Array.isArray(c)?c:[];return this.corporateActionsCache.set(t,f),f}catch{return this.corporateActionsCache.set(t,[]),[]}finally{this.corporateActionsInflight.delete(t)}})();return this.corporateActionsInflight.set(t,r),await r}applyTransforms(e,t,s,o,r,a){if(!e.length)return e;const l=N$(t,s);let c=e;this.shouldFilterBySession(a)&&s!=="all"&&l&&l!=="24x7"&&(c=this.filterBySession(c,l,r));const f=`${t.ticker}@${t.exchange||t.market||""}`,u=this.corporateActionsCache.get(f)||t.corporateActions;return u&&u.length&&o!=="none"&&(c=I$(c,u,o)),c}filterBySession(e,t,s){const o=[];for(const r of e){const a=(r==null?void 0:r.timestamp)??(r==null?void 0:r.time)??0,l=typeof a=="number"?a:Number(a),c=Number.isFinite(l)?l<1e11?l*1e3:l:0;c&&Jb(c,t,s)&&o.push(r)}return o}}function Hk(n){const{xVal:e,xloc:t,len:s,timeSeriesMs:o,tsIndex:r,config:a,warn:l,meta:c}=n;if(!Number.isFinite(e))return null;const f=!!(a!=null&&a.strictXloc),u=!!(a!=null&&a.allowFloatIndex),d=f&&t==="time"?0:Math.max(0,Number((a==null?void 0:a.futureBars)||0));if(t!=="time"){if(f&&!Number.isInteger(e))return null;const ue=f||!u?Math.round(e):e;return!Number.isFinite(ue)||ue<0?null:ue>s-1&&ue<=s-1+d||ue>=0&&ue<s?ue:null}const h=e<1e12?Math.floor(e*1e3):Math.floor(e),m=o.length;if(!m)return null;const g=f?0:Math.max(0,Number((a==null?void 0:a.toleranceBars)||0)),w=f?0:Math.max(0,Number((a==null?void 0:a.toleranceMs)||0)),C=Math.max(0,Number((a==null?void 0:a.avgIntervalMs)||0)),P=C>0?g*C:0,I=Math.max(w,P),A=o[m-1];o[0];const M=ue=>{if(!l)return;const fe=["[ScriptStudio] time anchor miss",c!=null&&c.kind?`kind=${c.kind}`:"",(c==null?void 0:c.id)!=null?`id=${c.id}`:"",`ts=${h}`,`mode=${(a==null?void 0:a.mode)||"nearest"}`,`tolBars=${g}`,`tolMs=${w}`,`reason=${ue}`].filter(Boolean);l(fe.join(" "))};if(h>A&&d>0){const ue=h-A,fe=C>0?Math.max(1,Math.round(ue/C)):1;return fe<=d?s-1+fe:(M("future_out_of_range"),null)}let F=0,B=m;for(;F<B;){const ue=F+B>>1;o[ue]<h?F=ue+1:B=ue}const $=F<m?F:null,L=F-1>=0?F-1:null;let O=null;const Y=f?"prev":(a==null?void 0:a.mode)||"nearest";if(Y==="prev")O=L??$;else if(Y==="next")O=$??L;else{const ue=L!=null?Math.abs(o[L]-h):Number.POSITIVE_INFINITY,fe=$!=null?Math.abs(o[$]-h):Number.POSITIVE_INFINITY;ue<=fe?O=L:O=$}if(O==null)return M("no_match"),null;const ce=o[O],Q=Math.abs(ce-h),le=C>0?Q/C:Math.abs(O-(F<m?F:m-1));return I>0&&Q>I?(M("beyond_tolerance_ms"),null):g>0&&le>g?(M("beyond_tolerance_bars"),null):O}function fx(n,e,t){if(!Array.isArray(n)||n.length<=2)return n||[];const s=Math.max(1,Math.floor(t||1)),o=[];let r=null,a=null;for(let l=0;l<n.length;l++){const c=n[l];if(!c)continue;const{x:f,y:u}=e(c)||{};if(!Number.isFinite(f)||!Number.isFinite(u))continue;if(o.length===0){o.push(c),r={x:f,y:u};continue}const d=f-r.x,h=u-r.y,m=d!==0?h/d:null,g=Math.abs(d)>=s||Math.abs(h)>=s,w=m!=null&&a!=null?m*a<0:!1;(g||w||l===n.length-1)&&(o.push(c),r={x:f,y:u},a=m??a)}return o[o.length-1]!==n[n.length-1]&&o.push(n[n.length-1]),o}function qk(n){const{baseLeft:e,baseRight:t,extend:s,vpLeft:o,vpRight:r,lastIndex:a}=n||{};if(!Number.isFinite(e)||!Number.isFinite(t))return null;const l=Number.isFinite(a)?Math.max(0,a):Math.max(e,t),c=g=>Math.max(0,Math.min(l,g)),f=Number.isFinite(o)?c(o):c(e),u=Number.isFinite(r)?c(r):c(t),d=String(s||"none").toLowerCase();let h=e,m=t;return d==="both"?(h=f,m=u):d==="left"?h=f:d==="right"&&(m=u),{leftExt:c(h),rightExt:c(m)}}function xb(n){const{startIndex:e,endIndex:t,startValue:s,endValue:o,slope:r,intercept:a,extend:l,fromIndex:c,toIndex:f,yRange:u,toX:d,toY:h}=n||{};if(!Number.isFinite(e)||!Number.isFinite(t)||!Number.isFinite(s)||!Number.isFinite(o))return null;const m=String(l||"none").toLowerCase(),g={x1:e,y1:s,x2:t,y2:o},w=e===t,C=Number.isFinite(c)?c:e,P=Number.isFinite(f)?f:t;let I=r,A=a;!w&&(!Number.isFinite(I)||!Number.isFinite(A))&&(I=(o-s)/(t-e),A=s-I*e);let M={...g};if(m!=="none"){if(w){const $=Number(u==null?void 0:u.from),L=Number(u==null?void 0:u.to),O=Number.isFinite($)&&Number.isFinite(L)?Math.min($,L):Math.min(s,o),Y=Number.isFinite($)&&Number.isFinite(L)?Math.max($,L):Math.max(s,o);M={x1:e,y1:Y,x2:e,y2:O}}else if(Number.isFinite(I)&&Number.isFinite(A)){let $=e,L=t;m==="left"?$=C:m==="right"?L=P:m==="both"&&($=C,L=P),M={x1:$,y1:I*$+A,x2:L,y2:I*L+A}}}const F={x1:d(g.x1),y1:h(g.y1),x2:d(g.x2),y2:h(g.y2)},B={x1:d(M.x1),y1:h(M.y1),x2:d(M.x2),y2:h(M.y2)};return!Number.isFinite(F.x1)||!Number.isFinite(F.y1)||!Number.isFinite(F.x2)||!Number.isFinite(F.y2)||!Number.isFinite(B.x1)||!Number.isFinite(B.y1)||!Number.isFinite(B.x2)||!Number.isFinite(B.y2)?null:{mode:m,vertical:w,base:F,extended:B,baseData:g,extendedData:M}}function Uk(n,e){const t=String(n||"solid").toLowerCase(),s=Number(e),o=Number.isFinite(s)&&s>=3;return t==="dashed"?o?[8,5]:[6,4]:t==="dotted"?o?[3,5]:[2,4]:[]}const Gk=new Map,px=typeof document<"u"?document.createElement("canvas").getContext("2d"):null;function wb(n,e){return px?(px.font=e,px.measureText(n).width):n.length*8}function Z1(n){const e=n.text??"",t=n.font||'12px "Inter", system-ui, sans-serif',s=Number.isFinite(n.maxWidth)?Math.max(0,Number(n.maxWidth)):0,o=n.wrap===!0,r=(()=>{const w=t.match(/(\d+(?:\.\d+)?)px/),C=w?Number(w[1]):12;return Math.max(C+2,C*1.2)})(),a=Number.isFinite(n.lineHeight)?Number(n.lineHeight):r,l=`${t}|${s}|${o?"w":"n"}|${a}|${e}`,c=Gk.get(l);if(c)return c;const f=String(e).split(/\n/),u=[],d=w=>{if(!o||s<=0){u.push(w);return}const C=w.split(/\s+/).filter(Boolean);let P="";const I=()=>{P&&(u.push(P),P="")},A=M=>{if(!M)return;if(wb(M,t)>s&&s>4){I();let $="";for(const L of M){const O=$+L;wb(O,t)>s&&$?(u.push($),$=L):$=O}$&&u.push($);return}const B=P?`${P} ${M}`:M;wb(B,t)>s&&P?(I(),P=M):P=B};for(const M of C)A(M);I()};f.forEach(w=>d(w)),u.length||u.push("");let h=0;for(const w of u)h=Math.max(h,wb(w,t));const m=u.length*a,g={lines:u,width:h,height:m,lineHeight:a};return Gk.set(l,g),g}const hR=1200,p_=new Map,vR=()=>{if(typeof window>"u")return 1;const n=window.devicePixelRatio||1;return Number.isFinite(n)&&n>0?n:1},gR=(n,e,t)=>JSON.stringify([n,e.font,e.color,e.strokeColor??"",Number.isFinite(e.strokeWidth)?e.strokeWidth:0,Number.isFinite(e.maxWidth)?e.maxWidth:"",e.wrap?1:0,Number.isFinite(e.lineHeight)?e.lineHeight:"",e.align||"left",t]),Yk=(n,e)=>{if(p_.has(n)&&p_.delete(n),p_.set(n,e),p_.size<=hR)return;const t=p_.keys().next().value;t&&p_.delete(t)},kb=(n,e)=>{if(typeof document>"u")return null;const t=String(n??"");if(!t)return{canvas:document.createElement("canvas"),width:0,height:0,lineHeight:Number.isFinite(e.lineHeight)?Number(e.lineHeight):14,lines:[],dpr:1};const s=vR(),o=gR(t,e,s),r=p_.get(o);if(r)return Yk(o,r),r;const a=Z1({text:t,font:e.font,maxWidth:e.maxWidth,wrap:e.wrap===!0,lineHeight:e.lineHeight}),l=Math.max(1,Math.ceil(a.width)),c=Math.max(1,Math.ceil(a.height)),f=document.createElement("canvas");f.width=Math.ceil(l*s),f.height=Math.ceil(c*s);const u=f.getContext("2d");if(!u)return null;u.scale(s,s),u.font=e.font,u.textBaseline="top";const d=e.align||"left";u.textAlign=d,u.fillStyle=e.color,e.strokeWidth&&e.strokeWidth>0&&(u.lineWidth=e.strokeWidth,u.strokeStyle=e.strokeColor||"rgba(0,0,0,0.45)");const h=d==="center"?l/2:d==="right"?l:0;let m=0;for(const w of a.lines)e.strokeWidth&&e.strokeWidth>0&&u.strokeText(w,h,m),u.fillText(w,h,m),m+=a.lineHeight;const g={canvas:f,width:l,height:c,lineHeight:a.lineHeight,lines:a.lines,dpr:s};return Yk(o,g),g},r8=Object.freeze({interactionV2:!0,heatmapRasterV1:!0,webglRuntimeDrawV1:!0}),_R=r8,yR=n=>{},nv=n=>{const e=_R[n]??!1;return yR()??e},a6=new Map;function $0(n,e){n&&a6.set(n,e)}function s_(n){if(n)return a6.get(n)}function Kk(n){n&&a6.delete(n)}const mx=6,Pv=n=>typeof n=="number"&&Number.isFinite(n),W1=(n,e,t)=>n>=t.x&&e>=t.y&&n<=t.x+t.width&&e<=t.y+t.height,bR=n=>{if(!n)return null;const e=n.width,t=n.height;if(!Pv(e)||!Pv(t))return null;let s=n.x,o=n.y;const r=n.align||"center",a=n.valign||"middle";return r==="center"?s-=e/2:r==="right"&&(s-=e),a==="middle"?o-=t/2:a==="bottom"&&(o-=t),{x:s,y:o,width:e,height:t}},xR=n=>{if(!n||n.length<3)return null;let e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(const r of n)!Pv(r.x)||!Pv(r.y)||(r.x<e&&(e=r.x),r.x>s&&(s=r.x),r.y<t&&(t=r.y),r.y>o&&(o=r.y));return!Pv(e)||!Pv(t)||!Pv(s)||!Pv(o)?null:{x:e,y:t,width:s-e,height:o-t}},wR=(n,e)=>{let t=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const r=e[s],a=e[o];if(!r||!a)continue;r.y>n.y!=a.y>n.y&&n.x<(a.x-r.x)*(n.y-r.y)/(a.y-r.y+1e-7)+r.x&&(t=!t)}return t},hx=(n,e,t)=>{const s=t.x-e.x,o=t.y-e.y;if(s===0&&o===0)return Math.hypot(n.x-e.x,n.y-e.y);const r=((n.x-e.x)*s+(n.y-e.y)*o)/(s*s+o*o),a=Math.max(0,Math.min(1,r)),l=e.x+a*s,c=e.y+a*o;return Math.hypot(n.x-l,n.y-c)};function kR(n,e){return n.zIndex!==e.zIndex?e.zIndex-n.zIndex:n.createdAt!==e.createdAt?e.createdAt-n.createdAt:n.id<e.id?-1:n.id>e.id?1:0}function SR(n){return!Array.isArray(n)||n.length===0?null:n.reduce((e,t)=>e?kR(t,e)<0?t:e:t,null)}function a8(n,e,t){if(!Array.isArray(n)||!Pv(e)||!Pv(t))return null;const s=[],o={x:e,y:t};for(const r of n){if(!r||!Pv(r.zIndex)||!Pv(r.createdAt))continue;const a=r.id,l=r.type;if(l==="handle"){if(!r.rect)continue;W1(e,t,r.rect)&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}if(l==="label"){const c=r.rect??bR(r.anchor);if(!c)continue;W1(e,t,c)&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}if(l==="box"){if(!r.rect)continue;W1(e,t,r.rect)&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}if(l==="line"||l==="lineSegment"){if(!r.segment)continue;const c=hx(o,r.segment.a,r.segment.b),f=Pv(r.tolerance)?r.tolerance:mx;c<=f&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt,distance:c});continue}if(l==="polyline"||l==="path"){const c=r.segments||[];if(!c.length){r.rect&&W1(e,t,r.rect)&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}const f=Pv(r.tolerance)?r.tolerance:mx;let u=1/0;for(const d of c){const h=hx(o,d.a,d.b);if(h<u&&(u=h),u<=f)break}u<=f&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt,distance:u});continue}if(l==="polygon"){const c=r.polygon||[];if(c.length<3)continue;const f=r.rect??xR(c);if(f&&!W1(e,t,f))continue;if(wR(o,c)){s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}const u=Pv(r.tolerance)?r.tolerance:mx;let d=1/0;for(let h=0;h<c.length;h++){const m=c[h],g=c[(h+1)%c.length];if(!m||!g)continue;const w=hx(o,m,g);if(w<d&&(d=w),d<=u)break}d<=u&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt,distance:d});continue}}return SR(s)}const Xk=n=>typeof n=="number"&&Number.isFinite(n),U_=(n,e)=>!Xk(n)||!Xk(e)||e<=0?n:Math.round(n/e)*e;function Zk(n){return{snapOff:!!(n!=null&&n.altKey),axisLock:!!(n!=null&&n.shiftKey),strong:!1}}function Jk(n,e,t){return!e||t.snapOff?{time:n.time,price:n.price}:{time:U_(n.time,e.timeStep),price:U_(n.price,e.priceStep)}}function Qk(n,e,t){return!e||t.snapOff?{leftTime:n.leftTime,rightTime:n.rightTime,top:n.top,bottom:n.bottom}:{leftTime:U_(n.leftTime,e.timeStep),rightTime:U_(n.rightTime,e.timeStep),top:U_(n.top,e.priceStep),bottom:U_(n.bottom,e.priceStep)}}const CR=new Set(["box","label","line","lineSegment","polyline","polygon","path"]),l8=new Set(["n","s","e","w","ne","nw","se","sw"]);let ou=null,Uu=null;const IR={snapOff:!1,axisLock:!1,strong:!1},dp=n=>typeof n=="number"&&Number.isFinite(n),e5=n=>!!(n&&typeof n.toIndex=="function"&&typeof n.toValue=="function"&&typeof n.toX=="function"&&typeof n.toY=="function"),b2=n=>!!(n&&dp(n.leftIndex)&&dp(n.rightIndex)&&dp(n.topValue)&&dp(n.bottomValue)),yw=n=>!!(n&&dp(n.index)&&dp(n.value)),x2=(n,e,t)=>({x:n-t.x,y:e-t.y}),Qb=n=>n==="n"||n==="s"?"ns-resize":n==="e"||n==="w"?"ew-resize":n==="ne"||n==="sw"?"nesw-resize":"nwse-resize",PR=n=>n??IR,t5=(n,e,t)=>t.axisLock?Math.abs(n)>=Math.abs(e)?{lockX:!1,lockY:!0}:{lockX:!0,lockY:!1}:{lockX:!1,lockY:!1},Sb=(n,e,t)=>n?{timeStep:e?n.timeStep:Number.NaN,priceStep:t?n.priceStep:Number.NaN}:null;function n5(n,e,t,s){var a;if(!nv("interactionV2"))return{};const o=PR(s);if(Uu){const l=x2(n,e,Uu.offset);let c=l.x-Uu.startX,f=l.y-Uu.startY;const u=Uu.handle.includes("e")||Uu.handle.includes("w"),d=Uu.handle.includes("n")||Uu.handle.includes("s");u||(c=0),d||(f=0);const{lockX:h,lockY:m}=t5(c,f,o);h&&(c=0),m&&(f=0);let g=Uu.basePx.left,w=Uu.basePx.right,C=Uu.basePx.top,P=Uu.basePx.bottom;Uu.handle.includes("w")&&(g+=c),Uu.handle.includes("e")&&(w+=c),Uu.handle.includes("n")&&(C+=f),Uu.handle.includes("s")&&(P+=f);const I=Uu.axis.toIndex(g),A=Uu.axis.toIndex(w),M=Uu.axis.toValue(C),F=Uu.axis.toValue(P);if(!dp(I)||!dp(A)||!dp(M)||!dp(F))return{hoverId:Uu.targetId,resizingId:Uu.targetId,cursor:Qb(Uu.handle)};const B=Sb(Uu.snap,u&&!h,d&&!m),$=Qk({leftTime:I,rightTime:A,top:M,bottom:F},B,o);let L=$.leftTime,O=$.rightTime,Y=$.top,ce=$.bottom;const Q=Math.max(2,Uu.minWidthIndex),le=Math.max(0,Uu.minHeightValue);O-L<Q&&(Uu.handle.includes("w")?L=O-Q:O=L+Q),Y-ce<le&&(Uu.handle.includes("n")?Y=ce+le:ce=Y-le);const ue=s_(Uu.targetId);return $0(Uu.targetId,{box:{leftIndex:L,rightIndex:O,topValue:Y,bottomValue:ce},hidden:ue==null?void 0:ue.hidden}),{hoverId:Uu.targetId,resizingId:Uu.targetId,cursor:Qb(Uu.handle)}}if(ou){const l=x2(n,e,ou.offset);let c=l.x-ou.startX,f=l.y-ou.startY;const{lockX:u,lockY:d}=t5(c,f,o);u&&(c=0),d&&(f=0);const h=s_(ou.id);if(ou.type==="box"&&ou.baseBox&&ou.basePx){const m=ou.axis.toIndex(ou.basePx.left+c),g=ou.axis.toIndex(ou.basePx.right+c),w=ou.axis.toValue(ou.basePx.top+f),C=ou.axis.toValue(ou.basePx.bottom+f);if(dp(m)&&dp(g)&&dp(w)&&dp(C)){const P=Sb(ou.snap,!u,!d),I=Qk({leftTime:m,rightTime:g,top:w,bottom:C},P,o);$0(ou.id,{box:{leftIndex:I.leftTime,rightIndex:I.rightTime,topValue:I.top,bottomValue:I.bottom},hidden:h==null?void 0:h.hidden})}}else if(ou.type==="label"&&ou.baseLabel&&ou.baseAnchorPx){const m=ou.axis.toIndex(ou.baseAnchorPx.x+c),g=ou.axis.toValue(ou.baseAnchorPx.y+f);if(dp(m)&&dp(g)){const w=Sb(ou.snap,!u,!d),C=Jk({time:m,price:g},w,o);$0(ou.id,{label:{index:C.time,value:C.price},hidden:h==null?void 0:h.hidden})}}else if(ou.type==="shape"){const m=ou.baseIndex,g=ou.baseValue;if(dp(m)&&dp(g)){let w=ou.axis.toIndex(l.x),C=ou.axis.toValue(l.y);if(u&&(w=m),d&&(C=g),dp(w)&&dp(C)){const P=Sb(ou.snap,!u,!d),I=Jk({time:w,price:C},P,o),A=I.time-m,M=I.price-g,F=ou.baseTranslate||{dxIndex:0,dyValue:0};$0(ou.id,{translate:{dxIndex:F.dxIndex+A,dyValue:F.dyValue+M},hidden:h==null?void 0:h.hidden})}}}return{hoverId:ou.id,draggingId:ou.id,cursor:"grabbing"}}const r=a8(t,n,e);if(!r)return{};if(r.type==="handle"){const l=t.find(f=>f.id===r.id&&f.type===r.type),c=(a=l==null?void 0:l.handle)==null?void 0:a.position;if(c&&l8.has(c))return{hoverId:r.id,cursor:Qb(c)}}return{hoverId:r.id}}function MR(n,e,t){if(!nv("interactionV2"))return{};const s=a8(t,n,e);if(!s)return ou=null,Uu=null,{};if(ou=null,Uu=null,s.type==="handle"){const r=t.find(l=>l.id===s.id&&l.type===s.type),a=r==null?void 0:r.handle;if(a&&l8.has(a.position)){const l=t.find(w=>w.id===a.targetId&&w.type==="box"),c=l==null?void 0:l.axis,f=(l==null?void 0:l.offset)??{x:0,y:0},u=l==null?void 0:l.box,d=(l==null?void 0:l.snap)??null;if(!l||!e5(c)||!b2(u))return{};const h=x2(n,e,f),m=s_(a.targetId),g=a.boundsPx;return Uu={targetId:a.targetId,handle:a.position,startX:h.x,startY:h.y,offset:f,axis:c,baseBounds:{...u},basePx:{left:g.left,right:g.right,top:g.top,bottom:g.bottom},minWidthIndex:Number(a.minWidthIndex)||2,minHeightValue:Number(a.minHeightValue)||0,originalEdit:m?{...m}:void 0,snap:d},{selectedId:a.targetId,resizingId:a.targetId,cursor:Qb(a.position)}}}const o=t.find(r=>r.id===s.id&&r.type===s.type);if(o&&CR.has(s.type)){const r=o.axis,a=o.offset??{x:0,y:0};if(!e5(r))return{selectedId:s.id};const l=x2(n,e,a);if(s.type==="box"&&b2(o.box)){const c=r.toX(o.box.leftIndex),f=r.toX(o.box.rightIndex),u=r.toY(o.box.topValue),d=r.toY(o.box.bottomValue);dp(c)&&dp(f)&&dp(u)&&dp(d)&&(ou={id:s.id,type:"box",startX:l.x,startY:l.y,offset:a,axis:r,baseBox:{...o.box},basePx:{left:c,right:f,top:u,bottom:d},snap:o.snap??null})}else if(s.type==="label"&&yw(o.label)){const c=r.toX(o.label.index),f=r.toY(o.label.value);dp(c)&&dp(f)&&(ou={id:s.id,type:"label",startX:l.x,startY:l.y,offset:a,axis:r,baseLabel:{...o.label},baseAnchorPx:{x:c,y:f},snap:o.snap??null})}else{const c=r.toIndex(l.x),f=r.toValue(l.y);if(dp(c)&&dp(f)){const u=s_(s.id);ou={id:s.id,type:"shape",startX:l.x,startY:l.y,offset:a,axis:r,baseIndex:c,baseValue:f,baseTranslate:u!=null&&u.translate?{...u.translate}:{dxIndex:0,dyValue:0},snap:o.snap??null}}}Uu=null}else ou=null,Uu=null;return{selectedId:s.id,draggingId:ou==null?void 0:ou.id}}function bw(){if(!nv("interactionV2"))return{};if(Uu){const e=Uu.targetId;return Uu=null,{endedId:e}}if(!ou)return{};const n=ou.id;return ou=null,{endedId:n}}function NR(n){if(nv("interactionV2")){if(Uu){const e=Uu.targetId;Uu.originalEdit?$0(e,Uu.originalEdit):Kk(e),Uu=null;return}ou&&(Kk(ou.id),ou=null)}}function AR(n,e,t){if(!nv("interactionV2"))return{};if(!n||!n.id)return{};if(!dp(e)||!dp(t))return{};if(e===0&&t===0)return{};const s=s_(n.id),o=s!=null&&s.box&&b2(s.box)?s.box:n.box,r=s!=null&&s.label&&yw(s.label)?s.label:n.label;if(n.type==="box"&&b2(o))return $0(n.id,{box:{leftIndex:o.leftIndex+e,rightIndex:o.rightIndex+e,topValue:o.topValue+t,bottomValue:o.bottomValue+t},hidden:s==null?void 0:s.hidden}),{nudgedId:n.id};if(n.type==="label"&&yw(r))return $0(n.id,{label:{index:r.index+e,value:r.value+t},hidden:s==null?void 0:s.hidden}),{nudgedId:n.id};if(n.type==="line"||n.type==="lineSegment"||n.type==="polyline"||n.type==="polygon"||n.type==="path"){const a=(s==null?void 0:s.translate)??{dxIndex:0,dyValue:0};return $0(n.id,{translate:{dxIndex:a.dxIndex+e,dyValue:a.dyValue+t},hidden:s==null?void 0:s.hidden}),{nudgedId:n.id}}return{}}var TR=ta('<path d="M12.41465,11L18.5,11C18.7761,11,19,11.22386,19,11.5C19,11.77614,18.7761,12,18.5,12L12.41465,12C12.20873,12.5826,11.65311,13,11,13C10.34689,13,9.79127,12.5826,9.58535,12L3.5,12C3.223857,12,3,11.77614,3,11.5C3,11.22386,3.223857,11,3.5,11L9.58535,11C9.79127,10.417404,10.34689,10,11,10C11.65311,10,12.20873,10.417404,12.41465,11Z" stroke-opacity="0" stroke="none"></path>'),FR=ta('<g transform="scale(0.7857142857)"><path fill="currentColor" stroke="currentColor" stroke-width="1" d="M2 9.75a1.5 1.5 0 0 0-1.5 1.5v5.5a1.5 1.5 0 0 0 1.5 1.5h24a1.5 1.5 0 0 0 1.5-1.5v-5.5a1.5 1.5 0 0 0-1.5-1.5zm0 1h3v2.5h1v-2.5h3.25v3.9h1v-3.9h3.25v2.5h1v-2.5h3.25v3.9h1v-3.9H22v2.5h1v-2.5h3a.5.5 0 0 1 .5.5v5.5a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-5.5a.5.5 0 0 1 .5-.5z" transform="rotate(-45 14 14)"></path></g>'),LR=ta('<path d="M21,5.5C21,6.32843,20.3284,7,19.5,7C19.4136,7,19.3289,6.99269,19.2465,6.97866L15.6257,15.5086C15.8587,15.7729,16,16.119999999999997,16,16.5C16,17.328400000000002,15.3284,18,14.5,18C13.8469,18,13.2913,17.5826,13.0854,17L3.91465,17C3.70873,17.5826,3.15311,18,2.5,18C1.671573,18,1,17.328400000000002,1,16.5C1,15.6716,1.671573,15,2.5,15C2.5840199999999998,15,2.66643,15.0069,2.74668,15.0202L6.36934,6.48574C6.13933,6.22213,6,5.87733,6,5.5C6,4.671573,6.67157,4,7.5,4C8.15311,4,8.70873,4.417404,8.91465,5L18.0854,5C18.2913,4.417404,18.8469,4,19.5,4C20.3284,4,21,4.671573,21,5.5ZM18.0854,6L8.91465,6C8.892579999999999,6.06243,8.8665,6.12296,8.83672,6.18128L13.9814,15.0921C14.143,15.0325,14.3177,15,14.5,15C14.584,15,14.6664,15.0069,14.7467,15.0202L18.3693,6.48574C18.2462,6.3446,18.149,6.1802,18.0854,6ZM13.2036,15.745L8.0861,6.8811800000000005C7.90605,6.95768,7.70797,7,7.5,7C7.41359,7,7.32888,6.99269,7.24647,6.97866L3.62571,15.5086C3.7512,15.651,3.8501,15.8174,3.91465,16L13.0854,16C13.1169,15.9108,13.1566,15.8255,13.2036,15.745Z" stroke-opacity="0" stroke="none"></path>'),ER=ta('<path d="M9.474616630859375,7.494615087890625L8.844736630859375,7.494615087890625L8.844736630859375,4.149892087890625L8.000006630859374,4.634915087890625L8.004896630859374,4.005035087890625L9.020516630859376,3.414215087890625L9.474616630859375,3.414215087890625L9.474616630859375,7.494615087890625ZM18.529296630859378,4.8318550878906255Q18.307996630859375,5.028795087890625,18.122396630859377,5.385245087890625Q17.868496630859376,5.019035087890625,17.629196630859376,4.8269750878906255Q17.389996630859375,4.634915087890625,17.168596630859376,4.634915087890625Q16.794296630859375,4.634915087890625,16.522496630859376,4.976715087890625Q16.252296630859377,5.3168850878906255,16.252296630859377,5.7856350878906255Q16.252296630859377,6.218575087890625,16.502896630859375,6.521315087890625Q16.755196630859373,6.822415087890625,17.114896630859377,6.822415087890625Q17.368796630859375,6.822415087890625,17.588596630859374,6.625475087890624Q17.809896630859377,6.428535087890625,17.998696630859374,6.0688350878906245Q18.249396630859373,6.439935087890625,18.488596630859377,6.631985087890625Q18.727896630859377,6.822415087890625,18.952496630859375,6.822415087890625Q19.326796630859373,6.822415087890625,19.596996630859376,6.482245087890625Q19.868796630859375,6.140455087890626,19.868796630859375,5.671705087890626Q19.868796630859375,5.238755087890625,19.618196630859376,4.937655087890625Q19.367496630859375,4.634915087890625,19.006196630859375,4.634915087890625Q18.750696630859377,4.634915087890625,18.529296630859378,4.8318550878906255ZM18.337296630859377,5.674955087890625L18.278696630859375,5.596835087890625Q18.449596630859375,5.272935087890625,18.622096630859374,5.1101750878906245Q18.794596630859374,4.947415087890625,18.967096630859373,4.947415087890625Q19.194996630859375,4.947415087890625,19.346396630859374,5.1345950878906255Q19.497696630859377,5.320135087890625,19.497696630859377,5.598455087890625Q19.497696630859377,5.8914250878906245,19.360996630859376,6.096505087890625Q19.224296630859374,6.301585087890626,19.027396630859375,6.301585087890626Q18.915096630859374,6.301585087890626,18.742496630859375,6.146965087890624Q18.569996630859375,5.992335087890625,18.337296630859377,5.674955087890625ZM17.785496630859377,5.779125087890625L17.842496630859372,5.857245087890625Q17.668296630859373,6.186025087890625,17.495796630859374,6.348785087890625Q17.324896630859374,6.509915087890625,17.153996630859375,6.509915087890625Q16.926096630859377,6.509915087890625,16.774796630859377,6.324375087890624Q16.623396630859375,6.137195087890625,16.623396630859375,5.858875087890625Q16.623396630859375,5.565905087890625,16.761696630859376,5.360825087890625Q16.900096630859373,5.1557550878906255,17.095396630859376,5.1557550878906255Q17.228896630859374,5.1557550878906255,17.365596630859375,5.2778250878906245Q17.502296630859377,5.399895087890625,17.785496630859377,5.779125087890625ZM10.710296630859375,10.634915087890626C10.710296630859375,11.024655087890626,10.561656630859375,11.379685087890625,10.317976630859375,11.646395087890625L12.879196630859376,15.171615087890626C12.985696630859374,15.147615087890625,13.096496630859376,15.134915087890626,13.210296630859375,15.134915087890626C13.306796630859376,15.134915087890626,13.401096630859374,15.144015087890624,13.492596630859374,15.161415087890624L16.819096630859377,11.196955087890625C16.748996630859374,11.023375087890624,16.710296630859375,10.833655087890625,16.710296630859375,10.634915087890626C16.710296630859375,9.806495087890625,17.381896630859373,9.134915087890626,18.210296630859375,9.134915087890626C19.038696630859373,9.134915087890626,19.710296630859375,9.806495087890625,19.710296630859375,10.634915087890626C19.710296630859375,11.463345087890625,19.038696630859373,12.134915087890626,18.210296630859375,12.134915087890626C17.949796630859375,12.134915087890626,17.704796630859377,12.068505087890625,17.491296630859374,11.951675087890624L14.364996630859375,15.677415087890624C14.580596630859375,15.937215087890625,14.710296630859375,16.270915087890625,14.710296630859375,16.634915087890626C14.710296630859375,17.463315087890624,14.038696630859375,18.134915087890626,13.210296630859375,18.134915087890626C12.381866630859374,18.134915087890626,11.710296630859375,17.463315087890624,11.710296630859375,16.634915087890626C11.710296630859375,16.284415087890626,11.830486630859374,15.962015087890626,12.031896630859375,15.706715087890625L9.425686630859374,12.119565087890624C9.355346630859376,12.129685087890625,9.283436630859375,12.134915087890626,9.210296630859375,12.134915087890626C8.872396630859374,12.134915087890626,8.560596630859376,12.023195087890626,8.309816630859375,11.834665087890626L5.215876630859375,15.521915087890624C5.519506630859375,15.796415087890624,5.710296630859375,16.193415087890624,5.710296630859375,16.634915087890626C5.710296630859375,17.463315087890624,5.038726630859375,18.134915087890626,4.210296630859375,18.134915087890626C3.381869630859375,18.134915087890626,2.710296630859375,17.463315087890624,2.710296630859375,16.634915087890626C2.710296630859375,15.806515087890626,3.381869630859375,15.134915087890626,4.210296630859375,15.134915087890626C4.218546630859375,15.134915087890626,4.226776630859375,15.135015087890626,4.234996630859375,15.135115087890625L7.744116630859375,10.953115087890625C7.721966630859375,10.850565087890626,7.710296630859375,10.744105087890624,7.710296630859375,10.634915087890626C7.710296630859375,9.806495087890625,8.381866630859374,9.134915087890626,9.210296630859375,9.134915087890626C10.038726630859376,9.134915087890626,10.710296630859375,9.806495087890625,10.710296630859375,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),$R=ta('<path d="M17.0643,7.033864912109375L18,3.585784912109375L14.5078,4.509695912109375L15.3537,5.344934912109375L6.02026,14.560584912109375C5.87635,14.517484912109374,5.72366,14.494284912109375,5.5655,14.494284912109375C4.7009,14.494284912109375,4,15.186384912109375,4,16.040084912109375C4,16.893784912109375,4.7009,17.585784912109375,5.5655,17.585784912109375C6.43011,17.585784912109375,7.13101,16.893784912109375,7.13101,16.040084912109375C7.13101,15.722284912109375,7.03392,15.426984912109376,6.86744,15.181384912109374L16.0917,6.073604912109375L17.0643,7.033864912109375Z" stroke-opacity="0" stroke="none"></path>'),DR=ta('<g transform="scale(0.7857142857)" fill="none"><path stroke="currentColor" d="M16 14a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4.5 14a9.5 9.5 0 0 1 18.7-2.37 2.5 2.5 0 0 0 0 4.74A9.5 9.5 0 0 1 4.5 14Zm19.7 2.5a10.5 10.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"></path><path fill="currentColor" d="M22.5 14a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></g>'),RR=ta('<path d="M18.8532,7.020985087890625Q19.0257,6.734525087890625,19.0257,6.369945087890625Q19.0257,6.020005087890625,18.8499,5.754705087890625Q18.6758,5.489415087890626,18.3649,5.339675087890625Q18.5944,5.209465087890625,18.7214,4.994615087890625Q18.8499,4.779775087890625,18.8499,4.5193550878906255Q18.8499,4.2003480878906245,18.7002,3.951324087890625Q18.5505,3.700673087890625,18.277,3.557444087890625Q18.0052,3.414215087890625,17.6455,3.414215087890625Q17.285800000000002,3.414215087890625,17.0107,3.557444087890625Q16.7357,3.700673087890625,16.5843,3.951324087890625Q16.4346,4.2003480878906245,16.4346,4.5193550878906255Q16.4346,4.779775087890625,16.561500000000002,4.994615087890625Q16.6901,5.209465087890625,16.919600000000003,5.339675087890625Q16.6055,5.489415087890626,16.4297,5.757965087890625Q16.255499999999998,6.024895087890625,16.255499999999998,6.369945087890625Q16.255499999999998,6.734525087890625,16.4297,7.020985087890625Q16.6055,7.305815087890625,16.919600000000003,7.465325087890625Q17.2354,7.624825087890625,17.6455,7.624825087890625Q18.0557,7.624825087890625,18.3682,7.465325087890625Q18.6807,7.305815087890625,18.8532,7.020985087890625ZM8.76432,7.559725087890625L8.13444,7.559725087890625L8.13444,4.214996087890625L7.28971,4.700025087890625L7.2946,4.070139087890625L8.310220000000001,3.479319087890625L8.76432,3.479319087890625L8.76432,7.559725087890625ZM17.1816,4.955555087890625Q17.0042,4.784655087890625,17.0042,4.5095950878906255Q17.0042,4.229645087890625,17.18,4.057119087890625Q17.355800000000002,3.884592087890625,17.6455,3.884592087890625Q17.935200000000002,3.884592087890625,18.1077,4.057119087890625Q18.2803,4.229645087890625,18.2803,4.5095950878906255Q18.2803,4.784655087890625,18.1045,4.955555087890625Q17.930300000000003,5.124825087890625,17.6455,5.124825087890625Q17.3607,5.124825087890625,17.1816,4.955555087890625ZM18.2217,5.7953950878906255Q18.4398,6.005365087890625,18.4398,6.3552950878906245Q18.4398,6.705235087890625,18.2217,6.915195087890625Q18.0052,7.125155087890625,17.6455,7.125155087890625Q17.285800000000002,7.125155087890625,17.067700000000002,6.915195087890625Q16.849600000000002,6.705235087890625,16.849600000000002,6.3552950878906245Q16.849600000000002,6.005365087890625,17.064500000000002,5.7953950878906255Q17.2793,5.585435087890625,17.6455,5.585435087890625Q18.0052,5.585435087890625,18.2217,5.7953950878906255ZM9.60768,11.711495087890626C9.85136,11.444785087890626,10,11.089765087890626,10,10.700025087890625C10,9.871595087890626,9.32843,9.200025087890625,8.5,9.200025087890625C7.67157,9.200025087890625,7,9.871595087890626,7,10.700025087890625C7,10.809205087890625,7.01167,10.915665087890625,7.03382,11.018215087890624L3.5247,15.200215087890625C3.51648,15.200115087890625,3.5082500000000003,15.200015087890625,3.5,15.200015087890625C2.671573,15.200015087890625,2,15.871615087890625,2,16.700015087890627C2,17.528415087890625,2.671573,18.200015087890627,3.5,18.200015087890627C4.32843,18.200015087890627,5,17.528415087890625,5,16.700015087890627C5,16.258515087890625,4.80921,15.861515087890625,4.50558,15.587015087890626L7.59952,11.899765087890625C7.8503,12.088295087890625,8.162099999999999,12.200025087890625,8.5,12.200025087890625C8.57314,12.200025087890625,8.645050000000001,12.194785087890626,8.71539,12.184675087890625L11.3216,15.771815087890625C11.12019,16.027215087890625,11,16.349515087890623,11,16.700015087890627C11,17.528415087890625,11.67157,18.200015087890627,12.5,18.200015087890627C13.3284,18.200015087890627,14,17.528415087890625,14,16.700015087890627C14,16.336015087890623,13.8703,16.002315087890626,13.6547,15.742515087890625L16.781,12.016775087890625C16.994500000000002,12.133605087890626,17.2395,12.200025087890625,17.5,12.200025087890625C18.3284,12.200025087890625,19,11.528445087890624,19,10.700025087890625C19,9.871595087890626,18.3284,9.200025087890625,17.5,9.200025087890625C16.671599999999998,9.200025087890625,16,9.871595087890626,16,10.700025087890625C16,10.898765087890624,16.0387,11.088475087890625,16.108800000000002,11.262055087890625L12.7823,15.226515087890625C12.6908,15.209115087890625,12.5965,15.200015087890625,12.5,15.200015087890625C12.3862,15.200015087890625,12.2754,15.212715087890626,12.1689,15.236715087890625L9.60768,11.711495087890626Z" stroke-opacity="0" stroke="none"></path>'),jR=ta('<ellipse cx="10.5" cy="11.5" rx="1.5" ry="1.5" stroke-opacity="0" stroke="none"></ellipse><ellipse cx="17.5" cy="11.5" rx="1.5" ry="1.5" stroke-opacity="0" stroke="none"></ellipse><ellipse cx="10.5" cy="11.5" rx="7" ry="7" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse><ellipse cx="10.5" cy="11.5" rx="5" ry="5" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse><ellipse cx="10.5" cy="11.5" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse>',1),BR=ta('<path d="M17,4.5C17,5.32843,16.328400000000002,6,15.5,6C15.0931,6,14.7241,5.83802,14.4539,5.57503L5.98992,8.32515C5.99658,8.38251,6,8.440850000000001,6,8.5C6,9.15311,5.582599999999999,9.70873,5,9.91465L5,11.08535C5.42621,11.236,5.763999999999999,11.57379,5.91465,12L19.5,12C19.7761,12,20,12.22386,20,12.5C20,12.77614,19.7761,13,19.5,13L5.91465,13C5.70873,13.5826,5.15311,14,4.5,14C3.671573,14,3,13.3284,3,12.5C3,11.84689,3.417404,11.29127,4,11.08535L4,9.91465C3.417404,9.70873,3,9.15311,3,8.5C3,7.67157,3.671573,7,4.5,7C4.90411,7,5.2709,7.15981,5.5406200000000005,7.41967L14.0093,4.66802C14.0032,4.6128599999999995,14,4.5568,14,4.5C14,3.671573,14.6716,3,15.5,3C16.328400000000002,3,17,3.671573,17,4.5ZM4,15.5C4,15.2239,4.22386,15,4.5,15L19.5,15C19.7761,15,20,15.2239,20,15.5C20,15.7761,19.7761,16,19.5,16L4.5,16C4.22386,16,4,15.7761,4,15.5ZM4,18.5C4,18.2239,4.22386,18,4.5,18L19.5,18C19.7761,18,20,18.2239,20,18.5C20,18.7761,19.7761,19,19.5,19L4.5,19C4.22386,19,4,18.7761,4,18.5Z" stroke-opacity="0" stroke="none"></path>'),OR=ta('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M21 15H3a1 1 0 0 1 0-2h18a1 1 0 0 1 0 2Zm-2-3a2.99 2.99 0 0 1-2.816-2H3a1 1 0 0 1 0-2h13.184A2.995 2.995 0 1 1 19 12Zm0-4a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm2-3H3a1 1 0 0 1 0-2h18a1 1 0 1 1 0 2ZM5 16a2.99 2.99 0 0 1 2.816 2H21a1 1 0 0 1 0 2H7.816A2.995 2.995 0 1 1 5 16Zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"></path></g>'),zR=ta('<path d="M4,17.0854L4,3.5C4,3.223858,4.22386,3,4.5,3C4.77614,3,5,3.223858,5,3.5L5,10L7.57584,10L9.8127,4.46359C9.91614,4.20756,10.20756,4.08386,10.46359,4.1873000000000005C10.71963,4.29075,10.84333,4.58216,10.73988,4.8382000000000005L8.65438,10L11.08535,10C11.29127,9.4174,11.84689,9,12.5,9C12.65154,9,12.79784,9.02247,12.93573,9.06427L16.6464,5.35355C16.8417,5.15829,17.1583,5.15829,17.3536,5.35355C17.5488,5.54882,17.5488,5.8654,17.3536,6.06066L13.7475,9.66675C13.907,9.90508,14,10.19168,14,10.5C14,11.15311,13.5826,11.70873,13,11.91465L13,14.3638L18.3714,12.1936C18.6274,12.09015,18.918799999999997,12.21385,19.0222,12.46989C19.1257,12.72592,19.002,13.0173,18.746000000000002,13.1208L13,15.4423L13,18L19.5,18C19.7761,18,20,18.2239,20,18.5C20,18.7761,19.7761,19,19.5,19L5.91465,19C5.70873,19.5826,5.15311,20,4.5,20C3.671573,20,3,19.3284,3,18.5C3,17.846899999999998,3.417404,17.2913,4,17.0854ZM6.3729499999999994,17.0413L12,14.7678L12,11.91465C11.88136,11.87271,11.76956,11.81627,11.66675,11.74746L6.3729499999999994,17.0413ZM12,15.8463L6.6694700000000005,18L12,18L12,15.8463ZM6.38629,15.6137L8.250350000000001,11L11,11L6.38629,15.6137ZM5,11L7.17182,11L5,16.3754L5,11Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),VR=ta('<path d="M3,7.32468C5.90649,3.3893050000000002,11.49833,2.81306,14.6674,6.31944C14.9056,6.1554199999999994,15.192,6.05979,15.5,6.05979C15.845,6.05979,16.1628,6.17974,16.4162,6.381349999999999L18.4509,4.23827L19,4.816615L16.8945,7.03429C16.962600000000002,7.21075,17,7.40319,17,7.60463C17,8.45782,16.328400000000002,9.14947,15.5,9.14947C14.6716,9.14947,14,8.45782,14,7.60463C14,7.36402,14.0534,7.13625,14.1487,6.93322C11.32695,3.748365,6.25159,4.253956,3.612785,7.82695L3,7.32468ZM14.09,15.4717C15.7427,13.78985,16.244500000000002,11.524740000000001,15.5633,9.30134L15.5618,9.30134L16.3012,9.0502C17.072400000000002,11.56646,16.497700000000002,14.158,14.6282,16.0599C12.28737,18.442,8.62386,18.6988,6.41348,16.4501C4.5526,14.5572,4.52076,11.19671,6.36766,9.3177C7.89069,7.76754,10.07544,7.706189999999999,11.56741,9.22363C11.95453,9.61742,12.24817,10.08363,12.43369,10.57677L14.1451,8.77421L14.6942,9.35256L12.64982,11.50582C12.65827,11.59712,12.66295,11.68839,12.66378,11.77936C12.87398,12.04523,13,12.38451,13,12.7541C13,13.60729,12.32843,14.2989,11.5,14.2989C10.67157,14.2989,10,13.60729,10,12.7541C10,11.90091,10.67157,11.20926,11.5,11.20926C11.60387,11.20926,11.70528,11.220130000000001,11.8032,11.240829999999999L11.81763,11.22564C11.69858,10.71874,11.42858,10.21929,11.0284,9.81179C9.844000000000001,8.60765,8.136890000000001,8.65592,6.90822,9.90586C5.37975,11.460930000000001,5.40693,14.288,6.95404,15.8619C8.84598,17.7867,12.03496,17.5626,14.09,15.4717Z" stroke-opacity="0" stroke="none"></path>'),WR=ta('<path d="M8.13444,7.494615087890625L8.76432,7.494615087890625L8.76432,3.414215087890625L8.310220000000001,3.414215087890625L7.2946,4.005035087890625L7.28971,4.634915087890625L8.13444,4.149892087890625L8.13444,7.494615087890625ZM18.832,6.929835087890625Q19.0046,6.635245087890625,19.0046,6.2543850878906255Q19.0046,5.889805087890625,18.8451,5.5952050878906245Q18.6855,5.3006050878906255,18.3975,5.132965087890625Q18.1094,4.9653250878906245,17.7399,4.9653250878906245Q17.435499999999998,4.9653250878906245,17.1556,5.149245087890625L17.2793,3.939931087890625L18.8304,3.939931087890625L18.8304,3.414215087890625L16.7406,3.414215087890625L16.5094,5.665195087890625L17.0156,5.795405087890625Q17.095399999999998,5.655425087890626,17.2516,5.570795087890625Q17.4095,5.484525087890625,17.6357,5.484525087890625Q17.9694,5.484525087890625,18.1842,5.697745087890625Q18.4007,5.909335087890625,18.4007,6.2543850878906255Q18.4007,6.604315087890625,18.1842,6.822415087890625Q17.9694,7.0405150878906255,17.6292,7.0405150878906255Q17.3298,7.0405150878906255,17.119799999999998,6.890775087890625Q16.9098,6.739415087890626,16.825200000000002,6.474115087890625L16.3597,6.749175087890626Q16.470399999999998,7.110505087890624,16.807299999999998,7.335115087890625Q17.144199999999998,7.559725087890625,17.6292,7.559725087890625Q18.0296,7.559725087890625,18.3438,7.392075087890625Q18.6595,7.224435087890625,18.832,6.929835087890625ZM10,10.634915087890626C10,11.024655087890626,9.85136,11.379685087890625,9.60768,11.646395087890625L12.1689,15.171615087890626C12.2754,15.147615087890625,12.3862,15.134915087890626,12.5,15.134915087890626C12.5965,15.134915087890626,12.6908,15.144015087890624,12.7823,15.161415087890624L16.108800000000002,11.196955087890625C16.0387,11.023375087890624,16,10.833655087890625,16,10.634915087890626C16,9.806495087890625,16.671599999999998,9.134915087890626,17.5,9.134915087890626C18.3284,9.134915087890626,19,9.806495087890625,19,10.634915087890626C19,11.463345087890625,18.3284,12.134915087890626,17.5,12.134915087890626C17.2395,12.134915087890626,16.994500000000002,12.068505087890625,16.781,11.951675087890624L13.6547,15.677415087890624C13.8703,15.937215087890625,14,16.270915087890625,14,16.634915087890626C14,17.463315087890624,13.3284,18.134915087890626,12.5,18.134915087890626C11.67157,18.134915087890626,11,17.463315087890624,11,16.634915087890626C11,16.284415087890626,11.12019,15.962015087890626,11.3216,15.706715087890625L8.71539,12.119565087890624C8.645050000000001,12.129685087890625,8.57314,12.134915087890626,8.5,12.134915087890626C8.162099999999999,12.134915087890626,7.8503,12.023195087890626,7.59952,11.834665087890626L4.50558,15.521915087890624C4.80921,15.796415087890624,5,16.193415087890624,5,16.634915087890626C5,17.463315087890624,4.32843,18.134915087890626,3.5,18.134915087890626C2.671573,18.134915087890626,2,17.463315087890624,2,16.634915087890626C2,15.806515087890626,2.671573,15.134915087890626,3.5,15.134915087890626C3.5082500000000003,15.134915087890626,3.51648,15.135015087890626,3.5247,15.135115087890625L7.03382,10.953115087890625C7.01167,10.850565087890626,7,10.744105087890624,7,10.634915087890626C7,9.806495087890625,7.67157,9.134915087890626,8.5,9.134915087890626C9.32843,9.134915087890626,10,9.806495087890625,10,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),HR=ta('<path d="M20,3.5C20,4.15311,19.5826,4.70873,19,4.91465L19,18.5C19,18.7761,18.7761,19,18.5,19L4.91465,19C4.70873,19.5826,4.15311,20,3.5,20C2.671573,20,2,19.3284,2,18.5C2,17.846899999999998,2.417404,17.2913,3,17.0854L3,3.5C3,3.22386,3.22386,3,3.5,3L17.0854,3C17.2913,2.417404,17.846899999999998,2,18.5,2C19.3284,2,20,2.671573,20,3.5ZM17.0854,4C17.236,4.42621,17.5738,4.763999999999999,18,4.91465L18,8L14,8L14,4L17.0854,4ZM13,4L13,8L9,8L9,4L13,4ZM13,9L9,9L9,13L13,13L13,9ZM13,14L9,14L9,18L13,18L13,14ZM14,18L14,14L18,14L18,18L14,18ZM18,13L14,13L14,9L18,9L18,13ZM4.91465,18C4.763999999999999,17.5738,4.42621,17.236,4,17.0854L4,14L8,14L8,18L4.91465,18ZM4,8L4,4L8,4L8,8L4,8ZM8,9L8,13L4,13L4,9L8,9Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),qR=ta('<path d="M6.91465,11L11.08535,11C11.29127,10.417404,11.84689,10,12.5,10C13.15311,10,13.70873,10.417404,13.91465,11L18.5,11C18.7761,11,19,11.22386,19,11.5C19,11.77614,18.7761,12,18.5,12L13.91465,12C13.70873,12.5826,13.15311,13,12.5,13C11.84689,13,11.29127,12.5826,11.08535,12L6.91465,12C6.70873,12.5826,6.15311,13,5.5,13C4.671573,13,4,12.32843,4,11.5C4,10.671573,4.671573,10,5.5,10C6.15311,10,6.70873,10.417404,6.91465,11Z" stroke-opacity="0" stroke="none"></path>'),UR=ta('<path d="M6.91465,12.5C6.70873,13.0826,6.15311,13.5,5.5,13.5C4.671573,13.5,4,12.82843,4,12C4,11.171573,4.671573,10.5,5.5,10.5C6.15311,10.5,6.70873,10.917404,6.91465,11.5L16.0853,11.5C16.2913,10.917404,16.846899999999998,10.5,17.5,10.5C18.328400000000002,10.5,19,11.171573,19,12C19,12.82843,18.328400000000002,13.5,17.5,13.5C16.846899999999998,13.5,16.2913,13.0826,16.0853,12.5L6.91465,12.5Z" stroke-opacity="0" stroke="none"></path>'),GR=ta('<path d="M5.80417,14.9887L4.62563,16.167299999999997C4.43037,16.3625,4.43037,16.6791,4.62563,16.8744C4.82089,17.0696,5.13748,17.0696,5.332739999999999,16.8744L6.62638,15.5807C7.75595,16.290100000000002,9.19328,16.7929,11,16.7929C16.165399999999998,16.7929,18.3323,12.64289,18.8866,11.36789C19.0378,10.99289,19.0378,10.59289,18.8866,10.21789C18.5549,9.45486,17.6456,7.66212,15.8617,6.34545L17.3536,4.853553C17.5488,4.658291,17.5488,4.341709,17.3536,4.146447C17.1583,3.9511845,16.8417,3.9511845,16.6464,4.146447L15.0014,5.7915399999999995C13.9314,5.1969,12.61166,4.792893,11,4.792893C5.80945,4.792893,3.667717,8.94289,3.113386,10.21789C2.9622049,10.59289,2.9622049,10.99289,3.113386,11.36789C3.424435,12.08333,4.2353000000000005,13.70399,5.80417,14.9887ZM7.36012,14.847C8.32327,15.4074,9.52286,15.7929,11,15.7929C15.5606,15.7929,17.4756,12.11789,17.9543,10.99289C18.0047,10.86789,18.0047,10.74289,17.9543,10.61789C17.659,9.90846,16.8171,8.23812,15.1447,7.06241L12.96929,9.23782C13.3134,9.66543,13.5197,10.20642,13.5197,10.79289C13.5197,12.16789,12.38583,13.29289,11,13.29289C10.41596,13.29289,9.87667,13.09308,9.44815,12.75896L7.36012,14.847ZM8.794609999999999,11.99829L6.520099999999999,14.2728C5.06905,13.12119,4.32057,11.628250000000001,4.04567,10.96789C3.995275,10.84289,3.995275,10.71789,4.04567,10.59289C4.52441,9.46789,6.43937,5.79289,11,5.79289C12.28868,5.79289,13.3661,6.086320000000001,14.2596,6.53329L12.19759,8.5953C11.84086,8.40257,11.43271,8.29289,11,8.29289C9.61417,8.29289,8.480319999999999,9.41789,8.480319999999999,10.79289C8.480319999999999,11.22918,8.594470000000001,11.64029,8.794609999999999,11.99829ZM10.16528,12.04183C10.404869999999999,12.20032,10.692070000000001,12.29289,11,12.29289C11.8315,12.29289,12.51181,11.61789,12.51181,10.79289C12.51181,10.48318,12.41593,10.194600000000001,12.25216,9.95494L10.16528,12.04183ZM11.43602,9.35687L9.55616,11.236740000000001C9.512,11.09633,9.48819,10.94724,9.48819,10.79289C9.48819,9.96789,10.1685,9.29289,11,9.29289C11.15142,9.29289,11.29782,9.31528,11.43602,9.35687Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),YR=ta('<path d="M11,17C5.80945,17,3.667717,12.85,3.113386,11.575C2.9622047,11.2,2.9622047,10.8,3.113386,10.425C3.667717,9.15,5.80945,5,11,5C16.165399999999998,5,18.3323,9.15,18.8866,10.425C19.0378,10.8,19.0378,11.2,18.8866,11.575C18.3323,12.85,16.165399999999998,17,11,17ZM4.04567,10.8C3.995276,10.925,3.995276,11.05,4.04567,11.175C4.52441,12.325,6.43937,16,11,16C15.5606,16,17.4756,12.325,17.9543,11.2C18.0047,11.075,18.0047,10.95,17.9543,10.825C17.4756,9.675,15.5606,6,11,6C6.43937,6,4.52441,9.675,4.04567,10.8ZM11,13.5C9.61417,13.5,8.480319999999999,12.375,8.480319999999999,11C8.480319999999999,9.625,9.61417,8.5,11,8.5C12.38583,8.5,13.5197,9.625,13.5197,11C13.5197,12.375,12.38583,13.5,11,13.5ZM11,9.5C10.1685,9.5,9.48819,10.175,9.48819,11C9.48819,11.825,10.1685,12.5,11,12.5C11.8315,12.5,12.51181,11.825,12.51181,11C12.51181,10.175,11.8315,9.5,11,9.5Z" fill-opacity="1" stroke="currentColor" stroke-width="1"></path>'),KR=ta('<defs><clipPath id="master_svg0_151_625"><rect x="0" y="0" width="22" height="22" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_151_625)"><path d="M14.5385,9.76923L15.6538,9.76923C16.6538,9.76923,17.4615,10.576920000000001,17.4615,11.576920000000001L17.4615,17.1923C17.4615,18.1923,16.6538,19,15.6538,19L5.80769,19C4.807692,19,4,18.1923,4,17.1923L4,11.576920000000001C4,10.576920000000001,4.807692,9.76923,5.80769,9.76923L7.23077,9.76923L7.23077,7.576919999999999C7.23077,5.61538,8.88462,4,10.88462,4C12.88462,4,14.5385,5.61538,14.5385,7.576919999999999L14.5385,9.76923ZM10.88461,5.15385C9.5,5.15385,8.38461,6.23077,8.38461,7.576919999999999L8.38461,9.76923L13.38462,9.76923L13.38462,7.576919999999999C13.38462,6.23077,12.26923,5.15385,10.88461,5.15385ZM15.6538,17.8462C16,17.8462,16.3077,17.5385,16.3077,17.1923L16.3077,11.576920000000001C16.3077,11.23077,16,10.923079999999999,15.6538,10.923079999999999L5.80769,10.923079999999999C5.46154,10.923079999999999,5.15385,11.23077,5.15385,11.576920000000001L5.15385,17.1923C5.15385,17.5385,5.46154,17.8462,5.80769,17.8462L15.6538,17.8462ZM10.153839999999999,12.65385C10.153839999999999,12.34615,10.42307,12.07692,10.73076,12.07692C11.038450000000001,12.07692,11.307680000000001,12.34615,11.307680000000001,12.65385L11.307680000000001,14.5769C11.307680000000001,14.8846,11.038450000000001,15.1538,10.73076,15.1538C10.42307,15.1538,10.153839999999999,14.8846,10.153839999999999,14.5769L10.153839999999999,12.65385Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path></g>',1),XR=ta('<path d="M19.6401,7.99355C20.4028,7.92291,21,7.2811900000000005,21,6.5C21,5.671573,20.3284,5,19.5,5C18.8469,5,18.2913,5.417404,18.0854,6L7.62067,6C7.34453,6,7.12067,6.22386,7.12067,6.5C7.12067,6.5479,7.12741,6.59423,7.13999,6.63809L3.2294099999999997,15.0243C2.530138,15.1517,2,15.764,2,16.5C2,17.328400000000002,2.671573,18,3.5,18C4.15311,18,4.70873,17.5826,4.91465,17L14.5963,17C14.6456,17.076,14.7162,17.1396,14.8044,17.1807C15.0546,17.2974,15.3521,17.1891,15.4688,16.9388L19.6401,7.99355ZM14.7896,16.0293L18.6551,7.739599999999999C18.3942,7.56144,18.1925,7.30307,18.0854,7L8.0746,7L4.25044,15.2009C4.55701,15.3784,4.79493,15.6613,4.91465,16L14.6207,16C14.68,16,14.7368,16.0103,14.7896,16.0293Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),ZR=ta('<path d="M3.3367688759765626,12.63173C3.5320318759765623,12.82699,3.8486138759765627,12.82699,4.043876875976562,12.63173L11.822052875976562,4.853553C12.017312875976563,4.658291,12.017312875976563,4.341708,11.822052875976562,4.146446C11.626792875976562,3.9511843,11.310202875976563,3.9511843,11.114942875976563,4.146446L3.3367688759765626,11.92462C3.1415071759765625,12.11988,3.1415071759765625,12.43647,3.3367688759765626,12.63173ZM5.001492875976562,17.0351C4.806232875976562,16.8399,4.806232875976562,16.5233,5.001492875976562,16.328L7.304532875976562,14.025C7.210822875976563,13.82916,7.158352875976563,13.60984,7.158352875976563,13.37827C7.158352875976563,12.54984,7.829922875976562,11.87827,8.658352875976561,11.87827C8.889922875976563,11.87827,9.109232875976563,11.93075,9.305052875976562,12.02446L11.304532875976562,10.02498C11.210822875976563,9.82916,11.158352875976561,9.60984,11.158352875976561,9.37827C11.158352875976561,8.54984,11.829922875976562,7.8782700000000006,12.658352875976563,7.8782700000000006C12.889922875976563,7.8782700000000006,13.109232875976563,7.93075,13.305022875976562,8.024460000000001L15.608122875976562,5.72142C15.803322875976562,5.5261499999999995,16.119922875976563,5.5261499999999995,16.315222875976563,5.72142C16.510422875976563,5.9166799999999995,16.510422875976563,6.23326,16.315222875976563,6.42852L14.012122875976562,8.73156C14.105822875976562,8.92738,14.158322875976562,9.1467,14.158322875976562,9.37827C14.158322875976562,10.2067,13.486822875976562,10.87827,12.658352875976563,10.87827C12.426772875976562,10.87827,12.207452875976562,10.82579,12.011642875976563,10.73209L10.012162875976562,12.73156C10.105872875976562,12.92738,10.158352875976561,13.1467,10.158352875976561,13.37827C10.158352875976561,14.2067,9.486772875976563,14.8783,8.658352875976561,14.8783C8.426772875976562,14.8783,8.207452875976562,14.8258,8.011642875976563,14.7321L5.708602875976562,17.0351C5.513342875976562,17.2304,5.196752875976562,17.2304,5.001492875976562,17.0351ZM10.415712875976563,18.328C10.220452875976562,18.5233,9.903862875976563,18.5233,9.708602875976563,18.328C9.513342875976562,18.1328,9.513342875976562,17.816200000000002,9.708602875976563,17.6209L12.304532875976562,15.025C12.210822875976563,14.8292,12.158352875976563,14.6098,12.158352875976563,14.3783C12.158352875976563,13.54984,12.829922875976562,12.87827,13.658322875976562,12.87827C13.889922875976563,12.87827,14.109222875976563,12.93075,14.305022875976562,13.02446L17.486822875976564,9.84274C17.682022875976564,9.64747,17.99862287597656,9.64747,18.19392287597656,9.84274C18.38912287597656,10.038,18.38912287597656,10.35458,18.19392287597656,10.54984L15.012122875976562,13.73156C15.105822875976562,13.92738,15.158322875976562,14.1467,15.158322875976562,14.3783C15.158322875976562,15.2067,14.486822875976562,15.8783,13.658322875976562,15.8783C13.426822875976562,15.8783,13.207422875976562,15.8258,13.011642875976563,15.7321L10.415712875976563,18.328Z" stroke-opacity="0" stroke="none"></path>'),JR=ta('<path d="M3.146447,14.178126025390625C2.9511847,13.982826025390626,2.9511847,13.666226025390625,3.146447,13.470926025390625L7.39146,9.225966025390626C7.35417,9.095106025390624,7.33421,8.956946025390625,7.33421,8.814116025390625C7.33421,7.985696025390625,8.00578,7.314116025390625,8.834209999999999,7.314116025390625C8.97703,7.314116025390625,9.11519,7.334086025390625,9.24605,7.371366025390625L13.753,2.864373025390625C13.9483,2.669110325390625,14.2649,2.669110325390625,14.4602,2.864373025390625C14.6554,3.059635025390625,14.6554,3.376217025390625,14.4602,3.571479025390625L10.06916,7.962476025390625C10.23631,8.204386025390626,10.334209999999999,8.497826025390625,10.334209999999999,8.814116025390625C10.334209999999999,9.642546025390626,9.66264,10.314116025390625,8.834209999999999,10.314116025390625C8.51791,10.314116025390625,8.22448,10.216226025390625,7.98256,10.049076025390626L3.853554,14.178126025390625C3.658291,14.373326025390625,3.341709,14.373326025390625,3.146447,14.178126025390625ZM7.67736,19.188526025390626C7.4821,18.993226025390626,7.4821,18.676626025390625,7.67736,18.481426025390626L9.9804,16.178326025390625C9.88669,15.982526025390625,9.834209999999999,15.763226025390624,9.834209999999999,15.531626025390626C9.834209999999999,14.703226025390626,10.50578,14.031626025390626,11.33421,14.031626025390626C11.56579,14.031626025390626,11.78511,14.084126025390624,11.98093,14.177826025390624L13.9804,12.178356025390626C13.8867,11.982536025390624,13.8342,11.763216025390625,13.8342,11.531636025390625C13.8342,10.703206025390624,14.5058,10.031636025390625,15.3342,10.031636025390625C15.5658,10.031636025390625,15.7851,10.084116025390625,15.9809,10.177826025390626L18.284,7.874796025390625C18.4792,7.679536025390625,18.7958,7.679536025390625,18.9911,7.874796025390625C19.1863,8.070056025390624,19.1863,8.386636025390626,18.9911,8.581906025390625L16.688000000000002,10.884936025390624C16.7817,11.080756025390626,16.8342,11.300066025390626,16.8342,11.531636025390625C16.8342,12.360066025390624,16.162599999999998,13.031626025390626,15.3342,13.031626025390626C15.1026,13.031626025390626,14.8833,12.979126025390626,14.6875,12.885426025390625L12.68803,14.884926025390625C12.78174,15.080726025390625,12.83421,15.300026025390626,12.83421,15.531626025390626C12.83421,16.360026025390624,12.16264,17.031626025390626,11.33421,17.031626025390626C11.10264,17.031626025390626,10.88333,16.979126025390627,10.68751,16.885426025390625L8.38446,19.188526025390626C8.1892,19.383726025390626,7.87262,19.383726025390626,7.67736,19.188526025390626Z" stroke-opacity="0" stroke="none"></path>'),QR=ta('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="m2.285 10.333 8.048-8.048a.977.977 0 1 1 1.381 1.381l-8.048 8.049a.977.977 0 0 1-1.381-1.382Zm10 10 8.048-8.048a.977.977 0 1 1 1.381 1.381l-8.048 8.049a.977.977 0 0 1-1.381-1.382ZM19 8a2.966 2.966 0 0 1-1.308-.312l-10 10c.202.408.307.857.308 1.312a3.03 3.03 0 1 1-1.693-2.689l10-10A2.993 2.993 0 1 1 19 8ZM5 18a1 1 0 1 0 0 2 1 1 0 0 0 0-2ZM19 4a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"></path></g>'),ej=ta('<path d="M6.91465,13.00505L18.5,13.00505C18.7761,13.00505,19,13.228909999999999,19,13.50505C19,13.781189999999999,18.7761,14.00505,18.5,14.00505L6.91465,14.00505C6.70873,14.58765,6.15311,15.00505,5.5,15.00505C4.671573,15.00505,4,14.33348,4,13.50505C4,12.67662,4.671573,12.00505,5.5,12.00505C6.15311,12.00505,6.70873,12.422450000000001,6.91465,13.00505ZM7.81404,11.625L10.48591,11.625L10.48591,10.90625L9.65193,10.90625L9.65193,7.125L8.997630000000001,7.125C8.71443,7.306641,8.415600000000001,7.419922,7.96443,7.498047L7.96443,8.05078L8.77497,8.05078L8.77497,10.90625L7.81404,10.90625L7.81404,11.625ZM11.081620000000001,11.625L14.0562,11.625L14.0562,10.88281L13.09724,10.88281C12.8863,10.88281,12.59333,10.90625,12.36482,10.93555C13.17537,10.11328,13.84724,9.2207,13.84724,8.39062C13.84724,7.541016,13.28865,7,12.4488,7C11.84333,7,11.446850000000001,7.234375,11.03279,7.679688L11.52497,8.16797C11.747630000000001,7.914062,12.0113,7.697266,12.33552,7.697266C12.7613,7.697266,13.00154,7.982422,13.00154,8.43359C13.00154,9.14648,12.29255,10.00781,11.081620000000001,11.11523L11.081620000000001,11.625ZM15.9605,11.75C16.8121,11.75,17.526899999999998,11.2832,17.526899999999998,10.4375C17.526899999999998,9.82031,17.142200000000003,9.43945,16.6441,9.30078L16.6441,9.27148C17.1129,9.08594,17.3824,8.7207,17.3824,8.21289C17.3824,7.421875,16.8004,7,15.9429,7C15.4215,7,14.9957,7.210938,14.6109,7.541016L15.066,8.11133C15.3258,7.849609,15.5836,7.697266,15.9019,7.697266C16.2789,7.697266,16.4957,7.914062,16.4957,8.28125C16.4957,8.70898,16.2301,9,15.4215,9L15.4215,9.63672C16.3804,9.63672,16.6383,9.91992,16.6383,10.38086C16.6383,10.79688,16.3336,11.03125,15.8824,11.03125C15.4742,11.03125,15.1578,10.82227,14.8922,10.55078L14.4781,11.13281C14.7906,11.486329999999999,15.2652,11.75,15.9605,11.75Z" stroke-opacity="0" stroke="none"></path>'),tj=ta('<g transform="scale(0.7857142857)" fill="currentColor" fill-rule="nonzero"><path d="M8.354 20.354l5-5-.707-.707-5 5z"></path><path d="M16.354 12.354l8-8-.707-.707-8 8z"></path><path d="M14.5 15c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM6.5 23c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g>'),nj=ta('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M3 6C3 7.30622 3.83481 8.41746 5 8.82929V15.1707C3.83481 15.5825 3 16.6938 3 18C3 19.6569 4.34315 21 6 21C7.30622 21 8.41746 20.1652 8.82929 19H15.1707C15.5825 20.1652 16.6938 21 18 21C19.6569 21 21 19.6569 21 18C21 16.6938 20.1652 15.5825 19 15.1707V8.82929C20.1652 8.41746 21 7.30622 21 6C21 4.34315 19.6569 3 18 3C16.6938 3 15.5825 3.83481 15.1707 5H8.82929C8.41746 3.83481 7.30622 3 6 3C4.34315 3 3 4.34315 3 6ZM6 7C6.55228 7 7 6.55228 7 6C7 5.44772 6.55228 5 6 5C5.44772 5 5 5.44772 5 6C5 6.55228 5.44772 7 6 7ZM17 15.1707V8.82929C16.1476 8.52801 15.472 7.85242 15.1707 7H8.82929C8.52801 7.85241 7.85241 8.52801 7 8.82929V15.1707C7.85241 15.472 8.52801 16.1476 8.82929 17H15.1707C15.472 16.1476 16.1476 15.472 17 15.1707ZM18 7C18.5523 7 19 6.55228 19 6C19 5.44772 18.5523 5 18 5C17.4477 5 17 5.44772 17 6C17 6.55228 17.4477 7 18 7ZM7 18C7 18.5523 6.55228 19 6 19C5.44772 19 5 18.5523 5 18C5 17.4477 5.44772 17 6 17C6.55228 17 7 17.4477 7 18ZM19 18C19 18.5523 18.5523 19 18 19C17.4477 19 17 18.5523 17 18C17 17.4477 17.4477 17 18 17C18.5523 17 19 17.4477 19 18Z"></path></g>'),sj=ta('<path d="M16.966900000000003,8.67144C16.6669,8.67144,16.4247,8.91558,16.4247,9.21802L16.4247,16.631500000000003C16.4247,17.322,16.007199999999997,17.9068,15.5139,17.9068L13.93072,17.9068L13.93072,9.2162C13.93072,8.91741,13.68675,8.67144,13.38855,8.67144C13.09036,8.67144,12.84639,8.91741,12.84639,9.21802L12.84639,17.9068L10.151810000000001,17.9068L10.151810000000001,9.21802C10.151810000000001,8.91741,9.90783,8.67144,9.609639999999999,8.67144C9.31145,8.67144,9.06747,8.91741,9.06747,9.219850000000001L9.06747,17.9068L7.48614,17.9068C6.99277,17.9068,6.5753,17.322,6.5753,16.631500000000003L6.5753,9.21802C6.5753,8.91558,6.333130000000001,8.67144,6.03313,8.67144C5.73313,8.67144,5.49096,8.91558,5.49096,9.21802L5.49096,16.631500000000003C5.49096,17.9378,6.385540000000001,19,7.48614,19L15.512,19C16.6127,19,17.509,17.9378,17.509,16.631500000000003L17.509,9.21802C17.509,8.91558,17.2669,8.67144,16.966900000000003,8.67144ZM18.4578,6.21183L4.542169,6.21183C4.243976,6.21183,4,6.45779,4,6.75841C4,7.05903,4.243976,7.30499,4.542169,7.30499L18.4578,7.30499C18.756,7.30499,19,7.05903,19,6.75841C19,6.45779,18.756,6.21183,18.4578,6.21183ZM8.68072,5.10045L14.3193,5.10045C14.6175,5.10045,14.8614,4.852666,14.8614,4.550225C14.8614,4.247783,14.6175,4,14.3193,4L8.68072,4C8.38253,4,8.13855,4.247783,8.13855,4.550225C8.13855,4.852666,8.38253,5.10045,8.68072,5.10045Z" fill-opacity="1" stroke="currentColor" stroke-width="1"></path>'),oj=ta('<circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="1.5"></circle><circle cx="8.5" cy="8.5" r="1" fill="currentColor"></circle><circle cx="13.5" cy="8.5" r="1" fill="currentColor"></circle><path d="M7.5 13.5 Q11 16.5 14.5 13.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>',1),ij=ta('<g fill="currentColor"><path d="M5 5h12v2h-5v10h-2V7H5z"></path></g>'),rj=ta('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M19.054 7.988a2.988 2.988 0 0 1-1.31-.312l-10 10a3.027 3.027 0 1 1-1.38-1.381l10-10a2.994 2.994 0 1 1 2.69 1.693Zm-14 10a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm14-14a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"></path></g>'),aj=ta('<path d="M6,4L6,8L4,8L4,16L6,16L6,20L8,20L8,16L10,16L10,8L8,8L8,4L6,4ZM14,2L14,6L12,6L12,14L14,14L14,18L16,18L16,14L18,14L18,6L16,6L16,2L14,2Z" stroke-opacity="0" stroke="none"></path>'),lj=ta('<path d="M3,18L4.5,16.5L8,13L12,17L16,13L19,16L21,14L19,12L16,15L12,11L8,15L4.5,18.5L3,20Z" stroke-opacity="0" stroke="none"></path>'),cj=ta('<path d="M3,18L4.5,16.5L8,13L12,17L16,13L19,16L21,14L21,20L3,20Z" stroke-opacity="0" stroke="none"></path>'),uj=ta('<path d="M6,4L6,8L4,8L4,16L6,16L6,20L8,20L8,16L10,16L10,8L8,8L8,4L6,4ZM14,2L14,6L12,6L12,14L14,14L14,18L16,18L16,14L18,14L18,6L16,6L16,2L14,2Z" stroke-opacity="0" stroke="none" fill="currentColor"></path>'),dj=ta('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect>',1),fj=ta('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="currentColor" fill-opacity="0.3"></rect>',1),pj=ta('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="currentColor" fill-opacity="0.3"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect>',1),mj=ta('<path d="M6,4L6,20M12,2L12,22M18,3L18,21" stroke="currentColor" stroke-width="0.5"></path><path d="M4,8L6,8M6,16L8,16M10,6L12,6M12,16L14,16M16,7L18,7M18,13L20,13" stroke="currentColor" stroke-width="0.5"></path>',1),hj=ta('<g stroke-width="1.2" fill="none"><g stroke="#00E6D8"><line x1="3" y1="13" x2="6" y2="16"></line><line x1="6" y1="13" x2="3" y2="16"></line><line x1="3" y1="9" x2="6" y2="12"></line><line x1="6" y1="9" x2="3" y2="12"></line><line x1="3" y1="5" x2="6" y2="8"></line><line x1="6" y1="5" x2="3" y2="8"></line></g><g stroke="#FF4D4D"><circle cx="10.5" cy="10.5" r="1.8"></circle><circle cx="10.5" cy="14.5" r="1.8"></circle><circle cx="10.5" cy="18.5" r="1.8"></circle></g><g stroke="#00E6D8"><line x1="15" y1="9" x2="18" y2="12"></line><line x1="18" y1="9" x2="15" y2="12"></line><line x1="15" y1="5" x2="18" y2="8"></line><line x1="18" y1="5" x2="15" y2="8"></line></g></g>'),vj=ta('<path d="M5.146447,15.753C4.9511845,15.9483,4.9511845,16.2649,5.146447,16.4602C5.341709,16.6554,5.658291,16.6554,5.853554,16.4602L8.156600000000001,14.15711C8.352409999999999,14.25082,8.57173,14.3033,8.8033,14.3033C9.631730000000001,14.3033,10.3033,13.63172,10.3033,12.80329C10.3033,12.57172,10.250820000000001,12.352409999999999,10.157119999999999,12.15659L12.156600000000001,10.15711C12.352409999999999,10.250820000000001,12.571729999999999,10.30329,12.8033,10.30329C13.63173,10.30329,14.3033,9.63172,14.3033,8.80329C14.3033,8.57172,14.25082,8.352409999999999,14.15712,8.15659L16.4602,5.853553C16.6554,5.658291,16.6554,5.341709,16.4602,5.146447C16.2649,4.9511843,15.9483,4.9511843,15.753,5.146447L13.45001,7.449479999999999C13.25419,7.35577,13.03487,7.3032900000000005,12.8033,7.3032900000000005C11.97487,7.3032900000000005,11.3033,7.97487,11.3033,8.80329C11.3033,9.03487,11.35578,9.254190000000001,11.44949,9.450009999999999L9.450009999999999,11.449480000000001C9.254190000000001,11.35577,9.03487,11.30329,8.8033,11.30329C7.97487,11.30329,7.3033,11.97487,7.3033,12.80329C7.3033,13.03487,7.35578,13.25419,7.44949,13.45001L5.146447,15.753Z" stroke-opacity="0" stroke="none"></path>'),gj=ta('<defs><clipPath id="master_svg0_151_615"><rect x="0" y="0" width="22" height="22" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_151_615)"><path d="M19.672,3.0673368C19.4417,2.9354008,19.1463,3.00292252,18.9994,3.2210900000000002L17.4588,5.50622L16.743299999999998,3.781253L13.9915,7.4662L13.9618,7.51108C13.8339,7.72862,13.8936,8.005659999999999,14.1004,8.15391L14.1462,8.183430000000001C14.3683,8.308720000000001,14.6511,8.25001,14.8022,8.047229999999999L16.4907,5.78571L17.246299999999998,7.60713L19.8374,3.7635389999999997L19.8651,3.717088C19.9871,3.484615,19.9023,3.199273,19.672,3.0673368ZM4.79974,8.462530000000001L10.117740000000001,3.252975C10.31381,3.0610145,10.63152,3.0610145,10.82759,3.252975L13.4115,5.78453C13.6076,5.976710000000001,13.6076,6.28833,13.4115,6.4805L8.093869999999999,11.69045C7.48847,12.28368,7.51659,13.3308,8.151309999999999,13.9528C8.786439999999999,14.5755,9.85421,14.6027,10.45961,14.0087L15.7768,8.79831C15.9729,8.60609,16.2909,8.60609,16.487099999999998,8.79831L19.0705,11.33026C19.2667,11.52244,19.2667,11.83406,19.0705,12.02623L13.7533,17.2366C11.32572,19.6158,7.30328,19.578,4.85679,17.1807C2.410298,14.7834,2.371331,10.84174,4.79974,8.462530000000001ZM12.3461,6.1325199999999995L10.47246,4.29654L5.51079,9.15889C3.477674,11.15076,3.510214,14.4688,5.56784,16.4847C7.62506,18.500999999999998,11.01117,18.5325,13.0439,16.540599999999998L15.6842,13.9529L14.2908,12.58718L15.0011,11.89161L16.394399999999997,13.2569L18.0056,11.67786L16.1323,9.84188L11.16985,14.7046C10.18764,15.6679,8.540980000000001,15.6494,7.51498,14.7184L7.44107,14.6487C6.4219,13.65,6.37771,11.98096,7.38362,10.994869999999999L10.02485,8.40693L8.624939999999999,7.03516L9.335180000000001,6.33919L10.73512,7.71099L12.3461,6.1325199999999995Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path></g>',1),_j=ta('<path d="M8.134443814697265,7.494615087890625L8.764323814697265,7.494615087890625L8.764323814697265,3.414215087890625L8.310223814697267,3.414215087890625L7.294603814697266,4.005035087890625L7.289713814697266,4.634915087890625L8.134443814697265,4.149892087890625L8.134443814697265,7.494615087890625ZM18.832003814697266,6.933095087890624Q19.004603814697266,6.635245087890625,19.004603814697266,6.2543850878906255Q19.004603814697266,5.884915087890625,18.845103814697264,5.593575087890625Q18.685503814697267,5.3006050878906255,18.399103814697266,5.136225087890625Q18.114303814697266,4.9702050878906245,17.754603814697266,4.9653250878906245L18.820603814697265,3.840647087890625L18.820603814697265,3.414215087890625L16.519203814697264,3.414215087890625L16.519203814697264,3.939931087890625L18.050803814697264,3.939931087890625L16.719403814697266,5.334785087890625L17.074203814697263,5.7205350878906245Q17.254903814697265,5.484525087890625,17.619503814697268,5.484525087890625Q17.980803814697268,5.484525087890625,18.187503814697266,5.689605087890625Q18.394203814697267,5.894685087890625,18.394203814697267,6.2543850878906255Q18.394203814697267,6.604315087890625,18.187503814697266,6.822415087890625Q17.980803814697268,7.0405150878906255,17.640603814697265,7.0405150878906255Q17.334603814697267,7.0405150878906255,17.124703814697266,6.890775087890625Q16.914703814697265,6.739415087890626,16.820303814697265,6.469225087890624L16.354803814697263,6.744295087890626Q16.480103814697266,7.125155087890625,16.821903814697265,7.341625087890625Q17.165403814697264,7.559725087890625,17.640603814697265,7.559725087890625Q18.039403814697266,7.559725087890625,18.348603814697267,7.393705087890625Q18.659503814697267,7.229315087890625,18.832003814697266,6.933095087890624ZM10.000003814697266,10.634915087890626C10.000003814697266,11.024655087890626,9.851363814697265,11.379685087890625,9.607683814697266,11.646395087890625L12.168903814697266,15.171615087890626C12.275403814697265,15.147615087890625,12.386203814697266,15.134915087890626,12.500003814697266,15.134915087890626C12.596503814697266,15.134915087890626,12.690803814697265,15.144015087890624,12.782303814697265,15.161415087890624L16.108803814697268,11.196955087890625C16.038703814697264,11.023375087890624,16.000003814697266,10.833655087890625,16.000003814697266,10.634915087890626C16.000003814697266,9.806495087890625,16.671603814697264,9.134915087890626,17.500003814697266,9.134915087890626C18.328403814697264,9.134915087890626,19.000003814697266,9.806495087890625,19.000003814697266,10.634915087890626C19.000003814697266,11.463345087890625,18.328403814697264,12.134915087890626,17.500003814697266,12.134915087890626C17.239503814697265,12.134915087890626,16.994503814697268,12.068495087890625,16.781003814697264,11.951675087890624L13.654703814697266,15.677415087890624C13.870303814697266,15.937215087890625,14.000003814697266,16.270915087890625,14.000003814697266,16.634915087890626C14.000003814697266,17.463315087890624,13.328403814697266,18.134915087890626,12.500003814697266,18.134915087890626C11.671573814697265,18.134915087890626,11.000003814697266,17.463315087890624,11.000003814697266,16.634915087890626C11.000003814697266,16.284415087890626,11.120193814697265,15.962015087890626,11.321603814697266,15.706715087890625L8.715393814697265,12.119565087890624C8.645053814697267,12.129685087890625,8.573143814697266,12.134915087890626,8.500003814697266,12.134915087890626C8.162103814697264,12.134915087890626,7.8503038146972655,12.023195087890626,7.599523814697266,11.834665087890626L4.505583814697266,15.521915087890624C4.809213814697266,15.796415087890624,5.000003814697266,16.193415087890624,5.000003814697266,16.634915087890626C5.000003814697266,17.463315087890624,4.328433814697266,18.134915087890626,3.5000038146972656,18.134915087890626C2.6715768146972656,18.134915087890626,2.0000038146972656,17.463315087890624,2.0000038146972656,16.634915087890626C2.0000038146972656,15.806515087890626,2.6715768146972656,15.134915087890626,3.5000038146972656,15.134915087890626C3.508253814697266,15.134915087890626,3.5164838146972657,15.135015087890626,3.524703814697266,15.135115087890625L7.033823814697266,10.953115087890625C7.011673814697265,10.850565087890626,7.000003814697266,10.744105087890624,7.000003814697266,10.634915087890626C7.000003814697266,9.806495087890625,7.671573814697266,9.134915087890626,8.500003814697266,9.134915087890626C9.328433814697267,9.134915087890626,10.000003814697266,9.806495087890625,10.000003814697266,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),yj=ta('<path d="M11.57625,6.9981C11.55099,6.999359999999999,11.52557,7,11.5,7C11.34,7,11.18584,6.97495,11.04125,6.9285499999999995L5.55401,16.4327C5.713760000000001,16.5905,5.83826,16.7839,5.91465,17L16.0854,17C16.2187,16.622700000000002,16.4987,16.314700000000002,16.8569,16.1445L11.57625,6.9981ZM12.50759,6.611219999999999C12.81005,6.336790000000001,13,5.94058,13,5.5C13,4.671573,12.32843,4,11.5,4C10.67157,4,10,4.671573,10,5.5C10,5.80059,10.08841,6.08052,10.24066,6.31522L4.64514,16.0069C4.59738,16.002299999999998,4.54896,16,4.5,16C3.671573,16,3,16.671599999999998,3,17.5C3,18.328400000000002,3.671573,19,4.5,19C5.15311,19,5.70873,18.5826,5.91465,18L16.0854,18C16.2913,18.5826,16.846899999999998,19,17.5,19C18.328400000000002,19,19,18.328400000000002,19,17.5C19,16.8365,18.5691,16.2735,17.971899999999998,16.075699999999998L12.50759,6.611219999999999Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),bj=ta('<g transform="scale(0.7857142857)"><path fill="currentColor" stroke="currentColor" stroke-width="1" fill-rule="evenodd" d="M14 6a3 3 0 0 0-3 3v3h8.5a2.5 2.5 0 0 1 2.5 2.5v7a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 6 21.5v-7A2.5 2.5 0 0 1 8.5 12H10V9a4 4 0 0 1 8 0h-1a3 3 0 0 0-3-3zm-1 11a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6-2.5c0-.83.67-1.5 1.5-1.5h11c.83 0 1.5.67 1.5 1.5v7c0 .83-.67 1.5-1.5 1.5h-11A1.5 1.5 0 0 1 7 21.5v-7z"></path></g>'),xj=ta('<path d="M11.66558837890625,19C10.83716137890625,19,10.16558837890625,18.328400000000002,10.16558837890625,17.5C10.16558837890625,16.846899999999998,10.58298437890625,16.2913,11.16557337890625,16.0854L11.16557337890625,11.91464C10.58298437890625,11.70872,10.16558837890625,11.1531,10.16558837890625,10.5C10.16558837890625,9.8469,10.58298437890625,9.29128,11.16557337890625,9.08536L11.16557337890625,4.5C11.16557337890625,4.223857,11.38942837890625,4,11.66556837890625,4C11.94171837890625,4,12.16556837890625,4.223857,12.16556837890625,4.5L12.16556837890625,9.08535C12.74817837890625,9.291260000000001,13.16558837890625,9.846879999999999,13.16558837890625,10.5C13.16558837890625,11.153120000000001,12.74817837890625,11.708739999999999,12.16556837890625,11.91465L12.16556837890625,16.0854C12.74817837890625,16.2913,13.16558837890625,16.846899999999998,13.16558837890625,17.5C13.16558837890625,18.328400000000002,12.49401837890625,19,11.66558837890625,19Z" stroke-opacity="0" stroke="none"></path>'),wj=ta('<path d="M11.165603637695312,6.91465C11.748203637695312,6.70873,12.165603637695312,6.15311,12.165603637695312,5.5C12.165603637695312,4.671573,11.494033637695313,4,10.665603637695312,4C9.837176637695313,4,9.165603637695312,4.671573,9.165603637695312,5.5C9.165603637695312,6.15311,9.583007637695312,6.70873,10.165603637695312,6.91465L10.165603637695312,16.0854C9.583007637695312,16.2913,9.165603637695312,16.846899999999998,9.165603637695312,17.5C9.165603637695312,18.328400000000002,9.837176637695313,19,10.665603637695312,19C11.494033637695313,19,12.165603637695312,18.328400000000002,12.165603637695312,17.5C12.165603637695312,16.846899999999998,11.748203637695312,16.2913,11.165603637695312,16.0854L11.165603637695312,6.91465Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),kj=ta('<path d="M11,12.41465L11,18.5C11,18.7761,11.22386,19,11.5,19C11.77614,19,12,18.7761,12,18.5L12,12.41465C12.5826,12.20873,13,11.65311,13,11C13,10.34689,12.5826,9.79127,12,9.58535L12,3.5C12,3.223857,11.77614,3,11.5,3C11.22386,3,11,3.223857,11,3.5L11,9.58535C10.417404,9.79127,10,10.34689,10,11C10,11.65311,10.417404,12.20873,11,12.41465Z" stroke-opacity="0" stroke="none"></path>'),Sj=ta('<path d="M11,17C5.80945,17,3.667717,12.85,3.113386,11.575C2.9622047,11.2,2.9622047,10.8,3.113386,10.425C3.667717,9.15,5.80945,5,11,5C16.165399999999998,5,18.3323,9.15,18.8866,10.425C19.0378,10.8,19.0378,11.2,18.8866,11.575C18.3323,12.85,16.165399999999998,17,11,17ZM4.04567,10.8C3.995276,10.925,3.995276,11.05,4.04567,11.175C4.52441,12.325,6.43937,16,11,16C15.5606,16,17.4756,12.325,17.9543,11.2C18.0047,11.075,18.0047,10.95,17.9543,10.825C17.4756,9.675,15.5606,6,11,6C6.43937,6,4.52441,9.675,4.04567,10.8ZM11,13.5C9.61417,13.5,8.480319999999999,12.375,8.480319999999999,11C8.480319999999999,9.625,9.61417,8.5,11,8.5C12.38583,8.5,13.5197,9.625,13.5197,11C13.5197,12.375,12.38583,13.5,11,13.5ZM11,9.5C10.1685,9.5,9.48819,10.175,9.48819,11C9.48819,11.825,10.1685,12.5,11,12.5C11.8315,12.5,12.51181,11.825,12.51181,11C12.51181,10.175,11.8315,9.5,11,9.5Z" stroke-opacity="0" fill-opacity="1"></path>'),Cj=ta('<path d="M4.727219638671875,8.007996215820313L9.973849638671876,2.7629472158203123C10.167279638671875,2.5696791158203123,10.480729638671875,2.5696791158203123,10.674169638671875,2.7629472158203123L13.223329638671874,5.311756215820313C13.416929638671874,5.505236215820313,13.416929638671874,5.8189862158203125,13.223329638671874,6.012466215820313L7.977129638671875,11.257906215820313C7.379859638671875,11.855176215820313,7.407609638671875,12.909396215820312,8.033809638671876,13.535596215820313C8.660409638671876,14.162596215820313,9.713849638671874,14.189996215820312,10.311129638671876,13.591896215820313L15.556929638671875,8.346066215820311C15.750429638671875,8.152526215820313,16.064229638671875,8.152526215820313,16.257629638671872,8.346066215820311L18.806529638671876,10.895266215820312C19.000029638671876,11.088746215820313,19.000029638671876,11.402496215820312,18.806529638671876,11.595976215820313L13.560629638671875,16.841796215820313C11.165619638671876,19.237196215820312,7.197149638671875,19.19919621582031,4.783499638671875,16.785496215820313C2.3698426386718747,14.371896215820312,2.331397638671875,10.403416215820313,4.727219638671875,8.007996215820313ZM12.172299638671875,5.662106215820312L10.323809638671875,3.8136162158203124L5.4287196386718755,8.709096215820313C3.422893638671875,10.714536215820312,3.4549956386718748,14.055196215820313,5.484999638671875,16.08479621582031C7.514609638671875,18.114796215820313,10.855289638671875,18.146496215820314,12.860719638671876,16.141096215820312L15.465629638671874,13.535796215820312L14.090929638671875,12.160756215820312L14.791629638671875,11.460436215820312L16.166229638671876,12.834996215820313L17.755829638671877,11.245226215820313L15.907729638671874,9.396736215820312L11.011839638671875,14.292596215820312C10.042809638671875,15.262396215820312,8.418249638671874,15.243796215820312,7.406019638671875,14.306496215820312L7.333099638671875,14.236296215820312C6.327599638671876,13.230796215820313,6.284009638671876,11.550396215820312,7.276419638671875,10.557586215820312L9.882199638671874,7.952026215820313L8.501079638671875,6.570906215820313L9.201789638671876,5.870186215820313L10.582939638671874,7.251336215820312L12.172299638671875,5.662106215820312Z" fill-rule="evenodd" fill-opacity="1" stroke="currentColor" stroke-width="0.5"></path>'),Ij=ta('<g transform="scale(0.7857142857)" fill="currentColor" fill-rule="nonzero" stroke="currentColor" stroke-width="1"><path d="M20.449 8.505l2.103 9.112.974-.225-2.103-9.112zM13.943 14.011l7.631 4.856.537-.844-7.631-4.856zM14.379 11.716l4.812-3.609-.6-.8-4.812 3.609zM10.96 13.828l-4.721 6.744.819.573 4.721-6.744zM6.331 20.67l2.31-13.088-.985-.174-2.31 13.088zM9.041 7.454l1.995 3.492.868-.496-1.995-3.492z"></path><path d="M8.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM12.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM20.5 8c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM23.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g>'),Pj=ta('<path d="m19.45,17.57l-3.78,-9.16a0.92,0.92 0 0 0 -1.71,0l-3.78,9.16a0.92,0.92 0 1 0 1.71,0.71l0.77,-1.86l4.31,0l0.77,1.86a0.92,0.92 0 0 0 0.85,0.57a0.92,0.92 0 0 0 0.85,-1.28l0,0zm-6.03,-3.01l1.39,-3.37l1.39,3.37l-2.79,0zm-2.81,-0.8a0.92,0.92 0 0 0 -0.21,-1.29c-0.01,-0.01 -0.63,-0.47 -1.53,-1.46c1.67,-2.25 2.61,-4.82 2.99,-6.03l1.36,0a0.92,0.92 0 0 0 0,-1.85l-4.87,0l0,-0.84a0.92,0.92 0 0 0 -1.85,0l0,0.84l-4.87,0a0.92,0.92 0 0 0 0,1.85l8.28,0c-0.4,1.13 -1.14,2.92 -2.26,4.55c-1.32,-1.75 -1.81,-2.88 -1.81,-2.89a0.92,0.92 0 0 0 -1.7,0.71c0.02,0.06 0.61,1.44 2.22,3.53c0.04,0.05 0.08,0.1 0.12,0.15c-1.65,1.86 -3.27,3.02 -3.94,3.39a0.92,0.92 0 1 0 0.88,1.62c0.09,-0.05 2.04,-1.13 4.27,-3.59c0.95,1.01 1.6,1.49 1.64,1.52a0.92,0.92 0 0 0 1.29,-0.21l0,0z" id="svg_1"></path>'),Mj=ta('<g id="svg_7"><path d="m10.02,1.07c-4.98,0 -9.28,4.05 -9.02,9.02c0.35,6.79 8.26,2.87 8.97,8.2a0.9,0.9 0 0 0 0.99,0.77a9.02,9.02 0 0 0 -0.94,-18zm1.77,16.4a0.51,0.51 0 0 1 -0.62,-0.35a4.51,4.51 0 0 0 -1.61,-2.3c-1.03,-0.78 -2.27,-1.08 -3.46,-1.38c-2.39,-0.59 -3.55,-0.99 -3.67,-3.43c-0.1,-1.87 0.58,-3.67 1.93,-5.08a7.84,7.84 0 0 1 5.66,-2.43a7.59,7.59 0 0 1 1.77,14.97z" id="svg_1"></path><path d="m13.04,14.42m-1.38,0a1.38,1.38 0 1 0 2.77,0a1.38,1.38 0 1 0 -2.77,0z" id="svg_2"></path><path d="m15.28,9.07m-1.13,0a1.13,1.13 0 1 0 2.26,0a1.13,1.13 0 1 0 -2.26,0z" id="svg_3"></path><path d="m14.23,6.93a1.13,1.13 0 1 0 -1.58,-0.19a1.13,1.13 0 0 0 1.58,0.19z" id="svg_4"></path><path d="m10.29,4.73m-0.97,0.58a1.13,1.13 0 1 0 1.93,-1.16a1.13,1.13 0 1 0 -1.93,1.16z" id="svg_5"></path><path d="m6.47,4.66a1.13,1.13 0 1 0 1.49,0.58a1.13,1.13 0 0 0 -1.49,-0.58z" id="svg_6"></path></g>'),Nj=ta('<path d="m15.1,6.75c0,-2.31 -1.89,-4.18 -4.21,-4.18c-2.33,0 -4.21,1.87 -4.21,4.18c0,2.31 1.89,4.18 4.21,4.18c2.33,0 4.21,-1.87 4.21,-4.18m5.9,13.26c0.03,0.09 0.05,0.18 0.05,0.28c0,0.54 -0.44,0.98 -0.99,0.98a0.99,0.99 0 0 1 -0.99,-0.98l0,0l-0.03,0c-0.26,-4.12 -3.69,-7.39 -7.9,-7.39c-4.21,0 -7.65,3.27 -7.91,7.39l-0.02,0l0,0c0,0.54 -0.44,0.98 -0.99,0.98a0.99,0.99 0 0 1 -0.99,-0.98c0,-0.09 0.02,-0.18 0.04,-0.27c0.29,-3.74 2.66,-6.9 5.98,-8.3c-1.54,-1.12 -2.55,-2.92 -2.55,-4.97c0,-3.4 2.77,-6.15 6.19,-6.15c3.42,0 6.19,2.75 6.19,6.15a6.12,6.12 0 0 1 -2.39,4.85c3.48,1.33 6,4.56 6.31,8.41" fill="#515151" id="svg_1"></path>'),Aj=ta('<g transform="scale(0.047 0.047)"><path d="M387.6 2.6C385.5 4.7 385 6.2 385 10C385 13.8 385.5 15.3 387.6 17.4L390.3 20H410.9H431.5L382.5 69L333.5 118L314.5 99C304.1 88.6 294.2 79.6 292.6 79C291 78.4 288.3 78.2 286.6 78.6C284.2 79 263.1 99.5 192.7 169.8C142.7 219.7 101.2 261.7 100.4 263.2C98.1 267.5 98.7 271.6 101.9 275.2C104.4 278 105.5 278.5 109.4 278.5H114L201.5 191L289 103.5L308.8 123.3L328.6 143H333.5H338.5L392.2 89.3L446 35.5V52.8C446 71.1 446.7 74.7 450.9 77C453.9 78.6 460.3 78.2 462.6 76.2C466.8 72.8 467 71.3 467 39C467 6.7 466.8 5.2 462.6 1.8C460.7 0.199996 457.1 -4.14997e-06 425.4 -4.14997e-06H390.3L387.6 2.6Z" fill="currentColor"></path><path d="M382.8 147.4C373.9 149.8 366 158.1 364.1 167.1C363.3 170.5 363 222 363 332V492H335.5H308L307.8 400.1L307.5 308.2L303.8 302.9C295.9 291.6 290.4 290.1 256.9 290C244 290 230.7 290.5 227.5 291.1C218.2 292.8 211 298.4 207.1 307C205.1 311.4 205 313.1 205 401.7V492H177.5H150V444.7C150 391.6 150 391.7 143 383.7C140.7 381.2 136.8 378.3 133.8 376.9C128.6 374.5 128 374.5 98 374.5H67.5L61.8 377.3C55.4 380.4 51.7 384.3 48.6 391C46.6 395.3 46.5 397.2 46.2 443.8L45.9 492H32.9C18.2 492 15.9 492.8 14 498.6C12.5 502.9 14.1 508.2 17.5 510.4C19.7 511.8 42.4 512 256 512C469.6 512 492.3 511.8 494.5 510.4C497.9 508.2 499.5 502.9 498 498.6C496.1 492.9 493.7 492 479.5 492H467V331.2C467 150.8 467.5 163.8 459.7 155.3C451.9 146.8 450.7 146.5 417 146.3C395.4 146.1 386.3 146.4 382.8 147.4ZM443.4 169.1L446 171.1V331.6V492H415H384V332V171.9L386.5 169.5L388.9 167H414.8C439.5 167 440.9 167.1 443.4 169.1ZM282.8 312.1C284.8 312.8 286.2 314.2 286.9 316.2C287.7 318.3 288 346.8 288 405.6V492H257H226V403.7C226 320.8 226.1 315.2 227.8 313.8C228.7 312.9 230.2 312 231 311.7C233.9 310.7 279.6 311 282.8 312.1ZM127.1 397.9C128.9 400.1 129 402.4 129 446.1V492H98H67L67.1 446.7C67.1 421.9 67.5 400.7 67.9 399.6C69.6 395.4 72.1 395 99.3 395.3C125.2 395.5 125.2 395.5 127.1 397.9Z" fill="currentColor"></path><path d="M69.2 295.5C65.3 298.7 64.4 302.7 66.4 307.4C69.3 314.4 78.6 315.6 83.5 309.8C91.5 300.3 78.6 287.5 69.2 295.5Z" fill="currentColor"></path><circle cx="2" cy="18" r="1" fill="currentColor"></circle></g>'),Tj=ta('<g id="svg_4" transform="translate(-0.1 -0.1) scale(1.00914 1.00914) translate(0.1 0.1) scale(1.09 1.09) matrix(0.995 0 0 0.995 0 0)"><path d="m18.54,9.09c-0.21,-2.47 -1.25,-4.77 -2.96,-6.45c-1.73,-1.69 -3.96,-2.64 -6.3,-2.64c-1.25,0 -2.46,0.27 -3.61,0.78c-0.01,0 -0.01,0.02 -0.02,0.02c-0.02,0 -0.02,0.01 -0.03,0.01c-1.09,0.5 -2.06,1.21 -2.91,2.12c-0.86,0.92 -1.52,1.98 -1.99,3.18c-0.47,1.23 -0.72,2.54 -0.72,3.89c0,0.87 0.11,1.72 0.31,2.54c0,0.02 0.01,0.05 0.02,0.07c0.41,1.62 1.18,3.11 2.3,4.35c1.44,1.59 3.3,2.6 5.3,2.91c0.03,0 0.04,0.02 0.06,0.02c0.33,0.05 0.67,0.08 1.01,0.08l0.21,0c0.4,0 1.17,-0.03 1.8,-0.27c0.16,-0.07 0.29,-0.19 0.36,-0.36c0.07,-0.16 0.09,-0.35 0.03,-0.53c-0.1,-0.27 -0.34,-0.46 -0.61,-0.46c-0.07,0 -0.16,0.01 -0.23,0.03c-0.47,0.18 -1.1,0.21 -1.36,0.21l-0.1,0c0.1,-0.32 0.14,-0.67 0.05,-1.04c-0.15,-0.66 -0.64,-1.21 -1.57,-1.75l-0.39,-0.23c-0.62,-0.36 -0.96,-0.54 -1.16,-0.84c-0.2,-0.29 -0.34,-0.74 -0.51,-1.75c-0.13,-0.68 -0.47,-1.21 -1.01,-1.52c-0.37,-0.2 -0.8,-0.31 -1.32,-0.31c-0.36,0 -0.76,0.05 -1.18,0.15c-0.21,0.05 -0.41,0.11 -0.59,0.16c-0.08,-0.48 -0.12,-0.98 -0.12,-1.49c0,-3.04 1.47,-5.7 3.69,-7.24c0.01,0.28 0.07,0.57 0.19,0.84c0.3,0.7 0.92,1.14 1.84,1.33c0.05,0.01 0.08,0.01 0.12,0.01l0.04,0c0.09,0 0.39,0.01 0.71,0.14c0.43,0.19 0.68,0.51 0.76,1c0.2,1.56 0.42,4.38 0.14,5.29c-0.02,0.07 -0.03,0.15 -0.03,0.23c0,0.37 0.29,0.69 0.64,0.69c0.18,0 0.34,-0.08 0.46,-0.2c0.12,-0.13 2.76,-3.01 3.46,-3.97c0.08,-0.11 0.17,-0.21 0.26,-0.32c0.34,-0.43 0.69,-0.86 0.82,-1.51c0.15,-0.69 0,-1.46 -0.46,-2.41c-0.32,-0.68 -0.38,-0.98 -0.4,-1.1c0.02,-0.01 0.04,-0.02 0.06,-0.04c2.02,1.39 3.42,3.73 3.65,6.48c0.04,0.37 0.31,0.63 0.65,0.63l0.06,0c0.35,-0.01 0.61,-0.34 0.58,-0.73zm-15.35,3.47c0.3,0 0.53,0.05 0.71,0.15c0.18,0.12 0.29,0.28 0.34,0.56c0.2,1.07 0.37,1.79 0.76,2.34c0.38,0.53 0.86,0.79 1.58,1.21l0.03,0.01c0.1,0.06 0.23,0.13 0.35,0.2c0.74,0.43 0.9,0.72 0.94,0.86c0.03,0.14 -0.05,0.34 -0.15,0.54c-2.83,-0.58 -5.1,-2.74 -6.01,-5.6c0.42,-0.13 0.97,-0.27 1.45,-0.27zm9.6,-8.04c0.64,1.31 0.36,1.67 -0.21,2.37c-0.09,0.12 -0.19,0.23 -0.28,0.36c-0.35,0.48 -1.28,1.53 -2.09,2.43c0,-0.44 -0.02,-0.94 -0.06,-1.49c-0.08,-1.23 -0.22,-2.28 -0.22,-2.32l0,-0.04c-0.18,-0.99 -0.73,-1.71 -1.61,-2.07c-0.49,-0.2 -0.95,-0.22 -1.13,-0.22c-0.45,-0.11 -0.73,-0.3 -0.85,-0.55c-0.14,-0.3 -0.05,-0.74 0.04,-1.02c0.91,-0.38 1.88,-0.59 2.9,-0.59c1.11,0 2.16,0.24 3.13,0.67c-0.07,0.13 -0.13,0.3 -0.16,0.5c-0.04,0.49 0.12,1.1 0.54,1.97z" id="svg_1"></path><path d="m15.22,9.72c-2.63,0 -4.77,2.3 -4.77,5.14c0,2.84 2.13,5.14 4.77,5.14c2.64,0 4.78,-2.3 4.78,-5.14c0,-2.84 -2.15,-5.14 -4.78,-5.14zm0,8.88c-1.91,0 -3.48,-1.68 -3.48,-3.75c0,-2.07 1.56,-3.75 3.48,-3.75c1.93,0 3.49,1.68 3.49,3.75c0,2.07 -1.57,3.75 -3.49,3.75z" id="svg_2"></path><path d="m15.69,15.05l0,-2.37c0,-0.38 -0.29,-0.7 -0.64,-0.7c-0.36,0 -0.65,0.32 -0.65,0.7l0,2.66c0,0.19 0.07,0.35 0.19,0.49l1.16,1.27c0.12,0.12 0.28,0.2 0.46,0.2c0.17,0 0.33,-0.08 0.46,-0.2c0.11,-0.13 0.18,-0.31 0.18,-0.5c0,-0.19 -0.07,-0.36 -0.18,-0.49l-0.98,-1.06z" id="svg_3"></path></g>'),Fj=ta('<path d="M8 5v14l11-7z" fill="currentColor"></path>'),Lj=ta('<rect x="6" y="6" width="10" height="10" fill="currentColor"></rect>'),Ej=ta('<path d="m21.62,13.73l-1.7,-1.37c0.08,-0.46 0.12,-0.94 0.12,-1.41c0,-0.47 -0.04,-0.94 -0.12,-1.41l1.7,-1.37c0.25,-0.21 0.35,-0.55 0.24,-0.85l-0.03,-0.07c-0.46,-1.24 -1.15,-2.38 -2.06,-3.37l-0.04,-0.05c-0.22,-0.24 -0.58,-0.34 -0.91,-0.23l-2.09,0.71c-0.78,-0.6 -1.64,-1.08 -2.57,-1.41l-0.41,-2.08c-0.07,-0.32 -0.33,-0.57 -0.67,-0.62l-0.08,-0.01c-1.34,-0.23 -2.76,-0.23 -4.1,0l-0.08,0.01c-0.34,0.05 -0.6,0.31 -0.67,0.62l-0.41,2.09c-0.93,0.33 -1.78,0.8 -2.55,1.4l-2.11,-0.71c-0.33,-0.11 -0.69,-0.02 -0.91,0.23l-0.04,0.05c-0.91,1.01 -1.6,2.14 -2.06,3.37l-0.03,0.07c-0.11,0.3 -0.01,0.65 0.24,0.85l1.72,1.38c-0.09,0.46 -0.12,0.93 -0.12,1.4c0,0.47 0.03,0.94 0.12,1.39l-1.72,1.39c-0.25,0.21 -0.35,0.55 -0.24,0.85l0.03,0.07c0.46,1.24 1.15,2.37 2.06,3.37l0.04,0.05c0.22,0.24 0.58,0.34 0.91,0.23l2.11,-0.71c0.77,0.6 1.62,1.07 2.55,1.4l0.41,2.09c0.07,0.32 0.33,0.57 0.67,0.62l0.08,0.01c0.67,0.12 1.36,0.18 2.05,0.18c0.69,0 1.38,-0.05 2.05,-0.18l0.08,-0.01c0.34,-0.05 0.6,-0.31 0.67,-0.62l0.41,-2.08c0.93,-0.33 1.8,-0.81 2.57,-1.41l2.09,0.71c0.33,0.11 0.69,0.01 0.91,-0.23l0.04,-0.05c0.91,-1.01 1.6,-2.14 2.06,-3.37l0.03,-0.07c0.11,-0.3 0.01,-0.64 -0.24,-0.85zm-3.53,-3.91c0.07,0.37 0.1,0.76 0.1,1.13c0,0.38 -0.03,0.77 -0.1,1.13l-0.18,0.99l1.93,1.55c-0.28,0.65 -0.66,1.25 -1.09,1.81l-2.4,-0.81l-0.81,0.64c-0.61,0.48 -1.3,0.85 -2.05,1.12l-0.99,0.35l-0.46,2.38c-0.72,0.08 -1.47,0.08 -2.19,0l-0.47,-2.38l-0.97,-0.36c-0.73,-0.26 -1.41,-0.64 -2.03,-1.12l-0.81,-0.64l-2.42,0.82c-0.44,-0.57 -0.8,-1.17 -1.09,-1.81l1.95,-1.58l-0.16,-0.97c-0.07,-0.36 -0.1,-0.74 -0.1,-1.12c0,-0.37 0.03,-0.74 0.1,-1.11l0.16,-0.97l-1.95,-1.58c0.3,-0.65 0.66,-1.25 1.09,-1.81l2.42,0.81l0.81,-0.62c0.61,-0.48 1.29,-0.85 2.03,-1.12l0.99,-0.35l0.46,-2.38c0.72,-0.09 1.47,-0.09 2.19,0l0.46,2.37l0.99,0.35c0.74,0.26 1.43,0.65 2.05,1.12l0.81,0.64l2.4,-0.81c0.44,0.57 0.81,1.17 1.11,1.81l-1.94,1.55l0.18,0.97zm-7.14,-3.42c-2.51,0 -4.54,1.93 -4.54,4.3c0,2.38 2.04,4.3 4.54,4.3c2.51,0 4.54,-1.93 4.54,-4.3c0,-2.38 -2.04,-4.3 -4.54,-4.3zm2.05,6.24c-0.55,0.51 -1.27,0.8 -2.05,0.8c-0.77,0 -1.5,-0.28 -2.05,-0.8c-0.54,-0.51 -0.84,-1.2 -0.84,-1.94c0,-0.73 0.31,-1.41 0.84,-1.94c0.55,-0.51 1.28,-0.8 2.05,-0.8c0.78,0 1.5,0.28 2.05,0.8c0.55,0.53 0.84,1.2 0.84,1.94c0,0.73 -0.3,1.42 -0.84,1.94z" id="svg_1"></path>'),$j=ta('<path d="m7.13,1l7.64,0c0.16,0 0.31,0.12 0.34,0.28l0.25,1.38c0.12,0.67 0.68,1.15 1.35,1.15l2.45,0c1.51,0 2.74,1.26 2.74,2.81l0,11.27c0,1.55 -1.23,2.81 -2.74,2.81l-16.43,0c-1.51,0 -2.74,-1.26 -2.74,-2.81l0,-11.27c0,-1.55 1.23,-2.81 2.74,-2.81l2.45,0c0.67,0 1.23,-0.48 1.35,-1.15l0.25,-1.38c0.03,-0.16 0.18,-0.28 0.34,-0.28zm9.58,4.23c-1.32,0 -2.45,-0.96 -2.69,-2.3l-0.1,-0.51l-5.93,0l-0.1,0.51c-0.24,1.34 -1.37,2.3 -2.69,2.3l-2.45,0c-0.76,0 -1.37,0.62 -1.37,1.4l0,11.27c0,0.78 0.61,1.4 1.37,1.4l16.43,0c0.76,0 1.37,-0.62 1.37,-1.4l0,-11.27c0,-0.78 -0.61,-1.4 -1.37,-1.4l-2.45,0zm-11.91,2.11l-1.37,0c-0.38,0 -0.69,-0.32 -0.69,-0.71c0,-0.38 0.31,-0.7 0.69,-0.7l1.37,0c0.37,0 0.68,0.32 0.68,0.7c0,0.39 -0.31,0.71 -0.68,0.71zm6.15,-0.71c-3.21,0 -5.81,2.68 -5.81,5.99c0,3.3 2.61,5.98 5.81,5.98c3.21,0 5.81,-2.68 5.81,-5.98c0,-3.31 -2.61,-5.99 -5.81,-5.99zm0,1.41c1.19,0 2.31,0.47 3.14,1.34c0.84,0.87 1.3,2.01 1.3,3.24c0,1.22 -0.46,2.37 -1.3,3.23c-0.83,0.87 -1.95,1.35 -3.14,1.35c-1.19,0 -2.31,-0.48 -3.14,-1.35c-0.84,-0.87 -1.3,-2.01 -1.3,-3.23c0,-1.23 0.46,-2.38 1.3,-3.24c0.83,-0.87 1.95,-1.34 3.14,-1.34zm0,2.46c-1.14,0 -2.05,0.94 -2.05,2.11c0,1.16 0.91,2.11 2.05,2.11c1.14,0 2.06,-0.95 2.06,-2.11c0,-1.17 -0.92,-2.11 -2.06,-2.11zm0,1.4c0.37,0 0.69,0.32 0.69,0.71c0,0.38 -0.32,0.7 -0.69,0.7c-0.37,0 -0.68,-0.32 -0.68,-0.7c0,-0.39 0.31,-0.71 0.68,-0.71z" id="svg_1"></path>'),Dj=ta('<path d="m1.08,0l-1.08,1.08l4.19,4.2l-1.64,1.64l4.36,0l0,-4.36l-1.62,1.62l-4.21,-4.18zm14.73,5.28l4.19,-4.2l-1.08,-1.08l-4.21,4.18l-1.62,-1.62l0,4.36l4.36,0l-1.64,-1.64zm-11.64,9.42l-4.09,4.11l1.08,1.19l4.11,-4.2l1.64,1.64l0,-4.36l-4.36,0l1.62,1.62zm13.28,-1.62l-4.36,0l0,4.36l1.64,-1.64l4.11,4.2l1.08,-1.19l-4.09,-4.11l1.62,-1.62z" id="svg_1" transform="scale(1.09 1.09)"></path>'),Rj=ta('<path d="m2.93,1.77l4.65,4.64l-1.19,1.19l-4.62,-4.67l-1.77,1.77l0,-4.7l4.7,0l-1.77,1.77zm3.48,10.63l-4.64,4.64l-1.77,-1.76l0,4.7l4.7,0l-1.77,-1.77l4.65,-4.64l-1.17,-1.17zm8.87,-12.4l1.76,1.77l-4.64,4.64l1.19,1.19l4.64,-4.64l1.77,1.76l0,-4.72l-4.72,0zm-1.71,12.4l-1.19,1.19l4.64,4.64l-1.77,1.77l4.73,0l0,-4.72l-1.77,1.76l-4.64,-4.64z" id="svg_1" transform="scale(1.095 1.095)"></path>'),jj=ta('<path d="m12.24,4.81c2.72,0 4.93,2.2 4.93,4.92c0,0.01 0,0.03 0,0.05c-0.01,0.03 -0.01,0.07 -0.01,0.11l-0.02,0.75l0.75,0c1.81,0.01 3.27,1.48 3.27,3.28c0,1.8 -1.46,3.27 -3.26,3.28l-0.16,0l-13.36,0c-2.01,0 -3.65,-1.64 -3.65,-3.64c0,-1.56 0.99,-2.94 2.47,-3.45l0.41,-0.14l0.07,-0.42c0.18,-1.06 1.09,-1.83 2.16,-1.83c0.34,0 0.67,0.08 0.98,0.24l0.67,0.34l0.31,-0.68c0.82,-1.7 2.56,-2.81 4.44,-2.81l0,0.01zm0,-0.73c-2.24,0 -4.19,1.31 -5.1,3.22c-0.39,-0.2 -0.83,-0.31 -1.31,-0.31c-1.44,0 -2.64,1.05 -2.87,2.43c-1.72,0.59 -2.96,2.22 -2.96,4.14c0,2.42 1.96,4.37 4.37,4.37l13.52,0c2.2,-0.01 3.99,-1.8 3.99,-4.01c0,-2.21 -1.79,-4.01 -4,-4.01c0.01,-0.06 0.01,-0.12 0.01,-0.18c0,-3.12 -2.53,-5.65 -5.66,-5.65l0,0z" fill="#000000" id="svg_1"></path>'),Bj=ta('<path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" fill="currentColor"></path>'),Oj=ta('<g transform="scale(-1,1) translate(-24,0)"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" fill="currentColor"></path></g>'),zj=ta('<g transform="scale(0.9166666667)"><path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M20 13H15.874C15.5122 14.4056 14.4056 15.5122 13 15.874V20C13 20.2652 12.8946 20.5196 12.7071 20.7071C12.5196 20.8946 12.2652 21 12 21C11.7348 21 11.4804 20.8946 11.2929 20.7071C11.1054 20.5196 11 20.2652 11 20V15.874C9.59439 15.5122 8.4878 14.4056 8.12602 13H4C3.73478 13 3.48043 12.8946 3.29289 12.7071C3.10536 12.5196 3 12.2652 3 12C3 11.7348 3.10536 11.4804 3.29289 11.2929C3.48043 11.1054 3.73478 11 4 11H8.12602C8.4878 9.59439 9.59439 8.4878 11 8.12602V4C11 3.73478 11.1054 3.48043 11.2929 3.29289C11.4804 3.10536 11.7348 3 12 3C12.2652 3 12.5196 3.10536 12.7071 3.29289C12.8946 3.48043 13 3.73478 13 4V8.12602C14.4056 8.4878 15.5122 9.59439 15.874 11H20C20.2652 11 20.5196 11.1054 20.7071 11.2929C20.8946 11.4804 21 11.7348 21 12C21 12.2652 20.8946 12.5196 20.7071 12.7071C20.5196 12.8946 20.2652 13 20 13ZM12 10C10.8954 10 10 10.8954 10 12C10 13.1046 10.8954 14 12 14C13.1046 14 14 13.1046 14 12C14 10.8954 13.1046 10 12 10Z"></path></g>'),Vj=ta('<rect x="3" y="4" width="16" height="14" rx="1" fill="none" stroke="currentColor" stroke-width="0.5"></rect><rect x="13" y="4" width="6" height="14" rx="1" fill="currentColor" fill-opacity="0.3"></rect><line x1="13" y1="4" x2="13" y2="18" stroke="currentColor" stroke-width="0.5"></line>',1),Wj=ta('<div class="icon-fallback"> </div>'),Hj=ta('<svg class="icon-overlay fill-current svelte-19kzeyz" viewBox="0 0 22 22"><!></svg>');function Gv(n,e){let t=hi(e,"name",3,"none"),s=hi(e,"active",3,!1),o=hi(e,"size",3,32);var r=Hj(),a=y(r);Ue(a,()=>t()=="horizontalStraightLine",l=>{var c=TR();q(l,c)},l=>{var c=Qn(),f=fn(c);Ue(f,()=>t()=="ruler",u=>{var d=FR();q(u,d)},u=>{var d=Qn(),h=fn(d);Ue(h,()=>t()=="abcd",m=>{var g=LR();q(m,g)},m=>{var g=Qn(),w=fn(g);Ue(w,()=>t()=="anyWaves",C=>{var P=ER();q(C,P)},C=>{var P=Qn(),I=fn(P);Ue(I,()=>t()=="arrow",A=>{var M=$R();q(A,M)},A=>{var M=Qn(),F=fn(M);Ue(F,()=>t()=="circle",B=>{var $=DR();q(B,$)},B=>{var $=Qn(),L=fn($);Ue(L,()=>t()=="eightWaves",O=>{var Y=RR();q(O,Y)},O=>{var Y=Qn(),ce=fn(Y);Ue(ce,()=>t()=="fibonacciCircle",Q=>{var le=jR();Zi(4),q(Q,le)},Q=>{var le=Qn(),ue=fn(le);Ue(ue,()=>t()=="fibonacciExtension",fe=>{var pe=BR();q(fe,pe)},fe=>{var pe=Qn(),Z=fn(pe);Ue(Z,()=>t()=="fibonacciSegment",xe=>{var oe=OR();q(xe,oe)},xe=>{var oe=Qn(),Pe=fn(oe);Ue(Pe,()=>t()=="fibonacciSpeedResistanceFan",$e=>{var ze=zR();q($e,ze)},$e=>{var ze=Qn(),Ke=fn(ze);Ue(Ke,()=>t()=="fibonacciSpiral",qe=>{var nt=VR();q(qe,nt)},qe=>{var nt=Qn(),ft=fn(nt);Ue(ft,()=>t()=="fiveWaves",ut=>{var bt=WR();q(ut,bt)},ut=>{var bt=Qn(),Pt=fn(bt);Ue(Pt,()=>t()=="gannBox",Et=>{var Mt=HR();q(Et,Mt)},Et=>{var Mt=Qn(),Je=fn(Mt);Ue(Je,()=>t()=="horizontalRayLine",Ct=>{var Ze=qR();q(Ct,Ze)},Ct=>{var Ze=Qn(),Xe=fn(Ze);Ue(Xe,()=>t()=="horizontalSegment",Ae=>{var Qe=UR();q(Ae,Qe)},Ae=>{var Qe=Qn(),gt=fn(Qe);Ue(gt,()=>t()=="invisible",Ft=>{var ot=GR();q(Ft,ot)},Ft=>{var ot=Qn(),ve=fn(ot);Ue(ve,()=>t()=="visible",Ie=>{var It=YR();q(Ie,It)},Ie=>{var It=Qn(),Dt=fn(It);Ue(Dt,()=>t()=="lock",Zt=>{var gn=KR();Zi(),q(Zt,gn)},Zt=>{var gn=Qn(),hn=fn(gn);Ue(hn,()=>t()=="parallelogram",qn=>{var On=XR();q(qn,On)},qn=>{var On=Qn(),bn=fn(On);Ue(bn,()=>t()=="parallelStraightLine",Fn=>{var Xs=ZR();q(Fn,Xs)},Fn=>{var Xs=Qn(),oo=fn(Xs);Ue(oo,()=>t()=="priceChannelLine",Yn=>{var _o=JR();q(Yn,_o)},Yn=>{var _o=Qn(),xs=fn(_o);Ue(xs,()=>t()=="priceChannelLineNew",Rt=>{var un=QR();q(Rt,un)},Rt=>{var un=Qn(),qs=fn(un);Ue(qs,()=>t()=="priceLine",ri=>{var Eo=ej();q(ri,Eo)},ri=>{var Eo=Qn(),Ia=fn(Eo);Ue(Ia,()=>t()=="rayLine",Lr=>{var Qa=tj();q(Lr,Qa)},Lr=>{var Qa=Qn(),yr=fn(Qa);Ue(yr,()=>t()=="rect",Fi=>{var Rc=nj();q(Fi,Rc)},Fi=>{var Rc=Qn(),Cu=fn(Rc);Ue(Cu,()=>t()=="remove",uc=>{var Fl=sj();q(uc,Fl)},uc=>{var Fl=Qn(),jc=fn(Fl);Ue(jc,()=>t()=="emoji",nd=>{var Fa=oj();Zi(3),q(nd,Fa)},nd=>{var Fa=Qn(),dc=fn(Fa);Ue(dc,()=>t()=="text",Bc=>{var rd=ij();q(Bc,rd)},Bc=>{var rd=Qn(),uf=fn(rd);Ue(uf,()=>t()=="segment",So=>{var Ll=rj();q(So,Ll)},So=>{var Ll=Qn(),ya=fn(Ll);Ue(ya,()=>t()=="candle",hc=>{var Pa=aj();q(hc,Pa)},hc=>{var Pa=Qn(),Yr=fn(Pa);Ue(Yr,()=>t()=="line",el=>{var Yl=lj();q(el,Yl)},el=>{var Yl=Qn(),Vu=fn(Yl);Ue(Vu,()=>t()=="area",Iu=>{var Ro=cj();q(Iu,Ro)},Iu=>{var Ro=Qn(),zr=fn(Ro);Ue(zr,()=>t()=="candle_solid",kl=>{var Md=uj();q(kl,Md)},kl=>{var Md=Qn(),nf=fn(Md);Ue(nf,()=>t()=="candle_stroke",zf=>{var df=dj();Zi(2),q(zf,df)},zf=>{var df=Qn(),Pu=fn(df);Ue(Pu,()=>t()=="candle_up_stroke",Dd=>{var yf=fj();Zi(2),q(Dd,yf)},Dd=>{var yf=Qn(),$n=fn(yf);Ue($n,()=>t()=="candle_down_stroke",ws=>{var Us=pj();Zi(2),q(ws,Us)},ws=>{var Us=Qn(),Dn=fn(Us);Ue(Dn,()=>t()=="ohlc",ni=>{var mo=mj();Zi(),q(ni,mo)},ni=>{var mo=Qn(),sr=fn(mo);Ue(sr,()=>t()=="point_and_figure",or=>{var hl=hj();q(or,hl)},or=>{var hl=Qn(),Oi=fn(hl);Ue(Oi,()=>t()=="straightLine",si=>{var Wo=vj();q(si,Wo)},si=>{var Wo=Qn(),Ua=fn(Wo);Ue(Ua,()=>t()=="strongMagnet",Hi=>{var to=gj();Zi(),q(Hi,to)},Hi=>{var to=Qn(),Li=fn(to);Ue(Li,()=>t()=="threeWaves",Vr=>{var ba=_j();q(Vr,ba)},Vr=>{var ba=Qn(),qi=fn(ba);Ue(qi,()=>t()=="triangle",Wr=>{var Kl=yj();q(Wr,Kl)},Wr=>{var Kl=Qn(),Wl=fn(Kl);Ue(Wl,()=>t()=="unlock",Ic=>{var Pc=bj();q(Ic,Pc)},Ic=>{var Pc=Qn(),cl=fn(Pc);Ue(cl,()=>t()=="verticalRayLine",mr=>{var La=xj();q(mr,La)},mr=>{var La=Qn(),Sl=fn(La);Ue(Sl,()=>t()=="verticalSegment",Ba=>{var vi=wj();q(Ba,vi)},Ba=>{var vi=Qn(),vc=fn(vi);Ue(vc,()=>t()=="verticalStraightLine",ul=>{var Ga=kj();q(ul,Ga)},ul=>{var Ga=Qn(),vl=fn(Ga);Ue(vl,()=>t()=="visiable",pu=>{var tl=Sj();q(pu,tl)},pu=>{var tl=Qn(),Oa=fn(tl);Ue(Oa,()=>t()=="weakMagnet",Oc=>{var Gu=Cj();q(Oc,Gu)},Oc=>{var Gu=Qn(),El=fn(Gu);Ue(El,()=>t()=="xabcd",mu=>{var bc=Ij();q(mu,bc)},mu=>{var bc=Qn(),nl=fn(bc);Ue(nl,()=>t()=="lang",la=>{var Mu=Pj();q(la,Mu)},la=>{var Mu=Qn(),Yu=fn(Mu);Ue(Yu,()=>t()=="theme",zc=>{var Zd=Mj();q(zc,Zd)},zc=>{var Zd=Qn(),Yf=fn(Zd);Ue(Yf,()=>t()=="user",Kf=>{var _d=Nj();q(Kf,_d)},Kf=>{var _d=Qn(),Rd=fn(_d);Ue(Rd,()=>t()=="indicator",fc=>{var pp=Aj();q(fc,pp)},fc=>{var pp=Qn(),kd=fn(pp);Ue(kd,()=>t()=="timezone",Wd=>{var $l=Tj();q(Wd,$l)},Wd=>{var $l=Qn(),Nu=fn($l);Ue(Nu,()=>t()=="play",Ku=>{var bf=Fj();q(Ku,bf)},Ku=>{var bf=Qn(),Xu=fn(bf);Ue(Xu,()=>t()=="stop",Ql=>{var Hd=Lj();q(Ql,Hd)},Ql=>{var Hd=Qn(),hu=fn(Hd);Ue(hu,()=>t()=="setting",Jc=>{var Au=Ej();q(Jc,Au)},Jc=>{var Au=Qn(),jd=fn(Au);Ue(jd,()=>t()=="screenShot",Wu=>{var sf=$j();q(Wu,sf)},Wu=>{var sf=Qn(),ad=fn(sf);Ue(ad,()=>t()=="exitFullScreen",yd=>{var Bd=Dj();q(yd,Bd)},yd=>{var Bd=Qn(),Mc=fn(Bd);Ue(Mc,()=>t()=="fullScreen",Tu=>{var qd=Rj();q(Tu,qd)},Tu=>{var qd=Qn(),Xf=fn(qd);Ue(Xf,()=>t()=="cloud",Vf=>{var se=jj();q(Vf,se)},Vf=>{var se=Qn(),be=fn(se);Ue(be,()=>t()=="undo",G=>{var re=Bj();q(G,re)},G=>{var re=Qn(),we=fn(re);Ue(we,()=>t()=="redo",J=>{var Fe=Oj();q(J,Fe)},J=>{var Fe=Qn(),yt=fn(Fe);Ue(yt,()=>t()=="crosshair",vt=>{var jt=zj();q(vt,jt)},vt=>{var jt=Qn(),ye=fn(jt);Ue(ye,()=>t()=="sidebar",E=>{var me=Vj();Zi(2),q(E,me)},E=>{var me=Wj(),Se=y(me,!0);_(me),Ce(()=>tt(Se,t())),q(E,me)},!0),q(vt,jt)},!0),q(J,Fe)},!0),q(G,re)},!0),q(Vf,se)},!0),q(Tu,qd)},!0),q(yd,Bd)},!0),q(Wu,sf)},!0),q(Jc,Au)},!0),q(Ql,Hd)},!0),q(Ku,bf)},!0),q(Wd,$l)},!0),q(fc,pp)},!0),q(Kf,_d)},!0),q(zc,Zd)},!0),q(la,Mu)},!0),q(mu,bc)},!0),q(Oc,Gu)},!0),q(pu,tl)},!0),q(ul,Ga)},!0),q(Ba,vi)},!0),q(mr,La)},!0),q(Ic,Pc)},!0),q(Wr,Kl)},!0),q(Vr,ba)},!0),q(Hi,to)},!0),q(si,Wo)},!0),q(or,hl)},!0),q(ni,mo)},!0),q(ws,Us)},!0),q(Dd,yf)},!0),q(zf,df)},!0),q(kl,Md)},!0),q(Iu,Ro)},!0),q(el,Yl)},!0),q(hc,Pa)},!0),q(So,Ll)},!0),q(Bc,rd)},!0),q(nd,Fa)},!0),q(uc,Fl)},!0),q(Fi,Rc)},!0),q(Lr,Qa)},!0),q(ri,Eo)},!0),q(Rt,un)},!0),q(Yn,_o)},!0),q(Fn,Xs)},!0),q(qn,On)},!0),q(Zt,gn)},!0),q(Ie,It)},!0),q(Ft,ot)},!0),q(Ae,Qe)},!0),q(Ct,Ze)},!0),q(Et,Mt)},!0),q(ut,bt)},!0),q(qe,nt)},!0),q($e,ze)},!0),q(xe,oe)},!0),q(fe,pe)},!0),q(Q,le)},!0),q(O,Y)},!0),q(B,$)},!0),q(A,M)},!0),q(C,P)},!0),q(m,g)},!0),q(u,d)},!0),q(l,c)}),_(r),Ce(()=>{Ot(r,"style",`width: ${o()??""}px; height: ${o()??""}px;`),wr(r,"active",s())}),q(n,r)}var w2={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */w2.exports;(function(n,e){(function(){var t,s="4.17.21",o=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",f=500,u="__lodash_placeholder__",d=1,h=2,m=4,g=1,w=2,C=1,P=2,I=4,A=8,M=16,F=32,B=64,$=128,L=256,O=512,Y=30,ce="...",Q=800,le=16,ue=1,fe=2,pe=3,Z=1/0,xe=9007199254740991,oe=17976931348623157e292,Pe=NaN,$e=4294967295,ze=$e-1,Ke=$e>>>1,qe=[["ary",$],["bind",C],["bindKey",P],["curry",A],["curryRight",M],["flip",O],["partial",F],["partialRight",B],["rearg",L]],nt="[object Arguments]",ft="[object Array]",ut="[object AsyncFunction]",bt="[object Boolean]",Pt="[object Date]",Et="[object DOMException]",Mt="[object Error]",Je="[object Function]",Ct="[object GeneratorFunction]",Ze="[object Map]",Xe="[object Number]",Ae="[object Null]",Qe="[object Object]",gt="[object Promise]",Ft="[object Proxy]",ot="[object RegExp]",ve="[object Set]",Ie="[object String]",It="[object Symbol]",Dt="[object Undefined]",Zt="[object WeakMap]",gn="[object WeakSet]",hn="[object ArrayBuffer]",qn="[object DataView]",On="[object Float32Array]",bn="[object Float64Array]",Fn="[object Int8Array]",Xs="[object Int16Array]",oo="[object Int32Array]",Yn="[object Uint8Array]",_o="[object Uint8ClampedArray]",xs="[object Uint16Array]",Rt="[object Uint32Array]",un=/\b__p \+= '';/g,qs=/\b(__p \+=) '' \+/g,ri=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Eo=/&(?:amp|lt|gt|quot|#39);/g,Ia=/[&<>"']/g,Lr=RegExp(Eo.source),Qa=RegExp(Ia.source),yr=/<%-([\s\S]+?)%>/g,Fi=/<%([\s\S]+?)%>/g,Rc=/<%=([\s\S]+?)%>/g,Cu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,uc=/^\w*$/,Fl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,jc=/[\\^$.*+?()[\]{}|]/g,nd=RegExp(jc.source),Fa=/^\s+/,dc=/\s/,Bc=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,rd=/\{\n\/\* \[wrapped with (.+)\] \*/,uf=/,? & /,So=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ll=/[()=,{}\[\]\/\s]/,ya=/\\(\\)?/g,hc=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Pa=/\w*$/,Yr=/^[-+]0x[0-9a-f]+$/i,el=/^0b[01]+$/i,Yl=/^\[object .+?Constructor\]$/,Vu=/^0o[0-7]+$/i,Iu=/^(?:0|[1-9]\d*)$/,Ro=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,zr=/($^)/,kl=/['\n\r\u2028\u2029\\]/g,Md="\\ud800-\\udfff",nf="\\u0300-\\u036f",zf="\\ufe20-\\ufe2f",df="\\u20d0-\\u20ff",Pu=nf+zf+df,Dd="\\u2700-\\u27bf",yf="a-z\\xdf-\\xf6\\xf8-\\xff",$n="\\xac\\xb1\\xd7\\xf7",ws="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Us="\\u2000-\\u206f",Dn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ni="A-Z\\xc0-\\xd6\\xd8-\\xde",mo="\\ufe0e\\ufe0f",sr=$n+ws+Us+Dn,or="['’]",hl="["+Md+"]",Oi="["+sr+"]",si="["+Pu+"]",Wo="\\d+",Ua="["+Dd+"]",Hi="["+yf+"]",to="[^"+Md+sr+Wo+Dd+yf+ni+"]",Li="\\ud83c[\\udffb-\\udfff]",Vr="(?:"+si+"|"+Li+")",ba="[^"+Md+"]",qi="(?:\\ud83c[\\udde6-\\uddff]){2}",Wr="[\\ud800-\\udbff][\\udc00-\\udfff]",Kl="["+ni+"]",Wl="\\u200d",Ic="(?:"+Hi+"|"+to+")",Pc="(?:"+Kl+"|"+to+")",cl="(?:"+or+"(?:d|ll|m|re|s|t|ve))?",mr="(?:"+or+"(?:D|LL|M|RE|S|T|VE))?",La=Vr+"?",Sl="["+mo+"]?",Ba="(?:"+Wl+"(?:"+[ba,qi,Wr].join("|")+")"+Sl+La+")*",vi="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vc="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ul=Sl+La+Ba,Ga="(?:"+[Ua,qi,Wr].join("|")+")"+ul,vl="(?:"+[ba+si+"?",si,qi,Wr,hl].join("|")+")",pu=RegExp(or,"g"),tl=RegExp(si,"g"),Oa=RegExp(Li+"(?="+Li+")|"+vl+ul,"g"),Oc=RegExp([Kl+"?"+Hi+"+"+cl+"(?="+[Oi,Kl,"$"].join("|")+")",Pc+"+"+mr+"(?="+[Oi,Kl+Ic,"$"].join("|")+")",Kl+"?"+Ic+"+"+cl,Kl+"+"+mr,vc,vi,Wo,Ga].join("|"),"g"),Gu=RegExp("["+Wl+Md+Pu+mo+"]"),El=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,mu=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],bc=-1,nl={};nl[On]=nl[bn]=nl[Fn]=nl[Xs]=nl[oo]=nl[Yn]=nl[_o]=nl[xs]=nl[Rt]=!0,nl[nt]=nl[ft]=nl[hn]=nl[bt]=nl[qn]=nl[Pt]=nl[Mt]=nl[Je]=nl[Ze]=nl[Xe]=nl[Qe]=nl[ot]=nl[ve]=nl[Ie]=nl[Zt]=!1;var la={};la[nt]=la[ft]=la[hn]=la[qn]=la[bt]=la[Pt]=la[On]=la[bn]=la[Fn]=la[Xs]=la[oo]=la[Ze]=la[Xe]=la[Qe]=la[ot]=la[ve]=la[Ie]=la[It]=la[Yn]=la[_o]=la[xs]=la[Rt]=!0,la[Mt]=la[Je]=la[Zt]=!1;var Mu={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Yu={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},zc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Zd={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Yf=parseFloat,Kf=parseInt,_d=typeof L0=="object"&&L0&&L0.Object===Object&&L0,Rd=typeof self=="object"&&self&&self.Object===Object&&self,fc=_d||Rd||Function("return this")(),pp=e&&!e.nodeType&&e,kd=pp&&!0&&n&&!n.nodeType&&n,Wd=kd&&kd.exports===pp,$l=Wd&&_d.process,Nu=function(){try{var _t=kd&&kd.require&&kd.require("util").types;return _t||$l&&$l.binding&&$l.binding("util")}catch{}}(),Ku=Nu&&Nu.isArrayBuffer,bf=Nu&&Nu.isDate,Xu=Nu&&Nu.isMap,Ql=Nu&&Nu.isRegExp,Hd=Nu&&Nu.isSet,hu=Nu&&Nu.isTypedArray;function Jc(_t,Gt,en){switch(en.length){case 0:return _t.call(Gt);case 1:return _t.call(Gt,en[0]);case 2:return _t.call(Gt,en[0],en[1]);case 3:return _t.call(Gt,en[0],en[1],en[2])}return _t.apply(Gt,en)}function Au(_t,Gt,en,cs){for(var ps=-1,vo=_t==null?0:_t.length;++ps<vo;){var Ko=_t[ps];Gt(cs,Ko,en(Ko),_t)}return cs}function jd(_t,Gt){for(var en=-1,cs=_t==null?0:_t.length;++en<cs&&Gt(_t[en],en,_t)!==!1;);return _t}function Wu(_t,Gt){for(var en=_t==null?0:_t.length;en--&&Gt(_t[en],en,_t)!==!1;);return _t}function sf(_t,Gt){for(var en=-1,cs=_t==null?0:_t.length;++en<cs;)if(!Gt(_t[en],en,_t))return!1;return!0}function ad(_t,Gt){for(var en=-1,cs=_t==null?0:_t.length,ps=0,vo=[];++en<cs;){var Ko=_t[en];Gt(Ko,en,_t)&&(vo[ps++]=Ko)}return vo}function yd(_t,Gt){var en=_t==null?0:_t.length;return!!en&&J(_t,Gt,0)>-1}function Bd(_t,Gt,en){for(var cs=-1,ps=_t==null?0:_t.length;++cs<ps;)if(en(Gt,_t[cs]))return!0;return!1}function Mc(_t,Gt){for(var en=-1,cs=_t==null?0:_t.length,ps=Array(cs);++en<cs;)ps[en]=Gt(_t[en],en,_t);return ps}function Tu(_t,Gt){for(var en=-1,cs=Gt.length,ps=_t.length;++en<cs;)_t[ps+en]=Gt[en];return _t}function qd(_t,Gt,en,cs){var ps=-1,vo=_t==null?0:_t.length;for(cs&&vo&&(en=_t[++ps]);++ps<vo;)en=Gt(en,_t[ps],ps,_t);return en}function Xf(_t,Gt,en,cs){var ps=_t==null?0:_t.length;for(cs&&ps&&(en=_t[--ps]);ps--;)en=Gt(en,_t[ps],ps,_t);return en}function Vf(_t,Gt){for(var en=-1,cs=_t==null?0:_t.length;++en<cs;)if(Gt(_t[en],en,_t))return!0;return!1}var se=jt("length");function be(_t){return _t.split("")}function G(_t){return _t.match(So)||[]}function re(_t,Gt,en){var cs;return en(_t,function(ps,vo,Ko){if(Gt(ps,vo,Ko))return cs=vo,!1}),cs}function we(_t,Gt,en,cs){for(var ps=_t.length,vo=en+(cs?1:-1);cs?vo--:++vo<ps;)if(Gt(_t[vo],vo,_t))return vo;return-1}function J(_t,Gt,en){return Gt===Gt?Lf(_t,Gt,en):we(_t,yt,en)}function Fe(_t,Gt,en,cs){for(var ps=en-1,vo=_t.length;++ps<vo;)if(cs(_t[ps],Gt))return ps;return-1}function yt(_t){return _t!==_t}function vt(_t,Gt){var en=_t==null?0:_t.length;return en?Se(_t,Gt)/en:Pe}function jt(_t){return function(Gt){return Gt==null?t:Gt[_t]}}function ye(_t){return function(Gt){return _t==null?t:_t[Gt]}}function E(_t,Gt,en,cs,ps){return ps(_t,function(vo,Ko,ho){en=cs?(cs=!1,vo):Gt(en,vo,Ko,ho)}),en}function me(_t,Gt){var en=_t.length;for(_t.sort(Gt);en--;)_t[en]=_t[en].value;return _t}function Se(_t,Gt){for(var en,cs=-1,ps=_t.length;++cs<ps;){var vo=Gt(_t[cs]);vo!==t&&(en=en===t?vo:en+vo)}return en}function Ve(_t,Gt){for(var en=-1,cs=Array(_t);++en<_t;)cs[en]=Gt(en);return cs}function Ye(_t,Gt){return Mc(Gt,function(en){return[en,_t[en]]})}function at(_t){return _t&&_t.slice(0,Ht(_t)+1).replace(Fa,"")}function Re(_t){return function(Gt){return _t(Gt)}}function De(_t,Gt){return Mc(Gt,function(en){return _t[en]})}function pt(_t,Gt){return _t.has(Gt)}function Ge(_t,Gt){for(var en=-1,cs=_t.length;++en<cs&&J(Gt,_t[en],0)>-1;);return en}function sn(_t,Gt){for(var en=_t.length;en--&&J(Gt,_t[en],0)>-1;);return en}function Un(_t,Gt){for(var en=_t.length,cs=0;en--;)_t[en]===Gt&&++cs;return cs}var Zs=ye(Mu),vs=ye(Yu);function Oo(_t){return"\\"+Zd[_t]}function Pi(_t,Gt){return _t==null?t:_t[Gt]}function no(_t){return Gu.test(_t)}function gl(_t){return El.test(_t)}function Ms(_t){for(var Gt,en=[];!(Gt=_t.next()).done;)en.push(Gt.value);return en}function wo(_t){var Gt=-1,en=Array(_t.size);return _t.forEach(function(cs,ps){en[++Gt]=[ps,cs]}),en}function fr(_t,Gt){return function(en){return _t(Gt(en))}}function xa(_t,Gt){for(var en=-1,cs=_t.length,ps=0,vo=[];++en<cs;){var Ko=_t[en];(Ko===Gt||Ko===u)&&(_t[en]=u,vo[ps++]=en)}return vo}function ic(_t){var Gt=-1,en=Array(_t.size);return _t.forEach(function(cs){en[++Gt]=cs}),en}function ec(_t){var Gt=-1,en=Array(_t.size);return _t.forEach(function(cs){en[++Gt]=[cs,cs]}),en}function Lf(_t,Gt,en){for(var cs=en-1,ps=_t.length;++cs<ps;)if(_t[cs]===Gt)return cs;return-1}function _e(_t,Gt,en){for(var cs=en+1;cs--;)if(_t[cs]===Gt)return cs;return cs}function We(_t){return no(_t)?ht(_t):se(_t)}function xt(_t){return no(_t)?dn(_t):be(_t)}function Ht(_t){for(var Gt=_t.length;Gt--&&dc.test(_t.charAt(Gt)););return Gt}var qt=ye(zc);function ht(_t){for(var Gt=Oa.lastIndex=0;Oa.test(_t);)++Gt;return Gt}function dn(_t){return _t.match(Oa)||[]}function Ut(_t){return _t.match(Oc)||[]}var Xn=function _t(Gt){Gt=Gt==null?fc:rs.defaults(fc.Object(),Gt,rs.pick(fc,mu));var en=Gt.Array,cs=Gt.Date,ps=Gt.Error,vo=Gt.Function,Ko=Gt.Math,ho=Gt.Object,wa=Gt.RegExp,di=Gt.String,Mi=Gt.TypeError,Kr=en.prototype,hr=vo.prototype,sl=ho.prototype,fo=Gt["__core-js_shared__"],wu=hr.toString,_l=sl.hasOwnProperty,Xl=0,rc=function(){var p=/[^.]+$/.exec(fo&&fo.keys&&fo.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),Qc=sl.toString,na=wu.call(ho),Nc=fc._,Ea=wa("^"+wu.call(_l).replace(jc,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Nd=Wd?Gt.Buffer:t,In=Gt.Symbol,St=Gt.Uint8Array,Rn=Nd?Nd.allocUnsafe:t,Cn=fr(ho.getPrototypeOf,ho),Ts=ho.create,Fs=sl.propertyIsEnumerable,Es=Kr.splice,Co=In?In.isConcatSpreadable:t,li=In?In.iterator:t,ro=In?In.toStringTag:t,zo=function(){try{var p=cn(ho,"defineProperty");return p({},"",{}),p}catch{}}(),io=Gt.clearTimeout!==fc.clearTimeout&&Gt.clearTimeout,Ji=cs&&cs.now!==fc.Date.now&&cs.now,Hl=Gt.setTimeout!==fc.setTimeout&&Gt.setTimeout,Vc=Ko.ceil,ol=Ko.floor,Ac=ho.getOwnPropertySymbols,br=Nd?Nd.isBuffer:t,fa=Gt.isFinite,Dl=Kr.join,Fu=fr(ho.keys,ho),Xr=Ko.max,cr=Ko.min,us=cs.now,ko=Gt.parseInt,ur=Ko.random,Pr=Kr.reverse,kr=cn(Gt,"DataView"),Sr=cn(Gt,"Map"),Lu=cn(Gt,"Promise"),iu=cn(Gt,"Set"),bd=cn(Gt,"WeakMap"),Or=cn(ho,"create"),pc=bd&&new bd,Wc={},Od=Pm(kr),Zu=Pm(Sr),ff=Pm(Lu),xd=Pm(iu),Wf=Pm(bd),Ui=In?In.prototype:t,om=Ui?Ui.valueOf:t,Ef=Ui?Ui.toString:t;function it(p){if(ji(p)&&!Uo(p)&&!(p instanceof ku)){if(p instanceof Ep)return p;if(_l.call(p,"__wrapped__"))return Pg(p)}return new Ep(p)}var gv=function(){function p(){}return function(b){if(!Qs(b))return{};if(Ts)return Ts(b);p.prototype=b;var T=new p;return p.prototype=t,T}}();function Nv(){}function Ep(p,b){this.__wrapped__=p,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=t}it.templateSettings={escape:yr,evaluate:Fi,interpolate:Rc,variable:"",imports:{_:it}},it.prototype=Nv.prototype,it.prototype.constructor=it,Ep.prototype=gv(Nv.prototype),Ep.prototype.constructor=Ep;function ku(p){this.__wrapped__=p,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=$e,this.__views__=[]}function Rm(){var p=new ku(this.__wrapped__);return p.__actions__=ip(this.__actions__),p.__dir__=this.__dir__,p.__filtered__=this.__filtered__,p.__iteratees__=ip(this.__iteratees__),p.__takeCount__=this.__takeCount__,p.__views__=ip(this.__views__),p}function Wg(){if(this.__filtered__){var p=new ku(this);p.__dir__=-1,p.__filtered__=!0}else p=this.clone(),p.__dir__*=-1;return p}function Sg(){var p=this.__wrapped__.value(),b=this.__dir__,T=Uo(p),z=b<0,ie=T?p.length:0,Ne=wn(0,ie,this.__views__),Oe=Ne.start,ct=Ne.end,et=ct-Oe,Vt=z?ct:Oe-1,rn=this.__iteratees__,kn=rn.length,Is=0,Sn=cr(et,this.__takeCount__);if(!T||!z&&ie==et&&Sn==et)return uv(p,this.__actions__);var Ao=[];e:for(;et--&&Is<Sn;){Vt+=b;for(var Io=-1,go=p[Vt];++Io<kn;){var so=rn[Io],es=so.iteratee,bo=so.type,Ir=es(go);if(bo==fe)go=Ir;else if(!Ir){if(bo==ue)continue e;break e}}Ao[Is++]=go}return Ao}ku.prototype=gv(Nv.prototype),ku.prototype.constructor=ku;function Av(p){var b=-1,T=p==null?0:p.length;for(this.clear();++b<T;){var z=p[b];this.set(z[0],z[1])}}function Wp(){this.__data__=Or?Or(null):{},this.size=0}function Eu(p){var b=this.has(p)&&delete this.__data__[p];return this.size-=b?1:0,b}function av(p){var b=this.__data__;if(Or){var T=b[p];return T===c?t:T}return _l.call(b,p)?b[p]:t}function jm(p){var b=this.__data__;return Or?b[p]!==t:_l.call(b,p)}function ng(p,b){var T=this.__data__;return this.size+=this.has(p)?0:1,T[p]=Or&&b===t?c:b,this}Av.prototype.clear=Wp,Av.prototype.delete=Eu,Av.prototype.get=av,Av.prototype.has=jm,Av.prototype.set=ng;function im(p){var b=-1,T=p==null?0:p.length;for(this.clear();++b<T;){var z=p[b];this.set(z[0],z[1])}}function xf(){this.__data__=[],this.size=0}function Bm(p){var b=this.__data__,T=Vn(b,p);if(T<0)return!1;var z=b.length-1;return T==z?b.pop():Es.call(b,T,1),--this.size,!0}function Om(p){var b=this.__data__,T=Vn(b,p);return T<0?t:b[T][1]}function Lh(p){return Vn(this.__data__,p)>-1}function Gh(p,b){var T=this.__data__,z=Vn(T,p);return z<0?(++this.size,T.push([p,b])):T[z][1]=b,this}im.prototype.clear=xf,im.prototype.delete=Bm,im.prototype.get=Om,im.prototype.has=Lh,im.prototype.set=Gh;function fh(p){var b=-1,T=p==null?0:p.length;for(this.clear();++b<T;){var z=p[b];this.set(z[0],z[1])}}function Tv(){this.size=0,this.__data__={hash:new Av,map:new(Sr||im),string:new Av}}function w0(p){var b=ms(this,p).delete(p);return this.size-=b?1:0,b}function Cg(p){return ms(this,p).get(p)}function Fv(p){return ms(this,p).has(p)}function _v(p,b){var T=ms(this,p),z=T.size;return T.set(p,b),this.size+=T.size==z?0:1,this}fh.prototype.clear=Tv,fh.prototype.delete=w0,fh.prototype.get=Cg,fh.prototype.has=Fv,fh.prototype.set=_v;function ph(p){var b=-1,T=p==null?0:p.length;for(this.__data__=new fh;++b<T;)this.add(p[b])}function mh(p){return this.__data__.set(p,c),this}function sg(p){return this.__data__.has(p)}ph.prototype.add=ph.prototype.push=mh,ph.prototype.has=sg;function hh(p){var b=this.__data__=new im(p);this.size=b.size}function og(){this.__data__=new im,this.size=0}function np(p){var b=this.__data__,T=b.delete(p);return this.size=b.size,T}function z0(p){return this.__data__.get(p)}function Ig(p){return this.__data__.has(p)}function ee(p,b){var T=this.__data__;if(T instanceof im){var z=T.__data__;if(!Sr||z.length<o-1)return z.push([p,b]),this.size=++T.size,this;T=this.__data__=new fh(z)}return T.set(p,b),this.size=T.size,this}hh.prototype.clear=og,hh.prototype.delete=np,hh.prototype.get=z0,hh.prototype.has=Ig,hh.prototype.set=ee;function de(p,b){var T=Uo(p),z=!T&&Sa(p),ie=!T&&!z&&Jo(p),Ne=!T&&!z&&!ie&&bl(p),Oe=T||z||ie||Ne,ct=Oe?Ve(p.length,di):[],et=ct.length;for(var Vt in p)(b||_l.call(p,Vt))&&!(Oe&&(Vt=="length"||ie&&(Vt=="offset"||Vt=="parent")||Ne&&(Vt=="buffer"||Vt=="byteLength"||Vt=="byteOffset")||No(Vt,et)))&&ct.push(Vt);return ct}function He(p){var b=p.length;return b?p[lm(0,b-1)]:t}function rt(p,b){return Df(ip(p),Ei(b,0,p.length))}function Qt(p){return Df(ip(p))}function Lt(p,b,T){(T!==t&&!pr(p[b],T)||T===t&&!(b in p))&&Os(p,b,T)}function _n(p,b,T){var z=p[b];(!(_l.call(p,b)&&pr(z,T))||T===t&&!(b in p))&&Os(p,b,T)}function Vn(p,b){for(var T=p.length;T--;)if(pr(p[T][0],b))return T;return-1}function Zn(p,b,T,z){return Rl(p,function(ie,Ne,Oe){b(z,ie,T(ie),Oe)}),z}function Js(p,b){return p&&um(b,Nf(b),p)}function $o(p,b){return p&&um(b,Qu(b),p)}function Os(p,b,T){b=="__proto__"&&zo?zo(p,b,{configurable:!0,enumerable:!0,value:T,writable:!0}):p[b]=T}function Xo(p,b){for(var T=-1,z=b.length,ie=en(z),Ne=p==null;++T<z;)ie[T]=Ne?t:qp(p,b[T]);return ie}function Ei(p,b,T){return p===p&&(T!==t&&(p=p<=T?p:T),b!==t&&(p=p>=b?p:b)),p}function ao(p,b,T,z,ie,Ne){var Oe,ct=b&d,et=b&h,Vt=b&m;if(T&&(Oe=ie?T(p,z,ie,Ne):T(p)),Oe!==t)return Oe;if(!Qs(p))return p;var rn=Uo(p);if(rn){if(Oe=yo(p),!ct)return ip(p,Oe)}else{var kn=an(p),Is=kn==Je||kn==Ct;if(Jo(p))return $h(p,ct);if(kn==Qe||kn==nt||Is&&!ie){if(Oe=et||Is?{}:Si(p),!ct)return et?Zm(p,$o(Oe,p)):dv(p,Js(Oe,p))}else{if(!la[kn])return ie?p:{};Oe=is(p,kn,ct)}}Ne||(Ne=new hh);var Sn=Ne.get(p);if(Sn)return Sn;Ne.set(p,Oe),Cc(p)?p.forEach(function(go){Oe.add(ao(go,b,T,go,p,Ne))}):qa(p)&&p.forEach(function(go,so){Oe.set(so,ao(go,b,T,so,p,Ne))});var Ao=Vt?et?Xt:jn:et?Qu:Nf,Io=rn?t:Ao(p);return jd(Io||p,function(go,so){Io&&(so=go,go=p[so]),_n(Oe,so,ao(go,b,T,so,p,Ne))}),Oe}function za(p){var b=Nf(p);return function(T){return $a(T,p,b)}}function $a(p,b,T){var z=T.length;if(p==null)return!z;for(p=ho(p);z--;){var ie=T[z],Ne=b[ie],Oe=p[ie];if(Oe===t&&!(ie in p)||!Ne(Oe))return!1}return!0}function yl(p,b,T){if(typeof p!="function")throw new Mi(a);return au(function(){p.apply(t,T)},b)}function Cl(p,b,T,z){var ie=-1,Ne=yd,Oe=!0,ct=p.length,et=[],Vt=b.length;if(!ct)return et;T&&(b=Mc(b,Re(T))),z?(Ne=Bd,Oe=!1):b.length>=o&&(Ne=pt,Oe=!1,b=new ph(b));e:for(;++ie<ct;){var rn=p[ie],kn=T==null?rn:T(rn);if(rn=z||rn!==0?rn:0,Oe&&kn===kn){for(var Is=Vt;Is--;)if(b[Is]===kn)continue e;et.push(rn)}else Ne(b,kn,z)||et.push(rn)}return et}var Rl=Ov(Mo),tc=Ov($i,!0);function Ad(p,b){var T=!0;return Rl(p,function(z,ie,Ne){return T=!!b(z,ie,Ne),T}),T}function gc(p,b,T){for(var z=-1,ie=p.length;++z<ie;){var Ne=p[z],Oe=b(Ne);if(Oe!=null&&(ct===t?Oe===Oe&&!Gc(Oe):T(Oe,ct)))var ct=Oe,et=Ne}return et}function wd(p,b,T,z){var ie=p.length;for(T=ea(T),T<0&&(T=-T>ie?0:ie+T),z=z===t||z>ie?ie:ea(z),z<0&&(z+=ie),z=T>z?0:qf(z);T<z;)p[T++]=b;return p}function Xp(p,b){var T=[];return Rl(p,function(z,ie,Ne){b(z,ie,Ne)&&T.push(z)}),T}function $u(p,b,T,z,ie){var Ne=-1,Oe=p.length;for(T||(T=gs),ie||(ie=[]);++Ne<Oe;){var ct=p[Ne];b>0&&T(ct)?b>1?$u(ct,b-1,T,z,ie):Tu(ie,ct):z||(ie[ie.length]=ct)}return ie}var Jd=jh(),Po=jh(!0);function Mo(p,b){return p&&Jd(p,b,Nf)}function $i(p,b){return p&&Po(p,b,Nf)}function Zr(p,b){return ad(b,function(T){return Ur(p[T])})}function nc(p,b){b=Rp(b,p);for(var T=0,z=b.length;p!=null&&T<z;)p=p[kf(b[T++])];return T&&T==z?p:t}function Hu(p,b,T){var z=b(p);return Uo(p)?z:Tu(z,T(p))}function ld(p){return p==null?p===t?Dt:Ae:ro&&ro in ho(p)?Gn(p):_u(p)}function mp(p,b){return p>b}function Tc(p,b){return p!=null&&_l.call(p,b)}function Hp(p,b){return p!=null&&b in ho(p)}function vu(p,b,T){return p>=cr(b,T)&&p<Xr(b,T)}function Qi(p,b,T){for(var z=T?Bd:yd,ie=p[0].length,Ne=p.length,Oe=Ne,ct=en(Ne),et=1/0,Vt=[];Oe--;){var rn=p[Oe];Oe&&b&&(rn=Mc(rn,Re(b))),et=cr(rn.length,et),ct[Oe]=!T&&(b||ie>=120&&rn.length>=120)?new ph(Oe&&rn):t}rn=p[0];var kn=-1,Is=ct[0];e:for(;++kn<ie&&Vt.length<et;){var Sn=rn[kn],Ao=b?b(Sn):Sn;if(Sn=T||Sn!==0?Sn:0,!(Is?pt(Is,Ao):z(Vt,Ao,T))){for(Oe=Ne;--Oe;){var Io=ct[Oe];if(!(Io?pt(Io,Ao):z(p[Oe],Ao,T)))continue e}Is&&Is.push(Ao),Vt.push(Sn)}}return Vt}function zm(p,b,T,z){return Mo(p,function(ie,Ne,Oe){b(z,T(ie),Ne,Oe)}),z}function sp(p,b,T){b=Rp(b,p),p=ql(p,b);var z=p==null?p:p[kf($t(b))];return z==null?t:Jc(z,p,T)}function ym(p){return ji(p)&&ld(p)==nt}function vh(p){return ji(p)&&ld(p)==hn}function Zp(p){return ji(p)&&ld(p)==Pt}function Jp(p,b,T,z,ie){return p===b?!0:p==null||b==null||!ji(p)&&!ji(b)?p!==p&&b!==b:bm(p,b,T,z,Jp,ie)}function bm(p,b,T,z,ie,Ne){var Oe=Uo(p),ct=Uo(b),et=Oe?ft:an(p),Vt=ct?ft:an(b);et=et==nt?Qe:et,Vt=Vt==nt?Qe:Vt;var rn=et==Qe,kn=Vt==Qe,Is=et==Vt;if(Is&&Jo(p)){if(!Jo(b))return!1;Oe=!0,rn=!1}if(Is&&!rn)return Ne||(Ne=new hh),Oe||bl(p)?Pn(p,b,T,z,ie,Ne):as(p,b,et,T,z,ie,Ne);if(!(T&g)){var Sn=rn&&_l.call(p,"__wrapped__"),Ao=kn&&_l.call(b,"__wrapped__");if(Sn||Ao){var Io=Sn?p.value():p,go=Ao?b.value():b;return Ne||(Ne=new hh),ie(Io,go,T,z,Ne)}}return Is?(Ne||(Ne=new hh),Cs(p,b,T,z,ie,Ne)):!1}function Eh(p){return ji(p)&&an(p)==Ze}function Hf(p,b,T,z){var ie=T.length,Ne=ie,Oe=!z;if(p==null)return!Ne;for(p=ho(p);ie--;){var ct=T[ie];if(Oe&&ct[2]?ct[1]!==p[ct[0]]:!(ct[0]in p))return!1}for(;++ie<Ne;){ct=T[ie];var et=ct[0],Vt=p[et],rn=ct[1];if(Oe&&ct[2]){if(Vt===t&&!(et in p))return!1}else{var kn=new hh;if(z)var Is=z(Vt,rn,et,p,b,kn);if(!(Is===t?Jp(rn,Vt,g|w,z,kn):Is))return!1}}return!0}function Vm(p){if(!Qs(p)||Hc(p))return!1;var b=Ur(p)?Ea:Yl;return b.test(Pm(p))}function Wm(p){return ji(p)&&ld(p)==ot}function Yh(p){return ji(p)&&an(p)==ve}function rm(p){return ji(p)&&xi(p.length)&&!!nl[ld(p)]}function xm(p){return typeof p=="function"?p:p==null?Af:typeof p=="object"?Uo(p)?qm(p[0],p[1]):Lv(p):c1(p)}function Hm(p){if(!ac(p))return Fu(p);var b=[];for(var T in ho(p))_l.call(p,T)&&T!="constructor"&&b.push(T);return b}function hp(p){if(!Qs(p))return Bl(p);var b=ac(p),T=[];for(var z in p)z=="constructor"&&(b||!_l.call(p,z))||T.push(z);return T}function zd(p,b){return p<b}function lv(p,b){var T=-1,z=qr(p)?en(p.length):[];return Rl(p,function(ie,Ne,Oe){z[++T]=b(ie,Ne,Oe)}),z}function Lv(p){var b=Ns(p);return b.length==1&&b[0][2]?_c(b[0][0],b[0][1]):function(T){return T===p||Hf(T,p,b)}}function qm(p,b){return co(p)&&tu(b)?_c(kf(p),b):function(T){var z=qp(T,p);return z===t&&z===b?th(T,p):Jp(b,z,g|w)}}function gh(p,b,T,z,ie){p!==b&&Jd(b,function(Ne,Oe){if(ie||(ie=new hh),Qs(Ne))Kh(p,b,Oe,T,gh,z,ie);else{var ct=z?z(Uc(p,Oe),Ne,Oe+"",p,b,ie):t;ct===t&&(ct=Ne),Lt(p,Oe,ct)}},Qu)}function Kh(p,b,T,z,ie,Ne,Oe){var ct=Uc(p,T),et=Uc(b,T),Vt=Oe.get(et);if(Vt){Lt(p,T,Vt);return}var rn=Ne?Ne(ct,et,T+"",p,b,Oe):t,kn=rn===t;if(kn){var Is=Uo(et),Sn=!Is&&Jo(et),Ao=!Is&&!Sn&&bl(et);rn=et,Is||Sn||Ao?Uo(ct)?rn=ct:Ri(ct)?rn=ip(ct):Sn?(kn=!1,rn=$h(et,!0)):Ao?(kn=!1,rn=eu(et,!0)):rn=[]:Gl(et)||Sa(et)?(rn=ct,Sa(ct)?rn=pl(ct):(!Qs(ct)||Ur(ct))&&(rn=Si(et))):kn=!1}kn&&(Oe.set(et,rn),ie(rn,et,z,Ne,Oe),Oe.delete(et)),Lt(p,T,rn)}function Du(p,b){var T=p.length;if(T)return b+=b<0?T:0,No(b,T)?p[b]:t}function $p(p,b,T){b.length?b=Mc(b,function(Ne){return Uo(Ne)?function(Oe){return nc(Oe,Ne.length===1?Ne[0]:Ne)}:Ne}):b=[Af];var z=-1;b=Mc(b,Re(ln()));var ie=lv(p,function(Ne,Oe,ct){var et=Mc(b,function(Vt){return Vt(Ne)});return{criteria:et,index:++z,value:Ne}});return me(ie,function(Ne,Oe){return Xm(Ne,Oe,T)})}function _h(p,b){return am(p,b,function(T,z){return th(p,z)})}function am(p,b,T){for(var z=-1,ie=b.length,Ne={};++z<ie;){var Oe=b[z],ct=nc(p,Oe);T(ct,Oe)&&cm(Ne,Rp(Oe,p),ct)}return Ne}function Um(p){return function(b){return nc(b,p)}}function $f(p,b,T,z){var ie=z?Fe:J,Ne=-1,Oe=b.length,ct=p;for(p===b&&(b=ip(b)),T&&(ct=Mc(p,Re(T)));++Ne<Oe;)for(var et=0,Vt=b[Ne],rn=T?T(Vt):Vt;(et=ie(ct,rn,et,z))>-1;)ct!==p&&Es.call(ct,et,1),Es.call(p,et,1);return p}function wm(p,b){for(var T=p?b.length:0,z=T-1;T--;){var ie=b[T];if(T==z||ie!==Ne){var Ne=ie;No(ie)?Es.call(p,ie,1):$v(p,ie)}}return p}function lm(p,b){return p+ol(ur()*(b-p+1))}function yh(p,b,T,z){for(var ie=-1,Ne=Xr(Vc((b-p)/(T||1)),0),Oe=en(Ne);Ne--;)Oe[z?Ne:++ie]=p,p+=T;return Oe}function Gm(p,b){var T="";if(!p||b<1||b>xe)return T;do b%2&&(T+=p),b=ol(b/2),b&&(p+=p);while(b);return T}function Vl(p,b){return of(cd(p,b,Af),p+"")}function km(p){return He(Ls(p))}function Ym(p,b){var T=Ls(p);return Df(T,Ei(b,0,T.length))}function cm(p,b,T,z){if(!Qs(p))return p;b=Rp(b,p);for(var ie=-1,Ne=b.length,Oe=Ne-1,ct=p;ct!=null&&++ie<Ne;){var et=kf(b[ie]),Vt=T;if(et==="__proto__"||et==="constructor"||et==="prototype")return p;if(ie!=Oe){var rn=ct[et];Vt=z?z(rn,et,ct):t,Vt===t&&(Vt=Qs(rn)?rn:No(b[ie+1])?[]:{})}_n(ct,et,Vt),ct=ct[et]}return p}var bh=pc?function(p,b){return pc.set(p,b),p}:Af,cv=zo?function(p,b){return zo(p,"toString",{configurable:!0,enumerable:!1,value:$g(b),writable:!0})}:Af;function ig(p){return Df(Ls(p))}function Dp(p,b,T){var z=-1,ie=p.length;b<0&&(b=-b>ie?0:ie+b),T=T>ie?ie:T,T<0&&(T+=ie),ie=b>T?0:T-b>>>0,b>>>=0;for(var Ne=en(ie);++z<ie;)Ne[z]=p[z+b];return Ne}function yv(p,b){var T;return Rl(p,function(z,ie,Ne){return T=b(z,ie,Ne),!T}),!!T}function op(p,b,T){var z=0,ie=p==null?z:p.length;if(typeof b=="number"&&b===b&&ie<=Ke){for(;z<ie;){var Ne=z+ie>>>1,Oe=p[Ne];Oe!==null&&!Gc(Oe)&&(T?Oe<=b:Oe<b)?z=Ne+1:ie=Ne}return ie}return Xh(p,b,Af,T)}function Xh(p,b,T,z){var ie=0,Ne=p==null?0:p.length;if(Ne===0)return 0;b=T(b);for(var Oe=b!==b,ct=b===null,et=Gc(b),Vt=b===t;ie<Ne;){var rn=ol((ie+Ne)/2),kn=T(p[rn]),Is=kn!==t,Sn=kn===null,Ao=kn===kn,Io=Gc(kn);if(Oe)var go=z||Ao;else Vt?go=Ao&&(z||Is):ct?go=Ao&&Is&&(z||!Sn):et?go=Ao&&Is&&!Sn&&(z||!Io):Sn||Io?go=!1:go=z?kn<=b:kn<b;go?ie=rn+1:Ne=rn}return cr(Ne,ze)}function Zh(p,b){for(var T=-1,z=p.length,ie=0,Ne=[];++T<z;){var Oe=p[T],ct=b?b(Oe):Oe;if(!T||!pr(ct,et)){var et=ct;Ne[ie++]=Oe===0?0:Oe}}return Ne}function Ev(p){return typeof p=="number"?p:Gc(p)?Pe:+p}function kp(p){if(typeof p=="string")return p;if(Uo(p))return Mc(p,kp)+"";if(Gc(p))return Ef?Ef.call(p):"";var b=p+"";return b=="0"&&1/p==-Z?"-0":b}function bp(p,b,T){var z=-1,ie=yd,Ne=p.length,Oe=!0,ct=[],et=ct;if(T)Oe=!1,ie=Bd;else if(Ne>=o){var Vt=b?null:dt(p);if(Vt)return ic(Vt);Oe=!1,ie=pt,et=new ph}else et=b?[]:ct;e:for(;++z<Ne;){var rn=p[z],kn=b?b(rn):rn;if(rn=T||rn!==0?rn:0,Oe&&kn===kn){for(var Is=et.length;Is--;)if(et[Is]===kn)continue e;b&&et.push(kn),ct.push(rn)}else ie(et,kn,T)||(et!==ct&&et.push(kn),ct.push(rn))}return ct}function $v(p,b){return b=Rp(b,p),p=ql(p,b),p==null||delete p[kf($t(b))]}function rg(p,b,T,z){return cm(p,b,T(nc(p,b)),z)}function Km(p,b,T,z){for(var ie=p.length,Ne=z?ie:-1;(z?Ne--:++Ne<ie)&&b(p[Ne],Ne,p););return T?Dp(p,z?0:Ne,z?Ne+1:ie):Dp(p,z?Ne+1:0,z?ie:Ne)}function uv(p,b){var T=p;return T instanceof ku&&(T=T.value()),qd(b,function(z,ie){return ie.func.apply(ie.thisArg,Tu([z],ie.args))},T)}function Jh(p,b,T){var z=p.length;if(z<2)return z?bp(p[0]):[];for(var ie=-1,Ne=en(z);++ie<z;)for(var Oe=p[ie],ct=-1;++ct<z;)ct!=ie&&(Ne[ie]=Cl(Ne[ie]||Oe,p[ct],b,T));return bp($u(Ne,1),b,T)}function ag(p,b,T){for(var z=-1,ie=p.length,Ne=b.length,Oe={};++z<ie;){var ct=z<Ne?b[z]:t;T(Oe,p[z],ct)}return Oe}function bv(p){return Ri(p)?p:[]}function xv(p){return typeof p=="function"?p:Af}function Rp(p,b){return Uo(p)?p:co(p,b)?[p]:Bh(lc(p))}var lg=Vl;function Sm(p,b,T){var z=p.length;return T=T===t?z:T,!b&&T>=z?p:Dp(p,b,T)}var Dv=io||function(p){return fc.clearTimeout(p)};function $h(p,b){if(b)return p.slice();var T=p.length,z=Rn?Rn(T):new p.constructor(T);return p.copy(z),z}function Rv(p){var b=new p.constructor(p.byteLength);return new St(b).set(new St(p)),b}function wf(p,b){var T=b?Rv(p.buffer):p.buffer;return new p.constructor(T,p.byteOffset,p.byteLength)}function sc(p){var b=new p.constructor(p.source,Pa.exec(p));return b.lastIndex=p.lastIndex,b}function ru(p){return om?ho(om.call(p)):{}}function eu(p,b){var T=b?Rv(p.buffer):p.buffer;return new p.constructor(T,p.byteOffset,p.length)}function Dh(p,b){if(p!==b){var T=p!==t,z=p===null,ie=p===p,Ne=Gc(p),Oe=b!==t,ct=b===null,et=b===b,Vt=Gc(b);if(!ct&&!Vt&&!Ne&&p>b||Ne&&Oe&&et&&!ct&&!Vt||z&&Oe&&et||!T&&et||!ie)return 1;if(!z&&!Ne&&!Vt&&p<b||Vt&&T&&ie&&!z&&!Ne||ct&&T&&ie||!Oe&&ie||!et)return-1}return 0}function Xm(p,b,T){for(var z=-1,ie=p.criteria,Ne=b.criteria,Oe=ie.length,ct=T.length;++z<Oe;){var et=Dh(ie[z],Ne[z]);if(et){if(z>=ct)return et;var Vt=T[z];return et*(Vt=="desc"?-1:1)}}return p.index-b.index}function jv(p,b,T,z){for(var ie=-1,Ne=p.length,Oe=T.length,ct=-1,et=b.length,Vt=Xr(Ne-Oe,0),rn=en(et+Vt),kn=!z;++ct<et;)rn[ct]=b[ct];for(;++ie<Oe;)(kn||ie<Ne)&&(rn[T[ie]]=p[ie]);for(;Vt--;)rn[ct++]=p[ie++];return rn}function Bv(p,b,T,z){for(var ie=-1,Ne=p.length,Oe=-1,ct=T.length,et=-1,Vt=b.length,rn=Xr(Ne-ct,0),kn=en(rn+Vt),Is=!z;++ie<rn;)kn[ie]=p[ie];for(var Sn=ie;++et<Vt;)kn[Sn+et]=b[et];for(;++Oe<ct;)(Is||ie<Ne)&&(kn[Sn+T[Oe]]=p[ie++]);return kn}function ip(p,b){var T=-1,z=p.length;for(b||(b=en(z));++T<z;)b[T]=p[T];return b}function um(p,b,T,z){var ie=!T;T||(T={});for(var Ne=-1,Oe=b.length;++Ne<Oe;){var ct=b[Ne],et=z?z(T[ct],p[ct],ct,T,p):t;et===t&&(et=p[ct]),ie?Os(T,ct,et):_n(T,ct,et)}return T}function dv(p,b){return um(p,ls(p),b)}function Zm(p,b){return um(p,on(p),b)}function Rh(p,b){return function(T,z){var ie=Uo(T)?Au:Zn,Ne=b?b():{};return ie(T,p,ln(z,2),Ne)}}function Cm(p){return Vl(function(b,T){var z=-1,ie=T.length,Ne=ie>1?T[ie-1]:t,Oe=ie>2?T[2]:t;for(Ne=p.length>3&&typeof Ne=="function"?(ie--,Ne):t,Oe&&jo(T[0],T[1],Oe)&&(Ne=ie<3?t:Ne,ie=1),b=ho(b);++z<ie;){var ct=T[z];ct&&p(b,ct,z,Ne)}return b})}function Ov(p,b){return function(T,z){if(T==null)return T;if(!qr(T))return p(T,z);for(var ie=T.length,Ne=b?ie:-1,Oe=ho(T);(b?Ne--:++Ne<ie)&&z(Oe[Ne],Ne,Oe)!==!1;);return T}}function jh(p){return function(b,T,z){for(var ie=-1,Ne=ho(b),Oe=z(b),ct=Oe.length;ct--;){var et=Oe[p?ct:++ie];if(T(Ne[et],et,Ne)===!1)break}return b}}function zv(p,b,T){var z=b&C,ie=Im(p);function Ne(){var Oe=this&&this!==fc&&this instanceof Ne?ie:p;return Oe.apply(z?T:this,arguments)}return Ne}function wv(p){return function(b){b=lc(b);var T=no(b)?xt(b):t,z=T?T[0]:b.charAt(0),ie=T?Sm(T,1).join(""):b.slice(1);return z[p]()+ie}}function xh(p){return function(b){return qd(Fg(Qo(b).replace(pu,"")),p,"")}}function Im(p){return function(){var b=arguments;switch(b.length){case 0:return new p;case 1:return new p(b[0]);case 2:return new p(b[0],b[1]);case 3:return new p(b[0],b[1],b[2]);case 4:return new p(b[0],b[1],b[2],b[3]);case 5:return new p(b[0],b[1],b[2],b[3],b[4]);case 6:return new p(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new p(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var T=gv(p.prototype),z=p.apply(T,b);return Qs(z)?z:T}}function Qh(p,b,T){var z=Im(p);function ie(){for(var Ne=arguments.length,Oe=en(Ne),ct=Ne,et=os(ie);ct--;)Oe[ct]=arguments[ct];var Vt=Ne<3&&Oe[0]!==et&&Oe[Ne-1]!==et?[]:xa(Oe,et);if(Ne-=Vt.length,Ne<T)return Ee(p,b,Vv,ie.placeholder,t,Oe,Vt,t,t,T-Ne);var rn=this&&this!==fc&&this instanceof ie?z:p;return Jc(rn,this,Oe)}return ie}function cg(p){return function(b,T,z){var ie=ho(b);if(!qr(b)){var Ne=ln(T,3);b=Nf(b),T=function(ct){return Ne(ie[ct],ct,ie)}}var Oe=p(b,T,z);return Oe>-1?ie[Ne?b[Oe]:Oe]:t}}function ug(p){return Ks(function(b){var T=b.length,z=T,ie=Ep.prototype.thru;for(p&&b.reverse();z--;){var Ne=b[z];if(typeof Ne!="function")throw new Mi(a);if(ie&&!Oe&&Kn(Ne)=="wrapper")var Oe=new Ep([],!0)}for(z=Oe?z:T;++z<T;){Ne=b[z];var ct=Kn(Ne),et=ct=="wrapper"?Tn(Ne):t;et&&gi(et[0])&&et[1]==($|A|F|L)&&!et[4].length&&et[9]==1?Oe=Oe[Kn(et[0])].apply(Oe,et[3]):Oe=Ne.length==1&&gi(Ne)?Oe[ct]():Oe.thru(Ne)}return function(){var Vt=arguments,rn=Vt[0];if(Oe&&Vt.length==1&&Uo(rn))return Oe.plant(rn).value();for(var kn=0,Is=T?b[kn].apply(this,Vt):rn;++kn<T;)Is=b[kn].call(this,Is);return Is}})}function Vv(p,b,T,z,ie,Ne,Oe,ct,et,Vt){var rn=b&$,kn=b&C,Is=b&P,Sn=b&(A|M),Ao=b&O,Io=Is?t:Im(p);function go(){for(var so=arguments.length,es=en(so),bo=so;bo--;)es[bo]=arguments[bo];if(Sn)var Ir=os(go),Ja=Un(es,Ir);if(z&&(es=jv(es,z,ie,Sn)),Ne&&(es=Bv(es,Ne,Oe,Sn)),so-=Ja,Sn&&so<Vt){var zl=xa(es,Ir);return Ee(p,b,Vv,go.placeholder,T,es,zl,ct,et,Vt-so)}var Kc=kn?T:this,bu=Is?Kc[p]:p;return so=es.length,ct?es=jp(es,ct):Ao&&so>1&&es.reverse(),rn&&et<so&&(es.length=et),this&&this!==fc&&this instanceof go&&(bu=Io||Im(bu)),bu.apply(Kc,es)}return go}function dg(p,b){return function(T,z){return zm(T,p,b(z),{})}}function fg(p,b){return function(T,z){var ie;if(T===t&&z===t)return b;if(T!==t&&(ie=T),z!==t){if(ie===t)return z;typeof T=="string"||typeof z=="string"?(T=kp(T),z=kp(z)):(T=Ev(T),z=Ev(z)),ie=p(T,z)}return ie}}function S(p){return Ks(function(b){return b=Mc(b,Re(ln())),Vl(function(T){var z=this;return p(b,function(ie){return Jc(ie,z,T)})})})}function R(p,b){b=b===t?" ":kp(b);var T=b.length;if(T<2)return T?Gm(b,p):b;var z=Gm(b,Vc(p/We(b)));return no(b)?Sm(xt(z),0,p).join(""):z.slice(0,p)}function X(p,b,T,z){var ie=b&C,Ne=Im(p);function Oe(){for(var ct=-1,et=arguments.length,Vt=-1,rn=z.length,kn=en(rn+et),Is=this&&this!==fc&&this instanceof Oe?Ne:p;++Vt<rn;)kn[Vt]=z[Vt];for(;et--;)kn[Vt++]=arguments[++ct];return Jc(Is,ie?T:this,kn)}return Oe}function ae(p){return function(b,T,z){return z&&typeof z!="number"&&jo(b,T,z)&&(T=z=t),b=Yc(b),T===t?(T=b,b=0):T=Yc(T),z=z===t?b<T?1:-1:Yc(z),yh(b,T,z,p)}}function ne(p){return function(b,T){return typeof b=="string"&&typeof T=="string"||(b=dd(b),T=dd(T)),p(b,T)}}function Ee(p,b,T,z,ie,Ne,Oe,ct,et,Vt){var rn=b&A,kn=rn?Oe:t,Is=rn?t:Oe,Sn=rn?Ne:t,Ao=rn?t:Ne;b|=rn?F:B,b&=~(rn?B:F),b&I||(b&=~(C|P));var Io=[p,b,ie,Sn,kn,Ao,Is,ct,et,Vt],go=T.apply(t,Io);return gi(p)&&Ol(go,Io),go.placeholder=z,Jm(go,p,b)}function je(p){var b=Ko[p];return function(T,z){if(T=dd(T),z=z==null?0:cr(ea(z),292),z&&fa(T)){var ie=(lc(T)+"e").split("e"),Ne=b(ie[0]+"e"+(+ie[1]+z));return ie=(lc(Ne)+"e").split("e"),+(ie[0]+"e"+(+ie[1]-z))}return b(T)}}var dt=iu&&1/ic(new iu([,-0]))[1]==Z?function(p){return new iu(p)}:M_;function At(p){return function(b){var T=an(b);return T==Ze?wo(b):T==ve?ec(b):Ye(b,p(b))}}function Yt(p,b,T,z,ie,Ne,Oe,ct){var et=b&P;if(!et&&typeof p!="function")throw new Mi(a);var Vt=z?z.length:0;if(Vt||(b&=~(F|B),z=ie=t),Oe=Oe===t?Oe:Xr(ea(Oe),0),ct=ct===t?ct:ea(ct),Vt-=ie?ie.length:0,b&B){var rn=z,kn=ie;z=ie=t}var Is=et?t:Tn(p),Sn=[p,b,T,z,ie,rn,kn,Ne,Oe,ct];if(Is&&jl(Sn,Is),p=Sn[0],b=Sn[1],T=Sn[2],z=Sn[3],ie=Sn[4],ct=Sn[9]=Sn[9]===t?et?0:p.length:Xr(Sn[9]-Vt,0),!ct&&b&(A|M)&&(b&=~(A|M)),!b||b==C)var Ao=zv(p,b,T);else b==A||b==M?Ao=Qh(p,b,ct):(b==F||b==(C|F))&&!ie.length?Ao=X(p,b,T,z):Ao=Vv.apply(t,Sn);var Io=Is?bh:Ol;return Jm(Io(Ao,Sn),p,b)}function yn(p,b,T,z){return p===t||pr(p,sl[T])&&!_l.call(z,T)?b:p}function Wt(p,b,T,z,ie,Ne){return Qs(p)&&Qs(b)&&(Ne.set(b,p),gh(p,b,t,Wt,Ne),Ne.delete(b)),p}function zn(p){return Gl(p)?t:p}function Pn(p,b,T,z,ie,Ne){var Oe=T&g,ct=p.length,et=b.length;if(ct!=et&&!(Oe&&et>ct))return!1;var Vt=Ne.get(p),rn=Ne.get(b);if(Vt&&rn)return Vt==b&&rn==p;var kn=-1,Is=!0,Sn=T&w?new ph:t;for(Ne.set(p,b),Ne.set(b,p);++kn<ct;){var Ao=p[kn],Io=b[kn];if(z)var go=Oe?z(Io,Ao,kn,b,p,Ne):z(Ao,Io,kn,p,b,Ne);if(go!==t){if(go)continue;Is=!1;break}if(Sn){if(!Vf(b,function(so,es){if(!pt(Sn,es)&&(Ao===so||ie(Ao,so,T,z,Ne)))return Sn.push(es)})){Is=!1;break}}else if(!(Ao===Io||ie(Ao,Io,T,z,Ne))){Is=!1;break}}return Ne.delete(p),Ne.delete(b),Is}function as(p,b,T,z,ie,Ne,Oe){switch(T){case qn:if(p.byteLength!=b.byteLength||p.byteOffset!=b.byteOffset)return!1;p=p.buffer,b=b.buffer;case hn:return!(p.byteLength!=b.byteLength||!Ne(new St(p),new St(b)));case bt:case Pt:case Xe:return pr(+p,+b);case Mt:return p.name==b.name&&p.message==b.message;case ot:case Ie:return p==b+"";case Ze:var ct=wo;case ve:var et=z&g;if(ct||(ct=ic),p.size!=b.size&&!et)return!1;var Vt=Oe.get(p);if(Vt)return Vt==b;z|=w,Oe.set(p,b);var rn=Pn(ct(p),ct(b),z,ie,Ne,Oe);return Oe.delete(p),rn;case It:if(om)return om.call(p)==om.call(b)}return!1}function Cs(p,b,T,z,ie,Ne){var Oe=T&g,ct=jn(p),et=ct.length,Vt=jn(b),rn=Vt.length;if(et!=rn&&!Oe)return!1;for(var kn=et;kn--;){var Is=ct[kn];if(!(Oe?Is in b:_l.call(b,Is)))return!1}var Sn=Ne.get(p),Ao=Ne.get(b);if(Sn&&Ao)return Sn==b&&Ao==p;var Io=!0;Ne.set(p,b),Ne.set(b,p);for(var go=Oe;++kn<et;){Is=ct[kn];var so=p[Is],es=b[Is];if(z)var bo=Oe?z(es,so,Is,b,p,Ne):z(so,es,Is,p,b,Ne);if(!(bo===t?so===es||ie(so,es,T,z,Ne):bo)){Io=!1;break}go||(go=Is=="constructor")}if(Io&&!go){var Ir=p.constructor,Ja=b.constructor;Ir!=Ja&&"constructor"in p&&"constructor"in b&&!(typeof Ir=="function"&&Ir instanceof Ir&&typeof Ja=="function"&&Ja instanceof Ja)&&(Io=!1)}return Ne.delete(p),Ne.delete(b),Io}function Ks(p){return of(cd(p,t,Mm),p+"")}function jn(p){return Hu(p,Nf,ls)}function Xt(p){return Hu(p,Qu,on)}var Tn=pc?function(p){return pc.get(p)}:M_;function Kn(p){for(var b=p.name+"",T=Wc[b],z=_l.call(Wc,b)?T.length:0;z--;){var ie=T[z],Ne=ie.func;if(Ne==null||Ne==p)return ie.name}return b}function os(p){var b=_l.call(it,"placeholder")?it:p;return b.placeholder}function ln(){var p=it.iteratee||nh;return p=p===nh?xm:p,arguments.length?p(arguments[0],arguments[1]):p}function ms(p,b){var T=p.__data__;return Vs(b)?T[typeof b=="string"?"string":"hash"]:T.map}function Ns(p){for(var b=Nf(p),T=b.length;T--;){var z=b[T],ie=p[z];b[T]=[z,ie,tu(ie)]}return b}function cn(p,b){var T=Pi(p,b);return Vm(T)?T:t}function Gn(p){var b=_l.call(p,ro),T=p[ro];try{p[ro]=t;var z=!0}catch{}var ie=Qc.call(p);return z&&(b?p[ro]=T:delete p[ro]),ie}var ls=Ac?function(p){return p==null?[]:(p=ho(p),ad(Ac(p),function(b){return Fs.call(p,b)}))}:N_,on=Ac?function(p){for(var b=[];p;)Tu(b,ls(p)),p=Cn(p);return b}:N_,an=ld;(kr&&an(new kr(new ArrayBuffer(1)))!=qn||Sr&&an(new Sr)!=Ze||Lu&&an(Lu.resolve())!=gt||iu&&an(new iu)!=ve||bd&&an(new bd)!=Zt)&&(an=function(p){var b=ld(p),T=b==Qe?p.constructor:t,z=T?Pm(T):"";if(z)switch(z){case Od:return qn;case Zu:return Ze;case ff:return gt;case xd:return ve;case Wf:return Zt}return b});function wn(p,b,T){for(var z=-1,ie=T.length;++z<ie;){var Ne=T[z],Oe=Ne.size;switch(Ne.type){case"drop":p+=Oe;break;case"dropRight":b-=Oe;break;case"take":b=cr(b,p+Oe);break;case"takeRight":p=Xr(p,b-Oe);break}}return{start:p,end:b}}function ds(p){var b=p.match(rd);return b?b[1].split(uf):[]}function Wn(p,b,T){b=Rp(b,p);for(var z=-1,ie=b.length,Ne=!1;++z<ie;){var Oe=kf(b[z]);if(!(Ne=p!=null&&T(p,Oe)))break;p=p[Oe]}return Ne||++z!=ie?Ne:(ie=p==null?0:p.length,!!ie&&xi(ie)&&No(Oe,ie)&&(Uo(p)||Sa(p)))}function yo(p){var b=p.length,T=new p.constructor(b);return b&&typeof p[0]=="string"&&_l.call(p,"index")&&(T.index=p.index,T.input=p.input),T}function Si(p){return typeof p.constructor=="function"&&!ac(p)?gv(Cn(p)):{}}function is(p,b,T){var z=p.constructor;switch(b){case hn:return Rv(p);case bt:case Pt:return new z(+p);case qn:return wf(p,T);case On:case bn:case Fn:case Xs:case oo:case Yn:case _o:case xs:case Rt:return eu(p,T);case Ze:return new z;case Xe:case Ie:return new z(p);case ot:return sc(p);case ve:return new z;case It:return ru(p)}}function To(p,b){var T=b.length;if(!T)return p;var z=T-1;return b[z]=(T>1?"& ":"")+b[z],b=b.join(T>2?", ":" "),p.replace(Bc,`{
/* [wrapped with `+b+`] */
`)}function gs(p){return Uo(p)||Sa(p)||!!(Co&&p&&p[Co])}function No(p,b){var T=typeof p;return b=b??xe,!!b&&(T=="number"||T!="symbol"&&Iu.test(p))&&p>-1&&p%1==0&&p<b}function jo(p,b,T){if(!Qs(T))return!1;var z=typeof b;return(z=="number"?qr(T)&&No(b,T.length):z=="string"&&b in T)?pr(T[b],p):!1}function co(p,b){if(Uo(p))return!1;var T=typeof p;return T=="number"||T=="symbol"||T=="boolean"||p==null||Gc(p)?!0:uc.test(p)||!Cu.test(p)||b!=null&&p in ho(b)}function Vs(p){var b=typeof p;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?p!=="__proto__":p===null}function gi(p){var b=Kn(p),T=it[b];if(typeof T!="function"||!(b in ku.prototype))return!1;if(p===T)return!0;var z=Tn(T);return!!z&&p===z[0]}function Hc(p){return!!rc&&rc in p}var xc=fo?Ur:A_;function ac(p){var b=p&&p.constructor,T=typeof b=="function"&&b.prototype||sl;return p===T}function tu(p){return p===p&&!Qs(p)}function _c(p,b){return function(T){return T==null?!1:T[p]===b&&(b!==t||p in ho(T))}}function qc(p){var b=ha(p,function(z){return T.size===f&&T.clear(),z}),T=b.cache;return b}function jl(p,b){var T=p[1],z=b[1],ie=T|z,Ne=ie<(C|P|$),Oe=z==$&&T==A||z==$&&T==L&&p[7].length<=b[8]||z==($|L)&&b[7].length<=b[8]&&T==A;if(!(Ne||Oe))return p;z&C&&(p[2]=b[2],ie|=T&C?0:I);var ct=b[3];if(ct){var et=p[3];p[3]=et?jv(et,ct,b[4]):ct,p[4]=et?xa(p[3],u):b[4]}return ct=b[5],ct&&(et=p[5],p[5]=et?Bv(et,ct,b[6]):ct,p[6]=et?xa(p[5],u):b[6]),ct=b[7],ct&&(p[7]=ct),z&$&&(p[8]=p[8]==null?b[8]:cr(p[8],b[8])),p[9]==null&&(p[9]=b[9]),p[0]=b[0],p[1]=ie,p}function Bl(p){var b=[];if(p!=null)for(var T in ho(p))b.push(T);return b}function _u(p){return Qc.call(p)}function cd(p,b,T){return b=Xr(b===t?p.length-1:b,0),function(){for(var z=arguments,ie=-1,Ne=Xr(z.length-b,0),Oe=en(Ne);++ie<Ne;)Oe[ie]=z[b+ie];ie=-1;for(var ct=en(b+1);++ie<b;)ct[ie]=z[ie];return ct[b]=T(Oe),Jc(p,this,ct)}}function ql(p,b){return b.length<2?p:nc(p,Dp(b,0,-1))}function jp(p,b){for(var T=p.length,z=cr(b.length,T),ie=ip(p);z--;){var Ne=b[z];p[z]=No(Ne,T)?ie[Ne]:t}return p}function Uc(p,b){if(!(b==="constructor"&&typeof p[b]=="function")&&b!="__proto__")return p[b]}var Ol=fv(bh),au=Hl||function(p,b){return fc.setTimeout(p,b)},of=fv(cv);function Jm(p,b,T){var z=b+"";return of(p,To(z,dm(ds(z),T)))}function fv(p){var b=0,T=0;return function(){var z=us(),ie=le-(z-T);if(T=z,ie>0){if(++b>=Q)return arguments[0]}else b=0;return p.apply(t,arguments)}}function Df(p,b){var T=-1,z=p.length,ie=z-1;for(b=b===t?z:b;++T<b;){var Ne=lm(T,ie),Oe=p[Ne];p[Ne]=p[T],p[T]=Oe}return p.length=b,p}var Bh=qc(function(p){var b=[];return p.charCodeAt(0)===46&&b.push(""),p.replace(Fl,function(T,z,ie,Ne){b.push(ie?Ne.replace(ya,"$1"):z||T)}),b});function kf(p){if(typeof p=="string"||Gc(p))return p;var b=p+"";return b=="0"&&1/p==-Z?"-0":b}function Pm(p){if(p!=null){try{return wu.call(p)}catch{}try{return p+""}catch{}}return""}function dm(p,b){return jd(qe,function(T){var z="_."+T[0];b&T[1]&&!yd(p,z)&&p.push(z)}),p.sort()}function Pg(p){if(p instanceof ku)return p.clone();var b=new Ep(p.__wrapped__,p.__chain__);return b.__actions__=ip(p.__actions__),b.__index__=p.__index__,b.__values__=p.__values__,b}function pf(p,b,T){(T?jo(p,b,T):b===t)?b=1:b=Xr(ea(b),0);var z=p==null?0:p.length;if(!z||b<1)return[];for(var ie=0,Ne=0,Oe=en(Vc(z/b));ie<z;)Oe[Ne++]=Dp(p,ie,ie+=b);return Oe}function wc(p){for(var b=-1,T=p==null?0:p.length,z=0,ie=[];++b<T;){var Ne=p[b];Ne&&(ie[z++]=Ne)}return ie}function xr(){var p=arguments.length;if(!p)return[];for(var b=en(p-1),T=arguments[0],z=p;z--;)b[z-1]=arguments[z];return Tu(Uo(T)?ip(T):[T],$u(b,1))}var Qd=Vl(function(p,b){return Ri(p)?Cl(p,$u(b,1,Ri,!0)):[]}),xp=Vl(function(p,b){var T=$t(b);return Ri(T)&&(T=t),Ri(p)?Cl(p,$u(b,1,Ri,!0),ln(T,2)):[]}),Qm=Vl(function(p,b){var T=$t(b);return Ri(T)&&(T=t),Ri(p)?Cl(p,$u(b,1,Ri,!0),t,T):[]});function Oh(p,b,T){var z=p==null?0:p.length;return z?(b=T||b===t?1:ea(b),Dp(p,b<0?0:b,z)):[]}function Pp(p,b,T){var z=p==null?0:p.length;return z?(b=T||b===t?1:ea(b),b=z-b,Dp(p,0,b<0?0:b)):[]}function pv(p,b){return p&&p.length?Km(p,ln(b,3),!0,!0):[]}function Mg(p,b){return p&&p.length?Km(p,ln(b,3),!0):[]}function Ng(p,b,T,z){var ie=p==null?0:p.length;return ie?(T&&typeof T!="number"&&jo(p,b,T)&&(T=0,z=ie),wd(p,b,T,z)):[]}function Ag(p,b,T){var z=p==null?0:p.length;if(!z)return-1;var ie=T==null?0:ea(T);return ie<0&&(ie=Xr(z+ie,0)),we(p,ln(b,3),ie)}function pg(p,b,T){var z=p==null?0:p.length;if(!z)return-1;var ie=z-1;return T!==t&&(ie=ea(T),ie=T<0?Xr(z+ie,0):cr(ie,z-1)),we(p,ln(b,3),ie,!0)}function Mm(p){var b=p==null?0:p.length;return b?$u(p,1):[]}function mg(p){var b=p==null?0:p.length;return b?$u(p,Z):[]}function Tg(p,b){var T=p==null?0:p.length;return T?(b=b===t?1:ea(b),$u(p,b)):[]}function kv(p){for(var b=-1,T=p==null?0:p.length,z={};++b<T;){var ie=p[b];z[ie[0]]=ie[1]}return z}function eh(p){return p&&p.length?p[0]:t}function nr(p,b,T){var z=p==null?0:p.length;if(!z)return-1;var ie=T==null?0:ea(T);return ie<0&&(ie=Xr(z+ie,0)),J(p,b,ie)}function Hr(p){var b=p==null?0:p.length;return b?Dp(p,0,-1):[]}var nu=Vl(function(p){var b=Mc(p,bv);return b.length&&b[0]===p[0]?Qi(b):[]}),Sd=Vl(function(p){var b=$t(p),T=Mc(p,bv);return b===$t(T)?b=t:T.pop(),T.length&&T[0]===p[0]?Qi(T,ln(b,2)):[]}),Rf=Vl(function(p){var b=$t(p),T=Mc(p,bv);return b=typeof b=="function"?b:t,b&&T.pop(),T.length&&T[0]===p[0]?Qi(T,t,b):[]});function Ud(p,b){return p==null?"":Dl.call(p,b)}function $t(p){var b=p==null?0:p.length;return b?p[b-1]:t}function Gs(p,b,T){var z=p==null?0:p.length;if(!z)return-1;var ie=z;return T!==t&&(ie=ea(T),ie=ie<0?Xr(z+ie,0):cr(ie,z-1)),b===b?_e(p,b,ie):we(p,yt,ie,!0)}function Zo(p,b){return p&&p.length?Du(p,ea(b)):t}var Bo=Vl(ka);function ka(p,b){return p&&p.length&&b&&b.length?$f(p,b):p}function Ru(p,b,T){return p&&p.length&&b&&b.length?$f(p,b,ln(T,2)):p}function Vo(p,b,T){return p&&p.length&&b&&b.length?$f(p,b,t,T):p}var il=Ks(function(p,b){var T=p==null?0:p.length,z=Xo(p,b);return wm(p,Mc(b,function(ie){return No(ie,T)?+ie:ie}).sort(Dh)),z});function Ya(p,b){var T=[];if(!(p&&p.length))return T;var z=-1,ie=[],Ne=p.length;for(b=ln(b,3);++z<Ne;){var Oe=p[z];b(Oe,z,p)&&(T.push(Oe),ie.push(z))}return wm(p,ie),T}function Zl(p){return p==null?p:Pr.call(p)}function oi(p,b,T){var z=p==null?0:p.length;return z?(T&&typeof T!="number"&&jo(p,b,T)?(b=0,T=z):(b=b==null?0:ea(b),T=T===t?z:ea(T)),Dp(p,b,T)):[]}function Ys(p,b){return op(p,b)}function Er(p,b,T){return Xh(p,b,ln(T,2))}function Hn(p,b){var T=p==null?0:p.length;if(T){var z=op(p,b);if(z<T&&pr(p[z],b))return z}return-1}function Mn(p,b){return op(p,b,!0)}function Do(p,b,T){return Xh(p,b,ln(T,2),!0)}function Jr(p,b){var T=p==null?0:p.length;if(T){var z=op(p,b,!0)-1;if(pr(p[z],b))return z}return-1}function Mr(p){return p&&p.length?Zh(p):[]}function vr(p,b){return p&&p.length?Zh(p,ln(b,2)):[]}function Il(p){var b=p==null?0:p.length;return b?Dp(p,1,b):[]}function mi(p,b,T){return p&&p.length?(b=T||b===t?1:ea(b),Dp(p,0,b<0?0:b)):[]}function Xi(p,b,T){var z=p==null?0:p.length;return z?(b=T||b===t?1:ea(b),b=z-b,Dp(p,b<0?0:b,z)):[]}function k(p,b){return p&&p.length?Km(p,ln(b,3),!1,!0):[]}function N(p,b){return p&&p.length?Km(p,ln(b,3)):[]}var j=Vl(function(p){return bp($u(p,1,Ri,!0))}),D=Vl(function(p){var b=$t(p);return Ri(b)&&(b=t),bp($u(p,1,Ri,!0),ln(b,2))}),W=Vl(function(p){var b=$t(p);return b=typeof b=="function"?b:t,bp($u(p,1,Ri,!0),t,b)});function H(p){return p&&p.length?bp(p):[]}function he(p,b){return p&&p.length?bp(p,ln(b,2)):[]}function Le(p,b){return b=typeof b=="function"?b:t,p&&p.length?bp(p,t,b):[]}function st(p){if(!(p&&p.length))return[];var b=0;return p=ad(p,function(T){if(Ri(T))return b=Xr(T.length,b),!0}),Ve(b,function(T){return Mc(p,jt(T))})}function Jt(p,b){if(!(p&&p.length))return[];var T=st(p);return b==null?T:Mc(T,function(z){return Jc(b,t,z)})}var fs=Vl(function(p,b){return Ri(p)?Cl(p,b):[]}),ts=Vl(function(p){return Jh(ad(p,Ri))}),Bn=Vl(function(p){var b=$t(p);return Ri(b)&&(b=t),Jh(ad(p,Ri),ln(b,2))}),ti=Vl(function(p){var b=$t(p);return b=typeof b=="function"?b:t,Jh(ad(p,Ri),t,b)}),ci=Vl(st);function lu(p,b){return ag(p||[],b||[],_n)}function Cd(p,b){return ag(p||[],b||[],cm)}var Sf=Vl(function(p){var b=p.length,T=b>1?p[b-1]:t;return T=typeof T=="function"?(p.pop(),T):t,Jt(p,T)});function rf(p){var b=it(p);return b.__chain__=!0,b}function rp(p,b){return b(p),p}function ef(p,b){return b(p)}var Cf=Ks(function(p){var b=p.length,T=b?p[0]:0,z=this.__wrapped__,ie=function(Ne){return Xo(Ne,p)};return b>1||this.__actions__.length||!(z instanceof ku)||!No(T)?this.thru(ie):(z=z.slice(T,+T+(b?1:0)),z.__actions__.push({func:ef,args:[ie],thisArg:t}),new Ep(z,this.__chain__).thru(function(Ne){return b&&!Ne.length&&Ne.push(t),Ne}))});function mf(){return rf(this)}function Id(){return new Ep(this.value(),this.__chain__)}function If(){this.__values__===t&&(this.__values__=Su(this.value()));var p=this.__index__>=this.__values__.length,b=p?t:this.__values__[this.__index__++];return{done:p,value:b}}function jf(){return this}function sa(p){for(var b,T=this;T instanceof Nv;){var z=Pg(T);z.__index__=0,z.__values__=t,b?ie.__wrapped__=z:b=z;var ie=z;T=T.__wrapped__}return ie.__wrapped__=p,b}function wi(){var p=this.__wrapped__;if(p instanceof ku){var b=p;return this.__actions__.length&&(b=new ku(this)),b=b.reverse(),b.__actions__.push({func:ef,args:[Zl],thisArg:t}),new Ep(b,this.__chain__)}return this.thru(Zl)}function pa(){return uv(this.__wrapped__,this.__actions__)}var er=Rh(function(p,b,T){_l.call(p,T)?++p[T]:Os(p,T,1)});function Da(p,b,T){var z=Uo(p)?sf:Ad;return T&&jo(p,b,T)&&(b=t),z(p,ln(b,3))}function cu(p,b){var T=Uo(p)?ad:Xp;return T(p,ln(b,3))}var Va=cg(Ag),ju=cg(pg);function Bu(p,b){return $u(_s(p,b),1)}function oa(p,b){return $u(_s(p,b),Z)}function Ul(p,b,T){return T=T===t?1:ea(T),$u(_s(p,b),T)}function ud(p,b){var T=Uo(p)?jd:Rl;return T(p,ln(b,3))}function dl(p,b){var T=Uo(p)?Wu:tc;return T(p,ln(b,3))}var U=Rh(function(p,b,T){_l.call(p,T)?p[T].push(b):Os(p,T,[b])});function Kt(p,b,T,z){p=qr(p)?p:Ls(p),T=T&&!z?ea(T):0;var ie=p.length;return T<0&&(T=Xr(ie+T,0)),du(p)?T<=ie&&p.indexOf(b,T)>-1:!!ie&&J(p,b,T)>-1}var bs=Vl(function(p,b,T){var z=-1,ie=typeof b=="function",Ne=qr(p)?en(p.length):[];return Rl(p,function(Oe){Ne[++z]=ie?Jc(b,Oe,T):sp(Oe,b,T)}),Ne}),Ds=Rh(function(p,b,T){Os(p,T,b)});function _s(p,b){var T=Uo(p)?Mc:lv;return T(p,ln(b,3))}function zi(p,b,T,z){return p==null?[]:(Uo(b)||(b=b==null?[]:[b]),T=z?t:T,Uo(T)||(T=T==null?[]:[T]),$p(p,b,T))}var ii=Rh(function(p,b,T){p[T?0:1].push(b)},function(){return[[],[]]});function ia(p,b,T){var z=Uo(p)?qd:E,ie=arguments.length<3;return z(p,ln(b,4),T,ie,Rl)}function $r(p,b,T){var z=Uo(p)?Xf:E,ie=arguments.length<3;return z(p,ln(b,4),T,ie,tc)}function rr(p,b){var T=Uo(p)?ad:Xp;return T(p,Dr(ln(b,3)))}function Jl(p){var b=Uo(p)?He:km;return b(p)}function Wa(p,b,T){(T?jo(p,b,T):b===t)?b=1:b=ea(b);var z=Uo(p)?rt:Ym;return z(p,b)}function Ci(p){var b=Uo(p)?Qt:ig;return b(p)}function Ha(p){if(p==null)return 0;if(qr(p))return du(p)?We(p):p.length;var b=an(p);return b==Ze||b==ve?p.size:Hm(p).length}function ki(p,b,T){var z=Uo(p)?Vf:yv;return T&&jo(p,b,T)&&(b=t),z(p,ln(b,3))}var ys=Vl(function(p,b){if(p==null)return[];var T=b.length;return T>1&&jo(p,b[0],b[1])?b=[]:T>2&&jo(b[0],b[1],b[2])&&(b=[b[0]]),$p(p,$u(b,1),[])}),tr=Ji||function(){return fc.Date.now()};function Fo(p,b){if(typeof b!="function")throw new Mi(a);return p=ea(p),function(){if(--p<1)return b.apply(this,arguments)}}function Lo(p,b,T){return b=T?t:b,b=p&&b==null?p.length:b,Yt(p,$,t,t,t,t,b)}function Gi(p,b){var T;if(typeof b!="function")throw new Mi(a);return p=ea(p),function(){return--p>0&&(T=b.apply(this,arguments)),p<=1&&(b=t),T}}var Nr=Vl(function(p,b,T){var z=C;if(T.length){var ie=xa(T,os(Nr));z|=F}return Yt(p,z,b,T,ie)}),Vi=Vl(function(p,b,T){var z=C|P;if(T.length){var ie=xa(T,os(Vi));z|=F}return Yt(b,z,p,T,ie)});function Ho(p,b,T){b=T?t:b;var z=Yt(p,A,t,t,t,t,t,b);return z.placeholder=Ho.placeholder,z}function Ar(p,b,T){b=T?t:b;var z=Yt(p,M,t,t,t,t,t,b);return z.placeholder=Ar.placeholder,z}function ma(p,b,T){var z,ie,Ne,Oe,ct,et,Vt=0,rn=!1,kn=!1,Is=!0;if(typeof p!="function")throw new Mi(a);b=dd(b)||0,Qs(T)&&(rn=!!T.leading,kn="maxWait"in T,Ne=kn?Xr(dd(T.maxWait)||0,b):Ne,Is="trailing"in T?!!T.trailing:Is);function Sn(zl){var Kc=z,bu=ie;return z=ie=t,Vt=zl,Oe=p.apply(bu,Kc),Oe}function Ao(zl){return Vt=zl,ct=au(so,b),rn?Sn(zl):Oe}function Io(zl){var Kc=zl-et,bu=zl-Vt,oc=b-Kc;return kn?cr(oc,Ne-bu):oc}function go(zl){var Kc=zl-et,bu=zl-Vt;return et===t||Kc>=b||Kc<0||kn&&bu>=Ne}function so(){var zl=tr();if(go(zl))return es(zl);ct=au(so,Io(zl))}function es(zl){return ct=t,Is&&z?Sn(zl):(z=ie=t,Oe)}function bo(){ct!==t&&Dv(ct),Vt=0,z=et=ie=ct=t}function Ir(){return ct===t?Oe:es(tr())}function Ja(){var zl=tr(),Kc=go(zl);if(z=arguments,ie=this,et=zl,Kc){if(ct===t)return Ao(et);if(kn)return Dv(ct),ct=au(so,b),Sn(et)}return ct===t&&(ct=au(so,b)),Oe}return Ja.cancel=bo,Ja.flush=Ir,Ja}var rl=Vl(function(p,b){return yl(p,1,b)}),Cr=Vl(function(p,b,T){return yl(p,dd(b)||0,T)});function Yi(p){return Yt(p,O)}function ha(p,b){if(typeof p!="function"||b!=null&&typeof b!="function")throw new Mi(a);var T=function(){var z=arguments,ie=b?b.apply(this,z):z[0],Ne=T.cache;if(Ne.has(ie))return Ne.get(ie);var Oe=p.apply(this,z);return T.cache=Ne.set(ie,Oe)||Ne,Oe};return T.cache=new(ha.Cache||fh),T}ha.Cache=fh;function Dr(p){if(typeof p!="function")throw new Mi(a);return function(){var b=arguments;switch(b.length){case 0:return!p.call(this);case 1:return!p.call(this,b[0]);case 2:return!p.call(this,b[0],b[1]);case 3:return!p.call(this,b[0],b[1],b[2])}return!p.apply(this,b)}}function va(p){return Gi(2,p)}var al=lg(function(p,b){b=b.length==1&&Uo(b[0])?Mc(b[0],Re(ln())):Mc($u(b,1),Re(ln()));var T=b.length;return Vl(function(z){for(var ie=-1,Ne=cr(z.length,T);++ie<Ne;)z[ie]=b[ie].call(this,z[ie]);return Jc(p,this,z)})}),ns=Vl(function(p,b){var T=xa(b,os(ns));return Yt(p,F,t,b,T)}),zs=Vl(function(p,b){var T=xa(b,os(zs));return Yt(p,B,t,b,T)}),Rs=Ks(function(p,b){return Yt(p,L,t,t,t,b)});function Ni(p,b){if(typeof p!="function")throw new Mi(a);return b=b===t?b:ea(b),Vl(p,b)}function Ma(p,b){if(typeof p!="function")throw new Mi(a);return b=b==null?0:Xr(ea(b),0),Vl(function(T){var z=T[b],ie=Sm(T,0,b);return z&&Tu(ie,z),Jc(p,this,ie)})}function ll(p,b,T){var z=!0,ie=!0;if(typeof p!="function")throw new Mi(a);return Qs(T)&&(z="leading"in T?!!T.leading:z,ie="trailing"in T?!!T.trailing:ie),ma(p,b,{leading:z,maxWait:b,trailing:ie})}function ir(p){return Lo(p,1)}function Ai(p,b){return ns(xv(b),p)}function ca(){if(!arguments.length)return[];var p=arguments[0];return Uo(p)?p:[p]}function ui(p){return ao(p,m)}function bi(p,b){return b=typeof b=="function"?b:t,ao(p,m,b)}function ai(p){return ao(p,d|m)}function fi(p,b){return b=typeof b=="function"?b:t,ao(p,d|m,b)}function ra(p,b){return b==null||$a(p,b,Nf(b))}function pr(p,b){return p===b||p!==p&&b!==b}var Ti=ne(mp),Di=ne(function(p,b){return p>=b}),Sa=ym(function(){return arguments}())?ym:function(p){return ji(p)&&_l.call(p,"callee")&&!Fs.call(p,"callee")},Uo=en.isArray,ga=Ku?Re(Ku):vh;function qr(p){return p!=null&&xi(p.length)&&!Ur(p)}function Ri(p){return ji(p)&&qr(p)}function Ka(p){return p===!0||p===!1||ji(p)&&ld(p)==bt}var Jo=br||A_,Ki=bf?Re(bf):Zp;function ua(p){return ji(p)&&p.nodeType===1&&!Gl(p)}function Qr(p){if(p==null)return!0;if(qr(p)&&(Uo(p)||typeof p=="string"||typeof p.splice=="function"||Jo(p)||bl(p)||Sa(p)))return!p.length;var b=an(p);if(b==Ze||b==ve)return!p.size;if(ac(p))return!Hm(p).length;for(var T in p)if(_l.call(p,T))return!1;return!0}function ar(p,b){return Jp(p,b)}function _a(p,b,T){T=typeof T=="function"?T:t;var z=T?T(p,b):t;return z===t?Jp(p,b,t,T):!!z}function Pl(p){if(!ji(p))return!1;var b=ld(p);return b==Mt||b==Et||typeof p.message=="string"&&typeof p.name=="string"&&!Gl(p)}function gr(p){return typeof p=="number"&&fa(p)}function Ur(p){if(!Qs(p))return!1;var b=ld(p);return b==Je||b==Ct||b==ut||b==Ft}function Ra(p){return typeof p=="number"&&p==ea(p)}function xi(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=xe}function Qs(p){var b=typeof p;return p!=null&&(b=="object"||b=="function")}function ji(p){return p!=null&&typeof p=="object"}var qa=Xu?Re(Xu):Eh;function _i(p,b){return p===b||Hf(p,b,Ns(b))}function da(p,b,T){return T=typeof T=="function"?T:t,Hf(p,b,Ns(b),T)}function dr(p){return Nl(p)&&p!=+p}function fl(p){if(xc(p))throw new ps(r);return Vm(p)}function kc(p){return p===null}function Ml(p){return p==null}function Nl(p){return typeof p=="number"||ji(p)&&ld(p)==Xe}function Gl(p){if(!ji(p)||ld(p)!=Qe)return!1;var b=Cn(p);if(b===null)return!0;var T=_l.call(b,"constructor")&&b.constructor;return typeof T=="function"&&T instanceof T&&wu.call(T)==na}var uu=Ql?Re(Ql):Wm;function Sc(p){return Ra(p)&&p>=-xe&&p<=xe}var Cc=Hd?Re(Hd):Yh;function du(p){return typeof p=="string"||!Uo(p)&&ji(p)&&ld(p)==Ie}function Gc(p){return typeof p=="symbol"||ji(p)&&ld(p)==It}var bl=hu?Re(hu):rm;function fu(p){return p===t}function Pd(p){return ji(p)&&an(p)==Zt}function hf(p){return ji(p)&&ld(p)==gn}var yu=ne(zd),Bf=ne(function(p,b){return p<=b});function Su(p){if(!p)return[];if(qr(p))return du(p)?xt(p):ip(p);if(li&&p[li])return Ms(p[li]());var b=an(p),T=b==Ze?wo:b==ve?ic:Ls;return T(p)}function Yc(p){if(!p)return p===0?p:0;if(p=dd(p),p===Z||p===-Z){var b=p<0?-1:1;return b*oe}return p===p?p:0}function ea(p){var b=Yc(p),T=b%1;return b===b?T?b-T:b:0}function qf(p){return p?Ei(ea(p),0,$e):0}function dd(p){if(typeof p=="number")return p;if(Gc(p))return Pe;if(Qs(p)){var b=typeof p.valueOf=="function"?p.valueOf():p;p=Qs(b)?b+"":b}if(typeof p!="string")return p===0?p:+p;p=at(p);var T=el.test(p);return T||Vu.test(p)?Kf(p.slice(2),T?2:8):Yr.test(p)?Pe:+p}function pl(p){return um(p,Qu(p))}function vf(p){return p?Ei(ea(p),-xe,xe):p===0?p:0}function lc(p){return p==null?"":kp(p)}var Pf=Cm(function(p,b){if(ac(b)||qr(b)){um(b,Nf(b),p);return}for(var T in b)_l.call(b,T)&&_n(p,T,b[T])}),Gd=Cm(function(p,b){um(b,Qu(b),p)}),af=Cm(function(p,b,T,z){um(b,Qu(b),p,z)}),fd=Cm(function(p,b,T,z){um(b,Nf(b),p,z)}),Td=Ks(Xo);function vp(p,b){var T=gv(p);return b==null?T:Js(T,b)}var Xa=Vl(function(p,b){p=ho(p);var T=-1,z=b.length,ie=z>2?b[2]:t;for(ie&&jo(b[0],b[1],ie)&&(z=1);++T<z;)for(var Ne=b[T],Oe=Qu(Ne),ct=-1,et=Oe.length;++ct<et;){var Vt=Oe[ct],rn=p[Vt];(rn===t||pr(rn,sl[Vt])&&!_l.call(p,Vt))&&(p[Vt]=Ne[Vt])}return p}),Ju=Vl(function(p){return p.push(t,Wt),Jc(te,t,p)});function Bp(p,b){return re(p,ln(b,3),Mo)}function Zf(p,b){return re(p,ln(b,3),$i)}function ap(p,b){return p==null?p:Jd(p,ln(b,3),Qu)}function wp(p,b){return p==null?p:Po(p,ln(b,3),Qu)}function fm(p,b){return p&&Mo(p,ln(b,3))}function Fc(p,b){return p&&$i(p,ln(b,3))}function Mf(p){return p==null?[]:Zr(p,Nf(p))}function Sp(p){return p==null?[]:Zr(p,Qu(p))}function qp(p,b,T){var z=p==null?t:nc(p,b);return z===t?T:z}function Up(p,b){return p!=null&&Wn(p,b,Tc)}function th(p,b){return p!=null&&Wn(p,b,Hp)}var Nm=dg(function(p,b,T){b!=null&&typeof b.toString!="function"&&(b=Qc.call(b)),p[b]=T},$g(Af)),zh=dg(function(p,b,T){b!=null&&typeof b.toString!="function"&&(b=Qc.call(b)),_l.call(p,b)?p[b].push(T):p[b]=[T]},ln),Sv=Vl(sp);function Nf(p){return qr(p)?de(p):Hm(p)}function Qu(p){return qr(p)?de(p,!0):hp(p)}function Op(p,b){var T={};return b=ln(b,3),Mo(p,function(z,ie,Ne){Os(T,b(z,ie,Ne),z)}),T}function Vh(p,b){var T={};return b=ln(b,3),Mo(p,function(z,ie,Ne){Os(T,ie,b(z,ie,Ne))}),T}var pd=Cm(function(p,b,T){gh(p,b,T)}),te=Cm(function(p,b,T,z){gh(p,b,T,z)}),nn=Ks(function(p,b){var T={};if(p==null)return T;var z=!1;b=Mc(b,function(Ne){return Ne=Rp(Ne,p),z||(z=Ne.length>1),Ne}),um(p,Xt(p),T),z&&(T=ao(T,d|h|m,zn));for(var ie=b.length;ie--;)$v(T,b[ie]);return T});function mt(p,b){return Nt(p,Dr(ln(b)))}var pn=Ks(function(p,b){return p==null?{}:_h(p,b)});function Nt(p,b){if(p==null)return{};var T=Mc(Xt(p),function(z){return[z]});return b=ln(b),am(p,T,function(z,ie){return b(z,ie[0])})}function Ps(p,b,T){b=Rp(b,p);var z=-1,ie=b.length;for(ie||(ie=1,p=t);++z<ie;){var Ne=p==null?t:p[kf(b[z])];Ne===t&&(z=ie,Ne=T),p=Ur(Ne)?Ne.call(p):Ne}return p}function Nn(p,b,T){return p==null?p:cm(p,b,T)}function hs(p,b,T,z){return z=typeof z=="function"?z:t,p==null?p:cm(p,b,T,z)}var ss=At(Nf),Ln=At(Qu);function tn(p,b,T){var z=Uo(p),ie=z||Jo(p)||bl(p);if(b=ln(b,4),T==null){var Ne=p&&p.constructor;ie?T=z?new Ne:[]:Qs(p)?T=Ur(Ne)?gv(Cn(p)):{}:T={}}return(ie?jd:Mo)(p,function(Oe,ct,et){return b(T,Oe,ct,et)}),T}function Ws(p,b){return p==null?!0:$v(p,b)}function Hs(p,b,T){return p==null?p:rg(p,b,xv(T))}function As(p,b,T,z){return z=typeof z=="function"?z:t,p==null?p:rg(p,b,xv(T),z)}function Ls(p){return p==null?[]:De(p,Nf(p))}function js(p){return p==null?[]:De(p,Qu(p))}function ks(p,b,T){return T===t&&(T=b,b=t),T!==t&&(T=dd(T),T=T===T?T:0),b!==t&&(b=dd(b),b=b===b?b:0),Ei(dd(p),b,T)}function Jn(p,b,T){return b=Yc(b),T===t?(T=b,b=0):T=Yc(T),p=dd(p),vu(p,b,T)}function En(p,b,T){if(T&&typeof T!="boolean"&&jo(p,b,T)&&(b=T=t),T===t&&(typeof b=="boolean"?(T=b,b=t):typeof p=="boolean"&&(T=p,p=t)),p===t&&b===t?(p=0,b=1):(p=Yc(p),b===t?(b=p,p=0):b=Yc(b)),p>b){var z=p;p=b,b=z}if(T||p%1||b%1){var ie=ur();return cr(p+ie*(b-p+Yf("1e-"+((ie+"").length-1))),b)}return lm(p,b)}var Wi=xh(function(p,b,T){return b=b.toLowerCase(),p+(T?ml(b):b)});function ml(p){return pm(lc(p).toLowerCase())}function Qo(p){return p=lc(p),p&&p.replace(Ro,Zs).replace(tl,"")}function po(p,b,T){p=lc(p),b=kp(b);var z=p.length;T=T===t?z:Ei(ea(T),0,z);var ie=T;return T-=b.length,T>=0&&p.slice(T,ie)==b}function aa(p){return p=lc(p),p&&Qa.test(p)?p.replace(Ia,vs):p}function Za(p){return p=lc(p),p&&nd.test(p)?p.replace(jc,"\\$&"):p}var Lc=xh(function(p,b,T){return p+(T?"-":"")+b.toLowerCase()}),Na=xh(function(p,b,T){return p+(T?" ":"")+b.toLowerCase()}),Jf=wv("toLowerCase");function Rr(p,b,T){p=lc(p),b=ea(b);var z=b?We(p):0;if(!b||z>=b)return p;var ie=(b-z)/2;return R(ol(ie),T)+p+R(Vc(ie),T)}function Go(p,b,T){p=lc(p),b=ea(b);var z=b?We(p):0;return b&&z<b?p+R(b-z,T):p}function Aa(p,b,T){p=lc(p),b=ea(b);var z=b?We(p):0;return b&&z<b?R(b-z,T)+p:p}function jr(p,b,T){return T||b==null?b=0:b&&(b=+b),ko(lc(p).replace(Fa,""),b||0)}function ja(p,b,T){return(T?jo(p,b,T):b===t)?b=1:b=ea(b),Gm(lc(p),b)}function qu(){var p=arguments,b=lc(p[0]);return p.length<3?b:b.replace(p[1],p[2])}var Yd=xh(function(p,b,T){return p+(T?"_":"")+b.toLowerCase()});function Mp(p,b,T){return T&&typeof T!="number"&&jo(p,b,T)&&(b=T=t),T=T===t?$e:T>>>0,T?(p=lc(p),p&&(typeof b=="string"||b!=null&&!uu(b))&&(b=kp(b),!b&&no(p))?Sm(xt(p),0,T):p.split(b,T)):[]}var zp=xh(function(p,b,T){return p+(T?" ":"")+pm(b)});function Kd(p,b,T){return p=lc(p),T=T==null?0:Ei(ea(T),0,p.length),b=kp(b),p.slice(T,T+b.length)==b}function Vp(p,b,T){var z=it.templateSettings;T&&jo(p,b,T)&&(b=t),p=lc(p),b=af({},b,z,yn);var ie=af({},b.imports,z.imports,yn),Ne=Nf(ie),Oe=De(ie,Ne),ct,et,Vt=0,rn=b.interpolate||zr,kn="__p += '",Is=wa((b.escape||zr).source+"|"+rn.source+"|"+(rn===Rc?hc:zr).source+"|"+(b.evaluate||zr).source+"|$","g"),Sn="//# sourceURL="+(_l.call(b,"sourceURL")?(b.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++bc+"]")+`
`;p.replace(Is,function(go,so,es,bo,Ir,Ja){return es||(es=bo),kn+=p.slice(Vt,Ja).replace(kl,Oo),so&&(ct=!0,kn+=`' +
__e(`+so+`) +
'`),Ir&&(et=!0,kn+=`';
`+Ir+`;
__p += '`),es&&(kn+=`' +
((__t = (`+es+`)) == null ? '' : __t) +
'`),Vt=Ja+go.length,go}),kn+=`';
`;var Ao=_l.call(b,"variable")&&b.variable;if(!Ao)kn=`with (obj) {
`+kn+`
}
`;else if(Ll.test(Ao))throw new ps(l);kn=(et?kn.replace(un,""):kn).replace(qs,"$1").replace(ri,"$1;"),kn="function("+(Ao||"obj")+`) {
`+(Ao?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ct?", __e = _.escape":"")+(et?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+kn+`return __p
}`;var Io=Hg(function(){return vo(Ne,Sn+"return "+kn).apply(t,Oe)});if(Io.source=kn,Pl(Io))throw Io;return Io}function Wh(p){return lc(p).toLowerCase()}function Np(p){return lc(p).toUpperCase()}function mv(p,b,T){if(p=lc(p),p&&(T||b===t))return at(p);if(!p||!(b=kp(b)))return p;var z=xt(p),ie=xt(b),Ne=Ge(z,ie),Oe=sn(z,ie)+1;return Sm(z,Ne,Oe).join("")}function wh(p,b,T){if(p=lc(p),p&&(T||b===t))return p.slice(0,Ht(p)+1);if(!p||!(b=kp(b)))return p;var z=xt(p),ie=sn(z,xt(b))+1;return Sm(z,0,ie).join("")}function Qp(p,b,T){if(p=lc(p),p&&(T||b===t))return p.replace(Fa,"");if(!p||!(b=kp(b)))return p;var z=xt(p),ie=Ge(z,xt(b));return Sm(z,ie).join("")}function Ap(p,b){var T=Y,z=ce;if(Qs(b)){var ie="separator"in b?b.separator:ie;T="length"in b?ea(b.length):T,z="omission"in b?kp(b.omission):z}p=lc(p);var Ne=p.length;if(no(p)){var Oe=xt(p);Ne=Oe.length}if(T>=Ne)return p;var ct=T-We(z);if(ct<1)return z;var et=Oe?Sm(Oe,0,ct).join(""):p.slice(0,ct);if(ie===t)return et+z;if(Oe&&(ct+=et.length-ct),uu(ie)){if(p.slice(ct).search(ie)){var Vt,rn=et;for(ie.global||(ie=wa(ie.source,lc(Pa.exec(ie))+"g")),ie.lastIndex=0;Vt=ie.exec(rn);)var kn=Vt.index;et=et.slice(0,kn===t?ct:kn)}}else if(p.indexOf(kp(ie),ct)!=ct){var Is=et.lastIndexOf(ie);Is>-1&&(et=et.slice(0,Is))}return et+z}function Hh(p){return p=lc(p),p&&Lr.test(p)?p.replace(Eo,qt):p}var Am=xh(function(p,b,T){return p+(T?" ":"")+b.toUpperCase()}),pm=wv("toUpperCase");function Fg(p,b,T){return p=lc(p),b=T?t:b,b===t?gl(p)?Ut(p):G(p):p.match(b)||[]}var Hg=Vl(function(p,b){try{return Jc(p,t,b)}catch(T){return Pl(T)?T:new ps(T)}}),Lg=Ks(function(p,b){return jd(b,function(T){T=kf(T),Os(p,T,Nr(p[T],p))}),p});function Eg(p){var b=p==null?0:p.length,T=ln();return p=b?Mc(p,function(z){if(typeof z[1]!="function")throw new Mi(a);return[T(z[0]),z[1]]}):[],Vl(function(z){for(var ie=-1;++ie<b;){var Ne=p[ie];if(Jc(Ne[0],this,z))return Jc(Ne[1],this,z)}})}function i0(p){return za(ao(p,d))}function $g(p){return function(){return p}}function hg(p,b){return p==null||p!==p?b:p}var kh=ug(),C_=ug(!0);function Af(p){return p}function nh(p){return xm(typeof p=="function"?p:ao(p,d))}function qg(p){return Lv(ao(p,d))}function k0(p,b){return qm(p,ao(b,d))}var I_=Vl(function(p,b){return function(T){return sp(T,p,b)}}),Iy=Vl(function(p,b){return function(T){return sp(p,T,b)}});function P_(p,b,T){var z=Nf(b),ie=Zr(b,z);T==null&&!(Qs(b)&&(ie.length||!z.length))&&(T=b,b=p,p=this,ie=Zr(b,Nf(b)));var Ne=!(Qs(T)&&"chain"in T)||!!T.chain,Oe=Ur(p);return jd(ie,function(ct){var et=b[ct];p[ct]=et,Oe&&(p.prototype[ct]=function(){var Vt=this.__chain__;if(Ne||Vt){var rn=p(this.__wrapped__),kn=rn.__actions__=ip(this.__actions__);return kn.push({func:et,args:arguments,thisArg:p}),rn.__chain__=Vt,rn}return et.apply(p,Tu([this.value()],arguments))})}),p}function Py(){return fc._===this&&(fc._=Nc),this}function M_(){}function My(p){return p=ea(p),Vl(function(b){return Du(b,p)})}var Ny=S(Mc),Ay=S(sf),Ty=S(Vf);function c1(p){return co(p)?jt(kf(p)):Um(p)}function Fy(p){return function(b){return p==null?t:nc(p,b)}}var Ly=ae(),Ey=ae(!0);function N_(){return[]}function A_(){return!1}function $y(){return{}}function Dy(){return""}function Ry(){return!0}function T_(p,b){if(p=ea(p),p<1||p>xe)return[];var T=$e,z=cr(p,$e);b=ln(b),p-=$e;for(var ie=Ve(z,b);++T<p;)b(T);return ie}function jy(p){return Uo(p)?Mc(p,kf):Gc(p)?[p]:ip(Bh(lc(p)))}function F_(p){var b=++Xl;return lc(p)+b}var By=fg(function(p,b){return p+b},0),Oy=je("ceil"),zy=fg(function(p,b){return p/b},1),Vy=je("floor");function Wy(p){return p&&p.length?gc(p,Af,mp):t}function Hy(p,b){return p&&p.length?gc(p,ln(b,2),mp):t}function qy(p){return vt(p,Af)}function Uy(p,b){return vt(p,ln(b,2))}function Gy(p){return p&&p.length?gc(p,Af,zd):t}function Yy(p,b){return p&&p.length?gc(p,ln(b,2),zd):t}var Ky=fg(function(p,b){return p*b},1),Xy=je("round"),Zy=fg(function(p,b){return p-b},0);function lt(p){return p&&p.length?Se(p,Af):0}function Be(p,b){return p&&p.length?Se(p,ln(b,2)):0}return it.after=Fo,it.ary=Lo,it.assign=Pf,it.assignIn=Gd,it.assignInWith=af,it.assignWith=fd,it.at=Td,it.before=Gi,it.bind=Nr,it.bindAll=Lg,it.bindKey=Vi,it.castArray=ca,it.chain=rf,it.chunk=pf,it.compact=wc,it.concat=xr,it.cond=Eg,it.conforms=i0,it.constant=$g,it.countBy=er,it.create=vp,it.curry=Ho,it.curryRight=Ar,it.debounce=ma,it.defaults=Xa,it.defaultsDeep=Ju,it.defer=rl,it.delay=Cr,it.difference=Qd,it.differenceBy=xp,it.differenceWith=Qm,it.drop=Oh,it.dropRight=Pp,it.dropRightWhile=pv,it.dropWhile=Mg,it.fill=Ng,it.filter=cu,it.flatMap=Bu,it.flatMapDeep=oa,it.flatMapDepth=Ul,it.flatten=Mm,it.flattenDeep=mg,it.flattenDepth=Tg,it.flip=Yi,it.flow=kh,it.flowRight=C_,it.fromPairs=kv,it.functions=Mf,it.functionsIn=Sp,it.groupBy=U,it.initial=Hr,it.intersection=nu,it.intersectionBy=Sd,it.intersectionWith=Rf,it.invert=Nm,it.invertBy=zh,it.invokeMap=bs,it.iteratee=nh,it.keyBy=Ds,it.keys=Nf,it.keysIn=Qu,it.map=_s,it.mapKeys=Op,it.mapValues=Vh,it.matches=qg,it.matchesProperty=k0,it.memoize=ha,it.merge=pd,it.mergeWith=te,it.method=I_,it.methodOf=Iy,it.mixin=P_,it.negate=Dr,it.nthArg=My,it.omit=nn,it.omitBy=mt,it.once=va,it.orderBy=zi,it.over=Ny,it.overArgs=al,it.overEvery=Ay,it.overSome=Ty,it.partial=ns,it.partialRight=zs,it.partition=ii,it.pick=pn,it.pickBy=Nt,it.property=c1,it.propertyOf=Fy,it.pull=Bo,it.pullAll=ka,it.pullAllBy=Ru,it.pullAllWith=Vo,it.pullAt=il,it.range=Ly,it.rangeRight=Ey,it.rearg=Rs,it.reject=rr,it.remove=Ya,it.rest=Ni,it.reverse=Zl,it.sampleSize=Wa,it.set=Nn,it.setWith=hs,it.shuffle=Ci,it.slice=oi,it.sortBy=ys,it.sortedUniq=Mr,it.sortedUniqBy=vr,it.split=Mp,it.spread=Ma,it.tail=Il,it.take=mi,it.takeRight=Xi,it.takeRightWhile=k,it.takeWhile=N,it.tap=rp,it.throttle=ll,it.thru=ef,it.toArray=Su,it.toPairs=ss,it.toPairsIn=Ln,it.toPath=jy,it.toPlainObject=pl,it.transform=tn,it.unary=ir,it.union=j,it.unionBy=D,it.unionWith=W,it.uniq=H,it.uniqBy=he,it.uniqWith=Le,it.unset=Ws,it.unzip=st,it.unzipWith=Jt,it.update=Hs,it.updateWith=As,it.values=Ls,it.valuesIn=js,it.without=fs,it.words=Fg,it.wrap=Ai,it.xor=ts,it.xorBy=Bn,it.xorWith=ti,it.zip=ci,it.zipObject=lu,it.zipObjectDeep=Cd,it.zipWith=Sf,it.entries=ss,it.entriesIn=Ln,it.extend=Gd,it.extendWith=af,P_(it,it),it.add=By,it.attempt=Hg,it.camelCase=Wi,it.capitalize=ml,it.ceil=Oy,it.clamp=ks,it.clone=ui,it.cloneDeep=ai,it.cloneDeepWith=fi,it.cloneWith=bi,it.conformsTo=ra,it.deburr=Qo,it.defaultTo=hg,it.divide=zy,it.endsWith=po,it.eq=pr,it.escape=aa,it.escapeRegExp=Za,it.every=Da,it.find=Va,it.findIndex=Ag,it.findKey=Bp,it.findLast=ju,it.findLastIndex=pg,it.findLastKey=Zf,it.floor=Vy,it.forEach=ud,it.forEachRight=dl,it.forIn=ap,it.forInRight=wp,it.forOwn=fm,it.forOwnRight=Fc,it.get=qp,it.gt=Ti,it.gte=Di,it.has=Up,it.hasIn=th,it.head=eh,it.identity=Af,it.includes=Kt,it.indexOf=nr,it.inRange=Jn,it.invoke=Sv,it.isArguments=Sa,it.isArray=Uo,it.isArrayBuffer=ga,it.isArrayLike=qr,it.isArrayLikeObject=Ri,it.isBoolean=Ka,it.isBuffer=Jo,it.isDate=Ki,it.isElement=ua,it.isEmpty=Qr,it.isEqual=ar,it.isEqualWith=_a,it.isError=Pl,it.isFinite=gr,it.isFunction=Ur,it.isInteger=Ra,it.isLength=xi,it.isMap=qa,it.isMatch=_i,it.isMatchWith=da,it.isNaN=dr,it.isNative=fl,it.isNil=Ml,it.isNull=kc,it.isNumber=Nl,it.isObject=Qs,it.isObjectLike=ji,it.isPlainObject=Gl,it.isRegExp=uu,it.isSafeInteger=Sc,it.isSet=Cc,it.isString=du,it.isSymbol=Gc,it.isTypedArray=bl,it.isUndefined=fu,it.isWeakMap=Pd,it.isWeakSet=hf,it.join=Ud,it.kebabCase=Lc,it.last=$t,it.lastIndexOf=Gs,it.lowerCase=Na,it.lowerFirst=Jf,it.lt=yu,it.lte=Bf,it.max=Wy,it.maxBy=Hy,it.mean=qy,it.meanBy=Uy,it.min=Gy,it.minBy=Yy,it.stubArray=N_,it.stubFalse=A_,it.stubObject=$y,it.stubString=Dy,it.stubTrue=Ry,it.multiply=Ky,it.nth=Zo,it.noConflict=Py,it.noop=M_,it.now=tr,it.pad=Rr,it.padEnd=Go,it.padStart=Aa,it.parseInt=jr,it.random=En,it.reduce=ia,it.reduceRight=$r,it.repeat=ja,it.replace=qu,it.result=Ps,it.round=Xy,it.runInContext=_t,it.sample=Jl,it.size=Ha,it.snakeCase=Yd,it.some=ki,it.sortedIndex=Ys,it.sortedIndexBy=Er,it.sortedIndexOf=Hn,it.sortedLastIndex=Mn,it.sortedLastIndexBy=Do,it.sortedLastIndexOf=Jr,it.startCase=zp,it.startsWith=Kd,it.subtract=Zy,it.sum=lt,it.sumBy=Be,it.template=Vp,it.times=T_,it.toFinite=Yc,it.toInteger=ea,it.toLength=qf,it.toLower=Wh,it.toNumber=dd,it.toSafeInteger=vf,it.toString=lc,it.toUpper=Np,it.trim=mv,it.trimEnd=wh,it.trimStart=Qp,it.truncate=Ap,it.unescape=Hh,it.uniqueId=F_,it.upperCase=Am,it.upperFirst=pm,it.each=ud,it.eachRight=dl,it.first=eh,P_(it,function(){var p={};return Mo(it,function(b,T){_l.call(it.prototype,T)||(p[T]=b)}),p}(),{chain:!1}),it.VERSION=s,jd(["bind","bindKey","curry","curryRight","partial","partialRight"],function(p){it[p].placeholder=it}),jd(["drop","take"],function(p,b){ku.prototype[p]=function(T){T=T===t?1:Xr(ea(T),0);var z=this.__filtered__&&!b?new ku(this):this.clone();return z.__filtered__?z.__takeCount__=cr(T,z.__takeCount__):z.__views__.push({size:cr(T,$e),type:p+(z.__dir__<0?"Right":"")}),z},ku.prototype[p+"Right"]=function(T){return this.reverse()[p](T).reverse()}}),jd(["filter","map","takeWhile"],function(p,b){var T=b+1,z=T==ue||T==pe;ku.prototype[p]=function(ie){var Ne=this.clone();return Ne.__iteratees__.push({iteratee:ln(ie,3),type:T}),Ne.__filtered__=Ne.__filtered__||z,Ne}}),jd(["head","last"],function(p,b){var T="take"+(b?"Right":"");ku.prototype[p]=function(){return this[T](1).value()[0]}}),jd(["initial","tail"],function(p,b){var T="drop"+(b?"":"Right");ku.prototype[p]=function(){return this.__filtered__?new ku(this):this[T](1)}}),ku.prototype.compact=function(){return this.filter(Af)},ku.prototype.find=function(p){return this.filter(p).head()},ku.prototype.findLast=function(p){return this.reverse().find(p)},ku.prototype.invokeMap=Vl(function(p,b){return typeof p=="function"?new ku(this):this.map(function(T){return sp(T,p,b)})}),ku.prototype.reject=function(p){return this.filter(Dr(ln(p)))},ku.prototype.slice=function(p,b){p=ea(p);var T=this;return T.__filtered__&&(p>0||b<0)?new ku(T):(p<0?T=T.takeRight(-p):p&&(T=T.drop(p)),b!==t&&(b=ea(b),T=b<0?T.dropRight(-b):T.take(b-p)),T)},ku.prototype.takeRightWhile=function(p){return this.reverse().takeWhile(p).reverse()},ku.prototype.toArray=function(){return this.take($e)},Mo(ku.prototype,function(p,b){var T=/^(?:filter|find|map|reject)|While$/.test(b),z=/^(?:head|last)$/.test(b),ie=it[z?"take"+(b=="last"?"Right":""):b],Ne=z||/^find/.test(b);ie&&(it.prototype[b]=function(){var Oe=this.__wrapped__,ct=z?[1]:arguments,et=Oe instanceof ku,Vt=ct[0],rn=et||Uo(Oe),kn=function(so){var es=ie.apply(it,Tu([so],ct));return z&&Is?es[0]:es};rn&&T&&typeof Vt=="function"&&Vt.length!=1&&(et=rn=!1);var Is=this.__chain__,Sn=!!this.__actions__.length,Ao=Ne&&!Is,Io=et&&!Sn;if(!Ne&&rn){Oe=Io?Oe:new ku(this);var go=p.apply(Oe,ct);return go.__actions__.push({func:ef,args:[kn],thisArg:t}),new Ep(go,Is)}return Ao&&Io?p.apply(this,ct):(go=this.thru(kn),Ao?z?go.value()[0]:go.value():go)})}),jd(["pop","push","shift","sort","splice","unshift"],function(p){var b=Kr[p],T=/^(?:push|sort|unshift)$/.test(p)?"tap":"thru",z=/^(?:pop|shift)$/.test(p);it.prototype[p]=function(){var ie=arguments;if(z&&!this.__chain__){var Ne=this.value();return b.apply(Uo(Ne)?Ne:[],ie)}return this[T](function(Oe){return b.apply(Uo(Oe)?Oe:[],ie)})}}),Mo(ku.prototype,function(p,b){var T=it[b];if(T){var z=T.name+"";_l.call(Wc,z)||(Wc[z]=[]),Wc[z].push({name:b,func:T})}}),Wc[Vv(t,P).name]=[{name:"wrapper",func:t}],ku.prototype.clone=Rm,ku.prototype.reverse=Wg,ku.prototype.value=Sg,it.prototype.at=Cf,it.prototype.chain=mf,it.prototype.commit=Id,it.prototype.next=If,it.prototype.plant=sa,it.prototype.reverse=wi,it.prototype.toJSON=it.prototype.valueOf=it.prototype.value=pa,it.prototype.first=it.prototype.head,li&&(it.prototype[li]=jf),it},rs=Xn();kd?((kd.exports=rs)._=rs,pp._=rs):fc._=rs}).call(L0)})(w2,w2.exports);var qj=w2.exports;const An=yy(qj),G_="userId",xw="__smartchartUserId",c8=["userId","userID","user_id","userid","uid","clerkId"];let W_=null;function j2(n){if(typeof n!="string")return null;const e=n.trim();return e.length>0?e:null}function s5(n){try{return j2(n())}catch{return null}}function Uj(n){const e=j2(n);W_=e;let t=!1;if(typeof window>"u")return{userId:e,persisted:t};if(e){window[xw]=e;try{localStorage.setItem(G_,e),t=!0}catch{}try{sessionStorage.setItem(G_,e),t=!0}catch{}return{userId:e,persisted:t}}try{localStorage.removeItem(G_)}catch{}try{sessionStorage.removeItem(G_)}catch{}try{delete window[xw]}catch{}return{userId:null,persisted:t}}function zg(){if(W_)return W_;if(typeof window>"u")return null;const n=j2(window[xw]);if(n)return W_=n,n;const e=s5(()=>localStorage.getItem(G_));if(e)return W_=e,e;const t=s5(()=>sessionStorage.getItem(G_));return t?(W_=t,t):null}function Gj(n){if(typeof window>"u")return{userId:null,fromUrl:!1,persisted:!1};const e=n??new URL(window.location.href);for(const t of c8){const s=j2(e.searchParams.get(t));if(s){const o=Uj(s);return{userId:o.userId,fromUrl:!0,persisted:o.persisted}}}return{userId:zg(),fromUrl:!1,persisted:!1}}const Yj=["#b45309","#111827","#334155","#64748b","#16a34a","#2563eb","#7c3aed","#ef4444"],ly="smartchart.quickColors",l6=30,k_=$m(Yj);let o5=!1;function u8(){if(typeof localStorage>"u")return ly;const n=zg();return n?`${ly}.${n}`:ly}function Kj(n){return Array.isArray(n)?n.filter(e=>typeof e=="string"&&e.trim().length>0).slice(0,l6):[]}function vx(){if(typeof localStorage>"u")return;const n=u8();let e=localStorage.getItem(n);if(!e&&zg()){const s=localStorage.getItem(ly);s&&(e=s,localStorage.setItem(n,s))}if(e)try{const t=JSON.parse(e);k_.set(Kj(t))}catch{}}function d8(n){if(typeof localStorage>"u")return;const e=Array.isArray(n)?n:vm(k_);try{localStorage.setItem(u8(),JSON.stringify(e))}catch{}}function Xj(){o5||typeof window>"u"||(o5=!0,vx(),window.addEventListener("storage",n=>{if(n.key==="userId"){vx();return}n.key&&n.key.startsWith(ly)&&vx()}))}function Zj(n){if(!n)return;const e=vm(k_);if(e.includes(n)||e.length>=l6)return;const t=[...e,n];k_.set(t),d8(t)}function Jj(n){if(!n)return;const e=vm(k_).filter(t=>t!==n);k_.set(e),d8(e)}function Qj(n,e,t){const s=n.target;e(parseInt(s.value)),t("opacityChange",e())}function eB(n,e){n.stopPropagation(),x(e,!0)}function tB(n,e,t,s,o,r,a,l){if(/^#[0-9A-F]{6}$/i.test(i(e))){const c=t(i(e));x(s,c.h),x(o,c.s),x(r,c.l),a(i(e)),l("colorChange",i(e))}}function nB(n,e,t,s,o){i(e)&&/^#[0-9A-Fa-f]{6}$/.test(i(e))&&(t(i(e)),s("colorChange",i(e)),o(i(e)))}var sB=(n,e)=>{n.stopPropagation(),e()},oB=(n,e)=>e(!1),iB=(n,e,t)=>e(i(t)),rB=ke("<button></button>"),aB=ke('<div class="flex gap-[2px]"></div>'),lB=(n,e,t)=>e(i(t)),cB=(n,e,t)=>e(n,i(t)),uB=(n,e,t)=>e(n,i(t)),dB=ke("<button></button>"),fB=ke(`<button class="w-4 h-4 rounded-[2px] border border-dashed border-gray-300 dark:border-white/20 bg-white/60 dark:bg-white/5
                     flex items-center justify-center text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white transition-colors"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.25" d="M12 4v16m8-8H4"></path></svg></button>`),pB=n=>n.stopPropagation(),mB=(n,e,t)=>e(i(t).color),hB=ke('<div class="absolute z-10"><button class="flex items-center gap-2 px-3 py-2 rounded-md bg-[#1E2329] text-white text-xs border border-white/10 shadow-lg"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-1 12a2 2 0 01-2 2H8a2 2 0 01-2-2L5 7m3 0h8m-6 0V5a1 1 0 011-1h2a1 1 0 011 1v2"></path></svg> <span>Remove color</span></button></div>'),vB=ke('<div class="inline-flex flex-col items-stretch"><div class="flex items-center justify-between mb-3"><div class="flex items-center gap-2"><div class="w-7 h-7 rounded-md border border-gray-200/80 dark:border-white/10 shadow-inner"></div> <div class="leading-tight"><div class="text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Selected</div> <div class="text-sm font-semibold text-gray-900 dark:text-gray-100"> </div></div></div> <button class="px-3 py-1 rounded-md text-xs font-semibold bg-gray-900 text-white dark:bg-white dark:text-[#111827] hover:opacity-90 transition-opacity">Done</button></div> <div class="h-px bg-gray-200/80 dark:bg-white/10 mb-3"></div> <div class="mb-3 flex flex-col gap-[2px] border border-gray-300 dark:border-[#2E313A] bg-white dark:bg-[#111318] p-[2px] w-full"></div> <div class="mb-3"><div class="flex items-center justify-between mb-2"><span class="text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Quick</span> <span class="text-[10px] text-gray-400 dark:text-gray-500">Shortcuts</span></div> <div class="grid grid-cols-10 gap-[2px] p-[2px] border border-transparent"><!> <!></div></div> <div><div class="flex items-center justify-between mb-2"><span class="text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Opacity</span> <span class="text-xs font-semibold text-gray-900 dark:text-gray-100"> </span></div> <div class="relative"><div class="relative h-3 rounded-[2px] border border-gray-300 dark:border-[#2E313A] overflow-hidden" style="background-image: repeating-conic-gradient(#7a7a7a 0% 25%, #2b2b2b 0% 50%); background-size: 6px 6px; background-position: 0 0;"><div class="absolute inset-0"></div> <input type="range" min="0" max="100" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"></div> <div class="absolute top-1/2 w-3.5 h-3.5 bg-white dark:bg-[#1B1D23] border border-gray-300 dark:border-[#2E313A] rounded-full transform -translate-y-1/2 pointer-events-none"></div></div></div> <!></div>'),gB=(n,e)=>e(!1),_B=(n,e)=>x(e,!1),yB=ke('<div class="mb-3 flex items-center justify-between"><div class="flex items-center gap-2"><div class="w-7 h-7 rounded-md border border-gray-200/80 dark:border-white/10 shadow-inner"></div> <div class="leading-tight"><div class="text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Custom</div> <div class="text-sm font-semibold text-gray-900 dark:text-gray-100"> </div></div></div> <div class="flex items-center gap-2"><button class="px-3 py-1 rounded-md text-xs font-semibold bg-gray-900 text-white dark:bg-white dark:text-[#111827] hover:opacity-90 transition-opacity">Done</button> <button class="text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button></div></div> <div class="h-px bg-gray-200/80 dark:bg-white/10 mb-3"></div> <div class="mb-3"><label class="block text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">Hex</label> <input type="text" class="w-full px-3 py-2 bg-white/80 dark:bg-[#1A1A1A] border border-gray-200/80 dark:border-[#2E313A] rounded-lg text-gray-900 dark:text-white text-sm focus:border-gray-900/30 dark:focus:border-white/30 focus:outline-none" placeholder="#000000"></div> <div class="mb-3"><div class="w-full h-7 rounded-lg border border-gray-200/80 dark:border-[#2E313A] shadow-inner"></div></div> <div class="mb-3"><label class="block text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">Picker</label> <div class="relative w-full h-24 rounded-xl border border-gray-200/80 dark:border-[#2E313A] cursor-crosshair overflow-hidden"><div class="absolute w-3 h-3 border-2 border-white rounded-full transform -translate-x-1/2 -translate-y-1/2 pointer-events-none shadow-sm"></div></div></div> <div class="mb-3"><label class="block text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">Hue</label> <div class="relative"><div class="relative h-3 rounded-full overflow-hidden border border-gray-200/80 dark:border-white/10"><div class="absolute inset-0" style="background: linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000);"></div> <input type="range" min="0" max="360" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"></div> <div class="absolute top-1/2 w-4 h-4 bg-white dark:bg-[#1B1D23] border border-gray-300 dark:border-white/10 rounded-full transform -translate-y-1/2 pointer-events-none shadow-md"></div></div></div> <button class="w-full py-2 rounded-lg bg-gradient-to-r from-gray-900 to-gray-700 text-white text-sm font-semibold shadow-sm hover:opacity-95 transition-opacity">Add Color</button>',1),bB=ke(`<div class="color-picker-container fixed z-[360000] bg-white dark:bg-[#1B1D23] border border-gray-200 dark:border-[#2E313A] rounded-lg shadow-[0_8px_20px_rgba(0,0,0,0.22)] p-4 transition-colors duration-150" style="
      left: 50%; 
      top: 50%; 
      transform: translate(-50%, -50%); 
      max-height: 90vh; 
      max-width: 90vw;
      overflow-y: auto;
    "><!></div>`);function qv(n,e){Ed(e,!1);const t=sm(),s=()=>wl(k_,"$quickColors",t),o=Fh();let r=hi(e,"selectedColor",12,"#1677FF"),a=hi(e,"show",12,!1),l=hi(e,"opacity",12,100),c=id(),f=id(),u=!1,d=id(!1),h=id({visible:!1,x:0,y:0,color:""}),m=null,g=id(r()),w=id(r()),C=id("#000000"),P=id(0),I=id(100),A=id(50);const M=ue(),F=10,Y=F*16+(F-1)*2+2*2+1*2;function ce(Je){r(Je),o("colorChange",Je),fe()}function Q(Je){Zj(Je),x(d,!1)}function le(Je,Ct,Ze){Ze/=100;const Xe=Ct*Math.min(Ze,1-Ze)/100,Ae=Qe=>{const gt=(Qe+Je/30)%12,Ft=Ze-Xe*Math.max(Math.min(gt-3,9-gt,1),-1);return Math.round(255*Ft).toString(16).padStart(2,"0")};return`#${Ae(0)}${Ae(8)}${Ae(4)}`}function ue(){const Je=["#ffffff","#e6e6e6","#cccccc","#b3b3b3","#999999","#808080","#666666","#4d4d4d","#333333","#000000"],Ct=[0,15,30,45,60,120,180,210,240,300],Ze=[50,88,78,68,58,42,28],Xe=90,Ae=Ze.map(Qe=>Ct.map(gt=>le(gt,Xe,Qe)));return[Je,...Ae]}function fe(){x(h,{visible:!1,x:0,y:0,color:""})}function pe(Je,Ct,Ze){let Qe=Je,gt=Ct;if(i(c)){const{width:Ft,height:ot}=i(c).getBoundingClientRect();Qe+140>Ft&&(Qe=Math.max(8,Ft-140-8)),gt+36>ot&&(gt=Math.max(8,ot-36-8))}x(h,{visible:!0,x:Qe,y:gt,color:Ze})}function Z(Je,Ct){if(Je.preventDefault(),Je.stopPropagation(),!i(c))return;const Ze=i(c).getBoundingClientRect();pe(Je.clientX-Ze.left,Je.clientY-Ze.top,Ct)}function xe(Je){Jj(Je),fe()}function oe(Je,Ct){if(Je.pointerType==="mouse")return;m&&clearTimeout(m);const Ze=Je.currentTarget;if(!Ze||!i(c))return;const Xe=i(c).getBoundingClientRect(),Ae=Ze.getBoundingClientRect();m=setTimeout(()=>{const Qe=Ae.right-Xe.left+8,gt=Ae.top-Xe.top;pe(Qe,gt,Ct)},450)}function Pe(){m&&(clearTimeout(m),m=null)}function $e(Je){const Ct=(Je||"").trim();if(!Ct)return null;if(/^#([0-9a-f]{6})$/i.test(Ct))return{r:parseInt(Ct.slice(1,3),16),g:parseInt(Ct.slice(3,5),16),b:parseInt(Ct.slice(5,7),16)};if(/^#([0-9a-f]{3})$/i.test(Ct)){const Xe=Ct[1],Ae=Ct[2],Qe=Ct[3];return{r:parseInt(Xe+Xe,16),g:parseInt(Ae+Ae,16),b:parseInt(Qe+Qe,16)}}const Ze=Ct.match(/^rgba?\(([^)]+)\)$/i);if(Ze){const Xe=Ze[1].split(",").map(Ae=>parseFloat(Ae.trim()));if(Xe.length>=3&&Xe.every(Ae=>!Number.isNaN(Ae)))return{r:Math.round(Xe[0]),g:Math.round(Xe[1]),b:Math.round(Xe[2])}}return null}function ze(Je,Ct){const Ze=$e(Je);if(!Ze)return null;const Xe=Math.max(0,Math.min(1,Ct));return`rgba(${Ze.r}, ${Ze.g}, ${Ze.b}, ${Xe})`}function Ke(Je){const Ct=parseInt(Je.slice(1,3),16)/255,Ze=parseInt(Je.slice(3,5),16)/255,Xe=parseInt(Je.slice(5,7),16)/255,Ae=Math.max(Ct,Ze,Xe),Qe=Math.min(Ct,Ze,Xe);let gt=0,Ft=0,ot=(Ae+Qe)/2;if(Ae!==Qe){const ve=Ae-Qe;switch(Ft=ot>.5?ve/(2-Ae-Qe):ve/(Ae+Qe),Ae){case Ct:gt=(Ze-Xe)/ve+(Ze<Xe?6:0);break;case Ze:gt=(Xe-Ct)/ve+2;break;case Xe:gt=(Ct-Ze)/ve+4;break}gt/=6}return{h:gt*360,s:Ft*100,l:ot*100}}function qe(){x(C,le(i(P),i(I),i(A))),r(i(C)),o("colorChange",i(C))}function nt(Je){u=!0,bt(Je),document.addEventListener("mousemove",ft),document.addEventListener("mouseup",ut),Je.preventDefault()}function ft(Je){u&&i(f)&&bt(Je)}function ut(){u=!1,document.removeEventListener("mousemove",ft),document.removeEventListener("mouseup",ut)}function bt(Je){if(!i(f))return;const Ct=i(f).getBoundingClientRect(),Ze=Math.max(0,Math.min(1,(Je.clientX-Ct.left)/Ct.width)),Xe=Math.max(0,Math.min(1,(Je.clientY-Ct.top)/Ct.height));x(I,Ze*100),x(A,(1-Xe)*100),qe()}function Pt(Je){const Ct=Je.target;i(c)&&!i(c).contains(Ct)&&(a(!1),x(d,!1),o("close"))}Th(()=>{Xj()}),b0(()=>{typeof document<"u"&&document.removeEventListener("click",Pt,!0)}),nm(()=>(tm(r()),tm(l())),()=>{x(g,ze(r(),l()/100)||r())}),nm(()=>tm(r()),()=>{x(w,ze(r(),.6)||r())}),nm(()=>tm(a()),()=>{a()&&typeof document<"u"&&setTimeout(()=>{document.addEventListener("click",Pt,!0)},0)}),nm(()=>tm(a()),()=>{!a()&&typeof document<"u"&&document.removeEventListener("click",Pt,!0)}),x0(),rv();var Et=Qn(),Mt=fn(Et);Ue(Mt,a,Je=>{var Ct=bB();Ct.__click=[sB,fe];var Ze=y(Ct);Ue(Ze,()=>!i(d),Xe=>{var Ae=vB();Ot(Ae,"style",`width: ${Y}px;`);var Qe=y(Ae),gt=y(Qe),Ft=y(gt),ot=v(Ft,2),ve=v(y(ot),2),Ie=y(ve,!0);_(ve),_(ot),_(gt);var It=v(gt,2);It.__click=[oB,a],_(Qe);var Dt=v(Qe,4);Yo(Dt,5,()=>M,Ii,(qs,ri)=>{var Eo=aB();Yo(Eo,5,()=>i(ri),Ii,(Ia,Lr)=>{var Qa=rB();Qa.__click=[iB,ce,Lr],Ce(()=>{pi(Qa,`w-4 h-4 rounded-[2px] focus:outline-none
                         ${(r()===i(Lr)?"shadow-[inset_0_0_0_2px_rgba(0,0,0,0.65)] dark:shadow-[inset_0_0_0_2px_rgba(255,255,255,0.95)]":"")??""}`),Ot(Qa,"style",`background-color: ${i(Lr)??""};`)}),q(Ia,Qa)}),_(Eo),q(qs,Eo)}),_(Dt);var Zt=v(Dt,2),gn=v(y(Zt),2);Ot(gn,"style",`width: ${Y}px;`);var hn=y(gn);Yo(hn,1,s,Ii,(qs,ri)=>{var Eo=dB();Eo.__click=[lB,ce,ri],Eo.__contextmenu=[cB,Z,ri],Eo.__pointerdown=[uB,oe,ri],Eo.__pointerup=Pe,Ce(()=>{pi(Eo,`w-4 h-4 rounded-[2px] transition-colors focus:outline-none
                     ${(r()===i(ri)?"shadow-[inset_0_0_0_2px_rgba(0,0,0,0.65)] dark:shadow-[inset_0_0_0_2px_rgba(255,255,255,0.95)]":"")??""}`),Ot(Eo,"style",`background-color: ${i(ri)??""};`)}),vd("pointerleave",Eo,Pe),vd("pointercancel",Eo,Pe),q(qs,Eo)});var qn=v(hn,2);Ue(qn,()=>s().length<l6,qs=>{var ri=fB();ri.__click=[eB,d],q(qs,ri)}),_(gn),_(Zt);var On=v(Zt,2),bn=y(On),Fn=v(y(bn),2),Xs=y(Fn);_(Fn),_(bn);var oo=v(bn,2),Yn=y(oo),_o=y(Yn),xs=v(_o,2);xn(xs),xs.__input=[Qj,l,o],_(Yn);var Rt=v(Yn,2);_(oo),_(On);var un=v(On,2);Ue(un,()=>i(h).visible,qs=>{var ri=hB();ri.__click=[pB];var Eo=y(ri);Eo.__click=[mB,xe,h],_(ri),Ce(()=>Ot(ri,"style",`left: ${i(h).x??""}px; top: ${i(h).y??""}px;`)),q(qs,ri)}),_(Ae),Ce(()=>{Ot(Ft,"style",`background-color: ${r()??""};`),tt(Ie,r()),tt(Xs,`${l()??""}%`),Ot(_o,"style",`background: linear-gradient(to right, rgba(0,0,0,0), ${i(g)??""});`),Ot(Rt,"style",`left: calc(${l()??""}% - 7px); box-shadow: 0 0 0 1px rgba(0,0,0,0.25), 0 0 8px ${i(w)??""};`)}),Bs(xs,l),q(Xe,Ae)},Xe=>{var Ae=yB(),Qe=fn(Ae),gt=y(Qe),Ft=y(gt),ot=v(Ft,2),ve=v(y(ot),2),Ie=y(ve,!0);_(ve),_(ot),_(gt);var It=v(gt,2),Dt=y(It);Dt.__click=[gB,a];var Zt=v(Dt,2);Zt.__click=[_B,d],_(It),_(Qe);var gn=v(Qe,4),hn=v(y(gn),2);xn(hn),hn.__input=[tB,C,Ke,P,I,A,r,o],_(gn);var qn=v(gn,2),On=y(qn);_(qn);var bn=v(qn,2),Fn=v(y(bn),2);Fn.__mousedown=nt;var Xs=y(Fn);_(Fn),tp(Fn,qs=>x(f,qs),()=>i(f)),_(bn);var oo=v(bn,2),Yn=v(y(oo),2),_o=y(Yn),xs=v(y(_o),2);xn(xs),xs.__input=qe,_(_o);var Rt=v(_o,2);_(Yn),_(oo);var un=v(oo,2);un.__click=[nB,C,r,o,Q],Ce(()=>{Ot(Ft,"style",`background-color: ${i(C)??""};`),tt(Ie,i(C)),Ot(On,"style",`background-color: ${i(C)??""};`),Ot(Fn,"style",`background: linear-gradient(to bottom, transparent, black), linear-gradient(to right, white, hsl(${i(P)??""}, 100%, 50%));`),Ot(Xs,"style",`left: ${i(I)??""}%; top: ${100-i(A)}%;`),Ot(Rt,"style",`left: calc(${i(P)/360*100}% - 8px);`)}),Bs(hn,()=>i(C),qs=>x(C,qs)),Bs(xs,()=>i(P),qs=>x(P,qs)),q(Xe,Ae)}),_(Ct),tp(Ct,Xe=>x(c,Xe),()=>i(c)),Ce(()=>{wr(Ct,"w-fit",!i(d)),wr(Ct,"w-80",i(d))}),q(Je,Ct)}),q(n,Et),$d()}Ip(["click","contextmenu","pointerdown","pointerup","input","mousedown"]);const xB={data:null,loading:!1,error:null},O0=$m(xB);async function wB(n,e){const s=`${SB()}/auth/user/preference/${n}${e?"?isFree=true":""}`,o=await CB(s,{},8e3);if(!o.ok){const a=new Error(o.status===404?"User not found":`Failed to fetch user preferences: ${o.statusText}`);throw a.status=o.status,a}return await o.json()}async function kB(n,e,t={}){const s=Math.max(1,t.retries??3),o=Math.max(0,t.baseDelayMs??350),r=Math.max(o,t.maxDelayMs??1500),a=t.bootstrapMissing??!0;let l=0,c,f=!1;for(;l<s;)try{return await wB(n,e)}catch(u){c=u,l+=1;const d=u==null?void 0:u.status,h=typeof u=="object"&&u!==null&&"name"in u&&u.name==="AbortError",m=d===404||d===429||typeof d=="number"&&d>=500||d===void 0||h;if(d===404&&a&&!f){f=!0;try{await f8(n,"Light")}catch{}}if(!m||l>=s)break;const g=Math.min(r,o*Math.pow(2,l-1));await new Promise(w=>setTimeout(w,g))}throw c instanceof Error?c:new Error("Failed to fetch user preferences")}function SB(){var e,t;const n=(t=(e=import.meta)==null?void 0:e.env)==null?void 0:t.VITE_USER_PREFS_BASE_URL;return typeof n=="string"&&n.trim()?n.trim():"https://noti.dutyai.app"}async function CB(n,e={},t=8e3){const s=new AbortController,o=setTimeout(()=>s.abort(),t);try{return await fetch(n,{...e,signal:s.signal})}finally{clearTimeout(o)}}function IB(n){return{id:n,clerkId:n,theme:"Light",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isUserExists:!0,isPremium:!1,isTrial:!1}}function i5(n){O0.set({data:n,loading:!1,error:null})}function PB(n){O0.update(e=>({...e,loading:n}))}async function f8(n,e){const t="https://noti.dutyai.app/auth/user/preference";try{const s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clerkId:n,theme:e})});if(!s.ok)throw new Error(`Failed to save theme preference: ${s.statusText}`);console.log("✅ Theme preference saved successfully:",{clerkId:n,theme:e})}catch(s){console.error("❌ Failed to save theme preference:",s)}}const r5=$m(null),ww=$m(null),MB=lP,Cb={},NB=[{tfsecs:604800,origin:345600,date:"1970-01-05"}];function AB(n){if(n=Math.abs(n),n>=1)return 0;let e=0;for(;n<1;)n=n*10,e+=1;return e}function bg(n){if(Cb[n])return Cb[n];const e=n.length-1,t=n.substring(e),s=n.substring(0,e),o=parseInt(s);let r="minute";if(t=="w")r="week";else if(t=="d")r="day";else if(t=="h")r="hour";else if(t=="m")r="minute";else if(t=="s")r="second";else throw new Error(`unsupport period: ${n}`);const a=gp(n);return Cb[n]={multiplier:o,timespan:r,timeframe:n,secs:a},Cb[n]}bg("1m"),bg("5m"),bg("15m"),bg("30m"),bg("1h"),bg("2h"),bg("4h"),bg("8h"),bg("12h"),bg("1d"),bg("3d"),bg("1w");function Ib(n,e,t){return{id:n,position:MB.Middle,marginLeft:8,marginTop:2,marginRight:0,marginBottom:0,paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,icon:e,fontFamily:"icomoon",size:14,color:t,activeColor:t,backgroundColor:"transparent",activeBackgroundColor:"rgba(22, 119, 255, 0.15)"}}function fp(n){let e=n==="dark"?"#929AA5":"#76808F",t=n==="dark"?"#555555":"#dddddd";const s=n==="dark"?"#111B2B":"#F3F3F3",o=n==="dark"?"#0A0F1A":"#ffffff",r=n==="dark"?"#b3b3b3":e,a=n==="dark"?"#FFFFFF":"#333333";try{if(typeof window<"u"){const m=document.querySelector(".menu-container")||document.documentElement,g=window.getComputedStyle(m),w=I=>(g.getPropertyValue(I)||"").trim(),C=w("--menu-text"),P=w("--menu-btn-border")||w("--menu-border");C&&(e=C),P&&(t=P)}}catch{}const l=typeof window<"u"&&window.innerWidth<=768,c=typeof window<"u"&&window.innerWidth<=480,f=c?10:l?11:12,u=c?10:l?11:12,d=c?2:l?3:4,h=c?2:l?3:4;return{pane:{backgroundColor:o},candle:{pane:{backgroundColor:o},type:cP.CandleSolid,bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",upBorderColor:"#26A69A",downBorderColor:"#EF5350",noChangeBorderColor:"#888888",upWickColor:"#26A69A",downWickColor:"#EF5350",noChangeWickColor:"#888888"},priceMark:{last:{show:!0},high:{show:!0},low:{show:!0}},tooltip:{showRule:sk.Always,text:{style:{fontSize:32,fontWeight:"bold",color:"#FFFFFF"}},title:{show:!0,size:16,family:"Helvetica Neue",weight:"normal",color:a,template:"{name} · {period} · {exchange} · {segment}"},legend:{size:13,family:"Helvetica Neue",weight:"normal",color:e,marginLeft:1,marginTop:4,marginRight:1,marginBottom:4,defaultValue:"n/a",template:({current:m,prev:g},w)=>{var Y,ce;const C=(w==null?void 0:w.bar)||{},P=((ce=(Y=w==null?void 0:w.tooltip)==null?void 0:Y.legend)==null?void 0:ce.color)??e,I=(m==null?void 0:m.open)??0,A=(m==null?void 0:m.close)??0,F=(C.compareRule||"current_open")==="current_open"?I:(g==null?void 0:g.close)??A,$=I===A||A>=F?C.upBorderColor||P:C.downBorderColor||P,L=Q=>({text:Q,color:$});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:L("{open}")},{title:"H",value:L("{high}")},{title:"L",value:L("{low}")},{title:"C",value:L("{close}")},{title:"V",value:L("{volume}")},{title:"",value:L("{changeValue} ({change})")}]:[{title:"O",value:L("{open}")},{title:"H",value:L("{high}")},{title:"L",value:L("{low}")},{title:"C",value:L("{close}")},{title:"V",value:L("{volume}")},{title:"",value:L("{changeValue} ({change})")}]}}}},indicator:{lastValueMark:{show:!0},tooltip:{showRule:sk.Always,icons:[Ib("visible","",e),Ib("invisible","",e),Ib("setting","",e),Ib("close","",e)]}},grid:{show:!0,horizontal:{show:!0,color:s,style:wt.Solid,size:1},vertical:{show:!0,color:s,style:wt.Solid,size:1}},xAxis:{show:!0,axisLine:{show:!0,color:t,size:5},ticduty:{show:!0,color:t},tickText:{show:!0,style:{fontSize:f,color:r,fontFamily:"Arial, sans-serif"},margin:d}},yAxis:{type:"normal",reverse:!1,show:!0,axisLine:{show:!0,color:t,size:4},ticduty:{show:!0,color:t},tickText:{show:!0,style:{fontSize:u,color:r,fontFamily:"Arial, sans-serif"},margin:h}},separator:{size:1,color:n==="dark"?"rgba(85, 85, 85, 0.3)":"rgba(221, 221, 221, 0.3)",fill:!0,activeBackgroundColor:n==="dark"?"rgba(85, 85, 85, 0.1)":"rgba(221, 221, 221, 0.1)"}}}const cp=u4(),k2={AO:[{title:"Short Period",precision:0,min:1,default:5},{title:"Long Period",precision:0,min:1,default:34},{title:"Increasing Color",type:"color",styleKey:"bars[0].upColor",default:"#26A69A"},{title:"Decreasing Color",type:"color",styleKey:"bars[0].downColor",default:"#EF5350"},{title:"Reverse Color",type:"color",styleKey:"bars[0].reverseColor",default:"#c4c4c4"}],BIAS:[{title:ew(),precision:0,min:1,default:6}],BOLL:[{title:ew(),precision:0,min:1,default:20},{title:d4(),precision:2,min:1,default:2}],BBI:[{title:cp+"1",precision:0,min:1,default:3},{title:cp+"2",precision:0,min:1,default:6},{title:cp+"3",precision:0,min:1,default:12},{title:cp+"4",precision:0,min:1,default:24}],CCI:[{title:cp+"1",precision:0,min:1,default:20}],CR:[{title:cp+"1",precision:0,min:1,default:26},{title:cp+"2",precision:0,min:1,default:10},{title:cp+"3",precision:0,min:1,default:20},{title:cp+"4",precision:0,min:1,default:40},{title:cp+"5",precision:0,min:1,default:60}],DMI:[{title:"DI Period",precision:0,min:1,default:14},{title:"ADX Period",precision:0,min:1,default:6}],EMV:[{title:cp+"1",precision:0,min:1,default:14},{title:cp+"2",precision:0,min:1,default:9}],EMA:[{title:"Period",precision:0,min:1,default:20},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#2563eb"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:2}],ICHIMOKU:[{title:"Tenkan Period",precision:0,min:1,default:9},{title:"Kijun Period",precision:0,min:1,default:26},{title:"Senkou B Period",precision:0,min:1,default:52}],MTM:[{title:cp+"1",precision:0,min:1,default:12},{title:cp+"2",precision:0,min:1,default:6}],MA:[{title:"MA1",precision:0,min:1,styleKey:"lines[0].color",default:5},{title:"MA2",precision:0,min:1,styleKey:"lines[1].color",default:10},{title:"MA3",precision:0,min:1,styleKey:"lines[2].color",default:30}],MACD:[{title:"Fast Period",precision:0,min:1,default:12},{title:"Slow Period",precision:0,min:1,default:26},{title:"Signal Period",precision:0,min:1,default:9}],OBV:[{title:cp+"1",precision:0,min:1,default:30},{title:cp+"2",precision:0,min:1,default:10}],PVT:[],PSY:[{title:cp+"1",precision:0,min:1,default:12},{title:cp+"2",precision:0,min:1,default:6}],ROC:[{title:cp+"1",precision:0,min:1,default:12},{title:cp+"2",precision:0,min:1,default:6}],RSI:[{title:"Period",precision:0,min:1,default:14},{title:"Overbought",precision:0,min:50,max:100,default:70},{title:"Middle",precision:0,min:30,max:70,default:50},{title:"Oversold",precision:0,min:0,max:50,default:30},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#FF6B35"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:1}],SMA:[{title:cp+"1",precision:0,min:1,default:12},{title:cp+"2",precision:0,min:1,default:2}],SMARTTREND:[{title:"Period",precision:0,min:1,default:10},{title:"Multiplier",precision:1,min:.1,max:10,default:3},{title:"Uptrend Color",type:"color",styleKey:"lines[0].color",default:"#10B981"},{title:"Downtrend Color",type:"color",styleKey:"lines[1].color",default:"#EF4444"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:2}],KDJ:[{title:cp+"1",precision:0,min:1,default:9},{title:cp+"2",precision:0,min:1,default:3},{title:cp+"3",precision:0,min:1,default:3}],SAR:[{title:"Start",precision:3,min:.001,max:.1,default:.02},{title:"Increment",precision:3,min:.001,max:.1,default:.02},{title:"Max value",precision:2,min:.1,max:1,default:.2}],TRIX:[{title:cp+"1",precision:0,min:1,default:12},{title:cp+"2",precision:0,min:1,default:9}],VOL:[{title:"MA1",precision:0,min:1,default:5},{title:"MA2",precision:0,min:1,default:10},{title:"MA3",precision:0,min:1,default:20}],VR:[{title:cp+"1",precision:0,min:1,default:26},{title:cp+"2",precision:0,min:1,default:6},{title:cp+"3",precision:0,min:1,default:12}],WR:[{title:"Period",precision:0,min:1,default:14},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#2563eb"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:1}],TRAP_HUNTER:[{title:"Resistance Lookback",precision:0,min:1,default:20},{title:"Support Lookback",precision:0,min:1,default:20},{title:"Confirmation Bars",precision:0,min:1,default:4},{title:"Max Trap Bars",precision:0,min:1,default:6},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Min Volume Spike",precision:2,min:.1,default:1.2},{title:"Min Breakout Factor",precision:4,min:0,default:5e-4},{title:"Min Wick Ratio",precision:2,min:0,max:1,default:.35},{title:"Min Trap Score",precision:2,min:0,max:1,default:.5},{title:"Enable Normal Signal (0/1)",precision:0,min:0,max:1,default:1},{title:"Normal Quiet Bars",precision:0,min:1,default:5}],SMART_MONEY:[{title:"Zone Lookback Bars",precision:0,min:10,default:40},{title:"Min Zone Bars",precision:0,min:3,default:5},{title:"Max Zone Bars",precision:0,min:5,default:25},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Min Volume Factor",precision:2,min:.1,default:1.2},{title:"Max Zone Width %",precision:3,min:.001,default:.03},{title:"Prior Trend Lookback",precision:0,min:1,default:20},{title:"Min OBV Trend Strength",precision:2,min:0,default:.2},{title:"Min Zone Score",precision:2,min:0,max:1,default:.6},{title:"Merge Nearby Zones (0/1)",precision:0,min:0,max:1,default:1},{title:"Max Zones Displayed",precision:0,min:1,default:20},{title:"Show Labels (0/1)",precision:0,min:0,max:1,default:1}],VOLCANIC:[{title:"BB Period",precision:0,min:1,default:16},{title:"BB StdDev",precision:2,min:.1,default:2},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Normalize Lookback",precision:0,min:10,default:60},{title:"Pressure SMA",precision:0,min:1,default:2},{title:"Min Pressure Alert",precision:2,min:0,max:1,default:.55},{title:"Confirm Bars",precision:0,min:1,default:1},{title:"Min Volume x",precision:2,min:.5,default:1},{title:"Min Range x",precision:2,min:.5,default:1},{title:"Min Body % of Range",precision:2,min:0,max:1,default:.5},{title:"Breakout Lookback",precision:0,min:5,default:10},{title:"Min Bars Between Signals",precision:0,min:1,default:1},{title:"Trend EMA Period",precision:0,min:2,default:30},{title:"Require Trend Align (0/1)",precision:0,min:0,max:1,default:0},{title:"Breakout Buffer %",precision:4,min:0,default:7e-4},{title:"Require BB Band Break (0/1)",precision:0,min:0,max:1,default:0},{title:"Retest Window (bars)",precision:0,min:1,default:1}],VOLCANIC_SIG:[{title:"BB Period",precision:0,min:1,default:16},{title:"BB StdDev",precision:2,min:.1,default:2},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Normalize Lookback",precision:0,min:10,default:60},{title:"Pressure SMA",precision:0,min:1,default:2},{title:"Min Pressure Alert",precision:2,min:0,max:1,default:.55},{title:"Confirm Bars",precision:0,min:1,default:1},{title:"Min Volume x",precision:2,min:.5,default:1},{title:"Min Range x",precision:2,min:.5,default:1},{title:"Min Body % of Range",precision:2,min:0,max:1,default:.5},{title:"Breakout Lookback",precision:0,min:5,default:10},{title:"Min Bars Between Signals",precision:0,min:1,default:1},{title:"Trend EMA Period",precision:0,min:2,default:30},{title:"Require Trend Align (0/1)",precision:0,min:0,max:1,default:0},{title:"Breakout Buffer %",precision:4,min:0,default:7e-4},{title:"Require BB Band Break (0/1)",precision:0,min:0,max:1,default:0},{title:"Retest Window (bars)",precision:0,min:1,default:1}],ZIGZAG:[{title:"Deviation %",precision:1,min:1,max:50,default:5},{title:"Depth",precision:0,min:1,max:50,default:5}]};function TB(n,e){if(n>1e12)throw Error("10 digit timestamp is require for align_tfsecs");let t=0;for(const s of NB){if(e<s.tfsecs)break;if(e%s.tfsecs==0){t=s.origin;break}}return t?Math.floor((n-t)/e)*e+t:Math.floor(n/e)*e}function a5(n,e){if((!n||isNaN(n)||n<=0)&&(console.warn("Invalid timestamp in align_tfmsecs:",n),n=Date.now()),n<1e12&&(console.warn("13 digit timestamp is require for align_tfmsecs, got:",n),n<1e9?n=n*1e3:n=Date.now()),e<1e3)throw Error("milliseconds tf_msecs is require for align_tfmsecs");const t=Math.floor(n/1e3),s=Math.floor(e/1e3);return TB(t,s)*1e3}function FB(n,e,t,s=null){if(n=n.map((a,l)=>{const c=a[0];return(!c||isNaN(c)||c<=0)&&(console.warn(`Invalid timestamp in build_ohlcvs at index ${l}:`,c),a[0]=Date.now()),a}),s&&((!s[0]||isNaN(s[0])||s[0]<=0)&&(console.warn("Invalid timestamp in last_bar:",s[0]),s[0]=Date.now()),s[0]=a5(s[0],t)),e==t)return s&&n.length>0&&n[0][0]>s[0]&&n.splice(0,0,s),n;const o=s?[s]:[];let r=o.length-1;return n.forEach((a,l)=>{if((!a[0]||isNaN(a[0])||a[0]<=0)&&(console.warn(`Invalid timestamp in build_ohlcvs forEach at index ${l}:`,a[0]),a[0]=Date.now()),a[0]=a5(a[0],t),r<0||a[0]>o[r][0])o.push(a),r+=1;else{const c=o[r];c[2]=Math.max(c[2],a[2]),c[3]=Math.min(c[3],a[3]),c[4]=a[4],c[5]+=a[5]}}),o}function Xd(n){var o,r,a,l,c,f,u,d,h,m,g,w,C,P,I,A,M,F,B,$,L,O,Y,ce,Q,le,ue,fe;const e=n,t=An.cloneDeep(e),s=(o=t.candle)==null?void 0:o.type;if(s&&(t._originalChartType=s),t.candle&&t.candle.type==="area"&&!t.candle._isLineChart){t.candle.area||(t.candle.area={});const pe=((r=t.candle.bar)==null?void 0:r.upColor)||((a=t.candle.bar)==null?void 0:a.downColor)||((f=(c=(l=t.candle.priceMark)==null?void 0:l.last)==null?void 0:c.text)==null?void 0:f.color)||((d=(u=t.candle.tooltip)==null?void 0:u.text)==null?void 0:d.color)||"#2196F3";t.candle.area={...t.candle.area,backgroundColor:[{offset:0,color:pe+"60"},{offset:1,color:pe+"10"}]}}if(e.yAxis&&(t.yAxis={...t.yAxis||{},...e.yAxis||{}}),e.xAxis&&(t.xAxis={...t.xAxis||{},...e.xAxis||{}}),e.grid&&(t.grid={...t.grid||{},...e.grid||{}}),e.indicator&&(t.indicator={...t.indicator||{},...e.indicator||{}}),t.candle&&t.candle.type==="heikin_ashi"&&(t.candle.type="candle_solid"),t.candle&&t.candle.type==="renko_atr"&&(t.candle.type="candle_solid"),t.candle&&!t.candle.bar&&(t.candle.bar={}),t.candle&&t.candle.type==="point_and_figure"){t.candle.type="candle_solid";const pe="rgba(0,0,0,0)";t.candle.bar={...t.candle.bar,upColor:pe,downColor:pe,noChangeColor:pe,upBorderColor:pe,downBorderColor:pe,noChangeBorderColor:pe,upWickColor:pe,downWickColor:pe,noChangeWickColor:pe},t.candle.priceMark||(t.candle.priceMark={}),t.candle.priceMark.high={show:!1},t.candle.priceMark.low={show:!1}}else if(t.candle&&t.candle.bar){const pe=t.candle.bar,Z=$e=>!$e||$e==="transparent"||$e==="rgba(0,0,0,0)",xe="#26A69A",oe="#EF5350",Pe="#888888";Z(pe.upColor)&&(pe.upColor=xe),Z(pe.downColor)&&(pe.downColor=oe),Z(pe.noChangeColor)&&(pe.noChangeColor=Pe),Z(pe.upBorderColor)&&(pe.upBorderColor=xe),Z(pe.downBorderColor)&&(pe.downBorderColor=oe),Z(pe.noChangeBorderColor)&&(pe.noChangeBorderColor=Pe),Z(pe.upWickColor)&&(pe.upWickColor=xe),Z(pe.downWickColor)&&(pe.downWickColor=oe),Z(pe.noChangeWickColor)&&(pe.noChangeWickColor=Pe),t.candle.bar=pe}try{const pe=(g=(m=(h=e==null?void 0:e.candle)==null?void 0:h.tooltip)==null?void 0:m.title)==null?void 0:g.color;if(pe&&((C=(w=t==null?void 0:t.indicator)==null?void 0:w.tooltip)!=null&&C.title)&&(t.indicator.tooltip.title.color=pe),(I=(P=t==null?void 0:t.indicator)==null?void 0:P.tooltip)!=null&&I.legend&&(t.indicator.tooltip.legend.hideTitle=!0),(M=(A=t==null?void 0:t.indicator)==null?void 0:A.tooltip)!=null&&M.title){const Z=(B=(F=e==null?void 0:e.candle)==null?void 0:F.tooltip)==null?void 0:B.title,xe=t.indicator.tooltip.title;typeof(Z==null?void 0:Z.marginLeft)=="number"?xe.marginLeft=Z.marginLeft:xe.marginLeft=0,typeof(Z==null?void 0:Z.marginTop)=="number"&&(xe.marginTop=Z.marginTop),typeof(Z==null?void 0:Z.marginBottom)=="number"&&(xe.marginBottom=Z.marginBottom),xe.marginRight=4}if((L=($=t==null?void 0:t.indicator)==null?void 0:$.tooltip)!=null&&L.legend){const Z=(Y=(O=e==null?void 0:e.candle)==null?void 0:O.tooltip)==null?void 0:Y.title;typeof(Z==null?void 0:Z.marginLeft)=="number"?t.indicator.tooltip.legend.marginLeft=Z.marginLeft:t.indicator.tooltip.legend.marginLeft=0,t.indicator.tooltip.legend.marginRight=2}(le=(Q=(ce=t==null?void 0:t.indicator)==null?void 0:ce.tooltip)==null?void 0:Q.title)!=null&&le.size&&((fe=(ue=t==null?void 0:t.indicator)==null?void 0:ue.tooltip)!=null&&fe.legend)&&(t.indicator.tooltip.legend.size=t.indicator.tooltip.title.size)}catch{}return t}function gx(n,e){var t,s;return(t=e==null?void 0:e.candle)!=null&&t.type?(console.log("✅ Using chart type from $save.styles:",e.candle.type),e.candle.type):n!=null&&n._originalChartType?(console.log("✅ Using original chart type from marker:",n._originalChartType),n._originalChartType):(s=n==null?void 0:n.candle)!=null&&s.type?(console.log("⚠️ Using chart type from chart.getStyles() (might be converted):",n.candle.type),n.candle.type):(console.log("⚠️ No chart type found, defaulting to candle_solid"),"candle_solid")}function Pb(n){if(!n||n.length===0)return n;const e=[];let t=0,s=0;for(let o=0;o<n.length;o++){const r=n[o],a=(r.open+r.high+r.low+r.close)/4;let l;o===0?l=(r.open+r.close)/2:l=(t+s)/2;const c=Math.max(r.high,l,a),f=Math.min(r.low,l,a),u={...r,open:l,high:c,low:f,close:a};e.push(u),t=l,s=a}return e}function Mb(n,e){if(!Array.isArray(n)||n.length===0)return n;const t=(e==null?void 0:e.method)||"ATR",s=Math.max(1,((e==null?void 0:e.atrLength)??14)|0),o=(e==null?void 0:e.source)||"close",r=!!(e!=null&&e.wick),a=le=>{const ue=Number(le==null?void 0:le.open),fe=Number(le==null?void 0:le.high),pe=Number(le==null?void 0:le.low),Z=Number(le==null?void 0:le.close);return!Number.isFinite(ue)||!Number.isFinite(fe)||!Number.isFinite(pe)||!Number.isFinite(Z)?null:{...le,open:ue,high:fe,low:pe,close:Z,volume:Number.isFinite(Number(le==null?void 0:le.volume))?Number(le.volume):le==null?void 0:le.volume}},l=n.map(a).filter(Boolean);if(l.length===0)return[];const c=le=>{switch(o){case"open":return le.open;case"high":return le.high;case"low":return le.low;default:return le.close}},f=[];let u=null,d=1/0,h=-1/0,m=0;for(let le=0;le<l.length;le++){const ue=l[le];d=Math.min(d,ue.low),h=Math.max(h,ue.high),m+=ue.close;const fe=u==null?Math.max(0,ue.high-ue.low):Math.max(ue.high-ue.low,Math.abs(ue.high-u),Math.abs(ue.low-u));f.push(Math.max(0,fe)),u=ue.close}const g=new Array(f.length).fill(0);let w=0;for(let le=0;le<f.length;le++)w+=f[le],le===s-1?g[le]=w/s:le>=s?g[le]=(g[le-1]*(s-1)+f[le])/s:g[le]=f[le];const C=m/Math.max(1,l.length),P=Number.isFinite(h-d)?Math.max(0,h-d):0,I=g[Math.min(g.length-1,Math.max(0,s-1))]||f.reduce((le,ue)=>le+ue,0)/Math.max(1,f.length);let A=t==="ATR"&&g[g.length-1]||I;if(!Number.isFinite(A)||A<=0){const le=P>0?P/Math.max(50,l.length):Math.abs(C)*.001;A=le>0?le:1}const M=P>0?P/5e3:0,F=Number.isFinite(C)&&C!==0?Math.abs(C)*1e-6:0;A=Math.max(1e-12,A,M,F);const B=200,$=2e4,L=le=>{if(!Number.isFinite(le)||le<=0)return 0;let ue=0,fe=c(l[0]);for(let pe=1;pe<l.length;pe++){const Z=c(l[pe]);if(!Number.isFinite(Z))continue;const xe=Z-fe,oe=Math.floor(Math.abs(xe)/le);if(oe<=0)continue;const Pe=Math.min(oe,B);if(ue+=Pe,fe+=Math.sign(xe)*Pe*le,ue>$*4)return ue}return ue};let O=L(A);for(let le=0;le<3&&O>$;le++){const ue=Math.max(1.2,O/$);A*=ue,O=L(A)}const Y=[];let ce=c(l[0]),Q=l[0]&&typeof l[0].timestamp=="number"&&Number.isFinite(l[0].timestamp)?l[0].timestamp:Date.now();for(let le=1;le<l.length;le++){const ue=l[le],fe=c(ue);if(!Number.isFinite(fe))continue;const pe=fe-ce,Z=pe>0?1:pe<0?-1:0;if(Z===0)continue;let xe=Math.floor(Math.abs(pe)/A);if(!(xe<=0)){xe=Math.min(xe,B);for(let oe=0;oe<xe;oe++){const Pe=ce,$e=ce+Z*A,ze=Math.max(Pe,$e),Ke=Math.min(Pe,$e),qe=oe===xe-1,nt=r&&qe&&Z>0?Math.max(ze,ue.high):ze,ft=r&&qe&&Z<0?Math.min(Ke,ue.low):Ke,ut=typeof ue.timestamp=="number"&&Number.isFinite(ue.timestamp)?ue.timestamp:Q;Q=Math.max(ut,Q+1),Y.push({timestamp:Q,open:Pe,high:nt,low:ft,close:$e,volume:ue.volume??0}),ce=$e}}}if(Y.length===0){const le=l[l.length-1],ue=le.open,fe=le.close,pe=r?le.high:Math.max(ue,fe),Z=r?le.low:Math.min(ue,fe);Y.push({timestamp:typeof le.timestamp=="number"&&Number.isFinite(le.timestamp)?le.timestamp:Q||Date.now(),open:ue,high:pe,low:Z,close:fe,volume:le.volume??0})}return Y}const LB={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};function Nb(n,e){if(!Array.isArray(n)||n.length===0)return n;const t={...LB,...e};let s;if(t.boxSizeMode==="ATR"){const P=Math.max(1,t.atrLength||14),I=[];let A=null;for(let $=0;$<n.length;$++){const L=n[$],O=A==null?Math.max(0,L.high-L.low):Math.max(L.high-L.low,Math.abs(L.high-A),Math.abs(L.low-A));I.push(Math.max(0,O)),A=L.close}const M=new Array(I.length).fill(0);let F=0;for(let $=0;$<I.length;$++)F+=I[$],$===P-1?M[$]=F/P:$>=P?M[$]=(M[$-1]*(P-1)+I[$])/P:M[$]=I[$];const B=M[M.length-1]||I.reduce(($,L)=>$+L,0)/Math.max(1,I.length);s=Math.max(1e-4,B)}else if(t.boxSizeMode==="percent"){const P=n.reduce((I,A)=>I+A.close,0)/n.length;s=Math.max(1e-4,P*t.boxSize/100)}else s=Math.max(1e-4,t.boxSize);const o=s*t.reversalBoxes,r=n[0];let a=r.close>=r.open?"up":"down",l=Math.floor(r.high/s)*s,c=Math.ceil(r.low/s)*s;const f=[];let u=0,d={columnIndex:0,direction:a,boxes:[],highPrice:l,lowPrice:c,startTime:r.timestamp||Date.now(),endTime:r.timestamp||Date.now()};const h=Math.max(1,Math.round((l-c)/s));for(let P=0;P<=h;P++){const I=c+P*s;d.boxes.push({columnIndex:0,direction:a,boxIndex:P,price:I,startTime:d.startTime,endTime:d.endTime})}const m=500;for(let P=1;P<n.length;P++){const I=n[P],A=I.timestamp||Date.now();if(d.endTime=A,a==="up"){const M=Math.floor(I.high/s)*s;if(M>l){let F=Math.round((M-l)/s);F=Math.min(F,m-d.boxes.length);for(let B=1;B<=F;B++){const $=l+B*s;d.boxes.push({columnIndex:u,direction:"up",boxIndex:d.boxes.length,price:$,startTime:A,endTime:A})}l=M,d.highPrice=l}if(l-I.low>=o){const F=Math.ceil(I.low/s)*s;f.push(d),u++,a="down",c=F,d={columnIndex:u,direction:"down",boxes:[],highPrice:l-s,lowPrice:c,startTime:A,endTime:A};let B=Math.round((d.highPrice-c)/s);B=Math.min(B,m);for(let $=0;$<=B;$++){const L=d.highPrice-$*s;d.boxes.push({columnIndex:u,direction:"down",boxIndex:$,price:L,startTime:A,endTime:A})}l=d.highPrice}}else{const M=Math.ceil(I.low/s)*s;if(M<c){let F=Math.round((c-M)/s);F=Math.min(F,m-d.boxes.length);for(let B=1;B<=F;B++){const $=c-B*s;d.boxes.push({columnIndex:u,direction:"down",boxIndex:d.boxes.length,price:$,startTime:A,endTime:A})}c=M,d.lowPrice=c}if(I.high-c>=o){const F=Math.floor(I.high/s)*s;f.push(d),u++,a="up",l=F,d={columnIndex:u,direction:"up",boxes:[],highPrice:l,lowPrice:c+s,startTime:A,endTime:A};let B=Math.round((l-d.lowPrice)/s);B=Math.min(B,m);for(let $=0;$<=B;$++){const L=d.lowPrice+$*s;d.boxes.push({columnIndex:u,direction:"up",boxIndex:$,price:L,startTime:A,endTime:A})}c=d.lowPrice}}}if(d.boxes.length>0&&f.push(d),f.length===0)return n;const g=[],w=Date.now(),C=6e4;for(const P of f){const I=P.startTime||w+P.columnIndex*C;g.push({timestamp:I,open:P.direction==="up"?P.lowPrice:P.highPrice,high:P.highPrice,low:P.lowPrice,close:P.direction==="up"?P.highPrice:P.lowPrice,volume:P.boxes.length,_pnf:{columnIndex:P.columnIndex,direction:P.direction,boxes:P.boxes,boxCount:P.boxes.length,boxSize:s,upColor:t.upColor,downColor:t.downColor}})}return g}function j0(n){return n.exchange&&n.ticker?`${n.exchange.toUpperCase()}:${n.ticker.toUpperCase()}`:(n.ticker||n.name||"UNKNOWN").toUpperCase()}function EB(n,e){var r,a,l,c;const t=[];if(e)try{const f=((r=e.getChartStore)==null?void 0:r.call(e))||e;f&&typeof f.getPanes=="function"?f.getPanes().forEach((d,h)=>{t.push({id:d.id||`pane_${h}`,height:d.height,minHeight:d.minHeight,position:h,visible:d.visible!==!1})}):t.push({id:"candle_pane",height:400,position:0,visible:!0})}catch(f){console.warn("Error collecting pane configurations:",f),t.push({id:"candle_pane",height:400,position:0,visible:!0})}const s=[],o=new Map;if(Object.entries(n.saveInds).forEach(([f,u])=>{var w,C,P,I,A,M,F,B,$,L,O,Y;const d={};u.params&&Array.isArray(u.params)&&u.params.forEach((ce,Q)=>{d[`param_${Q}`]=ce});const h={};u.styles&&Array.isArray(u.styles)?u.styles.forEach((ce,Q)=>{h[`style_${Q}`]=ce}):u.styles&&typeof u.styles=="object"&&Object.assign(h,u.styles);const m={id:f,type:u.name,params:d,styles:h,paneId:u.pane_id,visible:!0,...Object.fromEntries(Object.entries(u).filter(([ce])=>!["name","pane_id","params","styles"].includes(ce)))};if(m.type==="RSI"){const ce=m;if(!ce.rsiGroups||ce.rsiGroups.length===0){const Q=m.paneId||"pane_RSI",le=m0.getInstance(Q)||m0.getInstanceConfig(Q);if(le){const ue=le.overboughtThreshold??((P=(C=(w=le.levels)==null?void 0:w.find)==null?void 0:C.call(w,Z=>Z.id==="overbought"))==null?void 0:P.value)??70,fe=((M=(A=(I=le.levels)==null?void 0:I.find)==null?void 0:A.call(I,Z=>Z.id==="middle"))==null?void 0:M.value)??50,pe=le.oversoldThreshold??(($=(B=(F=le.levels)==null?void 0:F.find)==null?void 0:B.call(F,Z=>Z.id==="oversold"))==null?void 0:$.value)??30;ce.rsiGroups=[{period:le.period??14,overboughtLevel:ue,middleLevel:fe,oversoldLevel:pe,styles:{rsi:{color:le.lineColor??"#8B5CF6",thickness:le.lineThickness??2,lineStyle:le.lineStyle??"solid"},overboughtColor:le.overboughtColor??"#EF4444",oversoldColor:le.oversoldColor??"#10B981",middleLineColor:((Y=(O=(L=le.levels)==null?void 0:L.find)==null?void 0:O.call(L,Z=>Z.id==="middle"))==null?void 0:Y.color)??"#6B7280"}}]}}}const g=`${u.name}_${u.pane_id||"candle_pane"}`;o.set(g,m)}),e)try{const f=((a=e.getIndicators)==null?void 0:a.call(e))??[];console.log("📊 Collecting indicators from chart:",f.length,"found"),f.forEach(u=>{if(!u.name)return;const d=u.paneId||"candle_pane",h=`${u.name}_${d}`;if(o.has(h)){console.log(`✅ Indicator ${u.name} (${d}) already in saveInds`);return}console.log(`⚠️ Indicator ${u.name} (${d}) on chart but not in saveInds`);let m=null,g=null;for(const[w,C]of Object.entries(n.saveInds))if(C.name===u.name&&(C.pane_id===d||!C.pane_id&&d==="candle_pane")){m=C,g=w;break}if(m&&g){console.log(`✅ Found matching saveInd for ${u.name} with key: ${g}`);const w={};m.params&&Array.isArray(m.params)&&m.params.forEach((I,A)=>{w[`param_${A}`]=I});const C={};m.styles&&Array.isArray(m.styles)?m.styles.forEach((I,A)=>{C[`style_${A}`]=I}):m.styles&&typeof m.styles=="object"&&Object.assign(C,m.styles);const P={id:g,type:m.name,params:w,styles:C,paneId:m.pane_id||d,visible:!0,...Object.fromEntries(Object.entries(m).filter(([I])=>!["name","pane_id","params","styles"].includes(I)))};o.set(h,P)}else{if(u.name==="RSI"){console.log(`♻️ Skipping fallback SavedIndicator creation for RSI on pane ${d} (no matching saveInd)`);return}console.log(`⚠️ No matching saveInd found for ${u.name}, creating basic entry`);const C={id:`${d}_${u.name}`,type:u.name,params:{},styles:{},paneId:d,visible:!0};o.set(h,C)}})}catch(f){console.warn("⚠️ Failed to get indicators from chart, using saveInds only:",f)}return s.push(...Array.from(o.values())),console.log(`✅ Collected ${s.length} indicators for saving (${Object.keys(n.saveInds).length} from saveInds, ${s.length-Object.keys(n.saveInds).length} from chart)`),{timezone:n.timezone,interval:n.period.timeframe,chartType:((c=(l=n.styles)==null?void 0:l.candle)==null?void 0:c.type)||"candle_solid",theme:n.theme,panes:t,indicators:s,styles:n.styles||{},options:n.options||{}}}async function $B(n,e,t){var s,o,r,a,l,c,f,u,d,h,m,g,w,C,P,I,A,M,F,B,$,L,O,Y,ce,Q,le,ue,fe,pe,Z,xe,oe,Pe;try{if(console.log("🔄 Applying global state:",n),t){try{t.removeIndicator({}),console.log("🧹 Removed all existing indicators before applying new layout")}catch(ut){console.warn("Failed to clear existing indicators before applying layout:",ut)}try{const{RSIManager:ut}=await Bg(async()=>{const{RSIManager:bt}=await Promise.resolve().then(()=>_k);return{RSIManager:bt}},void 0,import.meta.url);ut.clearAllInstances()}catch{}}const $e={},ze=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"],Ke=(s=vm(O0))==null?void 0:s.data,qe=Ke&&(Ke.isPremium===!0||Ke.isTrial===!0),nt=[],ft=new Set;if(n.indicators.forEach(ut=>{if(ut.type==="RSI"){const bt=ut.rsiGroups,Pt=Array.isArray(bt)&&bt.length>0&&(bt[0].actualPaneId||bt[0].paneId)||ut.paneId;if(Pt){if(ft.has(Pt)){console.log("♻️ Skipping duplicate RSI indicator for pane:",Pt);return}ft.add(Pt),ut.paneId=Pt,ut.id=`${Pt}_RSI`,Array.isArray(bt)&&bt.length>0&&(bt[0].paneId=Pt,bt[0].actualPaneId=Pt)}}nt.push(ut)}),nt.forEach(ut=>{if(!qe&&ut.type&&ze.includes(ut.type)){console.log(`🔒 Skipping AI indicator ${ut.type} - user does not have premium access`);return}const bt=[];ut.params&&typeof ut.params=="object"&&Object.entries(ut.params).forEach(([Mt,Je])=>{if(Mt.startsWith("param_")){const Ct=parseInt(Mt.replace("param_",""));bt[Ct]=Je}});const Pt=[];ut.styles&&typeof ut.styles=="object"&&Object.entries(ut.styles).forEach(([Mt,Je])=>{if(Mt.startsWith("style_")&&typeof Je=="object"){const Ct=parseInt(Mt.replace("style_",""));Pt[Ct]=Je}});const Et={name:ut.type,pane_id:ut.paneId,params:bt.length>0?bt:void 0,styles:Pt.length>0?Pt:void 0,...Object.fromEntries(Object.entries(ut).filter(([Mt])=>!["id","type","paneId","params","styles","visible"].includes(Mt)))};$e[ut.id]=Et}),e.update(ut=>{ut.timezone=n.timezone,ut.period={...ut.period,timeframe:n.interval};const bt=n.styles&&typeof n.styles=="object"?{...n.styles}:{},Pt=ut.theme||n.theme||"dark";if((n.theme||Pt)!==Pt)try{const Mt=fp(Pt),Je=An.merge({},Mt,bt);delete Je.backgroundColor,delete Je.backgroundOpacity,delete Je.backgroundType,delete Je.backgroundGradient,delete Je.gridColor,delete Je.gridOpacity,delete Je.gridType,delete Je.gridGradient,ut.styles=Je}catch{ut.styles=bt}else ut.styles=bt;return ut.styles.candle||(ut.styles.candle={}),ut.styles.candle.type=n.chartType,ut.options=n.options&&typeof n.options=="object"?{...n.options}:{},ut.saveInds=$e,ut}),t)try{const ut=vm(e);t.setStyles&&ut.styles&&(t.setStyles(ut.styles),console.log("🎨 Applied saved styles to chart"))}catch(ut){console.warn("Failed to apply saved styles to chart:",ut)}if(t&&nt.length>0){console.log("Creating indicators on chart:",nt.length);for(const ut of nt)try{const bt=[];ut.params&&typeof ut.params=="object"&&Object.entries(ut.params).forEach(([Ct,Ze])=>{if(Ct.startsWith("param_")){const Xe=parseInt(Ct.replace("param_",""));bt[Xe]=Ze}});const Pt=[];ut.styles&&typeof ut.styles=="object"&&Object.entries(ut.styles).forEach(([Ct,Ze])=>{if(Ct.startsWith("style_")&&typeof Ze=="object"){const Xe=parseInt(Ct.replace("style_",""));Pt[Xe]=Ze}});const Et={name:ut.type,calcParams:bt.length>0?bt:void 0,visible:ut.visible!==!1};if(Pt.length>0&&(Et.styles={lines:Pt.map(Ct=>{const Ze=Ct.lineStyle==="dashed"||Ct.lineStyle==="dotted",Xe=Ct.lineStyle==="dotted"?[2,2]:[4,4];return{color:Ct.color,size:Ct.thickness??1,style:Ze?wt.Dashed:wt.Solid,dashedValue:Ze?Xe:[2,2]}})}),ut.type==="SMARTTREND"){const Ct=ut.superTrendGroup,Ze=Ct?{showLabels:!!Ct.showLabels,uptrendColor:((r=(o=Ct.styles)==null?void 0:o.uptrend)==null?void 0:r.color)??"#00FF00",downtrendColor:((l=(a=Ct.styles)==null?void 0:a.downtrend)==null?void 0:l.color)??"#FF0000",uptrendThickness:((f=(c=Ct.styles)==null?void 0:c.uptrend)==null?void 0:f.thickness)??1,downtrendThickness:((d=(u=Ct.styles)==null?void 0:u.downtrend)==null?void 0:d.thickness)??1,uptrendLineStyle:((m=(h=Ct.styles)==null?void 0:h.uptrend)==null?void 0:m.lineStyle)??"dashed",downtrendLineStyle:((w=(g=Ct.styles)==null?void 0:g.downtrend)==null?void 0:w.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"};if(Et.extendData=Ze,!Et.styles){const Xe=Ze.uptrendLineStyle==="dotted"||Ze.uptrendLineStyle==="dashed";Et.styles={lines:[{color:Ze.uptrendColor,size:Ze.uptrendThickness,style:Xe?wt.Dashed:wt.Solid,dashedValue:Ze.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}if(ut.type==="RSI"){const Ct=ut.rsiGroups||[],Ze=ut.paneId;if(Array.isArray(Ct)&&Ct.length>0){const Xe=Ct[0],Ae=((C=Xe.styles)==null?void 0:C.overboughtColor)??"#EF4444",Qe=((P=Xe.styles)==null?void 0:P.oversoldColor)??"#22C55E",gt=((I=Xe.styles)==null?void 0:I.middleLineColor)??"#6B7280",Ft=Xe.fillOpacity??.15,ot=((A=Xe.styles)==null?void 0:A.overboughtThickness)??1,ve=((M=Xe.styles)==null?void 0:M.oversoldThickness)??1,Ie=((F=Xe.styles)==null?void 0:F.middleLineThickness)??1,It=((B=Xe.styles)==null?void 0:B.overboughtLineStyle)??"dashed",Dt=(($=Xe.styles)==null?void 0:$.oversoldLineStyle)??"dashed",Zt=((L=Xe.styles)==null?void 0:L.middleLineStyle)??"dashed",gn={id:Ze,period:Xe.period??14,lineColor:((Y=(O=Xe.styles)==null?void 0:O.rsi)==null?void 0:Y.color)??"#8B5CF6",lineThickness:((Q=(ce=Xe.styles)==null?void 0:ce.rsi)==null?void 0:Q.thickness)??2,lineStyle:((ue=(le=Xe.styles)==null?void 0:le.rsi)==null?void 0:ue.lineStyle)??"solid",overboughtLevel:Xe.overboughtLevel??70,oversoldLevel:Xe.oversoldLevel??30,middleLevel:Xe.middleLevel??50,overboughtColor:Ae,overboughtThickness:ot,overboughtLineStyle:It,oversoldColor:Qe,oversoldThickness:ve,oversoldLineStyle:Dt,overboughtFillColor:Ae,oversoldFillColor:Qe,middleLineColor:gt,middleLineThickness:Ie,middleLineStyle:Zt,fillOpacity:Ft,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:Xe.overboughtLevel??70,color:Ae,lineStyle:It,thickness:ot,label:String(Xe.overboughtLevel??70),visible:!0},{id:"middle",value:Xe.middleLevel??50,color:gt,lineStyle:Zt,thickness:Ie,label:String(Xe.middleLevel??50),visible:!0},{id:"oversold",value:Xe.oversoldLevel??30,color:Qe,lineStyle:Dt,thickness:ve,label:String(Xe.oversoldLevel??30),visible:!0}]};try{const{RSIManager:On}=await Bg(async()=>{const{RSIManager:bn}=await Promise.resolve().then(()=>_k);return{RSIManager:bn}},void 0,import.meta.url);On.importInstanceConfig(gn)}catch{}Et.calcParams=[Xe.period??14];const hn={color:((pe=(fe=Xe.styles)==null?void 0:fe.rsi)==null?void 0:pe.color)??"#8B5CF6",size:((xe=(Z=Xe.styles)==null?void 0:Z.rsi)==null?void 0:xe.thickness)??2,style:wt.Solid,dashedValue:[2,2]},qn=(Pe=(oe=Xe.styles)==null?void 0:oe.rsi)==null?void 0:Pe.lineStyle;qn==="dashed"?(hn.style=wt.Dashed,hn.dashedValue=[6,4]):qn==="dotted"&&(hn.style=wt.Dashed,hn.dashedValue=[2,2]),Et.styles={lines:[hn]}}}const Mt=ut.paneId==="candle_pane",Je=t.createIndicator(Et,Mt,{id:ut.paneId});console.log(`Created indicator ${ut.type} with ID:`,Je)}catch(bt){console.error(`Failed to create indicator ${ut.type}:`,bt)}}console.log("Applied global state:",{timezone:n.timezone,interval:n.interval,chartType:n.chartType,theme:n.theme,indicatorCount:nt.length,indicatorsCreated:t?nt.length:0})}catch($e){throw console.error("Error applying global state:",$e),$e}}function l5(n){return j0(n.symbol)}class DB{constructor(e){Te(this,"chart");Te(this,"persistenceKey");Te(this,"currentSymbol",null);Te(this,"ephemeralMode",!0);Te(this,"drawingsBySymbol",new Map);Te(this,"renderedDrawingIds",new Set);Te(this,"onDrawingCreated");Te(this,"onDrawingRemoved");Te(this,"onSymbolChanged");Te(this,"symbolChangeCallbacks",new Set);this.chart=e.chart,this.persistenceKey=e.persistenceKey,this.onDrawingCreated=e.onDrawingCreated,this.onDrawingRemoved=e.onDrawingRemoved,this.onSymbolChanged=e.onSymbolChanged,this.ephemeralMode||this.loadFromStorage(),console.log("✅ DrawingManager initialized with key:",this.persistenceKey)}setCurrentSymbol(e){var o;const t=typeof e=="string"?e:j0(e);if(this.currentSymbol===t){console.log("🔄 Symbol unchanged, skipping reload:",t);return}const s=this.currentSymbol;this.currentSymbol=t,console.log(`🔄 Symbol changed: ${s} → ${t}`),this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol(),s&&((o=this.onSymbolChanged)==null||o.call(this,s,t),this.symbolChangeCallbacks.forEach(r=>r(t)))}getCurrentSymbol(){return this.currentSymbol}addDrawing(e){var o;if(!e.symbolKey)throw console.error("❌ Cannot add drawing without symbolKey:",e),new Error("Drawing must have a symbolKey");let t=this.drawingsBySymbol.get(e.symbolKey);t||(t=[],this.drawingsBySymbol.set(e.symbolKey,t));const s=t.findIndex(r=>r.id===e.id);s>=0?(t[s]=e,console.log("🔄 Updated drawing:",e.id,"for symbol:",e.symbolKey)):(t.push(e),console.log("➕ Added drawing:",e.id,"for symbol:",e.symbolKey)),this.saveToStorage(),e.symbolKey===this.currentSymbol&&e.visible!==!1&&this.renderDrawing(e),(o=this.onDrawingCreated)==null||o.call(this,e)}removeDrawing(e){var o,r;let t=!1,s=null;for(const[a,l]of this.drawingsBySymbol.entries()){const c=l.findIndex(f=>f.id===e);if(c>=0){l.splice(c,1),t=!0,s=a,console.log("🗑️ Removed drawing:",e,"from symbol:",a);break}}return t&&(s&&((o=this.drawingsBySymbol.get(s))==null?void 0:o.length)===0&&this.drawingsBySymbol.delete(s),this.saveToStorage(),this.renderedDrawingIds.has(e)&&(this.chart.removeOverlay({id:e}),this.renderedDrawingIds.delete(e)),s&&((r=this.onDrawingRemoved)==null||r.call(this,e,s))),t}removeDrawingForSymbol(e,t){var r;const s=this.drawingsBySymbol.get(t);if(!s)return!1;const o=s.findIndex(a=>a.id===e);return o<0?!1:(s.splice(o,1),s.length===0&&this.drawingsBySymbol.delete(t),this.saveToStorage(),this.renderedDrawingIds.has(e)&&(this.chart.removeOverlay({id:e}),this.renderedDrawingIds.delete(e)),(r=this.onDrawingRemoved)==null||r.call(this,e,t),!0)}getDrawingsForSymbol(e){return this.drawingsBySymbol.get(e)||[]}getCurrentSymbolDrawings(){return this.currentSymbol?this.getDrawingsForSymbol(this.currentSymbol):[]}getAllDrawings(){return new Map(this.drawingsBySymbol)}clearDrawingsForSymbol(e){const t=this.drawingsBySymbol.get(e);t&&(e===this.currentSymbol&&t.forEach(s=>{this.renderedDrawingIds.has(s.id)&&(this.chart.removeOverlay({id:s.id}),this.renderedDrawingIds.delete(s.id))}),this.drawingsBySymbol.delete(e),this.saveToStorage(),console.log("🗑️ Cleared all drawings for symbol:",e))}clearCurrentSymbolDrawings(){this.currentSymbol&&this.clearDrawingsForSymbol(this.currentSymbol)}clearRenderedDrawings(){this.renderedDrawingIds.forEach(e=>{try{this.chart.removeOverlay({id:e})}catch(t){console.warn("Failed to remove overlay:",e,t)}}),this.renderedDrawingIds.clear(),console.log("🧹 Cleared rendered drawings from chart")}hideRenderedDrawings(){this.clearRenderedDrawings()}renderDrawingsForCurrentSymbol(){if(!this.currentSymbol){console.log("⚠️ No current symbol, skipping render");return}const e=this.getDrawingsForSymbol(this.currentSymbol);console.log(`🎨 Rendering ${e.length} drawings for symbol:`,this.currentSymbol),e.forEach(t=>{t.visible!==!1&&this.renderDrawing(t)})}renderCurrentSymbolDrawings(){this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()}renderDrawing(e){var t;if(e.symbolKey!==this.currentSymbol){console.warn("⛔ Drawing symbolKey mismatch, skipping render:",{drawingSymbol:e.symbolKey,currentSymbol:this.currentSymbol});return}try{const s={id:e.id,groupId:"drawing_tools",name:e.type,points:e.points.map(r=>({timestamp:r.time,value:r.price,t:r.time,p:r.price})),styles:e.styles,lock:e.locked,visible:e.visible,onSelected:r=>{try{const a=typeof window<"u"?window.drawBarRef:null;a!=null&&a.externalSelectOverlay&&a.externalSelectOverlay(r.overlay)}catch{}return!0},onDeselected:r=>{try{const a=typeof window<"u"?window.drawBarRef:null;a!=null&&a.externalDeselectOverlay&&a.externalDeselectOverlay(r.overlay)}catch{}return!0},onPressedMoveEnd:r=>{try{const a=typeof window<"u"?window.drawBarRef:null;a!=null&&a.externalSyncOverlay&&a.externalSyncOverlay(r.overlay)}catch{}return!0},onRemoved:r=>{try{const a=typeof window<"u"?window.drawBarRef:null;a!=null&&a.externalRemoved&&a.externalRemoved(r.overlay.id)}catch{}return!0},...Object.fromEntries(Object.entries(e).filter(([r])=>!["id","symbolKey","type","points","styles","locked","visible","seriesId"].includes(r)))};if(this.chart.createOverlay(s)){this.renderedDrawingIds.add(e.id);try{const r=typeof window<"u"?window.drawBarRef:null;(t=r==null?void 0:r.externalEnsureCrossPaneLines)==null||t.call(r)}catch{}console.log("✅ Rendered drawing:",e.id,"for symbol:",e.symbolKey)}}catch(s){console.error("❌ Failed to render drawing:",e.id,s)}}updateDrawing(e,t){for(const[s,o]of this.drawingsBySymbol.entries()){const r=o.findIndex(a=>a.id===e);if(r>=0){const a=o[r];return o[r]={...a,...t,symbolKey:a.symbolKey},this.saveToStorage(),console.log("🔄 Updated drawing:",e),!0}}return!1}loadDrawingsForSymbol(e,t){const s=t.filter(o=>o.symbolKey!==e?(console.warn("⚠️ Drawing symbolKey mismatch during bulk load:",{expected:e,actual:o.symbolKey,drawingId:o.id}),!1):!0);this.drawingsBySymbol.set(e,s),this.saveToStorage(),e===this.currentSymbol&&(this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()),console.log(`📥 Loaded ${s.length} drawings for symbol:`,e)}loadAllDrawings(e){this.drawingsBySymbol.clear(),Object.entries(e).forEach(([t,s])=>{const o=s.filter(r=>(r.symbolKey||(console.warn("⚠️ Drawing missing symbolKey, assigning:",t),r.symbolKey=t),!0));this.drawingsBySymbol.set(t,o)}),this.saveToStorage(),this.currentSymbol&&(this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()),console.log("📥 Loaded drawings for",this.drawingsBySymbol.size,"symbols")}saveToStorage(){if(!this.ephemeralMode)try{const e={drawingsBySymbol:Object.fromEntries(this.drawingsBySymbol),version:1};localStorage.setItem(this.persistenceKey,JSON.stringify(e))}catch(e){console.error("❌ Failed to save drawings to storage:",e)}}clearPersistedStorage(){try{localStorage.removeItem(this.persistenceKey),console.log("🧹 Cleared persisted drawing storage for key:",this.persistenceKey)}catch(e){console.warn("Failed to clear persisted drawing storage:",e)}}loadFromStorage(){if(!this.ephemeralMode)try{const e=localStorage.getItem(this.persistenceKey);if(!e){console.log("📭 No stored drawings found");return}const t=JSON.parse(e);if(!t.version){console.log("🔄 Migrating legacy drawing storage..."),this.migrateLegacyStorage(t);return}Object.entries(t.drawingsBySymbol||{}).forEach(([s,o])=>{const r=o.map(a=>(a.symbolKey||(a.symbolKey=s),a));this.drawingsBySymbol.set(s,r)}),console.log("📂 Loaded drawings from storage:",this.drawingsBySymbol.size,"symbols")}catch(e){console.error("❌ Failed to load drawings from storage:",e),this.drawingsBySymbol.clear()}}migrateLegacyStorage(e){if(console.log("🔄 Starting migration of legacy overlay format..."),typeof e=="object"&&!e.drawingsBySymbol){const t={};Object.entries(e).forEach(([s,o])=>{try{const r=s.split("_");if(r.length<3){console.warn("⚠️ Invalid legacy key format:",s);return}const a=r[r.length-1],l=r[r.length-2],f=r.slice(0,-2).join("_").toUpperCase(),u=this.convertLegacyOverlayToDrawing(a,o,f);u&&(t[f]||(t[f]=[]),t[f].push(u))}catch(r){console.warn("⚠️ Failed to migrate legacy overlay:",s,r)}}),Object.entries(t).forEach(([s,o])=>{this.drawingsBySymbol.set(s,o)}),this.saveToStorage(),console.log("✅ Migration complete:",this.drawingsBySymbol.size,"symbols migrated")}}convertLegacyOverlayToDrawing(e,t,s){try{const o=[];return t.points&&Array.isArray(t.points)&&t.points.forEach(r=>{r&&typeof r=="object"&&(r.timestamp&&r.value!==void 0?o.push({time:r.timestamp,price:r.value}):r.time&&r.price!==void 0?o.push({time:r.time,price:r.price}):r.t&&r.p!==void 0&&o.push({time:r.t,price:r.p}))}),o.length===0?(console.warn("Legacy overlay has no valid data coordinates:",e),null):{id:e,symbolKey:s,type:t.name||"unknown",points:o,styles:t.styles||{},locked:!!t.lock,visible:t.visible!==!1,...Object.fromEntries(Object.entries(t).filter(([r])=>!["name","points","styles","lock","visible"].includes(r)))}}catch(o){return console.warn("Error converting legacy overlay to drawing:",e,o),null}}onSymbolChange(e){this.symbolChangeCallbacks.add(e)}offSymbolChange(e){this.symbolChangeCallbacks.delete(e)}exportDrawings(){return Object.fromEntries(this.drawingsBySymbol)}getStats(){let e=0;return this.drawingsBySymbol.forEach(t=>{e+=t.length}),{totalSymbols:this.drawingsBySymbol.size,totalDrawings:e,currentSymbolDrawings:this.getCurrentSymbolDrawings().length,renderedDrawings:this.renderedDrawingIds.size}}destroy(){this.clearRenderedDrawings(),this.symbolChangeCallbacks.clear(),this.drawingsBySymbol.clear(),console.log("🗑️ DrawingManager destroyed")}}let J1=null;function RB(n){return J1&&(console.warn("⚠️ DrawingManager already initialized, destroying old instance"),J1.destroy()),J1=new DB(n),J1}function e0(){return J1}class jB{constructor(){Te(this,"state",$m({undoStack:[],redoStack:[],maxHistorySize:50}));Te(this,"chart",null);Te(this,"saveStore",null);Te(this,"overlaysStore",null)}init({chart:e,saveStore:t,overlaysStore:s}){this.chart=e,this.saveStore=t,this.overlaysStore=s}addAction(e){this.state.update(t=>(t.redoStack=[],t.undoStack.push(e),t.undoStack.length>t.maxHistorySize&&t.undoStack.shift(),t))}recordAddIndicator(e,t,s,o){const r={type:"ADD_INDICATOR",data:{name:e,paneId:t,params:s,saveKey:o},timestamp:Date.now(),id:`indicator_${e}_${t}_${Date.now()}`};this.addAction(r)}recordRemoveIndicator(e,t,s,o){const r={type:"REMOVE_INDICATOR",data:{name:e,paneId:t,params:s,saveKey:o},timestamp:Date.now(),id:`indicator_${e}_${t}_${Date.now()}`};this.addAction(r)}recordAddOverlay(e,t,s){const o={type:"ADD_OVERLAY",data:{overlayId:e,overlayData:t,overlayKey:s},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(o)}recordRemoveOverlay(e,t,s){const o={type:"REMOVE_OVERLAY",data:{overlayId:e,overlayData:t,overlayKey:s},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(o)}recordModifyOverlay(e,t,s,o){const r={type:"MODIFY_OVERLAY",data:{overlayId:e,prevData:t,nextData:s,overlayKey:o},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(r)}undo(){const e=vm(this.state);if(e.undoStack.length===0)return!1;const t=e.undoStack[e.undoStack.length-1],s=this.executeUndo(t);return s&&this.state.update(o=>{const r=o.undoStack.pop();return r&&o.redoStack.push(r),o}),s}redo(){const e=vm(this.state);if(e.redoStack.length===0)return!1;const t=e.redoStack[e.redoStack.length-1],s=this.executeRedo(t);return s&&this.state.update(o=>{const r=o.redoStack.pop();return r&&o.undoStack.push(r),o}),s}executeUndo(e){var t,s,o,r,a;if(!this.chart)return!1;try{switch(e.type){case"ADD_INDICATOR":this.chart.removeIndicator({paneId:e.data.paneId,name:e.data.name}),this.saveStore&&this.saveStore.update(f=>(delete f.saveInds[e.data.saveKey],f));break;case"REMOVE_INDICATOR":const l=this.chart.createIndicator({name:e.data.name,calcParams:e.data.params},!1,{id:e.data.paneId});this.saveStore&&l&&this.saveStore.update(f=>(f.saveInds[e.data.saveKey]={name:e.data.name,pane_id:e.data.paneId,params:e.data.params},f));break;case"ADD_OVERLAY":this.chart.removeOverlay({id:e.data.overlayId}),this.overlaysStore&&this.overlaysStore.update(f=>(delete f[e.data.overlayKey],f));try{const f=e0();f&&f.removeDrawing(e.data.overlayId)}catch{}break;case"REMOVE_OVERLAY":const c=this.chart.createOverlay(e.data.overlayData);this.overlaysStore&&c&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.overlayData,f));try{const f=e0();if(f){const u=vm(this.saveStore),d=j0(u.symbol),h=e.data.overlayData,m=Array.isArray(h==null?void 0:h.points)?h.points.map(g=>({time:(g==null?void 0:g.timestamp)??(g==null?void 0:g.t)??0,price:(g==null?void 0:g.value)??(g==null?void 0:g.p)??0})):[];if(m.length>0){const g={id:e.data.overlayId,symbolKey:d,type:(h==null?void 0:h.name)||"unknown",points:m,styles:(h==null?void 0:h.styles)||{},...h!=null&&h.extendData?{extendData:h.extendData}:{},locked:!!(h!=null&&h.lock),visible:(h==null?void 0:h.visible)!==!1};f.addDrawing(g)}}}catch{}break;case"MODIFY_OVERLAY":this.chart.overrideOverlay({id:e.data.overlayId,styles:(t=e.data.prevData)==null?void 0:t.styles,extendData:(s=e.data.prevData)==null?void 0:s.extendData,points:(o=e.data.prevData)==null?void 0:o.points,lock:(r=e.data.prevData)==null?void 0:r.lock,visible:(a=e.data.prevData)==null?void 0:a.visible}),this.overlaysStore&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.prevData,f));try{const f=e0();if(f){const u=e.data.prevData,d=Array.isArray(u==null?void 0:u.points)?u.points.map(h=>({time:(h==null?void 0:h.timestamp)??(h==null?void 0:h.t)??0,price:(h==null?void 0:h.value)??(h==null?void 0:h.p)??0})):[];f.updateDrawing(e.data.overlayId,{points:d,styles:(u==null?void 0:u.styles)||{},extendData:u==null?void 0:u.extendData,locked:!!(u!=null&&u.lock),visible:(u==null?void 0:u.visible)!==!1})}}catch{}break;default:return!1}return!0}catch(l){return console.error("Error executing undo:",l),!1}}executeRedo(e){var t,s,o,r,a;if(!this.chart)return!1;try{switch(e.type){case"ADD_INDICATOR":const l=this.chart.createIndicator({name:e.data.name,calcParams:e.data.params},!1,{id:e.data.paneId});this.saveStore&&l&&this.saveStore.update(f=>(f.saveInds[e.data.saveKey]={name:e.data.name,pane_id:e.data.paneId,params:e.data.params},f));break;case"REMOVE_INDICATOR":this.chart.removeIndicator({paneId:e.data.paneId,name:e.data.name}),this.saveStore&&this.saveStore.update(f=>(delete f.saveInds[e.data.saveKey],f));break;case"ADD_OVERLAY":const c=this.chart.createOverlay(e.data.overlayData);this.overlaysStore&&c&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.overlayData,f));try{const f=e0();if(f){const u=vm(this.saveStore),d=j0(u.symbol),h=e.data.overlayData,m=Array.isArray(h==null?void 0:h.points)?h.points.map(g=>({time:(g==null?void 0:g.timestamp)??(g==null?void 0:g.t)??0,price:(g==null?void 0:g.value)??(g==null?void 0:g.p)??0})):[];if(m.length>0){const g={id:e.data.overlayId,symbolKey:d,type:(h==null?void 0:h.name)||"unknown",points:m,styles:(h==null?void 0:h.styles)||{},...h!=null&&h.extendData?{extendData:h.extendData}:{},locked:!!(h!=null&&h.lock),visible:(h==null?void 0:h.visible)!==!1};f.addDrawing(g)}}}catch{}break;case"REMOVE_OVERLAY":this.chart.removeOverlay({id:e.data.overlayId}),this.overlaysStore&&this.overlaysStore.update(f=>(delete f[e.data.overlayKey],f));try{const f=e0();f&&f.removeDrawing(e.data.overlayId)}catch{}break;case"MODIFY_OVERLAY":this.chart.overrideOverlay({id:e.data.overlayId,styles:(t=e.data.nextData)==null?void 0:t.styles,extendData:(s=e.data.nextData)==null?void 0:s.extendData,points:(o=e.data.nextData)==null?void 0:o.points,lock:(r=e.data.nextData)==null?void 0:r.lock,visible:(a=e.data.nextData)==null?void 0:a.visible}),this.overlaysStore&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.nextData,f));try{const f=e0();if(f){const u=e.data.nextData,d=Array.isArray(u==null?void 0:u.points)?u.points.map(h=>({time:(h==null?void 0:h.timestamp)??(h==null?void 0:h.t)??0,price:(h==null?void 0:h.value)??(h==null?void 0:h.p)??0})):[];f.updateDrawing(e.data.overlayId,{points:d,styles:(u==null?void 0:u.styles)||{},extendData:u==null?void 0:u.extendData,locked:!!(u!=null&&u.lock),visible:(u==null?void 0:u.visible)!==!1})}}catch{}break;default:return!1}return!0}catch(l){return console.error("Error executing redo:",l),!1}}canUndo(){return vm(this.state).undoStack.length>0}canRedo(){return vm(this.state).redoStack.length>0}getState(){return this.state}clearHistory(){this.state.update(e=>({...e,undoStack:[],redoStack:[]}))}}const Fp=new jB,BB={"😀":{name:"grinning face",slug:"grinning_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😃":{name:"grinning face with big eyes",slug:"grinning_face_with_big_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😄":{name:"grinning face with smiling eyes",slug:"grinning_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😁":{name:"beaming face with smiling eyes",slug:"beaming_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😆":{name:"grinning squinting face",slug:"grinning_squinting_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😅":{name:"grinning face with sweat",slug:"grinning_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤣":{name:"rolling on the floor laughing",slug:"rolling_on_the_floor_laughing",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"😂":{name:"face with tears of joy",slug:"face_with_tears_of_joy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙂":{name:"slightly smiling face",slug:"slightly_smiling_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🙃":{name:"upside-down face",slug:"upside_down_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫠":{name:"melting face",slug:"melting_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😉":{name:"winking face",slug:"winking_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😊":{name:"smiling face with smiling eyes",slug:"smiling_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😇":{name:"smiling face with halo",slug:"smiling_face_with_halo",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥰":{name:"smiling face with hearts",slug:"smiling_face_with_hearts",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"😍":{name:"smiling face with heart-eyes",slug:"smiling_face_with_heart_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤩":{name:"star-struck",slug:"star_struck",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😘":{name:"face blowing a kiss",slug:"face_blowing_a_kiss",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😗":{name:"kissing face",slug:"kissing_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☺️":{name:"smiling face",slug:"smiling_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😚":{name:"kissing face with closed eyes",slug:"kissing_face_with_closed_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😙":{name:"kissing face with smiling eyes",slug:"kissing_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥲":{name:"smiling face with tear",slug:"smiling_face_with_tear",group:"Smileys & Emotion",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"😋":{name:"face savoring food",slug:"face_savoring_food",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😛":{name:"face with tongue",slug:"face_with_tongue",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😜":{name:"winking face with tongue",slug:"winking_face_with_tongue",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤪":{name:"zany face",slug:"zany_face",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😝":{name:"squinting face with tongue",slug:"squinting_face_with_tongue",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤑":{name:"money-mouth face",slug:"money_mouth_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤗":{name:"smiling face with open hands",slug:"smiling_face_with_open_hands",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤭":{name:"face with hand over mouth",slug:"face_with_hand_over_mouth",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🫢":{name:"face with open eyes and hand over mouth",slug:"face_with_open_eyes_and_hand_over_mouth",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🫣":{name:"face with peeking eye",slug:"face_with_peeking_eye",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🤫":{name:"shushing face",slug:"shushing_face",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤔":{name:"thinking face",slug:"thinking_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫡":{name:"saluting face",slug:"saluting_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🤐":{name:"zipper-mouth face",slug:"zipper_mouth_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤨":{name:"face with raised eyebrow",slug:"face_with_raised_eyebrow",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😐":{name:"neutral face",slug:"neutral_face",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"😑":{name:"expressionless face",slug:"expressionless_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😶":{name:"face without mouth",slug:"face_without_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫥":{name:"dotted line face",slug:"dotted_line_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😶‍🌫️":{name:"face in clouds",slug:"face_in_clouds",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"😏":{name:"smirking face",slug:"smirking_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😒":{name:"unamused face",slug:"unamused_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙄":{name:"face with rolling eyes",slug:"face_with_rolling_eyes",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😬":{name:"grimacing face",slug:"grimacing_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😮‍💨":{name:"face exhaling",slug:"face_exhaling",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"🤥":{name:"lying face",slug:"lying_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫨":{name:"shaking face",slug:"shaking_face",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🙂‍↔️":{name:"head shaking horizontally",slug:"head_shaking_horizontally",group:"Smileys & Emotion",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🙂‍↕️":{name:"head shaking vertically",slug:"head_shaking_vertically",group:"Smileys & Emotion",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"😌":{name:"relieved face",slug:"relieved_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😔":{name:"pensive face",slug:"pensive_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😪":{name:"sleepy face",slug:"sleepy_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤤":{name:"drooling face",slug:"drooling_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"😴":{name:"sleeping face",slug:"sleeping_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫩":{name:"face with bags under eyes",slug:"face_with_bags_under_eyes",group:"Smileys & Emotion",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"😷":{name:"face with medical mask",slug:"face_with_medical_mask",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤒":{name:"face with thermometer",slug:"face_with_thermometer",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤕":{name:"face with head-bandage",slug:"face_with_head_bandage",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤢":{name:"nauseated face",slug:"nauseated_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🤮":{name:"face vomiting",slug:"face_vomiting",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤧":{name:"sneezing face",slug:"sneezing_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥵":{name:"hot face",slug:"hot_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥶":{name:"cold face",slug:"cold_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥴":{name:"woozy face",slug:"woozy_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"😵":{name:"face with crossed-out eyes",slug:"face_with_crossed_out_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😵‍💫":{name:"face with spiral eyes",slug:"face_with_spiral_eyes",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"🤯":{name:"exploding head",slug:"exploding_head",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤠":{name:"cowboy hat face",slug:"cowboy_hat_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥳":{name:"partying face",slug:"partying_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥸":{name:"disguised face",slug:"disguised_face",group:"Smileys & Emotion",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"😎":{name:"smiling face with sunglasses",slug:"smiling_face_with_sunglasses",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤓":{name:"nerd face",slug:"nerd_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧐":{name:"face with monocle",slug:"face_with_monocle",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😕":{name:"confused face",slug:"confused_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫤":{name:"face with diagonal mouth",slug:"face_with_diagonal_mouth",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😟":{name:"worried face",slug:"worried_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🙁":{name:"slightly frowning face",slug:"slightly_frowning_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☹️":{name:"frowning face",slug:"frowning_face",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"😮":{name:"face with open mouth",slug:"face_with_open_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😯":{name:"hushed face",slug:"hushed_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😲":{name:"astonished face",slug:"astonished_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😳":{name:"flushed face",slug:"flushed_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥺":{name:"pleading face",slug:"pleading_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥹":{name:"face holding back tears",slug:"face_holding_back_tears",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😦":{name:"frowning face with open mouth",slug:"frowning_face_with_open_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😧":{name:"anguished face",slug:"anguished_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😨":{name:"fearful face",slug:"fearful_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😰":{name:"anxious face with sweat",slug:"anxious_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😥":{name:"sad but relieved face",slug:"sad_but_relieved_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😢":{name:"crying face",slug:"crying_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😭":{name:"loudly crying face",slug:"loudly_crying_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😱":{name:"face screaming in fear",slug:"face_screaming_in_fear",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😖":{name:"confounded face",slug:"confounded_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😣":{name:"persevering face",slug:"persevering_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😞":{name:"disappointed face",slug:"disappointed_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😓":{name:"downcast face with sweat",slug:"downcast_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😩":{name:"weary face",slug:"weary_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😫":{name:"tired face",slug:"tired_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥱":{name:"yawning face",slug:"yawning_face",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"😤":{name:"face with steam from nose",slug:"face_with_steam_from_nose",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😡":{name:"enraged face",slug:"enraged_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😠":{name:"angry face",slug:"angry_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤬":{name:"face with symbols on mouth",slug:"face_with_symbols_on_mouth",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😈":{name:"smiling face with horns",slug:"smiling_face_with_horns",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"👿":{name:"angry face with horns",slug:"angry_face_with_horns",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💀":{name:"skull",slug:"skull",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☠️":{name:"skull and crossbones",slug:"skull_and_crossbones",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💩":{name:"pile of poo",slug:"pile_of_poo",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤡":{name:"clown face",slug:"clown_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"👹":{name:"ogre",slug:"ogre",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👺":{name:"goblin",slug:"goblin",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👻":{name:"ghost",slug:"ghost",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👽":{name:"alien",slug:"alien",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👾":{name:"alien monster",slug:"alien_monster",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤖":{name:"robot",slug:"robot",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😺":{name:"grinning cat",slug:"grinning_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😸":{name:"grinning cat with smiling eyes",slug:"grinning_cat_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😹":{name:"cat with tears of joy",slug:"cat_with_tears_of_joy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😻":{name:"smiling cat with heart-eyes",slug:"smiling_cat_with_heart_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😼":{name:"cat with wry smile",slug:"cat_with_wry_smile",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😽":{name:"kissing cat",slug:"kissing_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙀":{name:"weary cat",slug:"weary_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😿":{name:"crying cat",slug:"crying_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😾":{name:"pouting cat",slug:"pouting_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙈":{name:"see-no-evil monkey",slug:"see_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙉":{name:"hear-no-evil monkey",slug:"hear_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙊":{name:"speak-no-evil monkey",slug:"speak_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💌":{name:"love letter",slug:"love_letter",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💘":{name:"heart with arrow",slug:"heart_with_arrow",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💝":{name:"heart with ribbon",slug:"heart_with_ribbon",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💖":{name:"sparkling heart",slug:"sparkling_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💗":{name:"growing heart",slug:"growing_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💓":{name:"beating heart",slug:"beating_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💞":{name:"revolving hearts",slug:"revolving_hearts",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💕":{name:"two hearts",slug:"two_hearts",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💟":{name:"heart decoration",slug:"heart_decoration",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❣️":{name:"heart exclamation",slug:"heart_exclamation",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💔":{name:"broken heart",slug:"broken_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❤️‍🔥":{name:"heart on fire",slug:"heart_on_fire",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"❤️‍🩹":{name:"mending heart",slug:"mending_heart",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"❤️":{name:"red heart",slug:"red_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩷":{name:"pink heart",slug:"pink_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🧡":{name:"orange heart",slug:"orange_heart",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"💛":{name:"yellow heart",slug:"yellow_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💚":{name:"green heart",slug:"green_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💙":{name:"blue heart",slug:"blue_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩵":{name:"light blue heart",slug:"light_blue_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"💜":{name:"purple heart",slug:"purple_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤎":{name:"brown heart",slug:"brown_heart",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🖤":{name:"black heart",slug:"black_heart",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🩶":{name:"grey heart",slug:"grey_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🤍":{name:"white heart",slug:"white_heart",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💋":{name:"kiss mark",slug:"kiss_mark",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💯":{name:"hundred points",slug:"hundred_points",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💢":{name:"anger symbol",slug:"anger_symbol",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💥":{name:"collision",slug:"collision",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💫":{name:"dizzy",slug:"dizzy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💦":{name:"sweat droplets",slug:"sweat_droplets",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💨":{name:"dashing away",slug:"dashing_away",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕳️":{name:"hole",slug:"hole",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💬":{name:"speech balloon",slug:"speech_balloon",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👁️‍🗨️":{name:"eye in speech bubble",slug:"eye_in_speech_bubble",group:"Smileys & Emotion",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🗨️":{name:"left speech bubble",slug:"left_speech_bubble",group:"Smileys & Emotion",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🗯️":{name:"right anger bubble",slug:"right_anger_bubble",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💭":{name:"thought balloon",slug:"thought_balloon",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💤":{name:"ZZZ",slug:"zzz",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👋":{name:"waving hand",slug:"waving_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤚":{name:"raised back of hand",slug:"raised_back_of_hand",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🖐️":{name:"hand with fingers splayed",slug:"hand_with_fingers_splayed",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✋":{name:"raised hand",slug:"raised_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🖖":{name:"vulcan salute",slug:"vulcan_salute",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫱":{name:"rightwards hand",slug:"rightwards_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫲":{name:"leftwards hand",slug:"leftwards_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫳":{name:"palm down hand",slug:"palm_down_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫴":{name:"palm up hand",slug:"palm_up_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫷":{name:"leftwards pushing hand",slug:"leftwards_pushing_hand",group:"People & Body",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!0,skin_tone_support_unicode_version:"15.0"},"🫸":{name:"rightwards pushing hand",slug:"rightwards_pushing_hand",group:"People & Body",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!0,skin_tone_support_unicode_version:"15.0"},"👌":{name:"OK hand",slug:"ok_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤌":{name:"pinched fingers",slug:"pinched_fingers",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤏":{name:"pinching hand",slug:"pinching_hand",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"✌️":{name:"victory hand",slug:"victory_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤞":{name:"crossed fingers",slug:"crossed_fingers",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🫰":{name:"hand with index finger and thumb crossed",slug:"hand_with_index_finger_and_thumb_crossed",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤟":{name:"love-you gesture",slug:"love_you_gesture",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤘":{name:"sign of the horns",slug:"sign_of_the_horns",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤙":{name:"call me hand",slug:"call_me_hand",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👈":{name:"backhand index pointing left",slug:"backhand_index_pointing_left",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👉":{name:"backhand index pointing right",slug:"backhand_index_pointing_right",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👆":{name:"backhand index pointing up",slug:"backhand_index_pointing_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🖕":{name:"middle finger",slug:"middle_finger",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👇":{name:"backhand index pointing down",slug:"backhand_index_pointing_down",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"☝️":{name:"index pointing up",slug:"index_pointing_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫵":{name:"index pointing at the viewer",slug:"index_pointing_at_the_viewer",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"👍":{name:"thumbs up",slug:"thumbs_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👎":{name:"thumbs down",slug:"thumbs_down",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✊":{name:"raised fist",slug:"raised_fist",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👊":{name:"oncoming fist",slug:"oncoming_fist",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤛":{name:"left-facing fist",slug:"left_facing_fist",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤜":{name:"right-facing fist",slug:"right_facing_fist",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👏":{name:"clapping hands",slug:"clapping_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙌":{name:"raising hands",slug:"raising_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫶":{name:"heart hands",slug:"heart_hands",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"👐":{name:"open hands",slug:"open_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤲":{name:"palms up together",slug:"palms_up_together",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤝":{name:"handshake",slug:"handshake",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🙏":{name:"folded hands",slug:"folded_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✍️":{name:"writing hand",slug:"writing_hand",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💅":{name:"nail polish",slug:"nail_polish",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤳":{name:"selfie",slug:"selfie",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"💪":{name:"flexed biceps",slug:"flexed_biceps",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🦾":{name:"mechanical arm",slug:"mechanical_arm",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦿":{name:"mechanical leg",slug:"mechanical_leg",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦵":{name:"leg",slug:"leg",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦶":{name:"foot",slug:"foot",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👂":{name:"ear",slug:"ear",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🦻":{name:"ear with hearing aid",slug:"ear_with_hearing_aid",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👃":{name:"nose",slug:"nose",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧠":{name:"brain",slug:"brain",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🫀":{name:"anatomical heart",slug:"anatomical_heart",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🫁":{name:"lungs",slug:"lungs",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦷":{name:"tooth",slug:"tooth",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦴":{name:"bone",slug:"bone",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"👀":{name:"eyes",slug:"eyes",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👁️":{name:"eye",slug:"eye",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"👅":{name:"tongue",slug:"tongue",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👄":{name:"mouth",slug:"mouth",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫦":{name:"biting lip",slug:"biting_lip",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"👶":{name:"baby",slug:"baby",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧒":{name:"child",slug:"child",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👦":{name:"boy",slug:"boy",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👧":{name:"girl",slug:"girl",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧑":{name:"person",slug:"person",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👱":{name:"person blond hair",slug:"person_blond_hair",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👨":{name:"man",slug:"man",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧔":{name:"person beard",slug:"person_beard",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧔‍♂️":{name:"man beard",slug:"man_beard",group:"People & Body",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"🧔‍♀️":{name:"woman beard",slug:"woman_beard",group:"People & Body",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍🦰":{name:"man red hair",slug:"man_red_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦱":{name:"man curly hair",slug:"man_curly_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦳":{name:"man white hair",slug:"man_white_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦲":{name:"man bald",slug:"man_bald",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👩":{name:"woman",slug:"woman",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👩‍🦰":{name:"woman red hair",slug:"woman_red_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦰":{name:"person red hair",slug:"person_red_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦱":{name:"woman curly hair",slug:"woman_curly_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦱":{name:"person curly hair",slug:"person_curly_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦳":{name:"woman white hair",slug:"woman_white_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦳":{name:"person white hair",slug:"person_white_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦲":{name:"woman bald",slug:"woman_bald",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦲":{name:"person bald",slug:"person_bald",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👱‍♀️":{name:"woman blond hair",slug:"woman_blond_hair",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👱‍♂️":{name:"man blond hair",slug:"man_blond_hair",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧓":{name:"older person",slug:"older_person",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👴":{name:"old man",slug:"old_man",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👵":{name:"old woman",slug:"old_woman",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙍":{name:"person frowning",slug:"person_frowning",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙍‍♂️":{name:"man frowning",slug:"man_frowning",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙍‍♀️":{name:"woman frowning",slug:"woman_frowning",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙎":{name:"person pouting",slug:"person_pouting",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙎‍♂️":{name:"man pouting",slug:"man_pouting",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙎‍♀️":{name:"woman pouting",slug:"woman_pouting",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙅":{name:"person gesturing NO",slug:"person_gesturing_no",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙅‍♂️":{name:"man gesturing NO",slug:"man_gesturing_no",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙅‍♀️":{name:"woman gesturing NO",slug:"woman_gesturing_no",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙆":{name:"person gesturing OK",slug:"person_gesturing_ok",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙆‍♂️":{name:"man gesturing OK",slug:"man_gesturing_ok",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙆‍♀️":{name:"woman gesturing OK",slug:"woman_gesturing_ok",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💁":{name:"person tipping hand",slug:"person_tipping_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💁‍♂️":{name:"man tipping hand",slug:"man_tipping_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💁‍♀️":{name:"woman tipping hand",slug:"woman_tipping_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙋":{name:"person raising hand",slug:"person_raising_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙋‍♂️":{name:"man raising hand",slug:"man_raising_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙋‍♀️":{name:"woman raising hand",slug:"woman_raising_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧏":{name:"deaf person",slug:"deaf_person",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧏‍♂️":{name:"deaf man",slug:"deaf_man",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧏‍♀️":{name:"deaf woman",slug:"deaf_woman",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🙇":{name:"person bowing",slug:"person_bowing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙇‍♂️":{name:"man bowing",slug:"man_bowing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙇‍♀️":{name:"woman bowing",slug:"woman_bowing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤦":{name:"person facepalming",slug:"person_facepalming",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤦‍♂️":{name:"man facepalming",slug:"man_facepalming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤦‍♀️":{name:"woman facepalming",slug:"woman_facepalming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤷":{name:"person shrugging",slug:"person_shrugging",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤷‍♂️":{name:"man shrugging",slug:"man_shrugging",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤷‍♀️":{name:"woman shrugging",slug:"woman_shrugging",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍⚕️":{name:"health worker",slug:"health_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍⚕️":{name:"man health worker",slug:"man_health_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍⚕️":{name:"woman health worker",slug:"woman_health_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎓":{name:"student",slug:"student",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎓":{name:"man student",slug:"man_student",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎓":{name:"woman student",slug:"woman_student",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🏫":{name:"teacher",slug:"teacher",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🏫":{name:"man teacher",slug:"man_teacher",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🏫":{name:"woman teacher",slug:"woman_teacher",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍⚖️":{name:"judge",slug:"judge",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍⚖️":{name:"man judge",slug:"man_judge",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍⚖️":{name:"woman judge",slug:"woman_judge",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🌾":{name:"farmer",slug:"farmer",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🌾":{name:"man farmer",slug:"man_farmer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🌾":{name:"woman farmer",slug:"woman_farmer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🍳":{name:"cook",slug:"cook",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🍳":{name:"man cook",slug:"man_cook",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🍳":{name:"woman cook",slug:"woman_cook",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🔧":{name:"mechanic",slug:"mechanic",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🔧":{name:"man mechanic",slug:"man_mechanic",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🔧":{name:"woman mechanic",slug:"woman_mechanic",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🏭":{name:"factory worker",slug:"factory_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🏭":{name:"man factory worker",slug:"man_factory_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🏭":{name:"woman factory worker",slug:"woman_factory_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍💼":{name:"office worker",slug:"office_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍💼":{name:"man office worker",slug:"man_office_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍💼":{name:"woman office worker",slug:"woman_office_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🔬":{name:"scientist",slug:"scientist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🔬":{name:"man scientist",slug:"man_scientist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🔬":{name:"woman scientist",slug:"woman_scientist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍💻":{name:"technologist",slug:"technologist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍💻":{name:"man technologist",slug:"man_technologist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍💻":{name:"woman technologist",slug:"woman_technologist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎤":{name:"singer",slug:"singer",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎤":{name:"man singer",slug:"man_singer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎤":{name:"woman singer",slug:"woman_singer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎨":{name:"artist",slug:"artist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎨":{name:"man artist",slug:"man_artist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎨":{name:"woman artist",slug:"woman_artist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍✈️":{name:"pilot",slug:"pilot",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍✈️":{name:"man pilot",slug:"man_pilot",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍✈️":{name:"woman pilot",slug:"woman_pilot",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🚀":{name:"astronaut",slug:"astronaut",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🚀":{name:"man astronaut",slug:"man_astronaut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🚀":{name:"woman astronaut",slug:"woman_astronaut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🚒":{name:"firefighter",slug:"firefighter",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🚒":{name:"man firefighter",slug:"man_firefighter",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🚒":{name:"woman firefighter",slug:"woman_firefighter",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👮":{name:"police officer",slug:"police_officer",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👮‍♂️":{name:"man police officer",slug:"man_police_officer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👮‍♀️":{name:"woman police officer",slug:"woman_police_officer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🕵️":{name:"detective",slug:"detective",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"🕵️‍♂️":{name:"man detective",slug:"man_detective",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🕵️‍♀️":{name:"woman detective",slug:"woman_detective",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💂":{name:"guard",slug:"guard",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💂‍♂️":{name:"man guard",slug:"man_guard",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💂‍♀️":{name:"woman guard",slug:"woman_guard",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🥷":{name:"ninja",slug:"ninja",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👷":{name:"construction worker",slug:"construction_worker",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👷‍♂️":{name:"man construction worker",slug:"man_construction_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👷‍♀️":{name:"woman construction worker",slug:"woman_construction_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🫅":{name:"person with crown",slug:"person_with_crown",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤴":{name:"prince",slug:"prince",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👸":{name:"princess",slug:"princess",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👳":{name:"person wearing turban",slug:"person_wearing_turban",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👳‍♂️":{name:"man wearing turban",slug:"man_wearing_turban",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👳‍♀️":{name:"woman wearing turban",slug:"woman_wearing_turban",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👲":{name:"person with skullcap",slug:"person_with_skullcap",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧕":{name:"woman with headscarf",slug:"woman_with_headscarf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤵":{name:"person in tuxedo",slug:"person_in_tuxedo",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤵‍♂️":{name:"man in tuxedo",slug:"man_in_tuxedo",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤵‍♀️":{name:"woman in tuxedo",slug:"woman_in_tuxedo",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👰":{name:"person with veil",slug:"person_with_veil",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👰‍♂️":{name:"man with veil",slug:"man_with_veil",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👰‍♀️":{name:"woman with veil",slug:"woman_with_veil",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤰":{name:"pregnant woman",slug:"pregnant_woman",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🫃":{name:"pregnant man",slug:"pregnant_man",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫄":{name:"pregnant person",slug:"pregnant_person",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤱":{name:"breast-feeding",slug:"breast_feeding",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👩‍🍼":{name:"woman feeding baby",slug:"woman_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👨‍🍼":{name:"man feeding baby",slug:"man_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🧑‍🍼":{name:"person feeding baby",slug:"person_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👼":{name:"baby angel",slug:"baby_angel",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🎅":{name:"Santa Claus",slug:"santa_claus",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤶":{name:"Mrs. Claus",slug:"mrs_claus",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🧑‍🎄":{name:"Mx Claus",slug:"mx_claus",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🦸":{name:"superhero",slug:"superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦸‍♂️":{name:"man superhero",slug:"man_superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦸‍♀️":{name:"woman superhero",slug:"woman_superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹":{name:"supervillain",slug:"supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹‍♂️":{name:"man supervillain",slug:"man_supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹‍♀️":{name:"woman supervillain",slug:"woman_supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧙":{name:"mage",slug:"mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧙‍♂️":{name:"man mage",slug:"man_mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧙‍♀️":{name:"woman mage",slug:"woman_mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚":{name:"fairy",slug:"fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚‍♂️":{name:"man fairy",slug:"man_fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚‍♀️":{name:"woman fairy",slug:"woman_fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛":{name:"vampire",slug:"vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛‍♂️":{name:"man vampire",slug:"man_vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛‍♀️":{name:"woman vampire",slug:"woman_vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜":{name:"merperson",slug:"merperson",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜‍♂️":{name:"merman",slug:"merman",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜‍♀️":{name:"mermaid",slug:"mermaid",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝":{name:"elf",slug:"elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝‍♂️":{name:"man elf",slug:"man_elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝‍♀️":{name:"woman elf",slug:"woman_elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧞":{name:"genie",slug:"genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧞‍♂️":{name:"man genie",slug:"man_genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧞‍♀️":{name:"woman genie",slug:"woman_genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟":{name:"zombie",slug:"zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟‍♂️":{name:"man zombie",slug:"man_zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟‍♀️":{name:"woman zombie",slug:"woman_zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧌":{name:"troll",slug:"troll",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"💆":{name:"person getting massage",slug:"person_getting_massage",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💆‍♂️":{name:"man getting massage",slug:"man_getting_massage",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💆‍♀️":{name:"woman getting massage",slug:"woman_getting_massage",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💇":{name:"person getting haircut",slug:"person_getting_haircut",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💇‍♂️":{name:"man getting haircut",slug:"man_getting_haircut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💇‍♀️":{name:"woman getting haircut",slug:"woman_getting_haircut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶":{name:"person walking",slug:"person_walking",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚶‍♂️":{name:"man walking",slug:"man_walking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶‍♀️":{name:"woman walking",slug:"woman_walking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶‍➡️":{name:"person walking facing right",slug:"person_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🚶‍♀️‍➡️":{name:"woman walking facing right",slug:"woman_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🚶‍♂️‍➡️":{name:"man walking facing right",slug:"man_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧍":{name:"person standing",slug:"person_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧍‍♂️":{name:"man standing",slug:"man_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧍‍♀️":{name:"woman standing",slug:"woman_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎":{name:"person kneeling",slug:"person_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍♂️":{name:"man kneeling",slug:"man_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍♀️":{name:"woman kneeling",slug:"woman_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍➡️":{name:"person kneeling facing right",slug:"person_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧎‍♀️‍➡️":{name:"woman kneeling facing right",slug:"woman_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧎‍♂️‍➡️":{name:"man kneeling facing right",slug:"man_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦯":{name:"person with white cane",slug:"person_with_white_cane",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦯‍➡️":{name:"person with white cane facing right",slug:"person_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦯":{name:"man with white cane",slug:"man_with_white_cane",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦯‍➡️":{name:"man with white cane facing right",slug:"man_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦯":{name:"woman with white cane",slug:"woman_with_white_cane",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦯‍➡️":{name:"woman with white cane facing right",slug:"woman_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦼":{name:"person in motorized wheelchair",slug:"person_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦼‍➡️":{name:"person in motorized wheelchair facing right",slug:"person_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦼":{name:"man in motorized wheelchair",slug:"man_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦼‍➡️":{name:"man in motorized wheelchair facing right",slug:"man_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦼":{name:"woman in motorized wheelchair",slug:"woman_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦼‍➡️":{name:"woman in motorized wheelchair facing right",slug:"woman_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦽":{name:"person in manual wheelchair",slug:"person_in_manual_wheelchair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦽‍➡️":{name:"person in manual wheelchair facing right",slug:"person_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦽":{name:"man in manual wheelchair",slug:"man_in_manual_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦽‍➡️":{name:"man in manual wheelchair facing right",slug:"man_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦽":{name:"woman in manual wheelchair",slug:"woman_in_manual_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦽‍➡️":{name:"woman in manual wheelchair facing right",slug:"woman_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃":{name:"person running",slug:"person_running",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏃‍♂️":{name:"man running",slug:"man_running",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏃‍♀️":{name:"woman running",slug:"woman_running",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏃‍➡️":{name:"person running facing right",slug:"person_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃‍♀️‍➡️":{name:"woman running facing right",slug:"woman_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃‍♂️‍➡️":{name:"man running facing right",slug:"man_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"💃":{name:"woman dancing",slug:"woman_dancing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🕺":{name:"man dancing",slug:"man_dancing",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🕴️":{name:"person in suit levitating",slug:"person_in_suit_levitating",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👯":{name:"people with bunny ears",slug:"people_with_bunny_ears",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👯‍♂️":{name:"men with bunny ears",slug:"men_with_bunny_ears",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👯‍♀️":{name:"women with bunny ears",slug:"women_with_bunny_ears",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🧖":{name:"person in steamy room",slug:"person_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧖‍♂️":{name:"man in steamy room",slug:"man_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧖‍♀️":{name:"woman in steamy room",slug:"woman_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗":{name:"person climbing",slug:"person_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗‍♂️":{name:"man climbing",slug:"man_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗‍♀️":{name:"woman climbing",slug:"woman_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤺":{name:"person fencing",slug:"person_fencing",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🏇":{name:"horse racing",slug:"horse_racing",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"⛷️":{name:"skier",slug:"skier",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏂":{name:"snowboarder",slug:"snowboarder",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏌️":{name:"person golfing",slug:"person_golfing",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏌️‍♂️":{name:"man golfing",slug:"man_golfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏌️‍♀️":{name:"woman golfing",slug:"woman_golfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏄":{name:"person surfing",slug:"person_surfing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏄‍♂️":{name:"man surfing",slug:"man_surfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏄‍♀️":{name:"woman surfing",slug:"woman_surfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚣":{name:"person rowing boat",slug:"person_rowing_boat",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚣‍♂️":{name:"man rowing boat",slug:"man_rowing_boat",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚣‍♀️":{name:"woman rowing boat",slug:"woman_rowing_boat",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏊":{name:"person swimming",slug:"person_swimming",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏊‍♂️":{name:"man swimming",slug:"man_swimming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏊‍♀️":{name:"woman swimming",slug:"woman_swimming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"⛹️":{name:"person bouncing ball",slug:"person_bouncing_ball",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"⛹️‍♂️":{name:"man bouncing ball",slug:"man_bouncing_ball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"⛹️‍♀️":{name:"woman bouncing ball",slug:"woman_bouncing_ball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏋️":{name:"person lifting weights",slug:"person_lifting_weights",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"🏋️‍♂️":{name:"man lifting weights",slug:"man_lifting_weights",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏋️‍♀️":{name:"woman lifting weights",slug:"woman_lifting_weights",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚴":{name:"person biking",slug:"person_biking",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚴‍♂️":{name:"man biking",slug:"man_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚴‍♀️":{name:"woman biking",slug:"woman_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚵":{name:"person mountain biking",slug:"person_mountain_biking",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚵‍♂️":{name:"man mountain biking",slug:"man_mountain_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚵‍♀️":{name:"woman mountain biking",slug:"woman_mountain_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤸":{name:"person cartwheeling",slug:"person_cartwheeling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤸‍♂️":{name:"man cartwheeling",slug:"man_cartwheeling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤸‍♀️":{name:"woman cartwheeling",slug:"woman_cartwheeling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤼":{name:"people wrestling",slug:"people_wrestling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🤼‍♂️":{name:"men wrestling",slug:"men_wrestling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🤼‍♀️":{name:"women wrestling",slug:"women_wrestling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🤽":{name:"person playing water polo",slug:"person_playing_water_polo",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤽‍♂️":{name:"man playing water polo",slug:"man_playing_water_polo",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤽‍♀️":{name:"woman playing water polo",slug:"woman_playing_water_polo",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤾":{name:"person playing handball",slug:"person_playing_handball",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤾‍♂️":{name:"man playing handball",slug:"man_playing_handball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤾‍♀️":{name:"woman playing handball",slug:"woman_playing_handball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤹":{name:"person juggling",slug:"person_juggling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤹‍♂️":{name:"man juggling",slug:"man_juggling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤹‍♀️":{name:"woman juggling",slug:"woman_juggling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧘":{name:"person in lotus position",slug:"person_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧘‍♂️":{name:"man in lotus position",slug:"man_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧘‍♀️":{name:"woman in lotus position",slug:"woman_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🛀":{name:"person taking bath",slug:"person_taking_bath",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🛌":{name:"person in bed",slug:"person_in_bed",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🤝‍🧑":{name:"people holding hands",slug:"people_holding_hands",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👭":{name:"women holding hands",slug:"women_holding_hands",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👫":{name:"woman and man holding hands",slug:"woman_and_man_holding_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👬":{name:"men holding hands",slug:"men_holding_hands",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"💏":{name:"kiss",slug:"kiss",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍💋‍👨":{name:"kiss woman, man",slug:"kiss_woman_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍❤️‍💋‍👨":{name:"kiss man, man",slug:"kiss_man_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍💋‍👩":{name:"kiss woman, woman",slug:"kiss_woman_woman",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"💑":{name:"couple with heart",slug:"couple_with_heart",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍👨":{name:"couple with heart woman, man",slug:"couple_with_heart_woman_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍❤️‍👨":{name:"couple with heart man, man",slug:"couple_with_heart_man_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍👩":{name:"couple with heart woman, woman",slug:"couple_with_heart_woman_woman",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍👩‍👦":{name:"family man, woman, boy",slug:"family_man_woman_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧":{name:"family man, woman, girl",slug:"family_man_woman_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧‍👦":{name:"family man, woman, girl, boy",slug:"family_man_woman_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👦‍👦":{name:"family man, woman, boy, boy",slug:"family_man_woman_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧‍👧":{name:"family man, woman, girl, girl",slug:"family_man_woman_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👦":{name:"family man, man, boy",slug:"family_man_man_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧":{name:"family man, man, girl",slug:"family_man_man_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧‍👦":{name:"family man, man, girl, boy",slug:"family_man_man_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👦‍👦":{name:"family man, man, boy, boy",slug:"family_man_man_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧‍👧":{name:"family man, man, girl, girl",slug:"family_man_man_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👦":{name:"family woman, woman, boy",slug:"family_woman_woman_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧":{name:"family woman, woman, girl",slug:"family_woman_woman_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧‍👦":{name:"family woman, woman, girl, boy",slug:"family_woman_woman_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👦‍👦":{name:"family woman, woman, boy, boy",slug:"family_woman_woman_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧‍👧":{name:"family woman, woman, girl, girl",slug:"family_woman_woman_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👦":{name:"family man, boy",slug:"family_man_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👦‍👦":{name:"family man, boy, boy",slug:"family_man_boy_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧":{name:"family man, girl",slug:"family_man_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧‍👦":{name:"family man, girl, boy",slug:"family_man_girl_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧‍👧":{name:"family man, girl, girl",slug:"family_man_girl_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👦":{name:"family woman, boy",slug:"family_woman_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👦‍👦":{name:"family woman, boy, boy",slug:"family_woman_boy_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧":{name:"family woman, girl",slug:"family_woman_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧‍👦":{name:"family woman, girl, boy",slug:"family_woman_girl_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧‍👧":{name:"family woman, girl, girl",slug:"family_woman_girl_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🗣️":{name:"speaking head",slug:"speaking_head",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"👤":{name:"bust in silhouette",slug:"bust_in_silhouette",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👥":{name:"busts in silhouette",slug:"busts_in_silhouette",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫂":{name:"people hugging",slug:"people_hugging",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👪":{name:"family",slug:"family",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧑‍🧑‍🧒":{name:"family adult, adult, child",slug:"family_adult_adult_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧑‍🧒‍🧒":{name:"family adult, adult, child, child",slug:"family_adult_adult_child_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧒":{name:"family adult, child",slug:"family_adult_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧒‍🧒":{name:"family adult, child, child",slug:"family_adult_child_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"👣":{name:"footprints",slug:"footprints",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫆":{name:"fingerprint",slug:"fingerprint",group:"People & Body",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🐵":{name:"monkey face",slug:"monkey_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐒":{name:"monkey",slug:"monkey",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦍":{name:"gorilla",slug:"gorilla",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦧":{name:"orangutan",slug:"orangutan",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐶":{name:"dog face",slug:"dog_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐕":{name:"dog",slug:"dog",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦮":{name:"guide dog",slug:"guide_dog",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐕‍🦺":{name:"service dog",slug:"service_dog",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐩":{name:"poodle",slug:"poodle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐺":{name:"wolf",slug:"wolf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦊":{name:"fox",slug:"fox",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦝":{name:"raccoon",slug:"raccoon",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐱":{name:"cat face",slug:"cat_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐈":{name:"cat",slug:"cat",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🐈‍⬛":{name:"black cat",slug:"black_cat",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦁":{name:"lion",slug:"lion",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐯":{name:"tiger face",slug:"tiger_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐅":{name:"tiger",slug:"tiger",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐆":{name:"leopard",slug:"leopard",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐴":{name:"horse face",slug:"horse_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫎":{name:"moose",slug:"moose",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🫏":{name:"donkey",slug:"donkey",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐎":{name:"horse",slug:"horse",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦄":{name:"unicorn",slug:"unicorn",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦓":{name:"zebra",slug:"zebra",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦌":{name:"deer",slug:"deer",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦬":{name:"bison",slug:"bison",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐮":{name:"cow face",slug:"cow_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐂":{name:"ox",slug:"ox",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐃":{name:"water buffalo",slug:"water_buffalo",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐄":{name:"cow",slug:"cow",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐷":{name:"pig face",slug:"pig_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐖":{name:"pig",slug:"pig",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐗":{name:"boar",slug:"boar",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐽":{name:"pig nose",slug:"pig_nose",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐏":{name:"ram",slug:"ram",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐑":{name:"ewe",slug:"ewe",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐐":{name:"goat",slug:"goat",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐪":{name:"camel",slug:"camel",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐫":{name:"two-hump camel",slug:"two_hump_camel",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦙":{name:"llama",slug:"llama",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦒":{name:"giraffe",slug:"giraffe",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🐘":{name:"elephant",slug:"elephant",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦣":{name:"mammoth",slug:"mammoth",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦏":{name:"rhinoceros",slug:"rhinoceros",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦛":{name:"hippopotamus",slug:"hippopotamus",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐭":{name:"mouse face",slug:"mouse_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐁":{name:"mouse",slug:"mouse",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐀":{name:"rat",slug:"rat",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐹":{name:"hamster",slug:"hamster",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐰":{name:"rabbit face",slug:"rabbit_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐇":{name:"rabbit",slug:"rabbit",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐿️":{name:"chipmunk",slug:"chipmunk",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦫":{name:"beaver",slug:"beaver",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦔":{name:"hedgehog",slug:"hedgehog",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦇":{name:"bat",slug:"bat",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐻":{name:"bear",slug:"bear",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐻‍❄️":{name:"polar bear",slug:"polar_bear",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐨":{name:"koala",slug:"koala",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐼":{name:"panda",slug:"panda",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦥":{name:"sloth",slug:"sloth",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦦":{name:"otter",slug:"otter",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦨":{name:"skunk",slug:"skunk",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦘":{name:"kangaroo",slug:"kangaroo",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦡":{name:"badger",slug:"badger",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐾":{name:"paw prints",slug:"paw_prints",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦃":{name:"turkey",slug:"turkey",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐔":{name:"chicken",slug:"chicken",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐓":{name:"rooster",slug:"rooster",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐣":{name:"hatching chick",slug:"hatching_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐤":{name:"baby chick",slug:"baby_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐥":{name:"front-facing baby chick",slug:"front_facing_baby_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐦":{name:"bird",slug:"bird",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐧":{name:"penguin",slug:"penguin",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕊️":{name:"dove",slug:"dove",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦅":{name:"eagle",slug:"eagle",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦆":{name:"duck",slug:"duck",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦢":{name:"swan",slug:"swan",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦉":{name:"owl",slug:"owl",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦤":{name:"dodo",slug:"dodo",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪶":{name:"feather",slug:"feather",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦩":{name:"flamingo",slug:"flamingo",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦚":{name:"peacock",slug:"peacock",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦜":{name:"parrot",slug:"parrot",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪽":{name:"wing",slug:"wing",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐦‍⬛":{name:"black bird",slug:"black_bird",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪿":{name:"goose",slug:"goose",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐦‍🔥":{name:"phoenix",slug:"phoenix",group:"Animals & Nature",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🐸":{name:"frog",slug:"frog",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐊":{name:"crocodile",slug:"crocodile",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐢":{name:"turtle",slug:"turtle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦎":{name:"lizard",slug:"lizard",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐍":{name:"snake",slug:"snake",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐲":{name:"dragon face",slug:"dragon_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐉":{name:"dragon",slug:"dragon",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦕":{name:"sauropod",slug:"sauropod",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦖":{name:"T-Rex",slug:"t_rex",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🐳":{name:"spouting whale",slug:"spouting_whale",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐋":{name:"whale",slug:"whale",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐬":{name:"dolphin",slug:"dolphin",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦭":{name:"seal",slug:"seal",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐟":{name:"fish",slug:"fish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐠":{name:"tropical fish",slug:"tropical_fish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐡":{name:"blowfish",slug:"blowfish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦈":{name:"shark",slug:"shark",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐙":{name:"octopus",slug:"octopus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐚":{name:"spiral shell",slug:"spiral_shell",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪸":{name:"coral",slug:"coral",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪼":{name:"jellyfish",slug:"jellyfish",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🦀":{name:"crab",slug:"crab",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦞":{name:"lobster",slug:"lobster",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦐":{name:"shrimp",slug:"shrimp",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦑":{name:"squid",slug:"squid",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦪":{name:"oyster",slug:"oyster",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐌":{name:"snail",slug:"snail",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦋":{name:"butterfly",slug:"butterfly",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐛":{name:"bug",slug:"bug",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐜":{name:"ant",slug:"ant",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐝":{name:"honeybee",slug:"honeybee",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪲":{name:"beetle",slug:"beetle",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐞":{name:"lady beetle",slug:"lady_beetle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦗":{name:"cricket",slug:"cricket",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🪳":{name:"cockroach",slug:"cockroach",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🕷️":{name:"spider",slug:"spider",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕸️":{name:"spider web",slug:"spider_web",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦂":{name:"scorpion",slug:"scorpion",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦟":{name:"mosquito",slug:"mosquito",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪰":{name:"fly",slug:"fly",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪱":{name:"worm",slug:"worm",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦠":{name:"microbe",slug:"microbe",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"💐":{name:"bouquet",slug:"bouquet",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌸":{name:"cherry blossom",slug:"cherry_blossom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💮":{name:"white flower",slug:"white_flower",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪷":{name:"lotus",slug:"lotus",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏵️":{name:"rosette",slug:"rosette",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌹":{name:"rose",slug:"rose",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥀":{name:"wilted flower",slug:"wilted_flower",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🌺":{name:"hibiscus",slug:"hibiscus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌻":{name:"sunflower",slug:"sunflower",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌼":{name:"blossom",slug:"blossom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌷":{name:"tulip",slug:"tulip",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪻":{name:"hyacinth",slug:"hyacinth",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🌱":{name:"seedling",slug:"seedling",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪴":{name:"potted plant",slug:"potted_plant",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🌲":{name:"evergreen tree",slug:"evergreen_tree",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌳":{name:"deciduous tree",slug:"deciduous_tree",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌴":{name:"palm tree",slug:"palm_tree",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌵":{name:"cactus",slug:"cactus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌾":{name:"sheaf of rice",slug:"sheaf_of_rice",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌿":{name:"herb",slug:"herb",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☘️":{name:"shamrock",slug:"shamrock",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍀":{name:"four leaf clover",slug:"four_leaf_clover",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍁":{name:"maple leaf",slug:"maple_leaf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍂":{name:"fallen leaf",slug:"fallen_leaf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍃":{name:"leaf fluttering in wind",slug:"leaf_fluttering_in_wind",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪹":{name:"empty nest",slug:"empty_nest",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪺":{name:"nest with eggs",slug:"nest_with_eggs",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🍄":{name:"mushroom",slug:"mushroom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪾":{name:"leafless tree",slug:"leafless_tree",group:"Animals & Nature",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🍇":{name:"grapes",slug:"grapes",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍈":{name:"melon",slug:"melon",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍉":{name:"watermelon",slug:"watermelon",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍊":{name:"tangerine",slug:"tangerine",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍋":{name:"lemon",slug:"lemon",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍋‍🟩":{name:"lime",slug:"lime",group:"Food & Drink",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🍌":{name:"banana",slug:"banana",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍍":{name:"pineapple",slug:"pineapple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥭":{name:"mango",slug:"mango",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🍎":{name:"red apple",slug:"red_apple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍏":{name:"green apple",slug:"green_apple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍐":{name:"pear",slug:"pear",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍑":{name:"peach",slug:"peach",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍒":{name:"cherries",slug:"cherries",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍓":{name:"strawberry",slug:"strawberry",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫐":{name:"blueberries",slug:"blueberries",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥝":{name:"kiwi fruit",slug:"kiwi_fruit",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍅":{name:"tomato",slug:"tomato",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫒":{name:"olive",slug:"olive",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥥":{name:"coconut",slug:"coconut",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥑":{name:"avocado",slug:"avocado",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍆":{name:"eggplant",slug:"eggplant",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥔":{name:"potato",slug:"potato",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥕":{name:"carrot",slug:"carrot",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🌽":{name:"ear of corn",slug:"ear_of_corn",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌶️":{name:"hot pepper",slug:"hot_pepper",group:"Food & Drink",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🫑":{name:"bell pepper",slug:"bell_pepper",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥒":{name:"cucumber",slug:"cucumber",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥬":{name:"leafy green",slug:"leafy_green",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥦":{name:"broccoli",slug:"broccoli",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧄":{name:"garlic",slug:"garlic",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧅":{name:"onion",slug:"onion",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥜":{name:"peanuts",slug:"peanuts",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫘":{name:"beans",slug:"beans",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🌰":{name:"chestnut",slug:"chestnut",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫚":{name:"ginger root",slug:"ginger_root",group:"Food & Drink",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🫛":{name:"pea pod",slug:"pea_pod",group:"Food & Drink",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🍄‍🟫":{name:"brown mushroom",slug:"brown_mushroom",group:"Food & Drink",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🫜":{name:"root vegetable",slug:"root_vegetable",group:"Food & Drink",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🍞":{name:"bread",slug:"bread",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥐":{name:"croissant",slug:"croissant",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥖":{name:"baguette bread",slug:"baguette_bread",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫓":{name:"flatbread",slug:"flatbread",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥨":{name:"pretzel",slug:"pretzel",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥯":{name:"bagel",slug:"bagel",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥞":{name:"pancakes",slug:"pancakes",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🧇":{name:"waffle",slug:"waffle",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧀":{name:"cheese wedge",slug:"cheese_wedge",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍖":{name:"meat on bone",slug:"meat_on_bone",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍗":{name:"poultry leg",slug:"poultry_leg",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥩":{name:"cut of meat",slug:"cut_of_meat",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥓":{name:"bacon",slug:"bacon",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍔":{name:"hamburger",slug:"hamburger",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍟":{name:"french fries",slug:"french_fries",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍕":{name:"pizza",slug:"pizza",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌭":{name:"hot dog",slug:"hot_dog",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥪":{name:"sandwich",slug:"sandwich",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🌮":{name:"taco",slug:"taco",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌯":{name:"burrito",slug:"burrito",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫔":{name:"tamale",slug:"tamale",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥙":{name:"stuffed flatbread",slug:"stuffed_flatbread",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🧆":{name:"falafel",slug:"falafel",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥚":{name:"egg",slug:"egg",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍳":{name:"cooking",slug:"cooking",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥘":{name:"shallow pan of food",slug:"shallow_pan_of_food",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍲":{name:"pot of food",slug:"pot_of_food",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫕":{name:"fondue",slug:"fondue",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥣":{name:"bowl with spoon",slug:"bowl_with_spoon",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥗":{name:"green salad",slug:"green_salad",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍿":{name:"popcorn",slug:"popcorn",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧈":{name:"butter",slug:"butter",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧂":{name:"salt",slug:"salt",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥫":{name:"canned food",slug:"canned_food",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍱":{name:"bento box",slug:"bento_box",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍘":{name:"rice cracker",slug:"rice_cracker",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍙":{name:"rice ball",slug:"rice_ball",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍚":{name:"cooked rice",slug:"cooked_rice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍛":{name:"curry rice",slug:"curry_rice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍜":{name:"steaming bowl",slug:"steaming_bowl",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍝":{name:"spaghetti",slug:"spaghetti",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍠":{name:"roasted sweet potato",slug:"roasted_sweet_potato",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍢":{name:"oden",slug:"oden",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍣":{name:"sushi",slug:"sushi",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍤":{name:"fried shrimp",slug:"fried_shrimp",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍥":{name:"fish cake with swirl",slug:"fish_cake_with_swirl",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥮":{name:"moon cake",slug:"moon_cake",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🍡":{name:"dango",slug:"dango",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥟":{name:"dumpling",slug:"dumpling",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥠":{name:"fortune cookie",slug:"fortune_cookie",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥡":{name:"takeout box",slug:"takeout_box",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍦":{name:"soft ice cream",slug:"soft_ice_cream",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍧":{name:"shaved ice",slug:"shaved_ice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍨":{name:"ice cream",slug:"ice_cream",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍩":{name:"doughnut",slug:"doughnut",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍪":{name:"cookie",slug:"cookie",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎂":{name:"birthday cake",slug:"birthday_cake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍰":{name:"shortcake",slug:"shortcake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧁":{name:"cupcake",slug:"cupcake",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥧":{name:"pie",slug:"pie",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍫":{name:"chocolate bar",slug:"chocolate_bar",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍬":{name:"candy",slug:"candy",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍭":{name:"lollipop",slug:"lollipop",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍮":{name:"custard",slug:"custard",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍯":{name:"honey pot",slug:"honey_pot",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍼":{name:"baby bottle",slug:"baby_bottle",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥛":{name:"glass of milk",slug:"glass_of_milk",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"☕":{name:"hot beverage",slug:"hot_beverage",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫖":{name:"teapot",slug:"teapot",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🍵":{name:"teacup without handle",slug:"teacup_without_handle",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍶":{name:"sake",slug:"sake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍾":{name:"bottle with popping cork",slug:"bottle_with_popping_cork",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍷":{name:"wine glass",slug:"wine_glass",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍸":{name:"cocktail glass",slug:"cocktail_glass",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍹":{name:"tropical drink",slug:"tropical_drink",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍺":{name:"beer mug",slug:"beer_mug",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍻":{name:"clinking beer mugs",slug:"clinking_beer_mugs",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥂":{name:"clinking glasses",slug:"clinking_glasses",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥃":{name:"tumbler glass",slug:"tumbler_glass",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫗":{name:"pouring liquid",slug:"pouring_liquid",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🥤":{name:"cup with straw",slug:"cup_with_straw",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧋":{name:"bubble tea",slug:"bubble_tea",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧃":{name:"beverage box",slug:"beverage_box",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧉":{name:"mate",slug:"mate",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧊":{name:"ice",slug:"ice",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥢":{name:"chopsticks",slug:"chopsticks",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍽️":{name:"fork and knife with plate",slug:"fork_and_knife_with_plate",group:"Food & Drink",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🍴":{name:"fork and knife",slug:"fork_and_knife",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥄":{name:"spoon",slug:"spoon",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🔪":{name:"kitchen knife",slug:"kitchen_knife",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫙":{name:"jar",slug:"jar",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏺":{name:"amphora",slug:"amphora",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌍":{name:"globe showing Europe-Africa",slug:"globe_showing_europe_africa",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌎":{name:"globe showing Americas",slug:"globe_showing_americas",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌏":{name:"globe showing Asia-Australia",slug:"globe_showing_asia_australia",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌐":{name:"globe with meridians",slug:"globe_with_meridians",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🗺️":{name:"world map",slug:"world_map",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗾":{name:"map of Japan",slug:"map_of_japan",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧭":{name:"compass",slug:"compass",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏔️":{name:"snow-capped mountain",slug:"snow_capped_mountain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛰️":{name:"mountain",slug:"mountain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌋":{name:"volcano",slug:"volcano",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗻":{name:"mount fuji",slug:"mount_fuji",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏕️":{name:"camping",slug:"camping",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏖️":{name:"beach with umbrella",slug:"beach_with_umbrella",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏜️":{name:"desert",slug:"desert",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏝️":{name:"desert island",slug:"desert_island",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏞️":{name:"national park",slug:"national_park",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏟️":{name:"stadium",slug:"stadium",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏛️":{name:"classical building",slug:"classical_building",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏗️":{name:"building construction",slug:"building_construction",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🧱":{name:"brick",slug:"brick",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪨":{name:"rock",slug:"rock",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪵":{name:"wood",slug:"wood",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🛖":{name:"hut",slug:"hut",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏘️":{name:"houses",slug:"houses",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏚️":{name:"derelict house",slug:"derelict_house",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏠":{name:"house",slug:"house",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏡":{name:"house with garden",slug:"house_with_garden",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏢":{name:"office building",slug:"office_building",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏣":{name:"Japanese post office",slug:"japanese_post_office",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏤":{name:"post office",slug:"post_office",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏥":{name:"hospital",slug:"hospital",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏦":{name:"bank",slug:"bank",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏨":{name:"hotel",slug:"hotel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏩":{name:"love hotel",slug:"love_hotel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏪":{name:"convenience store",slug:"convenience_store",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏫":{name:"school",slug:"school",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏬":{name:"department store",slug:"department_store",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏭":{name:"factory",slug:"factory",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏯":{name:"Japanese castle",slug:"japanese_castle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏰":{name:"castle",slug:"castle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💒":{name:"wedding",slug:"wedding",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗼":{name:"Tokyo tower",slug:"tokyo_tower",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗽":{name:"Statue of Liberty",slug:"statue_of_liberty",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛪":{name:"church",slug:"church",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕌":{name:"mosque",slug:"mosque",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛕":{name:"hindu temple",slug:"hindu_temple",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🕍":{name:"synagogue",slug:"synagogue",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛩️":{name:"shinto shrine",slug:"shinto_shrine",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕋":{name:"kaaba",slug:"kaaba",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛲":{name:"fountain",slug:"fountain",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛺":{name:"tent",slug:"tent",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌁":{name:"foggy",slug:"foggy",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌃":{name:"night with stars",slug:"night_with_stars",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏙️":{name:"cityscape",slug:"cityscape",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌄":{name:"sunrise over mountains",slug:"sunrise_over_mountains",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌅":{name:"sunrise",slug:"sunrise",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌆":{name:"cityscape at dusk",slug:"cityscape_at_dusk",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌇":{name:"sunset",slug:"sunset",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌉":{name:"bridge at night",slug:"bridge_at_night",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♨️":{name:"hot springs",slug:"hot_springs",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎠":{name:"carousel horse",slug:"carousel_horse",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛝":{name:"playground slide",slug:"playground_slide",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🎡":{name:"ferris wheel",slug:"ferris_wheel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎢":{name:"roller coaster",slug:"roller_coaster",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💈":{name:"barber pole",slug:"barber_pole",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎪":{name:"circus tent",slug:"circus_tent",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚂":{name:"locomotive",slug:"locomotive",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚃":{name:"railway car",slug:"railway_car",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚄":{name:"high-speed train",slug:"high_speed_train",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚅":{name:"bullet train",slug:"bullet_train",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚆":{name:"train",slug:"train",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚇":{name:"metro",slug:"metro",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚈":{name:"light rail",slug:"light_rail",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚉":{name:"station",slug:"station",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚊":{name:"tram",slug:"tram",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚝":{name:"monorail",slug:"monorail",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚞":{name:"mountain railway",slug:"mountain_railway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚋":{name:"tram car",slug:"tram_car",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚌":{name:"bus",slug:"bus",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚍":{name:"oncoming bus",slug:"oncoming_bus",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚎":{name:"trolleybus",slug:"trolleybus",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚐":{name:"minibus",slug:"minibus",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚑":{name:"ambulance",slug:"ambulance",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚒":{name:"fire engine",slug:"fire_engine",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚓":{name:"police car",slug:"police_car",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚔":{name:"oncoming police car",slug:"oncoming_police_car",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚕":{name:"taxi",slug:"taxi",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚖":{name:"oncoming taxi",slug:"oncoming_taxi",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚗":{name:"automobile",slug:"automobile",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚘":{name:"oncoming automobile",slug:"oncoming_automobile",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚙":{name:"sport utility vehicle",slug:"sport_utility_vehicle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛻":{name:"pickup truck",slug:"pickup_truck",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚚":{name:"delivery truck",slug:"delivery_truck",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚛":{name:"articulated lorry",slug:"articulated_lorry",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚜":{name:"tractor",slug:"tractor",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏎️":{name:"racing car",slug:"racing_car",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏍️":{name:"motorcycle",slug:"motorcycle",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛵":{name:"motor scooter",slug:"motor_scooter",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦽":{name:"manual wheelchair",slug:"manual_wheelchair",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦼":{name:"motorized wheelchair",slug:"motorized_wheelchair",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🛺":{name:"auto rickshaw",slug:"auto_rickshaw",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🚲":{name:"bicycle",slug:"bicycle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛴":{name:"kick scooter",slug:"kick_scooter",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🛹":{name:"skateboard",slug:"skateboard",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🛼":{name:"roller skate",slug:"roller_skate",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚏":{name:"bus stop",slug:"bus_stop",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛣️":{name:"motorway",slug:"motorway",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛤️":{name:"railway track",slug:"railway_track",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛢️":{name:"oil drum",slug:"oil_drum",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛽":{name:"fuel pump",slug:"fuel_pump",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛞":{name:"wheel",slug:"wheel",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🚨":{name:"police car light",slug:"police_car_light",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚥":{name:"horizontal traffic light",slug:"horizontal_traffic_light",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚦":{name:"vertical traffic light",slug:"vertical_traffic_light",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛑":{name:"stop sign",slug:"stop_sign",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚧":{name:"construction",slug:"construction",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚓":{name:"anchor",slug:"anchor",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛟":{name:"ring buoy",slug:"ring_buoy",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"⛵":{name:"sailboat",slug:"sailboat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛶":{name:"canoe",slug:"canoe",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚤":{name:"speedboat",slug:"speedboat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛳️":{name:"passenger ship",slug:"passenger_ship",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛴️":{name:"ferry",slug:"ferry",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛥️":{name:"motor boat",slug:"motor_boat",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚢":{name:"ship",slug:"ship",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✈️":{name:"airplane",slug:"airplane",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛩️":{name:"small airplane",slug:"small_airplane",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛫":{name:"airplane departure",slug:"airplane_departure",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛬":{name:"airplane arrival",slug:"airplane_arrival",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪂":{name:"parachute",slug:"parachute",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💺":{name:"seat",slug:"seat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚁":{name:"helicopter",slug:"helicopter",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚟":{name:"suspension railway",slug:"suspension_railway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚠":{name:"mountain cableway",slug:"mountain_cableway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚡":{name:"aerial tramway",slug:"aerial_tramway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛰️":{name:"satellite",slug:"satellite",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚀":{name:"rocket",slug:"rocket",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛸":{name:"flying saucer",slug:"flying_saucer",group:"Travel & Places",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🛎️":{name:"bellhop bell",slug:"bellhop_bell",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🧳":{name:"luggage",slug:"luggage",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"⌛":{name:"hourglass done",slug:"hourglass_done",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏳":{name:"hourglass not done",slug:"hourglass_not_done",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⌚":{name:"watch",slug:"watch",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏰":{name:"alarm clock",slug:"alarm_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏱️":{name:"stopwatch",slug:"stopwatch",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⏲️":{name:"timer clock",slug:"timer_clock",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕰️":{name:"mantelpiece clock",slug:"mantelpiece_clock",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕛":{name:"twelve o’clock",slug:"twelve_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕧":{name:"twelve-thirty",slug:"twelve_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕐":{name:"one o’clock",slug:"one_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕜":{name:"one-thirty",slug:"one_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕑":{name:"two o’clock",slug:"two_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕝":{name:"two-thirty",slug:"two_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕒":{name:"three o’clock",slug:"three_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕞":{name:"three-thirty",slug:"three_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕓":{name:"four o’clock",slug:"four_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕟":{name:"four-thirty",slug:"four_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕔":{name:"five o’clock",slug:"five_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕠":{name:"five-thirty",slug:"five_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕕":{name:"six o’clock",slug:"six_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕡":{name:"six-thirty",slug:"six_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕖":{name:"seven o’clock",slug:"seven_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕢":{name:"seven-thirty",slug:"seven_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕗":{name:"eight o’clock",slug:"eight_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕣":{name:"eight-thirty",slug:"eight_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕘":{name:"nine o’clock",slug:"nine_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕤":{name:"nine-thirty",slug:"nine_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕙":{name:"ten o’clock",slug:"ten_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕥":{name:"ten-thirty",slug:"ten_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕚":{name:"eleven o’clock",slug:"eleven_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕦":{name:"eleven-thirty",slug:"eleven_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌑":{name:"new moon",slug:"new_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌒":{name:"waxing crescent moon",slug:"waxing_crescent_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌓":{name:"first quarter moon",slug:"first_quarter_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌔":{name:"waxing gibbous moon",slug:"waxing_gibbous_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌕":{name:"full moon",slug:"full_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌖":{name:"waning gibbous moon",slug:"waning_gibbous_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌗":{name:"last quarter moon",slug:"last_quarter_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌘":{name:"waning crescent moon",slug:"waning_crescent_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌙":{name:"crescent moon",slug:"crescent_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌚":{name:"new moon face",slug:"new_moon_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌛":{name:"first quarter moon face",slug:"first_quarter_moon_face",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌜":{name:"last quarter moon face",slug:"last_quarter_moon_face",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌡️":{name:"thermometer",slug:"thermometer",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☀️":{name:"sun",slug:"sun",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌝":{name:"full moon face",slug:"full_moon_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌞":{name:"sun with face",slug:"sun_with_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪐":{name:"ringed planet",slug:"ringed_planet",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⭐":{name:"star",slug:"star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌟":{name:"glowing star",slug:"glowing_star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌠":{name:"shooting star",slug:"shooting_star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌌":{name:"milky way",slug:"milky_way",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☁️":{name:"cloud",slug:"cloud",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛅":{name:"sun behind cloud",slug:"sun_behind_cloud",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛈️":{name:"cloud with lightning and rain",slug:"cloud_with_lightning_and_rain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌤️":{name:"sun behind small cloud",slug:"sun_behind_small_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌥️":{name:"sun behind large cloud",slug:"sun_behind_large_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌦️":{name:"sun behind rain cloud",slug:"sun_behind_rain_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌧️":{name:"cloud with rain",slug:"cloud_with_rain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌨️":{name:"cloud with snow",slug:"cloud_with_snow",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌩️":{name:"cloud with lightning",slug:"cloud_with_lightning",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌪️":{name:"tornado",slug:"tornado",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌫️":{name:"fog",slug:"fog",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌬️":{name:"wind face",slug:"wind_face",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌀":{name:"cyclone",slug:"cyclone",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌈":{name:"rainbow",slug:"rainbow",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌂":{name:"closed umbrella",slug:"closed_umbrella",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☂️":{name:"umbrella",slug:"umbrella",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☔":{name:"umbrella with rain drops",slug:"umbrella_with_rain_drops",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛱️":{name:"umbrella on ground",slug:"umbrella_on_ground",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚡":{name:"high voltage",slug:"high_voltage",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❄️":{name:"snowflake",slug:"snowflake",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☃️":{name:"snowman",slug:"snowman",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛄":{name:"snowman without snow",slug:"snowman_without_snow",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☄️":{name:"comet",slug:"comet",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔥":{name:"fire",slug:"fire",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💧":{name:"droplet",slug:"droplet",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌊":{name:"water wave",slug:"water_wave",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎃":{name:"jack-o-lantern",slug:"jack_o_lantern",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎄":{name:"Christmas tree",slug:"christmas_tree",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎆":{name:"fireworks",slug:"fireworks",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎇":{name:"sparkler",slug:"sparkler",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧨":{name:"firecracker",slug:"firecracker",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"✨":{name:"sparkles",slug:"sparkles",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎈":{name:"balloon",slug:"balloon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎉":{name:"party popper",slug:"party_popper",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎊":{name:"confetti ball",slug:"confetti_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎋":{name:"tanabata tree",slug:"tanabata_tree",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎍":{name:"pine decoration",slug:"pine_decoration",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎎":{name:"Japanese dolls",slug:"japanese_dolls",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎏":{name:"carp streamer",slug:"carp_streamer",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎐":{name:"wind chime",slug:"wind_chime",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎑":{name:"moon viewing ceremony",slug:"moon_viewing_ceremony",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧧":{name:"red envelope",slug:"red_envelope",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎀":{name:"ribbon",slug:"ribbon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎁":{name:"wrapped gift",slug:"wrapped_gift",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎗️":{name:"reminder ribbon",slug:"reminder_ribbon",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎟️":{name:"admission tickets",slug:"admission_tickets",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎫":{name:"ticket",slug:"ticket",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎖️":{name:"military medal",slug:"military_medal",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏆":{name:"trophy",slug:"trophy",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏅":{name:"sports medal",slug:"sports_medal",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥇":{name:"1st place medal",slug:"1st_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥈":{name:"2nd place medal",slug:"2nd_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥉":{name:"3rd place medal",slug:"3rd_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"⚽":{name:"soccer ball",slug:"soccer_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚾":{name:"baseball",slug:"baseball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥎":{name:"softball",slug:"softball",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏀":{name:"basketball",slug:"basketball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏐":{name:"volleyball",slug:"volleyball",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏈":{name:"american football",slug:"american_football",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏉":{name:"rugby football",slug:"rugby_football",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎾":{name:"tennis",slug:"tennis",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥏":{name:"flying disc",slug:"flying_disc",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎳":{name:"bowling",slug:"bowling",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏏":{name:"cricket game",slug:"cricket_game",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏑":{name:"field hockey",slug:"field_hockey",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏒":{name:"ice hockey",slug:"ice_hockey",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥍":{name:"lacrosse",slug:"lacrosse",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏓":{name:"ping pong",slug:"ping_pong",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏸":{name:"badminton",slug:"badminton",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥊":{name:"boxing glove",slug:"boxing_glove",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥋":{name:"martial arts uniform",slug:"martial_arts_uniform",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥅":{name:"goal net",slug:"goal_net",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"⛳":{name:"flag in hole",slug:"flag_in_hole",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛸️":{name:"ice skate",slug:"ice_skate",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎣":{name:"fishing pole",slug:"fishing_pole",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤿":{name:"diving mask",slug:"diving_mask",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🎽":{name:"running shirt",slug:"running_shirt",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎿":{name:"skis",slug:"skis",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛷":{name:"sled",slug:"sled",group:"Activities",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥌":{name:"curling stone",slug:"curling_stone",group:"Activities",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🎯":{name:"bullseye",slug:"bullseye",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪀":{name:"yo-yo",slug:"yo_yo",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🪁":{name:"kite",slug:"kite",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔫":{name:"water pistol",slug:"water_pistol",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎱":{name:"pool 8 ball",slug:"pool_8_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔮":{name:"crystal ball",slug:"crystal_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪄":{name:"magic wand",slug:"magic_wand",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🎮":{name:"video game",slug:"video_game",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕹️":{name:"joystick",slug:"joystick",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎰":{name:"slot machine",slug:"slot_machine",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎲":{name:"game die",slug:"game_die",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧩":{name:"puzzle piece",slug:"puzzle_piece",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧸":{name:"teddy bear",slug:"teddy_bear",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪅":{name:"piñata",slug:"pinata",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪩":{name:"mirror ball",slug:"mirror_ball",group:"Activities",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪆":{name:"nesting dolls",slug:"nesting_dolls",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"♠️":{name:"spade suit",slug:"spade_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♥️":{name:"heart suit",slug:"heart_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♦️":{name:"diamond suit",slug:"diamond_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♣️":{name:"club suit",slug:"club_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♟️":{name:"chess pawn",slug:"chess_pawn",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🃏":{name:"joker",slug:"joker",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🀄":{name:"mahjong red dragon",slug:"mahjong_red_dragon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎴":{name:"flower playing cards",slug:"flower_playing_cards",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎭":{name:"performing arts",slug:"performing_arts",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖼️":{name:"framed picture",slug:"framed_picture",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎨":{name:"artist palette",slug:"artist_palette",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧵":{name:"thread",slug:"thread",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪡":{name:"sewing needle",slug:"sewing_needle",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧶":{name:"yarn",slug:"yarn",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪢":{name:"knot",slug:"knot",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👓":{name:"glasses",slug:"glasses",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕶️":{name:"sunglasses",slug:"sunglasses",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🥽":{name:"goggles",slug:"goggles",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥼":{name:"lab coat",slug:"lab_coat",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦺":{name:"safety vest",slug:"safety_vest",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👔":{name:"necktie",slug:"necktie",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👕":{name:"t-shirt",slug:"t_shirt",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👖":{name:"jeans",slug:"jeans",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧣":{name:"scarf",slug:"scarf",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧤":{name:"gloves",slug:"gloves",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧥":{name:"coat",slug:"coat",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧦":{name:"socks",slug:"socks",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"👗":{name:"dress",slug:"dress",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👘":{name:"kimono",slug:"kimono",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥻":{name:"sari",slug:"sari",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩱":{name:"one-piece swimsuit",slug:"one_piece_swimsuit",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩲":{name:"briefs",slug:"briefs",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩳":{name:"shorts",slug:"shorts",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👙":{name:"bikini",slug:"bikini",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👚":{name:"woman’s clothes",slug:"woman_s_clothes",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪭":{name:"folding hand fan",slug:"folding_hand_fan",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"👛":{name:"purse",slug:"purse",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👜":{name:"handbag",slug:"handbag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👝":{name:"clutch bag",slug:"clutch_bag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛍️":{name:"shopping bags",slug:"shopping_bags",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎒":{name:"backpack",slug:"backpack",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩴":{name:"thong sandal",slug:"thong_sandal",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👞":{name:"man’s shoe",slug:"man_s_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👟":{name:"running shoe",slug:"running_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥾":{name:"hiking boot",slug:"hiking_boot",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥿":{name:"flat shoe",slug:"flat_shoe",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"👠":{name:"high-heeled shoe",slug:"high_heeled_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👡":{name:"woman’s sandal",slug:"woman_s_sandal",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩰":{name:"ballet shoes",slug:"ballet_shoes",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👢":{name:"woman’s boot",slug:"woman_s_boot",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪮":{name:"hair pick",slug:"hair_pick",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"👑":{name:"crown",slug:"crown",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👒":{name:"woman’s hat",slug:"woman_s_hat",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎩":{name:"top hat",slug:"top_hat",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎓":{name:"graduation cap",slug:"graduation_cap",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧢":{name:"billed cap",slug:"billed_cap",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🪖":{name:"military helmet",slug:"military_helmet",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"⛑️":{name:"rescue worker’s helmet",slug:"rescue_worker_s_helmet",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📿":{name:"prayer beads",slug:"prayer_beads",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💄":{name:"lipstick",slug:"lipstick",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💍":{name:"ring",slug:"ring",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💎":{name:"gem stone",slug:"gem_stone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔇":{name:"muted speaker",slug:"muted_speaker",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔈":{name:"speaker low volume",slug:"speaker_low_volume",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔉":{name:"speaker medium volume",slug:"speaker_medium_volume",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔊":{name:"speaker high volume",slug:"speaker_high_volume",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📢":{name:"loudspeaker",slug:"loudspeaker",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📣":{name:"megaphone",slug:"megaphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📯":{name:"postal horn",slug:"postal_horn",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔔":{name:"bell",slug:"bell",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔕":{name:"bell with slash",slug:"bell_with_slash",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎼":{name:"musical score",slug:"musical_score",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎵":{name:"musical note",slug:"musical_note",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎶":{name:"musical notes",slug:"musical_notes",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎙️":{name:"studio microphone",slug:"studio_microphone",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎚️":{name:"level slider",slug:"level_slider",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎛️":{name:"control knobs",slug:"control_knobs",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎤":{name:"microphone",slug:"microphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎧":{name:"headphone",slug:"headphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📻":{name:"radio",slug:"radio",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎷":{name:"saxophone",slug:"saxophone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪗":{name:"accordion",slug:"accordion",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🎸":{name:"guitar",slug:"guitar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎹":{name:"musical keyboard",slug:"musical_keyboard",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎺":{name:"trumpet",slug:"trumpet",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎻":{name:"violin",slug:"violin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪕":{name:"banjo",slug:"banjo",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥁":{name:"drum",slug:"drum",group:"Objects",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🪘":{name:"long drum",slug:"long_drum",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪇":{name:"maracas",slug:"maracas",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪈":{name:"flute",slug:"flute",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪉":{name:"harp",slug:"harp",group:"Objects",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"📱":{name:"mobile phone",slug:"mobile_phone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📲":{name:"mobile phone with arrow",slug:"mobile_phone_with_arrow",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☎️":{name:"telephone",slug:"telephone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📞":{name:"telephone receiver",slug:"telephone_receiver",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📟":{name:"pager",slug:"pager",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📠":{name:"fax machine",slug:"fax_machine",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔋":{name:"battery",slug:"battery",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪫":{name:"low battery",slug:"low_battery",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🔌":{name:"electric plug",slug:"electric_plug",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💻":{name:"laptop",slug:"laptop",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖥️":{name:"desktop computer",slug:"desktop_computer",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖨️":{name:"printer",slug:"printer",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⌨️":{name:"keyboard",slug:"keyboard",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🖱️":{name:"computer mouse",slug:"computer_mouse",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖲️":{name:"trackball",slug:"trackball",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💽":{name:"computer disk",slug:"computer_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💾":{name:"floppy disk",slug:"floppy_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💿":{name:"optical disk",slug:"optical_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📀":{name:"dvd",slug:"dvd",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧮":{name:"abacus",slug:"abacus",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎥":{name:"movie camera",slug:"movie_camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎞️":{name:"film frames",slug:"film_frames",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📽️":{name:"film projector",slug:"film_projector",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎬":{name:"clapper board",slug:"clapper_board",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📺":{name:"television",slug:"television",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📷":{name:"camera",slug:"camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📸":{name:"camera with flash",slug:"camera_with_flash",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📹":{name:"video camera",slug:"video_camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📼":{name:"videocassette",slug:"videocassette",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔍":{name:"magnifying glass tilted left",slug:"magnifying_glass_tilted_left",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔎":{name:"magnifying glass tilted right",slug:"magnifying_glass_tilted_right",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕯️":{name:"candle",slug:"candle",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💡":{name:"light bulb",slug:"light_bulb",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔦":{name:"flashlight",slug:"flashlight",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏮":{name:"red paper lantern",slug:"red_paper_lantern",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪔":{name:"diya lamp",slug:"diya_lamp",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"📔":{name:"notebook with decorative cover",slug:"notebook_with_decorative_cover",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📕":{name:"closed book",slug:"closed_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📖":{name:"open book",slug:"open_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📗":{name:"green book",slug:"green_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📘":{name:"blue book",slug:"blue_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📙":{name:"orange book",slug:"orange_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📚":{name:"books",slug:"books",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📓":{name:"notebook",slug:"notebook",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📒":{name:"ledger",slug:"ledger",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📃":{name:"page with curl",slug:"page_with_curl",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📜":{name:"scroll",slug:"scroll",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📄":{name:"page facing up",slug:"page_facing_up",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📰":{name:"newspaper",slug:"newspaper",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗞️":{name:"rolled-up newspaper",slug:"rolled_up_newspaper",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📑":{name:"bookmark tabs",slug:"bookmark_tabs",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔖":{name:"bookmark",slug:"bookmark",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏷️":{name:"label",slug:"label",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💰":{name:"money bag",slug:"money_bag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪙":{name:"coin",slug:"coin",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"💴":{name:"yen banknote",slug:"yen_banknote",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💵":{name:"dollar banknote",slug:"dollar_banknote",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💶":{name:"euro banknote",slug:"euro_banknote",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💷":{name:"pound banknote",slug:"pound_banknote",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💸":{name:"money with wings",slug:"money_with_wings",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💳":{name:"credit card",slug:"credit_card",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧾":{name:"receipt",slug:"receipt",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"💹":{name:"chart increasing with yen",slug:"chart_increasing_with_yen",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✉️":{name:"envelope",slug:"envelope",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📧":{name:"e-mail",slug:"e_mail",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📨":{name:"incoming envelope",slug:"incoming_envelope",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📩":{name:"envelope with arrow",slug:"envelope_with_arrow",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📤":{name:"outbox tray",slug:"outbox_tray",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📥":{name:"inbox tray",slug:"inbox_tray",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📦":{name:"package",slug:"package",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📫":{name:"closed mailbox with raised flag",slug:"closed_mailbox_with_raised_flag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📪":{name:"closed mailbox with lowered flag",slug:"closed_mailbox_with_lowered_flag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📬":{name:"open mailbox with raised flag",slug:"open_mailbox_with_raised_flag",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📭":{name:"open mailbox with lowered flag",slug:"open_mailbox_with_lowered_flag",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📮":{name:"postbox",slug:"postbox",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗳️":{name:"ballot box with ballot",slug:"ballot_box_with_ballot",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✏️":{name:"pencil",slug:"pencil",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✒️":{name:"black nib",slug:"black_nib",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖋️":{name:"fountain pen",slug:"fountain_pen",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖊️":{name:"pen",slug:"pen",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖌️":{name:"paintbrush",slug:"paintbrush",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖍️":{name:"crayon",slug:"crayon",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📝":{name:"memo",slug:"memo",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💼":{name:"briefcase",slug:"briefcase",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📁":{name:"file folder",slug:"file_folder",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📂":{name:"open file folder",slug:"open_file_folder",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗂️":{name:"card index dividers",slug:"card_index_dividers",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📅":{name:"calendar",slug:"calendar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📆":{name:"tear-off calendar",slug:"tear_off_calendar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗒️":{name:"spiral notepad",slug:"spiral_notepad",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗓️":{name:"spiral calendar",slug:"spiral_calendar",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📇":{name:"card index",slug:"card_index",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📈":{name:"chart increasing",slug:"chart_increasing",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📉":{name:"chart decreasing",slug:"chart_decreasing",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📊":{name:"bar chart",slug:"bar_chart",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📋":{name:"clipboard",slug:"clipboard",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📌":{name:"pushpin",slug:"pushpin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📍":{name:"round pushpin",slug:"round_pushpin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📎":{name:"paperclip",slug:"paperclip",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖇️":{name:"linked paperclips",slug:"linked_paperclips",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📏":{name:"straight ruler",slug:"straight_ruler",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📐":{name:"triangular ruler",slug:"triangular_ruler",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✂️":{name:"scissors",slug:"scissors",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗃️":{name:"card file box",slug:"card_file_box",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗄️":{name:"file cabinet",slug:"file_cabinet",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗑️":{name:"wastebasket",slug:"wastebasket",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔒":{name:"locked",slug:"locked",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔓":{name:"unlocked",slug:"unlocked",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔏":{name:"locked with pen",slug:"locked_with_pen",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔐":{name:"locked with key",slug:"locked_with_key",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔑":{name:"key",slug:"key",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗝️":{name:"old key",slug:"old_key",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔨":{name:"hammer",slug:"hammer",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪓":{name:"axe",slug:"axe",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⛏️":{name:"pick",slug:"pick",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚒️":{name:"hammer and pick",slug:"hammer_and_pick",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛠️":{name:"hammer and wrench",slug:"hammer_and_wrench",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗡️":{name:"dagger",slug:"dagger",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚔️":{name:"crossed swords",slug:"crossed_swords",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💣":{name:"bomb",slug:"bomb",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪃":{name:"boomerang",slug:"boomerang",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏹":{name:"bow and arrow",slug:"bow_and_arrow",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛡️":{name:"shield",slug:"shield",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪚":{name:"carpentry saw",slug:"carpentry_saw",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🔧":{name:"wrench",slug:"wrench",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪛":{name:"screwdriver",slug:"screwdriver",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🔩":{name:"nut and bolt",slug:"nut_and_bolt",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚙️":{name:"gear",slug:"gear",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🗜️":{name:"clamp",slug:"clamp",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚖️":{name:"balance scale",slug:"balance_scale",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦯":{name:"white cane",slug:"white_cane",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔗":{name:"link",slug:"link",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛓️‍💥":{name:"broken chain",slug:"broken_chain",group:"Objects",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"⛓️":{name:"chains",slug:"chains",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪝":{name:"hook",slug:"hook",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧰":{name:"toolbox",slug:"toolbox",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧲":{name:"magnet",slug:"magnet",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪜":{name:"ladder",slug:"ladder",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪏":{name:"shovel",slug:"shovel",group:"Objects",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"⚗️":{name:"alembic",slug:"alembic",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧪":{name:"test tube",slug:"test_tube",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧫":{name:"petri dish",slug:"petri_dish",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧬":{name:"dna",slug:"dna",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🔬":{name:"microscope",slug:"microscope",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔭":{name:"telescope",slug:"telescope",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📡":{name:"satellite antenna",slug:"satellite_antenna",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💉":{name:"syringe",slug:"syringe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩸":{name:"drop of blood",slug:"drop_of_blood",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💊":{name:"pill",slug:"pill",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩹":{name:"adhesive bandage",slug:"adhesive_bandage",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩼":{name:"crutch",slug:"crutch",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🩺":{name:"stethoscope",slug:"stethoscope",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩻":{name:"x-ray",slug:"x_ray",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🚪":{name:"door",slug:"door",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛗":{name:"elevator",slug:"elevator",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪞":{name:"mirror",slug:"mirror",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪟":{name:"window",slug:"window",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🛏️":{name:"bed",slug:"bed",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛋️":{name:"couch and lamp",slug:"couch_and_lamp",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪑":{name:"chair",slug:"chair",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🚽":{name:"toilet",slug:"toilet",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪠":{name:"plunger",slug:"plunger",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚿":{name:"shower",slug:"shower",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛁":{name:"bathtub",slug:"bathtub",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪤":{name:"mouse trap",slug:"mouse_trap",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪒":{name:"razor",slug:"razor",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧴":{name:"lotion bottle",slug:"lotion_bottle",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧷":{name:"safety pin",slug:"safety_pin",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧹":{name:"broom",slug:"broom",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧺":{name:"basket",slug:"basket",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧻":{name:"roll of paper",slug:"roll_of_paper",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪣":{name:"bucket",slug:"bucket",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧼":{name:"soap",slug:"soap",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🫧":{name:"bubbles",slug:"bubbles",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪥":{name:"toothbrush",slug:"toothbrush",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧽":{name:"sponge",slug:"sponge",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧯":{name:"fire extinguisher",slug:"fire_extinguisher",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🛒":{name:"shopping cart",slug:"shopping_cart",group:"Objects",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚬":{name:"cigarette",slug:"cigarette",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚰️":{name:"coffin",slug:"coffin",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪦":{name:"headstone",slug:"headstone",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"⚱️":{name:"funeral urn",slug:"funeral_urn",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧿":{name:"nazar amulet",slug:"nazar_amulet",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪬":{name:"hamsa",slug:"hamsa",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🗿":{name:"moai",slug:"moai",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪧":{name:"placard",slug:"placard",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪪":{name:"identification card",slug:"identification_card",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏧":{name:"ATM sign",slug:"atm_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚮":{name:"litter in bin sign",slug:"litter_in_bin_sign",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚰":{name:"potable water",slug:"potable_water",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"♿":{name:"wheelchair symbol",slug:"wheelchair_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚹":{name:"men’s room",slug:"men_s_room",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚺":{name:"women’s room",slug:"women_s_room",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚻":{name:"restroom",slug:"restroom",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚼":{name:"baby symbol",slug:"baby_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚾":{name:"water closet",slug:"water_closet",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛂":{name:"passport control",slug:"passport_control",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛃":{name:"customs",slug:"customs",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛄":{name:"baggage claim",slug:"baggage_claim",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛅":{name:"left luggage",slug:"left_luggage",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⚠️":{name:"warning",slug:"warning",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚸":{name:"children crossing",slug:"children_crossing",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛔":{name:"no entry",slug:"no_entry",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚫":{name:"prohibited",slug:"prohibited",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚳":{name:"no bicycles",slug:"no_bicycles",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚭":{name:"no smoking",slug:"no_smoking",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚯":{name:"no littering",slug:"no_littering",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚱":{name:"non-potable water",slug:"non_potable_water",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚷":{name:"no pedestrians",slug:"no_pedestrians",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📵":{name:"no mobile phones",slug:"no_mobile_phones",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔞":{name:"no one under eighteen",slug:"no_one_under_eighteen",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☢️":{name:"radioactive",slug:"radioactive",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☣️":{name:"biohazard",slug:"biohazard",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⬆️":{name:"up arrow",slug:"up_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↗️":{name:"up-right arrow",slug:"up_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➡️":{name:"right arrow",slug:"right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↘️":{name:"down-right arrow",slug:"down_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬇️":{name:"down arrow",slug:"down_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↙️":{name:"down-left arrow",slug:"down_left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬅️":{name:"left arrow",slug:"left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↖️":{name:"up-left arrow",slug:"up_left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↕️":{name:"up-down arrow",slug:"up_down_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↔️":{name:"left-right arrow",slug:"left_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↩️":{name:"right arrow curving left",slug:"right_arrow_curving_left",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↪️":{name:"left arrow curving right",slug:"left_arrow_curving_right",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⤴️":{name:"right arrow curving up",slug:"right_arrow_curving_up",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⤵️":{name:"right arrow curving down",slug:"right_arrow_curving_down",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔃":{name:"clockwise vertical arrows",slug:"clockwise_vertical_arrows",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔄":{name:"counterclockwise arrows button",slug:"counterclockwise_arrows_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔙":{name:"BACK arrow",slug:"back_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔚":{name:"END arrow",slug:"end_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔛":{name:"ON! arrow",slug:"on_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔜":{name:"SOON arrow",slug:"soon_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔝":{name:"TOP arrow",slug:"top_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛐":{name:"place of worship",slug:"place_of_worship",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⚛️":{name:"atom symbol",slug:"atom_symbol",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕉️":{name:"om",slug:"om",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✡️":{name:"star of David",slug:"star_of_david",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☸️":{name:"wheel of dharma",slug:"wheel_of_dharma",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☯️":{name:"yin yang",slug:"yin_yang",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✝️":{name:"latin cross",slug:"latin_cross",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☦️":{name:"orthodox cross",slug:"orthodox_cross",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☪️":{name:"star and crescent",slug:"star_and_crescent",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☮️":{name:"peace symbol",slug:"peace_symbol",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕎":{name:"menorah",slug:"menorah",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔯":{name:"dotted six-pointed star",slug:"dotted_six_pointed_star",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪯":{name:"khanda",slug:"khanda",group:"Symbols",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"♈":{name:"Aries",slug:"aries",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♉":{name:"Taurus",slug:"taurus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♊":{name:"Gemini",slug:"gemini",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♋":{name:"Cancer",slug:"cancer",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♌":{name:"Leo",slug:"leo",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♍":{name:"Virgo",slug:"virgo",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♎":{name:"Libra",slug:"libra",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♏":{name:"Scorpio",slug:"scorpio",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♐":{name:"Sagittarius",slug:"sagittarius",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♑":{name:"Capricorn",slug:"capricorn",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♒":{name:"Aquarius",slug:"aquarius",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♓":{name:"Pisces",slug:"pisces",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛎":{name:"Ophiuchus",slug:"ophiuchus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔀":{name:"shuffle tracks button",slug:"shuffle_tracks_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔁":{name:"repeat button",slug:"repeat_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔂":{name:"repeat single button",slug:"repeat_single_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"▶️":{name:"play button",slug:"play_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏩":{name:"fast-forward button",slug:"fast_forward_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏭️":{name:"next track button",slug:"next_track_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏯️":{name:"play or pause button",slug:"play_or_pause_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"◀️":{name:"reverse button",slug:"reverse_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏪":{name:"fast reverse button",slug:"fast_reverse_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏮️":{name:"last track button",slug:"last_track_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔼":{name:"upwards button",slug:"upwards_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏫":{name:"fast up button",slug:"fast_up_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔽":{name:"downwards button",slug:"downwards_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏬":{name:"fast down button",slug:"fast_down_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏸️":{name:"pause button",slug:"pause_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏹️":{name:"stop button",slug:"stop_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏺️":{name:"record button",slug:"record_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏏️":{name:"eject button",slug:"eject_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎦":{name:"cinema",slug:"cinema",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔅":{name:"dim button",slug:"dim_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔆":{name:"bright button",slug:"bright_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📶":{name:"antenna bars",slug:"antenna_bars",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛜":{name:"wireless",slug:"wireless",group:"Symbols",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"📳":{name:"vibration mode",slug:"vibration_mode",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📴":{name:"mobile phone off",slug:"mobile_phone_off",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♀️":{name:"female sign",slug:"female_sign",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"♂️":{name:"male sign",slug:"male_sign",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"⚧️":{name:"transgender symbol",slug:"transgender_symbol",group:"Symbols",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"✖️":{name:"multiply",slug:"multiply",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➕":{name:"plus",slug:"plus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➖":{name:"minus",slug:"minus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➗":{name:"divide",slug:"divide",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟰":{name:"heavy equals sign",slug:"heavy_equals_sign",group:"Symbols",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"♾️":{name:"infinity",slug:"infinity",group:"Symbols",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"‼️":{name:"double exclamation mark",slug:"double_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⁉️":{name:"exclamation question mark",slug:"exclamation_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❓":{name:"red question mark",slug:"red_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❔":{name:"white question mark",slug:"white_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❕":{name:"white exclamation mark",slug:"white_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❗":{name:"red exclamation mark",slug:"red_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"〰️":{name:"wavy dash",slug:"wavy_dash",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💱":{name:"currency exchange",slug:"currency_exchange",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💲":{name:"heavy dollar sign",slug:"heavy_dollar_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚕️":{name:"medical symbol",slug:"medical_symbol",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"♻️":{name:"recycling symbol",slug:"recycling_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚜️":{name:"fleur-de-lis",slug:"fleur_de_lis",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔱":{name:"trident emblem",slug:"trident_emblem",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📛":{name:"name badge",slug:"name_badge",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔰":{name:"Japanese symbol for beginner",slug:"japanese_symbol_for_beginner",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⭕":{name:"hollow red circle",slug:"hollow_red_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✅":{name:"check mark button",slug:"check_mark_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☑️":{name:"check box with check",slug:"check_box_with_check",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✔️":{name:"check mark",slug:"check_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❌":{name:"cross mark",slug:"cross_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❎":{name:"cross mark button",slug:"cross_mark_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➰":{name:"curly loop",slug:"curly_loop",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➿":{name:"double curly loop",slug:"double_curly_loop",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"〽️":{name:"part alternation mark",slug:"part_alternation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✳️":{name:"eight-spoked asterisk",slug:"eight_spoked_asterisk",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✴️":{name:"eight-pointed star",slug:"eight_pointed_star",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❇️":{name:"sparkle",slug:"sparkle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"©️":{name:"copyright",slug:"copyright",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"®️":{name:"registered",slug:"registered",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"™️":{name:"trade mark",slug:"trade_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫟":{name:"splatter",slug:"splatter",group:"Symbols",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"#️⃣":{name:"keycap #",slug:"keycap_number_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"*️⃣":{name:"keycap *",slug:"keycap_asterisk",group:"Symbols",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"0️⃣":{name:"keycap 0",slug:"keycap_0",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"1️⃣":{name:"keycap 1",slug:"keycap_1",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"2️⃣":{name:"keycap 2",slug:"keycap_2",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"3️⃣":{name:"keycap 3",slug:"keycap_3",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"4️⃣":{name:"keycap 4",slug:"keycap_4",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"5️⃣":{name:"keycap 5",slug:"keycap_5",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"6️⃣":{name:"keycap 6",slug:"keycap_6",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"7️⃣":{name:"keycap 7",slug:"keycap_7",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"8️⃣":{name:"keycap 8",slug:"keycap_8",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"9️⃣":{name:"keycap 9",slug:"keycap_9",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔟":{name:"keycap 10",slug:"keycap_10",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔠":{name:"input latin uppercase",slug:"input_latin_uppercase",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔡":{name:"input latin lowercase",slug:"input_latin_lowercase",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔢":{name:"input numbers",slug:"input_numbers",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔣":{name:"input symbols",slug:"input_symbols",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔤":{name:"input latin letters",slug:"input_latin_letters",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅰️":{name:"A button (blood type)",slug:"a_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆎":{name:"AB button (blood type)",slug:"ab_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅱️":{name:"B button (blood type)",slug:"b_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆑":{name:"CL button",slug:"cl_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆒":{name:"COOL button",slug:"cool_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆓":{name:"FREE button",slug:"free_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"ℹ️":{name:"information",slug:"information",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆔":{name:"ID button",slug:"id_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"Ⓜ️":{name:"circled M",slug:"circled_m",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆕":{name:"NEW button",slug:"new_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆖":{name:"NG button",slug:"ng_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅾️":{name:"O button (blood type)",slug:"o_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆗":{name:"OK button",slug:"ok_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅿️":{name:"P button",slug:"p_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆘":{name:"SOS button",slug:"sos_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆙":{name:"UP! button",slug:"up_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆚":{name:"VS button",slug:"vs_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈁":{name:"Japanese “here” button",slug:"japanese_here_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈂️":{name:"Japanese “service charge” button",slug:"japanese_service_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈷️":{name:"Japanese “monthly amount” button",slug:"japanese_monthly_amount_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈶":{name:"Japanese “not free of charge” button",slug:"japanese_not_free_of_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈯":{name:"Japanese “reserved” button",slug:"japanese_reserved_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🉐":{name:"Japanese “bargain” button",slug:"japanese_bargain_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈹":{name:"Japanese “discount” button",slug:"japanese_discount_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈚":{name:"Japanese “free of charge” button",slug:"japanese_free_of_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈲":{name:"Japanese “prohibited” button",slug:"japanese_prohibited_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🉑":{name:"Japanese “acceptable” button",slug:"japanese_acceptable_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈸":{name:"Japanese “application” button",slug:"japanese_application_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈴":{name:"Japanese “passing grade” button",slug:"japanese_passing_grade_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈳":{name:"Japanese “vacancy” button",slug:"japanese_vacancy_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"㊗️":{name:"Japanese “congratulations” button",slug:"japanese_congratulations_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"㊙️":{name:"Japanese “secret” button",slug:"japanese_secret_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈺":{name:"Japanese “open for business” button",slug:"japanese_open_for_business_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈵":{name:"Japanese “no vacancy” button",slug:"japanese_no_vacancy_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔴":{name:"red circle",slug:"red_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟠":{name:"orange circle",slug:"orange_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟡":{name:"yellow circle",slug:"yellow_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟢":{name:"green circle",slug:"green_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔵":{name:"blue circle",slug:"blue_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟣":{name:"purple circle",slug:"purple_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟤":{name:"brown circle",slug:"brown_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⚫":{name:"black circle",slug:"black_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚪":{name:"white circle",slug:"white_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟥":{name:"red square",slug:"red_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟧":{name:"orange square",slug:"orange_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟨":{name:"yellow square",slug:"yellow_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟩":{name:"green square",slug:"green_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟦":{name:"blue square",slug:"blue_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟪":{name:"purple square",slug:"purple_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟫":{name:"brown square",slug:"brown_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⬛":{name:"black large square",slug:"black_large_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬜":{name:"white large square",slug:"white_large_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◼️":{name:"black medium square",slug:"black_medium_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◻️":{name:"white medium square",slug:"white_medium_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◾":{name:"black medium-small square",slug:"black_medium_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◽":{name:"white medium-small square",slug:"white_medium_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"▪️":{name:"black small square",slug:"black_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"▫️":{name:"white small square",slug:"white_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔶":{name:"large orange diamond",slug:"large_orange_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔷":{name:"large blue diamond",slug:"large_blue_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔸":{name:"small orange diamond",slug:"small_orange_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔹":{name:"small blue diamond",slug:"small_blue_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔺":{name:"red triangle pointed up",slug:"red_triangle_pointed_up",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔻":{name:"red triangle pointed down",slug:"red_triangle_pointed_down",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💠":{name:"diamond with a dot",slug:"diamond_with_a_dot",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔘":{name:"radio button",slug:"radio_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔳":{name:"white square button",slug:"white_square_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔲":{name:"black square button",slug:"black_square_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏁":{name:"chequered flag",slug:"chequered_flag",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚩":{name:"triangular flag",slug:"triangular_flag",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎌":{name:"crossed flags",slug:"crossed_flags",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏴":{name:"black flag",slug:"black_flag",group:"Flags",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏳️":{name:"white flag",slug:"white_flag",group:"Flags",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏳️‍🌈":{name:"rainbow flag",slug:"rainbow_flag",group:"Flags",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🏳️‍⚧️":{name:"transgender flag",slug:"transgender_flag",group:"Flags",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏴‍☠️":{name:"pirate flag",slug:"pirate_flag",group:"Flags",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🇦🇨":{name:"flag Ascension Island",slug:"flag_ascension_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇩":{name:"flag Andorra",slug:"flag_andorra",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇪":{name:"flag United Arab Emirates",slug:"flag_united_arab_emirates",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇫":{name:"flag Afghanistan",slug:"flag_afghanistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇬":{name:"flag Antigua & Barbuda",slug:"flag_antigua_barbuda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇮":{name:"flag Anguilla",slug:"flag_anguilla",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇱":{name:"flag Albania",slug:"flag_albania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇲":{name:"flag Armenia",slug:"flag_armenia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇴":{name:"flag Angola",slug:"flag_angola",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇶":{name:"flag Antarctica",slug:"flag_antarctica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇷":{name:"flag Argentina",slug:"flag_argentina",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇸":{name:"flag American Samoa",slug:"flag_american_samoa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇹":{name:"flag Austria",slug:"flag_austria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇺":{name:"flag Australia",slug:"flag_australia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇼":{name:"flag Aruba",slug:"flag_aruba",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇽":{name:"flag Åland Islands",slug:"flag_aland_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇿":{name:"flag Azerbaijan",slug:"flag_azerbaijan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇦":{name:"flag Bosnia & Herzegovina",slug:"flag_bosnia_herzegovina",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇧":{name:"flag Barbados",slug:"flag_barbados",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇩":{name:"flag Bangladesh",slug:"flag_bangladesh",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇪":{name:"flag Belgium",slug:"flag_belgium",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇫":{name:"flag Burkina Faso",slug:"flag_burkina_faso",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇬":{name:"flag Bulgaria",slug:"flag_bulgaria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇭":{name:"flag Bahrain",slug:"flag_bahrain",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇮":{name:"flag Burundi",slug:"flag_burundi",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇯":{name:"flag Benin",slug:"flag_benin",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇱":{name:"flag St. Barthélemy",slug:"flag_st_barthelemy",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇲":{name:"flag Bermuda",slug:"flag_bermuda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇳":{name:"flag Brunei",slug:"flag_brunei",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇴":{name:"flag Bolivia",slug:"flag_bolivia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇶":{name:"flag Caribbean Netherlands",slug:"flag_caribbean_netherlands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇷":{name:"flag Brazil",slug:"flag_brazil",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇸":{name:"flag Bahamas",slug:"flag_bahamas",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇹":{name:"flag Bhutan",slug:"flag_bhutan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇻":{name:"flag Bouvet Island",slug:"flag_bouvet_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇼":{name:"flag Botswana",slug:"flag_botswana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇾":{name:"flag Belarus",slug:"flag_belarus",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇿":{name:"flag Belize",slug:"flag_belize",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇦":{name:"flag Canada",slug:"flag_canada",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇨":{name:"flag Cocos (Keeling) Islands",slug:"flag_cocos_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇩":{name:"flag Congo - Kinshasa",slug:"flag_congo_kinshasa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇫":{name:"flag Central African Republic",slug:"flag_central_african_republic",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇬":{name:"flag Congo - Brazzaville",slug:"flag_congo_brazzaville",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇭":{name:"flag Switzerland",slug:"flag_switzerland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇮":{name:"flag Côte d’Ivoire",slug:"flag_cote_d_ivoire",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇰":{name:"flag Cook Islands",slug:"flag_cook_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇱":{name:"flag Chile",slug:"flag_chile",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇲":{name:"flag Cameroon",slug:"flag_cameroon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇳":{name:"flag China",slug:"flag_china",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇨🇴":{name:"flag Colombia",slug:"flag_colombia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇵":{name:"flag Clipperton Island",slug:"flag_clipperton_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇶":{name:"flag Sark",slug:"flag_sark",group:"Flags",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🇨🇷":{name:"flag Costa Rica",slug:"flag_costa_rica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇺":{name:"flag Cuba",slug:"flag_cuba",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇻":{name:"flag Cape Verde",slug:"flag_cape_verde",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇼":{name:"flag Curaçao",slug:"flag_curacao",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇽":{name:"flag Christmas Island",slug:"flag_christmas_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇾":{name:"flag Cyprus",slug:"flag_cyprus",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇿":{name:"flag Czechia",slug:"flag_czechia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇪":{name:"flag Germany",slug:"flag_germany",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇩🇬":{name:"flag Diego Garcia",slug:"flag_diego_garcia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇯":{name:"flag Djibouti",slug:"flag_djibouti",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇰":{name:"flag Denmark",slug:"flag_denmark",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇲":{name:"flag Dominica",slug:"flag_dominica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇴":{name:"flag Dominican Republic",slug:"flag_dominican_republic",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇿":{name:"flag Algeria",slug:"flag_algeria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇦":{name:"flag Ceuta & Melilla",slug:"flag_ceuta_melilla",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇨":{name:"flag Ecuador",slug:"flag_ecuador",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇪":{name:"flag Estonia",slug:"flag_estonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇬":{name:"flag Egypt",slug:"flag_egypt",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇭":{name:"flag Western Sahara",slug:"flag_western_sahara",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇷":{name:"flag Eritrea",slug:"flag_eritrea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇸":{name:"flag Spain",slug:"flag_spain",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇪🇹":{name:"flag Ethiopia",slug:"flag_ethiopia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇺":{name:"flag European Union",slug:"flag_european_union",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇮":{name:"flag Finland",slug:"flag_finland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇯":{name:"flag Fiji",slug:"flag_fiji",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇰":{name:"flag Falkland Islands",slug:"flag_falkland_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇲":{name:"flag Micronesia",slug:"flag_micronesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇴":{name:"flag Faroe Islands",slug:"flag_faroe_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇷":{name:"flag France",slug:"flag_france",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇬🇦":{name:"flag Gabon",slug:"flag_gabon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇧":{name:"flag United Kingdom",slug:"flag_united_kingdom",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇬🇩":{name:"flag Grenada",slug:"flag_grenada",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇪":{name:"flag Georgia",slug:"flag_georgia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇫":{name:"flag French Guiana",slug:"flag_french_guiana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇬":{name:"flag Guernsey",slug:"flag_guernsey",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇭":{name:"flag Ghana",slug:"flag_ghana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇮":{name:"flag Gibraltar",slug:"flag_gibraltar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇱":{name:"flag Greenland",slug:"flag_greenland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇲":{name:"flag Gambia",slug:"flag_gambia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇳":{name:"flag Guinea",slug:"flag_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇵":{name:"flag Guadeloupe",slug:"flag_guadeloupe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇶":{name:"flag Equatorial Guinea",slug:"flag_equatorial_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇷":{name:"flag Greece",slug:"flag_greece",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇸":{name:"flag South Georgia & South Sandwich Islands",slug:"flag_south_georgia_south_sandwich_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇹":{name:"flag Guatemala",slug:"flag_guatemala",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇺":{name:"flag Guam",slug:"flag_guam",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇼":{name:"flag Guinea-Bissau",slug:"flag_guinea_bissau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇾":{name:"flag Guyana",slug:"flag_guyana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇰":{name:"flag Hong Kong SAR China",slug:"flag_hong_kong_sar_china",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇲":{name:"flag Heard & McDonald Islands",slug:"flag_heard_mcdonald_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇳":{name:"flag Honduras",slug:"flag_honduras",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇷":{name:"flag Croatia",slug:"flag_croatia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇹":{name:"flag Haiti",slug:"flag_haiti",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇺":{name:"flag Hungary",slug:"flag_hungary",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇨":{name:"flag Canary Islands",slug:"flag_canary_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇩":{name:"flag Indonesia",slug:"flag_indonesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇪":{name:"flag Ireland",slug:"flag_ireland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇱":{name:"flag Israel",slug:"flag_israel",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇲":{name:"flag Isle of Man",slug:"flag_isle_of_man",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇳":{name:"flag India",slug:"flag_india",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇴":{name:"flag British Indian Ocean Territory",slug:"flag_british_indian_ocean_territory",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇶":{name:"flag Iraq",slug:"flag_iraq",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇷":{name:"flag Iran",slug:"flag_iran",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇸":{name:"flag Iceland",slug:"flag_iceland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇹":{name:"flag Italy",slug:"flag_italy",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇯🇪":{name:"flag Jersey",slug:"flag_jersey",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇲":{name:"flag Jamaica",slug:"flag_jamaica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇴":{name:"flag Jordan",slug:"flag_jordan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇵":{name:"flag Japan",slug:"flag_japan",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇰🇪":{name:"flag Kenya",slug:"flag_kenya",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇬":{name:"flag Kyrgyzstan",slug:"flag_kyrgyzstan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇭":{name:"flag Cambodia",slug:"flag_cambodia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇮":{name:"flag Kiribati",slug:"flag_kiribati",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇲":{name:"flag Comoros",slug:"flag_comoros",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇳":{name:"flag St. Kitts & Nevis",slug:"flag_st_kitts_nevis",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇵":{name:"flag North Korea",slug:"flag_north_korea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇷":{name:"flag South Korea",slug:"flag_south_korea",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇰🇼":{name:"flag Kuwait",slug:"flag_kuwait",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇾":{name:"flag Cayman Islands",slug:"flag_cayman_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇿":{name:"flag Kazakhstan",slug:"flag_kazakhstan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇦":{name:"flag Laos",slug:"flag_laos",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇧":{name:"flag Lebanon",slug:"flag_lebanon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇨":{name:"flag St. Lucia",slug:"flag_st_lucia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇮":{name:"flag Liechtenstein",slug:"flag_liechtenstein",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇰":{name:"flag Sri Lanka",slug:"flag_sri_lanka",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇷":{name:"flag Liberia",slug:"flag_liberia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇸":{name:"flag Lesotho",slug:"flag_lesotho",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇹":{name:"flag Lithuania",slug:"flag_lithuania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇺":{name:"flag Luxembourg",slug:"flag_luxembourg",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇻":{name:"flag Latvia",slug:"flag_latvia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇾":{name:"flag Libya",slug:"flag_libya",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇦":{name:"flag Morocco",slug:"flag_morocco",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇨":{name:"flag Monaco",slug:"flag_monaco",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇩":{name:"flag Moldova",slug:"flag_moldova",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇪":{name:"flag Montenegro",slug:"flag_montenegro",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇫":{name:"flag St. Martin",slug:"flag_st_martin",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇬":{name:"flag Madagascar",slug:"flag_madagascar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇭":{name:"flag Marshall Islands",slug:"flag_marshall_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇰":{name:"flag North Macedonia",slug:"flag_north_macedonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇱":{name:"flag Mali",slug:"flag_mali",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇲":{name:"flag Myanmar (Burma)",slug:"flag_myanmar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇳":{name:"flag Mongolia",slug:"flag_mongolia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇴":{name:"flag Macao SAR China",slug:"flag_macao_sar_china",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇵":{name:"flag Northern Mariana Islands",slug:"flag_northern_mariana_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇶":{name:"flag Martinique",slug:"flag_martinique",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇷":{name:"flag Mauritania",slug:"flag_mauritania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇸":{name:"flag Montserrat",slug:"flag_montserrat",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇹":{name:"flag Malta",slug:"flag_malta",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇺":{name:"flag Mauritius",slug:"flag_mauritius",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇻":{name:"flag Maldives",slug:"flag_maldives",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇼":{name:"flag Malawi",slug:"flag_malawi",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇽":{name:"flag Mexico",slug:"flag_mexico",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇾":{name:"flag Malaysia",slug:"flag_malaysia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇿":{name:"flag Mozambique",slug:"flag_mozambique",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇦":{name:"flag Namibia",slug:"flag_namibia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇨":{name:"flag New Caledonia",slug:"flag_new_caledonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇪":{name:"flag Niger",slug:"flag_niger",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇫":{name:"flag Norfolk Island",slug:"flag_norfolk_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇬":{name:"flag Nigeria",slug:"flag_nigeria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇮":{name:"flag Nicaragua",slug:"flag_nicaragua",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇱":{name:"flag Netherlands",slug:"flag_netherlands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇴":{name:"flag Norway",slug:"flag_norway",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇵":{name:"flag Nepal",slug:"flag_nepal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇷":{name:"flag Nauru",slug:"flag_nauru",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇺":{name:"flag Niue",slug:"flag_niue",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇿":{name:"flag New Zealand",slug:"flag_new_zealand",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇴🇲":{name:"flag Oman",slug:"flag_oman",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇦":{name:"flag Panama",slug:"flag_panama",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇪":{name:"flag Peru",slug:"flag_peru",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇫":{name:"flag French Polynesia",slug:"flag_french_polynesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇬":{name:"flag Papua New Guinea",slug:"flag_papua_new_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇭":{name:"flag Philippines",slug:"flag_philippines",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇰":{name:"flag Pakistan",slug:"flag_pakistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇱":{name:"flag Poland",slug:"flag_poland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇲":{name:"flag St. Pierre & Miquelon",slug:"flag_st_pierre_miquelon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇳":{name:"flag Pitcairn Islands",slug:"flag_pitcairn_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇷":{name:"flag Puerto Rico",slug:"flag_puerto_rico",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇸":{name:"flag Palestinian Territories",slug:"flag_palestinian_territories",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇹":{name:"flag Portugal",slug:"flag_portugal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇼":{name:"flag Palau",slug:"flag_palau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇾":{name:"flag Paraguay",slug:"flag_paraguay",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇶🇦":{name:"flag Qatar",slug:"flag_qatar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇪":{name:"flag Réunion",slug:"flag_reunion",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇴":{name:"flag Romania",slug:"flag_romania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇸":{name:"flag Serbia",slug:"flag_serbia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇺":{name:"flag Russia",slug:"flag_russia",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇷🇼":{name:"flag Rwanda",slug:"flag_rwanda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇦":{name:"flag Saudi Arabia",slug:"flag_saudi_arabia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇧":{name:"flag Solomon Islands",slug:"flag_solomon_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇨":{name:"flag Seychelles",slug:"flag_seychelles",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇩":{name:"flag Sudan",slug:"flag_sudan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇪":{name:"flag Sweden",slug:"flag_sweden",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇬":{name:"flag Singapore",slug:"flag_singapore",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇭":{name:"flag St. Helena",slug:"flag_st_helena",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇮":{name:"flag Slovenia",slug:"flag_slovenia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇯":{name:"flag Svalbard & Jan Mayen",slug:"flag_svalbard_jan_mayen",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇰":{name:"flag Slovakia",slug:"flag_slovakia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇱":{name:"flag Sierra Leone",slug:"flag_sierra_leone",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇲":{name:"flag San Marino",slug:"flag_san_marino",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇳":{name:"flag Senegal",slug:"flag_senegal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇴":{name:"flag Somalia",slug:"flag_somalia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇷":{name:"flag Suriname",slug:"flag_suriname",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇸":{name:"flag South Sudan",slug:"flag_south_sudan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇹":{name:"flag São Tomé & Príncipe",slug:"flag_sao_tome_principe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇻":{name:"flag El Salvador",slug:"flag_el_salvador",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇽":{name:"flag Sint Maarten",slug:"flag_sint_maarten",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇾":{name:"flag Syria",slug:"flag_syria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇿":{name:"flag Eswatini",slug:"flag_eswatini",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇦":{name:"flag Tristan da Cunha",slug:"flag_tristan_da_cunha",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇨":{name:"flag Turks & Caicos Islands",slug:"flag_turks_caicos_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇩":{name:"flag Chad",slug:"flag_chad",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇫":{name:"flag French Southern Territories",slug:"flag_french_southern_territories",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇬":{name:"flag Togo",slug:"flag_togo",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇭":{name:"flag Thailand",slug:"flag_thailand",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇯":{name:"flag Tajikistan",slug:"flag_tajikistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇰":{name:"flag Tokelau",slug:"flag_tokelau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇱":{name:"flag Timor-Leste",slug:"flag_timor_leste",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇲":{name:"flag Turkmenistan",slug:"flag_turkmenistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇳":{name:"flag Tunisia",slug:"flag_tunisia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇴":{name:"flag Tonga",slug:"flag_tonga",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇷":{name:"flag Türkiye",slug:"flag_turkiye",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇹":{name:"flag Trinidad & Tobago",slug:"flag_trinidad_tobago",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇻":{name:"flag Tuvalu",slug:"flag_tuvalu",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇼":{name:"flag Taiwan",slug:"flag_taiwan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇿":{name:"flag Tanzania",slug:"flag_tanzania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇦":{name:"flag Ukraine",slug:"flag_ukraine",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇬":{name:"flag Uganda",slug:"flag_uganda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇲":{name:"flag U.S. Outlying Islands",slug:"flag_u_s_outlying_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇳":{name:"flag United Nations",slug:"flag_united_nations",group:"Flags",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🇺🇸":{name:"flag United States",slug:"flag_united_states",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇺🇾":{name:"flag Uruguay",slug:"flag_uruguay",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇿":{name:"flag Uzbekistan",slug:"flag_uzbekistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇦":{name:"flag Vatican City",slug:"flag_vatican_city",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇨":{name:"flag St. Vincent & Grenadines",slug:"flag_st_vincent_grenadines",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇪":{name:"flag Venezuela",slug:"flag_venezuela",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇬":{name:"flag British Virgin Islands",slug:"flag_british_virgin_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇮":{name:"flag U.S. Virgin Islands",slug:"flag_u_s_virgin_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇳":{name:"flag Vietnam",slug:"flag_vietnam",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇺":{name:"flag Vanuatu",slug:"flag_vanuatu",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇼🇫":{name:"flag Wallis & Futuna",slug:"flag_wallis_futuna",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇼🇸":{name:"flag Samoa",slug:"flag_samoa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇽🇰":{name:"flag Kosovo",slug:"flag_kosovo",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇾🇪":{name:"flag Yemen",slug:"flag_yemen",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇾🇹":{name:"flag Mayotte",slug:"flag_mayotte",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇦":{name:"flag South Africa",slug:"flag_south_africa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇲":{name:"flag Zambia",slug:"flag_zambia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇼":{name:"flag Zimbabwe",slug:"flag_zimbabwe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🏴󠁧󠁢󠁥󠁮󠁧󠁿":{name:"flag England",slug:"flag_england",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🏴󠁧󠁢󠁳󠁣󠁴󠁿":{name:"flag Scotland",slug:"flag_scotland",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🏴󠁧󠁢󠁷󠁬󠁳󠁿":{name:"flag Wales",slug:"flag_wales",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1}};function OB(n,e){const t=n.target;x(e,V(t.value))}var zB=(n,e)=>e("recent"),VB=ke("<button>Recent</button>"),WB=(n,e,t)=>e(t()),HB=ke("<button> </button>"),qB=ke('<div class="flex border-b border-base-content/20 overflow-x-auto"><!> <!></div>'),UB=(n,e,t)=>e(i(t).emoji),GB=ke('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),YB=(n,e,t)=>e(i(t)),KB=ke('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),XB=(n,e,t)=>e(i(t).emoji),ZB=ke('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),JB=ke('<div class="text-center text-base-content/60 py-8">No emojis found</div>'),QB=ke('<div class="emoji-picker fixed z-50 bg-base-100 border border-base-content/20 rounded-lg shadow-lg svelte-hsh18a"><div class="p-3 border-b border-base-content/20"><input type="text" placeholder="Search emojis..." class="input input-sm w-full bg-base-200"></div> <!> <div class="p-2 overflow-y-auto" style="height: calc(100% - 120px);"><div class="grid grid-cols-8 gap-1"><!></div> <!></div></div>');function eO(n,e){Ed(e,!0);const t=sm(),s=()=>wl(l,"$recentlyUsed",t),o=Fh();let r=hi(e,"show",15,!1),a=hi(e,"position",27,()=>V({x:0,y:0}));const l=Gw("emoji-recently-used",[]);let c=ge(""),f=ge("smileys");const d=(()=>{const I={smileys:{name:"Smileys & Emotion",emojis:[]},people:{name:"People & Body",emojis:[]},animals:{name:"Animals & Nature",emojis:[]},food:{name:"Food & Drink",emojis:[]},activities:{name:"Activities",emojis:[]},travel:{name:"Travel & Places",emojis:[]},objects:{name:"Objects",emojis:[]},symbols:{name:"Symbols",emojis:[]},flags:{name:"Flags",emojis:[]}};return Object.entries(BB).forEach(([A,M])=>{var L;if(!A||!M.name)return;const F={emoji:A,name:M.name,keywords:M.keywords||[]},B=((L=M.group)==null?void 0:L.toLowerCase())||"",$=M.name.toLowerCase();B.includes("smileys")||B.includes("emotion")||$.includes("face")||$.includes("smile")||$.includes("laugh")||$.includes("cry")?I.smileys.emojis.push(F):B.includes("people")||B.includes("body")||$.includes("hand")||$.includes("body")||$.includes("person")||$.includes("man")||$.includes("woman")?I.people.emojis.push(F):B.includes("animals")||B.includes("nature")||$.includes("animal")||$.includes("cat")||$.includes("dog")||$.includes("bird")||$.includes("plant")||$.includes("tree")?I.animals.emojis.push(F):B.includes("food")||B.includes("drink")||$.includes("food")||$.includes("fruit")||$.includes("drink")||$.includes("coffee")||$.includes("pizza")?I.food.emojis.push(F):B.includes("activities")||B.includes("sport")||$.includes("sport")||$.includes("ball")||$.includes("game")?I.activities.emojis.push(F):B.includes("travel")||B.includes("places")||$.includes("car")||$.includes("plane")||$.includes("train")||$.includes("building")?I.travel.emojis.push(F):B.includes("objects")||$.includes("phone")||$.includes("computer")||$.includes("book")||$.includes("tool")?I.objects.emojis.push(F):B.includes("flags")||$.includes("flag")?I.flags.emojis.push(F):I.symbols.emojis.push(F)}),I})(),h=Bt(()=>{var I;return i(c)?Object.values(d).flatMap(A=>A.emojis).filter(A=>A.emoji.includes(i(c))||A.name.toLowerCase().includes(i(c).toLowerCase())||A.keywords.some(M=>M.toLowerCase().includes(i(c).toLowerCase()))):((I=d[i(f)])==null?void 0:I.emojis)||[]});function m(I){l.update(A=>{const M=A.filter(F=>F!==I);return[I,...M].slice(0,20)}),o("select",{emoji:I}),r(!1)}function g(I){x(f,V(I)),x(c,"")}function w(I){I.target.closest(".emoji-picker")||r(!1)}Th(()=>{if(typeof document<"u")return document.addEventListener("click",w),()=>{document.removeEventListener("click",w)}});var C=Qn(),P=fn(C);Ue(P,r,I=>{var A=QB(),M=y(A),F=y(M);xn(F),F.__input=[OB,c],_(M);var B=v(M,2);Ue(B,()=>!i(c),ce=>{var Q=qB(),le=y(Q);Ue(le,()=>s().length>0,fe=>{var pe=VB();pe.__click=[zB,g],Ce(()=>pi(pe,`px-3 py-2 text-xs whitespace-nowrap border-b-2 transition-colors ${(i(f)==="recent"?"border-primary text-primary":"border-transparent hover:text-primary")??""}`)),q(fe,pe)});var ue=v(le,2);Yo(ue,17,()=>Object.entries(d),Ii,(fe,pe)=>{let Z=()=>i(pe)[0],xe=()=>i(pe)[1];var oe=HB();oe.__click=[WB,g,Z];var Pe=y(oe,!0);_(oe),Ce(()=>{pi(oe,`px-3 py-2 text-xs whitespace-nowrap border-b-2 transition-colors ${(i(f)===Z()?"border-primary text-primary":"border-transparent hover:text-primary")??""}`),tt(Pe,xe().name)}),q(fe,oe)}),_(Q),q(ce,Q)});var $=v(B,2),L=y($),O=y(L);Ue(O,()=>i(c),ce=>{var Q=Qn(),le=fn(Q);Yo(le,17,()=>i(h),Ii,(ue,fe)=>{var pe=GB();pe.__click=[UB,m,fe];var Z=y(pe,!0);_(pe),Ce(()=>{Ot(pe,"title",i(fe).name),tt(Z,i(fe).emoji)}),q(ue,pe)}),q(ce,Q)},ce=>{var Q=Qn(),le=fn(Q);Ue(le,()=>i(f)==="recent"&&s().length>0,ue=>{var fe=Qn(),pe=fn(fe);Yo(pe,1,s,Ii,(Z,xe)=>{var oe=KB();oe.__click=[YB,m,xe];var Pe=y(oe,!0);_(oe),Ce(()=>{Ot(oe,"title",i(xe)),tt(Pe,i(xe))}),q(Z,oe)}),q(ue,fe)},ue=>{var fe=Qn(),pe=fn(fe);Yo(pe,17,()=>i(h),Ii,(Z,xe)=>{var oe=ZB();oe.__click=[XB,m,xe];var Pe=y(oe,!0);_(oe),Ce(()=>{Ot(oe,"title",i(xe).name),tt(Pe,i(xe).emoji)}),q(Z,oe)}),q(ue,fe)},!0),q(ce,Q)}),_(L);var Y=v(L,2);Ue(Y,()=>i(c)&&i(h).length===0,ce=>{var Q=JB();q(ce,Q)}),_($),_(A),Ce(()=>{Ot(A,"style",`left: ${a().x??""}px; top: ${a().y??""}px; width: 320px; height: 400px;`),Gf(F,i(c))}),q(I,A)}),q(n,C),$d()}Ip(["input","click"]);function tO(n,e){e("reset")}function nO(n,e){e("confirm")}function sO(n,e){n.target.classList.contains("modal-backdrop")&&e()}var oO=n=>n.stopPropagation(),iO=ke(`<div><input type="checkbox" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 focus:ring-2
                       sm:w-4 sm:h-4 touch-manipulation"> <input type="number" step="0.001" min="0" max="10"> <button class="w-10 h-10 rounded border-2 border-gray-300 hover:border-gray-400 transition-colors
                       sm:w-8 sm:h-8 touch-manipulation" title="Change color"></button> <span> </span></div>`),rO=ke(`<div class="fixed inset-0 bg-transparent flex items-center justify-center z-[9999] modal-backdrop"><div><div><h3>Fibonacci Settings</h3> <button title="Close"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-4 max-h-[60vh] overflow-y-auto svelte-ah2kky"><div class="space-y-3"></div></div> <div><button>🔁 Reset</button> <div class="flex gap-3 w-full sm:w-auto sm:gap-2"><button>❌ Cancel</button> <button class="px-6 py-3 text-sm rounded bg-blue-600 hover:bg-blue-700 text-white transition-colors
                   touch-manipulation min-h-[44px] flex-1 sm:flex-none
                   sm:px-4 sm:py-2 sm:min-h-[36px]">✅ Confirm</button></div></div></div></div>`),aO=ke('<div class="fixed z-[10000]"><!></div>'),lO=ke("<!> <!>",1);function cO(n,e){Ed(e,!1);let t=hi(e,"visible",8,!1),s=hi(e,"levels",24,()=>[]),o=hi(e,"theme",8,"dark");const r=Fh();let a=id(!1),l=id(-1),c=id({x:0,y:0});function f(I,A,M){r("levelChange",{index:I,field:A,value:M})}function u(I,A){x(l,A),x(c,{x:I.clientX,y:I.clientY}),x(a,!0)}function d(I){i(l)>=0&&f(i(l),"color",I.detail)}function h(I){i(l)>=0&&f(i(l),"opacity",I.detail)}function m(){x(a,!1),x(l,-1)}function g(){r("cancel")}nm(()=>tm(t()),()=>{t()||(x(a,!1),x(l,-1))}),nm(()=>i(a),()=>{i(a)||x(l,-1)}),x0(),rv();var w=lO(),C=fn(w);Ue(C,t,I=>{var A=rO();A.__click=[sO,g];var M=y(A);M.__click=[oO];var F=y(M),B=y(F),$=v(B,2);$.__click=g;var L=y($);_($),_(F);var O=v(F,2),Y=y(O);Yo(Y,5,s,Ii,(pe,Z,xe)=>{var oe=iO(),Pe=y(oe);xn(Pe),Pe.__change=()=>f(xe,"visible",i(Z).visible);var $e=v(Pe,2);xn($e),$e.__change=()=>f(xe,"value",i(Z).value);var ze=v($e,2);ze.__click=nt=>u(nt,xe);var Ke=v(ze,2),qe=y(Ke,!0);Ce(()=>tt(qe,i(Z).value===0?"Start":i(Z).value===1?"End":`${(i(Z).value*100).toFixed(1)}%`)),_(Ke),_(oe),Ce(()=>{pi(oe,`flex items-center gap-3 p-3 rounded-lg ${(o()==="dark"?"bg-[#2a2a2a]":"bg-gray-50")??""}
                        sm:gap-4 sm:p-4`),pi($e,`w-24 px-3 py-2 text-sm rounded border touch-manipulation
                       sm:w-20 sm:px-2 sm:py-1
                       ${(o()==="dark"?"bg-[#3a3a3a] border-[#555] text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500")??""} 
                       focus:outline-none focus:ring-1 focus:ring-blue-500`),Ot(ze,"style",`background-color: ${i(Z).color??""}`),pi(Ke,`text-sm ${(o()==="dark"?"text-gray-300":"text-gray-700")??""} flex-1
                           sm:text-sm`)}),Uv(Pe,()=>i(Z).visible,nt=>(i(Z).visible=nt,N6(()=>s()))),Bs($e,()=>i(Z).value,nt=>(i(Z).value=nt,N6(()=>s()))),q(pe,oe)}),_(Y),_(O);var ce=v(O,2),Q=y(ce);Q.__click=[tO,r];var le=v(Q,2),ue=y(le);ue.__click=g;var fe=v(ue,2);fe.__click=[nO,r],_(le),_(ce),_(M),_(A),Ce(()=>{pi(M,`relative ${(o()==="dark"?"bg-[#1a1a1a] border-[#404040]":"bg-white border-gray-200")??""} 
             rounded-lg shadow-xl border max-w-md w-full mx-4 max-h-[80vh] overflow-hidden
             sm:max-w-lg md:max-w-xl lg:max-w-2xl svelte-ah2kky`),pi(F,`flex items-center justify-between p-4 border-b ${(o()==="dark"?"border-[#404040]":"border-gray-200")??""}`),pi(B,`text-lg font-semibold ${(o()==="dark"?"text-white":"text-gray-900")??""}`),pi($,`w-8 h-8 rounded-full ${(o()==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} 
                 flex items-center justify-center transition-colors`),v_(L,`w-5 h-5 ${(o()==="dark"?"text-gray-400":"text-gray-600")??""}`),pi(ce,`flex items-center justify-between p-4 border-t ${(o()==="dark"?"border-[#404040]":"border-gray-200")??""}
                  sm:flex-row flex-col gap-3 sm:gap-0`),pi(Q,`px-6 py-3 text-sm rounded ${(o()==="dark"?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700")??""} 
                 transition-colors touch-manipulation min-h-[44px] w-full sm:w-auto
                 sm:px-4 sm:py-2 sm:min-h-[36px]`),pi(ue,`px-6 py-3 text-sm rounded ${(o()==="dark"?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700")??""} 
                   transition-colors touch-manipulation min-h-[44px] flex-1 sm:flex-none
                   sm:px-4 sm:py-2 sm:min-h-[36px]`)}),q(I,A)});var P=v(C,2);Ue(P,()=>i(a),I=>{var A=aO(),M=y(A),F=ov(()=>{var $;return(($=s()[i(l)])==null?void 0:$.color)||"#FF6B6B"}),B=ov(()=>{var $;return(($=s()[i(l)])==null?void 0:$.opacity)??15});qv(M,{get show(){return i(a)},set show($){x(a,$)},get selectedColor(){return i(F)},get opacity(){return i(B)},$$events:{colorChange:d,opacityChange:h,close:m},$$legacy:!0}),_(A),Ce(()=>Ot(A,"style",`left: ${i(c).x??""}px; top: ${i(c).y??""}px;`)),q(I,A)}),q(n,w),$d()}Ip(["click","change"]);function uO(n,e,t,s){e("confirm",{extend:i(t),timeLabel:i(s)})}function c5(n,e,t,s){e("change",{extend:i(t),timeLabel:i(s)})}function dO(n,e){n.target.classList.contains("modal-backdrop")&&e()}var fO=n=>n.stopPropagation(),pO=ke('<label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 focus:ring-2"> <span>Extend</span></label>'),mO=ke('<div class="fixed inset-0 bg-transparent flex items-center justify-center z-[9999] modal-backdrop"><div><div><h3>Vertical Line</h3> <button title="Close"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-5 space-y-5"><!> <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 focus:ring-2"> <span>Time label</span></label></div> <div><button>Cancel</button> <button class="px-5 py-2 text-sm rounded bg-blue-600 hover:bg-blue-700 text-white transition-colors">Ok</button></div></div></div>');function hO(n,e){Ed(e,!1);let t=hi(e,"visible",8,!1),s=hi(e,"extendEnabled",8,!0),o=hi(e,"timeLabelEnabled",8,!0),r=hi(e,"theme",8,"dark"),a=hi(e,"showExtendToggle",8,!0);const l=Fh();let c=id(s()),f=id(o());function u(){l("cancel")}nm(()=>(tm(t()),tm(s()),tm(o())),()=>{t()&&(x(c,s()),x(f,o()))}),x0(),rv();var d=Qn(),h=fn(d);Ue(h,t,m=>{var g=mO();g.__click=[dO,u];var w=y(g);w.__click=[fO];var C=y(w),P=y(C),I=v(P,2);I.__click=u;var A=y(I);_(I),_(C);var M=v(C,2),F=y(M);Ue(F,a,Q=>{var le=pO(),ue=y(le);xn(ue),ue.__change=[c5,l,c,f];var fe=v(ue,2);_(le),Ce(()=>pi(fe,`text-sm ${(r()==="dark"?"text-gray-200":"text-gray-700")??""}`)),Uv(ue,()=>i(c),pe=>x(c,pe)),q(Q,le)});var B=v(F,2),$=y(B);xn($),$.__change=[c5,l,c,f];var L=v($,2);_(B),_(M);var O=v(M,2),Y=y(O);Y.__click=u;var ce=v(Y,2);ce.__click=[uO,l,c,f],_(O),_(w),_(g),Ce(()=>{pi(w,`relative ${(r()==="dark"?"bg-[#1a1a1a] border-[#404040]":"bg-white border-gray-200")??""}
             rounded-lg shadow-xl border w-full max-w-sm mx-4 overflow-hidden`),pi(C,`flex items-center justify-between p-4 border-b ${(r()==="dark"?"border-[#404040]":"border-gray-200")??""}`),pi(P,`text-lg font-semibold ${(r()==="dark"?"text-white":"text-gray-900")??""}`),pi(I,`w-8 h-8 rounded-full ${(r()==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""}
                 flex items-center justify-center transition-colors`),v_(A,`w-5 h-5 ${(r()==="dark"?"text-gray-400":"text-gray-600")??""}`),pi(L,`text-sm ${(r()==="dark"?"text-gray-200":"text-gray-700")??""}`),pi(O,`flex items-center justify-end gap-3 p-4 border-t ${(r()==="dark"?"border-[#404040]":"border-gray-200")??""}`),pi(Y,`px-5 py-2 text-sm rounded ${(r()==="dark"?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700")??""}
                 transition-colors`)}),Uv($,()=>i(f),Q=>x(f,Q)),q(m,g)}),q(n,d),$d()}Ip(["click","change"]);const c6=$m(!1);function iv(){c6.set(!0)}function _x(){c6.set(!1)}function yx(){return vm(c6)===!0}function vO(n,e,t,s,o,r){var d,h,m;if(!i(e)||!t())return;const l=!(((h=(d=i(e))==null?void 0:d.extendData)==null?void 0:h.manualLock)===!0),c=l?!0:!!i(o),f={...i(e).extendData||{},manualLock:l};(m=t())==null||m.overrideOverlay({id:i(e).id,lock:c,extendData:f});const u={...i(e),lock:c,extendData:f};x(e,V(u)),r(u)}function gO(n,e,t){i(e).fontWeight=i(e).fontWeight==="bold"?"normal":"bold",t()}function _O(n,e){e(n)}function yO(n,e,t,s,o,r,a){n.stopPropagation();const l=n.target.getBoundingClientRect();x(e,"line"),x(t,V(s.color)),x(o,V(s.opacity)),x(r,V({x:Math.max(10,Math.min(l.left,window.innerWidth-320)),y:Math.max(10,Math.min(l.bottom+5,window.innerHeight-400))})),x(a,!0)}function bO(n,e,t,s,o,r,a){x(e,"textColor"),x(t,V(i(s).textColor)),x(o,V(i(r))),x(a,!0)}function xO(n,e,t,s,o,r,a){x(e,"textBg"),x(t,V(i(s).backgroundColor)),x(o,V(i(r))),x(a,!0)}function wO(n,e,t,s,o,r,a,l){var u,d;const c=e(i(t));if(!c)return;const f=String((c==null?void 0:c.name)||(c==null?void 0:c.type)||"");x(s,V(o(f))),x(r,V({extend:i(s)?((u=c==null?void 0:c.extendData)==null?void 0:u.crossPaneEnabled)!==!1:!1,timeLabel:((d=c==null?void 0:c.extendData)==null?void 0:d.showTimeLabel)!==!1})),x(a,V({...i(r)})),x(l,!0)}function kO(n,e){n.preventDefault(),n.stopPropagation(),e()}var SO=ke('<div class="pro-active-indicator absolute bottom-[3px] left-1/2 transform -translate-x-1/2 w-[4px] h-[4px] rounded-full svelte-ue8k6c" style="background: var(--menu-accent);"></div>'),CO=(n,e,t)=>e(i(t)),IO=ke('<div class="submenu-portal svelte-ue8k6c"></div>'),PO=ke(`<div class="pro-submenu-arrow flex items-center justify-center absolute top-1/2 right-0 transform -translate-y-1/2
               w-5 h-5 opacity-0 group-hover:opacity-100 hover:opacity-100 transition-all duration-150 cubic-bezier(0.4, 0, 0.2, 1)
               bg-[var(--menu-btn-bg)] border border-[var(--menu-btn-border)] rounded-full
               hover:bg-[var(--menu-hover-bg)] hover:border-[var(--menu-btn-hover-border)] cursor-pointer z-20 svelte-ue8k6c" style="box-shadow: 0 1px 3px rgba(0,0,0,0.1);"><svg class="w-2.5 h-2.5 transition-all duration-150 cubic-bezier(0.4, 0, 0.2, 1) text-[var(--menu-text)] svelte-ue8k6c" viewBox="0 0 8 12" fill="currentColor"><path d="M1.705 0.295C1.315 -0.095 0.685 -0.095 0.295 0.295C-0.095 0.685 -0.095 1.315 0.295 1.705L5.59 7L0.295 12.295C-0.095 12.685 -0.095 13.315 0.295 13.705C0.685 14.095 1.315 14.095 1.705 13.705L7.705 7.705C8.095 7.315 8.095 6.685 7.705 6.295L1.705 0.295Z" class="svelte-ue8k6c"></path></svg></div> <!>`,1),MO=ke(`<div class="group flex flex-row items-center justify-center relative w-full mt-2 cursor-pointer transition-all duration-200 ease-out svelte-ue8k6c"><div class="pro-draw-button w-[36px] h-[36px] rounded-[8px] flex items-center justify-center relative overflow-hidden transition-all duration-200 cubic-bezier(0.4, 0, 0.2, 1)
             isolation-isolate svelte-ue8k6c" style="background: var(--menu-btn-bg); border: 1px solid var(--menu-btn-border); backdrop-filter: blur(16px) saturate(160%); -webkit-backdrop-filter: blur(16px) saturate(160%);"><div class="button-hover-overlay absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-[8px] svelte-ue8k6c" style="background: var(--menu-hover-bg);"></div> <!> <!></div> <!></div>`),NO=ke('<div class="w-full h-[2px] mt-3 mb-2 opacity-90 svelte-ue8k6c" style="background: linear-gradient(to right, transparent, var(--menu-accent), transparent); box-shadow: 0 0 10px var(--menu-glow);"></div>'),AO=n=>n.stopPropagation(),TO=ke("<!> <!>",1),FO=n=>n.preventDefault(),LO=ke('<button class="drawbar-scroll-arrow svelte-ue8k6c" title="Scroll to see more tools" aria-label="Scroll down" type="button"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-ue8k6c"><polyline points="6 9 12 15 18 9"></polyline></svg></button>'),EO=(n,e,t,s,o,r)=>i(e)==="mode"?t(i(s).key):o(r.findIndex(a=>a.key===i(e)),i(s).key),$O=ke(`<li class="px-4 py-3 flex flex-row items-center gap-3 transition-all duration-200 ease-in-out
                   text-[var(--menu-text)] hover:bg-[var(--menu-hover-bg)] hover:text-[var(--menu-glow)] cursor-pointer svelte-ue8k6c"><!> <span class="text-sm font-medium"> </span></li>`),DO=ke(`<ul class="premium-submenu fixed min-w-[140px] max-h-[70vh] z-[9999] rounded-lg shadow-2xl border border-[var(--menu-btn-border)] overflow-y-auto
                bg-[var(--menu-bg)] backdrop-blur-sm transition-all duration-300 ease-in-out svelte-ue8k6c"></ul>`),RO=(n,e,t)=>e(i(t).key),jO=ke(`<li class="px-4 py-3 flex flex-row items-center gap-3 transition-all duration-200 ease-in-out
                 text-[var(--menu-text)] hover:bg-[var(--menu-hover-bg)] hover:text-[var(--menu-glow)] cursor-pointer svelte-ue8k6c"><!> <span class="text-sm font-medium"> </span></li>`),BO=ke(`<ul class="premium-submenu fixed min-w-[140px] max-h-[70vh] z-[9999] rounded-lg shadow-2xl border border-[var(--menu-btn-border)] overflow-y-auto
              bg-[var(--menu-bg)] backdrop-blur-sm transition-all duration-300 ease-in-out svelte-ue8k6c"></ul>`),OO=ke("<!> <!>",1),zO=n=>n.stopPropagation(),VO=ke("<option> </option>"),WO=ke(`<select title="Font size"><option>8</option><option>10</option><option>11</option><option>12</option><option>14</option><option>16</option><option>18</option><option>20</option><option>22</option><option>24</option><option>32</option><option>40</option><option>52</option></select> <button title="Bold"><span class="text-xs font-bold">B</span></button> <div class="flex items-center gap-1 svelte-ue8k6c"><div class="flex items-center gap-1"><button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                       cursor-pointer hover:scale-105 transition-transform touch-manipulation flex items-center justify-center svelte-ue8k6c" title="Text color"><!></button> <button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                       cursor-pointer hover:scale-105 transition-transform touch-manipulation flex items-center justify-center svelte-ue8k6c" title="Background color"><!></button></div> <select title="Font family"></select></div>`,1),HO=ke(`<button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                 cursor-pointer hover:scale-105 transition-transform touch-manipulation svelte-ue8k6c" title="Choose color"></button> <select title="Line thickness"><option>1px</option><option>2px</option><option>3px</option><option>4px</option><option>5px</option><option>6px</option><option>7px</option><option>8px</option></select> <select title="Line style"><option>Line</option><option>Dash</option><option>Dot</option></select>`,1),qO=ke('<div title="Drag to move"><div class="flex flex-col gap-0.5"><div class="flex gap-0.5"><div></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div> <div class="flex gap-0.5"><div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div> <div class="flex gap-0.5"><div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div></div></div> <!>',1),UO=(n,e)=>{var t;return e(((t=n.target)==null?void 0:t.value)||"24")},GO=ke('<div class="flex items-center gap-3 svelte-ue8k6c"><div class="flex items-center justify-center w-8 h-8 text-lg"> </div> <div class="flex items-center gap-1 sm:gap-2 min-w-[100px] sm:min-w-[120px]"><span class="text-xs text-gray-500 dark:text-gray-400 hidden sm:inline">Size:</span> <input type="range" min="16" max="64" class="flex-1 h-2 sm:h-1 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer slider touch-manipulation svelte-ue8k6c"> <span class="text-xs text-gray-500 dark:text-gray-400 w-6 text-right"> </span></div></div>'),YO=(n,e)=>{e()},KO=ke('<button title="Fibonacci Settings"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button>'),XO=ke('<button title="Vertical Line Settings"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button>'),ZO=(n,e)=>x(e,!i(e)),JO=n=>n.stopPropagation(),QO=(n,e,t)=>{e(),x(t,!1)},ez=(n,e,t)=>{e(),x(t,!1)},tz=(n,e,t)=>{e(),x(t,!1)},nz=ke("<button>Paste</button>"),sz=ke("<div><button>Clone</button> <button>Copy</button> <!></div>"),oz=(n,e,t,s)=>{e(),x(t,!1),x(s,null)},iz=ke('<div><!> <!> <!> <button><!></button> <div class="relative svelte-ue8k6c"><button title="More" aria-haspopup="true"><svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="12" cy="19" r="2"></circle></svg></button> <!></div> <button title="Delete"><svg fill="none" stroke="currentColor" vector-effect="non-scaling-stroke" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),rz=ke('<div class="fixed z-[200001] bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer shadow-lg transition-all duration-200" title="Delete selected drawing"><svg class="w-4 h-4" fill="none" stroke="currentColor" vector-effect="non-scaling-stroke" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></div>'),az=ke('<div class="drawbar-wrapper svelte-ue8k6c"><div class="drawbar-container h-full box-border border-r border-l-0 transition-all duration-200 ease-in-out overflow-y-auto scrollbar-hidden svelte-ue8k6c" style="background: var(--menu-bg); box-shadow: var(--menu-shadow); border-left: none;"><!> <!> <!> <!> <!> <!> <!> <!></div> <!></div> <!> <!> <!> <!>  <!> <!> <!>',1);function lz(n,e){Ed(e,!0);const t=sm(),s=()=>wl(bn,"$chart",t),o=()=>wl(qn,"$save",t),r=()=>wl(df,"$undoRedoState",t),a=(_e,We=m_,xt=m_,Ht,qt,ht,dn)=>{let Ut=ov(()=>ob(Ht==null?void 0:Ht(),"")),Xn=ov(()=>ob(qt==null?void 0:qt(),()=>[],!0)),rs=ov(()=>ob(ht==null?void 0:ht(),!1)),_t=ov(()=>ob(dn==null?void 0:dn(),!1));var Gt=MO(),en=y(Gt);en.__click=function(...wa){var di;(di=We())==null||di.apply(this,wa)};var cs=v(y(en),2),ps=Bt(()=>Sl(xt())),vo=Bt(()=>i(Ut)==="mode"&&i(u)===i(f)||i(Ut)==="lock"&&i(d));Gv(cs,{get name(){return i(ps)},get active(){return i(vo)},size:24,class:"relative z-10 transition-all duration-200 group-hover:scale-[1.05]"});var Ko=v(cs,2);Ue(Ko,()=>i(Ut)==="mode"&&i(u)===i(f)||i(Ut)==="lock"&&i(d)||i(Ut)&&i(Ut)===i(c),wa=>{var di=SO();q(wa,di)}),_(en);var ho=v(en,2);Ue(ho,()=>i(Xn).length>0,wa=>{var di=PO(),Mi=fn(di);Mi.__click=[CO,Wr,Ut];var Kr=y(Mi);_(Mi);var hr=v(Mi,2);Ue(hr,()=>i(Ut)===i(c),sl=>{var fo=IO();q(sl,fo)}),Ce(()=>wr(Kr,"rotate-180",i(c)===i(Ut))),q(wa,di)}),_(Gt),Ce(()=>{Ot(Gt,"style",`margin-top: ${(i(rs)||i(_t)?"12px":"")??""}`),Ot(en,"title",i(Ut)||xt()),Ot(en,"aria-label",i(Ut)||xt()),wr(en,"active-btn",i(Ut)==="mode"&&i(u)===i(f)||i(Ut)==="lock"&&i(d)||i(Ut)&&i(Ut)===i(c))}),q(_e,Gt)},l=_e=>{var We=NO();q(_e,We)};let c=ge(""),f=ge("weakMagnet"),u=ge("normal"),d=ge(!1),h=ge(!0),m=V([]),g=ge(""),w=ge(null),C=ge(null),P=ge(!1),I=ge(!1),A=ge(null),M=V({thickness:"1",style:"solid",color:"#1677FF",opacity:100}),F=ge(!1),B=V({x:0,y:0}),$=ge(null),L=ge(0),O=ge(null),Y=ge(!1),ce=ge(!1);const Q="__SMARTCHART_OVERLAY__:",le=new Set(["verticalStraightLine","verticalRayLine"]),ue=new Set(["verticalStraightLine","verticalRayLine","verticalSegment"]),fe="x_axis_pane";let pe=!1,Z=null,xe=ge(null),oe=0,Pe=ge(!1),$e=ge("line"),ze=ge("#1677FF"),Ke=ge(100),qe=ge(!1),nt=ge(V({x:0,y:0})),ft=ge(V({x:0,y:0}));const ut="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif";let bt=ge(V({fontSize:"32",fontWeight:"bold",textColor:"#FFFFFF",backgroundColor:"#A00000",fontFamily:ut})),Pt=ge(100),Et=ge(20),Mt=ge(!1),Je=ge(void 0);function Ct(_e){const We=_e.replace("#",""),xt=parseInt(We.slice(0,2),16),Ht=parseInt(We.slice(2,4),16),qt=parseInt(We.slice(4,6),16);return{r:xt,g:Ht,b:qt}}function Ze(_e){if(!_e||typeof _e!="string"||!_e.startsWith("#"))return"#000000";const We=_e.length===9?_e.slice(0,7):_e,{r:xt,g:Ht,b:qt}=Ct(We);return .2126*xt+.7152*Ht+.0722*qt>128?"#000000":"#FFFFFF"}const Xe=[{label:"System",value:ut},{label:"Arial",value:"Arial, Helvetica, sans-serif"},{label:"Helvetica",value:"'Helvetica Neue', Arial, sans-serif"},{label:"Segoe UI",value:"'Segoe UI', Tahoma, Geneva, sans-serif"},{label:"Roboto",value:"Roboto, system-ui, -apple-system, 'Segoe UI', Arial, sans-serif"},{label:"Times New Roman",value:"'Times New Roman', Times, serif"},{label:"Georgia",value:"Georgia, 'Times New Roman', serif"},{label:"Garamond",value:"Garamond, 'Times New Roman', serif"},{label:"Palatino",value:"'Palatino Linotype', 'Book Antiqua', Palatino, serif"},{label:"Verdana",value:"Verdana, Geneva, sans-serif"},{label:"Tahoma",value:"Tahoma, Geneva, sans-serif"},{label:"Trebuchet MS",value:"'Trebuchet MS', 'Lucida Grande', sans-serif"},{label:"Impact",value:"Impact, Charcoal, sans-serif"},{label:"Lucida Sans",value:"'Lucida Sans Unicode', 'Lucida Grande', sans-serif"},{label:"Century Gothic",value:"'Century Gothic', AppleGothic, sans-serif"},{label:"Optima",value:"Optima, 'Segoe', 'Segoe UI', sans-serif"},{label:"Comic Sans MS",value:"'Comic Sans MS', 'Comic Sans', cursive, sans-serif"},{label:"Avenir",value:"'Avenir Next', Avenir, sans-serif"},{label:"Futura",value:"Futura, 'Trebuchet MS', Arial, sans-serif"},{label:"Menlo",value:"Menlo, Monaco, Consolas, 'Courier New', monospace"},{label:"Consolas",value:"Consolas, 'Liberation Mono', Menlo, Monaco, monospace"},{label:"Courier New",value:"'Courier New', Courier, monospace"}];let Ae=null;function Qe(){var xt;Ae||(Ae=document.querySelector(".chart-container")||document.querySelector("[data-chart-container]")||document.querySelector(".duty-chart")||document.querySelector("#chart")||((xt=document.querySelector("canvas"))==null?void 0:xt.parentElement)||document.body);const _e=Ae==null?void 0:Ae.getBoundingClientRect();if(!_e||_e.width<60||_e.height<60)return{left:0,top:0,width:window.innerWidth,height:window.innerHeight};const We=10;return{left:_e.left+We,top:_e.top+We,width:_e.width-We*2,height:_e.height-We*2}}function gt(){const _e=typeof window<"u"&&window.innerWidth<=768,We=_e?Math.min(300,window.innerWidth-40):300;return{isMobile:_e,width:We,height:_e?48:60}}function Ft(_e){if(!_e||typeof window>"u")return null;const{isMobile:We,width:xt,height:Ht}=gt(),qt=Qe(),ht=qt.left+(We?4:8),dn=qt.top+(We?4:8),Ut=qt.left+qt.width-xt-(We?4:8),Xn=qt.top+qt.height-Ht-(We?4:8),rs=Number(_e.x),_t=Number(_e.y);return!Number.isFinite(rs)||!Number.isFinite(_t)?null:{x:Math.max(ht,Math.min(rs,Ut)),y:Math.max(dn,Math.min(_t,Xn))}}function ot(_e){const We=Ie(_e);return Ft(i(xe))||We}function ve(_e){try{const We=Qe();Ae&&(Ae.style.cursor=_e??"default")}catch{}}function Ie(_e){var wu,_l,Xl,rc,Qc;if(!_e||!_e.points||_e.points.length===0||!s())return null;const We=_e.points[0],xt=_e.paneId||"candle_pane",Ht=(wu=s())==null?void 0:wu.convertToPixel(We,{paneId:xt}),qt=(Ae||document.body).getBoundingClientRect();if(!Ht||typeof Ht.x!="number"||typeof Ht.y!="number"||!qt)return null;const ht=Qe(),dn=window.innerWidth<=768,Ut=dn?Math.min(300,window.innerWidth-40):300,Xn=dn?48:60,rs=dn?32:24,_t=(_l=_e.extendData)!=null&&_l.editing?T0.getEditorRect():null,Gt=_t?_t.width:((Xl=_e.extendData)==null?void 0:Xl.boxWidth)??160,en=_t?_t.height:((rc=_e.extendData)==null?void 0:rc.boxHeight)??Math.round((((Qc=_e.extendData)==null?void 0:Qc.fontSize)??32)*1.4)+8,cs=Ht.x-Gt/2,ps=Ht.x+Gt/2,vo=Ht.y-Math.round(en/2),Ko=_t?_t.left:qt.left+cs,ho=_t?_t.right:qt.left+ps,wa=_t?_t.top:qt.top+vo,di=_t?_t.bottom:wa+en;let Mi=[{x:ho+rs,y:wa},{x:Ko,y:di+rs},{x:Ko-Ut-rs,y:wa},{x:Ko,y:wa-Xn-rs}];dn&&(Mi=[{x:Ko,y:di+rs},{x:Ko,y:wa-Xn-rs},{x:ho+rs,y:wa},{x:Ko-Ut-rs,y:wa}]);const Kr=qt.left+(dn?4:8),hr=qt.top+(dn?4:8),sl=qt.left+ht.width-Ut-(dn?4:8),fo=qt.top+ht.height-Xn-(dn?4:8);for(const na of Mi){let Nc=Math.max(Kr,Math.min(na.x,sl)),Ea=Math.max(hr,Math.min(na.y,fo));const Nd=Ea<di&&Ea+Xn>wa,In=Nc<ho&&Nc+Ut>Ko;if(!(Nd&&In))return{x:Nc,y:Ea}}if(dn){let na=Math.max(Kr,Math.min(Ko,sl)),Nc=Math.max(hr,Math.min(di+rs,fo));return{x:na,y:Nc}}else{let na=Math.max(Kr,Math.min(ho+rs,sl)),Nc=Math.max(hr,Math.min(wa,fo));return{x:na,y:Nc}}}function It(_e){function We(Ht){const qt=_e.scrollTop>0,ht=_e.scrollTop<_e.scrollHeight-_e.clientHeight;(Ht.deltaY<0&&!qt||Ht.deltaY>0&&!ht)&&Ht.preventDefault(),Ht.stopPropagation()}function xt(Ht){Ht.preventDefault(),Ht.stopPropagation()}return _e.addEventListener("wheel",We,{passive:!1,capture:!0}),_e.addEventListener("touchmove",xt,{passive:!1,capture:!0}),{destroy(){_e.removeEventListener("wheel",We,{capture:!0}),_e.removeEventListener("touchmove",xt,{capture:!0})}}}function Dt(){var _e,We;if(i(I)&&i(A)&&i($)&&!(i(A).name==="text"&&((_e=i(A).extendData)!=null&&_e.editing))&&i(A).points&&i(A).points.length>0){const xt=i(A).points[0],Ht=(We=s())==null?void 0:We.convertToPixel(xt,{paneId:"candle_pane"});if(Ht&&typeof Ht=="object"&&"x"in Ht&&"y"in Ht&&Ht.x!==void 0&&Ht.y!==void 0){const dn=Math.max(10,Math.min(Ht.x-80,window.innerWidth-300)),Ut=Math.max(10,Math.min(Ht.y-30,window.innerHeight-200));x($,V({x:dn,y:Ut}))}}i(Pe)&&x(ft,V({x:Math.max(10,Math.min(i(ft).x,window.innerWidth-320)),y:Math.max(10,Math.min(i(ft).y,window.innerHeight-400))}))}function Zt(){if(typeof localStorage<"u"){const _e=localStorage.getItem("contextMenuPosition");if(_e)try{x(xe,V(JSON.parse(_e)))}catch(We){console.log("Error loading saved position:",We)}}}function gn(_e){typeof localStorage<"u"&&(localStorage.setItem("contextMenuPosition",JSON.stringify(_e)),x(xe,V(_e)))}const hn="drawing_tools",qn=gd("save"),On=gd("ctx"),bn=gd("chart"),Fn=$m({}),Xs=Fn.subscribe(()=>{s()&&(Z&&clearTimeout(Z),Z=setTimeout(()=>{mo()},0))}),oo=gd("drawingManager"),Yn=15,_o="smartchart.drawingDefaults",xs="smartchart.fibonacciLevels",Rt={thickness:"1",style:"solid",color:"#1677FF",opacity:100},un={rect:{opacity:10},triangle:{opacity:10},parallelogram:{opacity:10},gannBox:{opacity:10},xabcd:{opacity:10},ruler:{opacity:15}},qs={fontSize:"32",fontWeight:"bold",textColor:"#FFFFFF",textOpacity:100,backgroundColor:"#A00000",backgroundOpacity:20,fontFamily:ut},ri=[{value:0,visible:!0,color:"#FF6B6B",opacity:Yn},{value:.236,visible:!0,color:"#4ECDC4",opacity:Yn},{value:.382,visible:!0,color:"#45B7D1",opacity:Yn},{value:.5,visible:!0,color:"#96CEB4",opacity:Yn},{value:.618,visible:!0,color:"#FFEAA7",opacity:Yn},{value:1,visible:!0,color:"#98D8C8",opacity:Yn},{value:1.618,visible:!0,color:"#85C1E9",opacity:Yn},{value:.786,visible:!1,color:"#DDA0DD",opacity:Yn},{value:1.272,visible:!1,color:"#F7DC6F",opacity:Yn},{value:1.414,visible:!1,color:"#BB8FCE",opacity:Yn},{value:2,visible:!1,color:"#FFB6C1",opacity:Yn},{value:2.272,visible:!1,color:"#98FB98",opacity:Yn},{value:2.414,visible:!1,color:"#F0E68C",opacity:Yn},{value:2.618,visible:!1,color:"#F8C471",opacity:Yn},{value:3,visible:!1,color:"#DEB887",opacity:Yn},{value:3.618,visible:!1,color:"#CD853F",opacity:Yn},{value:4,visible:!1,color:"#D2691E",opacity:Yn},{value:4.236,visible:!1,color:"#A0522D",opacity:Yn},{value:4.272,visible:!1,color:"#8B4513",opacity:Yn},{value:4.618,visible:!1,color:"#654321",opacity:Yn}];function Eo(_e){return _e.map(We=>({...We}))}function Ia(_e){if(!Array.isArray(_e))return Eo(ri);const We=_e.map((xt,Ht)=>{const qt=ri[Ht]||ri[ri.length-1],ht=typeof(xt==null?void 0:xt.value)=="number"?xt.value:qt.value,dn=typeof(xt==null?void 0:xt.visible)=="boolean"?xt.visible:qt.visible,Ut=typeof(xt==null?void 0:xt.color)=="string"?xt.color:qt.color,Xn=typeof(xt==null?void 0:xt.opacity)=="number"?xt.opacity:qt.opacity,rs=Math.max(0,Math.min(100,Xn??Yn));return{value:ht,visible:dn,color:Ut,opacity:rs}});return We.length?We:Eo(ri)}function Lr(){if(typeof localStorage>"u")return _o;const _e=zg();return _e?`${_o}.${_e}`:_o}function Qa(){if(typeof localStorage>"u")return null;try{const _e=localStorage.getItem(Lr());if(_e)return JSON.parse(_e);const We=localStorage.getItem(Fi());if(We){const Ht={fibonacciLevels:JSON.parse(We)};return yr(Ht),Ht}return null}catch{return null}}function yr(_e){if(!(typeof localStorage>"u"))try{localStorage.setItem(Lr(),JSON.stringify(_e))}catch{}}function Fi(){if(typeof localStorage>"u")return xs;const _e=zg();return _e?`${xs}.${_e}`:xs}function Rc(_e){const We=(_e||"").trim();if(!We)return null;if(/^#([0-9a-f]{8})$/i.test(We))return{r:parseInt(We.slice(1,3),16),g:parseInt(We.slice(3,5),16),b:parseInt(We.slice(5,7),16),a:parseInt(We.slice(7,9),16)/255};if(/^#([0-9a-f]{6})$/i.test(We))return{r:parseInt(We.slice(1,3),16),g:parseInt(We.slice(3,5),16),b:parseInt(We.slice(5,7),16)};if(/^#([0-9a-f]{3})$/i.test(We)){const Ht=We[1],qt=We[2],ht=We[3];return{r:parseInt(Ht+Ht,16),g:parseInt(qt+qt,16),b:parseInt(ht+ht,16)}}const xt=We.match(/^rgba?\(([^)]+)\)$/i);if(xt){const Ht=xt[1].split(",").map(qt=>parseFloat(qt.trim()));if(Ht.length>=3&&Ht.every(qt=>!Number.isNaN(qt)))return{r:Math.round(Ht[0]),g:Math.round(Ht[1]),b:Math.round(Ht[2]),a:Ht.length>=4?Math.max(0,Math.min(1,Ht[3])):void 0}}return null}function Cu(_e){const We=xt=>Math.max(0,Math.min(255,Math.round(xt))).toString(16).padStart(2,"0");return`#${We(_e.r)}${We(_e.g)}${We(_e.b)}`}function uc(_e,We){const xt=Rc(_e);return xt?Cu(xt):We}function Fl(_e,We,xt){const Ht=Rc(_e)||Rc(xt);if(!Ht)return xt;const qt=Math.max(0,Math.min(100,We))/100;return`rgba(${Ht.r}, ${Ht.g}, ${Ht.b}, ${qt})`}function jc(_e){const We=(_e==null?void 0:_e.style)==="dashed"||(_e==null?void 0:_e.style)==="dotted"?_e.style:"solid",xt=typeof(_e==null?void 0:_e.opacity)=="number"?Math.max(0,Math.min(100,_e.opacity)):Rt.opacity,Ht=(_e==null?void 0:_e.thickness)??Rt.thickness,qt=String(Ht),ht=uc((_e==null?void 0:_e.color)||Rt.color,Rt.color);return{thickness:qt,style:We,color:ht,opacity:xt}}function nd(_e){return _e.thickness===Rt.thickness&&_e.style===Rt.style&&_e.opacity===Rt.opacity&&_e.color.toLowerCase()===Rt.color.toLowerCase()}function Fa(_e){return{fontSize:String((_e==null?void 0:_e.fontSize)??qs.fontSize),fontWeight:(_e==null?void 0:_e.fontWeight)==="normal"?"normal":qs.fontWeight,textColor:uc((_e==null?void 0:_e.textColor)||qs.textColor,qs.textColor),textOpacity:typeof(_e==null?void 0:_e.textOpacity)=="number"?Math.max(0,Math.min(100,_e.textOpacity)):qs.textOpacity,backgroundColor:uc((_e==null?void 0:_e.backgroundColor)||qs.backgroundColor,qs.backgroundColor),backgroundOpacity:typeof(_e==null?void 0:_e.backgroundOpacity)=="number"?Math.max(0,Math.min(100,_e.backgroundOpacity)):qs.backgroundOpacity,fontFamily:String((_e==null?void 0:_e.fontFamily)||qs.fontFamily)}}function dc(_e){x(bt,V({fontSize:_e.fontSize,fontWeight:_e.fontWeight,textColor:_e.textColor,backgroundColor:_e.backgroundColor,fontFamily:_e.fontFamily})),x(Pt,V(_e.textOpacity)),x(Et,V(_e.backgroundOpacity))}function Bc(_e){var We;return((We=_e==null?void 0:_e.extendData)==null?void 0:We.origin)==="user"||(_e==null?void 0:_e.groupId)===hn}function rd(){return An.get(o().options,"drawingDefaults")||{}}function uf(_e,We){return{lineByTool:{...We.lineByTool||{},..._e.lineByTool||{}},text:_e.text||We.text,fibonacciLevels:_e.fibonacciLevels||We.fibonacciLevels}}function So(){const _e=rd(),We=Qa()||{};return uf(_e,We)}function Ll(_e,We){const xt=jc(We);qn.update(ht=>{ht.options||(ht.options={}),ht.options.drawingDefaults||(ht.options.drawingDefaults={});const dn=ht.options.drawingDefaults;return dn.lineByTool||(dn.lineByTool={}),dn.lineByTool[_e]=xt,ht});const Ht=Qa()||{},qt={...Ht,lineByTool:{...Ht.lineByTool||{},[_e]:xt}};yr(qt),iv()}function ya(_e){var qt;const xt=(qt=So().lineByTool)==null?void 0:qt[_e],Ht=un[_e];if(xt){const ht=jc(xt);return Ht&&nd(ht)?jc({...Rt,...Ht}):ht}return jc(Ht?{...Rt,...Ht}:Rt)}function hc(_e){const We=Fa(_e);qn.update(qt=>(qt.options||(qt.options={}),qt.options.drawingDefaults||(qt.options.drawingDefaults={}),qt.options.drawingDefaults.text=We,qt));const Ht={...Qa()||{},text:We};yr(Ht),iv()}function Pa(){const _e=So();return Fa(_e.text)}function Yr(_e){if(!_e)return{color:Rt.color,opacity:Rt.opacity};const We=_e.trim();if(/^#([0-9a-f]{8})$/i.test(We)){const Ht=`#${We.slice(1,7)}`,qt=parseInt(We.slice(7,9),16),ht=Math.round(qt/255*100);return{color:Ht,opacity:ht}}const xt=Rc(We);if(xt){const Ht=typeof xt.a=="number"?Math.round(xt.a*100):100;return{color:Cu(xt),opacity:Ht}}return{color:Rt.color,opacity:Rt.opacity}}function el(_e){var Ht;const We=(Ht=_e==null?void 0:_e.styles)==null?void 0:Ht.line;if(!We)return;const xt=Yr(We.color||Rt.color);if(M.thickness=String(We.size||Rt.thickness),M.color=xt.color,M.opacity=xt.opacity,We.style===wt.Dashed){const qt=We.dashedValue;qt&&qt[0]===2&&(qt[1]===6||qt[1]===8)?M.style="dotted":M.style="dashed"}else M.style="solid"}function Yl(){const _e=An.get(o().options,"drawingDefaults.fibonacciLevels");if(_e)return Ia(_e);const We=Qa();return We!=null&&We.fibonacciLevels?Ia(We.fibonacciLevels):Eo(ri)}function Vu(_e){qn.update(Ht=>(Ht.options||(Ht.options={}),Ht.options.drawingDefaults||(Ht.options.drawingDefaults={}),Ht.options.drawingDefaults.fibonacciLevels=Eo(_e),Ht));const xt={...Qa()||{},fibonacciLevels:Eo(_e)};yr(xt),iv()}let Iu=ge(!1),Ro=ge(V(Yl())),zr=ge(V(Eo(i(Ro)))),kl=ge(!1),Md=ge(V({extend:!0,timeLabel:!0})),nf=ge(V({extend:!0,timeLabel:!0})),zf=ge(!0);const df=Fp.getState();let Pu=ge(!1),Dd=ge(!1);Fr(()=>{const _e=r();x(Pu,_e.undoStack.length>0),x(Dd,_e.redoStack.length>0)}),Fr(()=>{s()&&Fp.init({chart:s(),saveStore:qn,overlaysStore:Fn})});let yf=!1;Fr(()=>{s()&&!yf&&(yf=!0,setTimeout(()=>{Ic()},0))});function $n(_e){const We=o().symbol;return`${We.shortName??We.name??We.ticker}_${o().period.timeframe}_${_e}`}function ws(_e){return _e?le.has(String(_e)):!1}function Us(_e){return _e?ue.has(String(_e)):!1}function Dn(_e){var xt;const We=(xt=_e==null?void 0:_e.extendData)==null?void 0:xt.crossPaneGroup;return typeof We=="string"&&We.length>0?We:null}function ni(){if(!s()||typeof s().getDrawPanes!="function")return[];try{return s().getDrawPanes().map(_e=>{var We;return(We=_e==null?void 0:_e.getId)==null?void 0:We.call(_e)}).filter(_e=>_e&&_e!==fe)}catch{return[]}}function mo(){var _e,We;if(!(!s()||pe)){pe=!0;try{const xt=((We=(_e=s()).getOverlays)==null?void 0:We.call(_e,{groupId:hn}))||[],Ht=ni(),qt=new Map;xt.forEach(ht=>{var Xn;const dn=String((ht==null?void 0:ht.name)||(ht==null?void 0:ht.type)||"");if(!ws(dn))return;let Ut=Dn(ht);if(!Ut&&(Ut=ht==null?void 0:ht.id,Ut)){const rs={...(ht==null?void 0:ht.extendData)||{},crossPaneGroup:Ut,crossPaneRole:"primary"};try{s().overrideOverlay({id:ht.id,extendData:rs})}catch{}ht.extendData=rs}Ut&&(qt.has(Ut)||qt.set(Ut,[]),(Xn=qt.get(Ut))==null||Xn.push(ht))}),qt.forEach((ht,dn)=>{var rs;const Ut=ht.find(_t=>{var Gt;return((Gt=_t==null?void 0:_t.extendData)==null?void 0:Gt.crossPaneRole)!=="mirror"})??ht[0];if(!Ut||!Array.isArray(Ut.points)||Ut.points.length===0)return;if(((rs=Ut==null?void 0:Ut.extendData)==null?void 0:rs.crossPaneEnabled)===!1){Oi(dn,Ut.id);return}const Xn=new Set(ht.map(_t=>_t==null?void 0:_t.paneId));Ht.forEach(_t=>{if(!_t||Xn.has(_t))return;const Gt={...(Ut==null?void 0:Ut.extendData)||{},crossPaneGroup:dn,crossPaneRole:"mirror",mirrorOf:Ut.id,selected:!1,editing:!1},en=Wl(String(Ut.name));try{s().createOverlay({name:String(Ut.name),paneId:_t,groupId:Ut.groupId??hn,points:Ut.points.map(cs=>({...cs})),styles:Ut.styles,visible:Ut.visible,lock:Ut.lock,mode:Ut.mode,extendData:Gt,...en})}catch{}})})}finally{pe=!1}}}function sr(_e){if(!s())return;const We=String((_e==null?void 0:_e.name)||(_e==null?void 0:_e.type)||"");if(!(!ws(We)||!Dn(_e)))try{s().overrideOverlay({id:_e.id,points:_e.points})}catch{}}function or(_e){if(!_e||typeof _e!="object")return;const We=_e.extendData;!We||typeof We!="object"||(delete We.crossPaneGroup,delete We.crossPaneRole,delete We.mirrorOf)}function hl(_e){var xt,Ht,qt;if(!s())return _e;const We=Dn(_e);if(!We||((xt=_e==null?void 0:_e.extendData)==null?void 0:xt.crossPaneRole)!=="mirror")return _e;try{return(((qt=(Ht=s()).getOverlays)==null?void 0:qt.call(Ht,{groupId:hn}))||[]).find(Ut=>{var Xn,rs;return((Xn=Ut==null?void 0:Ut.extendData)==null?void 0:Xn.crossPaneGroup)===We&&((rs=Ut==null?void 0:Ut.extendData)==null?void 0:rs.crossPaneRole)!=="mirror"})||_e}catch{return _e}}function Oi(_e,We){var xt,Ht;if(s())try{(((Ht=(xt=s()).getOverlays)==null?void 0:Ht.call(xt))||[]).forEach(ht=>{var Ut,Xn;if(!(ht!=null&&ht.id)||ht.id===We)return;const dn=(Ut=ht==null?void 0:ht.extendData)==null?void 0:Ut.mirrorOf;(((Xn=ht==null?void 0:ht.extendData)==null?void 0:Xn.crossPaneGroup)===_e||typeof dn=="string"&&dn===We)&&s().removeOverlay({id:ht.id})})}catch{}}function si(_e,We){var xt,Ht;if(s())try{(((Ht=(xt=s()).getOverlays)==null?void 0:Ht.call(xt))||[]).forEach(ht=>{var dn;!(ht!=null&&ht.id)||ht.id===We||(ht==null?void 0:ht.name)===_e&&((dn=ht==null?void 0:ht.extendData)==null?void 0:dn.crossPaneRole)==="mirror"&&s().removeOverlay({id:ht.id})})}catch{}}let Wo={};const ba=V([{key:"single-line",icon:"segment",list:[{key:"segment",text:"segment"},{key:"arrow",text:"arrow"},{key:"rayLine",text:"ray_line"},{key:"straightLine",text:"straight_line"},{key:"priceLine",text:"price_line"},{key:"horizontalStraightLine",text:"horizontal_straight_line"},{key:"horizontalRayLine",text:"horizontal_ray_line"},{key:"horizontalSegment",text:"horizontal_segment"},{key:"verticalStraightLine",text:"vertical_straight_line"},{key:"verticalRayLine",text:"vertical_ray_line"},{key:"verticalSegment",text:"vertical_segment"}]},{key:"more-line",icon:"priceChannelLine",list:[{key:"priceChannelLine",text:"price_channel_line"},{key:"parallelStraightLine",text:"parallel_straight_line"}]},{key:"polygon",icon:"rect",list:[{key:"circle",text:"circle"},{key:"rect",text:"rect"},{key:"parallelogram",text:"parallelogram"},{key:"triangle",text:"triangle"}]},{key:"fibonacci",icon:"fibonacciSegment",list:[{key:"fibonacciSegment",text:"fibonacci_segment"},{key:"fibonacciCircle",text:"fibonacci_circle"},{key:"fibonacciSpiral",text:"fibonacci_spiral"},{key:"fibonacciSpeedResistanceFan",text:"fibonacci_speed_resistance_fan"},{key:"fibonacciExtension",text:"fibonacci_extension"},{key:"gannBox",text:"gann_box"}]},{key:"wave",icon:"xabcd",list:[{key:"xabcd",text:"xabcd"},{key:"abcd",text:"abcd"},{key:"threeWaves",text:"three_waves"},{key:"fiveWaves",text:"five_waves"},{key:"eightWaves",text:"eight_waves"},{key:"anyWaves",text:"any_waves"}]},{key:"emoji",icon:"emoji",list:[]},{key:"text",icon:"text",list:[]}]),qi=V([{key:"weakMagnet",text:"weakMagnet"},{key:"strongMagnet",text:"strongMagnet"}]);function Wr(_e){i(c)==_e?x(c,""):x(c,V(_e))}function Kl(_e){if(!s()||!(_e!=null&&_e.id))return _e;try{const We=s().getOverlays({id:_e.id});if(We&&We[0])return We[0]}catch{}return _e}function Wl(_e,We={}){const xt=_e?R1[_e]??{}:{};let Ht=!1;const qt={onMouseEnter:ht=>{var dn;xt.onMouseEnter&&xt.onMouseEnter(ht);try{window.__overlayHover=!0,window.__overlayHoverId=((dn=ht.overlay)==null?void 0:dn.id)??null}catch{}return ve("pointer"),!0},onMouseLeave:ht=>{xt.onMouseLeave&&xt.onMouseLeave(ht);try{window.__overlayHover=!1,window.__overlayHoverId=null}catch{}return ve(null),!0},onRightClick:ht=>{var dn;xt.onRightClick&&xt.onRightClick(ht);try{const Ut=((dn=ht.overlay)==null?void 0:dn.id)??null;window.__overlayHover=!0,window.__overlayHoverId=Ut,window.__overlayRightClickId=Ut,window.__overlayRightClickAt=Date.now()}catch{}return!0},onDoubleClick:ht=>(xt.onDoubleClick&&xt.onDoubleClick(ht),!0),onPressedMoving:ht=>{var dn;xt.onPressedMoving&&xt.onPressedMoving(ht),Ht=!0;try{if(s()&&((dn=ht.overlay)!=null&&dn.id)&&!Wo[ht.overlay.id]){const Ut=s().getOverlays({id:ht.overlay.id});Ut&&Ut[0]&&(Wo[ht.overlay.id]=JSON.parse(JSON.stringify(Ut[0])))}}catch{}return sr(ht.overlay),!1},onPressedMoveEnd:ht=>{var dn;if(!Ht)return!0;Ht=!1,Au(ht.overlay),sr(ht.overlay);try{const Ut=Wo[ht.overlay.id],Xn=ht.overlay;if(Ut&&Xn){const rs=$n(ht.overlay.id);Fp.recordModifyOverlay(ht.overlay.id,Ut,Xn,rs)}}catch{}if(delete Wo[ht.overlay.id],i(g)===ht.overlay.id&&ht.overlay.points&&ht.overlay.points.length>0){const Ut=ht.overlay.points[0],Xn=ht.overlay.paneId||"candle_pane",rs=(dn=s())==null?void 0:dn.convertToPixel(Ut,{paneId:Xn});rs&&typeof rs=="object"&&"x"in rs&&"y"in rs&&rs.x!==void 0&&rs.y!==void 0&&x(C,V({x:rs.x-80,y:rs.y-30}))}return!0},onSelected:ht=>{xt.onSelected&&xt.onSelected(ht),oe=Date.now();const dn=Kl(ht.overlay);if(x(g,V(dn.id)),x(A,V(dn)),el(dn),(dn==null?void 0:dn.name)==="text"&&mu(dn),dn.points&&dn.points.length>0){const Ut=ot(dn);Ut&&(x($,V({...Ut})),x(C,V({x:Ut.x,y:Ut.y})),x(I,!0),x(P,!1),el(dn))}return!0},onDeselected:ht=>{var dn,Ut;xt.onDeselected&&xt.onDeselected(ht);try{s()&&((dn=ht.overlay)!=null&&dn.id)&&s().overrideOverlay({id:ht.overlay.id,selected:!1,extendData:{...(Ut=ht.overlay)==null?void 0:Ut.extendData,selected:!1,editing:!1}})}catch{}return x(g,""),x(P,!1),x(I,!1),x(ce,!1),x(C,null),x(A,null),!0},onRemoved:ht=>{xt.onRemoved&&xt.onRemoved(ht),Fn.update(Ut=>(delete Ut[$n(ht.overlay.id)],Ut));const dn=oo.get();if(dn)try{dn.removeDrawing(ht.overlay.id),console.log("🗑️ Removed drawing from DrawingManager:",ht.overlay.id),iv()}catch(Ut){console.error("Error removing drawing from DrawingManager:",Ut)}return!0}};return We.includeDrawEnd&&(qt.onDrawEnd=ht=>{var Ut,Xn,rs,_t;if(xt.onDrawEnd&&xt.onDrawEnd(ht),Au(ht.overlay),ws((Ut=ht.overlay)==null?void 0:Ut.name)&&!Dn(ht.overlay)){const Gt={...((Xn=ht.overlay)==null?void 0:Xn.extendData)||{},crossPaneGroup:ht.overlay.id,crossPaneRole:"primary"};try{(_t=(rs=s())==null?void 0:rs.overrideOverlay)==null||_t.call(rs,{id:ht.overlay.id,extendData:Gt})}catch{}ht.overlay.extendData=Gt}mo();const dn=$n(ht.overlay.id);if(Fp.recordAddOverlay(ht.overlay.id,ht.overlay,dn),i(w)===ht.overlay.id&&x(w,null),ht.overlay.name==="text")try{x(A,V(ht.overlay)),x(g,V(ht.overlay.id));const Gt=ot(ht.overlay);Gt&&(x($,V({...Gt})),x(C,V({x:Gt.x,y:Gt.y})),x(I,!0),x(P,!1)),s()&&T0.startEditing(s(),ht.overlay)}catch{}return!0}),qt}function Ic(){var _e,We;if(s())try{(((We=(_e=s()).getOverlays)==null?void 0:We.call(_e))||[]).forEach(Ht=>{const qt=(Ht==null?void 0:Ht.name)||(Ht==null?void 0:Ht.type),ht=(Ht==null?void 0:Ht.groupId)===hn||qt&&R1[String(qt)];if(!(Ht!=null&&Ht.id)||!qt||!ht)return;const dn=Wl(String(qt),{includeDrawEnd:!0});try{s().overrideOverlay({id:Ht.id,groupId:hn,...dn})}catch{}})}catch{}}function Pc(){var _e,We,xt,Ht,qt,ht;if(!s())return null;try{const dn=(We=(_e=s()).getChartStore)==null?void 0:We.call(_e),Ut=(Ht=(xt=dn==null?void 0:dn.getClickOverlayInfo)==null?void 0:xt.call(dn))==null?void 0:Ht.overlay;return Ut&&((Ut==null?void 0:Ut.groupId)===hn||Ut!=null&&Ut.name&&R1[String(Ut.name)])?Ut:(((ht=(qt=s()).getOverlays)==null?void 0:ht.call(qt))||[]).find(_t=>{var Gt,en;return((_t==null?void 0:_t.groupId)===hn||(_t==null?void 0:_t.name)&&R1[String(_t.name)])&&((_t==null?void 0:_t.selected)===!0||((Gt=_t==null?void 0:_t.extendData)==null?void 0:Gt.selected)===!0||((en=_t==null?void 0:_t.extendData)==null?void 0:en.editing)===!0)})||null}catch{}return null}function cl(_e){var Ht;const We={groupId:hn,...Wl(_e==null?void 0:_e.name,{includeDrawEnd:!0})},xt=(Ht=s())==null?void 0:Ht.createOverlay(An.mergeWith({},We,_e,(qt,ht,dn)=>{if(dn.startsWith("on")&&qt&&ht)return Ut=>(ht(Ut),qt(Ut))}));return xt&&(Array.isArray(xt)?(m.push(...xt),xt.length>0&&x(w,V(xt[0]))):(m.push(xt),x(w,V(xt)))),xt}function mr(_e){_e==="text"&&ve("text"),i(d)&&(x(d,!1),ul(!1,{preserveManualLock:!0}));const We=ya(_e);let xt=wt.Solid,Ht=[8,4];We.style==="dashed"?(xt=wt.Dashed,Ht=[8,4]):We.style==="dotted"&&(xt=wt.Dashed,Ht=[2,6]);const qt=Number(We.thickness)||1,ht=Fl(We.color,We.opacity,Rt.color),dn={line:{size:qt,color:ht,style:xt,dashedValue:Ht},text:{color:"#FFFFFF",backgroundColor:"#A0000020",borderColor:"#1677FF"},polygon:{color:ht}},Ut={origin:"user"};if(Us(_e)&&(Ut.showTimeLabel=!0),ws(_e)&&(Ut.crossPaneEnabled=!0),_e==="text"){const Xn=Pa(),rs=Fl(Xn.textColor,Xn.textOpacity,qs.textColor),_t=Fl(Xn.backgroundColor,Xn.backgroundOpacity,qs.backgroundColor);Ut.text=El,Ut.fontSize=Number(Xn.fontSize)||32,Ut.fontWeight=Xn.fontWeight,Ut.textColor=Xn.textColor,Ut.backgroundColor=_t,Ut.fontFamily=Xn.fontFamily,Ut.textOpacity=Xn.textOpacity,Ut.textBgOpacity=Xn.backgroundOpacity,dn.text={...dn.text,size:Number(Xn.fontSize)||32,weight:Xn.fontWeight,family:Xn.fontFamily,color:rs,backgroundColor:_t}}_e==="fibonacciSegment"&&(Ut.fibonacciLevels=Eo(Yl())),cl({name:_e,visible:i(h),lock:i(d),mode:i(u),styles:dn,extendData:Ut})}function La(_e,We){ba[_e].icon=We,mr(We),x(c,"")}function Sl(_e){return _e==="priceChannelLine"?"priceChannelLineNew":_e}function Ba(){var We;let _e=i(f);i(u)!=="normal"&&(_e="normal"),x(u,V(_e)),(We=s())==null||We.overrideOverlay({mode:_e})}function vi(_e){var We;x(f,V(_e)),x(u,V(_e)),x(c,""),(We=s())==null||We.overrideOverlay({mode:_e})}function vc(_e){let xt=0;return _e==="crosshair"?xt=0:ba.find(Ht=>Ht.key===_e)?xt=1+ba.findIndex(Ht=>Ht.key===_e):_e==="ruler"?xt=1+ba.length+1:_e==="mode"?xt=1+ba.length+2:_e==="lock"?xt=1+ba.length+3:_e==="visible"?xt=1+ba.length+4:_e==="remove"&&(xt=1+ba.length+5),xt*52}function ul(_e,We={}){var xt,Ht;if(s())try{(((Ht=(xt=s()).getOverlays)==null?void 0:Ht.call(xt))||[]).forEach(ht=>{var Xn,rs;const dn=(ht==null?void 0:ht.name)||(ht==null?void 0:ht.type),Ut=(ht==null?void 0:ht.groupId)===hn||dn&&R1[String(dn)];!(ht!=null&&ht.id)||!Ut||!_e&&We.preserveManualLock&&((Xn=ht==null?void 0:ht.extendData)==null?void 0:Xn.manualLock)===!0||(rs=s())==null||rs.overrideOverlay({id:ht.id,lock:_e})})}catch(qt){console.warn("setOverlayLock failed:",qt)}}function Ga(){x(d,!i(d)),i(d)?ul(!0):ul(!1,{preserveManualLock:!0})}function vl(_e){var We,xt;if(!s()||!_e)return null;try{const Ht=(We=s().getOverlays({id:_e}))==null?void 0:We[0];return Ht?{lock:!!Ht.lock,manualLock:((xt=Ht==null?void 0:Ht.extendData)==null?void 0:xt.manualLock)===!0}:null}catch(Ht){return console.warn("getOverlayLockInfo failed:",Ht),null}}function pu(_e){var We,xt,Ht;if(!(!s()||!_e))try{const qt=(We=s().getOverlays({id:_e}))==null?void 0:We[0];if(!qt)return;const dn=!(((xt=qt==null?void 0:qt.extendData)==null?void 0:xt.manualLock)===!0),Ut=dn?!0:!!i(d),Xn={...qt.extendData||{},manualLock:dn};s().overrideOverlay({id:_e,lock:Ut,extendData:Xn});const rs={...qt,lock:Ut,extendData:Xn};((Ht=i(A))==null?void 0:Ht.id)===_e&&x(A,V(rs)),Au(rs)}catch(qt){console.warn("toggleOverlayManualLockById failed:",qt)}}function tl(){var _e;x(h,!i(h)),(_e=s())==null||_e.overrideOverlay({visible:i(h)})}function Oa(){var _e,We;if(x(u,"normal"),x(f,"weakMagnet"),ve(null),i(w)){(_e=s())==null||_e.removeOverlay({id:i(w)});const xt=m.indexOf(i(w));xt>-1&&m.splice(xt,1),x(w,null)}(We=s())==null||We.overrideOverlay({mode:aP.Normal}),x(c,""),x(I,!1),x(P,!1),x(ce,!1),x(C,null),x(A,null),x(g,"")}function Oc(){var xt;let _e={groupId:hn},We=null;if(i(g))_e.id=i(g),We=hl(i(A)),We!=null&&We.id&&We.id!==i(g)&&(_e.id=We.id);else if(m.length>0){const Ht=m.pop();if(_e.id=Ht,Ht&&s()){const qt=s().getOverlays({id:Ht});qt&&qt.length>0&&(We=hl(qt[0]),We!=null&&We.id&&We.id!==Ht&&(_e.id=We.id))}}if(We){const Ht=$n(We.id);Fp.recordRemoveOverlay(We.id,We,Ht)}(xt=s())==null||xt.removeOverlay(_e),x(I,!1),x(P,!1),x(ce,!1),x(C,null),x(A,null)}function Gu(){var Ut;if(!i(A)||!s())return;const _e=$n(i(A).id),We=JSON.parse(JSON.stringify(i(A))),xt=Number(M.thickness)||1;let Ht=wt.Solid,qt=[8,4];M.style==="dashed"?(Ht=wt.Dashed,qt=[8,4]):M.style==="dotted"&&(Ht=wt.Dashed,qt=[2,6]);const ht=Fl(M.color,M.opacity,Rt.color),dn={line:{size:xt,color:ht,style:Ht,dashedValue:qt},text:{color:"#FFFFFF",backgroundColor:"rgba(0, 100, 255, 0.7)",borderColor:"#FFFFFF"},polygon:{color:ht}};try{s().overrideOverlay({id:i(A).id,styles:dn})}catch(Xn){console.log("Error updating overlay styles:",Xn)}Au({...i(A),styles:{...i(A).styles,...dn}}),Bc(i(A))&&((Ut=i(A))!=null&&Ut.name)&&Ll(i(A).name,{thickness:M.thickness,style:M.style,color:M.color,opacity:M.opacity});try{const Xn={...i(A),styles:{...i(A).styles,...dn}};Fp.recordModifyOverlay(i(A).id,We,Xn,_e)}catch{}}const El="Add text";function mu(_e){const We=_e.extendData||{},Ht=(_e.styles||{}).text||{},qt=We.backgroundColor||Ht.backgroundColor||"#A0000020";let ht=qt;if(typeof qt=="string"&&qt.startsWith("#")&&qt.length===9){ht=qt.slice(0,7);try{x(Et,V(Math.round(parseInt(qt.slice(7,9),16)/255*100)))}catch{}}typeof We.textBgOpacity=="number"&&x(Et,V(Math.max(0,Math.min(100,We.textBgOpacity))));const dn=We.textColor||Ht.color||"#FFFFFF";let Ut=dn;if(typeof dn=="string"&&dn.startsWith("#")&&dn.length===9){Ut=dn.slice(0,7);try{x(Pt,V(Math.round(parseInt(dn.slice(7,9),16)/255*100)))}catch{}}typeof We.textOpacity=="number"&&x(Pt,V(Math.max(0,Math.min(100,We.textOpacity)))),i(bt).fontSize=String(We.fontSize||Ht.size||32),i(bt).fontWeight=We.fontWeight||Ht.weight||"bold",i(bt).textColor=uc(Ut,qs.textColor),i(bt).backgroundColor=uc(ht,qs.backgroundColor),i(bt).fontFamily=We.fontFamily||Ht.family||ut}function bc(){var ps,vo,Ko,ho,wa,di,Mi;if(!i(A)||!s()||i(A).name!=="text")return;const _e=$n(i(A).id),We=JSON.parse(JSON.stringify(i(A))),xt=Number(i(bt).fontSize)||12,Ht=i(bt).backgroundColor||qs.backgroundColor,qt=i(bt).textColor||qs.textColor,ht=Fl(Ht,i(Et),qs.backgroundColor),dn=Fl(qt,i(Pt),qs.textColor),Ut=((ps=i(A).styles)==null?void 0:ps.text)||{},Xn=Ut.size??((vo=i(A).extendData)==null?void 0:vo.fontSize),rs=Ut.weight??((Ko=i(A).extendData)==null?void 0:Ko.fontWeight),_t=Ut.family??((ho=i(A).extendData)==null?void 0:ho.fontFamily),Gt=Xn!==xt||rs!==i(bt).fontWeight||_t!==i(bt).fontFamily,en={...i(A).extendData||{},fontSize:xt,fontWeight:i(bt).fontWeight,textColor:i(bt).textColor,backgroundColor:ht,fontFamily:i(bt).fontFamily,...Gt?{boxWidth:0,boxHeight:0}:{}},cs={...i(A).styles||{},text:{...((wa=i(A).styles)==null?void 0:wa.text)||{},size:xt,color:dn,backgroundColor:ht,family:i(bt).fontFamily,weight:i(bt).fontWeight,paddingLeft:8,paddingRight:8,paddingTop:4,paddingBottom:4,borderSize:0,borderColor:"transparent"},box:{...((di=i(A).styles)==null?void 0:di.box)||{},stroke:"#3b82f6",width:1,fill:"transparent"},handles:{...((Mi=i(A).styles)==null?void 0:Mi.handles)||{},size:6,fill:"#3b82f6",stroke:"#3b82f6"}};try{if(s().overrideOverlay({id:i(A).id,styles:cs,extendData:{...en,textColor:qt,backgroundColor:ht,textOpacity:i(Pt),textBgOpacity:i(Et)}}),(i(A).extendData||{}).editing)try{T0.updateEditorStyle(i(A))}catch{}}catch(Kr){console.log("Error updating text overlay styles:",Kr)}x(A,V({...i(A),styles:cs,extendData:en})),Au(i(A)),Bc(i(A))&&hc({fontSize:i(bt).fontSize,fontWeight:i(bt).fontWeight,textColor:i(bt).textColor,textOpacity:i(Pt),backgroundColor:i(bt).backgroundColor,backgroundOpacity:i(Et),fontFamily:i(bt).fontFamily});try{const Kr=JSON.parse(JSON.stringify(i(A)));Fp.recordModifyOverlay(i(A).id,We,Kr,_e)}catch{}}function nl(_e){var ht;x(F,!0),x(L,V(Date.now()));const We=_e instanceof MouseEvent?_e.clientX:_e.touches[0].clientX,xt=_e instanceof MouseEvent?_e.clientY:_e.touches[0].clientY,Ht=(ht=_e.target.closest(".context-menu-container"))==null?void 0:ht.getBoundingClientRect();Ht?(B.x=We-Ht.left,B.y=xt-Ht.top):i($)&&(B.x=We-i($).x,B.y=xt-i($).y);const qt=_e;typeof qt.preventDefault=="function"&&qt.preventDefault(),typeof qt.stopPropagation=="function"&&qt.stopPropagation()}function la(_e){if(i(F)&&i($)){x(L,V(Date.now()));const We=_e instanceof MouseEvent?_e.clientX:_e.touches[0].clientX,xt=_e instanceof MouseEvent?_e.clientY:_e.touches[0].clientY,Ht=window.innerWidth<=768,qt=Ht?Math.min(250,window.innerWidth-40):300,ht=Ht?40:60,dn=Ht?5:10,Ut=Ae==null?void 0:Ae.getBoundingClientRect();let Xn=We-B.x,rs=xt-B.y;const _t=((Ut==null?void 0:Ut.left)||0)+dn,Gt=(Ut?Ut.right:window.innerWidth)-qt-dn,en=((Ut==null?void 0:Ut.top)||0)+dn,cs=(Ut?Ut.bottom:window.innerHeight)-ht-dn;i($).x=Math.max(_t,Math.min(Xn,Gt)),i($).y=Math.max(en,Math.min(rs,cs))}}function Mu(){i(F)&&i($)&&gn(i($)),x(F,!1),x(L,V(Date.now()))}function Yu(_e){la(_e)}function zc(){Mu()}function Zd(_e){const We=_e.detail;i($e)==="line"?(M.color=We,Gu()):i($e)==="textColor"?(i(bt).textColor=We,bc()):i($e)==="textBg"&&(i(bt).backgroundColor=We,bc())}function Yf(_e){const We=_e.detail;i($e)==="line"?(M.opacity=We,x(Ke,V(We)),Gu()):i($e)==="textColor"?(x(Pt,V(We)),x(Ke,V(We)),bc()):i($e)==="textBg"&&(x(Et,V(We)),x(Ke,V(We)),bc())}function Kf(){x(Pe,!1)}function _d(){const _e=Fp.undo();console.log(_e?"Undo successful":"Nothing to undo")}function Rd(){const _e=Fp.redo();console.log(_e?"Redo successful":"Nothing to redo")}function fc(_e){(_e.ctrlKey||_e.metaKey)&&_e.key==="z"&&!_e.shiftKey?(_e.preventDefault(),_d()):(_e.ctrlKey||_e.metaKey)&&_e.key==="y"||(_e.ctrlKey||_e.metaKey)&&_e.shiftKey&&_e.key==="z"?(_e.preventDefault(),Rd()):(_e.key==="Delete"||_e.key==="Backspace")&&i(g)?(_e.preventDefault(),Oc()):(_e.ctrlKey||_e.metaKey)&&_e.key==="c"&&i(A)?(_e.preventDefault(),kd()):(_e.ctrlKey||_e.metaKey)&&_e.key==="v"&&i(O)&&(_e.preventDefault(),Ql(_e))}function pp(){if(!(!i(A)||!s())){x(Y,!0);try{const _e=JSON.parse(JSON.stringify(i(A))),We=Date.now();_e.id=`${i(A).name}_clone_${We}`,_e.points&&Array.isArray(_e.points)&&(_e.points=_e.points.map(Ht=>Ht&&typeof Ht=="object"?{...Ht,timestamp:Ht.timestamp?Ht.timestamp+1e3*60*5:Ht.timestamp,value:Ht.value?Ht.value*1.002:Ht.value}:Ht)),or(_e);const xt=cl(_e);if(xt){const Ht=Array.isArray(xt)?xt[0]:xt;if(Ht){const qt=$n(Ht);Fp.recordAddOverlay(Ht,_e,qt),mo(),setTimeout(()=>{var dn;const ht=s().getOverlays({id:Ht})[0];if(ht&&(Xu(Ht,ht),x(g,V(Ht)),x(A,V(ht)),el(ht),(ht==null?void 0:ht.name)==="text"&&mu(ht),ht.points&&ht.points.length>0)){const Ut=ht.points[0],Xn=(dn=s())==null?void 0:dn.convertToPixel(Ut,{paneId:"candle_pane"});if(Xn&&typeof Xn=="object"&&"x"in Xn&&"y"in Xn&&Xn.x!==void 0&&Xn.y!==void 0){x(C,V({x:Xn.x-80,y:Xn.y-30}));const rs=ot(ht)||{x:Xn.x-80,y:Xn.y-30};x($,V({...rs})),x(I,!0),x(P,!1),x(ce,!1)}}},100)}console.log("Overlay cloned successfully")}}catch(_e){console.error("Error cloning overlay:",_e)}finally{x(Y,!1)}}}function kd(){var _e;if(i(A))try{x(O,V(JSON.parse(JSON.stringify(i(A))))),console.log("Overlay copied to clipboard");try{(_e=navigator==null?void 0:navigator.clipboard)!=null&&_e.writeText&&navigator.clipboard.writeText(`${Q}${JSON.stringify(i(O))}`).catch(()=>{})}catch{}x(I,!1),setTimeout(()=>{console.log("Copy operation completed")},100)}catch(We){console.error("Error copying overlay:",We)}}function Wd(_e){if(!s()||!_e)return null;const We=s().getOverlays({id:_e})||[];if(!We.length)return null;const xt=Kl(We[0]);return x(g,V(xt.id)),x(A,V(xt)),el(xt),(xt==null?void 0:xt.name)==="text"&&mu(xt),xt}function $l(_e){Wd(_e)&&pp()}function Nu(_e){Wd(_e)&&kd()}function Ku(_e){Wd(_e)&&Oc()}function bf(){return!!i(O)}function Xu(_e,We){var ht,dn,Ut,Xn,rs,_t,Gt;if(!s()||!_e)return;let xt=0,Ht=0;try{const en=(We==null?void 0:We.paneId)||"candle_pane",cs=(ht=We==null?void 0:We.points)==null?void 0:ht[0],ps=cs?(dn=s())==null?void 0:dn.convertToPixel(cs,{paneId:en}):null;ps&&typeof ps=="object"&&(typeof ps.x=="number"&&(xt=ps.x),typeof ps.y=="number"&&(Ht=ps.y))}catch{}const qt=(Ut=i(A))==null?void 0:Ut.id;if(qt&&qt!==_e)try{const en={...((Xn=i(A))==null?void 0:Xn.extendData)||{},selected:!1};s().overrideOverlay({id:qt,selected:!1,extendData:en})}catch{}try{const en={...(We==null?void 0:We.extendData)||{},selected:!0};s().overrideOverlay({id:_e,selected:!0,extendData:en})}catch{}try{const en=(_t=(rs=s())==null?void 0:rs.getChartStore)==null?void 0:_t.call(rs);if(en!=null&&en.setClickOverlayInfo){const cs=((Gt=We==null?void 0:We.points)==null?void 0:Gt.length)>0?"overlay_figure_point_0":void 0,ps=cs!==void 0?{key:cs,type:"circle",attrs:{}}:null;en.setClickOverlayInfo({paneId:(We==null?void 0:We.paneId)||"candle_pane",overlay:We,figureType:ps?"point":"other",figureIndex:-1,figure:ps},(vo,Ko)=>{var ho;return(ho=vo==null?void 0:vo.onSelected)==null||ho.call(vo,{chart:s(),overlay:vo,figure:Ko,x:xt,y:Ht}),!0},(vo,Ko)=>{var ho;return(ho=vo==null?void 0:vo.onDeselected)==null||ho.call(vo,{chart:s(),overlay:vo,figure:Ko,x:xt,y:Ht}),!0})}}catch{}}function Ql(_e,We){if(!(!i(O)||!s()))try{const xt=JSON.parse(JSON.stringify(i(O))),Ht=Date.now();if(xt.id=`${i(O).name}_paste_${Ht}`,We&&xt.points&&Array.isArray(xt.points)){const ht=xt.points[0]||{},dn=Number(ht.timestamp),Ut=Number(ht.value);if(Number.isFinite(dn)&&Number.isFinite(Ut)){const Xn=We.timestamp-dn,rs=We.value-Ut;xt.points=xt.points.map(_t=>_t&&typeof _t=="object"?{..._t,timestamp:typeof _t.timestamp=="number"?_t.timestamp+Xn:_t.timestamp,value:typeof _t.value=="number"?_t.value+rs:_t.value}:_t)}}else _e&&xt.points&&Array.isArray(xt.points)&&(xt.points=xt.points.map(ht=>ht&&typeof ht=="object"?{...ht,timestamp:ht.timestamp?ht.timestamp+1e3*60*10:ht.timestamp,value:ht.value?ht.value*1.005:ht.value}:ht));or(xt);const qt=cl(xt);if(qt){const ht=Array.isArray(qt)?qt[0]:qt;if(ht){const dn=$n(ht);Fp.recordAddOverlay(ht,xt,dn),mo(),setTimeout(()=>{var Xn;const Ut=s().getOverlays({id:ht})[0];if(Ut&&(Xu(ht,Ut),x(g,V(ht)),x(A,V(Ut)),el(Ut),(Ut==null?void 0:Ut.name)==="text"&&mu(Ut),Ut.points&&Ut.points.length>0)){const rs=Ut.points[0],_t=(Xn=s())==null?void 0:Xn.convertToPixel(rs,{paneId:"candle_pane"});if(_t&&typeof _t=="object"&&"x"in _t&&"y"in _t&&_t.x!==void 0&&_t.y!==void 0){x(C,V({x:_t.x-80,y:_t.y-30}));const Gt=ot(Ut)||{x:_t.x-80,y:_t.y-30};x($,V({...Gt})),x(I,!0),x(P,!1),x(ce,!1)}}},100)}console.log("Overlay pasted successfully")}}catch(xt){console.error("Error pasting overlay:",xt)}}function Hd(_e){if(!(!i(O)||!s())){if(!_e||!Number.isFinite(_e.x)||!Number.isFinite(_e.y)){Ql();return}try{const We=_e.paneId||"candle_pane",xt=s().convertFromPixel([{x:_e.x,y:_e.y}],{paneId:We,absolute:!0}),Ht=Array.isArray(xt)?xt[0]:null;Ht&&typeof Ht.timestamp=="number"&&typeof Ht.value=="number"?Ql(void 0,{timestamp:Ht.timestamp,value:Ht.value}):Ql()}catch{Ql()}}}function hu(_e,We){const xt=String(_e||"");if(!xt.startsWith(Q))return;const Ht=xt.slice(Q.length);try{const qt=JSON.parse(Ht);x(O,V(qt)),Hd(We)}catch(qt){console.warn("Failed to parse overlay clipboard payload:",qt)}}function Jc(_e,We){if(!s())return;const xt=String(_e||"").trim();if(!xt||!We||!Number.isFinite(We.x)||!Number.isFinite(We.y))return;const Ht=We.paneId||"candle_pane";let qt=null;try{const en=s().convertFromPixel([{x:We.x,y:We.y}],{paneId:Ht,absolute:!0});qt=Array.isArray(en)?en[0]:null}catch{}if(!qt||typeof qt.timestamp!="number"||typeof qt.value!="number")return;const ht=Pa(),dn=Number(ht.fontSize)||32,Ut=Fl(ht.textColor,ht.textOpacity,qs.textColor),Xn=Fl(ht.backgroundColor,ht.backgroundOpacity,qs.backgroundColor),rs={name:"text",visible:i(h),lock:i(d),mode:i(u),paneId:Ht,points:[{timestamp:qt.timestamp,value:qt.value}],styles:{text:{color:Ut,backgroundColor:Xn,borderColor:"#1677FF",size:dn,weight:ht.fontWeight,family:ht.fontFamily}},extendData:{text:xt,fontSize:dn,fontWeight:ht.fontWeight,textColor:ht.textColor,textOpacity:ht.textOpacity,backgroundColor:Xn,textBgOpacity:ht.backgroundOpacity,fontFamily:ht.fontFamily}},_t=cl(rs),Gt=Array.isArray(_t)?_t[0]:_t;if(Gt){const en=$n(Gt);Fp.recordAddOverlay(Gt,rs,en),setTimeout(()=>{const cs=s().getOverlays({id:Gt})[0];cs&&(Xu(Gt,cs),x(g,V(Gt)),x(A,V(cs)),el(cs),mu(cs),T0.startEditing(s(),cs))},0)}}function Au(_e){if(_e.groupId!==hn)return;const We=["extendData","groupId","id","lock","mode","name","paneId","points","styles","totalStep","visible","zLevel"],xt=$n(_e.id);Fn.update(qt=>(qt[xt]=Object.fromEntries(We.map(ht=>[ht,_e[ht]])),qt));const Ht=oo.get();if(Ht&&_e.points&&_e.points.length>0)try{const qt=j0(o().symbol),ht={id:_e.id,symbolKey:qt,type:_e.name||"unknown",points:_e.points.map(dn=>({time:dn.timestamp||dn.t||0,price:dn.value||dn.p||0})),styles:_e.styles||{},..._e.extendData?{extendData:_e.extendData}:{},locked:!!_e.lock,visible:_e.visible!==!1};Ht.addDrawing(ht),iv()}catch(qt){console.error("Error syncing overlay to DrawingManager:",qt)}}function jd(){if(x(qe,!i(qe)),i(qe)){const _e=Qe();x(nt,V({x:_e.left+60,y:_e.top+100}))}}function Wu(_e){const{emoji:We}=_e.detail;console.log("Selected emoji:",We),x(qe,!1),cl({name:"emoji",visible:i(h),lock:i(d),mode:i(u),extendData:{emoji:We,size:24},styles:{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}}})}function sf(_e){if(!i(A)||i(A).name!=="emoji")return;const We=$n(i(A).id),xt=JSON.parse(JSON.stringify(i(A))),Ht=parseInt(_e);if(!(isNaN(Ht)||Ht<16||Ht>64)&&(i(A).extendData&&(i(A).extendData.size=Ht),s()&&i(A).id)){s().overrideOverlay({id:i(A).id,extendData:i(A).extendData}),Au(i(A));try{const qt=JSON.parse(JSON.stringify(i(A)));Fp.recordModifyOverlay(i(A).id,xt,qt,We)}catch{}}}function ad(){var _e,We;if(((_e=i(A))==null?void 0:_e.name)==="fibonacciSegment"){const xt=((We=i(A).extendData)==null?void 0:We.fibonacciLevels)||i(A).fibonacciLevels;xt?x(Ro,V(Ia(xt))):x(Ro,V(Yl())),x(zr,V(Eo(i(Ro)))),x(Iu,!0)}}function yd(){x(Ro,V(Eo(ri))),Tu()}function Bd(){Tu(),x(Iu,!1)}function Mc(){x(Ro,V(Eo(i(zr)))),Tu(),x(Iu,!1)}function Tu(){if(!i(A)||i(A).name!=="fibonacciSegment"||!s())return;const _e=$n(i(A).id),We=JSON.parse(JSON.stringify(i(A))),xt=Eo(i(Ro));s().overrideOverlay({id:i(A).id,extendData:{...i(A).extendData,fibonacciLevels:xt}}),i(A).extendData={...i(A).extendData||{},fibonacciLevels:xt},i(A).fibonacciLevels=xt,Au(i(A)),Vu(xt);try{const Ht=JSON.parse(JSON.stringify(i(A)));Fp.recordModifyOverlay(i(A).id,We,Ht,_e)}catch{}}function qd(_e,We,xt){_e>=0&&_e<i(Ro).length&&(i(Ro)[_e]={...i(Ro)[_e],[We]:xt},Tu())}function Xf(_e){var Ut,Xn;if(!s())return;const We=hl(i(A));if(!We)return;const xt=String((We==null?void 0:We.name)||(We==null?void 0:We.type)||"");if(!ws(xt)){const _t={extendData:{...We.extendData||{},showTimeLabel:_e.timeLabel,crossPaneEnabled:!1}};or(_t);try{s().overrideOverlay({id:We.id,extendData:_t.extendData})}catch{}si(xt,We.id);try{const Gt=(Ut=s().getOverlays({id:We.id}))==null?void 0:Ut[0];Gt&&Au(Gt)}catch{}return}const qt={...We.extendData||{}},ht=qt.crossPaneGroup||We.id;if(!qt.crossPaneGroup){const rs={...qt,crossPaneGroup:ht,crossPaneRole:"primary"};try{s().overrideOverlay({id:We.id,extendData:rs})}catch{}qt.crossPaneGroup=ht,qt.crossPaneRole="primary"}const dn={...qt};dn.crossPaneEnabled=_e.extend,dn.showTimeLabel=_e.timeLabel,dn.crossPaneGroup=ht,dn.crossPaneRole??(dn.crossPaneRole="primary");try{s().overrideOverlay({id:We.id,extendData:dn})}catch{}_e.extend?mo():Oi(ht,We.id);try{const rs=(Xn=s().getOverlays({id:We.id}))==null?void 0:Xn[0];rs&&Au(rs)}catch{}}function Vf(_e){const We=(_e==null?void 0:_e.detail)||i(Md);x(Md,V({...We})),Xf(We),x(kl,!1)}function se(){x(Md,V({...i(nf)})),Xf(i(nf)),x(kl,!1)}function be(_e){const We=(_e==null?void 0:_e.detail)||i(Md);x(Md,V({...We})),Xf(We)}_p(On,_e=>_e.clickChart).subscribe(()=>{x(c,""),Date.now()-oe>150&&!i(F)&&requestAnimationFrame(()=>{var Ht,qt,ht,dn,Ut,Xn;const We=(qt=(Ht=s())==null?void 0:Ht.getChartStore)==null?void 0:qt.call(Ht),xt=Pc();if(xt){(!i(A)||i(A).id!==xt.id)&&(Ic(),J(xt));return}if((ht=i(A))!=null&&ht.id)try{const rs={...i(A).extendData||{},selected:!1};(Ut=(dn=s())==null?void 0:dn.overrideOverlay)==null||Ut.call(dn,{id:i(A).id,selected:!1,extendData:rs})}catch{}if(We!=null&&We.setClickOverlayInfo)try{We.setClickOverlayInfo({paneId:((Xn=i(A))==null?void 0:Xn.paneId)||"candle_pane",overlay:null,figureType:"none",figureIndex:-1,figure:null},()=>!0,()=>!0)}catch{}x(g,""),x(A,null),x(I,!1),x(P,!1),x(ce,!1),x(C,null)})}),Th(()=>{if(Zt(),dc(Pa()),typeof document<"u"&&(document.addEventListener("mousemove",la),document.addEventListener("mouseup",Mu),document.addEventListener("touchmove",Yu,{passive:!1}),document.addEventListener("touchend",zc),document.addEventListener("touchcancel",zc)),typeof window<"u"){window.addEventListener("resize",Dt);const _e=We=>{if(s()&&i(A)&&i(A).name==="text"){const xt=ot(i(A));xt&&(x($,V({...xt})),x(C,V({x:xt.x,y:xt.y})),x(I,!0),x(P,!1)),T0.startEditing(s(),i(A))}};window.addEventListener("dblclick",_e)}}),Th(()=>{typeof document<"u"&&document.addEventListener("keydown",fc)});function re(){if(!i(Je))return;const{scrollHeight:_e,clientHeight:We,scrollTop:xt}=i(Je),Ht=_e>We,qt=xt+We>=_e-5;x(Mt,V(Ht&&!qt))}function we(_e){if(_e&&(_e.preventDefault(),_e.stopPropagation()),!i(Je))return;const{scrollTop:We,clientHeight:xt,scrollHeight:Ht}=i(Je),qt=xt*.7,ht=Math.min(We+qt,Ht-xt);i(Je).scrollTo({top:ht,behavior:"smooth"})}Th(()=>{re();const _e=()=>{re()},We=()=>{re()};return i(Je)&&i(Je).addEventListener("scroll",_e),typeof window<"u"&&window.addEventListener("resize",We),setTimeout(re,500),()=>{i(Je)&&i(Je).removeEventListener("scroll",_e),typeof window<"u"&&window.removeEventListener("resize",We)}}),b0(()=>{try{Xs()}catch{}Z&&(clearTimeout(Z),Z=null),typeof document<"u"&&(document.removeEventListener("mousemove",la),document.removeEventListener("mouseup",Mu),document.removeEventListener("keydown",fc),document.removeEventListener("touchmove",Yu),document.removeEventListener("touchend",zc),document.removeEventListener("touchcancel",zc)),typeof window<"u"&&window.removeEventListener("resize",Dt)});function J(_e){try{oe=Date.now();const We=Kl(_e);if(x(g,V(We.id)),x(A,V(We)),el(We),(We==null?void 0:We.name)==="text"&&mu(We),We.points&&We.points.length>0){const xt=ot(We);xt&&(x($,V({...xt})),x(C,V({x:xt.x,y:xt.y})),x(I,!0),x(P,!1))}}catch(We){console.warn("externalSelectOverlay failed:",We)}}function Fe(_e){var We,xt,Ht;try{if(i(g)===_e.id||((We=i(A))==null?void 0:We.id)===_e.id){try{(Ht=(xt=s())==null?void 0:xt.overrideOverlay)==null||Ht.call(xt,{id:_e.id,selected:!1,extendData:{...(_e==null?void 0:_e.extendData)||{},selected:!1,editing:!1}})}catch{}x(g,""),x(P,!1),x(I,!1),x(ce,!1),x(C,null),x(A,null)}}catch(qt){console.warn("externalDeselectOverlay failed:",qt)}}function yt(_e){try{Au(_e),sr(_e)}catch(We){console.warn("externalSyncOverlay failed:",We)}}function vt(){try{mo()}catch(_e){console.warn("externalEnsureCrossPaneLines failed:",_e)}}function jt(_e){try{i(g)===_e&&(x(g,""),x(P,!1),x(I,!1),x(ce,!1),x(C,null),x(A,null))}catch(We){console.warn("externalRemoved failed:",We)}}function ye(_e={}){mr("text"),cl({name:"text",visible:i(h),lock:i(d),mode:i(u),styles:{text:{color:"#FFFFFF",backgroundColor:"#A0000020",borderColor:"#1677FF",size:_e.fontSize??32,weight:_e.fontWeight??"bold",family:_e.fontFamily??ut}},extendData:{text:_e.text??El,fontSize:_e.fontSize??32,fontWeight:_e.fontWeight??"bold",textColor:_e.textColor??"#FFFFFF",backgroundColor:_e.backgroundColor??"#A0000020",fontFamily:_e.fontFamily??ut}})}function E(_e,We){s()&&s().overrideOverlay({id:_e,...We})}function me(_e){s()&&s().removeOverlay({id:_e})}function Se(_e){x(g,V(_e||""))}function Ve(_e){var xt;if(!s())return;const We=(xt=s().getOverlays({id:_e}))==null?void 0:xt[0];We&&We.name==="text"&&T0.startEditing(s(),We)}function Ye(_e){}var at=az(),Re=fn(at),De=y(Re);De.__click=[AO];var pt=y(De);a(pt,()=>Oa,()=>"crosshair",()=>"",()=>[],()=>!0);var Ge=v(pt,2);Yo(Ge,17,()=>ba,Ii,(_e,We)=>{var xt=TO(),Ht=fn(xt),qt=ov(()=>()=>i(We).key==="emoji"?jd():mr(i(We).icon));a(Ht,()=>i(qt),()=>i(We).icon,()=>i(We).key,()=>i(We).list,()=>!0);var ht=v(Ht,2);Ue(ht,()=>i(We).key==="emoji",dn=>{l(dn)}),q(_e,xt)});var sn=v(Ge,2),Un=ov(()=>()=>mr("ruler"));a(sn,()=>i(Un),()=>"ruler");var Zs=v(sn,2);a(Zs,()=>Ba,()=>i(f),()=>"mode",()=>qi,()=>!1,()=>!0);var vs=v(Zs,2);a(vs,()=>Ga,()=>i(d)?"lock":"unlock",()=>"lock",()=>[],()=>!1,()=>!0);var Oo=v(vs,2);a(Oo,()=>tl,()=>i(h)?"visible":"invisible",()=>"",()=>[],()=>!1,()=>!0);var Pi=v(Oo,2);l(Pi);var no=v(Pi,2);a(no,()=>Oc,()=>"remove"),_(De),tp(De,_e=>x(Je,_e),()=>i(Je));var gl=v(De,2);Ue(gl,()=>i(Mt),_e=>{var We=LO();We.__click=we,We.__touchstart=[kO,we],We.__touchend=[FO],q(_e,We)}),_(Re);var Ms=v(Re,2);Ue(Ms,()=>i(c),_e=>{var We=OO(),xt=fn(We);Yo(xt,17,()=>ba,Ii,(qt,ht)=>{var dn=Qn(),Ut=fn(dn);Ue(Ut,()=>i(ht).key===i(c)&&i(ht).list.length>0,Xn=>{var rs=DO();const _t=Bt(()=>`left: 60px; top: ${vc(i(c))??""}px;`);Yo(rs,21,()=>i(ht).list,Ii,(Gt,en)=>{var cs=$O();cs.__click=[EO,c,vi,en,La,ba];var ps=y(cs),vo=Bt(()=>Sl(i(en).key));Gv(ps,{get name(){return i(vo)},class:"w-4 h-4"});var Ko=v(ps,2),ho=y(Ko,!0);Ce(()=>tt(ho,Og[i(en).text]())),_(Ko),_(cs),vd("mouseenter",cs,wa=>wa.currentTarget.style.backgroundColor="var(--menu-hover-bg)"),vd("mouseleave",cs,wa=>wa.currentTarget.style.backgroundColor="transparent"),q(Gt,cs)}),_(rs),T6(rs,Gt=>It(Gt)),Ce(()=>Ot(rs,"style",i(_t))),q(Xn,rs)}),q(qt,dn)});var Ht=v(xt,2);Ue(Ht,()=>i(c)==="mode",qt=>{var ht=BO();const dn=Bt(()=>`left: 60px; top: ${vc("mode")??""}px;`);Yo(ht,21,()=>qi,Ii,(Ut,Xn)=>{var rs=jO();rs.__click=[RO,vi,Xn];var _t=y(rs),Gt=Bt(()=>Sl(i(Xn).key));Gv(_t,{get name(){return i(Gt)},class:"w-4 h-4"});var en=v(_t,2),cs=y(en,!0);Ce(()=>tt(cs,Og[i(Xn).text]())),_(en),_(rs),vd("mouseenter",rs,ps=>ps.currentTarget.style.backgroundColor="var(--menu-hover-bg)"),vd("mouseleave",rs,ps=>ps.currentTarget.style.backgroundColor="transparent"),q(Ut,rs)}),_(ht),T6(ht,Ut=>It(Ut)),Ce(()=>Ot(ht,"style",i(dn))),q(qt,ht)}),q(_e,We)});var wo=v(Ms,2);Ue(wo,()=>i(I)&&i($),_e=>{var We=iz();We.__click=[zO];var xt=y(We);Ue(xt,()=>{var vo;return((vo=i(A))==null?void 0:vo.name)!=="emoji"},vo=>{var Ko=qO(),ho=fn(Ko);ho.__mousedown=nl,ho.__touchstart=[_O,nl];var wa=y(ho),di=y(wa),Mi=y(di);Zi(2),_(di),Zi(4),_(wa),_(ho);var Kr=v(ho,2);Ue(Kr,()=>{var hr;return((hr=i(A))==null?void 0:hr.name)==="text"},hr=>{var sl=WO(),fo=fn(sl);fo.__change=bc;var wu=y(fo);wu.value=(wu.__value="8")==null?"":"8";var _l=v(wu);_l.value=(_l.__value="10")==null?"":"10";var Xl=v(_l);Xl.value=(Xl.__value="11")==null?"":"11";var rc=v(Xl);rc.value=(rc.__value="12")==null?"":"12";var Qc=v(rc);Qc.value=(Qc.__value="14")==null?"":"14";var na=v(Qc);na.value=(na.__value="16")==null?"":"16";var Nc=v(na);Nc.value=(Nc.__value="18")==null?"":"18";var Ea=v(Nc);Ea.value=(Ea.__value="20")==null?"":"20";var Nd=v(Ea);Nd.value=(Nd.__value="22")==null?"":"22";var In=v(Nd);In.value=(In.__value="24")==null?"":"24";var St=v(In);St.value=(St.__value="32")==null?"":"32";var Rn=v(St);Rn.value=(Rn.__value="40")==null?"":"40";var Cn=v(Rn);Cn.value=(Cn.__value="52")==null?"":"52",_(fo);var Ts=v(fo,2);Ts.__click=[gO,bt,bc];var Fs=v(Ts,2),Es=y(Fs),Co=y(Es);const li=Bt(()=>`background-color: ${i(bt).textColor??""}; color: ${Ze(i(bt).textColor)??""};`);Co.__click=[bO,$e,ze,bt,Ke,Pt,Pe];var ro=y(Co);Gv(ro,{name:"text",size:12}),_(Co);var zo=v(Co,2);const io=Bt(()=>`background-color: ${i(bt).backgroundColor??""}; color: ${Ze(i(bt).backgroundColor)??""};`);zo.__click=[xO,$e,ze,bt,Ke,Et,Pe];var Ji=y(zo);Gv(Ji,{name:"rect",size:12}),_(zo),_(Es);var Hl=v(Es,2);Hl.__change=bc,Yo(Hl,21,()=>Xe,Ii,(Vc,ol)=>{var Ac=VO(),br={},fa=y(Ac,!0);_(Ac),Ce(()=>{br!==(br=i(ol).value)&&(Ac.value=(Ac.__value=i(ol).value)==null?"":i(ol).value),tt(fa,i(ol).label)}),q(Vc,Ac)}),_(Hl),_(Fs),Ce(()=>{pi(fo,`px-1 py-1 text-xs border rounded cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[72px] h-[28px] svelte-ue8k6c`),pi(Ts,`w-8 h-8 rounded flex items-center justify-center ${(o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors svelte-ue8k6c`),Ot(Co,"style",i(li)),Ot(zo,"style",i(io)),pi(Hl,`px-1 py-1 text-xs border rounded cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n max-w-[120px] svelte-ue8k6c`)}),xo(fo,()=>i(bt).fontSize,Vc=>i(bt).fontSize=Vc),xo(Hl,()=>i(bt).fontFamily,Vc=>i(bt).fontFamily=Vc),q(hr,sl)},hr=>{var sl=HO(),fo=fn(sl);fo.__click=[yO,$e,ze,M,Ke,ft,Pe];var wu=v(fo,2);wu.__change=Gu;var _l=y(wu);_l.value=(_l.__value="1")==null?"":"1";var Xl=v(_l);Xl.value=(Xl.__value="2")==null?"":"2";var rc=v(Xl);rc.value=(rc.__value="3")==null?"":"3";var Qc=v(rc);Qc.value=(Qc.__value="4")==null?"":"4";var na=v(Qc);na.value=(na.__value="5")==null?"":"5";var Nc=v(na);Nc.value=(Nc.__value="6")==null?"":"6";var Ea=v(Nc);Ea.value=(Ea.__value="7")==null?"":"7";var Nd=v(Ea);Nd.value=(Nd.__value="8")==null?"":"8",_(wu);var In=v(wu,2);In.__change=Gu;var St=y(In);St.value=(St.__value="solid")==null?"":"solid";var Rn=v(St);Rn.value=(Rn.__value="dashed")==null?"":"dashed";var Cn=v(Rn);Cn.value=(Cn.__value="dotted")==null?"":"dotted",_(In),Ce(()=>{Ot(fo,"style",`background-color: ${M.color??""};`),pi(wu,`px-1 py-1 text-xs border rounded-md cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[64px] h-[28px] svelte-ue8k6c`),pi(In,`px-1 py-1 text-xs border rounded-md cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[72px] h-[28px] svelte-ue8k6c`)}),xo(wu,()=>M.thickness,Ts=>M.thickness=Ts),xo(In,()=>M.style,Ts=>M.style=Ts),q(hr,sl)}),Ce(()=>{pi(ho,`drag-handle cursor-grab hover:cursor-grabbing flex items-center justify-center
                 w-6 h-6 rounded ${(o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors
                 touch-manipulation svelte-ue8k6c`),pi(Mi,`w-0.5 h-0.5 ${(o().theme==="dark"?"bg-gray-500":"bg-gray-400")??""} rounded-full`)}),q(vo,Ko)},vo=>{var Ko=GO(),ho=y(Ko),wa=y(ho,!0);_(ho);var di=v(ho,2),Mi=v(y(di),2);xn(Mi),Mi.__input=[UO,sf];var Kr=v(Mi,2),hr=y(Kr,!0);_(Kr),_(di),_(Ko),Ce(()=>{var sl,fo,wu,_l,Xl,rc,Qc,na;tt(wa,((fo=(sl=i(A))==null?void 0:sl.extendData)==null?void 0:fo.emoji)||"😀"),Gf(Mi,((_l=(wu=i(A))==null?void 0:wu.extendData)==null?void 0:_l.size)||24),Ot(Mi,"title",`Emoji size: ${(((rc=(Xl=i(A))==null?void 0:Xl.extendData)==null?void 0:rc.size)||24)??""}px`),tt(hr,((na=(Qc=i(A))==null?void 0:Qc.extendData)==null?void 0:na.size)||24)}),q(vo,Ko)});var Ht=v(xt,2);Ue(Ht,()=>{var vo;return((vo=i(A))==null?void 0:vo.name)==="fibonacciSegment"},vo=>{var Ko=KO();Ko.__click=[YO,ad];var ho=y(Ko);_(Ko),Ce(()=>{pi(Ko,`w-8 h-8 rounded ${(o().theme==="dark"?"hover:bg-blue-900":"hover:bg-blue-100")??""} transition-colors duration-200
                 flex items-center justify-center svelte-ue8k6c`),v_(ho,`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""} hover:text-blue-500`)}),q(vo,Ko)});var qt=v(Ht,2);Ue(qt,()=>{var vo;return Us((vo=i(A))==null?void 0:vo.name)},vo=>{var Ko=XO();Ko.__click=[wO,hl,A,zf,ws,Md,nf,kl];var ho=y(Ko);_(Ko),Ce(()=>{pi(Ko,`w-8 h-8 rounded ${(o().theme==="dark"?"hover:bg-blue-900":"hover:bg-blue-100")??""} transition-colors duration-200
                 flex items-center justify-center svelte-ue8k6c`),v_(ho,`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""} hover:text-blue-500`)}),q(vo,Ko)});var ht=v(qt,2);ht.__click=[vO,A,s,bn,d,Au];var dn=y(ht),Ut=Bt(()=>{var vo,Ko;return(Ko=(vo=i(A))==null?void 0:vo.extendData)!=null&&Ko.manualLock?"lock":"unlock"}),Xn=Bt(()=>`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""}`);Gv(dn,{get name(){return i(Ut)},get class(){return i(Xn)}}),_(ht);var rs=v(ht,2),_t=y(rs);_t.__click=[ZO,ce];var Gt=y(_t);_(_t);var en=v(_t,2);Ue(en,()=>i(ce),vo=>{var Ko=sz();Ko.__click=[JO];var ho=y(Ko);ho.__click=[QO,pp,ce];var wa=v(ho,2);wa.__click=[ez,kd,ce];var di=v(wa,2);Ue(di,()=>i(O),Mi=>{var Kr=nz();Kr.__click=[tz,Ql,ce],Ce(()=>pi(Kr,`w-full text-left px-3 py-2 text-sm ${(o().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-ue8k6c`)),q(Mi,Kr)}),_(Ko),Ce(()=>{pi(Ko,`absolute right-0 top-full mt-1 min-w-[140px] rounded-md shadow-lg border ${(o().theme==="dark"?"bg-[#2B2B2B] border-[#3F3F3F]":"bg-white border-gray-200")??""} z-[200002]`),pi(ho,`w-full text-left px-3 py-2 text-sm ${(o().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-ue8k6c`),pi(wa,`w-full text-left px-3 py-2 text-sm ${(o().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-ue8k6c`)}),q(vo,Ko)}),_(rs);var cs=v(rs,2);cs.__click=[oz,Oc,I,C];var ps=y(cs);_(cs),_(We),Ce(()=>{var vo,Ko,ho,wa;pi(We,`context-menu-container fixed z-[200001] rounded-md shadow-lg flex items-center gap-1 space-x-1\\n ${(o().theme==="dark"?"bg-[#2B2B2B] border border-[#3F3F3F]":"bg-white border border-gray-200")??""} ${(i(F)?"cursor-grabbing":"")??""}\\n px-2 py-1 sm:px-3 sm:py-1\\n max-w-[85vw] sm:max-w-none svelte-ue8k6c`),Ot(We,"data-theme",o().theme),Ot(We,"style",`left: ${i($).x??""}px; 
           top: ${i($).y??""}px;`),pi(ht,`w-8 h-8 rounded transition-colors duration-200 flex items-center justify-center
        ${((Ko=(vo=i(A))==null?void 0:vo.extendData)!=null&&Ko.manualLock?o().theme==="dark"?"bg-blue-900":"bg-blue-100":o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} svelte-ue8k6c`),Ot(ht,"title",(wa=(ho=i(A))==null?void 0:ho.extendData)!=null&&wa.manualLock?"Unlock selected drawing":"Lock selected drawing"),pi(_t,`w-8 h-8 rounded ${(o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors duration-200 flex items-center justify-center svelte-ue8k6c`),Ot(_t,"aria-expanded",i(ce)),v_(Gt,`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""}`),pi(cs,`w-8 h-8 rounded ${(o().theme==="dark"?"hover:bg-red-900":"hover:bg-red-100")??""} transition-colors duration-200
               flex items-center justify-center svelte-ue8k6c`),v_(ps,`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""} hover:text-red-500`)}),q(_e,We)});var fr=v(wo,2);Ue(fr,()=>i(P)&&i(C),_e=>{var We=rz();We.__click=Oc,Ce(()=>Ot(We,"style",`left: ${i(C).x??""}px; top: ${i(C).y??""}px;`)),q(_e,We)});var xa=v(fr,2);qv(xa,{get selectedColor(){return i(ze)},set selectedColor(_e){x(ze,V(_e))},get opacity(){return i(Ke)},set opacity(_e){x(Ke,V(_e))},get show(){return i(Pe)},set show(_e){x(Pe,V(_e))},$$events:{colorChange:Zd,opacityChange:Yf,close:Kf}});var ic=v(xa,2);eO(ic,{get show(){return i(qe)},set show(_e){x(qe,V(_e))},get position(){return i(nt)},set position(_e){x(nt,V(_e))},$$events:{select:Wu}});var ec=v(ic,2);cO(ec,{get visible(){return i(Iu)},set visible(_e){x(Iu,V(_e))},get levels(){return i(Ro)},set levels(_e){x(Ro,V(_e))},get theme(){return o().theme},$$events:{levelChange:_e=>qd(_e.detail.index,_e.detail.field,_e.detail.value),reset:yd,confirm:Bd,cancel:Mc}});var Lf=v(ec,2);return hO(Lf,{get visible(){return i(kl)},set visible(_e){x(kl,V(_e))},get showExtendToggle(){return i(zf)},get extendEnabled(){return i(Md).extend},get timeLabelEnabled(){return i(Md).timeLabel},get theme(){return o().theme},$$events:{change:be,confirm:Vf,cancel:se}}),q(n,at),$d({addOverlay:cl,getOverlayLockInfo:vl,toggleOverlayManualLockById:pu,clickRemove:Oc,cloneOverlayById:$l,copyOverlayById:Nu,removeOverlayById:Ku,hasCopiedOverlay:bf,pasteOverlayAtPixel:Hd,pasteOverlayFromClipboard:hu,pasteTextAtPixel:Jc,externalSelectOverlay:J,externalDeselectOverlay:Fe,externalSyncOverlay:yt,externalEnsureCrossPaneLines:vt,externalRemoved:jt,createTextDrawing:ye,updateTextDrawing:E,deleteTextDrawing:me,setSelectedDrawing:Se,enterEditMode:Ve,exitEditMode:Ye})}Ip(["click","touchstart","touchend","mousedown","change","input"]);const p8={mode:"none",playing:!1,speed:1,replayFrom:null,replayTo:null,replayActive:!1,depositAmount:1e5,leverage:null,currency:"USD",balance:1e5,positions:[],history:[],sidebarOpen:!1,pendingOrders:[],onboardingDone:!1},uh=$m(p8);function u6(){uh.set(p8)}function m8(n){var t;const e=n.priceCurrency||((t=n.exchange)!=null&&t.toUpperCase().includes("DSE")?"BDT":"USD");uh.update(s=>({...s,currency:e}))}function h8(n){uh.update(e=>({...e,currency:n}))}function v8(n){uh.update(e=>({...e,depositAmount:n,balance:n}))}function g8(n){uh.update(e=>({...e,leverage:n}))}function _8(n){uh.update(e=>({...e,onboardingDone:n}))}function S2(n){uh.update(e=>({...e,mode:n}))}function Yv(n){uh.update(e=>({...e,playing:n}))}function y8(n,e){const t=Number.isFinite(n)&&Number.isFinite(e);uh.update(s=>({...s,replayFrom:t?Number(n):null,replayTo:t?Number(e):null,replayActive:t}))}function cz(){uh.update(n=>({...n,replayFrom:null,replayTo:null,replayActive:!1}))}function d6(n){if(uh.update(e=>({...e,speed:n})),typeof window<"u"&&window.setPlaybackSpeed)try{window.setPlaybackSpeed(n)}catch{}}function b8(n){uh.update(e=>({...e,positions:[...e.positions,n],balance:e.balance-n.avgCost*n.quantity}))}function uz(n,e,t){uh.update(s=>{const o=s.positions.findIndex(d=>d.id===n);if(o===-1)return s;const r=s.positions[o],a=Math.min(e,r.quantity),l=(t-r.avgCost)*a*(r.leverage||1),c=r.quantity-a,f=[...s.positions];c>0?f[o]={...r,quantity:c}:f.splice(o,1);const u={id:n,symbol:r.symbol,quantity:a,avgCost:r.avgCost,closedAvg:t,pnl:l,closedAt:Date.now()};return{...s,positions:f,history:[u,...s.history],balance:s.balance+t*a+l}})}function dz(n){uh.update(e=>({...e,pendingOrders:[...e.pendingOrders||[],n]}))}function bx(n){uh.update(e=>({...e,pendingOrders:(e.pendingOrders||[]).filter(t=>t.id!==n)}))}function u5(n,e,t){e(!1),n.stopPropagation(),t.click&&t.click("close")}var fz=n=>n.stopPropagation(),pz=(n,e,t)=>e(i(t)),mz=ke("<button> </button>"),hz=ke('<div class="modal-action px-4 sm:px-6 py-4 sm:py-5 border-t modal-footer svelte-1a6y34w"><div class="flex flex-col sm:flex-row gap-2 sm:gap-3 justify-end w-full"></div></div>'),vz=ke('<div class="fixed inset-0 z-[350000] flex items-center justify-center px-3 sm:px-4 md:px-6 animate-in fade-in duration-200 modal-overlay svelte-1a6y34w"><div><div class="relative px-4 sm:px-6 py-4 sm:py-5 border-b modal-header svelte-1a6y34w"><div class="flex justify-between items-center gap-4"><div class="flex items-center gap-3 min-w-0 flex-1"><div class="icon-badge svelte-1a6y34w"><svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div> <h3 class="font-bold text-lg sm:text-xl md:text-2xl tracking-tight text-base-content truncate"> </h3></div> <button class="close-btn flex-shrink-0 svelte-1a6y34w" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 sm:w-6 sm:h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div><!></div> <!></div></div>');function tg(n,e){Ed(e,!0);let t=hi(e,"width",3,600),s=hi(e,"maxWidth",3,"min(600px, 95vw)"),o=hi(e,"maxHeight",3,"90vh"),r=hi(e,"title",3,""),a=hi(e,"buttons",19,()=>["confirm"]),l=hi(e,"show",15,!1),c=hi(e,"center",3,!1),f=hi(e,"class",3,""),u=hi(e,"theme",3,"dark");function d(w){w==="close"&&l(!1),e.click&&e.click(w)}function h(w){switch(w){case"confirm":return"btn-primary";case"cancel":return"btn-ghost";default:return"btn-secondary"}}var m=Qn(),g=fn(m);Ue(g,l,w=>{var C=vz();C.__click=[u5,l,e];var P=y(C);P.__click=[fz];var I=y(P),A=y(I),M=y(A),F=v(y(M),2),B=y(F,!0);_(F),_(M);var $=v(M,2);$.__click=[u5,l,e],_(A),_(I);var L=v(I,2),O=y(L);Ue(O,()=>e.children,ce=>{var Q=Qn(),le=fn(Q);DC(le,()=>e.children),q(ce,Q)}),_(L);var Y=v(L,2);Ue(Y,()=>a().length>0,ce=>{var Q=hz(),le=y(Q);Yo(le,21,a,Ii,(ue,fe)=>{var pe=mz();const Z=Bt(()=>`btn-premium ${h(i(fe))??""} w-full sm:w-auto sm:min-w-[120px] svelte-1a6y34w`);pe.__click=[pz,d,fe];var xe=y(pe,!0);Ce(()=>tt(xe,Og[i(fe)]())),_(pe),Ce(()=>pi(pe,i(Z))),q(ue,pe)}),_(le),_(Q),q(ce,Q)}),_(P),_(C),Ce(()=>{pi(P,`relative rounded-3xl shadow-luxury animate-in zoom-in-95 duration-300 overflow-hidden flex flex-col modal-container ${f()??""} svelte-1a6y34w`),Ot(P,"data-theme",u()),Ot(P,"style",`width: ${(typeof t()=="string"?t():t()+"px")??""}; max-width: ${s()??""}; max-height: ${o()??""};`),tt(B,r()),pi(L,`flex-1 overflow-y-auto premium-scrollbar ${(c()?"flex justify-center items-center":"")??""} px-4 sm:px-6 py-4 sm:py-5 svelte-1a6y34w`)}),q(w,C)}),q(n,m),$d()}Ip(["click"]);const gz="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let x8=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=gz[t[n]&63];return e};/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const _z={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var yz=ta("<svg><!><!></svg>");function dh(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]),s=_m(t,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ed(e,!1);let o=hi(e,"name",8,void 0),r=hi(e,"color",8,"currentColor"),a=hi(e,"size",8,24),l=hi(e,"strokeWidth",8,2),c=hi(e,"absoluteStrokeWidth",8,!1),f=hi(e,"iconNode",24,()=>[]);const u=(...I)=>I.filter((A,M,F)=>!!A&&F.indexOf(A)===M).join(" "),d=a_(),[h,m]=d;rv();var g=yz();let w;var C=y(g);Yo(C,1,f,Ii,(I,A)=>{let M=()=>i(A)[0],F=()=>i(A)[1];var B=Qn(),$=fn(B);const L=ov(()=>`${M()}`=="button"?m({...F()},[{attribute_name:"formaction"}]):`${M()}`=="form"?m({...F()},[{attribute_name:"action"}]):`${M()}`=="a"?m({...F()},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{...F()});VC($,M,!0,(O,Y)=>{let ce;Ce(()=>ce=A6(O,ce,{...i(L)},void 0,O.namespaceURI===h3,O.nodeName.includes("-")))}),q(I,B)});var P=v(C);Dm(P,e,"default",{}),_(g),Ce(()=>w=A6(g,w,{..._z,...s,width:a(),height:a(),stroke:r(),"stroke-width":c()?Number(l())*24/Number(a()):l(),class:u("lucide-icon","lucide",o()?`lucide-${o()}`:"",t.class)},void 0,!0)),q(n,g),$d()}function bz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"activity"},()=>t,{iconNode:[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function xz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"banknote"},()=>t,{iconNode:[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2"}],["circle",{cx:"12",cy:"12",r:"2"}],["path",{d:"M6 12h.01M18 12h.01"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function wz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"camera"},()=>t,{iconNode:[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z"}],["circle",{cx:"12",cy:"13",r:"3"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function kz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"clock"},()=>t,{iconNode:[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Sz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"code-xml"},()=>t,{iconNode:[["path",{d:"m18 16 4-4-4-4"}],["path",{d:"m6 8-4 4 4 4"}],["path",{d:"m14.5 4-5 16"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Cz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"download"},()=>t,{iconNode:[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Iz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"flask-conical"},()=>t,{iconNode:[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2"}],["path",{d:"M6.453 15h11.094"}],["path",{d:"M8.5 2h7"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Pz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"gauge"},()=>t,{iconNode:[["path",{d:"m12 14 4-4"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Mz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"log-out"},()=>t,{iconNode:[["path",{d:"m16 17 5-5-5-5"}],["path",{d:"M21 12H9"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Nz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"maximize"},()=>t,{iconNode:[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Az(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"minimize"},()=>t,{iconNode:[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Tz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"moon"},()=>t,{iconNode:[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Fz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"pause"},()=>t,{iconNode:[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Lz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"play"},()=>t,{iconNode:[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Ez(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"save"},()=>t,{iconNode:[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function $z(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"search"},()=>t,{iconNode:[["path",{d:"m21 21-4.34-4.34"}],["circle",{cx:"11",cy:"11",r:"8"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Dz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"settings"},()=>t,{iconNode:[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Rz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"sun"},()=>t,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function jz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"trending-up"},()=>t,{iconNode:[["path",{d:"M16 7h6v6"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}function Bz(n,e){const t=_m(e,["children","$$slots","$$events","$$legacy"]);dh(n,ch({name:"wallet"},()=>t,{iconNode:[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"}]],children:(o,r)=>{var a=Qn(),l=fn(a);Dm(l,e,"default",{}),q(o,a)},$$slots:{default:!0}}))}const w8=["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHF","CLP","CNY","COP","CRC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRU","MUR","MVR","MWK","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","SSP","STN","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VES","VND","VUV","WST","XAF","XCD","XOF","XPF","YER","ZAR","ZMW","ZWL"],k8="smartchart.alerts.v1",R_={rules:{},logs:[],delivery:{},options:{backfill:!1,maxLogs:500},lastFired:{},firedOnce:{}},Oz=()=>{if(typeof window>"u"||!window.localStorage)return{...R_};try{const n=localStorage.getItem(k8);if(!n)return{...R_};const e=JSON.parse(n);return{...R_,...e,options:{...R_.options,...e.options||{}},delivery:{...R_.delivery,...e.delivery||{}},rules:e.rules||{},logs:Array.isArray(e.logs)?e.logs:[],lastFired:e.lastFired||{},firedOnce:e.firedOnce||{}}}catch(n){return console.warn("Failed to load alerts state:",n),{...R_}}},zz=n=>{if(!(typeof window>"u"||!window.localStorage))try{localStorage.setItem(k8,JSON.stringify(n))}catch(e){console.warn("Failed to persist alerts state:",e)}},Qv=$m(Oz());Qv.subscribe(n=>zz(n));const hy=$m(!1),C2=n=>({id:n,enabled:!0,frequency:"once_per_bar",channels:{app:!0,webhook:!1,email:!1,push:!1}}),Vz=n=>{Qv.update(e=>{const t={...e.rules};for(const s of n){const o=t[s.id];t[s.id]={...o||C2(s.id),...s,channels:{...(o==null?void 0:o.channels)||C2(s.id).channels,...s.channels||{}},enabled:s.enabled??(o==null?void 0:o.enabled)??!0,frequency:s.frequency||(o==null?void 0:o.frequency)||"once_per_bar"}}return e.rules=t,e})},B2=(n,e)=>{Qv.update(t=>{const s=t.rules[n]||C2(n);return t.rules={...t.rules,[n]:{...s,...e,channels:{...s.channels,...e.channels||{}}}},t})},xy=n=>{Qv.update(e=>(e.delivery={...e.delivery,...n},e))},S8=n=>{Qv.update(e=>(e.options={...e.options,...n},e))},xx=()=>{Qv.update(n=>(n.logs=[],n.lastFired={},n.firedOnce={},n))},Wz=()=>{Qv.update(n=>(n.lastFired={},n.firedOnce={},n))},Hz=(n,e,t,s)=>{if(!e.enabled||!n.options.backfill&&t<s)return!1;if(e.frequency==="once")return!n.firedOnce[e.id];const o=n.lastFired[e.id];return!(o&&o.index===t)},qz=(n,e,t,s)=>{n.lastFired[e.id]={index:t,timestamp:s},e.frequency==="once"&&(n.firedOnce[e.id]=!0)},Uz=(n,e,t)=>`${n}_${t}_${e}_${Math.random().toString(36).slice(2,8)}`,C8=n=>{Qv.update(e=>{const t=[...n,...e.logs],s=e.options.maxLogs;return e.logs=s>0?t.slice(0,s):t,e})},Gz=async n=>{const e=vm(Qv),{events:t,context:s}=n;if(!t.length)return[];const o=[];for(const r of t){const a=String(r.signalId||r.title||r.message||"alert"),l=e.rules[a]||C2(a),c={...l,id:a,title:l.title??r.title,message:l.message??r.message,frequency:r.frequency||l.frequency};if(!Hz(e,c,r.index,s.latestIndex))continue;qz(e,c,r.index,r.timestamp);const f=[];Object.keys(c.channels).forEach(u=>{const d=c.channels[u];f.push({channel:u,status:d?"pending":"skipped"})}),o.push({id:Uz(a,r.timestamp,r.index),ruleId:a,timestamp:r.timestamp,barIndex:r.index,symbol:s.symbol,timeframe:s.timeframe,title:c.title,message:c.message,price:s.price,deliveries:f})}return o.length?(Qv.set(e),C8(o),o):(Qv.set(e),[])},I8=async n=>{var s;const e=vm(Qv),t=Object.keys(((s=e.rules[n.ruleId])==null?void 0:s.channels)||{}).filter(o=>{var r,a;return(a=(r=e.rules[n.ruleId])==null?void 0:r.channels)==null?void 0:a[o]});if(!t.length)return[];try{const o=await fetch("/api/alerts/deliver",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:n,delivery:e.delivery,channels:t})});if(!o.ok)return t.map(a=>({channel:a,status:"failed",detail:`HTTP ${o.status}`}));const r=await o.json();return Array.isArray(r==null?void 0:r.deliveries)?r.deliveries:[]}catch(o){return t.map(r=>({channel:r,status:"failed",detail:(o==null?void 0:o.message)||"Delivery failed"}))}},P8=(n,e)=>{Qv.update(t=>(t.logs=t.logs.map(s=>s.id!==n?s:{...s,deliveries:e.length?e:s.deliveries}),t))};function Yz(){hy.set(!0)}function Kz(n,e,t,s){h8(i(e)),v8(Math.max(0,Number(i(t))||0)),x(s,2)}function Xz(){var n;try{(n=window.predictNextCandle)==null||n.call(window)}catch{}Yv(!0)}function Zz(n){d6(parseFloat(n.target.value))}function Jz(n,e,t,s,o){var c,f;if(!(typeof window<"u"?window.confirm("Exit simulator?"):!0))return;e();const a=t().positions;for(const u of a){try{u.lineOverlayId&&((c=s())==null||c.removeOverlay({id:u.lineOverlayId}))}catch{}try{u.noteOverlayId&&((f=s())==null||f.removeOverlay({id:u.noteOverlayId}))}catch{}}u6();const l=window.sidebarHostRef;l&&l.closeSidebar&&l.closeSidebar()}function Qz(n,e,t,s,o,r,a,l){x(e,!0),x(t,"instant"),x(s,1),x(o,null),x(r,1),x(a,null),x(l,null)}function eV(n,e,t,s,o,r,a,l,c,f,u,d,h){var F,B;x(e,null);const m=i(t),g=Math.max(0,Number(i(s))||0);if(g<=0||m<=0){x(e,"Invalid quantity");return}if(!o(g,m)){x(e,"Quantity exceeds balance");return}r();const w=x8(),C=a(),P=(F=l())==null?void 0:F.createOverlay({name:"horizontalStraightLine",points:[{value:m}],styles:{line:{style:wt.Dashed,size:1}}}),I=(B=l())==null?void 0:B.createOverlay({name:"note",points:[{timestamp:C,value:m}],extendData:{in_text:"BUY",in_color:"#10b981",line_color:"#10b981"}}),A=Array.isArray(P)?P[0]??void 0:P??void 0,M=Array.isArray(I)?I[0]??void 0:I??void 0;b8({id:w,symbol:f().symbol,quantity:g,avgCost:m,leverage:d().leverage,openedAt:Date.now(),lineOverlayId:A,noteOverlayId:M}),x(h,!1)}function tV(n,e,t,s,o,r,a,l,c,f,u,d,h){var F,B;x(e,null);const m=Math.max(0,Number(i(t))||0),g=Math.max(0,Number(i(s))||0);if(g<=0||m<=0){x(e,"Quantity exceeds balance or invalid price");return}if(!o(g,m)){x(e,"Quantity exceeds balance or invalid price");return}const w=x8(),C=m>=i(r),P=(F=a())==null?void 0:F.createOverlay({name:"horizontalStraightLine",points:[{value:m}],styles:{line:{style:wt.Dashed,size:1}}}),I=(B=a())==null?void 0:B.createOverlay({name:"note",points:[{timestamp:c(),value:m}],extendData:{in_text:"PENDING",in_color:"#f59e0b",line_color:"#f59e0b"}}),A=Array.isArray(P)?P[0]??void 0:P??void 0,M=Array.isArray(I)?I[0]??void 0:I??void 0;dz({id:w,symbol:f().symbol,quantity:g,price:m,leverage:d().leverage,createdAt:Date.now(),triggerUp:C,lineOverlayId:A,noteOverlayId:M}),x(h,!1)}var nV=ke("<option> </option>"),sV=ke('<div class="grid grid-cols-1 sm:grid-cols-3 gap-2 items-end w-full"><div class="flex flex-col gap-1"><div class="text-xs opacity-80">Currency</div> <select class="select select-bordered select-sm"></select></div> <input class="input input-bordered input-sm" type="number" min="0" placeholder="Deposit"> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Confirm Deposit</button></div>'),oV=(n,e)=>x(e,!0),iV=(n,e)=>x(e,!1),rV=ke('<div class="flex items-center gap-2 w-full"><select class="select select-bordered select-sm"><option>1:50</option><option>1:100</option><option>1:200</option><option>1:400</option><option>1:500</option></select> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Confirm</button></div>'),aV=(n,e,t)=>{x(e,null),t()},lV=ke('<button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Confirm</button>'),cV=ke('<div class="space-y-2 w-full"><div class="text-sm">Take leverage?</div> <div class="flex items-center gap-2 w-full"><label class="label cursor-pointer"><input type="radio" name="lev" class="radio radio-sm"> <span class="label-text ml-2">Yes</span></label> <label class="label cursor-pointer"><input type="radio" name="lev" class="radio radio-sm"> <span class="label-text ml-2">No</span></label></div> <!></div>'),uV=ke('<span class="text-success"> </span>'),dV=ke('<span class="text-error"> </span>'),fV=ke("<span>No trades</span>"),pV=ke('<button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button"><!></button>'),mV=ke('<button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button"><!></button>'),hV=(n,e)=>d6(e),vV=ke('<button type="button"> </button>'),gV=(n,e)=>x(e,"portfolio"),_V=(n,e)=>x(e,"history"),yV=(n,e,t)=>e(i(t)),bV=ke('<div class="flex items-center justify-between text-sm mt-2 gap-2"><div class="flex items-center gap-2 min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div></div> <div class="flex items-center gap-2"><button class="btn btn-sm btn-premium-ghost svelte-112gz12" type="button">Cancel</button></div></div>'),xV=ke('<div class="card lux-card shadow w-full mb-3 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="text-sm font-semibold">Pending Orders</div> <!></div></div>'),wV=(n,e,t)=>{x(e,""),x(t,0)},kV=ke('<button class="btn btn-xs btn-premium-ghost svelte-112gz12" type="button">Cancel</button>'),SV=(n,e,t)=>e(i(t).id),CV=ke('<button class="btn btn-xs btn-premium-outline svelte-112gz12" type="button">Sell</button>'),IV=(n,e)=>e(!0),PV=(n,e)=>e(!1),MV=ke('<div class="sell-panel w-full mt-2 space-y-3 svelte-112gz12"><div class="sell-section svelte-112gz12"><div class="flex items-center justify-between"><div class="text-xs opacity-70"> </div> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Close All</button></div></div> <div class="sell-section svelte-112gz12"><div class="text-xs opacity-70 mb-2">Close partial position</div> <div class="flex items-center gap-2"><input class="input input-bordered input-sm flex-1" type="number" min="0" placeholder="Partial qty"> <button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Confirm Partial</button></div> <div class="mt-2 text-xs opacity-70 flex items-center justify-between"><span> </span> <span> </span></div></div></div>'),NV=ke('<div class="card lux-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="flex items-center justify-between"><div class="flex items-center gap-2 text-sm min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div></div> <div class="flex items-center gap-2"><div> </div> <!></div></div> <!></div></div>'),AV=ke("<!> <!>",1),TV=ke('<div class="card trade-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 text-sm min-w-0"><div class="flex items-center justify-between"><div class="flex items-center gap-2 min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div></div> <div> </div></div> <div class="mt-1 truncate"> </div></div></div>'),FV=ke('<div class="card history-summary-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="grid grid-cols-3 gap-2 items-stretch"><div class="summary-tile win svelte-112gz12"><div class="summary-title svelte-112gz12">Winning</div> <div class="summary-values svelte-112gz12"><div class="badge badge-success text-[10px]"> </div> <div class="summary-amount svelte-112gz12"> </div></div></div> <div class="summary-tile loss svelte-112gz12"><div class="summary-title svelte-112gz12">Losing</div> <div class="summary-values svelte-112gz12"><div class="badge badge-error text-[10px]"> </div> <div class="summary-amount svelte-112gz12"> </div></div></div> <div><div class="summary-title svelte-112gz12">Net</div> <div class="summary-values svelte-112gz12"><div class="summary-amount svelte-112gz12"> </div></div></div></div></div></div> <!>',1),LV=ke('<div class="exit-bar svelte-112gz12"><div class="exit-copy svelte-112gz12">Practice live trading. Check your predictions and improve.</div> <button class="btn btn-sm btn-premium-danger exit-cta svelte-112gz12" type="button"><!> Exit</button></div> <div class="mini-stack grid grid-cols-1 gap-2 w-full svelte-112gz12"><div class="card glass lux-card shadow overflow-hidden mini-tile deposit-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Deposit</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"> </div></div></div></div></div> <div class="card glass lux-card shadow overflow-hidden mini-tile investment-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Investment <span class="badge badge-outline text-[9px] ml-1"> </span></div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"><!></div></div></div></div></div> <div class="card glass lux-card shadow overflow-hidden mini-tile available-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Available</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"> </div></div></div></div></div></div> <div class="card speed-card w-full svelte-112gz12"><div class="card-body p-4"><div class="speed-header flex items-center justify-between svelte-112gz12"><div class="flex items-center gap-2"><div class="speed-icon svelte-112gz12"><!></div> <div class="speed-title svelte-112gz12">Playback Speed</div></div> <div class="speed-badge svelte-112gz12"> </div></div> <div class="mt-3 flex items-center gap-3"><input type="range" min="0.5" max="10" step="0.5" class="speed-range flex-1 svelte-112gz12"> <!></div> <div class="mt-2 speed-chips svelte-112gz12"></div></div></div> <div class="card trade-action-card w-full overflow-hidden svelte-112gz12"><div class="card-body p-4 min-w-0"><div class="flex items-center justify-between"><div><div class="text-xs opacity-70">Current Price</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div></div> <div class="badge badge-success badge-outline">LIVE</div></div> <div class="mt-3"><button class="btn btn-premium-primary w-full svelte-112gz12" type="button">Buy Stock</button></div></div></div> <div class="card lux-card shadow w-full svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="flex items-center justify-between"><div><div class="text-xs opacity-70">Alerts</div> <div class="text-sm font-semibold">Script Alerts Center</div></div> <button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Open</button></div></div></div> <div class="tabs tabs-boxed w-full mt-3 gap-3 svelte-112gz12"><button type="button">Portfolio</button> <button type="button">History</button></div> <!>',1),EV=(n,e)=>x(e,"instant"),$V=(n,e)=>x(e,"pending"),DV=ke('<div class="text-error text-xs mt-1"> </div>'),RV=ke('<div class="space-y-2"><div class="card buy-card svelte-112gz12"><div class="card-body p-3"><div class="flex items-center justify-between"><div class="text-xs opacity-70">Current Price</div> <div class="metric-value font-bold truncate whitespace-nowrap svelte-112gz12"> </div></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 items-end mt-2"><input class="input input-bordered input-sm" type="number" min="0" placeholder="Quantity"> <button class="btn btn-sm btn-premium-primary w-full svelte-112gz12" type="button">Confirm Buy</button></div> <!></div></div></div>'),jV=ke('<div class="text-error text-xs"> </div>'),BV=ke('<div class="space-y-2"><div class="grid grid-cols-2 gap-2 items-end"><input class="input input-bordered input-sm" type="number" min="0" placeholder="Custom Price"> <input class="input input-bordered input-sm" type="number" min="0" placeholder="Quantity"></div> <button class="btn btn-sm btn-premium-primary w-full svelte-112gz12" type="button">Place Pending Buy</button> <!></div>'),OV=ke('<div class="space-y-3"><div class="flex items-center gap-2"><div class="badge badge-outline">Mode</div> <label class="label cursor-pointer"><input type="radio" name="buyMode" class="radio radio-sm"> <span class="label-text ml-2">Instant</span></label> <label class="label cursor-pointer"><input type="radio" name="buyMode" class="radio radio-sm"> <span class="label-text ml-2">Pending</span></label></div> <!></div>'),zV=ke('<div class="p-4 space-y-4 w-full box-border"><!></div> <!>',1);function VV(n,e){Ed(e,!0);const t=sm(),s=()=>wl(uh,"$simulator",t),o=()=>wl(l,"$save",t),r=()=>wl(a,"$chart",t),a=gd("chart"),l=gd("save");let c=ge(V(s().depositAmount)),f=ge(V(s().currency||o().symbol.priceCurrency||"USD")),u=ge(!1),d=ge(null),h=ge(V(s().onboardingDone?3:1)),m=ge(0),g=null,w=ge(0),C=ge(""),P=ge("portfolio"),I=ge(!1),A=ge("instant"),M=ge(null),F=ge(1),B=ge(1),$=ge(null),L=ge(null);const O=Bt(()=>(s().positions||[]).length>0),Y=Bt(()=>(s().positions||[]).reduce((Ze,Xe)=>Ze+(i(m)-Xe.avgCost)*Xe.quantity*(Xe.leverage||1),0)),ce=Bt(()=>s().history||[]),Q=Bt(()=>i(ce).filter(Ze=>Number(Ze.pnl)>0).length),le=Bt(()=>i(ce).filter(Ze=>Number(Ze.pnl)<0).length),ue=Bt(()=>i(ce).reduce((Ze,Xe)=>{const Ae=Number(Xe.pnl);return Ze+(Number.isFinite(Ae)&&Ae>0?Ae:0)},0)),fe=Bt(()=>i(ce).reduce((Ze,Xe)=>{const Ae=Number(Xe.pnl);return Ze+(Number.isFinite(Ae)&&Ae<0?Math.abs(Ae):0)},0)),pe=Bt(()=>i(ce).reduce((Ze,Xe)=>{const Ae=Number(Xe.pnl);return Ze+(Number.isFinite(Ae)?Ae:0)},0)),Z=Bt(()=>i(pe)+i(Y)),xe=Bt(()=>((s().speed||.5)-.5)/9.5*100);function oe(){var Xe;const Ze=((Xe=r())==null?void 0:Xe.getDataList())||[];return Ze.length===0?0:Ze[Ze.length-1].close}function Pe(){var Xe;const Ze=((Xe=r())==null?void 0:Xe.getDataList())||[];return Ze.length===0?Date.now():Ze[Ze.length-1].timestamp}function $e(){g8(i(u)?i(d)||100:null),x(h,3),_8(!0)}function ze(){var Ze;try{(Ze=window.stopPrediction)==null||Ze.call(window)}catch{}Yv(!1)}function Ke(){g||(g=setInterval(()=>{var ot,ve,Ie,It,Dt;const Ze=((ot=r())==null?void 0:ot.getDataList())||[],Xe=Ze.length>0?Ze[Ze.length-1]:null,Ae=Xe?Xe.close??0:0,Qe=Xe?Xe.high??Ae:Ae,gt=Xe?Xe.low??Ae:Ae;x(m,V(Ae));const Ft=[...s().pendingOrders||[]];for(const Zt of Ft)if(Zt.triggerUp?Qe>=Zt.price:gt<=Zt.price){const hn=s().leverage||1;if(Zt.price*Zt.quantity/hn<=s().balance){if(Zt.lineOverlayId)try{(ve=r())==null||ve.removeOverlay({id:Zt.lineOverlayId})}catch{}if(Zt.noteOverlayId)try{(Ie=r())==null||Ie.removeOverlay({id:Zt.noteOverlayId})}catch{}bx(Zt.id);const On=Pe(),bn=(It=r())==null?void 0:It.createOverlay({name:"horizontalStraightLine",points:[{value:Zt.price}],styles:{line:{style:wt.Dashed,size:1}}}),Fn=(Dt=r())==null?void 0:Dt.createOverlay({name:"note",points:[{timestamp:On,value:Zt.price}],extendData:{in_text:"BUY",in_color:"#10b981",line_color:"#10b981"}}),Xs=Array.isArray(bn)?bn[0]??void 0:bn??void 0,oo=Array.isArray(Fn)?Fn[0]??void 0:Fn??void 0;b8({id:Zt.id,symbol:Zt.symbol,quantity:Zt.quantity,avgCost:Zt.price,leverage:Zt.leverage,openedAt:Date.now(),lineOverlayId:Xs,noteOverlayId:oo})}else bx(Zt.id)}},300))}function qe(){g&&(clearInterval(g),g=null)}Th(()=>{x(m,V(oe()))}),Fr(()=>{s().playing?Ke():qe()});function nt(Ze,Xe){const Ae=s().leverage||1;return Xe*Ze/Ae<=s().balance}function ft(Ze){var Xe,Ae;try{Ze.lineOverlayId&&((Xe=r())==null||Xe.removeOverlay({id:Ze.lineOverlayId}))}catch{}try{Ze.noteOverlayId&&((Ae=r())==null||Ae.removeOverlay({id:Ze.noteOverlayId}))}catch{}bx(Ze.id)}function ut(Ze){x(C,V(Ze)),x(w,0),x(P,"portfolio")}function bt(Ze){var gt,Ft;const Xe=s().positions.find(ot=>ot.id===i(C));if(!Xe)return;const Ae=oe(),Qe=Ze?Xe.quantity:Math.min(Xe.quantity,Math.max(0,Number(i(w))||0));if(!(Qe<=0)){if(uz(Xe.id,Qe,Ae),Qe===Xe.quantity){try{Xe.lineOverlayId&&((gt=r())==null||gt.removeOverlay({id:Xe.lineOverlayId}))}catch{}try{Xe.noteOverlayId&&((Ft=r())==null||Ft.removeOverlay({id:Xe.noteOverlayId}))}catch{}}x(C,""),x(w,0)}}function Pt(Ze){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:s().currency||"USD",maximumFractionDigits:2}).format(Ze)}catch{return`${Ze.toFixed(2)} ${s().currency||""}`}}var Et=zV(),Mt=fn(Et),Je=y(Mt);Ue(Je,()=>i(h)===1,Ze=>{var Xe=sV(),Ae=y(Xe),Qe=v(y(Ae),2);Yo(Qe,21,()=>w8,Ii,(ot,ve)=>{var Ie=nV(),It={},Dt=y(Ie,!0);_(Ie),Ce(()=>{It!==(It=i(ve))&&(Ie.value=(Ie.__value=i(ve))==null?"":i(ve)),tt(Dt,i(ve))}),q(ot,Ie)}),_(Qe),_(Ae);var gt=v(Ae,2);xn(gt);var Ft=v(gt,2);Ft.__click=[Kz,f,c,h],_(Xe),xo(Qe,()=>i(f),ot=>x(f,ot)),Bs(gt,()=>i(c),ot=>x(c,ot)),q(Ze,Xe)},Ze=>{var Xe=Qn(),Ae=fn(Xe);Ue(Ae,()=>i(h)===2,Qe=>{var gt=cV(),Ft=v(y(gt),2),ot=y(Ft),ve=y(ot);xn(ve),ve.__click=[oV,u],Zi(2),_(ot);var Ie=v(ot,2),It=y(Ie);xn(It),It.__click=[iV,u],Zi(2),_(Ie),_(Ft);var Dt=v(Ft,2);Ue(Dt,()=>i(u),Zt=>{var gn=rV(),hn=y(gn),qn=y(hn);qn.value=(qn.__value=50)==null?"":50;var On=v(qn);On.value=(On.__value=100)==null?"":100;var bn=v(On);bn.value=(bn.__value=200)==null?"":200;var Fn=v(bn);Fn.value=(Fn.__value=400)==null?"":400;var Xs=v(Fn);Xs.value=(Xs.__value=500)==null?"":500,_(hn);var oo=v(hn,2);oo.__click=$e,_(gn),xo(hn,()=>i(d),Yn=>x(d,Yn)),q(Zt,gn)},Zt=>{var gn=lV();gn.__click=[aV,d,$e],q(Zt,gn)}),_(gt),Ce(()=>{Mv(ve,i(u)),Mv(It,!i(u))}),q(Qe,gt)},Qe=>{var gt=LV(),Ft=fn(gt),ot=v(y(Ft),2);ot.__click=[Jz,ze,s,r,a];var ve=y(ot);Mz(ve,{size:16}),Zi(),_(ot),_(Ft);var Ie=v(Ft,2),It=y(Ie),Dt=y(It),Zt=y(Dt),gn=y(Zt),hn=y(gn),qn=y(hn);Bz(qn,{size:14}),_(hn),_(gn);var On=v(gn,2),bn=v(y(On),2);Ce(()=>Ot(bn,"title",Pt(s().depositAmount)));var Fn=y(bn,!0);Ce(()=>tt(Fn,Pt(s().depositAmount))),_(bn);var Xs=v(bn,2),oo=y(Xs);Ce(()=>tt(oo,`${Pt(s().depositAmount)??""} • ${s().currency??""}`)),_(Xs),_(On),_(Zt),_(Dt),_(It);var Yn=v(It,2),_o=y(Yn),xs=y(_o),Rt=y(xs),un=y(Rt),qs=y(un);jz(qs,{size:14}),_(un),_(Rt);var ri=v(Rt,2),Eo=y(ri),Ia=v(y(Eo)),Lr=y(Ia);_(Ia),_(Eo);var Qa=v(Eo,2);Ce(()=>Ot(Qa,"title",Pt((s().positions||[]).reduce((Oi,si)=>Oi+si.avgCost*si.quantity,0))));var yr=y(Qa,!0);Ce(()=>tt(yr,Pt((s().positions||[]).reduce((Oi,si)=>Oi+si.avgCost*si.quantity,0)))),_(Qa);var Fi=v(Qa,2),Rc=y(Fi);Ue(Rc,()=>(s().positions||[]).length>0,Oi=>{var si=Qn(),Wo=fn(si);Ue(Wo,()=>(s().positions||[]).reduce((Ua,Hi)=>Ua+(i(m)-Hi.avgCost)*Hi.quantity*(Hi.leverage||1),0)>=0,Ua=>{var Hi=uV(),to=y(Hi);Ce(()=>tt(to,`+${Pt((s().positions||[]).reduce((Li,Vr)=>Li+(i(m)-Vr.avgCost)*Vr.quantity*(Vr.leverage||1),0))??""}`)),_(Hi),q(Ua,Hi)},Ua=>{var Hi=dV(),to=y(Hi);Ce(()=>tt(to,`-${Pt(Math.abs((s().positions||[]).reduce((Li,Vr)=>Li+(i(m)-Vr.avgCost)*Vr.quantity*(Vr.leverage||1),0)))??""}`)),_(Hi),q(Ua,Hi)}),q(Oi,si)},Oi=>{var si=fV();q(Oi,si)}),_(Fi),_(ri),_(xs),_(_o),_(Yn);var Cu=v(Yn,2),uc=y(Cu),Fl=y(uc),jc=y(Fl),nd=y(jc),Fa=y(nd);xz(Fa,{size:14}),_(nd),_(jc);var dc=v(jc,2),Bc=v(y(dc),2);Ce(()=>Ot(Bc,"title",Pt(s().balance*(s().leverage||1))));var rd=y(Bc,!0);Ce(()=>tt(rd,Pt(s().balance*(s().leverage||1)))),_(Bc);var uf=v(Bc,2),So=y(uf);_(uf),_(dc),_(Fl),_(uc),_(Cu),_(Ie);var Ll=v(Ie,2),ya=y(Ll),hc=y(ya),Pa=y(hc),Yr=y(Pa),el=y(Yr);Pz(el,{size:16}),_(Yr),Zi(2),_(Pa);var Yl=v(Pa,2),Vu=y(Yl);_(Yl),_(hc);var Iu=v(hc,2),Ro=y(Iu);xn(Ro),Ro.__input=[Zz];var zr=v(Ro,2);Ue(zr,()=>s().playing,Oi=>{var si=pV();si.__click=ze;var Wo=y(si);Fz(Wo,{size:16}),_(si),q(Oi,si)},Oi=>{var si=mV();si.__click=[Xz];var Wo=y(si);Lz(Wo,{size:16}),_(si),q(Oi,si)}),_(Iu);var kl=v(Iu,2);Yo(kl,20,()=>[.5,1,2,5,10],Ii,(Oi,si)=>{var Wo=vV();Wo.__click=[hV,si];var Ua=y(Wo);_(Wo),Ce(()=>{pi(Wo,`speed-chip ${(s().speed===si?"active":"")??""} svelte-112gz12`),tt(Ua,`${si??""}x`)}),q(Oi,Wo)}),_(kl),_(ya),_(Ll);var Md=v(Ll,2),nf=y(Md),zf=y(nf),df=y(zf),Pu=v(y(df),2);Ce(()=>Ot(Pu,"title",i(m).toFixed(2)));var Dd=y(Pu,!0);Ce(()=>tt(Dd,i(m).toFixed(2))),_(Pu),_(df),Zi(2),_(zf);var yf=v(zf,2),$n=y(yf);$n.__click=[Qz,I,A,F,M,B,$,L],_(yf),_(nf),_(Md);var ws=v(Md,2),Us=y(ws),Dn=y(Us),ni=v(y(Dn),2);ni.__click=[Yz],_(Dn),_(Us),_(ws);var mo=v(ws,2),sr=y(mo);sr.__click=[gV,P];var or=v(sr,2);or.__click=[_V,P],_(mo);var hl=v(mo,2);Ue(hl,()=>i(P)==="portfolio",Oi=>{var si=AV(),Wo=fn(si);Ue(Wo,()=>(s().pendingOrders||[]).length>0,Hi=>{var to=xV(),Li=y(to),Vr=v(y(Li),2);Yo(Vr,1,()=>s().pendingOrders,Ii,(ba,qi)=>{var Wr=bV(),Kl=y(Wr),Wl=y(Kl),Ic=y(Wl,!0);_(Wl);var Pc=v(Wl,2),cl=y(Pc);_(Pc);var mr=v(Pc,2),La=y(mr);Ce(()=>tt(La,`Price ${i(qi).price.toFixed(2)??""}`)),_(mr),_(Kl);var Sl=v(Kl,2),Ba=y(Sl);Ba.__click=[yV,ft,qi],_(Sl),_(Wr),Ce(()=>{tt(Ic,i(qi).symbol.ticker),tt(cl,`Qty ${i(qi).quantity??""}`)}),q(ba,Wr)}),_(Li),_(to),q(Hi,to)});var Ua=v(Wo,2);Yo(Ua,1,()=>s().positions,Ii,(Hi,to)=>{var Li=NV(),Vr=y(Li),ba=y(Vr),qi=y(ba),Wr=y(qi),Kl=y(Wr,!0);_(Wr);var Wl=v(Wr,2),Ic=y(Wl);_(Wl);var Pc=v(Wl,2),cl=y(Pc);Ce(()=>tt(cl,`Avg ${i(to).avgCost.toFixed(2)??""}`)),_(Pc);var mr=v(Pc,2),La=y(mr);_(mr),_(qi);var Sl=v(qi,2),Ba=y(Sl),vi=y(Ba);Ce(()=>tt(vi,`${((i(m)-i(to).avgCost)*i(to).quantity*(i(to).leverage||1)>=0?"+":"")??""}${((i(m)-i(to).avgCost)*i(to).quantity*(i(to).leverage||1)).toFixed(2)??""}`)),_(Ba);var vc=v(Ba,2);Ue(vc,()=>i(C)===i(to).id,Ga=>{var vl=kV();vl.__click=[wV,C,w],q(Ga,vl)},Ga=>{var vl=CV();vl.__click=[SV,ut,to],q(Ga,vl)}),_(Sl),_(ba);var ul=v(ba,2);Ue(ul,()=>i(C)===i(to).id,Ga=>{var vl=MV(),pu=y(vl),tl=y(pu),Oa=y(tl),Oc=y(Oa);_(Oa);var Gu=v(Oa,2);Gu.__click=[IV,bt],_(tl),_(pu);var El=v(pu,2),mu=v(y(El),2),bc=y(mu);xn(bc);var nl=v(bc,2);nl.__click=[PV,bt],Ce(()=>nl.disabled=!i(w)||Number(i(w))<=0||Number(i(w))>i(to).quantity),_(mu);var la=v(mu,2),Mu=y(la),Yu=y(Mu);_(Mu);var zc=v(Mu,2),Zd=y(zc);Ce(()=>tt(Zd,`Est. PnL: ${((i(m)-i(to).avgCost)*(Number(i(w))||0)*(i(to).leverage||1)).toFixed(2)??""}`)),_(zc),_(la),_(El),_(vl),Ce(()=>{tt(Oc,`Close entire position (${i(to).quantity??""})`),Ot(bc,"max",i(to).quantity),tt(Yu,`Available: ${i(to).quantity??""}`)}),Bs(bc,()=>i(w),Yf=>x(w,Yf)),q(Ga,vl)}),_(Vr),_(Li),Ce(()=>{tt(Kl,i(to).symbol.ticker),tt(Ic,`Qty ${i(to).quantity??""}`),tt(La,`Lev ${(i(to).leverage||1)??""}x`),pi(Ba,`badge ${((i(m)-i(to).avgCost)*i(to).quantity*(i(to).leverage||1)>=0?"badge-success":"badge-error")??""}`)}),q(Hi,Li)}),q(Oi,si)},Oi=>{var si=FV(),Wo=fn(si),Ua=y(Wo),Hi=y(Ua),to=y(Hi),Li=v(y(to),2),Vr=y(Li),ba=y(Vr,!0);_(Vr);var qi=v(Vr,2);Ce(()=>Ot(qi,"title",Pt(i(ue))));var Wr=y(qi,!0);Ce(()=>tt(Wr,Pt(i(ue)))),_(qi),_(Li),_(to);var Kl=v(to,2),Wl=v(y(Kl),2),Ic=y(Wl),Pc=y(Ic,!0);_(Ic);var cl=v(Ic,2);Ce(()=>Ot(cl,"title",Pt(i(fe))));var mr=y(cl,!0);Ce(()=>tt(mr,Pt(i(fe)))),_(cl),_(Wl),_(Kl);var La=v(Kl,2),Sl=v(y(La),2),Ba=y(Sl);Ce(()=>Ot(Ba,"title",Pt(i(Z))));var vi=y(Ba);Ce(()=>tt(vi,`${(i(Z)>=0?"+":"")??""}${Pt(i(Z))??""}`)),_(Ba),_(Sl),_(La),_(Hi),_(Ua),_(Wo);var vc=v(Wo,2);Yo(vc,1,()=>s().history,Ii,(ul,Ga)=>{var vl=TV(),pu=y(vl),tl=y(pu),Oa=y(tl),Oc=y(Oa),Gu=y(Oc,!0);_(Oc);var El=v(Oc,2),mu=y(El);_(El),_(Oa);var bc=v(Oa,2),nl=y(bc);Ce(()=>tt(nl,`${(i(Ga).pnl>=0?"+":"")??""}${i(Ga).pnl.toFixed(2)??""}`)),_(bc),_(tl);var la=v(tl,2);const Mu=Bt(()=>i(Ga).avgCost.toFixed(2)??""),Yu=Bt(()=>i(Ga).closedAvg.toFixed(2)??"");var zc=y(la);Ce(()=>tt(zc,`Buy ${i(Mu)} • Sell ${i(Yu)}`)),_(la),_(pu),_(vl),Ce(()=>{tt(Gu,i(Ga).symbol.ticker),tt(mu,`Qty ${i(Ga).quantity??""}`),pi(bc,`badge ${(i(Ga).pnl>=0?"badge-success":"badge-error")??""}`)}),q(ul,vl)}),Ce(()=>{tt(ba,i(Q)),tt(Pc,i(le)),pi(La,`summary-tile net ${(i(Z)>=0?"pos":"neg")??""} svelte-112gz12`)}),q(Oi,si)}),Ce(()=>{wr(Yn,"pos",i(O)&&i(Y)>=0),wr(Yn,"neg",i(O)&&i(Y)<0),tt(Lr,`Open ${(s().positions||[]).length??""}`),tt(So,`Leverage ${(s().leverage||1)??""}x`),tt(Vu,`${s().speed??""}x`),Gf(Ro,s().speed),Ot(Ro,"style",`background: linear-gradient(to right, var(--menu-active-bg) ${i(xe)}%, var(--menu-btn-bg) ${i(xe)}%);`),pi(sr,`tab ${(i(P)==="portfolio"?"tab-active":"")??""} svelte-112gz12`),pi(or,`tab ${(i(P)==="history"?"tab-active":"")??""} svelte-112gz12`)}),q(Qe,gt)},!0),q(Ze,Xe)}),_(Mt);var Ct=v(Mt,2);Ue(Ct,()=>i(I),Ze=>{tg(Ze,{title:"Place Buy Order",buttons:[],get show(){return i(I)},set show(Xe){x(I,V(Xe))},get theme(){return o().theme},children:(Xe,Ae)=>{var Qe=OV(),gt=y(Qe),Ft=v(y(gt),2),ot=y(Ft);xn(ot),ot.__click=[EV,A],Zi(2),_(Ft);var ve=v(Ft,2),Ie=y(ve);xn(Ie),Ie.__click=[$V,A],Zi(2),_(ve),_(gt);var It=v(gt,2);Ue(It,()=>i(A)==="instant",Dt=>{var Zt=RV(),gn=y(Zt),hn=y(gn),qn=y(hn),On=v(y(qn),2);Ce(()=>Ot(On,"title",i(m).toFixed(2)));var bn=y(On,!0);Ce(()=>tt(bn,i(m).toFixed(2))),_(On),_(qn);var Fn=v(qn,2),Xs=y(Fn);xn(Xs);var oo=v(Xs,2);oo.__click=[eV,$,m,F,nt,ze,Pe,r,a,o,l,s,I],_(Fn);var Yn=v(Fn,2);Ue(Yn,()=>i($),_o=>{var xs=DV(),Rt=y(xs,!0);_(xs),Ce(()=>tt(Rt,i($))),q(_o,xs)}),_(hn),_(gn),_(Zt),Bs(Xs,()=>i(F),_o=>x(F,_o)),q(Dt,Zt)},Dt=>{var Zt=BV(),gn=y(Zt),hn=y(gn);xn(hn);var qn=v(hn,2);xn(qn),_(gn);var On=v(gn,2);On.__click=[tV,L,M,B,nt,m,r,a,Pe,o,l,s,I];var bn=v(On,2);Ue(bn,()=>i(L),Fn=>{var Xs=jV(),oo=y(Xs,!0);_(Xs),Ce(()=>tt(oo,i(L))),q(Fn,Xs)}),_(Zt),Bs(hn,()=>i(M),Fn=>x(M,Fn)),Bs(qn,()=>i(B),Fn=>x(B,Fn)),q(Dt,Zt)}),_(Qe),Ce(()=>{Mv(ot,i(A)==="instant"),Mv(Ie,i(A)==="pending")}),q(Xe,Qe)},$$slots:{default:!0}})}),q(n,Et),$d()}Ip(["click","input"]);var WV=ke('<div class="top-section svelte-3gnxyq"><div class="section-card svelte-3gnxyq"><button class="sidebar-icon svelte-3gnxyq" title="Watch List"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M8 6H21M8 12H21M8 18H21M3 6H3.01M3 12H3.01M3 18H3.01" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Watch</span></button> <button class="sidebar-icon svelte-3gnxyq" title="Alerts"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M18 8A6 6 0 0 0 6 8C6 15 3 17 3 17H21S18 15 18 8Z" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path><path d="M13.73 21A2 2 0 0 1 10.27 21" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Alerts</span></button> <button class="sidebar-icon ask-ai-btn svelte-3gnxyq" title="Ask AI"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path><path d="M12 12C13.1046 12 14 11.1046 14 10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10C10 11.1046 10.8954 12 12 12Z" fill="currentColor" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Ask AI</span></button></div></div> <div class="bottom-section svelte-3gnxyq"><div class="section-card svelte-3gnxyq"><button class="sidebar-icon svelte-3gnxyq" title="Calendar"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></rect><line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" class="svelte-3gnxyq"></line><line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" class="svelte-3gnxyq"></line><line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></line></svg> <span class="sidebar-label svelte-3gnxyq">Calendar</span></button> <button class="sidebar-icon svelte-3gnxyq" title="Portfolio"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><rect x="2" y="7" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></rect><path d="M16 21V5A2 2 0 0 0 14 3H10A2 2 0 0 0 8 5V21" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Portfolio</span></button></div></div>',1),HV=ke("<div><!></div>");function qV(n,e){Ed(e,!1);const t=sm(),s=()=>wl(a,"$save",t),o=()=>wl(uh,"$simulator",t);let r=hi(e,"className",8,"");const a=gd("save");rv();var l=HV(),c=y(l);Ue(c,()=>o().mode==="strategy",f=>{VV(f,{})},f=>{var u=WV(),d=fn(u),h=y(d),m=v(y(h),2);Zi(2),_(h),_(d),Zi(2),vd("click",m,()=>hy.set(!0)),q(f,u)}),_(l),Ce(()=>{pi(l,`right-sidebar hidden md:flex ${r()??""} svelte-3gnxyq`),Ot(l,"data-theme",s().theme)}),q(n,l),$d()}function UV(n,e){n.preventDefault(),n.stopPropagation(),e("double-click")}var GV=ke('<div role="separator" aria-orientation="vertical" aria-label="Resize sidebar" tabindex="0"><div class="resize-indicator svelte-uwsrre"><div class="resize-dots svelte-uwsrre"><div class="dot svelte-uwsrre"></div> <div class="dot svelte-uwsrre"></div> <div class="dot svelte-uwsrre"></div></div></div></div>');function YV(n,e){Ed(e,!0);let t=hi(e,"className",3,"");const s=Fh();let o=ge(!1),r=0,a=0,l;const c=180,f=480,u=12;function d(A){if(A.button!==0)return;A.preventDefault(),A.stopPropagation(),x(o,!0),r=A.clientX;const M=l.closest(".sidebar-container");M&&(a=M.offsetWidth),l.setPointerCapture(A.pointerId),document.body.style.userSelect="none",document.body.style.pointerEvents="none",l.style.pointerEvents="auto",s("resize:start",{widthPx:a})}function h(A){if(!i(o))return;A.preventDefault(),A.stopPropagation();const M=A.clientX-r,F=Math.max(c,Math.min(f,a-M));requestAnimationFrame(()=>{s("resize:move",{widthPx:F})})}function m(A){if(!i(o))return;A.preventDefault(),A.stopPropagation(),x(o,!1),l.releasePointerCapture(A.pointerId),document.body.style.userSelect="",document.body.style.pointerEvents="",l.style.pointerEvents="";const M=A.clientX-r,F=Math.max(c,Math.min(f,a-M));s("resize:end",{widthPx:F})}function g(A){i(o)&&(x(o,!1),l.releasePointerCapture(A.pointerId),document.body.style.userSelect="",document.body.style.pointerEvents="",l.style.pointerEvents="",s("resize:end",{widthPx:a}))}function w(A){if(!["ArrowLeft","ArrowRight"].includes(A.key))return;A.preventDefault(),A.stopPropagation();const M=l.closest(".sidebar-container");if(!M)return;const F=M.offsetWidth;let B=F;A.key==="ArrowLeft"?B=Math.min(f,F+u):A.key==="ArrowRight"&&(B=Math.max(c,F-u)),B!==F&&(s("resize:start",{widthPx:F}),s("resize:move",{widthPx:B}),s("resize:end",{widthPx:B}))}function C(){}function P(){}var I=GV();I.__pointerdown=d,I.__pointermove=h,I.__pointerup=m,I.__dblclick=[UV,s],I.__keydown=w,tp(I,A=>l=A,()=>l),Ce(()=>{pi(I,`sidebar-resize-handle ${t()??""} svelte-uwsrre`),wr(I,"dragging",i(o))}),vd("pointercancel",I,g),vd("focus",I,C),vd("blur",I,P),q(n,I),$d()}Ip(["pointerdown","pointermove","pointerup","dblclick","keydown"]);const wy=180,O2=480,vy=280;function M8(n,e=wy,t=O2,s=vy){return isNaN(n)||n<e||n>t?s:n}function N8(){return typeof window<"u"&&window.__sidebarBootstrap?window.__sidebarBootstrap:{visible:!1,widthPx:0,transitionsEnabled:!1}}function f6(n){if(typeof window<"u"){window.__sidebarBootstrap||(window.__sidebarBootstrap=N8()),window.__sidebarBootstrap={...window.__sidebarBootstrap,...n};const e=document.documentElement,t=window.__sidebarBootstrap,s=t.visible?t.widthPx+"px":"0px",o=t.visible?"1":"0";e.style.setProperty("--sidebar-width",s),e.style.setProperty("--sidebar-visible",o),e.style.setProperty("--chart-sidebar-width",s),e.style.setProperty("--chart-sidebar-visible",o)}}function KV(n,e){if(typeof window<"u"&&window.localStorage)try{if(localStorage.setItem("dutyai.chart.sidebar.visible","false"),n){const t=M8(e,wy,O2,vy);localStorage.setItem("dutyai.chart.sidebar.widthPx",String(t))}}catch(t){console.warn("Failed to persist sidebar state:",t)}}function XV(){if(typeof window>"u")return!0;const n=window.innerWidth,s=wy+80+300;return n>=s}function d5(){f6({transitionsEnabled:!0})}function ZV(){f6({transitionsEnabled:!1})}function Ab(n,e){const t=e!==void 0?e:n?vy:0;f6({visible:n,widthPx:n?M8(t,wy,O2,vy):0}),KV(n,t)}const JV={MIN_WIDTH:wy,MAX_WIDTH:O2,DEFAULT_WIDTH:vy,PRICE_SCALE_WIDTH:80};class QV{constructor(){Te(this,"pending",!1);Te(this,"callbacks",[]);Te(this,"keyedCallbacks",new Map);Te(this,"rafId",null)}request(e){this.callbacks.push(e),this.schedule()}requestKey(e,t){this.keyedCallbacks.set(e,t),this.schedule()}schedule(){this.pending||(this.pending=!0,this.rafId=requestAnimationFrame(()=>{this.flush()}))}async flush(){this.pending=!1,this.rafId=null;const e=this.callbacks;this.callbacks=[];const t=Array.from(this.keyedCallbacks.values());this.keyedCallbacks.clear();for(const s of e)try{await s()}catch(o){console.error("RenderScheduler: Error executing callback",o)}for(const s of t)try{await s()}catch(o){console.error("RenderScheduler: Error executing callback",o)}}cancel(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pending=!1,this.callbacks=[],this.keyedCallbacks.clear()}isPending(){return this.pending}immediate(e){requestAnimationFrame(async()=>{try{await e()}catch(t){console.error("RenderScheduler: Error executing immediate callback",t)}})}}let wx=null;function z2(){return wx||(wx=new QV),wx}class eW{constructor(){Te(this,"scheduler",z2());Te(this,"inProgress",!1);Te(this,"queue",[])}async run(e){if(this.inProgress){this.queue.push(e);return}this.inProgress=!0;try{await this.executeTransaction(e)}finally{if(this.inProgress=!1,this.queue.length>0){const t=this.queue.shift();this.run(t)}}}async executeTransaction(e){const{reason:t,chart:s,mutateState:o,measure:r,compute:a,draw:l,commit:c,cleanup:f,skipTransitions:u}=e;console.log(`🔄 RenderTransaction [${t}] starting...`);const d=performance.now();this.scheduler.request(async()=>{try{o&&await o(),r&&await r(),a&&await a(),l&&s&&await l(s),c&&await c();const h=performance.now()-d;console.log(`✅ RenderTransaction [${t}] completed in ${h.toFixed(2)}ms`)}catch(h){console.error(`❌ RenderTransaction [${t}] failed:`,h)}finally{f&&f()}})}async batch(e){if(e.length===0)return;const t={reason:e[0].reason,chart:e[0].chart,mutateState:async()=>{for(const s of e)s.mutateState&&await s.mutateState()},measure:async()=>{for(const s of e)s.measure&&await s.measure()},compute:async()=>{for(const s of e)s.compute&&await s.compute()},draw:async s=>{for(const o of e)o.draw&&await o.draw(s)},commit:async()=>{for(const s of e)s.commit&&await s.commit()},cleanup:()=>{for(const s of e)s.cleanup&&s.cleanup()}};await this.run(t)}isInProgress(){return this.inProgress}getQueueLength(){return this.queue.length}}let kx=null;function tW(){return kx||(kx=new eW),kx}class nW{constructor(){Te(this,"states",new Map);Te(this,"transitionProperty","transition")}register(e,t){this.states.set(e,{enabled:!1,element:t})}disable(e){const t=this.states.get(e);t&&(t.enabled=!1,t.element&&this.applyTransitionStyle(t.element,"none"))}enable(e){const t=this.states.get(e);t&&(t.enabled=!0,t.element&&this.applyTransitionStyle(t.element,""))}withoutTransitions(e,t){this.disable(e);const s=t();return requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.enable(e)})}),s}applyLayout(e,t,s=!0){this.disable(e),t(),s&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.enable(e)})})}isEnabled(e){var t;return((t=this.states.get(e))==null?void 0:t.enabled)??!1}updateElement(e,t){const s=this.states.get(e);s?(s.element=t,s.enabled?this.applyTransitionStyle(t,""):this.applyTransitionStyle(t,"none")):this.register(e,t)}applyTransitionStyle(e,t){e.style.setProperty(this.transitionProperty,t)}clear(){this.states.clear()}getKeys(){return Array.from(this.states.keys())}}let Sx=null;function A8(){return Sx||(Sx=new nW),Sx}class sW{constructor(){Te(this,"rafId",null);Te(this,"pending",!1);Te(this,"lastArgs",null)}throttle(e,...t){this.lastArgs=t,!this.pending&&(this.pending=!0,this.rafId=requestAnimationFrame(async()=>{this.pending=!1,this.rafId=null;const s=this.lastArgs;this.lastArgs=null;try{await e(...s)}catch(o){console.error("Throttler: Error executing function",o)}}))}cancel(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pending=!1,this.lastArgs=null}isPending(){return this.pending}}class oW{constructor(){Te(this,"transaction",tW());Te(this,"layoutManager",A8());Te(this,"scheduler",z2());Te(this,"applyCanvasColorsFn",null)}async waitIndicatorReady(e,t,s,o=800){var a;const r=Date.now();for(;Date.now()-r<o;){try{const l=((a=e.getIndicators)==null?void 0:a.call(e,{name:t,paneId:s}))??[];if(l.length>0&&l.some(f=>f&&f.result&&Object.keys(f.result).length>0))return}catch{}await new Promise(l=>setTimeout(l,16))}}setApplyCanvasColorsFunction(e){this.applyCanvasColorsFn=e}reapplyCanvasColors(){this.applyCanvasColorsFn&&this.applyCanvasColorsFn()}async addIndicator(e){let t=null;return await this.transaction.run({reason:"indicator",chart:e.chart,mutateState:()=>{t=e.chart.createIndicator({name:e.name,calcParams:e.params},e.isMain??!1,e.paneId?{id:e.paneId}:void 0)},compute:async()=>{await this.waitIndicatorReady(e.chart,e.name,e.paneId)},commit:()=>{console.log(`✅ Indicator added: ${e.name} (${t})`),this.scheduler.requestKey("canvas:reapply",()=>{this.reapplyCanvasColors()})}}),t}async removeIndicator(e){await this.transaction.run({reason:"indicator",chart:e.chart,mutateState:()=>{e.chart.removeIndicator({paneId:e.paneId,name:e.name})},commit:()=>{console.log(`✅ Indicator removed: ${e.name}`)}})}async changeTimeframe(e){let t=null;try{t=Promise.resolve(e.loadDataFn()).catch(s=>{throw console.error("❌ Timeframe load failed:",s),s})}catch(s){console.error("❌ Timeframe load failed to start:",s),t=Promise.reject(s)}await this.transaction.run({reason:"timeframe",chart:e.chart,compute:async()=>{t&&await t},commit:()=>{console.log("✅ Timeframe changed"),e.skipCanvasReapply||this.scheduler.requestKey("canvas:reapply",()=>{this.reapplyCanvasColors()})}})}async switchChartType(e){await this.transaction.run({reason:"type",chart:e.chart,mutateState:()=>{},compute:async()=>{await e.reloadDataFn()},commit:()=>{console.log(`✅ Chart type switched to: ${e.newType}`),this.scheduler.requestKey("canvas:reapply",()=>{this.reapplyCanvasColors()})}})}async sidebarOperation(e){const t="sidebar";this.layoutManager.register(t),await this.transaction.run({reason:"sidebar",chart:e.chart,skipTransitions:!0,mutateState:()=>{this.layoutManager.disable(t)},measure:()=>{},commit:()=>{this.scheduler.requestKey("sidebar:resize",()=>{e.chart.resize(),this.reapplyCanvasColors(),requestAnimationFrame(()=>{this.layoutManager.enable(t)})})}})}async changeTheme(e,t){await this.transaction.run({reason:"theme",chart:e,mutateState:()=>{t()},commit:()=>{console.log("✅ Theme changed")}})}resizeChart(e){this.scheduler.requestKey("chart:resize",()=>{e.resize()})}async batchIndicatorOperations(e){const t=e.map(s=>({reason:"indicator",chart:s.operation.chart,mutateState:()=>{s.type==="add"?s.operation.chart.createIndicator({name:s.operation.name,calcParams:s.operation.params},s.operation.isMain??!1,s.operation.paneId?{id:s.operation.paneId}:void 0):s.operation.chart.removeIndicator({paneId:s.operation.paneId,name:s.operation.name})}}));await this.transaction.batch(t)}}let Cx=null;function p6(){return Cx||(Cx=new oW),Cx}var iW=ke('<div class="sidebar-container svelte-1chwdug"><!> <!></div>'),rW=ke("<div><!></div>");function aW(n,e){Ed(e,!0);const t=sm(),s=()=>wl(c,"$chart",t),o=()=>wl(w,"$sidebarWidth",t),r=()=>wl(C,"$sidebarState",t),a=()=>wl(f,"$save",t);let l=hi(e,"className",3,"");const c=gd("chart"),f=gd("save"),{MIN_WIDTH:u,MAX_WIDTH:d,DEFAULT_WIDTH:h,PRICE_SCALE_WIDTH:m}=JV,g=N8(),w=$m(g.widthPx);f.update(qe=>(qe.showSidebar=g.visible,qe));const C=_p([f,w],([qe,nt])=>({visible:qe.showSidebar,widthPx:nt})),P=Fh();let I=ge(!1);p6();const A=z2(),M=A8(),F=new sW;M.register("sidebar");function B(){var qe;if(!XV())return!1;if(typeof window<"u"){const nt=(qe=window.matchMedia)==null?void 0:qe.call(window,"(min-width: 768px)");if(nt&&!nt.matches)return!1}return!0}function $(){s()&&A.requestKey("sidebar:resize",()=>{var qe;(qe=s())==null||qe.resize()})}function L(){s()&&F.throttle(()=>{A.requestKey("sidebar:resize",()=>{var qe;(qe=s())==null||qe.resize()})})}function O(){if(!B()){f.update(nt=>(nt.showSidebar=!1,nt)),Ab(!1,0),P("sidebar:toggle",{visible:!1});return}if(!s())return;const qe=o()||h;M.enable("sidebar"),f.update(nt=>(nt.showSidebar=!0,nt)),w.set(qe),Ab(!0,qe),P("sidebar:toggle",{visible:!0}),requestAnimationFrame(()=>{$(),setTimeout(()=>{$()},100),setTimeout(()=>{$()},250)})}function Y(){f.update(qe=>(qe.showSidebar=!1,qe)),Ab(!1,0),P("sidebar:toggle",{visible:!1}),s()&&(M.enable("sidebar"),requestAnimationFrame(()=>{$(),setTimeout(()=>{$()},100),setTimeout(()=>{$()},250)}))}function ce(){if(!B()){Y();return}r().visible?Y():O()}function Q(qe){const nt=Math.max(u,Math.min(d,qe));w.set(nt),a().showSidebar&&Ab(!0,nt),P("sidebar:resize:move",{widthPx:nt}),L()}function le(){return r()}function ue(qe){M.disable("sidebar"),ZV(),P("sidebar:resize:start",{widthPx:o()})}function fe(qe){const nt=qe.detail.widthPx;Q(nt)}function pe(qe){i(I)&&(M.enable("sidebar"),d5()),P("sidebar:resize:end",{widthPx:o()})}function Z(){Q(h)}function xe(){!B()&&a().showSidebar&&Y()}function oe(qe){if(qe.key==="S"&&!qe.ctrlKey&&!qe.metaKey&&!qe.altKey){const nt=qe.target;nt.tagName!=="INPUT"&&nt.tagName!=="TEXTAREA"&&!nt.isContentEditable&&(qe.preventDefault(),ce())}}Th(()=>{(async()=>(M.disable("sidebar"),await r2(),xe(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{x(I,!0),M.enable("sidebar"),d5(),console.log("✨ Sidebar transitions enabled"),s()&&$()})})))();const qe=()=>{xe()};return window.addEventListener("resize",qe),window.addEventListener("keydown",oe),()=>{window.removeEventListener("resize",qe),window.removeEventListener("keydown",oe),F.cancel()}});const Pe=Bt(()=>()=>{const qe=r().visible?`${o()}px`:"0px";return{"--sidebar-width":qe,"--sidebar-visible":r().visible?"1":"0","--sidebar-transitions":i(I)?"width 200ms cubic-bezier(0.4, 0, 0.2, 1)":"none",width:qe}});var $e=rW();const ze=Bt(()=>Object.entries(i(Pe)).map(([qe,nt])=>`${qe}: ${nt}`).join("; "));var Ke=y($e);return Ue(Ke,()=>r().visible,qe=>{var nt=iW(),ft=y(nt);qV(ft,{});var ut=v(ft,2);YV(ut,{$$events:{"resize:start":ue,"resize:move":fe,"resize:end":pe,"double-click":Z}}),_(nt),Ce(()=>Ot(nt,"style",`width: ${o()??""}px;`)),q(qe,nt)}),_($e),Ce(()=>{pi($e,`sidebar-host ${l()??""} svelte-1chwdug`),Ot($e,"style",i(ze))}),q(n,$e),$d({openSidebar:O,closeSidebar:Y,toggleSidebar:ce,setSidebarWidth:Q,getSidebarState:le})}var lW=(n,e)=>x(e,"rules"),cW=(n,e)=>x(e,"delivery"),uW=(n,e)=>x(e,"logs"),dW=ke('<div class="empty-state svelte-kd3mpt"><div class="title svelte-kd3mpt">No alert rules found</div> <div class="desc svelte-kd3mpt">Add alertcondition() or alert() in JS/Pine to populate rules.</div></div>'),fW=(n,e)=>B2(i(e).id,{enabled:n.target.checked}),pW=(n,e)=>B2(i(e).id,{frequency:n.target.value}),mW=ke("<option> </option>"),hW=(n,e)=>B2(i(e).id,{message:n.target.value}),vW=(n,e,t)=>B2(i(e).id,{channels:{[i(t)]:n.target.checked}}),gW=ke('<label class="channel svelte-kd3mpt"><input type="checkbox"> <span> </span></label>'),_W=(n,e,t)=>e(i(t)),yW=ke('<div class="rule-card svelte-kd3mpt"><div class="rule-head svelte-kd3mpt"><div><div class="rule-title svelte-kd3mpt"> </div> <div class="rule-message svelte-kd3mpt"> </div></div> <label class="switch svelte-kd3mpt"><input type="checkbox" class="svelte-kd3mpt"> <span class="slider svelte-kd3mpt"></span></label></div> <div class="rule-row svelte-kd3mpt"><label>Frequency</label> <select class="svelte-kd3mpt"></select></div> <div class="rule-row svelte-kd3mpt"><label>Message</label> <input type="text" placeholder="Alert message" class="svelte-kd3mpt"></div> <div class="channels svelte-kd3mpt"></div> <button class="btn-test svelte-kd3mpt">Test alert</button></div>'),bW=ke('<div class="rules-grid svelte-kd3mpt"></div>'),xW=ke('<div class="alerts-panel svelte-kd3mpt"><!></div>'),wW=n=>xy({webhookUrl:n.target.value}),kW=n=>xy({emailEndpoint:n.target.value}),SW=n=>xy({emailTo:n.target.value}),CW=n=>xy({pushEndpoint:n.target.value}),IW=n=>xy({pushTarget:n.target.value}),PW=n=>S8({backfill:n.target.checked}),MW=n=>S8({maxLogs:Number(n.target.value)||500}),NW=ke('<div class="alerts-panel svelte-kd3mpt"><div class="delivery-grid svelte-kd3mpt"><div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Webhook</div> <input type="text" placeholder="https://your-webhook-url" class="svelte-kd3mpt"></div> <div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Email (HTTP endpoint)</div> <input type="text" placeholder="https://email-gateway/send" class="svelte-kd3mpt"> <input type="text" placeholder="to@example.com" class="svelte-kd3mpt"></div> <div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Push (HTTP endpoint)</div> <input type="text" placeholder="https://push-gateway/send" class="svelte-kd3mpt"> <input type="text" placeholder="push target / token" class="svelte-kd3mpt"></div></div> <div class="options-row svelte-kd3mpt"><label class="option svelte-kd3mpt"><input type="checkbox"> <span>Backfill historical alerts</span></label> <label class="option svelte-kd3mpt"><span>Max logs</span> <input type="number" min="50" max="2000" class="svelte-kd3mpt"></label></div></div>'),AW=ke('<div class="empty-state svelte-kd3mpt"><div class="title svelte-kd3mpt">No alerts yet</div> <div class="desc svelte-kd3mpt">Triggered alerts will appear here.</div></div>'),TW=ke("<span> </span>"),FW=ke('<div class="log-item svelte-kd3mpt"><div class="log-main"><div class="log-title svelte-kd3mpt"> </div> <div class="log-meta svelte-kd3mpt"> </div> <div class="log-message svelte-kd3mpt"> </div></div> <div class="log-deliveries svelte-kd3mpt"></div></div>'),LW=ke('<div class="logs-list svelte-kd3mpt"></div>'),EW=ke('<div class="alerts-panel logs-panel svelte-kd3mpt"><div class="logs-header svelte-kd3mpt"><div class="logs-title svelte-kd3mpt">Alert Logs</div> <button class="btn-clear svelte-kd3mpt">Clear</button></div> <!></div>'),$W=ke('<div class="alerts-shell svelte-kd3mpt"><div class="alerts-tabs svelte-kd3mpt"><button class="svelte-kd3mpt">Rules</button> <button class="svelte-kd3mpt">Delivery</button> <button class="svelte-kd3mpt">Logs</button></div> <!></div>');function DW(n,e){Ed(e,!0);const t=sm(),s=()=>wl(hy,"$alertCenterUi",t),o=()=>wl(a,"$save",t),r=()=>wl(Qv,"$alertCenter",t),a=gd("save");let l=ge(!1),c=ge("rules");Fr(()=>{x(l,V(s()))}),Fr(()=>{s()!==i(l)&&hy.set(i(l))});const f={once_per_bar:"Once per bar",once_per_bar_close:"Once per bar close",once:"Once only"},u={app:"App",webhook:"Webhook",email:"Email",push:"Push"},d=g=>!g||!Number.isFinite(g)?"-":new Date(g).toLocaleString(),h=g=>g.title||g.id,m=async g=>{var I,A,M,F,B,$;const w=Date.now(),C={id:`${g.id}_${w}`,ruleId:g.id,timestamp:w,barIndex:void 0,symbol:((A=(I=o())==null?void 0:I.symbol)==null?void 0:A.ticker)||((F=(M=o())==null?void 0:M.symbol)==null?void 0:F.name),timeframe:($=(B=o())==null?void 0:B.period)==null?void 0:$.timeframe,title:g.title||g.id,message:g.message||"Test alert",price:void 0,deliveries:Object.keys(g.channels||{}).map(L=>({channel:L,status:g.channels[L]?"pending":"skipped"}))};C8([C]);const P=await I8(C);P8(C.id,P)};tg(n,{title:"Alerts Center",width:"min(980px, 96vw)",maxHeight:"90vh",get show(){return i(l)},set show(g){x(l,V(g))},get theme(){return o().theme},buttons:[],class:"alerts-center",children:(g,w)=>{var C=$W(),P=y(C),I=y(P);I.__click=[lW,c];var A=v(I,2);A.__click=[cW,c];var M=v(A,2);M.__click=[uW,c],_(P);var F=v(P,2);Ue(F,()=>i(c)==="rules",B=>{var $=xW(),L=y($);Ue(L,()=>Object.keys(r().rules).length===0,O=>{var Y=dW();q(O,Y)},O=>{var Y=bW();Yo(Y,5,()=>Object.values(r().rules),ce=>ce.id,(ce,Q)=>{var le=yW(),ue=y(le),fe=y(ue),pe=y(fe),Z=y(pe,!0);Ce(()=>tt(Z,h(i(Q)))),_(pe);var xe=v(pe,2),oe=y(xe,!0);_(xe),_(fe);var Pe=v(fe,2),$e=y(Pe);xn($e),$e.__change=[fW,Q],Zi(2),_(Pe),_(ue);var ze=v(ue,2),Ke=v(y(ze),2);e_(Ke,()=>i(Q).frequency);var qe;Ke.__change=[pW,Q],Yo(Ke,21,()=>Object.entries(f),Ii,(Pt,Et)=>{let Mt=()=>i(Et)[0],Je=()=>i(Et)[1];var Ct=mW(),Ze={},Xe=y(Ct,!0);_(Ct),Ce(()=>{Ze!==(Ze=Mt())&&(Ct.value=(Ct.__value=Mt())==null?"":Mt()),tt(Xe,Je())}),q(Pt,Ct)}),_(Ke),_(ze);var nt=v(ze,2),ft=v(y(nt),2);xn(ft),ft.__change=[hW,Q],_(nt);var ut=v(nt,2);Yo(ut,21,()=>Object.keys(u),Ii,(Pt,Et)=>{var Mt=gW(),Je=y(Mt);xn(Je),Je.__change=[vW,Q,Et];var Ct=v(Je,2),Ze=y(Ct,!0);_(Ct),_(Mt),Ce(()=>{var Xe;Mv(Je,(Xe=i(Q).channels)==null?void 0:Xe[i(Et)]),tt(Ze,u[i(Et)])}),q(Pt,Mt)}),_(ut);var bt=v(ut,2);bt.__click=[_W,m,Q],_(le),Ce(()=>{tt(oe,i(Q).message||"No message"),Mv($e,i(Q).enabled),qe!==(qe=i(Q).frequency)&&(Ke.value=(Ke.__value=i(Q).frequency)==null?"":i(Q).frequency,_0(Ke,i(Q).frequency)),Gf(ft,i(Q).message||"")}),q(ce,le)}),_(Y),q(O,Y)}),_($),q(B,$)},B=>{var $=Qn(),L=fn($);Ue(L,()=>i(c)==="delivery",O=>{var Y=NW(),ce=y(Y),Q=y(ce),le=v(y(Q),2);xn(le),le.__change=[wW],_(Q);var ue=v(Q,2),fe=v(y(ue),2);xn(fe),fe.__change=[kW];var pe=v(fe,2);xn(pe),pe.__change=[SW],_(ue);var Z=v(ue,2),xe=v(y(Z),2);xn(xe),xe.__change=[CW];var oe=v(xe,2);xn(oe),oe.__change=[IW],_(Z),_(ce);var Pe=v(ce,2),$e=y(Pe),ze=y($e);xn(ze),ze.__change=[PW],Zi(2),_($e);var Ke=v($e,2),qe=v(y(Ke),2);xn(qe),qe.__change=[MW],_(Ke),_(Pe),_(Y),Ce(()=>{Gf(le,r().delivery.webhookUrl||""),Gf(fe,r().delivery.emailEndpoint||""),Gf(pe,r().delivery.emailTo||""),Gf(xe,r().delivery.pushEndpoint||""),Gf(oe,r().delivery.pushTarget||""),Mv(ze,r().options.backfill),Gf(qe,r().options.maxLogs)}),q(O,Y)},O=>{var Y=EW(),ce=y(Y),Q=v(y(ce),2);Q.__click=function(...ue){xx==null||xx.apply(this,ue)},_(ce);var le=v(ce,2);Ue(le,()=>r().logs.length===0,ue=>{var fe=AW();q(ue,fe)},ue=>{var fe=LW();Yo(fe,5,()=>r().logs,pe=>pe.id,(pe,Z)=>{var xe=FW(),oe=y(xe),Pe=y(oe),$e=y(Pe,!0);_(Pe);var ze=v(Pe,2),Ke=y(ze);Ce(()=>tt(Ke,`${d(i(Z).timestamp)??""} · ${(i(Z).symbol||"-")??""} · ${(i(Z).timeframe||"-")??""}`)),_(ze);var qe=v(ze,2),nt=y(qe,!0);_(qe),_(oe);var ft=v(oe,2);Yo(ft,21,()=>i(Z).deliveries,Ii,(ut,bt)=>{var Pt=TW(),Et=y(Pt);_(Pt),Ce(()=>{pi(Pt,`${`chip chip-${i(bt).status}`??""} svelte-kd3mpt`),tt(Et,`${i(bt).channel??""}:${i(bt).status??""}`)}),q(ut,Pt)}),_(ft),_(xe),Ce(()=>{tt($e,i(Z).title||i(Z).ruleId),tt(nt,i(Z).message||"-")}),q(pe,xe)}),_(fe),q(ue,fe)}),_(Y),q(O,Y)},!0),q(B,$)}),_(C),Ce(()=>{wr(I,"active",i(c)==="rules"),wr(A,"active",i(c)==="delivery"),wr(M,"active",i(c)==="logs")}),q(g,C)},$$slots:{default:!0}}),$d()}Ip(["click","change"]);const RW=["XAU","XAG","XPT","XPD","CNH"],f5=new Set(["USD","EUR","GBP","JPY","CHF","CAD","AUD","NZD","SEK","NOK","DKK","SGD","HKD","CNY","INR","KRW","THB","MYR","IDR","PHP","MXN","BRL","ZAR","TRY","PLN","CZK","HUF","RON","ILS","RUB","AED","SAR","QAR","KWD",...RW]),jW=["USDT","USDC","BUSD","DAI","TUSD","FDUSD","USD","BTC","ETH","BNB","SOL","XBT"],BW=["BINANCE","COINBASE","KRAKEN","BYBIT","OKX","BITFINEX","KUCOIN","GATE","MEXC","BITGET"],OW=["OANDA","FXCM","FOREX","FX","DUKASCOPY","PEPPERSTONE","ICMARKETS","IG"];function cy(n){if(typeof n=="number"&&Number.isFinite(n))return n;if(typeof n=="string"){const e=Number(n.trim());if(Number.isFinite(e))return e}}function Ix(n){return typeof n=="number"&&Number.isFinite(n)}function c0(n,e,t){return Math.min(t,Math.max(e,Math.trunc(n)))}function T8(n){const e=typeof n.exchange=="string"?n.exchange.trim():"",t=typeof n.ticker=="string"?n.ticker.trim():"";if(!e&&t.includes(":")){const s=t.indexOf(":"),o=t.slice(0,s).trim(),r=t.slice(s+1).trim();return{exchange:o?o.toUpperCase():void 0,ticker:r.toUpperCase()}}return{exchange:e?e.toUpperCase():void 0,ticker:t.toUpperCase()}}function F8(n){return(n||"").replace(/[^A-Z]/gi,"").toUpperCase()}function L8(n){const e=(n.market??n.type??"").toString().toLowerCase();if(e.includes("forex")||e==="fx")return"forex";if(e.includes("crypto")||e.includes("coin"))return"crypto";const{exchange:t,ticker:s}=T8(n),o=(t||"").toUpperCase();if(BW.some(a=>o.includes(a)))return"crypto";if(OW.some(a=>o.includes(a)))return"forex";const r=F8(s);if(r.length>=6){const a=r.slice(0,3),l=r.slice(3,6);if(f5.has(a)&&f5.has(l))return"forex"}return jW.some(a=>r.endsWith(a))?"crypto":e.includes("stock")||e.includes("equity")||e.includes("index")?"stock":"unknown"}function Tb(n){return L8(n)}function zW(n){const{ticker:e}=T8(n),t=F8(e),s=t.slice(0,3),o=t.slice(3,6);return s==="XAU"||s==="XAG"||s==="XPT"||s==="XPD"||o==="JPY"?3:5}function E8(n,e){if(!Number.isFinite(n))return 0;try{const t=n.toFixed(e).replace(/\.?0+$/,""),s=t.indexOf(".");return s===-1?0:t.length-s-1}catch{return 0}}function Px(n){if(!Array.isArray(n)||n.length===0)return;const e=n.slice(Math.max(0,n.length-200));let t=0;for(const s of e){const o=[s.open,s.high,s.low,s.close];for(const r of o){const a=cy(r);if(a!=null&&(t=Math.max(t,E8(a,12)),t>=12))return 12}}return t}function VW(n){var e;if(!(!Array.isArray(n)||n.length===0))for(let t=n.length-1;t>=0;t--){const s=(e=n[t])==null?void 0:e.close,o=cy(s);if(o!=null)return o}}function j_(n,e){const t=(n==null?void 0:n.tickSize)??(n==null?void 0:n.minTick)??(n==null?void 0:n.priceStep),s=cy(t),o=s!=null&&s>0?E8(s,12):void 0,r=L8(n);if(r==="forex"){const f=zW(n),u=cy(n==null?void 0:n.pricePrecision),d=e?Px(e):void 0,h=Math.max(f,o??0,u??0,Ix(d)?d:0);return c0(h,0,12)}const a=n==null?void 0:n.pricePrecision,l=cy(a);if(r==="stock")return o!=null?c0(o,0,12):l!=null?c0(l,0,12):2;const c=e?Px(e):void 0;if(Ix(c))return c0(c,2,12);if(r==="crypto"){const f=e?Px(e):void 0,u=Ix(f)?f:l??6,d=Math.abs(VW(e)??NaN);return Number.isFinite(d)?d>=1e3?c0(u,2,2):d>=1?c0(u,2,4):d>=.01?c0(u,4,8):c0(u,6,12):c0(u,2,12)}return l!=null?c0(l,0,12):2}var $8={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/(function(n,e){(function(t,s){n.exports=s()})(L0,function t(){var s=typeof self<"u"?self:typeof window<"u"?window:s!==void 0?s:{},o=!s.document&&!!s.postMessage,r=s.IS_PAPA_WORKER||!1,a={},l=0,c={parse:function(L,O){var Y=(O=O||{}).dynamicTyping||!1;if($(Y)&&(O.dynamicTypingFunction=Y,Y={}),O.dynamicTyping=Y,O.transform=!!$(O.transform)&&O.transform,O.worker&&c.WORKERS_SUPPORTED){var ce=function(){if(!c.WORKERS_SUPPORTED)return!1;var le=(fe=s.URL||s.webkitURL||null,pe=t.toString(),c.BLOB_URL||(c.BLOB_URL=fe.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",pe,")();"],{type:"text/javascript"})))),ue=new s.Worker(le),fe,pe;return ue.onmessage=I,ue.id=l++,a[ue.id]=ue}();return ce.userStep=O.step,ce.userChunk=O.chunk,ce.userComplete=O.complete,ce.userError=O.error,O.step=$(O.step),O.chunk=$(O.chunk),O.complete=$(O.complete),O.error=$(O.error),delete O.worker,void ce.postMessage({input:L,config:O,workerId:ce.id})}var Q=null;return c.NODE_STREAM_INPUT,typeof L=="string"?(L=function(le){return le.charCodeAt(0)===65279?le.slice(1):le}(L),Q=O.download?new d(O):new m(O)):L.readable===!0&&$(L.read)&&$(L.on)?Q=new g(O):(s.File&&L instanceof File||L instanceof Object)&&(Q=new h(O)),Q.stream(L)},unparse:function(L,O){var Y=!1,ce=!0,Q=",",le=`\r
`,ue='"',fe=ue+ue,pe=!1,Z=null,xe=!1;(function(){if(typeof O=="object"){if(typeof O.delimiter!="string"||c.BAD_DELIMITERS.filter(function(ze){return O.delimiter.indexOf(ze)!==-1}).length||(Q=O.delimiter),(typeof O.quotes=="boolean"||typeof O.quotes=="function"||Array.isArray(O.quotes))&&(Y=O.quotes),typeof O.skipEmptyLines!="boolean"&&typeof O.skipEmptyLines!="string"||(pe=O.skipEmptyLines),typeof O.newline=="string"&&(le=O.newline),typeof O.quoteChar=="string"&&(ue=O.quoteChar),typeof O.header=="boolean"&&(ce=O.header),Array.isArray(O.columns)){if(O.columns.length===0)throw new Error("Option columns is empty");Z=O.columns}O.escapeChar!==void 0&&(fe=O.escapeChar+ue),(typeof O.escapeFormulae=="boolean"||O.escapeFormulae instanceof RegExp)&&(xe=O.escapeFormulae instanceof RegExp?O.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var oe=new RegExp(C(ue),"g");if(typeof L=="string"&&(L=JSON.parse(L)),Array.isArray(L)){if(!L.length||Array.isArray(L[0]))return Pe(null,L,pe);if(typeof L[0]=="object")return Pe(Z||Object.keys(L[0]),L,pe)}else if(typeof L=="object")return typeof L.data=="string"&&(L.data=JSON.parse(L.data)),Array.isArray(L.data)&&(L.fields||(L.fields=L.meta&&L.meta.fields||Z),L.fields||(L.fields=Array.isArray(L.data[0])?L.fields:typeof L.data[0]=="object"?Object.keys(L.data[0]):[]),Array.isArray(L.data[0])||typeof L.data[0]=="object"||(L.data=[L.data])),Pe(L.fields||[],L.data||[],pe);throw new Error("Unable to serialize unrecognized input");function Pe(ze,Ke,qe){var nt="";typeof ze=="string"&&(ze=JSON.parse(ze)),typeof Ke=="string"&&(Ke=JSON.parse(Ke));var ft=Array.isArray(ze)&&0<ze.length,ut=!Array.isArray(Ke[0]);if(ft&&ce){for(var bt=0;bt<ze.length;bt++)0<bt&&(nt+=Q),nt+=$e(ze[bt],bt);0<Ke.length&&(nt+=le)}for(var Pt=0;Pt<Ke.length;Pt++){var Et=ft?ze.length:Ke[Pt].length,Mt=!1,Je=ft?Object.keys(Ke[Pt]).length===0:Ke[Pt].length===0;if(qe&&!ft&&(Mt=qe==="greedy"?Ke[Pt].join("").trim()==="":Ke[Pt].length===1&&Ke[Pt][0].length===0),qe==="greedy"&&ft){for(var Ct=[],Ze=0;Ze<Et;Ze++){var Xe=ut?ze[Ze]:Ze;Ct.push(Ke[Pt][Xe])}Mt=Ct.join("").trim()===""}if(!Mt){for(var Ae=0;Ae<Et;Ae++){0<Ae&&!Je&&(nt+=Q);var Qe=ft&&ut?ze[Ae]:Ae;nt+=$e(Ke[Pt][Qe],Ae)}Pt<Ke.length-1&&(!qe||0<Et&&!Je)&&(nt+=le)}}return nt}function $e(ze,Ke){if(ze==null)return"";if(ze.constructor===Date)return JSON.stringify(ze).slice(1,25);var qe=!1;xe&&typeof ze=="string"&&xe.test(ze)&&(ze="'"+ze,qe=!0);var nt=ze.toString().replace(oe,fe);return(qe=qe||Y===!0||typeof Y=="function"&&Y(ze,Ke)||Array.isArray(Y)&&Y[Ke]||function(ft,ut){for(var bt=0;bt<ut.length;bt++)if(-1<ft.indexOf(ut[bt]))return!0;return!1}(nt,c.BAD_DELIMITERS)||-1<nt.indexOf(Q)||nt.charAt(0)===" "||nt.charAt(nt.length-1)===" ")?ue+nt+ue:nt}}};if(c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!o&&!!s.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=P,c.ParserHandle=w,c.NetworkStreamer=d,c.FileStreamer=h,c.StringStreamer=m,c.ReadableStreamStreamer=g,s.jQuery){var f=s.jQuery;f.fn.parse=function(L){var O=L.config||{},Y=[];return this.each(function(le){if(!(f(this).prop("tagName").toUpperCase()==="INPUT"&&f(this).attr("type").toLowerCase()==="file"&&s.FileReader)||!this.files||this.files.length===0)return!0;for(var ue=0;ue<this.files.length;ue++)Y.push({file:this.files[ue],inputElem:this,instanceConfig:f.extend({},O)})}),ce(),this;function ce(){if(Y.length!==0){var le,ue,fe,pe,Z=Y[0];if($(L.before)){var xe=L.before(Z.file,Z.inputElem);if(typeof xe=="object"){if(xe.action==="abort")return le="AbortError",ue=Z.file,fe=Z.inputElem,pe=xe.reason,void($(L.error)&&L.error({name:le},ue,fe,pe));if(xe.action==="skip")return void Q();typeof xe.config=="object"&&(Z.instanceConfig=f.extend(Z.instanceConfig,xe.config))}else if(xe==="skip")return void Q()}var oe=Z.instanceConfig.complete;Z.instanceConfig.complete=function(Pe){$(oe)&&oe(Pe,Z.file,Z.inputElem),Q()},c.parse(Z.file,Z.instanceConfig)}else $(L.complete)&&L.complete()}function Q(){Y.splice(0,1),ce()}}}function u(L){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(O){var Y=F(O);Y.chunkSize=parseInt(Y.chunkSize),O.step||O.chunk||(Y.chunkSize=null),this._handle=new w(Y),(this._handle.streamer=this)._config=Y}).call(this,L),this.parseChunk=function(O,Y){if(this.isFirstChunk&&$(this._config.beforeFirstChunk)){var ce=this._config.beforeFirstChunk(O);ce!==void 0&&(O=ce)}this.isFirstChunk=!1,this._halted=!1;var Q=this._partialLine+O;this._partialLine="";var le=this._handle.parse(Q,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var ue=le.meta.cursor;this._finished||(this._partialLine=Q.substring(ue-this._baseIndex),this._baseIndex=ue),le&&le.data&&(this._rowCount+=le.data.length);var fe=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(r)s.postMessage({results:le,workerId:c.WORKER_ID,finished:fe});else if($(this._config.chunk)&&!Y){if(this._config.chunk(le,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);le=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(le.data),this._completeResults.errors=this._completeResults.errors.concat(le.errors),this._completeResults.meta=le.meta),this._completed||!fe||!$(this._config.complete)||le&&le.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),fe||le&&le.meta.paused||this._nextChunk(),le}this._halted=!0},this._sendError=function(O){$(this._config.error)?this._config.error(O):r&&this._config.error&&s.postMessage({workerId:c.WORKER_ID,error:O,finished:!1})}}function d(L){var O;(L=L||{}).chunkSize||(L.chunkSize=c.RemoteChunkSize),u.call(this,L),this._nextChunk=o?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(Y){this._input=Y,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(O=new XMLHttpRequest,this._config.withCredentials&&(O.withCredentials=this._config.withCredentials),o||(O.onload=B(this._chunkLoaded,this),O.onerror=B(this._chunkError,this)),O.open(this._config.downloadRequestBody?"POST":"GET",this._input,!o),this._config.downloadRequestHeaders){var Y=this._config.downloadRequestHeaders;for(var ce in Y)O.setRequestHeader(ce,Y[ce])}if(this._config.chunkSize){var Q=this._start+this._config.chunkSize-1;O.setRequestHeader("Range","bytes="+this._start+"-"+Q)}try{O.send(this._config.downloadRequestBody)}catch(le){this._chunkError(le.message)}o&&O.status===0&&this._chunkError()}},this._chunkLoaded=function(){O.readyState===4&&(O.status<200||400<=O.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:O.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(Y){var ce=Y.getResponseHeader("Content-Range");return ce===null?-1:parseInt(ce.substring(ce.lastIndexOf("/")+1))}(O),this.parseChunk(O.responseText)))},this._chunkError=function(Y){var ce=O.statusText||Y;this._sendError(new Error(ce))}}function h(L){var O,Y;(L=L||{}).chunkSize||(L.chunkSize=c.LocalChunkSize),u.call(this,L);var ce=typeof FileReader<"u";this.stream=function(Q){this._input=Q,Y=Q.slice||Q.webkitSlice||Q.mozSlice,ce?((O=new FileReader).onload=B(this._chunkLoaded,this),O.onerror=B(this._chunkError,this)):O=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var Q=this._input;if(this._config.chunkSize){var le=Math.min(this._start+this._config.chunkSize,this._input.size);Q=Y.call(Q,this._start,le)}var ue=O.readAsText(Q,this._config.encoding);ce||this._chunkLoaded({target:{result:ue}})},this._chunkLoaded=function(Q){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(Q.target.result)},this._chunkError=function(){this._sendError(O.error)}}function m(L){var O;u.call(this,L=L||{}),this.stream=function(Y){return O=Y,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var Y,ce=this._config.chunkSize;return ce?(Y=O.substring(0,ce),O=O.substring(ce)):(Y=O,O=""),this._finished=!O,this.parseChunk(Y)}}}function g(L){u.call(this,L=L||{});var O=[],Y=!0,ce=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(Q){this._input=Q,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){ce&&O.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),O.length?this.parseChunk(O.shift()):Y=!0},this._streamData=B(function(Q){try{O.push(typeof Q=="string"?Q:Q.toString(this._config.encoding)),Y&&(Y=!1,this._checkIsFinished(),this.parseChunk(O.shift()))}catch(le){this._streamError(le)}},this),this._streamError=B(function(Q){this._streamCleanUp(),this._sendError(Q)},this),this._streamEnd=B(function(){this._streamCleanUp(),ce=!0,this._streamData("")},this),this._streamCleanUp=B(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function w(L){var O,Y,ce,Q=Math.pow(2,53),le=-Q,ue=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,fe=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,pe=this,Z=0,xe=0,oe=!1,Pe=!1,$e=[],ze={data:[],errors:[],meta:{}};if($(L.step)){var Ke=L.step;L.step=function(Pt){if(ze=Pt,ft())nt();else{if(nt(),ze.data.length===0)return;Z+=Pt.data.length,L.preview&&Z>L.preview?Y.abort():(ze.data=ze.data[0],Ke(ze,pe))}}}function qe(Pt){return L.skipEmptyLines==="greedy"?Pt.join("").trim()==="":Pt.length===1&&Pt[0].length===0}function nt(){return ze&&ce&&(bt("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),ce=!1),L.skipEmptyLines&&(ze.data=ze.data.filter(function(Pt){return!qe(Pt)})),ft()&&function(){if(!ze)return;function Pt(Mt,Je){$(L.transformHeader)&&(Mt=L.transformHeader(Mt,Je)),$e.push(Mt)}if(Array.isArray(ze.data[0])){for(var Et=0;ft()&&Et<ze.data.length;Et++)ze.data[Et].forEach(Pt);ze.data.splice(0,1)}else ze.data.forEach(Pt)}(),function(){if(!ze||!L.header&&!L.dynamicTyping&&!L.transform)return ze;function Pt(Mt,Je){var Ct,Ze=L.header?{}:[];for(Ct=0;Ct<Mt.length;Ct++){var Xe=Ct,Ae=Mt[Ct];L.header&&(Xe=Ct>=$e.length?"__parsed_extra":$e[Ct]),L.transform&&(Ae=L.transform(Ae,Xe)),Ae=ut(Xe,Ae),Xe==="__parsed_extra"?(Ze[Xe]=Ze[Xe]||[],Ze[Xe].push(Ae)):Ze[Xe]=Ae}return L.header&&(Ct>$e.length?bt("FieldMismatch","TooManyFields","Too many fields: expected "+$e.length+" fields but parsed "+Ct,xe+Je):Ct<$e.length&&bt("FieldMismatch","TooFewFields","Too few fields: expected "+$e.length+" fields but parsed "+Ct,xe+Je)),Ze}var Et=1;return!ze.data.length||Array.isArray(ze.data[0])?(ze.data=ze.data.map(Pt),Et=ze.data.length):ze.data=Pt(ze.data,0),L.header&&ze.meta&&(ze.meta.fields=$e),xe+=Et,ze}()}function ft(){return L.header&&$e.length===0}function ut(Pt,Et){return Mt=Pt,L.dynamicTypingFunction&&L.dynamicTyping[Mt]===void 0&&(L.dynamicTyping[Mt]=L.dynamicTypingFunction(Mt)),(L.dynamicTyping[Mt]||L.dynamicTyping)===!0?Et==="true"||Et==="TRUE"||Et!=="false"&&Et!=="FALSE"&&(function(Je){if(ue.test(Je)){var Ct=parseFloat(Je);if(le<Ct&&Ct<Q)return!0}return!1}(Et)?parseFloat(Et):fe.test(Et)?new Date(Et):Et===""?null:Et):Et;var Mt}function bt(Pt,Et,Mt,Je){var Ct={type:Pt,code:Et,message:Mt};Je!==void 0&&(Ct.row=Je),ze.errors.push(Ct)}this.parse=function(Pt,Et,Mt){var Je=L.quoteChar||'"';if(L.newline||(L.newline=function(Xe,Ae){Xe=Xe.substring(0,1048576);var Qe=new RegExp(C(Ae)+"([^]*?)"+C(Ae),"gm"),gt=(Xe=Xe.replace(Qe,"")).split("\r"),Ft=Xe.split(`
`),ot=1<Ft.length&&Ft[0].length<gt[0].length;if(gt.length===1||ot)return`
`;for(var ve=0,Ie=0;Ie<gt.length;Ie++)gt[Ie][0]===`
`&&ve++;return ve>=gt.length/2?`\r
`:"\r"}(Pt,Je)),ce=!1,L.delimiter)$(L.delimiter)&&(L.delimiter=L.delimiter(Pt),ze.meta.delimiter=L.delimiter);else{var Ct=function(Xe,Ae,Qe,gt,Ft){var ot,ve,Ie,It;Ft=Ft||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var Dt=0;Dt<Ft.length;Dt++){var Zt=Ft[Dt],gn=0,hn=0,qn=0;Ie=void 0;for(var On=new P({comments:gt,delimiter:Zt,newline:Ae,preview:10}).parse(Xe),bn=0;bn<On.data.length;bn++)if(Qe&&qe(On.data[bn]))qn++;else{var Fn=On.data[bn].length;hn+=Fn,Ie!==void 0?0<Fn&&(gn+=Math.abs(Fn-Ie),Ie=Fn):Ie=Fn}0<On.data.length&&(hn/=On.data.length-qn),(ve===void 0||gn<=ve)&&(It===void 0||It<hn)&&1.99<hn&&(ve=gn,ot=Zt,It=hn)}return{successful:!!(L.delimiter=ot),bestDelimiter:ot}}(Pt,L.newline,L.skipEmptyLines,L.comments,L.delimitersToGuess);Ct.successful?L.delimiter=Ct.bestDelimiter:(ce=!0,L.delimiter=c.DefaultDelimiter),ze.meta.delimiter=L.delimiter}var Ze=F(L);return L.preview&&L.header&&Ze.preview++,O=Pt,Y=new P(Ze),ze=Y.parse(O,Et,Mt),nt(),oe?{meta:{paused:!0}}:ze||{meta:{paused:!1}}},this.paused=function(){return oe},this.pause=function(){oe=!0,Y.abort(),O=$(L.chunk)?"":O.substring(Y.getCharIndex())},this.resume=function(){pe.streamer._halted?(oe=!1,pe.streamer.parseChunk(O,!0)):setTimeout(pe.resume,3)},this.aborted=function(){return Pe},this.abort=function(){Pe=!0,Y.abort(),ze.meta.aborted=!0,$(L.complete)&&L.complete(ze),O=""}}function C(L){return L.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function P(L){var O,Y=(L=L||{}).delimiter,ce=L.newline,Q=L.comments,le=L.step,ue=L.preview,fe=L.fastMode,pe=O=L.quoteChar===void 0||L.quoteChar===null?'"':L.quoteChar;if(L.escapeChar!==void 0&&(pe=L.escapeChar),(typeof Y!="string"||-1<c.BAD_DELIMITERS.indexOf(Y))&&(Y=","),Q===Y)throw new Error("Comment character same as delimiter");Q===!0?Q="#":(typeof Q!="string"||-1<c.BAD_DELIMITERS.indexOf(Q))&&(Q=!1),ce!==`
`&&ce!=="\r"&&ce!==`\r
`&&(ce=`
`);var Z=0,xe=!1;this.parse=function(oe,Pe,$e){if(typeof oe!="string")throw new Error("Input must be a string");var ze=oe.length,Ke=Y.length,qe=ce.length,nt=Q.length,ft=$(le),ut=[],bt=[],Pt=[],Et=Z=0;if(!oe)return Xs();if(L.header&&!Pe){var Mt=oe.split(ce)[0].split(Y),Je=[],Ct={},Ze=!1;for(var Xe in Mt){var Ae=Mt[Xe];$(L.transformHeader)&&(Ae=L.transformHeader(Ae,Xe));var Qe=Ae,gt=Ct[Ae]||0;for(0<gt&&(Ze=!0,Qe=Ae+"_"+gt),Ct[Ae]=gt+1;Je.includes(Qe);)Qe=Qe+"_"+gt;Je.push(Qe)}if(Ze){var Ft=oe.split(ce);Ft[0]=Je.join(Y),oe=Ft.join(ce)}}if(fe||fe!==!1&&oe.indexOf(O)===-1){for(var ot=oe.split(ce),ve=0;ve<ot.length;ve++){if(Pt=ot[ve],Z+=Pt.length,ve!==ot.length-1)Z+=ce.length;else if($e)return Xs();if(!Q||Pt.substring(0,nt)!==Q){if(ft){if(ut=[],qn(Pt.split(Y)),oo(),xe)return Xs()}else qn(Pt.split(Y));if(ue&&ue<=ve)return ut=ut.slice(0,ue),Xs(!0)}}return Xs()}for(var Ie=oe.indexOf(Y,Z),It=oe.indexOf(ce,Z),Dt=new RegExp(C(pe)+C(O),"g"),Zt=oe.indexOf(O,Z);;)if(oe[Z]!==O)if(Q&&Pt.length===0&&oe.substring(Z,Z+nt)===Q){if(It===-1)return Xs();Z=It+qe,It=oe.indexOf(ce,Z),Ie=oe.indexOf(Y,Z)}else if(Ie!==-1&&(Ie<It||It===-1))Pt.push(oe.substring(Z,Ie)),Z=Ie+Ke,Ie=oe.indexOf(Y,Z);else{if(It===-1)break;if(Pt.push(oe.substring(Z,It)),Fn(It+qe),ft&&(oo(),xe))return Xs();if(ue&&ut.length>=ue)return Xs(!0)}else for(Zt=Z,Z++;;){if((Zt=oe.indexOf(O,Zt+1))===-1)return $e||bt.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ut.length,index:Z}),bn();if(Zt===ze-1)return bn(oe.substring(Z,Zt).replace(Dt,O));if(O!==pe||oe[Zt+1]!==pe){if(O===pe||Zt===0||oe[Zt-1]!==pe){Ie!==-1&&Ie<Zt+1&&(Ie=oe.indexOf(Y,Zt+1)),It!==-1&&It<Zt+1&&(It=oe.indexOf(ce,Zt+1));var gn=On(It===-1?Ie:Math.min(Ie,It));if(oe.substr(Zt+1+gn,Ke)===Y){Pt.push(oe.substring(Z,Zt).replace(Dt,O)),oe[Z=Zt+1+gn+Ke]!==O&&(Zt=oe.indexOf(O,Z)),Ie=oe.indexOf(Y,Z),It=oe.indexOf(ce,Z);break}var hn=On(It);if(oe.substring(Zt+1+hn,Zt+1+hn+qe)===ce){if(Pt.push(oe.substring(Z,Zt).replace(Dt,O)),Fn(Zt+1+hn+qe),Ie=oe.indexOf(Y,Z),Zt=oe.indexOf(O,Z),ft&&(oo(),xe))return Xs();if(ue&&ut.length>=ue)return Xs(!0);break}bt.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ut.length,index:Z}),Zt++}}else Zt++}return bn();function qn(Yn){ut.push(Yn),Et=Z}function On(Yn){var _o=0;if(Yn!==-1){var xs=oe.substring(Zt+1,Yn);xs&&xs.trim()===""&&(_o=xs.length)}return _o}function bn(Yn){return $e||(Yn===void 0&&(Yn=oe.substring(Z)),Pt.push(Yn),Z=ze,qn(Pt),ft&&oo()),Xs()}function Fn(Yn){Z=Yn,qn(Pt),Pt=[],It=oe.indexOf(ce,Z)}function Xs(Yn){return{data:ut,errors:bt,meta:{delimiter:Y,linebreak:ce,aborted:xe,truncated:!!Yn,cursor:Et+(Pe||0)}}}function oo(){le(Xs()),ut=[],bt=[]}},this.abort=function(){xe=!0},this.getCharIndex=function(){return Z}}function I(L){var O=L.data,Y=a[O.workerId],ce=!1;if(O.error)Y.userError(O.error,O.file);else if(O.results&&O.results.data){var Q={abort:function(){ce=!0,A(O.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:M,resume:M};if($(Y.userStep)){for(var le=0;le<O.results.data.length&&(Y.userStep({data:O.results.data[le],errors:O.results.errors,meta:O.results.meta},Q),!ce);le++);delete O.results}else $(Y.userChunk)&&(Y.userChunk(O.results,Q,O.file),delete O.results)}O.finished&&!ce&&A(O.workerId,O.results)}function A(L,O){var Y=a[L];$(Y.userComplete)&&Y.userComplete(O),Y.terminate(),delete a[L]}function M(){throw new Error("Not implemented.")}function F(L){if(typeof L!="object"||L===null)return L;var O=Array.isArray(L)?[]:{};for(var Y in L)O[Y]=F(L[Y]);return O}function B(L,O){return function(){L.apply(O,arguments)}}function $(L){return typeof L=="function"}return r&&(s.onmessage=function(L){var O=L.data;if(c.WORKER_ID===void 0&&O&&(c.WORKER_ID=O.workerId),typeof O.input=="string")s.postMessage({workerId:c.WORKER_ID,results:c.parse(O.input,O.config),finished:!0});else if(s.File&&O.input instanceof File||O.input instanceof Object){var Y=c.parse(O.input,O.config);Y&&s.postMessage({workerId:c.WORKER_ID,results:Y,finished:!0})}}),(d.prototype=Object.create(u.prototype)).constructor=d,(h.prototype=Object.create(u.prototype)).constructor=h,(m.prototype=Object.create(m.prototype)).constructor=m,(g.prototype=Object.create(u.prototype)).constructor=g,c})})($8);var WW=$8.exports;const HW=yy(WW);function qW(n,e,t,s,o){if(!(!e()||i(t).length===0))switch(n.key){case"ArrowDown":n.preventDefault(),x(s,V(Math.min(i(s)+1,i(t).length-1)));break;case"ArrowUp":n.preventDefault(),x(s,V(Math.max(i(s)-1,-1)));break;case"Enter":n.preventDefault(),i(s)>=0&&i(s)<i(t).length&&o(i(t)[i(s)]);break;case"Escape":n.preventDefault(),e(!1);break}}var UW=ke('<div class="flex justify-center py-16"><div class="relative"><div class="w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin"></div> <div class="absolute inset-0 w-12 h-12 border-4 border-transparent border-t-primary/60 rounded-full animate-spin" style="animation-delay: -0.15s;"></div></div></div>'),GW=ke('<div class="flex flex-col items-center justify-center py-16 text-center"><div class="w-16 h-16 rounded-full bg-base-200/50 flex items-center justify-center mb-4"><svg class="w-8 h-8 text-base-content/40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <p class="text-lg font-semibold text-base-content/60 mb-2">No symbols found</p> <p class="text-sm text-base-content/40">Try a different search term</p></div>'),YW=(n,e,t)=>e(i(t)),KW=ke('<div class="absolute top-0 left-0 w-5 h-5 rounded-full overflow-hidden bg-base-200 ring-2 ring-base-100 z-10"><img class="w-full h-full object-cover"></div> <div class="absolute bottom-0 right-0 w-5 h-5 rounded-full overflow-hidden bg-base-200"><img class="w-full h-full object-cover"></div>',1),XW=ke('<div class="relative w-full h-full rounded-lg overflow-hidden bg-base-200/50"><img class="w-full h-full object-cover"> <div class="absolute inset-0 bg-base-200 flex items-center justify-center hidden"><span class="text-xs font-medium text-base-content/60"> </span></div></div>'),ZW=ke('<span class="text-xs px-1.5 py-0.5 rounded bg-base-200/60 border border-base-300/40 text-base-content/60"> </span>'),JW=ke('<p class="text-sm text-base-content/60 truncate mt-0.5"> </p>'),QW=ke('<div class="flex-shrink-0"><svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg></div>'),eH=ke('<div><div class="relative w-8 h-8 flex-shrink-0"><!></div> <div class="flex-1 min-w-0"><div class="flex items-center gap-2"><h3 class="font-medium text-base"> </h3> <span class="text-xs text-base-content/50"> </span> <!></div> <!></div> <!></div>'),tH=ke('<div class="flex items-center justify-center py-4"><div class="flex items-center gap-3 text-base-content/60"><div class="relative"><div class="w-6 h-6 border-2 border-primary/20 border-t-primary rounded-full animate-spin"></div> <div class="absolute inset-0 w-6 h-6 border-2 border-transparent border-t-primary/60 rounded-full animate-spin" style="animation-delay: -0.15s;"></div></div> <span class="text-sm">Loading more symbols…</span></div></div>'),nH=ke('<div class="divide-y divide-base-300/20"><!> <!></div>'),sH=ke('<div class="flex flex-col gap-6"><div class="relative"><div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-base-content/50 pointer-events-none"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <input type="text" class="w-full pl-12 pr-4 py-3 text-sm bg-base-100 border border-base-300/50 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200 placeholder:text-base-content/50" placeholder="Search symbols..."></div> <div class="relative rounded-lg overflow-hidden bg-base-100 border border-base-300/30"><div class="h-96 overflow-y-auto luxury-scrollbar svelte-1r1pdks"><!></div></div> <div class="flex justify-center items-center py-2 mt-1"><div class="group relative cursor-pointer"><div class="absolute inset-0 bg-gradient-to-r from-transparent via-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-700 ease-out blur-xl"></div> <div class="relative flex items-center gap-2 px-4 py-1.5 rounded-full bg-gradient-to-r from-base-100/80 to-base-200/60 backdrop-blur-sm border border-base-300/30 shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-500 ease-out"><div class="w-2 h-2 rounded-full bg-gradient-to-r from-primary to-secondary animate-pulse"></div> <span class="text-sm font-medium text-base-content/70 group-hover:text-primary transition-colors duration-300">Powered by</span> <span class="text-sm font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent group-hover:from-secondary group-hover:to-primary transition-all duration-500">Duty AI</span> <div class="w-2 h-2 rounded-full bg-gradient-to-r from-secondary to-primary animate-pulse" style="animation-delay: 0.5s;"></div></div></div></div></div>'),oH=ke("<div><!></div>");function iH(n,e){Ed(e,!0);const t=sm(),s=()=>wl(A,"$save",t),o=()=>wl(c,"$keyword",t),r=()=>wl(I,"$ctx",t);let a=hi(e,"show",15);const l=r4();let c=$m(""),f=ge(V([]));const u=50;let d=ge(u),h=ge(!1),m,g=null,w=ge(V([])),C=ge(-1),P=!1;const I=gd("ctx"),A=gd("save"),M=gd("datafeed"),F=6,B=new Set;Fr(()=>{if(a()){if(console.log("🔍 Modal opened! Available symbols:",s().allSymbols.length),console.log("🔍 Current symbol:",s().symbol),x(f,V(s().allSymbols)),x(d,u),x(C,-1),!P){P=!0;const oe=s().symbol.shortName||s().symbol.ticker||"";c.set(oe),r2().then(()=>{g&&(g.focus(),g.select())})}}else P=!1}),Fr(()=>{x(w,V(i(f).slice(0,i(d))))}),Fr(()=>{if(!a())return;const oe=i(w).slice(0,F);if(oe.length)for(const Pe of oe)ue(Pe)}),typeof window<"u"&&(window.testSymbolChange=()=>{if(s().allSymbols.length>0){const oe=s().allSymbols[1];console.log("🧪 Testing symbol change to:",oe),le(oe)}else console.log("🧪 No symbols available for testing")});function $(oe){return oe.toLowerCase().replace(/[^\p{L}\p{N}]+/gu," ").trim()}function L(oe){return $(oe).split(/\s+/).filter(Boolean).map($e=>$e[0]).join("")}function O(oe,Pe){const $e=oe.length,ze=Pe.length;if($e===0)return ze;if(ze===0)return $e;const Ke=new Array(ze+1);for(let qe=0;qe<=ze;(qe+=1)-1)Ke[qe]=qe;for(let qe=1;qe<=$e;(qe+=1)-1){let nt=qe-1;Ke[0]=qe;for(let ft=1;ft<=ze;(ft+=1)-1){const ut=Ke[ft],bt=oe[qe-1]===Pe[ft-1]?0:1;Ke[ft]=Math.min(Ke[ft]+1,Ke[ft-1]+1,nt+bt),nt=ut}}return Ke[ze]}function Y(oe,Pe){const $e=Math.max(oe.length,Pe.length);return $e===0?1:1-O(oe,Pe)/$e}function ce(oe,Pe){if(!Pe||!Pe.trim())return oe;const ze=$(Pe).split(/\s+/).filter(Boolean);return oe.map(qe=>{const nt=qe.ticker.toLowerCase(),ft=qe.shortName||"";ft.toLowerCase();const ut=$(ft),bt=ut.split(/\s+/).filter(Boolean),Pt=(qe.exchange||"").toLowerCase(),Et=L(ft);let Mt=0,Je=0;for(const Ct of ze){let Ze=0;nt===Ct?Ze+=1200:nt.startsWith(Ct)?Ze+=800:nt.includes(Ct)?Ze+=600:Et===Ct||Et.startsWith(Ct)?Ze+=450:ut.startsWith(Ct)?Ze+=500:ut.includes(Ct)?Ze+=300:Pt.includes(Ct)?Ze+=80:Q(nt,Ct)?Ze+=60:Q(ut,Ct)&&(Ze+=40);const Xe=Y(nt,Ct);Xe>.5&&(Ze+=Math.floor(Xe*300));let Ae=0;for(const Qe of bt){const gt=Y(Qe,Ct);if(gt>Ae&&(Ae=gt),Ae>=.92)break}Ae>.5&&(Ze+=Math.floor(Ae*200)),Ze>0&&(Je+=1),Mt+=Ze}return Je===ze.length?Mt+=100:Mt+=Je*50,Mt>0&&nt.length<=5&&(Mt+=20),{symbol:qe,score:Mt}}).filter(qe=>qe.score>0).sort((qe,nt)=>nt.score!==qe.score?nt.score-qe.score:qe.symbol.ticker.localeCompare(nt.symbol.ticker)).map(qe=>qe.symbol)}function Q(oe,Pe){let $e=0;for(let ze=0;ze<oe.length&&$e<Pe.length;(ze+=1)-1)oe[ze]===Pe[$e]&&($e+=1);return $e===Pe.length}c.subscribe(oe=>{if(!oe||!oe.trim()){x(f,V(s().allSymbols)),x(d,u),x(C,-1);return}x(f,V(ce(s().allSymbols,oe))),x(d,u),x(C,-1)});function le(oe){try{ue(oe)}catch{}try{b3({logo:oe.logo,logo2:oe.logo2})}catch{}Dc(A,qo(s).symbol=oe,qo(s)),a(!1)}function ue(oe){var ze,Ke,qe,nt,ft,ut,bt,Pt;if(!M||!(oe!=null&&oe.ticker))return;const Pe=((Ke=(ze=s())==null?void 0:ze.period)==null?void 0:Ke.timeframe)||"1m",$e=`${oe.ticker}|${Pe}`;if(!B.has($e)){B.add($e);try{(qe=M.startBackgroundPrefetch)==null||qe.call(M,oe,{timeframe:Pe})}catch{}try{const Et=Number(((ft=(nt=s())==null?void 0:nt.period)==null?void 0:ft.secs)||60)*1e3,Mt=Date.now()-Et*600;(Pt=(bt=(ut=M.ensureHistoryBefore)==null?void 0:ut.call(M,oe,Pe,Mt))==null?void 0:bt.catch)==null||Pt.call(bt,()=>{})}catch{}}}async function fe(){i(h)||i(d)>=i(f).length||(x(h,!0),await new Promise(oe=>setTimeout(oe,250)),x(d,V(Math.min(i(d)+u,i(f).length))),x(h,!1))}function pe(oe){const Pe=oe.currentTarget;Pe.scrollTop+Pe.clientHeight>=Pe.scrollHeight-24&&fe()}var Z=oH();Z.__keydown=[qW,a,w,C,le];var xe=y(Z);tg(xe,{title:l,width:650,maxHeight:"85vh",get show(){return a()},set show(oe){a(oe)},get theme(){return s().theme},buttons:[],children:(oe,Pe)=>{var $e=sH(),ze=y($e),Ke=v(y(ze),2);xn(Ke),a3(Ke,!0),tp(Ke,ut=>g=ut,()=>g),_(ze);var qe=v(ze,2),nt=y(qe),ft=y(nt);Ue(ft,()=>r().loadingPairs,ut=>{var bt=UW();q(ut,bt)},ut=>{var bt=Qn(),Pt=fn(bt);Ue(Pt,()=>i(f).length===0,Et=>{var Mt=GW();q(Et,Mt)},Et=>{var Mt=nH(),Je=y(Mt);Yo(Je,17,()=>i(w),Ii,(Ze,Xe,Ae)=>{var Qe=eH();Qe.__click=[YW,le,Xe];var gt=y(Qe),Ft=y(gt);Ue(Ft,()=>i(Xe).logo2,On=>{var bn=KW(),Fn=fn(bn),Xs=y(Fn);_(Fn);var oo=v(Fn,2),Yn=y(oo);_(oo),Ce(()=>{Ot(Xs,"src",`${i(Xe).logo}`),Ot(Xs,"alt",i(Xe).ticker),Ot(Yn,"src",`${i(Xe).logo2}`),Ot(Yn,"alt",i(Xe).ticker)}),vd("error",Xs,_o=>{_o.target.style.display="none"}),q2(Xs),vd("error",Yn,_o=>{_o.target.style.display="none"}),q2(Yn),q(On,bn)},On=>{var bn=XW(),Fn=y(bn),Xs=v(Fn,2),oo=y(Xs),Yn=y(oo,!0);Ce(()=>tt(Yn,i(Xe).ticker.charAt(0))),_(oo),_(Xs),_(bn),Ce(()=>{Ot(Fn,"src",`${i(Xe).logo}`),Ot(Fn,"alt",i(Xe).ticker)}),vd("error",Fn,_o=>{const xs=_o.target;if(xs){xs.style.display="none";const Rt=xs.nextElementSibling;Rt&&(Rt.style.display="flex")}}),q2(Fn),q(On,bn)}),_(gt);var ot=v(gt,2),ve=y(ot),Ie=y(ve),It=y(Ie,!0);_(Ie);var Dt=v(Ie,2),Zt=y(Dt,!0);_(Dt);var gn=v(Dt,2);Ue(gn,()=>i(Xe).type,On=>{var bn=ZW(),Fn=y(bn,!0);_(bn),Ce(()=>tt(Fn,i(Xe).type)),q(On,bn)}),_(ve);var hn=v(ve,2);Ue(hn,()=>i(Xe).shortName&&i(Xe).shortName!==i(Xe).ticker,On=>{var bn=JW(),Fn=y(bn,!0);_(bn),Ce(()=>tt(Fn,i(Xe).shortName)),q(On,bn)}),_(ot);var qn=v(ot,2);Ue(qn,()=>i(C)===Ae,On=>{var bn=QW();q(On,bn)}),_(Qe),Ce(()=>{pi(Qe,`group flex items-center gap-3 px-4 py-3 cursor-pointer transition-all duration-200
                         ${(i(C)===Ae?"bg-primary/10 text-primary border-l-2 border-primary":"hover:bg-base-200/50 text-base-content")??""}`),tt(It,i(Xe).ticker),tt(Zt,i(Xe).exchange)}),vd("mouseenter",Qe,()=>ue(i(Xe))),q(Ze,Qe)});var Ct=v(Je,2);Ue(Ct,()=>i(h),Ze=>{var Xe=tH();q(Ze,Xe)}),_(Mt),q(Et,Mt)},!0),q(ut,bt)}),_(nt),tp(nt,ut=>m=ut,()=>m),_(qe),Zi(2),_($e),Bs(Ke,o,ut=>l3(c,ut)),vd("scroll",nt,pe),q(oe,$e)},$$slots:{default:!0}}),_(Z),q(n,Z),$d()}Ip(["keydown","click"]);var rH=(n,e,t)=>e(i(t)),aH=ke('<li class="w-[140px] h-[85px] flex items-center justify-center cursor-pointer rounded-lg svelte-18wwyns"><span> </span></li>'),lH=ke('<div class="p-2"><ul class="flex flex-wrap justify-center gap-2"></ul></div>');function cH(n,e){Ed(e,!0);const t=sm(),s=()=>wl(l,"$save",t),o=()=>wl(c,"$isRenkoActive",t);let r=hi(e,"show",15);const a=o4(),l=gd("save"),c=_p(l,h=>{var m,g;return((g=(m=h.styles)==null?void 0:m.candle)==null?void 0:g.type)==="renko_atr"}),f=[{timeframe:"1m",multiplier:1,timespan:"minute",secs:60},{timeframe:"5m",multiplier:5,timespan:"minute",secs:300},{timeframe:"15m",multiplier:15,timespan:"minute",secs:900},{timeframe:"30m",multiplier:30,timespan:"minute",secs:1800},{timeframe:"1h",multiplier:1,timespan:"hour",secs:3600},{timeframe:"4h",multiplier:4,timespan:"hour",secs:14400},{timeframe:"1d",multiplier:1,timespan:"day",secs:86400},{timeframe:"1w",multiplier:1,timespan:"week",secs:604800},{timeframe:"1M",multiplier:1,timespan:"month",secs:2592e3}];function u(h){var m;Dc(l,qo(s).period=h,qo(s));try{const g=(m=s())!=null&&m.key&&typeof s().key=="string"?s().key:"chart";typeof localStorage<"u"&&localStorage.setItem(`${g}.lastTimeframe`,(h==null?void 0:h.timeframe)||"")}catch{}try{ww.set(h)}catch{}r(!1)}function d(h){switch(h){case"minute":return h4();case"hour":return v4();case"day":return g4();case"week":return _4();case"month":return y4();default:return h}}tg(n,{title:a,width:500,get show(){return r()},set show(h){r(h)},get theme(){return s().theme},buttons:[],children:(h,m)=>{var g=lH(),w=y(g);Yo(w,21,()=>f,Ii,(C,P)=>{var I=Qn(),A=fn(I);Ue(A,()=>!(o()&&i(P).timeframe==="4h"),M=>{var F=aH();F.__click=[rH,u,P];var B=y(F),$=y(B);Ce(()=>tt($,`${i(P).multiplier??""} ${d(i(P).timespan)??""}`)),_(B),_(F),Ce(()=>{var L,O,Y;wr(F,"hover:bg-base-200",i(P).timeframe!==((L=s().period)==null?void 0:L.timeframe)),wr(F,"bg-primary",i(P).timeframe===((O=s().period)==null?void 0:O.timeframe)),wr(F,"text-primary-content",i(P).timeframe===((Y=s().period)==null?void 0:Y.timeframe))}),q(M,F)}),q(C,I)}),_(w),_(g),q(h,g)},$$slots:{default:!0}}),$d()}Ip(["click"]);const uH=n=>n;function D8(n){const e=n-1;return e*e*e+1}function p5(n){const e=typeof n=="string"&&n.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[n,"px"]}function y_(n,{delay:e=0,duration:t=400,easing:s=uH}={}){const o=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:s,css:r=>`opacity: ${r*o}`}}function gy(n,{delay:e=0,duration:t=400,easing:s=D8,x:o=0,y:r=0,opacity:a=0}={}){const l=getComputedStyle(n),c=+l.opacity,f=l.transform==="none"?"":l.transform,u=c*(1-a),[d,h]=p5(o),[m,g]=p5(r);return{delay:e,duration:t,easing:s,css:(w,C)=>`
			transform: ${f} translate(${(1-w)*d}${h}, ${(1-w)*m}${g});
			opacity: ${c-u*C}`}}function dH(n,{delay:e=0,duration:t=400,easing:s=D8,axis:o="y"}={}){const r=getComputedStyle(n),a=+r.opacity,l=o==="y"?"height":"width",c=parseFloat(r[l]),f=o==="y"?["top","bottom"]:["left","right"],u=f.map(P=>`${P[0].toUpperCase()}${P.slice(1)}`),d=parseFloat(r[`padding${u[0]}`]),h=parseFloat(r[`padding${u[1]}`]),m=parseFloat(r[`margin${u[0]}`]),g=parseFloat(r[`margin${u[1]}`]),w=parseFloat(r[`border${u[0]}Width`]),C=parseFloat(r[`border${u[1]}Width`]);return{delay:e,duration:t,easing:s,css:P=>`overflow: hidden;opacity: ${Math.min(P*20,1)*a};${l}: ${P*c}px;padding-${f[0]}: ${P*d}px;padding-${f[1]}: ${P*h}px;margin-${f[0]}: ${P*m}px;margin-${f[1]}: ${P*g}px;border-${f[0]}-width: ${P*w}px;border-${f[1]}-width: ${P*C}px;`}}function kw(n){const e=n-1;return e*e*e+1}const Mx={CURRENT_VERSION:1,DEFAULT_FUTURE_MARGIN_MS:30*60*1e3,MAX_FUTURE_MARGIN_MS:24*60*60*1e3,MIN_FUTURE_MARGIN_MS:5*60*1e3,DEFAULT_FUTURE_MARGIN_PERCENT:.2,TIMESTAMP_PRECISION:1,PRICE_PRECISION:1e-6};function I2(n,e){try{const{chart:t,paneId:s="candle_pane"}=e,o={timestamp:n.t,value:n.p},r=t.convertToPixel(o,{paneId:s,absolute:!0});if(!r||typeof r!="object")return null;const a=Array.isArray(r)?r[0]:r;return!a||typeof a!="object"||typeof a.x!="number"||typeof a.y!="number"||!isFinite(a.x)||!isFinite(a.y)?null:{x:a.x,y:a.y}}catch(t){return console.error("Error converting data-space to screen-space:",t),null}}function fH(n,e,t){try{const{chart:s,paneId:o="candle_pane"}=e,r=s.convertFromPixel([n],{paneId:o});if(!r||!Array.isArray(r)||r.length===0||!r[0])return null;const a=r[0];return typeof a.timestamp!="number"||typeof a.value!="number"||!isFinite(a.timestamp)||!isFinite(a.value)?null:{id:t||pH(),t:Math.round(a.timestamp),p:a.value}}catch(s){return console.error("Error converting screen-space to data-space:",s),null}}function R8(n,e){const t=[];let s=!0,o=!0;for(const r of n){const a=I2(r,e);if(!a){o=!1,t.push({x:0,y:0});continue}t.push(a),(a.x<-100||a.x>1e4||a.y<-100||a.y>1e4)&&(s=!1)}return{screenPoints:t,isVisible:s,isValid:o}}function m5(n,e,t={}){var s,o,r,a,l;try{const c={minMarginMs:Mx.MIN_FUTURE_MARGIN_MS,maxMarginMs:Mx.MAX_FUTURE_MARGIN_MS,defaultMarginPercent:Mx.DEFAULT_FUTURE_MARGIN_PERCENT,...t},f=e.getDataList();if(!f||f.length===0)return;const u=f[f.length-1],d=typeof(u==null?void 0:u.timestamp)=="number"?u.timestamp:null;if(!d||!isFinite(d))return;let h=Number.NEGATIVE_INFINITY;for(const ue of n)typeof ue.t=="number"&&isFinite(ue.t)&&ue.t>h&&(h=ue.t);if(!Number.isFinite(h)||h<=d)return;const m=Math.max(0,h-d);if(m<=0)return;const g=e.getVisibleRange();let w=0;if(g&&f.length>1){const ue=(s=f[Math.max(0,Math.min(f.length-1,g.from))])==null?void 0:s.timestamp,fe=(o=f[Math.max(0,Math.min(f.length-1,g.to))])==null?void 0:o.timestamp;typeof ue=="number"&&typeof fe=="number"&&isFinite(ue)&&isFinite(fe)&&(w=Math.max(0,fe-ue))}const C=w>0?Math.floor(w*c.defaultMarginPercent):Math.floor(m*c.defaultMarginPercent),P=Math.min(Math.max(c.minMarginMs,C),c.maxMarginMs),I=Math.min(m+P,c.maxMarginMs),A=d+I,M=u.timestamp;if(M>=A)return;const F=[];for(let ue=Math.max(0,f.length-10);ue<f.length-1;ue++){const fe=(r=f[ue])==null?void 0:r.timestamp,pe=(a=f[ue+1])==null?void 0:a.timestamp;if(typeof fe=="number"&&typeof pe=="number"){const Z=pe-fe;isFinite(Z)&&Z>0&&F.push(Z)}}const B=F.length?F.sort((ue,fe)=>ue-fe)[Math.floor(F.length/2)]:6e4;if(!B||!isFinite(B)||B<=0)return;const $=Math.max(0,Math.ceil((A-M)/B));if($<=0)return;const L=typeof(u==null?void 0:u.close)=="number"?u.close:typeof(u==null?void 0:u.open)=="number"?u.open:0,O=[];for(let ue=1;ue<=$;ue++){const fe=M+ue*B;O.push({timestamp:fe,open:L,high:L,low:L,close:L,volume:0})}const Y=e.getVisibleRange(),ce=Y?Y.to>=f.length-2:!0,Q=[...f,...O];e.applyNewData(Q,!1);try{(Q??[]).length>0&&(window.hasFirstDataLoaded=!0)}catch{}const le=ce?Q.length-1:Y?Y.to:Q.length-1;try{e.scrollToDataIndex(le)}catch{const ue=(l=Q[le])==null?void 0:l.timestamp;if(typeof ue=="number")try{e.scrollToTimestamp(ue)}catch{}}}catch{}}function pH(){return`point_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}class mH{constructor(e){Te(this,"chart");Te(this,"context");this.chart=e,this.context={chart:e}}enhanceTemplate(e){const t={...e,originalTemplate:e,createPointFigures:s=>{var a,l;const{overlay:o,coordinates:r}=s;if(this.isDataSpaceOverlay(o)){const c=o,f=R8(c.points,this.context);return f.isValid?t.createDataSpaceFigures?t.createDataSpaceFigures({overlay:c,chart:this.chart,projectionResult:f,screenCoordinates:f.screenPoints}):((a=e.createPointFigures)==null?void 0:a.call(e,{...s,coordinates:f.screenPoints}))||[]:[]}if(t.createDataSpaceFigures){const c={screenPoints:r||[],isVisible:!0,isValid:Array.isArray(r)&&r.length>0};return t.createDataSpaceFigures({overlay:o,chart:this.chart,projectionResult:c,screenCoordinates:c.screenPoints})}return((l=e.createPointFigures)==null?void 0:l.call(e,s))||[]}};return t}createDataSpaceTemplate(e,t){const s={name:e,totalStep:t.totalStep,needDefaultPointFigure:t.needDefaultPointFigure??!0,needDefaultXAxisFigure:t.needDefaultXAxisFigure??!0,needDefaultYAxisFigure:t.needDefaultYAxisFigure??!0,styles:t.styles,onDrawStart:t.onDrawStart,onDrawing:t.onDrawing,onDrawEnd:t.onDrawEnd,onClick:t.onClick,onDoubleClick:t.onDoubleClick,onRightClick:t.onRightClick,onPressedMoveStart:t.onPressedMoveStart,onPressedMoving:t.onPressedMoving,onPressedMoveEnd:t.onPressedMoveEnd,onMouseEnter:t.onMouseEnter,onMouseLeave:t.onMouseLeave,onSelected:t.onSelected,onDeselected:t.onDeselected};return this.enhanceTemplate({...s,createDataSpaceFigures:t.createDataSpaceFigures})}isDataSpaceOverlay(e){return e&&typeof e=="object"&&"points"in e&&Array.isArray(e.points)&&e.points.length>0&&e.points.every(t=>t&&typeof t=="object"&&"t"in t&&"p"in t&&"id"in t&&typeof t.t=="number"&&typeof t.p=="number"&&typeof t.id=="string")}screenToDataSpace(e){return[]}updateChart(e){this.chart=e,this.context={chart:e}}}let h5=null;function j8(n){return h5=new mH(n),h5}const uy={windowBars:120,horizons:[5,10,20],topK:200,stride:1,distance:"cosine",halfLifeBars:500,atrLen:14,rsiLen:14,adxLen:14,avwapAnchors:["sessionOpen","prevHigh","prevLow","swingHi","swingLo"],candidateSL:[.6,.8,1,1.25,1.5],useSwingStop:!1,minMatches:100,winsor:.98,bandAlpha:.22,showTable:!0,showBothDirections:!0},B8="npo_mae_settings_v1";function hH(){try{const n=localStorage.getItem(B8);if(!n)return{...uy};const e=JSON.parse(n);return{...uy,...e}}catch{return{...uy}}}function v5(n){try{localStorage.setItem(B8,JSON.stringify(n))}catch{}}function vH(n,e){const t=e.windowBars;if(n.length<t)return new Float32Array;const s=n.length-t,o=n.slice(s),r=A=>{const M=[];for(let F=A;F<o.length;F++){const B=(o[F].close-o[F-A].close)/Math.max(1e-8,o[F-A].close);M.push(B)}return M},a=r(1),l=r(2),c=r(3),f=r(5),u=[];for(let A=0;A<o.length;A++){const M=e.atrLen,F=Math.max(0,A-M+1);let B=0,$=0;for(let L=F;L<=A;L++){const O=o[L].high,Y=o[L].low;B+=Math.max(0,O-Y),$++}u.push(B/Math.max(1,$))}const h=((A,M)=>{const F=[];for(let B=0;B<A.length;B++){const $=Math.max(0,B-M+1),L=A[$],O=A[B];F.push(O-L)}return F})(u,5),m=[];for(let A=0;A<o.length;A++){const M=o[A],F=Math.max(1e-8,M.high-M.low),B=Math.abs(M.close-M.open);m.push(B/F)}const g=[...a,...l,...c,...f,...u,...h,...m],w=g.reduce((A,M)=>A+M,0)/Math.max(1,g.length),C=Math.sqrt(g.reduce((A,M)=>A+Math.pow(M-w,2),0)/Math.max(1,g.length)),I=g.map(A=>(A-w)/(C>1e-8?C:1)).map(A=>Math.max(-5,Math.min(5,A)));return new Float32Array(I)}function Sw(n){const e=n.getDataList();if(!e||e.length===0)return null;const t=e[e.length-1];return{timestamp:t.timestamp,price:t.close}}function gH(n,e,t,s="candle_pane"){try{const o=n.convertToPixel({timestamp:e,value:t},{paneId:s}),r=Array.isArray(o)?o[0]:o;return(r==null?void 0:r.y)??null}catch{return null}}function _H(n){try{const e=n.getSize(),t=n.getVisibleRange();if(!e||!t)return 4;const s=Math.max(1,t.to-t.from+1);return e.width/s}catch{return 4}}function yH(n){try{const e=n.getDataList();if(!e||e.length<2)return 0;const t=Math.min(10,e.length-1);let s=0;for(let r=e.length-t;r<e.length-1;r++){const a=e[r],l=e[r+1],c=Math.max(0,((l==null?void 0:l.timestamp)??0)-((a==null?void 0:a.timestamp)??0));s+=c}const o=s/Math.max(1,t);return isFinite(o)&&o>0?o:0}catch{return 0}}function bH(n){return j8(n).createDataSpaceTemplate("NearestPatternOutcomeMaeStop",{totalStep:1,needDefaultPointFigure:!0,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createDataSpaceFigures:({overlay:s,screenCoordinates:o,chart:r})=>{var ce,Q,le,ue,fe,pe;const a=[];if(o.length<1)return a;const l=o[0],c=s.extendData;if(!c)return a;const f=_H(r),u=Sw(r);if(!u)return a;const d=u.timestamp,h=u.price,m=c.forwardPathMedianR||[],g=c.forwardPathP10R||[],w=c.forwardPathP90R||[],C=m.map(Z=>h+Z),P=g.map(Z=>h+Z),I=w.map(Z=>h+Z),A=c.bandAlpha??uy.bandAlpha,M=Z=>gH(r,d,Z),F=yH(r),B=(Z,xe)=>{const oe=d+(F>0?Z*F:0);try{const Pe=r.convertToPixel({timestamp:oe,value:xe},{paneId:"candle_pane"}),$e=Array.isArray(Pe)?Pe[0]:Pe,ze=($e==null?void 0:$e.y)??M(xe);return{x:($e==null?void 0:$e.x)??l.x+Z*f,y:ze??l.y}}catch{const Pe=M(xe);return{x:l.x+Z*f,y:Pe??l.y}}};if(C.length>0){const Z=c.styles&&c.styles.median||{},xe=typeof Z.size=="number"?Z.size:1,oe=typeof Z.style=="string"?Z.style:"solid";for(let Pe=0;Pe<C.length-1;Pe++){const $e=B(Pe,C[Pe]),ze=B(Pe+1,C[Pe+1]);a.push({type:"line",attrs:{coordinates:[$e,ze]},styles:{color:((ce=c.colors)==null?void 0:ce.median)||"#66c2a5",size:xe,style:oe}})}}if(P.length>0&&I.length>0&&c.showOutcomeBand!==!1){const Z=[];for(let oe=0;oe<I.length;oe++)Z.push(B(oe,I[oe]));for(let oe=P.length-1;oe>=0;oe--)Z.push(B(oe,P[oe]));const xe=c.colors&&c.colors.band||`rgba(102, 194, 165, ${A})`;a.push({type:"polygon",attrs:{coordinates:Z},styles:{color:xe}})}const $=c.selectedSL,L=c.lastAtr,O=$&&typeof L=="number"?h-$*L:void 0;if(c.showStopLines!==!1&&typeof O=="number"){const Z=M(O);if(Z!=null){const xe=r.getSize(),oe=(xe==null?void 0:xe.width)??0,Pe=c.styles&&c.styles.slLong||{},$e=typeof Pe.size=="number"?Pe.size:1,ze=typeof Pe.style=="string"?Pe.style:"dashed";a.push({type:"line",attrs:{coordinates:[{x:0,y:Z},{x:oe,y:Z}]},styles:{color:((Q=c.colors)==null?void 0:Q.slLong)||"#e67e22",style:ze,size:$e}});const Ke=(O??0).toFixed(2);a.push({type:"text",attrs:{x:oe-4,y:Z,text:`SL L ${Ke}`},styles:{color:((le=c.colors)==null?void 0:le.slLong)||"#e67e22",backgroundColor:"transparent",align:"right",size:11}})}}const Y=$&&typeof L=="number"?h+$*L:void 0;if(c.showStopLines!==!1&&typeof Y=="number"){const Z=M(Y);if(Z!=null){const xe=r.getSize(),oe=(xe==null?void 0:xe.width)??0,Pe=c.styles&&c.styles.slShort||{},$e=typeof Pe.size=="number"?Pe.size:1,ze=typeof Pe.style=="string"?Pe.style:"dashed";a.push({type:"line",attrs:{coordinates:[{x:0,y:Z},{x:oe,y:Z}]},styles:{color:((ue=c.colors)==null?void 0:ue.slShort)||"#c0392b",style:ze,size:$e}});const Ke=(Y??0).toFixed(2);a.push({type:"text",attrs:{x:oe-4,y:Z,text:`SL S ${Ke}`},styles:{color:((fe=c.colors)==null?void 0:fe.slShort)||"#c0392b",backgroundColor:"transparent",align:"right",size:11}})}}if(c.showTable&&Array.isArray(c.evTable)){const Z=r.getSize(),xe=(Z==null?void 0:Z.width)??0,oe=240,Pe=10,$e=10,ze=18,Ke=Math.min(c.evTable.length,6),qe=20,nt=$e*2+qe+Ke*ze,ft=12,bt=Math.max(ft,xe-oe-ft-80),Pt=10,Et=typeof document<"u"&&((pe=document==null?void 0:document.documentElement)==null?void 0:pe.getAttribute("data-theme"))||"",Mt=String(Et).toLowerCase().includes("dark"),Je=Mt?"rgba(16,20,30,0.85)":"rgba(245,247,255,0.95)",Ct=Mt?"rgba(140,160,220,0.35)":"rgba(80,100,160,0.35)",Ze=Mt?"rgba(28,34,50,0.90)":"rgba(232,236,250,0.90)",Xe=Mt?"#a7b3d8":"#415277",Ae=Mt?"#cfd6ee":"#1f2937";a.push({type:"rect",attrs:{x:bt,y:Pt,width:oe,height:nt},styles:{style:"fill",color:Je}}),a.push({type:"rect",attrs:{x:bt,y:Pt,width:oe,height:nt},styles:{style:"stroke",color:Ct,borderSize:1,borderStyle:"solid"}});const Qe=oe-Pe*2,gt=Ie=>Math.min(bt+oe-Pe-4,Ie),Ft={mark:gt(bt+Pe),side:gt(bt+Pe+12),mult:gt(bt+Pe+Qe*.1),ev:gt(bt+Pe+Qe*.35),pwin:gt(bt+Pe+Qe*.55),winr:gt(bt+Pe+Qe*.72),lossr:gt(bt+Pe+Qe*.88)};let ot=Pt+$e+2;a.push({type:"rect",attrs:{x:bt+1,y:Pt+1,width:oe-2,height:qe},styles:{style:"fill",color:Ze}}),a.push({type:"text",attrs:{x:Ft.mult,y:ot,text:"SL"},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ft.ev,y:ot,text:"EV"},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ft.pwin,y:ot,text:"pWin"},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ft.winr,y:ot,text:"winR"},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ft.lossr,y:ot,text:"lossR"},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),ot+=qe-6;for(let Ie=0;Ie<Ke;Ie++){const It=c.evTable[Ie],Dt=c.selectedSL===It.mult;a.push({type:"text",attrs:{x:Ft.mark,y:ot,text:Dt?"▶":"•"},styles:{color:Ae,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ft.side,y:ot,text:It.side==="long"?"L":"S"},styles:{color:Ae,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ft.mult,y:ot,text:`${It.mult.toFixed(2)}×`},styles:{color:Ae,size:12,backgroundColor:"transparent"}});const Zt=`${It.ev>=0?"+":""}${It.ev.toFixed(2)}`;a.push({type:"text",attrs:{x:Ft.ev,y:ot,text:Zt},styles:{color:Ae,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ft.pwin,y:ot,text:`${Math.round(It.pWin*100)}%`},styles:{color:Ae,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ft.winr,y:ot,text:It.avgWinR.toFixed(2)},styles:{color:Ae,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ft.lossr,y:ot,text:It.avgLossR.toFixed(2)},styles:{color:Ae,size:12,backgroundColor:"transparent"}}),ot+=ze}const ve=(()=>{const Ie=c.selectedSide;return c.evTable.find(Dt=>Dt.mult===c.selectedSL&&(!Ie||Dt.side===Ie))||c.evTable.find(Dt=>Dt.mult===c.selectedSL)||null})();if(ve){const It=Pt+nt+6,Dt=86,Zt=ve.side==="long"?"Long":"Short",gn=`${ve.mult.toFixed(2)}× ATR`,hn=h.toFixed(2),qn=(ve.side==="long"?h-ve.mult*(L??0):h+ve.mult*(L??0)).toFixed(2),On=Math.round((ve.pWin??0)*100);a.push({type:"rect",attrs:{x:bt,y:It,width:oe,height:Dt},styles:{style:"fill",color:Mt?"rgba(16,20,30,0.85)":"rgba(245,247,255,0.95)"}}),a.push({type:"rect",attrs:{x:bt,y:It,width:oe,height:Dt},styles:{style:"stroke",color:Ct,borderSize:1,borderStyle:"solid"}});let bn=It+8+2;a.push({type:"text",attrs:{x:bt+8,y:bn,text:`Active: ${Zt}`},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),bn+=18,a.push({type:"text",attrs:{x:bt+8,y:bn,text:`Anchor: ${hn}`},styles:{color:Ae,size:12,backgroundColor:"transparent"}}),bn+=18,a.push({type:"text",attrs:{x:bt+8,y:bn,text:`Stop: ${qn} (${gn})`},styles:{color:Ae,size:12,backgroundColor:"transparent"}}),bn+=18,a.push({type:"text",attrs:{x:bt+8,y:bn,text:`pWin ${On}% • winR ${ve.avgWinR.toFixed(2)} • lossR ${ve.avgLossR.toFixed(2)}`},styles:{color:Ae,size:12,backgroundColor:"transparent"}});const Fn=Math.abs(h-(ve.side==="long"?h-ve.mult*(L??0):h+ve.mult*(L??0))),Xs=w.length&&g.length?Math.max(0,(w[0]??0)-(g[0]??0)):0,oo=Xs<=1,Yn=Xs>=2,_o=ve.side==="long"&&(ve.ev??0)>=.15&&(ve.pWin??0)>=.52&&!Yn,xs=ve.side==="short"&&(ve.ev??0)>=.1&&(ve.pWin??0)>=.5&&!Yn,Rt=_o?"BUY":xs?"SELL":"WAIT",un=_o?"#10b981":xs?"#ef4444":Mt?"#f59e0b":"#b45309",qs=It+Dt+6,ri=74,Eo=Mt?"rgba(20,24,32,0.85)":"rgba(240,244,255,0.95)";a.push({type:"rect",attrs:{x:bt,y:qs,width:oe,height:ri},styles:{style:"fill",color:Eo}}),a.push({type:"rect",attrs:{x:bt,y:qs,width:oe,height:ri},styles:{style:"stroke",color:Ct,borderSize:1,borderStyle:"solid"}});let Ia=qs+8+2;a.push({type:"text",attrs:{x:bt+8,y:Ia,text:`Action: ${Rt}`},styles:{color:un,size:13,backgroundColor:"transparent"}}),Ia+=18;const Lr=oo?"Band: Narrow":Yn?"Band: Wide":"Band: Normal",Qa=`1R: ${Fn.toFixed(2)}`,yr=_o?"EV≥0.30, pWin≥55%":xs?"EV≥0.20, pWin≥50%":"Low EV / Wide band / Low pWin";a.push({type:"text",attrs:{x:bt+8,y:Ia,text:`${Lr} • ${Qa}`},styles:{color:Ae,size:12,backgroundColor:"transparent"}}),Ia+=18,a.push({type:"text",attrs:{x:bt+8,y:Ia,text:yr},styles:{color:Xe,size:12,backgroundColor:"transparent"}})}}return a},onClick:s=>{var c;const o=s.overlay.extendData;if(!o||!Array.isArray(o.evTable))return!0;const a=(o.evTable.findIndex(f=>f.mult===o.selectedSL)+1)%o.evTable.length,l=o.evTable[a];return l&&(o.selectedSL=l.mult,o.selectedSide=l.side,(c=s.chart)==null||c.overrideOverlay({id:s.overlay.id,extendData:o})),!0}})}function xH(){return new Worker(new URL(""+new URL("../workers/npoMae.worker-DaGdsbjp.js",import.meta.url).href,import.meta.url),{type:"module"})}function wH(n,e){const t=bH(n);T3(t);let s={...hH()},o=null,r=!0,a=xH(),l=0,c=-1,f=0,u=!0,d=!0;function h(){var M;if(!o){const F=Sw(n),B=F?[{timestamp:F.timestamp,value:F.price}]:[],$=n.createOverlay({name:"NearestPatternOutcomeMaeStop",points:B});o=Array.isArray($)?($==null?void 0:$[0])??null:$,m();try{const L=e0(),O=((M=L==null?void 0:L.getCurrentSymbol)==null?void 0:M.call(L))||null;L&&O&&o&&L.addDrawing({id:o,symbolKey:O,type:"NearestPatternOutcomeMaeStop",points:F?[{time:F.timestamp,price:F.price}]:[],styles:{},visible:!0})}catch{}}}function m(){var F,B;if(!o)return;const M=Sw(n);if(M)try{const $=(F=n.getOverlays)==null?void 0:F.call(n,{id:o}),L=Array.isArray($)&&$.length>0?$[0]:null,O=(B=L==null?void 0:L.points)==null?void 0:B[0],Y=(O==null?void 0:O.timestamp)??(O==null?void 0:O.time)??(O==null?void 0:O.t),ce=(O==null?void 0:O.value)??(O==null?void 0:O.price)??(O==null?void 0:O.p);if(typeof Y!="number"||typeof ce!="number"||Y!==M.timestamp||Math.abs(ce-M.price)>1e-6){n.overrideOverlay({id:o,points:[{timestamp:M.timestamp,value:M.price}]});try{const le=e0();le&&o&&le.updateDrawing(o,{points:[{time:M.timestamp,price:M.price}]})}catch{}}}catch{}}function g(M){if(!o)return;const F={...M,bandAlpha:s.bandAlpha,showTable:s.showTable,showStopLines:d,showOutcomeBand:u};f&&cancelAnimationFrame(f),f=requestAnimationFrame(()=>{n.overrideOverlay({id:o,extendData:F});try{const B=e0();B&&o&&B.updateDrawing(o,{extendData:F})}catch{}})}function w(){if(!r||!a)return;m();const M=n.getDataList();if(!M||M.length<Math.max(s.windowBars+Math.max(...s.horizons),10)){g({forwardPathMedian:[],forwardPathP10:[],forwardPathP90:[],evTable:[],suggestedSL:null});return}const F=M.map(O=>({time:O.timestamp,open:O.open,high:O.high,low:O.low,close:O.close,volume:O.volume})),B=vH(F,s),$=++l;c=$;const L={id:$,settings:s,features:B,bars:F};a.postMessage(L,[B.buffer])}function C(M){var Y,ce;const F=M.data;if(!F||F.id!==c)return;const B=Math.max(...s.horizons),$=F.byHorizon[B];if(!$)return;const L=F.slSuggest||{},O=kH(n,s.atrLen);g({forwardPathMedianR:$.forwardPathMedian,forwardPathP10R:$.forwardPathP10,forwardPathP90R:$.forwardPathP90,evTable:L.evTable||[],selectedSL:((Y=L.long)==null?void 0:Y.mult)??((ce=L.short)==null?void 0:ce.mult),selectedSide:L.long?"long":L.short?"short":void 0,lastAtr:O})}a&&(a.onmessage=C),h(),w();const P=window.setInterval(()=>{h(),w()},500),I=M=>{M.key==="O"||M.key==="o"?(u=!u,g({})):(M.key==="S"||M.key==="s")&&(d=!d,g({}))};return window.addEventListener("keydown",I,{capture:!0}),{setEnabled(M){r=M,r&&w()},updateSettings(M){s={...s,...M},v5(s),w()},setShowOutcomeBand(M){u=M,g({})},setShowStopLines(M){d=M,g({})},setColors(M){g({colors:M})},setStyles(M){g({styles:M})},resetSettings(){s={...uy},v5(s),w()},getOverlayId(){return o},dispose(){if(window.removeEventListener("keydown",I,{capture:!0}),window.clearInterval(P),a&&(a.terminate(),a=null),o)try{n.removeOverlay({id:o})}catch{}}}}function kH(n,e){const t=n.getDataList();if(!t||t.length===0)return 1;const s=Math.min(e,t.length);let o=0;for(let r=t.length-s;r<t.length;r++){const a=t[r].high,l=t[r].low;o+=Math.max(0,a-l)}return o/Math.max(1,s)}var SH=(n,e)=>x(e,""),CH=ke('<button class="absolute right-4 top-1/2 transform -translate-y-1/2 hover:scale-110 transition-all duration-300 z-10 clear-search-btn svelte-e5btcs" title="Clear search"><svg class="w-4 h-4 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-e5btcs"></path></svg></button>'),IH=(n,e,t,s)=>!i(e)&&t(i(s).is_main,i(s).name),PH=(n,e)=>{n.stopPropagation(),x(e,!0)},MH=ke('<button class="w-8 h-8 rounded-full ml-2 opacity-0 group-hover:opacity-100 hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm info-btn svelte-e5btcs" title="How it works"><svg class="w-4 h-4 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" class="svelte-e5btcs"></circle><line x1="12" y1="16" x2="12" y2="12" class="svelte-e5btcs"></line><line x1="12" y1="8" x2="12.01" y2="8" class="svelte-e5btcs"></line></svg></button>'),NH=(n,e,t)=>{n.stopPropagation(),e(i(t).name)},AH=(n,e,t)=>{n.stopPropagation(),e(i(t).name)},TH=ke('<div class="flex items-center gap-2 ml-4 opacity-100 transition-all duration-300 svelte-e5btcs"><button class="w-8 h-8 rounded-full hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm edit-btn svelte-e5btcs" title="Edit Parameters"><svg class="w-3.5 h-3.5 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" class="svelte-e5btcs"></path></svg></button> <button class="w-8 h-8 rounded-full hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm delete-btn svelte-e5btcs" title="Remove Indicator"><svg class="w-3.5 h-3.5 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-e5btcs"></path></svg></button></div>'),FH=ke('<div><div></div> <div class="flex-1 min-w-0 svelte-e5btcs"><span> </span></div> <!> <!></div>'),LH=ke('<div class="flex flex-col items-center justify-center py-16 text-center svelte-e5btcs"><div class="w-16 h-16 rounded-full bg-base-200/50 flex items-center justify-center mb-4 svelte-e5btcs"><svg class="w-8 h-8 text-base-content/40 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-e5btcs"></path></svg></div> <p class="text-lg font-semibold text-base-content/60 mb-2 svelte-e5btcs">No indicators found</p> <p class="text-sm text-base-content/40 svelte-e5btcs">Try a different search term</p></div>'),EH=ke(`<div class="flex flex-col gap-6 svelte-e5btcs"><div><div class="absolute left-4 top-1/2 transform -translate-y-1/2 pointer-events-none z-10 transition-all duration-300 search-icon svelte-e5btcs"><svg class="w-4 h-4 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-e5btcs"></path></svg></div> <input type="text" class="w-full pl-12 pr-12 py-3.5 text-[15px] font-medium tracking-wide backdrop-blur-sm rounded-2xl
               focus:outline-none transition-all duration-500 ease-out
               placeholder:font-normal search-input svelte-e5btcs"> <!></div> <div class="relative rounded-2xl overflow-hidden backdrop-blur-sm indicator-list-container svelte-e5btcs"><div class="indicator-scroll ultra-minimal-scrollbar svelte-e5btcs"><!> <!></div></div> <div class="flex justify-center items-center py-2 mt-1 svelte-e5btcs"><div class="group relative cursor-pointer svelte-e5btcs"><div class="absolute inset-0 bg-gradient-to-r from-transparent via-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-700 ease-out blur-xl svelte-e5btcs"></div> <div class="relative flex items-center gap-2 px-4 py-1.5 rounded-full bg-gradient-to-r from-base-100/80 to-base-200/60 backdrop-blur-sm border border-base-300/30 shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-500 ease-out svelte-e5btcs"><div class="w-2 h-2 rounded-full bg-gradient-to-r from-primary to-secondary animate-pulse svelte-e5btcs"></div> <span class="text-sm font-medium text-base-content/70 group-hover:text-primary transition-colors duration-300 svelte-e5btcs">Powered by</span> <span class="text-sm font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent group-hover:from-secondary group-hover:to-primary transition-all duration-500 svelte-e5btcs">Duty AI</span> <div class="w-2 h-2 rounded-full bg-gradient-to-r from-secondary to-primary animate-pulse svelte-e5btcs" style="animation-delay: 0.5s;"></div></div></div></div></div>`),$H=(n,e)=>x(e,!1),DH=(n,e)=>x(e,"bn"),RH=(n,e)=>x(e,"en"),jH=(n,e)=>x(e,!1),BH=ke(`<div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">খুব সহজ ব্যাখ্যা</div> <p class="text-sm text-base-content/70 svelte-e5btcs">মনে করুন আপনি আগের দিনের ছবি দেখে আজকের দিনের কথা অনুমান করছেন।
                এই ইন্ডিকেটরটি ঠিক তেমনই করে—এখনকার দামের সঙ্গে খুব মিল‑থাকা
                আগের প্যাটার্ন খুঁজে নেয়, তাদের পথ ধরে সামনে কী হতে পারে তা
                অনুমান করে, আর অতীতে কতটা উল্টো দিকে গেছে সেটাকে ধরে নিরাপদ
                থামার জায়গা (স্টপ‑লস) বলে দেয়।</p> <p class="text-sm text-base-content/70 svelte-e5btcs">উদাহরণ: ধরুন আজকের দামের গতি অনেকটা গত মাসের ১৫ তারিখের মতো।
                ইন্ডিকেটরটি তখন গত মাসের ১৫ তারিখের পরের দিনগুলো কী হয়েছিল সেটা
                দেখে আজকের পরের দিনগুলোর জন্য অনুমান করে।</p> <p class="text-sm text-base-content/70 svelte-e5btcs">চার্টে রঙের ব্যান্ডটি P10–P90 প্রত্যাশিত রেঞ্জ বোঝায়—মানে ১০০‑এর
                মধ্যে ৮০ বার দাম এই সীমার মধ্যে থাকতে পারে। মাঝের রেখাটি মাঝের
                রাস্তা (মিডিয়ান পথ)—দাম সাধারণত এই পথ ধরে চলতে পারে। আর ড্যাশড
                লাইনগুলো লং/শর্টের স্টপ—এগুলোতে পৌঁছালে থামার সংকেত।</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">চার্ট উপাদান</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">মাঝের রাস্তা: দাম সাধারণত কোন পথে যেতে পারে তার মাঝের লাইন।</li> <li class="svelte-e5btcs">রঙের ব্যান্ড: সম্ভাব্য ওঠা‑নামার এলাকা (P10–P90)। সরু মানে
                  পরিষ্কার পথ, প্রশস্ত মানে বেশি অনিশ্চয়তা।</li> <li class="svelte-e5btcs">স্টপের দাগ: লং/শর্টের প্রস্তাবিত স্টপ‑লসের ড্যাশড লাইন।</li> <li class="svelte-e5btcs">ইভি টেবিল: কোন স্টপ নিলে মোটের উপর লাভ‑ক্ষতি কেমন হতে পারে তা
                  দেখায়।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ওভারলে প্যানেলগুলো</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">তথ্য প্যানেল</span>: <span class="font-medium svelte-e5btcs">Active</span> (Long/Short), <span class="font-medium svelte-e5btcs">Anchor</span> (বর্তমান
                  দাম), <span class="font-medium svelte-e5btcs">Stop</span> (SL মূল্য ও ×ATR), <span class="font-medium svelte-e5btcs">pWin</span>, <span class="font-medium svelte-e5btcs">winR</span>, <span class="font-medium svelte-e5btcs">lossR</span> দেখায়—সিদ্ধান্তের জন্য দ্রুত
                  প্রেক্ষাপট দেয়।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">সিদ্ধান্ত প্যানেল</span>: বড় অক্ষরে <span class="font-medium svelte-e5btcs">Action: BUY/SELL/WAIT</span> দেখায়। সঙ্গে <span class="font-medium svelte-e5btcs">Band</span> (Narrow/Normal/Wide), <span class="font-medium svelte-e5btcs">1R</span> দূরত্ব ও <span class="font-medium svelte-e5btcs">শর্তের সারাংশ</span> দেখায়। <br class="svelte-e5btcs">BUY (লং): EV ≥ 0.30 ও pWin ≥ 55%, ব্যান্ড Wide না হলে। <br class="svelte-e5btcs">SELL (শর্ট): EV ≥ 0.20 ও pWin ≥ 50%, ব্যান্ড Wide না
                  হলে। <br class="svelte-e5btcs">অন্যথা: WAIT।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ইভি টেবিল (উদাহরণ)</div> <div class="overflow-x-auto svelte-e5btcs"><table class="table table-xs svelte-e5btcs"><thead class="svelte-e5btcs"><tr class="svelte-e5btcs"><th class="svelte-e5btcs">পজিশন</th><th class="svelte-e5btcs">এসএল (×এটিআর)</th><th class="svelte-e5btcs">ইভি (আর)</th><th class="svelte-e5btcs">জেতার সম্ভাবনা (%)</th><th class="svelte-e5btcs">উইন R</th><th class="svelte-e5btcs">লস R</th></tr></thead><tbody class="svelte-e5btcs"><tr class="svelte-e5btcs"><td class="svelte-e5btcs">লং</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">+0.45</td><td class="svelte-e5btcs">62</td><td class="svelte-e5btcs">1.60</td><td class="svelte-e5btcs">0.95</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">লং</td><td class="svelte-e5btcs">1.25×</td><td class="svelte-e5btcs">+0.30</td><td class="svelte-e5btcs">68</td><td class="svelte-e5btcs">1.35</td><td class="svelte-e5btcs">0.80</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">শর্ট</td><td class="svelte-e5btcs">0.80×</td><td class="svelte-e5btcs">+0.20</td><td class="svelte-e5btcs">54</td><td class="svelte-e5btcs">1.10</td><td class="svelte-e5btcs">0.85</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">শর্ট</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">−0.05</td><td class="svelte-e5btcs">48</td><td class="svelte-e5btcs">1.20</td><td class="svelte-e5btcs">1.10</td></tr></tbody></table></div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ইভি: মোটের উপর গড় প্রত্যাশা। জেতা‑হারা দুটো মিলিয়ে ফল কেমন
                  হবে।</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা (%): ১০০‑এর মধ্যে সংখ্যা। যত বেশি, জেতার
                  সম্ভাবনা তত বেশি।</li> <li class="svelte-e5btcs">উইন R ও লস R: জিতলে আনুমানিক কত, হারলে আনুমানিক কত। ভারসাম্য
                  দেখুন।</li> <li class="svelte-e5btcs">ইভি ≥ 0 হলে সারি বিবেচনা করুন; ইভি যত বেশি, মোট প্রত্যাশা তত
                  ভালো।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">টেবিলের ▶ চিহ্ন (অ্যারো) কীভাবে কাজ করে</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">টেবিলের সারিতে ▶ দেখায় কোন এসএল মাল্টিপ্লায়ার এখন সক্রিয়।
                  ভেতরে ক্লিক করলে ▶ পরের সারিতে যায়।</li> <li class="svelte-e5btcs">▶ যে সারিতে থাকে, সেই সারির <span class="font-medium svelte-e5btcs">SL (×ATR)</span> অনুযায়ী চার্টের ড্যাশড স্টপ‑লাইন আপডেট হয়।</li> <li class="svelte-e5btcs">▶ যদি লং সারিতে থাকে: সিদ্ধান্ত লং বায়াসে ভাবুন; স্টপ সাধারণত
                  বর্তমান দামের নিচে (<span class="font-medium svelte-e5btcs">anchor − mult × ATR</span>).</li> <li class="svelte-e5btcs">▶ যদি শর্ট সারিতে থাকে: সিদ্ধান্ত শর্ট বায়াসে ভাবুন; স্টপ
                  সাধারণত বর্তমান দামের উপরে (<span class="font-medium svelte-e5btcs">anchor + mult × ATR</span>).</li> <li class="svelte-e5btcs">সেরা নির্বাচন: ▶ কে এমন সারিতে রাখুন যেখানে <span class="font-medium svelte-e5btcs">EV পজিটিভ</span>, <span class="font-medium svelte-e5btcs">pWin বেশি</span>, আর <span class="font-medium svelte-e5btcs">lossR নিয়ন্ত্রণে</span> থাকে।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">অ্যারো উদাহরণ (শর্ট)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">ধরুন ▶ শর্ট সারিতে আছে এবং <span class="font-medium svelte-e5btcs">SL = 1.50×</span>, <span class="font-medium svelte-e5btcs">winR = 1.71</span>, <span class="font-medium svelte-e5btcs">lossR = 1.46</span>।</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.50×</span> মানে স্টপ দূরত্ব <span class="font-medium svelte-e5btcs">1.5 × ATR</span> উপরে। দূর স্টপ → কম
                    স্টপ‑হিট; কিন্তু রিস্ক ইউনিট বড় হয়।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.71</span> মানে জিতলে গড় লাভ <span class="font-medium svelte-e5btcs">1.71R</span>। যদি 1R = 100 টাকা
                    রিস্ক ধরেন, জিতলে গড়ে 171 টাকা।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 1.46</span> মানে হারলে গড়
                    ক্ষতি <span class="font-medium svelte-e5btcs">1.46R</span> ≈ 146 টাকা।</li> <li class="svelte-e5btcs">সিদ্ধান্ত: pWin যদি ~55% হয়, তাহলে <span class="font-medium svelte-e5btcs">EV = pWin × winR − (1−pWin) × lossR</span> = 0.55×1.71 − 0.45×1.46 ≈ <span class="font-medium svelte-e5btcs">+0.28R</span> → গ্রহণযোগ্য।</li> <li class="svelte-e5btcs">যদি pWin 45%‑এর নিচে নামে বা lossR বেশি হয়, ▶ অন্য সারিতে
                    সরান (কম SL বা ভালো EV)।</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">অ্যারো উদাহরণ (লং)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">ধরুন ▶ লং সারিতে আছে এবং <span class="font-medium svelte-e5btcs">SL = 1.00×</span>, <span class="font-medium svelte-e5btcs">winR = 1.40</span>, <span class="font-medium svelte-e5btcs">lossR = 0.90</span>।</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.00×</span> মানে স্টপ দূরত্ব <span class="font-medium svelte-e5btcs">1 × ATR</span> নিচে। কাছের স্টপ → ঝুঁকি
                    ছোট; কিন্তু স্টপ‑হিট হতে পারে বেশি।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.40</span> মানে জিতলে গড় লাভ
                    1.40R।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 0.90</span> মানে হারলে গড় ক্ষতি
                    0.90R।</li> <li class="svelte-e5btcs">pWin যদি ~60% হয়, <span class="font-medium svelte-e5btcs">EV ≈ 0.60×1.40 − 0.40×0.90 = +0.54R</span> → শক্ত সিদ্ধান্ত।</li> <li class="svelte-e5btcs">যদি ব্যান্ড খুব প্রশস্ত বা pWin কম হয়, ▶ কে এমন সারিতে নিন
                    যেখানে EV পজিটিভ ও lossR নিয়ন্ত্রিত।</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ব্যান্ড ভিত্তিক সিদ্ধান্ত</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ব্যান্ড সরু: পথ পরিষ্কার—আত্মবিশ্বাস একটু বাড়ানো যেতে পারে।</li> <li class="svelte-e5btcs">ব্যান্ড প্রশস্ত: অনিশ্চয়তা বেশি—সাইজ কমান বা একটু অপেক্ষা
                  করুন।</li> <li class="svelte-e5btcs">ব্যান্ড যদি বড় সাপোর্ট/রেজিস্ট্যান্সের সঙ্গে মিলে যায়: সতর্ক
                  থাকুন, স্টপ দূরে রাখুন।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">উদাহরণ</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">লং বায়াস</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">মাঝের রাস্তা উপরে দিকে। ইভি +0.30→+0.60, জেতার সম্ভাবনা
                    55–65%। এসএল 1.0×–1.25× নিলে সাধারণত জেতার সম্ভাবনা ও লস
                    R‑এর মধ্যে ভালো ভারসাম্য থাকে।</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">শর্ট বায়াস</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">মাঝের রাস্তা নিচের দিকে। শর্ট ইভি +0.20→+0.45। ব্যান্ড যদি
                    আগের নিচু জায়গার সঙ্গে মিলে যায়, এসএল 0.8×–1.0× নিলে সতর্ক
                    এন্ট্রির জন্য ভালো হয়।</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">কখন কিনবেন/বিক্রি করবেন</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">কিনবেন কখন (লং)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">ইভি +0.30 বা তার বেশি হলে</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 55% বা তার বেশি হলে</li> <li class="svelte-e5btcs">ব্যান্ড সরু হলে (পরিষ্কার পথ)</li> <li class="svelte-e5btcs">মাঝের রাস্তা উপরের দিকে হলে</li> <li class="svelte-e5btcs">স্টপ-লস 1.0×–1.25× ATR হলে</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">উদাহরণ: ইভি +0.45, pWin 62%, ব্যান্ড সরু → কিনুন</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">বিক্রি করবেন কখন (শর্ট)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">শর্ট ইভি +0.20 বা তার বেশি হলে</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 50% বা তার বেশি হলে</li> <li class="svelte-e5btcs">ব্যান্ড সরু হলে</li> <li class="svelte-e5btcs">মাঝের রাস্তা নিচের দিকে হলে</li> <li class="svelte-e5btcs">স্টপ-লস 0.8×–1.0× ATR হলে</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">উদাহরণ: ইভি +0.25, pWin 54%, ব্যান্ড সরু → বিক্রি করুন</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">কখন অপেক্ষা করবেন</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ইভি নেগেটিভ হলে (−0.10 বা তার কম)</li> <li class="svelte-e5btcs">ব্যান্ড খুব প্রশস্ত হলে (অনিশ্চয়তা বেশি)</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 45% এর কম হলে</li> <li class="svelte-e5btcs">ব্যান্ড বড় সাপোর্ট/রেজিস্ট্যান্সের সঙ্গে মিলে গেলে</li> <li class="svelte-e5btcs">winR/lossR ভারসাম্য খারাপ হলে (winR ≤ 1.0 বা lossR ≥ 1.2)</li></ul> <p class="text-sm text-base-content/70 mt-2 svelte-e5btcs">উদাহরণ: ইভি −0.15, pWin 42%, ব্যান্ড প্রশস্ত → অপেক্ষা করুন</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">টিপস</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">এডিট পপআপে গিয়ে ব্যান্ডের রং, অপাসিটি ও লাইনের স্টাইল বদলাতে
                  পারেন।</li> <li class="svelte-e5btcs">ইভি টেবিলে ক্লিক করলে স্টপ পাল্টায়; চার্টের ড্যাশড লাইনও সাথে
                  সাথে বদলে যায়।</li> <li class="svelte-e5btcs">ট্রেন্ড ফিল্টার বা ভলিউমের সঙ্গে জোড়া দিলে সিদ্ধান্ত আরও শক্ত
                  হয়।</li> <li class="svelte-e5btcs">রিস্ক ম্যানেজমেন্ট: এক ট্রেডে 1–2% এর বেশি রিস্ক নেবেন না</li> <li class="svelte-e5btcs">কনফার্মেশন: ক্যান্ডেলস্টিক প্যাটার্ন বা ইন্ডিকেটর কনফার্মেশন
                  নিন</li></ul></div>`,1),OH=ke(`<div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Simple Explanation</div> <p class="text-sm text-base-content/70 svelte-e5btcs">Think of it like looking at old pictures to guess today’s story.
                The indicator finds past patterns that look very similar to now,
                follows their path to estimate what might happen next, and uses
                historical MAE to suggest a safe place to stop (stop‑loss). The
                colored band is the expected range (P10–P90), the middle line is
                the median path, and the dashed lines are suggested long/short
                stops.</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Chart Elements</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Middle road: the central line showing the likely path.</li> <li class="svelte-e5btcs">Colored band: the area where price may move (P10–P90). Narrow
                  means clearer path; wide means more uncertainty.</li> <li class="svelte-e5btcs">Stop marks: dashed lines for suggested long/short stops.</li> <li class="svelte-e5btcs">EV table: shows overall gain‑loss balance for different stops.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Overlay Panels</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">Info Panel</span>: shows <span class="font-medium svelte-e5btcs">Active</span> (Long/Short), <span class="font-medium svelte-e5btcs">Anchor</span> (current
                  price), <span class="font-medium svelte-e5btcs">Stop</span> (SL price and
                  ×ATR), <span class="font-medium svelte-e5btcs">pWin</span>, <span class="font-medium svelte-e5btcs">winR</span>, <span class="font-medium svelte-e5btcs">lossR</span>—quick context for
                  decisions.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">Decision Panel</span>: prominently
                  displays <span class="font-medium svelte-e5btcs">Action: BUY/SELL/WAIT</span> with <span class="font-medium svelte-e5btcs">Band</span> (Narrow/Normal/Wide), <span class="font-medium svelte-e5btcs">1R</span> distance, and <span class="font-medium svelte-e5btcs">criteria summary</span>. <br class="svelte-e5btcs">BUY (Long): EV ≥ 0.30 and pWin ≥ 55%, band not Wide. <br class="svelte-e5btcs">SELL (Short): EV ≥ 0.20 and pWin ≥ 50%, band not Wide. <br class="svelte-e5btcs">Otherwise: WAIT.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">EV Table (Example)</div> <div class="overflow-x-auto svelte-e5btcs"><table class="table table-xs svelte-e5btcs"><thead class="svelte-e5btcs"><tr class="svelte-e5btcs"><th class="svelte-e5btcs">Side</th><th class="svelte-e5btcs">SL (×ATR)</th><th class="svelte-e5btcs">EV (R)</th><th class="svelte-e5btcs">pWin (%)</th><th class="svelte-e5btcs">winR</th><th class="svelte-e5btcs">lossR</th></tr></thead><tbody class="svelte-e5btcs"><tr class="svelte-e5btcs"><td class="svelte-e5btcs">L</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">+0.45</td><td class="svelte-e5btcs">62</td><td class="svelte-e5btcs">1.60</td><td class="svelte-e5btcs">0.95</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">L</td><td class="svelte-e5btcs">1.25×</td><td class="svelte-e5btcs">+0.30</td><td class="svelte-e5btcs">68</td><td class="svelte-e5btcs">1.35</td><td class="svelte-e5btcs">0.80</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">S</td><td class="svelte-e5btcs">0.80×</td><td class="svelte-e5btcs">+0.20</td><td class="svelte-e5btcs">54</td><td class="svelte-e5btcs">1.10</td><td class="svelte-e5btcs">0.85</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">S</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">−0.05</td><td class="svelte-e5btcs">48</td><td class="svelte-e5btcs">1.20</td><td class="svelte-e5btcs">1.10</td></tr></tbody></table></div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">EV: the overall expectancy—combines win and loss outcomes.</li> <li class="svelte-e5btcs">pWin (%): out of 100. Higher means better chance to win.</li> <li class="svelte-e5btcs">winR and lossR: how much you might win or lose. Balance them.</li> <li class="svelte-e5btcs">If EV ≥ 0, consider the row; higher EV means better overall
                  expectancy.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">How the ▶ arrow works</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">The ▶ in the table marks the <span class="font-medium svelte-e5btcs">active SL multiplier</span>. Click inside the table to move it to the next row.</li> <li class="svelte-e5btcs">Where ▶ sits, the chart’s dashed stop‑lines update using that
                  row’s <span class="font-medium svelte-e5btcs">SL (×ATR)</span>.</li> <li class="svelte-e5btcs">If ▶ is on a Long row: think with a long bias; the stop is
                  usually below current price (<span class="font-medium svelte-e5btcs">anchor − mult × ATR</span>).</li> <li class="svelte-e5btcs">If ▶ is on a Short row: think with a short bias; the stop is
                  usually above current price (<span class="font-medium svelte-e5btcs">anchor + mult × ATR</span>).</li> <li class="svelte-e5btcs">Best practice: place ▶ on rows with <span class="font-medium svelte-e5btcs">positive EV</span>, <span class="font-medium svelte-e5btcs">higher pWin</span>, and <span class="font-medium svelte-e5btcs">controlled lossR</span>.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Arrow Example (Short)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">Suppose ▶ is on a Short row with <span class="font-medium svelte-e5btcs">SL = 1.50×</span>, <span class="font-medium svelte-e5btcs">winR = 1.71</span>, <span class="font-medium svelte-e5btcs">lossR = 1.46</span>.</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.50×</span> means stop
                    distance is <span class="font-medium svelte-e5btcs">1.5 × ATR</span> above
                    anchor. Far stop → fewer stop‑hits; risk unit is larger.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.71</span> means average win
                    is <span class="font-medium svelte-e5btcs">1.71R</span>. If 1R = 100 units
                    risk, average win ≈ 171.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 1.46</span> means average
                    loss is <span class="font-medium svelte-e5btcs">1.46R</span>.</li> <li class="svelte-e5btcs">Decision: if pWin ≈ 55%, <span class="font-medium svelte-e5btcs">EV = pWin × winR − (1−pWin) × lossR</span> = 0.55×1.71 − 0.45×1.46 ≈ <span class="font-medium svelte-e5btcs">+0.28R</span> → acceptable.</li> <li class="svelte-e5btcs">If pWin drops below ~45% or lossR rises, move ▶ to a better
                    row (smaller SL or higher EV).</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Arrow Example (Long)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">Suppose ▶ is on a Long row with <span class="font-medium svelte-e5btcs">SL = 1.00×</span>, <span class="font-medium svelte-e5btcs">winR = 1.40</span>, <span class="font-medium svelte-e5btcs">lossR = 0.90</span>.</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.00×</span> means stop
                    distance is <span class="font-medium svelte-e5btcs">1 × ATR</span> below anchor.
                    Closer stop → smaller risk; may get hit more often.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.40</span> means average win
                    is 1.40R.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 0.90</span> means average loss
                    is 0.90R.</li> <li class="svelte-e5btcs">If pWin ≈ 60%, <span class="font-medium svelte-e5btcs">EV ≈ 0.60×1.40 − 0.40×0.90 = +0.54R</span> → strong setup.</li> <li class="svelte-e5btcs">If band is very wide or pWin is low, move ▶ to rows with
                    positive EV and controlled lossR.</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Band‑Based Decisions</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Narrow band: clearer path—slightly increase conviction if
                  suitable.</li> <li class="svelte-e5btcs">Wide band: more uncertainty—reduce size or wait for clarity.</li> <li class="svelte-e5btcs">If band overlaps major support/resistance: be cautious; use a
                  safer stop.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Examples</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Long Bias</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">Middle road is upward. EV +0.30→+0.60, pWin 55–65%. SL
                    1.0×–1.25× often gives a good balance between win chance and
                    lossR.</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Short Bias</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">Middle road is downward. Short EV +0.20→+0.45. If the band
                    overlaps prior lows, SL 0.8×–1.0× is a careful choice.</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">When to Buy/Sell</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Buy When (Long)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">EV +0.30 or higher</li> <li class="svelte-e5btcs">pWin 55% or higher</li> <li class="svelte-e5btcs">Band is narrow (clear path)</li> <li class="svelte-e5btcs">Middle road is upward</li> <li class="svelte-e5btcs">Stop-loss 1.0×–1.25× ATR</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">Example: EV +0.45, pWin 62%, narrow band → Buy</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Sell When (Short)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">Short EV +0.20 or higher</li> <li class="svelte-e5btcs">pWin 50% or higher</li> <li class="svelte-e5btcs">Band is narrow</li> <li class="svelte-e5btcs">Middle road is downward</li> <li class="svelte-e5btcs">Stop-loss 0.8×–1.0× ATR</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">Example: EV +0.25, pWin 54%, narrow band → Sell</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">When to Wait</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">EV is negative (−0.10 or worse)</li> <li class="svelte-e5btcs">Band is very wide (high uncertainty)</li> <li class="svelte-e5btcs">pWin below 45%</li> <li class="svelte-e5btcs">Band overlaps major support/resistance</li> <li class="svelte-e5btcs">Poor winR/lossR balance (winR ≤ 1.0 or lossR ≥ 1.2)</li></ul> <p class="text-sm text-base-content/70 mt-2 svelte-e5btcs">Example: EV −0.15, pWin 42%, wide band → Wait</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Tips</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Use the edit popup to change band opacity, colors, and line
                  styles.</li> <li class="svelte-e5btcs">Click inside the EV table to change stops; dashed lines update
                  instantly.</li> <li class="svelte-e5btcs">Pair with trend filters or volume to make decisions more
                  robust.</li> <li class="svelte-e5btcs">Risk management: Don't risk more than 1–2% per trade</li> <li class="svelte-e5btcs">Confirmation: Wait for candlestick pattern or indicator
                  confirmation</li></ul></div>`,1),zH=ke('<div class="fixed inset-0 z-[60] svelte-e5btcs"><div class="absolute inset-0 bg-base-200/20 svelte-e5btcs"></div> <div class="absolute inset-0 flex items-center justify-center p-4 svelte-e5btcs"><div class="w-full max-w-3xl rounded-xl shadow-2xl border border-base-300 bg-base-100 overflow-hidden svelte-e5btcs"><div class="flex items-center justify-between px-5 py-4 border-b border-base-300 bg-base-50 svelte-e5btcs"><div class="flex items-center gap-3 svelte-e5btcs"><div class="w-8 h-8 rounded-lg flex items-center justify-center bg-primary/10 text-primary svelte-e5btcs"><svg class="w-5 h-5 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" class="svelte-e5btcs"></circle><line x1="12" y1="16" x2="12" y2="12" class="svelte-e5btcs"></line><line x1="12" y1="8" x2="12.01" y2="8" class="svelte-e5btcs"></line></svg></div> <div class="svelte-e5btcs"><div class="text-base font-semibold text-base-content svelte-e5btcs"> </div> <div class="text-xs text-base-content/60 svelte-e5btcs"> </div></div></div> <div class="flex items-center gap-2 svelte-e5btcs"><button>বাংলা</button> <button>English</button></div> <button class="btn btn-xs btn-ghost svelte-e5btcs" aria-label="Close"><svg class="w-4 h-4 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18" class="svelte-e5btcs"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-e5btcs"></line></svg></button></div> <div class="px-5 py-4 space-y-5 max-h-[70vh] overflow-y-auto svelte-e5btcs"><!></div></div></div></div>'),VH=(n,e)=>x(e,!1),WH=(n,e)=>x(e,!1),HH=ke(`<div class="premium-modal-backdrop svelte-e5btcs" role="presentation"></div> <div class="premium-modal-container svelte-e5btcs" role="dialog" aria-modal="true" aria-labelledby="premium-modal-title"><div class="premium-background svelte-e5btcs"><div class="premium-orb premium-orb-1 svelte-e5btcs"></div> <div class="premium-orb premium-orb-2 svelte-e5btcs"></div></div> <div class="premium-content svelte-e5btcs"><button class="premium-close-btn svelte-e5btcs" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><line x1="18" y1="6" x2="6" y2="18" class="svelte-e5btcs"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-e5btcs"></line></svg></button> <div class="premium-icon-wrapper svelte-e5btcs"><div class="premium-icon svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-e5btcs"></path><path d="M2 17l10 5 10-5" class="svelte-e5btcs"></path><path d="M2 12l10 5 10-5" class="svelte-e5btcs"></path></svg> <div class="premium-icon-glow svelte-e5btcs"></div></div></div> <h2 id="premium-modal-title" class="premium-title svelte-e5btcs">Premium Feature</h2> <p class="premium-message svelte-e5btcs">Smart Trend is an exclusive premium indicator. Upgrade to Premium to
        unlock this advanced trend-following tool and enhance your trading
        strategy.</p> <div class="premium-features svelte-e5btcs"><div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">Smart Trend Indicator</span></div> <div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">AI Indicators (Smart Money, Trap Hunter, Volcanic)</span></div> <div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">More premium features coming soon</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-e5btcs"><span class="svelte-e5btcs">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><line x1="5" y1="12" x2="19" y2="12" class="svelte-e5btcs"></line><polyline points="12 5 19 12 12 19" class="svelte-e5btcs"></polyline></svg></a></div></div>`,1),qH=ke("<!> <!> <!>",1);function UH(n,e){Ed(e,!0);const t=sm(),s=()=>wl(c,"$ctx",t),o=()=>wl(u,"$chart",t),r=()=>wl(f,"$save",t),a=()=>wl(O0,"$userPreferences",t);let l=hi(e,"show",15);const c=gd("ctx"),f=gd("save"),u=gd("chart"),d=p6(),h=[{name:"BBI",title:"BBI (Bull and Bear Index)",is_main:!1},{name:"BOLL",title:"BOLL (Bollinger Bands)",is_main:!0},{name:"EMA",title:"EMA (Exponential Moving Average)",is_main:!0},{name:"ICHIMOKU",title:"ICHIMOKU (Ichimoku Kinko Hyo)",is_main:!0},{name:"MA",title:"MA (Moving Average)",is_main:!0},{name:"SAR",title:"SAR (Parabolic SAR)",is_main:!0},{name:"SMA",title:"SMA (Simple Moving Average)",is_main:!0},{name:"SMARTTREND",title:"Smart Trend",is_main:!0},{name:"ZIGZAG",title:"ZigZag (Trend Reversal Indicator)",is_main:!0},{name:"AO",title:"Awesome Oscillator",is_main:!1},{name:"BIAS",title:"BIAS (Bias)",is_main:!1},{name:"CCI",title:"CCI (Commodity Channel Index)",is_main:!1},{name:"CR",title:"CR (Energy)",is_main:!1},{name:"DMI",title:"DMI (Directional Movement Index)",is_main:!1},{name:"EMV",title:"EMV (Ease of Movement)",is_main:!1},{name:"KDJ",title:"KDJ (KDJ Index)",is_main:!1},{name:"MACD",title:"MACD (Moving Average Convergence Divergence)",is_main:!1},{name:"MTM",title:"MTM (Momentum)",is_main:!1},{name:"OBV",title:"OBV (On Balance Volume)",is_main:!1},{name:"PSY",title:"PSY (Psychological Line)",is_main:!1},{name:"PVT",title:"PVT (Price Volume Trend)",is_main:!1},{name:"ROC",title:"ROC (Rate of Change)",is_main:!1},{name:"RSI",title:"RSI (Relative Strength Index)",is_main:!1},{name:"STOCH",title:"STOCH (Stochastic Oscillator)",is_main:!1},{name:"TRIX",title:"TRIX (Triple Exponential Moving Average)",is_main:!1},{name:"VOL",title:"VOL (Volume)",is_main:!0},{name:"VR",title:"VR (Volume Variation Rate)",is_main:!1},{name:"WR",title:"WR (Williams Percentage Range)",is_main:!1}];h.push({name:"NPO_MAE",title:"Nearest‑Pattern Outcome + MAE‑Stop",is_main:!0});const m=h.slice().sort((Ae,Qe)=>Ae.name.localeCompare(Qe.name));function g(Ae){const Qe=h.find(gt=>gt.name===Ae);return Qe?Qe.title:Ae}function w(Ae,Qe){const gt=new Set;if(!(Ae!=null&&Ae.getIndicators))return gt;try{Ae.getIndicators().forEach(ot=>{(ot==null?void 0:ot.name)===Qe&&(ot!=null&&ot.paneId)&&gt.add(ot.paneId)})}catch(Ft){console.warn(`⚠️ Failed to read ${Qe} pane IDs from chart:`,Ft)}return gt}function C(Ae,Qe){if(!Qe.has(Ae))return Ae;let gt=2;for(;Qe.has(`${Ae}_${gt}`)&&gt<1e3;)gt+=1;if(!Qe.has(`${Ae}_${gt}`))return`${Ae}_${gt}`;let Ft=`${Ae}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;for(;Qe.has(Ft);)Ft=`${Ae}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;return Ft}function P(Ae,Qe,gt,Ft){const ot=w(Ae,Qe);for(const ve of ot)if(!gt.has(ve))return ve;return Ft}let I=ge(V(new Set));function A(){var ot,ve,Ie,It,Dt,Zt,gn;const Ae=new Set,Qe=((ot=s())==null?void 0:ot.initDone)>0;let gt=!1;if(o()&&Qe)try{const hn=((Ie=(ve=o()).getIndicators)==null?void 0:Ie.call(ve))??[];hn.forEach(bn=>{bn&&bn.name&&Ae.add(bn.name)}),gt=!0,console.log("📊 Indicator list - from chart.getIndicators:",hn.map(bn=>bn.name));const qn=((Dt=(It=o()).getOverlays)==null?void 0:Dt.call(It))??[];(qn==null?void 0:qn.some(bn=>(bn==null?void 0:bn.name)==="NearestPatternOutcomeMaeStop"))&&Ae.add("NPO_MAE")}catch(hn){console.warn("⚠️ Indicator list - getIndicators failed, falling back to saveInds",hn)}if(!gt&&r()&&r().saveInds){Object.values(r().saveInds).forEach(hn=>{hn&&hn.name&&Ae.add(hn.name)}),console.log("📊 Indicator list - from saveInds (fallback):",Array.from(Ae));try{(((gn=(Zt=o())==null?void 0:Zt.getOverlays)==null?void 0:gn.call(Zt))??[]).some(qn=>(qn==null?void 0:qn.name)==="NearestPatternOutcomeMaeStop")||Ae.delete("NPO_MAE")}catch{}}const Ft=Array.from(Ae).map(hn=>g(hn));console.log("🔄 selectedIndicators updated:",Ft),x(I,V(Ae))}Fr(()=>{var Ae;l(),o(),(Ae=r())==null||Ae.saveInds,A()}),Th(()=>{console.log("modalIndSearch mounted"),console.log("Available ActionTypes:",Object.keys(Jg)),console.log("ActionType values:",Object.values(Jg)),console.log("🔍 localStorage content:");for(let Ae=0;Ae<localStorage.length;(Ae+=1)-1){const Qe=localStorage.key(Ae);Qe&&console.log(`🔍 ${Qe}:`,localStorage.getItem(Qe))}window.debugChart=()=>{const Ae=JSON.parse(localStorage.getItem("chart")||"{}");return console.log("🔍 localStorage chart data:",Ae),console.log("🔍 saveInds keys:",Object.keys(Ae.saveInds||{})),console.log("🔍 Current $save.saveInds keys:",Object.keys(r().saveInds)),console.log("🔍 Chart available:",o()?"Yes":"No chart"),{localStorage:Ae,currentSave:r().saveInds}},setTimeout(()=>{console.log("🚀 Auto-debug on page load:"),window.debugChart()},2e3),console.log("🔍 Debug function added: window.debugChart()")});let M=ge(""),F=ge(!1),B=ge(V(new Set)),$=ge(!1),L=ge(!1),O=ge(!0),Y=ge(0),ce,Q=ge(!1),le=ge("bn"),ue=ge(!1);Fr(()=>{i(Q)&&l()?(x(ue,!0),l(!1)):!i(Q)&&!l()&&i(ue)&&(x(ue,!1),l(!0))}),Fr(()=>{!s().modalIndCfg&&i(F)&&(x(F,!1),setTimeout(()=>{l(!0)},100))});let fe=Bt(()=>{let Ae=m;if(i(M)){const Qe=i(M).toLowerCase();Ae=Ae.filter(gt=>gt.name.toLowerCase().includes(Qe)||gt.title.toLowerCase().includes(Qe)).sort((gt,Ft)=>gt.name.localeCompare(Ft.name))}if(l()&&i(B).size>0){const Qe=Ae.filter(Ft=>i(B).has(Ft.name)),gt=Ae.filter(Ft=>!i(B).has(Ft.name));return[...Qe,...gt]}return Ae});Fr(()=>{var Ae,Qe;if(l()!==i($)){if(l()){const gt=new Set;if((Qe=(Ae=i(I)).forEach)==null||Qe.call(Ae,Ft=>gt.add(Ft)),gt.size===0&&i(I)&&i(I).size>0)for(const Ft of i(I).values())gt.add(Ft);x(B,V(gt))}else x(B,V(new Set));x($,V(l()))}});function pe(){var Qe;const Ae=(Qe=a())==null?void 0:Qe.data;return Ae?Ae.isPremium===!0||Ae.isTrial===!0:!1}async function Z(Ae,Qe,gt,Ft=800){var ve;const ot=Date.now();for(;Date.now()-ot<Ft;){try{const Ie=((ve=Ae.getIndicators)==null?void 0:ve.call(Ae,{name:Qe,paneId:gt}))??[];if(Ie.length>0&&Ie.some(Dt=>(Dt==null?void 0:Dt.result)&&Object.keys(Dt.result).length>0))return}catch{}await new Promise(Ie=>setTimeout(Ie,16))}}async function xe(Ae,Qe){var gt,Ft,ot,ve,Ie,It,Dt,Zt,gn,hn,qn,On,bn,Fn,Xs,oo,Yn,_o;if(Qe==="SMARTTREND"&&!pe()){console.log("🔒 Premium access required for Smart Trend indicator"),x(L,!0);return}if(Qe==="BBI")ze(Qe,[3,6,12,24],!0,{id:"pane_BBI"});else if(Qe==="EMA")ze(Qe,[20],!0,{id:"candle_pane"});else if(Qe==="MA"){const xs="candle_pane",Rt=o();if(Rt){const un=Rt.createIndicator({name:"MA",calcParams:[20],styles:{lines:[{color:"#2563eb",size:1,style:wt.Solid}]},createTooltipDataSource:({indicator:qs})=>{const ri=[qs.visible?1:0,2,3],Eo=Rt.getStyles().indicator.tooltip;return{icons:ri.map(Lr=>Eo.features[Lr])}}},!0,{id:xs});if(await Z(Rt,"MA",xs),un){const qs={name:"MA",pane_id:xs,params:[20],styles:[{color:"#2563eb",thickness:1,lineStyle:"solid"}]},ri=`${xs}_MA`;f.update(Eo=>(Eo.saveInds[ri]=qs,Eo))}}}else if(Qe==="SMARTTREND"){const xs="candle_pane",Rt=o();if(Rt){const un=Rt.createIndicator({name:"SMARTTREND",calcParams:[10,3],styles:{lines:[{color:"#00FF00",size:1,style:wt.Dashed,dashedValue:[4,4]}]},extendData:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},createTooltipDataSource:({indicator:qs})=>{const ri=[qs.visible?1:0,2,3],Eo=Rt.getStyles().indicator.tooltip;return{icons:ri.map(Lr=>Eo.features[Lr])}}},!0,{id:xs});if(await Z(Rt,"SMARTTREND",xs),un){const qs={name:"SMARTTREND",pane_id:xs,params:[10,3],superTrendGroups:[{id:"st_default",period:10,multiplier:3,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]},ri=`${xs}_SMARTTREND`;f.update(Eo=>(Eo.saveInds[ri]=qs,Eo))}}}else if(Qe==="SMA"){const xs="candle_pane",Rt=o();if(Rt){const un=Rt.createIndicator({name:"SMA",calcParams:[20],styles:{lines:[{color:"#FF6C37",size:2,style:wt.Solid}]},createTooltipDataSource:({indicator:qs})=>{const ri=[qs.visible?1:0,2,3],Eo=Rt.getStyles().indicator.tooltip;return{icons:ri.map(Lr=>Eo.features[Lr])}}},!0,{id:xs});if(await Z(Rt,"SMA",xs),un){const qs={name:"SMA",pane_id:xs,params:[20],styles:[{color:"#FF6C37",thickness:2,lineStyle:"solid"}]},ri=`${xs}_SMA`;f.update(Eo=>(Eo.saveInds[ri]=qs,Eo))}}}else if(Qe==="RSI"){const xs=o();if(!xs)return;let Rt=[];try{const Fi=localStorage.getItem("rsiGroups");Fi&&(Rt=JSON.parse(Fi))}catch(Fi){console.warn("Failed to load saved RSI groups:",Fi)}Rt.length===0&&(Rt=[{id:"rsi_default",period:14,overbought:70,middle:50,oversold:30,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",oversoldColor:"#10B981",middleLineColor:"#6B7280"}}]);const un=Rt[0],qs=un.overboughtLevel??un.overbought??70,ri=un.middleLevel??un.middle??50,Eo=un.oversoldLevel??un.oversold??30,Ia=w(xs,"RSI"),Lr=new Set(Ia);Object.values(r().saveInds).forEach(Fi=>{(Fi==null?void 0:Fi.name)==="RSI"&&(Fi!=null&&Fi.pane_id)&&Lr.add(Fi.pane_id)});const Qa=C("pane_RSI",Lr),yr=xs.createIndicator({name:"RSI",calcParams:[un.period],styles:{lines:[{color:((Ft=(gt=un.styles)==null?void 0:gt.rsi)==null?void 0:Ft.color)||"#8B5CF6",size:((ve=(ot=un.styles)==null?void 0:ot.rsi)==null?void 0:ve.thickness)??2,style:((It=(Ie=un.styles)==null?void 0:Ie.rsi)==null?void 0:It.lineStyle)==="dashed"||((Zt=(Dt=un.styles)==null?void 0:Dt.rsi)==null?void 0:Zt.lineStyle)==="dotted"?wt.Dashed:wt.Solid}]}},!1,{id:Qa,axis:{gap:{bottom:2}}});if(await Z(xs,"RSI",Qa),yr){const Fi=P(xs,"RSI",Ia,Qa),Rc={id:un.id||`rsi_${Date.now()}`,period:un.period,overboughtLevel:qs,middleLevel:ri,oversoldLevel:Eo,paneId:Fi,actualPaneId:Fi,styles:{rsi:{color:((hn=(gn=un.styles)==null?void 0:gn.rsi)==null?void 0:hn.color)||"#8B5CF6",thickness:((On=(qn=un.styles)==null?void 0:qn.rsi)==null?void 0:On.thickness)??2,lineStyle:((Fn=(bn=un.styles)==null?void 0:bn.rsi)==null?void 0:Fn.lineStyle)||"solid"},overboughtColor:((Xs=un.styles)==null?void 0:Xs.overboughtColor)||"#EF4444",oversoldColor:((oo=un.styles)==null?void 0:oo.oversoldColor)||"#10B981",middleLineColor:((Yn=un.styles)==null?void 0:Yn.middleLineColor)||"#6B7280"}},Cu={name:"RSI",pane_id:Fi,params:[un.period],rsiGroups:[Rc]},uc=`${Fi}_RSI`;f.update(Fl=>(Fl.saveInds[uc]=Cu,Fl))}}else if(Qe==="STOCH"){const xs="pane_STOCH";let Rt=[];try{const ri=localStorage.getItem("stochasticGroups");ri&&(Rt=JSON.parse(ri))}catch(ri){console.warn("Failed to load saved Stochastic groups:",ri)}Rt.length===0&&(Rt=[{id:"stochastic_default",kPeriod:14,dPeriod:3,overbought:80,mid:50,oversold:20,styles:{k:{color:"#3B82F6",thickness:2,lineStyle:"solid"},d:{color:"#EF4444",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midColor:"#6B7280"}}]);const un=Rt[0],qs=o();if(qs&&qs.createIndicator({name:"STOCH",calcParams:[un.kPeriod,un.dPeriod],styles:{lines:[{color:un.styles.k.color,size:un.styles.k.thickness,style:un.styles.k.lineStyle==="dashed"||un.styles.k.lineStyle==="dotted"?wt.Dashed:wt.Solid},{color:un.styles.d.color,size:un.styles.d.thickness,style:un.styles.d.lineStyle==="dashed"||un.styles.d.lineStyle==="dotted"?wt.Dashed:wt.Solid}]}},!0,{id:xs})){const Eo={name:"STOCH",pane_id:xs,params:[un.kPeriod,un.dPeriod]},Ia=`${xs}_STOCH`;f.update(Lr=>(Lr.saveInds[Ia]=Eo,Lr))}}else if(Qe==="NPO_MAE"){const xs=o();if(!xs)return;if(!(((_o=xs.getOverlays)==null?void 0:_o.call(xs))??[]).some(un=>(un==null?void 0:un.name)==="NearestPatternOutcomeMaeStop")){const un=wH(xs);window.__npoMaeApi=un,f.update(qs=>{const ri="candle_pane_NPO_MAE";return qs.saveInds[ri]={name:"NPO_MAE",pane_id:"candle_pane"},qs})}}else{const xs=Ae?"candle_pane":"pane_"+Qe;ze(Qe,void 0,!0,{id:xs})}}function oe(Ae){var gt,Ft;let Qe=Object.entries(r().saveInds).find(([ot,ve])=>ve.name===Ae);if(!Qe&&o())try{const ve=(((Ft=(gt=o()).getIndicators)==null?void 0:Ft.call(gt))??[]).find(Ie=>Ie&&Ie.name===Ae);if(ve){Dc(c,qo(s).editIndName=Ae,qo(s)),Dc(c,qo(s).editPaneId=ve.paneId||s().editPaneId||"candle_pane",qo(s)),Dc(c,qo(s).modalIndCfg=!0,qo(s)),x(F,!0),l(!1);return}}catch(ot){console.warn("⚠️ Failed to locate indicator on chart for edit:",ot)}if(Qe){const[,ot]=Qe;Dc(c,qo(s).editIndName=Ae,qo(s)),Dc(c,qo(s).editPaneId=ot.pane_id,qo(s)),Dc(c,qo(s).modalIndCfg=!0,qo(s)),x(F,!0),l(!1)}}function Pe(Ae){var Ft;const Qe=new Set,gt=[];if(Object.entries(r().saveInds).forEach(([ot,ve])=>{(ve==null?void 0:ve.name)===Ae&&(ve!=null&&ve.pane_id?Qe.add(ve.pane_id):gt.push(ot))}),w(o(),Ae).forEach(ot=>{Qe.add(ot)}),(Ft=o())!=null&&Ft.getIndicators)try{o().getIndicators().forEach(ve=>{if(!(!ve||ve.name!==Ae)){if(ve.paneId)Qe.add(ve.paneId);else if(ve.id)try{o().removeIndicator({id:ve.id})}catch{}}})}catch{}Qe.forEach(ot=>{Ke(ot,Ae)}),gt.length>0&&(f.update(ot=>(gt.forEach(ve=>{delete ot.saveInds[ve]}),ot)),iv())}function $e(Ae){var Qe,gt,Ft;if(Ae==="NPO_MAE"){const ot=o();if(ot)try{(((Qe=ot.getOverlays)==null?void 0:Qe.call(ot))??[]).forEach(Ie=>{if((Ie==null?void 0:Ie.name)==="NearestPatternOutcomeMaeStop")try{ot.removeOverlay({id:Ie.id})}catch{}})}catch{}try{(Ft=(gt=window.__npoMaeApi)==null?void 0:gt.dispose)==null||Ft.call(gt),window.__npoMaeApi=null}catch{}f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{var It;((It=ve.saveInds[Ie])==null?void 0:It.name)==="NPO_MAE"&&delete ve.saveInds[Ie]}),ve));return}if(Ae==="MACD")Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="MACD").forEach(([ve,Ie])=>{Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="MACD"&&delete ve.saveInds[Ie]}),ve));else if(Ae==="BOLL")console.log("🗑️ Starting bulk BOLL deletion..."),Pe(Ae),f.update(ot=>(Object.keys(ot.saveInds).forEach(ve=>{ot.saveInds[ve].name==="BOLL"&&delete ot.saveInds[ve]}),ot)),iv(),console.log("✅ Bulk BOLL deletion completed");else if(Ae==="RSI")Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="RSI").forEach(([ve,Ie])=>{Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="RSI"&&delete ve.saveInds[Ie]}),ve));else if(Ae==="STOCH")Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="STOCH").forEach(([ve,Ie])=>{Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="STOCH"&&delete ve.saveInds[Ie]}),ve));else if(Ae==="BBI")Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="BBI").forEach(([ve,Ie])=>{Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="BBI"&&delete ve.saveInds[Ie]}),ve));else if(Ae==="AO"){if(console.log("🗑️ Starting bulk AO deletion..."),o())try{const Ie=o().getIndicators().filter(It=>It.name==="AO");console.log("📊 Found AO indicators on chart:",Ie.length),Ie.forEach(It=>{console.log("🗑️ Removing AO indicator from pane:",It.paneId),o().removeIndicator({paneId:It.paneId,name:"AO"})}),console.log("✅ All AO indicators removed from chart")}catch(ve){console.error("❌ Error removing AO indicators from chart:",ve)}const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="AO");console.log("🗑️ Deleting AO saved entries:",ot.length),ot.forEach(([ve,Ie])=>{console.log("🗑️ Cleaning saved entry:",ve,"pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="AO"&&(console.log("🗑️ Clearing AO saved data:",Ie),delete ve.saveInds[Ie])}),ve)),console.log("✅ Bulk AO deletion completed")}else if(Ae==="DMI"){if(console.log("🗑️ Starting bulk DMI deletion..."),o())try{const Ie=o().getIndicators().filter(It=>It.name==="DMI");console.log("📊 Found DMI indicators on chart:",Ie.length),Ie.forEach(It=>{console.log("🗑️ Removing DMI indicator from pane:",It.paneId),o().removeIndicator({paneId:It.paneId,name:"DMI"})}),console.log("✅ All DMI indicators removed from chart")}catch(ve){console.error("❌ Error removing DMI indicators from chart:",ve)}const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="DMI");console.log("🗑️ Deleting DMI saved entries:",ot.length),ot.forEach(([ve,Ie])=>{console.log("🗑️ Cleaning saved entry:",ve,"pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="DMI"&&(console.log("🗑️ Clearing DMI saved data:",Ie),delete ve.saveInds[Ie])}),ve)),console.log("✅ Bulk DMI deletion completed")}else if(Ae==="SAR"){if(console.log("🗑️ Starting bulk SAR deletion..."),o())try{const ve=o().getIndicators().filter(Ie=>Ie.name==="SAR");console.log("📊 Found SAR indicators on chart:",ve.length),ve.forEach(Ie=>{console.log("🗑️ Removing SAR from pane:",Ie.paneId),o().removeIndicator({paneId:Ie.paneId,name:"SAR"})})}catch(ot){console.error("❌ Error removing SAR indicators from chart:",ot);try{o().removeIndicator({paneId:"candle_pane",name:"SAR"})}catch{}try{o().removeIndicator({paneId:s().editPaneId,name:"SAR"})}catch{}}f.update(ot=>(Object.keys(ot.saveInds).forEach(ve=>{ot.saveInds[ve].name==="SAR"&&delete ot.saveInds[ve]}),ot)),c.update(ot=>(ot.editIndName==="SAR"&&(ot.editIndName="",ot.editPaneId="",ot.modalIndCfg=!1),ot)),console.log("✅ Bulk SAR deletion completed")}else if(Ae==="SMARTTREND"){if(console.log("🗑️ Starting bulk Smart Trend deletion..."),o())try{const ve=o().getIndicators().filter(Ie=>Ie.name==="SMARTTREND");console.log("📊 Found Smart Trend indicators on chart:",ve.length),ve.forEach(Ie=>{console.log("🗑️ Removing Smart Trend from pane:",Ie.paneId),o().removeIndicator({paneId:Ie.paneId,name:"SMARTTREND"})})}catch(ot){console.error("❌ Error removing Smart Trend indicators from chart:",ot);try{o().removeIndicator({paneId:"candle_pane",name:"SMARTTREND"})}catch{}try{o().removeIndicator({paneId:s().editPaneId,name:"SMARTTREND"})}catch{}}f.update(ot=>(Object.keys(ot.saveInds).forEach(ve=>{ot.saveInds[ve].name==="SMARTTREND"&&delete ot.saveInds[ve]}),ot)),console.log("✅ Bulk Smart Trend deletion completed")}else if(Ae==="CR"){if(console.log("🗑️ Starting bulk CR deletion..."),o())try{const Ie=o().getIndicators().filter(It=>It.name==="CR");console.log("📊 Found CR indicators on chart:",Ie.length),Ie.forEach(It=>{console.log("🗑️ Removing CR indicator from pane:",It.paneId),o().removeIndicator({paneId:It.paneId,name:"CR"})}),console.log("✅ All CR indicators removed from chart")}catch(ve){console.error("❌ Error removing CR indicators from chart:",ve)}const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="CR");console.log("🗑️ Deleting CR saved entries:",ot.length),ot.forEach(([ve,Ie])=>{console.log("🗑️ Cleaning saved entry:",ve,"pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="CR"&&(console.log("🗑️ Clearing CR saved data:",Ie),delete ve.saveInds[Ie])}),ve)),console.log("✅ Bulk CR deletion completed")}else if(Ae==="WR"){if(console.log("🗑️ Starting bulk WR deletion..."),o())try{const Ie=o().getIndicators().filter(It=>It.name==="WR");console.log("📊 Found WR indicators on chart:",Ie.length),Ie.forEach(It=>{console.log("🗑️ Removing WR indicator from pane:",It.paneId),o().removeIndicator({paneId:It.paneId,name:"WR"})}),console.log("✅ All WR indicators removed from chart")}catch(ve){console.error("❌ Error removing WR indicators from chart:",ve)}const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="WR");console.log("🗑️ Deleting WR saved entries:",ot.length),ot.forEach(([ve,Ie])=>{console.log("🗑️ Cleaning saved entry:",ve,"pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="WR"&&(console.log("🗑️ Clearing WR saved data:",Ie),delete ve.saveInds[Ie])}),ve)),c.update(ve=>(ve.clearWrGroups+=1,ve)),console.log("✅ Bulk WR deletion completed")}else if(Ae==="KDJ"){const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="KDJ");console.log("🗑️ Deleting KDJ entries:",ot),ot.forEach(([ve,Ie])=>{console.log("🗑️ Deleting KDJ from pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="KDJ"&&(console.log("🗑️ Clearing KDJ saved data:",Ie),delete ve.saveInds[Ie])}),ve))}else if(Ae==="OBV"){const ot=Object.entries(r().saveInds).filter(([Ie,It])=>It.name==="OBV");console.log("🗑️ Deleting OBV entries from saveInds:",ot),ot.forEach(([Ie,It])=>{console.log("🗑️ Deleting OBV from pane (saveInds):",It.pane_id),It.pane_id&&Ke(It.pane_id,Ae)});const ve=[s().editPaneId,"pane_OBV_1","pane_OBV_2","pane_OBV_3","pane_OBV_4","pane_OBV_5","main","sub1","sub2","sub3","sub4"];console.log("🗑️ Attempting to remove OBV from common pane locations..."),ve.forEach(Ie=>{var It;if(Ie)try{console.log("🗑️ Trying to remove OBV from pane:",Ie),(It=o())==null||It.removeIndicator({paneId:Ie,name:"OBV"})}catch{}}),f.update(Ie=>(Object.keys(Ie.saveInds).forEach(It=>{Ie.saveInds[It].name==="OBV"&&(console.log("🗑️ Clearing OBV saved data:",It),delete Ie.saveInds[It])}),Ie)),c.update(Ie=>(Ie.clearObvGroups+=1,Ie))}else if(Ae==="CCI"){if(console.log("🗑️ Starting bulk CCI deletion..."),o())try{const Ie=o().getIndicators().filter(It=>It.name==="CCI");console.log("📊 Found CCI indicators on chart:",Ie.length),Ie.forEach(It=>{console.log("🗑️ Removing CCI indicator from pane:",It.paneId),o().removeIndicator({paneId:It.paneId,name:"CCI"})}),console.log("✅ All CCI indicators removed from chart")}catch(ve){console.error("❌ Error removing CCI indicators from chart:",ve)}const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="CCI");console.log("🗑️ Deleting CCI saved entries:",ot.length),ot.forEach(([ve,Ie])=>{console.log("🗑️ Cleaning saved entry:",ve,"pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="CCI"&&(console.log("🗑️ Clearing CCI saved data:",Ie),delete ve.saveInds[Ie])}),ve)),c.update(ve=>(ve.clearCciGroups+=1,ve)),console.log("✅ Bulk CCI deletion completed")}else if(Ae==="EMV"){const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="EMV");console.log("🗑️ Deleting EMV entries:",ot),ot.forEach(([ve,Ie])=>{console.log("🗑️ Deleting EMV from pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="EMV"&&(console.log("🗑️ Clearing EMV saved data:",Ie),delete ve.saveInds[Ie])}),ve)),c.update(ve=>(ve.clearEmvGroups+=1,ve))}else if(Ae==="MTM"){const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="MTM");console.log("🗑️ Deleting MTM entries:",ot),ot.forEach(([ve,Ie])=>{console.log("🗑️ Deleting MTM from pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="MTM"&&(console.log("🗑️ Clearing MTM saved data:",Ie),delete ve.saveInds[Ie])}),ve)),c.update(ve=>(ve.clearMtmGroups+=1,ve))}else if(Ae==="PSY"){const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="PSY");console.log("🗑️ Deleting PSY entries:",ot),ot.forEach(([ve,Ie])=>{console.log("🗑️ Deleting PSY from pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="PSY"&&(console.log("🗑️ Clearing PSY saved data:",Ie),delete ve.saveInds[Ie])}),ve)),c.update(ve=>(ve.clearPsyGroups+=1,ve))}else if(Ae==="PVT"){if(console.log("🗑️ Starting bulk PVT deletion..."),o())try{const Ie=o().getIndicators().filter(It=>It.name==="PVT");console.log("📊 Found PVT indicators on chart:",Ie.length),Ie.forEach(It=>{console.log("🗑️ Removing PVT indicator from pane:",It.paneId),o().removeIndicator({paneId:It.paneId,name:"PVT"})}),console.log("✅ All PVT indicators removed from chart")}catch(ve){console.error("❌ Error removing PVT indicators from chart:",ve)}const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="PVT");console.log("🗑️ Deleting PVT saved entries:",ot.length),ot.forEach(([ve,Ie])=>{console.log("🗑️ Cleaning saved entry:",ve,"pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="PVT"&&(console.log("🗑️ Clearing PVT saved data:",Ie),delete ve.saveInds[Ie])}),ve)),c.update(ve=>(ve.clearPvtGroups+=1,ve)),console.log("✅ Bulk PVT deletion completed")}else if(Ae==="ROC"){if(console.log("🗑️ Starting bulk ROC deletion..."),o())try{const Ie=o().getIndicators().filter(It=>It.name==="ROC");console.log("📊 Found ROC indicators on chart:",Ie.length),Ie.forEach(It=>{console.log("🗑️ Removing ROC indicator from pane:",It.paneId),o().removeIndicator({paneId:It.paneId,name:"ROC"})}),console.log("✅ All ROC indicators removed from chart")}catch(ve){console.error("❌ Error removing ROC indicators from chart:",ve)}const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="ROC");console.log("🗑️ Deleting ROC saved entries:",ot.length),ot.forEach(([ve,Ie])=>{console.log("🗑️ Cleaning saved entry:",ve,"pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="ROC"&&(console.log("🗑️ Clearing ROC saved data:",Ie),delete ve.saveInds[Ie])}),ve)),c.update(ve=>(ve.clearRocGroups+=1,ve)),console.log("✅ Bulk ROC deletion completed")}else if(Ae==="VR"){if(console.log("🗑️ Starting bulk VR deletion..."),o())try{const Ie=o().getIndicators().filter(It=>It.name==="VR");console.log("📊 Found VR indicators on chart:",Ie.length),Ie.forEach(It=>{console.log("🗑️ Removing VR indicator from pane:",It.paneId),o().removeIndicator({paneId:It.paneId,name:"VR"})}),console.log("✅ All VR indicators removed from chart")}catch(ve){console.error("❌ Error removing VR indicators from chart:",ve)}const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="VR");console.log("🗑️ Deleting VR saved entries:",ot.length),ot.forEach(([ve,Ie])=>{console.log("🗑️ Cleaning saved entry:",ve,"pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="VR"&&(console.log("🗑️ Clearing VR saved data:",Ie),delete ve.saveInds[Ie])}),ve)),console.log("✅ Bulk VR deletion completed")}else if(Ae==="VOL"){if(console.log("🗑️ Starting bulk VOL deletion..."),o())try{const Ie=o().getIndicators().filter(It=>It.name==="VOL");console.log("📊 Found VOL indicators on chart:",Ie.length),Ie.forEach(It=>{console.log("🗑️ Removing VOL indicator from pane:",It.paneId),o().removeIndicator({paneId:It.paneId,name:"VOL"})}),console.log("✅ All VOL indicators removed from chart")}catch(ve){console.error("❌ Error removing VOL indicators from chart:",ve)}const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="VOL");console.log("🗑️ Deleting VOL saved entries:",ot.length),ot.forEach(([ve,Ie])=>{console.log("🗑️ Cleaning saved entry:",ve,"pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="VOL"&&(console.log("🗑️ Clearing VOL saved data:",Ie),delete ve.saveInds[Ie])}),ve)),c.update(ve=>(ve.clearVolGroups+=1,ve)),console.log("✅ Bulk VOL deletion completed")}else if(Ae==="BIAS"){if(console.log("🗑️ Starting bulk BIAS deletion..."),o())try{const Ie=o().getIndicators().filter(It=>It.name==="BIAS");console.log("📊 Found BIAS indicators on chart:",Ie.length),Ie.forEach(It=>{console.log("🗑️ Removing BIAS indicator from pane:",It.paneId),o().removeIndicator({paneId:It.paneId,name:"BIAS"})}),console.log("✅ All BIAS indicators removed from chart")}catch(ve){console.error("❌ Error removing BIAS indicators from chart:",ve)}const ot=Object.entries(r().saveInds).filter(([ve,Ie])=>Ie.name==="BIAS");console.log("🗑️ Deleting BIAS saved entries:",ot.length),ot.forEach(([ve,Ie])=>{console.log("🗑️ Cleaning saved entry:",ve,"pane:",Ie.pane_id),Ie.pane_id&&Ke(Ie.pane_id,Ae)}),f.update(ve=>(Object.keys(ve.saveInds).forEach(Ie=>{ve.saveInds[Ie].name==="BIAS"&&(console.log("🗑️ Clearing BIAS saved data:",Ie),delete ve.saveInds[Ie])}),ve)),console.log("✅ Bulk BIAS deletion completed")}else Pe(Ae)}async function ze(Ae,Qe,gt,Ft){const ot=o();if(!ot)return null;let ve=Qe,Ie={};if(Ae==="VOL"){if((!(Ft!=null&&Ft.id)||Ft.id!=="candle_pane")&&(Ft={axis:{gap:{bottom:2}},...Ft}),!Qe||Qe.length===0){ve=[20];const qn=(On=>{switch(On){case"dashed":return{style:wt.Dashed,dashedValue:[4,4]};case"dotted":return{style:wt.Dashed,dashedValue:[2,2]};default:return{style:wt.Solid,dashedValue:[2,2]}}})("dotted");Ie={bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#26a69a"}],lines:[{color:"#8B5CF6",size:1,style:qn.style,dashedValue:qn.dashedValue,smooth:!1}]}}}else Ae==="EMV"&&((!(Ft!=null&&Ft.id)||Ft.id!=="candle_pane")&&(Ft={axis:{gap:{bottom:2}},...Ft}),(!Qe||Qe.length===0)&&(ve=(k2[Ae]||[]).filter(qn=>qn.type!=="color").map(qn=>qn.default)));if(!ve||ve.length===0){const hn=k2[Ae]||[];hn.length>0&&Ae!=="VOL"&&(ve=hn.filter(On=>On.type!=="color").map(On=>On.default),hn.filter(On=>On.styleKey&&On.type==="color").forEach(On=>{const bn=On.styleKey,Fn=On.default,Xs=bn.match(/^(\w+)\[(\d+)\]\.(\w+)$/);if(Xs){const[,oo,Yn,_o]=Xs;Ie[oo]||(Ie[oo]=[]),Ie[oo][parseInt(Yn)]||(Ie[oo][parseInt(Yn)]={}),Ie[oo][parseInt(Yn)][_o]=Fn}}))}const It=(Ft==null?void 0:Ft.id)??"",Dt=`${It}_${Ae}`,Zt=ot.createIndicator({name:Ae,calcParams:ve,styles:Object.keys(Ie).length>0?Ie:void 0,createTooltipDataSource:({indicator:hn})=>{const qn=[hn.visible?1:0,2,3],On=ot.getStyles().indicator.tooltip;return{icons:qn.map(Fn=>On.features[Fn])}}},gt,Ft);if(await Z(ot,Ae,Ft==null?void 0:Ft.id),!Zt)return null;const gn={name:Ae,pane_id:It,params:ve};return f.update(hn=>(hn.saveInds[Dt]=gn,hn)),iv(),Fp.recordAddIndicator(Ae,It,ve||[],Dt),gn}async function Ke(Ae,Qe){var Ie;if(console.log("🗑️ delInd called:",{paneId:Ae,name:Qe,chart:!!o()}),!o()){console.log("❌ No chart available");return}const gt=o(),Ft=`${Ae}_${Qe}`,ot=r().saveInds[Ft];ot&&Fp.recordRemoveIndicator(Qe,Ae,ot.params||[],Ft),console.log("🔥 Attempting to remove indicator with correct API: removeIndicator(paneId, name)");try{gt.removeIndicator({paneId:Ae,name:Qe}),console.log("✅ removeIndicator successful")}catch(It){console.log("❌ removeIndicator failed:",It);try{console.log("🔄 Trying fallback: remove indicator by name directly"),console.log("Attempting to remove indicator:",Qe,"from pane:",Ae),console.log("Direct removal attempt for:",Qe),[].forEach(Zt=>{console.log("Removing indicator instance:",Zt);try{gt.removeIndicator({paneId:Ae,name:Zt.name})}catch(gn){console.log("Failed to remove indicator instance:",gn)}}),console.log("✅ Fallback method successful")}catch(Dt){console.log("❌ Fallback method also failed:",Dt)}}try{const Dt=(((Ie=gt.getIndicators)==null?void 0:Ie.call(gt))??[]).filter(Zt=>(Zt==null?void 0:Zt.name)===Qe&&(!Ae||(Zt==null?void 0:Zt.paneId)===Ae));Dt.length>0&&Dt.forEach(Zt=>{try{Zt!=null&&Zt.id?gt.removeIndicator({id:Zt.id}):Zt!=null&&Zt.paneId&&gt.removeIndicator({paneId:Zt.paneId,name:Qe})}catch{}})}catch{}console.log("🧹 Cleaning saved state for:",Qe);const ve=JSON.parse(localStorage.getItem("indicators")||"{}");console.log("🧹 Current localStorage indicators:",ve),ve[Ae]&&(ve[Ae]=ve[Ae].filter(It=>It.name!==Qe),ve[Ae].length===0&&delete ve[Ae],localStorage.setItem("indicators",JSON.stringify(ve)),console.log("🧹 Updated localStorage indicators:",ve)),f.update(It=>{if(console.log("🧹 Before cleanup saveInds keys:",Object.keys(It.saveInds)),Qe==="ZIGZAG"){const Dt=`${Ae}_ZIGZAG`;Object.keys(It.saveInds).forEach(Zt=>{const gn=It.saveInds[Zt];Zt.startsWith(Dt)&&(gn==null?void 0:gn.name)==="ZIGZAG"&&(console.log("🧹 Removing ZigZag save key:",Zt),delete It.saveInds[Zt])})}else{const Dt=`${Ae}_${Qe}`;console.log("🧹 Cleaning saved state key:",Dt,"existed:",!!It.saveInds[Dt]),delete It.saveInds[Dt]}return console.log("🧹 After cleanup saveInds keys:",Object.keys(It.saveInds)),It}),iv(),d.removeIndicator({chart:gt,name:Qe,paneId:Ae}).catch(It=>{console.warn("Background color preservation failed:",It)}),console.log("✅ delInd completed")}_p(c,Ae=>Ae.cloudIndLoaded).subscribe(Ae=>{console.log("🔄 cloudIndLoaded triggered, saveInds:",Object.keys(r().saveInds)),console.log("🚫 Automatic indicator restoration disabled to prevent deleted indicators from reappearing")});function nt(Ae){const gt=Ae.target.scrollTop;gt<i(Y)||gt<=10?x(O,!0):gt>i(Y)&&gt>50&&x(O,!1),x(Y,V(gt))}const ft=_p(c,Ae=>Ae.initDone);let ut=!1;ft.subscribe(Ae=>{if(console.log("initDone changed:",Ae,"chart:",!!o(),"subscribed:",ut),Ae>0&&!ut&&o()){console.log("Subscribing to OnTooltipIconClick with chart:",o()),console.log("Chart methods available:",Object.getOwnPropertyNames(o())),console.log("subscribeAction method:",typeof o().subscribeAction),ut=!0;try{o().subscribeAction(Jg.OnCandleTooltipFeatureClick,Qe=>{var Ft,ot;console.log("🔥 OnTooltipIconClick fired!",Qe);const gt=Qe;if(gt.indicatorName)switch(console.log("Processing icon click:",gt.iconId,"for indicator:",gt.indicatorName),gt.iconId){case"visible":{console.log("Making indicator visible"),(Ft=o())==null||Ft.overrideIndicator({name:gt.indicatorName,paneId:gt.paneId,visible:!0});break}case"invisible":{console.log("Making indicator invisible"),(ot=o())==null||ot.overrideIndicator({name:gt.indicatorName,paneId:gt.paneId,visible:!1});break}case"setting":{console.log("Opening settings"),Dc(c,qo(s).editIndName=gt.indicatorName,qo(s)),Dc(c,qo(s).editPaneId=gt.paneId,qo(s)),Dc(c,qo(s).modalIndCfg=!0,qo(s)),l()&&l(!1);break}case"close":console.log("Deleting indicator:",gt.indicatorName,"from pane:",gt.paneId),Ke(gt.paneId,gt.indicatorName)}}),console.log("✅ Successfully subscribed to OnTooltipIconClick")}catch(Qe){console.error("❌ Error subscribing to OnTooltipIconClick:",Qe)}}});const bt=a_(),[Pt,Et]=bt;var Mt=qH(),Je=fn(Mt),Ct=Bt(()=>Xw());tg(Je,{get title(){return i(Ct)},width:700,maxWidth:"95vw",maxHeight:"min(92svh, 90vh)",get show(){return l()},set show(Ae){l(Ae)},get theme(){return r().theme},buttons:[],class:"ind-modal",children:(Ae,Qe)=>{var gt=EH(),Ft=y(gt),ot=v(y(Ft),2);xn(ot),Ce(()=>Ot(ot,"placeholder",l4()));var ve=v(ot,2);Ue(ve,()=>i(M),gn=>{var hn=CH();hn.__click=[SH,M],q(gn,hn)}),_(Ft);var Ie=v(Ft,2),It=y(Ie),Dt=y(It);Yo(Dt,17,()=>i(fe),Ii,(gn,hn,qn)=>{var On=FH();const bn=Bt(()=>i(I).has(i(hn).name));On.__click=[IH,bn,xe,hn];var Fn=y(On),Xs=v(Fn,2),oo=y(Xs),Yn=y(oo,!0);_(oo),_(Xs);var _o=v(Xs,2);Ue(_o,()=>i(hn).name==="NPO_MAE",Rt=>{var un=MH();un.__click=[PH,Q],q(Rt,un)});var xs=v(_o,2);Ue(xs,()=>i(bn),Rt=>{var un=TH(),qs=y(un);qs.__click=[NH,oe,hn];var ri=v(qs,2);ri.__click=[AH,$e,hn],_(un),q(Rt,un)}),_(On),Ce(()=>{pi(On,`group indicator-row relative flex items-center min-h-[56px] px-5 py-3 cursor-pointer transition-all duration-500 ease-out
                   ${(qn<i(fe).length-1?"border-b":"")??""} 
                   ${(i(bn)?"indicator-item-selected":"indicator-item-unselected")??""} svelte-e5btcs`),pi(Fn,`flex items-center justify-center w-2 h-2 rounded-full mr-4 transition-all duration-500
                        ${(i(bn)?"indicator-dot-selected":"indicator-dot-unselected")??""} svelte-e5btcs`),pi(oo,`indicator-title text-[15px] font-medium tracking-wide leading-relaxed
                           ${(i(bn)?"indicator-text-selected":"indicator-text-unselected")??""} svelte-e5btcs`),tt(Yn,i(hn).title)}),q(gn,On)});var Zt=v(Dt,2);Ue(Zt,()=>i(fe).length===0,gn=>{var hn=LH();q(gn,hn)}),_(It),tp(It,gn=>ce=gn,()=>ce),_(Ie),Zi(2),_(gt),Ce(()=>pi(Ft,`relative group transition-all duration-300 ease-out ${(i(O)?"opacity-100 translate-y-0":"opacity-0 -translate-y-4 pointer-events-none")??""} svelte-e5btcs`)),Bs(ot,()=>i(M),gn=>x(M,gn)),vd("scroll",It,nt),q(Ae,gt)},$$slots:{default:!0}});var Ze=v(Je,2);Ue(Ze,()=>i(Q),Ae=>{var Qe=zH(),gt=y(Qe);gt.__click=[$H,Q];var Ft=v(gt,2),ot=y(Ft),ve=y(ot),Ie=y(ve),It=v(y(Ie),2),Dt=y(It),Zt=y(Dt,!0);_(Dt);var gn=v(Dt,2),hn=y(gn,!0);_(gn),_(It),_(Ie);var qn=v(Ie,2),On=y(qn);On.__click=[DH,le];var bn=v(On,2);bn.__click=[RH,le],_(qn);var Fn=v(qn,2);Fn.__click=[jH,Q],_(ve);var Xs=v(ve,2),oo=y(Xs);Ue(oo,()=>i(le)==="bn",Yn=>{var _o=BH();Zi(22),q(Yn,_o)},Yn=>{var _o=OH();Zi(22),q(Yn,_o)}),_(Xs),_(ot),_(Ft),_(Qe),Ce(()=>{tt(Zt,i(le)==="bn"?"নিকটতম‑প্যাটার্ন আউটকাম + এমএই‑স্টপ":"Nearest‑Pattern Outcome + MAE‑Stop"),tt(hn,i(le)==="bn"?"কিভাবে কাজ করে এবং কিভাবে ব্যবহার করবেন":"How it works and how to use"),pi(On,`btn btn-xs ${(i(le)==="bn"?"btn-primary":"btn-outline")??""} svelte-e5btcs`),pi(bn,`btn btn-xs ${(i(le)==="en"?"btn-primary":"btn-outline")??""} svelte-e5btcs`)}),q(Ae,Qe)});var Xe=v(Ze,2);return Ue(Xe,()=>i(L),Ae=>{var Qe=HH(),gt=fn(Qe);gt.__click=[VH,L];var Ft=v(gt,2),ot=v(y(Ft),2),ve=y(ot);ve.__click=[WH,L];var Ie=v(ve,10);Ce(()=>Ot(Ie,"href",Pt("https://dutyai.app/settings/investor?device=1",void 0))),_(ot),_(Ft),wg(3,gt,()=>y_,()=>({duration:200})),wg(3,Ft,()=>gy,()=>({y:20,duration:300,easing:kw})),q(Ae,Qe)}),q(n,Mt),$d({createIndicator:ze,delInd:Ke})}Ip(["click"]);function mc(n,e){Ed(e,!0);let t=hi(e,"show",15),s=hi(e,"selectedColor",7,"#000000");hi(e,"position",19,()=>({x:0,y:0}));let o=hi(e,"opacity",7,100);const r=Fh();function a(d){const h=(d||"").trim();if(!h)return null;if(/^#?[0-9A-Fa-f]{6}$/.test(h)){const g=h.startsWith("#")?h.slice(1):h;return{r:parseInt(g.slice(0,2),16),g:parseInt(g.slice(2,4),16),b:parseInt(g.slice(4,6),16)}}const m=h.match(/^rgba?\(([^)]+)\)$/i);if(m){const g=m[1].split(",").map(w=>parseFloat(w.trim()));if(g.length>=3&&g.every(w=>!isNaN(w)))return{r:Math.round(g[0]),g:Math.round(g[1]),b:Math.round(g[2])}}return null}function l(d,h){const m=a(d);if(!m)return null;const g=Math.max(0,Math.min(100,h))/100;return`rgba(${m.r}, ${m.g}, ${m.b}, ${g})`}function c(d){const h=d.detail;s(h);const m=l(h,o());r("colorChange",{color:h,opacity:o(),rgba:m})}function f(d){const h=d.detail;o(Number.isFinite(h)?h:o());const m=l(s(),o());r("opacityChange",{opacity:o(),rgba:m,color:s()}),r("colorChange",{color:s(),opacity:o(),rgba:m})}function u(){t(!1),r("close")}qv(n,{get show(){return t()},set show(d){t(d)},get selectedColor(){return s()},get opacity(){return o()},$$events:{colorChange:c,opacityChange:f,close:u}}),$d()}const qh={LAYOUTS:"chart.saves.v1",ACTIVE_SAVE_ID:"chart.activeSaveId",LEGACY_LAYOUTS:"chart.saves.v0"};function Br(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}function Nx(n){return n.toUpperCase().trim()}function GH(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"}catch{return"UTC"}}function Ax(n){return n&&typeof n.id=="string"&&typeof n.name=="string"&&typeof n.createdAt=="string"&&typeof n.updatedAt=="string"&&typeof n.timezone=="string"&&typeof n.interval=="string"&&typeof n.chartType=="string"&&typeof n.theme=="string"&&Array.isArray(n.panes)&&Array.isArray(n.indicators)&&typeof n.drawingsBySymbol=="object"}class O8{constructor(){Te(this,"initialized",!1);this.initialize()}async initialize(){if(!(this.initialized||!_3))try{await this.migrate(),this.initialized=!0}catch(e){console.error("Failed to initialize storage provider:",e)}}async migrate(){try{const e=localStorage.getItem(qh.LEGACY_LAYOUTS);if(!e)return;console.log("🔄 Migrating chart saves from v0 to v1...");const t=JSON.parse(e);if(!Array.isArray(t))return;if(localStorage.getItem(qh.LAYOUTS)){localStorage.removeItem(qh.LEGACY_LAYOUTS);return}const o=t.map(r=>({id:r.id||Br(),name:r.name||"Migrated Layout",createdAt:r.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),timezone:r.timezone||GH(),interval:r.interval||"1h",chartType:r.chartType||"candles",theme:r.theme||"dark",panes:r.panes||[],indicators:r.indicators||[],styles:r.styles||{},options:r.options||{},drawingsBySymbol:r.drawings?{[Nx(r.symbol||"DEFAULT")]:r.drawings}:{}}));localStorage.setItem(qh.LAYOUTS,JSON.stringify(o)),localStorage.removeItem(qh.LEGACY_LAYOUTS),console.log(`✅ Migrated ${o.length} layouts to v1 format`)}catch(e){console.error("Migration failed:",e)}}async listSavedLayouts(){await this.initialize();try{const e=localStorage.getItem(qh.LAYOUTS);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(Ax).map(s=>({id:s.id,name:s.name,createdAt:s.createdAt,updatedAt:s.updatedAt})).sort((s,o)=>new Date(o.updatedAt).getTime()-new Date(s.updatedAt).getTime()):[]}catch(e){return console.error("Failed to list saved layouts:",e),[]}}async getSavedLayout(e){await this.initialize();try{const t=localStorage.getItem(qh.LAYOUTS);if(!t)return null;const s=JSON.parse(t);if(!Array.isArray(s))return null;const o=s.find(r=>r.id===e);return o&&Ax(o)?o:null}catch(t){return console.error("Failed to get saved layout:",t),null}}async createSavedLayout(e){await this.initialize();try{const t=new Date().toISOString(),s={...e,id:Br(),createdAt:t,updatedAt:t,drawingsBySymbol:Object.fromEntries(Object.entries(e.drawingsBySymbol).map(([a,l])=>[Nx(a),l]))},o=localStorage.getItem(qh.LAYOUTS),r=o?JSON.parse(o):[];return r.push(s),localStorage.setItem(qh.LAYOUTS,JSON.stringify(r)),s}catch(t){throw console.error("Failed to create saved layout:",t),new Error("Failed to save layout")}}async updateSavedLayout(e,t){await this.initialize();try{const s=localStorage.getItem(qh.LAYOUTS);if(!s)throw new Error("Layout not found");const o=JSON.parse(s),r=o.findIndex(l=>l.id===e);if(r===-1)throw new Error("Layout not found");const a={...o[r],...t,id:e,updatedAt:new Date().toISOString(),drawingsBySymbol:t.drawingsBySymbol?Object.fromEntries(Object.entries(t.drawingsBySymbol).map(([l,c])=>[Nx(l),c])):o[r].drawingsBySymbol};return o[r]=a,localStorage.setItem(qh.LAYOUTS,JSON.stringify(o)),a}catch(s){throw console.error("Failed to update saved layout:",s),new Error("Failed to update layout")}}async deleteSavedLayout(e){await this.initialize();try{const t=localStorage.getItem(qh.LAYOUTS);if(!t)return;const o=JSON.parse(t).filter(a=>a.id!==e);localStorage.setItem(qh.LAYOUTS,JSON.stringify(o)),await this.getActiveSaveId()===e&&await this.setActiveSaveId(null)}catch(t){throw console.error("Failed to delete saved layout:",t),new Error("Failed to delete layout")}}async setActiveSaveId(e){try{e===null?localStorage.removeItem(qh.ACTIVE_SAVE_ID):localStorage.setItem(qh.ACTIVE_SAVE_ID,e)}catch(t){console.error("Failed to set active save ID:",t)}}async getActiveSaveId(){try{return localStorage.getItem(qh.ACTIVE_SAVE_ID)}catch(e){return console.error("Failed to get active save ID:",e),null}}async layoutNameExists(e,t){return(await this.listSavedLayouts()).some(o=>o.name===e&&o.id!==t)}async cleanup(){try{const e=localStorage.getItem(qh.LAYOUTS);if(!e)return;const t=JSON.parse(e),s=t.filter(Ax);s.length!==t.length&&(localStorage.setItem(qh.LAYOUTS,JSON.stringify(s)),console.log(`🧹 Cleaned up ${t.length-s.length} invalid layouts`))}catch(e){console.error("Failed to cleanup storage:",e)}}}const YH=new O8;function _g(n,e,t,s,o,r,a){if(!i(e)||!t()||!o().editPaneId)return;const l=[a.zoneLookbackBars,a.minZoneBars,a.maxZoneBars,a.atrPeriod,a.volumeMAPeriod,a.minVolumeFactor,a.maxZoneWidthPct,a.priorTrendLookback,a.minOBVTrendStrength,a.minZoneScore,a.mergeNearbyZones?1:0,a.maxZonesDisplayed,a.showLabels?1:0];try{t().overrideIndicator({name:"SMART_MONEY",calcParams:l,paneId:o().editPaneId})}catch(c){console.error("SMART_MONEY realtime update failed:",c)}}function KH(n,e,t){const s={id:Br(),deviation:5,depth:5,styles:{color:"#2962FF",thickness:2,lineStyle:"solid"}};x(e,V([...i(e),s])),t()}function g5(n,e,t,s){const o=e();o&&o.setStyles({median:{size:i(t),style:i(s)}})}function _5(n,e,t,s){const o=e();o&&o.setStyles({slLong:{size:i(t),style:i(s)}})}function y5(n,e,t,s){const o=e();o&&o.setStyles({slShort:{size:i(t),style:i(s)}})}function XH(n,e,t){const s=e();s&&s.setShowOutcomeBand(!!i(t))}function ZH(n,e,t){const s=e();s&&s.setShowStopLines(!!i(t))}function JH(n,e,t){const s=e();s&&s.updateSettings({showTable:!!i(t)})}function QH(n,e,t){if(i(e))try{if(i(t).length>=10){console.warn("⚠️ Maximum number of EMV groups (10) reached");return}const o=i(t).length+1,r={id:Br(),name:`EMV #${o}`,period:14,period2:9,color:"#2563eb",thickness:2,lineStyle:"solid"};i(t).push(r),console.log("✅ Added new EMV group:",r.name)}catch(s){console.error("❌ Error adding EMV group:",s)}}function eq(n,e,t,s){if(i(e))try{if(i(t).length>=10){console.warn("⚠️ Maximum number of MTM groups (10) reached");return}const r=i(t).length+1,a=["#2563eb","#8B5CF6","#F59E0B","#10B981","#EF4444","#EC4899","#06B6D4","#F97316"],l=i(t).length%a.length,c={id:Br(),name:`MTM #${r}`,period:14,color:a[l],thickness:2,lineStyle:"solid"};i(t).push(c),console.log("✅ Added new MTM group:",c.name),s()}catch(o){console.error("❌ Error adding MTM group:",o)}}function tq(n,e,t,s){if(!i(e))return;const o=i(t).length+1;i(t).push({id:Br(),name:`BIAS${o}`,period:6,color:"#2196F3",thickness:1,lineStyle:"solid"}),s()}function nq(n,e,t,s){if(!i(e))return;const o=i(t).length+1,r=o===1?"CCI":`CCI${o}`;i(t).push({id:Br(),name:r,period:14,color:"#FF9800",thickness:1,lineStyle:"solid"}),console.log("➕ Added new CCI group:",r),s()}function sq(n,e,t,s){if(!i(e))return;const o=i(t)[i(t).length-1]||i(t)[0],r={id:Br(),start:(o==null?void 0:o.start)??.02,increment:(o==null?void 0:o.increment)??.02,maxValue:(o==null?void 0:o.maxValue)??.2,color:"#2563eb",dotSize:1};x(t,V([...i(t),r])),s()}function oq(n,e,t,s){if(!i(e))return;const o=["#00FF00","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8"],r=i(t).map(u=>u.styles.uptrend.color),a=o.filter(u=>!r.includes(u)),l=a.length>0?a[0]:o[i(t).length%o.length],c=i(t)[i(t).length-1]||i(t)[0],f={id:Br(),period:((c==null?void 0:c.period)||10)+2,multiplier:(c==null?void 0:c.multiplier)||3,showLabels:!0,styles:{uptrend:{color:l,thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}};x(t,V([...i(t),f])),console.log("✅ Added new Smart Trend group:",f),s()}function iq(n,e,t,s){if(!i(e))return;const o=i(t).length+1;i(t).push({id:Br(),name:`DMI${o}`,diPeriod:14,adxPeriod:6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}),console.log("➕ Added new DMI group"),s()}function rq(n,e,t,s){if(!i(e))return;const o=i(t).length+1;i(t).push({id:Br(),name:`CR${o}`,crPeriod:26,crMa1Period:10,crMa2Period:20,crMa3Period:40,crMa4Period:60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}),console.log("➕ Added new CR group"),s()}function aq(n,e,t,s){if(!i(e))return;const o=["#26A69A","#EF5350","#8B5CF6","#F59E0B","#10B981","#F97316","#06B6D4","#84CC16"],r=i(t).length%o.length;i(t).push({id:Br(),shortPeriod:5,longPeriod:34,styles:{increasing:{color:o[r]},decreasing:{color:o[(r+1)%o.length]},reverse:{color:"#c4c4c4"}}}),s()}function lq(n,e,t){x(e,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(t,!0)}function Fb(n,e,t,s,o,r,a,l,c,f,u,d,h,m,g,w,C){if(i(e))return;if(i(t)){s();return}if(i(o)){r();return}if(i(a)){l();return}if(i(c)){f();return}if(u.length>=10)return;const P=u[u.length-1],I={...P,title:`${P.title.replace(/\d+$/,"")}${u.length+1}`};u.push(I),d.push(I.default||0),h.push({color:"#2563eb",thickness:1,lineStyle:"solid"}),i(m)?g():i(w)&&C()}function cq(n,e,t,s,o,r,a,l,c,f,u,d,h,m,g){if(!i(e))return;const w=t().editPaneId||"candle_pane";i(o).push({id:Br(),paneId:w,period:i(r),stdDev:i(a),styles:{fillColor:i(l),fillOpacity:i(c),upperColor:i(f),middleColor:i(u),lowerColor:i(d),thickness:i(h),lineStyle:i(m)}}),g()}var uq=(n,e,t)=>e(i(t).id),dq=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove MACD"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),fq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Fast</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Slow</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Signal</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">MACD Line:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Signal Line:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Positive Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Negative Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Reverse Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div></div></div>'),pq=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More MACD"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add MACD</span></button></div></div>'),mq=ke('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Zone Lookback Bars</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Prior Trend Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Zone Bars</label> <input type="number" min="3" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zone Bars</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zone Width %</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.005" max="0.10" step="0.005" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Factor</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.5" max="2.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min OBV Trend</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="0.6" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Zone Score</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.3" max="0.9" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Merge Nearby Zones</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Overlap/adjacent similar zones merge</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div> <div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Show Labels</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Type + score label</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zones Displayed</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"></div></div>'),hq=(n,e,t)=>{e[9]=n.currentTarget.checked?1:0,t()},vq=ke('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Resistance Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Support Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Trap Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Spike (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="1.0" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Breakout Factor (%)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="number" step="0.0001" min="0.0000" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">e.g. 0.0005 = 0.05%</span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Wick Ratio</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Trap Score</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Stable Signal</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Show blue “Stable” dots</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normal Quiet Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"></div></div></div>'),gq=ke('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Compression Inputs</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB StdDev</label> <input type="number" step="0.1" min="0.1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normalize Lookback</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Pressure SMA</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Alert & Breakout Behavior</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Pressure for Alert</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Range Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Body % of Range</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Breakout Lookback</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Bars Between Signals</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div></div>'),_q=ke('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Detection Parameters</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB StdDev</label> <input type="number" step="0.1" min="0.1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normalize Lookback</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Pressure SMA</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Alert & Breakout Filters</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Pressure for Alert</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Range Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Body % of Range</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Breakout Lookback</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Bars Between Signals</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div></div>'),yq=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove RSI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),bq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="50" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Middle</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="50"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">RSI Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change RSI Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 border-t border-base-200 pt-2 svelte-fy2ox8"><span class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Level Lines</span> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Overbought Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Oversold Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Middle Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Middle Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between mt-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Fill Opacity</span> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.05" max="0.5" step="0.05" class="range range-xs w-20 svelte-fy2ox8"> <span class="text-xs text-base-content/60 w-8 svelte-fy2ox8"> </span></div></div></div></div>'),xq=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 sm:gap-2 svelte-fy2ox8" title="Add More RSI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add RSI</span></button></div></div>'),wq=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Stochastic"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),kq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">%K Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">%D Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="50"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="50" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="50"></div></div> <div class="grid grid-cols-1 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Mid Level</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="100"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">%K Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change %K Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">%D Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change %D Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 border-t border-base-200 pt-2 svelte-fy2ox8"><span class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Level Colors</span> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Overbought Color"></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Oversold Color"></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Mid Line</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Mid Line Color"></button></div></div></div>'),Sq=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 sm:gap-2 svelte-fy2ox8" title="Add More Stochastic"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Stochastic</span></button></div></div>'),Cq=(n,e,t)=>e(i(t).id),Iq=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove DMI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Pq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">DI Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ADX Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">DI+:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">DI-:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">ADX:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),Mq=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More DMI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add DMI</span></button></div></div>'),Nq=(n,e,t)=>e(i(t).id),Aq=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Williams %R"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Tq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-50" max="0"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Middle Level</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-70" max="-30"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-100" max="-50"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">WR Line:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 border-b border-base-200 pb-1 svelte-fy2ox8">Level Lines</div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Overbought:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Middle:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Oversold:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),Fq=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More Williams %R"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Williams %R</span></button></div></div>'),Lq=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove VR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Eq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Short Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 sm:col-span-1 col-span-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Long Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Main Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Short Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Long Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),$q=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More VR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add More VR</span></button></div></div>'),Dq=(n,e,t)=>e(i(t).id),Rq=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove BBI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),jq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 1</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 2</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 3</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 4</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),Bq=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More BBI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add BBI</span></button></div></div>'),Oq=(n,e,t)=>e(i(t).id),zq=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove EMV"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Vq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 1</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 2</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),Wq=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More EMV"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add EMV</span></button></div></div>'),Hq=(n,e,t)=>e(i(t).id),qq=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove MTM"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Uq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-1 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),Gq=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More MTM"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add MTM</span></button></div></div>'),Yq=(n,e,t)=>e(i(t).id),Kq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove this AO"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Short Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Long Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="border-t border-base-300 pt-2 mt-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 mb-2 block svelte-fy2ox8">Histogram Colors</label> <div class="grid grid-cols-1 gap-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Increasing Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Decreasing Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Reverse Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div></div>'),Xq=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More Awesome Oscillator"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add More AO</span></button></div></div>'),Zq=(n,e,t)=>e(i(t).id),Jq=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove CR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Qq=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">CR Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA1 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA2 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA3 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA4 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">CR:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA1:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA2:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA3:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA4:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),eU=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More CR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add CR</span></button></div></div>'),tU=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Deviation %</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="50" step="0.1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Depth</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="50"></div></div> <div class="border-t border-base-300 pt-2 mt-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 mb-2 block svelte-fy2ox8">ZigZag Line Style</label> <div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Thickness</span> <select class="select select-bordered select-xs w-20 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Style</span> <select class="select select-bordered select-xs w-24 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),nU=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more ZigZag"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More ZigZag</button></div></div>'),sU=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Delete this PVT instance">✕</button>'),oU=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),iU=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-primary svelte-fy2ox8">➕ Add More PVT</button></div></div>'),rU=(n,e,t)=>e(i(t).id),aU=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove SAR Group"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),lU=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Start</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.001" max="0.1" step="0.001"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Increment</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.001" max="0.1" step="0.001"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max value</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="1.0" step="0.01"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Dot size:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div></div></div>'),cU=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-primary svelte-fy2ox8">➕ Add More SAR</button></div></div>'),uU=(n,e,t)=>e(i(t).id),dU=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Smart Trend Group"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),fU=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="100" step="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Multiplier</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-sm svelte-fy2ox8"> <label class="text-xs text-base-content/60 svelte-fy2ox8">Show Labels</label></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 svelte-fy2ox8">Uptrend Line</div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 svelte-fy2ox8">Downtrend Line</div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div></div>'),pU=ke('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary svelte-fy2ox8" title="Add more Smart Trend"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add Smart Trend</button></div></div>'),mU=(n,e)=>e(),hU=ke('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete EMA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),vU=ke('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),gU=(n,e)=>e(),_U=(n,e)=>e(),yU=ke('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),bU=ke('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <!></div>'),xU=ke('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more EMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add EMA</button></div>'),wU=ke('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),kU=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Delete this SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),SU=ke('<div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-sm svelte-fy2ox8" min="1" max="500"></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Color</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Line Thickness</label> <select class="select select-bordered select-xs w-20 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Line Style</label> <select class="select select-bordered select-xs w-24 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),CU=ke('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add SMA</button></div></div>'),IU=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Volume"><span class="text-xs svelte-fy2ox8">×</span></button>'),PU=ke('<div class="w-6 svelte-fy2ox8"></div>'),MU=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs svelte-fy2ox8" min="1" max="200"></div></div> <div class="space-y-2 svelte-fy2ox8"><h4 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Volume Histogram</h4> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Up Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Down Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div> <div class="space-y-2 svelte-fy2ox8"><h4 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">EMA Line</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-sm svelte-fy2ox8"> <label class="text-xs text-base-content/60 svelte-fy2ox8">Show EMA with Volume</label></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),NU=ke('<div class="space-y-3 mt-3 svelte-fy2ox8"></div>'),AU=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove TRIX"><span class="text-xs svelte-fy2ox8">×</span></button>'),TU=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">TRIX:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Signal:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">TRIX Line:</span> <div class="w-3 h-2 rounded svelte-fy2ox8"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <input type="color" class="w-8 h-6 rounded border border-base-300 cursor-pointer svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-12 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Signal Line:</span> <div class="w-3 h-2 rounded svelte-fy2ox8"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <input type="color" class="w-8 h-6 rounded border border-base-300 cursor-pointer svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-12 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),FU=(n,e)=>e(),LU=ke('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add More TRIX"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More TRIX</button></div></div>'),EU=(n,e,t)=>e(i(t).id),$U=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove BIAS"><span class="text-xs svelte-fy2ox8">×</span></button>'),DU=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Period:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Color:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Width:</span> <select class="select select-bordered select-xs w-12 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option></select></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-14 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div></div>'),RU=ke('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More BIAS"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add BIAS</span></button></div></div>'),jU=(n,e,t)=>e(i(t).id),BU=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove CCI"><span class="text-xs svelte-fy2ox8">×</span></button>'),OU=ke('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Period:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Color:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Width:</span> <select class="select select-bordered select-xs w-12 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option></select></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-14 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div></div>'),zU=ke('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More CCI"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add CCI</span></button></div></div>'),VU=ke('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Ichimoku"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),WU=ke('<div class="grid grid-cols-1 sm:grid-cols-[1.4fr_0.8fr_0.8fr_0.8fr_0.9fr] gap-3 items-center px-1 py-2 border-b border-base-200 last:border-b-0 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><div class="w-4 h-4 rounded-full border border-base-300 svelte-fy2ox8"></div> <span class="text-sm font-medium text-base-content svelte-fy2ox8"> </span></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Period</span> <input type="number" class="input input-bordered input-sm w-24 text-center svelte-fy2ox8" min="1" max="200"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Color</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-5 h-5 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Thickness</span> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Style</span> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),HU=ke('<div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-sm sm:text-base font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="hidden sm:grid grid-cols-[1.4fr_0.8fr_0.8fr_0.8fr_0.9fr] gap-3 text-xs text-base-content/60 px-1 svelte-fy2ox8"><div class="svelte-fy2ox8">Component</div> <div class="svelte-fy2ox8">Period</div> <div class="svelte-fy2ox8">Color</div> <div class="svelte-fy2ox8">Thickness</div> <div class="svelte-fy2ox8">Style</div></div> <!></div>'),qU=ke('<div class="mt-3 sm:mt-5 svelte-fy2ox8"><div class="border border-base-300 rounded-lg p-4 bg-base-50/50 svelte-fy2ox8"><div class="flex items-center gap-3 mb-6 pb-4 border-b border-base-200 svelte-fy2ox8"><div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center svelte-fy2ox8"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" class="svelte-fy2ox8"></path></svg></div> <div class="svelte-fy2ox8"><h3 class="text-lg font-semibold text-base-content svelte-fy2ox8">Ichimoku Kinko Hyo</h3> <p class="text-sm text-base-content/60 svelte-fy2ox8">Complete cloud indicator with all components</p></div></div> <div class="space-y-6 svelte-fy2ox8"></div> <div class="flex justify-center pt-4 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add Ichimoku"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Ichimoku</span></button></div> <div class="mt-6 pt-4 border-t border-base-200 svelte-fy2ox8"><div class="text-xs text-base-content/60 space-y-1 svelte-fy2ox8"><p class="svelte-fy2ox8"><strong class="svelte-fy2ox8">Components:</strong> Tenkan Sen (Conversion), Kijun Sen (Base), Senkou Span A & B (Cloud)</p> <p class="svelte-fy2ox8"><strong class="svelte-fy2ox8">Usage:</strong> Trend direction, support/resistance levels, and momentum analysis</p></div></div></div></div>'),UU=ke('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete SMA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),GU=ke('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),YU=ke('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),KU=ke('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add SMA</button></div>'),XU=ke('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),ZU=(n,e)=>e(),JU=ke('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete MA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),QU=ke('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),eG=(n,e)=>e(),tG=(n,e)=>e(),nG=ke('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),sG=ke('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <!></div>'),oG=ke('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more MA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add MA</button></div>'),iG=ke('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),rG=(n,e,t)=>e(i(t).id),aG=ke('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove ROC"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),lG=ke('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Period</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),cG=ke('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more ROC"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More ROC</button></div></div>'),uG=(n,e,t)=>e(i(t).id),dG=ke('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove PSY"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),fG=ke('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 1 (PSY Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">PSY Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 2 (MAPSY Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAPSY Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex items-center gap-2 pt-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm svelte-fy2ox8"> <label class="text-sm text-base-content/80 cursor-pointer svelte-fy2ox8">Show MAPSY</label></div></div></div>'),pG=ke('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more PSY"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More PSY</button></div></div>'),mG=(n,e,t)=>e(i(t).id),hG=ke('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove OBV"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),vG=ke('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8" style="display: none;"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 1 (OBV Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">OBV Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAOBV Period</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"> <span class="text-xs text-base-content/50 svelte-fy2ox8">Moving average period for OBV smoothing</span></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAOBV Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div></div>'),gG=ke('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more OBV"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More OBV</button></div></div>'),_G=(n,e,t)=>e(i(t).id),yG=ke('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove KDJ"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),bG=ke('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">K Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">D Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">K Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">K:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">D Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">D:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">J Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">J:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),xG=ke('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more KDJ"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More KDJ</button></div></div>'),wG=(n,e)=>e("band"),kG=(n,e)=>e("slLong"),SG=(n,e)=>e("slShort"),CG=(n,e)=>e("median"),IG=ke('<div class="space-y-4 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Outcome Band</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Band:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Fill Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Stop Lines</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Stops:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long SL Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short SL Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Median Path</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">EV Table</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Table:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div></div></div>'),PG=(n,e)=>e("fill",0),MG=(n,e)=>e("upper",0),NG=(n,e)=>e("middle",0),AG=(n,e)=>e("lower",0),TG=(n,e)=>e(0),FG=ke('<button class="btn btn-xs btn-outline btn-error gap-1 text-xs svelte-fy2ox8" title="Remove BOLL 1"><svg class="w-3 h-3 svelte-fy2ox8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg> Remove BOLL 1</button>'),LG=(n,e,t)=>e(i(t)),EG=(n,e,t)=>e("fill",i(t)),$G=(n,e,t)=>e("upper",i(t)),DG=(n,e,t)=>e("middle",i(t)),RG=(n,e,t)=>e("lower",i(t)),jG=ke('<div class="bg-base-50 border border-primary/20 rounded-md p-3 space-y-3 mt-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-semibold text-primary svelte-fy2ox8"> </h4> <button class="btn btn-xs btn-ghost text-error svelte-fy2ox8"><svg class="w-3.5 h-3.5 svelte-fy2ox8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="200"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Standard Deviation</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Fill Area</h5> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Fill Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Line Colors</h5> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Upper Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Middle Line (SMA)</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Lower Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Line Style</h5> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),BG=ke('<div class="space-y-4 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Parameters</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="200"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Standard Deviation</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Fill Area Settings</h4> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Fill Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"> <div class="flex justify-between text-xs text-base-content/50 svelte-fy2ox8"><span class="svelte-fy2ox8">0%</span> <span class="svelte-fy2ox8">50%</span> <span class="svelte-fy2ox8">100%</span></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Line Colors</h4> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Upper Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Middle Line (SMA)</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Lower Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Line Style</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex justify-center gap-2 pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more BOLL"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More BOLL</button> <!></div> <!></div>'),OG=ke('<div class="flex justify-center items-center min-h-[120px] svelte-fy2ox8"><div class="text-base-content/70 svelte-fy2ox8"> </div></div>'),zG=ke('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),VG=ke('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),WG=ke('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-16 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),HG=ke('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg></button></div>'),qG=ke('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),UG=ke('<div class="ai-branding-container svelte-fy2ox8"><div class="ai-branding-badge svelte-fy2ox8"><svg class="ai-branding-icon svelte-fy2ox8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-fy2ox8"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-fy2ox8"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-fy2ox8"></line></svg> <div class="ai-branding-text svelte-fy2ox8"><div class="ai-branding-main svelte-fy2ox8">Duty AI Algorithm Included</div> <div class="ai-branding-sub svelte-fy2ox8">Powered by Duty AI</div></div> <div class="ai-branding-glow svelte-fy2ox8"></div></div></div>'),GG=ke('<div class="responsive-modal-content svelte-fy2ox8"><!> <!></div>'),YG=ke("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function KG(n,e){Ed(e,!0);const t=sm(),s=()=>wl(f,"$chart",t),o=()=>wl(l,"$ctx",t),r=()=>wl(c,"$save",t);let a=hi(e,"show",15);const l=gd("ctx"),c=gd("save"),f=gd("chart");let u=V([]),d=V([]),h=V([]);function m(k){const N=(k||"").trim();if(!N)return null;if(/^#?[0-9A-Fa-f]{6}$/.test(N)){const D=N.startsWith("#")?N.slice(1):N;return{r:parseInt(D.slice(0,2),16),g:parseInt(D.slice(2,4),16),b:parseInt(D.slice(4,6),16)}}const j=N.match(/^rgba?\(([^)]+)\)$/i);if(j){const D=j[1].split(",").map(W=>parseFloat(W.trim()));if(D.length>=3&&D.every(W=>!isNaN(W)))return{r:Math.round(D[0]),g:Math.round(D[1]),b:Math.round(D[2])}}return null}function g(k,N){const j=m(k);if(!j)return k;const D=Math.max(0,Math.min(100,N))/100;return`rgba(${j.r}, ${j.g}, ${j.b}, ${D})`}let w=ge("#2196F3"),C=ge(5),P=ge("#f23645"),I=ge("#2962ff"),A=ge("#089981"),M=ge(1),F=ge("solid"),B=ge(20),$=ge(2),L=ge(!1),O=ge(V({x:0,y:0})),Y=ge(0),ce=ge("macdLine"),Q=ge(!1),le=ge(V({x:0,y:0})),ue=ge(0),fe=ge(!1),pe=ge(V({x:0,y:0})),Z=ge(0),xe=ge("diPlus"),oe=ge(!1),Pe=ge(V({x:0,y:0})),$e=ge(!1),ze=ge(V({x:0,y:0})),Ke=ge(!1),qe=ge(V({x:0,y:0})),nt=ge(0),ft=ge(!1),ut=ge(V({x:0,y:0})),bt=ge(0),Pt=ge(!1),Et=ge(V({x:0,y:0})),Mt=ge(V([])),Je=ge(!1),Ct=ge(V({x:0,y:0})),Ze=ge(0),Xe=ge("histogram"),Ae=ge(!1),Qe=ge(V({x:0,y:0})),gt=ge(!1),Ft=ge(V({x:0,y:0})),ot=ge(!1),ve=ge(V({x:0,y:0})),Ie=ge(!1),It=ge(V({x:0,y:0})),Dt=ge(0),Zt=ge(!1),gn=ge(V({x:0,y:0})),hn=ge(0),qn=ge("vr"),On=ge(!1),bn=ge(V({x:0,y:0})),Fn=ge(0),Xs=ge(!1),oo=ge(V({x:0,y:0})),Yn=ge(0),_o=ge(!1),xs=ge(V({x:0,y:0})),Rt=ge(0),un=ge(!1),qs=ge(V({x:0,y:0})),ri=ge(!1),Eo=ge(V({x:0,y:0})),Ia=ge(0),Lr=ge(!1),Qa=ge(V({x:0,y:0})),yr=ge(0),Fi=ge(!1),Rc=V({x:0,y:0}),Cu=ge(0),uc=ge("uptrend"),Fl=ge(!1),jc=ge(V({x:0,y:0})),nd=ge(0),Fa=ge(!1),dc=ge(V({x:0,y:0})),Bc=ge(!1),rd=ge(V({x:0,y:0})),uf=ge(!1),So=ge(V({x:0,y:0})),Ll=ge(0),ya=ge(!1),hc=ge(V({x:0,y:0})),Pa=ge(0),Yr=ge("cr"),el=ge(!1),Yl=ge(V({x:0,y:0})),Vu=ge(!1),Iu=ge(V({x:0,y:0})),Ro=ge(!1),zr=ge(V({x:0,y:0})),kl=ge(0),Md=ge(!1),nf=ge(V({x:0,y:0})),zf=ge(!1),df=ge(V({x:0,y:0})),Pu=ge(!1),Dd=V({x:0,y:0}),yf=ge(!1),$n=V({x:0,y:0}),ws=ge(!1),Us=ge(V({x:0,y:0})),Dn=ge(!1),ni=ge(V({x:0,y:0})),mo=ge(!1),sr=ge(V({x:0,y:0})),or=ge(!1),hl=ge(V({x:0,y:0})),Oi=ge(!1),si=ge(V({x:0,y:0})),Wo=ge(!1),Ua=ge(V({x:0,y:0})),Hi=ge(!1),to=ge(V({x:0,y:0})),Li=ge(!1),Vr=ge(V({x:0,y:0})),ba=ge(!1),qi=ge(V({x:0,y:0})),Wr=ge(1),Kl=ge("solid"),Wl=ge(1),Ic=ge("dashed"),Pc=ge(1),cl=ge("dashed"),mr=ge(22),La=ge("#66c2a5"),Sl=ge("#66c2a5"),Ba=ge("#e67e22"),vi=ge("#c0392b"),vc=ge(!0),ul=ge(!0),Ga=ge(!0),vl=ge(!1),pu=ge(V({x:0,y:0})),tl=ge(0),Oa=ge(!1),Oc=ge(V({x:0,y:0})),Gu=ge(0),El=ge(0),mu=ge(0),bc=ge(!1),nl=ge(V({x:0,y:0})),la=ge(0),Mu=ge(!1),Yu=ge(V({x:0,y:0})),zc=ge(0),Zd=ge(!1),Yf=ge(V({x:0,y:0})),Kf=ge(0),_d=ge(!1),Rd=ge(!1),fc=ge(!1),pp=ge(!1),kd=ge(!1),Wd=ge(V({x:0,y:0})),$l=ge(0);function Nu(k,N){if(s()){try{s().removeIndicator({paneId:k,name:N})}catch(j){console.log("Error removing indicator:",j)}c.update(j=>{const D=`${k}_${N}`;return delete j.saveInds[D],j})}}const Ku=Bt(()=>o().editIndName==="BOLL"),bf=Bt(()=>o().editIndName==="MACD"),Xu=Bt(()=>o().editIndName==="BIAS"),Ql=Bt(()=>o().editIndName==="AO"),Hd=Bt(()=>o().editIndName==="WR"),hu=Bt(()=>o().editIndName==="VR"),Jc=Bt(()=>o().editIndName==="BBI"),Au=Bt(()=>o().editIndName==="EMA"),jd=Bt(()=>o().editIndName==="SMA"),Wu=Bt(()=>o().editIndName==="MA"),sf=Bt(()=>o().editIndName==="ICHIMOKU"),ad=Bt(()=>o().editIndName==="PVT"),yd=Bt(()=>o().editIndName==="VOL"),Bd=Bt(()=>o().editIndName==="SAR"),Mc=Bt(()=>o().editIndName==="DMI"),Tu=Bt(()=>o().editIndName==="TRIX"),qd=Bt(()=>o().editIndName==="ROC"),Xf=Bt(()=>o().editIndName==="ZIGZAG"),Vf=Bt(()=>o().editIndName==="PSY"),se=Bt(()=>o().editIndName==="OBV"),be=Bt(()=>o().editIndName==="CR"),G=Bt(()=>o().editIndName==="NPO_MAE"),re=Bt(()=>o().editIndName==="KDJ"),we=Bt(()=>o().editIndName==="CCI"),J=Bt(()=>o().editIndName==="EMV"),Fe=Bt(()=>o().editIndName==="MTM"),yt=Bt(()=>o().editIndName==="RSI"),vt=Bt(()=>o().editIndName==="STOCH"),jt=Bt(()=>o().editIndName==="SMARTTREND"),ye=Bt(()=>o().editIndName==="SMART_MONEY"),E=Bt(()=>o().editIndName==="TRAP_HUNTER"),me=Bt(()=>o().editIndName==="VOLCANIC"),Se=Bt(()=>o().editIndName==="VOLCANIC_SIG"),Ve=Bt(()=>i(ye)||i(E)||i(me)||i(Se));function Ye(){if(!(o().editIndName!=="TRAP_HUNTER"||!s()))try{const k=(u||[]).map(N=>Number(N));s().overrideIndicator({name:"TRAP_HUNTER",calcParams:k,paneId:o().editPaneId})}catch(k){console.error("❌ Error updating Trap Hunter:",k)}}function at(){if(!(o().editIndName!=="VOLCANIC"||!s()))try{const k=(u||[]).map(N=>Number(N));s().overrideIndicator({name:"VOLCANIC",calcParams:k,paneId:o().editPaneId})}catch(k){console.error("❌ Error updating VOLCANIC:",k)}}function Re(){if(!(o().editIndName!=="VOLCANIC_SIG"||!s()))try{const k=(u||[]).map(N=>Number(N));s().overrideIndicator({name:"VOLCANIC_SIG",calcParams:k,paneId:o().editPaneId})}catch(k){console.error("❌ Error updating VOLCANIC_SIG:",k)}}let De=ge("");Fr(()=>{if(!i(me))return;const k=JSON.stringify(u??[]);k!==i(De)&&(x(De,V(k)),at())});let pt=ge("");Fr(()=>{if(!i(Se))return;const k=JSON.stringify(u??[]);k!==i(pt)&&(x(pt,V(k)),Re())});const Ge=Bt(()=>o().editIndName==="SMARTTREND"?"Smart Trend":o().editIndName);let sn=ge("#2962FF"),Un=ge(2),Zs=ge("solid"),vs=ge(26),Oo=ge(10),Pi=ge(20),no=ge(40),gl=ge(60),Ms=V({zoneLookbackBars:40,minZoneBars:5,maxZoneBars:25,atrPeriod:14,volumeMAPeriod:20,minVolumeFactor:1.2,maxZoneWidthPct:.03,priorTrendLookback:20,minOBVTrendStrength:.2,minZoneScore:.6,mergeNearbyZones:!0,maxZonesDisplayed:20,showLabels:!0});function wo(){if(!i(ye)||!Array.isArray(u))return;const k=u;Ms.zoneLookbackBars=Number(k[0]??Ms.zoneLookbackBars),Ms.minZoneBars=Number(k[1]??Ms.minZoneBars),Ms.maxZoneBars=Number(k[2]??Ms.maxZoneBars),Ms.atrPeriod=Number(k[3]??Ms.atrPeriod),Ms.volumeMAPeriod=Number(k[4]??Ms.volumeMAPeriod),Ms.minVolumeFactor=Number(k[5]??Ms.minVolumeFactor),Ms.maxZoneWidthPct=Number(k[6]??Ms.maxZoneWidthPct),Ms.priorTrendLookback=Number(k[7]??Ms.priorTrendLookback),Ms.minOBVTrendStrength=Number(k[8]??Ms.minOBVTrendStrength),Ms.minZoneScore=Number(k[9]??Ms.minZoneScore),Ms.mergeNearbyZones=Number(k[10]??(Ms.mergeNearbyZones?1:0))>0,Ms.maxZonesDisplayed=Number(k[11]??Ms.maxZonesDisplayed),Ms.showLabels=Number(k[12]??(Ms.showLabels?1:0))>0}Fr(()=>{i(ye)&&wo()});function fr(){var N;const k=[Ms.zoneLookbackBars,Ms.minZoneBars,Ms.maxZoneBars,Ms.atrPeriod,Ms.volumeMAPeriod,Ms.minVolumeFactor,Ms.maxZoneWidthPct,Ms.priorTrendLookback,Ms.minOBVTrendStrength,Ms.minZoneScore,Ms.mergeNearbyZones?1:0,Ms.maxZonesDisplayed,Ms.showLabels?1:0];(N=s())==null||N.overrideIndicator({name:"SMART_MONEY",calcParams:k,paneId:o().editPaneId}),c.update(j=>(j.saveInds[`${o().editPaneId}_SMART_MONEY`]={name:"SMART_MONEY",params:k,pane_id:o().editPaneId},j))}let xa=ge("#FF6B35"),ic=ge("#2196F3"),ec=ge("#4CAF50"),Lf=ge("#FF9800"),_e=ge("#9C27B0"),We=ge(2),xt=ge(1),Ht=ge(1),qt=ge(1),ht=ge(1),dn=ge("solid"),Ut=ge("solid"),Xn=ge("solid"),rs=ge("solid"),_t=ge("solid");Fr(()=>{i(qd)&&!i(Dl)?(console.log("🎯 ROC modal opened, initializing..."),x(Dl,!0),zm(),setTimeout(()=>{sp()},100)):!i(qd)&&i(Dl)&&x(Dl,!1)});let Gt=ge(!1),en=ge(!1);Fr(()=>{i(yt)&&!i(Gt)?(console.log("🎯 RSI modal opened, initializing..."),x(Gt,!0),Wg()):!i(yt)&&i(Gt)&&x(Gt,!1)}),Fr(()=>{i(vt)&&!i(en)?(console.log("🎯 Stochastic modal opened, initializing..."),x(en,!0),jm()):!i(vt)&&i(en)&&x(en,!1)}),Fr(()=>{i(Tu)&&!i(Fu)?(console.log("🎯 TRIX modal opened, initializing..."),x(Fu,!0),$a()):!i(Tu)&&i(Fu)&&x(Fu,!1)});let cs=ge(!1);Fr(()=>{i(jd)&&!i(cs)?(console.log("🎯 SMA modal opened, initializing..."),x(cs,!0),Zn()):!i(jd)&&i(cs)&&x(cs,!1)});let ps=ge(!1);Fr(()=>{i(hu)&&!i(ps)?(console.log("🎯 VR modal opened, initializing..."),x(ps,!0),z0()):!i(hu)&&i(ps)&&x(ps,!1)});let vo=ge(!1);Fr(()=>{i(yd)&&!i(vo)?(console.log("🎯 Volume modal opened, initializing..."),x(vo,!0),Ig()):!i(yd)&&i(vo)&&x(vo,!1)});let Ko=ge(!1);Fr(()=>{i(Jc)&&!i(Ko)?(console.log("🎯 BBI modal opened, initializing..."),x(Ko,!0),Ei()):!i(Jc)&&i(Ko)&&x(Ko,!1)}),Fr(()=>{i(Jc)&&i(Ko)&&s()&&i(Nc).forEach((k,N)=>{const{period1:j,period2:D,period3:W,period4:H,color:he,thickness:Le,lineStyle:st}=k;if(j&&D&&W&&H&&he&&Le&&st){const Jt=setTimeout(()=>{Lt(N)},100);return()=>clearTimeout(Jt)}})});let ho=ge(!1);Fr(()=>{i(Ku)&&!i(ho)?(console.log("🎯 Bollinger Bands modal opened, initializing..."),x(ho,!0),_h()):!i(Ku)&&i(ho)&&x(ho,!1)}),Fr(()=>{if(i(Ku)&&i(ho)&&s()){const k=i(B),N=i($),j=i(w),D=i(C),W=i(P),H=i(I),he=i(A),Le=i(M),st=i(F);if(k&&N&&j&&W&&H&&he&&Le&&st){const Jt=setTimeout(()=>{i(Ea).length===0?x(Ea,V([{id:Br(),paneId:o().editPaneId||"candle_pane",period:k,stdDev:N,styles:{fillColor:j,fillOpacity:D,upperColor:W,middleColor:H,lowerColor:he,thickness:Le,lineStyle:st}}])):(i(Ea)[0].period=k,i(Ea)[0].stdDev=N,i(Ea)[0].styles.fillColor=j,i(Ea)[0].styles.fillOpacity=D,i(Ea)[0].styles.upperColor=W,i(Ea)[0].styles.middleColor=H,i(Ea)[0].styles.lowerColor=he,i(Ea)[0].styles.thickness=Le,i(Ea)[0].styles.lineStyle=st),ro()},100);return()=>clearTimeout(Jt)}}});let wa=ge(!1);Fr(()=>{i(Bd)&&!i(wa)?(console.log("🎯 SAR modal opened, initializing..."),x(wa,!0),$u()):!i(Bd)&&i(wa)&&x(wa,!1)}),Fr(()=>{i(Bd)&&i(wa)&&s()&&i(Hl).forEach((k,N)=>{const{start:j,increment:D,maxValue:W,color:H,dotSize:he}=k;if(j!==void 0&&D!==void 0&&W!==void 0&&H&&he){const Le=setTimeout(()=>{Po(N)},100);return()=>clearTimeout(Le)}})});let di=ge(!1);Fr(()=>{i(Ql)&&!i(di)?(console.log("🎯 AO modal opened, initializing..."),x(di,!0),$p()):!i(Ql)&&i(di)&&x(di,!1)}),Fr(()=>{i(Ql)&&i(di)&&s()&&i(na).forEach((k,N)=>{const{shortPeriod:j,longPeriod:D,styles:W}=k;if(j&&D&&W){const H=setTimeout(()=>{am()},100);return()=>clearTimeout(H)}})});let Mi=ge(!1);Fr(()=>{i(Xu)&&!i(Mi)?(console.log("🎯 BIAS modal opened, initializing..."),x(Mi,!0),Rl()):!i(Xu)&&i(Mi)&&x(Mi,!1)}),Fr(()=>{i(Xu)&&i(Mi)&&s()&&i(io).forEach((k,N)=>{const{period:j,color:D,thickness:W,lineStyle:H}=k;if(j&&D&&W&&H){const he=setTimeout(()=>{tc()},100);return()=>clearTimeout(he)}})});let Kr=ge(!1);Fr(()=>{i(Fe)&&!i(Kr)?(console.log("🎯 MTM modal opened, initializing..."),x(Kr,!0),Fv()):!i(Fe)&&i(Kr)&&x(Kr,!1)}),Fr(()=>{i(Fe)&&i(Kr)&&s()&&i(Sr).forEach((k,N)=>{const{period:j,color:D,thickness:W,lineStyle:H}=k;if(j&&D&&W&&H){const he=setTimeout(()=>{mh()},100);return()=>clearTimeout(he)}})});let hr=ge(!1),sl=ge(!1);Fr(()=>{i(se)&&!i(hr)?(console.log("🎯 OBV modal opened, initializing..."),x(hr,!0),Vm()):!i(se)&&i(hr)&&x(hr,!1)}),Fr(()=>{if(i(sl)){console.log("⏸️ Skipping OBV effect - removal in progress");return}i(se)&&i(hr)&&s()&&i(cr).forEach((k,N)=>{const{obvPeriod:j,maobvPeriod:D,showMaobv:W,styles:H}=k;if(j&&D&&H){const he=setTimeout(()=>{rm()},100);return()=>clearTimeout(he)}})});let fo=ge(!1);Fr(()=>{i(we)&&!i(fo)?(console.log("🎯 CCI modal opened, initializing..."),x(fo,!0),gc()):!i(we)&&i(fo)&&x(fo,!1)}),Fr(()=>{i(we)&&i(fo)&&s()&&i(ko).forEach((k,N)=>{const{period:j,color:D,thickness:W,lineStyle:H}=k;if(j&&D&&W&&H){const he=setTimeout(()=>{wd()},100);return()=>clearTimeout(he)}})});let wu=ge(!1);Fr(()=>{i(be)&&!i(wu)?(console.log("🎯 CR modal opened, initializing..."),x(wu,!0),mp()):!i(be)&&i(wu)&&x(wu,!1)}),Fr(()=>{i(be)&&i(wu)&&s()&&i(br).forEach((k,N)=>{const{crPeriod:j,crMa1Period:D,crMa2Period:W,crMa3Period:H,crMa4Period:he,styles:Le}=k;if(j&&D&&W&&H&&he&&Le){const st=setTimeout(()=>{vu()},100);return()=>clearTimeout(st)}})});let _l=ge(!1);Fr(()=>{i(Mc)&&!i(_l)?(console.log("🎯 DMI modal opened, initializing..."),x(_l,!0),ld()):!i(Mc)&&i(_l)&&x(_l,!1)}),Fr(()=>{i(Mc)&&i(_l)&&s()&&i(ol).forEach((k,N)=>{const{diPeriod:j,adxPeriod:D,styles:W}=k;if(j&&D&&W){const H=setTimeout(()=>{Tc()},100);return()=>clearTimeout(H)}})}),Fr(()=>{i(hu)&&i(ps)&&s()&&i(Qc).forEach((k,N)=>{const{period:j,shortPeriod:D,longPeriod:W,styles:H}=k;if(j&&D&&W&&H){const he=setTimeout(()=>{rt(N)},100);return()=>clearTimeout(he)}})}),Fr(()=>{i(bf)&&s()&&i(Xl).length>0&&i(Xl).forEach((k,N)=>{const{fastPeriod:j,slowPeriod:D,signalPeriod:W,styles:H}=k;if(j&&D&&W&&H){const he=setTimeout(()=>{Gh(N)},100);return()=>clearTimeout(he)}})});let Xl=ge(V([])),rc=ge(V([])),Qc=ge(V([])),na=ge(V([])),Nc=ge(V([])),Ea=ge(V([])),Nd=ge(0),In=ge(V([])),St=ge(0);function Rn(k){x(St,V(k)),x(qs,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(un,!0)}function Cn(){if(!s())return;const k=o().editPaneId||"candle_pane";for(let N=0;N<6;(N+=1)-1)try{s().removeIndicator({paneId:k,name:"ZIGZAG"})}catch{}i(In).forEach((N,j)=>{const D=N.styles.lineStyle==="solid"?wt.Solid:wt.Dashed,W=N.styles.lineStyle==="dashed"?[4,4]:N.styles.lineStyle==="dotted"?[2,6]:[2,2],H={lines:[{color:N.styles.color,size:N.styles.thickness,style:D,dashedValue:W,smooth:!1}]};s().createIndicator({name:"ZIGZAG",calcParams:[N.deviation,N.depth],styles:H},!0,{id:k});const he=j===0?`${k}_ZIGZAG`:`${k}_ZIGZAG_${j+1}`;c.update(Le=>(Le.saveInds[he]={name:"ZIGZAG",pane_id:k,params:[N.deviation,N.depth],styles:H},Le))}),c.update(N=>{const j=`${k}_ZIGZAG`;return Object.keys(N.saveInds).filter(W=>W.startsWith(j)).forEach(W=>{const H=W.match(/_ZIGZAG(?:_(\d+))?$/);(H&&H[1]?parseInt(H[1],10):1)>i(In).length&&delete N.saveInds[W]}),N})}function Ts(k,N){x(Nd,V(N));const j={x:window.innerWidth/2,y:window.innerHeight/2};k==="fill"&&(x(ni,V(j)),x(Dn,!0)),k==="upper"&&(x(sr,V(j)),x(mo,!0)),k==="middle"&&(x(hl,V(j)),x(or,!0)),k==="lower"&&(x(si,V(j)),x(Oi,!0))}function Fs(){return window.__npoMaeApi}function Es(k){const N={x:window.innerWidth/2,y:window.innerHeight/2};k==="median"&&(x(Ua,V(N)),x(Wo,!0)),k==="band"&&(x(to,V(N)),x(Hi,!0)),k==="slLong"&&(x(Vr,V(N)),x(Li,!0)),k==="slShort"&&(x(qi,V(N)),x(ba,!0))}function Co(){const k=Fs();if(!k)return;k.updateSettings({bandAlpha:Math.max(0,Math.min(100,i(mr)))/100});const N=g(i(La),i(mr));k.setColors({band:N})}let li=ge(!1);Fr(()=>{var k,N;if(!(!i(G)||i(li)||!s()))try{const D=(((N=(k=s()).getOverlays)==null?void 0:N.call(k))??[]).find(Le=>(Le==null?void 0:Le.name)==="NearestPatternOutcomeMaeStop"),W=(D==null?void 0:D.extendData)||{},H=W.colors||{};H.median&&x(Sl,V(H.median)),H.band&&x(La,V(H.band)),H.slLong&&x(Ba,V(H.slLong)),H.slShort&&x(vi,V(H.slShort)),typeof W.showOutcomeBand=="boolean"&&x(vc,V(W.showOutcomeBand)),typeof W.showStopLines=="boolean"&&x(ul,V(W.showStopLines)),typeof W.showTable=="boolean"&&x(Ga,V(W.showTable));const he=W.styles||{};he.median&&(typeof he.median.size=="number"&&x(Wr,V(he.median.size)),typeof he.median.style=="string"&&x(Kl,V(he.median.style))),he.slLong&&(typeof he.slLong.size=="number"&&x(Wl,V(he.slLong.size)),typeof he.slLong.style=="string"&&x(Ic,V(he.slLong.style))),he.slShort&&(typeof he.slShort.size=="number"&&x(Pc,V(he.slShort.size)),typeof he.slShort.style=="string"&&x(cl,V(he.slShort.style))),typeof W.bandAlpha=="number"&&x(mr,V(Math.round((W.bandAlpha||0)*100))),x(li,!0)}catch{}});function ro(){if(!s())return;const k=o().editPaneId||"candle_pane";for(let N=0;N<6;(N+=1)-1)try{s().removeIndicator({paneId:k,name:"BOLL"})}catch{}i(Ea).forEach((N,j)=>{const D=N.styles.lineStyle==="solid"?wt.Solid:wt.Dashed,W=N.styles.lineStyle==="dashed"?[4,4]:[0,0],H={lines:[{color:N.styles.upperColor,size:N.styles.thickness,style:D,dashedValue:W},{color:N.styles.middleColor,size:N.styles.thickness,style:D,dashedValue:W},{color:N.styles.lowerColor,size:N.styles.thickness,style:D,dashedValue:W}],fill:{color:N.styles.fillColor,opacity:(N.styles.fillOpacity||0)/100}};s().createIndicator({name:"BOLL",calcParams:[N.period,N.stdDev],styles:H},!0,{id:k});const he=j===0?`${k}_BOLL`:`${k}_BOLL_${j+1}`;c.update(Le=>(Le.saveInds[he]={name:"BOLL",pane_id:k,params:[N.period,N.stdDev],bollingerStyles:{fillColor:N.styles.fillColor,fillOpacity:N.styles.fillOpacity,upperColor:N.styles.upperColor,middleColor:N.styles.middleColor,lowerColor:N.styles.lowerColor,thickness:N.styles.thickness,lineStyle:N.styles.lineStyle}},Le))}),c.update(N=>{const j=`${k}_BOLL`;return Object.keys(N.saveInds).filter(W=>W.startsWith(j)).forEach(W=>{const H=W.match(/_BOLL(?:_(\d+))?$/);(H&&H[1]?parseInt(H[1],10):1)>i(Ea).length&&delete N.saveInds[W]}),N})}function zo(k){if(i(Ea).length<=1)return;x(Ea,V(i(Ea).filter((j,D)=>D!==k)));const N=i(Ea)[0];N&&(x(B,V(N.period)),x($,V(N.stdDev)),x(w,V(N.styles.fillColor)),x(C,V(N.styles.fillOpacity)),x(P,V(N.styles.upperColor)),x(I,V(N.styles.middleColor)),x(A,V(N.styles.lowerColor)),x(M,V(N.styles.thickness)),x(F,V(N.styles.lineStyle))),ro()}let io=ge(V([])),Ji=ge(V([])),Hl=ge(V([])),Vc=ge(V([])),ol=ge(V([])),Ac=ge(V([])),br=ge(V([])),fa=ge(V([])),Dl=ge(!1),Fu=ge(!1),Xr=ge(V([])),cr=ge(V([])),us=ge(V([])),ko=ge(V([]));function ur(){x(ko,V([])),console.log("✅ CCI groups cleared from modal state")}let Pr=ge(V([]));function kr(){x(Pr,V([])),console.log("✅ EMV groups cleared from modal state")}let Sr=ge(V([]));function Lu(){x(Sr,V([])),console.log("✅ MTM groups cleared from modal state")}function iu(){x(cr,V([])),console.log("✅ OBV groups cleared from modal state")}function bd(){x(Xr,V([])),console.log("✅ PSY groups cleared from modal state")}let Or=ge(V([]));function pc(){x(Or,V([])),console.log("✅ PVT groups cleared from modal state")}function Wc(){x(Mt,V([])),console.log("✅ VOL groups cleared from modal state")}function Od(){x(rc,V([])),console.log("✅ WR groups cleared from modal state")}function Zu(){if(!i(ad))return;const k=`${o().editPaneId}_PVT`,N=r().saveInds[k];N&&N.pvtGroups&&N.pvtGroups.length>0?x(Or,V([...N.pvtGroups])):i(Or).length===0&&x(Or,V([{id:Br(),name:"PVT #1",color:"#2563eb",thickness:1,lineStyle:"solid"}]))}function ff(){var N;if(!i(ad))return;const k={id:Br(),name:`PVT #${i(Or).length+1}`,color:"#2563eb",thickness:1,lineStyle:"solid"};if(i(Or).push(k),s()){let j=wt.Solid,D=[2,2];k.lineStyle==="dashed"?(j=wt.Dashed,D=[4,4]):k.lineStyle==="dotted"&&(j=wt.Dashed,D=[2,2]);const W={lines:[{color:k.color,size:k.thickness,style:j,dashedValue:D}]},H=(N=s())==null?void 0:N.createIndicator({name:"PVT",styles:W,figures:[{key:"pvt",title:"PVT: ",type:"line"}]},!1);console.log("✅ Created PVT indicator on pane:",H),H&&c.update(he=>{const Le=`${H}_PVT`;return he.saveInds[Le]||(he.saveInds[Le]={name:"PVT",pane_id:H,pvtGroups:[]}),he.saveInds[Le].pvtGroups||(he.saveInds[Le].pvtGroups=[]),he.saveInds[Le].pvtGroups.push({...k}),console.log("💾 Saved new PVT group to storage:",Le,k),he})}console.log("➕ Added new PVT group:",k.name,"ID:",k.id)}function xd(k){var j,D;if(!i(ad)||i(Or).length<=1||k<0||k>=i(Or).length)return;console.log("🗑️ Removing PVT group at index:",k);const N=i(Or).length;if(i(Or)[k],i(Or).splice(k,1),console.log(`📝 Removed group: ${N} -> ${i(Or).length}`),i(Or).forEach((W,H)=>{W.name=`PVT #${H+1}`}),s())try{const H=((j=s())==null?void 0:j.getIndicators()).filter(he=>he.name==="PVT");console.log("📈 PVT indicators found:",H.length);for(const he of H)console.log("🗑️ Removing PVT from pane:",he.paneId),(D=s())==null||D.removeIndicator({paneId:he.paneId,name:"PVT"});i(Or).forEach((he,Le)=>{var Bn;let st=wt.Solid,Jt=[2,2];he.lineStyle==="dashed"?(st=wt.Dashed,Jt=[4,4]):he.lineStyle==="dotted"&&(st=wt.Dashed,Jt=[2,2]);const fs={lines:[{color:he.color,size:he.thickness,style:st,dashedValue:Jt}]};console.log("➕ Re-adding PVT group:",he.name,"at index:",Le);const ts=(Bn=s())==null?void 0:Bn.createIndicator({name:"PVT",styles:fs,figures:[{key:"pvt",title:"PVT: ",type:"line"}]},!1);ts&&c.update(ti=>{const ci=`${ts}_PVT`;return ti.saveInds[ci]||(ti.saveInds[ci]={name:"PVT",pane_id:ts,pvtGroups:[]}),ti.saveInds[ci].pvtGroups||(ti.saveInds[ci].pvtGroups=[]),ti.saveInds[ci].pvtGroups[Le]={...he},ti})}),console.log("✅ Successfully updated PVT indicators on chart")}catch(W){console.error("❌ Error updating PVT indicators:",W)}console.log("✅ PVT group removed. Remaining groups:",i(Or).length)}function Wf(){x(fa,V([])),console.log("✅ ROC groups cleared from modal state")}let Ui=ge(V([]));function om(){x(Ui,V([])),console.log("✅ RSI groups cleared from modal state")}function Ef(){const k=new Set,N=s();if(!(N!=null&&N.getIndicators))return k;try{N.getIndicators().forEach(D=>{(D==null?void 0:D.name)==="RSI"&&(D!=null&&D.paneId)&&k.add(D.paneId)})}catch(j){console.warn("⚠️ Failed to read RSI pane IDs from chart:",j)}return k}function it(k,N){const j=Ef();for(const D of j)if(!k.has(D))return D;return N}function gv(k){const N="pane_RSI";if(!k.has(N))return N;let j=2;for(;k.has(`${N}_${j}`)&&j<1e3;)j+=1;if(!k.has(`${N}_${j}`))return`${N}_${j}`;let D=`${N}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;for(;k.has(D);)D=`${N}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;return D}function Nv(k,N={}){return{...k,...N,styles:{...k.styles,rsi:{...k.styles.rsi}}}}function Ep(k){var W,H,he;if(!k||k.name!=="RSI")return null;const N=Array.isArray(k.rsiGroups)&&k.rsiGroups.length>0?k.rsiGroups[0]:null;if(!N)return null;const j=N.actualPaneId||N.paneId||k.pane_id,D=N.styles||{};return{id:N.id||Br(),period:N.period??(Array.isArray(k.params)?k.params[0]:14),overboughtLevel:N.overboughtLevel??70,middleLevel:N.middleLevel??50,oversoldLevel:N.oversoldLevel??30,fillOpacity:N.fillOpacity??.15,paneId:j||k.pane_id,actualPaneId:j||k.pane_id,styles:{rsi:{color:((W=D.rsi)==null?void 0:W.color)??"#8B5CF6",thickness:((H=D.rsi)==null?void 0:H.thickness)??2,lineStyle:((he=D.rsi)==null?void 0:he.lineStyle)??"solid"},overboughtColor:D.overboughtColor??"#EF4444",overboughtThickness:D.overboughtThickness??1,overboughtLineStyle:D.overboughtLineStyle??"dashed",oversoldColor:D.oversoldColor??"#22C55E",oversoldThickness:D.oversoldThickness??1,oversoldLineStyle:D.oversoldLineStyle??"dashed",middleLineColor:D.middleLineColor??"#6B7280",middleLineThickness:D.middleLineThickness??1,middleLineStyle:D.middleLineStyle??"dashed"}}}function ku(){const k=new Map;Object.values(r().saveInds||{}).forEach(j=>{if(!j||j.name!=="RSI")return;const D=Ep(j);D!=null&&D.actualPaneId&&!k.has(D.actualPaneId)&&k.set(D.actualPaneId,D)});const N=Array.from(k.values());return o().editPaneId&&N.sort((j,D)=>j.actualPaneId===o().editPaneId?-1:D.actualPaneId===o().editPaneId?1:(j.actualPaneId||"").localeCompare(D.actualPaneId||"")),N}function Rm(){if(!i(yt))return;const k=i(Ui).map(N=>{const j=N.actualPaneId||N.paneId||o().editPaneId;return Nv(N,{paneId:j,actualPaneId:j})});c.update(N=>(Object.keys(N.saveInds||{}).forEach(j=>{var D;((D=N.saveInds[j])==null?void 0:D.name)==="RSI"&&delete N.saveInds[j]}),k.forEach(j=>{const D=j.actualPaneId;if(!D)return;const W=`${D}_RSI`;N.saveInds[W]={name:"RSI",pane_id:D,params:[j.period],rsiGroups:[Nv(j)]}}),N))}function Wg(){if(!i(yt))return;const k=ku(),N=Ef();if(N.size>0&&k.length<N.size){const j=[];if(N.forEach(D=>{try{const W=m0.getInstance(D)||m0.getInstanceConfig(D);if(!W)return;const H={id:Br(),period:W.period??14,overboughtLevel:W.overboughtLevel??70,middleLevel:W.middleLevel??50,oversoldLevel:W.oversoldLevel??30,fillOpacity:W.fillOpacity??.15,paneId:D,actualPaneId:D,styles:{rsi:{color:W.lineColor??"#8B5CF6",thickness:W.lineThickness??2,lineStyle:W.lineStyle??"solid"},overboughtColor:W.overboughtColor??"#EF4444",overboughtThickness:W.overboughtThickness??1,overboughtLineStyle:W.overboughtLineStyle??"dashed",oversoldColor:W.oversoldColor??"#22C55E",oversoldThickness:W.oversoldThickness??1,oversoldLineStyle:W.oversoldLineStyle??"dashed",middleLineColor:W.middleLineColor??"#6B7280",middleLineThickness:W.middleLineThickness??1,middleLineStyle:W.middleLineStyle??"dashed"}};j.push(H)}catch(W){console.warn("⚠️ Failed to reconstruct RSI group from instance:",W)}}),j.length>0){x(Ui,V(j)),Rm();return}}if(k.length>0){x(Ui,V(k)),Rm();return}if(i(Ui).length===0){const j={id:Br(),period:14,overboughtLevel:70,middleLevel:50,oversoldLevel:30,fillOpacity:.15,paneId:o().editPaneId,actualPaneId:o().editPaneId,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed"}};x(Ui,V([j])),m0.createInstance(j.actualPaneId,{period:j.period,lineColor:j.styles.rsi.color,lineThickness:j.styles.rsi.thickness,lineStyle:j.styles.rsi.lineStyle,overboughtLevel:j.overboughtLevel,oversoldLevel:j.oversoldLevel,middleLevel:j.middleLevel,overboughtColor:j.styles.overboughtColor,overboughtThickness:j.styles.overboughtThickness??1,overboughtLineStyle:j.styles.overboughtLineStyle||"dashed",oversoldColor:j.styles.oversoldColor,oversoldThickness:j.styles.oversoldThickness??1,oversoldLineStyle:j.styles.oversoldLineStyle||"dashed",overboughtFillColor:j.styles.overboughtColor,oversoldFillColor:j.styles.oversoldColor,middleLineColor:j.styles.middleLineColor,middleLineThickness:j.styles.middleLineThickness??1,middleLineStyle:j.styles.middleLineStyle||"dashed",fillOpacity:j.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:j.overboughtLevel,color:j.styles.overboughtColor,lineStyle:j.styles.overboughtLineStyle||"dashed",thickness:j.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:j.middleLevel,color:j.styles.middleLineColor,lineStyle:j.styles.middleLineStyle||"dashed",thickness:j.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:j.oversoldLevel,color:j.styles.oversoldColor,lineStyle:j.styles.oversoldLineStyle||"dashed",thickness:j.styles.oversoldThickness??1,label:"30",visible:!0}]}),Rm()}}function Sg(){if(!i(yt))return;const k=Ef(),N=new Set(k);i(Ui).forEach(H=>{const he=H.actualPaneId||H.paneId;he&&N.add(he)});const j=gv(N),D={id:Br(),period:14,overboughtLevel:70,middleLevel:50,oversoldLevel:30,fillOpacity:.15,paneId:j,actualPaneId:j,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed"}};i(Ui).push(D);let W=j;if(s()){const H=s(),he=new Set(k);let Le=wt.Solid,st=[2,2];D.styles.rsi.lineStyle==="dashed"?(Le=wt.Dashed,st=[6,4]):D.styles.rsi.lineStyle==="dotted"&&(Le=wt.Dashed,st=[2,2]);const Jt=H.createIndicator({name:"RSI",calcParams:[D.period],styles:{lines:[{color:D.styles.rsi.color,size:D.styles.rsi.thickness,style:Le,dashedValue:st}]}},!1,{id:j,axis:{gap:{bottom:2}}});if(W=it(he,j),D.paneId=W,D.actualPaneId=W,m0.createInstance(W,{period:D.period,lineColor:D.styles.rsi.color,lineThickness:D.styles.rsi.thickness,lineStyle:D.styles.rsi.lineStyle,overboughtLevel:D.overboughtLevel,oversoldLevel:D.oversoldLevel,middleLevel:D.middleLevel,overboughtColor:D.styles.overboughtColor,overboughtThickness:D.styles.overboughtThickness??1,overboughtLineStyle:D.styles.overboughtLineStyle||"dashed",oversoldColor:D.styles.oversoldColor,oversoldThickness:D.styles.oversoldThickness??1,oversoldLineStyle:D.styles.oversoldLineStyle||"dashed",overboughtFillColor:D.styles.overboughtColor,oversoldFillColor:D.styles.oversoldColor,middleLineColor:D.styles.middleLineColor,middleLineThickness:D.styles.middleLineThickness??1,middleLineStyle:D.styles.middleLineStyle||"dashed",fillOpacity:D.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:D.overboughtLevel,color:D.styles.overboughtColor,lineStyle:D.styles.overboughtLineStyle||"dashed",thickness:D.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:D.middleLevel,color:D.styles.middleLineColor,lineStyle:D.styles.middleLineStyle||"dashed",thickness:D.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:D.oversoldLevel,color:D.styles.oversoldColor,lineStyle:D.styles.oversoldLineStyle||"dashed",thickness:D.styles.oversoldThickness??1,label:"30",visible:!0}]}),Jt){const fs=`${W}_RSI`;c.update(ts=>(ts.saveInds[fs]={name:"RSI",pane_id:W,params:[D.period],rsiGroups:[{id:D.id,period:D.period,overboughtLevel:D.overboughtLevel,middleLevel:D.middleLevel,oversoldLevel:D.oversoldLevel,paneId:W,actualPaneId:W,styles:D.styles}]},ts))}}else m0.createInstance(W,{period:D.period,lineColor:D.styles.rsi.color,lineThickness:D.styles.rsi.thickness,lineStyle:D.styles.rsi.lineStyle,overboughtLevel:D.overboughtLevel,oversoldLevel:D.oversoldLevel,middleLevel:D.middleLevel,overboughtColor:D.styles.overboughtColor,overboughtThickness:D.styles.overboughtThickness??1,overboughtLineStyle:D.styles.overboughtLineStyle||"dashed",oversoldColor:D.styles.oversoldColor,oversoldThickness:D.styles.oversoldThickness??1,oversoldLineStyle:D.styles.oversoldLineStyle||"dashed",overboughtFillColor:D.styles.overboughtColor,oversoldFillColor:D.styles.oversoldColor,middleLineColor:D.styles.middleLineColor,middleLineThickness:D.styles.middleLineThickness??1,middleLineStyle:D.styles.middleLineStyle||"dashed",fillOpacity:D.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:D.overboughtLevel,color:D.styles.overboughtColor,lineStyle:D.styles.overboughtLineStyle||"dashed",thickness:D.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:D.middleLevel,color:D.styles.middleLineColor,lineStyle:D.styles.middleLineStyle||"dashed",thickness:D.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:D.oversoldLevel,color:D.styles.oversoldColor,lineStyle:D.styles.oversoldLineStyle||"dashed",thickness:D.styles.oversoldThickness??1,label:"30",visible:!0}]});Rm()}function Av(k){var W;if(!i(yt)||i(Ui).length<=1||k<0||k>=i(Ui).length)return;console.log("🗑️ Removing RSI group at index:",k);const N=i(Ui)[k];let j=N.actualPaneId||N.paneId||o().editPaneId;if(!j&&((W=s())!=null&&W.getIndicators))try{const H=new Set(i(Ui).filter((st,Jt)=>Jt!==k).map(st=>st.actualPaneId||st.paneId).filter(st=>!!st)),Le=s().getIndicators().find(st=>(st==null?void 0:st.name)==="RSI"&&(st==null?void 0:st.paneId)&&!H.has(st.paneId));Le!=null&&Le.paneId&&(j=Le.paneId)}catch(H){console.warn("⚠️ Failed to resolve RSI pane ID for removal:",H)}const D=i(Ui).length;if(i(Ui).splice(k,1),console.log(`📝 Removed group: ${D} -> ${i(Ui).length}`),s()&&j)try{console.log("🗑️ Removing RSI from pane:",j),m0.deleteInstance(j),Nu(j,"RSI")}catch(H){console.error("❌ Error removing RSI indicator:",H)}Rm(),console.log("✅ RSI group removed. Remaining groups:",i(Ui).length)}function Wp(k){if(!i(yt)||!s()||k<0||k>=i(Ui).length)return;const N=i(Ui)[k],j=N.actualPaneId||N.paneId||o().editPaneId;if(!j){console.warn("⚠️ Unable to resolve pane ID for RSI update");return}try{m0.updateInstance(j,{period:N.period,lineColor:N.styles.rsi.color,lineThickness:N.styles.rsi.thickness,lineStyle:N.styles.rsi.lineStyle,overboughtLevel:N.overboughtLevel,oversoldLevel:N.oversoldLevel,middleLevel:N.middleLevel,overboughtColor:N.styles.overboughtColor||"#EF4444",overboughtThickness:N.styles.overboughtThickness??1,overboughtLineStyle:N.styles.overboughtLineStyle||"dashed",oversoldColor:N.styles.oversoldColor||"#22C55E",oversoldThickness:N.styles.oversoldThickness??1,oversoldLineStyle:N.styles.oversoldLineStyle||"dashed",overboughtFillColor:N.styles.overboughtColor||"#EF4444",oversoldFillColor:N.styles.oversoldColor||"#22C55E",middleLineColor:N.styles.middleLineColor||"#6B7280",middleLineThickness:N.styles.middleLineThickness??1,middleLineStyle:N.styles.middleLineStyle||"dashed",fillOpacity:N.fillOpacity??.15,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:N.overboughtLevel,color:N.styles.overboughtColor||"#EF4444",lineStyle:N.styles.overboughtLineStyle||"dashed",thickness:N.styles.overboughtThickness??1,label:String(N.overboughtLevel),visible:!0},{id:"middle",value:N.middleLevel,color:N.styles.middleLineColor||"#6B7280",lineStyle:N.styles.middleLineStyle||"dashed",thickness:N.styles.middleLineThickness??1,label:String(N.middleLevel),visible:!0},{id:"oversold",value:N.oversoldLevel,color:N.styles.oversoldColor||"#22C55E",lineStyle:N.styles.oversoldLineStyle||"dashed",thickness:N.styles.oversoldThickness??1,label:String(N.oversoldLevel),visible:!0}]}),s().removeIndicator({paneId:j,name:"RSI"});let D=wt.Solid,W=[2,2];N.styles.rsi.lineStyle==="dashed"?(D=wt.Dashed,W=[6,4]):N.styles.rsi.lineStyle==="dotted"&&(D=wt.Dashed,W=[2,2]);const H=s().createIndicator({name:"RSI",calcParams:[N.period],styles:{lines:[{color:N.styles.rsi.color,size:N.styles.rsi.thickness,style:D,dashedValue:W}]}},!1,{id:j,axis:{gap:{bottom:2}}});try{typeof s().resize=="function"&&s().resize()}catch{}if(N.actualPaneId=j,N.paneId=j,H){const he=`${j}_RSI`;c.update(Le=>{const st=(i(Ui)||[]).filter(Jt=>(Jt.actualPaneId||Jt.paneId)===j);return Le.saveInds[he]={name:"RSI",pane_id:j,params:[N.period],rsiGroups:st},Le})}Rm()}catch(D){console.error("❌ Error updating RSI indicator:",D)}}let Eu=ge(V([]));function av(){x(Eu,V([])),console.log("✅ Stochastic groups cleared from modal state")}function jm(){if(!i(vt))return;const k=`${o().editPaneId}_STOCH`,N=r().saveInds[k];if(N&&N.stochasticGroups&&N.stochasticGroups.length>0)x(Eu,V([...N.stochasticGroups]));else if(i(Eu).length===0){const j={id:Br(),kPeriod:14,dPeriod:3,overboughtLevel:80,oversoldLevel:20,midLevel:50,paneId:o().editPaneId,styles:{duty:{color:"#1E90FF",thickness:2,lineStyle:"solid"},dLine:{color:"#FF1493",thickness:2,lineStyle:"dashed"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midLineColor:"#6B7280"}};x(Eu,V([j])),mb.createInstance(o().editPaneId,{kPeriod:j.kPeriod,dPeriod:j.dPeriod,dutyColor:j.styles.duty.color,dutyThickness:j.styles.duty.thickness,dutyStyle:j.styles.duty.lineStyle,dLineColor:j.styles.dLine.color,dLineThickness:j.styles.dLine.thickness,dLineStyle:j.styles.dLine.lineStyle,levels:[{id:"overbought",value:j.overboughtLevel,color:j.styles.overboughtColor,lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:j.oversoldLevel,color:j.styles.oversoldColor,lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"mid",value:j.midLevel,color:j.styles.midLineColor,lineStyle:"dashed",thickness:1,label:"Mid",visible:!0}]})}}function ng(){var N;if(!i(vt))return;const k={id:Br(),kPeriod:14,dPeriod:3,overboughtLevel:80,oversoldLevel:20,midLevel:50,paneId:void 0,styles:{duty:{color:"#1E90FF",thickness:2,lineStyle:"solid"},dLine:{color:"#FF1493",thickness:2,lineStyle:"dashed"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midLineColor:"#6B7280"}};if(x(Eu,V([...i(Eu),k])),i(Eu).length>1){const j=Object.values(r().saveInds).filter(Jt=>Jt.name==="STOCH"&&Jt.pane_id).map(Jt=>Jt.pane_id);let D=2;for(;j.includes(`pane_STOCH_${D}`);)D+=1;const W=i(Eu).length-1,H=[k.kPeriod,k.dPeriod,1],he={lines:[{color:k.styles.duty.color,size:k.styles.duty.thickness,style:k.styles.duty.lineStyle==="dashed"||k.styles.duty.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:k.styles.duty.lineStyle==="dashed"?[4,4]:k.styles.duty.lineStyle==="dotted"?[2,2]:[2,2]},{color:k.styles.dLine.color,size:k.styles.dLine.thickness,style:k.styles.dLine.lineStyle==="dashed"||k.styles.dLine.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:k.styles.dLine.lineStyle==="dashed"?[4,4]:k.styles.dLine.lineStyle==="dotted"?[2,2]:[2,2]}]},Le=`pane_STOCH_${D}`;console.log(`🆕 Immediately creating Stochastic ${D} with pane ID:`,Le),((N=s())==null?void 0:N.createIndicator({name:"STOCH",calcParams:H,styles:he},!1,{id:Le,axis:{gap:{bottom:2}}}))&&(console.log(`✅ Stochastic ${D} created with pane ID:`,Le),k.paneId=Le,mb.updateInstance(Le,{kPeriod:k.kPeriod,dPeriod:k.dPeriod,levels:[{id:"overbought",value:k.overboughtLevel,color:k.styles.overboughtColor,lineStyle:"solid",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:k.oversoldLevel,color:k.styles.oversoldColor,lineStyle:"solid",thickness:1,label:"Oversold",visible:!0},{id:"midline",value:k.midLevel,color:k.styles.midLineColor,lineStyle:"solid",thickness:1,label:"Midline",visible:!0}],zones:[{id:"overbought_zone",type:"overbought",topLevel:100,bottomLevel:k.overboughtLevel,fillColor:k.styles.overboughtColor,fillOpacity:.1,visible:!0},{id:"oversold_zone",type:"oversold",topLevel:k.oversoldLevel,bottomLevel:0,fillColor:k.styles.oversoldColor,fillOpacity:.1,visible:!0}],dutyColor:k.styles.duty.color,dLineColor:k.styles.dLine.color,showLevels:!0,showZones:!0,overboughtLevel:k.overboughtLevel,oversoldLevel:k.oversoldLevel,midlineLevel:k.midLevel}),c.update(Jt=>{const fs=`pane_STOCH_${D}_STOCH`;return Jt.saveInds[fs]={name:"STOCH",stochasticGroup:k,pane_id:Le,groupIndex:W,params:[k.kPeriod,k.dPeriod,1]},Jt}))}console.log("✅ New Stochastic group added:",k)}function im(k){if(!i(vt)||k<0||k>=i(Eu).length)return;const j=i(Eu)[k].paneId||o().editPaneId;try{mb.deleteInstance(j),s()&&s().removeIndicator({paneId:j,name:"STOCH"}),c.update(D=>(Object.keys(D.saveInds).filter(H=>D.saveInds[H].name==="STOCH"&&D.saveInds[H].pane_id===j).forEach(H=>{delete D.saveInds[H]}),D)),x(Eu,V(i(Eu).filter((D,W)=>W!==k))),console.log("✅ Stochastic group removed successfully")}catch(D){console.error("❌ Error removing Stochastic group:",D)}}function xf(k){if(!i(vt)||k<0||k>=i(Eu).length)return;const N=i(Eu)[k],j=N.paneId||o().editPaneId;try{mb.updateInstance(j,{kPeriod:N.kPeriod,dPeriod:N.dPeriod,dutyColor:N.styles.duty.color,dutyThickness:N.styles.duty.thickness,dutyStyle:N.styles.duty.lineStyle,dLineColor:N.styles.dLine.color,dLineThickness:N.styles.dLine.thickness,dLineStyle:N.styles.dLine.lineStyle,overboughtLevel:N.overboughtLevel,oversoldLevel:N.oversoldLevel,midlineLevel:N.midLevel,showZones:!0,zones:[{id:"overbought-zone",topLevel:100,bottomLevel:N.overboughtLevel,fillColor:N.styles.overboughtColor||"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold-zone",topLevel:N.oversoldLevel,bottomLevel:0,fillColor:N.styles.oversoldColor||"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}],levels:[{id:"overbought",value:N.overboughtLevel,color:N.styles.overboughtColor||"#EF4444",lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:N.oversoldLevel,color:N.styles.oversoldColor||"#10B981",lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"mid",value:N.midLevel,color:N.styles.midLineColor||"#6B7280",lineStyle:"dashed",thickness:1,label:"Mid",visible:!0}]}),s()&&s().removeIndicator({paneId:j,name:"STOCH"});let D=wt.Solid,W=[2,2],H=wt.Solid,he=[2,2];if(N.styles.duty.lineStyle==="dashed"?(D=wt.Dashed,W=[4,4]):N.styles.duty.lineStyle==="dotted"&&(D=wt.Dashed,W=[2,2]),N.styles.dLine.lineStyle==="dashed"?(H=wt.Dashed,he=[4,4]):N.styles.dLine.lineStyle==="dotted"&&(H=wt.Dashed,he=[2,2]),s()?s().createIndicator({name:"STOCH",calcParams:[N.kPeriod,N.dPeriod],styles:{lines:[{color:N.styles.duty.color,size:N.styles.duty.thickness,style:D,dashedValue:W},{color:N.styles.dLine.color,size:N.styles.dLine.thickness,style:H,dashedValue:he}]}},j===o().editPaneId,{id:j}):null){const st=`${j}_STOCH`;c.update(Jt=>(Jt.saveInds[st]={name:"STOCH",pane_id:j,params:[N.kPeriod,N.dPeriod],stochasticGroups:i(Eu)},Jt))}console.log("✅ Stochastic indicator and levels updated successfully")}catch(D){console.error("❌ Error updating Stochastic indicator:",D)}}function Bm(){if(!i(bf))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="MACD").sort();console.log("🔍 Found existing MACD keys:",k),k.length>0?(x(Xl,V([])),k.forEach((N,j)=>{const D=r().saveInds[N];if(D){if(D.macdGroup){const W={...D.macdGroup};W.styles||(W.styles={}),W.styles.reverseHistogram||(W.styles.reverseHistogram={color:"#c4c4c4"}),j>0&&D.pane_id&&(W.actualPaneId=D.pane_id),i(Xl).push(W)}else if(D.params&&D.params.length>=3){const W={id:Br(),fastPeriod:D.params[0]||12,slowPeriod:D.params[1]||26,signalPeriod:D.params[2]||9,actualPaneId:void 0,styles:{macdLine:{color:"#2563eb",thickness:1,lineStyle:"solid"},signalLine:{color:"#dc2626",thickness:1,lineStyle:"solid"},positiveHistogram:{color:"#26a69a"},negativeHistogram:{color:"#ef5350"},reverseHistogram:{color:"#c4c4c4"}}};j>0&&D.pane_id&&(W.actualPaneId=D.pane_id),i(Xl).push(W)}}}),console.log("✅ Loaded",i(Xl).length,"existing MACD groups")):i(Xl).length===0&&(x(Xl,V([{id:Br(),fastPeriod:12,slowPeriod:26,signalPeriod:9,styles:{macdLine:{color:"#2563eb",thickness:1,lineStyle:"solid"},signalLine:{color:"#dc2626",thickness:1,lineStyle:"solid"},positiveHistogram:{color:"#26a69a"},negativeHistogram:{color:"#ef5350"},reverseHistogram:{color:"#c4c4c4"}}}])),console.log("🆕 Created default MACD group"))}function Om(){var D;if(!i(bf))return;const k=[{macdLine:"#2563eb",signalLine:"#dc2626",positiveHistogram:"#26a69a",negativeHistogram:"#ef5350",reverseHistogram:"#c4c4c4"},{macdLine:"#9333ea",signalLine:"#ea580c",positiveHistogram:"#059669",negativeHistogram:"#dc2626",reverseHistogram:"#c4c4c4"},{macdLine:"#ec4899",signalLine:"#f59e0b",positiveHistogram:"#0891b2",negativeHistogram:"#f97316",reverseHistogram:"#c4c4c4"}],N=i(Xl).length%k.length,j={id:Br(),fastPeriod:12,slowPeriod:26,signalPeriod:9,actualPaneId:void 0,styles:{macdLine:{color:k[N].macdLine,thickness:1,lineStyle:"solid"},signalLine:{color:k[N].signalLine,thickness:1,lineStyle:"solid"},positiveHistogram:{color:k[N].positiveHistogram},negativeHistogram:{color:k[N].negativeHistogram},reverseHistogram:{color:k[N].reverseHistogram}}};if(i(Xl).push(j),i(Xl).length>1){const W=Object.values(r().saveInds).filter(ts=>ts.name==="MACD"&&ts.pane_id).map(ts=>ts.pane_id);let H=2;for(;W.includes(`pane_MACD_${H}`);)H+=1;const he=i(Xl).length-1,Le=[j.fastPeriod,j.slowPeriod,j.signalPeriod],st={lines:[{color:j.styles.macdLine.color,size:j.styles.macdLine.thickness,style:j.styles.macdLine.lineStyle==="dashed"||j.styles.macdLine.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:j.styles.macdLine.lineStyle==="dashed"?[4,4]:j.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:j.styles.signalLine.color,size:j.styles.signalLine.thickness,style:j.styles.signalLine.lineStyle==="dashed"||j.styles.signalLine.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:j.styles.signalLine.lineStyle==="dashed"?[4,4]:j.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:j.styles.positiveHistogram.color,downColor:j.styles.negativeHistogram.color,noChangeColor:j.styles.positiveHistogram.color,reverseColor:j.styles.reverseHistogram.color,borderSize:0,borderColor:j.styles.positiveHistogram.color}]},Jt=`pane_MACD_${H}`;console.log(`🆕 Immediately creating MACD ${H} with pane ID:`,Jt),((D=s())==null?void 0:D.createIndicator({name:"MACD",calcParams:Le,styles:st},!1,{id:Jt,axis:{gap:{bottom:2}}}))&&(console.log(`✅ MACD ${H} created with pane ID:`,Jt),j.actualPaneId=Jt,c.update(ts=>{const Bn=`pane_MACD_${H}_MACD`;return ts.saveInds[Bn]={name:"MACD",macdGroup:j,pane_id:Jt,groupIndex:he,params:[j.fastPeriod,j.slowPeriod,j.signalPeriod]},ts}))}}function Lh(k){var j,D;if(!i(bf)||i(Xl).length<=1)return;const N=i(Xl).findIndex(W=>W.id===k);if(N!==-1){console.log("🗑️ Removing MACD group at index:",N,"ID:",k);try{if(N===0&&i(Xl).length>1){console.log("🔄 Special handling: First MACD removed, promoting second MACD to first position"),x(Xl,V(i(Xl).filter(H=>H.id!==k))),console.log("✅ MACD group removed from array. Remaining groups:",i(Xl).length);const W=i(Xl)[0];W.actualPaneId&&(console.log("🗑️ Removing old second MACD from sub-pane:",W.actualPaneId),(j=s())==null||j.removeIndicator({paneId:W.actualPaneId,name:"MACD"})),W.actualPaneId=void 0,console.log("📊 Updating MACD in edit pane with new first group settings"),Gh(0)}else{const W=i(Xl)[N];W.actualPaneId&&(console.log("🗑️ Removing MACD from actual pane:",W.actualPaneId),(D=s())==null||D.removeIndicator({paneId:W.actualPaneId,name:"MACD"}),console.log("✅ Successfully removed MACD from actual pane:",W.actualPaneId)),x(Xl,V(i(Xl).filter(H=>H.id!==k))),console.log("✅ MACD group removed from array. Remaining groups:",i(Xl).length)}c.update(W=>(Object.keys(W.saveInds).forEach(H=>{W.saveInds[H].name==="MACD"&&(console.log("🧹 Cleaning saved state for key:",H),delete W.saveInds[H])}),i(Xl).forEach((H,he)=>{const Le=he===0?`${o().editPaneId}_MACD`:`pane_MACD_${he+1}_MACD`,st=he===0?o().editPaneId:H.actualPaneId||`pane_MACD_${he+1}`;console.log(`💾 Re-saving MACD group ${he+1} with key:`,Le,"pane ID:",st),W.saveInds[Le]={name:"MACD",macdGroup:H,pane_id:st,groupIndex:he,macdGroups:he===0?[...i(Xl)]:void 0,params:[H.fastPeriod,H.slowPeriod,H.signalPeriod]}}),W)),console.log("🔄 MACD groups reindexed successfully")}catch(W){console.log("❌ Error removing MACD indicator:",W)}}}function Gh(k){var H;const N=i(Xl)[k];if(!N||!s())return;N.styles.reverseHistogram||(N.styles.reverseHistogram={color:"#c4c4c4"});const j=k===0?o().editPaneId:N.actualPaneId||`pane_MACD_${k+1}`,D={lines:[{color:N.styles.macdLine.color,size:N.styles.macdLine.thickness,style:N.styles.macdLine.lineStyle==="dashed"||N.styles.macdLine.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:N.styles.macdLine.lineStyle==="dashed"?[4,4]:N.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:N.styles.signalLine.color,size:N.styles.signalLine.thickness,style:N.styles.signalLine.lineStyle==="dashed"||N.styles.signalLine.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:N.styles.signalLine.lineStyle==="dashed"?[4,4]:N.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:N.styles.positiveHistogram.color,downColor:N.styles.negativeHistogram.color,noChangeColor:N.styles.positiveHistogram.color,reverseColor:N.styles.reverseHistogram.color,borderSize:0,borderColor:N.styles.positiveHistogram.color}]};(H=s())==null||H.overrideIndicator({name:"MACD",paneId:j,styles:D,calcParams:[N.fastPeriod,N.slowPeriod,N.signalPeriod]});const W=k===0?`${o().editPaneId}_MACD`:`pane_MACD_${k+1}_MACD`;c.update(he=>(he.saveInds[W]&&(he.saveInds[W].params=[N.fastPeriod,N.slowPeriod,N.signalPeriod],he.saveInds[W].macdGroup={...N},console.log("💾 Persisted MACD changes to save data:",W,N)),he)),console.log("🔄 Updated MACD indicator:",k,N)}function fh(k,N){var H;const j=i(Xl)[k];if(!j||!s())return;j.styles.reverseHistogram||(j.styles.reverseHistogram={color:"#c4c4c4"});const D=k===0?o().editPaneId:j.actualPaneId||`pane_MACD_${k+1}`,W={lines:[{color:j.styles.macdLine.color,size:j.styles.macdLine.thickness,style:j.styles.macdLine.lineStyle==="dashed"||j.styles.macdLine.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:j.styles.macdLine.lineStyle==="dashed"?[4,4]:j.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:j.styles.signalLine.color,size:j.styles.signalLine.thickness,style:j.styles.signalLine.lineStyle==="dashed"||j.styles.signalLine.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:j.styles.signalLine.lineStyle==="dashed"?[4,4]:j.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:j.styles.positiveHistogram.color,downColor:j.styles.negativeHistogram.color,noChangeColor:j.styles.positiveHistogram.color,reverseColor:j.styles.reverseHistogram.color,borderSize:0,borderColor:j.styles.positiveHistogram.color}]};(H=s())==null||H.overrideIndicator({name:"MACD",paneId:D,styles:W}),console.log("🎨 Updated MACD color:",N,j.styles[N].color)}function Tv(){if(i(J))try{const k=`${o().editPaneId}_EMV`,N=r().saveInds[k];if(N&&N.emvGroups&&Array.isArray(N.emvGroups)&&N.emvGroups.length>0){const j=N.emvGroups.filter(D=>D&&typeof D.id=="string"&&typeof D.name=="string"&&typeof D.period=="number"&&D.period>0&&typeof D.period2=="number"&&D.period2>0&&typeof D.color=="string"&&typeof D.thickness=="number"&&D.thickness>0&&typeof D.lineStyle=="string");j.length>0?(x(Pr,V([...j])),console.log("✅ Loaded",j.length,"valid EMV groups")):(console.warn("⚠️ No valid EMV groups found in saved data, creating default"),w0())}else i(Pr).length===0&&w0()}catch(k){console.error("❌ Error initializing EMV groups:",k),w0()}}function w0(){x(Pr,V([{id:Br(),name:"EMV #1",period:14,period2:9,color:"#2563eb",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default EMV group")}function Cg(k){if(!i(J)||i(Pr).length<=1){console.warn("⚠️ Cannot remove EMV group: minimum one group required");return}try{if(!k||typeof k!="string"){console.error("❌ Invalid group ID provided for EMV group removal");return}const N=i(Pr).length;x(Pr,V(i(Pr).filter(j=>j.id!==k))),i(Pr).length<N?console.log("✅ Removed EMV group with ID:",k):console.warn("⚠️ EMV group not found for removal:",k)}catch(N){console.error("❌ Error removing EMV group:",N)}}function Fv(){if(i(Fe))try{const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N]&&r().saveInds[N].name==="MTM").sort((N,j)=>N===`${o().editPaneId}_MTM`?-1:j===`${o().editPaneId}_MTM`?1:N.localeCompare(j));k.length>0?(x(Sr,V([])),k.forEach((N,j)=>{const D=r().saveInds[N];if(D){if(D.mtmGroup){const W={...D.mtmGroup};j>0&&D.pane_id&&(W.actualPaneId=D.pane_id),i(Sr).push(W)}else if(D.mtmGroups&&Array.isArray(D.mtmGroups)&&j===0){const W=D.mtmGroups.filter(H=>H&&typeof H.id=="string"&&typeof H.name=="string"&&typeof H.period=="number"&&H.period>0&&typeof H.color=="string"&&typeof H.thickness=="number"&&H.thickness>0&&typeof H.lineStyle=="string");x(Sr,V([...W]))}}}),i(Sr).length>0?console.log("✅ Loaded",i(Sr).length,"MTM groups from saved data"):(console.warn("⚠️ No valid MTM groups found, creating default"),_v())):i(Sr).length===0&&_v()}catch(k){console.error("❌ Error initializing MTM groups:",k),_v()}}function _v(){x(Sr,V([{id:Br(),name:"MTM #1",period:14,color:"#2563eb",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default MTM group")}function ph(k){if(!i(Fe)||i(Sr).length<=1){console.warn("⚠️ Cannot remove MTM group: minimum one group required");return}try{if(!k||typeof k!="string"){console.error("❌ Invalid group ID provided for MTM group removal");return}const N=i(Sr).length;x(Sr,V(i(Sr).filter(j=>j.id!==k))),i(Sr).length<N?(console.log("✅ Removed MTM group with ID:",k),mh()):console.warn("⚠️ MTM group not found for removal:",k)}catch(N){console.error("❌ Error removing MTM group:",N)}}function mh(){var k;if(!(!i(Fe)||!s()))try{console.log("🔄 Applying MTM changes to chart...");const N=Object.keys(r().saveInds).filter(D=>r().saveInds[D]&&r().saveInds[D].name==="MTM").sort((D,W)=>D===`${o().editPaneId}_MTM`?-1:W===`${o().editPaneId}_MTM`?1:D.localeCompare(W));console.log("🔧 Applying MTM changes. Existing keys:",N),console.log("🔧 Current MTM groups:",i(Sr).length);const j=i(Sr).length;if(N.length>j)for(let D=j;D<N.length;(D+=1)-1){const W=N[D],H=r().saveInds[W];if(H&&H.pane_id)try{console.log("🗑️ Removing excess MTM indicator from pane:",H.pane_id),(k=s())==null||k.removeIndicator({paneId:H.pane_id,name:"MTM"})}catch(he){console.log("❌ Error removing excess MTM indicator:",he)}}i(Sr).forEach((D,W)=>{var Le,st,Jt;const H=[D.period],he={lines:[{color:D.color,size:D.thickness,style:D.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:D.lineStyle==="dashed"?[4,4]:D.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(W===0)console.log("🔄 Updating first MTM in pane:",o().editPaneId),(Le=s())==null||Le.overrideIndicator({name:"MTM",calcParams:H,styles:he,paneId:o().editPaneId});else{const fs=`pane_MTM_${W+1}_MTM`,ts=N.find(Bn=>Bn===fs);if(ts){const Bn=r().saveInds[ts];Bn&&Bn.pane_id&&(console.log("🔄 Updating existing MTM in pane:",Bn.pane_id),(st=s())==null||st.overrideIndicator({name:"MTM",calcParams:H,styles:he,paneId:Bn.pane_id}),D.actualPaneId=Bn.pane_id)}else{const Bn=`pane_MTM_${W+1}`;console.log("🆕 Creating new MTM in pane:",Bn);const ti=(Jt=s())==null?void 0:Jt.createIndicator({name:"MTM",calcParams:H,styles:he},!0,{id:Bn,axis:{gap:{bottom:2}}});ti&&(D.actualPaneId=Bn,console.log("✅ Created new MTM indicator with ID:",ti,"in pane:",Bn))}}}),c.update(D=>{try{Object.keys(D.saveInds).forEach(W=>{D.saveInds[W]&&D.saveInds[W].name==="MTM"&&delete D.saveInds[W]}),i(Sr).forEach((W,H)=>{try{const he=H===0?`${o().editPaneId}_MTM`:`pane_MTM_${H+1}_MTM`,Le=H===0?o().editPaneId:W.actualPaneId||`pane_MTM_${H+1}`;if(!he||!Le){console.error(`❌ Invalid save key or pane ID for MTM group ${H}`);return}const st={name:"MTM",mtmGroup:W,pane_id:Le,groupIndex:H,mtmGroups:H===0?[...i(Sr)]:void 0,params:[W.period]};D.saveInds[he]=st,console.log("💾 Saved MTM group",H,"with key:",he,"and pane ID:",Le)}catch(he){console.error(`❌ Error saving MTM group ${H}:`,he)}})}catch(W){console.error("❌ Error in MTM save operation:",W)}return D}),console.log("✅ MTM changes applied successfully")}catch(N){console.error("❌ Critical error in applyMtm:",N)}}function sg(){if(!i(Hd))return;const k=`${o().editPaneId}_WR`,N=r().saveInds[k];if(N&&N.wrGroups&&N.wrGroups.length>0){x(rc,V([...N.wrGroups]));return}const j=[];Object.keys(r().saveInds).forEach(D=>{if((D.includes("_WR")||D.startsWith("WR_"))&&D!==k){const W=r().saveInds[D];W&&W.wrGroup&&j.push(W.wrGroup)}}),N&&N.wrGroup&&j.unshift(N.wrGroup),j.length>0?x(rc,V([...j])):i(rc).length===0&&x(rc,V([{id:Br(),period:14,overboughtLevel:-20,middleLevel:-50,oversoldLevel:-80,paneId:o().editPaneId,styles:{wr:{color:"#2563eb",thickness:1,lineStyle:"solid"},overbought:{color:"#EF4444",thickness:1,lineStyle:"solid"},oversold:{color:"#10B981",thickness:1,lineStyle:"solid"},middleLine:{color:"#6B7280",thickness:1,lineStyle:"solid"}}}]))}function hh(){if(!i(Hd))return;const k=`pane_WR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,N={id:Br(),period:14,overboughtLevel:-20,middleLevel:-50,oversoldLevel:-80,paneId:k,styles:{wr:{color:"#2563eb",thickness:1,lineStyle:"solid"},overbought:{color:"#EF4444",thickness:1,lineStyle:"solid"},oversold:{color:"#10B981",thickness:1,lineStyle:"solid"},middleLine:{color:"#6B7280",thickness:1,lineStyle:"solid"}}};if(i(rc).push(N),cx.createInstance(k,{period:N.period,lineColor:N.styles.wr.color,lineThickness:N.styles.wr.thickness,lineStyle:N.styles.wr.lineStyle,levels:[{id:"overbought",value:N.overboughtLevel,color:N.styles.overbought.color,lineStyle:N.styles.overbought.lineStyle,thickness:N.styles.overbought.thickness,label:"Overbought",visible:!0},{id:"middle",value:N.middleLevel,color:N.styles.middleLine.color,lineStyle:N.styles.middleLine.lineStyle,thickness:N.styles.middleLine.thickness,label:"Middle",visible:!0},{id:"oversold",value:N.oversoldLevel,color:N.styles.oversold.color,lineStyle:N.styles.oversold.lineStyle,thickness:N.styles.oversold.thickness,label:"Oversold",visible:!0}]}),s()){let j=wt.Solid,D=[2,2];if(N.styles.wr.lineStyle==="dashed"?(j=wt.Dashed,D=[4,4]):N.styles.wr.lineStyle==="dotted"&&(j=wt.Dashed,D=[2,2]),s().createIndicator({name:"WR",calcParams:[N.period],styles:{lines:[{color:N.styles.wr.color,size:N.styles.wr.thickness,style:j,dashedValue:D}]}},!1,{id:k})){const H=`${k}_WR`;c.update(he=>(he.saveInds[H]={name:"WR",pane_id:k,params:[N.period]},he))}}console.log("➕ Added new WR group in new pane:",N.id,k)}function og(k){if(!i(Hd)||i(rc).length<=1)return;const N=i(rc).find(D=>D.id===k);if(!N)return;i(rc).findIndex(D=>D.id===k);const j=N.paneId;x(rc,V(i(rc).filter(D=>D.id!==k))),j&&cx.deleteInstance(j),j&&Nu(j,"WR"),console.log("🗑️ Removed WR group from pane:",j)}function np(k){if(!i(Hd)||!s()||k<0||k>=i(rc).length)return;const N=i(rc)[k],j=N.paneId||o().editPaneId;console.log("🔄 Updating WR indicator:",k,j);try{cx.updateInstance(j,{period:N.period,lineColor:N.styles.wr.color,lineThickness:N.styles.wr.thickness,lineStyle:N.styles.wr.lineStyle,enableDynamicColoring:!0,overboughtColor:N.styles.overbought.color||"#EF4444",oversoldColor:N.styles.oversold.color||"#10B981",overboughtThreshold:N.overboughtLevel,oversoldThreshold:N.oversoldLevel,levels:[{id:"overbought",value:N.overboughtLevel,color:N.styles.overbought.color||"#EF4444",lineStyle:N.styles.overbought.lineStyle,thickness:N.styles.overbought.thickness,label:"Overbought",visible:!0},{id:"middle",value:N.middleLevel,color:N.styles.middleLine.color||"#6B7280",lineStyle:N.styles.middleLine.lineStyle,thickness:N.styles.middleLine.thickness,label:"Middle",visible:!0},{id:"oversold",value:N.oversoldLevel,color:N.styles.oversold.color||"#10B981",lineStyle:N.styles.oversold.lineStyle,thickness:N.styles.oversold.thickness,label:"Oversold",visible:!0}]}),s().removeIndicator({paneId:j,name:"WR"});let D=wt.Solid,W=[2,2];if(N.styles.wr.lineStyle==="dashed"?(D=wt.Dashed,W=[4,4]):N.styles.wr.lineStyle==="dotted"&&(D=wt.Dashed,W=[2,2]),s().createIndicator({name:"WR",calcParams:[N.period],styles:{lines:[{color:N.styles.wr.color,size:N.styles.wr.thickness,style:D,dashedValue:W}]}},j===o().editPaneId,{id:j})){const he=`${j}_WR`;c.update(Le=>(Le.saveInds[he]={name:"WR",pane_id:j,params:[N.period]},Le))}console.log("✅ WR indicator and levels updated successfully")}catch(D){console.error("❌ Error updating WR indicator:",D)}}function z0(){if(!i(hu))return;const k=Object.entries(r().saveInds).filter(([N,j])=>j.name==="VR");if(k.length>0)x(Qc,V(k.map(([N,j])=>{var D,W,H;return j.vrGroups&&j.vrGroups.length>0?j.vrGroups[0]:j.vrGroup?j.vrGroup:{id:Br(),paneId:j.pane_id,period:((D=j.params)==null?void 0:D[0])||26,shortPeriod:((W=j.params)==null?void 0:W[1])||6,longPeriod:((H=j.params)==null?void 0:H[2])||12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}}}))),console.log("✅ Loaded VR groups from save system:",i(Qc).length);else if(i(Qc).length===0){const N={id:Br(),paneId:o().editPaneId,period:26,shortPeriod:6,longPeriod:12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}};x(Qc,V([N])),console.log("✅ Created default VR group with pane ID:",o().editPaneId)}}function Ig(){if(!i(yd))return;const k=Object.entries(r().saveInds).filter(([N,j])=>j.name==="VOL");if(k.length>0)x(Mt,V(k.map(([N,j])=>{var D,W,H,he,Le;if(j.volGroups&&j.volGroups.length>0){const st=j.volGroups[0];return{...st,paneId:"candle_pane",styles:{...st.styles,ema:{visible:((W=(D=st.styles)==null?void 0:D.ema)==null?void 0:W.visible)??!1,...st.styles.ema}}}}else if(j.volGroup){const st=j.volGroup;return{...st,paneId:"candle_pane",styles:{...st.styles,ema:{visible:((he=(H=st.styles)==null?void 0:H.ema)==null?void 0:he.visible)??!1,...st.styles.ema}}}}else return{id:Br(),paneId:"candle_pane",period:((Le=j.params)==null?void 0:Le[0])||20,styles:{histogram:{upColor:"#26a69a",downColor:"#ef5350",thickness:1,lineStyle:"solid"},ema:{color:"#8B5CF6",thickness:1,lineStyle:"dotted",visible:!1}}}}))),console.log("✅ Loaded Volume groups from save system:",i(Mt).length);else if(i(Mt).length===0){const N={id:Br(),paneId:"candle_pane",period:20,styles:{histogram:{upColor:"#26a69a",downColor:"#ef5350",thickness:1,lineStyle:"solid"},ema:{color:"#8B5CF6",thickness:1,lineStyle:"dotted",visible:!1}}};x(Mt,V([N])),console.log("✅ Created default Volume group:",N)}}function ee(){if(!i(hu))return;const k=`pane_VR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,N={id:Br(),paneId:k,period:26,shortPeriod:6,longPeriod:12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}};if(i(Qc).push(N),s()){let j=wt.Solid,D=[2,2];if(N.styles.vr.lineStyle==="dashed"?(j=wt.Dashed,D=[4,4]):N.styles.vr.lineStyle==="dotted"&&(j=wt.Dashed,D=[2,2]),s().createIndicator({name:"VR",calcParams:[N.period,N.shortPeriod,N.longPeriod],styles:{lines:[{color:N.styles.vr.color,size:N.styles.vr.thickness,style:j,dashedValue:D}]}},!1,{id:k})){const H=`${k}_VR`;c.update(he=>(he.saveInds[H]={name:"VR",pane_id:k,params:[N.period,N.shortPeriod,N.longPeriod]},he))}}console.log("➕ Added new VR group in new pane:",N.id,k)}function de(k){if(!i(hu)||i(Qc).length<=1||k<0||k>=i(Qc).length)return;console.log("🗑️ Removing VR group at index:",k);const j=i(Qc)[k].paneId,D=i(Qc).length;if(i(Qc).splice(k,1),console.log(`📝 Removed group: ${D} -> ${i(Qc).length}`),s()&&j)try{console.log("🗑️ Removing VR from pane:",j),Nu(j,"VR")}catch(W){console.error("❌ Error removing VR indicator:",W)}console.log("✅ VR group removed. Remaining groups:",i(Qc).length),console.log("🗑️ Removed VR group from list (will be applied on confirm)")}function He(k){if(!i(yd)||i(Mt).length<=1||k<0||k>=i(Mt).length)return;console.log("🗑️ Removing Volume group at index:",k),i(Mt)[k];const N="candle_pane",j=i(Mt).length;if(i(Mt).splice(k,1),console.log(`📝 Removed group: ${j} -> ${i(Mt).length}`),s()&&N)try{console.log("🗑️ Removing Volume from pane:",N),Nu(N,"VOL")}catch(D){console.error("❌ Error removing Volume indicator:",D)}console.log("✅ Volume group removed. Remaining groups:",i(Mt).length),console.log("🗑️ Removed Volume group from list (will be applied on confirm)")}function rt(k){if(o().editIndName!=="VR"||!s()||k<0||k>=i(Qc).length)return;const N=i(Qc)[k],j=N.paneId||o().editPaneId;console.log("🔄 Updating VR indicator:",k,j);try{s().removeIndicator({paneId:j,name:"VR"});const D=st=>{switch(st){case"dashed":return{style:wt.Dashed,dashedValue:[4,4]};case"dotted":return{style:wt.Dashed,dashedValue:[2,2]};default:return{style:wt.Solid,dashedValue:[2,2]}}},W=D(N.styles.vr.lineStyle),H=D(N.styles.vrShort.lineStyle),he=D(N.styles.vrLong.lineStyle);if(s().createIndicator({name:"VR",calcParams:[N.period,N.shortPeriod,N.longPeriod],styles:{lines:[{color:N.styles.vr.color,size:N.styles.vr.thickness,style:W.style,dashedValue:W.dashedValue},{color:N.styles.vrShort.color,size:N.styles.vrShort.thickness,style:H.style,dashedValue:H.dashedValue},{color:N.styles.vrLong.color,size:N.styles.vrLong.thickness,style:he.style,dashedValue:he.dashedValue}]}},j===o().editPaneId,{id:j})){const st=`${j}_VR`;c.update(Jt=>(Jt.saveInds[st]={name:"VR",pane_id:j,params:[N.period,N.shortPeriod,N.longPeriod]},Jt))}console.log("✅ VR indicator updated successfully")}catch(D){console.error("❌ Error updating VR indicator:",D)}}function Qt(k){if(o().editIndName!=="VOL"||!s()||k<0||k>=i(Mt).length)return;const N=i(Mt)[k],j="candle_pane";try{console.log("🔄 Updating Volume indicator for group:",k,"paneId:",j),s().removeIndicator({paneId:j,name:"VOL"});let D=wt.Solid,W=[2,2];if(N.styles.ema.lineStyle==="dashed"?(D=wt.Dashed,W=[4,4]):N.styles.ema.lineStyle==="dotted"&&(D=wt.Dashed,W=[2,2]),console.log("updateVolIndicator - Colors being applied:",{upColor:N.styles.histogram.upColor,downColor:N.styles.histogram.downColor,noChangeColor:N.styles.histogram.upColor,emaColor:N.styles.ema.color}),s().createIndicator({name:"VOL",calcParams:[N.period],styles:{bars:[{upColor:N.styles.histogram.upColor,downColor:N.styles.histogram.downColor,noChangeColor:N.styles.histogram.upColor}],lines:[{color:N.styles.ema.color,size:N.styles.ema.thickness,style:D,dashedValue:W,visible:N.styles.ema.visible===!0}]}},!0,{id:j})){const he=`${j}_VOL`;c.update(Le=>(Le.saveInds[he]={name:"VOL",pane_id:j,params:[N.period],volGroup:N},Le))}console.log("✅ Volume indicator updated successfully")}catch(D){console.error("❌ Error updating Volume indicator:",D)}}function Lt(k){if(o().editIndName!=="BBI"||!s()||k<0||k>=i(Nc).length)return;const N=i(Nc)[k],j=N.paneId||o().editPaneId;console.log("🔄 Updating BBI indicator:",k,j);try{s().removeIndicator({paneId:j,name:"BBI"});const W=(he=>{switch(he){case"dashed":return{style:wt.Dashed,dashedValue:[4,4]};case"dotted":return{style:wt.Dashed,dashedValue:[2,2]};default:return{style:wt.Solid,dashedValue:[2,2]}}})(N.lineStyle);if(s().createIndicator({name:"BBI",calcParams:[N.period1,N.period2,N.period3,N.period4],styles:{lines:[{color:N.color,size:N.thickness,style:W.style,dashedValue:W.dashedValue}]}},j===o().editPaneId,{id:j})){const he=`${j}_BBI`;c.update(Le=>(Le.saveInds[he]={name:"BBI",pane_id:j,params:[N.period1,N.period2,N.period3,N.period4],bbiGroup:N},Le))}console.log("✅ BBI indicator updated successfully")}catch(D){console.error("❌ Error updating BBI indicator:",D)}}function _n(){if(!(o().editIndName!=="EMA"||!s()))try{console.log("🔄 Updating EMA indicator"),s().removeIndicator({paneId:o().editPaneId,name:"EMA"});const k=s().createIndicator({name:"EMA",calcParams:u,styles:{lines:u.map((N,j)=>{const D=h[j];let W=wt.Solid,H=[2,2];return(D==null?void 0:D.lineStyle)==="dashed"?(W=wt.Dashed,H=[4,4]):(D==null?void 0:D.lineStyle)==="dotted"&&(W=wt.Dashed,H=[2,2]),{color:(D==null?void 0:D.color)||"#FF6B6B",size:(D==null?void 0:D.thickness)||1,style:W,dashedValue:H}})}},!0,{id:o().editPaneId});console.log("✅ EMA indicator updated successfully")}catch(k){console.error("❌ Error updating EMA indicator:",k)}}function Vn(){if(!(o().editIndName!=="MA"||!s()))try{console.log("🔄 Updating MA indicator"),s().removeIndicator({paneId:o().editPaneId,name:"MA"});const k=s().createIndicator({name:"MA",calcParams:u,styles:{lines:u.map((j,D)=>{const W=h[D];let H=wt.Solid,he=[2,2];return(W==null?void 0:W.lineStyle)==="dashed"?(H=wt.Dashed,he=[4,4]):(W==null?void 0:W.lineStyle)==="dotted"&&(H=wt.Dashed,he=[2,2]),{color:(W==null?void 0:W.color)||"#2563eb",size:(W==null?void 0:W.thickness)||1,style:H,dashedValue:he}})}},!0,{id:o().editPaneId}),N=`${o().editPaneId}_MA`;c.update(j=>(j.saveInds[N]&&(j.saveInds[N].params=[...u],j.saveInds[N].styles=h.map(D=>({...D}))),j)),console.log("✅ MA indicator updated successfully")}catch(k){console.error("❌ Error updating MA indicator:",k)}}function Zn(){var j,D,W;if(!i(jd))return;const k=`${o().editPaneId}_SMA`,N=r().saveInds[k];N&&N.smaGroups&&N.smaGroups.length>0?(x(Ji,V([...N.smaGroups])),console.log("✅ Loaded",i(Ji).length,"SMA groups from saved data")):N&&N.params&&N.params.length>0&&N.styles?(x(Ji,V([{id:Br(),name:"SMA",period:N.params[0]||20,color:((j=N.styles[0])==null?void 0:j.color)||"#FF6C37",thickness:((D=N.styles[0])==null?void 0:D.thickness)||2,lineStyle:((W=N.styles[0])==null?void 0:W.lineStyle)||"solid"}])),console.log("✅ Loaded SMA from saved data (old format)")):i(Ji).length===0&&(x(Ji,V([{id:Br(),name:"SMA",period:20,color:"#FF6C37",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default SMA group"))}function Js(k){var N,j;if(!(o().editIndName!=="SMA"||!s()||i(Ji).length===0||k>=i(Ji).length))try{console.log("🔄 Updating SMA indicator at index:",k);const D=i(Ji)[k],H=((N=s())==null?void 0:N.getIndicators()).filter(Le=>Le.name==="SMA");for(const Le of H)(j=s())==null||j.removeIndicator({paneId:Le.paneId,name:"SMA"});i(Ji).forEach((Le,st)=>{var ts;let Jt=wt.Solid,fs=[2,2];Le.lineStyle==="dashed"?(Jt=wt.Dashed,fs=[8,4]):Le.lineStyle==="dotted"&&(Jt=wt.Dashed,fs=[2,2]),(ts=s())==null||ts.createIndicator({name:"SMA",calcParams:[Le.period],styles:{lines:[{color:Le.color,size:Le.thickness,style:Jt,dashedValue:fs}]}},!0,{id:o().editPaneId})});const he=`${o().editPaneId}_SMA`;c.update(Le=>(Le.saveInds[he]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Ji).map(st=>({...st}))},Le)),console.log("✅ SMA indicators updated successfully")}catch(D){console.error("❌ Error updating SMA indicator:",D)}}function $o(){if(!i(jd))return;const k=i(Ji).length>0?i(Ji)[i(Ji).length-1].period+10:20,N=["#FF6C37","#2563eb","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],j=N[i(Ji).length%N.length],D={id:Br(),name:"SMA",period:k,color:j,thickness:2,lineStyle:"solid"};if(i(Ji).push(D),s()){s().createIndicator({name:"SMA",calcParams:[D.period],styles:{lines:[{color:D.color,size:D.thickness,style:wt.Solid,dashedValue:[2,2]}]}},!0,{id:o().editPaneId});const W=`${o().editPaneId}_SMA`;c.update(H=>(H.saveInds[W]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Ji).map(he=>({...he}))},H))}console.log("➕ Added new SMA group:",D)}function Os(k){var N,j;if(!(!i(jd)||i(Ji).length<=1||k<0||k>=i(Ji).length)&&(console.log("🗑️ Removing SMA group at index:",k),i(Ji).splice(k,1),s()))try{const W=((N=s())==null?void 0:N.getIndicators()).filter(he=>he.name==="SMA");for(const he of W)(j=s())==null||j.removeIndicator({paneId:he.paneId,name:"SMA"});i(Ji).forEach(he=>{var Jt;let Le=wt.Solid,st=[2,2];he.lineStyle==="dashed"?(Le=wt.Dashed,st=[8,4]):he.lineStyle==="dotted"&&(Le=wt.Dashed,st=[2,2]),(Jt=s())==null||Jt.createIndicator({name:"SMA",calcParams:[he.period],styles:{lines:[{color:he.color,size:he.thickness,style:Le,dashedValue:st}]}},!0,{id:o().editPaneId})});const H=`${o().editPaneId}_SMA`;c.update(he=>(i(Ji).length>0?he.saveInds[H]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Ji).map(Le=>({...Le}))}:delete he.saveInds[H],he)),console.log("✅ SMA group removed and chart updated")}catch(D){console.error("❌ Error removing SMA group:",D)}}function Xo(){var k,N;if(i(jd)){console.log("🔧 SMA Confirm: Saving",i(Ji).length,"SMA groups");try{const j=(k=s())==null?void 0:k.getIndicators(),D=(j==null?void 0:j.filter(H=>H.name==="SMA"))||[];for(const H of D)(N=s())==null||N.removeIndicator({paneId:H.paneId,name:"SMA"});i(Ji).forEach(H=>{var st;let he=wt.Solid,Le=[2,2];H.lineStyle==="dashed"?(he=wt.Dashed,Le=[8,4]):H.lineStyle==="dotted"&&(he=wt.Dashed,Le=[2,2]),(st=s())==null||st.createIndicator({name:"SMA",calcParams:[H.period],styles:{lines:[{color:H.color,size:H.thickness,style:he,dashedValue:Le}]}},!0,{id:o().editPaneId}),console.log("✅ Created SMA with period:",H.period)});const W=`${o().editPaneId}_SMA`;c.update(H=>(H.saveInds[W]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Ji).map(he=>({...he}))},console.log("💾 Saved",i(Ji).length,"SMA groups to:",W),H)),console.log("✅ SMA confirm completed successfully"),l.update(H=>(H.editIndName="",H.editPaneId="",H.modalIndCfg=!1,H))}catch(j){console.error("❌ Error in SMA confirm:",j)}}}function Ei(){if(!i(Jc))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="BBI").sort((N,j)=>N===`${o().editPaneId}_BBI`?-1:j===`${o().editPaneId}_BBI`?1:N.localeCompare(j));console.log("🔍 Found existing BBI keys:",k),k.length>0?(x(Nc,V([])),k.forEach((N,j)=>{const D=r().saveInds[N];if(D){const W=D.pane_id||N.replace("_BBI","");if(D.bbiGroup){const H={...D.bbiGroup};H.paneId||(H.paneId=W),i(Nc).push(H)}else D.params&&D.params.length===4&&i(Nc).push({id:Br(),name:`BBI${j+1}`,paneId:W,period1:D.params[0]||3,period2:D.params[1]||6,period3:D.params[2]||12,period4:D.params[3]||24,color:"#8B5CF6",thickness:1,lineStyle:"solid"})}}),console.log("✅ Loaded",i(Nc).length,"existing BBI groups")):i(Nc).length===0&&(x(Nc,V([{id:Br(),name:"BBI",paneId:o().editPaneId,period1:3,period2:6,period3:12,period4:24,color:"#8B5CF6",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default BBI group"))}function ao(){if(!i(Jc))return;const k=`pane_BBI_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,N=i(Nc).length+1,j={id:Br(),name:`BBI${N}`,paneId:k,period1:3,period2:6,period3:12,period4:24,color:"#8B5CF6",thickness:1,lineStyle:"solid"};if(i(Nc).push(j),s()){const W=(he=>{switch(he){case"dashed":return{style:wt.Dashed,dashedValue:[4,4]};case"dotted":return{style:wt.Dashed,dashedValue:[2,2]};default:return{style:wt.Solid,dashedValue:[2,2]}}})(j.lineStyle);if(s().createIndicator({name:"BBI",calcParams:[j.period1,j.period2,j.period3,j.period4],styles:{lines:[{color:j.color,size:j.thickness,style:W.style,dashedValue:W.dashedValue}]}},!1,{id:k})){const he=`${k}_BBI`;c.update(Le=>(Le.saveInds[he]={name:"BBI",pane_id:k,params:[j.period1,j.period2,j.period3,j.period4],bbiGroup:j},Le))}}console.log("➕ Added new BBI group in new pane:",j.id,k)}function za(k){var W;if(!i(Jc)||i(Nc).length<=1)return;const N=i(Nc).findIndex(H=>H.id===k);if(N===-1)return;const j=i(Nc)[N];console.log("🗑️ Removing BBI group at index:",N,"ID:",k,"paneId:",j.paneId);const D=j.paneId||(N===0?o().editPaneId:null);if(s()&&D){try{console.log("🗑️ Removing BBI from pane:",D),(W=s())==null||W.removeIndicator({paneId:D,name:"BBI"}),console.log("✅ Successfully removed BBI from pane:",D)}catch(H){console.log("❌ Error removing BBI indicator from pane:",D,H)}c.update(H=>{const he=`${D}_BBI`;return console.log("🧹 Cleaning saved state key:",he),delete H.saveInds[he],H})}else console.log("❌ Cannot remove BBI: no valid paneId found for group:",j);x(Nc,V(i(Nc).filter(H=>H.id!==k))),console.log("✅ BBI group removed from array. Remaining groups:",i(Nc).length)}function $a(){if(!i(Tu))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="TRIX").sort((N,j)=>N===`${o().editPaneId}_TRIX`?-1:j===`${o().editPaneId}_TRIX`?1:N.localeCompare(j));console.log("🔍 Found existing TRIX keys:",k),k.length>0?(x(Ac,V([])),k.forEach((N,j)=>{const D=r().saveInds[N];if(D)if(D.trixGroup){const W={...D.trixGroup};W.paneId||(W.paneId=D.pane_id||o().editPaneId),i(Ac).push(W)}else D.params&&D.params.length>=2&&i(Ac).push({id:Br(),name:`TRIX${j+1}`,trixPeriod:D.params[0]||15,signalPeriod:D.params[1]||9,paneId:D.pane_id||o().editPaneId,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}})}),console.log("✅ Loaded",i(Ac).length,"existing TRIX groups")):i(Ac).length===0&&(x(Ac,V([{id:Br(),name:"TRIX",trixPeriod:15,signalPeriod:9,paneId:o().editPaneId,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default TRIX group"))}function yl(){if(!i(Tu))return;const k=`pane_TRIX_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,N={id:Br(),name:`TRIX${i(Ac).length+1}`,trixPeriod:15,signalPeriod:9,paneId:k,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}};if(i(Ac).push(N),s()){let j=wt.Solid,D=[2,2],W=wt.Solid,H=[2,2];if(N.styles.trix.lineStyle==="dashed"?(j=wt.Dashed,D=[4,4]):N.styles.trix.lineStyle==="dotted"&&(j=wt.Dashed,D=[2,2]),N.styles.signal.lineStyle==="dashed"?(W=wt.Dashed,H=[4,4]):N.styles.signal.lineStyle==="dotted"&&(W=wt.Dashed,H=[2,2]),s().createIndicator({name:"TRIX",calcParams:[N.trixPeriod,N.signalPeriod],styles:{lines:[{color:N.styles.trix.color,size:N.styles.trix.thickness,style:j,dashedValue:D},{color:N.styles.signal.color,size:N.styles.signal.thickness,style:W,dashedValue:H}]}},!1,{id:k})){const Le=`${k}_TRIX`;c.update(st=>(st.saveInds[Le]={name:"TRIX",pane_id:k,params:[N.trixPeriod,N.signalPeriod]},st))}}console.log("➕ Added new TRIX group in new pane:",N.id,k)}function Cl(k){if(!i(Tu)||i(Ac).length<=1||k<0||k>=i(Ac).length)return;console.log("🗑️ Removing TRIX group at index:",k);const j=i(Ac)[k].paneId||o().editPaneId,D=i(Ac).length;if(i(Ac).splice(k,1),console.log(`📝 Removed group: ${D} -> ${i(Ac).length}`),s()&&j)try{console.log("🗑️ Removing TRIX from pane:",j),Nu(j,"TRIX")}catch(W){console.error("❌ Error removing TRIX indicator:",W)}console.log("✅ TRIX group removed. Remaining groups:",i(Ac).length)}function Rl(){if(!i(Xu))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="BIAS").sort((N,j)=>N===`${o().editPaneId}_BIAS`?-1:j===`${o().editPaneId}_BIAS`?1:N.localeCompare(j));console.log("🔍 Found existing BIAS keys:",k),k.length>0?(x(io,V([])),k.forEach((N,j)=>{const D=r().saveInds[N];D&&(D.biasGroup?i(io).push({...D.biasGroup}):D.params&&D.params.length>=1&&i(io).push({id:Br(),name:`BIAS${j+1}`,period:D.params[0]||6,color:"#2196F3",thickness:1,lineStyle:"solid"}))}),console.log("✅ Loaded",i(io).length,"existing BIAS groups")):i(io).length===0&&(x(io,V([{id:Br(),name:"BIAS",period:6,color:"#2196F3",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default BIAS group"))}function tc(){var j;if(!i(Xu)||!s())return;console.log("🔄 Applying BIAS changes in real-time, groups:",i(io).length);const k=Object.keys(r().saveInds).filter(D=>r().saveInds[D].name==="BIAS").sort((D,W)=>D===`${o().editPaneId}_BIAS`?-1:W===`${o().editPaneId}_BIAS`?1:D.localeCompare(W));console.log("🔍 Existing BIAS keys:",k);const N=i(io).length;if(k.length>N){console.log(`🗑️ Removing ${k.length-N} excess BIAS indicators`);for(let D=N;D<k.length;(D+=1)-1){const W=k[D],H=r().saveInds[W];if(H&&H.pane_id){console.log("🗑️ Removing BIAS indicator from pane:",H.pane_id);try{(j=s())==null||j.removeIndicator({paneId:H.pane_id,name:"BIAS"})}catch(he){console.log("Error removing excess BIAS indicator:",he)}}}}i(io).forEach((D,W)=>{var Le,st,Jt;const H=[D.period],he={lines:[{color:D.color,size:D.thickness,style:D.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:D.lineStyle==="dashed"?[4,4]:D.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(W===0)console.log("🔄 Updating first BIAS indicator in pane:",o().editPaneId),(Le=s())==null||Le.overrideIndicator({name:"BIAS",calcParams:H,styles:he,paneId:o().editPaneId});else{const fs=`pane_BIAS_${W+1}_BIAS`,ts=k.find(Bn=>Bn===fs);if(ts){const Bn=r().saveInds[ts];Bn&&Bn.pane_id&&(console.log(`🔄 Updating existing BIAS ${W+1} in pane:`,Bn.pane_id),(st=s())==null||st.overrideIndicator({name:"BIAS",calcParams:H,styles:he,paneId:Bn.pane_id}))}else{const Bn=`pane_BIAS_${W+1}`;console.log(`🆕 Creating new BIAS ${W+1} with pane ID:`,Bn),(Jt=s())==null||Jt.createIndicator({name:"BIAS",calcParams:H,styles:he},!0,{id:Bn})}}}),c.update(D=>(Object.keys(D.saveInds).forEach(W=>{D.saveInds[W].name==="BIAS"&&delete D.saveInds[W]}),i(io).forEach((W,H)=>{const he=H===0?`${o().editPaneId}_BIAS`:`pane_BIAS_${H+1}_BIAS`,Le=H===0?o().editPaneId:`pane_BIAS_${H+1}`;console.log(`💾 Saving BIAS group ${H+1} with key:`,he),D.saveInds[he]={name:"BIAS",biasGroup:W,pane_id:Le,groupIndex:H,biasGroups:H===0?[...i(io)]:void 0,params:[W.period]}}),D))}function Ad(k){if(!i(Xu)||i(io).length<=1)return;const N=i(io).findIndex(j=>j.id===k);N!==-1&&(console.log("🗑️ Removing BIAS group at index:",N,"ID:",k),x(io,V(i(io).filter(j=>j.id!==k))),tc(),console.log("✅ BIAS group removed. Remaining groups:",i(io).length))}function gc(){if(!i(we))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="CCI").sort((N,j)=>N===`${o().editPaneId}_CCI`?-1:j===`${o().editPaneId}_CCI`?1:N.localeCompare(j));if(console.log("🔍 Found existing CCI keys:",k),k.length>0){x(ko,V([]));let N=1;k.forEach((j,D)=>{const W=r().saveInds[j];if(W)if(W.cciGroup){const H={...W.cciGroup};H.name=N===1?"CCI":`CCI${N}`,i(ko).push(H),N+=1}else W.params&&W.params.length>=1&&(i(ko).push({id:Br(),name:N===1?"CCI":`CCI${N}`,period:W.params[0]||14,color:"#FF9800",thickness:1,lineStyle:"solid"}),N+=1)}),console.log("✅ Loaded",i(ko).length,"existing CCI groups with proper naming")}else i(ko).length===0&&(x(ko,V([{id:Br(),name:"CCI",period:14,color:"#FF9800",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default CCI group"))}function wd(){if(!i(we)||!s())return;console.log("🔄 Applying CCI changes in real-time, groups:",i(ko).length);const k=Object.keys(r().saveInds).filter(H=>r().saveInds[H].name==="CCI").sort((H,he)=>H===`${o().editPaneId}_CCI`?-1:he===`${o().editPaneId}_CCI`?1:H.localeCompare(he));console.log("🔍 Existing CCI keys:",k);const N=new Map,j=new Set;i(ko).forEach((H,he)=>{let Le=null;for(const st of k){if(j.has(st))continue;const Jt=r().saveInds[st];if(Jt&&Jt.cciGroup&&Jt.cciGroup.id===H.id){Le=st,j.add(st);break}}if(!Le){if(he===0&&!j.has(`${o().editPaneId}_CCI`))Le=`${o().editPaneId}_CCI`;else{let st=2;for(;j.has(`pane_CCI_${st}_CCI`)||k.includes(`pane_CCI_${st}_CCI`);)st+=1;Le=`pane_CCI_${st}_CCI`}j.add(Le)}N.set(H.id,Le)});const D=Array.from(N.values()),W=k.filter(H=>!D.includes(H));W.forEach(H=>{var Le;const he=r().saveInds[H];if(he&&he.pane_id){console.log("🗑️ Removing CCI indicator from pane:",he.pane_id,"key:",H);try{(Le=s())==null||Le.removeIndicator({paneId:he.pane_id,name:"CCI"})}catch(st){console.log("Error removing excess CCI indicator:",st)}}}),i(ko).forEach((H,he)=>{var ts,Bn;const Le=[H.period],st=N.get(H.id),Jt={lines:[{color:H.color,size:H.thickness,style:H.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:H.lineStyle==="dashed"?[4,4]:H.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},fs=k.includes(st)?r().saveInds[st]:null;if(fs&&fs.pane_id)console.log("🔄 Updating existing CCI in pane:",fs.pane_id),(ts=s())==null||ts.overrideIndicator({name:"CCI",calcParams:Le,styles:Jt,paneId:fs.pane_id});else{const ti=st===`${o().editPaneId}_CCI`?o().editPaneId:st.replace("_CCI","");console.log("🆕 Creating new CCI with pane ID:",ti,"key:",st),(Bn=s())==null||Bn.createIndicator({name:"CCI",calcParams:Le,styles:Jt},!0,{id:ti})}}),c.update(H=>(W.forEach(he=>{delete H.saveInds[he],console.log("🗑️ Deleted save data for key:",he)}),i(ko).forEach((he,Le)=>{const st=N.get(he.id),Jt=st===`${o().editPaneId}_CCI`?o().editPaneId:st.replace("_CCI","");console.log(`💾 Saving CCI group ${Le+1} with key:`,st),H.saveInds[st]={name:"CCI",cciGroup:he,pane_id:Jt,groupIndex:Le,cciGroups:Le===0?[...i(ko)]:void 0,params:[he.period]}}),H))}function Xp(k){if(!i(we)||i(ko).length<=1)return;const N=i(ko).findIndex(j=>j.id===k);N!==-1&&(console.log("🗑️ Removing CCI group at index:",N,"ID:",k),x(ko,V(i(ko).filter(j=>j.id!==k))),wd(),console.log("✅ CCI group removed. Remaining groups:",i(ko).length))}function $u(){if(!i(Bd))return;const N=Object.values(r().saveInds||{}).filter(j=>(j==null?void 0:j.name)==="SAR").filter(j=>(j==null?void 0:j.pane_id)==="candle_pane");if(N.length>0){const j=N[0];j.sarGroups&&Array.isArray(j.sarGroups)&&j.sarGroups.length>0?x(Hl,V([...j.sarGroups])):x(Hl,V(N.map(D=>{const[W=.02,H=.02,he=.2]=D.params||[];return{id:Br(),start:W,increment:H,maxValue:he,color:"#2563eb",dotSize:1}})))}else x(Hl,V([{id:Br(),start:.02,increment:.02,maxValue:.2,color:"#2563eb",dotSize:1}]));s()&&i(Hl).length>0&&Mo()}function Jd(k){!i(Bd)||i(Hl).length<=1||(x(Hl,V(i(Hl).filter(N=>N.id!==k))),Mo())}function Po(k){!i(Bd)||!s()||k>=i(Hl).length||Mo()}function Mo(){if(!s()||!i(Bd))return;const k="candle_pane";for(let N=0;N<6;(N+=1)-1)try{s().removeIndicator({paneId:k,name:"SAR"})}catch{}i(Hl).forEach(N=>{var W;const j=[N.start,N.increment,N.maxValue],D={lines:[{color:N.color,size:N.dotSize,style:wt.Solid}]};(W=s())==null||W.createIndicator({name:"SAR",calcParams:j,styles:D},!0,{id:k})})}function $i(){if(!i(jt))return;const k=`${o().editPaneId}_SMARTTREND`,N=r().saveInds[k];if(N&&N.superTrendGroups&&N.superTrendGroups.length>0)x(Vc,V([...N.superTrendGroups]));else if(N&&Array.isArray(N.params)){const j=Number(N.params[0]??10),D=Number(N.params[1]??3);x(Vc,V([{id:Br(),period:j,multiplier:D,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]))}else i(Vc).length===0&&x(Vc,V([{id:Br(),period:10,multiplier:3,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]));Hu()}function Zr(k){!i(jt)||i(Vc).length<=1||(x(Vc,V(i(Vc).filter(N=>N.id!==k))),Hu())}function nc(k){!i(jt)||!s()||k>=i(Vc).length||(i(Vc)[k],Hu())}function Hu(){if(!s()||!i(jt))return;const k="candle_pane";for(let N=0;N<6;(N+=1)-1)try{s().removeIndicator({paneId:k,name:"SMARTTREND"})}catch{}i(Vc).forEach((N,j)=>{var H;const D=[N.period,N.multiplier],W={lines:[{color:N.styles.uptrend.color,size:N.styles.uptrend.thickness,style:N.styles.uptrend.lineStyle==="dashed"?wt.Dashed:wt.Solid}]};(H=s())==null||H.createIndicator({name:"SMARTTREND",calcParams:D,styles:W,extendData:{showLabels:N.showLabels,uptrendColor:N.styles.uptrend.color,downtrendColor:N.styles.downtrend.color,uptrendThickness:N.styles.uptrend.thickness,downtrendThickness:N.styles.downtrend.thickness,uptrendLineStyle:N.styles.uptrend.lineStyle,downtrendLineStyle:N.styles.downtrend.lineStyle}},!0,{id:k})}),c.update(N=>(Object.keys(N.saveInds).forEach(j=>{N.saveInds[j].name==="SMARTTREND"&&delete N.saveInds[j]}),i(Vc).forEach((j,D)=>{const W=D===0?`${k}_SMARTTREND`:`${k}_SMARTTREND_${D+1}`;N.saveInds[W]={name:"SMARTTREND",pane_id:k,params:[j.period,j.multiplier],superTrendGroup:j,groupIndex:D}}),N))}function ld(){if(!i(Mc))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="DMI").sort((N,j)=>N===`${o().editPaneId}_DMI`?-1:j===`${o().editPaneId}_DMI`?1:N.localeCompare(j));if(console.log("🔍 Found existing DMI keys:",k),k.length>0){x(ol,V([]));let N=1;k.forEach((j,D)=>{const W=r().saveInds[j];if(W.dmiGroup){const H={...W.dmiGroup};H.name=N===1?"DMI":`DMI${N}`,i(ol).push(H),N+=1}else W.params&&W.params.length>=2&&(i(ol).push({id:Br(),name:N===1?"DMI":`DMI${N}`,diPeriod:W.params[0]||14,adxPeriod:W.params[1]||6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}),N+=1)}),console.log("✅ Loaded",i(ol).length,"existing DMI groups with proper naming")}else i(ol).length===0&&(x(ol,V([{id:Br(),name:"DMI",diPeriod:14,adxPeriod:6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default DMI group"))}function mp(){if(!i(be))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="CR").sort((N,j)=>N===`${o().editPaneId}_CR`?-1:j===`${o().editPaneId}_CR`?1:N.localeCompare(j));console.log("🔍 Found existing CR keys:",k),k.length>0?(x(br,V([])),k.forEach((N,j)=>{var W,H,he,Le,st;const D=r().saveInds[N];D.crGroup?i(br).push({...D.crGroup}):i(br).push({id:Br(),name:`CR${j+1}`,crPeriod:((W=D.params)==null?void 0:W[0])||26,crMa1Period:((H=D.params)==null?void 0:H[1])||10,crMa2Period:((he=D.params)==null?void 0:he[2])||20,crMa3Period:((Le=D.params)==null?void 0:Le[3])||40,crMa4Period:((st=D.params)==null?void 0:st[4])||60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}})}),console.log("✅ Loaded",i(br).length,"existing CR groups")):i(br).length===0&&(x(br,V([{id:Br(),name:"CR",crPeriod:26,crMa1Period:10,crMa2Period:20,crMa3Period:40,crMa4Period:60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default CR group"))}function Tc(){if(!i(Mc)||!s())return;console.log("🔄 Applying DMI changes in real-time, groups:",i(ol).length);const k=Object.keys(r().saveInds).filter(H=>r().saveInds[H].name==="DMI").sort((H,he)=>H===`${o().editPaneId}_DMI`?-1:he===`${o().editPaneId}_DMI`?1:H.localeCompare(he));console.log("🔍 Existing DMI keys:",k);const N=new Map,j=new Set;i(ol).forEach((H,he)=>{for(const Le of k){if(j.has(Le))continue;const st=r().saveInds[Le];if(st&&st.dmiGroup&&st.dmiGroup.id===H.id){N.set(H.id,Le),j.add(Le),console.log(`✅ Matched group ${he+1} (ID: ${H.id}) to existing key: ${Le}`);break}}}),i(ol).forEach((H,he)=>{if(N.has(H.id))return;let Le=null;if(he===0&&!j.has(`${o().editPaneId}_DMI`)&&!k.includes(`${o().editPaneId}_DMI`))Le=`${o().editPaneId}_DMI`;else{let st=2;for(;j.has(`pane_DMI_${st}_DMI`)||k.includes(`pane_DMI_${st}_DMI`);)st+=1;Le=`pane_DMI_${st}_DMI`}N.set(H.id,Le),j.add(Le),console.log(`🆕 Assigned new key for group ${he+1} (ID: ${H.id}): ${Le}`)});const D=Array.from(N.values()),W=k.filter(H=>!D.includes(H));W.forEach(H=>{var Le;const he=r().saveInds[H];if(he&&he.pane_id){console.log("🗑️ Removing DMI indicator from pane:",he.pane_id,"key:",H);try{(Le=s())==null||Le.removeIndicator({paneId:he.pane_id,name:"DMI"})}catch(st){console.log("Error removing excess DMI indicator:",st)}}}),i(ol).forEach((H,he)=>{var ti,ci,lu,Cd;const Le=[H.diPeriod,H.adxPeriod],st=N.get(H.id),Jt=he===0?o().editPaneId:`pane_DMI_${he+1}`;console.log(`📍 Group ${he+1} (ID: ${H.id}) -> Target pane: ${Jt}, Save key: ${st}`);const fs={lines:[{color:H.styles.diPlus.color,size:H.styles.diPlus.thickness,style:H.styles.diPlus.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:H.styles.diPlus.lineStyle==="dashed"?[4,4]:H.styles.diPlus.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:H.styles.diMinus.color,size:H.styles.diMinus.thickness,style:H.styles.diMinus.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:H.styles.diMinus.lineStyle==="dashed"?[4,4]:H.styles.diMinus.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:H.styles.adx.color,size:H.styles.adx.thickness,style:H.styles.adx.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:H.styles.adx.lineStyle==="dashed"?[4,4]:H.styles.adx.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},ts=k.includes(st)?r().saveInds[st]:null,Bn=ts==null?void 0:ts.pane_id;if(Bn&&Bn!==Jt){console.log(`🔀 Moving DMI from pane ${Bn} to ${Jt}`);try{(ti=s())==null||ti.removeIndicator({paneId:Bn,name:"DMI"})}catch(Sf){console.log("Note: Indicator may not exist in old pane:",Sf)}(ci=s())==null||ci.createIndicator({name:"DMI",calcParams:Le,styles:fs},!0,{id:Jt})}else Bn?(console.log(`🔄 Updating existing DMI in pane: ${Jt}`),(lu=s())==null||lu.overrideIndicator({name:"DMI",calcParams:Le,styles:fs,paneId:Jt})):(console.log(`🆕 Creating new DMI in pane: ${Jt}`),(Cd=s())==null||Cd.createIndicator({name:"DMI",calcParams:Le,styles:fs},!0,{id:Jt}))}),c.update(H=>(W.forEach(he=>{delete H.saveInds[he],console.log("🗑️ Deleted save data for key:",he)}),i(ol).forEach((he,Le)=>{const st=N.get(he.id),Jt=Le===0?o().editPaneId:`pane_DMI_${Le+1}`;console.log(`💾 Saving DMI group ${Le+1} with key: ${st}, pane: ${Jt}`),H.saveInds[st]={name:"DMI",dmiGroup:he,pane_id:Jt,groupIndex:Le,dmiGroups:Le===0?[...i(ol)]:void 0,params:[he.diPeriod,he.adxPeriod]}}),H))}function Hp(k){if(!i(Mc)||i(ol).length<=1)return;const N=i(ol).findIndex(j=>j.id===k);N!==-1&&(console.log("🗑️ Removing DMI group at index:",N,"ID:",k),x(ol,V(i(ol).filter(j=>j.id!==k))),Tc(),console.log("✅ DMI group removed. Remaining groups:",i(ol).length))}function vu(){if(!i(be)||!s())return;console.log("🔄 Applying CR changes in real-time, groups:",i(br).length);const k=Object.keys(r().saveInds).filter(H=>r().saveInds[H].name==="CR").sort((H,he)=>H===`${o().editPaneId}_CR`?-1:he===`${o().editPaneId}_CR`?1:H.localeCompare(he));console.log("🔍 Existing CR keys:",k);const N=new Map,j=new Set;i(br).forEach((H,he)=>{let Le=null;for(const st of k){if(j.has(st))continue;const Jt=r().saveInds[st];if(Jt&&Jt.crGroup&&Jt.crGroup.id===H.id){Le=st,j.add(st);break}}if(!Le){if(he===0&&!j.has(`${o().editPaneId}_CR`))Le=`${o().editPaneId}_CR`;else{let st=2;for(;j.has(`pane_CR_${st}_CR`)||k.includes(`pane_CR_${st}_CR`);)st+=1;Le=`pane_CR_${st}_CR`}j.add(Le)}N.set(H.id,Le)});const D=Array.from(N.values()),W=k.filter(H=>!D.includes(H));W.forEach(H=>{var Le;const he=r().saveInds[H];if(he&&he.pane_id){console.log("🗑️ Removing CR indicator from pane:",he.pane_id,"key:",H);try{(Le=s())==null||Le.removeIndicator({paneId:he.pane_id,name:"CR"})}catch(st){console.log("Error removing excess CR indicator:",st)}}}),i(br).forEach((H,he)=>{var ts,Bn;const Le=[H.crPeriod,H.crMa1Period,H.crMa2Period,H.crMa3Period,H.crMa4Period],st=N.get(H.id),Jt={lines:[{color:H.styles.cr.color,size:H.styles.cr.thickness,style:H.styles.cr.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:H.styles.cr.lineStyle==="dashed"?[4,4]:H.styles.cr.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:H.styles.ma1.color,size:H.styles.ma1.thickness,style:H.styles.ma1.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:H.styles.ma1.lineStyle==="dashed"?[4,4]:H.styles.ma1.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:H.styles.ma2.color,size:H.styles.ma2.thickness,style:H.styles.ma2.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:H.styles.ma2.lineStyle==="dashed"?[4,4]:H.styles.ma2.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:H.styles.ma3.color,size:H.styles.ma3.thickness,style:H.styles.ma3.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:H.styles.ma3.lineStyle==="dashed"?[4,4]:H.styles.ma3.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:H.styles.ma4.color,size:H.styles.ma4.thickness,style:H.styles.ma4.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:H.styles.ma4.lineStyle==="dashed"?[4,4]:H.styles.ma4.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},fs=k.includes(st)?r().saveInds[st]:null;if(fs&&fs.pane_id)console.log("🔄 Updating existing CR in pane:",fs.pane_id),(ts=s())==null||ts.overrideIndicator({name:"CR",calcParams:Le,styles:Jt,paneId:fs.pane_id});else{const ti=st===`${o().editPaneId}_CR`?o().editPaneId:st.replace("_CR","");console.log("🆕 Creating new CR with pane ID:",ti,"key:",st),(Bn=s())==null||Bn.createIndicator({name:"CR",calcParams:Le,styles:Jt},!0,{id:ti})}}),c.update(H=>(W.forEach(he=>{delete H.saveInds[he],console.log("🗑️ Deleted save data for key:",he)}),i(br).forEach((he,Le)=>{const st=N.get(he.id),Jt=st===`${o().editPaneId}_CR`?o().editPaneId:st.replace("_CR","");console.log(`💾 Saving CR group ${Le+1} with key:`,st),H.saveInds[st]={name:"CR",crGroup:he,pane_id:Jt,groupIndex:Le,crGroups:Le===0?[...i(br)]:void 0,params:[he.crPeriod,he.crMa1Period,he.crMa2Period,he.crMa3Period,he.crMa4Period]}}),H))}function Qi(k){if(!i(be)||i(br).length<=1)return;const N=i(br).findIndex(j=>j.id===k);N!==-1&&(console.log("🗑️ Removing CR group at index:",N,"ID:",k),x(br,V(i(br).filter(j=>j.id!==k))),vu(),console.log("✅ CR group removed. Remaining groups:",i(br).length))}function zm(){if(!i(qd))return;const k=`${o().editPaneId}_ROC`,N=r().saveInds[k];N&&N.rocGroups&&N.rocGroups.length>0?(x(fa,V([...N.rocGroups])),i(fa).forEach((j,D)=>{j.paneId||(j.paneId=D===0?o().editPaneId:void 0)})):N&&N.rocGroup?(x(fa,V([N.rocGroup])),i(fa)[0]&&!i(fa)[0].paneId&&(i(fa)[0].paneId=o().editPaneId)):i(fa).length===0&&x(fa,V([{id:Br(),period:14,period2:21,paneId:o().editPaneId,styles:{roc:{color:"#2563eb",thickness:1,lineStyle:"solid"},roc2:{color:"#dc2626",thickness:1,lineStyle:"solid",visible:!1}}}]))}function sp(){var k;if(!(!s()||!i(qd)))try{const j=((k=s())==null?void 0:k.getIndicators()).filter(D=>D.name==="ROC");console.log("🔍 Detecting paneIds for ROC indicators:",j.length),j.forEach((D,W)=>{W<i(fa).length&&!i(fa)[W].paneId&&(i(fa)[W].paneId=D.paneId,console.log(`📍 Set paneId ${D.paneId} for ROC group ${W}`))})}catch(N){console.error("❌ Error detecting ROC paneIds:",N)}}function ym(){var Jt,fs;if(!i(qd)||!s())return;const k=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"],N=i(fa).length%k.length,j={id:Br(),period:14,period2:21,paneId:void 0,styles:{roc:{color:k[N],thickness:1,lineStyle:"solid"},roc2:{color:k[(N+1)%k.length],thickness:1,lineStyle:"solid",visible:!1}}};i(fa).push(j);const D=[j.period];let W=wt.Solid,H=[2,2];j.styles.roc.lineStyle==="dashed"?(W=wt.Dashed,H=[4,4]):j.styles.roc.lineStyle==="dotted"&&(W=wt.Dashed,H=[2,2]);const he={lines:[{color:j.styles.roc.color,size:j.styles.roc.thickness,style:W,dashedValue:H,smooth:!1}]},Le={name:"ROC",calcParams:D,styles:he,figures:[{key:"roc",title:"ROC: ",type:"line"}]};let st;i(fa).length===1?((Jt=s())==null||Jt.overrideIndicator({...Le,paneId:o().editPaneId}),st=o().editPaneId):st=(fs=s())==null?void 0:fs.createIndicator(Le,!1,{axis:{gap:{bottom:2}}}),j.paneId=st??void 0,c.update(ts=>{const Bn=`${o().editPaneId}_ROC`;return ts.saveInds[Bn]||(ts.saveInds[Bn]={name:"ROC",pane_id:o().editPaneId,params:[j.period],rocGroups:[]}),ts.saveInds[Bn].rocGroups||(ts.saveInds[Bn].rocGroups=[]),ts.saveInds[Bn].rocGroups=[...i(fa)],ts})}function vh(k){var D,W;if(!i(qd)||i(fa).length<=1)return;const N=i(fa).findIndex(H=>H.id===k);if(N===-1)return;console.log("🗑️ Removing ROC group at index:",N,"with ID:",k);const j=i(fa).length;if(i(fa).splice(N,1),console.log(`📝 Removed ROC group: ${j} -> ${i(fa).length}`),i(fa).forEach((H,he)=>{H.name=`ROC #${he+1}`}),s())try{const he=((D=s())==null?void 0:D.getIndicators()).filter(Le=>Le.name==="ROC");console.log("📈 ROC indicators found:",he.length);for(const Le of he)console.log("🗑️ Removing ROC from pane:",Le.paneId),(W=s())==null||W.removeIndicator({paneId:Le.paneId,name:"ROC"});i(fa).forEach((Le,st)=>{var ti;let Jt=wt.Solid,fs=[2,2];Le.styles.roc.lineStyle==="dashed"?(Jt=wt.Dashed,fs=[4,4]):Le.styles.roc.lineStyle==="dotted"&&(Jt=wt.Dashed,fs=[2,2]);const ts={lines:[{color:Le.styles.roc.color,size:Le.styles.roc.thickness,style:Jt,dashedValue:fs}]};console.log("➕ Re-adding ROC group:",`ROC_${st+1}`,"at index:",st);const Bn=(ti=s())==null?void 0:ti.createIndicator({name:"ROC",calcParams:[Le.period],styles:ts,figures:[{key:"roc",title:"ROC: ",type:"line"}]},!1);Bn&&(Le.paneId=Bn,c.update(ci=>{const lu=`${Bn}_ROC`;return ci.saveInds[lu]||(ci.saveInds[lu]={name:"ROC",pane_id:Bn,rocGroups:[]}),ci.saveInds[lu].rocGroups||(ci.saveInds[lu].rocGroups=[]),ci.saveInds[lu].rocGroups[st]={...Le},ci}))}),console.log("✅ Successfully updated ROC indicators on chart")}catch(H){console.error("❌ Error updating ROC indicators:",H)}console.log("✅ ROC group removed. Remaining groups:",i(fa).length)}function Zp(k){var he,Le;const N=i(fa)[k];if(!N||!s()){console.warn("❌ updateRocIndicator: Missing group or chart",{group:N,chart:!!s()});return}console.log("🔄 updateRocIndicator called:",{groupIndex:k,group:N});let j=wt.Solid,D=[2,2];N.styles.roc.lineStyle==="dashed"?(j=wt.Dashed,D=[4,4]):N.styles.roc.lineStyle==="dotted"&&(j=wt.Dashed,D=[2,2]);const H=((he=s())==null?void 0:he.getIndicators()).filter(st=>st.name==="ROC");if(console.log("📊 Found ROC indicators on chart:",H.length),console.log("📊 Looking for group index:",k),H.length>k){const st=H[k];console.log("✅ Found matching ROC indicator by index, updating styles...");const Jt=(Le=s())==null?void 0:Le.overrideIndicator({name:"ROC",paneId:st.paneId,calcParams:[N.period],styles:{lines:[{color:N.styles.roc.color,size:N.styles.roc.thickness,style:j,dashedValue:D,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]});console.log("🎨 overrideIndicator result:",Jt),console.log("🎨 Applied styles:",{color:N.styles.roc.color,size:N.styles.roc.thickness,style:j,dashedValue:D});const fs=`${st.paneId}_ROC`;console.log("💾 Using save key:",fs),c.update(ts=>{ts.saveInds[fs]||(ts.saveInds[fs]={name:"ROC",pane_id:st.paneId,params:[N.period],rocGroups:[]}),ts.saveInds[fs].rocGroups||(ts.saveInds[fs].rocGroups=[]);const Bn=ts.saveInds[fs].rocGroups||[];for(;Bn.length<=k;)Bn.push({});return Bn[k]={...N},ts.saveInds[fs].rocGroups=Bn,ts.saveInds[fs].params=[N.period],console.log("💾 Persisted ROC changes to save data:",fs,N),ts}),console.log("✅ ROC indicator updated successfully:",k,N)}else console.error("❌ ROC indicator not found on chart for group index:",k),console.log("📊 Available ROC indicators:",H.length),console.log("📊 Requested group index:",k)}function Jp(){if(!i(Vf))return;x(Xr,V([]));const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="PSY").sort((N,j)=>N===`${o().editPaneId}_PSY`?-1:j===`${o().editPaneId}_PSY`?1:N.localeCompare(j));k.length>0?x(Xr,V(k.map((N,j)=>{const D=r().saveInds[N];if(D.psyGroup)return{...D.psyGroup,id:D.psyGroup.id||Br(),actualPaneId:D.pane_id};if(D.psyGroups){const W=D.psyGroups[j]||D.psyGroups[0];return{...W,id:W.id||Br(),actualPaneId:D.pane_id}}else{const[W=12,H=6]=D.params||[12,6],he=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"];return{id:Br(),psyPeriod:W,mapsyPeriod:H,showMapsy:!0,actualPaneId:D.pane_id,styles:{psy:{color:he[j%he.length],thickness:1,lineStyle:"solid"},mapsy:{color:he[(j+1)%he.length],thickness:1,lineStyle:"solid"}}}}}))):i(Xr).push({id:Br(),psyPeriod:12,mapsyPeriod:6,showMapsy:!0,styles:{psy:{color:"#2563eb",thickness:1,lineStyle:"solid"},mapsy:{color:"#dc2626",thickness:1,lineStyle:"solid"}}}),x(Xr,V(i(Xr).map(N=>({...N,id:N.id||Br()}))))}function bm(){var W;if(!i(Vf))return;const k=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"],N=i(Xr).length%k.length,j={id:Br(),psyPeriod:12,mapsyPeriod:6,showMapsy:!0,actualPaneId:void 0,styles:{psy:{color:k[N],thickness:1,lineStyle:"solid"},mapsy:{color:k[(N+1)%k.length],thickness:1,lineStyle:"solid"}}};if(i(Xr).push(j),i(Xr).length>1){let H=2;for(;Object.keys(r().saveInds).some(ci=>ci===`psy_${String(H).padStart(3,"0")}_PSY`);)H+=1;const he=i(Xr).length-1,Le=[j.psyPeriod,j.mapsyPeriod],st=[{key:"psy",title:"PSY: ",type:"line"}];j.showMapsy&&st.push({key:"mapsy",title:"MAPSY: ",type:"line"});const Jt={lines:[]};let fs=wt.Solid,ts=[2,2];if(j.styles.psy.lineStyle==="dashed"?(fs=wt.Dashed,ts=[4,4]):j.styles.psy.lineStyle==="dotted"&&(fs=wt.Dashed,ts=[2,2]),Jt.lines.push({color:j.styles.psy.color,size:j.styles.psy.thickness,style:fs,dashedValue:ts,smooth:!1}),j.showMapsy){let ci=wt.Solid,lu=[2,2];j.styles.mapsy.lineStyle==="dashed"?(ci=wt.Dashed,lu=[4,4]):j.styles.mapsy.lineStyle==="dotted"&&(ci=wt.Dashed,lu=[2,2]),Jt.lines.push({color:j.styles.mapsy.color,size:j.styles.mapsy.thickness,style:ci,dashedValue:lu,smooth:!1})}const Bn=`psy_${String(H).padStart(3,"0")}`;console.log(`🆕 Immediately creating PSY ${H} with pane ID:`,Bn),((W=s())==null?void 0:W.createIndicator({name:"PSY",calcParams:Le,styles:Jt,figures:st},!1,{id:Bn,axis:{gap:{bottom:2}}}))&&(console.log(`✅ PSY ${H} created with pane ID:`,Bn),j.actualPaneId=Bn,c.update(ci=>{const lu=`psy_${String(H).padStart(3,"0")}_PSY`;return ci.saveInds[lu]={name:"PSY",psyGroup:j,pane_id:Bn,groupIndex:he,params:[j.psyPeriod,j.mapsyPeriod]},ci}))}else console.log("📝 New PSY group will be added to edit pane on confirm")}function Eh(k){var j,D,W;if(!i(Vf)||i(Xr).length<=1)return;const N=i(Xr).findIndex(H=>H.id===k);if(N!==-1){console.log("🗑️ Removing PSY group at index:",N,"ID:",k);try{if(N===0&&i(Xr).length>1){console.log("🔄 Special handling: First PSY removed, promoting second PSY to first position"),x(Xr,V(i(Xr).filter(he=>he.id!==k))),console.log("✅ PSY group removed from array. Remaining groups:",i(Xr).length);const H=i(Xr)[0];H.actualPaneId&&(console.log("🗑️ Removing old second PSY from sub-pane:",H.actualPaneId),(j=s())==null||j.removeIndicator({paneId:H.actualPaneId,name:"PSY"})),H.actualPaneId=void 0,console.log("📊 Updating PSY in edit pane with new first group settings"),Hf(0)}else{const H=`pane_PSY_${N+1}_PSY`;if(r().saveInds[H]){const he=r().saveInds[H];console.log("🗑️ Removing PSY from pane:",he.pane_id),(D=s())==null||D.removeIndicator({paneId:he.pane_id,name:"PSY"}),console.log("✅ Successfully removed PSY from pane:",he.pane_id)}else{const he=i(Xr)[N];he.actualPaneId&&(console.log("🗑️ Removing PSY from actual pane:",he.actualPaneId),(W=s())==null||W.removeIndicator({paneId:he.actualPaneId,name:"PSY"}),console.log("✅ Successfully removed PSY from actual pane:",he.actualPaneId))}x(Xr,V(i(Xr).filter(he=>he.id!==k))),console.log("✅ PSY group removed from array. Remaining groups:",i(Xr).length)}c.update(H=>(Object.keys(H.saveInds).forEach(he=>{H.saveInds[he].name==="PSY"&&(console.log("🧹 Cleaning saved state for key:",he),delete H.saveInds[he])}),i(Xr).forEach((he,Le)=>{const st=Le===0?`${o().editPaneId}_PSY`:`pane_PSY_${Le+1}_PSY`,Jt=Le===0?o().editPaneId:he.actualPaneId||`pane_PSY_${Le+1}`;H.saveInds[st]={name:"PSY",psyGroup:he,pane_id:Jt,groupIndex:Le,psyGroups:Le===0?[...i(Xr)]:void 0,params:[he.psyPeriod,he.mapsyPeriod]},console.log("💾 Re-saved PSY group",Le,"with key:",st,"and pane ID:",Jt)}),H))}catch(H){console.error("❌ Error removing PSY group:",H)}}}function Hf(k){var st;const N=i(Xr)[k];if(!N||!s())return;const j=k===0?o().editPaneId:N.actualPaneId||`psy_${String(k+1).padStart(3,"0")}`,D=[{key:"psy",title:"PSY: ",type:"line"}];N.showMapsy&&D.push({key:"mapsy",title:"MAPSY: ",type:"line"});const W={lines:[]};let H=wt.Solid,he=[2,2];if(N.styles.psy.lineStyle==="dashed"?(H=wt.Dashed,he=[4,4]):N.styles.psy.lineStyle==="dotted"&&(H=wt.Dashed,he=[2,2]),W.lines.push({color:N.styles.psy.color,size:N.styles.psy.thickness,style:H,dashedValue:he,smooth:!1}),N.showMapsy){let Jt=wt.Solid,fs=[2,2];N.styles.mapsy.lineStyle==="dashed"?(Jt=wt.Dashed,fs=[4,4]):N.styles.mapsy.lineStyle==="dotted"&&(Jt=wt.Dashed,fs=[2,2]),W.lines.push({color:N.styles.mapsy.color,size:N.styles.mapsy.thickness,style:Jt,dashedValue:fs,smooth:!1})}(st=s())==null||st.overrideIndicator({name:"PSY",paneId:j,styles:W,calcParams:[N.psyPeriod,N.mapsyPeriod],figures:D});const Le=k===0?`${o().editPaneId}_PSY`:`psy_${String(k+1).padStart(3,"0")}_PSY`;c.update(Jt=>(Jt.saveInds[Le]&&(Jt.saveInds[Le].params=[N.psyPeriod,N.mapsyPeriod],Jt.saveInds[Le].psyGroup={...N},console.log("💾 Persisted PSY changes to save data:",Le,N)),Jt)),console.log("🔄 Updated PSY indicator:",k,N)}function Vm(){if(!i(se))return;x(cr,V([]));const k=Object.entries(r().saveInds).filter(([N,j])=>j.name==="OBV");k.length>0?(k.sort(([N,j],[D,W])=>{const H=j.groupIndex||0,he=W.groupIndex||0;return H-he}),k.forEach(([N,j])=>{var W,H;const D=j;if(D.obvGroup){const he=D.obvGroup;D.pane_id&&(he.actualPaneId=D.pane_id),i(cr).push(he)}else if(D.obvGroups&&D.obvGroups.length>0)x(cr,V([...D.obvGroups])),i(cr).forEach((he,Le)=>{he.actualPaneId||(Le===0?he.actualPaneId=o().editPaneId:D.pane_id&&(he.actualPaneId=D.pane_id))});else{const he={id:Br(),obvPeriod:((W=D.params)==null?void 0:W[0])||30,maobvPeriod:((H=D.params)==null?void 0:H[1])||10,showMaobv:!0,actualPaneId:void 0,styles:{obv:{color:"#FF6B35",thickness:2,lineStyle:"solid"},maobv:{color:"#2196F3",thickness:1,lineStyle:"solid"}}};D.pane_id&&(he.actualPaneId=D.pane_id),i(cr).push(he)}})):i(cr).push({id:Br(),obvPeriod:30,maobvPeriod:10,showMaobv:!0,actualPaneId:o().editPaneId,styles:{obv:{color:"#FF6B35",thickness:2,lineStyle:"solid"},maobv:{color:"#2196F3",thickness:1,lineStyle:"solid"}}})}function Wm(){if(!i(se))return;const k=["#FF6B35","#2196F3","#16a34a","#ca8a04","#9333ea","#c2410c"],N=i(cr).length%k.length,j={id:Br(),obvPeriod:30,maobvPeriod:10,showMaobv:!0,actualPaneId:void 0,styles:{obv:{color:k[N],thickness:2,lineStyle:"solid"},maobv:{color:k[(N+1)%k.length],thickness:1,lineStyle:"solid"}}},D=new Set;i(cr).forEach(he=>{he.actualPaneId&&D.add(he.actualPaneId)}),Object.keys(r().saveInds).forEach(he=>{r().saveInds[he]&&r().saveInds[he].name==="OBV"&&r().saveInds[he].pane_id&&D.add(r().saveInds[he].pane_id)}),console.log("🔍 Existing OBV pane IDs:",Array.from(D));let W=2;for(;D.has(`pane_OBV_${W}`);)W+=1;const H=`pane_OBV_${W}`;j.actualPaneId=H,console.log("✅ Adding new OBV group with pane ID:",H),i(cr).push(j),rm()}function Yh(k){var D;if(!i(se)||i(cr).length<=1)return;x(sl,!0),console.log("🚫 Set obvRemovalInProgress = true");const N=i(cr).findIndex(W=>W.id===k);if(N===-1){x(sl,!1);return}const j=i(cr)[N];console.log("🗑️ Removing OBV group at index:",N,"ID:",k),console.log("🗑️ Group to remove:",j);try{let W;W=j.actualPaneId,W||Object.keys(r().saveInds).forEach(H=>{const he=r().saveInds[H];he&&he.name==="OBV"&&he.groupIndex===N&&(W=he.pane_id)}),!W&&N===0&&(W=o().editPaneId),console.log("🗑️ Removing OBV at index",N,"from pane:",W),W&&(console.log("🗑️ Removing OBV indicator from pane:",W),(D=s())==null||D.removeIndicator({paneId:W,name:"OBV"}),console.log("✅ Successfully removed OBV from pane:",W)),x(cr,V(i(cr).filter(H=>H.id!==k))),console.log("✅ OBV group removed from array. Remaining groups:",i(cr).length),c.update(H=>{const he=[];return Object.keys(H.saveInds).forEach(Le=>{H.saveInds[Le]&&H.saveInds[Le].name==="OBV"&&he.push(Le)}),console.log("🧹 Clearing all OBV save data:",he),he.forEach(Le=>delete H.saveInds[Le]),i(cr).forEach((Le,st)=>{const Jt=Le.actualPaneId||o().editPaneId;if(!Jt){console.error(`❌ No pane ID for OBV group ${st} during removal cleanup`);return}const fs=`${Jt}_OBV`;H.saveInds[fs]={name:"OBV",obvGroup:Le,pane_id:Jt,groupIndex:st,obvGroups:st===0?[...i(cr)]:void 0,params:[Le.obvPeriod,Le.maobvPeriod]},console.log("💾 Re-saved OBV group",st,"with key:",fs,"pane:",Jt)}),H}),console.log("✅ OBV removal and reindexing completed"),setTimeout(()=>{x(sl,!1),console.log("✅ Reset obvRemovalInProgress = false")},200)}catch(W){console.error("❌ Error removing OBV group:",W)}}function rm(){if(!(!i(se)||!s()))try{console.log("🔄 Applying OBV changes to chart..."),console.log("🔧 Current OBV groups:",i(cr).length);const k=Object.keys(r().saveInds).filter(j=>r().saveInds[j]&&r().saveInds[j].name==="OBV");console.log("🔧 Existing OBV keys in save data:",k);const N=new Set;i(cr).forEach((j,D)=>{const W=j.actualPaneId||o().editPaneId;N.add(W)}),console.log("🔧 Pane IDs that should exist:",Array.from(N)),k.forEach(j=>{var W;const D=r().saveInds[j];if(D&&D.pane_id&&!N.has(D.pane_id))try{console.log("🗑️ Removing stale OBV indicator from pane:",D.pane_id),(W=s())==null||W.removeIndicator({paneId:D.pane_id,name:"OBV"})}catch(H){console.log("❌ Error removing stale OBV indicator:",H)}}),i(cr).forEach((j,D)=>{var he,Le,st;const W=[j.obvPeriod,j.maobvPeriod],H={lines:[{color:j.styles.obv.color,size:j.styles.obv.thickness,style:j.styles.obv.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:j.styles.obv.lineStyle==="dashed"?[4,4]:j.styles.obv.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:j.styles.maobv.color,size:j.styles.maobv.thickness,style:j.styles.maobv.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:j.styles.maobv.lineStyle==="dashed"?[4,4]:j.styles.maobv.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(D===0){const Jt=j.actualPaneId||o().editPaneId;j.actualPaneId||(j.actualPaneId=o().editPaneId),console.log("🔄 Updating first OBV in pane:",Jt),(he=s())==null||he.overrideIndicator({name:"OBV",calcParams:W,styles:H,paneId:Jt})}else{const Jt=j.actualPaneId||`pane_OBV_${D+1}`;if(k.find(ts=>{const Bn=r().saveInds[ts];return Bn&&Bn.pane_id===Jt}))console.log("🔄 Updating existing OBV in pane:",Jt),(Le=s())==null||Le.overrideIndicator({name:"OBV",calcParams:W,styles:H,paneId:Jt}),j.actualPaneId=Jt;else{const ts=j.actualPaneId||`pane_OBV_${D+1}`;console.log("🆕 Creating new OBV in pane:",ts);const Bn=(st=s())==null?void 0:st.createIndicator({name:"OBV",calcParams:W,styles:H},!0,{id:ts,axis:{gap:{bottom:2}}});Bn&&(j.actualPaneId=ts,console.log("✅ Created new OBV indicator with ID:",Bn,"in pane:",ts))}}}),c.update(j=>{try{Object.keys(j.saveInds).forEach(D=>{j.saveInds[D]&&j.saveInds[D].name==="OBV"&&delete j.saveInds[D]}),i(cr).forEach((D,W)=>{try{const H=D.actualPaneId||o().editPaneId;if(!H){console.error(`❌ No pane ID for OBV group ${W}`);return}const he=`${H}_OBV`,Le={name:"OBV",obvGroup:D,pane_id:H,groupIndex:W,obvGroups:W===0?[...i(cr)]:void 0,params:[D.obvPeriod,D.maobvPeriod]};j.saveInds[he]=Le,console.log("💾 Saved OBV group",W,"with key:",he,"and pane ID:",H)}catch(H){console.error(`❌ Error saving OBV group ${W}:`,H)}})}catch(D){console.error("❌ Error in OBV save operation:",D)}return j}),console.log("✅ OBV changes applied successfully")}catch(k){console.error("❌ Critical error in applyObv:",k)}}function xm(){if(!i(re))return;console.log("🔄 Initializing KDJ groups for edit pane:",o().editPaneId);const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="KDJ").sort((N,j)=>N===`${o().editPaneId}_KDJ`?-1:j===`${o().editPaneId}_KDJ`?1:N.localeCompare(j));console.log("🔍 Found KDJ keys:",k),k.length>0?(x(us,V([])),k.forEach((N,j)=>{const D=r().saveInds[N];if(console.log(`🔄 Loading KDJ group ${j+1} from key:`,N,D),D){if(D.kdjGroup){const W={...D.kdjGroup};j>0&&D.pane_id&&(W.actualPaneId=D.pane_id),i(us).push(W)}else if(D.params&&D.params.length>=2){const W={id:Br(),kPeriod:D.params[0]||9,dPeriod:D.params[1]||3,actualPaneId:void 0,styles:{k:{color:"#FF6B35",thickness:1,lineStyle:"solid"},d:{color:"#2196F3",thickness:1,lineStyle:"solid"},j:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}};j>0&&D.pane_id&&(W.actualPaneId=D.pane_id),i(us).push(W)}}}),console.log("✅ Loaded",i(us).length,"existing KDJ groups")):i(us).length===0&&(x(us,V([{id:Br(),kPeriod:9,dPeriod:3,styles:{k:{color:"#FF6B35",thickness:1,lineStyle:"solid"},d:{color:"#2196F3",thickness:1,lineStyle:"solid"},j:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default KDJ group"))}function Hm(){var D;if(!i(re))return;const k=["#FF6B35","#2196F3","#9C27B0","#16a34a","#ca8a04","#dc2626"],N=i(us).length%k.length,j={id:Br(),kPeriod:9,dPeriod:3,actualPaneId:void 0,styles:{k:{color:k[N],thickness:1,lineStyle:"solid"},d:{color:k[(N+1)%k.length],thickness:1,lineStyle:"solid"},j:{color:k[(N+2)%k.length],thickness:1,lineStyle:"solid"}}};if(i(us).push(j),i(us).length>1){const W=Object.values(r().saveInds).filter(ts=>ts.name==="KDJ"&&ts.pane_id).map(ts=>ts.pane_id);let H=2;for(;W.includes(`pane_KDJ_${H}`);)H+=1;const he=i(us).length-1,Le=[j.kPeriod,j.dPeriod,3],st={lines:[{color:j.styles.k.color,size:j.styles.k.thickness,style:j.styles.k.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:j.styles.k.lineStyle==="dashed"?[4,4]:[2,2]},{color:j.styles.d.color,size:j.styles.d.thickness,style:j.styles.d.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:j.styles.d.lineStyle==="dashed"?[4,4]:[2,2]},{color:j.styles.j.color,size:j.styles.j.thickness,style:j.styles.j.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:j.styles.j.lineStyle==="dashed"?[4,4]:[2,2]}]},Jt=`pane_KDJ_${H}`;console.log(`🆕 Immediately creating KDJ ${H} with pane ID:`,Jt),((D=s())==null?void 0:D.createIndicator({name:"KDJ",calcParams:Le,styles:st},!1,{id:Jt,axis:{gap:{bottom:2}}}))&&(console.log(`✅ KDJ ${H} created with pane ID:`,Jt),j.actualPaneId=Jt,c.update(ts=>{const Bn=`pane_KDJ_${H}_KDJ`;return ts.saveInds[Bn]={name:"KDJ",kdjGroup:j,pane_id:Jt,groupIndex:he,params:[j.kPeriod,j.dPeriod,3]},ts}))}}function hp(k){var H;const N=i(us)[k];if(!N||!s())return;const j=k===0?o().editPaneId:N.actualPaneId||`pane_KDJ_${k+1}`,D={lines:[{color:N.styles.k.color,size:N.styles.k.thickness,style:N.styles.k.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:N.styles.k.lineStyle==="dashed"?[4,4]:[2,2]},{color:N.styles.d.color,size:N.styles.d.thickness,style:N.styles.d.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:N.styles.d.lineStyle==="dashed"?[4,4]:[2,2]},{color:N.styles.j.color,size:N.styles.j.thickness,style:N.styles.j.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:N.styles.j.lineStyle==="dashed"?[4,4]:[2,2]}]};(H=s())==null||H.overrideIndicator({name:"KDJ",paneId:j,styles:D,calcParams:[N.kPeriod,N.dPeriod,3]});const W=k===0?`${o().editPaneId}_KDJ`:`pane_KDJ_${k+1}_KDJ`;c.update(he=>(he.saveInds[W]&&(he.saveInds[W].params=[N.kPeriod,N.dPeriod,3],he.saveInds[W].kdjGroup={...N},console.log("💾 Persisted KDJ changes to save data:",W,N)),he)),console.log("🔄 Updated KDJ indicator:",k,N)}let zd=ge(V([]));function lv(){if(!i(sf)||i(zd).length>0)return;const k=`${o().editPaneId}_ICHIMOKU`,N=r().saveInds[k];if(N&&Array.isArray(N.ichimokuGroups)&&N.ichimokuGroups.length>0)x(zd,V(N.ichimokuGroups.map((j,D)=>{var W;return{id:j.id||Br(),name:j.name||`Ichimoku #${D+1}`,params:j.params||[9,26,52],styles:((W=j.styles)==null?void 0:W.map(H=>({color:H.color||"#2563eb",thickness:H.thickness??1,lineStyle:H.lineStyle||"solid"})))||[{color:"#ef4444",thickness:1,lineStyle:"solid"},{color:"#3b82f6",thickness:1,lineStyle:"solid"},{color:"#10b981",thickness:1,lineStyle:"solid"}]}})));else{const j=[u[0]||9,u[1]||26,u[2]||52],D=[0,1,2].map(W=>{var H,he,Le;return{color:((H=h[W])==null?void 0:H.color)||["#ef4444","#3b82f6","#10b981"][W]||"#2563eb",thickness:((he=h[W])==null?void 0:he.thickness)??1,lineStyle:((Le=h[W])==null?void 0:Le.lineStyle)||"solid"}});x(zd,V([{id:Br(),name:"Ichimoku #1",params:j,styles:D}]))}}function Lv(){var W;if(!i(sf))return;const k=i(zd).length+1,N=[["#ef4444","#3b82f6","#10b981"],["#f59e0b","#8b5cf6","#06b6d4"],["#22c55e","#e11d48","#0ea5e9"]],j=N[(k-1)%N.length],D={id:Br(),name:`Ichimoku #${k}`,params:[9,26,52],styles:[{color:j[0],thickness:1,lineStyle:"solid"},{color:j[1],thickness:1,lineStyle:"solid"},{color:j[2],thickness:1,lineStyle:"solid"}]};x(zd,V([...i(zd),D]));try{const H={lines:D.styles.map(Le=>({color:Le.color,size:Le.thickness,style:Le.lineStyle==="dashed"||Le.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:Le.lineStyle==="dashed"?[4,4]:Le.lineStyle==="dotted"?[2,2]:[2,2]}))};(W=s())==null||W.createIndicator({name:"ICHIMOKU",calcParams:D.params,styles:H},!0,{id:o().editPaneId});const he=`${o().editPaneId}_ICHIMOKU`;c.update(Le=>{var st;return Le.saveInds[he]={name:"ICHIMOKU",pane_id:o().editPaneId,params:((st=i(zd)[0])==null?void 0:st.params)||[9,26,52],ichimokuGroups:i(zd).map(Jt=>({...Jt}))},Le})}catch(H){console.error("❌ Error adding Ichimoku group:",H)}}function qm(k){var N,j,D;if(!(!i(sf)||!s()))try{const H=(((j=(N=s())==null?void 0:N.getIndicators)==null?void 0:j.call(N))||[]).filter(Le=>Le.name==="ICHIMOKU"&&Le.paneId===o().editPaneId);for(const Le of H)(D=s())==null||D.removeIndicator({paneId:Le.paneId,name:"ICHIMOKU"});i(zd).forEach(Le=>{var Jt;const st={lines:Le.styles.map(fs=>({color:fs.color,size:fs.thickness,style:fs.lineStyle==="dashed"||fs.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:fs.lineStyle==="dashed"?[4,4]:fs.lineStyle==="dotted"?[2,2]:[2,2]}))};(Jt=s())==null||Jt.createIndicator({name:"ICHIMOKU",calcParams:Le.params,styles:st},!0,{id:o().editPaneId})});const he=`${o().editPaneId}_ICHIMOKU`;c.update(Le=>{var st;return Le.saveInds[he]={name:"ICHIMOKU",pane_id:o().editPaneId,params:((st=i(zd)[0])==null?void 0:st.params)||[9,26,52],ichimokuGroups:i(zd).map(Jt=>({...Jt}))},Le}),console.log("🔄 Updated Ichimoku groups")}catch(W){console.error("❌ Error updating Ichimoku groups:",W)}}function gh(k){if(i(sf)&&!(i(zd).length<=1)&&!(k<0||k>=i(zd).length))try{x(zd,V(i(zd).filter((N,j)=>j!==k))),qm(0),console.log("🗑️ Removed Ichimoku group at index:",k)}catch(N){console.error("❌ Error removing Ichimoku group:",N)}}function Kh(){var k,N,j;if(!(!i(sf)||!s()))try{const W=(((N=(k=s())==null?void 0:k.getIndicators)==null?void 0:N.call(k))||[]).filter(he=>he.name==="ICHIMOKU"&&he.paneId===o().editPaneId);for(const he of W)(j=s())==null||j.removeIndicator({paneId:he.paneId,name:"ICHIMOKU"});i(zd).forEach(he=>{var st;const Le={lines:he.styles.map(Jt=>({color:Jt.color,size:Jt.thickness,style:Jt.lineStyle==="dashed"||Jt.lineStyle==="dotted"?wt.Dashed:wt.Solid,dashedValue:Jt.lineStyle==="dashed"?[4,4]:Jt.lineStyle==="dotted"?[2,2]:[2,2]}))};(st=s())==null||st.createIndicator({name:"ICHIMOKU",calcParams:he.params,styles:Le},!0,{id:o().editPaneId})});const H=`${o().editPaneId}_ICHIMOKU`;c.update(he=>{var Le;return he.saveInds[H]={name:"ICHIMOKU",pane_id:o().editPaneId,params:((Le=i(zd)[0])==null?void 0:Le.params)||[9,26,52],ichimokuGroups:i(zd).map(st=>({...st}))},he}),l.update(he=>(he.editIndName="",he.editPaneId="",he.modalIndCfg=!1,he)),a(!1),console.log("✅ Ichimoku confirm applied")}catch(D){console.error("❌ Error confirming Ichimoku groups:",D)}}function Du(k){var j,D;if(!i(re)||i(us).length<=1)return;const N=i(us).findIndex(W=>W.id===k);if(N!==-1){console.log("🗑️ Removing KDJ group at index:",N,"ID:",k);try{if(N===0&&i(us).length>1){console.log("🔄 Special handling: First KDJ removed, promoting second KDJ to first position"),x(us,V(i(us).filter(H=>H.id!==k))),console.log("✅ KDJ group removed from array. Remaining groups:",i(us).length);const W=i(us)[0];W.actualPaneId&&(console.log("🗑️ Removing old second KDJ from sub-pane:",W.actualPaneId),(j=s())==null||j.removeIndicator({paneId:W.actualPaneId,name:"KDJ"})),W.actualPaneId=void 0,console.log("📊 Updating KDJ in edit pane with new first group settings"),hp(0)}else{const W=i(us)[N];W.actualPaneId&&(console.log("🗑️ Removing KDJ from actual pane:",W.actualPaneId),(D=s())==null||D.removeIndicator({paneId:W.actualPaneId,name:"KDJ"}),console.log("✅ Successfully removed KDJ from actual pane:",W.actualPaneId)),x(us,V(i(us).filter(H=>H.id!==k))),console.log("✅ KDJ group removed from array. Remaining groups:",i(us).length)}c.update(W=>(Object.keys(W.saveInds).forEach(H=>{W.saveInds[H].name==="KDJ"&&(console.log("🧹 Cleaning saved state for key:",H),delete W.saveInds[H])}),i(us).forEach((H,he)=>{const Le=he===0?`${o().editPaneId}_KDJ`:`pane_KDJ_${he+1}_KDJ`,st=he===0?o().editPaneId:H.actualPaneId||`pane_KDJ_${he+1}`;console.log(`💾 Re-saving KDJ group ${he+1} with key:`,Le,"pane ID:",st),W.saveInds[Le]={name:"KDJ",kdjGroup:H,pane_id:st,groupIndex:he,kdjGroups:he===0?[...i(us)]:void 0,params:[H.kPeriod,H.dPeriod,3]}}),W)),console.log("🔄 KDJ groups reindexed successfully")}catch(W){console.log("❌ Error removing KDJ indicator:",W)}}}function $p(){var N,j;if(!i(Ql))return;console.log("🔄 Initializing AO groups for edit pane:",o().editPaneId);const k=Object.keys(r().saveInds).filter(D=>r().saveInds[D].name==="AO").sort((D,W)=>D===`${o().editPaneId}_AO`?-1:W===`${o().editPaneId}_AO`?1:D.localeCompare(W));if(console.log("🔍 Found AO keys:",k),k.length>0)x(na,V([])),k.forEach((D,W)=>{var he;const H=r().saveInds[D];if(console.log(`🔄 Loading AO group ${W+1} from key:`,D,H),H)if(H.aoGroup){const Le={...H.aoGroup},st=Le.styles||{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"}};(he=st.reverse)!=null&&he.color?Le.styles=st:Le.styles={...st,reverse:{color:"#c4c4c4"}},i(na).push(Le)}else H.params&&H.params.length===2&&i(na).push({id:Br(),shortPeriod:H.params[0]||5,longPeriod:H.params[1]||34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"},reverse:{color:"#c4c4c4"}}})}),console.log("✅ Loaded AO groups:",i(na).length);else{const D=Object.entries(r().saveInds).find(([W,H])=>H.name==="AO"&&W.includes(o().editPaneId||""));if(D){const[,W]=D;console.log("🔄 Found existing AO indicator, creating group from it"),x(na,V([{id:Br(),shortPeriod:((N=W.params)==null?void 0:N[0])||5,longPeriod:((j=W.params)==null?void 0:j[1])||34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"},reverse:{color:"#c4c4c4"}}}]))}else console.log("🔄 Creating default AO group"),x(na,V([{id:Br(),shortPeriod:5,longPeriod:34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"},reverse:{color:"#c4c4c4"}}}]))}}function _h(){if(!i(Ku))return;const k=o().editPaneId||"candle_pane",N=Object.entries(r().saveInds).filter(([D,W])=>W&&W.name==="BOLL"&&W.pane_id===k);if(N.length>0){const D=N.sort(([W],[H])=>{var st,Jt;const he=(st=W.match(/_BOLL_(\d+)$/))!=null&&st[1]?parseInt(W.match(/_BOLL_(\d+)$/)[1],10):1,Le=(Jt=H.match(/_BOLL_(\d+)$/))!=null&&Jt[1]?parseInt(H.match(/_BOLL_(\d+)$/)[1],10):1;return he-Le});x(Ea,V(D.map(([W,H])=>{var he,Le,st,Jt,fs,ts,Bn;return{id:Br(),paneId:k,period:H.params&&H.params[0]||20,stdDev:H.params&&H.params[1]||2,styles:{fillColor:((he=H.bollingerStyles)==null?void 0:he.fillColor)||"#2196F3",fillOpacity:((Le=H.bollingerStyles)==null?void 0:Le.fillOpacity)??5,upperColor:((st=H.bollingerStyles)==null?void 0:st.upperColor)||"#f23645",middleColor:((Jt=H.bollingerStyles)==null?void 0:Jt.middleColor)||"#2962ff",lowerColor:((fs=H.bollingerStyles)==null?void 0:fs.lowerColor)||"#089981",thickness:((ts=H.bollingerStyles)==null?void 0:ts.thickness)||1,lineStyle:((Bn=H.bollingerStyles)==null?void 0:Bn.lineStyle)||"solid"}}})))}else x(Ea,V([{id:Br(),paneId:k,period:i(B)||20,stdDev:i($)||2,styles:{fillColor:i(w)||"#2196F3",fillOpacity:i(C)??5,upperColor:i(P)||"#f23645",middleColor:i(I)||"#2962ff",lowerColor:i(A)||"#089981",thickness:i(M)||1,lineStyle:i(F)||"solid"}}]));const j=i(Ea)[0];j&&(x(B,V(j.period)),x($,V(j.stdDev)),x(w,V(j.styles.fillColor)),x(C,V(j.styles.fillOpacity)),x(P,V(j.styles.upperColor)),x(I,V(j.styles.middleColor)),x(A,V(j.styles.lowerColor)),x(M,V(j.styles.thickness)),x(F,V(j.styles.lineStyle))),ro()}function am(){var j;if(!i(Ql)||!s())return;console.log("🔄 Applying AO changes in real-time, groups:",i(na).length);const k=Object.keys(r().saveInds).filter(D=>r().saveInds[D].name==="AO").sort((D,W)=>D===`${o().editPaneId}_AO`?-1:W===`${o().editPaneId}_AO`?1:D.localeCompare(W));console.log("🔍 Existing AO keys:",k);const N=i(na).length;if(k.length>N){console.log(`🗑️ Removing ${k.length-N} excess AO indicators`);for(let D=N;D<k.length;(D+=1)-1){const W=k[D],H=r().saveInds[W];if(H&&H.pane_id){console.log("🗑️ Removing AO indicator from pane:",H.pane_id);try{(j=s())==null||j.removeIndicator({paneId:H.pane_id,name:"AO"})}catch(he){console.log("Error removing excess AO indicator:",he)}}}}i(na).forEach((D,W)=>{var Le,st,Jt,fs,ts;const H=[D.shortPeriod,D.longPeriod],he={bars:[{upColor:D.styles.increasing.color,downColor:D.styles.decreasing.color,noChangeColor:((Le=D.styles.reverse)==null?void 0:Le.color)||"#c4c4c4",reverseColor:((st=D.styles.reverse)==null?void 0:st.color)||"#c4c4c4"}]};if(W===0)console.log("🔄 Updating first AO indicator in pane:",o().editPaneId),(Jt=s())==null||Jt.overrideIndicator({name:"AO",calcParams:H,styles:he,paneId:o().editPaneId});else{const Bn=`pane_AO_${W+1}_AO`,ti=k.find(ci=>ci===Bn);if(ti){const ci=r().saveInds[ti];ci&&ci.pane_id&&(console.log(`🔄 Updating existing AO ${W+1} in pane:`,ci.pane_id),(fs=s())==null||fs.overrideIndicator({name:"AO",calcParams:H,styles:he,paneId:ci.pane_id}))}else{const ci=`pane_AO_${W+1}`;console.log(`🆕 Creating new AO ${W+1} with pane ID:`,ci),(ts=s())==null||ts.createIndicator({name:"AO",calcParams:H,styles:he},!0,{id:ci})}}}),c.update(D=>(Object.keys(D.saveInds).forEach(W=>{D.saveInds[W].name==="AO"&&delete D.saveInds[W]}),i(na).forEach((W,H)=>{const he=H===0?`${o().editPaneId}_AO`:`pane_AO_${H+1}_AO`,Le=H===0?o().editPaneId:`pane_AO_${H+1}`;console.log(`💾 Saving AO group ${H+1} with key:`,he),D.saveInds[he]={name:"AO",aoGroup:W,pane_id:Le,groupIndex:H,aoGroups:H===0?[...i(na)]:void 0,params:[W.shortPeriod,W.longPeriod]}}),D))}function Um(k){!i(Ql)||i(na).length<=1||!i(na).find(j=>j.id===k)||(i(na).findIndex(j=>j.id===k),x(na,V(i(na).filter(j=>j.id!==k))),am())}function $f(){const k=`${o().editPaneId}_CR`,N=r().saveInds[k];N&&(x(vs,V(N.crPeriod||26)),x(Oo,V(N.crMa1Period||10)),x(Pi,V(N.crMa2Period||20)),x(no,V(N.crMa3Period||40)),x(gl,V(N.crMa4Period||60)),x(xa,V(N.crColor||"#FF6B35")),x(ic,V(N.crMa1Color||"#2196F3")),x(ec,V(N.crMa2Color||"#4CAF50")),x(Lf,V(N.crMa3Color||"#FF9800")),x(_e,V(N.crMa4Color||"#9C27B0")),x(We,V(N.crThickness||2)),x(xt,V(N.crMa1Thickness||1)),x(Ht,V(N.crMa2Thickness||1)),x(qt,V(N.crMa3Thickness||1)),x(ht,V(N.crMa4Thickness||1)),x(dn,V(N.crLineStyle||"solid")),x(Ut,V(N.crMa1LineStyle||"solid")),x(Xn,V(N.crMa2LineStyle||"solid")),x(rs,V(N.crMa3LineStyle||"solid")),x(_t,V(N.crMa4LineStyle||"solid")))}function wm(k,N){return j=>{x(Y,V(k)),x(ce,V(N)),x(O,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(L,!0)}}function lm(k){return N=>{x(ue,V(k)),x(le,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Q,!0)}}function yh(k,N){return j=>{x(Z,V(k)),x(xe,V(N)),x(pe,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(fe,!0)}}function Gm(k){return N=>{x(bt,V(k)),x(ut,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(ft,!0)}}function Vl(k,N){return j=>{x(Pa,V(k)),x(Yr,V(N)),x(hc,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(ya,!0)}}function km(k,N){return j=>{x(nt,k*3+N),x(qe,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Ke,!0)}}function Ym(k,N){return j=>{if(x(Ze,V(k)),x(Xe,V(N)),x(Ct,V({x:j.clientX,y:j.clientY})),x(Je,!0),i(Mt).length>k&&(N==="histogram"||N==="histogram-down")){const D=i(Mt)[k];N==="histogram"?D.styles.histogram.upColor=g(D.styles.histogram.upColor||"#26a69a",70):D.styles.histogram.downColor=g(D.styles.histogram.downColor||"#ef5350",70),Qt(k)}}}function cm(k){return N=>{if(x(Dt,V(k)),N.currentTarget&&N.currentTarget instanceof Element){const j=N.currentTarget.getBoundingClientRect();x(Qe,V({x:j.left+j.width/2,y:j.bottom+5}))}else x(Qe,V({x:window.innerWidth/2,y:window.innerHeight/2}));x(Ae,!0)}}function bh(k){return N=>{if(x(Dt,V(k)),N.currentTarget&&N.currentTarget instanceof Element){const j=N.currentTarget.getBoundingClientRect();x(Ft,V({x:j.left+j.width/2,y:j.bottom+5}))}else x(Ft,V({x:window.innerWidth/2,y:window.innerHeight/2}));x(gt,!0)}}function cv(k){return N=>{if(x(Dt,V(k)),N.currentTarget&&N.currentTarget instanceof Element){const j=N.currentTarget.getBoundingClientRect();x(ve,V({x:j.left+j.width/2,y:j.bottom+5}))}else x(ve,V({x:window.innerWidth/2,y:window.innerHeight/2}));x(ot,!0)}}function ig(k){return N=>{if(x(Dt,V(k)),N.currentTarget&&N.currentTarget instanceof Element){const j=N.currentTarget.getBoundingClientRect();x(It,V({x:j.left+j.width/2,y:j.bottom+5}))}else x(It,V({x:window.innerWidth/2,y:window.innerHeight/2}));x(Ie,!0)}}function Dp(k,N){return j=>{x(hn,V(k)),x(qn,V(N)),x(gn,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Zt,!0)}}function yv(k){return N=>{x(Fn,V(k)),x(bn,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(On,!0)}}function op(k){return N=>{x(Yn,V(k)),x(oo,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Xs,!0)}}function Xh(k){return N=>{x(Rt,V(k)),x(xs,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(_o,!0)}}function Zh(k){return N=>{x(Ia,V(k)),x(Eo,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(ri,!0)}}function Ev(k){return N=>{x(yr,V(k)),x(Qa,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Lr,!0)}}function kp(k){return N=>{x(Ll,V(k)),x(So,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(uf,!0)}}function bp(k){return N=>{x(nd,V(k)),x(jc,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Fl,!0)}}function $v(k){return N=>{x(tl,V(k)),x(pu,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(vl,!0)}}function rg(k){return N=>{x(Gu,V(k)),x(Oc,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Oa,!0)}}function Km(k,N=0){return j=>{x(mu,V(N)),x(El,V(k)),x(dc,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Fa,!0)}}function uv(k){return N=>{x(la,V(k)),x(nl,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(bc,!0)}}function Jh(k){return N=>{x(zc,V(k)),x(Yu,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Mu,!0)}}_p(l,k=>k.modalIndCfg).subscribe(()=>{if(!o().editIndName)return;if(i(sf)){lv();const j=k2.ICHIMOKU||[];d.splice(0,d.length,...j);return}if(i(Xf)){const D=`${o().editPaneId||"candle_pane"}_ZIGZAG`,W=Object.keys(r().saveInds).filter(he=>{var Le;return he.startsWith(D)&&((Le=r().saveInds[he])==null?void 0:Le.name)==="ZIGZAG"}).sort((he,Le)=>{const st=Jt=>{const fs=Jt.match(/_ZIGZAG(?:_(\d+))?$/);return fs&&fs[1]?parseInt(fs[1],10):1};return st(he)-st(Le)});x(In,V([])),W.length>0?W.forEach(he=>{var ts,Bn,ti,ci;const Le=r().saveInds[he],st=((Bn=(ts=Le==null?void 0:Le.styles)==null?void 0:ts.lines)==null?void 0:Bn[0])||{},Jt=Array.isArray(st.dashedValue)?st.dashedValue.join(","):"",fs=st.style===wt.Solid?"solid":Jt==="2,6"?"dotted":"dashed";i(In).push({id:Br(),deviation:Number(((ti=Le==null?void 0:Le.params)==null?void 0:ti[0])??5),depth:Number(((ci=Le==null?void 0:Le.params)==null?void 0:ci[1])??5),styles:{color:st.color??"#2962FF",thickness:Number(st.size??2),lineStyle:fs}})}):x(In,V([{id:Br(),deviation:5,depth:5,styles:{color:"#2962FF",thickness:2,lineStyle:"solid"}}]));const H=i(In)[0];u.splice(0,u.length,H.deviation,H.depth),x(sn,V(H.styles.color)),x(Un,V(H.styles.thickness)),x(Zs,V(H.styles.lineStyle));return}if(i(bf)){Bm();return}if(i(ad)){Zu();return}if(i(J)){Tv();return}if(i(Fe)){Fv();return}if(i(Hd)){sg();return}if(i(hu)){z0();return}if(i(Jc)){Ei();return}if(i(Tu)){$a();return}if(i(Xu)){Rl();return}if(i(we)){gc();return}if(i(Bd)){$u();return}if(i(jt)){$i();return}if(i(Mc)){ld();return}if(i(be)){mp();return}if(i(qd)){zm();return}if(i(Vf)){Jp();return}if(i(se)){Vm();return}if(i(re)){xm();return}if(i(Ql)){$p();return}if(i(be)){$f();return}if(i(Ku)){_h();return}const k=`${o().editPaneId}_${o().editIndName}`,N=r().saveInds[k];if(N&&N.fields&&!i(Ku))d.splice(0,d.length,...N.fields),u.splice(0,u.length,...N.params||[]),h.splice(0,h.length,...N.styles||[]);else{const j=k2[o().editIndName]||[];if(i(Ku)){d.splice(0,d.length,...j);const D=j.map(W=>W.default);u.splice(0,u.length,...D),N&&N.params&&N.params.length>=2&&(u[0]=N.params[0],u[1]=N.params[1])}else if(d.splice(0,d.length,...j),N&&N.params)u.splice(0,u.length,...N.params),h.splice(0,h.length,...N.styles||[]),(i(Wu)||i(Au))&&d.length>u.length&&d.splice(u.length,d.length-u.length);else{const D=j.filter(W=>W.type!=="color").map(W=>W.default);u.splice(0,u.length,...D)}}if(i(Tu)){for(;h.length<2;)h.length===0?h.push({color:"#2563eb",thickness:1,lineStyle:"solid"}):h.push({color:"#dc2626",thickness:1,lineStyle:"solid"});for(;h.length>2;)h.pop()}else{for(;h.length<u.length;)h.push({color:"#2563eb",thickness:1,lineStyle:"solid"});for(;h.length>u.length;)h.pop()}}),_p(l,k=>k.clearCciGroups).subscribe(k=>{k>0&&ur()}),_p(l,k=>k.clearEmvGroups).subscribe(k=>{k>0&&kr()}),_p(l,k=>k.clearMtmGroups).subscribe(k=>{k>0&&Lu()}),_p(l,k=>k.clearObvGroups).subscribe(k=>{k>0&&iu()}),_p(l,k=>k.clearPsyGroups).subscribe(k=>{k>0&&bd()}),_p(l,k=>k.clearPvtGroups).subscribe(k=>{k>0&&pc()}),_p(l,k=>k.clearRocGroups).subscribe(k=>{k>0&&Wf()}),_p(l,k=>k.clearVolGroups).subscribe(k=>{k>0&&Wc()}),_p(l,k=>k.clearWrGroups).subscribe(k=>{k>0&&Od()});function sc(k){i(Ku)||u.length<=1||(u.splice(k,1),d.splice(k,1),h.splice(k,1),i(Wu)?Vn():i(Au)&&_n())}function ru(){const k=s();if(!k)return;const N=[6],j=k.createIndicator({name:"BIAS",calcParams:N,createTooltipDataSource:({indicator:he})=>{const Le=[he.visible?1:0,2,3],st=k.getStyles().indicator.tooltip;return{icons:Le.map(fs=>st.features[fs])}}},!1,{axis:{gap:{bottom:2}}});if(!j)return;const D=j,W={name:"BIAS",pane_id:D,params:N},H=`${D}_BIAS`;c.update(he=>(he.saveInds[H]=W,he)),a(!1)}function eu(){const k=s();if(!k)return;const N=[5,34],j=k.createIndicator({name:"AO",calcParams:N,createTooltipDataSource:({indicator:he})=>{const Le=[he.visible?1:0,2,3],st=k.getStyles().indicator.tooltip;return{icons:Le.map(fs=>st.features[fs])}}},!1,{axis:{gap:{bottom:2}}});if(j){const he=k.getStyles();k.setStyles({...he,indicator:{...he.indicator,bars:[{upColor:"#8B5CF6",downColor:"#EF4444",noChangeColor:"#8B5CF6"}]}})}if(!j)return;const D=j,W={name:"AO",pane_id:D,params:N},H=`${D}_AO`;c.update(he=>(he.saveInds[H]=W,he)),a(!1)}function Dh(){const k=s();if(!k)return;const N=[14],j=k.createIndicator({name:"WR",calcParams:N,createTooltipDataSource:({indicator:he})=>{const Le=[he.visible?1:0,2,3],st=k.getStyles().indicator.tooltip;return{icons:Le.map(fs=>st.features[fs])}}},!1,{axis:{gap:{bottom:2}}});if(!j)return;const D=j,W={name:"WR",pane_id:D,params:N},H=`${D}_WR`;c.update(he=>(he.saveInds[H]=W,he)),a(!1)}function Xm(){const k=s();if(!k)return;const N=[15,9],j=k.createIndicator({name:"TRIX",calcParams:N,createTooltipDataSource:({indicator:he})=>{const Le=[he.visible?1:0,2,3],st=k.getStyles().indicator.tooltip;return{icons:Le.map(fs=>st.features[fs])}}},!1,{axis:{gap:{bottom:2}}});if(!j)return;const D=j,W={name:"TRIX",pane_id:D,params:N},H=`${D}_TRIX`;c.update(he=>(he.saveInds[H]=W,he)),a(!1)}function jv(){var j;if(!i(be))return;const k=Object.keys(r().saveInds).filter(D=>r().saveInds[D].name==="CR").sort((D,W)=>D===`${o().editPaneId}_CR`?-1:W===`${o().editPaneId}_CR`?1:D.localeCompare(W));console.log("🔧 Applying CR changes. Existing keys:",k),console.log("🔧 Current CR groups:",i(br).length);const N=i(br).length;if(k.length>N)for(let D=N;D<k.length;(D+=1)-1){const W=k[D],H=r().saveInds[W];try{console.log("🗑️ Removing excess CR indicator from pane:",H.pane_id),(j=s())==null||j.removeIndicator({paneId:H.pane_id,name:"CR"})}catch(he){console.log("❌ Error removing excess CR indicator:",he)}delete r().saveInds[W]}i(br).forEach((D,W)=>{var Le,st,Jt;const H=[D.crPeriod,D.crMa1Period,D.crMa2Period,D.crMa3Period,D.crMa4Period],he={lines:[{color:D.styles.cr.color,size:D.styles.cr.thickness,style:D.styles.cr.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:D.styles.cr.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:D.styles.ma1.color,size:D.styles.ma1.thickness,style:D.styles.ma1.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:D.styles.ma1.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:D.styles.ma2.color,size:D.styles.ma2.thickness,style:D.styles.ma2.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:D.styles.ma2.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:D.styles.ma3.color,size:D.styles.ma3.thickness,style:D.styles.ma3.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:D.styles.ma3.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:D.styles.ma4.color,size:D.styles.ma4.thickness,style:D.styles.ma4.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:D.styles.ma4.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};if(W===0)console.log("🔄 Updating first CR in pane:",o().editPaneId),(Le=s())==null||Le.overrideIndicator({name:"CR",calcParams:H,styles:he,paneId:o().editPaneId});else{const fs=`pane_CR_${W+1}_CR`,ts=k.find(Bn=>Bn===fs);if(ts){const Bn=r().saveInds[ts];console.log("🔄 Updating existing CR in pane:",Bn.pane_id),(st=s())==null||st.overrideIndicator({name:"CR",calcParams:H,styles:he,paneId:Bn.pane_id})}else{const Bn=`pane_CR_${W+1}`;console.log("🆕 Creating new CR in pane:",Bn);const ti=(Jt=s())==null?void 0:Jt.createIndicator({name:"CR",calcParams:H,styles:he},!0,{id:Bn});console.log("✅ Created new CR indicator with ID:",ti,"in pane:",Bn)}}}),c.update(D=>(Object.keys(D.saveInds).forEach(W=>{D.saveInds[W].name==="CR"&&delete D.saveInds[W]}),i(br).forEach((W,H)=>{const he=H===0?`${o().editPaneId}_CR`:`pane_CR_${H+1}_CR`,Le=H===0?o().editPaneId:`pane_CR_${H+1}`,st={name:"CR",crGroup:W,pane_id:Le,groupIndex:H,crGroups:H===0?[...i(br)]:void 0,params:[W.crPeriod,W.crMa1Period,W.crMa2Period,W.crMa3Period,W.crMa4Period]};D.saveInds[he]=st,console.log("💾 Saved CR group",H,"with key:",he,"and pane ID:",Le)}),D)),l.update(D=>(D.editIndName="",D.editPaneId="",D.modalIndCfg=!1,D)),a(!1)}function Bv(){i(Xl).forEach((k,N)=>{Gh(N)}),c.update(k=>(Object.keys(k.saveInds).forEach(N=>{k.saveInds[N].name==="MACD"&&delete k.saveInds[N]}),i(Xl).forEach((N,j)=>{const D=j===0?`${o().editPaneId}_MACD`:`pane_MACD_${j+1}_MACD`,W=j===0?o().editPaneId:N.actualPaneId||`pane_MACD_${j+1}`;k.saveInds[D]={name:"MACD",macdGroup:N,pane_id:W,groupIndex:j,params:[N.fastPeriod,N.slowPeriod,N.signalPeriod]}}),k)),console.log("🔄 Clearing edit state and closing popup..."),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,console.log("✅ Context updated - modalIndCfg set to false"),k)),a(!1)}function ip(){if(i(Hd)){i(rc).forEach((k,N)=>{k.paneId&&np(N)}),c.update(k=>{const N=`${o().editPaneId}_WR`,j={name:"WR",wrGroups:i(rc),pane_id:o().editPaneId};return k.saveInds[N]=j,i(rc).forEach((D,W)=>{const H=W===0?`${o().editPaneId}_WR_single`:`WR_${W+1}`,he={name:"WR",wrGroup:D,pane_id:W===0?o().editPaneId:`new_pane_${W}`,groupIndex:W};k.saveInds[H]=he}),k});try{console.log("🔄 Clearing edit state and closing popup..."),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,console.log("✅ Context updated - modalIndCfg set to false"),k)),a(!1),console.log("✅ Popup show flag set to false - handleKdjConfirm completed successfully")}catch(k){console.error("❌ Error in handleKdjConfirm:",k),console.log("🔄 Forcing popup close due to error..."),l.update(N=>(N.editIndName="",N.editPaneId="",N.modalIndCfg=!1,N)),a(!1),console.log("✅ Popup forcefully closed after error")}}}function um(){i(hu)&&(i(Qc).forEach((k,N)=>{var W;const j=[k.period,k.shortPeriod,k.longPeriod],D={lines:[{color:k.styles.vr.color,size:k.styles.vr.thickness,style:k.styles.vr.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:k.styles.vr.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:k.styles.vrShort.color,size:k.styles.vrShort.thickness,style:k.styles.vrShort.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:k.styles.vrShort.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:k.styles.vrLong.color,size:k.styles.vrLong.thickness,style:k.styles.vrLong.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:k.styles.vrLong.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};k.paneId&&((W=s())==null||W.overrideIndicator({name:"VR",calcParams:j,styles:D,paneId:k.paneId}),console.log(`✅ Updated VR indicator in pane: ${k.paneId}`))}),c.update(k=>(i(Qc).forEach((N,j)=>{const D=`${N.paneId}_VR`,W={name:"VR",vrGroup:N,pane_id:N.paneId,params:[N.period,N.shortPeriod,N.longPeriod],groupIndex:j};k.saveInds[D]=W,console.log(`💾 Saved VR group to: ${D}`)}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function dv(){i(yd)&&(i(Mt).forEach((k,N)=>{var W;const j=[k.period],D={bars:[{upColor:k.styles.histogram.upColor,downColor:k.styles.histogram.downColor,noChangeColor:k.styles.histogram.upColor}],lines:[{color:k.styles.ema.color,size:k.styles.ema.thickness,style:k.styles.ema.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:k.styles.ema.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1,visible:k.styles.ema.visible===!0}]};k.paneId&&((W=s())==null||W.overrideIndicator({name:"VOL",calcParams:j,styles:D,paneId:k.paneId}),console.log(`✅ Updated Volume indicator in pane: ${k.paneId}`))}),c.update(k=>(i(Mt).forEach((N,j)=>{const D=`${N.paneId}_VOL`,W={name:"VOL",volGroup:N,pane_id:N.paneId,params:[N.period],groupIndex:j};k.saveInds[D]=W,console.log(`💾 Saved Volume group to: ${D}`)}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function Zm(){i(Jc)&&(console.log("🔧 Applying BBI changes. Current BBI groups:",i(Nc).length),i(Nc).forEach((k,N)=>{var Le;const j=[k.period1,k.period2,k.period3,k.period4],W=(st=>{switch(st){case"dashed":return{style:wt.Dashed,dashedValue:[4,4]};case"dotted":return{style:wt.Dashed,dashedValue:[2,2]};default:return{style:wt.Solid,dashedValue:[2,2]}}})(k.lineStyle),H={lines:[{color:k.color,size:k.thickness,style:W.style,dashedValue:W.dashedValue,smooth:!1}]},he=k.paneId||(N===0?o().editPaneId:`pane_BBI_${N+1}`);console.log("🔄 Updating BBI group",N,"in pane:",he),(Le=s())==null||Le.overrideIndicator({name:"BBI",calcParams:j,styles:H,paneId:he}),k.paneId||(k.paneId=he)}),c.update(k=>(Object.keys(k.saveInds).forEach(N=>{k.saveInds[N].name==="BBI"&&delete k.saveInds[N]}),i(Nc).forEach((N,j)=>{const D=`${N.paneId}_BBI`,W={name:"BBI",bbiGroup:N,pane_id:N.paneId,groupIndex:j,bbiGroups:j===0?[...i(Nc)]:void 0,params:[N.period1,N.period2,N.period3,N.period4]};k.saveInds[D]=W,console.log("💾 Saved BBI group",j,"with key:",D,"and pane ID:",N.paneId)}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function Rh(){var k;if(!i(J)){console.warn("⚠️ handleEmvConfirm called but not in EMV mode");return}try{if(!i(Pr)||i(Pr).length===0){console.error("❌ No EMV groups to process");return}const N=i(Pr).filter(W=>!(!W||typeof W!="object"||typeof W.period!="number"||W.period<=0||typeof W.period2!="number"||W.period2<=0||typeof W.color!="string"||!W.color||typeof W.thickness!="number"||W.thickness<=0||typeof W.lineStyle!="string"||!W.lineStyle));if(N.length===0){console.error("❌ No valid EMV groups found");return}N.length!==i(Pr).length&&(console.warn(`⚠️ ${i(Pr).length-N.length} invalid EMV groups filtered out`),x(Pr,V(N)));const j=Object.keys(r().saveInds).filter(W=>r().saveInds[W]&&r().saveInds[W].name==="EMV").sort((W,H)=>W===`${o().editPaneId}_EMV`?-1:H===`${o().editPaneId}_EMV`?1:W.localeCompare(H));console.log("🔧 Applying EMV changes. Existing keys:",j),console.log("🔧 Current EMV groups:",i(Pr).length);const D=i(Pr).length;if(j.length>D)for(let W=D;W<j.length;(W+=1)-1){const H=j[W],he=r().saveInds[H];if(he&&he.pane_id)try{console.log("🗑️ Removing excess EMV indicator from pane:",he.pane_id),(k=s())==null||k.removeIndicator({paneId:he.pane_id,name:"EMV"})}catch(Le){console.log("❌ Error removing excess EMV indicator:",Le)}}i(Pr).forEach((W,H)=>{var st,Jt,fs;const he=[W.period,W.period2],Le={lines:[{color:W.color,size:W.thickness,style:W.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:W.lineStyle==="dashed"?[4,4]:W.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(H===0)console.log("🔄 Updating first EMV in pane:",o().editPaneId),(st=s())==null||st.overrideIndicator({name:"EMV",calcParams:he,styles:Le,paneId:o().editPaneId});else{const ts=`pane_EMV_${H+1}_EMV`,Bn=j.find(ti=>ti===ts);if(Bn){const ti=r().saveInds[Bn];ti&&ti.pane_id&&(console.log("🔄 Updating existing EMV in pane:",ti.pane_id),(Jt=s())==null||Jt.overrideIndicator({name:"EMV",calcParams:he,styles:Le,paneId:ti.pane_id}))}else{const ti=`pane_EMV_${H+1}`;console.log("🆕 Creating new EMV in pane:",ti);const ci=(fs=s())==null?void 0:fs.createIndicator({name:"EMV",calcParams:he,styles:Le},!0,{id:ti});ci&&console.log("✅ Created new EMV indicator with ID:",ci,"in pane:",ti)}}}),c.update(W=>{try{Object.keys(W.saveInds).forEach(H=>{W.saveInds[H]&&W.saveInds[H].name==="EMV"&&delete W.saveInds[H]}),i(Pr).forEach((H,he)=>{try{const Le=he===0?`${o().editPaneId}_EMV`:`pane_EMV_${he+1}_EMV`,st=he===0?o().editPaneId:`pane_EMV_${he+1}`;if(!Le||!st){console.error(`❌ Invalid save key or pane ID for EMV group ${he}`);return}const Jt={name:"EMV",emvGroup:H,pane_id:st,groupIndex:he,emvGroups:he===0?[...i(Pr)]:void 0,params:[H.period,H.period2]};W.saveInds[Le]=Jt,console.log("💾 Saved EMV group",he,"with key:",Le,"and pane ID:",st)}catch(Le){console.error(`❌ Error saving EMV group ${he}:`,Le)}})}catch(H){console.error("❌ Error in EMV save operation:",H)}return W}),l.update(W=>(W.editIndName="",W.editPaneId="",W.modalIndCfg=!1,W)),a(!1),console.log("✅ EMV configuration completed successfully")}catch(N){console.error("❌ Critical error in handleEmvConfirm:",N)}}function Cm(){var k;if(!i(Fe)){console.warn("⚠️ handleMtmConfirm called but not in MTM mode");return}try{if(!i(Sr)||i(Sr).length===0){console.error("❌ No MTM groups to process");return}const N=i(Sr).filter(W=>!(!W||typeof W!="object"||typeof W.period!="number"||W.period<=0||typeof W.color!="string"||!W.color||typeof W.thickness!="number"||W.thickness<=0||typeof W.lineStyle!="string"||!W.lineStyle));if(N.length===0){console.error("❌ No valid MTM groups found");return}N.length!==i(Sr).length&&(console.warn(`⚠️ ${i(Sr).length-N.length} invalid MTM groups filtered out`),x(Sr,V(N)));const j=Object.keys(r().saveInds).filter(W=>r().saveInds[W]&&r().saveInds[W].name==="MTM").sort((W,H)=>W===`${o().editPaneId}_MTM`?-1:H===`${o().editPaneId}_MTM`?1:W.localeCompare(H));console.log("🔧 Applying MTM changes. Existing keys:",j),console.log("🔧 Current MTM groups:",i(Sr).length);const D=i(Sr).length;if(j.length>D)for(let W=D;W<j.length;(W+=1)-1){const H=j[W],he=r().saveInds[H];if(he&&he.pane_id)try{console.log("🗑️ Removing excess MTM indicator from pane:",he.pane_id),(k=s())==null||k.removeIndicator({paneId:he.pane_id,name:"MTM"})}catch(Le){console.log("❌ Error removing excess MTM indicator:",Le)}}i(Sr).forEach((W,H)=>{var st,Jt,fs;const he=[W.period],Le={lines:[{color:W.color,size:W.thickness,style:W.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:W.lineStyle==="dashed"?[4,4]:W.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(H===0)console.log("🔄 Updating first MTM in pane:",o().editPaneId),(st=s())==null||st.overrideIndicator({name:"MTM",calcParams:he,styles:Le,paneId:o().editPaneId});else{const ts=`pane_MTM_${H+1}_MTM`,Bn=j.find(ti=>ti===ts);if(Bn){const ti=r().saveInds[Bn];ti&&ti.pane_id&&(console.log("🔄 Updating existing MTM in pane:",ti.pane_id),(Jt=s())==null||Jt.overrideIndicator({name:"MTM",calcParams:he,styles:Le,paneId:ti.pane_id}))}else{const ti=`pane_MTM_${H+1}`;console.log("🆕 Creating new MTM in pane:",ti);const ci=(fs=s())==null?void 0:fs.createIndicator({name:"MTM",calcParams:he,styles:Le},!0,{id:ti});ci&&console.log("✅ Created new MTM indicator with ID:",ci,"in pane:",ti)}}}),c.update(W=>{try{Object.keys(W.saveInds).forEach(H=>{W.saveInds[H]&&W.saveInds[H].name==="MTM"&&delete W.saveInds[H]}),i(Sr).forEach((H,he)=>{try{const Le=he===0?`${o().editPaneId}_MTM`:`pane_MTM_${he+1}_MTM`,st=he===0?o().editPaneId:`pane_MTM_${he+1}`;if(!Le||!st){console.error(`❌ Invalid save key or pane ID for MTM group ${he}`);return}const Jt={name:"MTM",mtmGroup:H,pane_id:st,groupIndex:he,mtmGroups:he===0?[...i(Sr)]:void 0,params:[H.period]};W.saveInds[Le]=Jt,console.log("💾 Saved MTM group",he,"with key:",Le,"and pane ID:",st)}catch(Le){console.error(`❌ Error saving MTM group ${he}:`,Le)}})}catch(H){console.error("❌ Error in MTM save operation:",H)}return W}),l.update(W=>(W.editIndName="",W.editPaneId="",W.modalIndCfg=!1,W)),a(!1),console.log("✅ MTM configuration completed successfully")}catch(N){console.error("❌ Critical error in handleMtmConfirm:",N)}}function Ov(){var j;if(!i(Xu))return;const k=Object.keys(r().saveInds).filter(D=>r().saveInds[D].name==="BIAS").sort((D,W)=>D===`${o().editPaneId}_BIAS`?-1:W===`${o().editPaneId}_BIAS`?1:D.localeCompare(W));console.log("🔧 Applying BIAS changes. Existing keys:",k),console.log("🔧 Current BIAS groups:",i(io).length);const N=i(io).length;if(k.length>N)for(let D=N;D<k.length;(D+=1)-1){const W=k[D],H=r().saveInds[W];if(H&&H.pane_id)try{console.log("🗑️ Removing excess BIAS indicator from pane:",H.pane_id),(j=s())==null||j.removeIndicator({paneId:H.pane_id,name:"BIAS"})}catch(he){console.log("❌ Error removing excess BIAS indicator:",he)}}i(io).forEach((D,W)=>{var Le,st,Jt;const H=[D.period],he={lines:[{color:D.color,size:D.thickness,style:D.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:D.lineStyle==="dashed"?[4,4]:D.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(W===0)console.log("🔄 Updating first BIAS in pane:",o().editPaneId),(Le=s())==null||Le.overrideIndicator({name:"BIAS",calcParams:H,styles:he,paneId:o().editPaneId});else{const fs=`pane_BIAS_${W+1}_BIAS`,ts=k.find(Bn=>Bn===fs);if(ts){const Bn=r().saveInds[ts];Bn&&Bn.pane_id&&(console.log("🔄 Updating existing BIAS in pane:",Bn.pane_id),(st=s())==null||st.overrideIndicator({name:"BIAS",calcParams:H,styles:he,paneId:Bn.pane_id}))}else{const Bn=`pane_BIAS_${W+1}`;console.log("🆕 Creating new BIAS in pane:",Bn);const ti=(Jt=s())==null?void 0:Jt.createIndicator({name:"BIAS",calcParams:H,styles:he},!0,{id:Bn});ti&&console.log("✅ Created new BIAS indicator with ID:",ti,"in pane:",Bn)}}}),c.update(D=>(Object.keys(D.saveInds).forEach(W=>{D.saveInds[W].name==="BIAS"&&delete D.saveInds[W]}),i(io).forEach((W,H)=>{const he=H===0?`${o().editPaneId}_BIAS`:`pane_BIAS_${H+1}_BIAS`,Le=H===0?o().editPaneId:`pane_BIAS_${H+1}`,st={name:"BIAS",biasGroup:W,pane_id:Le,groupIndex:H,biasGroups:H===0?[...i(io)]:void 0,params:[W.period]};D.saveInds[he]=st,console.log("💾 Saved BIAS group",H,"with key:",he,"and pane ID:",Le)}),D)),l.update(D=>(D.editIndName="",D.editPaneId="",D.modalIndCfg=!1,D)),a(!1),console.log("✅ BIAS configuration saved successfully")}function jh(){if(!i(we))return;const k=Object.keys(r().saveInds).filter(H=>r().saveInds[H].name==="CCI").sort((H,he)=>H===`${o().editPaneId}_CCI`?-1:he===`${o().editPaneId}_CCI`?1:H.localeCompare(he));console.log("🔧 Applying CCI changes. Existing keys:",k),console.log("🔧 Current CCI groups:",i(ko).length);const N=new Map,j=[],D=new Set;i(ko).forEach((H,he)=>{let Le=null;for(const st of k){if(D.has(st))continue;const Jt=r().saveInds[st];if(Jt&&Jt.cciGroup&&(Jt.cciGroup.id===H.id||Jt.cciGroup.period===H.period&&Jt.cciGroup.color===H.color&&Jt.cciGroup.thickness===H.thickness&&Jt.cciGroup.lineStyle===H.lineStyle)){Le=st,D.add(st);break}}if(!Le){let st=he+1,Jt;do Jt=st===1?`${o().editPaneId}_CCI`:`pane_CCI_${st}_CCI`,st+=1;while(D.has(Jt)||k.includes(Jt));Le=Jt,D.add(Le)}N.set(H.id,Le),j.push(Le)});const W=k.filter(H=>!j.includes(H));W.forEach(H=>{var Le;const he=r().saveInds[H];if(he&&he.pane_id)try{console.log("🗑️ Removing CCI indicator from pane:",he.pane_id,"key:",H),(Le=s())==null||Le.removeIndicator({paneId:he.pane_id,name:"CCI"})}catch(st){console.log("❌ Error removing CCI indicator:",st)}}),i(ko).forEach((H,he)=>{var ts,Bn;const Le=[H.period],st={lines:[{color:H.color,size:H.thickness,style:H.lineStyle==="solid"?wt.Solid:wt.Dashed,dashedValue:H.lineStyle==="dashed"?[4,4]:H.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},Jt=N.get(H.id),fs=r().saveInds[Jt];if(fs&&fs.pane_id)console.log("🔄 Updating existing CCI in pane:",fs.pane_id,"with key:",Jt),(ts=s())==null||ts.overrideIndicator({name:"CCI",calcParams:Le,styles:st,paneId:fs.pane_id});else{const ti=Jt===`${o().editPaneId}_CCI`?o().editPaneId:Jt.replace("_CCI","");console.log("🆕 Creating new CCI in pane:",ti,"with key:",Jt);const ci=(Bn=s())==null?void 0:Bn.createIndicator({name:"CCI",calcParams:Le,styles:st},!0,{id:ti});ci&&console.log("✅ Created new CCI indicator with ID:",ci,"in pane:",ti)}}),c.update(H=>(W.forEach(he=>{delete H.saveInds[he],console.log("🗑️ Deleted save data for key:",he)}),i(ko).forEach((he,Le)=>{const st=N.get(he.id),Jt=st===`${o().editPaneId}_CCI`?o().editPaneId:st.replace("_CCI",""),fs={name:"CCI",cciGroup:he,pane_id:Jt,groupIndex:Le,cciGroups:Le===0?[...i(ko)]:void 0,params:[he.period]};H.saveInds[st]=fs,console.log("💾 Saved CCI group",Le,"with key:",st,"and pane ID:",Jt)}),H)),l.update(H=>(H.editIndName="",H.editPaneId="",H.modalIndCfg=!1,H)),a(!1),console.log("✅ CCI configuration saved successfully")}function zv(){i(Bd)&&(Mo(),c.update(k=>(Object.keys(k.saveInds).forEach(N=>{k.saveInds[N].name==="SAR"&&delete k.saveInds[N]}),i(Hl).forEach((N,j)=>{const D=j===0?"candle_pane_SAR":`SAR_${j+1}`,W={name:"SAR",sarGroup:N,pane_id:"candle_pane",groupIndex:j,sarGroups:j===0?[...i(Hl)]:void 0,params:[N.start,N.increment,N.maxValue]};k.saveInds[D]=W}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function wv(){i(jt)&&(Hu(),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function xh(){var j;if(!i(Mc))return;const k=Object.keys(r().saveInds).filter(D=>r().saveInds[D].name==="DMI").sort((D,W)=>D===`${o().editPaneId}_DMI`?-1:W===`${o().editPaneId}_DMI`?1:D.localeCompare(W));console.log("🔧 Applying DMI changes. Existing keys:",k),console.log("🔧 Current DMI groups:",i(ol).length);const N=i(ol).length;if(k.length>N)for(let D=N;D<k.length;(D+=1)-1){const W=k[D],H=r().saveInds[W];try{console.log("🗑️ Removing excess DMI indicator from pane:",H.pane_id),(j=s())==null||j.removeIndicator({paneId:H.pane_id,name:"DMI"})}catch(he){console.log("❌ Error removing excess DMI indicator:",he)}delete r().saveInds[W]}i(ol).forEach((D,W)=>{var Le,st,Jt;const H=[D.diPeriod,D.adxPeriod],he={lines:[{color:D.styles.diPlus.color,size:D.styles.diPlus.thickness,style:D.styles.diPlus.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:D.styles.diPlus.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:D.styles.diMinus.color,size:D.styles.diMinus.thickness,style:D.styles.diMinus.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:D.styles.diMinus.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:D.styles.adx.color,size:D.styles.adx.thickness,style:D.styles.adx.lineStyle==="dashed"?wt.Dashed:wt.Solid,dashedValue:D.styles.adx.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};if(W===0)console.log("🔄 Updating first DMI in pane:",o().editPaneId),(Le=s())==null||Le.overrideIndicator({name:"DMI",calcParams:H,styles:he,paneId:o().editPaneId});else{const fs=`pane_DMI_${W+1}_DMI`,ts=k.find(Bn=>Bn===fs);if(ts){const Bn=r().saveInds[ts];console.log("🔄 Updating existing DMI in pane:",Bn.pane_id),(st=s())==null||st.overrideIndicator({name:"DMI",calcParams:H,styles:he,paneId:Bn.pane_id})}else{const Bn=`pane_DMI_${W+1}`;console.log("🆕 Creating new DMI in pane:",Bn);const ti=(Jt=s())==null?void 0:Jt.createIndicator({name:"DMI",calcParams:H,styles:he},!0,{id:Bn});console.log("✅ Created new DMI indicator with ID:",ti,"in pane:",Bn)}}}),c.update(D=>(Object.keys(D.saveInds).forEach(W=>{D.saveInds[W].name==="DMI"&&delete D.saveInds[W]}),i(ol).forEach((W,H)=>{const he=H===0?`${o().editPaneId}_DMI`:`pane_DMI_${H+1}_DMI`,Le=H===0?o().editPaneId:`pane_DMI_${H+1}`,st={name:"DMI",dmiGroup:W,pane_id:Le,groupIndex:H,dmiGroups:H===0?[...i(ol)]:void 0,params:[W.diPeriod,W.adxPeriod]};D.saveInds[he]=st,console.log("💾 Saved DMI group",H,"with key:",he,"and pane ID:",Le)}),D)),l.update(D=>(D.editIndName="",D.editPaneId="",D.modalIndCfg=!1,D)),a(!1)}function Im(k){var he,Le;const N=i(Or)[k];if(!N||!s()){console.warn("❌ updatePvtIndicator: Missing group or chart",{group:N,chart:!!s()});return}console.log("🔄 updatePvtIndicator called:",{groupIndex:k,group:N});let j=wt.Solid,D=[2,2];N.lineStyle==="dashed"?(j=wt.Dashed,D=[4,4]):N.lineStyle==="dotted"&&(j=wt.Dashed,D=[2,2]);const H=((he=s())==null?void 0:he.getIndicators()).filter(st=>st.name==="PVT");if(console.log("📊 Found PVT indicators on chart:",H.length),console.log("📊 Looking for group index:",k),H.length>k){const st=H[k];console.log("✅ Found matching PVT indicator by index, updating styles...");const Jt=(Le=s())==null?void 0:Le.overrideIndicator({name:"PVT",paneId:st.paneId,styles:{lines:[{color:N.color,size:N.thickness,style:j,dashedValue:D,smooth:!1}]},figures:[{key:"pvt",title:"PVT: ",type:"line"}]});console.log("🎨 overrideIndicator result:",Jt),console.log("🎨 Applied styles:",{color:N.color,size:N.thickness,style:j,dashedValue:D});const fs=`${st.paneId}_PVT`;console.log("💾 Using save key:",fs),c.update(ts=>{ts.saveInds[fs]||(ts.saveInds[fs]={name:"PVT",pane_id:st.paneId,pvtGroups:[]}),ts.saveInds[fs].pvtGroups||(ts.saveInds[fs].pvtGroups=[]);const Bn=ts.saveInds[fs].pvtGroups||[];for(;Bn.length<=k;)Bn.push({});return Bn[k]={...N},ts.saveInds[fs].pvtGroups=Bn,console.log("💾 Persisted PVT changes to save data:",fs,N),ts}),console.log("✅ PVT indicator updated successfully:",k,N)}else console.error("❌ PVT indicator not found on chart for group index:",k),console.log("📊 Available PVT indicators:",H.length),console.log("📊 Requested group index:",k)}function Qh(k){if(!i(Tu)||!s()||k<0||k>=i(Ac).length)return;const N=i(Ac)[k];console.log("🔄 Updating TRIX indicator:",k,N);try{let D=function(Le){let st=wt.Solid,Jt=[2,2];return Le==="dashed"?(st=wt.Dashed,Jt=[4,4]):Le==="dotted"&&(st=wt.Dashed,Jt=[2,2]),{lineStyle:st,dashedValue:Jt}},j=N.paneId||o().editPaneId;console.log("🔍 Using pane ID for TRIX update:",j,"for group:",k),s().removeIndicator({paneId:j,name:"TRIX"});const W=D(N.styles.trix.lineStyle),H=D(N.styles.signal.lineStyle);if(s().createIndicator({name:"TRIX",calcParams:[N.trixPeriod,N.signalPeriod],styles:{lines:[{color:N.styles.trix.color,size:N.styles.trix.thickness,style:W.lineStyle,dashedValue:W.dashedValue},{color:N.styles.signal.color,size:N.styles.signal.thickness,style:H.lineStyle,dashedValue:H.dashedValue}]}},j===o().editPaneId,{id:j})){const Le=`${j}_TRIX`;c.update(st=>(st.saveInds[Le]?st.saveInds[Le].params=[N.trixPeriod,N.signalPeriod]:st.saveInds[Le]={name:"TRIX",pane_id:j,params:[N.trixPeriod,N.signalPeriod]},st.saveInds[Le].trixGroup={...N},st))}console.log("✅ TRIX indicator updated successfully:",k)}catch(j){console.error("❌ Error updating TRIX indicator:",j)}}function cg(){var j;if(!i(qd)||!s())return;const N=((j=s())==null?void 0:j.getIndicators()).filter(D=>D.name==="ROC");console.log("📊 Found ROC indicators on chart:",N.length),console.log("📊 ROC groups to apply:",i(fa).length),i(fa).forEach((D,W)=>{var Jt,fs;const H=[D.period];let he=wt.Solid,Le=[2,2];D.styles.roc.lineStyle==="dashed"?(he=wt.Dashed,Le=[4,4]):D.styles.roc.lineStyle==="dotted"&&(he=wt.Dashed,Le=[2,2]);const st=N[W];if(st){console.log(`🎨 Updating existing ROC indicator ${W} in pane:`,st.paneId);const ts=(Jt=s())==null?void 0:Jt.overrideIndicator({name:"ROC",paneId:st.paneId,calcParams:H,styles:{lines:[{color:D.styles.roc.color,size:D.styles.roc.thickness,style:he,dashedValue:Le,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]});console.log("🎨 overrideIndicator result:",ts);const Bn=`${st.paneId}_ROC`;c.update(ti=>{ti.saveInds[Bn]||(ti.saveInds[Bn]={name:"ROC",pane_id:st.paneId,params:H,rocGroups:[]}),ti.saveInds[Bn].rocGroups||(ti.saveInds[Bn].rocGroups=[]);const ci=ti.saveInds[Bn].rocGroups||[];for(;ci.length<=W;)ci.push({});return ci[W]={...D},ti.saveInds[Bn].rocGroups=ci,ti.saveInds[Bn].params=H,console.log("💾 Persisted ROC changes to save data:",Bn,D),ti}),console.log("✅ ROC indicator updated successfully:",W,D)}else{console.log(`➕ Creating new ROC indicator for group ${W}`);const ts={name:"ROC",calcParams:H,styles:{lines:[{color:D.styles.roc.color,size:D.styles.roc.thickness,style:he,dashedValue:Le,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]};(fs=s())==null||fs.createIndicator(ts,!1,{axis:{gap:{bottom:2}}})}}),l.update(D=>(D.editIndName="",D.editPaneId="",D.modalIndCfg=!1,D)),a(!1)}function ug(){var j;if(!i(Vf))return;const k=Object.keys(r().saveInds).filter(D=>r().saveInds[D].name==="PSY").sort((D,W)=>D===`${o().editPaneId}_PSY`?-1:W===`${o().editPaneId}_PSY`?1:D.localeCompare(W)),N=i(Xr).length;if(k.length>N)for(let D=N;D<k.length;(D+=1)-1){const W=k[D],H=r().saveInds[W];if(H&&H.pane_id)try{(j=s())==null||j.removeIndicator({paneId:H.pane_id,name:"PSY"})}catch(he){console.log("Error removing excess PSY indicator:",he)}}i(Xr).forEach((D,W)=>{var ts,Bn,ti;const H=[D.psyPeriod,D.mapsyPeriod],he=[{key:"psy",title:"PSY: ",type:"line"}];D.showMapsy&&he.push({key:"mapsy",title:"MAPSY: ",type:"line"});const Le={lines:[]};let st=wt.Solid,Jt=[2,2];if(D.styles.psy.lineStyle==="dashed"?(st=wt.Dashed,Jt=[4,4]):D.styles.psy.lineStyle==="dotted"&&(st=wt.Dashed,Jt=[2,2]),Le.lines.push({color:D.styles.psy.color,size:D.styles.psy.thickness,style:st,dashedValue:Jt,smooth:!1}),D.showMapsy){let ci=wt.Solid,lu=[2,2];D.styles.mapsy.lineStyle==="dashed"?(ci=wt.Dashed,lu=[4,4]):D.styles.mapsy.lineStyle==="dotted"&&(ci=wt.Dashed,lu=[2,2]),Le.lines.push({color:D.styles.mapsy.color,size:D.styles.mapsy.thickness,style:ci,dashedValue:lu,smooth:!1})}const fs={name:"PSY",calcParams:H,styles:Le,figures:he};if(W===0)(ts=s())==null||ts.overrideIndicator({...fs,paneId:o().editPaneId});else{const ci=`psy_${String(W+1).padStart(3,"0")}_PSY`,lu=k.find(Cd=>Cd===ci);if(lu){const Cd=r().saveInds[lu];Cd&&Cd.pane_id&&((Bn=s())==null||Bn.overrideIndicator({...fs,paneId:Cd.pane_id}))}else{const Cd=`psy_${String(W+1).padStart(3,"0")}`;((ti=s())==null?void 0:ti.createIndicator(fs,!1,{id:Cd,axis:{gap:{bottom:2}}}))&&(console.log(`✅ PSY ${W+1} created with pane ID:`,Cd),D.actualPaneId=Cd)}}}),c.update(D=>(Object.keys(D.saveInds).forEach(W=>{D.saveInds[W].name==="PSY"&&delete D.saveInds[W]}),i(Xr).forEach((W,H)=>{const he=H===0?`${o().editPaneId}_PSY`:`psy_${String(H+1).padStart(3,"0")}_PSY`,Le=H===0?o().editPaneId:W.actualPaneId||`psy_${String(H+1).padStart(3,"0")}`;D.saveInds[he]={name:"PSY",psyGroup:W,pane_id:Le,groupIndex:H,params:[W.psyPeriod,W.mapsyPeriod]}}),D)),l.update(D=>(D.editIndName="",D.editPaneId="",D.modalIndCfg=!1,D)),a(!1)}function Vv(){if(!i(se))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="OBV");i(cr).forEach((N,j)=>{var Jt,fs,ts;const D=[N.obvPeriod,N.maobvPeriod],W=[{key:"obv",title:"OBV: ",type:"line"}];N.showMaobv&&W.push({key:"maobv",title:"MAOBV: ",type:"line"});const H={lines:[]};let he=wt.Solid,Le=[2,2];if(N.styles.obv.lineStyle==="dashed"?(he=wt.Dashed,Le=[4,4]):N.styles.obv.lineStyle==="dotted"&&(he=wt.Dashed,Le=[2,2]),H.lines.push({color:N.styles.obv.color,size:N.styles.obv.thickness,style:he,dashedValue:Le,smooth:!1}),N.showMaobv){let Bn=wt.Solid,ti=[2,2];N.styles.maobv.lineStyle==="dashed"?(Bn=wt.Dashed,ti=[4,4]):N.styles.maobv.lineStyle==="dotted"&&(Bn=wt.Dashed,ti=[2,2]),H.lines.push({color:N.styles.maobv.color,size:N.styles.maobv.thickness,style:Bn,dashedValue:ti,smooth:!1})}const st={name:"OBV",calcParams:D,styles:H,figures:W};if(j===0)(Jt=s())==null||Jt.overrideIndicator({...st,paneId:o().editPaneId});else{const Bn=`pane_OBV_${j+1}_OBV`,ti=k.find(ci=>ci===Bn);if(ti){const ci=r().saveInds[ti];ci&&ci.pane_id&&((fs=s())==null||fs.overrideIndicator({...st,paneId:ci.pane_id}))}else{const ci=`pane_OBV_${j+1}`;((ts=s())==null?void 0:ts.createIndicator(st,!1,{id:ci,axis:{gap:{bottom:2}}}))&&(console.log(`✅ OBV ${j+1} created with pane ID:`,ci),N.actualPaneId=ci)}}}),c.update(N=>(Object.keys(N.saveInds).forEach(j=>{N.saveInds[j].name==="OBV"&&delete N.saveInds[j]}),i(cr).forEach((j,D)=>{const W=D===0?`${o().editPaneId}_OBV`:`pane_OBV_${D+1}_OBV`,H=D===0?o().editPaneId:j.actualPaneId||`pane_OBV_${D+1}`,he={name:"OBV",obvGroup:j,pane_id:H,groupIndex:D,obvGroups:D===0?[...i(cr)]:void 0,params:[j.obvPeriod,j.maobvPeriod]};N.saveInds[W]=he}),N)),l.update(N=>(N.editIndName="",N.editPaneId="",N.modalIndCfg=!1,N)),a(!1)}function dg(){if(console.log("🚀 handleKdjConfirm started"),!i(re)){console.log("❌ Not KDJ indicator, returning early");return}try{console.log("🔄 Applying KDJ changes, groups:",i(us).length),console.log("📊 Current KDJ groups data:",JSON.parse(JSON.stringify(i(us)))),console.log("🔄 Preserving existing indicators and updating with current values"),i(us).forEach((k,N)=>{console.log(`🔄 Applying KDJ group ${N+1} with current values`),hp(N)}),c.update(k=>(i(us).forEach((N,j)=>{const D=j===0?`${o().editPaneId}_KDJ`:`pane_KDJ_${j+1}_KDJ`,W=j===0?o().editPaneId:N.actualPaneId||`pane_KDJ_${j+1}`;console.log(`💾 Updating saved KDJ group ${j+1} with key:`,D,"pane ID:",W),k.saveInds[D]={name:"KDJ",kdjGroup:N,pane_id:W,groupIndex:j,kdjGroups:j===0?[...i(us)]:void 0,params:[N.kPeriod,N.dPeriod,3]}}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1)}catch(k){console.error("❌ Error in handleKdjConfirm main logic:",k),console.log("🔄 Forcing popup close due to error in main logic..."),l.update(N=>(N.editIndName="",N.editPaneId="",N.modalIndCfg=!1,N)),a(!1),console.log("✅ Popup forcefully closed after error in main logic")}}function fg(){i(Xf)&&(Cn(),x(un,!1),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function S(){var j;if(!i(Ql))return;console.log("🔄 Applying AO changes, groups:",i(na).length);const k=Object.keys(r().saveInds).filter(D=>r().saveInds[D].name==="AO").sort((D,W)=>D===`${o().editPaneId}_AO`?-1:W===`${o().editPaneId}_AO`?1:D.localeCompare(W));console.log("🔍 Existing AO keys:",k);const N=i(na).length;if(k.length>N){console.log(`🗑️ Removing ${k.length-N} excess AO indicators`);for(let D=N;D<k.length;(D+=1)-1){const W=k[D],H=r().saveInds[W];if(H&&H.pane_id){console.log("🗑️ Removing AO indicator from pane:",H.pane_id);try{(j=s())==null||j.removeIndicator({paneId:H.pane_id,name:"AO"})}catch(he){console.log("Error removing excess AO indicator:",he)}}}}i(na).forEach((D,W)=>{var Le,st,Jt,fs,ts;const H=[D.shortPeriod,D.longPeriod],he={bars:[{upColor:D.styles.increasing.color,downColor:D.styles.decreasing.color,noChangeColor:((Le=D.styles.reverse)==null?void 0:Le.color)||"#c4c4c4",reverseColor:((st=D.styles.reverse)==null?void 0:st.color)||"#c4c4c4"}]};if(W===0)console.log("🔄 Updating first AO indicator in pane:",o().editPaneId),(Jt=s())==null||Jt.overrideIndicator({name:"AO",calcParams:H,styles:he,paneId:o().editPaneId});else{const Bn=`pane_AO_${W+1}_AO`,ti=k.find(ci=>ci===Bn);if(ti){const ci=r().saveInds[ti];ci&&ci.pane_id&&(console.log(`🔄 Updating existing AO ${W+1} in pane:`,ci.pane_id),(fs=s())==null||fs.overrideIndicator({name:"AO",calcParams:H,styles:he,paneId:ci.pane_id}))}else{const ci=`pane_AO_${W+1}`;console.log(`🆕 Creating new AO ${W+1} with pane ID:`,ci),(ts=s())==null||ts.createIndicator({name:"AO",calcParams:H,styles:he},!0,{id:ci})}}}),c.update(D=>(Object.keys(D.saveInds).forEach(W=>{D.saveInds[W].name==="AO"&&delete D.saveInds[W]}),i(na).forEach((W,H)=>{const he=H===0?`${o().editPaneId}_AO`:`pane_AO_${H+1}_AO`,Le=H===0?o().editPaneId:`pane_AO_${H+1}`;console.log(`💾 Saving AO group ${H+1} with key:`,he),D.saveInds[he]={name:"AO",aoGroup:W,pane_id:Le,groupIndex:H,aoGroups:H===0?[...i(na)]:void 0,params:[W.shortPeriod,W.longPeriod]}}),D)),l.update(D=>(D.editIndName="",D.editPaneId="",D.modalIndCfg=!1,D)),a(!1)}function R(){i(Ku)&&(i(Ea).length===0?x(Ea,V([{id:Br(),paneId:o().editPaneId||"candle_pane",period:i(B),stdDev:i($),styles:{fillColor:i(w),fillOpacity:i(C),upperColor:i(P),middleColor:i(I),lowerColor:i(A),thickness:i(M),lineStyle:i(F)}}])):(i(Ea)[0].period=i(B),i(Ea)[0].stdDev=i($),i(Ea)[0].styles.fillColor=i(w),i(Ea)[0].styles.fillOpacity=i(C),i(Ea)[0].styles.upperColor=i(P),i(Ea)[0].styles.middleColor=i(I),i(Ea)[0].styles.lowerColor=i(A),i(Ea)[0].styles.thickness=i(M),i(Ea)[0].styles.lineStyle=i(F)),ro(),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function X(k){var D;if(console.log("🔄 handleConfirm called with:",k),console.log("📊 Current context:",{editIndName:o().editIndName,editPaneId:o().editPaneId,isKdj:i(re),kdjGroups:i(us)}),k==="close"||k==="cancel"){l.update(W=>(W.editIndName="",W.editPaneId="",W.modalIndCfg=!1,W)),x(un,!1),a(!1);return}if(k==="confirm"&&i(bf)&&o().editIndName&&o().editPaneId){Bv();return}if(k==="confirm"&&i(ye)&&o().editIndName&&o().editPaneId){fr(),l.update(W=>(W.editIndName="",W.editPaneId="",W.modalIndCfg=!1,W)),a(!1);return}if(k==="confirm"&&i(ad)&&o().editIndName&&o().editPaneId){console.log("🔄 PVT Confirm: Applying all changes to chart"),i(Or).forEach((W,H)=>{console.log(`🔄 Applying PVT group ${H}:`,W),Im(H)}),c.update(W=>{const H=`${o().editPaneId}_PVT`;return W.saveInds[H]={...W.saveInds[H],pvtGroups:[...i(Or)]},console.log("💾 Saved PVT groups to:",H),W}),l.update(W=>(W.editIndName="",W.editPaneId="",W.modalIndCfg=!1,W)),a(!1);return}if(k==="confirm"&&i(be)&&o().editIndName&&o().editPaneId){jv();return}if(k==="confirm"&&i(Hd)&&o().editIndName&&o().editPaneId){ip();return}if(k==="confirm"&&i(hu)&&o().editIndName&&o().editPaneId){um();return}if(k==="confirm"&&i(yd)&&o().editIndName&&o().editPaneId){dv();return}if(k==="confirm"&&i(Jc)&&o().editIndName&&o().editPaneId){Zm();return}if(k==="confirm"&&i(yt)&&o().editIndName&&o().editPaneId){i(Ui).forEach((W,H)=>{Wp(H)}),Rm(),l.update(W=>(W.editIndName="",W.editPaneId="",W.modalIndCfg=!1,W)),a(!1);return}if(k==="confirm"&&i(J)&&o().editIndName&&o().editPaneId){Rh();return}if(k==="confirm"&&i(Fe)&&o().editIndName&&o().editPaneId){Cm();return}if(k==="confirm"&&i(Xu)&&o().editIndName&&o().editPaneId){Ov();return}if(k==="confirm"&&i(jd)&&o().editIndName&&o().editPaneId){Xo();return}if(k==="confirm"&&i(we)&&o().editIndName&&o().editPaneId){jh();return}if(k==="confirm"&&i(Bd)&&o().editIndName&&o().editPaneId){zv();return}if(k==="confirm"&&i(jt)&&o().editIndName&&o().editPaneId){wv();return}if(k==="confirm"&&i(Mc)&&o().editIndName&&o().editPaneId){xh();return}if(k==="confirm"&&i(qd)&&o().editIndName&&o().editPaneId){cg();return}if(k==="confirm"&&i(Vf)&&o().editIndName&&o().editPaneId){ug();return}if(k==="confirm"&&i(se)&&o().editIndName&&o().editPaneId){Vv();return}if(k==="confirm"&&i(sf)&&o().editIndName&&o().editPaneId){Kh();return}if(k==="confirm"&&i(re)&&o().editIndName&&o().editPaneId){console.log("✅ KDJ confirm condition met, calling handleKdjConfirm"),dg();return}if(k==="confirm"&&i(Ql)&&o().editIndName&&o().editPaneId){S();return}if(k==="confirm"&&i(Ku)&&o().editIndName&&o().editPaneId){R();return}if(k==="confirm"&&i(Xf)&&o().editIndName&&o().editPaneId){fg();return}if(k!=="confirm"||!o().editIndName||!o().editPaneId||d.length===0){a(!1);return}const N=[],j={lines:[],bars:[]};u.forEach((W,H)=>{const he=d[H];if(he&&he.type==="color"){const Le=he.styleKey;if(Le){const st=Le.match(/^(\w+)\[(\d+)\]\.(\w+)$/);if(st){const[,Jt,fs,ts]=st,Bn=parseInt(fs);j[Jt]||(j[Jt]=[]),j[Jt][Bn]||(j[Jt][Bn]={}),j[Jt][Bn][ts]=W||he.default}}}else(!Xv.isValid(W)||W==="")&&he&&he.default&&(W=he.default),N.push(Number(W))}),h.forEach((W,H)=>{let he=wt.Solid,Le=[2,2];W.lineStyle==="dashed"?(he=wt.Dashed,Le=[4,4]):W.lineStyle==="dotted"&&(he=wt.Dashed,Le=[2,6]),j.lines[H]={color:W.color,size:W.thickness,style:he,dashedValue:Le}}),(D=s())==null||D.overrideIndicator({name:o().editIndName,calcParams:N,styles:j,paneId:o().editPaneId}),c.update(W=>{const H={name:o().editIndName,params:N,pane_id:o().editPaneId,styles:[...h]};return i(Ku)||(H.fields=[...d]),W.saveInds[`${o().editPaneId}_${o().editIndName}`]=H,W}),l.update(W=>(W.editIndName="",W.editPaneId="",W.modalIndCfg=!1,W)),a(!1)}a_();var ae=YG(),ne=fn(ae);tg(ne,{get title(){return i(Ge)},width:600,maxWidth:"min(600px, 95vw)",maxHeight:"90vh",get show(){return a()},set show(k){a(k)},get theme(){return r().theme},click:X,children:(k,N)=>{var j=GG(),D=y(j);Ue(D,()=>i(bf),H=>{var he=pq(),Le=y(he);Yo(Le,17,()=>i(Xl),Ii,(fs,ts,Bn)=>{var ti=fq(),ci=y(ti),lu=y(ci);lu.textContent=`MACD ${Bn+1}`;var Cd=v(lu,2);Ue(Cd,()=>i(Xl).length>1,Vi=>{var Ho=dq();Ho.__click=[uq,Lh,ts],q(Vi,Ho)}),_(ci);var Sf=v(ci,2),rf=y(Sf),rp=v(y(rf),2);xn(rp),_(rf);var ef=v(rf,2),Cf=v(y(ef),2);xn(Cf),_(ef);var mf=v(ef,2),Id=v(y(mf),2);xn(Id),_(mf),_(Sf);var If=v(Sf,2),jf=y(If),sa=v(y(jf),2),wi=Bt(()=>wm(Bn,"macdLine"));sa.__click=function(...Vi){var Ho;(Ho=i(wi))==null||Ho.apply(this,Vi)};var pa=v(sa,2);pa.__change=()=>Gh(Bn);var er=y(pa);er.value=(er.__value=1)==null?"":1;var Da=v(er);Da.value=(Da.__value=2)==null?"":2;var cu=v(Da);cu.value=(cu.__value=3)==null?"":3;var Va=v(cu);Va.value=(Va.__value=4)==null?"":4;var ju=v(Va);ju.value=(ju.__value=5)==null?"":5,_(pa);var Bu=v(pa,2);Bu.__change=()=>Gh(Bn);var oa=y(Bu);oa.value=(oa.__value="solid")==null?"":"solid";var Ul=v(oa);Ul.value=(Ul.__value="dashed")==null?"":"dashed";var ud=v(Ul);ud.value=(ud.__value="dotted")==null?"":"dotted",_(Bu),_(jf);var dl=v(jf,2),U=v(y(dl),2),Kt=Bt(()=>wm(Bn,"signalLine"));U.__click=function(...Vi){var Ho;(Ho=i(Kt))==null||Ho.apply(this,Vi)};var bs=v(U,2);bs.__change=()=>Gh(Bn);var Ds=y(bs);Ds.value=(Ds.__value=1)==null?"":1;var _s=v(Ds);_s.value=(_s.__value=2)==null?"":2;var zi=v(_s);zi.value=(zi.__value=3)==null?"":3;var ii=v(zi);ii.value=(ii.__value=4)==null?"":4;var ia=v(ii);ia.value=(ia.__value=5)==null?"":5,_(bs);var $r=v(bs,2);$r.__change=()=>Gh(Bn);var rr=y($r);rr.value=(rr.__value="solid")==null?"":"solid";var Jl=v(rr);Jl.value=(Jl.__value="dashed")==null?"":"dashed";var Wa=v(Jl);Wa.value=(Wa.__value="dotted")==null?"":"dotted",_($r),_(dl);var Ci=v(dl,2),Ha=v(y(Ci),2),ki=Bt(()=>wm(Bn,"positiveHistogram"));Ha.__click=function(...Vi){var Ho;(Ho=i(ki))==null||Ho.apply(this,Vi)},_(Ci);var ys=v(Ci,2),tr=v(y(ys),2),Fo=Bt(()=>wm(Bn,"negativeHistogram"));tr.__click=function(...Vi){var Ho;(Ho=i(Fo))==null||Ho.apply(this,Vi)},_(ys);var Lo=v(ys,2),Gi=v(y(Lo),2),Nr=Bt(()=>wm(Bn,"reverseHistogram"));Gi.__click=function(...Vi){var Ho;(Ho=i(Nr))==null||Ho.apply(this,Vi)},_(Lo),_(If),_(ti),Ce(()=>{Ot(sa,"style",`background-color: ${i(ts).styles.macdLine.color??""}; border: 1px solid #ddd;`),Ot(U,"style",`background-color: ${i(ts).styles.signalLine.color??""}; border: 1px solid #ddd;`),Ot(Ha,"style",`background-color: ${i(ts).styles.positiveHistogram.color??""}; border: 1px solid #ddd;`),Ot(tr,"style",`background-color: ${i(ts).styles.negativeHistogram.color??""}; border: 1px solid #ddd;`),Ot(Gi,"style",`background-color: ${i(ts).styles.reverseHistogram.color??""}; border: 1px solid #ddd;`)}),Bs(rp,()=>i(ts).fastPeriod,Vi=>i(ts).fastPeriod=Vi),Bs(Cf,()=>i(ts).slowPeriod,Vi=>i(ts).slowPeriod=Vi),Bs(Id,()=>i(ts).signalPeriod,Vi=>i(ts).signalPeriod=Vi),xo(pa,()=>i(ts).styles.macdLine.thickness,Vi=>i(ts).styles.macdLine.thickness=Vi),xo(Bu,()=>i(ts).styles.macdLine.lineStyle,Vi=>i(ts).styles.macdLine.lineStyle=Vi),xo(bs,()=>i(ts).styles.signalLine.thickness,Vi=>i(ts).styles.signalLine.thickness=Vi),xo($r,()=>i(ts).styles.signalLine.lineStyle,Vi=>i(ts).styles.signalLine.lineStyle=Vi),q(fs,ti)});var st=v(Le,2),Jt=y(st);Jt.__click=Om,_(st),_(he),q(H,he)},H=>{var he=Qn(),Le=fn(he);Ue(Le,()=>i(ye),st=>{var Jt=mq(),fs=y(Jt),ts=y(fs),Bn=v(y(ts),2);xn(Bn),Bn.__input=[_g,ye,s,f,o,l,Ms],_(ts);var ti=v(ts,2),ci=v(y(ti),2);xn(ci),ci.__input=[_g,ye,s,f,o,l,Ms],_(ti);var lu=v(ti,2),Cd=v(y(lu),2);xn(Cd),Cd.__input=[_g,ye,s,f,o,l,Ms],_(lu);var Sf=v(lu,2),rf=v(y(Sf),2);xn(rf),rf.__input=[_g,ye,s,f,o,l,Ms],_(Sf);var rp=v(Sf,2),ef=v(y(rp),2);xn(ef),ef.__input=[_g,ye,s,f,o,l,Ms],_(rp);var Cf=v(rp,2),mf=v(y(Cf),2);xn(mf),mf.__input=[_g,ye,s,f,o,l,Ms],_(Cf),_(fs);var Id=v(fs,2),If=y(Id),jf=v(y(If),2),sa=y(jf);xn(sa),sa.__input=[_g,ye,s,f,o,l,Ms];var wi=v(sa,2),pa=y(wi);Ce(()=>tt(pa,`${(Ms.maxZoneWidthPct*100).toFixed(1)??""}%`)),_(wi),_(jf),_(If);var er=v(If,2),Da=v(y(er),2),cu=y(Da);xn(cu),cu.__input=[_g,ye,s,f,o,l,Ms];var Va=v(cu,2),ju=y(Va);Ce(()=>tt(ju,`${Ms.minVolumeFactor.toFixed(2)??""}x`)),_(Va),_(Da),_(er);var Bu=v(er,2),oa=v(y(Bu),2),Ul=y(oa);xn(Ul),Ul.__input=[_g,ye,s,f,o,l,Ms];var ud=v(Ul,2),dl=y(ud,!0);Ce(()=>tt(dl,Ms.minOBVTrendStrength.toFixed(2))),_(ud),_(oa),_(Bu);var U=v(Bu,2),Kt=v(y(U),2),bs=y(Kt);xn(bs),bs.__input=[_g,ye,s,f,o,l,Ms];var Ds=v(bs,2),_s=y(Ds,!0);Ce(()=>tt(_s,Ms.minZoneScore.toFixed(2))),_(Ds),_(Kt),_(U),_(Id);var zi=v(Id,2),ii=y(zi),ia=v(y(ii),2);xn(ia),ia.__change=[_g,ye,s,f,o,l,Ms],_(ii);var $r=v(ii,2),rr=v(y($r),2);xn(rr),rr.__change=[_g,ye,s,f,o,l,Ms],_($r),_(zi);var Jl=v(zi,2),Wa=v(y(Jl),2);xn(Wa),Wa.__input=[_g,ye,s,f,o,l,Ms],_(Jl),_(Jt),Bs(Bn,()=>Ms.zoneLookbackBars,Ci=>Ms.zoneLookbackBars=Ci),Bs(ci,()=>Ms.priorTrendLookback,Ci=>Ms.priorTrendLookback=Ci),Bs(Cd,()=>Ms.minZoneBars,Ci=>Ms.minZoneBars=Ci),Bs(rf,()=>Ms.maxZoneBars,Ci=>Ms.maxZoneBars=Ci),Bs(ef,()=>Ms.atrPeriod,Ci=>Ms.atrPeriod=Ci),Bs(mf,()=>Ms.volumeMAPeriod,Ci=>Ms.volumeMAPeriod=Ci),Bs(sa,()=>Ms.maxZoneWidthPct,Ci=>Ms.maxZoneWidthPct=Ci),Bs(cu,()=>Ms.minVolumeFactor,Ci=>Ms.minVolumeFactor=Ci),Bs(Ul,()=>Ms.minOBVTrendStrength,Ci=>Ms.minOBVTrendStrength=Ci),Bs(bs,()=>Ms.minZoneScore,Ci=>Ms.minZoneScore=Ci),Uv(ia,()=>Ms.mergeNearbyZones,Ci=>Ms.mergeNearbyZones=Ci),Uv(rr,()=>Ms.showLabels,Ci=>Ms.showLabels=Ci),Bs(Wa,()=>Ms.maxZonesDisplayed,Ci=>Ms.maxZonesDisplayed=Ci),q(st,Jt)},st=>{var Jt=Qn(),fs=fn(Jt);Ue(fs,()=>i(E),ts=>{var Bn=vq(),ti=y(Bn),ci=y(ti),lu=v(y(ci),2);xn(lu),lu.__input=Ye,_(ci);var Cd=v(ci,2),Sf=v(y(Cd),2);xn(Sf),Sf.__input=Ye,_(Cd);var rf=v(Cd,2),rp=v(y(rf),2);xn(rp),rp.__input=Ye,_(rf);var ef=v(rf,2),Cf=v(y(ef),2);xn(Cf),Cf.__input=Ye,_(ef);var mf=v(ef,2),Id=v(y(mf),2);xn(Id),Id.__input=Ye,_(mf);var If=v(mf,2),jf=v(y(If),2),sa=y(jf);xn(sa),sa.__input=Ye;var wi=v(sa,2),pa=y(wi);Ce(()=>tt(pa,`${Number(u[5]??1.2).toFixed(2)??""}x`)),_(wi),_(jf),_(If),_(ti);var er=v(ti,2),Da=y(er),cu=v(y(Da),2),Va=y(cu);xn(Va),Va.__input=Ye,Zi(2),_(cu),_(Da);var ju=v(Da,2),Bu=v(y(ju),2),oa=y(Bu);xn(oa),oa.__input=Ye;var Ul=v(oa,2),ud=y(Ul,!0);Ce(()=>tt(ud,Number(u[7]??.35).toFixed(2))),_(Ul),_(Bu),_(ju);var dl=v(ju,2),U=v(y(dl),2),Kt=y(U);xn(Kt),Kt.__input=Ye;var bs=v(Kt,2),Ds=y(bs,!0);Ce(()=>tt(Ds,Number(u[8]??.5).toFixed(2))),_(bs),_(U),_(dl),_(er);var _s=v(er,2),zi=y(_s),ii=v(y(zi),2);xn(ii),Ce(()=>Mv(ii,Number(u[9]??1)>0)),ii.__change=[hq,u,Ye],_(zi);var ia=v(zi,2),$r=v(y(ia),2);xn($r),$r.__input=Ye,_(ia),_(_s),_(Bn),Bs(lu,()=>u[0],rr=>u[0]=rr),Bs(Sf,()=>u[1],rr=>u[1]=rr),Bs(rp,()=>u[2],rr=>u[2]=rr),Bs(Cf,()=>u[3],rr=>u[3]=rr),Bs(Id,()=>u[4],rr=>u[4]=rr),Bs(sa,()=>u[5],rr=>u[5]=rr),Bs(Va,()=>u[6],rr=>u[6]=rr),Bs(oa,()=>u[7],rr=>u[7]=rr),Bs(Kt,()=>u[8],rr=>u[8]=rr),Bs($r,()=>u[10],rr=>u[10]=rr),q(ts,Bn)},ts=>{var Bn=Qn(),ti=fn(Bn);Ue(ti,()=>i(me),ci=>{var lu=gq(),Cd=y(lu),Sf=v(y(Cd),2),rf=y(Sf),rp=v(y(rf),2);xn(rp),rp.__input=at,_(rf);var ef=v(rf,2),Cf=v(y(ef),2);xn(Cf),Cf.__input=at,_(ef);var mf=v(ef,2),Id=v(y(mf),2);xn(Id),Id.__input=at,_(mf);var If=v(mf,2),jf=v(y(If),2);xn(jf),jf.__input=at,_(If);var sa=v(If,2),wi=v(y(sa),2);xn(wi),wi.__input=at,_(sa);var pa=v(sa,2),er=v(y(pa),2);xn(er),er.__input=at,_(pa),_(Sf),_(Cd);var Da=v(Cd,2),cu=v(y(Da),2),Va=y(cu),ju=v(y(Va),2),Bu=y(ju);xn(Bu),Bu.__input=at;var oa=v(Bu,2),Ul=y(oa,!0);Ce(()=>tt(Ul,Number(u[6]??.7).toFixed(2))),_(oa),_(ju),_(Va);var ud=v(Va,2),dl=v(y(ud),2);xn(dl),dl.__input=at,_(ud);var U=v(ud,2),Kt=v(y(U),2),bs=y(Kt);xn(bs),bs.__input=at;var Ds=v(bs,2),_s=y(Ds);Ce(()=>tt(_s,`${Number(u[8]??1.3).toFixed(2)??""}x`)),_(Ds),_(Kt),_(U);var zi=v(U,2),ii=v(y(zi),2),ia=y(ii);xn(ia),ia.__input=at;var $r=v(ia,2),rr=y($r);Ce(()=>tt(rr,`${Number(u[9]??1.3).toFixed(2)??""}x`)),_($r),_(ii),_(zi);var Jl=v(zi,2),Wa=v(y(Jl),2),Ci=y(Wa);xn(Ci),Ci.__input=at;var Ha=v(Ci,2),ki=y(Ha,!0);Ce(()=>tt(ki,Number(u[10]??.6).toFixed(2))),_(Ha),_(Wa),_(Jl);var ys=v(Jl,2),tr=v(y(ys),2);xn(tr),tr.__input=at,_(ys);var Fo=v(ys,2),Lo=v(y(Fo),2);xn(Lo),Lo.__input=at,_(Fo),_(cu),_(Da),_(lu),Bs(rp,()=>u[0],Gi=>u[0]=Gi),Bs(Cf,()=>u[1],Gi=>u[1]=Gi),Bs(Id,()=>u[2],Gi=>u[2]=Gi),Bs(jf,()=>u[3],Gi=>u[3]=Gi),Bs(wi,()=>u[4],Gi=>u[4]=Gi),Bs(er,()=>u[5],Gi=>u[5]=Gi),Bs(Bu,()=>u[6],Gi=>u[6]=Gi),Bs(dl,()=>u[7],Gi=>u[7]=Gi),Bs(bs,()=>u[8],Gi=>u[8]=Gi),Bs(ia,()=>u[9],Gi=>u[9]=Gi),Bs(Ci,()=>u[10],Gi=>u[10]=Gi),Bs(tr,()=>u[11],Gi=>u[11]=Gi),Bs(Lo,()=>u[12],Gi=>u[12]=Gi),q(ci,lu)},ci=>{var lu=Qn(),Cd=fn(lu);Ue(Cd,()=>i(Se),Sf=>{var rf=_q(),rp=y(rf),ef=v(y(rp),2),Cf=y(ef),mf=v(y(Cf),2);xn(mf),mf.__input=Re,_(Cf);var Id=v(Cf,2),If=v(y(Id),2);xn(If),If.__input=Re,_(Id);var jf=v(Id,2),sa=v(y(jf),2);xn(sa),sa.__input=Re,_(jf);var wi=v(jf,2),pa=v(y(wi),2);xn(pa),pa.__input=Re,_(wi);var er=v(wi,2),Da=v(y(er),2);xn(Da),Da.__input=Re,_(er);var cu=v(er,2),Va=v(y(cu),2);xn(Va),Va.__input=Re,_(cu),_(ef),_(rp);var ju=v(rp,2),Bu=v(y(ju),2),oa=y(Bu),Ul=v(y(oa),2),ud=y(Ul);xn(ud),ud.__input=Re;var dl=v(ud,2),U=y(dl,!0);Ce(()=>tt(U,Number(u[6]??.7).toFixed(2))),_(dl),_(Ul),_(oa);var Kt=v(oa,2),bs=v(y(Kt),2);xn(bs),bs.__input=Re,_(Kt);var Ds=v(Kt,2),_s=v(y(Ds),2),zi=y(_s);xn(zi),zi.__input=Re;var ii=v(zi,2),ia=y(ii);Ce(()=>tt(ia,`${Number(u[8]??1.3).toFixed(2)??""}x`)),_(ii),_(_s),_(Ds);var $r=v(Ds,2),rr=v(y($r),2),Jl=y(rr);xn(Jl),Jl.__input=Re;var Wa=v(Jl,2),Ci=y(Wa);Ce(()=>tt(Ci,`${Number(u[9]??1.3).toFixed(2)??""}x`)),_(Wa),_(rr),_($r);var Ha=v($r,2),ki=v(y(Ha),2),ys=y(ki);xn(ys),ys.__input=Re;var tr=v(ys,2),Fo=y(tr,!0);Ce(()=>tt(Fo,Number(u[10]??.6).toFixed(2))),_(tr),_(ki),_(Ha);var Lo=v(Ha,2),Gi=v(y(Lo),2);xn(Gi),Gi.__input=Re,_(Lo);var Nr=v(Lo,2),Vi=v(y(Nr),2);xn(Vi),Vi.__input=Re,_(Nr),_(Bu),_(ju),_(rf),Bs(mf,()=>u[0],Ho=>u[0]=Ho),Bs(If,()=>u[1],Ho=>u[1]=Ho),Bs(sa,()=>u[2],Ho=>u[2]=Ho),Bs(pa,()=>u[3],Ho=>u[3]=Ho),Bs(Da,()=>u[4],Ho=>u[4]=Ho),Bs(Va,()=>u[5],Ho=>u[5]=Ho),Bs(ud,()=>u[6],Ho=>u[6]=Ho),Bs(bs,()=>u[7],Ho=>u[7]=Ho),Bs(zi,()=>u[8],Ho=>u[8]=Ho),Bs(Jl,()=>u[9],Ho=>u[9]=Ho),Bs(ys,()=>u[10],Ho=>u[10]=Ho),Bs(Gi,()=>u[11],Ho=>u[11]=Ho),Bs(Vi,()=>u[12],Ho=>u[12]=Ho),q(Sf,rf)},Sf=>{var rf=Qn(),rp=fn(rf);Ue(rp,()=>i(yt),ef=>{var Cf=xq(),mf=y(Cf);Yo(mf,17,()=>i(Ui),Ii,(jf,sa,wi)=>{var pa=bq(),er=y(pa),Da=y(er);Da.textContent=`RSI ${wi+1}`;var cu=v(Da,2);Ue(cu,()=>i(Ui).length>1,Jo=>{var Ki=yq();Ki.__click=()=>Av(wi),q(Jo,Ki)}),_(er);var Va=v(er,2),ju=y(Va),Bu=v(y(ju),2);xn(Bu),Bu.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)},_(ju);var oa=v(ju,2),Ul=v(y(oa),2);xn(Ul),Ul.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)},_(oa);var ud=v(oa,2),dl=v(y(ud),2);xn(dl),dl.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)},_(ud);var U=v(ud,2),Kt=v(y(U),2);xn(Kt),Kt.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)},_(U),_(Va);var bs=v(Va,2),Ds=y(bs),_s=v(y(Ds),2),zi=y(_s);zi.__click=Jo=>{x(Kf,V(wi));const Ki=Jo.currentTarget.getBoundingClientRect();x(Yf,V({x:Ki.left+Ki.width/2,y:Ki.bottom+5})),x(Zd,!0)};var ii=v(zi,2);ii.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)};var ia=y(ii);ia.value=(ia.__value=1)==null?"":1;var $r=v(ia);$r.value=($r.__value=2)==null?"":2;var rr=v($r);rr.value=(rr.__value=3)==null?"":3;var Jl=v(rr);Jl.value=(Jl.__value=4)==null?"":4;var Wa=v(Jl);Wa.value=(Wa.__value=5)==null?"":5,_(ii);var Ci=v(ii,2);Ci.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)};var Ha=y(Ci);Ha.value=(Ha.__value="solid")==null?"":"solid";var ki=v(Ha);ki.value=(ki.__value="dashed")==null?"":"dashed";var ys=v(ki);ys.value=(ys.__value="dotted")==null?"":"dotted",_(Ci),_(_s),_(Ds),_(bs);var tr=v(bs,2),Fo=v(y(tr),2),Lo=v(y(Fo),2),Gi=y(Lo);Gi.__click=Jo=>{x(kl,V(wi));const Ki=Jo.currentTarget.getBoundingClientRect();x(Yl,V({x:Ki.left+Ki.width/2,y:Ki.bottom+5})),x(el,!0)};var Nr=v(Gi,2);Nr.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)};var Vi=y(Nr);Vi.value=(Vi.__value=1)==null?"":1;var Ho=v(Vi);Ho.value=(Ho.__value=2)==null?"":2;var Ar=v(Ho);Ar.value=(Ar.__value=3)==null?"":3,_(Nr);var ma=v(Nr,2);ma.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)};var rl=y(ma);rl.value=(rl.__value="solid")==null?"":"solid";var Cr=v(rl);Cr.value=(Cr.__value="dashed")==null?"":"dashed";var Yi=v(Cr);Yi.value=(Yi.__value="dotted")==null?"":"dotted",_(ma),_(Lo),_(Fo);var ha=v(Fo,2),Dr=v(y(ha),2),va=y(Dr);va.__click=Jo=>{x(kl,V(wi));const Ki=Jo.currentTarget.getBoundingClientRect();x(Iu,V({x:Ki.left+Ki.width/2,y:Ki.bottom+5})),x(Vu,!0)};var al=v(va,2);al.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)};var ns=y(al);ns.value=(ns.__value=1)==null?"":1;var zs=v(ns);zs.value=(zs.__value=2)==null?"":2;var Rs=v(zs);Rs.value=(Rs.__value=3)==null?"":3,_(al);var Ni=v(al,2);Ni.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)};var Ma=y(Ni);Ma.value=(Ma.__value="solid")==null?"":"solid";var ll=v(Ma);ll.value=(ll.__value="dashed")==null?"":"dashed";var ir=v(ll);ir.value=(ir.__value="dotted")==null?"":"dotted",_(Ni),_(Dr),_(ha);var Ai=v(ha,2),ca=v(y(Ai),2),ui=y(ca);ui.__click=Jo=>{x(kl,V(wi));const Ki=Jo.currentTarget.getBoundingClientRect();x(zr,V({x:Ki.left+Ki.width/2,y:Ki.bottom+5})),x(Ro,!0)};var bi=v(ui,2);bi.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)};var ai=y(bi);ai.value=(ai.__value=1)==null?"":1;var fi=v(ai);fi.value=(fi.__value=2)==null?"":2;var ra=v(fi);ra.value=(ra.__value=3)==null?"":3,_(bi);var pr=v(bi,2);pr.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)};var Ti=y(pr);Ti.value=(Ti.__value="solid")==null?"":"solid";var Di=v(Ti);Di.value=(Di.__value="dashed")==null?"":"dashed";var Sa=v(Di);Sa.value=(Sa.__value="dotted")==null?"":"dotted",_(pr),_(ca),_(Ai);var Uo=v(Ai,2),ga=v(y(Uo),2),qr=y(ga);xn(qr),qr.__change=()=>{x(Ui,V([...i(Ui)])),Wp(wi)};var Ri=v(qr,2),Ka=y(Ri);Ce(()=>tt(Ka,`${Math.round((i(sa).fillOpacity??.15)*100)??""}%`)),_(Ri),_(ga),_(Uo),_(tr),_(pa),Ce(()=>{Ot(zi,"style",`background-color: ${i(sa).styles.rsi.color??""}`),Ot(Gi,"style",`background-color: ${(i(sa).styles.overboughtColor||"#EF4444")??""}`),Ot(va,"style",`background-color: ${(i(sa).styles.oversoldColor||"#22C55E")??""}`),Ot(ui,"style",`background-color: ${(i(sa).styles.middleLineColor||"#6B7280")??""}`)}),Bs(Bu,()=>i(sa).period,Jo=>i(sa).period=Jo),Bs(Ul,()=>i(sa).overboughtLevel,Jo=>i(sa).overboughtLevel=Jo),Bs(dl,()=>i(sa).middleLevel,Jo=>i(sa).middleLevel=Jo),Bs(Kt,()=>i(sa).oversoldLevel,Jo=>i(sa).oversoldLevel=Jo),xo(ii,()=>i(sa).styles.rsi.thickness,Jo=>i(sa).styles.rsi.thickness=Jo),xo(Ci,()=>i(sa).styles.rsi.lineStyle,Jo=>i(sa).styles.rsi.lineStyle=Jo),xo(Nr,()=>i(sa).styles.overboughtThickness,Jo=>i(sa).styles.overboughtThickness=Jo),xo(ma,()=>i(sa).styles.overboughtLineStyle,Jo=>i(sa).styles.overboughtLineStyle=Jo),xo(al,()=>i(sa).styles.oversoldThickness,Jo=>i(sa).styles.oversoldThickness=Jo),xo(Ni,()=>i(sa).styles.oversoldLineStyle,Jo=>i(sa).styles.oversoldLineStyle=Jo),xo(bi,()=>i(sa).styles.middleLineThickness,Jo=>i(sa).styles.middleLineThickness=Jo),xo(pr,()=>i(sa).styles.middleLineStyle,Jo=>i(sa).styles.middleLineStyle=Jo),Bs(qr,()=>i(sa).fillOpacity,Jo=>i(sa).fillOpacity=Jo),q(jf,pa)});var Id=v(mf,2),If=y(Id);If.__click=Sg,_(Id),_(Cf),q(ef,Cf)},ef=>{var Cf=Qn(),mf=fn(Cf);Ue(mf,()=>i(vt),Id=>{var If=Sq(),jf=y(If);Yo(jf,17,()=>i(Eu),Ii,(pa,er,Da)=>{var cu=kq(),Va=y(cu),ju=y(Va);ju.textContent=`Stochastic ${Da+1}`;var Bu=v(ju,2);Ue(Bu,()=>i(Eu).length>1,ai=>{var fi=wq();fi.__click=()=>im(Da),q(ai,fi)}),_(Va);var oa=v(Va,2),Ul=y(oa),ud=v(y(Ul),2);xn(ud),ud.__change=()=>xf(Da),_(Ul);var dl=v(Ul,2),U=v(y(dl),2);xn(U),U.__change=()=>xf(Da),_(dl);var Kt=v(dl,2),bs=v(y(Kt),2);xn(bs),bs.__change=()=>xf(Da),_(Kt);var Ds=v(Kt,2),_s=v(y(Ds),2);xn(_s),_s.__change=()=>xf(Da),_(Ds),_(oa);var zi=v(oa,2),ii=y(zi),ia=v(y(ii),2);xn(ia),ia.__change=()=>xf(Da),_(ii),_(zi);var $r=v(zi,2),rr=y($r),Jl=v(y(rr),2),Wa=y(Jl);Wa.__click=ai=>{const fi=ai.currentTarget.getBoundingClientRect();x(Wd,V({x:fi.left,y:fi.bottom+5})),x($l,V(Da)),x(_d,!0)};var Ci=v(Wa,2);Ci.__change=()=>xf(Da);var Ha=y(Ci);Ha.value=(Ha.__value=1)==null?"":1;var ki=v(Ha);ki.value=(ki.__value=2)==null?"":2;var ys=v(ki);ys.value=(ys.__value=3)==null?"":3;var tr=v(ys);tr.value=(tr.__value=4)==null?"":4;var Fo=v(tr);Fo.value=(Fo.__value=5)==null?"":5,_(Ci);var Lo=v(Ci,2);Lo.__change=()=>xf(Da);var Gi=y(Lo);Gi.value=(Gi.__value="solid")==null?"":"solid";var Nr=v(Gi);Nr.value=(Nr.__value="dashed")==null?"":"dashed";var Vi=v(Nr);Vi.value=(Vi.__value="dotted")==null?"":"dotted",_(Lo),_(Jl),_(rr),_($r);var Ho=v($r,2),Ar=y(Ho),ma=v(y(Ar),2),rl=y(ma);rl.__click=ai=>{const fi=ai.currentTarget.getBoundingClientRect();x(Wd,V({x:fi.left,y:fi.bottom+5})),x($l,V(Da)),x(Rd,!0)};var Cr=v(rl,2);Cr.__change=()=>xf(Da);var Yi=y(Cr);Yi.value=(Yi.__value=1)==null?"":1;var ha=v(Yi);ha.value=(ha.__value=2)==null?"":2;var Dr=v(ha);Dr.value=(Dr.__value=3)==null?"":3;var va=v(Dr);va.value=(va.__value=4)==null?"":4;var al=v(va);al.value=(al.__value=5)==null?"":5,_(Cr);var ns=v(Cr,2);ns.__change=()=>xf(Da);var zs=y(ns);zs.value=(zs.__value="solid")==null?"":"solid";var Rs=v(zs);Rs.value=(Rs.__value="dashed")==null?"":"dashed";var Ni=v(Rs);Ni.value=(Ni.__value="dotted")==null?"":"dotted",_(ns),_(ma),_(Ar),_(Ho);var Ma=v(Ho,2),ll=v(y(Ma),2),ir=v(y(ll),2);ir.__click=ai=>{const fi=ai.currentTarget.getBoundingClientRect();x(Wd,V({x:fi.left,y:fi.bottom+5})),x($l,V(Da)),x(fc,!0)},_(ll);var Ai=v(ll,2),ca=v(y(Ai),2);ca.__click=ai=>{const fi=ai.currentTarget.getBoundingClientRect();x(Wd,V({x:fi.left,y:fi.bottom+5})),x($l,V(Da)),x(pp,!0)},_(Ai);var ui=v(Ai,2),bi=v(y(ui),2);bi.__click=ai=>{const fi=ai.currentTarget.getBoundingClientRect();x(Wd,V({x:fi.left,y:fi.bottom+5})),x($l,V(Da)),x(kd,!0)},_(ui),_(Ma),_(cu),Ce(()=>{Ot(Wa,"style",`background-color: ${i(er).styles.duty.color??""}`),Ot(rl,"style",`background-color: ${i(er).styles.dLine.color??""}`),Ot(ir,"style",`background-color: ${(i(er).styles.overboughtColor||"#EF4444")??""}`),Ot(ca,"style",`background-color: ${(i(er).styles.oversoldColor||"#10B981")??""}`),Ot(bi,"style",`background-color: ${(i(er).styles.midLineColor||"#6B7280")??""}`)}),Bs(ud,()=>i(er).kPeriod,ai=>i(er).kPeriod=ai),Bs(U,()=>i(er).dPeriod,ai=>i(er).dPeriod=ai),Bs(bs,()=>i(er).overboughtLevel,ai=>i(er).overboughtLevel=ai),Bs(_s,()=>i(er).oversoldLevel,ai=>i(er).oversoldLevel=ai),Bs(ia,()=>i(er).midLevel,ai=>i(er).midLevel=ai),xo(Ci,()=>i(er).styles.duty.thickness,ai=>i(er).styles.duty.thickness=ai),xo(Lo,()=>i(er).styles.duty.lineStyle,ai=>i(er).styles.duty.lineStyle=ai),xo(Cr,()=>i(er).styles.dLine.thickness,ai=>i(er).styles.dLine.thickness=ai),xo(ns,()=>i(er).styles.dLine.lineStyle,ai=>i(er).styles.dLine.lineStyle=ai),q(pa,cu)});var sa=v(jf,2),wi=y(sa);wi.__click=ng,_(sa),_(If),q(Id,If)},Id=>{var If=Qn(),jf=fn(If);Ue(jf,()=>i(Mc),sa=>{var wi=Mq(),pa=y(wi);Yo(pa,17,()=>i(ol),Ii,(cu,Va,ju)=>{var Bu=Pq(),oa=y(Bu),Ul=y(oa);Ul.textContent=`DMI ${ju+1}`;var ud=v(Ul,2);Ue(ud,()=>i(ol).length>1,Ti=>{var Di=Iq();Di.__click=[Cq,Hp,Va],q(Ti,Di)}),_(oa);var dl=v(oa,2),U=y(dl),Kt=v(y(U),2);xn(Kt),Kt.__input=Tc,_(U);var bs=v(U,2),Ds=v(y(bs),2);xn(Ds),Ds.__input=Tc,_(bs),_(dl);var _s=v(dl,2),zi=y(_s),ii=v(y(zi),2),ia=Bt(()=>yh(ju,"diPlus"));ii.__click=function(...Ti){var Di;(Di=i(ia))==null||Di.apply(this,Ti)};var $r=y(ii);_(ii);var rr=v(ii,2);rr.__change=Tc;var Jl=y(rr);Jl.value=(Jl.__value=1)==null?"":1;var Wa=v(Jl);Wa.value=(Wa.__value=2)==null?"":2;var Ci=v(Wa);Ci.value=(Ci.__value=3)==null?"":3;var Ha=v(Ci);Ha.value=(Ha.__value=4)==null?"":4;var ki=v(Ha);ki.value=(ki.__value=5)==null?"":5,_(rr);var ys=v(rr,2);ys.__change=Tc;var tr=y(ys);tr.value=(tr.__value="solid")==null?"":"solid";var Fo=v(tr);Fo.value=(Fo.__value="dashed")==null?"":"dashed";var Lo=v(Fo);Lo.value=(Lo.__value="dotted")==null?"":"dotted",_(ys),_(zi);var Gi=v(zi,2),Nr=v(y(Gi),2),Vi=Bt(()=>yh(ju,"diMinus"));Nr.__click=function(...Ti){var Di;(Di=i(Vi))==null||Di.apply(this,Ti)};var Ho=y(Nr);_(Nr);var Ar=v(Nr,2);Ar.__change=Tc;var ma=y(Ar);ma.value=(ma.__value=1)==null?"":1;var rl=v(ma);rl.value=(rl.__value=2)==null?"":2;var Cr=v(rl);Cr.value=(Cr.__value=3)==null?"":3;var Yi=v(Cr);Yi.value=(Yi.__value=4)==null?"":4;var ha=v(Yi);ha.value=(ha.__value=5)==null?"":5,_(Ar);var Dr=v(Ar,2);Dr.__change=Tc;var va=y(Dr);va.value=(va.__value="solid")==null?"":"solid";var al=v(va);al.value=(al.__value="dashed")==null?"":"dashed";var ns=v(al);ns.value=(ns.__value="dotted")==null?"":"dotted",_(Dr),_(Gi);var zs=v(Gi,2),Rs=v(y(zs),2),Ni=Bt(()=>yh(ju,"adx"));Rs.__click=function(...Ti){var Di;(Di=i(Ni))==null||Di.apply(this,Ti)};var Ma=y(Rs);_(Rs);var ll=v(Rs,2);ll.__change=Tc;var ir=y(ll);ir.value=(ir.__value=1)==null?"":1;var Ai=v(ir);Ai.value=(Ai.__value=2)==null?"":2;var ca=v(Ai);ca.value=(ca.__value=3)==null?"":3;var ui=v(ca);ui.value=(ui.__value=4)==null?"":4;var bi=v(ui);bi.value=(bi.__value=5)==null?"":5,_(ll);var ai=v(ll,2);ai.__change=Tc;var fi=y(ai);fi.value=(fi.__value="solid")==null?"":"solid";var ra=v(fi);ra.value=(ra.__value="dashed")==null?"":"dashed";var pr=v(ra);pr.value=(pr.__value="dotted")==null?"":"dotted",_(ai),_(zs),_(_s),_(Bu),Ce(()=>{Ot($r,"style",`background-color: ${i(Va).styles.diPlus.color??""}`),Ot(Ho,"style",`background-color: ${i(Va).styles.diMinus.color??""}`),Ot(Ma,"style",`background-color: ${i(Va).styles.adx.color??""}`)}),Bs(Kt,()=>i(Va).diPeriod,Ti=>i(Va).diPeriod=Ti),Bs(Ds,()=>i(Va).adxPeriod,Ti=>i(Va).adxPeriod=Ti),xo(rr,()=>i(Va).styles.diPlus.thickness,Ti=>i(Va).styles.diPlus.thickness=Ti),xo(ys,()=>i(Va).styles.diPlus.lineStyle,Ti=>i(Va).styles.diPlus.lineStyle=Ti),xo(Ar,()=>i(Va).styles.diMinus.thickness,Ti=>i(Va).styles.diMinus.thickness=Ti),xo(Dr,()=>i(Va).styles.diMinus.lineStyle,Ti=>i(Va).styles.diMinus.lineStyle=Ti),xo(ll,()=>i(Va).styles.adx.thickness,Ti=>i(Va).styles.adx.thickness=Ti),xo(ai,()=>i(Va).styles.adx.lineStyle,Ti=>i(Va).styles.adx.lineStyle=Ti),q(cu,Bu)});var er=v(pa,2),Da=y(er);Da.__click=[iq,Mc,ol,Tc],_(er),_(wi),q(sa,wi)},sa=>{var wi=Qn(),pa=fn(wi);Ue(pa,()=>i(Hd),er=>{var Da=Fq(),cu=y(Da);Yo(cu,17,()=>i(rc),Ii,(Bu,oa,Ul)=>{var ud=Tq(),dl=y(ud),U=y(dl);U.textContent=`Williams %R ${Ul+1}`;var Kt=v(U,2);Ue(Kt,()=>i(rc).length>1,_i=>{var da=Aq();da.__click=[Nq,og,oa],q(_i,da)}),_(dl);var bs=v(dl,2),Ds=y(bs),_s=v(y(Ds),2);xn(_s),_s.__change=()=>np(Ul),_(Ds);var zi=v(Ds,2),ii=v(y(zi),2);xn(ii),ii.__change=()=>np(Ul),_(zi);var ia=v(zi,2),$r=v(y(ia),2);xn($r),$r.__change=()=>np(Ul),_(ia);var rr=v(ia,2),Jl=v(y(rr),2);xn(Jl),Jl.__change=()=>np(Ul),_(rr),_(bs);var Wa=v(bs,2),Ci=y(Wa),Ha=v(y(Ci),2),ki=Bt(()=>cm(Ul));Ha.__click=function(..._i){var da;(da=i(ki))==null||da.apply(this,_i)};var ys=y(Ha);_(Ha);var tr=v(Ha,2);tr.__change=()=>np(Ul);var Fo=y(tr);Fo.value=(Fo.__value=1)==null?"":1;var Lo=v(Fo);Lo.value=(Lo.__value=2)==null?"":2;var Gi=v(Lo);Gi.value=(Gi.__value=3)==null?"":3;var Nr=v(Gi);Nr.value=(Nr.__value=4)==null?"":4;var Vi=v(Nr);Vi.value=(Vi.__value=5)==null?"":5,_(tr);var Ho=v(tr,2);Ho.__change=()=>np(Ul);var Ar=y(Ho);Ar.value=(Ar.__value="solid")==null?"":"solid";var ma=v(Ar);ma.value=(ma.__value="dashed")==null?"":"dashed";var rl=v(ma);rl.value=(rl.__value="dotted")==null?"":"dotted",_(Ho),_(Ci),_(Wa);var Cr=v(Wa,2),Yi=v(y(Cr),2),ha=v(y(Yi),2),Dr=Bt(()=>bh(Ul));ha.__click=function(..._i){var da;(da=i(Dr))==null||da.apply(this,_i)};var va=y(ha);_(ha);var al=v(ha,2);al.__change=()=>np(Ul);var ns=y(al);ns.value=(ns.__value=1)==null?"":1;var zs=v(ns);zs.value=(zs.__value=2)==null?"":2;var Rs=v(zs);Rs.value=(Rs.__value=3)==null?"":3;var Ni=v(Rs);Ni.value=(Ni.__value=4)==null?"":4;var Ma=v(Ni);Ma.value=(Ma.__value=5)==null?"":5,_(al);var ll=v(al,2);ll.__change=()=>np(Ul);var ir=y(ll);ir.value=(ir.__value="solid")==null?"":"solid";var Ai=v(ir);Ai.value=(Ai.__value="dashed")==null?"":"dashed";var ca=v(Ai);ca.value=(ca.__value="dotted")==null?"":"dotted",_(ll),_(Yi);var ui=v(Yi,2),bi=v(y(ui),2),ai=Bt(()=>ig(Ul));bi.__click=function(..._i){var da;(da=i(ai))==null||da.apply(this,_i)};var fi=y(bi);_(bi);var ra=v(bi,2);ra.__change=()=>np(Ul);var pr=y(ra);pr.value=(pr.__value=1)==null?"":1;var Ti=v(pr);Ti.value=(Ti.__value=2)==null?"":2;var Di=v(Ti);Di.value=(Di.__value=3)==null?"":3;var Sa=v(Di);Sa.value=(Sa.__value=4)==null?"":4;var Uo=v(Sa);Uo.value=(Uo.__value=5)==null?"":5,_(ra);var ga=v(ra,2);ga.__change=()=>np(Ul);var qr=y(ga);qr.value=(qr.__value="solid")==null?"":"solid";var Ri=v(qr);Ri.value=(Ri.__value="dashed")==null?"":"dashed";var Ka=v(Ri);Ka.value=(Ka.__value="dotted")==null?"":"dotted",_(ga),_(ui);var Jo=v(ui,2),Ki=v(y(Jo),2),ua=Bt(()=>cv(Ul));Ki.__click=function(..._i){var da;(da=i(ua))==null||da.apply(this,_i)};var Qr=y(Ki);_(Ki);var ar=v(Ki,2);ar.__change=()=>np(Ul);var _a=y(ar);_a.value=(_a.__value=1)==null?"":1;var Pl=v(_a);Pl.value=(Pl.__value=2)==null?"":2;var gr=v(Pl);gr.value=(gr.__value=3)==null?"":3;var Ur=v(gr);Ur.value=(Ur.__value=4)==null?"":4;var Ra=v(Ur);Ra.value=(Ra.__value=5)==null?"":5,_(ar);var xi=v(ar,2);xi.__change=()=>np(Ul);var Qs=y(xi);Qs.value=(Qs.__value="solid")==null?"":"solid";var ji=v(Qs);ji.value=(ji.__value="dashed")==null?"":"dashed";var qa=v(ji);qa.value=(qa.__value="dotted")==null?"":"dotted",_(xi),_(Jo),_(Cr),_(ud),Ce(()=>{Ot(ys,"style",`background-color: ${i(oa).styles.wr.color??""}`),Ot(va,"style",`background-color: ${i(oa).styles.overbought.color??""}`),Ot(fi,"style",`background-color: ${i(oa).styles.middleLine.color??""}`),Ot(Qr,"style",`background-color: ${i(oa).styles.oversold.color??""}`)}),Bs(_s,()=>i(oa).period,_i=>i(oa).period=_i),Bs(ii,()=>i(oa).overboughtLevel,_i=>i(oa).overboughtLevel=_i),Bs($r,()=>i(oa).middleLevel,_i=>i(oa).middleLevel=_i),Bs(Jl,()=>i(oa).oversoldLevel,_i=>i(oa).oversoldLevel=_i),xo(tr,()=>i(oa).styles.wr.thickness,_i=>i(oa).styles.wr.thickness=_i),xo(Ho,()=>i(oa).styles.wr.lineStyle,_i=>i(oa).styles.wr.lineStyle=_i),xo(al,()=>i(oa).styles.overbought.thickness,_i=>i(oa).styles.overbought.thickness=_i),xo(ll,()=>i(oa).styles.overbought.lineStyle,_i=>i(oa).styles.overbought.lineStyle=_i),xo(ra,()=>i(oa).styles.middleLine.thickness,_i=>i(oa).styles.middleLine.thickness=_i),xo(ga,()=>i(oa).styles.middleLine.lineStyle,_i=>i(oa).styles.middleLine.lineStyle=_i),xo(ar,()=>i(oa).styles.oversold.thickness,_i=>i(oa).styles.oversold.thickness=_i),xo(xi,()=>i(oa).styles.oversold.lineStyle,_i=>i(oa).styles.oversold.lineStyle=_i),q(Bu,ud)});var Va=v(cu,2),ju=y(Va);ju.__click=hh,_(Va),_(Da),q(er,Da)},er=>{var Da=Qn(),cu=fn(Da);Ue(cu,()=>i(hu),Va=>{var ju=$q(),Bu=y(ju);Yo(Bu,17,()=>i(Qc),Ii,(ud,dl,U)=>{var Kt=Eq(),bs=y(Kt),Ds=y(bs);Ds.textContent=`VR ${U+1}`;var _s=v(Ds,2);Ue(_s,()=>i(Qc).length>1,Qs=>{var ji=Lq();ji.__click=()=>de(U),q(Qs,ji)}),_(bs);var zi=v(bs,2),ii=y(zi),ia=v(y(ii),2);xn(ia),_(ii);var $r=v(ii,2),rr=v(y($r),2);xn(rr),_($r);var Jl=v($r,2),Wa=v(y(Jl),2);xn(Wa),_(Jl),_(zi);var Ci=v(zi,2),Ha=v(y(Ci),2),ki=y(Ha),ys=v(y(ki),2),tr=Bt(()=>Dp(U,"vr"));ys.__click=function(...Qs){var ji;(ji=i(tr))==null||ji.apply(this,Qs)};var Fo=y(ys);_(ys),_(ki);var Lo=v(ki,2),Gi=v(y(Lo),2);Gi.__change=()=>rt(U);var Nr=y(Gi);Nr.value=(Nr.__value=1)==null?"":1;var Vi=v(Nr);Vi.value=(Vi.__value=2)==null?"":2;var Ho=v(Vi);Ho.value=(Ho.__value=3)==null?"":3;var Ar=v(Ho);Ar.value=(Ar.__value=4)==null?"":4;var ma=v(Ar);ma.value=(ma.__value=5)==null?"":5,_(Gi),_(Lo);var rl=v(Lo,2),Cr=v(y(rl),2);Cr.__change=()=>rt(U);var Yi=y(Cr);Yi.value=(Yi.__value="solid")==null?"":"solid";var ha=v(Yi);ha.value=(ha.__value="dashed")==null?"":"dashed";var Dr=v(ha);Dr.value=(Dr.__value="dotted")==null?"":"dotted",_(Cr),_(rl),_(Ha),_(Ci);var va=v(Ci,2),al=v(y(va),2),ns=y(al),zs=v(y(ns),2),Rs=Bt(()=>Dp(U,"vrShort"));zs.__click=function(...Qs){var ji;(ji=i(Rs))==null||ji.apply(this,Qs)};var Ni=y(zs);_(zs),_(ns);var Ma=v(ns,2),ll=v(y(Ma),2);ll.__change=()=>rt(U);var ir=y(ll);ir.value=(ir.__value=1)==null?"":1;var Ai=v(ir);Ai.value=(Ai.__value=2)==null?"":2;var ca=v(Ai);ca.value=(ca.__value=3)==null?"":3;var ui=v(ca);ui.value=(ui.__value=4)==null?"":4;var bi=v(ui);bi.value=(bi.__value=5)==null?"":5,_(ll),_(Ma);var ai=v(Ma,2),fi=v(y(ai),2);fi.__change=()=>rt(U);var ra=y(fi);ra.value=(ra.__value="solid")==null?"":"solid";var pr=v(ra);pr.value=(pr.__value="dashed")==null?"":"dashed";var Ti=v(pr);Ti.value=(Ti.__value="dotted")==null?"":"dotted",_(fi),_(ai),_(al),_(va);var Di=v(va,2),Sa=v(y(Di),2),Uo=y(Sa),ga=v(y(Uo),2),qr=Bt(()=>Dp(U,"vrLong"));ga.__click=function(...Qs){var ji;(ji=i(qr))==null||ji.apply(this,Qs)};var Ri=y(ga);_(ga),_(Uo);var Ka=v(Uo,2),Jo=v(y(Ka),2);Jo.__change=()=>rt(U);var Ki=y(Jo);Ki.value=(Ki.__value=1)==null?"":1;var ua=v(Ki);ua.value=(ua.__value=2)==null?"":2;var Qr=v(ua);Qr.value=(Qr.__value=3)==null?"":3;var ar=v(Qr);ar.value=(ar.__value=4)==null?"":4;var _a=v(ar);_a.value=(_a.__value=5)==null?"":5,_(Jo),_(Ka);var Pl=v(Ka,2),gr=v(y(Pl),2);gr.__change=()=>rt(U);var Ur=y(gr);Ur.value=(Ur.__value="solid")==null?"":"solid";var Ra=v(Ur);Ra.value=(Ra.__value="dashed")==null?"":"dashed";var xi=v(Ra);xi.value=(xi.__value="dotted")==null?"":"dotted",_(gr),_(Pl),_(Sa),_(Di),_(Kt),Ce(()=>{Ot(Fo,"style",`background-color: ${i(dl).styles.vr.color??""}`),Ot(Ni,"style",`background-color: ${i(dl).styles.vrShort.color??""}`),Ot(Ri,"style",`background-color: ${i(dl).styles.vrLong.color??""}`)}),Bs(ia,()=>i(dl).period,Qs=>i(dl).period=Qs),Bs(rr,()=>i(dl).shortPeriod,Qs=>i(dl).shortPeriod=Qs),Bs(Wa,()=>i(dl).longPeriod,Qs=>i(dl).longPeriod=Qs),xo(Gi,()=>i(dl).styles.vr.thickness,Qs=>i(dl).styles.vr.thickness=Qs),xo(Cr,()=>i(dl).styles.vr.lineStyle,Qs=>i(dl).styles.vr.lineStyle=Qs),xo(ll,()=>i(dl).styles.vrShort.thickness,Qs=>i(dl).styles.vrShort.thickness=Qs),xo(fi,()=>i(dl).styles.vrShort.lineStyle,Qs=>i(dl).styles.vrShort.lineStyle=Qs),xo(Jo,()=>i(dl).styles.vrLong.thickness,Qs=>i(dl).styles.vrLong.thickness=Qs),xo(gr,()=>i(dl).styles.vrLong.lineStyle,Qs=>i(dl).styles.vrLong.lineStyle=Qs),q(ud,Kt)});var oa=v(Bu,2),Ul=y(oa);Ul.__click=ee,_(oa),_(ju),q(Va,ju)},Va=>{var ju=Qn(),Bu=fn(ju);Ue(Bu,()=>i(Jc),oa=>{var Ul=Bq(),ud=y(Ul);Yo(ud,17,()=>i(Nc),Ii,(Kt,bs,Ds)=>{var _s=jq(),zi=y(_s),ii=y(zi);ii.textContent=`BBI ${Ds+1}`;var ia=v(ii,2);Ue(ia,()=>i(Nc).length>1,Rs=>{var Ni=Rq();Ni.__click=[Dq,za,bs],q(Rs,Ni)}),_(zi);var $r=v(zi,2),rr=y($r),Jl=v(y(rr),2);xn(Jl),Jl.__change=()=>Lt(Ds),_(rr);var Wa=v(rr,2),Ci=v(y(Wa),2);xn(Ci),Ci.__change=()=>Lt(Ds),_(Wa);var Ha=v(Wa,2),ki=v(y(Ha),2);xn(ki),ki.__change=()=>Lt(Ds),_(Ha);var ys=v(Ha,2),tr=v(y(ys),2);xn(tr),tr.__change=()=>Lt(Ds),_(ys),_($r);var Fo=v($r,2),Lo=y(Fo),Gi=v(y(Lo),2),Nr=Bt(()=>Jh(Ds));Gi.__click=function(...Rs){var Ni;(Ni=i(Nr))==null||Ni.apply(this,Rs)};var Vi=y(Gi);_(Gi),_(Lo);var Ho=v(Lo,2),Ar=v(y(Ho),2);Ar.__change=()=>Lt(Ds);var ma=y(Ar);ma.value=(ma.__value=1)==null?"":1;var rl=v(ma);rl.value=(rl.__value=2)==null?"":2;var Cr=v(rl);Cr.value=(Cr.__value=3)==null?"":3;var Yi=v(Cr);Yi.value=(Yi.__value=4)==null?"":4;var ha=v(Yi);ha.value=(ha.__value=5)==null?"":5,_(Ar),_(Ho);var Dr=v(Ho,2),va=v(y(Dr),2);va.__change=()=>Lt(Ds);var al=y(va);al.value=(al.__value="solid")==null?"":"solid";var ns=v(al);ns.value=(ns.__value="dashed")==null?"":"dashed";var zs=v(ns);zs.value=(zs.__value="dotted")==null?"":"dotted",_(va),_(Dr),_(Fo),_(_s),Ce(()=>Ot(Vi,"style",`background-color: ${i(bs).color??""}`)),Bs(Jl,()=>i(bs).period1,Rs=>i(bs).period1=Rs),Bs(Ci,()=>i(bs).period2,Rs=>i(bs).period2=Rs),Bs(ki,()=>i(bs).period3,Rs=>i(bs).period3=Rs),Bs(tr,()=>i(bs).period4,Rs=>i(bs).period4=Rs),xo(Ar,()=>i(bs).thickness,Rs=>i(bs).thickness=Rs),xo(va,()=>i(bs).lineStyle,Rs=>i(bs).lineStyle=Rs),q(Kt,_s)});var dl=v(ud,2),U=y(dl);U.__click=ao,_(dl),_(Ul),q(oa,Ul)},oa=>{var Ul=Qn(),ud=fn(Ul);Ue(ud,()=>i(J),dl=>{var U=Wq(),Kt=y(U);Yo(Kt,17,()=>i(Pr),Ii,(_s,zi)=>{var ii=Vq(),ia=y(ii),$r=y(ia),rr=y($r,!0);_($r);var Jl=v($r,2);Ue(Jl,()=>i(Pr).length>1,ns=>{var zs=zq();zs.__click=[Oq,Cg,zi],q(ns,zs)}),_(ia);var Wa=v(ia,2),Ci=y(Wa),Ha=v(y(Ci),2);xn(Ha),_(Ci);var ki=v(Ci,2),ys=v(y(ki),2);xn(ys),_(ki),_(Wa);var tr=v(Wa,2),Fo=y(tr),Lo=v(y(Fo),2);Lo.__click=[lq,Pe,oe];var Gi=y(Lo);_(Lo),_(Fo);var Nr=v(Fo,2),Vi=v(y(Nr),2),Ho=y(Vi);Ho.value=(Ho.__value=1)==null?"":1;var Ar=v(Ho);Ar.value=(Ar.__value=2)==null?"":2;var ma=v(Ar);ma.value=(ma.__value=3)==null?"":3;var rl=v(ma);rl.value=(rl.__value=4)==null?"":4;var Cr=v(rl);Cr.value=(Cr.__value=5)==null?"":5,_(Vi),_(Nr);var Yi=v(Nr,2),ha=v(y(Yi),2),Dr=y(ha);Dr.value=(Dr.__value="solid")==null?"":"solid";var va=v(Dr);va.value=(va.__value="dashed")==null?"":"dashed";var al=v(va);al.value=(al.__value="dotted")==null?"":"dotted",_(ha),_(Yi),_(tr),_(ii),Ce(()=>{tt(rr,i(zi).name),Ot(Gi,"style",`background-color: ${i(zi).color??""}`)}),Bs(Ha,()=>i(zi).period,ns=>i(zi).period=ns),Bs(ys,()=>i(zi).period2,ns=>i(zi).period2=ns),xo(Vi,()=>i(zi).thickness,ns=>i(zi).thickness=ns),xo(ha,()=>i(zi).lineStyle,ns=>i(zi).lineStyle=ns),q(_s,ii)});var bs=v(Kt,2),Ds=y(bs);Ds.__click=[QH,J,Pr],_(bs),_(U),q(dl,U)},dl=>{var U=Qn(),Kt=fn(U);Ue(Kt,()=>i(Fe),bs=>{var Ds=Gq(),_s=y(Ds);Yo(_s,17,()=>i(Sr),Ii,(ia,$r,rr)=>{var Jl=Uq(),Wa=y(Jl),Ci=y(Wa),Ha=y(Ci,!0);_(Ci);var ki=v(Ci,2);Ue(ki,()=>i(Sr).length>1,Ni=>{var Ma=qq();Ma.__click=[Hq,ph,$r],q(Ni,Ma)}),_(Wa);var ys=v(Wa,2),tr=y(ys),Fo=v(y(tr),2);xn(Fo),Fo.__input=mh,_(tr),_(ys);var Lo=v(ys,2),Gi=y(Lo),Nr=v(y(Gi),2),Vi=Bt(()=>Gm(rr));Nr.__click=function(...Ni){var Ma;(Ma=i(Vi))==null||Ma.apply(this,Ni)};var Ho=y(Nr);_(Nr),_(Gi);var Ar=v(Gi,2),ma=v(y(Ar),2);ma.__change=mh;var rl=y(ma);rl.value=(rl.__value=1)==null?"":1;var Cr=v(rl);Cr.value=(Cr.__value=2)==null?"":2;var Yi=v(Cr);Yi.value=(Yi.__value=3)==null?"":3;var ha=v(Yi);ha.value=(ha.__value=4)==null?"":4;var Dr=v(ha);Dr.value=(Dr.__value=5)==null?"":5,_(ma),_(Ar);var va=v(Ar,2),al=v(y(va),2);al.__change=mh;var ns=y(al);ns.value=(ns.__value="solid")==null?"":"solid";var zs=v(ns);zs.value=(zs.__value="dashed")==null?"":"dashed";var Rs=v(zs);Rs.value=(Rs.__value="dotted")==null?"":"dotted",_(al),_(va),_(Lo),_(Jl),Ce(()=>{tt(Ha,i($r).name),Ot(Ho,"style",`background-color: ${i($r).color??""}`)}),Bs(Fo,()=>i($r).period,Ni=>i($r).period=Ni),xo(ma,()=>i($r).thickness,Ni=>i($r).thickness=Ni),xo(al,()=>i($r).lineStyle,Ni=>i($r).lineStyle=Ni),q(ia,Jl)});var zi=v(_s,2),ii=y(zi);ii.__click=[eq,Fe,Sr,mh],_(zi),_(Ds),q(bs,Ds)},bs=>{var Ds=Qn(),_s=fn(Ds);Ue(_s,()=>i(Ql),zi=>{var ii=Xq(),ia=y(ii);Yo(ia,17,()=>i(na),Ii,(Jl,Wa,Ci)=>{var Ha=Kq(),ki=y(Ha),ys=y(ki);ys.textContent=Ci===0?"Awesome Oscillator":`AO ${Ci+1}`;var tr=v(ys,2);tr.__click=[Yq,Um,Wa],_(ki);var Fo=v(ki,2),Lo=y(Fo),Gi=v(y(Lo),2);xn(Gi),Gi.__input=am,_(Lo);var Nr=v(Lo,2),Vi=v(y(Nr),2);xn(Vi),Vi.__input=am,_(Nr),_(Fo);var Ho=v(Fo,2),Ar=v(y(Ho),2),ma=y(Ar),rl=v(y(ma),2),Cr=y(rl),Yi=v(Cr,2),ha=Bt(()=>kp(Ci*3));Yi.__click=function(...bi){var ai;(ai=i(ha))==null||ai.apply(this,bi)};var Dr=y(Yi);_(Yi),_(rl),_(ma);var va=v(ma,2),al=v(y(va),2),ns=y(al),zs=v(ns,2),Rs=Bt(()=>kp(Ci*3+1));zs.__click=function(...bi){var ai;(ai=i(Rs))==null||ai.apply(this,bi)};var Ni=y(zs);_(zs),_(al),_(va);var Ma=v(va,2),ll=v(y(Ma),2),ir=y(ll),Ai=v(ir,2),ca=Bt(()=>kp(Ci*3+2));Ai.__click=function(...bi){var ai;(ai=i(ca))==null||ai.apply(this,bi)};var ui=y(Ai);_(Ai),_(ll),_(Ma),_(Ar),_(Ho),_(Ha),Ce(()=>{Ot(Cr,"style",`background-color: ${i(Wa).styles.increasing.color??""}`),Ot(Dr,"style",`background-color: ${i(Wa).styles.increasing.color??""}`),Ot(ns,"style",`background-color: ${i(Wa).styles.decreasing.color??""}`),Ot(Ni,"style",`background-color: ${i(Wa).styles.decreasing.color??""}`),Ot(ir,"style",`background-color: ${i(Wa).styles.reverse.color??""}`),Ot(ui,"style",`background-color: ${i(Wa).styles.reverse.color??""}`)}),Bs(Gi,()=>i(Wa).shortPeriod,bi=>i(Wa).shortPeriod=bi),Bs(Vi,()=>i(Wa).longPeriod,bi=>i(Wa).longPeriod=bi),q(Jl,Ha)});var $r=v(ia,2),rr=y($r);rr.__click=[aq,Ql,na,am],_($r),_(ii),q(zi,ii)},zi=>{var ii=Qn(),ia=fn(ii);Ue(ia,()=>i(be),$r=>{var rr=eU(),Jl=y(rr);Yo(Jl,17,()=>i(br),Ii,(Ha,ki,ys)=>{var tr=Qq(),Fo=y(tr),Lo=y(Fo);Lo.textContent=`CR ${ys+1}`;var Gi=v(Lo,2);Ue(Gi,()=>i(br).length>1,Xa=>{var Ju=Jq();Ju.__click=[Zq,Qi,ki],q(Xa,Ju)}),_(Fo);var Nr=v(Fo,2),Vi=y(Nr),Ho=v(y(Vi),2);xn(Ho),Ho.__input=vu,_(Vi);var Ar=v(Vi,2),ma=v(y(Ar),2);xn(ma),ma.__input=vu,_(Ar);var rl=v(Ar,2),Cr=v(y(rl),2);xn(Cr),Cr.__input=vu,_(rl);var Yi=v(rl,2),ha=v(y(Yi),2);xn(ha),ha.__input=vu,_(Yi);var Dr=v(Yi,2),va=v(y(Dr),2);xn(va),va.__input=vu,_(Dr),_(Nr);var al=v(Nr,2),ns=y(al),zs=v(y(ns),2),Rs=Bt(()=>Vl(ys,"cr"));zs.__click=function(...Xa){var Ju;(Ju=i(Rs))==null||Ju.apply(this,Xa)};var Ni=y(zs);_(zs);var Ma=v(zs,2);Ma.__change=vu;var ll=y(Ma);ll.value=(ll.__value=1)==null?"":1;var ir=v(ll);ir.value=(ir.__value=2)==null?"":2;var Ai=v(ir);Ai.value=(Ai.__value=3)==null?"":3;var ca=v(Ai);ca.value=(ca.__value=4)==null?"":4;var ui=v(ca);ui.value=(ui.__value=5)==null?"":5,_(Ma);var bi=v(Ma,2);bi.__change=vu;var ai=y(bi);ai.value=(ai.__value="solid")==null?"":"solid";var fi=v(ai);fi.value=(fi.__value="dashed")==null?"":"dashed";var ra=v(fi);ra.value=(ra.__value="dotted")==null?"":"dotted",_(bi),_(ns);var pr=v(ns,2),Ti=v(y(pr),2),Di=Bt(()=>Vl(ys,"ma1"));Ti.__click=function(...Xa){var Ju;(Ju=i(Di))==null||Ju.apply(this,Xa)};var Sa=y(Ti);_(Ti);var Uo=v(Ti,2);Uo.__change=vu;var ga=y(Uo);ga.value=(ga.__value=1)==null?"":1;var qr=v(ga);qr.value=(qr.__value=2)==null?"":2;var Ri=v(qr);Ri.value=(Ri.__value=3)==null?"":3;var Ka=v(Ri);Ka.value=(Ka.__value=4)==null?"":4;var Jo=v(Ka);Jo.value=(Jo.__value=5)==null?"":5,_(Uo);var Ki=v(Uo,2);Ki.__change=vu;var ua=y(Ki);ua.value=(ua.__value="solid")==null?"":"solid";var Qr=v(ua);Qr.value=(Qr.__value="dashed")==null?"":"dashed";var ar=v(Qr);ar.value=(ar.__value="dotted")==null?"":"dotted",_(Ki),_(pr);var _a=v(pr,2),Pl=v(y(_a),2),gr=Bt(()=>Vl(ys,"ma2"));Pl.__click=function(...Xa){var Ju;(Ju=i(gr))==null||Ju.apply(this,Xa)};var Ur=y(Pl);_(Pl);var Ra=v(Pl,2);Ra.__change=vu;var xi=y(Ra);xi.value=(xi.__value=1)==null?"":1;var Qs=v(xi);Qs.value=(Qs.__value=2)==null?"":2;var ji=v(Qs);ji.value=(ji.__value=3)==null?"":3;var qa=v(ji);qa.value=(qa.__value=4)==null?"":4;var _i=v(qa);_i.value=(_i.__value=5)==null?"":5,_(Ra);var da=v(Ra,2);da.__change=vu;var dr=y(da);dr.value=(dr.__value="solid")==null?"":"solid";var fl=v(dr);fl.value=(fl.__value="dashed")==null?"":"dashed";var kc=v(fl);kc.value=(kc.__value="dotted")==null?"":"dotted",_(da),_(_a);var Ml=v(_a,2),Nl=v(y(Ml),2),Gl=Bt(()=>Vl(ys,"ma3"));Nl.__click=function(...Xa){var Ju;(Ju=i(Gl))==null||Ju.apply(this,Xa)};var uu=y(Nl);_(Nl);var Sc=v(Nl,2);Sc.__change=vu;var Cc=y(Sc);Cc.value=(Cc.__value=1)==null?"":1;var du=v(Cc);du.value=(du.__value=2)==null?"":2;var Gc=v(du);Gc.value=(Gc.__value=3)==null?"":3;var bl=v(Gc);bl.value=(bl.__value=4)==null?"":4;var fu=v(bl);fu.value=(fu.__value=5)==null?"":5,_(Sc);var Pd=v(Sc,2);Pd.__change=vu;var hf=y(Pd);hf.value=(hf.__value="solid")==null?"":"solid";var yu=v(hf);yu.value=(yu.__value="dashed")==null?"":"dashed";var Bf=v(yu);Bf.value=(Bf.__value="dotted")==null?"":"dotted",_(Pd),_(Ml);var Su=v(Ml,2),Yc=v(y(Su),2),ea=Bt(()=>Vl(ys,"ma4"));Yc.__click=function(...Xa){var Ju;(Ju=i(ea))==null||Ju.apply(this,Xa)};var qf=y(Yc);_(Yc);var dd=v(Yc,2);dd.__change=vu;var pl=y(dd);pl.value=(pl.__value=1)==null?"":1;var vf=v(pl);vf.value=(vf.__value=2)==null?"":2;var lc=v(vf);lc.value=(lc.__value=3)==null?"":3;var Pf=v(lc);Pf.value=(Pf.__value=4)==null?"":4;var Gd=v(Pf);Gd.value=(Gd.__value=5)==null?"":5,_(dd);var af=v(dd,2);af.__change=vu;var fd=y(af);fd.value=(fd.__value="solid")==null?"":"solid";var Td=v(fd);Td.value=(Td.__value="dashed")==null?"":"dashed";var vp=v(Td);vp.value=(vp.__value="dotted")==null?"":"dotted",_(af),_(Su),_(al),_(tr),Ce(()=>{Ot(Ni,"style",`background-color: ${i(ki).styles.cr.color??""}`),Ot(Sa,"style",`background-color: ${i(ki).styles.ma1.color??""}`),Ot(Ur,"style",`background-color: ${i(ki).styles.ma2.color??""}`),Ot(uu,"style",`background-color: ${i(ki).styles.ma3.color??""}`),Ot(qf,"style",`background-color: ${i(ki).styles.ma4.color??""}`)}),Bs(Ho,()=>i(ki).crPeriod,Xa=>i(ki).crPeriod=Xa),Bs(ma,()=>i(ki).crMa1Period,Xa=>i(ki).crMa1Period=Xa),Bs(Cr,()=>i(ki).crMa2Period,Xa=>i(ki).crMa2Period=Xa),Bs(ha,()=>i(ki).crMa3Period,Xa=>i(ki).crMa3Period=Xa),Bs(va,()=>i(ki).crMa4Period,Xa=>i(ki).crMa4Period=Xa),xo(Ma,()=>i(ki).styles.cr.thickness,Xa=>i(ki).styles.cr.thickness=Xa),xo(bi,()=>i(ki).styles.cr.lineStyle,Xa=>i(ki).styles.cr.lineStyle=Xa),xo(Uo,()=>i(ki).styles.ma1.thickness,Xa=>i(ki).styles.ma1.thickness=Xa),xo(Ki,()=>i(ki).styles.ma1.lineStyle,Xa=>i(ki).styles.ma1.lineStyle=Xa),xo(Ra,()=>i(ki).styles.ma2.thickness,Xa=>i(ki).styles.ma2.thickness=Xa),xo(da,()=>i(ki).styles.ma2.lineStyle,Xa=>i(ki).styles.ma2.lineStyle=Xa),xo(Sc,()=>i(ki).styles.ma3.thickness,Xa=>i(ki).styles.ma3.thickness=Xa),xo(Pd,()=>i(ki).styles.ma3.lineStyle,Xa=>i(ki).styles.ma3.lineStyle=Xa),xo(dd,()=>i(ki).styles.ma4.thickness,Xa=>i(ki).styles.ma4.thickness=Xa),xo(af,()=>i(ki).styles.ma4.lineStyle,Xa=>i(ki).styles.ma4.lineStyle=Xa),q(Ha,tr)});var Wa=v(Jl,2),Ci=y(Wa);Ci.__click=[rq,be,br,vu],_(Wa),_(rr),q($r,rr)},$r=>{var rr=Qn(),Jl=fn(rr);Ue(Jl,()=>i(Xf),Wa=>{var Ci=nU(),Ha=y(Ci);Yo(Ha,17,()=>i(In),Ii,(tr,Fo,Lo)=>{var Gi=tU(),Nr=y(Gi),Vi=y(Nr);Vi.textContent=`ZigZag ${Lo+1}`,_(Nr);var Ho=v(Nr,2),Ar=y(Ho),ma=v(y(Ar),2);xn(ma),ma.__input=Cn,_(Ar);var rl=v(Ar,2),Cr=v(y(rl),2);xn(Cr),Cr.__input=Cn,_(rl),_(Ho);var Yi=v(Ho,2),ha=v(y(Yi),2),Dr=y(ha),va=v(y(Dr),2),al=y(va),ns=v(al,2);ns.__click=()=>Rn(Lo);var zs=y(ns);_(ns),_(va),_(Dr);var Rs=v(Dr,2),Ni=v(y(Rs),2);Ni.__change=Cn;var Ma=y(Ni);Ma.value=(Ma.__value=1)==null?"":1;var ll=v(Ma);ll.value=(ll.__value=2)==null?"":2;var ir=v(ll);ir.value=(ir.__value=3)==null?"":3;var Ai=v(ir);Ai.value=(Ai.__value=4)==null?"":4;var ca=v(Ai);ca.value=(ca.__value=5)==null?"":5,_(Ni),_(Rs);var ui=v(Rs,2),bi=v(y(ui),2);bi.__change=Cn;var ai=y(bi);ai.value=(ai.__value="solid")==null?"":"solid";var fi=v(ai);fi.value=(fi.__value="dashed")==null?"":"dashed";var ra=v(fi);ra.value=(ra.__value="dotted")==null?"":"dotted",_(bi),_(ui),_(ha),_(Yi),_(Gi),Ce(()=>{Ot(al,"style",`background-color: ${i(Fo).styles.color??""}`),Ot(zs,"style",`background-color: ${i(Fo).styles.color??""}`)}),Bs(ma,()=>i(Fo).deviation,pr=>i(Fo).deviation=pr),Bs(Cr,()=>i(Fo).depth,pr=>i(Fo).depth=pr),xo(Ni,()=>i(Fo).styles.thickness,pr=>i(Fo).styles.thickness=pr),xo(bi,()=>i(Fo).styles.lineStyle,pr=>i(Fo).styles.lineStyle=pr),q(tr,Gi)});var ki=v(Ha,2),ys=y(ki);ys.__click=[KH,In,Cn],_(ki),_(Ci),q(Wa,Ci)},Wa=>{var Ci=Qn(),Ha=fn(Ci);Ue(Ha,()=>i(ad),ki=>{var ys=iU(),tr=y(ys);Yo(tr,17,()=>i(Or),Ii,(Gi,Nr,Vi)=>{var Ho=oU(),Ar=y(Ho),ma=y(Ar),rl=y(ma);Ce(()=>tt(rl,`${i(Nr).name??""} (ID: ${i(Nr).id.slice(0,8)??""})`)),_(ma);var Cr=v(ma,2);Ue(Cr,()=>i(Or).length>1,fi=>{var ra=sU();ra.__click=()=>xd(Vi),q(fi,ra)}),_(Ar);var Yi=v(Ar,2),ha=y(Yi),Dr=v(y(ha),2),va=Bt(()=>Zh(Vi));Dr.__click=function(...fi){var ra;(ra=i(va))==null||ra.apply(this,fi)};var al=y(Dr);_(Dr),_(ha);var ns=v(ha,2),zs=v(y(ns),2);zs.__change=fi=>{fi.target&&(i(Nr).thickness=parseInt(fi.target.value),Im(Vi))};var Rs=y(zs);Rs.value=(Rs.__value=1)==null?"":1;var Ni=v(Rs);Ni.value=(Ni.__value=2)==null?"":2;var Ma=v(Ni);Ma.value=(Ma.__value=3)==null?"":3;var ll=v(Ma);ll.value=(ll.__value=4)==null?"":4;var ir=v(ll);ir.value=(ir.__value=5)==null?"":5,_(zs),_(ns);var Ai=v(ns,2),ca=v(y(Ai),2);ca.__change=fi=>{fi.target&&(i(Nr).lineStyle=fi.target.value,Im(Vi))};var ui=y(ca);ui.value=(ui.__value="solid")==null?"":"solid";var bi=v(ui);bi.value=(bi.__value="dashed")==null?"":"dashed";var ai=v(bi);ai.value=(ai.__value="dotted")==null?"":"dotted",_(ca),_(Ai),_(Yi),_(Ho),Ce(()=>Ot(al,"style",`background-color: ${i(Nr).color??""}`)),xo(zs,()=>i(Nr).thickness,fi=>i(Nr).thickness=fi),xo(ca,()=>i(Nr).lineStyle,fi=>i(Nr).lineStyle=fi),q(Gi,Ho)});var Fo=v(tr,2),Lo=y(Fo);Lo.__click=ff,_(Fo),_(ys),q(ki,ys)},ki=>{var ys=Qn(),tr=fn(ys);Ue(tr,()=>i(Bd),Fo=>{var Lo=cU(),Gi=y(Lo);Yo(Gi,17,()=>i(Hl),Ii,(Ho,Ar,ma)=>{var rl=lU(),Cr=y(rl),Yi=y(Cr);Yi.textContent=`SAR ${ma+1}`;var ha=v(Yi,2);Ue(ha,()=>i(Hl).length>1,Di=>{var Sa=aU();Sa.__click=[rU,Jd,Ar],q(Di,Sa)}),_(Cr);var Dr=v(Cr,2),va=y(Dr),al=v(y(va),2);xn(al),_(va);var ns=v(va,2),zs=v(y(ns),2);xn(zs),_(ns);var Rs=v(ns,2),Ni=v(y(Rs),2);xn(Ni),_(Rs),_(Dr);var Ma=v(Dr,2),ll=y(Ma),ir=v(y(ll),2),Ai=Bt(()=>Ev(ma));ir.__click=function(...Di){var Sa;(Sa=i(Ai))==null||Sa.apply(this,Di)};var ca=y(ir);_(ir),_(ll);var ui=v(ll,2),bi=v(y(ui),2),ai=y(bi);ai.value=(ai.__value=1)==null?"":1;var fi=v(ai);fi.value=(fi.__value=2)==null?"":2;var ra=v(fi);ra.value=(ra.__value=3)==null?"":3;var pr=v(ra);pr.value=(pr.__value=4)==null?"":4;var Ti=v(pr);Ti.value=(Ti.__value=5)==null?"":5,_(bi),_(ui),_(Ma),_(rl),Ce(()=>Ot(ca,"style",`background-color: ${i(Ar).color??""}`)),Bs(al,()=>i(Ar).start,Di=>i(Ar).start=Di),Bs(zs,()=>i(Ar).increment,Di=>i(Ar).increment=Di),Bs(Ni,()=>i(Ar).maxValue,Di=>i(Ar).maxValue=Di),xo(bi,()=>i(Ar).dotSize,Di=>i(Ar).dotSize=Di),q(Ho,rl)});var Nr=v(Gi,2),Vi=y(Nr);Vi.__click=[sq,Bd,Hl,Mo],_(Nr),_(Lo),q(Fo,Lo)},Fo=>{var Lo=Qn(),Gi=fn(Lo);Ue(Gi,()=>i(jt),Nr=>{var Vi=pU(),Ho=y(Vi);Yo(Ho,17,()=>i(Vc),Ii,(rl,Cr,Yi)=>{var ha=fU(),Dr=y(ha),va=y(Dr);va.textContent=`Smart Trend ${Yi+1}`;var al=v(va,2);Ue(al,()=>i(Vc).length>1,dr=>{var fl=dU();fl.__click=[uU,Zr,Cr],q(dr,fl)}),_(Dr);var ns=v(Dr,2),zs=y(ns),Rs=v(y(zs),2);xn(Rs),Rs.__change=()=>nc(Yi),_(zs);var Ni=v(zs,2),Ma=v(y(Ni),2);xn(Ma),Ma.__change=()=>nc(Yi),_(Ni),_(ns);var ll=v(ns,2),ir=y(ll);xn(ir),ir.__change=()=>nc(Yi),Zi(2),_(ll);var Ai=v(ll,2),ca=v(y(Ai),2),ui=y(ca),bi=v(y(ui),2);bi.__click=()=>{x(Fi,!0),x(Cu,V(Yi)),x(uc,"uptrend")};var ai=y(bi);_(bi),_(ui);var fi=v(ui,2),ra=v(y(fi),2);ra.__change=()=>nc(Yi);var pr=y(ra);pr.value=(pr.__value=1)==null?"":1;var Ti=v(pr);Ti.value=(Ti.__value=2)==null?"":2;var Di=v(Ti);Di.value=(Di.__value=3)==null?"":3;var Sa=v(Di);Sa.value=(Sa.__value=4)==null?"":4;var Uo=v(Sa);Uo.value=(Uo.__value=5)==null?"":5,_(ra),_(fi);var ga=v(fi,2),qr=v(y(ga),2);qr.__change=()=>nc(Yi);var Ri=y(qr);Ri.value=(Ri.__value="solid")==null?"":"solid";var Ka=v(Ri);Ka.value=(Ka.__value="dashed")==null?"":"dashed",_(qr),_(ga),_(ca),_(Ai);var Jo=v(Ai,2),Ki=v(y(Jo),2),ua=y(Ki),Qr=v(y(ua),2);Qr.__click=()=>{x(Fi,!0),x(Cu,V(Yi)),x(uc,"downtrend")};var ar=y(Qr);_(Qr),_(ua);var _a=v(ua,2),Pl=v(y(_a),2);Pl.__change=()=>nc(Yi);var gr=y(Pl);gr.value=(gr.__value=1)==null?"":1;var Ur=v(gr);Ur.value=(Ur.__value=2)==null?"":2;var Ra=v(Ur);Ra.value=(Ra.__value=3)==null?"":3;var xi=v(Ra);xi.value=(xi.__value=4)==null?"":4;var Qs=v(xi);Qs.value=(Qs.__value=5)==null?"":5,_(Pl),_(_a);var ji=v(_a,2),qa=v(y(ji),2);qa.__change=()=>nc(Yi);var _i=y(qa);_i.value=(_i.__value="solid")==null?"":"solid";var da=v(_i);da.value=(da.__value="dashed")==null?"":"dashed",_(qa),_(ji),_(Ki),_(Jo),_(ha),Ce(()=>{Ot(ai,"style",`background-color: ${i(Cr).styles.uptrend.color??""}`),Ot(ar,"style",`background-color: ${i(Cr).styles.downtrend.color??""}`)}),Bs(Rs,()=>i(Cr).period,dr=>i(Cr).period=dr),Bs(Ma,()=>i(Cr).multiplier,dr=>i(Cr).multiplier=dr),Uv(ir,()=>i(Cr).showLabels,dr=>i(Cr).showLabels=dr),xo(ra,()=>i(Cr).styles.uptrend.thickness,dr=>i(Cr).styles.uptrend.thickness=dr),xo(qr,()=>i(Cr).styles.uptrend.lineStyle,dr=>i(Cr).styles.uptrend.lineStyle=dr),xo(Pl,()=>i(Cr).styles.downtrend.thickness,dr=>i(Cr).styles.downtrend.thickness=dr),xo(qa,()=>i(Cr).styles.downtrend.lineStyle,dr=>i(Cr).styles.downtrend.lineStyle=dr),q(rl,ha)});var Ar=v(Ho,2),ma=y(Ar);ma.__click=[oq,jt,Vc,Hu],_(Ar),_(Vi),q(Nr,Vi)},Nr=>{var Vi=Qn(),Ho=fn(Vi);Ue(Ho,()=>i(Au),Ar=>{var ma=wU(),rl=y(ma);Yo(rl,17,()=>d,Ii,(Yi,ha,Dr)=>{var va=bU(),al=y(va),ns=y(al),zs=y(ns,!0);_(ns);var Rs=v(ns,2),Ni=y(Rs);xn(Ni),Ni.__change=[mU,_n];var Ma=v(Ni,2);Ue(Ma,()=>u.length>1,ir=>{var Ai=hU();Ai.__click=()=>sc(Dr),q(ir,Ai)},ir=>{var Ai=vU();q(ir,Ai)}),_(Rs),_(al);var ll=v(al,2);Ue(ll,()=>h[Dr],ir=>{var Ai=yU(),ca=y(Ai),ui=v(y(ca),2),bi=Bt(()=>$v(Dr));ui.__click=function(...Ki){var ua;(ua=i(bi))==null||ua.apply(this,Ki)};var ai=y(ui);_(ui),_(ca);var fi=v(ca,2),ra=v(y(fi),2);ra.__change=[gU,_n];var pr=y(ra);pr.value=(pr.__value=1)==null?"":1;var Ti=v(pr);Ti.value=(Ti.__value=2)==null?"":2;var Di=v(Ti);Di.value=(Di.__value=3)==null?"":3;var Sa=v(Di);Sa.value=(Sa.__value=4)==null?"":4;var Uo=v(Sa);Uo.value=(Uo.__value=5)==null?"":5,_(ra),_(fi);var ga=v(fi,2),qr=v(y(ga),2);qr.__change=[_U,_n];var Ri=y(qr);Ri.value=(Ri.__value="solid")==null?"":"solid";var Ka=v(Ri);Ka.value=(Ka.__value="dashed")==null?"":"dashed";var Jo=v(Ka);Jo.value=(Jo.__value="dotted")==null?"":"dotted",_(qr),_(ga),_(Ai),Ce(()=>Ot(ai,"style",`background-color: ${h[Dr].color??""}`)),xo(ra,()=>h[Dr].thickness,Ki=>h[Dr].thickness=Ki),xo(qr,()=>h[Dr].lineStyle,Ki=>h[Dr].lineStyle=Ki),q(ir,Ai)}),_(va),Ce(()=>tt(zs,i(ha).title)),Bs(Ni,()=>u[Dr],ir=>u[Dr]=ir),q(Yi,va)});var Cr=v(rl,2);Ue(Cr,()=>d.length<10,Yi=>{var ha=xU(),Dr=y(ha);Dr.__click=[Fb,Ku,Xu,ru,Ql,eu,Hd,Dh,Tu,Xm,d,u,h,Wu,Vn,Au,_n],_(ha),q(Yi,ha)}),_(ma),q(Ar,ma)},Ar=>{var ma=Qn(),rl=fn(ma);Ue(rl,()=>i(jd),Cr=>{var Yi=CU(),ha=y(Yi);Yo(ha,17,()=>i(Ji),Ii,(al,ns,zs)=>{var Rs=SU(),Ni=y(Rs),Ma=y(Ni),ll=y(Ma);_(Ma);var ir=v(Ma,2);Ue(ir,()=>i(Ji).length>1,ua=>{var Qr=kU();Qr.__click=()=>Os(zs),q(ua,Qr)}),_(Ni);var Ai=v(Ni,2),ca=v(y(Ai),2);xn(ca),ca.__change=()=>Js(zs),_(Ai);var ui=v(Ai,2),bi=y(ui),ai=v(y(bi),2);ai.__click=ua=>{x(Gu,V(zs));const Qr=ua.currentTarget.getBoundingClientRect();x(Oc,V({x:Qr.left+Qr.width/2,y:Qr.bottom+5})),x(Oa,!0)};var fi=y(ai);_(ai),_(bi);var ra=v(bi,2),pr=v(y(ra),2);pr.__change=()=>Js(zs);var Ti=y(pr);Ti.value=(Ti.__value=1)==null?"":1;var Di=v(Ti);Di.value=(Di.__value=2)==null?"":2;var Sa=v(Di);Sa.value=(Sa.__value=3)==null?"":3;var Uo=v(Sa);Uo.value=(Uo.__value=4)==null?"":4;var ga=v(Uo);ga.value=(ga.__value=5)==null?"":5,_(pr),_(ra);var qr=v(ra,2),Ri=v(y(qr),2);Ri.__change=()=>Js(zs);var Ka=y(Ri);Ka.value=(Ka.__value="solid")==null?"":"solid";var Jo=v(Ka);Jo.value=(Jo.__value="dashed")==null?"":"dashed";var Ki=v(Jo);Ki.value=(Ki.__value="dotted")==null?"":"dotted",_(Ri),_(qr),_(ui),_(Rs),Ce(()=>{tt(ll,`SMA (${i(ns).period??""})`),Ot(fi,"style",`background-color: ${i(ns).color??""}`)}),Bs(ca,()=>i(ns).period,ua=>i(ns).period=ua),xo(pr,()=>i(ns).thickness,ua=>i(ns).thickness=ua),xo(Ri,()=>i(ns).lineStyle,ua=>i(ns).lineStyle=ua),q(al,Rs)});var Dr=v(ha,2),va=y(Dr);va.__click=$o,_(Dr),_(Yi),q(Cr,Yi)},Cr=>{var Yi=Qn(),ha=fn(Yi);Ue(ha,()=>i(yd),Dr=>{var va=NU();Yo(va,21,()=>i(Mt),Ii,(al,ns,zs)=>{var Rs=MU(),Ni=y(Rs),Ma=y(Ni);Ma.textContent=`Volume ${zs+1}`;var ll=v(Ma,2);Ue(ll,()=>i(Mt).length>1,dr=>{var fl=IU();fl.__click=()=>He(zs),q(dr,fl)},dr=>{var fl=PU();q(dr,fl)}),_(Ni);var ir=v(Ni,2),Ai=y(ir),ca=v(y(Ai),2);xn(ca),ca.__change=()=>Qt(zs),_(Ai),_(ir);var ui=v(ir,2),bi=v(y(ui),2),ai=y(bi),fi=v(y(ai),2),ra=Bt(()=>Ym(zs,"histogram"));fi.__click=function(...dr){var fl;(fl=i(ra))==null||fl.apply(this,dr)};var pr=y(fi);_(fi),_(ai);var Ti=v(ai,2),Di=v(y(Ti),2),Sa=Bt(()=>Ym(zs,"histogram-down"));Di.__click=function(...dr){var fl;(fl=i(Sa))==null||fl.apply(this,dr)};var Uo=y(Di);_(Di),_(Ti),_(bi),_(ui);var ga=v(ui,2),qr=v(y(ga),2),Ri=y(qr);xn(Ri),Ri.__change=()=>Qt(zs),Zi(2),_(qr);var Ka=v(qr,2),Jo=y(Ka),Ki=v(y(Jo),2),ua=Bt(()=>Ym(zs,"ema"));Ki.__click=function(...dr){var fl;(fl=i(ua))==null||fl.apply(this,dr)};var Qr=y(Ki);_(Ki),_(Jo);var ar=v(Jo,2),_a=v(y(ar),2);_a.__change=()=>Qt(zs);var Pl=y(_a);Pl.value=(Pl.__value=1)==null?"":1;var gr=v(Pl);gr.value=(gr.__value=2)==null?"":2;var Ur=v(gr);Ur.value=(Ur.__value=3)==null?"":3;var Ra=v(Ur);Ra.value=(Ra.__value=4)==null?"":4;var xi=v(Ra);xi.value=(xi.__value=5)==null?"":5,_(_a),_(ar);var Qs=v(ar,2),ji=v(y(Qs),2);ji.__change=()=>Qt(zs);var qa=y(ji);qa.value=(qa.__value="solid")==null?"":"solid";var _i=v(qa);_i.value=(_i.__value="dashed")==null?"":"dashed";var da=v(_i);da.value=(da.__value="dotted")==null?"":"dotted",_(ji),_(Qs),_(Ka),_(ga),_(Rs),Ce(()=>{Ot(pr,"style",`background-color: ${i(ns).styles.histogram.upColor??""}`),Ot(Uo,"style",`background-color: ${i(ns).styles.histogram.downColor??""}`),Ot(Qr,"style",`background-color: ${i(ns).styles.ema.color??""}`)}),Bs(ca,()=>i(ns).period,dr=>i(ns).period=dr),Uv(Ri,()=>i(ns).styles.ema.visible,dr=>i(ns).styles.ema.visible=dr),xo(_a,()=>i(ns).styles.ema.thickness,dr=>i(ns).styles.ema.thickness=dr),xo(ji,()=>i(ns).styles.ema.lineStyle,dr=>i(ns).styles.ema.lineStyle=dr),q(al,Rs)}),_(va),q(Dr,va)},Dr=>{var va=Qn(),al=fn(va);Ue(al,()=>i(Tu),ns=>{var zs=LU(),Rs=y(zs);Yo(Rs,17,()=>i(Ac),Ii,(ll,ir,Ai)=>{var ca=TU(),ui=y(ca),bi=y(ui),ai=y(bi,!0);_(bi);var fi=v(bi,2);Ue(fi,()=>i(Ac).length>1,yu=>{var Bf=AU();Bf.__click=()=>Cl(Ai),q(yu,Bf)}),_(ui);var ra=v(ui,2),pr=y(ra),Ti=v(y(pr),2);xn(Ti),Ti.__input=()=>Qh(Ai),_(pr);var Di=v(pr,2),Sa=v(y(Di),2);xn(Sa),Sa.__input=()=>Qh(Ai),_(Di),_(ra);var Uo=v(ra,2),ga=y(Uo),qr=v(y(ga),2);_(ga);var Ri=v(ga,2),Ka=y(Ri),Jo=v(y(Ka),2);xn(Jo),Jo.__input=()=>Qh(Ai),_(Ka);var Ki=v(Ka,2),ua=v(y(Ki),2);ua.__change=()=>Qh(Ai);var Qr=y(ua);Qr.value=(Qr.__value=1)==null?"":1;var ar=v(Qr);ar.value=(ar.__value=2)==null?"":2;var _a=v(ar);_a.value=(_a.__value=3)==null?"":3;var Pl=v(_a);Pl.value=(Pl.__value=4)==null?"":4;var gr=v(Pl);gr.value=(gr.__value=5)==null?"":5,_(ua),_(Ki);var Ur=v(Ki,2),Ra=v(y(Ur),2);Ra.__change=()=>Qh(Ai);var xi=y(Ra);xi.value=(xi.__value="solid")==null?"":"solid";var Qs=v(xi);Qs.value=(Qs.__value="dashed")==null?"":"dashed";var ji=v(Qs);ji.value=(ji.__value="dotted")==null?"":"dotted",_(Ra),_(Ur),_(Ri),_(Uo);var qa=v(Uo,2),_i=y(qa),da=v(y(_i),2);_(_i);var dr=v(_i,2),fl=y(dr),kc=v(y(fl),2);xn(kc),kc.__input=()=>Qh(Ai),_(fl);var Ml=v(fl,2),Nl=v(y(Ml),2);Nl.__change=()=>Qh(Ai);var Gl=y(Nl);Gl.value=(Gl.__value=1)==null?"":1;var uu=v(Gl);uu.value=(uu.__value=2)==null?"":2;var Sc=v(uu);Sc.value=(Sc.__value=3)==null?"":3;var Cc=v(Sc);Cc.value=(Cc.__value=4)==null?"":4;var du=v(Cc);du.value=(du.__value=5)==null?"":5,_(Nl),_(Ml);var Gc=v(Ml,2),bl=v(y(Gc),2);bl.__change=()=>Qh(Ai);var fu=y(bl);fu.value=(fu.__value="solid")==null?"":"solid";var Pd=v(fu);Pd.value=(Pd.__value="dashed")==null?"":"dashed";var hf=v(Pd);hf.value=(hf.__value="dotted")==null?"":"dotted",_(bl),_(Gc),_(dr),_(qa),_(ca),Ce(()=>{tt(ai,i(ir).name),Ot(qr,"style",`background-color: ${i(ir).styles.trix.color??""}`),Ot(da,"style",`background-color: ${i(ir).styles.signal.color??""}`)}),Bs(Ti,()=>i(ir).trixPeriod,yu=>i(ir).trixPeriod=yu),Bs(Sa,()=>i(ir).signalPeriod,yu=>i(ir).signalPeriod=yu),Bs(Jo,()=>i(ir).styles.trix.color,yu=>i(ir).styles.trix.color=yu),xo(ua,()=>i(ir).styles.trix.thickness,yu=>i(ir).styles.trix.thickness=yu),xo(Ra,()=>i(ir).styles.trix.lineStyle,yu=>i(ir).styles.trix.lineStyle=yu),Bs(kc,()=>i(ir).styles.signal.color,yu=>i(ir).styles.signal.color=yu),xo(Nl,()=>i(ir).styles.signal.thickness,yu=>i(ir).styles.signal.thickness=yu),xo(bl,()=>i(ir).styles.signal.lineStyle,yu=>i(ir).styles.signal.lineStyle=yu),q(ll,ca)});var Ni=v(Rs,2),Ma=y(Ni);Ma.__click=[FU,yl],_(Ni),_(zs),q(ns,zs)},ns=>{var zs=Qn(),Rs=fn(zs);Ue(Rs,()=>i(Xu),Ni=>{var Ma=RU(),ll=y(Ma);Yo(ll,17,()=>i(io),Ii,(ca,ui,bi)=>{var ai=DU(),fi=y(ai),ra=y(fi);ra.textContent=`BIAS ${bi+1}`;var pr=v(ra,2);Ue(pr,()=>i(io).length>1,xi=>{var Qs=$U();Qs.__click=[EU,Ad,ui],q(xi,Qs)}),_(fi);var Ti=v(fi,2),Di=v(y(Ti),2);xn(Di),Di.__input=tc,_(Ti);var Sa=v(Ti,2),Uo=y(Sa),ga=v(y(Uo),2),qr=Bt(()=>bp(bi));ga.__click=function(...xi){var Qs;(Qs=i(qr))==null||Qs.apply(this,xi)};var Ri=y(ga);_(ga),_(Uo);var Ka=v(Uo,2),Jo=v(y(Ka),2);Jo.__change=tc;var Ki=y(Jo);Ki.value=(Ki.__value=1)==null?"":1;var ua=v(Ki);ua.value=(ua.__value=2)==null?"":2;var Qr=v(ua);Qr.value=(Qr.__value=3)==null?"":3;var ar=v(Qr);ar.value=(ar.__value=4)==null?"":4,_(Jo),_(Ka);var _a=v(Ka,2),Pl=v(y(_a),2);Pl.__change=tc;var gr=y(Pl);gr.value=(gr.__value="solid")==null?"":"solid";var Ur=v(gr);Ur.value=(Ur.__value="dashed")==null?"":"dashed";var Ra=v(Ur);Ra.value=(Ra.__value="dotted")==null?"":"dotted",_(Pl),_(_a),_(Sa),_(ai),Ce(()=>Ot(Ri,"style",`background-color: ${i(ui).color??""}`)),Bs(Di,()=>i(ui).period,xi=>i(ui).period=xi),xo(Jo,()=>i(ui).thickness,xi=>i(ui).thickness=xi),xo(Pl,()=>i(ui).lineStyle,xi=>i(ui).lineStyle=xi),q(ca,ai)});var ir=v(ll,2),Ai=y(ir);Ai.__click=[tq,Xu,io,tc],_(ir),_(Ma),q(Ni,Ma)},Ni=>{var Ma=Qn(),ll=fn(Ma);Ue(ll,()=>i(we),ir=>{var Ai=zU(),ca=y(Ai);Yo(ca,17,()=>i(ko),Ii,(ai,fi,ra)=>{var pr=OU(),Ti=y(pr),Di=y(Ti);Di.textContent=`CCI ${ra+1}`;var Sa=v(Di,2);Ue(Sa,()=>i(ko).length>1,qa=>{var _i=BU();_i.__click=[jU,Xp,fi],q(qa,_i)}),_(Ti);var Uo=v(Ti,2),ga=v(y(Uo),2);xn(ga),ga.__input=wd,_(Uo);var qr=v(Uo,2),Ri=y(qr),Ka=v(y(Ri),2),Jo=Bt(()=>lm(ra));Ka.__click=function(...qa){var _i;(_i=i(Jo))==null||_i.apply(this,qa)};var Ki=y(Ka);_(Ka),_(Ri);var ua=v(Ri,2),Qr=v(y(ua),2);Qr.__change=wd;var ar=y(Qr);ar.value=(ar.__value=1)==null?"":1;var _a=v(ar);_a.value=(_a.__value=2)==null?"":2;var Pl=v(_a);Pl.value=(Pl.__value=3)==null?"":3;var gr=v(Pl);gr.value=(gr.__value=4)==null?"":4,_(Qr),_(ua);var Ur=v(ua,2),Ra=v(y(Ur),2);Ra.__change=wd;var xi=y(Ra);xi.value=(xi.__value="solid")==null?"":"solid";var Qs=v(xi);Qs.value=(Qs.__value="dashed")==null?"":"dashed";var ji=v(Qs);ji.value=(ji.__value="dotted")==null?"":"dotted",_(Ra),_(Ur),_(qr),_(pr),Ce(()=>Ot(Ki,"style",`background-color: ${i(fi).color??""}`)),Bs(ga,()=>i(fi).period,qa=>i(fi).period=qa),xo(Qr,()=>i(fi).thickness,qa=>i(fi).thickness=qa),xo(Ra,()=>i(fi).lineStyle,qa=>i(fi).lineStyle=qa),q(ai,pr)});var ui=v(ca,2),bi=y(ui);bi.__click=[nq,we,ko,wd],_(ui),_(Ai),q(ir,Ai)},ir=>{var Ai=Qn(),ca=fn(Ai);Ue(ca,()=>i(sf),ui=>{var bi=qU(),ai=y(bi),fi=v(y(ai),2);Yo(fi,21,()=>i(zd),Ii,(Ti,Di,Sa)=>{var Uo=HU(),ga=y(Uo),qr=y(ga),Ri=y(qr,!0);_(qr);var Ka=v(qr,2);Ue(Ka,()=>i(zd).length>1,Ki=>{var ua=VU();ua.__click=()=>gh(Sa),q(Ki,ua)}),_(ga);var Jo=v(ga,4);Yo(Jo,17,()=>d,Ii,(Ki,ua,Qr)=>{var ar=WU(),_a=y(ar),Pl=y(_a),gr=v(Pl,2),Ur=y(gr,!0);_(gr),_(_a);var Ra=v(_a,2),xi=v(y(Ra),2);xn(xi),xi.__change=()=>qm(),_(Ra);var Qs=v(Ra,2),ji=v(y(Qs),2),qa=Bt(()=>Km(Qr,Sa));ji.__click=function(...bl){var fu;(fu=i(qa))==null||fu.apply(this,bl)};var _i=y(ji);_(ji),_(Qs);var da=v(Qs,2),dr=v(y(da),2);dr.__change=()=>qm();var fl=y(dr);fl.value=(fl.__value=1)==null?"":1;var kc=v(fl);kc.value=(kc.__value=2)==null?"":2;var Ml=v(kc);Ml.value=(Ml.__value=3)==null?"":3;var Nl=v(Ml);Nl.value=(Nl.__value=4)==null?"":4;var Gl=v(Nl);Gl.value=(Gl.__value=5)==null?"":5,_(dr),_(da);var uu=v(da,2),Sc=v(y(uu),2);Sc.__change=()=>qm();var Cc=y(Sc);Cc.value=(Cc.__value="solid")==null?"":"solid";var du=v(Cc);du.value=(du.__value="dashed")==null?"":"dashed";var Gc=v(du);Gc.value=(Gc.__value="dotted")==null?"":"dotted",_(Sc),_(uu),_(ar),Ce(()=>{var bl,fu;Ot(Pl,"style",`background-color: ${((bl=i(Di).styles[Qr])==null?void 0:bl.color)??""}`),tt(Ur,i(ua).title),Ot(_i,"style",`background-color: ${((fu=i(Di).styles[Qr])==null?void 0:fu.color)??""}`)}),Bs(xi,()=>i(Di).params[Qr],bl=>i(Di).params[Qr]=bl),xo(dr,()=>i(Di).styles[Qr].thickness,bl=>i(Di).styles[Qr].thickness=bl),xo(Sc,()=>i(Di).styles[Qr].lineStyle,bl=>i(Di).styles[Qr].lineStyle=bl),q(Ki,ar)}),_(Uo),Ce(()=>tt(Ri,i(Di).name)),q(Ti,Uo)}),_(fi);var ra=v(fi,2),pr=y(ra);pr.__click=Lv,_(ra),Zi(2),_(ai),_(bi),q(ui,bi)},ui=>{var bi=Qn(),ai=fn(bi);Ue(ai,()=>i(jd),fi=>{var ra=XU(),pr=y(ra);Yo(pr,17,()=>d,Ii,(Di,Sa,Uo)=>{var ga=YU(),qr=y(ga),Ri=y(qr),Ka=y(Ri,!0);_(Ri);var Jo=v(Ri,2),Ki=y(Jo);xn(Ki);var ua=v(Ki,2);Ue(ua,()=>u.length>1,Nl=>{var Gl=UU();Gl.__click=()=>sc(Uo),q(Nl,Gl)},Nl=>{var Gl=GU();q(Nl,Gl)}),_(Jo),_(qr);var Qr=v(qr,2),ar=y(Qr),_a=v(y(ar),2),Pl=Bt(()=>rg(Uo));_a.__click=function(...Nl){var Gl;(Gl=i(Pl))==null||Gl.apply(this,Nl)};var gr=y(_a);_(_a),_(ar);var Ur=v(ar,2),Ra=v(y(Ur),2),xi=y(Ra);xi.value=(xi.__value=1)==null?"":1;var Qs=v(xi);Qs.value=(Qs.__value=2)==null?"":2;var ji=v(Qs);ji.value=(ji.__value=3)==null?"":3;var qa=v(ji);qa.value=(qa.__value=4)==null?"":4;var _i=v(qa);_i.value=(_i.__value=5)==null?"":5,_(Ra),_(Ur);var da=v(Ur,2),dr=v(y(da),2),fl=y(dr);fl.value=(fl.__value="solid")==null?"":"solid";var kc=v(fl);kc.value=(kc.__value="dashed")==null?"":"dashed";var Ml=v(kc);Ml.value=(Ml.__value="dotted")==null?"":"dotted",_(dr),_(da),_(Qr),_(ga),Ce(()=>{tt(Ka,i(Sa).title),Ot(gr,"style",`background-color: ${h[Uo].color??""}`)}),Bs(Ki,()=>u[Uo],Nl=>u[Uo]=Nl),xo(Ra,()=>h[Uo].thickness,Nl=>h[Uo].thickness=Nl),xo(dr,()=>h[Uo].lineStyle,Nl=>h[Uo].lineStyle=Nl),q(Di,ga)});var Ti=v(pr,2);Ue(Ti,()=>d.length<10,Di=>{var Sa=KU(),Uo=y(Sa);Uo.__click=[Fb,Ku,Xu,ru,Ql,eu,Hd,Dh,Tu,Xm,d,u,h,Wu,Vn,Au,_n],_(Sa),q(Di,Sa)}),_(ra),q(fi,ra)},fi=>{var ra=Qn(),pr=fn(ra);Ue(pr,()=>i(Wu),Ti=>{var Di=iG(),Sa=y(Di);Yo(Sa,17,()=>d,Ii,(ga,qr,Ri)=>{var Ka=sG(),Jo=y(Ka),Ki=y(Jo),ua=y(Ki,!0);_(Ki);var Qr=v(Ki,2),ar=y(Qr);xn(ar),ar.__change=[ZU,Vn];var _a=v(ar,2);Ue(_a,()=>u.length>1,gr=>{var Ur=JU();Ur.__click=()=>sc(Ri),q(gr,Ur)},gr=>{var Ur=QU();q(gr,Ur)}),_(Qr),_(Jo);var Pl=v(Jo,2);Ue(Pl,()=>h[Ri],gr=>{var Ur=nG(),Ra=y(Ur),xi=v(y(Ra),2),Qs=Bt(()=>uv(Ri));xi.__click=function(...du){var Gc;(Gc=i(Qs))==null||Gc.apply(this,du)};var ji=y(xi);_(xi),_(Ra);var qa=v(Ra,2),_i=v(y(qa),2);_i.__change=[eG,Vn];var da=y(_i);da.value=(da.__value=1)==null?"":1;var dr=v(da);dr.value=(dr.__value=2)==null?"":2;var fl=v(dr);fl.value=(fl.__value=3)==null?"":3;var kc=v(fl);kc.value=(kc.__value=4)==null?"":4;var Ml=v(kc);Ml.value=(Ml.__value=5)==null?"":5,_(_i),_(qa);var Nl=v(qa,2),Gl=v(y(Nl),2);Gl.__change=[tG,Vn];var uu=y(Gl);uu.value=(uu.__value="solid")==null?"":"solid";var Sc=v(uu);Sc.value=(Sc.__value="dashed")==null?"":"dashed";var Cc=v(Sc);Cc.value=(Cc.__value="dotted")==null?"":"dotted",_(Gl),_(Nl),_(Ur),Ce(()=>Ot(ji,"style",`background-color: ${h[Ri].color??""}`)),xo(_i,()=>h[Ri].thickness,du=>h[Ri].thickness=du),xo(Gl,()=>h[Ri].lineStyle,du=>h[Ri].lineStyle=du),q(gr,Ur)}),_(Ka),Ce(()=>tt(ua,i(qr).title)),Bs(ar,()=>u[Ri],gr=>u[Ri]=gr),q(ga,Ka)});var Uo=v(Sa,2);Ue(Uo,()=>d.length<10,ga=>{var qr=oG(),Ri=y(qr);Ri.__click=[Fb,Ku,Xu,ru,Ql,eu,Hd,Dh,Tu,Xm,d,u,h,Wu,Vn,Au,_n],_(qr),q(ga,qr)}),_(Di),q(Ti,Di)},Ti=>{var Di=Qn(),Sa=fn(Di);Ue(Sa,()=>i(qd),Uo=>{var ga=cG(),qr=y(ga);Yo(qr,17,()=>i(fa),Ii,(Jo,Ki,ua)=>{var Qr=lG(),ar=y(Qr),_a=y(ar);_a.textContent=`ROC ${ua+1}`;var Pl=v(_a,2);Ue(Pl,()=>i(fa).length>1,bl=>{var fu=aG();fu.__click=[rG,vh,Ki],q(bl,fu)}),_(ar);var gr=v(ar,2),Ur=y(gr),Ra=v(y(Ur),2);xn(Ra),Ra.__change=()=>Zp(ua),_(Ur);var xi=v(Ur,2),Qs=y(xi),ji=v(y(Qs),2),qa=Bt(()=>yv(ua));ji.__click=function(...bl){var fu;(fu=i(qa))==null||fu.apply(this,bl)};var _i=y(ji);_(ji),_(Qs);var da=v(Qs,2),dr=v(y(da),2);dr.__change=()=>Zp(ua);var fl=y(dr);fl.value=(fl.__value=1)==null?"":1;var kc=v(fl);kc.value=(kc.__value=2)==null?"":2;var Ml=v(kc);Ml.value=(Ml.__value=3)==null?"":3;var Nl=v(Ml);Nl.value=(Nl.__value=4)==null?"":4;var Gl=v(Nl);Gl.value=(Gl.__value=5)==null?"":5,_(dr),_(da);var uu=v(da,2),Sc=v(y(uu),2);Sc.__change=()=>Zp(ua);var Cc=y(Sc);Cc.value=(Cc.__value="solid")==null?"":"solid";var du=v(Cc);du.value=(du.__value="dashed")==null?"":"dashed";var Gc=v(du);Gc.value=(Gc.__value="dotted")==null?"":"dotted",_(Sc),_(uu),_(xi),_(gr),_(Qr),Ce(()=>Ot(_i,"style",`background-color: ${i(Ki).styles.roc.color??""}`)),Bs(Ra,()=>i(Ki).period,bl=>i(Ki).period=bl),xo(dr,()=>i(Ki).styles.roc.thickness,bl=>i(Ki).styles.roc.thickness=bl),xo(Sc,()=>i(Ki).styles.roc.lineStyle,bl=>i(Ki).styles.roc.lineStyle=bl),q(Jo,Qr)});var Ri=v(qr,2),Ka=y(Ri);Ka.__click=ym,_(Ri),_(ga),q(Uo,ga)},Uo=>{var ga=Qn(),qr=fn(ga);Ue(qr,()=>i(Vf),Ri=>{var Ka=pG(),Jo=y(Ka);Yo(Jo,17,()=>i(Xr),Ii,(Qr,ar,_a)=>{var Pl=fG(),gr=y(Pl),Ur=y(gr);Ur.textContent=`PSY ${_a+1}`;var Ra=v(Ur,2);Ue(Ra,()=>i(Xr).length>1,Fc=>{var Mf=dG();Mf.__click=[uG,Eh,ar],q(Fc,Mf)}),_(gr);var xi=v(gr,2),Qs=y(xi),ji=v(y(Qs),2);xn(ji),ji.__change=()=>Hf(_a),_(Qs);var qa=v(Qs,2),_i=v(y(qa),2),da=y(_i),dr=v(y(da),2),fl=Bt(()=>op(_a*2));dr.__click=function(...Fc){var Mf;(Mf=i(fl))==null||Mf.apply(this,Fc)};var kc=y(dr);_(dr),_(da);var Ml=v(da,2),Nl=v(y(Ml),2);Nl.__change=()=>Hf(_a);var Gl=y(Nl);Gl.value=(Gl.__value=1)==null?"":1;var uu=v(Gl);uu.value=(uu.__value=2)==null?"":2;var Sc=v(uu);Sc.value=(Sc.__value=3)==null?"":3;var Cc=v(Sc);Cc.value=(Cc.__value=4)==null?"":4;var du=v(Cc);du.value=(du.__value=5)==null?"":5,_(Nl),_(Ml);var Gc=v(Ml,2),bl=v(y(Gc),2);bl.__change=()=>Hf(_a);var fu=y(bl);fu.value=(fu.__value="solid")==null?"":"solid";var Pd=v(fu);Pd.value=(Pd.__value="dashed")==null?"":"dashed";var hf=v(Pd);hf.value=(hf.__value="dotted")==null?"":"dotted",_(bl),_(Gc),_(_i),_(qa);var yu=v(qa,2),Bf=v(y(yu),2);xn(Bf),Bf.__change=()=>Hf(_a),_(yu);var Su=v(yu,2),Yc=v(y(Su),2),ea=y(Yc),qf=v(y(ea),2),dd=Bt(()=>op(_a*2+1));qf.__click=function(...Fc){var Mf;(Mf=i(dd))==null||Mf.apply(this,Fc)};var pl=y(qf);_(qf),_(ea);var vf=v(ea,2),lc=v(y(vf),2);lc.__change=()=>Hf(_a);var Pf=y(lc);Pf.value=(Pf.__value=1)==null?"":1;var Gd=v(Pf);Gd.value=(Gd.__value=2)==null?"":2;var af=v(Gd);af.value=(af.__value=3)==null?"":3;var fd=v(af);fd.value=(fd.__value=4)==null?"":4;var Td=v(fd);Td.value=(Td.__value=5)==null?"":5,_(lc),_(vf);var vp=v(vf,2),Xa=v(y(vp),2);Xa.__change=()=>Hf(_a);var Ju=y(Xa);Ju.value=(Ju.__value="solid")==null?"":"solid";var Bp=v(Ju);Bp.value=(Bp.__value="dashed")==null?"":"dashed";var Zf=v(Bp);Zf.value=(Zf.__value="dotted")==null?"":"dotted",_(Xa),_(vp),_(Yc),_(Su);var ap=v(Su,2),wp=y(ap);xn(wp),wp.__change=()=>Hf(_a);var fm=v(wp,2);_(ap),_(xi),_(Pl),Ce(()=>{Ot(kc,"style",`background-color: ${i(ar).styles.psy.color??""}`),Ot(pl,"style",`background-color: ${i(ar).styles.mapsy.color??""}`),Ot(wp,"id",`showMapsy_${i(ar).id??""}`),Ot(fm,"for",`showMapsy_${i(ar).id??""}`)}),Bs(ji,()=>i(ar).psyPeriod,Fc=>i(ar).psyPeriod=Fc),xo(Nl,()=>i(ar).styles.psy.thickness,Fc=>i(ar).styles.psy.thickness=Fc),xo(bl,()=>i(ar).styles.psy.lineStyle,Fc=>i(ar).styles.psy.lineStyle=Fc),Bs(Bf,()=>i(ar).mapsyPeriod,Fc=>i(ar).mapsyPeriod=Fc),xo(lc,()=>i(ar).styles.mapsy.thickness,Fc=>i(ar).styles.mapsy.thickness=Fc),xo(Xa,()=>i(ar).styles.mapsy.lineStyle,Fc=>i(ar).styles.mapsy.lineStyle=Fc),Uv(wp,()=>i(ar).showMapsy,Fc=>i(ar).showMapsy=Fc),q(Qr,Pl)});var Ki=v(Jo,2),ua=y(Ki);ua.__click=bm,_(Ki),_(Ka),q(Ri,Ka)},Ri=>{var Ka=Qn(),Jo=fn(Ka);Ue(Jo,()=>i(se),Ki=>{var ua=gG(),Qr=y(ua);Yo(Qr,17,()=>i(cr),Ii,(Pl,gr,Ur)=>{var Ra=vG(),xi=y(Ra),Qs=y(xi);Qs.textContent=`OBV ${Ur+1}`;var ji=v(Qs,2);Ue(ji,()=>i(cr).length>1,Fc=>{var Mf=hG();Mf.__click=[mG,Yh,gr],q(Fc,Mf)}),_(xi);var qa=v(xi,2),_i=y(qa),da=v(y(_i),2);xn(da),da.__input=rm,_(_i);var dr=v(_i,2),fl=v(y(dr),2),kc=y(fl),Ml=v(y(kc),2),Nl=Bt(()=>Xh(Ur*2));Ml.__click=function(...Fc){var Mf;(Mf=i(Nl))==null||Mf.apply(this,Fc)};var Gl=y(Ml);_(Ml),_(kc);var uu=v(kc,2),Sc=v(y(uu),2);Sc.__change=rm;var Cc=y(Sc);Cc.value=(Cc.__value=1)==null?"":1;var du=v(Cc);du.value=(du.__value=2)==null?"":2;var Gc=v(du);Gc.value=(Gc.__value=3)==null?"":3;var bl=v(Gc);bl.value=(bl.__value=4)==null?"":4;var fu=v(bl);fu.value=(fu.__value=5)==null?"":5,_(Sc),_(uu);var Pd=v(uu,2),hf=v(y(Pd),2);hf.__change=rm;var yu=y(hf);yu.value=(yu.__value="solid")==null?"":"solid";var Bf=v(yu);Bf.value=(Bf.__value="dashed")==null?"":"dashed";var Su=v(Bf);Su.value=(Su.__value="dotted")==null?"":"dotted",_(hf),_(Pd),_(fl),_(dr);var Yc=v(dr,2),ea=v(y(Yc),2);xn(ea),ea.__input=rm,Zi(2),_(Yc);var qf=v(Yc,2),dd=v(y(qf),2),pl=y(dd),vf=v(y(pl),2),lc=Bt(()=>Xh(Ur*2+1));vf.__click=function(...Fc){var Mf;(Mf=i(lc))==null||Mf.apply(this,Fc)};var Pf=y(vf);_(vf),_(pl);var Gd=v(pl,2),af=v(y(Gd),2);af.__change=rm;var fd=y(af);fd.value=(fd.__value=1)==null?"":1;var Td=v(fd);Td.value=(Td.__value=2)==null?"":2;var vp=v(Td);vp.value=(vp.__value=3)==null?"":3;var Xa=v(vp);Xa.value=(Xa.__value=4)==null?"":4;var Ju=v(Xa);Ju.value=(Ju.__value=5)==null?"":5,_(af),_(Gd);var Bp=v(Gd,2),Zf=v(y(Bp),2);Zf.__change=rm;var ap=y(Zf);ap.value=(ap.__value="solid")==null?"":"solid";var wp=v(ap);wp.value=(wp.__value="dashed")==null?"":"dashed";var fm=v(wp);fm.value=(fm.__value="dotted")==null?"":"dotted",_(Zf),_(Bp),_(dd),_(qf),_(qa),_(Ra),Ce(()=>{Ot(Gl,"style",`background-color: ${i(gr).styles.obv.color??""}`),Ot(Pf,"style",`background-color: ${i(gr).styles.maobv.color??""}`)}),Bs(da,()=>i(gr).obvPeriod,Fc=>i(gr).obvPeriod=Fc),xo(Sc,()=>i(gr).styles.obv.thickness,Fc=>i(gr).styles.obv.thickness=Fc),xo(hf,()=>i(gr).styles.obv.lineStyle,Fc=>i(gr).styles.obv.lineStyle=Fc),Bs(ea,()=>i(gr).maobvPeriod,Fc=>i(gr).maobvPeriod=Fc),xo(af,()=>i(gr).styles.maobv.thickness,Fc=>i(gr).styles.maobv.thickness=Fc),xo(Zf,()=>i(gr).styles.maobv.lineStyle,Fc=>i(gr).styles.maobv.lineStyle=Fc),q(Pl,Ra)});var ar=v(Qr,2),_a=y(ar);_a.__click=Wm,_(ar),_(ua),q(Ki,ua)},Ki=>{var ua=Qn(),Qr=fn(ua);Ue(Qr,()=>i(re),ar=>{var _a=xG(),Pl=y(_a);Yo(Pl,17,()=>i(us),Ii,(Ra,xi,Qs)=>{var ji=bG(),qa=y(ji),_i=y(qa);_i.textContent=`KDJ ${Qs+1}`;var da=v(_i,2);Ue(da,()=>i(us).length>1,pd=>{var te=yG();te.__click=[_G,Du,xi],q(pd,te)}),_(qa);var dr=v(qa,2),fl=y(dr),kc=y(fl),Ml=v(y(kc),2);xn(Ml),Ml.__input=pd=>{pd.target&&(console.log("📊 K Period changed to:",pd.target.value,"for group:",Qs),hp(Qs))},_(kc);var Nl=v(kc,2),Gl=v(y(Nl),2);xn(Gl),Gl.__input=pd=>{pd.target&&(console.log("📊 D Period changed to:",pd.target.value,"for group:",Qs),hp(Qs))},_(Nl),_(fl);var uu=v(fl,2),Sc=v(y(uu),2),Cc=v(y(Sc),2),du=Bt(()=>km(Qs,0));Cc.__click=function(...pd){var te;(te=i(du))==null||te.apply(this,pd)};var Gc=y(Cc);_(Cc);var bl=v(Cc,2);bl.__change=()=>hp(Qs);var fu=y(bl);fu.value=(fu.__value=1)==null?"":1;var Pd=v(fu);Pd.value=(Pd.__value=2)==null?"":2;var hf=v(Pd);hf.value=(hf.__value=3)==null?"":3;var yu=v(hf);yu.value=(yu.__value=4)==null?"":4;var Bf=v(yu);Bf.value=(Bf.__value=5)==null?"":5,_(bl);var Su=v(bl,2);Su.__change=()=>hp(Qs);var Yc=y(Su);Yc.value=(Yc.__value="solid")==null?"":"solid";var ea=v(Yc);ea.value=(ea.__value="dashed")==null?"":"dashed";var qf=v(ea);qf.value=(qf.__value="dotted")==null?"":"dotted",_(Su),_(Sc),_(uu);var dd=v(uu,2),pl=v(y(dd),2),vf=v(y(pl),2),lc=Bt(()=>km(Qs,1));vf.__click=function(...pd){var te;(te=i(lc))==null||te.apply(this,pd)};var Pf=y(vf);_(vf);var Gd=v(vf,2);Gd.__change=()=>hp(Qs);var af=y(Gd);af.value=(af.__value=1)==null?"":1;var fd=v(af);fd.value=(fd.__value=2)==null?"":2;var Td=v(fd);Td.value=(Td.__value=3)==null?"":3;var vp=v(Td);vp.value=(vp.__value=4)==null?"":4;var Xa=v(vp);Xa.value=(Xa.__value=5)==null?"":5,_(Gd);var Ju=v(Gd,2);Ju.__change=()=>hp(Qs);var Bp=y(Ju);Bp.value=(Bp.__value="solid")==null?"":"solid";var Zf=v(Bp);Zf.value=(Zf.__value="dashed")==null?"":"dashed";var ap=v(Zf);ap.value=(ap.__value="dotted")==null?"":"dotted",_(Ju),_(pl),_(dd);var wp=v(dd,2),fm=v(y(wp),2),Fc=v(y(fm),2),Mf=Bt(()=>km(Qs,2));Fc.__click=function(...pd){var te;(te=i(Mf))==null||te.apply(this,pd)};var Sp=y(Fc);_(Fc);var qp=v(Fc,2);qp.__change=()=>hp(Qs);var Up=y(qp);Up.value=(Up.__value=1)==null?"":1;var th=v(Up);th.value=(th.__value=2)==null?"":2;var Nm=v(th);Nm.value=(Nm.__value=3)==null?"":3;var zh=v(Nm);zh.value=(zh.__value=4)==null?"":4;var Sv=v(zh);Sv.value=(Sv.__value=5)==null?"":5,_(qp);var Nf=v(qp,2);Nf.__change=()=>hp(Qs);var Qu=y(Nf);Qu.value=(Qu.__value="solid")==null?"":"solid";var Op=v(Qu);Op.value=(Op.__value="dashed")==null?"":"dashed";var Vh=v(Op);Vh.value=(Vh.__value="dotted")==null?"":"dotted",_(Nf),_(fm),_(wp),_(dr),_(ji),Ce(()=>{Ot(Gc,"style",`background-color: ${i(xi).styles.k.color??""}`),Ot(Pf,"style",`background-color: ${i(xi).styles.d.color??""}`),Ot(Sp,"style",`background-color: ${i(xi).styles.j.color??""}`)}),Bs(Ml,()=>i(xi).kPeriod,pd=>i(xi).kPeriod=pd),Bs(Gl,()=>i(xi).dPeriod,pd=>i(xi).dPeriod=pd),xo(bl,()=>i(xi).styles.k.thickness,pd=>i(xi).styles.k.thickness=pd),xo(Su,()=>i(xi).styles.k.lineStyle,pd=>i(xi).styles.k.lineStyle=pd),xo(Gd,()=>i(xi).styles.d.thickness,pd=>i(xi).styles.d.thickness=pd),xo(Ju,()=>i(xi).styles.d.lineStyle,pd=>i(xi).styles.d.lineStyle=pd),xo(qp,()=>i(xi).styles.j.thickness,pd=>i(xi).styles.j.thickness=pd),xo(Nf,()=>i(xi).styles.j.lineStyle,pd=>i(xi).styles.j.lineStyle=pd),q(Ra,ji)});var gr=v(Pl,2),Ur=y(gr);Ur.__click=Hm,_(gr),_(_a),q(ar,_a)},ar=>{var _a=Qn(),Pl=fn(_a);Ue(Pl,()=>i(G),gr=>{var Ur=IG(),Ra=y(Ur),xi=v(y(Ra),2),Qs=y(xi),ji=v(y(Qs),2);xn(ji),ji.__change=[XH,Fs,vc],_(Qs);var qa=v(Qs,2),_i=v(y(qa),2);_i.__click=[wG,Es];var da=y(_i);const dr=Bt(()=>`background-color: ${g(i(La),i(mr))}`);_(_i),_(qa),_(xi);var fl=v(xi,2),kc=y(fl),Ml=v(y(kc),2),Nl=y(Ml);_(Ml),_(kc);var Gl=v(kc,2);xn(Gl),Gl.__change=Co,_(fl),_(Ra);var uu=v(Ra,2),Sc=v(y(uu),2),Cc=v(y(Sc),2);xn(Cc),Cc.__change=[ZH,Fs,ul],_(Sc);var du=v(Sc,2),Gc=y(du),bl=v(y(Gc),2);bl.__click=[kG,Es];var fu=y(bl);_(bl),_(Gc);var Pd=v(Gc,2),hf=v(y(Pd),2);hf.__click=[SG,Es];var yu=y(hf);_(hf),_(Pd),_(du);var Bf=v(du,2),Su=y(Bf),Yc=v(y(Su),2);Yc.__change=[_5,Fs,Wl,Ic];var ea=y(Yc);ea.value=(ea.__value=1)==null?"":1;var qf=v(ea);qf.value=(qf.__value=2)==null?"":2;var dd=v(qf);dd.value=(dd.__value=3)==null?"":3;var pl=v(dd);pl.value=(pl.__value=4)==null?"":4;var vf=v(pl);vf.value=(vf.__value=5)==null?"":5,_(Yc),_(Su);var lc=v(Su,2),Pf=v(y(lc),2);Pf.__change=[_5,Fs,Wl,Ic];var Gd=y(Pf);Gd.value=(Gd.__value="solid")==null?"":"solid";var af=v(Gd);af.value=(af.__value="dashed")==null?"":"dashed",_(Pf),_(lc);var fd=v(lc,2),Td=v(y(fd),2);Td.__change=[y5,Fs,Pc,cl];var vp=y(Td);vp.value=(vp.__value=1)==null?"":1;var Xa=v(vp);Xa.value=(Xa.__value=2)==null?"":2;var Ju=v(Xa);Ju.value=(Ju.__value=3)==null?"":3;var Bp=v(Ju);Bp.value=(Bp.__value=4)==null?"":4;var Zf=v(Bp);Zf.value=(Zf.__value=5)==null?"":5,_(Td),_(fd);var ap=v(fd,2),wp=v(y(ap),2);wp.__change=[y5,Fs,Pc,cl];var fm=y(wp);fm.value=(fm.__value="solid")==null?"":"solid";var Fc=v(fm);Fc.value=(Fc.__value="dashed")==null?"":"dashed",_(wp),_(ap),_(Bf),_(uu);var Mf=v(uu,2),Sp=v(y(Mf),2),qp=y(Sp),Up=v(y(qp),2);Up.__click=[CG,Es];var th=y(Up);_(Up),_(qp);var Nm=v(qp,2),zh=v(y(Nm),2);zh.__change=[g5,Fs,Wr,Kl];var Sv=y(zh);Sv.value=(Sv.__value=1)==null?"":1;var Nf=v(Sv);Nf.value=(Nf.__value=2)==null?"":2;var Qu=v(Nf);Qu.value=(Qu.__value=3)==null?"":3;var Op=v(Qu);Op.value=(Op.__value=4)==null?"":4;var Vh=v(Op);Vh.value=(Vh.__value=5)==null?"":5,_(zh),_(Nm);var pd=v(Nm,2),te=v(y(pd),2);te.__change=[g5,Fs,Wr,Kl];var nn=y(te);nn.value=(nn.__value="solid")==null?"":"solid";var mt=v(nn);mt.value=(mt.__value="dashed")==null?"":"dashed",_(te),_(pd),_(Sp),_(Mf);var pn=v(Mf,2),Nt=v(y(pn),2),Ps=v(y(Nt),2);xn(Ps),Ps.__change=[JH,Fs,Ga],_(Nt),_(pn),_(Ur),Ce(()=>{Ot(da,"style",i(dr)),tt(Nl,`${i(mr)??""}%`),Ot(fu,"style",`background-color: ${i(Ba)}`),Ot(yu,"style",`background-color: ${i(vi)}`),Ot(th,"style",`background-color: ${i(Sl)}`)}),Uv(ji,()=>i(vc),Nn=>x(vc,Nn)),Bs(Gl,()=>i(mr),Nn=>x(mr,Nn)),Uv(Cc,()=>i(ul),Nn=>x(ul,Nn)),xo(Yc,()=>i(Wl),Nn=>x(Wl,Nn)),xo(Pf,()=>i(Ic),Nn=>x(Ic,Nn)),xo(Td,()=>i(Pc),Nn=>x(Pc,Nn)),xo(wp,()=>i(cl),Nn=>x(cl,Nn)),xo(zh,()=>i(Wr),Nn=>x(Wr,Nn)),xo(te,()=>i(Kl),Nn=>x(Kl,Nn)),Uv(Ps,()=>i(Ga),Nn=>x(Ga,Nn)),q(gr,Ur)},gr=>{var Ur=Qn(),Ra=fn(Ur);Ue(Ra,()=>i(Ku),xi=>{var Qs=BG(),ji=y(Qs),qa=v(y(ji),2),_i=y(qa),da=v(y(_i),2);xn(da),_(_i);var dr=v(_i,2),fl=v(y(dr),2);xn(fl),_(dr),_(qa),_(ji);var kc=v(ji,2),Ml=v(y(kc),2),Nl=v(y(Ml),2),Gl=y(Nl),uu=v(Gl,2);uu.__click=[PG,Ts];var Sc=y(uu);_(uu),_(Nl),_(Ml);var Cc=v(Ml,2),du=y(Cc),Gc=v(y(du),2),bl=y(Gc);_(Gc),_(du);var fu=v(du,2);xn(fu),Zi(2),_(Cc),_(kc);var Pd=v(kc,2),hf=v(y(Pd),2),yu=y(hf),Bf=v(y(yu),2),Su=y(Bf),Yc=v(Su,2);Yc.__click=[MG,Ts];var ea=y(Yc);_(Yc),_(Bf),_(yu);var qf=v(yu,2),dd=v(y(qf),2),pl=y(dd),vf=v(pl,2);vf.__click=[NG,Ts];var lc=y(vf);_(vf),_(dd),_(qf);var Pf=v(qf,2),Gd=v(y(Pf),2),af=y(Gd),fd=v(af,2);fd.__click=[AG,Ts];var Td=y(fd);_(fd),_(Gd),_(Pf),_(hf),_(Pd);var vp=v(Pd,2),Xa=v(y(vp),2),Ju=y(Xa),Bp=v(y(Ju),2),Zf=y(Bp);Zf.value=(Zf.__value=1)==null?"":1;var ap=v(Zf);ap.value=(ap.__value=2)==null?"":2;var wp=v(ap);wp.value=(wp.__value=3)==null?"":3;var fm=v(wp);fm.value=(fm.__value=4)==null?"":4;var Fc=v(fm);Fc.value=(Fc.__value=5)==null?"":5,_(Bp),_(Ju);var Mf=v(Ju,2),Sp=v(y(Mf),2),qp=y(Sp);qp.value=(qp.__value="solid")==null?"":"solid";var Up=v(qp);Up.value=(Up.__value="dashed")==null?"":"dashed";var th=v(Up);th.value=(th.__value="dotted")==null?"":"dotted",_(Sp),_(Mf),_(Xa),_(vp);var Nm=v(vp,2),zh=y(Nm);zh.__click=[cq,Ku,o,l,Ea,B,$,w,C,P,I,A,M,F,ro];var Sv=v(zh,2);Ue(Sv,()=>i(Ea).length>1,Qu=>{var Op=FG();Op.__click=[TG,zo],q(Qu,Op)}),_(Nm);var Nf=v(Nm,2);Ue(Nf,()=>i(Ea).length>1,Qu=>{var Op=Qn(),Vh=fn(Op);Yo(Vh,17,()=>i(Ea).slice(1),Ii,(pd,te,nn)=>{var mt=jG();const pn=Bt(()=>nn+1);var Nt=y(mt),Ps=y(Nt),Nn=y(Ps);_(Ps);var hs=v(Ps,2);hs.__click=[LG,zo,pn],_(Nt);var ss=v(Nt,2),Ln=y(ss),tn=v(y(Ln),2);xn(tn),tn.__change=ro,_(Ln);var Ws=v(Ln,2),Hs=v(y(Ws),2);xn(Hs),Hs.__change=ro,_(Ws),_(ss);var As=v(ss,2),Ls=v(y(As),2),js=v(y(Ls),2),ks=y(js),Jn=v(ks,2);Jn.__click=[EG,Ts,pn];var En=y(Jn);_(Jn),_(js),_(Ls);var Wi=v(Ls,2),ml=y(Wi),Qo=v(y(ml),2),po=y(Qo);_(Qo),_(ml);var aa=v(ml,2);xn(aa),aa.__change=ro,_(Wi),_(As);var Za=v(As,2),Lc=v(y(Za),2),Na=y(Lc),Jf=v(y(Na),2),Rr=y(Jf),Go=v(Rr,2);Go.__click=[$G,Ts,pn];var Aa=y(Go);_(Go),_(Jf),_(Na);var jr=v(Na,2),ja=v(y(jr),2),qu=y(ja),Yd=v(qu,2);Yd.__click=[DG,Ts,pn];var Mp=y(Yd);_(Yd),_(ja),_(jr);var zp=v(jr,2),Kd=v(y(zp),2),Vp=y(Kd),Wh=v(Vp,2);Wh.__click=[RG,Ts,pn];var Np=y(Wh);_(Wh),_(Kd),_(zp),_(Lc),_(Za);var mv=v(Za,2),wh=v(y(mv),2),Qp=y(wh),Ap=v(y(Qp),2);Ap.__change=ro;var Hh=y(Ap);Hh.value=(Hh.__value=1)==null?"":1;var Am=v(Hh);Am.value=(Am.__value=2)==null?"":2;var pm=v(Am);pm.value=(pm.__value=3)==null?"":3;var Fg=v(pm);Fg.value=(Fg.__value=4)==null?"":4;var Hg=v(Fg);Hg.value=(Hg.__value=5)==null?"":5,_(Ap),_(Qp);var Lg=v(Qp,2),Eg=v(y(Lg),2);Eg.__change=ro;var i0=y(Eg);i0.value=(i0.__value="solid")==null?"":"solid";var $g=v(i0);$g.value=($g.__value="dashed")==null?"":"dashed";var hg=v($g);hg.value=(hg.__value="dotted")==null?"":"dotted",_(Eg),_(Lg),_(wh),_(mv),_(mt),Ce(()=>{tt(Nn,`BOLL ${i(pn)+1}`),Ot(hs,"title",`Remove BOLL ${i(pn)+1}`),Ot(ks,"style",`background-color: ${i(te).styles.fillColor}; opacity: ${(i(te).styles.fillOpacity||0)/100}`),Ot(En,"style",`background-color: ${i(te).styles.fillColor}; opacity: ${(i(te).styles.fillOpacity||0)/100}`),tt(po,`${i(te).styles.fillOpacity??""}%`),Ot(Rr,"style",`background-color: ${i(te).styles.upperColor}`),Ot(Aa,"style",`background-color: ${i(te).styles.upperColor}`),Ot(qu,"style",`background-color: ${i(te).styles.middleColor}`),Ot(Mp,"style",`background-color: ${i(te).styles.middleColor}`),Ot(Vp,"style",`background-color: ${i(te).styles.lowerColor}`),Ot(Np,"style",`background-color: ${i(te).styles.lowerColor}`)}),Bs(tn,()=>i(te).period,kh=>i(te).period=kh),Bs(Hs,()=>i(te).stdDev,kh=>i(te).stdDev=kh),Bs(aa,()=>i(te).styles.fillOpacity,kh=>i(te).styles.fillOpacity=kh),xo(Ap,()=>i(te).styles.thickness,kh=>i(te).styles.thickness=kh),xo(Eg,()=>i(te).styles.lineStyle,kh=>i(te).styles.lineStyle=kh),q(pd,mt)}),q(Qu,Op)}),_(Qs),Ce(()=>{Ot(Gl,"style",`background-color: ${i(w)??""}; opacity: ${i(C)/100}`),Ot(Sc,"style",`background-color: ${i(w)??""}; opacity: ${i(C)/100}`),tt(bl,`${i(C)??""}%`),Ot(Su,"style",`background-color: ${i(P)??""}`),Ot(ea,"style",`background-color: ${i(P)??""}`),Ot(pl,"style",`background-color: ${i(I)??""}`),Ot(lc,"style",`background-color: ${i(I)??""}`),Ot(af,"style",`background-color: ${i(A)??""}`),Ot(Td,"style",`background-color: ${i(A)??""}`)}),Bs(da,()=>i(B),Qu=>x(B,Qu)),Bs(fl,()=>i($),Qu=>x($,Qu)),Bs(fu,()=>i(C),Qu=>x(C,Qu)),xo(Bp,()=>i(M),Qu=>x(M,Qu)),xo(Sp,()=>i(F),Qu=>x(F,Qu)),q(xi,Qs)},xi=>{var Qs=Qn(),ji=fn(Qs);Ue(ji,()=>!d.length,qa=>{var _i=OG(),da=y(_i),dr=y(da,!0);Ce(()=>tt(dr,a4())),_(da),_(_i),q(qa,_i)},qa=>{var _i=qG(),da=y(_i);Yo(da,17,()=>d,Ii,(fl,kc,Ml)=>{var Nl=WG(),Gl=y(Nl),uu=y(Gl),Sc=y(uu,!0);_(uu);var Cc=v(uu,2),du=y(Cc);xn(du);var Gc=v(du,2);Ue(Gc,()=>u.length>1&&!i(Ku),fd=>{var Td=zG();Td.__click=()=>sc(Ml),q(fd,Td)},fd=>{var Td=Qn(),vp=fn(Td);Ue(vp,()=>!i(Ku),Xa=>{var Ju=VG();q(Xa,Ju)},null,!0),q(fd,Td)}),_(Cc),_(Gl);var bl=v(Gl,2),fu=y(bl),Pd=v(y(fu),2),hf=Bt(()=>lm(Ml));Pd.__click=function(...fd){var Td;(Td=i(hf))==null||Td.apply(this,fd)};var yu=y(Pd);_(Pd),_(fu);var Bf=v(fu,2),Su=v(y(Bf),2),Yc=y(Su);Yc.value=(Yc.__value=1)==null?"":1;var ea=v(Yc);ea.value=(ea.__value=2)==null?"":2;var qf=v(ea);qf.value=(qf.__value=3)==null?"":3;var dd=v(qf);dd.value=(dd.__value=4)==null?"":4;var pl=v(dd);pl.value=(pl.__value=5)==null?"":5,_(Su),_(Bf);var vf=v(Bf,2),lc=v(y(vf),2),Pf=y(lc);Pf.value=(Pf.__value="solid")==null?"":"solid";var Gd=v(Pf);Gd.value=(Gd.__value="dashed")==null?"":"dashed";var af=v(Gd);af.value=(af.__value="dotted")==null?"":"dotted",_(lc),_(vf),_(bl),_(Nl),Ce(()=>{tt(Sc,i(kc).title),Ot(yu,"style",`background-color: ${h[Ml].color??""}`)}),Bs(du,()=>u[Ml],fd=>u[Ml]=fd),xo(Su,()=>h[Ml].thickness,fd=>h[Ml].thickness=fd),xo(lc,()=>h[Ml].lineStyle,fd=>h[Ml].lineStyle=fd),q(fl,Nl)});var dr=v(da,2);Ue(dr,()=>d.length<10&&!i(Ku)&&!i(ad)&&!i(Xf),fl=>{var kc=HG(),Ml=y(kc);Ml.__click=[Fb,Ku,Xu,ru,Ql,eu,Hd,Dh,Tu,Xm,d,u,h,Wu,Vn,Au,_n],_(kc),Ce(()=>Ot(Ml,"title",i(Xu)?"Add more BIAS indicator":i(Ql)?"Add more Awesome Oscillator":i(Hd)?"Add more WR indicator":i(Au)?"Add more EMA":"Add parameter")),q(fl,kc)}),_(_i),q(qa,_i)},!0),q(xi,Qs)},!0),q(gr,Ur)},!0),q(ar,_a)},!0),q(Ki,ua)},!0),q(Ri,Ka)},!0),q(Uo,ga)},!0),q(Ti,Di)},!0),q(fi,ra)},!0),q(ui,bi)},!0),q(ir,Ai)},!0),q(Ni,Ma)},!0),q(ns,zs)},!0),q(Dr,va)},!0),q(Cr,Yi)},!0),q(Ar,ma)},!0),q(Nr,Vi)},!0),q(Fo,Lo)},!0),q(ki,ys)},!0),q(Wa,Ci)},!0),q($r,rr)},!0),q(zi,ii)},!0),q(bs,Ds)},!0),q(dl,U)},!0),q(oa,Ul)},!0),q(Va,ju)},!0),q(er,Da)},!0),q(sa,wi)},!0),q(Id,If)},!0),q(ef,Cf)},!0),q(Sf,rf)},!0),q(ci,lu)},!0),q(ts,Bn)},!0),q(st,Jt)},!0),q(H,he)});var W=v(D,2);Ue(W,()=>i(Ve),H=>{var he=UG();q(H,he)}),_(j),q(k,j)},$$slots:{default:!0}});var Ee=v(ne,2),je=Bt(()=>{var k,N;return((N=(k=i(Ea)[i(Nd)])==null?void 0:k.styles)==null?void 0:N.upperColor)||"#f23645"});mc(Ee,{get show(){return i(mo)},set show(k){x(mo,V(k))},get selectedColor(){return i(je)},get position(){return i(sr)},$$events:{colorChange:k=>{i(Ea)[i(Nd)]?(i(Ea)[i(Nd)].styles.upperColor=k.detail.rgba||k.detail.color,ro()):x(P,V(k.detail.rgba||k.detail.color))}}});var dt=v(Ee,2),At=Bt(()=>{var k,N;return((N=(k=i(Ea)[i(Nd)])==null?void 0:k.styles)==null?void 0:N.middleColor)||"#2962ff"});mc(dt,{get show(){return i(or)},set show(k){x(or,V(k))},get selectedColor(){return i(At)},get position(){return i(hl)},$$events:{colorChange:k=>{i(Ea)[i(Nd)]?(i(Ea)[i(Nd)].styles.middleColor=k.detail.rgba||k.detail.color,ro()):x(I,V(k.detail.rgba||k.detail.color))}}});var Yt=v(dt,2),yn=Bt(()=>{var k,N;return((N=(k=i(Ea)[i(Nd)])==null?void 0:k.styles)==null?void 0:N.lowerColor)||"#089981"});mc(Yt,{get show(){return i(Oi)},set show(k){x(Oi,V(k))},get selectedColor(){return i(yn)},get position(){return i(si)},$$events:{colorChange:k=>{i(Ea)[i(Nd)]?(i(Ea)[i(Nd)].styles.lowerColor=k.detail.rgba||k.detail.color,ro()):x(A,V(k.detail.rgba||k.detail.color))}}});var Wt=v(Yt,2),zn=Bt(()=>{var k,N;return((N=(k=i(Ea)[i(Nd)])==null?void 0:k.styles)==null?void 0:N.fillColor)||"#2196F3"});mc(Wt,{get show(){return i(Dn)},set show(k){x(Dn,V(k))},get selectedColor(){return i(zn)},get position(){return i(ni)},$$events:{colorChange:k=>{i(Ea)[i(Nd)]?(i(Ea)[i(Nd)].styles.fillColor=k.detail.rgba||k.detail.color,ro()):x(w,V(k.detail.rgba||k.detail.color))}}});var Pn=v(Wt,2);mc(Pn,{get show(){return i(Wo)},set show(k){x(Wo,V(k))},get selectedColor(){return i(Sl)},get position(){return i(Ua)},$$events:{colorChange:k=>{var j;x(Sl,V(k.detail.rgba||k.detail.color));const N=window.__npoMaeApi;(j=N==null?void 0:N.setColors)==null||j.call(N,{median:i(Sl)})}}});var as=v(Pn,2),Cs=Bt(()=>g(i(La),i(mr)));mc(as,{get show(){return i(Hi)},set show(k){x(Hi,V(k))},get selectedColor(){return i(Cs)},get position(){return i(to)},$$events:{colorChange:k=>{x(La,V(k.detail.rgba||k.detail.color)),Co()}}});var Ks=v(as,2);mc(Ks,{get show(){return i(Li)},set show(k){x(Li,V(k))},get selectedColor(){return i(Ba)},get position(){return i(Vr)},$$events:{colorChange:k=>{var j;x(Ba,V(k.detail.rgba||k.detail.color));const N=window.__npoMaeApi;(j=N==null?void 0:N.setColors)==null||j.call(N,{slLong:i(Ba)})}}});var jn=v(Ks,2);mc(jn,{get show(){return i(ba)},set show(k){x(ba,V(k))},get selectedColor(){return i(vi)},get position(){return i(qi)},$$events:{colorChange:k=>{var j;x(vi,V(k.detail.rgba||k.detail.color));const N=window.__npoMaeApi;(j=N==null?void 0:N.setColors)==null||j.call(N,{slShort:i(vi)})}}});var Xt=v(jn,2),Tn=Bt(()=>{var k,N,j;return((j=(N=(k=i(Xl)[i(Y)])==null?void 0:k.styles)==null?void 0:N[i(ce)])==null?void 0:j.color)||"#2563eb"});mc(Xt,{get show(){return i(L)},set show(k){x(L,V(k))},get selectedColor(){return i(Tn)},get position(){return i(O)},$$events:{colorChange:k=>{i(Xl).length>i(Y)&&(i(Xl)[i(Y)].styles[i(ce)].color=k.detail.rgba||k.detail.color,fh(i(Y),i(ce)))}}});var Kn=v(Xt,2),os=Bt(()=>{var k,N,j;return((j=(N=(k=i(Vc)[i(Cu)])==null?void 0:k.styles)==null?void 0:N[i(uc)])==null?void 0:j.color)||"#2563eb"});mc(Kn,{get show(){return i(Fi)},set show(k){x(Fi,V(k))},get selectedColor(){return i(os)},get position(){return Rc},$$events:{colorChange:k=>{i(Vc).length>i(Cu)&&i(Vc)[i(Cu)].styles[i(uc)]&&(i(Vc)[i(Cu)].styles[i(uc)].color=k.detail.rgba||k.detail.color,Hu())}}});var ln=v(Kn,2),ms=Bt(()=>{var k;return((k=i(ko)[i(ue)])==null?void 0:k.color)||"#2563eb"});mc(ln,{get show(){return i(Q)},set show(k){x(Q,V(k))},get selectedColor(){return i(ms)},get position(){return i(le)},$$events:{colorChange:k=>{i(ko).length>i(ue)&&(i(ko)[i(ue)].color=k.detail.rgba||k.detail.color,wd())}}});var Ns=v(ln,2),cn=Bt(()=>{var k,N,j;return((j=(N=(k=i(ol)[0])==null?void 0:k.styles)==null?void 0:N.diPlus)==null?void 0:j.color)||"#2563eb"});mc(Ns,{get show(){return i(fe)},set show(k){x(fe,V(k))},get selectedColor(){return i(cn)},get position(){return i(pe)},$$events:{colorChange:k=>{i(ol).length>0&&(i(ol)[0].styles.diPlus.color=k.detail.rgba||k.detail.color)}}});var Gn=v(Ns,2),ls=Bt(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});mc(Gn,{get show(){return i(oe)},set show(k){x(oe,V(k))},get selectedColor(){return i(ls)},get position(){return i(Pe)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var on=v(Gn,2),an=Bt(()=>{var k;return((k=i(Sr)[i(bt)])==null?void 0:k.color)||"#2563eb"});mc(on,{get show(){return i(ft)},set show(k){x(ft,V(k))},get selectedColor(){return i(an)},get position(){return i(ut)},$$events:{colorChange:k=>{i(Sr)[i(bt)]&&(i(Sr)[i(bt)].color=k.detail.rgba||k.detail.color,mh())}}});var wn=v(on,2),ds=Bt(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});mc(wn,{get show(){return i($e)},set show(k){x($e,V(k))},get selectedColor(){return i(ds)},get position(){return i(ze)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Wn=v(wn,2),yo=Bt(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});mc(Wn,{get show(){return i(Pt)},set show(k){x(Pt,V(k))},get selectedColor(){return i(yo)},get position(){return i(Et)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Si=v(Wn,2),is=Bt(()=>{var k,N,j,D,W,H,he,Le,st;return i(Xe)==="histogram"?((j=(N=(k=i(Mt)[i(Ze)])==null?void 0:k.styles)==null?void 0:N.histogram)==null?void 0:j.upColor)||"#26a69a":i(Xe)==="histogram-down"?((H=(W=(D=i(Mt)[i(Ze)])==null?void 0:D.styles)==null?void 0:W.histogram)==null?void 0:H.downColor)||"#ef5350":((st=(Le=(he=i(Mt)[i(Ze)])==null?void 0:he.styles)==null?void 0:Le.ema)==null?void 0:st.color)||"#2563eb"}),To=Bt(()=>i(Xe)==="histogram"||i(Xe)==="histogram-down"?70:100);mc(Si,{get show(){return i(Je)},set show(k){x(Je,V(k))},get selectedColor(){return i(is)},get opacity(){return i(To)},get position(){return i(Ct)},$$events:{colorChange:k=>{i(Mt).length>i(Ze)&&(i(Xe)==="histogram"?i(Mt)[i(Ze)].styles.histogram.upColor=k.detail.rgba||k.detail.color:i(Xe)==="histogram-down"?i(Mt)[i(Ze)].styles.histogram.downColor=k.detail.rgba||k.detail.color:i(Xe)==="ema"&&(i(Mt)[i(Ze)].styles.ema.color=k.detail.rgba||k.detail.color),Qt(i(Ze)))}}});var gs=v(Si,2),No=Bt(()=>{var k,N,j;return((j=(N=(k=i(rc)[i(Dt)])==null?void 0:k.styles)==null?void 0:N.wr)==null?void 0:j.color)||"#2563eb"});mc(gs,{get show(){return i(Ae)},set show(k){x(Ae,V(k))},get selectedColor(){return i(No)},get position(){return i(Qe)},$$events:{colorChange:k=>{i(rc).length>i(Dt)&&i(rc)[i(Dt)].styles.wr&&(i(rc)[i(Dt)].styles.wr.color=k.detail.rgba||k.detail.color,np(i(Dt)))}}});var jo=v(gs,2),co=Bt(()=>{var k,N,j;return((j=(N=(k=i(rc)[i(Dt)])==null?void 0:k.styles)==null?void 0:N.overbought)==null?void 0:j.color)||"#FF4444"});mc(jo,{get show(){return i(gt)},set show(k){x(gt,V(k))},get selectedColor(){return i(co)},get position(){return i(Ft)},$$events:{colorChange:k=>{i(rc).length>i(Dt)&&i(rc)[i(Dt)].styles.overbought&&(i(rc)[i(Dt)].styles.overbought.color=k.detail.rgba||k.detail.color,np(i(Dt)))}}});var Vs=v(jo,2),gi=Bt(()=>{var k,N,j;return((j=(N=(k=i(rc)[i(Dt)])==null?void 0:k.styles)==null?void 0:N.oversold)==null?void 0:j.color)||"#00C851"});mc(Vs,{get show(){return i(ot)},set show(k){x(ot,V(k))},get selectedColor(){return i(gi)},get position(){return i(ve)},$$events:{colorChange:k=>{i(rc).length>i(Dt)&&i(rc)[i(Dt)].styles.oversold&&(i(rc)[i(Dt)].styles.oversold.color=k.detail.rgba||k.detail.color,np(i(Dt)))}}});var Hc=v(Vs,2),xc=Bt(()=>{var k,N,j;return((j=(N=(k=i(rc)[i(Dt)])==null?void 0:k.styles)==null?void 0:N.middleLine)==null?void 0:j.color)||"#808080"});mc(Hc,{get show(){return i(Ie)},set show(k){x(Ie,V(k))},get selectedColor(){return i(xc)},get position(){return i(It)},$$events:{colorChange:k=>{i(rc).length>i(Dt)&&i(rc)[i(Dt)].styles.middleLine&&(i(rc)[i(Dt)].styles.middleLine.color=k.detail.rgba||k.detail.color,np(i(Dt)))}}});var ac=v(Hc,2),tu=Bt(()=>{var k,N,j;return((j=(N=(k=i(Qc)[i(hn)])==null?void 0:k.styles)==null?void 0:N[i(qn)])==null?void 0:j.color)||"#2563eb"});mc(ac,{get show(){return i(Zt)},set show(k){x(Zt,V(k))},get selectedColor(){return i(tu)},get position(){return i(gn)},$$events:{colorChange:k=>{i(Qc).length>i(hn)&&i(Qc)[i(hn)].styles[i(qn)]&&(i(Qc)[i(hn)].styles[i(qn)].color=k.detail.rgba||k.detail.color,rt(i(hn)))}}});var _c=v(ac,2),qc=Bt(()=>{var k,N,j;return((j=(N=(k=i(fa)[i(Fn)])==null?void 0:k.styles)==null?void 0:N.roc)==null?void 0:j.color)||"#2563eb"});mc(_c,{get show(){return i(On)},set show(k){x(On,V(k))},get selectedColor(){return i(qc)},get position(){return i(bn)},$$events:{colorChange:k=>{i(fa).length>i(Fn)&&(i(fa)[i(Fn)].styles.roc.color=k.detail.rgba||k.detail.color,Zp(i(Fn)))}}});var jl=v(_c,2),Bl=Bt(()=>{var k,N,j,D,W,H;return i(Yn)%2===0?((j=(N=(k=i(Xr)[Math.floor(i(Yn)/2)])==null?void 0:k.styles)==null?void 0:N.psy)==null?void 0:j.color)||"#2563eb":((H=(W=(D=i(Xr)[Math.floor(i(Yn)/2)])==null?void 0:D.styles)==null?void 0:W.mapsy)==null?void 0:H.color)||"#dc2626"});mc(jl,{get show(){return i(Xs)},set show(k){x(Xs,V(k))},get selectedColor(){return i(Bl)},get position(){return i(oo)},$$events:{colorChange:k=>{const N=Math.floor(i(Yn)/2);i(Xr).length>N&&(i(Yn)%2===0?(i(Xr)[N].styles.psy.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated PSY color to:",k.detail.color)):(i(Xr)[N].styles.mapsy.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated MAPSY color to:",k.detail.color)),Hf(N))}}});var _u=v(jl,2),cd=Bt(()=>{var k,N,j,D,W,H;return i(Rt)%2===0?((j=(N=(k=i(cr)[Math.floor(i(Rt)/2)])==null?void 0:k.styles)==null?void 0:N.obv)==null?void 0:j.color)||"#FF6B35":((H=(W=(D=i(cr)[Math.floor(i(Rt)/2)])==null?void 0:D.styles)==null?void 0:W.maobv)==null?void 0:H.color)||"#2196F3"});mc(_u,{get show(){return i(_o)},set show(k){x(_o,V(k))},get selectedColor(){return i(cd)},get position(){return i(xs)},$$events:{colorChange:k=>{const N=Math.floor(i(Rt)/2);i(cr).length>N&&(i(Rt)%2===0?(i(cr)[N].styles.obv.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated OBV color to:",k.detail.color)):(i(cr)[N].styles.maobv.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated MAOBV color to:",k.detail.color)),rm())}}});var ql=v(_u,2),jp=Bt(()=>{var k;return((k=i(In)[i(St)])==null?void 0:k.styles.color)||"#2962FF"});mc(ql,{get show(){return i(un)},set show(k){x(un,V(k))},get selectedColor(){return i(jp)},get position(){return i(qs)},$$events:{colorChange:k=>{i(In).length>i(St)&&(i(In)[i(St)].styles.color=k.detail.rgba||k.detail.color,Cn())}}});var Uc=v(ql,2),Ol=Bt(()=>{var k;return((k=i(Or)[i(Ia)])==null?void 0:k.color)||"#FF6B35"});mc(Uc,{get show(){return i(ri)},set show(k){x(ri,V(k))},get selectedColor(){return i(Ol)},get position(){return i(Eo)},$$events:{colorChange:k=>{i(Or).length>i(Ia)&&(i(Or)[i(Ia)].color=k.detail.rgba||k.detail.color,console.log("🎨 Updated PVT color to:",k.detail.color),Im(i(Ia)))}}});var au=v(Uc,2),of=Bt(()=>{var k;return((k=i(Hl)[i(yr)])==null?void 0:k.color)||"#2563eb"});mc(au,{get show(){return i(Lr)},set show(k){x(Lr,V(k))},get selectedColor(){return i(of)},get position(){return i(Qa)},$$events:{colorChange:k=>{i(Hl).length>i(yr)&&(i(Hl)[i(yr)].color=k.detail.rgba||k.detail.color)}}});var Jm=v(au,2),fv=Bt(()=>{var k;return((k=i(io)[i(nd)])==null?void 0:k.color)||"#2563eb"});mc(Jm,{get show(){return i(Fl)},set show(k){x(Fl,V(k))},get selectedColor(){return i(fv)},get position(){return i(jc)},$$events:{colorChange:k=>{i(io).length>i(nd)&&(i(io)[i(nd)].color=k.detail.rgba||k.detail.color,tc())}}});var Df=v(Jm,2),Bh=Bt(()=>{var k,N;return((N=(k=i(zd)[i(mu)])==null?void 0:k.styles[i(El)])==null?void 0:N.color)||"#2563eb"});mc(Df,{get show(){return i(Fa)},set show(k){x(Fa,V(k))},get selectedColor(){return i(Bh)},get position(){return i(dc)},$$events:{colorChange:k=>{const N=i(zd)[i(mu)];N&&N.styles&&N.styles.length>i(El)&&(N.styles[i(El)].color=k.detail.rgba||k.detail.color,qm(i(mu)))}}});var kf=v(Df,2),Pm=Bt(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});mc(kf,{get show(){return i(Bc)},set show(k){x(Bc,V(k))},get selectedColor(){return i(Pm)},get position(){return i(rd)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var dm=v(kf,2),Pg=Bt(()=>{var k,N,j,D,W,H,he,Le,st;return i(Ll)%3===0?((j=(N=(k=i(na)[Math.floor(i(Ll)/3)])==null?void 0:k.styles)==null?void 0:N.increasing)==null?void 0:j.color)||"#00C851":i(Ll)%3===1?((H=(W=(D=i(na)[Math.floor(i(Ll)/3)])==null?void 0:D.styles)==null?void 0:W.decreasing)==null?void 0:H.color)||"#FF4444":((st=(Le=(he=i(na)[Math.floor(i(Ll)/3)])==null?void 0:he.styles)==null?void 0:Le.reverse)==null?void 0:st.color)||"#c4c4c4"});mc(dm,{get show(){return i(uf)},set show(k){x(uf,V(k))},get selectedColor(){return i(Pg)},get position(){return i(So)},$$events:{colorChange:k=>{const N=Math.floor(i(Ll)/3);i(na)[N]&&(i(Ll)%3===0?i(na)[N].styles.increasing.color=k.detail.rgba||k.detail.color:i(Ll)%3===1?i(na)[N].styles.decreasing.color=k.detail.rgba||k.detail.color:i(na)[N].styles.reverse.color=k.detail.rgba||k.detail.color,am())}}});var pf=v(dm,2),wc=Bt(()=>{var k,N,j;return((j=(N=(k=i(ol)[i(Z)])==null?void 0:k.styles)==null?void 0:N[i(xe)])==null?void 0:j.color)||"#2563eb"});mc(pf,{get show(){return i(fe)},set show(k){x(fe,V(k))},get selectedColor(){return i(wc)},get position(){return i(pe)},$$events:{colorChange:k=>{i(ol).length>i(Z)&&i(ol)[i(Z)].styles[i(xe)]&&(i(ol)[i(Z)].styles[i(xe)].color=k.detail.rgba||k.detail.color,Tc())}}});var xr=v(pf,2),Qd=Bt(()=>{var k,N,j;return((j=(N=(k=i(na)[0])==null?void 0:k.styles)==null?void 0:N.increasing)==null?void 0:j.color)||"#16a34a"});mc(xr,{get show(){return i(Md)},set show(k){x(Md,V(k))},get selectedColor(){return i(Qd)},get position(){return i(nf)},$$events:{colorChange:k=>{i(na).length>0&&(i(na)[0].styles.increasing.color=k.detail.rgba||k.detail.color)}}});var xp=v(xr,2),Qm=Bt(()=>{var k,N,j;return((j=(N=(k=i(na)[0])==null?void 0:k.styles)==null?void 0:N.decreasing)==null?void 0:j.color)||"#dc2626"});mc(xp,{get show(){return i(zf)},set show(k){x(zf,V(k))},get selectedColor(){return i(Qm)},get position(){return i(df)},$$events:{colorChange:k=>{i(na).length>0&&(i(na)[0].styles.decreasing.color=k.detail.rgba||k.detail.color)}}});var Oh=v(xp,2),Pp=Bt(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});mc(Oh,{get show(){return i(Pu)},set show(k){x(Pu,V(k))},get selectedColor(){return i(Pp)},get position(){return Dd},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var pv=v(Oh,2),Mg=Bt(()=>{var k;return((k=h[1])==null?void 0:k.color)||"#dc2626"});mc(pv,{get show(){return i(yf)},set show(k){x(yf,V(k))},get selectedColor(){return i(Mg)},get position(){return $n},$$events:{colorChange:k=>{h.length>1&&(h[1].color=k.detail.rgba||k.detail.color)}}});var Ng=v(pv,2),Ag=Bt(()=>{var k;return((k=h[2])==null?void 0:k.color)||"#16a34a"});mc(Ng,{get show(){return i(ws)},set show(k){x(ws,V(k))},get selectedColor(){return i(Ag)},get position(){return i(Us)},$$events:{colorChange:k=>{h.length>2&&(h[2].color=k.detail.rgba||k.detail.color)}}});var pg=v(Ng,2);mc(pg,{get show(){return i(Dn)},set show(k){x(Dn,V(k))},get selectedColor(){return i(w)},get position(){return i(ni)},$$events:{colorChange:k=>{x(w,V(k.detail.rgba||k.detail.color))}}});var Mm=v(pg,2);mc(Mm,{get show(){return i(mo)},set show(k){x(mo,V(k))},get selectedColor(){return i(P)},get position(){return i(sr)},$$events:{colorChange:k=>{x(P,V(k.detail.rgba||k.detail.color))}}});var mg=v(Mm,2);mc(mg,{get show(){return i(or)},set show(k){x(or,V(k))},get selectedColor(){return i(I)},get position(){return i(hl)},$$events:{colorChange:k=>{x(I,V(k.detail.rgba||k.detail.color))}}});var Tg=v(mg,2);mc(Tg,{get show(){return i(Oi)},set show(k){x(Oi,V(k))},get selectedColor(){return i(A)},get position(){return i(si)},$$events:{colorChange:k=>{x(A,V(k.detail.rgba||k.detail.color))}}});var kv=v(Tg,2),eh=Bt(()=>{var k;return((k=h[i(tl)])==null?void 0:k.color)||"#2563eb"});mc(kv,{get show(){return i(vl)},set show(k){x(vl,V(k))},get selectedColor(){return i(eh)},get position(){return i(pu)},$$events:{colorChange:k=>{h.length>i(tl)&&(h[i(tl)].color=k.detail.rgba||k.detail.color,_n())}}});var nr=v(kv,2),Hr=Bt(()=>{var k;return((k=i(Ji)[i(Gu)])==null?void 0:k.color)||"#FF6C37"});mc(nr,{get show(){return i(Oa)},set show(k){x(Oa,V(k))},get selectedColor(){return i(Hr)},get position(){return i(Oc)},$$events:{colorChange:k=>{i(Ji).length>i(Gu)&&(i(Ji)[i(Gu)].color=k.detail.rgba||k.detail.color,Js(i(Gu)))}}});var nu=v(nr,2),Sd=Bt(()=>{var k;return((k=h[i(la)])==null?void 0:k.color)||"#2563eb"});mc(nu,{get show(){return i(bc)},set show(k){x(bc,V(k))},get selectedColor(){return i(Sd)},get position(){return i(nl)},$$events:{colorChange:k=>{h.length>i(la)&&(h[i(la)].color=k.detail.rgba||k.detail.color,Vn())}}});var Rf=v(nu,2),Ud=Bt(()=>{var k;return((k=i(Nc)[i(zc)])==null?void 0:k.color)||"#2563eb"});mc(Rf,{get show(){return i(Mu)},set show(k){x(Mu,V(k))},get selectedColor(){return i(Ud)},get position(){return i(Yu)},$$events:{colorChange:k=>{i(Nc).length>i(zc)&&(i(Nc)[i(zc)].color=k.detail.rgba||k.detail.color,Lt(i(zc)))}}});var $t=v(Rf,2),Gs=Bt(()=>(()=>{const k=Math.floor(i(nt)/3),N=i(nt)%3,j=i(us)[k];if(!j)return"#2563eb";switch(N){case 0:return j.styles.k.color;case 1:return j.styles.d.color;case 2:return j.styles.j.color;default:return"#2563eb"}})());mc($t,{get show(){return i(Ke)},set show(k){x(Ke,V(k))},get selectedColor(){return i(Gs)},get position(){return i(qe)},$$events:{colorChange:k=>{const N=Math.floor(i(nt)/3),j=i(nt)%3,D=i(us)[N];if(console.log("🎨 KDJ Color change:",{groupIndex:N,lineIndex:j,newColor:k.detail.color,group:D}),D){switch(j){case 0:D.styles.k.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated K color to:",k.detail.color);break;case 1:D.styles.d.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated D color to:",k.detail.color);break;case 2:D.styles.j.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated J color to:",k.detail.color);break}console.log("🎨 Updated KDJ group:",D),hp(N)}}}});var Zo=v($t,2),Bo=Bt(()=>(()=>{const k=i(br)[i(Pa)];if(!k)return"#2563eb";switch(i(Yr)){case"cr":return k.styles.cr.color;case"ma1":return k.styles.ma1.color;case"ma2":return k.styles.ma2.color;case"ma3":return k.styles.ma3.color;case"ma4":return k.styles.ma4.color;default:return"#2563eb"}})());mc(Zo,{get show(){return i(ya)},set show(k){x(ya,V(k))},get selectedColor(){return i(Bo)},get position(){return i(hc)},$$events:{colorChange:k=>{const N=i(br)[i(Pa)];if(N){switch(i(Yr)){case"cr":N.styles.cr.color=k.detail.rgba||k.detail.color;break;case"ma1":N.styles.ma1.color=k.detail.rgba||k.detail.color;break;case"ma2":N.styles.ma2.color=k.detail.rgba||k.detail.color;break;case"ma3":N.styles.ma3.color=k.detail.rgba||k.detail.color;break;case"ma4":N.styles.ma4.color=k.detail.rgba||k.detail.color;break}vu()}}}});var ka=v(Zo,2),Ru=Bt(()=>{var k,N,j;return((j=(N=(k=i(Ui)[i(Kf)])==null?void 0:k.styles)==null?void 0:N.rsi)==null?void 0:j.color)||"#8B5CF6"});mc(ka,{get show(){return i(Zd)},set show(k){x(Zd,V(k))},get selectedColor(){return i(Ru)},get position(){return i(Yf)},$$events:{colorChange:k=>{i(Ui).length>i(Kf)&&(i(Ui)[i(Kf)].styles.rsi.color=k.detail.rgba||k.detail.color,Wp(i(Kf)))}}});var Vo=v(ka,2),il=Bt(()=>{var k,N;return((N=(k=i(Ui)[i(kl)])==null?void 0:k.styles)==null?void 0:N.overboughtColor)||"#EF4444"});mc(Vo,{get show(){return i(el)},set show(k){x(el,V(k))},get selectedColor(){return i(il)},get position(){return i(Yl)},$$events:{colorChange:k=>{if(i(Ui).length>i(kl)){const N=k.detail.rgba||k.detail.color;i(Ui)[i(kl)].styles.overboughtColor=N,x(Ui,V([...i(Ui)])),Wp(i(kl))}}}});var Ya=v(Vo,2),Zl=Bt(()=>{var k,N;return((N=(k=i(Ui)[i(kl)])==null?void 0:k.styles)==null?void 0:N.oversoldColor)||"#22C55E"});mc(Ya,{get show(){return i(Vu)},set show(k){x(Vu,V(k))},get selectedColor(){return i(Zl)},get position(){return i(Iu)},$$events:{colorChange:k=>{if(i(Ui).length>i(kl)){const N=k.detail.rgba||k.detail.color;i(Ui)[i(kl)].styles.oversoldColor=N,x(Ui,V([...i(Ui)])),Wp(i(kl))}}}});var oi=v(Ya,2),Ys=Bt(()=>{var k,N;return((N=(k=i(Ui)[i(kl)])==null?void 0:k.styles)==null?void 0:N.middleLineColor)||"#6B7280"});mc(oi,{get show(){return i(Ro)},set show(k){x(Ro,V(k))},get selectedColor(){return i(Ys)},get position(){return i(zr)},$$events:{colorChange:k=>{if(i(Ui).length>i(kl)){const N=k.detail.rgba||k.detail.color;i(Ui)[i(kl)].styles.middleLineColor=N,x(Ui,V([...i(Ui)])),Wp(i(kl))}}}});var Er=v(oi,2),Hn=Bt(()=>{var k,N,j;return((j=(N=(k=i(Eu)[i($l)])==null?void 0:k.styles)==null?void 0:N.duty)==null?void 0:j.color)||"#2962FF"});mc(Er,{get show(){return i(_d)},set show(k){x(_d,V(k))},get selectedColor(){return i(Hn)},get position(){return i(Wd)},$$events:{colorChange:k=>{i(Eu).length>i($l)&&(i(Eu)[i($l)].styles.duty.color=k.detail.rgba||k.detail.color,xf(i($l)))}}});var Mn=v(Er,2),Do=Bt(()=>{var k,N,j;return((j=(N=(k=i(Eu)[i($l)])==null?void 0:k.styles)==null?void 0:N.dLine)==null?void 0:j.color)||"#FF6D00"});mc(Mn,{get show(){return i(Rd)},set show(k){x(Rd,V(k))},get selectedColor(){return i(Do)},get position(){return i(Wd)},$$events:{colorChange:k=>{i(Eu).length>i($l)&&(i(Eu)[i($l)].styles.dLine.color=k.detail.rgba||k.detail.color,xf(i($l)))}}});var Jr=v(Mn,2),Mr=Bt(()=>{var k,N;return((N=(k=i(Eu)[i($l)])==null?void 0:k.styles)==null?void 0:N.overboughtColor)||"#EF4444"});mc(Jr,{get show(){return i(fc)},set show(k){x(fc,V(k))},get selectedColor(){return i(Mr)},get position(){return i(Wd)},$$events:{colorChange:k=>{i(Eu).length>i($l)&&(i(Eu)[i($l)].styles.overboughtColor=k.detail.rgba||k.detail.color,xf(i($l)))}}});var vr=v(Jr,2),Il=Bt(()=>{var k,N;return((N=(k=i(Eu)[i($l)])==null?void 0:k.styles)==null?void 0:N.oversoldColor)||"#10B981"});mc(vr,{get show(){return i(pp)},set show(k){x(pp,V(k))},get selectedColor(){return i(Il)},get position(){return i(Wd)},$$events:{colorChange:k=>{i(Eu).length>i($l)&&(i(Eu)[i($l)].styles.oversoldColor=k.detail.rgba||k.detail.color,xf(i($l)))}}});var mi=v(vr,2),Xi=Bt(()=>{var k,N;return((N=(k=i(Eu)[i($l)])==null?void 0:k.styles)==null?void 0:N.midLineColor)||"#6B7280"});return mc(mi,{get show(){return i(kd)},set show(k){x(kd,V(k))},get selectedColor(){return i(Xi)},get position(){return i(Wd)},$$events:{colorChange:k=>{i(Eu).length>i($l)&&(i(Eu)[i($l)].styles.midLineColor=k.detail.rgba||k.detail.color,xf(i($l)))}}}),q(n,ae),$d({clearCciGroups:ur,clearEmvGroups:kr,clearMtmGroups:Lu,clearObvGroups:iu,clearPsyGroups:bd,clearPvtGroups:pc,clearVolGroups:Wc,clearWrGroups:Od,clearRocGroups:Wf,clearRsiGroups:om,clearStochasticGroups:av})}Ip(["click","change","input"]);function XG(n,e,t){const s=n.target;x(e,parseInt(s.value)),t()}function ZG(n,e){n.target===n.currentTarget&&e(!1)}var JG=n=>n.stopPropagation(),QG=(n,e)=>e(!1),eY=(n,e)=>e("linear"),tY=(n,e)=>e("radial"),nY=(n,e,t)=>e(i(t).angle),sY=ke('<button class="w-8 h-8 text-sm rounded border transition-colors flex items-center justify-center"> </button>'),oY=ke('<div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Direction</label> <div class="grid grid-cols-4 gap-1 mb-3"></div> <div class="relative"><input type="range" min="0" max="360" class="w-full h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <div class="flex justify-between text-xs text-gray-500 mt-1"><span>0°</span> <span class="text-gray-300"> </span> <span>360°</span></div></div></div>'),iY=ke('<button class="absolute -top-2 -right-1 w-3 h-3 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hover:bg-red-600 transition-colors">×</button>'),rY=ke('<div class="absolute top-0 w-4 h-6 border-2 rounded cursor-grab transform -translate-x-1/2"><!></div>'),aY=ke('<button class="mt-2 w-full py-1 text-xs text-gray-400 border border-dashed border-gray-600 rounded hover:border-gray-400 hover:text-gray-300 transition-colors">+ Add Color Stop</button>'),lY=(n,e,t)=>e(i(t),parseInt(n.currentTarget.value)),cY=(n,e,t)=>e(n,i(t)),uY=(n,e,t)=>e(i(t),n.currentTarget.value),dY=(n,e,t)=>e(i(t),parseInt(n.currentTarget.value)),fY=ke('<div class="mb-4 p-3 bg-[#1A1A1A] rounded border border-[#404040]"><h4 class="text-xs font-medium text-gray-300 mb-3"> </h4> <div class="mb-3"><label class="block text-xs text-gray-400 mb-1">Position</label> <div class="flex items-center gap-2"><input type="range" min="0" max="100" class="flex-1 h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <span class="text-xs text-gray-300 w-8"> </span></div></div> <div class="mb-3"><label class="block text-xs text-gray-400 mb-1">Color</label> <div class="flex items-center gap-2"><button class="w-8 h-8 rounded border-2 border-[#404040] cursor-pointer hover:border-gray-300 transition-colors"></button> <input type="text" class="flex-1 px-2 py-1 bg-[#404040] border border-[#555] rounded text-white text-xs focus:border-blue-500 focus:outline-none" placeholder="#000000"></div></div> <div><label class="block text-xs text-gray-400 mb-1">Opacity</label> <div class="flex items-center gap-2"><input type="range" min="0" max="100" class="flex-1 h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <span class="text-xs text-gray-300 w-8"> </span></div></div></div>'),pY=ke('<div class="fixed inset-0 z-[360000] flex items-center justify-center p-4"><div class="gradient-editor-container bg-[#2A2A2A] border border-[#404040] rounded-lg shadow-xl w-full max-w-sm max-h-[90vh] overflow-y-auto svelte-e3zmk9"><div class="p-4"><div class="mb-4"><div class="flex items-center justify-between mb-3"><h3 class="text-sm font-semibold text-white">Gradient Editor</h3> <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors">OK</button></div> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Gradient Type</label> <div class="flex gap-2"><button class="flex-1 px-3 py-2 text-xs rounded transition-colors">Linear</button> <button class="flex-1 px-3 py-2 text-xs rounded transition-colors">Radial</button></div></div> <!> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Preview</label> <div class="w-full h-12 rounded border border-[#404040]"></div></div> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Color Stops</label> <div class="relative"><div class="relative w-full h-6 rounded border border-[#404040] cursor-pointer"></div> <!></div></div> <!></div></div></div></div>'),mY=ke("<!> <!>",1);function b5(n,e){Ed(e,!1);const t=Fh();let s=hi(e,"show",12,!1),o=hi(e,"initialGradient",24,()=>({type:"linear",direction:0,stops:[{position:0,color:"#ffffff",opacity:100},{position:100,color:"#000000",opacity:100}]})),r=id(),a=id(),l=!1,c=-1,f=id(!1),u=id(0),d=id(o().type),h=id(o().direction),m=id([...o().stops]);const g=[{angle:0,label:"→",title:"Left to Right"},{angle:45,label:"↗",title:"Bottom-Left to Top-Right"},{angle:90,label:"↑",title:"Bottom to Top"},{angle:135,label:"↖",title:"Bottom-Right to Top-Left"},{angle:180,label:"←",title:"Right to Left"},{angle:225,label:"↙",title:"Top-Right to Bottom-Left"},{angle:270,label:"↓",title:"Top to Bottom"},{angle:315,label:"↘",title:"Top-Left to Bottom-Right"}];function w(){const oe=[...i(m)].sort((Pe,$e)=>Pe.position-$e.position).map(Pe=>`${C(Pe.color,Pe.opacity/100)} ${Pe.position}%`);return i(d)==="linear"?`linear-gradient(${i(h)}deg, ${oe.join(", ")})`:`radial-gradient(circle, ${oe.join(", ")})`}function C(xe,oe){const Pe=parseInt(xe.slice(1,3),16),$e=parseInt(xe.slice(3,5),16),ze=parseInt(xe.slice(5,7),16);return`rgba(${Pe}, ${$e}, ${ze}, ${oe})`}function P(xe){x(d,xe),ue()}function I(xe){x(h,xe),ue()}function A(){if(i(m).length>=5)return;const xe=[...i(m)].sort((Ke,qe)=>Ke.position-qe.position);let oe=50,Pe=0,$e=50;for(let Ke=0;Ke<xe.length-1;(Ke+=1)-1){const qe=xe[Ke+1].position-xe[Ke].position;qe>Pe&&(Pe=qe,$e=xe[Ke].position+qe/2)}Pe>10&&(oe=$e);const ze={position:oe,color:"#808080",opacity:100};x(m,[...i(m),ze]),x(u,i(m).length-1),ue()}function M(xe){i(m).length<=2||(x(m,i(m).filter((oe,Pe)=>Pe!==xe)),i(u)>=i(m).length&&x(u,i(m).length-1),ue())}function F(xe,oe){f0(m,i(m)[xe].position=Math.max(0,Math.min(100,oe))),ue()}function B(xe,oe){f0(m,i(m)[xe].color=oe),ue()}function $(xe,oe){f0(m,i(m)[xe].opacity=Math.max(0,Math.min(100,oe))),ue()}function L(xe,oe){const Pe=xe.target.getBoundingClientRect();Pe.right+10,Pe.top,x(u,oe),x(f,!0)}function O(xe){i(u)>=0&&i(u)<i(m).length&&(f0(m,i(m)[i(u)].color=xe.detail),ue())}function Y(xe){i(u)>=0&&i(u)<i(m).length&&(f0(m,i(m)[i(u)].opacity=xe.detail),ue())}function ce(xe){if(!i(a))return;const oe=i(a).getBoundingClientRect(),Pe=xe.clientX-oe.left,$e=Pe/oe.width*100;let ze=-1;const Ke=8;if(i(m).forEach((qe,nt)=>{const ft=qe.position/100*oe.width;Math.abs(Pe-ft)<=Ke&&(ze=nt)}),ze>=0)l=!0,c=ze,x(u,ze);else if(i(m).length<5){const qe={position:Math.max(0,Math.min(100,$e)),color:"#808080",opacity:100};x(m,[...i(m),qe]),x(u,i(m).length-1),ue()}}function Q(xe){if(!l||c<0||!i(a))return;const oe=i(a).getBoundingClientRect(),Pe=xe.clientX-oe.left,$e=Math.max(0,Math.min(100,Pe/oe.width*100));f0(m,i(m)[c].position=$e),ue()}function le(){l=!1,c=-1}function ue(){const xe={type:i(d),direction:i(h),stops:[...i(m)],css:w()};t("gradientChange",xe)}b0(()=>{typeof document<"u"&&(document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",le))}),Th(()=>{ue()}),nm(()=>tm(s()),()=>{s()&&typeof document<"u"&&setTimeout(()=>{document.addEventListener("mousemove",Q),document.addEventListener("mouseup",le)},0)}),nm(()=>tm(s()),()=>{!s()&&typeof document<"u"&&(document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",le))}),x0(),rv();var fe=mY(),pe=fn(fe);Ue(pe,s,xe=>{var oe=pY();oe.__click=[ZG,s];var Pe=y(oe);Pe.__click=[JG];var $e=y(Pe),ze=y($e),Ke=y(ze),qe=v(y(Ke),2);qe.__click=[QG,s],_(Ke);var nt=v(Ke,2),ft=v(y(nt),2),ut=y(ft);ut.__click=[eY,P];var bt=v(ut,2);bt.__click=[tY,P],_(ft),_(nt);var Pt=v(nt,2);Ue(Pt,()=>i(d)==="linear",Ft=>{var ot=oY(),ve=v(y(ot),2);Yo(ve,5,()=>g,Ii,(hn,qn)=>{var On=sY();On.__click=[nY,I,qn];var bn=y(On,!0);_(On),Ce(()=>{Ot(On,"title",i(qn).title),wr(On,"border-blue-500",i(h)===i(qn).angle),wr(On,"bg-blue-600",i(h)===i(qn).angle),wr(On,"text-white",i(h)===i(qn).angle),wr(On,"border-[#404040]",i(h)!==i(qn).angle),wr(On,"text-gray-300",i(h)!==i(qn).angle),tt(bn,i(qn).label)}),q(hn,On)}),_(ve);var Ie=v(ve,2),It=y(Ie);xn(It),It.__input=[XG,h,ue];var Dt=v(It,2),Zt=v(y(Dt),2),gn=y(Zt);_(Zt),Zi(2),_(Dt),_(Ie),_(ot),Ce(()=>tt(gn,`${i(h)??""}°`)),Bs(It,()=>i(h),hn=>x(h,hn)),q(Ft,ot)});var Et=v(Pt,2),Mt=v(y(Et),2);const Je=ov(()=>`background: ${w()??""};`);_(Et);var Ct=v(Et,2),Ze=v(y(Ct),2),Xe=y(Ze);const Ae=ov(()=>`background: ${w()??""};`);Xe.__mousedown=ce,Yo(Xe,5,()=>i(m),Ii,(Ft,ot,ve)=>{var Ie=rY();Ie.__click=Dt=>{Dt.stopPropagation(),x(u,ve)};var It=y(Ie);Ue(It,()=>i(m).length>2,Dt=>{var Zt=iY();Zt.__click=gn=>{gn.stopPropagation(),M(ve)},q(Dt,Zt)}),_(Ie),Ce(()=>{Ot(Ie,"style",`left: ${i(ot).position??""}%; background-color: ${i(ot).color??""};`),wr(Ie,"border-white",ve===i(u)),wr(Ie,"border-gray-500",ve!==i(u))}),q(Ft,Ie)}),_(Xe),tp(Xe,Ft=>x(a,Ft),()=>i(a));var Qe=v(Xe,2);Ue(Qe,()=>i(m).length<5,Ft=>{var ot=aY();ot.__click=A,q(Ft,ot)}),_(Ze),_(Ct);var gt=v(Ct,2);Ue(gt,()=>i(u)>=0&&i(u)<i(m).length,Ft=>{var ot=fY(),ve=y(ot),Ie=y(ve);_(ve);var It=v(ve,2),Dt=v(y(It),2),Zt=y(Dt);xn(Zt),Zt.__input=[lY,F,u];var gn=v(Zt,2),hn=y(gn);_(gn),_(Dt),_(It);var qn=v(It,2),On=v(y(qn),2),bn=y(On);bn.__click=[cY,L,u];var Fn=v(bn,2);xn(Fn),Fn.__input=[uY,B,u],_(On),_(qn);var Xs=v(qn,2),oo=v(y(Xs),2),Yn=y(oo);xn(Yn),Yn.__input=[dY,$,u];var _o=v(Yn,2),xs=y(_o);_(_o),_(oo),_(Xs),_(ot),Ce(()=>{tt(Ie,`Stop ${i(u)+1} Configuration`),tt(hn,`${i(m)[i(u)].position??""}%`),Ot(bn,"style",`background-color: ${i(m)[i(u)].color??""};`),tt(xs,`${i(m)[i(u)].opacity??""}%`)}),Bs(Zt,()=>i(m)[i(u)].position,Rt=>f0(m,i(m)[i(u)].position=Rt)),Bs(Fn,()=>i(m)[i(u)].color,Rt=>f0(m,i(m)[i(u)].color=Rt)),Bs(Yn,()=>i(m)[i(u)].opacity,Rt=>f0(m,i(m)[i(u)].opacity=Rt)),q(Ft,ot)}),_(ze),_($e),_(Pe),tp(Pe,Ft=>x(r,Ft),()=>i(r)),_(oe),Ce(()=>{wr(ut,"bg-blue-600",i(d)==="linear"),wr(ut,"text-white",i(d)==="linear"),wr(ut,"bg-[#404040]",i(d)!=="linear"),wr(ut,"text-gray-300",i(d)!=="linear"),wr(bt,"bg-blue-600",i(d)==="radial"),wr(bt,"text-white",i(d)==="radial"),wr(bt,"bg-[#404040]",i(d)!=="radial"),wr(bt,"text-gray-300",i(d)!=="radial"),Ot(Mt,"style",i(Je)),Ot(Xe,"style",i(Ae))}),q(xe,oe)});var Z=v(pe,2);Ue(Z,()=>i(f),xe=>{var oe=ov(()=>{var $e;return(($e=i(m)[i(u)])==null?void 0:$e.color)||"#000000"}),Pe=ov(()=>{var $e;return(($e=i(m)[i(u)])==null?void 0:$e.opacity)||100});qv(xe,{get show(){return i(f)},set show($e){x(f,$e)},get selectedColor(){return i(oe)},get opacity(){return i(Pe)},$$events:{colorChange:O,opacityChange:Y},$$legacy:!0})}),q(n,fe),$d()}Ip(["click","input","mousedown"]);var h0,v0,F0,t1,e2;const h6=class h6 extends Map{constructor(t){super();N1(this,t1);N1(this,h0,new Map);N1(this,v0,L_(0));N1(this,F0,L_(0));if(t){for(var[s,o]of t)super.set(s,o);Lm(this,F0).v=super.size}}has(t){var s=Lm(this,h0),o=s.get(t);if(o===void 0){var r=super.get(t);if(r!==void 0)o=L_(0),s.set(t,o);else return i(Lm(this,v0)),!1}return i(o),!0}forEach(t,s){sb(this,t1,e2).call(this),super.forEach(t,s)}get(t){var s=Lm(this,h0),o=s.get(t);if(o===void 0){var r=super.get(t);if(r!==void 0)o=L_(0),s.set(t,o);else{i(Lm(this,v0));return}}return i(o),super.get(t)}set(t,s){var d;var o=Lm(this,h0),r=o.get(t),a=super.get(t),l=super.set(t,s),c=Lm(this,v0);if(r===void 0)o.set(t,L_(0)),x(Lm(this,F0),super.size),A1(c);else if(a!==s){A1(r);var f=c.reactions===null?null:new Set(c.reactions),u=f===null||!((d=r.reactions)!=null&&d.every(h=>f.has(h)));u&&A1(c)}return l}delete(t){var s=Lm(this,h0),o=s.get(t),r=super.delete(t);return o!==void 0&&(s.delete(t),x(Lm(this,F0),super.size),x(o,-1),A1(Lm(this,v0))),r}clear(){if(super.size!==0){super.clear();var t=Lm(this,h0);x(Lm(this,F0),0);for(var s of t.values())x(s,-1);A1(Lm(this,v0)),t.clear()}}keys(){return i(Lm(this,v0)),super.keys()}values(){return sb(this,t1,e2).call(this),super.values()}entries(){return sb(this,t1,e2).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return i(Lm(this,F0)),super.size}};h0=new WeakMap,v0=new WeakMap,F0=new WeakMap,t1=new WeakSet,e2=function(){i(Lm(this,v0));var t=Lm(this,h0);if(Lm(this,F0).v!==t.size)for(var s of S6(h6.prototype,this,"keys").call(this))t.has(s)||t.set(s,L_(0));for(var[,o]of Lm(this,h0))i(o)};let _y=h6;function Cw(n="dark"){return{version:2,canvas:{background:{mode:"solid",solid:{color:n==="dark"?"#070211":"#ffffff",alpha:1}},grid:{mode:"solid",solid:{color:n==="dark"?"#081115":"#F3F3F3",alpha:1}}}}}function Lb(n){return JSON.parse(JSON.stringify(n))}function hY(n,e="dark"){const s={current:Cw(e),pending:null,chartId:n};return $m(s)}function vY(n,e){if(typeof window>"u"||!window.localStorage)return;const t=`dutyai.chart.theme.${n}`;try{localStorage.setItem(t,JSON.stringify(e)),console.debug("THEME_PERSIST",{chartId:n,settings:e})}catch(s){console.error("Failed to persist theme settings:",s)}}function x5(n,e="dark"){if(typeof window>"u"||!window.localStorage)return Cw(e);const t=`dutyai.chart.theme.${n}`;try{const s=localStorage.getItem(t);if(s){const o=JSON.parse(s);if(o.version===2&&o.canvas)return console.debug("THEME_LOAD",{chartId:n,settings:o}),o}}catch(s){console.error("Failed to load persisted theme settings:",s)}return Cw(e)}function gY(n){if(!n||!n.stops||n.stops.length===0)return"transparent";const e=n.stops.map(t=>{const s=t.alpha!==void 0?t.alpha:1,o=t.color;if(s!==1&&o.startsWith("#")){const r=parseInt(o.slice(1,3),16),a=parseInt(o.slice(3,5),16),l=parseInt(o.slice(5,7),16);return`rgba(${r}, ${a}, ${l}, ${s}) ${t.offset*100}%`}return`${o} ${t.offset*100}%`}).join(", ");if(n.type==="linear")return`linear-gradient(${n.angle||0}deg, ${e})`;if(n.type==="radial"){const t=n.cx||.5,s=n.cy||.5;return n.r,`radial-gradient(circle at ${t*100}% ${s*100}%, ${e})`}return"transparent"}function Tx(n,e=1){if(!n.startsWith("#"))return n;const t=parseInt(n.slice(1,3),16),s=parseInt(n.slice(3,5),16),o=parseInt(n.slice(5,7),16);return`rgba(${t}, ${s}, ${o}, ${e})`}class m6{constructor(e,t,s="dark"){Te(this,"settingsStore");Te(this,"chart");Te(this,"chartId");Te(this,"pendingThemeApplication",null);Te(this,"chartUnsubscribe",null);Te(this,"chartReadinessTimeout",null);Te(this,"applyCanvasColorsFn",null);this.chartId=e,this.chart=t,this.settingsStore=hY(e,s),this.setupChartReadinessMonitoring(),this.loadPersistedSettings(s)}setApplyCanvasColorsFunction(e){this.applyCanvasColorsFn=e,console.log("🎨 Canvas colors function registered with theme manager")}applyCanvasColorsIfAvailable(){this.applyCanvasColorsFn&&(console.log("🎨 Applying canvas colors via theme manager"),this.applyCanvasColorsFn())}getStore(){return this.settingsStore}setupChartReadinessMonitoring(){this.chartUnsubscribe=this.chart.subscribe(e=>{e&&this.pendingThemeApplication&&(console.log("📊 Chart became available, applying pending theme"),this.applyTheme(this.pendingThemeApplication,{preview:!1}),this.pendingThemeApplication=null,this.chartReadinessTimeout&&(clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=null))})}setupChartReadinessTimeout(){this.chartReadinessTimeout&&clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=setTimeout(()=>{this.pendingThemeApplication&&(console.warn("📊 Chart readiness timeout - clearing pending theme application"),this.pendingThemeApplication=null),this.chartReadinessTimeout=null},1e4)}destroy(){this.chartUnsubscribe&&(this.chartUnsubscribe(),this.chartUnsubscribe=null),this.chartReadinessTimeout&&(clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=null)}loadPersistedSettings(e){let t=x5(this.chartId,e);const s=this.loadFromLegacySystem();s&&(t=this.mergeThemeSettings(t,s)),this.settingsStore.update(r=>({...r,current:t})),vm(this.chart)?this.applyTheme(t,{preview:!1}):(console.log("📊 Chart not ready, deferring theme application"),this.pendingThemeApplication=t,this.setupChartReadinessTimeout())}loadFromLegacySystem(){var e,t,s,o,r,a;try{const l=localStorage.getItem("chart");if(!l)return null;const c=JSON.parse(l);if(!c.styles)return null;console.log("📦 Loading from localStorage - chart type:",(t=(e=c.styles)==null?void 0:e.candle)==null?void 0:t.type);const f={canvas:{background:{},grid:{}}},u=c.styles.backgroundType||"solid";u==="solid"&&c.styles.backgroundColor?f.canvas.background={mode:"solid",solid:{color:c.styles.backgroundColor,alpha:(c.styles.backgroundOpacity??100)/100}}:u==="gradient"&&c.styles.backgroundGradient&&(f.canvas.background={mode:"gradient",gradient:c.styles.backgroundGradient});const d=c.styles.gridType||"solid";if(d==="solid"){const h=((o=(s=c.styles.grid)==null?void 0:s.horizontal)==null?void 0:o.color)||((a=(r=c.styles.grid)==null?void 0:r.vertical)==null?void 0:a.color);if(h){const m=this.extractHexFromColor(h),g=c.styles.gridOpacity??100;f.canvas.grid={mode:"solid",solid:{color:m,alpha:g/100}}}}else d==="gradient"&&c.styles.gridGradient&&(f.canvas.grid={mode:"gradient",gradient:c.styles.gridGradient});return console.debug("LEGACY_LOAD",{loadedSettings:f}),f}catch(l){return console.error("Failed to load from legacy system:",l),null}}extractHexFromColor(e){if(e.startsWith("#"))return e;if(e.startsWith("rgba")||e.startsWith("rgb")){const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(t){const s=parseInt(t[1]).toString(16).padStart(2,"0"),o=parseInt(t[2]).toString(16).padStart(2,"0"),r=parseInt(t[3]).toString(16).padStart(2,"0");return`#${s}${o}${r}`}}return e}mergeThemeSettings(e,t){var o,r;const s=Lb(e);return(o=t.canvas)!=null&&o.background&&(s.canvas.background=t.canvas.background),(r=t.canvas)!=null&&r.grid&&(s.canvas.grid=t.canvas.grid),s}openModal(){this.settingsStore.update(e=>(e.pending===null&&(e.pending=Lb(e.current),console.debug("THEME_MODAL_OPEN",{pending:e.pending})),e))}updatePending(e,t=!1){this.settingsStore.update(s=>(s.pending&&(e(s.pending),t&&this.applyTheme(s.pending,{preview:!0}),console.debug("THEME_PENDING_UPDATE",{pending:s.pending,applyPreview:t})),s))}confirm(){this.settingsStore.update(e=>(e.pending&&(e.current=Lb(e.pending),vY(this.chartId,e.current),this.applyTheme(e.current,{preview:!1}),this.syncToLegacySystem(e.current),console.debug("THEME_COMMIT",{current:e.current}),e.pending=null),e))}syncToLegacySystem(e){var t,s;try{const o=localStorage.getItem("chart");if(o){const r=JSON.parse(o),a=(s=(t=r.styles)==null?void 0:t.candle)==null?void 0:s.type;if(console.log("🔒 Preserving chart type in syncToLegacySystem:",a),r.styles||(r.styles={}),e.canvas.background.mode==="solid"&&e.canvas.background.solid?(r.styles.backgroundColor=e.canvas.background.solid.color,r.styles.backgroundOpacity=(e.canvas.background.solid.alpha??1)*100,r.styles.backgroundType="solid",delete r.styles.backgroundGradient):e.canvas.background.mode==="gradient"&&e.canvas.background.gradient&&(r.styles.backgroundGradient=e.canvas.background.gradient,r.styles.backgroundType="gradient",delete r.styles.backgroundColor,delete r.styles.backgroundOpacity),e.canvas.grid.mode==="solid"&&e.canvas.grid.solid){r.styles.grid||(r.styles.grid={}),r.styles.grid.horizontal||(r.styles.grid.horizontal={}),r.styles.grid.vertical||(r.styles.grid.vertical={});const l=e.canvas.grid.solid.alpha!==void 0&&e.canvas.grid.solid.alpha!==1?Tx(e.canvas.grid.solid.color,e.canvas.grid.solid.alpha):e.canvas.grid.solid.color;r.styles.grid.horizontal.color=l,r.styles.grid.vertical.color=l,r.styles.gridOpacity=(e.canvas.grid.solid.alpha??1)*100,r.styles.gridType="solid",delete r.styles.gridGradient}else e.canvas.grid.mode==="gradient"&&e.canvas.grid.gradient&&(r.styles.gridGradient=e.canvas.grid.gradient,r.styles.gridType="gradient");a&&(r.styles.candle||(r.styles.candle={}),r.styles.candle.type=a,console.log("✅ Restored chart type in syncToLegacySystem:",a)),localStorage.setItem("chart",JSON.stringify(r)),console.debug("LEGACY_SYNC",{syncedStyles:r.styles,preservedChartType:a})}}catch(o){console.error("Failed to sync to legacy system:",o)}}cancel(){this.settingsStore.update(e=>(e.pending&&(this.applyTheme(e.current,{preview:!1}),console.debug("THEME_CANCEL",{reverted_to:e.current}),e.pending=null),e))}reset(){this.settingsStore.update(e=>(e.pending&&(e.pending=Lb(e.current),this.applyTheme(e.pending,{preview:!0}),console.debug("THEME_RESET",{pending:e.pending})),e))}applyTheme(e,t={}){const s=vm(this.chart);if(!s){console.log("📊 Chart not available for theme application, storing for later"),t.preview||(this.pendingThemeApplication=e,this.setupChartReadinessTimeout());return}if(!e||!e.canvas){console.warn("Invalid theme configuration, skipping application");return}const o=t.preview||!1;o?this.addPreviewWatermark():this.removePreviewWatermark();try{e.canvas.background&&this.applyBackground(e.canvas.background),o||(e.canvas.grid&&this.applyGrid(e.canvas.grid,s),setTimeout(()=>{this.applyCanvasColorsIfAvailable()},150)),console.debug("THEME_APPLIED",{theme:e.canvas,preview:o,chartId:this.chartId,appliedGrid:!o})}catch(r){console.error("Failed to apply theme:",r)}}applyBackground(e){const t=document.querySelector(".duty-main"),s=document.querySelector(".duty-widget");if(!t&&!s){console.warn("Chart containers not found for background application");return}if(!e){console.warn("Background configuration is null or undefined, skipping");return}let o;if(e.mode==="solid"&&e.solid&&e.solid.color){const r=e.solid.alpha!==void 0?e.solid.alpha:1;o=r!==1?Tx(e.solid.color,r):e.solid.color}else e.mode==="gradient"&&e.gradient?o=gY(e.gradient):(console.warn("Invalid background configuration, using fallback"),o="#070211");console.log("🎨 Applying background:",o),[t,s].forEach(r=>{r&&(r.style.removeProperty("background"),r.style.removeProperty("background-color"),r.offsetHeight,r.style.background=o,r.style.backgroundColor=o,r.style.setProperty("--chart-background-color",o),r.offsetHeight)})}applyGrid(e,t){var a,l;const s=t.getStyles()??{},o=An.cloneDeep(s);try{const c=localStorage.getItem("chart");if(c){const f=JSON.parse(c);(l=(a=f.styles)==null?void 0:a.candle)!=null&&l.type&&(o.candle||(o.candle={}),o.candle.type=f.styles.candle.type,console.log("🔒 Preserved chart type in applyGrid:",f.styles.candle.type))}}catch(c){console.warn("Failed to preserve chart type:",c)}let r;if(e.mode==="solid"&&e.solid){const c=e.solid.alpha!==void 0?e.solid.alpha:1;r=c!==1?Tx(e.solid.color,c):e.solid.color}else if(e.mode==="gradient"&&e.gradient){const c=e.gradient.stops;if(c.length===1)r=c[0].color;else if(c.length>=2)r=this.blendColors(c[0].color,c[c.length-1].color,.5);else{console.warn("Invalid grid gradient configuration");return}}else{console.warn("Invalid grid configuration");return}console.log("🎨 ThemeManager applying grid color:",r),An.set(o,"grid.horizontal.color",r),An.set(o,"grid.vertical.color",r),t.setStyles(o),console.log("✅ Applied grid styles directly:",{gridColor:r,gridConfig:o.grid})}blendColors(e,t,s){if(!e.startsWith("#")||!t.startsWith("#"))return e;const o=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16),l=parseInt(t.slice(1,3),16),c=parseInt(t.slice(3,5),16),f=parseInt(t.slice(5,7),16),u=Math.round(o*(1-s)+l*s),d=Math.round(r*(1-s)+c*s),h=Math.round(a*(1-s)+f*s);return`#${u.toString(16).padStart(2,"0")}${d.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}`}addPreviewWatermark(){this.removePreviewWatermark();const e=document.querySelector(".duty-main");if(!e)return;const t=document.createElement("div");t.id="theme-preview-watermark",t.style.cssText=`
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 0, 0, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      z-index: 1000;
      pointer-events: none;
    `,t.textContent="PREVIEW",e.style.position="relative",e.appendChild(t)}removePreviewWatermark(){const e=document.getElementById("theme-preview-watermark");e&&e.remove()}getCurrentSettings(){return vm(this.settingsStore).current}getPendingSettings(){return vm(this.settingsStore).pending}isModalOpen(){return vm(this.settingsStore).pending!==null}resetToThemeDefaults(e){const t=x5(this.chartId,e);this.settingsStore.update(s=>({...s,current:t,pending:null})),console.log("🔄 Reset TransactionalThemeManager to theme defaults:",e)}}function _Y(n,e,t){const s=n.target.checked;x(e,V(s)),t({wick:s})}function yY(n,e,t){const s=n.target.value;x(e,V(s)),t({source:s})}function bY(n,e,t){const s="ATR";x(e,s),t({method:s})}function xY(n,e,t){const s=parseInt(n.target.value||"14",10),o=Math.max(1,isNaN(s)?14:s);x(e,V(o)),t({atrLength:o})}function wY(n,e,t){const s=n.target.value;x(e,V(s)),t({boxSizeMode:s})}function kY(n,e,t){const s=parseFloat(n.target.value||"1"),o=Math.max(1e-4,isNaN(s)?1:s);x(e,V(o)),t({boxSize:o})}function SY(n,e,t){const s=parseInt(n.target.value||"14",10),o=Math.max(1,isNaN(s)?14:s);x(e,V(o)),t({atrLength:o})}function CY(n,e,t){const s=parseInt(n.target.value||"3",10),o=Math.max(1,isNaN(s)?3:s);x(e,V(o)),t({reversalBoxes:o})}function IY(n,e,t){const s=n.target.value;x(e,V(s)),t({upColor:s})}function PY(n,e,t){const s=n.target.value;x(e,V(s)),t({downColor:s})}function MY(n,e,t,s,o,r,a,l){x(e,"ATR"),x(t,1),x(s,14),x(o,3),x(r,"#00E6D8"),x(a,"#FF4D4D"),l({boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"})}function NY(n,e,t,s,o,r,a,l,c,f){if(i(e)==="solid"){const u=n.target.getBoundingClientRect();x(t,V({x:u.right+10,y:u.top})),x(s,!0),x(o,!1),x(r,!1),x(a,!1),x(l,!1),x(c,!1),f()}else i(e)==="gradient"&&(x(r,!0),x(s,!1),x(o,!1),x(a,!1),x(l,!1),x(c,!1))}function AY(n,e,t,s,o,r,a,l,c){if(console.log("🔥 Grid picker clicked, type:",i(e)),i(e)==="solid"){const f=n.target.getBoundingClientRect();x(t,V({x:f.right+10,y:f.top})),console.log("🔥 Opening grid color picker at:",i(t)),x(s,!0),x(o,!1),x(r,!1),x(a,!1),x(l,!1),x(c,!1)}else i(e)==="gradient"&&(x(a,!0),x(s,!1),x(o,!1),x(r,!1),x(l,!1),x(c,!1))}function TY(n,e,t,s,o,r,a,l,c){const f=n.target.getBoundingClientRect();x(e,V({x:f.right+10,y:f.top})),x(t,!0),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c()}function FY(n,e,t,s,o,r,a,l,c){const f=n.target.getBoundingClientRect();x(e,V({x:f.right+10,y:f.top})),x(t,!0),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c()}function LY(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function EY(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function $Y(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function DY(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function RY(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function jY(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function BY(n,e,t){x(e,!i(e)),t()}function OY(n,e,t){x(e,!i(e)),t()}function zY(n,e,t){x(e,!i(e)),t()}var VY=(n,e)=>x(e,"canvas"),WY=(n,e)=>x(e,"other"),HY=(n,e)=>x(e,"candle"),qY=(n,e)=>x(e,"renko"),UY=ke('<button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Duty AI Renko</button>'),GY=(n,e)=>x(e,"pnf"),YY=ke('<button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Point & Figure</button>'),KY=ke('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Canvas Settings</h4> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Background color</label> <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3"><select class="select select-bordered select-sm w-full sm:w-32"><option>Solid</option><option>Gradient</option></select> <button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Grid color</label> <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3"><select class="select select-bordered select-sm w-full sm:w-32"><option>Solid</option><option>Gradient</option></select> <button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">X-Axis tick text color</label> <div class="flex items-center space-x-3"><button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Y-Axis tick text color</label> <div class="flex items-center space-x-3"><button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div></div>'),XY=(n,e,t)=>e(i(t).key,n.target.value),ZY=ke("<option> </option>"),JY=ke('<select class="select select-bordered select-sm w-full sm:w-32 flex-shrink-0"></select>'),QY=(n,e,t)=>e(i(t).key,n.target.checked),eK=ke('<input type="checkbox" class="toggle toggle-sm flex-shrink-0">'),tK=ke('<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-2 space-y-2 sm:space-y-0"><label class="text-sm font-medium text-base-content/80 flex-1"> </label> <!></div>'),nK=ke('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Other Settings</h4> <div class="grid grid-cols-1 gap-4"></div></div>'),sK=ke('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Candle Color Customization</h4> <div class="space-y-4"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b border-base-300"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Body</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div> <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b border-base-300"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Borders</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div> <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Wick</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div></div></div>'),oK=ke('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Duty AI Renko Settings</h4> <div class="space-y-4 p-3 rounded-lg border border-base-300"><div class="flex items-center gap-3"><label class="flex items-center gap-2"><input type="checkbox" class="checkbox checkbox-sm"> <span>Wick</span></label></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><div class="flex flex-col gap-1"><label class="text-xs opacity-80">Source</label> <select class="select select-bordered select-sm"><option>Close</option><option>Open</option><option>High</option><option>Low</option></select></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">Box size assignment method</label> <select class="select select-bordered select-sm" disabled><option>ATR</option></select></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">ATR length</label> <input type="number" min="1" class="input input-bordered input-sm"></div></div></div></div>'),iK=ke('<div class="flex flex-col gap-1"><label class="text-xs opacity-80">ATR Length</label> <input type="number" min="1" max="200" step="1" class="input input-bordered input-sm"></div>'),rK=ke('<div class="flex flex-col gap-1"><label class="text-xs opacity-80"> </label> <input type="number" min="0.0001" step="0.1" class="input input-bordered input-sm"></div>'),aK=ke('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Point & Figure Settings</h4> <div class="space-y-4 p-3 rounded-lg border border-base-300"><div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><div class="flex flex-col gap-1"><label class="text-xs opacity-80">Box Size Mode</label> <select class="select select-bordered select-sm"><option>ATR (Auto-fit)</option><option>Absolute (Price Units)</option><option>Percent (%)</option></select></div> <!></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">Reversal Boxes (typical: 3)</label> <input type="number" min="1" max="10" step="1" class="input input-bordered input-sm w-32"></div> <div class="pt-2 border-t border-base-300"><h5 class="text-sm font-medium mb-3">Symbol Colors</h5> <div class="grid grid-cols-2 gap-4"><div class="flex flex-col items-center gap-2"><label class="text-xs opacity-80">Up Column (X)</label> <div class="flex items-center gap-2"><input type="color" class="w-10 h-10 cursor-pointer rounded border border-base-300"> <span class="text-xs font-mono opacity-70"> </span></div></div> <div class="flex flex-col items-center gap-2"><label class="text-xs opacity-80">Down Column (O)</label> <div class="flex items-center gap-2"><input type="color" class="w-10 h-10 cursor-pointer rounded border border-base-300"> <span class="text-xs font-mono opacity-70"> </span></div></div></div></div> <div class="pt-4 border-t border-base-300"><button class="btn btn-sm btn-outline">Reset P&F to Defaults</button></div></div></div>'),lK=ke('<div class="flex flex-col lg:flex-row min-h-[400px] max-h-[70vh] overflow-hidden"><div class="w-full lg:w-48 border-b lg:border-b-0 lg:border-r border-base-300 pb-4 lg:pb-0 lg:pr-4 mb-4 lg:mb-0"><div class="flex lg:flex-col space-x-2 lg:space-x-0 lg:space-y-2 overflow-x-auto lg:overflow-x-visible"><button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Canvas</button> <button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Other Settings</button> <button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Candle</button> <!> <!></div></div> <div class="flex-1 lg:pl-6 overflow-y-auto"><!></div></div>'),cK=ke("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function z8(n,e){Ed(e,!0);const t=sm(),s=()=>wl(c,"$save",t),o=()=>wl(f,"$chart",t),r=()=>wl(l,"$ctx",t);let a=hi(e,"show",15);const l=gd("ctx"),c=gd("save"),f=gd("chart"),u=new m6("chart-settings",f,"dark");b0(()=>{u.destroy()});let d=ge(!1),h=null;Fr(()=>{var $n,ws,Us,Dn,ni;if(a())console.log("🔧 Settings modal OPENED"),console.log("  - Current $save.styles.candle.type:",(ws=($n=s().styles)==null?void 0:$n.candle)==null?void 0:ws.type),console.log("  - Current chart.getStyles().candle.type:",(ni=(Dn=(Us=o())==null?void 0:Us.getStyles())==null?void 0:Dn.candle)==null?void 0:ni.type),x(d,!1),u.openModal();else if(!i(d)){console.log("🚫 Settings modal CANCELLED"),h&&(clearTimeout(h),h=null);try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors()}});let m=ge("canvas");const g=new _y;let w=ge(!1),C=ge(!1),P=ge(!1),I=ge(!1),A=ge(V({x:0,y:0})),M=ge(V({x:0,y:0})),F=ge(V({x:0,y:0})),B=ge(V({x:0,y:0})),$=ge(!1),L=ge(!1),O=ge(!1),Y=ge(!1),ce=ge(!1),Q=ge(!1),le=ge(V({x:0,y:0})),ue=ge(V({x:0,y:0})),fe=ge(V({x:0,y:0})),pe=ge(V({x:0,y:0})),Z=ge(V({x:0,y:0})),xe=ge(V({x:0,y:0})),oe=ge(!1),Pe=ge(!1),$e=ge(!1),ze=ge(V(An.get(s().styles,"backgroundType")||"solid")),Ke=ge(V(An.get(s().styles,"gridType")||"solid")),qe=ge(V(An.get(s().styles,"backgroundColor")||"#000000")),nt=ge(V(An.get(s().styles,"grid.horizontal.color")||"#333333")),ft=ge(100),ut=ge(100),bt=ge(100),Pt=ge(100);const Et=[{key:"candle.priceMark.last.show",label:"Show Last Price",type:"switch",default:!0},{key:"candle.priceMark.high.show",label:"Show High Price",type:"switch",default:!0},{key:"candle.priceMark.low.show",label:"Show Low Price",type:"switch",default:!0},{key:"indicator.lastValueMark.show",label:"Show Indicator Last Value",type:"switch",default:!0},{key:"yAxis.reverse",label:"Reverse Coordinate",type:"switch",default:!1},{key:"grid.show",label:"Grid Show",type:"switch",default:!0}],Mt=new _y;let Je=ge(!0),Ct=ge(!0),Ze=ge(!0),Xe=ge("#26a69a"),Ae=ge("#ef5350"),Qe=ge("#26a69a"),gt=ge("#ef5350"),Ft=ge("#26a69a"),ot=ge("#ef5350");const ve=Bt(()=>{var $n,ws;return((ws=($n=s().styles)==null?void 0:$n.candle)==null?void 0:ws.type)==="renko_atr"});let Ie=ge(!1),It=ge("close"),Dt=ge("ATR"),Zt=ge(14);Fr(()=>{var ws,Us;if(!a())return;const $n=((Us=(ws=s().styles)==null?void 0:ws.candle)==null?void 0:Us.renko)||{};x(Ie,!!$n.wick),x(It,V($n.source||"close")),x(Dt,V($n.method||"ATR")),x(Zt,V(Math.max(1,($n.atrLength??14)|0)))}),Fr(()=>{a()&&(i(ve)?x(m,V(i(m)==="canvas"||i(m)==="other"?i(m):"renko")):i(m)==="renko"&&x(m,"candle"))});function gn($n){c.update(ws=>{ws.styles||(ws.styles={}),ws.styles.candle||(ws.styles.candle={});const Us=ws.styles.candle;return Us.renko||(Us.renko={method:"ATR",atrLength:14,source:"close",wick:!1}),Us.renko={...Us.renko,...$n},ws})}const hn=Bt(()=>{var $n,ws;return((ws=($n=s().styles)==null?void 0:$n.candle)==null?void 0:ws.type)==="point_and_figure"});let qn=ge("ATR"),On=ge(1),bn=ge(14),Fn=ge(3),Xs=ge("#00E6D8"),oo=ge("#FF4D4D");Fr(()=>{var ws,Us;if(!a())return;const $n=((Us=(ws=s().styles)==null?void 0:ws.candle)==null?void 0:Us.pnf)||{};x(qn,V($n.boxSizeMode||"ATR")),x(On,V(Math.max(1e-4,$n.boxSize??1))),x(bn,V(Math.max(1,Math.round($n.atrLength??14)))),x(Fn,V(Math.max(1,Math.round($n.reversalBoxes??3)))),x(Xs,V($n.upColor||"#00E6D8")),x(oo,V($n.downColor||"#FF4D4D"))}),Fr(()=>{a()&&(i(hn)?x(m,V(i(m)==="canvas"||i(m)==="other"?i(m):"pnf")):i(m)==="pnf"&&x(m,"candle"))});function Yn($n){c.update(ws=>{ws.styles||(ws.styles={}),ws.styles.candle||(ws.styles.candle={});const Us=ws.styles.candle;return Us.pnf||(Us.pnf={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"}),Us.pnf={...Us.pnf,...$n},ws})}let _o=ge(V(An.get(s().styles,"backgroundGradient")||{type:"linear",direction:90,stops:[{position:0,color:"#1a1a1a",opacity:100},{position:100,color:"#4a4a4a",opacity:100}]})),xs=ge(V(An.get(s().styles,"gridGradient")||{type:"linear",direction:90,stops:[{position:0,color:"#2a2a2a",opacity:100},{position:100,color:"#3a3a3a",opacity:100}]}));function Rt($n){if(!$n||!$n.stops)return"";const Us=[...$n.stops].sort((Dn,ni)=>Dn.position-ni.position).map(Dn=>{const ni=parseInt(Dn.color.slice(1,3),16),mo=parseInt(Dn.color.slice(3,5),16),sr=parseInt(Dn.color.slice(5,7),16),or=Dn.opacity/100;return`rgba(${ni}, ${mo}, ${sr}, ${or}) ${Dn.position}%`});return $n.type==="linear"?`linear-gradient(${$n.direction}deg, ${Us.join(", ")})`:`radial-gradient(circle, ${Us.join(", ")})`}function un($n){if(typeof $n=="string"&&$n.startsWith("rgba(")){const ws=$n.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/);if(ws){const Us=parseInt(ws[1]),Dn=parseInt(ws[2]),ni=parseInt(ws[3]);return`#${Us.toString(16).padStart(2,"0")}${Dn.toString(16).padStart(2,"0")}${ni.toString(16).padStart(2,"0")}`}}return $n}function qs(){const $n=s().theme;return{backgroundColor:$n==="dark"?"#0A0F1A":"#ffffff",backgroundOpacity:100,gridColor:$n==="dark"?"#111B2B":"#F3F3F3",gridOpacity:100,xAxisTickTextColor:$n==="dark"?"#b3b3b3":"#000000",yAxisTickTextColor:$n==="dark"?"#b3b3b3":"#000000"}}Fr(()=>{a()&&o()&&(console.log("📂 Modal opened - restoring saved values..."),x($e,!0),g.clear(),ri(),queueMicrotask(()=>{x($e,!1),console.log("✅ Restoration complete - preview enabled")}))}),Fr(()=>{if(!o()||!a()||i($e))return;const $n=i(ft),ws=i(qe),Us=i(ze),Dn=i(_o);Dn==null||Dn.stops,Dn==null||Dn.type,Dn==null||Dn.direction;const ni=document.querySelector(".duty-main"),mo=document.querySelector(".duty-widget");if(Us==="solid"){const sr=g.get("backgroundColor")||ws||qs().backgroundColor,hl=(g.get("backgroundOpacity")??$n??100)/100,Oi=dc(sr,hl);[ni,mo].forEach(si=>{if(si){const Wo=si;Wo.style.removeProperty("background"),Wo.style.removeProperty("background-color"),Wo.offsetHeight,Wo.style.setProperty("background",Oi,"important"),Wo.style.setProperty("background-color",Oi,"important"),Wo.style.setProperty("--chart-background-color",Oi),Wo.offsetHeight}})}else if(Us==="gradient"){const sr=g.get("backgroundGradient")||Dn;let or=sr;(!sr||!sr.stops||sr.stops.length===0)&&(or={type:"linear",direction:90,stops:[{position:0,color:"#1a1a1a",opacity:100},{position:100,color:"#4a4a4a",opacity:100}]},g.set("backgroundGradient",or));const hl=or.css||Rt(or);[ni,mo].forEach(Oi=>{if(Oi){const si=Oi;si.style.removeProperty("background"),si.style.removeProperty("background-color"),si.offsetHeight,si.style.setProperty("background",hl,"important"),si.style.setProperty("background-color",hl,"important"),si.style.setProperty("--chart-background-color",hl),si.offsetHeight}})}}),Fr(()=>{var ni,mo,sr,or;if(!o()||!a()||i($e))return;const $n=i(ut),ws=i(nt),Us=i(Ke),Dn=i(xs);if(Dn==null||Dn.stops,Dn==null||Dn.type,Dn==null||Dn.direction,console.log("🔄 Grid effect triggered:",{gridColorType:Us,gridColor:ws,gridOpacity:$n}),Us==="solid"){const hl=g.get("gridColor")||ws||qs().gridColor,Oi=g.get("gridOpacity")??$n??100,si=dc(hl,Oi/100);console.log("🎨 Applying solid grid color via effect:",si);const Wo=o().getStyles()??{},Ua=An.cloneDeep(Wo);(mo=(ni=s().styles)==null?void 0:ni.candle)!=null&&mo.type&&An.set(Ua,"candle.type",s().styles.candle.type);const Hi=An.get(Wo,"grid.show",!0);An.set(Ua,"grid.show",Hi),An.set(Ua,"grid.horizontal.show",Hi),An.set(Ua,"grid.horizontal.color",si),An.set(Ua,"grid.vertical.show",Hi),An.set(Ua,"grid.vertical.color",si),o().setStyles(Ua)}else if(Us==="gradient"){const hl=g.get("gridGradient")||Dn;if(hl&&hl.stops&&hl.stops.length>0){const Oi=hl.stops[0],si=hl.stops[hl.stops.length-1],Wo=jc(Oi.color,si.color,.5);console.log("🎨 Applying gradient grid color via effect:",Wo);const Ua=o().getStyles()??{},Hi=An.cloneDeep(Ua);(or=(sr=s().styles)==null?void 0:sr.candle)!=null&&or.type&&An.set(Hi,"candle.type",s().styles.candle.type);const to=An.get(Ua,"grid.show",!0);An.set(Hi,"grid.show",to),An.set(Hi,"grid.horizontal.show",to),An.set(Hi,"grid.horizontal.color",Wo),An.set(Hi,"grid.vertical.show",to),An.set(Hi,"grid.vertical.color",Wo),o().setStyles(Hi)}}});function ri(){const $n=qs();console.log("🔄 Restoring saved values...",{backgroundType:An.get(s().styles,"backgroundType"),gridType:An.get(s().styles,"gridType")});const ws=An.get(s().styles,"backgroundType")||"solid";if(x(ze,V(ws)),ws==="solid"){const Li=An.get(s().styles,"backgroundColor")||$n.backgroundColor,Vr=An.get(s().styles,"backgroundOpacity")||$n.backgroundOpacity,ba=un(Li);x(qe,V(ba)),x(ft,V(Vr)),g.set("backgroundColor",ba),g.set("backgroundOpacity",Vr),console.log("✅ Restored solid BG:",ba,"opacity:",Vr)}else if(ws==="gradient"){const Li=An.get(s().styles,"backgroundGradient");Li&&(x(_o,V({...Li})),g.set("backgroundGradient",Li),console.log("✅ Restored gradient BG:",Li))}const Us=An.get(s().styles,"gridType")||"solid";if(x(Ke,V(Us)),Us==="solid"){const Li=An.get(s().styles,"grid.horizontal.color")||An.get(s().styles,"grid.vertical.color")||$n.gridColor,Vr=An.get(s().styles,"gridOpacity")||$n.gridOpacity,ba=un(Li);x(nt,V(ba)),x(ut,V(Vr)),g.set("gridColor",ba),g.set("gridOpacity",Vr),console.log("✅ Restored solid Grid:",ba,"opacity:",Vr)}else if(Us==="gradient"){const Li=An.get(s().styles,"gridGradient");Li&&(x(xs,V({...Li})),g.set("gridGradient",Li),console.log("✅ Restored gradient Grid:",Li))}const Dn=An.get(s().styles,"xAxis.tickText.color")||$n.xAxisTickTextColor,ni=An.get(s().styles,"xAxis.tickText.opacity")||100,mo=un(Dn);x(bt,V(ni)),g.set("xAxisTickTextColor",mo),g.set("xAxisTickTextOpacity",ni);const sr=An.get(s().styles,"yAxis.tickText.color")||$n.yAxisTickTextColor,or=An.get(s().styles,"yAxis.tickText.opacity")||100,hl=un(sr);x(Pt,V(or)),g.set("yAxisTickTextColor",hl),g.set("yAxisTickTextOpacity",or);try{if(o()&&typeof o().getStyles=="function"){const Li=o().getStyles()??{},Vr=An.get(Li,"xAxis.tickText.color"),ba=An.get(Li,"yAxis.tickText.color");if(Vr){const qi=un(Vr);g.set("xAxisTickTextColor",qi)}if(ba){const qi=un(ba);g.set("yAxisTickTextColor",qi)}}}catch(Li){console.warn("Failed to read live axis styles from chart:",Li)}const Oi=An.get(s().styles,"candle.bar.upColor")||"#26a69a",si=An.get(s().styles,"candle.bar.downColor")||"#ef5350",Wo=An.get(s().styles,"candle.bar.upBorderColor")||"#26a69a",Ua=An.get(s().styles,"candle.bar.downBorderColor")||"#ef5350",Hi=An.get(s().styles,"candle.bar.upWickColor")||"#26a69a",to=An.get(s().styles,"candle.bar.downWickColor")||"#ef5350";x(Xe,V(Oi)),x(Ae,V(si)),x(Qe,V(Wo)),x(gt,V(Ua)),x(Ft,V(Hi)),x(ot,V(to)),Et.forEach(Li=>{const Vr=An.get(s().styles,Li.key);Vr!==void 0?Mt.set(Li.key,Vr):Mt.set(Li.key,Li.default)})}function Eo($n){if(x(qe,V($n.detail)),g.set("backgroundColor",$n.detail),i(ze)==="solid"){const ws=i(ft)/100,Us=dc($n.detail,ws),Dn=document.querySelector(".duty-main"),ni=document.querySelector(".duty-widget");[Dn,ni].forEach(mo=>{if(mo){const sr=mo;sr.style.removeProperty("background"),sr.style.removeProperty("background-color"),sr.style.removeProperty("background-image"),sr.offsetHeight,sr.style.setProperty("background",Us,"important"),sr.style.setProperty("background-color",Us,"important"),sr.style.setProperty("--chart-background-color",Us),sr.offsetHeight}})}}function Ia($n){if(x(ft,V($n.detail)),g.set("backgroundOpacity",$n.detail),i(ze)==="solid"){const ws=g.get("backgroundColor")||i(qe)||qs().backgroundColor,Us=$n.detail/100,Dn=dc(ws,Us),ni=document.querySelector(".duty-main"),mo=document.querySelector(".duty-widget");[ni,mo].forEach(sr=>{if(sr){const or=sr;or.style.removeProperty("background"),or.style.removeProperty("background-color"),or.offsetHeight,or.style.setProperty("background",Dn,"important"),or.style.setProperty("background-color",Dn,"important"),or.style.setProperty("--chart-background-color",Dn),or.offsetHeight}})}}function Lr($n){var mo,sr;if(console.log("🎨 Grid color changed to:",$n.detail),x(nt,V($n.detail)),g.set("gridColor",$n.detail),!o()){console.warn("⚠️ No chart available for grid color preview");return}const ws=dc($n.detail,i(ut)/100);console.log("🎨 Applying grid color:",ws);const Us=o().getStyles()??{},Dn=An.cloneDeep(Us);(sr=(mo=s().styles)==null?void 0:mo.candle)!=null&&sr.type&&An.set(Dn,"candle.type",s().styles.candle.type);const ni=An.get(Us,"grid.show",!0);An.set(Dn,"grid.show",ni),An.set(Dn,"grid.horizontal.show",ni),An.set(Dn,"grid.horizontal.color",ws),An.set(Dn,"grid.vertical.show",ni),An.set(Dn,"grid.vertical.color",ws),console.log("🎨 New grid styles:",Dn.grid);try{o().setStyles(Dn),console.log("✅ Grid styles applied successfully")}catch(or){console.error("❌ Failed to apply grid styles:",or)}}function Qa($n){var sr,or;if(console.log("🎨 Grid opacity changed to:",$n.detail),x(ut,V($n.detail)),g.set("gridOpacity",$n.detail),!o()){console.warn("⚠️ No chart available for grid opacity preview");return}const ws=g.get("gridColor")||i(nt)||qs().gridColor,Us=dc(ws,$n.detail/100);console.log("🎨 Applying grid opacity:",Us);const Dn=o().getStyles()??{},ni=An.cloneDeep(Dn);(or=(sr=s().styles)==null?void 0:sr.candle)!=null&&or.type&&An.set(ni,"candle.type",s().styles.candle.type);const mo=An.get(Dn,"grid.show",!0);An.set(ni,"grid.show",mo),An.set(ni,"grid.horizontal.show",mo),An.set(ni,"grid.horizontal.color",Us),An.set(ni,"grid.vertical.show",mo),An.set(ni,"grid.vertical.color",Us),console.log("🎨 New grid styles:",ni.grid);try{o().setStyles(ni),console.log("✅ Grid opacity applied successfully")}catch(hl){console.error("❌ Failed to apply grid opacity:",hl)}}function yr($n){if(g.set("xAxisTickTextColor",$n.detail),o()){const ws=o().getStyles()??{},Us=An.cloneDeep(ws);An.set(Us,"xAxis.tickText.color",$n.detail);const Dn=Xd(Us);o().setStyles(Dn)}}function Fi($n){if(g.set("yAxisTickTextColor",$n.detail),o()){const ws=o().getStyles()??{},Us=An.cloneDeep(ws);An.set(Us,"yAxis.tickText.color",$n.detail);const Dn=Xd(Us);o().setStyles(Dn)}}function Rc($n){if(x(bt,V($n.detail)),g.set("xAxisTickTextOpacity",$n.detail),o()){const ws=o().getStyles()??{},Us=An.cloneDeep(ws),Dn=g.get("xAxisTickTextColor")||qs().xAxisTickTextColor,ni=$n.detail/100,mo=dc(Dn,ni);An.set(Us,"xAxis.tickText.color",mo);const sr=Xd(Us);o().setStyles(sr)}}function Cu($n){if(x(Pt,V($n.detail)),g.set("yAxisTickTextOpacity",$n.detail),o()){const ws=o().getStyles()??{},Us=An.cloneDeep(ws),Dn=g.get("yAxisTickTextColor")||qs().yAxisTickTextColor,ni=$n.detail/100,mo=dc(Dn,ni);An.set(Us,"yAxis.tickText.color",mo);const sr=Xd(Us);o().setStyles(sr)}}function uc($n){if(x(_o,V({...$n.detail})),g.set("backgroundGradient",i(_o)),i(ze)==="gradient"){const ws=document.querySelector(".duty-main"),Us=document.querySelector(".duty-widget"),Dn=Rt(i(_o));[ws,Us].forEach(ni=>{if(ni){const mo=ni;mo.style.removeProperty("background"),mo.style.removeProperty("background-color"),mo.offsetHeight,mo.style.setProperty("background",Dn,"important"),mo.style.setProperty("background-color",Dn,"important"),mo.style.setProperty("--chart-background-color",Dn),mo.offsetHeight}})}}function Fl($n){var ws,Us;if(x(xs,V({...$n.detail})),g.set("gridGradient",i(xs)),o()&&i(Ke)==="gradient"){const Dn=$n.detail.stops[0],ni=$n.detail.stops[$n.detail.stops.length-1],mo=jc(Dn.color,ni.color,.5),sr=o().getStyles()??{},or=An.cloneDeep(sr);(Us=(ws=s().styles)==null?void 0:ws.candle)!=null&&Us.type&&An.set(or,"candle.type",s().styles.candle.type),An.set(or,"grid.horizontal.color",mo),An.set(or,"grid.vertical.color",mo);const hl=Xd(or);o().setStyles(hl)}}function jc($n,ws,Us){const Dn=$n.replace("#",""),ni=ws.replace("#",""),mo=parseInt(Dn.substr(0,2),16),sr=parseInt(Dn.substr(2,2),16),or=parseInt(Dn.substr(4,2),16),hl=parseInt(ni.substr(0,2),16),Oi=parseInt(ni.substr(2,2),16),si=parseInt(ni.substr(4,2),16),Wo=Math.round(mo*(1-Us)+hl*Us),Ua=Math.round(sr*(1-Us)+Oi*Us),Hi=Math.round(or*(1-Us)+si*Us);return`#${Wo.toString(16).padStart(2,"0")}${Ua.toString(16).padStart(2,"0")}${Hi.toString(16).padStart(2,"0")}`}function nd($n,ws){var sr,or,hl;const Us=(sr=o())==null?void 0:sr.getStyles(),Dn=An.get(Us,$n);if($n==="yAxis.reverse")try{(or=o())==null||or.setPaneOptions({axis:{reverse:ws}}),c.update(Oi=>(An.set(Oi.styles,$n,ws),Oi)),Mt.set($n,ws);return}catch(Oi){console.warn("setPaneOptions not available, falling back to styles:",Oi)}else if($n==="yAxis.type"){console.warn("yAxis.type is not supported in chart engine v10");return}if(Dn==ws)return;Mt.set($n,ws),c.update(Oi=>(An.set(Oi.styles,$n,ws),Oi));const ni=fp(s().theme),mo=An.merge({},ni,s().styles);(hl=o())==null||hl.setStyles(Xd(mo))}function Fa(){let $n=o();if(!$n)return;const ws=$n.getStyles()??{};Et.forEach(Us=>{const Dn=An.get(ws,Us.key);Us.key==="yAxis.reverse"?Mt.set(Us.key,Dn||!1):Mt.set(Us.key,Dn??Us.default)})}function dc($n,ws){const Us=$n.replace("#",""),Dn=parseInt(Us.substr(0,2),16),ni=parseInt(Us.substr(2,2),16),mo=parseInt(Us.substr(4,2),16);return`rgba(${Dn}, ${ni}, ${mo}, ${ws})`}function Bc(){x($,!1),x(L,!1),x(O,!1),x(Y,!1),x(ce,!1),x(Q,!1)}function rd($n){x(Xe,V($n.detail)),Pa()}function uf($n){x(Ae,V($n.detail)),Pa()}function So($n){x(Qe,V($n.detail)),Pa()}function Ll($n){x(gt,V($n.detail)),Pa()}function ya($n){x(Ft,V($n.detail)),Pa()}function hc($n){x(ot,V($n.detail)),Pa()}function Pa(){h&&clearTimeout(h),h=setTimeout(()=>{var Dn,ni;if(!o())return;const $n=o().getStyles()??{},ws=An.cloneDeep($n);(ni=(Dn=s().styles)==null?void 0:Dn.candle)!=null&&ni.type&&An.set(ws,"candle.type",s().styles.candle.type),i(Je)&&(An.set(ws,"candle.bar.upColor",i(Xe)),An.set(ws,"candle.bar.downColor",i(Ae))),i(Ct)&&(An.set(ws,"candle.bar.upBorderColor",i(Qe)),An.set(ws,"candle.bar.downBorderColor",i(gt))),i(Ze)&&(An.set(ws,"candle.bar.upWickColor",i(Ft)),An.set(ws,"candle.bar.downWickColor",i(ot)));const Us=Xd(ws);o().setStyles(Us),h=null},16)}function Yr($n){var ws,Us;if($n==="confirm"){console.log("🔧 CONFIRM CLICKED - Using theme manager"),u.updatePending(Dn=>{if(i(ze)==="solid"){const ni=g.get("backgroundColor")||i(qe),mo=g.get("backgroundOpacity")??i(ft);Dn.canvas.background.mode="solid",Dn.canvas.background.solid={color:ni,alpha:mo/100},delete Dn.canvas.background.gradient}else if(i(ze)==="gradient"){const ni=g.get("backgroundGradient")||i(_o);Dn.canvas.background.mode="gradient",Dn.canvas.background.gradient=ni,delete Dn.canvas.background.solid}if(i(Ke)==="solid"){const ni=g.get("gridColor")||i(nt),mo=g.get("gridOpacity")??i(ut);Dn.canvas.grid.mode="solid",Dn.canvas.grid.solid={color:ni,alpha:mo/100},delete Dn.canvas.grid.gradient}else if(i(Ke)==="gradient"){const ni=g.get("gridGradient")||i(xs);Dn.canvas.grid.mode="gradient",Dn.canvas.grid.gradient=ni,delete Dn.canvas.grid.solid}}),c.update(Dn=>{var mo,sr,or,hl,Oi,si;Dn.styles||(Dn.styles={}),Dn.styles.candle||(Dn.styles.candle={}),Dn.styles.candle.bar||(Dn.styles.candle.bar={}),console.log("🎨 Saving settings - Background Type:",i(ze)),console.log("🎨 Saving settings - Grid Type:",i(Ke));const ni=(sr=(mo=Dn.styles)==null?void 0:mo.candle)==null?void 0:sr.type;if(ni&&console.log("🔒 Preserving chart type:",ni),i(ze)==="solid"){const Wo=g.get("backgroundColor")||i(qe),Ua=g.get("backgroundOpacity")??i(ft);console.log("🎨 Solid BG:",{bgColor:Wo,bgOpacity:Ua}),Wo&&(Dn.styles.backgroundColor=Wo,Dn.styles.backgroundOpacity=Ua,Dn.styles.backgroundType="solid",delete Dn.styles.backgroundGradient)}else if(i(ze)==="gradient"){const Wo=g.get("backgroundGradient")||i(_o);console.log("🎨 Gradient BG:",Wo),Wo&&Wo.stops&&Wo.stops.length>0?(Dn.styles.backgroundGradient=Wo,Dn.styles.backgroundType="gradient",delete Dn.styles.backgroundColor,delete Dn.styles.backgroundOpacity,console.log("✅ Gradient background saved to $save.styles")):console.warn("⚠️ Invalid gradient data:",Wo)}if(i(Ke)==="solid"){const Wo=g.get("gridColor")||i(nt),Ua=g.get("gridOpacity")??100;console.log("🎨 Solid Grid:",{gridColor:Wo,gridOpacity:Ua}),Wo&&(Dn.styles.grid||(Dn.styles.grid={}),Dn.styles.grid.horizontal||(Dn.styles.grid.horizontal={}),Dn.styles.grid.vertical||(Dn.styles.grid.vertical={}),Dn.styles.grid.horizontal.color=Wo,Dn.styles.grid.vertical.color=Wo,Dn.styles.gridOpacity=Ua,Dn.styles.gridType="solid",delete Dn.styles.gridGradient)}else if(i(Ke)==="gradient"){const Wo=g.get("gridGradient")||i(xs);console.log("🎨 Gradient Grid:",Wo),Wo&&Wo.stops&&Wo.stops.length>0?(Dn.styles.gridGradient=Wo,Dn.styles.gridType="gradient",(hl=(or=Dn.styles.grid)==null?void 0:or.horizontal)==null||delete hl.color,(si=(Oi=Dn.styles.grid)==null?void 0:Oi.vertical)==null||delete si.color,delete Dn.styles.gridOpacity,console.log("✅ Gradient grid saved to $save.styles")):console.warn("⚠️ Invalid grid gradient data:",Wo)}try{const Wo=g.get("xAxisTickTextColor")||qs().xAxisTickTextColor,Ua=g.get("xAxisTickTextOpacity")??100,Hi=dc(Wo,Ua/100);An.set(Dn.styles,"xAxis.tickText.color",Hi),An.set(Dn.styles,"xAxis.tickText.opacity",Ua);const to=g.get("yAxisTickTextColor")||qs().yAxisTickTextColor,Li=g.get("yAxisTickTextOpacity")??100,Vr=dc(to,Li/100);An.set(Dn.styles,"yAxis.tickText.color",Vr),An.set(Dn.styles,"yAxis.tickText.opacity",Li)}catch(Wo){console.warn("Failed to persist axis tick text colors:",Wo)}try{const Wo=Dn.styles.candle.bar;i(Je)&&(Wo.upColor=i(Xe),Wo.downColor=i(Ae)),i(Ct)&&(Wo.upBorderColor=i(Qe),Wo.downBorderColor=i(gt)),i(Ze)&&(Wo.upWickColor=i(Ft),Wo.downWickColor=i(ot))}catch(Wo){console.warn("Failed to persist candle colors to $save.styles:",Wo)}return ni&&Dn.styles.candle&&(Dn.styles.candle.type=ni,console.log("✅ Restored chart type:",ni)),Dn}),u.confirm(),x(d,!0);try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors(),a(!1)}else if($n==="reset"){console.log("🔄 RESET CLICKED - Using theme manager"),u.reset();const Dn=qs();x(ze,"solid"),x(ft,V(Dn.backgroundOpacity)),x(Ke,"solid"),x(ut,V(Dn.gridOpacity)),x(bt,100),x(Pt,100),x(Je,!0),x(Ct,!0),x(Ze,!0),x(Xe,"#26a69a"),x(Ae,"#ef5350"),x(Qe,"#26a69a"),x(gt,"#ef5350"),x(Ft,"#26a69a"),x(ot,"#ef5350");try{const ni=qs();if(c.update(mo=>{mo.styles||(mo.styles={}),mo.styles.backgroundType="solid",mo.styles.backgroundColor=ni.backgroundColor,mo.styles.backgroundOpacity=ni.backgroundOpacity,delete mo.styles.backgroundGradient,mo.styles.grid||(mo.styles.grid={}),mo.styles.grid.horizontal||(mo.styles.grid.horizontal={}),mo.styles.grid.vertical||(mo.styles.grid.vertical={}),mo.styles.gridType="solid",mo.styles.gridOpacity=ni.gridOpacity,mo.styles.grid.horizontal.color=ni.gridColor,mo.styles.grid.vertical.color=ni.gridColor,delete mo.styles.gridGradient;const sr=ni.xAxisTickTextColor,or=ni.yAxisTickTextColor,hl=dc(sr,1),Oi=dc(or,1);An.set(mo.styles,"xAxis.tickText.color",hl),An.set(mo.styles,"xAxis.tickText.opacity",100),An.set(mo.styles,"yAxis.tickText.color",Oi),An.set(mo.styles,"yAxis.tickText.opacity",100),mo.styles.candle||(mo.styles.candle={}),mo.styles.candle.bar||(mo.styles.candle.bar={});const si=mo.styles.candle.bar;return si.upColor=i(Xe),si.downColor=i(Ae),si.upBorderColor=i(Qe),si.downBorderColor=i(gt),si.upWickColor=i(Ft),si.downWickColor=i(ot),mo}),o()){const mo=fp(s().theme),sr=An.merge({},mo,s().styles);(Us=(ws=s().styles)==null?void 0:ws.candle)!=null&&Us.type&&An.set(sr,"candle.type",s().styles.candle.type);const or=qs().xAxisTickTextColor,hl=qs().yAxisTickTextColor,Oi=dc(or,1),si=dc(hl,1);An.set(sr,"xAxis.tickText.color",Oi),An.set(sr,"yAxis.tickText.color",si);const Wo=Xd(sr);o().setStyles(Wo);try{const Ua=document.querySelector(".duty-main"),Hi=document.querySelector(".duty-widget");[Ua,Hi].forEach(to=>{if(to){const Li=to;Li.style.removeProperty("background"),Li.style.removeProperty("background-color"),Li.style.removeProperty("background-image"),Li.style.removeProperty("--chart-background-color")}})}catch{}try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors()}}catch(ni){console.warn("Failed to apply default candle colors on reset:",ni)}Fa(),g.clear(),g.set("backgroundColor",Dn.backgroundColor),g.set("backgroundOpacity",Dn.backgroundOpacity),g.set("gridColor",Dn.gridColor),g.set("gridOpacity",Dn.gridOpacity),g.set("xAxisTickTextColor",Dn.xAxisTickTextColor),g.set("xAxisTickTextOpacity",100),g.set("yAxisTickTextColor",Dn.yAxisTickTextColor),g.set("yAxisTickTextOpacity",100)}else console.log("🚫 CANCEL CLICKED - Using theme manager"),u.cancel(),a(!1);x(w,!1),x(C,!1),x(P,!1),x(I,!1),x(oe,!1),x(Pe,!1),Bc()}var el=cK(),Yl=fn(el);tg(Yl,{title:"Chart Setting",width:"min(90vw, 700px)",get show(){return a()},set show($n){a($n)},get theme(){return s().theme},click:Yr,buttons:["confirm","reset"],children:($n,ws)=>{var Us=lK(),Dn=y(Us),ni=y(Dn),mo=y(ni);mo.__click=[VY,m];var sr=v(mo,2);sr.__click=[WY,m];var or=v(sr,2);or.__click=[HY,m];var hl=v(or,2);Ue(hl,()=>i(ve),Ua=>{var Hi=UY();Hi.__click=[qY,m],Ce(()=>{wr(Hi,"bg-primary",i(m)==="renko"),wr(Hi,"text-primary-content",i(m)==="renko"),wr(Hi,"hover:bg-base-200",i(m)!=="renko")}),q(Ua,Hi)});var Oi=v(hl,2);Ue(Oi,()=>i(hn),Ua=>{var Hi=YY();Hi.__click=[GY,m],Ce(()=>{wr(Hi,"bg-primary",i(m)==="pnf"),wr(Hi,"text-primary-content",i(m)==="pnf"),wr(Hi,"hover:bg-base-200",i(m)!=="pnf")}),q(Ua,Hi)}),_(ni),_(Dn);var si=v(Dn,2),Wo=y(si);Ue(Wo,()=>i(m)==="canvas",Ua=>{var Hi=KY(),to=v(y(Hi),2),Li=v(y(to),2),Vr=y(Li),ba=y(Vr);ba.value=(ba.__value="solid")==null?"":"solid";var qi=v(ba);qi.value=(qi.__value="gradient")==null?"":"gradient",_(Vr);var Wr=v(Vr,2);const Kl=Bt(()=>{var Oa;return`background: ${(i(ze)==="gradient"?((Oa=g.get("backgroundGradient"))==null?void 0:Oa.css)||Rt(i(_o))||"linear-gradient(0deg, #ffffff 0%, #000000 100%)":g.get("backgroundColor")||qs().backgroundColor)??""}`});Wr.__click=[NY,ze,A,w,C,oe,Pe,P,I,Bc],_(Li),_(to);var Wl=v(to,2),Ic=v(y(Wl),2),Pc=y(Ic),cl=y(Pc);cl.value=(cl.__value="solid")==null?"":"solid";var mr=v(cl);mr.value=(mr.__value="gradient")==null?"":"gradient",_(Pc);var La=v(Pc,2);const Sl=Bt(()=>{var Oa;return`background: ${(i(Ke)==="gradient"?((Oa=g.get("gridGradient"))==null?void 0:Oa.css)||Rt(i(xs))||"linear-gradient(0deg, #f3f3f3 0%, #1c1c1c 100%)":g.get("gridColor")||i(nt)||qs().gridColor)??""}`});La.__click=[AY,Ke,M,C,w,oe,Pe,P,I],_(Ic),_(Wl);var Ba=v(Wl,2),vi=v(y(Ba),2),vc=y(vi);const ul=Bt(()=>`background: ${(g.get("xAxisTickTextColor")||qs().xAxisTickTextColor)??""}`);vc.__click=[TY,F,P,w,C,oe,Pe,I,Bc],_(vi),_(Ba);var Ga=v(Ba,2),vl=v(y(Ga),2),pu=y(vl);const tl=Bt(()=>`background: ${(g.get("yAxisTickTextColor")||qs().yAxisTickTextColor)??""}`);pu.__click=[FY,B,I,w,C,oe,Pe,P,Bc],_(vl),_(Ga),_(Hi),Ce(()=>{Ot(Wr,"style",i(Kl)),Ot(La,"style",i(Sl)),Ot(vc,"style",i(ul)),Ot(pu,"style",i(tl))}),xo(Vr,()=>i(ze),Oa=>x(ze,Oa)),xo(Pc,()=>i(Ke),Oa=>x(Ke,Oa)),q(Ua,Hi)},Ua=>{var Hi=Qn(),to=fn(Hi);Ue(to,()=>i(m)==="other",Li=>{var Vr=nK(),ba=v(y(Vr),2);Yo(ba,21,()=>Et,Ii,(qi,Wr)=>{var Kl=tK(),Wl=y(Kl),Ic=y(Wl,!0);_(Wl);var Pc=v(Wl,2);Ue(Pc,()=>i(Wr).type==="select",cl=>{var mr=JY();e_(mr,()=>Mt.get(i(Wr).key)??i(Wr).default);var La;mr.__change=[XY,nd,Wr],Yo(mr,21,()=>i(Wr).options||[],Ii,(Sl,Ba)=>{var vi=ZY(),vc={},ul=y(vi,!0);_(vi),Ce(()=>{vc!==(vc=i(Ba).value)&&(vi.value=(vi.__value=i(Ba).value)==null?"":i(Ba).value),tt(ul,i(Ba).label)}),q(Sl,vi)}),_(mr),Ce(()=>{La!==(La=Mt.get(i(Wr).key)??i(Wr).default)&&(mr.value=(mr.__value=Mt.get(i(Wr).key)??i(Wr).default)==null?"":Mt.get(i(Wr).key)??i(Wr).default,_0(mr,Mt.get(i(Wr).key)??i(Wr).default))}),q(cl,mr)},cl=>{var mr=Qn(),La=fn(mr);Ue(La,()=>i(Wr).type==="switch",Sl=>{var Ba=eK();xn(Ba),Ce(()=>Mv(Ba,Mt.get(i(Wr).key)??i(Wr).default)),Ba.__change=[QY,nd,Wr],q(Sl,Ba)},null,!0),q(cl,mr)}),_(Kl),Ce(()=>tt(Ic,i(Wr).label)),q(qi,Kl)}),_(ba),_(Vr),q(Li,Vr)},Li=>{var Vr=Qn(),ba=fn(Vr);Ue(ba,()=>i(m)==="candle",qi=>{var Wr=sK(),Kl=v(y(Wr),2),Wl=y(Kl),Ic=y(Wl),Pc=y(Ic);xn(Pc),Pc.__change=[BY,Je,Pa],Zi(2),_(Ic);var cl=v(Ic,2),mr=y(cl),La=v(y(mr),2);La.__click=[LY,le,w,C,P,I,oe,Pe,Bc,$],_(mr);var Sl=v(mr,2),Ba=v(y(Sl),2);Ba.__click=[EY,ue,w,C,P,I,oe,Pe,Bc,L],_(Sl),_(cl),_(Wl);var vi=v(Wl,2),vc=y(vi),ul=y(vc);xn(ul),ul.__change=[OY,Ct,Pa],Zi(2),_(vc);var Ga=v(vc,2),vl=y(Ga),pu=v(y(vl),2);pu.__click=[$Y,fe,w,C,P,I,oe,Pe,Bc,O],_(vl);var tl=v(vl,2),Oa=v(y(tl),2);Oa.__click=[DY,pe,w,C,P,I,oe,Pe,Bc,Y],_(tl),_(Ga),_(vi);var Oc=v(vi,2),Gu=y(Oc),El=y(Gu);xn(El),El.__change=[zY,Ze,Pa],Zi(2),_(Gu);var mu=v(Gu,2),bc=y(mu),nl=v(y(bc),2);nl.__click=[RY,Z,w,C,P,I,oe,Pe,Bc,ce],_(bc);var la=v(bc,2),Mu=v(y(la),2);Mu.__click=[jY,xe,w,C,P,I,oe,Pe,Bc,Q],_(la),_(mu),_(Oc),_(Kl),_(Wr),Ce(()=>{Ot(La,"style",`background-color: ${i(Xe)??""}`),La.disabled=!i(Je),wr(La,"opacity-50",!i(Je)),Ot(Ba,"style",`background-color: ${i(Ae)??""}`),Ba.disabled=!i(Je),wr(Ba,"opacity-50",!i(Je)),Ot(pu,"style",`background-color: ${i(Qe)??""}`),pu.disabled=!i(Ct),wr(pu,"opacity-50",!i(Ct)),Ot(Oa,"style",`background-color: ${i(gt)??""}`),Oa.disabled=!i(Ct),wr(Oa,"opacity-50",!i(Ct)),Ot(nl,"style",`background-color: ${i(Ft)??""}`),nl.disabled=!i(Ze),wr(nl,"opacity-50",!i(Ze)),Ot(Mu,"style",`background-color: ${i(ot)??""}`),Mu.disabled=!i(Ze),wr(Mu,"opacity-50",!i(Ze))}),Uv(Pc,()=>i(Je),Yu=>x(Je,Yu)),Uv(ul,()=>i(Ct),Yu=>x(Ct,Yu)),Uv(El,()=>i(Ze),Yu=>x(Ze,Yu)),q(qi,Wr)},qi=>{var Wr=Qn(),Kl=fn(Wr);Ue(Kl,()=>i(m)==="renko",Wl=>{var Ic=oK(),Pc=v(y(Ic),2),cl=y(Pc),mr=y(cl),La=y(mr);xn(La),La.__change=[_Y,Ie,gn],Zi(2),_(mr),_(cl);var Sl=v(cl,2),Ba=y(Sl),vi=v(y(Ba),2);vi.__change=[yY,It,gn];var vc=y(vi);vc.value=(vc.__value="close")==null?"":"close";var ul=v(vc);ul.value=(ul.__value="open")==null?"":"open";var Ga=v(ul);Ga.value=(Ga.__value="high")==null?"":"high";var vl=v(Ga);vl.value=(vl.__value="low")==null?"":"low",_(vi),_(Ba);var pu=v(Ba,2),tl=v(y(pu),2);tl.__change=[bY,Dt,gn];var Oa=y(tl);Oa.value=(Oa.__value="ATR")==null?"":"ATR",_(tl),_(pu);var Oc=v(pu,2),Gu=v(y(Oc),2);xn(Gu),Gu.__input=[xY,Zt,gn],_(Oc),_(Sl),_(Pc),_(Ic),Ce(()=>{Mv(La,i(Ie)),Gf(Gu,i(Zt))}),xo(vi,()=>i(It),El=>x(It,El)),xo(tl,()=>i(Dt),El=>x(Dt,El)),q(Wl,Ic)},Wl=>{var Ic=Qn(),Pc=fn(Ic);Ue(Pc,()=>i(m)==="pnf",cl=>{var mr=aK(),La=v(y(mr),2),Sl=y(La),Ba=y(Sl),vi=v(y(Ba),2);vi.__change=[wY,qn,Yn];var vc=y(vi);vc.value=(vc.__value="ATR")==null?"":"ATR";var ul=v(vc);ul.value=(ul.__value="absolute")==null?"":"absolute";var Ga=v(ul);Ga.value=(Ga.__value="percent")==null?"":"percent",_(vi),_(Ba);var vl=v(Ba,2);Ue(vl,()=>i(qn)==="ATR",_d=>{var Rd=iK(),fc=v(y(Rd),2);xn(fc),fc.__input=[SY,bn,Yn],_(Rd),Ce(()=>Gf(fc,i(bn))),q(_d,Rd)},_d=>{var Rd=rK(),fc=y(Rd),pp=y(fc);_(fc);var kd=v(fc,2);xn(kd),kd.__input=[kY,On,Yn],_(Rd),Ce(()=>{tt(pp,`Box Size ${(i(qn)==="percent"?"(%)":"(Price)")??""}`),Gf(kd,i(On))}),q(_d,Rd)}),_(Sl);var pu=v(Sl,2),tl=v(y(pu),2);xn(tl),tl.__input=[CY,Fn,Yn],_(pu);var Oa=v(pu,2),Oc=v(y(Oa),2),Gu=y(Oc),El=v(y(Gu),2),mu=y(El);xn(mu),mu.__input=[IY,Xs,Yn];var bc=v(mu,2),nl=y(bc,!0);_(bc),_(El),_(Gu);var la=v(Gu,2),Mu=v(y(la),2),Yu=y(Mu);xn(Yu),Yu.__input=[PY,oo,Yn];var zc=v(Yu,2),Zd=y(zc,!0);_(zc),_(Mu),_(la),_(Oc),_(Oa);var Yf=v(Oa,2),Kf=y(Yf);Kf.__click=[MY,qn,On,bn,Fn,Xs,oo,Yn],_(Yf),_(La),_(mr),Ce(()=>{Gf(tl,i(Fn)),tt(nl,i(Xs)),tt(Zd,i(oo))}),xo(vi,()=>i(qn),_d=>x(qn,_d)),Bs(mu,()=>i(Xs),_d=>x(Xs,_d)),Bs(Yu,()=>i(oo),_d=>x(oo,_d)),q(cl,mr)},null,!0),q(Wl,Ic)},!0),q(qi,Wr)},!0),q(Li,Vr)},!0),q(Ua,Hi)}),_(si),_(Us),Ce(()=>{wr(mo,"bg-primary",i(m)==="canvas"),wr(mo,"text-primary-content",i(m)==="canvas"),wr(mo,"hover:bg-base-200",i(m)!=="canvas"),wr(sr,"bg-primary",i(m)==="other"),wr(sr,"text-primary-content",i(m)==="other"),wr(sr,"hover:bg-base-200",i(m)!=="other"),wr(or,"bg-primary",i(m)==="candle"),wr(or,"text-primary-content",i(m)==="candle"),wr(or,"hover:bg-base-200",i(m)!=="candle")}),q($n,Us)},$$slots:{default:!0}});var Vu=v(Yl,2);Ue(Vu,()=>i(w),$n=>{var ws=Bt(()=>g.get("backgroundColor")||qs().backgroundColor);qv($n,{get show(){return i(w)},set show(Us){x(w,V(Us))},get selectedColor(){return i(ws)},get opacity(){return i(ft)},$$events:{colorChange:Eo,opacityChange:Ia}})});var Iu=v(Vu,2);Ue(Iu,()=>i(C),$n=>{var ws=Bt(()=>g.get("gridColor")||i(nt)||qs().gridColor);qv($n,{get show(){return i(C)},set show(Us){x(C,V(Us))},get selectedColor(){return i(ws)},get opacity(){return i(ut)},$$events:{colorChange:Lr,opacityChange:Qa}})});var Ro=v(Iu,2);Ue(Ro,()=>i(P),$n=>{var ws=Bt(()=>g.get("xAxisTickTextColor")||qs().xAxisTickTextColor);qv($n,{get show(){return i(P)},set show(Us){x(P,V(Us))},get selectedColor(){return i(ws)},get opacity(){return i(bt)},$$events:{colorChange:yr,opacityChange:Rc}})});var zr=v(Ro,2);Ue(zr,()=>i(I),$n=>{var ws=Bt(()=>g.get("yAxisTickTextColor")||qs().yAxisTickTextColor);qv($n,{get show(){return i(I)},set show(Us){x(I,V(Us))},get selectedColor(){return i(ws)},get opacity(){return i(Pt)},$$events:{colorChange:Fi,opacityChange:Cu}})});var kl=v(zr,2);Ue(kl,()=>i($),$n=>{qv($n,{get show(){return i($)},set show(ws){x($,V(ws))},get selectedColor(){return i(Xe)},$$events:{colorChange:rd}})});var Md=v(kl,2);Ue(Md,()=>i(L),$n=>{qv($n,{get show(){return i(L)},set show(ws){x(L,V(ws))},get selectedColor(){return i(Ae)},$$events:{colorChange:uf}})});var nf=v(Md,2);Ue(nf,()=>i(O),$n=>{qv($n,{get show(){return i(O)},set show(ws){x(O,V(ws))},get selectedColor(){return i(Qe)},$$events:{colorChange:So}})});var zf=v(nf,2);Ue(zf,()=>i(Y),$n=>{qv($n,{get show(){return i(Y)},set show(ws){x(Y,V(ws))},get selectedColor(){return i(gt)},$$events:{colorChange:Ll}})});var df=v(zf,2);Ue(df,()=>i(ce),$n=>{qv($n,{get show(){return i(ce)},set show(ws){x(ce,V(ws))},get selectedColor(){return i(Ft)},$$events:{colorChange:ya}})});var Pu=v(df,2);Ue(Pu,()=>i(Q),$n=>{qv($n,{get show(){return i(Q)},set show(ws){x(Q,V(ws))},get selectedColor(){return i(ot)},$$events:{colorChange:hc}})});var Dd=v(Pu,2);Ue(Dd,()=>i(oe),$n=>{b5($n,{get show(){return i(oe)},set show(ws){x(oe,V(ws))},get initialGradient(){return i(_o)},$$events:{gradientChange:uc}})});var yf=v(Dd,2);Ue(yf,()=>i(Pe),$n=>{b5($n,{get show(){return i(Pe)},set show(ws){x(Pe,V(ws))},get initialGradient(){return i(xs)},$$events:{gradientChange:Fl}})}),q(n,el),$d()}Ip(["click","change","input"]);var uK=(n,e,t)=>e(i(t).key,n.currentTarget.value),dK=ke("<option> </option>"),fK=ke('<select class="select select-bordered select-sm w-full"></select>'),pK=(n,e,t)=>e(i(t).key,n.currentTarget.checked),mK=ke('<input type="checkbox" class="toggle toggle-sm">'),hK=ke('<span class="text-base-content/70 text-right"> </span> <!>',1),vK=(n,e)=>x(e,!0),gK=ke('<div class="grid grid-cols-[3fr_2fr_3fr_2fr] gap-5 mx-7 my-5 items-center"><!> <div class="col-span-4 mt-4 pt-4 border-t border-base-300"><button class="btn btn-outline btn-primary w-full">Chart Setting</button></div></div>'),_K=ke("<!> <!>",1);function yK(n,e){Ed(e,!0);const t=sm(),s=()=>wl(f,"$chart",t),o=()=>wl(c,"$save",t);let r=hi(e,"show",15);const a=new _y,l=gd("ctx"),c=gd("save"),f=gd("chart");let u=ge(!1);const d=[{key:"candle.priceMark.last.show",text:"last_price_show",component:"switch"},{key:"candle.priceMark.high.show",text:"high_price_show",component:"switch"},{key:"candle.priceMark.low.show",text:"low_price_show",component:"switch"},{key:"indicator.lastValueMark.show",text:"indicator_last_value_show",component:"switch"},{key:"yAxis.reverse",text:"reverse_coordinate",component:"switch"},{key:"grid.show",text:"grid_show",component:"switch"}];function h(M,F){var Y,ce,Q,le,ue,fe,pe,Z,xe,oe,Pe,$e,ze,Ke,qe,nt,ft,ut,bt,Pt,Et,Mt,Je,Ct,Ze,Xe,Ae;const B=(Y=s())==null?void 0:Y.getStyles(),$=An.get(B,M);if(M==="yAxis.reverse")try{(ce=s())==null||ce.setPaneOptions({axis:{reverse:F}}),c.update(Qe=>(An.set(Qe.styles,M,F),Qe)),a.set(M,F);return}catch(Qe){console.warn("setPaneOptions not available, falling back to styles:",Qe)}if($==F)return;a.set(M,F),c.update(Qe=>(An.set(Qe.styles,M,F),Qe));const L=fp(o().theme);console.log("🟡 Settings.update key:",M,"value:",F,"theme:",o().theme),console.log("🎨 theme axis colors:",(ue=(le=(Q=L==null?void 0:L.xAxis)==null?void 0:Q.tickText)==null?void 0:le.style)==null?void 0:ue.color,(Z=(pe=(fe=L==null?void 0:L.yAxis)==null?void 0:fe.tickText)==null?void 0:pe.style)==null?void 0:Z.color),console.log("💾 saved axis colors:",An.get(o().styles,"xAxis.tickText.style.color"),An.get(o().styles,"yAxis.tickText.style.color"));const O=An.merge({},L,o().styles);try{const Qe=(Pe=(oe=(xe=L==null?void 0:L.xAxis)==null?void 0:xe.tickText)==null?void 0:oe.style)==null?void 0:Pe.color,gt=(Ke=(ze=($e=L==null?void 0:L.yAxis)==null?void 0:$e.tickText)==null?void 0:ze.style)==null?void 0:Ke.color;Qe&&((nt=(qe=O==null?void 0:O.xAxis)==null?void 0:qe.tickText)!=null&&nt.style)&&(O.xAxis.tickText.style.color=Qe,(ft=O==null?void 0:O.xAxis)!=null&&ft.tickText&&(delete O.xAxis.tickText.color,delete O.xAxis.tickText.opacity)),gt&&((bt=(ut=O==null?void 0:O.yAxis)==null?void 0:ut.tickText)!=null&&bt.style)&&(O.yAxis.tickText.style.color=gt,(Pt=O==null?void 0:O.yAxis)!=null&&Pt.tickText&&(delete O.yAxis.tickText.color,delete O.yAxis.tickText.opacity))}catch{}console.log("🔄 merged axis colors before apply:",(Je=(Mt=(Et=O==null?void 0:O.xAxis)==null?void 0:Et.tickText)==null?void 0:Mt.style)==null?void 0:Je.color,(Xe=(Ze=(Ct=O==null?void 0:O.yAxis)==null?void 0:Ct.tickText)==null?void 0:Ze.style)==null?void 0:Xe.color),(Ae=s())==null||Ae.setStyles(Xd(O)),setTimeout(()=>{var ot,ve,Ie,It,Dt,Zt,gn,hn,qn,On,bn;const Qe=((ot=s())==null?void 0:ot.getStyles())||{},gt=((It=(Ie=(ve=Qe==null?void 0:Qe.xAxis)==null?void 0:ve.tickText)==null?void 0:Ie.style)==null?void 0:It.color)??((Zt=(Dt=Qe==null?void 0:Qe.xAxis)==null?void 0:Dt.tickText)==null?void 0:Zt.color),Ft=((qn=(hn=(gn=Qe==null?void 0:Qe.yAxis)==null?void 0:gn.tickText)==null?void 0:hn.style)==null?void 0:qn.color)??((bn=(On=Qe==null?void 0:Qe.yAxis)==null?void 0:On.tickText)==null?void 0:bn.color);console.log("✅ chart axis colors after apply:",gt,Ft)},0)}function m(M){var F,B,$,L,O,Y,ce,Q,le,ue,fe,pe,Z,xe,oe,Pe,$e,ze,Ke,qe,nt,ft,ut,bt,Pt,Et,Mt;if(M==="reset"){const Je=(B=(F=o().styles)==null?void 0:F.candle)==null?void 0:B.type,Ct=fp(o().theme),Ze=o().styles;d.forEach(Ae=>{An.unset(Ze,Ae.key)}),c.update(Ae=>(Ae.styles=Ze,Je&&(Ae.styles.candle||(Ae.styles.candle={}),Ae.styles.candle.type=Je),Ae));const Xe=An.merge({},Ct,o().styles);console.log("🟠 Settings.reset theme:",o().theme),console.log("🎨 default axis colors:",(O=(L=($=Ct==null?void 0:Ct.xAxis)==null?void 0:$.tickText)==null?void 0:L.style)==null?void 0:O.color,(Q=(ce=(Y=Ct==null?void 0:Ct.yAxis)==null?void 0:Y.tickText)==null?void 0:ce.style)==null?void 0:Q.color);try{const Ae=(fe=(ue=(le=Ct==null?void 0:Ct.xAxis)==null?void 0:le.tickText)==null?void 0:ue.style)==null?void 0:fe.color,Qe=(xe=(Z=(pe=Ct==null?void 0:Ct.yAxis)==null?void 0:pe.tickText)==null?void 0:Z.style)==null?void 0:xe.color;Ae&&((Pe=(oe=Xe==null?void 0:Xe.xAxis)==null?void 0:oe.tickText)!=null&&Pe.style)&&(Xe.xAxis.tickText.style.color=Ae,($e=Xe==null?void 0:Xe.xAxis)!=null&&$e.tickText&&(delete Xe.xAxis.tickText.color,delete Xe.xAxis.tickText.opacity)),Qe&&((Ke=(ze=Xe==null?void 0:Xe.yAxis)==null?void 0:ze.tickText)!=null&&Ke.style)&&(Xe.yAxis.tickText.style.color=Qe,(qe=Xe==null?void 0:Xe.yAxis)!=null&&qe.tickText&&(delete Xe.yAxis.tickText.color,delete Xe.yAxis.tickText.opacity))}catch{}console.log("🔄 merged axis colors on reset:",(ut=(ft=(nt=Xe==null?void 0:Xe.xAxis)==null?void 0:nt.tickText)==null?void 0:ft.style)==null?void 0:ut.color,(Et=(Pt=(bt=Xe==null?void 0:Xe.yAxis)==null?void 0:bt.tickText)==null?void 0:Pt.style)==null?void 0:Et.color),(Mt=s())==null||Mt.setStyles(Xd(Xe)),setTimeout(()=>{var Ft,ot,ve,Ie,It,Dt,Zt,gn,hn,qn,On;const Ae=((Ft=s())==null?void 0:Ft.getStyles())||{},Qe=((Ie=(ve=(ot=Ae==null?void 0:Ae.xAxis)==null?void 0:ot.tickText)==null?void 0:ve.style)==null?void 0:Ie.color)??((Dt=(It=Ae==null?void 0:Ae.xAxis)==null?void 0:It.tickText)==null?void 0:Dt.color),gt=((hn=(gn=(Zt=Ae==null?void 0:Ae.yAxis)==null?void 0:Zt.tickText)==null?void 0:gn.style)==null?void 0:hn.color)??((On=(qn=Ae==null?void 0:Ae.yAxis)==null?void 0:qn.tickText)==null?void 0:On.color);console.log("✅ chart axis colors after reset apply:",Qe,gt)},0),g()}else r(!1)}function g(){let M=s();if(!M)return;const F=M.getStyles()??{};d.forEach(B=>{const $=An.get(F,B.key);B.key==="yAxis.reverse"?a.set(B.key,$||!1):a.set(B.key,$)})}_p(l,M=>M.initDone).subscribe(g),Fr(()=>{r()&&s()&&g()});var C=_K(),P=fn(C),I=Bt(()=>c4());tg(P,{get title(){return i(I)},width:760,get show(){return r()},set show(M){r(M)},get theme(){return o().theme},click:m,buttons:["confirm","reset"],children:(M,F)=>{var B=gK(),$=y(B);Yo($,17,()=>d,Ii,(Y,ce)=>{var Q=hK(),le=fn(Q),ue=y(le,!0);Ce(()=>{var pe;return tt(ue,(pe=Og[i(ce).text])==null?void 0:pe.call(Og))}),_(le);var fe=v(le,2);Ue(fe,()=>i(ce).component==="select",pe=>{var Z=fK();e_(Z,()=>a.get(i(ce).key));var xe;Z.__change=[uK,h,ce],Yo(Z,21,()=>i(ce).dataSource||[],Ii,(oe,Pe)=>{var $e=dK(),ze={},Ke=y($e,!0);Ce(()=>{var qe;return tt(Ke,((qe=Og[i(Pe).text])==null?void 0:qe.call(Og))||i(Pe).text)}),_($e),Ce(()=>{ze!==(ze=i(Pe).key)&&($e.value=($e.__value=i(Pe).key)==null?"":i(Pe).key)}),q(oe,$e)}),_(Z),Ce(()=>{xe!==(xe=a.get(i(ce).key))&&(Z.value=(Z.__value=a.get(i(ce).key))==null?"":a.get(i(ce).key),_0(Z,a.get(i(ce).key)))}),q(pe,Z)},pe=>{var Z=Qn(),xe=fn(Z);Ue(xe,()=>i(ce).component==="switch",oe=>{var Pe=mK();xn(Pe),Ce(()=>Mv(Pe,!!a.get(i(ce).key))),Pe.__change=[pK,h,ce],q(oe,Pe)},null,!0),q(pe,Z)}),q(Y,Q)});var L=v($,2),O=y(L);O.__click=[vK,u],_(L),_(B),q(M,B)},$$slots:{default:!0}});var A=v(P,2);z8(A,{get show(){return i(u)},set show(M){x(u,V(M))}}),q(n,C),$d()}Ip(["change","click"]);var bK=ke('<img alt="screenshot" class="w-[500px] mt-5">');function xK(n,e){Ed(e,!0);const t=sm(),s=()=>wl(r,"$save",t);let o=hi(e,"show",15);const r=gd("save");function a(l){if(l==="confirm"){const c=document.createElement("a");c.download="screenshot",c.href=e.url,document.body.appendChild(c),c.click(),c.remove()}o(!1)}tg(n,{title:"Screenshot",width:540,get show(){return o()},set show(l){o(l)},get theme(){return s().theme},click:a,children:(l,c)=>{var f=bK();Ce(()=>Ot(f,"src",e.url)),q(l,f)},$$slots:{default:!0}}),$d()}var wK=ke("<option> </option>"),kK=ke('<div class="flex justify-center items-center min-h-[70px]"><select class="select select-bordered w-[70%]"></select></div>');function SK(n,e){Ed(e,!0);const t=sm(),s=()=>wl(r,"$save",t);let o=hi(e,"show",15);const r=gd("save"),a=gP();function l(u){const h=u.target.value;r.update(m=>(m.timezone=h,m))}function c(u){o(!1)}var f=Bt(()=>i4());tg(n,{get title(){return i(f)},width:400,get show(){return o()},set show(u){o(u)},get theme(){return s().theme},click:c,children:(u,d)=>{var h=kK(),m=y(h);e_(m,()=>s().timezone);var g;m.__change=l,Yo(m,21,()=>a,Ii,(w,C)=>{var P=wK(),I={},A=y(P,!0);Ce(()=>tt(A,Og[i(C).text]())),_(P),Ce(()=>{I!==(I=i(C).key)&&(P.value=(P.__value=i(C).key)==null?"":i(C).key)}),q(w,P)}),_(m),_(h),Ce(()=>{g!==(g=s().timezone)&&(m.value=(m.__value=s().timezone)==null?"":s().timezone,_0(m,s().timezone))}),q(u,h)},$$slots:{default:!0}}),$d()}Ip(["change"]);var CK=ke('<div class="warning-banner"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01M10.29 3.86l-7.6 13.17A1 1 0 003.53 19h16.94a1 1 0 00.84-1.5L13.71 3.86a1 1 0 00-1.73 0z"></path></svg> <span> </span></div>'),IK=(n,e,t)=>e(i(t),n),PK=ke('<div class="selection-badge"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M13.3 4.3L6 11.6 2.7 8.3l1.1-1.1L6 9.4l6.2-6.2 1.1 1.1z" fill="currentColor" stroke="currentColor" stroke-width="0.5"></path></svg></div>'),MK=ke('<button class="chart-card"><div class="card-bg"></div> <!> <div class="icon-container"><div class="icon-glow"></div> <!></div> <span class="chart-name"> </span> <div class="shine-effect"></div></button>'),NK=ke(`<!> <div class="premium-grid"></div> <style>/* ===== PREMIUM GRID LAYOUT ===== */
    .premium-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
      padding: 8px;
    }
    
    @media (max-width: 640px) {
      .premium-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        padding: 6px;
      }
    }
    
    @media (max-width: 480px) {
      .premium-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        padding: 8px;
      }
    }
    
    /* ===== PREMIUM CHART CARD ===== */
    .chart-card {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 20px 12px 18px;
      background: linear-gradient(145deg, 
        rgba(30, 35, 48, 0.6) 0%, 
        rgba(20, 25, 35, 0.4) 100%);
      border: 1.5px solid rgba(255, 255, 255, 0.06);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 
        0 4px 20px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    @media (max-width: 640px) {
      .chart-card {
        padding: 16px 10px 14px;
        gap: 8px;
      }
    }
    
    @media (max-width: 480px) {
      .chart-card {
        padding: 22px 14px 20px;
        gap: 12px;
      }
    }
    
    /* Animated background */
    .card-bg {
      position: absolute;
      inset: 0;
      background: linear-gradient(145deg,
        rgba(45, 55, 75, 0.3) 0%,
        rgba(30, 40, 60, 0.2) 50%,
        rgba(20, 30, 50, 0.3) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }
    
    /* Hover state */
    .chart-card:hover {
      transform: translateY(-3px);
      border-color: rgba(255, 255, 255, 0.12);
      background: linear-gradient(145deg, 
        rgba(35, 45, 60, 0.7) 0%, 
        rgba(25, 35, 50, 0.5) 100%);
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.4),
        0 6px 20px rgba(20, 30, 50, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }
    
    .chart-card:hover .card-bg {
      opacity: 1;
    }
    
    /* Active state */
    .chart-card.active {
      background: linear-gradient(145deg, 
        rgba(30, 50, 80, 0.5) 0%,
        rgba(20, 40, 70, 0.4) 50%,
        rgba(25, 45, 75, 0.5) 100%);
      border-color: rgba(70, 120, 180, 0.4);
      box-shadow: 
        0 8px 32px rgba(30, 60, 100, 0.3),
        0 4px 16px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(60, 100, 150, 0.2);
      transform: translateY(-2px);
    }
    
    .chart-card.active .card-bg {
      background: linear-gradient(145deg,
        rgba(40, 65, 95, 0.4) 0%,
        rgba(30, 55, 85, 0.3) 50%,
        rgba(35, 60, 90, 0.4) 100%);
      opacity: 1;
    }
    
    .chart-card.active:hover {
      transform: translateY(-2px);
      border-color: rgba(80, 130, 190, 0.5);
    }
    
    /* ===== SELECTION BADGE ===== */
    .selection-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, 
        rgba(70, 120, 180, 0.9) 0%, 
        rgba(50, 100, 160, 0.85) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      z-index: 10;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 
        0 3px 10px rgba(30, 60, 100, 0.4),
        0 1px 3px rgba(0, 0, 0, 0.3);
      animation: badgePulse 2.5s ease-in-out infinite;
    }
    
    @keyframes badgePulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 
          0 3px 10px rgba(30, 60, 100, 0.4),
          0 1px 3px rgba(0, 0, 0, 0.3);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 
          0 4px 14px rgba(40, 70, 110, 0.5),
          0 2px 5px rgba(0, 0, 0, 0.35);
      }
    }
    
    /* ===== ICON CONTAINER ===== */
    .icon-container {
      position: relative;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: linear-gradient(145deg, 
        rgba(40, 50, 65, 0.5) 0%, 
        rgba(25, 35, 50, 0.3) 100%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 3px 12px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.06);
      z-index: 1;
    }
    
    @media (max-width: 640px) {
      .icon-container {
        width: 42px;
        height: 42px;
        border-radius: 10px;
      }
    }
    
    @media (max-width: 480px) {
      .icon-container {
        width: 50px;
        height: 50px;
        border-radius: 12px;
      }

    }
    
    .icon-glow {
      position: absolute;
      inset: -3px;
      background: linear-gradient(145deg, 
        rgba(50, 90, 140, 0.3) 0%, 
        rgba(35, 70, 120, 0.25) 100%);
      border-radius: inherit;
      opacity: 0;
      filter: blur(10px);
      transition: opacity 0.3s ease;
      z-index: -1;
    }
    
    .chart-card:hover .icon-container {
      transform: scale(1.06);
      background: linear-gradient(145deg, 
        rgba(50, 65, 85, 0.6) 0%, 
        rgba(35, 50, 70, 0.4) 100%);
      box-shadow: 
        0 5px 18px rgba(0, 0, 0, 0.25),
        0 2px 10px rgba(30, 50, 80, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    .chart-card.active .icon-container {
      background: linear-gradient(145deg, 
        rgba(40, 70, 110, 0.5) 0%, 
        rgba(30, 60, 95, 0.4) 100%);
      border-color: rgba(70, 110, 160, 0.3);
      transform: scale(1.04);
      box-shadow: 
        0 6px 20px rgba(30, 60, 100, 0.3),
        0 3px 12px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.12);
    }
    
    .chart-card.active .icon-glow {
      opacity: 0.5;
    }
    
    /* ===== CHART ICON ===== */
    :global(.chart-icon) {
      color: rgba(200, 210, 230, 0.85);
      filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.3));
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 2;
    }
    
    .chart-card:hover :global(.chart-icon) {
      color: rgba(220, 230, 245, 0.95);
      filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.35));
      transform: scale(1.05);
    }
    
    .chart-card.active :global(.chart-icon) {
      color: rgba(160, 200, 240, 1);
      filter: drop-shadow(0 4px 12px rgba(40, 80, 130, 0.5));
      transform: scale(1.03);
    }
    
    /* ===== CHART NAME ===== */
    .chart-name {
      color: rgba(180, 190, 210, 0.85);
      font-size: 12px;
      font-weight: 500;
      text-align: center;
      line-height: 1.3;
      letter-spacing: 0.4px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }
    
    @media (max-width: 640px) {
      .chart-name {
        font-size: 11px;
      }
    }
    
    @media (max-width: 480px) {
      .chart-name {
        font-size: 12.5px;
      }
    }
    
    .chart-card:hover .chart-name {
      color: rgba(210, 220, 235, 0.95);
      transform: translateY(-1px);
    }
    
    .chart-card.active .chart-name {
      color: rgba(180, 210, 240, 1);
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    /* ===== SHINE EFFECT ===== */
    .shine-effect {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        115deg,
        transparent 25%,
        rgba(255, 255, 255, 0.08) 45%,
        rgba(200, 220, 240, 0.12) 50%,
        rgba(255, 255, 255, 0.08) 55%,
        transparent 75%
      );
      transform: translateX(-100%) skewX(-15deg);
      transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .chart-card:hover .shine-effect {
      transform: translateX(100%) skewX(-15deg);
    }
    
    /* ===== LIGHT THEME ===== */
    :global([data-theme="light"]) .chart-card {
      background: linear-gradient(145deg, #ffffff 0%, #f9fbff 100%);
      border-color: rgba(59, 130, 246, 0.15);
      box-shadow: 
        0 2px 6px rgba(59, 130, 246, 0.08),
        0 1px 2px rgba(0, 0, 0, 0.04);
    }
    
    :global([data-theme="light"]) .card-bg {
      background: transparent;
      opacity: 0;
    }
    
    :global([data-theme="light"]) .chart-card:hover {
      background: #ffffff;
      border-color: rgba(59, 130, 246, 0.25);
      box-shadow: 
        0 6px 14px rgba(59, 130, 246, 0.10),
        0 3px 8px rgba(0, 0, 0, 0.05);
    }
    
    :global([data-theme="light"]) .chart-card.active {
      background: linear-gradient(145deg, #e8f4ff 0%, #f0f8ff 100%);
      border-color: rgba(100, 150, 220, 0.4);
      box-shadow: 
        0 3px 10px rgba(100, 150, 220, 0.15),
        0 1px 4px rgba(0, 0, 0, 0.05);
    }
    
    :global([data-theme="light"]) .chart-card.active .card-bg {
      opacity: 0;
    }
    
    :global([data-theme="light"]) .icon-container {
      background: #f3f6fb;
      border-color: rgba(59, 130, 246, 0.15);
      box-shadow: 
        0 1px 3px rgba(0, 0, 0, 0.04),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .chart-card:hover .icon-container {
      background: #f0f2f5;
      box-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.05),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .chart-card.active .icon-container {
      background: linear-gradient(145deg, #dceeff 0%, #e6f3ff 100%);
      border-color: rgba(100, 150, 220, 0.2);
      box-shadow: 
        0 2px 8px rgba(100, 150, 220, 0.12),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .icon-glow {
      opacity: 0;
    }
    
    :global([data-theme="light"]) :global(.chart-icon) {
      color: #3b82f6;
      filter: drop-shadow(0 0.5px 1px rgba(59, 130, 246, 0.15));
    }
    
    :global([data-theme="light"]) .chart-card:hover :global(.chart-icon) {
      color: #2563eb;
      filter: drop-shadow(0 1px 2px rgba(37, 99, 235, 0.2));
    }
    
    :global([data-theme="light"]) .chart-card.active :global(.chart-icon) {
      color: #1d4ed8;
      filter: drop-shadow(0 1px 3px rgba(29, 78, 216, 0.3));
    }
    
    :global([data-theme="light"]) .chart-name {
      color: #334155;
    }
    
    :global([data-theme="light"]) .chart-card:hover .chart-name {
      color: #1f2937;
    }
    
    :global([data-theme="light"]) .chart-card.active .chart-name {
      color: #2563eb;
      font-weight: 600;
    }
    
    :global([data-theme="light"]) .selection-badge {
      background: linear-gradient(135deg, #5ba3f5 0%, #4a90e2 100%);
      border-color: rgba(255, 255, 255, 0.8);
      box-shadow: 
        0 2px 8px rgba(74, 144, 226, 0.3),
        0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    /* ===== WARNING BANNER ===== */
    .warning-banner {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 18px;
      margin-bottom: 16px;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(239, 68, 68, 0.1) 100%);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 12px;
      color: rgba(251, 191, 36, 0.95);
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
    }
    
    .warning-banner svg {
      flex-shrink: 0;
      color: rgba(251, 191, 36, 1);
      filter: drop-shadow(0 2px 4px rgba(245, 158, 11, 0.3));
    }
    
    :global([data-theme="light"]) .warning-banner {
      background: linear-gradient(135deg, rgba(254, 243, 199, 0.9) 0%, rgba(254, 226, 226, 0.8) 100%);
      border-color: rgba(217, 119, 6, 0.3);
      color: rgba(146, 64, 14, 0.95);
      box-shadow: 0 2px 8px rgba(217, 119, 6, 0.15);
    }
    
    :global([data-theme="light"]) .warning-banner svg {
      color: rgba(217, 119, 6, 1);
      filter: drop-shadow(0 1px 2px rgba(217, 119, 6, 0.2));
    }
    
    /* ===== DISABLED STATE ===== */
    .chart-card.disabled {
      opacity: 0.35;
      cursor: not-allowed;
      pointer-events: auto;
    }
    
    .chart-card.disabled:hover {
      transform: none;
      opacity: 0.35;
      border-color: rgba(255, 255, 255, 0.06);
      background: linear-gradient(145deg, 
        rgba(30, 35, 48, 0.6) 0%, 
        rgba(20, 25, 35, 0.4) 100%);
      box-shadow: 
        0 4px 20px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    .chart-card.disabled .card-bg {
      opacity: 0;
    }
    
    .chart-card.disabled .icon-container {
      transform: none;
    }
    
    .chart-card.disabled .shine-effect {
      display: none;
    }
    
    :global([data-theme="light"]) .chart-card.disabled {
      opacity: 0.4;
    }
    
    :global([data-theme="light"]) .chart-card.disabled:hover {
      opacity: 0.4;
    }</style>`,1);function AK(n,e){Ed(e,!0);const t=sm(),s=()=>wl(a,"$save",t),o=()=>wl(l,"$chart",t);let r=hi(e,"show",15);gd("ctx");const a=gd("save"),l=gd("chart"),c=[{id:"candle_solid",name:"Candlestick",icon:"candle_solid"},{id:"candle_stroke",name:"Hollow",icon:"candle_stroke"},{id:"candle_up_stroke",name:"Up Hollow",icon:"candle_up_stroke"},{id:"candle_down_stroke",name:"Down Hollow",icon:"candle_down_stroke"},{id:"heikin_ashi",name:"Heikin Ashi",icon:"candle_solid"},{id:"renko_atr",name:"Duty AI Renko",icon:"candle_solid"},{id:"point_and_figure",name:"Point & Figure",icon:"point_and_figure"},{id:"ohlc",name:"OHLC",icon:"ohlc"},{id:"area",name:"Area",icon:"area"},{id:"line_chart",name:"Line",icon:"line"}],f=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"];function u(){return!s()||!s().saveInds?!1:Object.values(s().saveInds).some(w=>w&&f.includes(w.name))}let d=ge(!1),h=ge("");Fr(()=>{if(i(d)){const w=setTimeout(()=>{x(d,!1)},5e3);return()=>clearTimeout(w)}});function m(w,C){var M,F,B,$,L;const P=w;if(P.id==="renko_atr"&&u()){x(h,"You cannot use Duty AI Renko chart with AI Indicator"),x(d,!0),console.log("⚠️ Cannot add Renko chart: AI indicators present");return}if(P.id==="point_and_figure"&&u()){x(h,"You cannot use Point & Figure chart with AI Indicator"),x(d,!0),console.log("⚠️ Cannot add P&F chart: AI indicators present");return}if(console.log("📊 CHART TYPE CLICK:",P.id),C){const O=C.currentTarget;O.classList.add("selecting"),setTimeout(()=>{O.classList.remove("selecting")},800)}if(s().styles.candle||Dc(a,qo(s).styles.candle={},qo(s)),P.id==="line_chart"){console.log("🎯 Setting up LINE CHART (using area with transparent background)"),Dc(a,qo(s).styles.candle.type="area",qo(s));const O=((F=(M=s().styles.candle)==null?void 0:M.bar)==null?void 0:F.upColor)||"#2196F3";Dc(a,qo(s).styles.candle.area={lineSize:2,lineColor:O,lineSmooth:!1,value:"close",backgroundColor:[{offset:0,color:"rgba(0, 0, 0, 0)"},{offset:1,color:"rgba(0, 0, 0, 0)"}]},qo(s)),Dc(a,qo(s).styles.candle._isLineChart=!0,qo(s)),console.log("✅ Line chart configured with area type and transparent background")}else if(P.id==="area"){console.log("🎯 Setting up AREA CHART with gradient fill"),Dc(a,qo(s).styles.candle.type="area",qo(s)),delete s().styles.candle._isLineChart;const O=(($=(B=s().styles.candle)==null?void 0:B.bar)==null?void 0:$.upColor)||"#2196F3";Dc(a,qo(s).styles.candle.area={lineSize:2,lineColor:O,lineSmooth:!1,value:"close",backgroundColor:[{offset:0,color:O+"60"},{offset:1,color:O+"10"}]},qo(s)),console.log("✅ Area chart configured with gradient background")}else P.id==="renko_atr"?(console.log("🎯 Setting up RENKO (ATR) chart"),Dc(a,qo(s).styles.candle.type="renko_atr",qo(s)),s().styles.candle.renko||Dc(a,qo(s).styles.candle.renko={method:"ATR",atrLength:14,source:"close",wick:!1},qo(s)),delete s().styles.candle._isLineChart,delete s().styles.candle.area):P.id==="point_and_figure"?(console.log("🎯 Setting up POINT & FIGURE chart"),Dc(a,qo(s).styles.candle.type="point_and_figure",qo(s)),s().styles.candle.pnf||Dc(a,qo(s).styles.candle.pnf={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"},qo(s)),delete s().styles.candle._isLineChart,delete s().styles.candle.area):(Dc(a,qo(s).styles.candle.type=P.id,qo(s)),delete s().styles.candle._isLineChart,delete s().styles.candle.area);console.log("✅ Saved chart type to $save.styles:",{type:s().styles.candle.type,isLineChart:s().styles.candle._isLineChart,area:s().styles.candle.area});const I=fp(s().theme);An.merge(I,s().styles);const A=Xd(I);(L=o())==null||L.setStyles(A),console.log("✅ Styles applied to chart with processing"),r(!1)}function g(){var C,P,I,A;return(P=(C=s().styles)==null?void 0:C.candle)!=null&&P._isLineChart?"line_chart":((A=(I=s().styles)==null?void 0:I.candle)==null?void 0:A.type)||"candle_solid"}tg(n,{get show(){return r()},set show(w){r(w)},title:"Chart Type",width:"550px",maxWidth:"95vw",maxHeight:"90vh",buttons:[],get theme(){return s().theme},class:"chart-type-modal-premium",children:(w,C)=>{var P=NK(),I=fn(P);Ue(I,()=>i(d),M=>{var F=CK(),B=v(y(F),2),$=y(B,!0);_(B),_(F),Ce(()=>tt($,i(h))),wg(3,F,()=>gy,()=>({y:-20,duration:300})),q(M,F)});var A=v(I,2);Yo(A,21,()=>c,M=>M.id,(M,F)=>{var B=MK();const $=Bt(()=>(i(F).id==="renko_atr"||i(F).id==="point_and_figure")&&u());B.__click=[IK,m,F];const L=Bt(()=>g()===i(F).id);Ce(()=>wr(B,"active",i(L)));var O=v(y(B),2);Ue(O,()=>g()===i(F).id&&!i($),ue=>{var fe=PK();q(ue,fe)});var Y=v(O,2),ce=v(y(Y),2);Gv(ce,{get name(){return i(F).icon},size:26,class:"chart-icon"}),_(Y);var Q=v(Y,2),le=y(Q,!0);_(Q),Zi(2),_(B),Ce(()=>{wr(B,"disabled",i($)),tt(le,i(F).name)}),q(M,B)}),_(A),Zi(2),q(w,P)},$$slots:{default:!0}}),$d()}Ip(["click"]);function w5(n,e){e(!1)}var TK=(n,e,t,s,o)=>!i(e)&&!i(t)&&s(i(o).is_main,i(o).name),FK=ke('<div class="particle svelte-uswuii"></div>'),LK=ke('<div class="stream-line svelte-uswuii"></div>'),EK=ke('<div class="segment svelte-uswuii"></div>'),$K=ke('<div class="ai-loading-overlay svelte-uswuii"><div class="particles-container svelte-uswuii"></div> <div class="data-stream svelte-uswuii"></div> <div class="loading-content svelte-uswuii"><div class="ai-loader-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg> <div class="ai-pulse-ring ring-1 svelte-uswuii"></div> <div class="ai-pulse-ring ring-2 svelte-uswuii"></div> <div class="ai-pulse-ring ring-3 svelte-uswuii"></div> <div class="ai-glow svelte-uswuii"></div></div> <div class="loading-text-container svelte-uswuii"><div class="loading-text-main svelte-uswuii"> </div> <div class="loading-text-sub svelte-uswuii"> </div></div> <div class="progress-container svelte-uswuii"><div class="progress-bar svelte-uswuii"><div class="progress-glow svelte-uswuii"></div></div> <div class="progress-segments svelte-uswuii"></div></div> <div class="progress-info svelte-uswuii"><div class="progress-percentage svelte-uswuii"> </div> <div class="progress-status svelte-uswuii"> </div></div></div></div>'),DK=(n,e,t,s)=>{n.stopPropagation(),e(i(t),i(s).name)},RK=(n,e,t,s)=>{n.stopPropagation(),e(i(t),i(s).name)},jK=ke('<div class="indicator-actions svelte-uswuii"><button class="action-btn edit-btn svelte-uswuii" title="Edit Parameters"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" class="svelte-uswuii"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" class="svelte-uswuii"></path></svg></button> <button class="action-btn delete-btn svelte-uswuii" title="Remove Indicator"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="3 6 5 6 21 6" class="svelte-uswuii"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" class="svelte-uswuii"></path><line x1="10" y1="11" x2="10" y2="17" class="svelte-uswuii"></line><line x1="14" y1="11" x2="14" y2="17" class="svelte-uswuii"></line></svg></button></div>'),BK=ke('<div class="add-indicator-hint svelte-uswuii"><span class="svelte-uswuii">Click to add</span></div>'),OK=ke('<div class="indicator-icon svelte-uswuii"> </div> <div class="indicator-info svelte-uswuii"><span class="indicator-name svelte-uswuii"> </span></div> <!>',1),zK=ke("<div><!></div>"),VK=n=>n.stopPropagation(),WK=ke('<div class="ai-modal-backdrop svelte-uswuii" role="presentation"></div> <div class="ai-modal-container svelte-uswuii" role="dialog" aria-modal="true" aria-labelledby="ai-modal-title"><div class="ai-background svelte-uswuii"><div class="orb orb-1 svelte-uswuii"></div> <div class="orb orb-2 svelte-uswuii"></div> <div class="orb orb-3 svelte-uswuii"></div></div> <div class="ai-content svelte-uswuii"><div class="ai-header svelte-uswuii"><div class="ai-header-left svelte-uswuii"><div class="ai-icon-small svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg></div> <div class="ai-header-text svelte-uswuii"><h2 id="ai-modal-title" class="ai-title svelte-uswuii">AI Indicators</h2> <p class="ai-subtitle svelte-uswuii">Duty AI Advanced Algorithm - Exclusive for Pro Traders</p></div></div> <button class="close-btn svelte-uswuii" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="18" y1="6" x2="6" y2="18" class="svelte-uswuii"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-uswuii"></line></svg></button></div> <div class="indicators-list svelte-uswuii"><!> <div class="indicator-row coming-soon-item disabled svelte-uswuii"><div class="coming-soon-glitter-bg svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-1 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-2 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-3 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-4 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-5 svelte-uswuii"></div> <div class="coming-soon-shine-sweep svelte-uswuii"></div> <div class="indicator-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg></div> <div class="indicator-info svelte-uswuii"><span class="indicator-name svelte-uswuii">AI Trade Entry Finder and more AI algorithms</span> <span class="coming-soon-badge svelte-uswuii">Coming Soon</span></div></div></div> <div class="ai-powered-footer svelte-uswuii"><span class="powered-by-text svelte-uswuii">Powered by Duty AI</span></div></div></div>',1),HK=(n,e)=>x(e,!1),qK=(n,e)=>x(e,!1),UK=ke('<div class="premium-modal-backdrop svelte-uswuii" role="presentation"></div> <div class="premium-modal-container svelte-uswuii" role="dialog" aria-modal="true" aria-labelledby="premium-modal-title"><div class="premium-background svelte-uswuii"><div class="premium-orb premium-orb-1 svelte-uswuii"></div> <div class="premium-orb premium-orb-2 svelte-uswuii"></div></div> <div class="premium-content svelte-uswuii"><button class="premium-close-btn svelte-uswuii" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="18" y1="6" x2="6" y2="18" class="svelte-uswuii"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-uswuii"></line></svg></button> <div class="premium-icon-wrapper svelte-uswuii"><div class="premium-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-uswuii"></path><path d="M2 17l10 5 10-5" class="svelte-uswuii"></path><path d="M2 12l10 5 10-5" class="svelte-uswuii"></path></svg> <div class="premium-icon-glow svelte-uswuii"></div></div></div> <h2 id="premium-modal-title" class="premium-title svelte-uswuii">Premium Feature</h2> <p class="premium-message svelte-uswuii">AI Indicators are exclusive premium features. Upgrade to Premium to unlock all advanced AI algorithms and take your trading to the next level.</p> <div class="premium-features svelte-uswuii"><div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Smart Money Footprint</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Trap Hunter (Bull/Bear Traps)</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Volcanic Move & Eruptions</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">More AI algorithms coming soon</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-uswuii"><span class="svelte-uswuii">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="5" y1="12" x2="19" y2="12" class="svelte-uswuii"></line><polyline points="12 5 19 12 12 19" class="svelte-uswuii"></polyline></svg></a></div></div>',1),GK=ke("<!> <!>",1);function YK(n,e){Ed(e,!0);const t=sm(),s=()=>wl(u,"$chart",t),o=()=>wl(f,"$save",t),r=()=>wl(c,"$ctx",t),a=()=>wl(O0,"$userPreferences",t);let l=hi(e,"show",15);const c=gd("ctx"),f=gd("save"),u=gd("chart"),d=[{name:"SMART_MONEY",title:"Smart Money Footprint",is_main:!0,icon:"💰"},{name:"TRAP_HUNTER",title:"Trap Hunter (Bull/Bear Traps)",is_main:!0,icon:"🎯"},{name:"VOLCANIC",title:"Volcanic Move (Pressure) (Sub Pane)",is_main:!1,icon:"🌋"},{name:"VOLCANIC_SIG",title:"Volcanic Eruptions (Markers) (Main Pane)",is_main:!0,icon:"💥"}],h={SMART_MONEY:[{text:"💰 Tracking institutional money flow",duration:1200,subtext:"Analyzing whale movements..."},{text:"🏦 Detecting smart money footprints",duration:1400,subtext:"Scanning OBV patterns..."},{text:"📊 Mapping accumulation zones",duration:1300,subtext:"Identifying support levels..."},{text:"🎯 Calculating volume clusters",duration:1200,subtext:"Processing 50,000+ trades..."},{text:"✨ Activating smart money radar",duration:1100,subtext:"Deploying footprint tracker..."}],TRAP_HUNTER:[{text:"🎯 Scanning for bull/bear traps",duration:1200,subtext:"Analyzing false breakouts..."},{text:"🔍 Detecting fake-out patterns",duration:1400,subtext:"Identifying trap signatures..."},{text:"⚡ Processing trap probability",duration:1300,subtext:"Calculating 20+ parameters..."},{text:"🚨 Mapping high-risk zones",duration:1200,subtext:"Locating potential traps..."},{text:"✨ Deploying trap detection AI",duration:1100,subtext:"Activating alert system..."}],VOLCANIC:[{text:"🌋 Measuring market pressure",duration:1200,subtext:"Analyzing momentum buildup..."},{text:"📈 Detecting volcanic activity",duration:1400,subtext:"Scanning RSI extremes..."},{text:"🔥 Calculating eruption zones",duration:1300,subtext:"Processing pressure levels..."},{text:"⚡ Tracking explosive setups",duration:1200,subtext:"Identifying breakout points..."},{text:"✨ Activating volcanic pressure",duration:1100,subtext:"Deploying oscillator..."}],VOLCANIC_SIG:[{text:"💥 Detecting eruption signals",duration:1200,subtext:"Scanning breakout candles..."},{text:"🚀 Analyzing explosive moves",duration:1400,subtext:"Tracking volume spikes..."},{text:"🎯 Mapping eruption markers",duration:1300,subtext:"Calculating signal strength..."},{text:"⚡ Processing 15,000+ patterns",duration:1200,subtext:"Identifying eruption points..."},{text:"✨ Deploying eruption markers",duration:1100,subtext:"Activating signal alerts..."}]};let m=ge(V(new Set));Fr(()=>{var xe;if(!l()||!s())return;const pe=s();let Z=new Set;try{const oe=((xe=pe.getIndicators)==null?void 0:xe.call(pe))??[];Z=new Set(oe.map(Pe=>Pe.name)),console.log("🧠 AI Modal (open) - from chart.getIndicators:",oe)}catch(oe){console.warn("⚠️ AI Modal - getIndicators failed, falling back to saveInds",oe);const Pe=new Set;o()&&o().saveInds&&Object.values(o().saveInds).forEach($e=>{$e&&$e.name&&Pe.add($e.name)}),Z=Pe}console.log("🔄 AI Modal (open) - selectedIndicators updated:",Array.from(Z)),console.log("🔍 AI Modal (open) - saveInds keys:",Object.keys(o().saveInds||{})),x(m,V(Z))});let g=ge(!1),w=ge(null),C=ge(0),P=ge(0),I=ge(V([])),A=ge(!1);Fr(()=>{!r().modalIndCfg&&i(g)&&(x(g,!1),setTimeout(()=>{l(!0)},100))}),Fr(()=>{l()&&(console.log("🎯 AI Modal opened"),console.log("📊 Current saveInds:",o().saveInds),console.log("✅ AI indicators in chart:",Array.from(i(m))))});function M(){var Z,xe,oe;if(((xe=(Z=o().styles)==null?void 0:Z.candle)==null?void 0:xe.type)==="renko_atr"){console.log("🔄 Converting Renko chart to Candlestick for AI indicator compatibility"),Dc(f,qo(o).styles.candle.type="candle_solid",qo(o)),delete o().styles.candle.renko,delete o().styles.candle._isLineChart,delete o().styles.candle.area;const Pe=fp(o().theme);An.merge(Pe,o().styles);const $e=Xd(Pe);return(oe=s())==null||oe.setStyles($e),console.log("✅ Chart converted from Renko to Candlestick"),!0}return!1}async function F(pe){x(w,V(pe)),x(C,0),x(P,0),x(I,V(h[pe]||h.SMART_MONEY));for(let Z=0;Z<i(I).length;(Z+=1)-1){x(C,V(Z));const xe=i(I)[Z],oe=Z/i(I).length*100,Pe=(Z+1)/i(I).length*100,$e=20,ze=xe.duration/$e;for(let Ke=0;Ke<=$e;(Ke+=1)-1)x(P,oe+(Pe-oe)*(Ke/$e)),await new Promise(qe=>setTimeout(qe,ze))}x(w,null),x(C,0),x(P,0),x(I,V([]))}function B(){var Z;const pe=(Z=a())==null?void 0:Z.data;return pe?pe.isPremium===!0||pe.isTrial===!0:!1}async function $(pe,Z){if(!B()){console.log("🔒 Premium access required for AI indicators"),x(A,!0);return}await F(Z),M();let xe=!1;if(Z==="SMART_MONEY"){const oe="candle_pane",Pe=s();if(Pe&&Pe.createIndicator({name:"SMART_MONEY",calcParams:[40,5,25,14,20,1.2,.03,20,.2,.6,1,20,1]},!0,{id:oe})){const ze={name:"SMART_MONEY",pane_id:oe,params:[40,5,25,14,20,1.2,.03,20,.2,.6,1,20,1]},Ke=`${oe}_SMART_MONEY`;f.update(qe=>(qe.saveInds[Ke]=ze,qe)),iv(),Fp.recordAddIndicator(Z,oe,ze.params,Ke),xe=!0}}else if(Z==="TRAP_HUNTER"){const oe="candle_pane",Pe=s();if(Pe){const $e=[20,20,3,5,20,1.3,7e-4,.35,.5,1,5];if(Pe.createIndicator({name:"TRAP_HUNTER",calcParams:$e},!0,{id:oe})){const Ke={name:"TRAP_HUNTER",pane_id:oe,params:$e},qe=`${oe}_TRAP_HUNTER`;f.update(nt=>(nt.saveInds[qe]=Ke,nt)),iv(),Fp.recordAddIndicator(Z,oe,Ke.params,qe),xe=!0}}}else if(Z==="VOLCANIC"){const oe="pane_VOLCANIC",Pe=s();if(Pe){const $e=[16,2,14,20,60,2,.5,1,.8,.8,.4,10,1,30,0,7e-4,0,1];if(Pe.createIndicator({name:"VOLCANIC",calcParams:$e},!1,{id:oe})){const Ke={name:"VOLCANIC",pane_id:oe,params:$e},qe=`${oe}_VOLCANIC`;f.update(nt=>(nt.saveInds[qe]=Ke,nt)),iv(),Fp.recordAddIndicator(Z,oe,Ke.params,qe),xe=!0}}}else if(Z==="VOLCANIC_SIG"){const oe="candle_pane",Pe=s();if(Pe){const $e=[16,2,14,20,60,2,.5,1,.8,.8,.4,10,1,30,0,7e-4,0,1];if(Pe.createIndicator({name:"VOLCANIC_SIG",calcParams:$e},!0,{id:oe})){const Ke={name:"VOLCANIC_SIG",pane_id:oe,params:$e},qe=`${oe}_VOLCANIC_SIG`;f.update(nt=>(nt.saveInds[qe]=Ke,nt)),iv(),Fp.recordAddIndicator(Z,oe,Ke.params,qe),xe=!0}}}xe&&console.log(`✅ ${Z} added successfully from AI modal`)}function L(pe,Z){x(g,!0),l(!1),c.update(xe=>(xe.editPaneId=pe,xe.editIndName=Z,xe.modalIndCfg=!0,xe))}async function O(pe,Z){if(console.log("🗑️ Deleting indicator:",{paneId:pe,name:Z}),!s()){console.log("❌ No chart available");return}const xe=s(),oe=`${pe}_${Z}`,Pe=o().saveInds[oe];Pe&&Fp.recordRemoveIndicator(Z,pe,Pe.params||[],oe);try{xe.removeIndicator({paneId:pe,name:Z}),console.log("✅ Indicator removed"),f.update($e=>(delete $e.saveInds[oe],$e)),iv()}catch($e){console.log("❌ Error removing indicator:",$e)}}const Y=a_(),[ce,Q]=Y;var le=GK(),ue=fn(le);Ue(ue,l,pe=>{var Z=WK(),xe=fn(Z);xe.__click=[w5,l];var oe=v(xe,2),Pe=v(y(oe),2),$e=y(Pe),ze=v(y($e),2);ze.__click=[w5,l],_($e);var Ke=v($e,2),qe=y(Ke);Yo(qe,19,()=>d,ft=>ft.name,(ft,ut)=>{var bt=zK();const Pt=Bt(()=>i(m).has(i(ut).name)),Et=Bt(()=>i(w)===i(ut).name),Mt=Bt(()=>i(ut).is_main?"candle_pane":`pane_${i(ut).name}`);bt.__click=[TK,Pt,Et,$,ut];var Je=y(bt);Ue(Je,()=>i(Et),Ct=>{var Ze=$K(),Xe=y(Ze);Yo(Xe,20,()=>Array(12),Ii,(Yn,_o,xs)=>{var Rt=FK();Ot(Rt,"style",`--delay: ${xs*.15}s; --x: ${Math.random()*100}%; --y: ${Math.random()*100}%`),q(Yn,Rt)}),_(Xe);var Qe=v(Xe,2);Yo(Qe,20,()=>Array(8),Ii,(Yn,_o,xs)=>{var Rt=LK();Ot(Rt,"style",`--stream-delay: ${xs*.2}s; left: ${10+xs*12}%`),q(Yn,Rt)}),_(Qe);var Ft=v(Qe,2),ot=v(y(Ft),2),ve=y(ot),Ie=y(ve,!0);_(ve);var It=v(ve,2),Dt=y(It,!0);_(It),_(ot);var Zt=v(ot,2),gn=y(Zt),hn=v(gn,2);Yo(hn,20,()=>Array(5),Ii,(Yn,_o,xs)=>{var Rt=EK();Ce(()=>wr(Rt,"active",i(C)>=xs)),q(Yn,Rt)}),_(hn),_(Zt);var On=v(Zt,2),bn=y(On),Fn=y(bn);Ce(()=>tt(Fn,`${Math.round(i(P))??""}%`)),_(bn);var Xs=v(bn,2),oo=y(Xs);_(Xs),_(On),_(Ft),_(Ze),Ce(()=>{var Yn,_o;tt(Ie,((Yn=i(I)[i(C)])==null?void 0:Yn.text)||""),tt(Dt,((_o=i(I)[i(C)])==null?void 0:_o.subtext)||""),Ot(gn,"style",`width: ${i(P)??""}%`),tt(oo,`Phase ${i(C)+1}/5`)}),q(Ct,Ze)},Ct=>{var Ze=OK(),Xe=fn(Ze),Ae=y(Xe,!0);_(Xe);var Qe=v(Xe,2),gt=y(Qe),Ft=y(gt,!0);_(gt),_(Qe);var ot=v(Qe,2);Ue(ot,()=>i(Pt),ve=>{var Ie=jK(),It=y(Ie);It.__click=[DK,L,Mt,ut];var Dt=v(It,2);Dt.__click=[RK,O,Mt,ut],_(Ie),q(ve,Ie)},ve=>{var Ie=BK();q(ve,Ie)}),Ce(()=>{tt(Ae,i(ut).icon),tt(Ft,i(ut).title)}),q(Ct,Ze)}),_(bt),Ce(()=>pi(bt,`indicator-row ${(i(Pt)?"indicator-selected":"")??""} ${(i(Et)?"indicator-loading":"")??""} svelte-uswuii`)),q(ft,bt)});var nt=v(qe,2);nt.__click=[VK],_(Ke),Zi(2),_(Pe),_(oe),wg(3,xe,()=>y_,()=>({duration:200})),wg(3,oe,()=>gy,()=>({y:20,duration:300,easing:kw})),q(pe,Z)});var fe=v(ue,2);Ue(fe,()=>i(A),pe=>{var Z=UK(),xe=fn(Z);xe.__click=[HK,A];var oe=v(xe,2),Pe=v(y(oe),2),$e=y(Pe);$e.__click=[qK,A];var ze=v($e,10);Ce(()=>Ot(ze,"href",ce("https://dutyai.app/settings/investor?device=1",void 0))),_(Pe),_(oe),wg(3,xe,()=>y_,()=>({duration:200})),wg(3,oe,()=>gy,()=>({y:20,duration:300,easing:kw})),q(pe,Z)}),q(n,le),$d()}Ip(["click"]);var KK=ke('<span class="loading loading-spinner loading-xs"></span>'),XK=ke('<span class="text-xs">•</span>'),ZK=ke('<button class="btn btn-sm min-w-[100px] transition-all duration-200 svelte-1ib83i5" title="Save Layout Options"><!> Save <!></button>');function JK(n,e){Ed(e,!1);const t=id(),s=id();let o=hi(e,"savedLayouts",24,()=>[]),r=hi(e,"activeSaveId",8,null),a=hi(e,"isLoading",8,!1),l=hi(e,"hasUnsavedChanges",8,!1);const c=Fh();function f(){c("showPopup")}nm(()=>(tm(r()),tm(o())),()=>{x(t,r()?o().find(m=>m.id===r()):null)}),nm(()=>i(t),()=>{x(s,!!i(t))}),x0(),rv();var u=ZK(),d=y(u);Ue(d,a,m=>{var g=KK();q(m,g)},m=>{Ez(m,{class:"h-4 w-4"})});var h=v(d,2);Ue(h,l,m=>{var g=XK();q(m,g)}),_(u),Ce(()=>u.disabled=a()),vd("click",u,f),q(n,u),$d()}function QK(n,e,t,s,o){n.key==="Enter"&&i(e).valid&&i(t).trim()?(n.preventDefault(),s()):n.key==="Escape"&&(n.preventDefault(),o())}var eX=ke('<div class="flex items-center gap-2 text-sm text-error"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> </div>'),tX=ke('<div class="flex items-center gap-2 text-sm text-success"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Layout name is available</div>'),nX=ke('<div class="flex items-center justify-between text-sm"><span class="text-base-content/80"> </span> <span class="text-xs text-base-content/50"> </span></div>'),sX=ke('<div class="space-y-2"><h4 class="text-sm font-medium text-base-content/70"> </h4> <div class="max-h-32 overflow-y-auto space-y-1 p-3 bg-base-200/30 rounded-lg border border-base-300/50 svelte-bhlz05"></div></div>'),oX=ke('<span class="loading loading-spinner loading-sm"></span> Saving...',1),iX=ke('<div class="space-y-6"><div class="space-y-2"><label for="layout-name" class="block text-sm font-medium text-base-content">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter layout name..." class="w-full px-4 py-3 border border-base-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 bg-base-100 text-base-content placeholder-base-content/50"> <!></div> <!> <div class="flex gap-3 justify-end pt-4 border-t border-base-300/50"><button class="btn btn-ghost min-w-[100px] rounded-lg font-medium transition-all duration-200">Cancel</button> <button class="btn btn-primary min-w-[100px] rounded-lg font-medium transition-all duration-200 hover:scale-105"><!></button></div></div>');function rX(n,e){Ed(e,!1);const t=id();let s=hi(e,"show",12,!1),o=hi(e,"savedLayouts",24,()=>[]),r=hi(e,"isLoading",8,!1),a=hi(e,"mode",8,"save"),l=hi(e,"showExisting",8,!1),c=id(""),f=id({valid:!0}),u=id(!1);const d=Fh();function h(w){if(x(u,!0),!w){x(f,{valid:!1,error:"Layout name is required"}),x(u,!1);return}if(w.length<2){x(f,{valid:!1,error:"Layout name must be at least 2 characters"}),x(u,!1);return}if(w.length>50){x(f,{valid:!1,error:"Layout name must be less than 50 characters"}),x(u,!1);return}if(/[<>:"/\\|?*]/.test(w)){x(f,{valid:!1,error:"Layout name contains invalid characters"}),x(u,!1);return}if(o().some(I=>I.name.toLowerCase()===w.toLowerCase())){x(f,{valid:!1,error:"A layout with this name already exists"}),x(u,!1);return}x(f,{valid:!0}),x(u,!1)}function m(){const w=i(c).trim();i(f).valid&&w&&d("save",{name:w})}function g(){s(!1),d("cancel")}nm(()=>tm(s()),()=>{s()&&(x(c,""),x(f,{valid:!0}),x(u,!1))}),nm(()=>i(c),()=>{i(c).trim()?h(i(c).trim()):x(f,{valid:!1,error:"Layout name is required"})}),nm(()=>tm(a()),()=>{x(t,a()==="save"?"Save Chart Layout":"Save Layout As")}),x0(),rv(),tg(n,{get show(){return s()},set show(w){s(w)},get title(){return i(t)},width:450,buttons:[],children:(w,C)=>{var P=iX(),I=y(P),A=v(y(I),2);xn(A),A.__keydown=[QK,f,c,m,g],a3(A,!0);const M=ov(()=>!i(f).valid&&i(c).trim()),F=ov(()=>i(f).valid&&i(c).trim());var B=v(A,2);Ue(B,()=>i(c).trim()&&!i(f).valid,Q=>{var le=eX(),ue=v(y(le));_(le),Ce(()=>tt(ue,` ${i(f).error??""}`)),q(Q,le)},Q=>{var le=Qn(),ue=fn(le);Ue(ue,()=>i(f).valid&&i(c).trim(),fe=>{var pe=tX();q(fe,pe)},null,!0),q(Q,le)}),_(I);var $=v(I,2);Ue($,()=>l()&&o().length>0,Q=>{var le=sX(),ue=y(le),fe=y(ue);_(ue);var pe=v(ue,2);Yo(pe,5,o,Ii,(Z,xe)=>{var oe=nX(),Pe=y(oe),$e=y(Pe,!0);_(Pe);var ze=v(Pe,2),Ke=y(ze,!0);Ce(()=>tt(Ke,new Date(i(xe).updatedAt).toLocaleDateString())),_(ze),_(oe),Ce(()=>tt($e,i(xe).name)),q(Z,oe)}),_(pe),_(le),Ce(()=>tt(fe,`Existing Layouts (${o().length??""})`)),q(Q,le)});var L=v($,2),O=y(L);O.__click=g;var Y=v(O,2);Y.__click=m,Ce(()=>Y.disabled=!i(f).valid||!i(c).trim()||r()||i(u));var ce=y(Y);Ue(ce,r,Q=>{var le=oX();Zi(),q(Q,le)},Q=>{var le=Y0("Save Layout");q(Q,le)}),_(Y),_(L),_(P),Ce(()=>{A.disabled=r(),wr(A,"border-error",i(M)),wr(A,"border-success",i(F)),O.disabled=r()}),Bs(A,()=>i(c),Q=>x(c,Q)),q(w,P)},$$slots:{default:!0},$$legacy:!0}),$d()}Ip(["keydown","click"]);var aX=ke('<span class="loading loading-spinner loading-xs"></span>'),lX=ke('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path></svg>'),cX=ke('<span class="text-xs text-warning">• Unsaved changes</span>'),uX=ke('<div class="p-4 bg-primary/5 border-b border-base-300/50"><div class="flex items-center gap-2 text-sm"><div class="w-2 h-2 bg-primary rounded-full"></div> <span class="font-medium text-base-content"> </span> <!></div> <div class="text-xs text-base-content/60 mt-1"> </div></div>'),dX=ke('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts yet</div>'),fX=ke('<div class="w-1.5 h-1.5 bg-primary rounded-full"></div>'),pX=ke('<div><div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-sm font-medium text-base-content truncate"> </span> <!></div> <div class="text-xs text-base-content/60"> </div></div> <button class="opacity-0 group-hover:opacity-100 p-1 hover:bg-error/20 rounded transition-all duration-150" title="Delete layout"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),mX=ke('<div class="p-4"><div class="text-xs font-medium text-base-content/70 px-2 py-2"> </div> <div class="space-y-1"></div></div>'),hX=ke('<div class="max-h-48 overflow-y-auto svelte-10s4pck"><!></div>'),vX=ke('<div class="fixed inset-0 bg-transparent z-40"></div> <div class="fixed z-50 bg-base-100 border border-base-300 rounded-lg shadow-xl animate-in fade-in zoom-in-95 duration-200"><div class="flex items-center justify-between p-4 border-b border-base-300/50"><h3 class="text-lg font-semibold text-base-content">Save Chart Layout</h3> <button class="btn btn-ghost btn-sm btn-circle" title="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-4 border-b border-base-300/50"><div class="space-y-2"><button class="w-full flex items-center gap-3 px-4 py-3 text-sm bg-primary text-primary-content hover:bg-primary/90 rounded-md transition-colors duration-150"><!> </button> <button class="w-full flex items-center gap-3 px-4 py-3 text-sm hover:bg-base-200 rounded-md transition-colors duration-150"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> Save As...</button> <button class="w-full flex items-center gap-3 px-4 py-3 text-sm hover:bg-base-200 rounded-md transition-colors duration-150"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> New Layout</button></div></div> <!> <!></div>',1);function gX(n,e){Ed(e,!1);const t=id(),s=id();let o=hi(e,"show",12,!1),r=hi(e,"savedLayouts",24,()=>[]),a=hi(e,"activeSaveId",8,null),l=hi(e,"isLoading",8,!1),c=hi(e,"hasUnsavedChanges",8,!1),f=hi(e,"position",24,()=>({x:0,y:0})),u=hi(e,"showLayouts",8,!0),d=id();const h=Fh();function m(O){i(d)&&!i(d).contains(O.target)&&w()}function g(O){O.key==="Escape"&&w()}Th(()=>{console.log("🎯 ChartSavePopup mounted with props:",{show:o(),savedLayouts:r(),activeSaveId:a(),isLoading:l(),hasUnsavedChanges:c(),position:f()}),o()&&(document.addEventListener("click",m),document.addEventListener("keydown",g))}),b0(()=>{document.removeEventListener("click",m),document.removeEventListener("keydown",g)});function w(){o(!1),h("close")}function C(){i(s)?h("quickSave"):(h("save"),w())}function P(){h("saveAs"),w()}function I(){h("newLayout"),w()}function A(O){h("load",{layoutId:O}),w()}function M(O,Y){O.stopPropagation(),h("delete",{layoutId:Y})}function F(O){return new Date(O).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function B(){const ce=document.querySelector(".chart-container")||document.querySelector(".duty-widget");if(!ce)return`left: ${f().x}px; top: ${f().y}px;`;const Q=ce.getBoundingClientRect();let le=Q.left+Q.width/2-320/2,ue=Q.top+Q.height/2-400/2;return le=Math.max(20,Math.min(le,window.innerWidth-320-20)),ue=Math.max(20,Math.min(ue,window.innerHeight-400-20)),`left: ${le}px; top: ${ue}px;`}nm(()=>(tm(a()),tm(r())),()=>{x(t,a()?r().find(O=>O.id===a()):null)}),nm(()=>i(t),()=>{x(s,!!i(t))}),nm(()=>(tm(o()),tm(r()),tm(a()),i(t),i(s)),()=>{var O;o()&&console.log("🔄 ChartSavePopup reactive update (visible):",{show:o(),savedLayouts:((O=r())==null?void 0:O.length)||0,savedLayoutsData:r(),activeSaveId:a(),activeLayout:i(t),hasActiveSave:i(s)})}),nm(()=>tm(o()),()=>{o()?setTimeout(()=>{document.addEventListener("click",m),document.addEventListener("keydown",g)},0):(document.removeEventListener("click",m),document.removeEventListener("keydown",g))}),x0(),rv();var $=Qn(),L=fn($);Ue(L,o,O=>{var Y=vX(),ce=fn(Y),Q=v(ce,2);const le=ov(B);var ue=y(Q),fe=v(y(ue),2);_(ue);var pe=v(ue,2),Z=y(pe),xe=y(Z),oe=y(xe);Ue(oe,l,nt=>{var ft=aX();q(nt,ft)},nt=>{var ft=lX();q(nt,ft)});var Pe=v(oe);_(xe);var $e=v(xe,2),ze=v($e,2);_(Z),_(pe);var Ke=v(pe,2);Ue(Ke,()=>i(t),nt=>{var ft=uX(),ut=y(ft),bt=v(y(ut),2),Pt=y(bt);_(bt);var Et=v(bt,2);Ue(Et,c,Ct=>{var Ze=cX();q(Ct,Ze)}),_(ut);var Mt=v(ut,2),Je=y(Mt);Ce(()=>tt(Je,`Last saved: ${F(new Date(i(t).updatedAt).getTime())??""}`)),_(Mt),_(ft),Ce(()=>tt(Pt,`Active: ${i(t).name??""}`)),q(nt,ft)});var qe=v(Ke,2);Ue(qe,u,nt=>{var ft=hX(),ut=y(ft);Ue(ut,()=>r().length===0,bt=>{var Pt=dX();q(bt,Pt)},bt=>{var Pt=mX(),Et=y(Pt),Mt=y(Et);_(Et);var Je=v(Et,2);Yo(Je,5,r,Ii,(Ct,Ze)=>{var Xe=pX(),Ae=y(Xe),Qe=y(Ae),gt=y(Qe),Ft=y(gt,!0);_(gt);var ot=v(gt,2);Ue(ot,()=>i(Ze).id===a(),Dt=>{var Zt=fX();q(Dt,Zt)}),_(Qe);var ve=v(Qe,2),Ie=y(ve,!0);Ce(()=>tt(Ie,F(new Date(i(Ze).updatedAt).getTime()))),_(ve),_(Ae);var It=v(Ae,2);_(Xe),Ce(()=>{pi(Xe,`group flex items-center justify-between px-3 py-2 hover:bg-base-200 rounded-md transition-colors duration-150 cursor-pointer ${(i(Ze).id===a()?"bg-primary/10":"")??""}`),tt(Ft,i(Ze).name)}),vd("click",It,Dt=>M(Dt,i(Ze).id)),vd("click",Xe,()=>A(i(Ze).id)),q(Ct,Xe)}),_(Je),_(Pt),Ce(()=>tt(Mt,`Saved Layouts (${r().length??""})`)),q(bt,Pt)}),_(ft),q(nt,ft)}),_(Q),tp(Q,nt=>x(d,nt),()=>i(d)),Ce(()=>{Ot(Q,"style",i(le)),xe.disabled=l(),tt(Pe,` ${(i(s)?"Save to Current Layout":"Save New Layout")??""}`)}),vd("click",ce,w),vd("click",fe,w),vd("click",xe,C),vd("click",$e,P),vd("click",ze,I),q(O,Y)}),q(n,$),$d()}var _X=ke('<div class="p-6 text-center text-base-content/60 text-sm"><span class="loading loading-spinner loading-xs"></span></div>'),yX=ke('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts yet</div>'),bX=ke('<div class="w-1.5 h-1.5 bg-primary rounded-full"></div>'),xX=ke('<div><div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-sm font-medium text-base-content truncate"> </span> <!></div> <div class="text-xs text-base-content/60"> </div></div> <button class="opacity-0 group-hover:opacity-100 p-1 hover:bg-error/20 rounded transition-all duration-150" title="Delete layout"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),wX=ke('<div class="p-4"><div class="text-xs font-medium text-base-content/70 px-2 py-2"> </div> <div class="space-y-1"></div></div>'),kX=ke('<div class="fixed inset-0 bg-transparent z-40"></div> <div class="fixed z-50 bg-base-100 border border-base-300 rounded-lg shadow-xl animate-in fade-in zoom-in-95 duration-200"><div class="flex items-center justify-between p-4 border-b border-base-300/50"><h3 class="text-lg font-semibold text-base-content">Load Chart Layout</h3> <button class="btn btn-ghost btn-sm btn-circle" title="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="max-h-80 overflow-y-auto svelte-ciowbr"><!></div></div>',1);function SX(n,e){Ed(e,!1);let t=hi(e,"show",12,!1),s=hi(e,"savedLayouts",24,()=>[]),o=hi(e,"activeSaveId",8,null),r=hi(e,"isLoading",8,!1),a=hi(e,"position",24,()=>({x:0,y:0})),l=id();const c=Fh();function f(A){i(l)&&!i(l).contains(A.target)&&d()}function u(A){A.key==="Escape"&&d()}Th(()=>{t()&&(document.addEventListener("click",f),document.addEventListener("keydown",u))}),b0(()=>{document.removeEventListener("click",f),document.removeEventListener("keydown",u)});function d(){t(!1),c("close")}function h(A){c("load",{layoutId:A}),d()}function m(A){A!==o()&&h(A)}function g(A,M){A.stopPropagation(),c("delete",{layoutId:M})}function w(A){return new Date(A).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function C(){const F=document.querySelector(".chart-container")||document.querySelector(".duty-widget");if(!F)return`left: ${a().x}px; top: ${a().y}px;`;const B=F.getBoundingClientRect();let $=B.left+B.width/2-320/2,L=B.top+B.height/2-400/2;return $=Math.max(20,Math.min($,window.innerWidth-320-20)),L=Math.max(20,Math.min(L,window.innerHeight-400-20)),`left: ${$}px; top: ${L}px;`}nm(()=>tm(t()),()=>{t()?setTimeout(()=>{document.addEventListener("click",f),document.addEventListener("keydown",u)},0):(document.removeEventListener("click",f),document.removeEventListener("keydown",u))}),x0(),rv();var P=Qn(),I=fn(P);Ue(I,t,A=>{var M=kX(),F=fn(M),B=v(F,2);const $=ov(C);var L=y(B),O=v(y(L),2);_(L);var Y=v(L,2),ce=y(Y);Ue(ce,r,Q=>{var le=_X();q(Q,le)},Q=>{var le=Qn(),ue=fn(le);Ue(ue,()=>s().length===0,fe=>{var pe=yX();q(fe,pe)},fe=>{var pe=wX(),Z=y(pe),xe=y(Z);_(Z);var oe=v(Z,2);Yo(oe,5,s,Ii,(Pe,$e)=>{var ze=xX(),Ke=y(ze),qe=y(Ke),nt=y(qe),ft=y(nt,!0);_(nt);var ut=v(nt,2);Ue(ut,()=>i($e).id===o(),Mt=>{var Je=bX();q(Mt,Je)}),_(qe);var bt=v(qe,2),Pt=y(bt,!0);Ce(()=>tt(Pt,w(new Date(i($e).updatedAt).getTime()))),_(bt),_(Ke);var Et=v(Ke,2);_(ze),Ce(()=>{pi(ze,`group flex items-center justify-between px-3 py-2 hover:bg-base-200 rounded-md transition-colors duration-150 cursor-pointer ${(i($e).id===o()?"bg-primary/10":"")??""}`),tt(ft,i($e).name)}),vd("click",Et,Mt=>g(Mt,i($e).id)),vd("click",ze,()=>m(i($e).id)),q(Pe,ze)}),_(oe),_(pe),Ce(()=>tt(xe,`Saved Layouts (${s().length??""})`)),q(fe,pe)},!0),q(Q,le)}),_(Y),_(B),tp(B,Q=>x(l,Q),()=>i(l)),Ce(()=>Ot(B,"style",i($))),vd("click",F,d),vd("click",O,d),q(A,M)}),q(n,P),$d()}function CX(n,e,t){i(e)?(console.log("💾 SaveAsSelectModal dispatching saveTo event with layoutId:",i(e)),t("saveTo",{layoutId:i(e)})):console.log("❌ SaveAsSelectModal: No layout selected")}function IX(n,e){e("back")}function PX(n,e){e("cancel")}var MX=ke('<div class="p-6 text-center text-base-content/60 text-sm"><span class="loading loading-spinner loading-xs"></span></div>'),NX=ke('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts found.</div>'),AX=ke('<label class="flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-base-200"><input type="radio" name="save-as-target" class="radio radio-primary"> <div class="flex-1 min-w-0"><div class="text-sm font-medium text-base-content truncate"> </div> <div class="text-xs text-base-content/60"> </div></div></label>'),TX=ke('<span class="loading loading-spinner loading-xs"></span> Saving...',1),FX=ke('<div class="space-y-4"><div class="flex items-center justify-between"><button class="btn btn-ghost btn-sm" title="Back">← Back</button> <div></div></div> <div class="text-sm text-base-content/70">Select a saved layout to overwrite with the current chart.</div> <div class="max-h-80 overflow-y-auto divide-y divide-base-300/50 rounded-lg border border-base-300/50 svelte-1a3gcnl"><!></div> <div class="flex justify-end gap-3 pt-2"><button class="btn btn-ghost">Cancel</button> <button class="btn btn-primary"><!></button></div></div>');function LX(n,e){Ed(e,!1);const t=[];let s=hi(e,"show",12,!1),o=hi(e,"savedLayouts",24,()=>[]),r=hi(e,"isLoading",8,!1),a=id(null);const l=Fh();nm(()=>tm(s()),()=>{s()&&x(a,null)}),x0(),rv(),tg(n,{get show(){return s()},set show(c){s(c)},title:"Save As: Choose Layout to Overwrite",width:520,buttons:[],children:(c,f)=>{var u=FX(),d=y(u),h=y(d);h.__click=[IX,l],Zi(2),_(d);var m=v(d,4),g=y(m);Ue(g,r,A=>{var M=MX();q(A,M)},A=>{var M=Qn(),F=fn(M);Ue(F,()=>o().length===0,B=>{var $=NX();q(B,$)},B=>{var $=Qn(),L=fn($);Yo(L,1,o,Ii,(O,Y)=>{var ce=AX(),Q=y(ce);xn(Q);var le,ue=v(Q,2),fe=y(ue),pe=y(fe,!0);_(fe);var Z=v(fe,2),xe=y(Z,!0);Ce(()=>tt(xe,new Date(i(Y).updatedAt).toLocaleString())),_(Z),_(ue),_(ce),Ce(()=>{le!==(le=i(Y).id)&&(Q.value=(Q.__value=i(Y).id)==null?"":i(Y).id),tt(pe,i(Y).name)}),GC(t,[],Q,()=>(i(Y).id,i(a)),oe=>x(a,oe)),q(O,ce)}),q(B,$)},!0),q(A,M)}),_(m);var w=v(m,2),C=y(w);C.__click=[PX,l];var P=v(C,2);P.__click=[CX,a,l];var I=y(P);Ue(I,r,A=>{var M=TX();Zi(),q(A,M)},A=>{var M=Y0("Save");q(A,M)}),_(P),_(w),_(u),Ce(()=>{C.disabled=r(),P.disabled=!i(a)||r()}),q(c,u)},$$slots:{default:!0},$$legacy:!0}),$d()}Ip(["click"]);function EX(n,e,t,s,o,r,a,l,c){if(!e()){x(t,!0);return}m8(s().symbol),x(r,"normal"),x(a,""),l(),x(c,"date")}function $X(n,e,t,s,o,r,a){if(!e()){x(t,!0);return}m8(s().symbol),x(r,"strategy"),x(a,"deposit")}function DX(n,e,t,s,o,r){if(!e()){x(t,!0),x(s,"choose");return}h8(i(o)),v8(Math.max(0,Number(i(r))||0)),x(s,"leverage")}function k5(n,e,t,s,o,r,a,l,c){if(!e()){x(t,!0),x(s,"choose");return}g8(i(o)?i(r)||100:null),_8(!0),x(a,"strategy"),x(l,""),c(),x(s,"date")}function RX(n,e,t,s,o,r){if(!e()){x(t,!0),x(s,"choose");return}const a=o();a&&(y8(a.fromMs,a.toMs),r())}function jX(n,e,t,s,o,r,a){if(!e()){x(t,!0),x(s,"choose");return}if(cz(),i(o)==="normal"){S2("normal"),Yv(!0),r(!1),a("close");try{window.predictNextCandle&&window.predictNextCandle()}catch{}return}if(i(o)==="strategy"){S2("strategy"),r(!1),a("close");const l=window.sidebarHostRef;l&&l.openSidebar&&l.openSidebar()}}function BX(n,e,t,s){x(e,""),i(t)==="strategy"?x(s,"leverage"):x(s,"choose")}var OX=ke('<div class="grid grid-cols-1 md:grid-cols-2 gap-3 items-stretch svelte-1w86s5a"><div class="card lux-card shadow overflow-hidden h-full svelte-1w86s5a"><div class="card-body p-4 min-w-0 flex flex-col h-full svelte-1w86s5a"><div class="flex items-center gap-2 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Normal Price Simulator</div></div> <div class="text-xs opacity-70 mt-1 svelte-1w86s5a">Auto-play historical candles to simulate price movement.</div> <div class="mt-auto pt-3 svelte-1w86s5a"><button class="btn btn-premium-primary w-full svelte-1w86s5a" type="button">Start Normal Mode</button></div></div></div> <div class="card lux-card shadow overflow-hidden h-full svelte-1w86s5a"><div class="card-body p-4 min-w-0 flex flex-col h-full svelte-1w86s5a"><div class="flex items-center gap-2 svelte-1w86s5a"><div class="p-2 rounded-full bg-base-300/60 svelte-1w86s5a"><!></div> <div class="text-sm font-semibold svelte-1w86s5a">Trade Strategy Test</div></div> <div class="text-xs opacity-70 mt-1 svelte-1w86s5a">Deposit, set leverage, buy/pending orders, and track portfolio & PnL.</div> <div class="mt-auto pt-3 svelte-1w86s5a"><button class="btn btn-premium-outline w-full svelte-1w86s5a" type="button">Start Strategy Mode</button></div></div></div></div>'),zX=(n,e)=>x(e,"choose"),VX=ke('<option class="svelte-1w86s5a"> </option>'),WX=ke('<div class="card lux-card shadow overflow-hidden svelte-1w86s5a"><div class="card-body p-4 min-w-0 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Confirm Deposit</div> <div class="mt-2 flex items-center svelte-1w86s5a"><button class="btn btn-xs btn-premium-outline svelte-1w86s5a" type="button">Back</button></div> <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2 items-end svelte-1w86s5a"><div class="flex flex-col gap-1 svelte-1w86s5a"><div class="text-xs opacity-80 svelte-1w86s5a">Currency</div> <select class="select select-bordered select-sm svelte-1w86s5a"></select></div> <input class="input input-bordered input-sm svelte-1w86s5a" type="number" min="0" placeholder="Deposit"> <button class="btn btn-sm btn-premium-primary svelte-1w86s5a" type="button">Confirm Deposit</button></div></div></div>'),HX=(n,e)=>x(e,"deposit"),qX=(n,e)=>x(e,!0),UX=(n,e)=>x(e,!1),GX=ke('<div class="mt-2 flex items-center gap-2 svelte-1w86s5a"><select class="select select-bordered select-sm svelte-1w86s5a"><option class="svelte-1w86s5a">1:50</option><option class="svelte-1w86s5a">1:100</option><option class="svelte-1w86s5a">1:200</option><option class="svelte-1w86s5a">1:400</option><option class="svelte-1w86s5a">1:500</option></select> <button class="btn btn-sm btn-premium-primary svelte-1w86s5a" type="button">Confirm</button></div>'),YX=ke('<div class="mt-2 svelte-1w86s5a"><button class="btn btn-sm btn-premium-outline svelte-1w86s5a" type="button">Confirm</button></div>'),KX=ke('<div class="card lux-card shadow overflow-hidden svelte-1w86s5a"><div class="card-body p-4 min-w-0 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Take leverage?</div> <div class="mt-2 flex items-center svelte-1w86s5a"><button class="btn btn-xs btn-premium-outline svelte-1w86s5a" type="button">Back</button></div> <div class="mt-2 flex items-center gap-2 svelte-1w86s5a"><label class="label cursor-pointer svelte-1w86s5a"><input type="radio" name="lev-modal" class="radio radio-sm svelte-1w86s5a"> <span class="label-text ml-2 svelte-1w86s5a">Yes</span></label> <label class="label cursor-pointer svelte-1w86s5a"><input type="radio" name="lev-modal" class="radio radio-sm svelte-1w86s5a"> <span class="label-text ml-2 svelte-1w86s5a">No</span></label></div> <!></div></div>'),XX=ke('<div class="text-xs text-error mt-2 svelte-1w86s5a"> </div>'),ZX=ke('<div class="card lux-card shadow overflow-hidden svelte-1w86s5a"><div class="card-body p-4 min-w-0 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Select Simulation Range</div> <div class="mt-2 flex items-center svelte-1w86s5a"><button class="btn btn-xs btn-premium-outline svelte-1w86s5a" type="button">Back</button></div> <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2 items-end svelte-1w86s5a"><div class="flex flex-col gap-1 svelte-1w86s5a"><div class="text-xs opacity-80 svelte-1w86s5a">From</div> <input class="input input-bordered input-sm svelte-1w86s5a" type="date"></div> <div class="flex flex-col gap-1 svelte-1w86s5a"><div class="text-xs opacity-80 svelte-1w86s5a">To</div> <input class="input input-bordered input-sm svelte-1w86s5a" type="date"></div> <button class="btn btn-sm btn-premium-primary svelte-1w86s5a" type="button">Confirm Range</button></div> <!> <div class="mt-3 svelte-1w86s5a"><button class="btn btn-xs btn-premium-outline svelte-1w86s5a" type="button">Skip Date Filter</button></div></div></div>'),JX=ke('<div class="p-3 space-y-3 svelte-1w86s5a"><!></div>'),QX=(n,e)=>x(e,!1),eZ=(n,e)=>x(e,!1),tZ=ke('<div class="premium-modal-backdrop svelte-1w86s5a" role="presentation"></div> <div class="premium-modal-container svelte-1w86s5a" role="dialog" aria-modal="true" aria-labelledby="sim-premium-title"><div class="premium-background svelte-1w86s5a"><div class="premium-orb premium-orb-1 svelte-1w86s5a"></div> <div class="premium-orb premium-orb-2 svelte-1w86s5a"></div></div> <div class="premium-content svelte-1w86s5a"><button class="premium-close-btn svelte-1w86s5a" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><line x1="18" y1="6" x2="6" y2="18" class="svelte-1w86s5a"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-1w86s5a"></line></svg></button> <div class="premium-icon-wrapper svelte-1w86s5a"><div class="premium-icon svelte-1w86s5a"><!> <div class="premium-icon-glow svelte-1w86s5a"></div></div></div> <h2 id="sim-premium-title" class="premium-title svelte-1w86s5a">Premium Feature</h2> <p class="premium-message svelte-1w86s5a">Simulator Normal + Strategy modes are AI Pro exclusives. Unlock them to stress-test setups, fast-forward price action, and train with live-like executions.</p> <div class="premium-features svelte-1w86s5a"><div class="premium-feature-item svelte-1w86s5a"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><polyline points="20 6 9 17 4 12" class="svelte-1w86s5a"></polyline></svg> <span class="svelte-1w86s5a">Lightning-fast Normal Simulator</span></div> <div class="premium-feature-item svelte-1w86s5a"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><polyline points="20 6 9 17 4 12" class="svelte-1w86s5a"></polyline></svg> <span class="svelte-1w86s5a">Strategy Mode with deposits, leverage, and PnL</span></div> <div class="premium-feature-item svelte-1w86s5a"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><polyline points="20 6 9 17 4 12" class="svelte-1w86s5a"></polyline></svg> <span class="svelte-1w86s5a">Priority AI signals & future pro drops</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-1w86s5a"><span class="svelte-1w86s5a">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><line x1="5" y1="12" x2="19" y2="12" class="svelte-1w86s5a"></line><polyline points="12 5 19 12 12 19" class="svelte-1w86s5a"></polyline></svg></a></div></div>',1),nZ=ke("<!> <!>",1);function sZ(n,e){Ed(e,!0);const t=sm(),s=()=>wl(w,"$save",t),o=()=>wl(O0,"$userPreferences",t);let r=hi(e,"show",15),a=ge("choose"),l=ge(1e5),c=ge(!1),f=ge(null),u=ge(!1),d=ge(null),h=ge(""),m=ge(""),g=ge("");const w=gd("save");let C=ge(V(s().symbol.priceCurrency||"USD"));Fr(()=>{r()&&(x(a,"choose"),x(d,null),x(g,""))});const P=Fh();function I(le){le==="close"&&P("close")}function A(){var ue;const le=(ue=o())==null?void 0:ue.data;return(le==null?void 0:le.isPremium)===!0||(le==null?void 0:le.isTrial)===!0}function M(){if(i(h)&&i(m))return;const le=new Date,ue=le.toISOString().slice(0,10),pe=new Date(le.getTime()-30*24*60*60*1e3).toISOString().slice(0,10);x(h,V(pe)),x(m,V(ue))}function F(){if(x(g,""),!i(h)||!i(m))return x(g,"Please select a start and end date."),null;const le=new Date(i(h)),ue=new Date(i(m));if(isNaN(le.getTime())||isNaN(ue.getTime()))return x(g,"Invalid date range."),null;le.setHours(0,0,0,0),ue.setHours(23,59,59,999);const fe=le.getTime(),pe=ue.getTime();return!Number.isFinite(fe)||!Number.isFinite(pe)||fe>pe?(x(g,"Start date must be before end date."),null):{fromMs:fe,toMs:pe}}function B(){if(i(d)==="normal")S2("normal"),Yv(!1);else if(i(d)==="strategy"){S2("strategy"),Yv(!1);const le=window.sidebarHostRef;le&&le.openSidebar&&le.openSidebar()}r(!1),P("close")}const $=a_(),[L,O]=$;var Y=nZ(),ce=fn(Y);tg(ce,{get show(){return r()},set show(le){r(le)},title:"Choose Simulator Mode",buttons:[],click:I,get theme(){return s().theme},children:(le,ue)=>{var fe=JX(),pe=y(fe);Ue(pe,()=>i(a)==="choose",Z=>{var xe=OX(),oe=y(xe),Pe=y(oe),$e=v(y(Pe),4),ze=y($e);ze.__click=[EX,A,u,s,w,d,g,M,a],_($e),_(Pe),_(oe);var Ke=v(oe,2),qe=y(Ke),nt=y(qe),ft=y(nt),ut=y(ft);Iz(ut,{size:18}),_(ft),Zi(2),_(nt);var bt=v(nt,4),Pt=y(bt);Pt.__click=[$X,A,u,s,w,d,a],_(bt),_(qe),_(Ke),_(xe),q(Z,xe)},Z=>{var xe=Qn(),oe=fn(xe);Ue(oe,()=>i(a)==="deposit",Pe=>{var $e=WX(),ze=y($e),Ke=v(y(ze),2),qe=y(Ke);qe.__click=[zX,a],_(Ke);var nt=v(Ke,2),ft=y(nt),ut=v(y(ft),2);Yo(ut,21,()=>w8,Ii,(Et,Mt)=>{var Je=VX(),Ct={},Ze=y(Je,!0);_(Je),Ce(()=>{Ct!==(Ct=i(Mt))&&(Je.value=(Je.__value=i(Mt))==null?"":i(Mt)),tt(Ze,i(Mt))}),q(Et,Je)}),_(ut),_(ft);var bt=v(ft,2);xn(bt);var Pt=v(bt,2);Pt.__click=[DX,A,u,a,C,l],_(nt),_(ze),_($e),xo(ut,()=>i(C),Et=>x(C,Et)),Bs(bt,()=>i(l),Et=>x(l,Et)),q(Pe,$e)},Pe=>{var $e=Qn(),ze=fn($e);Ue(ze,()=>i(a)==="leverage",Ke=>{var qe=KX(),nt=y(qe),ft=v(y(nt),2),ut=y(ft);ut.__click=[HX,a],_(ft);var bt=v(ft,2),Pt=y(bt),Et=y(Pt);xn(Et),Et.__click=[qX,c],Zi(2),_(Pt);var Mt=v(Pt,2),Je=y(Mt);xn(Je),Je.__click=[UX,c],Zi(2),_(Mt),_(bt);var Ct=v(bt,2);Ue(Ct,()=>i(c),Ze=>{var Xe=GX(),Ae=y(Xe),Qe=y(Ae);Qe.value=(Qe.__value=50)==null?"":50;var gt=v(Qe);gt.value=(gt.__value=100)==null?"":100;var Ft=v(gt);Ft.value=(Ft.__value=200)==null?"":200;var ot=v(Ft);ot.value=(ot.__value=400)==null?"":400;var ve=v(ot);ve.value=(ve.__value=500)==null?"":500,_(Ae);var Ie=v(Ae,2);Ie.__click=[k5,A,u,a,c,f,d,g,M],_(Xe),xo(Ae,()=>i(f),It=>x(f,It)),q(Ze,Xe)},Ze=>{var Xe=YX(),Ae=y(Xe);Ae.__click=[k5,A,u,a,c,f,d,g,M],_(Xe),q(Ze,Xe)}),_(nt),_(qe),Ce(()=>{Mv(Et,i(c)),Mv(Je,!i(c))}),q(Ke,qe)},Ke=>{var qe=ZX(),nt=y(qe),ft=v(y(nt),2),ut=y(ft);ut.__click=[BX,g,d,a],_(ft);var bt=v(ft,2),Pt=y(bt),Et=v(y(Pt),2);xn(Et),_(Pt);var Mt=v(Pt,2),Je=v(y(Mt),2);xn(Je),_(Mt);var Ct=v(Mt,2);Ct.__click=[RX,A,u,a,F,B],_(bt);var Ze=v(bt,2);Ue(Ze,()=>i(g),Qe=>{var gt=XX(),Ft=y(gt,!0);_(gt),Ce(()=>tt(Ft,i(g))),q(Qe,gt)});var Xe=v(Ze,2),Ae=y(Xe);Ae.__click=[jX,A,u,a,d,r,P],_(Xe),_(nt),_(qe),Bs(Et,()=>i(h),Qe=>x(h,Qe)),Bs(Je,()=>i(m),Qe=>x(m,Qe)),q(Ke,qe)},!0),q(Pe,$e)},!0),q(Z,xe)}),_(fe),q(le,fe)},$$slots:{default:!0}});var Q=v(ce,2);Ue(Q,()=>i(u),le=>{var ue=tZ(),fe=fn(ue);fe.__click=[QX,u];var pe=v(fe,2),Z=v(y(pe),2),xe=y(Z);xe.__click=[eZ,u];var oe=v(xe,2),Pe=y(oe),$e=y(Pe);bz($e,{size:34}),Zi(2),_(Pe),_(oe);var ze=v(oe,8);Ce(()=>Ot(ze,"href",L("https://dutyai.app/settings/investor?device=1",void 0))),_(Z),_(pe),wg(3,fe,()=>y_,()=>({duration:200})),wg(3,pe,()=>gy,()=>({y:18,duration:260})),q(le,ue)}),q(n,Y),$d()}Ip(["click"]);var oZ=ke('<div class="toast svelte-66mo1o"><span class="toast-message svelte-66mo1o"> </span></div>');function V8(n,e){Ed(e,!1);let t=hi(e,"message",8,""),s=hi(e,"duration",8,3e3),o=hi(e,"visible",12,!1);const r=Fh();let a=id();Th(()=>{o()&&l()});function l(){o(!0),setTimeout(()=>{c()},s())}function c(){o(!1),r("hide")}rv();var f=Qn(),u=fn(f);return Ue(u,o,d=>{var h=oZ(),m=y(h),g=y(m,!0);_(m),_(h),tp(h,w=>x(a,w),()=>i(a)),Ce(()=>{wr(h,"show",o()),tt(g,t())}),q(d,h)}),q(n,f),E6(e,"showToast",l),E6(e,"hideToast",c),$d({showToast:l,hideToast:c})}function iZ(n,e,t,s,o,r,a){const l=e().theme==="dark"?"light":"dark";if(s()){x(o,V(l)),x(r,!0);return}a(l,!0)}function rZ(n,e,t,s){i(e)&&(t(i(e),!0),x(s,!1),x(e,null))}function aZ(n,e,t,s){i(e)&&(t(i(e),!1),x(s,!1),x(e,null))}function lZ(n,e,t,s,o,r,a,l){const c=n.target;if(!c.files||!c.files.length)return;const f=c.files[0],u=f.name.split(".").shift()||"Unknown";HW.parse(f,{skipEmptyLines:!0,complete:d=>{var m;const h=d.data.map(g=>({timestamp:parseInt(g[0]),open:parseFloat(g[1]),high:parseFloat(g[2]),low:parseFloat(g[3]),close:parseFloat(g[4]),volume:parseFloat(g[5])}));if(x(e,V(u)),h.length>1){const g=h.length-1,w=Math.min(h[1].timestamp-h[0].timestamp,h[g].timestamp-h[g-1].timestamp);Dc(s,qo(t).period=bg(hP(w/1e3)),qo(t))}h.length>0&&AB(Math.min(h[0].low,h[h.length-1].low))+3,(m=o())==null||m.applyNewData(h,!1),Dc(l,qo(a).loadingDuty=!1,qo(a)),Dc(l,qo(a).dutyLoaded+=1,qo(a))}})}function cZ(n,e,t,s,o,r){const a=!i(e);x(e,a);try{sessionStorage.setItem("drawbarShown",String(a))}catch{}try{const l=t();l&&l.style.setProperty("--drawing-bar-width",a?"52px":"0px");const c=typeof document<"u"?document.querySelector(".duty-main"):null;c&&c.style.setProperty("--drawing-bar-width",a?"52px":"0px");const f=typeof document<"u"?document.querySelector(".drawbar-host"):null;f&&(f.style.width=a?"52px":"0px",f.style.overflow="hidden");const u=typeof document<"u"?document.querySelector(".drawbar-container"):null;u&&a&&(u.style.borderRightWidth="2px",u.style.borderRightStyle="solid",u.style.borderRightColor="var(--menu-border)");const d=typeof document<"u"?document.querySelector(".drawbar-wrapper"):null;d&&a&&(d.style.display="")}catch{}requestAnimationFrame(()=>{var l;s(),(l=o())==null||l.resize()})}async function uZ(n,e,t,s,o,r,a,l,c,f,u,d){if(!i(e)){x(e,!0);try{if(i(t))if(s())try{f();let h=!1;if(document.webkitExitFullscreen)try{document.webkitExitFullscreen(),h=!0}catch(m){console.log("webkitExitFullscreen failed:",m)}if(window.iosFullscreenCleanup)try{window.iosFullscreenCleanup(),delete window.iosFullscreenCleanup,h=!0}catch(m){console.log("iOS cleanup function failed:",m)}if(!h)try{document.body.classList.remove("ios-fullscreen");const m=document.getElementById("ios-fullscreen-style");m&&m.remove();const g=document.querySelector('meta[name="viewport"]');g&&g.setAttribute("content","width=device-width, initial-scale=1.0")}catch(m){console.log("Manual iOS cleanup failed:",m)}x(t,!1),x(u,!1),setTimeout(()=>{a()&&a().resize(),setTimeout(()=>{x(e,!1)},50)},150)}catch(h){console.log("iOS exit rotation failed:",h),x(t,!1),x(u,!1),x(e,!1)}else{try{"screen"in window&&"orientation"in window.screen&&"unlock"in window.screen.orientation&&window.screen.orientation.unlock()}catch(h){console.log("Screen orientation unlock failed:",h)}await d(),x(t,!1),a()?setTimeout(()=>{a().resize(),setTimeout(()=>{x(e,!1)},50)},150):setTimeout(()=>{x(e,!1)},50)}else if(s())try{await o(),window.DeviceOrientationEvent&&r(),x(t,!0),setTimeout(()=>{window.scrollTo(0,1),setTimeout(()=>{window.scrollTo(0,0),a()&&a().resize(),setTimeout(()=>{x(e,!1)},50)},50)},100)}catch(h){console.log("iOS rotation setup failed:",h),x(t,!0),x(e,!1)}else await c(),setTimeout(async()=>{try{"screen"in window&&"orientation"in window.screen&&"lock"in window.screen.orientation?await window.screen.orientation.lock("landscape"):console.log("Screen Orientation API not supported. Please rotate your device manually.")}catch(h){console.log("Screen orientation lock failed:",h)}x(t,!0),a()?setTimeout(()=>{a().resize(),setTimeout(()=>{x(e,!1)},50)},100):setTimeout(()=>{x(e,!1)},50)},50)}catch(h){console.error("Rotation failed:",h),x(t,!1),x(e,!1)}}}var dZ=ke('<div class="save-overlay svelte-b1tvfj"><div class="save-success svelte-b1tvfj">Saved to current layout</div></div>'),fZ=(n,e)=>{var t;return(t=i(e))==null?void 0:t.click()},pZ=ke('<div class="custom-load-section svelte-b1tvfj"><input type="file" class="hidden svelte-b1tvfj" accept="text/csv"> <button class="custom-load-btn svelte-b1tvfj"><span class="custom-load-text svelte-b1tvfj">打开</span> <div class="custom-load-glow svelte-b1tvfj"></div></button></div>'),mZ=ke('<div class="rotate-loading-overlay svelte-b1tvfj"><div class="rotate-loading-spinner svelte-b1tvfj"><div class="rotate-spinner-ring svelte-b1tvfj"></div> <div class="rotate-spinner-ring svelte-b1tvfj"></div> <div class="rotate-spinner-ring svelte-b1tvfj"></div></div> <div class="rotate-loading-text svelte-b1tvfj">Rotating...</div></div>'),hZ=ta('<path d="M322.402 1.33524C319.002 2.83524 282.402 41.3352 279.802 46.2352C277.602 50.4352 277.602 56.6352 279.802 60.9352C282.102 65.5352 317.402 107.535 320.802 109.735C324.702 112.235 335.002 112.035 338.602 109.335C345.002 104.635 347.402 97.6352 345.002 90.4352C344.302 88.4352 340.902 83.3352 337.402 79.1352C333.902 74.9352 331.302 71.3352 331.502 71.1352C331.702 70.8352 334.802 71.2352 338.202 71.8352C379.802 79.7352 409.802 111.735 415.002 153.835C416.302 163.835 417.802 167.035 422.702 170.435C430.002 175.335 440.902 173.135 445.702 165.735C448.202 162.135 448.302 161.435 447.702 152.135C446.102 124.435 432.902 96.5352 411.102 74.9352C390.202 54.0352 367.102 42.7352 336.702 38.4352L331.902 37.8352L338.402 30.9352C345.302 23.5352 347.002 18.9352 345.502 12.0352C343.502 2.73524 331.702 -2.66476 322.402 1.33524Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M169.504 40.9358C163.204 42.2358 157.004 44.7358 152.004 47.9358C149.504 49.5358 125.204 73.2358 97.8044 100.636C44.9044 153.736 44.8044 153.936 41.4044 167.236C39.3044 175.336 40.0044 188.336 43.0044 196.136C44.1044 199.336 47.1044 204.436 49.4044 207.636C51.8044 210.836 95.8043 255.336 147.104 306.536C217.704 376.836 241.704 400.236 245.604 402.236C259.904 409.736 277.304 409.836 292.304 402.336C296.404 400.336 308.404 388.836 348.304 349.136C393.904 303.636 399.404 297.736 402.504 291.736C406.904 282.936 408.404 275.436 407.704 265.436C407.104 255.636 404.304 247.836 398.604 240.236C396.204 237.036 352.404 192.736 301.404 141.836C200.004 40.8358 204.204 44.5358 189.304 41.4358C181.904 39.8358 175.704 39.7358 169.504 40.9358ZM185.804 74.8358C187.904 75.9358 229.704 117.136 281.704 169.136C363.504 251.136 373.904 261.836 374.504 265.236C376.204 274.436 377.804 272.436 326.204 324.336C299.004 351.536 277.104 372.736 275.304 373.536C270.904 375.436 266.604 375.336 262.204 373.036C257.604 370.636 76.8043 189.636 74.6043 185.236C72.4043 180.936 72.6043 175.636 75.0043 170.936C78.3043 164.336 78.8044 164.436 94.8044 172.336C108.704 179.136 109.704 179.436 117.404 179.736C123.904 180.036 126.704 179.636 131.504 177.936C136.904 175.836 139.304 173.836 156.604 156.536C173.904 139.236 175.904 136.836 178.004 131.436C179.704 126.636 180.104 123.836 179.804 117.336C179.504 109.636 179.204 108.636 172.404 94.7358C164.504 78.8358 164.504 78.3358 170.804 74.9358C175.604 72.4358 181.104 72.4358 185.804 74.8358ZM133.404 133.036L119.404 147.036L112.204 143.736L105.004 140.436L122.804 122.636L140.504 104.936L144.004 111.936L147.504 118.936L133.404 133.036Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M310.402 275.936C308.602 276.336 305.902 277.536 304.402 278.736C299.102 282.436 278.102 304.436 277.102 307.336C275.502 311.236 275.802 318.536 277.502 321.836C280.902 328.436 288.102 331.836 295.802 330.436C298.802 329.836 302.002 327.236 313.902 315.636C321.802 307.836 328.902 300.036 329.602 298.236C334.902 285.836 323.602 272.736 310.402 275.936Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M7.40372 276.837C-0.296283 281.537 -1.79628 290.337 2.00372 309.037C12.9037 362.537 55.5037 401.637 111.304 409.437L116.104 410.037L109.604 416.937C102.704 424.337 101.004 428.937 102.504 435.837C104.504 445.137 116.004 450.537 125.304 446.537C128.904 445.037 165.304 407.037 168.304 401.637C170.504 397.537 170.504 391.337 168.204 386.937C165.904 382.337 130.604 340.337 127.204 338.137C123.304 335.637 113.004 335.837 109.404 338.537C103.004 343.237 100.604 350.237 103.004 357.437C103.704 359.437 107.104 364.537 110.604 368.737C114.104 372.937 116.704 376.537 116.504 376.737C116.304 377.037 113.204 376.637 109.804 376.037C79.4037 370.237 54.9037 351.637 41.9037 324.437C36.6037 313.337 34.4037 305.937 32.9037 293.737C31.7037 284.037 30.2037 280.837 25.3037 277.437C20.5037 274.237 12.1037 273.937 7.40372 276.837Z" fill="currentColor" class="svelte-b1tvfj"></path>',1),vZ=ta('<path d="M322.402 1.33524C319.002 2.83524 282.402 41.3352 279.802 46.2352C277.602 50.4352 277.602 56.6352 279.802 60.9352C282.102 65.5352 317.402 107.535 320.802 109.735C324.702 112.235 335.002 112.035 338.602 109.335C345.002 104.635 347.402 97.6352 345.002 90.4352C344.302 88.4352 340.902 83.3352 337.402 79.1352C333.902 74.9352 331.302 71.3352 331.502 71.1352C331.702 70.8352 334.802 71.2352 338.202 71.8352C379.802 79.7352 409.802 111.735 415.002 153.835C416.302 163.835 417.802 167.035 422.702 170.435C430.002 175.335 440.902 173.135 445.702 165.735C448.202 162.135 448.302 161.435 447.702 152.135C446.102 124.435 432.902 96.5352 411.102 74.9352C390.202 54.0352 367.102 42.7352 336.702 38.4352L331.902 37.8352L338.402 30.9352C345.302 23.5352 347.002 18.9352 345.502 12.0352C343.502 2.73524 331.702 -2.66476 322.402 1.33524Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M169.504 40.9358C163.204 42.2358 157.004 44.7358 152.004 47.9358C149.504 49.5358 125.204 73.2358 97.8044 100.636C44.9044 153.736 44.8044 153.936 41.4044 167.236C39.3044 175.336 40.0044 188.336 43.0044 196.136C44.1044 199.336 47.1044 204.436 49.4044 207.636C51.8044 210.836 95.8043 255.336 147.104 306.536C217.704 376.836 241.704 400.236 245.604 402.236C259.904 409.736 277.304 409.836 292.304 402.336C296.404 400.336 308.404 388.836 348.304 349.136C393.904 303.636 399.404 297.736 402.504 291.736C406.904 282.936 408.404 275.436 407.704 265.436C407.104 255.636 404.304 247.836 398.604 240.236C396.204 237.036 352.404 192.736 301.404 141.836C200.004 40.8358 204.204 44.5358 189.304 41.4358C181.904 39.8358 175.704 39.7358 169.504 40.9358ZM185.804 74.8358C187.904 75.9358 229.704 117.136 281.704 169.136C363.504 251.136 373.904 261.836 374.504 265.236C376.204 274.436 377.804 272.436 326.204 324.336C299.004 351.536 277.104 372.736 275.304 373.536C270.904 375.436 266.604 375.336 262.204 373.036C257.604 370.636 76.8043 189.636 74.6043 185.236C72.4043 180.936 72.6043 175.636 75.0043 170.936C78.3043 164.336 78.8044 164.436 94.8044 172.336C108.704 179.136 109.704 179.436 117.404 179.736C123.904 180.036 126.704 179.636 131.504 177.936C136.904 175.836 139.304 173.836 156.604 156.536C173.904 139.236 175.904 136.836 178.004 131.436C179.704 126.636 180.104 123.836 179.804 117.336C179.504 109.636 179.204 108.636 172.404 94.7358C164.504 78.8358 164.504 78.3358 170.804 74.9358C175.604 72.4358 181.104 72.4358 185.804 74.8358ZM133.404 133.036L119.404 147.036L112.204 143.736L105.004 140.436L122.804 122.636L140.504 104.936L144.004 111.936L147.504 118.936L133.404 133.036Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M310.402 275.936C308.602 276.336 305.902 277.536 304.402 278.736C299.102 282.436 278.102 304.436 277.102 307.336C275.502 311.236 275.802 318.536 277.502 321.836C280.902 328.436 288.102 331.836 295.802 330.436C298.802 329.836 302.002 327.236 313.902 315.636C321.802 307.836 328.902 300.036 329.602 298.236C334.902 285.836 323.602 272.736 310.402 275.936Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M7.40372 276.837C-0.296283 281.537 -1.79628 290.337 2.00372 309.037C12.9037 362.537 55.5037 401.637 111.304 409.437L116.104 410.037L109.604 416.937C102.704 424.337 101.004 428.937 102.504 435.837C104.504 445.137 116.004 450.537 125.304 446.537C128.904 445.037 165.304 407.037 168.304 401.637C170.504 397.537 170.504 391.337 168.204 386.937C165.904 382.337 130.604 340.337 127.204 338.137C123.304 335.637 113.004 335.837 109.404 338.537C103.004 343.237 100.604 350.237 103.004 357.437C103.704 359.437 107.104 364.537 110.604 368.737C114.104 372.937 116.704 376.537 116.504 376.737C116.304 377.037 113.204 376.637 109.804 376.037C79.4037 370.237 54.9037 351.637 41.9037 324.437C36.6037 313.337 34.4037 305.937 32.9037 293.737C31.7037 284.037 30.2037 280.837 25.3037 277.437C20.5037 274.237 12.1037 273.937 7.40372 276.837Z" fill="currentColor" class="svelte-b1tvfj"></path>',1),gZ=(n,e)=>x(e,!0),_Z=(n,e,t)=>e(i(t)),yZ=ke('<button><span class="timeframe-text svelte-b1tvfj"> </span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),bZ=(n,e,t)=>e(t[0]),xZ=ke('<button><span class="timeframe-text svelte-b1tvfj">4h</span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),wZ=(n,e,t)=>e(i(t)),kZ=ke('<button><span class="timeframe-text svelte-b1tvfj"> </span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),SZ=ke('<div class="timeframe-group desktop-only svelte-b1tvfj"><!> <!> <!></div>'),CZ=(n,e,t)=>e(t.find(s=>s.timeframe==="1d")),IZ=ke('<button><span class="timeframe-text svelte-b1tvfj">1d</span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),PZ=(n,e,t)=>e(t.find(s=>s.timeframe==="1w")),MZ=ke('<button><span class="timeframe-text svelte-b1tvfj">1w</span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),NZ=(n,e)=>x(e,!i(e)),AZ=(n,e,t)=>e(i(t)),TZ=ke('<button><span class="timeframe-text svelte-b1tvfj"> </span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),FZ=(n,e,t)=>e(t[0]),LZ=ke('<button><span class="timeframe-text svelte-b1tvfj">4h</span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),EZ=(n,e,t)=>e(t.find(s=>s.timeframe==="1M")),$Z=ke('<button><span class="timeframe-text svelte-b1tvfj">1M</span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),DZ=ke('<div class="timeframe-inline-expand svelte-b1tvfj"><!> <!> <!></div>'),RZ=ke('<div class="timeframe-group mobile-only svelte-b1tvfj"><!> <!> <button aria-label="More timeframes" title="More"><span class="timeframe-text svelte-b1tvfj">⋯</span> <div class="timeframe-glow svelte-b1tvfj"></div></button> <!></div>'),jZ=(n,e)=>x(e,!0),BZ=(n,e)=>x(e,!0),OZ=(n,e)=>x(e,!0),zZ=(n,e)=>x(e,!0),VZ=ke('<button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Play" type="button"><!></button>'),WZ=ke('<button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" disabled title="Simulator active" type="button"><!></button>'),HZ=(n,e)=>x(e,!0),qZ=(n,e)=>x(e,!0),UZ=(n,e,t)=>{e("🖱️ Fullscreen button clicked!"),t()},GZ=(n,e)=>e(n),YZ=(n,e)=>e(n),KZ=n=>{n.preventDefault(),n.stopPropagation()},XZ=(n,e)=>e(n),ZZ=ke('<button title="Scroll to see more" aria-label="Scroll right" type="button"><span class="arrow-icon svelte-b1tvfj"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><polyline points="9 18 15 12 9 6" class="svelte-b1tvfj"></polyline></svg></span></button>'),JZ=ke(`<div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 svelte-b1tvfj" role="dialog" aria-modal="true"><div class="bg-base-100 rounded-lg shadow-xl p-6 w-full max-w-md svelte-b1tvfj"><div class="text-base-content text-lg font-semibold mb-2 svelte-b1tvfj">Switch chart template theme?</div> <div class="text-base-content/80 text-sm mb-5 svelte-b1tvfj"> <br class="svelte-b1tvfj"> Would you like to switch the chart template's theme too?</div> <div class="flex justify-end gap-2 svelte-b1tvfj"><button class="btn btn-sm svelte-b1tvfj" type="button">No</button> <button class="btn btn-sm btn-primary svelte-b1tvfj" type="button">Yes</button></div></div></div>`),QZ=(n,e)=>x(e,!1),eJ=(n,e)=>x(e,!1),tJ=ke('<div class="premium-modal-backdrop svelte-b1tvfj" role="presentation"></div> <div class="premium-modal-container svelte-b1tvfj" role="dialog" aria-modal="true" aria-labelledby="renko-premium-title"><div class="premium-background svelte-b1tvfj"><div class="premium-orb premium-orb-1 svelte-b1tvfj"></div> <div class="premium-orb premium-orb-2 svelte-b1tvfj"></div></div> <div class="premium-content svelte-b1tvfj"><button class="premium-close-btn svelte-b1tvfj" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><line x1="18" y1="6" x2="6" y2="18" class="svelte-b1tvfj"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-b1tvfj"></line></svg></button> <div class="premium-icon-wrapper svelte-b1tvfj"><div class="premium-icon svelte-b1tvfj"><!> <div class="premium-icon-glow svelte-b1tvfj"></div></div></div> <h2 id="renko-premium-title" class="premium-title svelte-b1tvfj">Premium Feature</h2> <p class="premium-message svelte-b1tvfj">Renko and Point &amp; Figure intraday/daily views are AI Pro only. Weekly and Monthly stay free—upgrade to unlock every timeframe and keep your edge live.</p> <div class="premium-features svelte-b1tvfj"><div class="premium-feature-item svelte-b1tvfj"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><polyline points="20 6 9 17 4 12" class="svelte-b1tvfj"></polyline></svg> <span class="svelte-b1tvfj">Full Renko &amp; Point &amp; Figure timeframes</span></div> <div class="premium-feature-item svelte-b1tvfj"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><polyline points="20 6 9 17 4 12" class="svelte-b1tvfj"></polyline></svg> <span class="svelte-b1tvfj">Sharper entries with intraday brick precision</span></div> <div class="premium-feature-item svelte-b1tvfj"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><polyline points="20 6 9 17 4 12" class="svelte-b1tvfj"></polyline></svg> <span class="svelte-b1tvfj">All future AI Pro chart perks, included</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-b1tvfj"><span class="svelte-b1tvfj">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><line x1="5" y1="12" x2="19" y2="12" class="svelte-b1tvfj"></line><polyline points="12 5 19 12 12 19" class="svelte-b1tvfj"></polyline></svg></a></div></div>',1),nJ=ke('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="menu-wrapper svelte-b1tvfj"><div class="menu-container svelte-b1tvfj"><div class="menu-left-section svelte-b1tvfj"><div class="menu-toggle-wrapper svelte-b1tvfj"><button class="menu-toggle-btn svelte-b1tvfj" title="Toggle Left Panel"><div class="menu-toggle-icon-wrapper svelte-b1tvfj"><svg viewBox="0 0 1024 1024"><path d="M192.037 287.953h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32zM832.161 479.169H438.553c-17.673 0-32 14.327-32 32s14.327 32 32 32h393.608c17.673 0 32-14.327 32-32s-14.327-32-32-32zM832.161 735.802H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32zM319.028 351.594l-160 160 160 160z" class="svelte-b1tvfj"></path></svg></div> <div class="menu-toggle-glow svelte-b1tvfj"></div></button></div> <!> <div class="rotate-button-wrapper-mobile svelte-b1tvfj"><button type="button"><!> <div class="menu-btn-content svelte-b1tvfj"><div class="menu-icon-wrapper svelte-b1tvfj"><svg width="20" height="20" viewBox="0 0 448 448" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-b1tvfj"><!></svg></div></div> <div class="menu-btn-glow svelte-b1tvfj"></div></button></div> <div class="symbol-search-section svelte-b1tvfj"><div class="symbol-search-content svelte-b1tvfj"><div class="symbol-search-icon svelte-b1tvfj"><!></div> <span class="symbol-name svelte-b1tvfj"> </span></div></div> <div class="timeframe-section svelte-b1tvfj"><!> <!></div> <div class="ai-section svelte-b1tvfj"><button class="ai-btn group relative overflow-hidden svelte-b1tvfj" aria-label="AI Indicators" title="AI Powered Indicators" type="button"><div class="ai-glitter-bg svelte-b1tvfj"></div> <div class="ai-glitter-particle ai-glitter-1 svelte-b1tvfj"></div> <div class="ai-glitter-particle ai-glitter-2 svelte-b1tvfj"></div> <div class="ai-glitter-particle ai-glitter-3 svelte-b1tvfj"></div> <div class="ai-glitter-particle ai-glitter-4 svelte-b1tvfj"></div> <div class="ai-glitter-particle ai-glitter-5 svelte-b1tvfj"></div> <div class="ai-shine-sweep svelte-b1tvfj"></div> <div class="ai-btn-content svelte-b1tvfj"><div class="ai-icon-wrapper svelte-b1tvfj"><svg class="ai-icon svelte-b1tvfj" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-b1tvfj"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-b1tvfj"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-b1tvfj"></line></svg></div> <span class="ai-text svelte-b1tvfj">AI</span> <div class="ai-badge-mini svelte-b1tvfj">New</div></div></button></div> <div class="chart-type-section svelte-b1tvfj"><button class="pro-menu-btn svelte-b1tvfj" title="Chart Type"><!> <span class="pro-menu-text svelte-b1tvfj"> </span></button></div> <div class="indicator-section svelte-b1tvfj"><button class="pro-menu-btn svelte-b1tvfj" title="Indicators"><!> <span class="pro-menu-text svelte-b1tvfj"> </span></button></div> <div class="undo-redo-section svelte-b1tvfj"><button title="Undo (Ctrl+Z)"><!></button> <button title="Redo (Ctrl+Y)"><!></button></div></div> <div class="menu-right-section svelte-b1tvfj"><!> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Load Chart Layout" type="button"><!></button> <!> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Timezone" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Settings" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Script Studio" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Screenshot" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Toggle Theme" type="button"><!></button></div></div> <!></div> <!> <!> <!>',1);function sJ(n,e){Ed(e,!0);const t=sm(),s=()=>wl(d,"$chart",t),o=()=>wl(m,"$save",t),r=()=>wl(h,"$ctx",t),a=()=>wl(O0,"$userPreferences",t),l=()=>wl(Fl,"$isRenkoActive",t),c=()=>wl(uh,"$simulator",t);let f=hi(e,"customLoad",3,!1),u=hi(e,"mainContainer",15);const d=gd("chart"),h=gd("ctx"),m=gd("save");let g=ge(!0);Th(()=>{try{const ye=sessionStorage.getItem("drawbarShown");if(ye!=null){x(g,ye==="true");const E=u(),me=typeof document<"u"?document.querySelector(".duty-main"):null,Se=typeof document<"u"?document.querySelector(".drawbar-host"):null,Ve=i(g)?"52px":"0px";E&&E.style.setProperty("--drawing-bar-width",Ve),me&&me.style.setProperty("--drawing-bar-width",Ve),Se&&(Se.style.width=Ve)}else{const E=typeof document<"u"?document.querySelector(".drawbar-host"):null;if(E){const me=parseFloat(getComputedStyle(E).width||"52");x(g,me>0)}}}catch{}});const w="*";function C(){let ye=document;return(ye.fullscreenElement||ye.mozFullScreenElement||ye.webkitFullscreenElement||ye.msFullscreenElement)!=null}let P=ge(V(C())),I=ge(!1);{const ye=()=>{const me=i(P);if(x(P,V(C())),me&&!i(P)){if(s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Se=fp(o().theme);An.merge(Se,o().styles),s().setStyles(Xd(Se)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied chart styles before fullscreen exit")}u()&&(u(u().style.cssText="",!0),u().classList.remove("fullscreen")),setTimeout(()=>{var Se;if(u()&&(u().offsetHeight,u().offsetWidth,window.getComputedStyle(u()).height),(Se=s())==null||Se.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Ve=fp(o().theme);An.merge(Ve,o().styles),s().setStyles(Xd(Ve)),r().applyCanvasColors&&r().applyCanvasColors()}},10),setTimeout(()=>{var Se;if((Se=s())==null||Se.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Ve=fp(o().theme);An.merge(Ve,o().styles),s().setStyles(Xd(Ve)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var Se;if((Se=s())==null||Se.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Ve=fp(o().theme);if(An.merge(Ve,o().styles),s().setStyles(Xd(Ve)),r().applyCanvasColors){r().applyCanvasColors();const Ye=s().getVisibleRange();Ye&&s().scrollToDataIndex(Ye.to,0)}console.log("✅ Final chart colors applied after fullscreen exit")}},300),setTimeout(()=>{var Se;(Se=s())==null||Se.resize()},600),setTimeout(()=>{var Se;(Se=s())==null||Se.resize()},1200)}else setTimeout(()=>{var Se;(Se=s())==null||Se.resize()},100)},E=()=>{if(console.log("📱 handleIOSFullscreenChange triggered"),hc()){const me=window.innerHeight===screen.height,Se=document.body.classList.contains("ios-fullscreen"),Ve=window.navigator.standalone;console.log("🔍 iOS fullscreen checks:",{heightMatch:me,hasIOSClass:Se,isStandalone:Ve,windowHeight:window.innerHeight,screenHeight:screen.height,currentFullScreen:i(P)});const Ye=me||Se||Ve,at=i(P);if(i(P)!==Ye){if(console.log(`🔄 iOS fullscreen state changed: ${i(P)} → ${Ye}`),x(P,V(Ye)),at&&!Ye&&s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Re=fp(o().theme);An.merge(Re,o().styles),s().setStyles(Xd(Re)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied chart styles for iOS exit")}console.log("📏 Scheduling iOS chart resizes..."),setTimeout(()=>{var Re;if((Re=s())==null||Re.resize(),at&&!Ye&&s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const De=fp(o().theme);An.merge(De,o().styles),s().setStyles(Xd(De)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var Re;if((Re=s())==null||Re.resize(),at&&!Ye&&s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const De=fp(o().theme);if(An.merge(De,o().styles),s().setStyles(Xd(De)),r().applyCanvasColors){r().applyCanvasColors();const pt=s().getVisibleRange();pt&&s().scrollToDataIndex(pt.to,0)}console.log("✅ Final iOS chart colors applied")}},300)}else console.log("✅ No iOS fullscreen state change needed")}else console.log("❌ Not iOS Safari, skipping handler")};document.addEventListener("fullscreenchange",ye),document.addEventListener("webkitfullscreenchange",ye),document.addEventListener("mozfullscreenchange",ye),document.addEventListener("MSFullscreenChange",ye),hc()&&(window.addEventListener("resize",E),window.addEventListener("orientationchange",E),document.addEventListener("webkitfullscreenchange",E),"standalone"in window.navigator&&window.addEventListener("beforeunload",()=>{i(gt)&&i(gt)()}))}let A=ge(!1),M=ge(!1),F=ge(!1),B=ge(!1),$=ge(!1);function L(){x($,!0)}function O(){$n()}let Y=ge(!1),ce=ge(!1),Q=ge(!1),le=ge(""),ue=ge(""),fe=ge(!1),pe=ge(!1),Z=ge(!1),xe=ge(!1),oe=ge(!1),Pe=ge(null),$e=ge(!1),ze=ge(!1),Ke=ge(!1),qe=ge(V({x:0,y:0})),nt=ge(!1),ft=ge(V({x:0,y:0})),ut=ge(V([])),bt=ge(null),Pt=ge(!1),Et=ge(!1),Mt=!1,Je=ge(!1),Ct=ge(""),Ze=ge(!1),Xe=ge(V({x:0,y:0})),Ae=ge(!1);function Qe(){try{if(u()){const E=(u().querySelector(".chart-container")||u()).getBoundingClientRect();x(Xe,V({x:E.left+E.width/2,y:E.top+E.height/2}))}else{const ye=typeof window<"u"?window.innerWidth:0,E=typeof window<"u"?window.innerHeight:0;x(Xe,V({x:ye/2,y:E/2}))}}catch{}}let gt=ge(null);function Ft(ye){console.log(ye)}let ot=ge(void 0);const ve=[{timeframe:"1m",multiplier:1,timespan:"minute",secs:60},{timeframe:"5m",multiplier:5,timespan:"minute",secs:300},{timeframe:"15m",multiplier:15,timespan:"minute",secs:900},{timeframe:"30m",multiplier:30,timespan:"minute",secs:1800},{timeframe:"1h",multiplier:1,timespan:"hour",secs:3600}],Ie=[{timeframe:"1d",multiplier:1,timespan:"day",secs:86400},{timeframe:"1w",multiplier:1,timespan:"week",secs:604800},{timeframe:"1M",multiplier:1,timespan:"month",secs:2592e3}],It=[{timeframe:"4h",multiplier:4,timespan:"hour",secs:14400}],Dt=["1w","1M"],Zt=[{id:"candle_solid",name:"Candlestick",icon:"candle_solid"},{id:"candle_stroke",name:"Hollow",icon:"candle_stroke"},{id:"candle_up_stroke",name:"Up Hollow",icon:"candle_up_stroke"},{id:"candle_down_stroke",name:"Down Hollow",icon:"candle_down_stroke"},{id:"heikin_ashi",name:"Heikin Ashi",icon:"candle_solid"},{id:"renko_atr",name:"Duty AI Renko",icon:"candle_solid"},{id:"point_and_figure",name:"Point & Figure",icon:"point_and_figure"},{id:"ohlc",name:"OHLC",icon:"ohlc"},{id:"area",name:"Area",icon:"area"},{id:"line_chart",name:"Line",icon:"line"}];let gn=ge(!1),hn=ge(!1),qn=ge(!1),On=ge(!1),bn=ge(void 0);const Fn="smartchart.menu.scrollHint.dismissed",Xs="smartchart.menu.scrollHint.animated";let oo=ge(!1),Yn=ge(!1),_o=ge(!1),xs=null,Rt=0;function un(){try{x(oo,localStorage.getItem(Fn)==="1"),x(Yn,localStorage.getItem(Xs)==="1")}catch{}}function qs(){if(!(i(Yn)||!_3)){x(Yn,!0);try{localStorage.setItem(Xs,"1")}catch{}}}function ri(){if(!i(oo)){x(oo,!0),x(On,!1),x(_o,!1),xs&&(clearTimeout(xs),xs=null);try{localStorage.setItem(Fn,"1")}catch{}}}function Eo(){const ye=document.querySelector(".drawbar-host");if(!ye)return 0;const E=ye.getBoundingClientRect();return Math.max(0,Math.round(E.width))}function Ia(){var pt,Ge,sn,Un;const ye=s();if(!ye)return;const E=Eo(),me=ye.getStyles(),Se=((Ge=(pt=me.candle)==null?void 0:pt.tooltip)==null?void 0:Ge.offsetLeft)??4,Ve=((Un=(sn=me.indicator)==null?void 0:sn.tooltip)==null?void 0:Un.offsetLeft)??4,Ye=Math.max(0,Se-Rt),at=Math.max(0,Ve-Rt),Re=Ye+E,De=at+E;if(Re===Se&&De===Ve){Rt=E;return}ye.setStyles({candle:{tooltip:{offsetLeft:Re}},indicator:{tooltip:{offsetLeft:De}}}),Rt=E}Fr(()=>{let ye=null,E=null;function me(){return typeof window<"u"&&window.saveManager?(ye=window.saveManager.state.subscribe(Ve=>{console.log("📊 SaveManager state updated:",Ve),Ve.initialized?(console.log("🔗 SaveManager is initialized, updating UI state..."),x(ut,V(Ve.savedLayouts)),x(bt,V(Ve.activeSaveId)),x(Pt,V(Ve.isLoading)),E&&(clearInterval(E),E=null)):console.log("⏳ SaveManager exists but not yet initialized...")}),!0):!1}return me()||(console.log("⏳ Waiting for SaveManager to be available..."),E=setInterval(()=>{me()},100)),()=>{ye&&ye(),E&&clearInterval(E)}});function Lr(){s()&&setTimeout(()=>{s().resize()},300)}Th(()=>{un(),Fp.init({chart:s(),saveStore:m,overlaysStore:null});const ye=()=>{x(hn,V(Fp.canUndo())),x(qn,V(Fp.canRedo()))};ye();const E=setInterval(ye,100);"screen"in window&&"orientation"in window.screen?window.screen.orientation.addEventListener("change",Lr):window.addEventListener("orientationchange",Lr),ws();const me=()=>{ri(),ws()},Se=()=>{ws(),typeof window<"u"&&x(xe,window.innerWidth<=768),Ia()};return i(bn)&&i(bn).addEventListener("scroll",me),window.addEventListener("resize",Se),setTimeout(()=>{ws(),typeof window<"u"&&x(xe,window.innerWidth<=768),Ia()},500),()=>{clearInterval(E),xs&&(clearTimeout(xs),xs=null),"screen"in window&&"orientation"in window.screen?window.screen.orientation.removeEventListener("change",Lr):window.removeEventListener("orientationchange",Lr),i(bn)&&i(bn).removeEventListener("scroll",me),window.removeEventListener("resize",Se)}});function Qa(){i(hn)&&Fp.undo()}function yr(){i(qn)&&Fp.redo()}function Fi(ye){var E;if(Bc()&&!dc()){const me=ye==null?void 0:ye.timeframe;if(!Dt.includes(me)){x(Ae,!0);return}}Dc(m,qo(o).period=ye,qo(o));try{const me=(E=o())!=null&&E.key&&typeof o().key=="string"?o().key:"chart";typeof localStorage<"u"&&localStorage.setItem(`${me}.lastTimeframe`,(ye==null?void 0:ye.timeframe)||"")}catch{}i(Z)&&x(Z,!1)}function Rc(){var me,Se,Ve,Ye;if((Se=(me=o().styles)==null?void 0:me.candle)!=null&&Se._isLineChart)return Zt.find(at=>at.id==="line_chart")||Zt[0];const ye=((Ye=(Ve=o().styles)==null?void 0:Ve.candle)==null?void 0:Ye.type)||"candle_solid";return Zt.find(at=>at.id===ye)||Zt[0]}const Cu=_p(m,ye=>ye.symbol.ticker),uc=_p(m,ye=>ye.symbol.shortName),Fl=_p(m,ye=>{var E,me;return((me=(E=ye.styles)==null?void 0:E.candle)==null?void 0:me.type)==="renko_atr"});_p(m,ye=>{var E,me;return((me=(E=ye.styles)==null?void 0:E.candle)==null?void 0:me.type)==="point_and_figure"}),Cu.subscribe(()=>{x(ue,V(o().symbol.shortName||o().symbol.ticker))}),uc.subscribe(()=>{x(ue,V(o().symbol.shortName||o().symbol.ticker))});function jc(){const ye=o().styles||{},E=fp(o().theme);if(ye.backgroundColor||ye.backgroundGradient||ye.backgroundType||ye.backgroundOpacity!==void 0||ye.gridGradient||ye.gridType||ye.gridOpacity!==void 0)return!0;const me=Ge=>{if(!Ge||typeof Ge!="string")return"";const sn=Ge.trim().toLowerCase();if(sn.startsWith("rgba(")){const Un=sn.match(/rgba\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);if(Un){const Zs=Number(Un[1]).toString(16).padStart(2,"0"),vs=Number(Un[2]).toString(16).padStart(2,"0"),Oo=Number(Un[3]).toString(16).padStart(2,"0");return`#${Zs}${vs}${Oo}`}}return sn},Se=me(An.get(ye,"pane.backgroundColor")),Ve=me(An.get(ye,"candle.pane.backgroundColor")),Ye=me(An.get(E,"pane.backgroundColor"));if(Se&&Ye&&Se!==Ye||Ve&&Ye&&Ve!==Ye)return!0;const at=me(An.get(ye,"grid.horizontal.color")),Re=me(An.get(ye,"grid.vertical.color")),De=me(An.get(E,"grid.horizontal.color")),pt=me(An.get(E,"grid.vertical.color"));return!!(at&&De&&at!==De||Re&&pt&&Re!==pt)}function nd(ye){try{if(window.self!==window.top){const E={type:"theme-change",theme:ye};let me=w;try{window.parent.location&&(me=window.parent.location.origin)}catch{me=w}window.parent.postMessage(E,me),console.log("📤 Sent theme-change message to parent:",E,"origin:",me)}}catch(E){console.error("Failed to send theme-change message to parent:",E)}}function Fa(ye,E){var Ve,Ye,at,Re,De;const me=document.querySelector(".duty-main");if(me&&me.setAttribute("data-theme",ye),E){try{const pt=localStorage.getItem("chart");if(pt){const Ge=JSON.parse(pt);Ge.styles&&(delete Ge.styles.backgroundColor,delete Ge.styles.backgroundOpacity,delete Ge.styles.backgroundType,delete Ge.styles.backgroundGradient,Ge.styles.grid&&(delete Ge.styles.grid.horizontal,delete Ge.styles.grid.vertical),delete Ge.styles.gridColor,delete Ge.styles.gridOpacity,delete Ge.styles.gridType,delete Ge.styles.gridGradient,localStorage.setItem("chart",JSON.stringify(Ge)),console.log("🧹 Cleared custom background and grid colors from localStorage"))}}catch(pt){console.error("Failed to clear custom colors from localStorage:",pt)}if(s()){window.__forceApplyThemeDefaults=!0;const pt=fp(ye),Ge=JSON.parse(JSON.stringify(o().styles||{})),sn=pt,Un={...Ge,pane:{...Ge.pane,backgroundColor:sn.pane.backgroundColor},candle:{...Ge.candle,pane:{...(Ve=Ge.candle)==null?void 0:Ve.pane,backgroundColor:sn.candle.pane.backgroundColor}},grid:{...Ge.grid,horizontal:{...(Ye=Ge.grid)==null?void 0:Ye.horizontal,color:sn.grid.horizontal.color},vertical:{...(at=Ge.grid)==null?void 0:at.vertical,color:sn.grid.vertical.color}}},Zs=(Re=Ge==null?void 0:Ge.candle)==null?void 0:Re.type,vs=An.merge({},pt,Un);delete vs.backgroundColor,delete vs.backgroundOpacity,delete vs.backgroundType,delete vs.backgroundGradient,delete vs.gridColor,delete vs.gridOpacity,delete vs.gridType,delete vs.gridGradient,Zs&&vs.candle&&(vs.candle.type=Zs),s().setStyles(Xd(vs)),Dc(m,qo(o).styles=vs,qo(o))}try{const pt=new m6("chart-settings",d,ye);pt.resetToThemeDefaults(ye),pt.destroy(),console.log("🔄 Reset TransactionalThemeManager for theme toggle")}catch(pt){console.error("Failed to reset TransactionalThemeManager:",pt)}}Dc(m,qo(o).theme=ye,qo(o));const Se=(De=a())==null?void 0:De.data;if(Se!=null&&Se.clerkId){const pt=ye==="dark"?"Dark":"Light";f8(Se.clerkId,pt).catch(Ge=>{console.error("Failed to save theme to API:",Ge)})}nd(ye)}function dc(){var E;const ye=(E=a())==null?void 0:E.data;return(ye==null?void 0:ye.isPremium)===!0||(ye==null?void 0:ye.isTrial)===!0}function Bc(){var E,me;const ye=(me=(E=o().styles)==null?void 0:E.candle)==null?void 0:me.type;return ye==="renko_atr"||ye==="point_and_figure"}function rd(){var E;if(dc()||!Bc())return;const ye=(E=o().period)==null?void 0:E.timeframe;if(!Dt.includes(ye)){const me=Ie.find(Se=>Se.timeframe==="1M")||Ie.find(Se=>Se.timeframe==="1w");me&&Fi(me)}}Fr(()=>{var ye,E,me;(E=(ye=o().styles)==null?void 0:ye.candle)==null||E.type,(me=o().period)==null||me.timeframe,rd()});function uf(){const ye=An.get(o().styles,"backgroundType")==="gradient",E=An.get(o().styles,"backgroundGradient"),me=ye&&E&&Array.isArray(E.stops)&&E.stops.length>0,Se=(Ye,at)=>{const Re=(Ye||"#000000").replace("#",""),De=parseInt(Re.substring(0,2),16)||0,pt=parseInt(Re.substring(2,4),16)||0,Ge=parseInt(Re.substring(4,6),16)||0,sn=Math.max(0,Math.min(1,at??1));return`rgba(${De}, ${pt}, ${Ge}, ${sn})`};if(me){requestAnimationFrame(()=>{var Ye,at;try{const Re=(Ye=s())==null?void 0:Ye.getConvertPictureUrl(!0,"png","rgba(0, 0, 0, 0)");if(!Re)return;const De=new Image;De.onload=()=>{const pt=De.naturalWidth||De.width,Ge=De.naturalHeight||De.height,sn=document.createElement("canvas");sn.width=pt,sn.height=Ge;const Un=sn.getContext("2d");if(!Un)return;let Zs;if((E.type==="radial"?"radial":"linear")==="radial")Zs=Un.createRadialGradient(pt/2,Ge/2,0,pt/2,Ge/2,Math.max(pt,Ge)/2);else{const no=((typeof E.direction=="number"?E.direction:90)-90)*Math.PI/180,gl=Math.cos(no),Ms=Math.sin(no),wo=pt/2-pt/2*gl,fr=Ge/2-Ge/2*Ms,xa=pt/2+pt/2*gl,ic=Ge/2+Ge/2*Ms;Zs=Un.createLinearGradient(wo,fr,xa,ic)}[...E.stops].sort((Pi,no)=>(Pi.position??0)-(no.position??0)).forEach(Pi=>{const no=Math.max(0,Math.min(1,(Pi.position??0)/100)),gl=Se(Pi.color,(Pi.opacity??100)/100);Zs.addColorStop(no,gl)}),Un.fillStyle=Zs,Un.fillRect(0,0,pt,Ge),Un.drawImage(De,0,0,pt,Ge),x(le,V(sn.toDataURL("image/png"))),x(Y,!0)},De.src=Re}catch{let De=o().theme==="dark"?"#0A0F1A":"#ffffff";x(le,V(((at=s())==null?void 0:at.getConvertPictureUrl(!0,"jpeg",De))??"")),x(Y,!0)}});return}let Ve;try{const Ye=document.querySelector(".duty-widget"),at=document.querySelector(".duty-main"),Re=De=>{if(!De)return"";const pt=getComputedStyle(De).getPropertyValue("--chart-background-color").trim();return pt&&!pt.includes("gradient")?pt:""};if(Ve=Re(Ye)||Re(at)||void 0,!Ve&&s()&&typeof s().getStyles=="function"){const De=s().getStyles()??{};Ve=An.get(De,"pane.backgroundColor")||An.get(De,"candle.pane.backgroundColor")||void 0}if(!Ve){const De=An.get(o().styles,"backgroundColor");Ve=De&&typeof De=="string"?De:void 0}}catch{}Ve||(Ve=o().theme==="dark"?"#0A0F1A":"#ffffff"),requestAnimationFrame(()=>{var Ye;x(le,V(((Ye=s())==null?void 0:Ye.getConvertPictureUrl(!0,"jpeg",Ve))??"")),x(Y,!0)})}function So(){if(hc()&&i(gt)){i(gt)();return}let ye=document;const E=ye.exitFullscreen??ye.mozCancelFullScreen??ye.webkitExitFullscreen??ye.msExitFullscreen;E?E.call(ye):hc()&&Yr()}function Ll(){Ft("🔄 toggleFullscreen called, current fullScreen: "+i(P)),Ft("🔍 iOS detection - isIOS(): "+ya()+", isIOSSafari(): "+hc()),i(P)?(Ft("🚪 Exiting fullscreen..."),So()):hc()?(Ft("📱 Using iOS Safari fullscreen method"),Pa()):(Ft("🖥️ Using standard fullscreen method"),el())}function ya(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function hc(){const ye=navigator.userAgent,E=/iPad|iPhone|iPod/.test(ye)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,me=/Safari/.test(ye)&&!/Chrome|CriOS|FxiOS/.test(ye);return E&&me}function Pa(){return Ft("📱 enterFullscreenIOS called"),new Promise(ye=>{var me;const E=u();if(Ft("🎯 mainContainer element: "+(E?"Found":"Not found")),E&&E.webkitRequestFullscreen){Ft("🔧 Trying webkitRequestFullscreen...");try{E.webkitRequestFullscreen(),setTimeout(()=>{Ft("✅ webkitRequestFullscreen success, setting fullScreen = true"),x(P,!0),ye(!0)},300);return}catch(Se){Ft("❌ webkitRequestFullscreen failed: "+Se)}}else Ft("❌ webkitRequestFullscreen not available");if(E&&E.webkitEnterFullscreen)try{E.webkitEnterFullscreen(),setTimeout(()=>{x(P,!0),ye(!0)},300);return}catch(Se){console.log("webkitEnterFullscreen failed:",Se)}Ft("🔧 Trying viewport manipulation fallback...");try{const Se=document.querySelector('meta[name="viewport"]'),Ve=(Se==null?void 0:Se.getAttribute("content"))||"";Ft("📋 Original viewport content: "+Ve);const Ye=Se||document.createElement("meta");Ye.setAttribute("name","viewport"),Ye.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"),Se?console.log("🔄 Updated existing viewport meta tag"):(document.head.appendChild(Ye),console.log("➕ Added new viewport meta tag")),window.scrollTo(0,1),console.log("📜 Scrolled to hide Safari UI");const at=document.createElement("style");at.id="ios-fullscreen-style",at.textContent=`
          body.ios-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100vh !important;
            overflow: hidden !important;
            -webkit-overflow-scrolling: touch !important;
          }
          
          .ios-fullscreen #main-container {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
          }
          
          /* Hide Safari bottom bar */
          @supports (padding: max(0px)) {
            .ios-fullscreen {
              padding-bottom: env(safe-area-inset-bottom) !important;
            }
          }
        `,document.head.appendChild(at),console.log("🎨 Added iOS fullscreen CSS styles");const Re=((me=u())==null?void 0:me.getAttribute("data-theme"))||o().theme;Ft("🎨 Preserving theme during iOS fullscreen: "+Re),document.body.classList.add("ios-fullscreen"),console.log("✅ Applied ios-fullscreen class to body"),u()&&(u().setAttribute("data-theme",Re),Ft("🔄 Restored theme attribute: "+Re)),setTimeout(()=>{window.scrollTo(0,0),x(P,!0),Ft("🎯 iOS fullscreen activated successfully!"),x(gt,()=>{var Ge;Ft("🧹 Cleaning up iOS fullscreen...");const De=((Ge=u())==null?void 0:Ge.getAttribute("data-theme"))||o().theme;Ft("🎨 Preserving theme during cleanup: "+De),document.body.classList.remove("ios-fullscreen");const pt=document.getElementById("ios-fullscreen-style");pt&&pt.remove(),Se&&Ve&&Se.setAttribute("content",Ve),u()&&(u().setAttribute("data-theme",De),Ft("🔄 Restored theme attribute after cleanup: "+De)),x(P,!1),Ft("✅ iOS fullscreen cleanup completed")}),ye(!0)},100)}catch(Se){console.log("iOS Safari viewport fallback failed:",Se),ye(!1)}})}function Yr(){var ye;if(console.log("🚪 exitFullscreenIOS called"),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const E=fp(o().theme);An.merge(E,o().styles),s().setStyles(Xd(E)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied styles before iOS exit")}try{document.webkitExitFullscreen?(console.log("🔧 Trying webkitExitFullscreen..."),document.webkitExitFullscreen()):console.log("❌ webkitExitFullscreen not available"),i(gt)?(console.log("🧹 Using stored cleanup function..."),i(gt)(),x(gt,null)):console.log("❌ No stored cleanup function available"),console.log("🔧 Performing manual cleanup...");const E=((ye=u())==null?void 0:ye.getAttribute("data-theme"))||o().theme;console.log("🎨 Preserving theme during manual cleanup: "+E),document.body.classList.remove("ios-fullscreen");const me=document.getElementById("ios-fullscreen-style");me&&(me.remove(),console.log("🗑️ Removed iOS fullscreen styles"));const Se=document.querySelector('meta[name="viewport"]');Se&&(Se.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),console.log("📱 Restored viewport meta tag")),u()&&(u().setAttribute("data-theme",E),console.log("🔄 Restored theme attribute after manual cleanup: "+E)),x(P,!1),console.log("✅ Set fullScreen = false"),setTimeout(()=>{var Ve;if(console.log("📏 First chart resize..."),(Ve=s())==null||Ve.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Ye=fp(o().theme);An.merge(Ye,o().styles),s().setStyles(Xd(Ye)),r().applyCanvasColors&&r().applyCanvasColors()}},10),setTimeout(()=>{var Ve;if((Ve=s())==null||Ve.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Ye=fp(o().theme);An.merge(Ye,o().styles),s().setStyles(Xd(Ye)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var Ve;if((Ve=s())==null||Ve.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Ye=fp(o().theme);if(An.merge(Ye,o().styles),s().setStyles(Xd(Ye)),r().applyCanvasColors){r().applyCanvasColors();const at=s().getVisibleRange();at&&s().scrollToDataIndex(at.to,0)}console.log("✅ Final iOS chart colors applied after exit")}},300)}catch(E){console.log("❌ iOS exit fullscreen failed:",E)}}function el(){return ya()?Pa():new Promise(ye=>{let E=u();E&&E.requestFullscreen?E.requestFullscreen().then(()=>ye(!0)).catch(()=>ye(!1)):E&&E.mozRequestFullScreen?(E.mozRequestFullScreen(),setTimeout(()=>ye(!0),100)):E&&E.webkitRequestFullscreen?(E.webkitRequestFullscreen(),setTimeout(()=>ye(!0),100)):E&&E.msRequestFullscreen?(E.msRequestFullscreen(),setTimeout(()=>ye(!0),100)):ye(!1)})}function Yl(){Vu();const ye=document.createElement("div");ye.id="ios-rotation-hint",ye.innerHTML=`
      <div style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        z-index: 10000;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 280px;
        backdrop-filter: blur(10px);
      ">
        <div style="font-size: 24px; margin-bottom: 10px;">📱</div>
        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Rotate Your Device</div>
        <div style="font-size: 14px; opacity: 0.8;">Turn your device to landscape mode for the best experience</div>
        <div style="margin-top: 15px; font-size: 12px; opacity: 0.6;">Tap anywhere to dismiss</div>
      </div>
    `,ye.onclick=Vu,document.body.appendChild(ye),setTimeout(Vu,4e3)}function Vu(){const ye=document.getElementById("ios-rotation-hint");ye&&ye.remove()}async function Iu(){if(typeof window<"u"&&window.saveManager){const ye=window.saveManager,E=ye.getState();if(x(Ze,!1),E.activeSaveId){const me=await ye.quickSave();me.success||console.error("Quick save failed:",me.error),me.success&&(x(Ke,!1),x(Ct,"Saved to current layout"),x(Je,!0),setTimeout(()=>{x(Je,!1)},2e3),x(Ze,!0),Qe(),setTimeout(()=>{x(Ze,!1)},1500))}else x(Ke,!1),x($e,!0)}}function Ro(){x(Ke,!1),x(ze,!0)}function zr(){x(Ke,!1),x($e,!0)}async function kl(ye){const{layoutId:E}=ye.detail;if(typeof window<"u"&&window.saveManager){const me=window.saveManager;x(Et,!0);const Se=await me.load(E);x(Et,!1),Se.success||console.error("Load failed:",Se.error)}}async function Md(ye){const{layoutId:E}=ye.detail;if(typeof window<"u"&&window.saveManager){const Se=await window.saveManager.delete(E);if(!Se.success){console.error("Delete failed:",Se.error);return}x(ut,V((i(ut)||[]).filter(Ve=>Ve.id!==E))),i(bt)===E&&x(bt,null),x(Pt,!1)}}async function nf(ye){const{name:E}=ye.detail;if(typeof window<"u"&&window.saveManager){const me=window.saveManager;x(Ze,!1);const Se=await me.save(E);Se.success?(x($e,!1),x(Ze,!0),Qe(),setTimeout(()=>{x(Ze,!1)},1500)):console.error("Save failed:",Se.error)}}function zf(){x($e,!1)}async function df(ye){const{layoutId:E}=ye.detail;if(console.log("💾 SaveAsSelectSave triggered with layoutId:",E),typeof window<"u"&&window.saveManager){const me=window.saveManager;console.log("✅ SaveManager found, calling saveTo..."),x(Ze,!1);const Se=await me.saveTo(E);Se.success?(console.log("✅ Save to existing successful"),x(ze,!1),x(Ze,!0),Qe(),setTimeout(()=>{x(Ze,!1)},1500)):console.error("❌ Save to existing failed:",Se.error)}else console.error("❌ SaveManager not available")}function Pu(){x(ze,!1),yf()}function Dd(){x(ze,!1)}function yf(){console.log("🎯 Save button clicked, showing popup..."),console.log("📊 Current savedLayouts:",i(ut)),console.log("🎯 Current activeSaveId:",i(bt)),console.log("💾 SaveManager available:",!!window.saveManager);try{if(typeof window<"u"&&window.saveManager){const E=window.saveManager.getState();if(!E||!Array.isArray(E.savedLayouts)||E.savedLayouts.length===0){x(Ke,!1),x($e,!0);return}}else if(!i(ut)||i(ut).length===0){x(Ke,!1),x($e,!0);return}}catch{x(Ke,!1),x($e,!0);return}if(u()){const ye=u().querySelector(".chart-container");if(ye){const E=ye.getBoundingClientRect();x(qe,V({x:E.left+E.width/2,y:E.top+E.height/2}))}else{const E=u().getBoundingClientRect();x(qe,V({x:E.left+E.width/2,y:E.top+E.height/2}))}}x(Ke,!0)}function $n(){if(u()){const ye=u().querySelector(".chart-container");if(ye){const E=ye.getBoundingClientRect();x(ft,V({x:E.left+E.width/2,y:E.top+E.height/2}))}else{const E=u().getBoundingClientRect();x(ft,V({x:E.left+E.width/2,y:E.top+E.height/2}))}}x(nt,!0)}function ws(){if(!i(bn))return;if(i(oo)){x(On,!1);return}const{scrollWidth:ye,clientWidth:E,scrollLeft:me}=i(bn),Se=ye>E,Ve=me+E>=ye-5,Ye=Se&&!Ve;x(On,V(Ye)),Ye&&!i(Yn)&&!i(_o)&&(x(_o,!0),qs(),xs&&clearTimeout(xs),xs=setTimeout(()=>{x(_o,!1),xs=null},2400))}function Us(ye){if(ye&&(ye.preventDefault(),ye.stopPropagation()),!i(bn))return;ri();const{scrollLeft:E,clientWidth:me,scrollWidth:Se}=i(bn),Ve=me*.7,Ye=Math.min(E+Ve,Se-me);try{i(bn).scrollTo({left:Ye,behavior:"smooth"})}catch{i(bn).scrollLeft=Ye}}function Dn(ye){ye.preventDefault(),ye.stopPropagation(),Us()}const ni=a_(),[mo,sr]=ni;var or=nJ(),hl=fn(or);iH(hl,{get show(){return i(A)},set show(ye){x(A,V(ye))}});var Oi=v(hl,2);cH(Oi,{get show(){return i(M)},set show(ye){x(M,V(ye))}});var si=v(Oi,2);UH(si,{get show(){return i(F)},set show(ye){x(F,V(ye))}});var Wo=v(si,2);KG(Wo,{get show(){return r().modalIndCfg},set show(ye){Dc(h,qo(r).modalIndCfg=ye,qo(r))}});var Ua=v(Wo,2);yK(Ua,{get show(){return i(B)},set show(ye){x(B,V(ye))}});var Hi=v(Ua,2);z8(Hi,{get show(){return i($)},set show(ye){x($,V(ye))}});var to=v(Hi,2);xK(to,{get show(){return i(Y)},set show(ye){x(Y,V(ye))},get url(){return i(le)},set url(ye){x(le,V(ye))}});var Li=v(to,2);SK(Li,{get show(){return i(ce)},set show(ye){x(ce,V(ye))}});var Vr=v(Li,2);AK(Vr,{get show(){return i(gn)},set show(ye){x(gn,V(ye))}});var ba=v(Vr,2);YK(ba,{get show(){return i(Q)},set show(ye){x(Q,V(ye))}});var qi=v(ba,2);rX(qi,{get show(){return i($e)},set show(ye){x($e,V(ye))},get savedLayouts(){return i(ut)},get isLoading(){return i(Pt)},mode:"save",showExisting:!1,$$events:{save:nf,cancel:zf}});var Wr=v(qi,2);LX(Wr,{get show(){return i(ze)},set show(ye){x(ze,V(ye))},get savedLayouts(){return i(ut)},get isLoading(){return i(Pt)},$$events:{saveTo:df,back:Pu,cancel:Dd}});var Kl=v(Wr,2);gX(Kl,{get show(){return i(Ke)},set show(ye){x(Ke,V(ye))},get savedLayouts(){return i(ut)},get activeSaveId(){return i(bt)},get isLoading(){return i(Pt)},get hasUnsavedChanges(){return Mt},get position(){return i(qe)},showLayouts:!1,$$events:{save:Iu,saveAs:Ro,quickSave:Iu,newLayout:zr}});var Wl=v(Kl,2);SX(Wl,{get show(){return i(nt)},set show(ye){x(nt,V(ye))},get savedLayouts(){return i(ut)},get activeSaveId(){return i(bt)},get position(){return i(ft)},get isLoading(){return i(Pt)},$$events:{load:kl,delete:Md}});var Ic=v(Wl,2);V8(Ic,{get visible(){return i(Je)},set visible(ye){x(Je,V(ye))},get message(){return i(Ct)},duration:2e3});var Pc=v(Ic,2);Ue(Pc,()=>i(Ze),ye=>{var E=dZ();Ce(()=>Ot(E,"style",`left: ${i(Xe).x??""}px; top: ${i(Xe).y??""}px;`)),q(ye,E)});var cl=v(Pc,2),mr=y(cl),La=y(mr),Sl=y(La),Ba=y(Sl);Ba.__click=[cZ,g,u,Ia,s,d];var vi=y(Ba),vc=y(vi);_(vi),Zi(2),_(Ba),_(Sl);var ul=v(Sl,2);Ue(ul,f,ye=>{var E=pZ(),me=y(E);me.__change=[lZ,ue,o,m,s,d,r,h],tp(me,Ve=>x(ot,Ve),()=>i(ot));var Se=v(me,2);Se.__click=[fZ,ot],_(E),q(ye,E)});var Ga=v(ul,2),vl=y(Ga);vl.__click=[uZ,pe,fe,ya,Pa,Yl,s,d,el,Vu,P,So];var pu=y(vl);Ue(pu,()=>i(pe),ye=>{var E=mZ();q(ye,E)});var tl=v(pu,2),Oa=y(tl),Oc=y(Oa),Gu=y(Oc);Ue(Gu,()=>i(fe),ye=>{var E=hZ();Zi(3),q(ye,E)},ye=>{var E=vZ();Zi(3),q(ye,E)}),_(Oc),_(Oa),_(tl),Zi(2),_(vl),_(Ga);var El=v(Ga,2);El.__click=[gZ,A];var mu=y(El),bc=y(mu),nl=y(bc);$z(nl,{class:"search-icon"}),_(bc);var la=v(bc,2),Mu=y(la,!0);_(la),_(mu),_(El);var Yu=v(El,2),zc=y(Yu);Ue(zc,()=>!i(xe),ye=>{var E=SZ(),me=y(E);Yo(me,17,()=>ve,Ii,(Ye,at)=>{var Re=yZ();Re.__click=[_Z,Fi,at];var De=y(Re),pt=y(De,!0);_(De),Zi(2),_(Re),Ce(()=>{var Ge;pi(Re,`timeframe-btn ${(i(at).timeframe===((Ge=o().period)==null?void 0:Ge.timeframe)?"timeframe-btn-active":"")??""} svelte-b1tvfj`),tt(pt,i(at).timeframe)}),q(Ye,Re)});var Se=v(me,2);Ue(Se,()=>!l(),Ye=>{var at=xZ();at.__click=[bZ,Fi,It],Ce(()=>{var Re;return pi(at,`timeframe-btn ${(((Re=o().period)==null?void 0:Re.timeframe)==="4h"?"timeframe-btn-active":"")??""} svelte-b1tvfj`)}),q(Ye,at)});var Ve=v(Se,2);Yo(Ve,17,()=>Ie,Ii,(Ye,at)=>{var Re=kZ();Re.__click=[wZ,Fi,at];var De=y(Re),pt=y(De,!0);_(De),Zi(2),_(Re),Ce(()=>{var Ge;pi(Re,`timeframe-btn ${(i(at).timeframe===((Ge=o().period)==null?void 0:Ge.timeframe)?"timeframe-btn-active":"")??""} svelte-b1tvfj`),tt(pt,i(at).timeframe)}),q(Ye,Re)}),_(E),q(ye,E)});var Zd=v(zc,2);Ue(Zd,()=>i(xe),ye=>{var E=RZ(),me=y(E);Ue(me,()=>Ie.find(at=>at.timeframe==="1d"),at=>{var Re=IZ();Re.__click=[CZ,Fi,Ie],Ce(()=>{var De;return pi(Re,`timeframe-btn ${(((De=o().period)==null?void 0:De.timeframe)==="1d"?"timeframe-btn-active":"")??""} svelte-b1tvfj`)}),q(at,Re)});var Se=v(me,2);Ue(Se,()=>Ie.find(at=>at.timeframe==="1w"),at=>{var Re=MZ();Re.__click=[PZ,Fi,Ie],Ce(()=>{var De;return pi(Re,`timeframe-btn ${(((De=o().period)==null?void 0:De.timeframe)==="1w"?"timeframe-btn-active":"")??""} svelte-b1tvfj`)}),q(at,Re)});var Ve=v(Se,2);Ve.__click=[NZ,Z];var Ye=v(Ve,2);Ue(Ye,()=>i(Z),at=>{var Re=DZ(),De=y(Re);Yo(De,17,()=>ve,Ii,(sn,Un)=>{var Zs=TZ();Zs.__click=[AZ,Fi,Un];var vs=y(Zs),Oo=y(vs,!0);_(vs),Zi(2),_(Zs),Ce(()=>{var Pi;pi(Zs,`timeframe-btn ${(i(Un).timeframe===((Pi=o().period)==null?void 0:Pi.timeframe)?"timeframe-btn-active":"")??""} svelte-b1tvfj`),tt(Oo,i(Un).timeframe)}),q(sn,Zs)});var pt=v(De,2);Ue(pt,()=>!l(),sn=>{var Un=LZ();Un.__click=[FZ,Fi,It],Ce(()=>{var Zs;return pi(Un,`timeframe-btn ${(((Zs=o().period)==null?void 0:Zs.timeframe)==="4h"?"timeframe-btn-active":"")??""} svelte-b1tvfj`)}),q(sn,Un)});var Ge=v(pt,2);Ue(Ge,()=>Ie.find(sn=>sn.timeframe==="1M"),sn=>{var Un=$Z();Un.__click=[EZ,Fi,Ie],Ce(()=>{var Zs;return pi(Un,`timeframe-btn ${(((Zs=o().period)==null?void 0:Zs.timeframe)==="1M"?"timeframe-btn-active":"")??""} svelte-b1tvfj`)}),q(sn,Un)}),_(Re),wg(1,Re,()=>dH,()=>({duration:180})),wg(2,Re,()=>y_,()=>({duration:120})),q(at,Re)}),_(E),Ce(()=>{pi(Ve,`timeframe-btn timeframe-more-btn ${(i(Z)?"timeframe-btn-active":"")??""} svelte-b1tvfj`),Ot(Ve,"aria-expanded",i(Z))}),q(ye,E)}),_(Yu);var Yf=v(Yu,2),Kf=y(Yf);Kf.__click=[jZ,Q],_(Yf);var _d=v(Yf,2),Rd=y(_d);Rd.__click=[BZ,gn];var fc=y(Rd);Gv(fc,{get name(){return Rc().icon},size:16});var pp=v(fc,2),kd=y(pp,!0);Ce(()=>tt(kd,Rc().name)),_(pp),_(Rd),_(_d);var Wd=v(_d,2),$l=y(Wd);$l.__click=[OZ,F];var Nu=y($l);Gv(Nu,{name:"indicator",size:16});var Ku=v(Nu,2),bf=y(Ku,!0);Ce(()=>tt(bf,Xw())),_(Ku),_($l),_(Wd);var Xu=v(Wd,2),Ql=y(Xu);Ql.__click=function(...ye){var E;(E=i(hn)?Qa:void 0)==null||E.apply(this,ye)};var Hd=y(Ql);Gv(Hd,{class:"undo-redo-icon",name:"undo",size:16}),_(Ql);var hu=v(Ql,2);hu.__click=function(...ye){var E;(E=i(qn)?yr:void 0)==null||E.apply(this,ye)};var Jc=y(hu);Gv(Jc,{class:"undo-redo-icon",name:"redo",size:16}),_(hu),_(Xu),_(La);var Au=v(La,2),jd=y(Au),Wu=Bt(()=>i(Pt)&&!i(Et));JK(jd,{get savedLayouts(){return i(ut)},get activeSaveId(){return i(bt)},get isLoading(){return i(Wu)},get hasUnsavedChanges(){return Mt},$$events:{save:Iu,saveAs:Ro,quickSave:Iu,load:kl,delete:Md,newLayout:zr,showPopup:yf}});var sf=v(jd,2);sf.__click=$n;var ad=y(sf);Cz(ad,{size:18}),_(sf);var yd=v(sf,2);Ue(yd,()=>c().mode==="none",ye=>{var E=VZ();E.__click=[zZ,I];var me=y(E);Gv(me,{name:"play",size:18}),_(E),q(ye,E)},ye=>{var E=WZ(),me=y(E);Gv(me,{name:"play",size:18}),_(E),q(ye,E)});var Bd=v(yd,2);Bd.__click=[HZ,ce];var Mc=y(Bd);kz(Mc,{size:18}),_(Bd);var Tu=v(Bd,2);Tu.__click=[qZ,$];var qd=y(Tu);Dz(qd,{size:18}),_(Tu);var Xf=v(Tu,2);Xf.__click=function(...ye){var E;(E=e.onToggleScriptStudio)==null||E.apply(this,ye)};var Vf=y(Xf);Sz(Vf,{size:18}),_(Xf);var se=v(Xf,2);se.__click=uf;var be=y(se);wz(be,{size:18}),_(se);var G=v(se,2);G.__click=[UZ,Ft,Ll];var re=y(G);Ue(re,()=>i(P),ye=>{Az(ye,{size:18})},ye=>{Nz(ye,{size:18})}),_(G);var we=v(G,2);we.__click=[iZ,o,m,jc,Pe,oe,Fa];var J=y(we);Ue(J,()=>o().theme==="dark",ye=>{Tz(ye,{size:20})},ye=>{Rz(ye,{size:20})}),_(we),_(Au),_(mr),tp(mr,ye=>x(bn,ye),()=>i(bn));var Fe=v(mr,2);Ue(Fe,()=>i(On),ye=>{var E=ZZ();E.__click=[GZ,Us],E.__touchstart=[YZ,Dn],E.__touchend=[KZ],E.__pointerdown=[XZ,Us],Ce(()=>pi(E,`menu-scroll-arrow ${(i(_o)?"menu-scroll-arrow--animate":"")??""} svelte-b1tvfj`)),q(ye,E)}),_(cl);var yt=v(cl,2);Ue(yt,()=>i(oe),ye=>{var E=JZ(),me=y(E),Se=v(y(me),2),Ve=y(Se);Zi(2),_(Se);var Ye=v(Se,2),at=y(Ye);at.__click=[aZ,Pe,Fa,oe];var Re=v(at,2);Re.__click=[rZ,Pe,Fa,oe],_(Ye),_(me),_(E),Ce(()=>tt(Ve,`${`You're changing the user interface to the ${i(Pe)==="light"?"Light":"Dark"} theme.`??""} `)),q(ye,E)});var vt=v(yt,2);Ue(vt,()=>i(Ae),ye=>{var E=tJ(),me=fn(E);me.__click=[QZ,Ae];var Se=v(me,2),Ve=v(y(Se),2),Ye=y(Ve);Ye.__click=[eJ,Ae];var at=v(Ye,2),Re=y(at),De=y(Re);Gv(De,{name:"candle_solid",size:36}),Zi(2),_(Re),_(at);var pt=v(at,8);Ce(()=>Ot(pt,"href",mo("https://dutyai.app/settings/investor?device=1",void 0))),_(Ve),_(Se),wg(3,me,()=>y_,()=>({duration:180})),wg(3,Se,()=>y_,()=>({duration:200})),q(ye,E)});var jt=v(vt,2);return sZ(jt,{get show(){return i(I)},$$events:{close:()=>x(I,!1)}}),Ce(()=>{v_(vc,`menu-toggle-icon ${(i(g)?"":"rotate")??""} svelte-b1tvfj`),pi(vl,`menu-btn ${(i(fe)?"menu-btn-active":"")??""} ${(i(pe)?"rotate-loading":"")??""} svelte-b1tvfj`),Ot(vl,"title",i(fe)?"Exit Fullscreen & Rotation":"Fullscreen & Rotate to Landscape"),vl.disabled=i(pe),wr(tl,"rotate-content-hidden",i(pe)),wr(Oc,"rotate-icon-spinning",i(pe)),tt(Mu,i(ue)),pi(Ql,`undo-redo-btn ${(i(hn)?"":"undo-redo-disabled")??""} svelte-b1tvfj`),pi(hu,`undo-redo-btn ${(i(qn)?"":"undo-redo-disabled")??""} svelte-b1tvfj`),Ot(G,"title",i(P)?"Exit Fullscreen":"Fullscreen")}),q(n,or),$d({openChartSettings:L,openLoadLayout:O})}Ip(["click","change","touchstart","touchend","pointerdown"]);var oJ=ke('<div class="modal-backdrop svelte-1oypfgf"><div class="modal-content svelte-1oypfgf"><div class="modal-actions svelte-1oypfgf"><button class="action-btn copy-btn svelte-1oypfgf"><svg width="12" height="12" viewBox="0 0 24 24" fill="none"><rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"></rect><path d="M5 15H4C2.9 15 2 14.1 2 13V4C2 2.9 2.9 2 4 2H13C14.1 2 15 2.9 15 4V5" stroke="currentColor" stroke-width="2"></path></svg> <span class="svelte-1oypfgf"> </span></button> <button class="action-btn reset-btn svelte-1oypfgf"><svg width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M3 12C3 7.03 7.03 3 12 3C16.97 3 21 7.03 21 12C21 16.97 16.97 21 12 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><path d="M3 12L7 8M3 12L7 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg> <span class="svelte-1oypfgf">Reset View</span></button></div></div></div>');function iJ(n,e){Ed(e,!1);let t=hi(e,"isOpen",12,!1),s=hi(e,"x",8,0),o=hi(e,"y",8,0),r=hi(e,"currentPrice",8,"");const a=Fh();function l(){t(!1),a("close")}function c(){a("reset"),l()}function f(){a("copy",{price:r()}),l()}function u(g){g.target===g.currentTarget&&l()}function d(g){g.key==="Escape"&&l()}rv();var h=Qn();vd("keydown",EC,d);var m=fn(h);Ue(m,t,g=>{var w=oJ(),C=y(w),P=y(C),I=y(P),A=v(y(I),2),M=y(A);_(A),_(I);var F=v(I,2);_(P),_(C),_(w),Ce(()=>{Ot(C,"style",`left: ${s()??""}px; top: ${o()??""}px;`),tt(M,`Copy Price ${(r()?`(${r()})`:"")??""}`)}),vd("click",I,f),vd("click",F,c),vd("click",w,u),q(g,w)}),q(n,h),$d()}class rJ{constructor(e){Te(this,"chart");Te(this,"overlays",new Map);Te(this,"projectionQueue",new Set);Te(this,"isProjecting",!1);Te(this,"eventListeners",new Map);Te(this,"resizeObserver");Te(this,"periodicProjectionId");Te(this,"lastViewportState");Te(this,"animationFrameId",null);this.chart=e,this.initializeEventListeners()}initializeEventListeners(){if(typeof ResizeObserver<"u"){const e=this.chart.getDom();if(e){const t=new ResizeObserver(()=>{this.scheduleProjection("resize")});t.observe(e),this.resizeObserver=t}}this.setupPeriodicProjection()}setupPeriodicProjection(){this.periodicProjectionId=window.setInterval(()=>{const e=this.getViewportState();e!==this.lastViewportState&&(this.lastViewportState=e,this.scheduleProjection("scroll"))},100)}getViewportState(){try{const e=this.chart.getVisibleRange(),t=this.chart.getSize();return JSON.stringify({visibleRange:e,chartSize:t})}catch{return""}}scheduleProjection(e){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.animationFrameId=requestAnimationFrame(()=>{this.projectAllOverlays(e),this.animationFrameId=null})}addOverlay(e){this.overlays.set(e.id,e),e.points.length>0&&m5(e.points,this.chart),this.projectOverlay(e)}removeOverlay(e){this.overlays.delete(e);try{this.chart.removeOverlay({id:e})}catch(t){console.warn("Could not remove overlay from chart:",t)}}updateOverlay(e){this.overlays.has(e.id)&&(this.overlays.set(e.id,e),e.points.length>0&&m5(e.points,this.chart),this.projectOverlay(e))}getOverlay(e){return this.overlays.get(e)}getAllOverlays(){return Array.from(this.overlays.values())}projectOverlay(e){const t={chart:this.chart,paneId:"candle_pane"},s=R8(e.points,t);return s.isValid&&e.visible!==!1&&this.updateChartOverlay(e,s.screenPoints),s}projectAllOverlays(e){if(!this.isProjecting){this.isProjecting=!0;try{const t={type:e,chart:this.chart,timestamp:Date.now()};this.emitEvent(e,t);for(const s of this.overlays.values())s.visible!==!1&&this.projectOverlay(s)}finally{this.isProjecting=!1}}}updateChartOverlay(e,t){try{const s=t.map(l=>({x:l.x,y:l.y})),o={id:e.id,name:e.type,points:s.map((l,c)=>{var f,u;return{...l,timestamp:(f=e.points[c])==null?void 0:f.t,value:(u=e.points[c])==null?void 0:u.p}}),styles:this.convertOverlayStyles(e.style),visible:e.visible,lock:e.lock},r=this.chart.getOverlays({id:e.id});(r.length>0?r[0]:null)?this.chart.overrideOverlay(o):this.chart.createOverlay(o)}catch(s){console.error("Error updating chart overlay:",s)}}convertOverlayStyles(e){const t={};return e.line&&(t.line={color:e.line.color,size:e.line.size,style:e.line.style==="dashed"?"dashed":"solid"},e.line.dashedValue&&(t.line.dashedValue=e.line.dashedValue)),e.text&&(t.text={color:e.text.color,backgroundColor:e.text.backgroundColor,borderColor:e.text.borderColor,fontSize:e.text.fontSize}),e.polygon&&(t.polygon={color:e.polygon.color,fillColor:e.polygon.fillColor}),t}onTimeframeChange(){this.scheduleProjection("timeframeChange")}onTimezoneChange(){this.scheduleProjection("timezoneChange")}onPriceScaleChange(){this.scheduleProjection("priceScaleChange")}addEventListener(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}removeEventListener(e,t){const s=this.eventListeners.get(e);s&&s.delete(t)}emitEvent(e,t){const s=this.eventListeners.get(e);s&&s.forEach(o=>{try{o(t)}catch(r){console.error("Error in overlay event listener:",r)}})}forceProjection(){this.projectAllOverlays("resize")}clearAllOverlays(){for(const e of this.overlays.keys())this.removeOverlay(e);this.overlays.clear()}dispose(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0),this.periodicProjectionId&&(clearInterval(this.periodicProjectionId),this.periodicProjectionId=void 0),this.clearAllOverlays(),this.eventListeners.clear()}}const aJ={timeframeChange:{debounceMs:100,enabled:!0},zoom:{throttleMs:16,enabled:!0},scroll:{throttleMs:16,enabled:!0},resize:{debounceMs:250,enabled:!0},dataUpdate:{debounceMs:50,enabled:!0},priceScaleChange:{debounceMs:100,enabled:!0}};class lJ{constructor(e,t={}){Te(this,"chart");Te(this,"projectionManager",null);Te(this,"creationManager",null);Te(this,"eventListeners",new Map);Te(this,"resizeObserver",null);Te(this,"config");Te(this,"debounceTimers",new Map);Te(this,"throttleTimers",new Map);this.chart=e,this.config={...aJ,...t}}setProjectionManager(e){this.projectionManager=e}setCreationManager(e){this.creationManager=e}initialize(){this.setupChartEventListeners(),this.setupResizeObserver(),this.setupCustomEventListeners()}setupChartEventListeners(){this.setupViewportChangeDetection()}setupViewportChangeDetection(){let e=null;const s=setInterval(()=>{try{const o=this.chart.getVisibleRange();o&&this.hasRangeChanged(e,o)&&(e=o,this.handleEvent("scroll"))}catch(o){console.error("Error checking viewport changes:",o)}},16);this.eventListeners.set("viewportPolling",()=>clearInterval(s))}setupResizeObserver(){const e=this.chart.getDom();e&&(this.resizeObserver=new ResizeObserver(()=>{this.handleEvent("resize")}),this.resizeObserver.observe(e))}setupCustomEventListeners(){const e=this.chart.getDom();if(!e)return;const t=()=>this.handleEvent("timeframeChange"),s=()=>this.handleEvent("dataUpdate");e.addEventListener("timeframeChange",t),e.addEventListener("dataUpdate",s),this.eventListeners.set("timeframeChange",()=>{e.removeEventListener("timeframeChange",t)}),this.eventListeners.set("dataUpdate",()=>{e.removeEventListener("dataUpdate",s)})}handleEvent(e){const t=this.config[e];t.enabled&&(t.debounceMs?this.debounceEvent(e,t.debounceMs):t.throttleMs?this.throttleEvent(e,t.throttleMs):this.executeEvent(e))}debounceEvent(e,t){const s=this.debounceTimers.get(e);s&&clearTimeout(s);const o=setTimeout(()=>{this.executeEvent(e),this.debounceTimers.delete(e)},t);this.debounceTimers.set(e,o)}throttleEvent(e,t){const s=this.throttleTimers.get(e)||0,o=Date.now();o-s>=t&&(this.executeEvent(e),this.throttleTimers.set(e,o))}executeEvent(e){try{this.projectionManager&&this.projectionManager.forceProjection();const t=this.chart.getDom();t&&t.dispatchEvent(new CustomEvent("overlayEvent",{detail:{type:e,timestamp:Date.now()}}))}catch(t){console.error(`Error handling ${e} event:`,t)}}hasRangeChanged(e,t){return e?e.from!==t.from||e.to!==t.to:!0}hasPriceRangeChanged(e,t){return e?Math.abs(e.min-t.min)>1e-8||Math.abs(e.max-t.max)>1e-8:!0}triggerEvent(e){this.handleEvent(e)}updateConfig(e,t){this.config[e]={...this.config[e],...t}}setEventEnabled(e,t){this.config[e].enabled=t}destroy(){this.debounceTimers.forEach(e=>clearTimeout(e)),this.debounceTimers.clear(),this.throttleTimers.clear(),this.eventListeners.forEach(e=>e()),this.eventListeners.clear(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}}function S5(n){return typeof n=="object"&&n!==null&&typeof n.x=="number"&&typeof n.y=="number"}function C5(n){return typeof n=="object"&&n!==null&&typeof n.timestamp=="number"&&typeof n.value=="number"}function Fx(n){return typeof n=="object"&&n!==null}class cJ{constructor(e){Te(this,"chart");Te(this,"currentSymbolKey",null);this.chart=e}toDrawing(e,t){try{if(!this.currentSymbolKey)return null;const s=Array.isArray(t==null?void 0:t.points)?t.points.map(f=>{if(f&&typeof f=="object"){if(typeof f.timestamp=="number"&&typeof f.value=="number")return{time:f.timestamp,price:f.value};if(typeof f.t=="number"&&typeof f.p=="number")return{time:f.t,price:f.p}}return null}).filter(Boolean):[];if(s.length===0)return null;const o=(t==null?void 0:t.name)||(t==null?void 0:t.type)||"unknown",r=(t==null?void 0:t.styles)||(t==null?void 0:t.style)||{},a=!!(t!=null&&t.lock),l=(t==null?void 0:t.visible)!==!1;return{id:e,symbolKey:this.currentSymbolKey,type:o,points:s,styles:r,...t!=null&&t.extendData?{extendData:t.extendData}:{},locked:a,visible:l}}catch{return null}}setCurrentSymbolKey(e){this.currentSymbolKey=e,console.log("📍 OverlayCreationManager symbol set:",e)}getCurrentSymbolKey(){return this.currentSymbolKey}createPointFromMouse(e,t){try{const s={x:e,y:t},o={chart:this.chart},r=fH(s,o);return r?{timestamp:r.t,value:r.p}:null}catch(s){return console.error("Failed to create point from mouse coordinates:",s),null}}createDataSpaceOverlay(e){if(!Fx(e)||!e.points||!Array.isArray(e.points))return e;const t=e.points.map(s=>{if(S5(s)){const o=this.createPointFromMouse(s.x,s.y);return o?{timestamp:o.timestamp,value:o.value}:s}else if(C5(s))return s;return s});return{...e,points:t,_isDataSpace:!0}}convertLegacyOverlay(e){if(!Fx(e)||e._isDataSpace||!e.points)return e;const t=e.points.map(s=>{if(S5(s)){const o=this.createPointFromMouse(s.x,s.y);return o?{timestamp:o.timestamp,value:o.value}:s}return s});return{...e,points:t,_isDataSpace:!0}}projectOverlayToScreen(e){if(!Fx(e)||!e._isDataSpace||!e.points)return e;const t=e.points.map(s=>{if(C5(s)){const o={id:s.id||"temp",t:s.timestamp,p:s.value},r={chart:this.chart},a=I2(o,r);return a?{x:a.x,y:a.y}:s}return s});return{...e,points:t}}addOverlay(e){try{const t=this.createDataSpaceOverlay(e),s=this.projectOverlayToScreen(t),o=this.chart.createOverlay(s);if(o){const r=Array.isArray(o)?o[0]:o;if(typeof r=="string"){const a=e0();if(a){const l=this.toDrawing(r,t);if(l){a.addDrawing(l);try{iv()}catch{}}}}return r}return null}catch(t){return console.error("Failed to add overlay:",t),null}}storeDataSpaceOverlay(e,t){}getStoredDataSpaceOverlay(e){try{const t=localStorage.getItem("dataSpaceOverlays");return t&&JSON.parse(t)[e]||null}catch(t){return console.error("Failed to retrieve data-space overlay:",t),null}}removeStoredDataSpaceOverlay(e){try{const t=e0();if(t){t.removeDrawing(e);try{iv()}catch{}}}catch(t){console.error("Failed to remove overlay from DrawingManager:",t)}}}function uJ(n){return n.createDataSpaceTemplate("enhancedRect",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:s})=>{var c,f,u,d,h,m;if(s.length<2)return[];const[o,r]=s,a=[],l=30;return a.push({type:"rect",attrs:{x:Math.min(o.x,r.x)-l,y:Math.min(o.y,r.y)-l,width:Math.abs(r.x-o.x)+l*2,height:Math.abs(r.y-o.y)+l*2},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),a.push({type:"rect",attrs:{x:Math.min(o.x,r.x),y:Math.min(o.y,r.y),width:Math.abs(r.x-o.x),height:Math.abs(r.y-o.y)},styles:{style:"stroke",color:((f=(c=e.style)==null?void 0:c.line)==null?void 0:f.color)||"#1677FF",borderSize:((d=(u=e.style)==null?void 0:u.line)==null?void 0:d.size)||1,borderStyle:((m=(h=e.style)==null?void 0:h.line)==null?void 0:m.style)||"solid"}}),a},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function dJ(n){return n.createDataSpaceTemplate("enhancedCircle",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:s})=>{var f,u,d,h,m,g;if(s.length<2)return[];const[o,r]=s,a=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)),l=[];return l.push({type:"circle",attrs:{x:o.x,y:o.y,r:a+30},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),l.push({type:"circle",attrs:{x:o.x,y:o.y,r:a},styles:{style:"stroke",color:((u=(f=e.style)==null?void 0:f.line)==null?void 0:u.color)||"#1677FF",borderSize:((h=(d=e.style)==null?void 0:d.line)==null?void 0:h.size)||1,borderStyle:((g=(m=e.style)==null?void 0:m.line)==null?void 0:g.style)||"solid"}}),l},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function fJ(n){return n.createDataSpaceTemplate("enhancedLine",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:s})=>{var r,a,l,c,f,u;if(s.length<2)return[];const o=[];for(let d=0;d<s.length-1;d++){const h=s[d],m=s[d+1];o.push({type:"line",attrs:{coordinates:[{x:h.x,y:h.y},{x:m.x,y:m.y}]},styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),o.push({type:"line",attrs:{coordinates:[{x:h.x,y:h.y},{x:m.x,y:m.y}]},styles:{color:((a=(r=e.style)==null?void 0:r.line)==null?void 0:a.color)||"#1677FF",size:((c=(l=e.style)==null?void 0:l.line)==null?void 0:c.size)||.5,style:((u=(f=e.style)==null?void 0:f.line)==null?void 0:u.style)||"solid"}})}return o},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function pJ(n){return n.createDataSpaceTemplate("enhancedTrendLine",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:s,chart:o})=>{var h,m,g,w,C,P;if(s.length<2)return[];const[r,a]=s,l=[];let c=r,f=a;const u=e.extendLeft,d=e.extendRight;if(u||d){const I=o.getSize();if(I){const A=(a.y-r.y)/(a.x-r.x);if(u&&(c={x:0,y:r.y+A*(0-r.x)}),d){const M=r.y+A*(I.width-r.x);f={x:I.width,y:M}}}}return l.push({type:"line",attrs:{coordinates:[{x:c.x,y:c.y},{x:f.x,y:f.y}]},styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),l.push({type:"line",attrs:{coordinates:[{x:c.x,y:c.y},{x:f.x,y:f.y}]},styles:{color:((m=(h=e.style)==null?void 0:h.line)==null?void 0:m.color)||"#1677FF",size:((w=(g=e.style)==null?void 0:g.line)==null?void 0:w.size)||.5,style:((P=(C=e.style)==null?void 0:C.line)==null?void 0:P.style)||"solid"}}),l},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function mJ(n){return n.createDataSpaceTemplate("enhancedFibonacci",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:s})=>{if(s.length<2)return[];const[o,r]=s,a=[],l=[0,.236,.382,.5,.618,.786,1,1.618,2.618],c=r.y-o.y;return l.forEach(f=>{var d,h,m,g,w,C,P,I;const u=o.y+c*f;a.push({type:"line",attrs:{coordinates:[{x:Math.min(o.x,r.x),y:u},{x:Math.max(o.x,r.x),y:u}]},styles:{color:"transparent",size:30,style:"solid"},ignoreEvent:!1}),a.push({type:"line",attrs:{coordinates:[{x:Math.min(o.x,r.x),y:u},{x:Math.max(o.x,r.x),y:u}]},styles:{color:((h=(d=e.style)==null?void 0:d.line)==null?void 0:h.color)||"#1677FF",style:"dashed",size:((g=(m=e.style)==null?void 0:m.line)==null?void 0:g.size)||2}}),a.push({type:"text",attrs:{x:Math.max(o.x,r.x)+5,y:u,text:`${(f*100).toFixed(1)}%`},styles:{color:((C=(w=e.style)==null?void 0:w.text)==null?void 0:C.color)||"#666666",size:((I=(P=e.style)==null?void 0:P.text)==null?void 0:I.fontSize)||12}})}),a},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function hJ(n){return{enhancedRect:uJ(n),enhancedCircle:dJ(n),enhancedLine:fJ(n),enhancedTrendLine:pJ(n),enhancedFibonacci:mJ(n)}}const Iw=["sma","smma","ema","wma","rsi","bbands","bollinger","bollinger_bands","atr","obv","cci","mfi","ao","trix","vwap","vwma","zscore","evwma","roc","macd","supertrend","kc","keltner","donchian","atr_bands","vwap_bands","linreg_channel","sar","stoch","ichimoku","pivot_high","pivot_low","auto_fib","autofib","last_value","prev_value","line_value","security","expr","formula"],Pw=["line","histogram","area","cross","dots","stepped","step","bar","candles","ohlc","neon_line","bezier_line","glow_points","heatmap","distortion","cloud","aura","candleshadow","supertrend_cloud","fractal_boxes","liquidity_tiles"],Mw=["arrowUp","arrowDown","circle","square","cross","xcross","diamond","triangle_up_filled","triangle_down_filled","box","label","text","emoji","triangle_up_gradient","triangle_down_gradient","arrow_up_glow","arrow_down_glow","circle_pulse","pill","tag","flag","box_gradient","bubble","spark","star"];function yc(n){return Array.isArray(n)?n:[]}function cf(n){return typeof n=="string"?n:void 0}function Yp(n){return typeof n=="number"&&Number.isFinite(n)?n:void 0}function Lx(n){return String(n||"").replace(/\s+/g,"_").toLowerCase()}function vJ(n,e,t,s){if(!n.length)return{series:[],stateSeries:[]};const o=[],r=[],a=new Set(e.map(f=>Lx(String((f==null?void 0:f.name)||""))).filter(Boolean)),l=new Set(t.map(f=>Lx(String((f==null?void 0:f.name)||""))).filter(Boolean)),c=f=>f==null?"":typeof f=="string"?f:typeof f=="number"&&Number.isFinite(f)?String(f):typeof f=="boolean"?f?"true":"false":"";return n.forEach((f,u)=>{if(!f||typeof f!="object")return;const d=cf(f.type),h=(d?d.toLowerCase():"")||(f.state?"state":(f.series,"series")),m=cf(f.name)||cf(f.series)||cf(f.state)||"";if(!m){s.push(`rules[${u}] missing name`);return}if(h!=="series"&&h!=="state"){s.push(`rules[${u}] invalid type "${String(f.type||"")}"`);return}const g=Lx(m);if(a.has(g)||l.has(g)){s.push(`rules[${u}] name "${m}" conflicts with existing series/stateSeries`);return}const w=c(f.whenExpr??f.when),C=c(f.then??f.value??f.expr);if(!C){s.push(`rules[${u}] missing expression`);return}const P=c(f.else),I=w&&w.trim()?`iff(${w}, ${C}, ${P||(h==="state"?m:"na")})`:C;if(h==="state"){const A=c(f.init)||void 0,M=f.selfMode;r.push({name:m,initExpr:A,updateExpr:I,selfMode:M}),l.add(g)}else o.push({name:m,expr:I}),a.add(g)}),{series:o,stateSeries:r}}function Y_(n){const e=[];if(!n||typeof n!="object")return e.push("Script must be an object"),{ok:!1,errors:e};const t=n,s=!!(t!=null&&t.strategy)||yc(t==null?void 0:t.signals).length>0,o=yc(t.calc),r=yc(t.series),a=yc(t.stateSeries),l=yc(t.rules),c=vJ(l,r,a,e);c.series.length&&r.push(...c.series),c.stateSeries.length&&a.push(...c.stateSeries);const f=[];if(Array.isArray(t.panes)&&t.panes.length)for(const d of t.panes){const h=d.pane==="sub"?"sub":"main";f.push({pane:h,plots:yc(d.plots),levels:yc(d.levels),labels:yc(d.labels),lines:yc(d.lines),runtimeDrawOps:yc(d.runtimeDrawOps),runtimeLabels:yc(d.runtimeLabels),runtimeLines:yc(d.runtimeLines),runtimeBoxes:yc(d.runtimeBoxes),runtimeTables:yc(d.runtimeTables),runtimeHeatmaps:yc(d.runtimeHeatmaps),overlays:yc(d.overlays),min:Yp(d.min),max:Yp(d.max),shortName:cf(d.shortName),fills:yc(d.fills),backgroundZones:yc(d.backgroundZones),height:Yp(d.height)})}else if(t.main||t.sub)t.main&&f.push({pane:"main",plots:yc(t.main.plots),levels:yc(t.main.levels),labels:yc(t.main.labels),lines:yc(t.main.lines),runtimeDrawOps:yc(t.main.runtimeDrawOps),runtimeLabels:yc(t.main.runtimeLabels),runtimeLines:yc(t.main.runtimeLines),runtimeBoxes:yc(t.main.runtimeBoxes),runtimeTables:yc(t.main.runtimeTables),runtimeHeatmaps:yc(t.main.runtimeHeatmaps),overlays:yc(t.main.overlays),min:Yp(t.main.min),max:Yp(t.main.max),shortName:cf(t.main.shortName||t.shortName),fills:yc(t.main.fills),backgroundZones:yc(t.main.backgroundZones),height:Yp(t.main.height)}),t.sub&&f.push({pane:"sub",plots:yc(t.sub.plots),levels:yc(t.sub.levels),labels:yc(t.sub.labels),lines:yc(t.sub.lines),runtimeDrawOps:yc(t.sub.runtimeDrawOps),runtimeLabels:yc(t.sub.runtimeLabels),runtimeLines:yc(t.sub.runtimeLines),runtimeBoxes:yc(t.sub.runtimeBoxes),runtimeTables:yc(t.sub.runtimeTables),runtimeHeatmaps:yc(t.sub.runtimeHeatmaps),overlays:yc(t.sub.overlays),min:Yp(t.sub.min),max:Yp(t.sub.max),shortName:cf(t.sub.shortName||t.shortName),fills:yc(t.sub.fills),backgroundZones:yc(t.sub.backgroundZones),height:Yp(t.sub.height)});else if(t.pane||t.plots||t.labels||t.levels||t.lines){const d=t.pane==="sub"?"sub":"main";f.push({pane:d,plots:yc(t.plots),levels:yc(t.levels),labels:yc(t.labels),lines:yc(t.lines),runtimeDrawOps:yc(t.runtimeDrawOps),runtimeLabels:yc(t.runtimeLabels),runtimeLines:yc(t.runtimeLines),runtimeBoxes:yc(t.runtimeBoxes),runtimeTables:yc(t.runtimeTables),runtimeHeatmaps:yc(t.runtimeHeatmaps),overlays:yc(t.overlays),min:Yp(t.min),max:Yp(t.max),shortName:cf(t.shortName),fills:[],backgroundZones:[],height:void 0})}f.length||(s?f.push({pane:"main",plots:[],levels:[],labels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],runtimeHeatmaps:[],overlays:[],min:Yp(t.min),max:Yp(t.max),shortName:cf(t.shortName),fills:[],backgroundZones:[],height:void 0}):e.push("No panes defined"));const u={calc:o.map((d,h)=>({name:cf(d.name)||cf(d.type)||`calc_${h}`,type:cf(d.type)||cf(d.name),source:cf(d.source),period:Yp(d.period),fast:Yp(d.fast),slow:Yp(d.slow),signal:Yp(d.signal),kPeriod:Yp(d.kPeriod),dPeriod:Yp(d.dPeriod),left:Yp(d.left),right:Yp(d.right),tenkan:Yp(d.tenkan),kijun:Yp(d.kijun),senkouB:Yp(d.senkouB),expr:cf(d.expr),timeframe:cf(d.timeframe),symbol:cf(d.symbol),country:cf(d.country),lookahead:cf(d.lookahead),gaps:cf(d.gaps),lower:d.lower===!0?!0:void 0,params:d.params,style:d.style})),series:r.map((d,h)=>({name:cf(d.name)||`series_${h}`,expr:cf(d.expr)||""})),stateSeries:a.map((d,h)=>({name:cf(d.name)||`state_${h}`,initExpr:cf(d.initExpr),updateExpr:cf(d.updateExpr)||"",selfMode:d.selfMode||void 0})),panes:f,loopPlans:Array.isArray(t.loopPlans)?t.loopPlans:void 0,userFunctions:Array.isArray(t.userFunctions)?t.userFunctions:void 0,signals:yc(t.signals).map((d,h)=>{const m=d==null?void 0:d.order,g=cf(d==null?void 0:d.title),w=cf(d==null?void 0:d.message),C=cf(d==null?void 0:d.whenExpr),P=cf(d==null?void 0:d.scoreExpr),I=cf(d==null?void 0:d.cooldownExpr),A=cf(m==null?void 0:m.kind),M=A?A.trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit"):void 0,F=cf((d==null?void 0:d.frequency)??(d==null?void 0:d.freq)),B=nt=>{if(typeof nt=="number"&&Number.isFinite(nt)||typeof nt=="string")return nt},$=nt=>{if(typeof nt=="number"&&Number.isFinite(nt)||typeof nt=="string")return nt},L=B(m==null?void 0:m.price),O=B((m==null?void 0:m.stopPrice)??(m==null?void 0:m.stop)??(m==null?void 0:m.trigger)),Y=B((m==null?void 0:m.limitPrice)??(m==null?void 0:m.limit)??(m==null?void 0:m.lmt)),ce=$(m==null?void 0:m.qty),Q=$(m==null?void 0:m.cash),le=$((m==null?void 0:m.commissionPct)??(m==null?void 0:m.commission)),ue=$((m==null?void 0:m.slippagePct)??(m==null?void 0:m.slippage)),fe=typeof(m==null?void 0:m.qtyPct)=="number"&&Number.isFinite(m.qtyPct)?m.qtyPct:void 0,pe=typeof fe=="number"?Math.max(0,Math.min(100,fe)):void 0,Z=cf(m==null?void 0:m.oco),xe=typeof(m==null?void 0:m.expiresBars)=="number"&&Number.isFinite(m.expiresBars)?m.expiresBars:void 0,oe=typeof xe=="number"?Math.max(0,Math.floor(xe)):void 0,Pe=m==null?void 0:m.bracket,$e=(()=>{if(!Pe||typeof Pe!="object")return;const nt=Pe,ft=typeof nt.stopLossPct=="number"&&Number.isFinite(nt.stopLossPct)?Math.max(0,nt.stopLossPct):void 0,ut=typeof nt.takeProfitPct=="number"&&Number.isFinite(nt.takeProfitPct)?Math.max(0,nt.takeProfitPct):void 0,bt=typeof nt.trailingStopPct=="number"&&Number.isFinite(nt.trailingStopPct)?Math.max(0,nt.trailingStopPct):void 0,Pt=[],Et=Array.isArray(nt.takeProfits)?nt.takeProfits:[];for(const Mt of Et){if(!Mt||typeof Mt!="object")continue;const Je=typeof Mt.takeProfitPct=="number"?Mt.takeProfitPct:Number(Mt.takeProfitPct),Ct=typeof Mt.qtyPct=="number"?Mt.qtyPct:Number(Mt.qtyPct);!Number.isFinite(Je)||Je<=0||!Number.isFinite(Ct)||Ct<=0||Pt.push({takeProfitPct:Math.max(0,Je),qtyPct:Math.max(0,Math.min(100,Ct))})}if(Pt.sort((Mt,Je)=>Mt.takeProfitPct-Je.takeProfitPct),!(ft==null&&ut==null&&bt==null&&Pt.length===0))return{stopLossPct:ft,takeProfitPct:ut,trailingStopPct:bt,takeProfits:Pt.length?Pt:void 0}})(),ze=typeof(d==null?void 0:d.cooldownBars)=="number"&&Number.isFinite(d.cooldownBars)?d.cooldownBars:void 0,Ke=typeof ze=="number"?Math.max(0,Math.floor(ze)):void 0;let qe=null;return P==null&&(d==null?void 0:d.score)!=null&&(typeof d.score!="number"||!Number.isFinite(d.score)?e.push(`signals[${h}].score must be an integer 0..10`):Number.isInteger(d.score)?d.score<0||d.score>10?e.push(`signals[${h}].score must be in range 0..10`):qe=d.score:e.push(`signals[${h}].score must be an integer 0..10`)),{type:String((d==null?void 0:d.type)||""),when:String((d==null?void 0:d.when)||""),whenExpr:C,id:cf(d==null?void 0:d.id),orderId:cf(d==null?void 0:d.orderId),title:g,message:w,frequency:F,score:qe,scoreExpr:P,order:M||L!=null||O!=null||Y!=null||ce!=null||Q!=null||pe!=null||Z!=null||oe!=null||le!=null||ue!=null||$e!=null?{kind:M,price:L,stopPrice:O,limitPrice:Y,qty:ce,cash:Q,qtyPct:pe,oco:Z,expiresBars:oe,commissionPct:le,slippagePct:ue,bracket:$e}:void 0,cooldownBars:Ke,cooldownExpr:I}}),shortName:cf(t.shortName),strategy:t.strategy,params:t.params,style:t.style};return u.series.forEach((d,h)=>{d.name||e.push(`series[${h}] missing name`)}),u.stateSeries.forEach((d,h)=>{d.name||e.push(`stateSeries[${h}] missing name`),d.updateExpr||e.push(`stateSeries[${h}] missing updateExpr`)}),u.panes.forEach((d,h)=>{var m,g,w,C;!s&&!((m=d.plots)!=null&&m.length)&&!((g=d.labels)!=null&&g.length)&&!((w=d.levels)!=null&&w.length)&&!((C=d.lines)!=null&&C.length)&&e.push(`pane[${h}] has no plots/labels/levels/lines`)}),{ok:e.length===0,spec:u,errors:e}}const gJ=new Set(["line","histogram","area","cross","dots","stepped","step","bar","neon_line","bezier_line","glow_points","cloud","supertrend_cloud","aura","candleshadow"]),I5=n=>!n.interactionActive&&!n.overlayHover,_J=(n,e={})=>{const t=typeof e.pad=="number"?e.pad:6,s=typeof e.swatch=="number"?e.swatch:8,o=typeof e.gap=="number"?e.gap:6,r=typeof e.lineHeight=="number"?e.lineHeight:14;let a=0,l=0;for(const u of n){const d=Number.isFinite(u.width)?u.width:0,h=Number.isFinite(u.height)?u.height:r;a=Math.max(a,d),l+=Math.max(r,h)}const c=t*2+s+o+a,f=t*2+l;return{boxW:c,boxH:f,usedHeight:f+6,maxTextW:a,totalH:l}};function P2(n){return typeof n=="number"&&Number.isFinite(n)}function Q1(n,e,t){const s=n[t];if(P2(s))return s;const o=e[t];return P2(o)?o:NaN}function ey(n,e,t){const s=n[t];if(P2(s))return s;const o=e[t];return P2(o)?o:NaN}function P5(n,e,t,s){let o=-1,r=-1/0;for(let a=t;a<=s;a++){const l=Q1(n,e,a);Number.isFinite(l)&&l>r&&(r=l,o=a)}return o}function M5(n,e,t,s){let o=-1,r=1/0;for(let a=t;a<=s;a++){const l=ey(n,e,a);Number.isFinite(l)&&l<r&&(r=l,o=a)}return o}function W8(n,e,t,s,o){const r=Math.min(n.length,e.length,t.length);if(r<=1)return null;const a=Math.min(r-1,Math.max(0,Math.trunc(s))),l=Math.max(2,Math.trunc(o.lookback||200)),c=Math.max(0,a-l+1),f=o.direction==="down"?"down":"up";if((o.method==="pivots"?"pivots":"extremes")==="pivots"){const w=Math.max(1,Math.floor(Number(o.pivotLeft??3))),C=Math.max(1,Math.floor(Number(o.pivotRight??3))),P=a;if(P<C)return null;const I=[],A=[],M=Y=>{const ce=Q1(n,t,Y);if(!Number.isFinite(ce))return null;const Q=Math.max(0,Y-w),le=Math.min(P,Y+C);if(le<Y+C)return null;for(let ue=Q;ue<=le;ue++){if(ue===Y)continue;const fe=Q1(n,t,ue);if(!Number.isFinite(fe)||fe>=ce)return null}return ce},F=Y=>{const ce=ey(e,t,Y);if(!Number.isFinite(ce))return null;const Q=Math.max(0,Y-w),le=Math.min(P,Y+C);if(le<Y+C)return null;for(let ue=Q;ue<=le;ue++){if(ue===Y)continue;const fe=ey(e,t,ue);if(!Number.isFinite(fe)||fe<=ce)return null}return ce},B=Math.max(c,0),$=Math.min(a-C,a);for(let Y=B;Y<=$;Y++){const ce=M(Y);ce!=null&&I.push({index:Y,value:ce});const Q=F(Y);Q!=null&&A.push({index:Y,value:Q})}const L=I.length?I[I.length-1]:null,O=A.length?A[A.length-1]:null;if(!(!L||!O))if(f==="up"){let Y=null;for(let ce=A.length-1;ce>=0;ce--)if(A[ce].index<L.index){Y=A[ce];break}if(Y)return{fromIndex:Y.index,toIndex:L.index,fromValue:Y.value,toValue:L.value}}else{let Y=null;for(let ce=I.length-1;ce>=0;ce--)if(I[ce].index<O.index){Y=I[ce];break}if(Y)return{fromIndex:Y.index,toIndex:O.index,fromValue:Y.value,toValue:O.value}}}if(f==="up"){const w=P5(n,t,c,a);if(w<0)return null;const C=M5(e,t,c,w);if(C<0)return null;const P=ey(e,t,C),I=Q1(n,t,w);return[P,I].every(Number.isFinite)?{fromIndex:C,toIndex:w,fromValue:P,toValue:I}:null}const d=M5(e,t,c,a);if(d<0)return null;const h=P5(n,t,c,d);if(h<0)return null;const m=ey(e,t,d),g=Q1(n,t,h);return[m,g].every(Number.isFinite)?{fromIndex:h,toIndex:d,fromValue:g,toValue:m}:null}function yJ(n,e,t,s){const o=Math.min(n.length,e.length,t.length),r=new Array(o),a=new Array(o),l=new Array(o),c=new Array(o),f=new Array(o),u=new Array(o),d=new Array(o);for(let h=0;h<o;h++){const m=W8(n,e,t,h,s);if(!m){r[h]=void 0,a[h]=void 0,l[h]=void 0,c[h]=void 0,f[h]=void 0,u[h]=void 0,d[h]=void 0;continue}r[h]=m.fromValue,a[h]=m.toValue,l[h]=m.fromIndex,c[h]=m.toIndex,f[h]=m.fromValue,d[h]=m.toValue,u[h]=m.fromValue+(m.toValue-m.fromValue)*.5}return{from:r,to:a,fromIndex:l,toIndex:c,lvl0:f,lvl50:u,lvl100:d}}function bJ(n){const{seriesMap:e,calcDefs:t,len:s,params:o,lastPrevSource:r,resolveNum:a,onError:l}=n,c=o||{},f=(c==null?void 0:c.__pinev2)===1,u=d=>f?e1(d,{pineV2:!0}).expr:String(d??"");for(const d of t){const h=d.name||d.type;if(!h)continue;const m=String(h).replace(/\s+/g,"_").toLowerCase(),g=String(d.type||"").toLowerCase();if(g!=="security"){if(g==="sma"){const w=d.source||"close";e[m]=x_(e[w]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(g==="smma"){const w=d.source||"close";e[m]=L$(e[w]||e.close,Math.max(1,a(d.period,`${m}_period`,13)))}else if(g==="ema"){const w=d.source||"close";e[m]=n0(e[w]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(g==="wma"){const w=d.source||"close";e[m]=F$(e[w]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(g==="rsi"){const w=d.source||"close";e[m]=E$(e[w]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(g==="bbands"||g==="bollinger"||g==="bollinger_bands"){const w=d.source||"close",C=Math.max(1,a(d.period,`${m}_period`,20)),P=Math.max(.1,a(d.std,`${m}_std`,a(d.deviation,`${m}_deviation`,2))),{mid:I,upper:A,lower:M}=iw(e[w]||e.close,C,P);e[m+"_mid"]=I,e[m+"_upper"]=A,e[m+"_lower"]=M}else if(g==="atr"){const w=Math.max(1,a(d.period,`${m}_period`,14));e[m]=u2(e.high,e.low,e.close,w)}else if(g==="obv")e[m]=rS(e.close,e.volume);else if(g==="cci"){const w=Math.max(1,a(d.period,`${m}_period`,20));e[m]=aS(e.high,e.low,e.close,w)}else if(g==="mfi"){const w=Math.max(1,a(d.period,`${m}_period`,14));e[m]=lS(e.high,e.low,e.close,e.volume,w)}else if(g==="ao")e[m]=$$(e.high,e.low);else if(g==="trix"){const w=Math.max(1,a(d.period,`${m}_period`,12));e[m]=D$(e.close,w)}else if(g==="vwap")e[m]=Mk(e.close,e.volume);else if(g==="vwma"){const w=Math.max(1,a(d.period,`${m}_period`,20));e[m]=R$(e.close,e.volume,w)}else if(g==="macd"){const w=(d.source||"close").replace(/\s+/g,"_").toLowerCase(),C=Math.max(1,Number(d.fast)||12),P=Math.max(1,Number(d.slow)||26),I=Math.max(1,Number(d.signal)||9),A=e[w]||e.close,M=n0(A,C),F=n0(A,P),B=new Array(s);for(let Y=0;Y<s;Y++)B[Y]=M[Y]===void 0||F[Y]===void 0?void 0:M[Y]-F[Y];const $=n0(B,I),L=new Array(s),O=new Array(s);for(let Y=0;Y<s;Y++){const ce=B[Y],Q=$[Y];L[Y]=typeof Q=="number"&&Number.isFinite(Q)?Q:void 0,O[Y]=ce!==void 0&&Q!==void 0?ce-Q:void 0}e.macd_line=B,e.macd_signal=L,e.macd_hist=O}else if(g==="supertrend"){const w=Math.max(1,Number(d.period)||10),C=Math.max(.1,Number(d.factor)||3);e[m]=j$(e.high,e.low,e.close,w,C)}else if(g==="kc"||g==="keltner"){const w=Math.max(1,Number(d.period)||20),C=Math.max(.1,Number(d.mult)||2),P=B$(e.high,e.low,e.close,w,C);e[m+"_mid"]=P.mid,e[m+"_upper"]=P.upper,e[m+"_lower"]=P.lower}else if(g==="donchian"){const w=Math.max(1,Number(d.period)||20),C=O$(e.high,e.low,w);e[m+"_mid"]=C.mid,e[m+"_upper"]=C.upper,e[m+"_lower"]=C.lower}else if(g==="atr_bands"){const w=Math.max(1,Number(d.period)||14),C=Math.max(.1,Number(d.mult)||2),P=u2(e.high,e.low,e.close,w),I=new Array(s),A=new Array(s);for(let M=0;M<s;M++){const F=P[M],B=e.close[M];I[M]=F!=null&&B!=null?B+C*F:void 0,A[M]=F!=null&&B!=null?B-C*F:void 0}e[m+"_upper"]=I,e[m+"_lower"]=A}else if(g==="zscore"){const w=Math.max(1,Number(d.period)||20),C=d.source||"close";e[m]=cS(e[C]||e.close,w)}else if(g==="volume_delta")e[m]=Nk(e.close,e.volume);else if(g==="cum_delta"){const w=Nk(e.close,e.volume);e[m]=z$(w)}else if(g==="vwap_bands"){const w=Math.max(1,Number(d.period)||20),C=Mk(e.close,e.volume),{upper:P,lower:I}=iw(Array.from(C).map(A=>A),w,Math.max(.1,Number(d.std)||2));e[m+"_mid"]=Array.from(C),e[m+"_upper"]=P,e[m+"_lower"]=I}else if(g==="linreg_channel"){const w=Math.max(1,Number(d.period)||20),C=d.source||"close",P=V$(e[C]||e.close,w);e[m+"_mid"]=P.mid,e[m+"_upper"]=P.upper,e[m+"_lower"]=P.lower}else if(g==="evwma"){const w=Math.max(1,Number(d.period)||20);e[m]=uS(e.close,e.volume,w)}else if(g==="sar"){const w=Math.max(.001,Number(d.step)||.02),C=Math.max(w,Number(d.max)||.2),P=e.high,I=e.low,A=new Array(s);let M=w,F=P[0],B=I[0],$=!0;for(let L=1;L<s;L++){const O=P[L]??NaN,Y=I[L]??NaN;if(!Number.isFinite(O)||!Number.isFinite(Y)){A[L]=void 0;continue}let ce=B;$?(ce=B+M*(F-B),O>F&&(F=O,M=Math.min(C,M+w)),ce>Y&&($=!1,ce=F,F=Y,M=w)):(ce=B-M*(B-F),Y<F&&(F=Y,M=Math.min(C,M+w)),ce<O&&($=!0,ce=F,F=O,M=w)),A[L]=ce,B=ce}A[0]=B,e.sar=A}else if(g==="stoch"){const w=Number(d.kPeriod)||14,C=Number(d.dPeriod)||3,P=[],I=[];for(let M=0;M<s;M++){const F=Math.max(0,M-w+1);let B=-1/0,$=1/0;for(let ce=F;ce<=M;ce++){const Q=e.high[ce]??e.close[ce]??NaN,le=e.low[ce]??e.close[ce]??NaN;Q>B&&(B=Q),le<$&&($=le)}const L=e.close[M]??NaN,O=B-$,Y=O===0?void 0:100*((L-$)/O);P.push(Y)}const A=x_(P.map(M=>M??NaN),C);for(let M=0;M<s;M++)I.push(isNaN(A[M])?void 0:A[M]);e[m+"_k"]=P,e[m+"_d"]=I}else if(g==="roc"){const w=d.source||"close",C=e[w]||e.close,P=Math.max(1,Number(d.period)||10),I=new Array(s);for(let A=0;A<s;A++){const M=C[A],F=C[A-P];M===void 0||F===void 0||F===0?I[A]=void 0:I[A]=(M/F-1)*100}e[m]=I}else if(g==="ichimoku"){const w=Math.max(1,Number(d.tenkan)||9),C=Math.max(1,Number(d.kijun)||26),P=Math.max(1,Number(d.senkouB)||52),I=C,A=new Array(s),M=new Array(s),F=new Array(s),B=new Array(s),$=new Array(s),L=new Array(s),O=new Array(s),Y=e.high,ce=e.low,Q=e.close,le=(ue,fe)=>{let pe=-1/0,Z=1/0;const xe=Math.max(0,ue-fe+1);for(let oe=xe;oe<=ue;oe++){const Pe=Y[oe]??Q[oe]??NaN,$e=ce[oe]??Q[oe]??NaN;Pe>pe&&(pe=Pe),$e<Z&&(Z=$e)}return{hi:pe,lo:Z}};for(let ue=0;ue<s;ue++){if(ue>=w-1){const{hi:fe,lo:pe}=le(ue,w);A[ue]=(fe+pe)/2}if(ue>=C-1){const{hi:fe,lo:pe}=le(ue,C);M[ue]=(fe+pe)/2}if(A[ue]!==void 0&&M[ue]!==void 0&&(F[ue]=(A[ue]+M[ue])/2),ue>=P-1){const{hi:fe,lo:pe}=le(ue,P);B[ue]=(fe+pe)/2}O[ue]=ue+I<s?Q[ue+I]:void 0}for(let ue=0;ue<s;ue++)$[ue]=ue>=I?F[ue-I]:void 0,L[ue]=ue>=I?B[ue-I]:void 0;e.tenkan=A,e.kijun=M,e.spana=$,e.spanb=L,e.chikou=O}else if(g==="pivot_high"){const w=Math.max(0,Number(d.left)||3),C=Math.max(0,Number(d.right)||3),P=new Array(s);for(let I=0;I<s;I++){const A=e.high[I]??e.close[I]??NaN;if(!Number.isFinite(A)){P[I]=void 0;continue}let M=!0;const F=Math.max(0,I-w),B=Math.min(s-1,I+C);for(let $=F;$<=B;$++){if($===I)continue;const L=e.high[$]??e.close[$]??NaN;if(!Number.isFinite(L)){M=!1;break}if(L>=A){M=!1;break}}P[I]=M?A:void 0}e[m]=P}else if(g==="pivot_low"){const w=Math.max(0,Number(d.left)||3),C=Math.max(0,Number(d.right)||3),P=new Array(s);for(let I=0;I<s;I++){const A=e.low[I]??e.close[I]??NaN;if(!Number.isFinite(A)){P[I]=void 0;continue}let M=!0;const F=Math.max(0,I-w),B=Math.min(s-1,I+C);for(let $=F;$<=B;$++){if($===I)continue;const L=e.low[$]??e.close[$]??NaN;if(!Number.isFinite(L)){M=!1;break}if(L<=A){M=!1;break}}P[I]=M?A:void 0}e[m]=P}else if(g==="auto_fib"||g==="autofib"){const w=Math.max(2,Math.floor(a(d.lookback,`${m}_lookback`,200))),P=String(d.direction||"up").trim().toLowerCase()==="down"?"down":"up",I=String(d.method||d.mode||"extremes").trim().toLowerCase(),A=I==="pivots"||I==="pivot"||I==="swing"?"pivots":"extremes",M=Math.max(1,Math.floor(Number(d.pivotLeft??d.left??3))),F=Math.max(1,Math.floor(Number(d.pivotRight??d.right??3))),B=yJ(e.high,e.low,e.close,{lookback:w,direction:P,method:A,pivotLeft:M,pivotRight:F});e[`${m}_from`]=B.from,e[`${m}_to`]=B.to,e[`${m}_from_idx`]=B.fromIndex,e[`${m}_to_idx`]=B.toIndex,e[`${m}_0`]=B.lvl0,e[`${m}_50`]=B.lvl50,e[`${m}_100`]=B.lvl100}else if(g==="last_value"){const w=String(d.source||"close").replace(/\s+/g,"_").toLowerCase(),C=e[w]||e.close,P=new Array(s);let I;for(let A=0;A<s;A++){const M=C[A];M!=null&&Number.isFinite(M)&&(I=M),P[A]=I}e[m]=P,r[m]=w}else if(g==="prev_value"){const w=String(d.source||"close").replace(/\s+/g,"_").toLowerCase(),C=e[w]||e.close,P=new Array(s);let I,A;for(let M=0;M<s;M++){const F=C[M];if(F!=null&&Number.isFinite(F)){const B=F;(I===void 0||B!==I)&&(A=I,I=B)}P[M]=A}e[m]=P,r[m]=w}else if(g==="line_value"){const w=String(d.startValue||"").replace(/\s+/g,"_").toLowerCase(),C=String(d.endValue||"").replace(/\s+/g,"_").toLowerCase();let I=r[w]||r[C]||"";I||(/pl|low/i.test(w)||/pl|low/i.test(C)?I="pl":(/ph|high/i.test(w)||/ph|high/i.test(C))&&(I="ph"));const A=e[I],M=new Array(s);if(A){const F=[];for(let B=s-1;B>=0&&F.length<2;B--){const $=A[B];$!=null&&Number.isFinite($)&&F.push(B)}if(F.reverse(),F.length===2){const B=F[0],$=F[1],L=A[B],O=A[$];if(Number.isFinite(L)&&Number.isFinite(O)&&$!==B){const Y=(O-L)/($-B),ce=L-Y*B,Q=Math.max(1,Number(d.lookback)||s),le=Math.max(0,$-Q);for(let ue=0;ue<s;ue++)M[ue]=ue>=le?Y*ue+ce:void 0}}}e[m]=M}else if(g==="compare"){const w=String(d.left??"").trim(),C=String(d.right??"").trim(),P=String(d.op||">"),I=/^[-+]?\d+(?:\.\d+)?$/.test(w),A=/^[-+]?\d+(?:\.\d+)?$/.test(C),M=w.replace(/\s+/g,"_").toLowerCase(),F=C.replace(/\s+/g,"_").toLowerCase(),B=I?null:e[M]||e.close,$=A?null:e[F]||e.close,L=I?Number(w):NaN,O=A?Number(C):NaN,Y=new Array(s);for(let ce=0;ce<s;ce++){const Q=I?L:(B==null?void 0:B[ce])??NaN,le=A?O:($==null?void 0:$[ce])??NaN;if(!Number.isFinite(Q)||!Number.isFinite(le)){Y[ce]=0;continue}let ue=!1;switch(P){case">":ue=Q>le;break;case"<":ue=Q<le;break;case">=":ue=Q>=le;break;case"<=":ue=Q<=le;break;case"==":ue=Math.abs(Q-le)<1e-9;break;default:ue=Q>le;break}Y[ce]=ue?1:0}e[m]=Y}else if(typeof d.expr=="string"&&String(d.expr).trim().length)try{const w={};Object.entries(e).forEach(([A,M])=>{const F=new Float32Array(s);for(let B=0;B<s;B++)F[B]=M[B]??NaN;w[A.replace(/\s+/g,"_").toLowerCase()]=F});const C=__([{name:m,expr:u(String(d.expr).replace(/\$\{([^}]+)\}/g,(A,M)=>String(c[M]??A)))}],w,c),P=new Array(s),I=C[m];for(let A=0;A<s;A++){const M=I==null?void 0:I[A];P[A]=Number.isFinite(M)?M:void 0}e[m]=P}catch(w){if(l){const C=(w==null?void 0:w.message)!=null?String(w.message):String(w);l(`Expression error: ${C}`,w)}}}}}const H8=n=>/[A-Za-z_$]/.test(n),K_=n=>/[A-Za-z0-9_$]/.test(n),xJ=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?/,wJ=/[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,N5=(n,e)=>{let t=e;for(;t>=0&&/\s/.test(n[t]);)t-=1;return t},A5=(n,e)=>{let t=e;for(;t<n.length&&/\s/.test(n[t]);)t+=1;return t},kJ=(n,e)=>{let t=1;for(let s=e-1;s>=0;s-=1){const o=n[s];if(o===")")t+=1;else if(o==="("&&(t-=1,t===0))return s}return-1},T5=(n,e)=>{let t=1;for(let s=e+1;s<n.length;s+=1){const o=n[s];if(o==="(")t+=1;else if(o===")"&&(t-=1,t===0))return s}return-1},SJ=(n,e)=>{const t=N5(n,e-1);if(t<0)return null;const s=t+1,o=n[t];if(o===")"){const a=kJ(n,t);if(a<0)return null;let l=a,c=N5(n,l-1);if(c>=0&&K_(n[c])){let f=c;for(;f>=0&&K_(n[f]);)f-=1;l=f+1}return{start:l,end:s}}if(K_(o)){let a=t;for(;a-1>=0&&K_(n[a-1]);)a-=1;return{start:a,end:s}}const r=wJ.exec(n.slice(0,s));return r?{start:s-r[0].length,end:s}:null},CJ=(n,e)=>{let t=A5(n,e);if(t>=n.length)return null;const s=n[t];if(s==="("){const r=T5(n,t);return r<0?null:{start:t,end:r+1}}if(H8(s)){let r=t+1;for(;r<n.length&&K_(n[r]);)r+=1;const a=A5(n,r);if(n[a]==="("){const l=T5(n,a);return l<0?null:{start:t,end:l+1}}return{start:t,end:r}}const o=xJ.exec(n.slice(t));return o?{start:t,end:t+o[0].length}:null};function t2(n){const e=String(n||""),t=e.length;if(!/crosses/i.test(e))return e;const s=[];let o=null,r=0;for(;r<t;){const c=e[r];if(o){c===o&&e[r-1]!=="\\"&&(o=null),r+=1;continue}if(c==="'"||c==='"'){o=c,r+=1;continue}if(H8(c)){let f=r+1;for(;f<t&&K_(e[f]);)f+=1;const d=e.slice(r,f).toLowerCase();if(d==="crossesabove"||d==="crossesbelow"){const h=SJ(e,r),m=CJ(e,f);if(h&&m){s.push({start:h.start,end:m.end,left:h,right:m,fn:d==="crossesabove"?"crossover":"crossunder"}),r=m.end;continue}}r=f;continue}r+=1}if(!s.length)return e;let a="",l=0;for(const c of s){a+=e.slice(l,c.start);const f=e.slice(c.left.start,c.left.end).trim(),u=e.slice(c.right.start,c.right.end).trim();a+=`${c.fn}(${f}, ${u})`,l=c.end}return a+=e.slice(l),a}function IJ(n){console.error("[ScriptStudio]",n)}function Nw(n,e){const t=o=>o.replace(/\$\{([^}]+)\}/g,(r,a)=>{const l=String(a),c=e[l];if(c==null)return r;if(typeof c=="number"&&Number.isFinite(c))return String(c);if(typeof c=="string")return c;try{return JSON.stringify(c)}catch{return String(c)}}),s=o=>{if(o==null)return o;if(typeof o=="string"){const r=o.match(/^\$\{([^}]+)\}$/);if(r){const a=String(r[1]),l=e[a];return l??o}return t(o)}if(Array.isArray(o))return o.map(s);if(typeof o=="object"){const r=Array.isArray(o)?[]:{};return Object.keys(o).forEach(a=>{const l=o[a];r[a]=s(l)}),r}return o};return s(n)}const F5=512;function PJ(n,e){const t=n.match(/^\$\{([^}]+)\}$/);if(t){const s=String(t[1]||"");if(Object.prototype.hasOwnProperty.call(e,s))return e[s]}return n.replace(/\$\{([^}]+)\}/g,(s,o)=>{const r=String(o||"");if(!Object.prototype.hasOwnProperty.call(e,r))return s;const a=e[r];return typeof a=="string"?a:String(a)})}function Aw(n,e){if(n==null)return n;if(typeof n=="string")return PJ(n,e);if(Array.isArray(n))return n.map(t=>Aw(t,e));if(typeof n=="object"){const t={};return Object.keys(n).forEach(s=>{t[s]=Aw(n[s],e)}),t}return n}function Tw(n){let e=0;const t=r=>{if(e+=r,e>F5)throw new Error(`Loop expansion exceeds ${F5} items`)},s=(r,a)=>{const l=r==null?void 0:r.repeat,c=r==null?void 0:r.forEach,f=r==null?void 0:r.template;if(!f||!l&&!c)return[];const u=[],d=m=>{const g=Aw(f,m),w=o(g,m);Array.isArray(w)?u.push(...w):u.push(w)},h=(m,g,w)=>{m.forEach((C,P)=>{const I={...a,[g]:C};w&&(I[w]=P),t(1),d(I)})};if(c&&typeof c=="object"){if(!Array.isArray(c.items))throw new Error("forEach.items must be an array");const m=String(c.var||"item"),g=c.indexVar?String(c.indexVar):void 0;return h(c.items,m,g),u}if(l&&typeof l=="object"){const m=String(l.var||"i"),g=l.indexVar?String(l.indexVar):void 0;if(Array.isArray(l.items))return h(l.items,m,g),u;if(l.count!=null){const P=Number(l.count);if(!Number.isFinite(P))throw new Error("repeat.count must be a number");const I=Math.max(0,Math.floor(P)),A=new Array(I).fill(0).map((M,F)=>F);return h(A,m,g),u}const w=Number(l.from),C=Number(l.to);if(Number.isFinite(w)&&Number.isFinite(C)){const P=l.step!=null?Number(l.step):w<=C?1:-1;if(!Number.isFinite(P))throw new Error("repeat.step must be a number");const I=P===0?w<=C?1:-1:P,A=[];if(I>0)for(let M=w;M<=C;M+=I)A.push(M);else for(let M=w;M>=C;M+=I)A.push(M);return h(A,m,g),u}throw new Error("repeat requires count or from/to")}return u},o=(r,a)=>{if(r==null)return r;if(Array.isArray(r)){const l=[];return r.forEach(c=>{if(c&&typeof c=="object"&&!Array.isArray(c)&&(c.repeat||c.forEach)){if(!c.template)throw new Error("Loop directive requires template");l.push(...s(c,a))}else l.push(o(c,a))}),l}if(typeof r=="object"){const l={};return Object.keys(r).forEach(c=>{l[c]=o(r[c],a)}),l}return r};return o(n,{})}function V2(n,e,t){if(n.save(),e&&(n.beginPath(),n.rect(e.left,e.top,e.width,e.height),n.clip()),t)try{t()}finally{n.restore()}}function L5(n,e,t,s,o,r){if(!e.length)return;const a=Math.max(1,s/2);V2(n,o,()=>{if(n.save(),!!(r&&(r.from||r.to))){let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;for(const P of e)!Number.isFinite(P.x)||!Number.isFinite(P.y)||(P.x<c&&(c=P.x),P.x>f&&(f=P.x),P.y<u&&(u=P.y),P.y>d&&(d=P.y));const h=Number.isFinite(c)?c:o?o.left:0,m=Number.isFinite(f)&&f!==c?f:h+1,g=Number.isFinite(u)?u:o?o.top:0,w=Number.isFinite(d)&&d!==u?d:g+1,C=ah(n,{minX:h,maxX:m,minY:g,maxY:w},r,t);n.fillStyle=C??t}else n.fillStyle=t;for(let c=0;c<e.length;c++){const{x:f,y:u}=e[c];!Number.isFinite(f)||!Number.isFinite(u)||(n.beginPath(),n.arc(f,u,a,0,Math.PI*2),n.fill())}n.restore()})}function MJ(n,e,t,s,o,r,a,l){e.length&&V2(n,l,()=>{const c=Number.isFinite(t)?t:l?l.top+l.height:0,f=(h,m)=>{if(h<0||m<h)return;n.beginPath();let g=!1,w=null,C=null,P=0,I=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,M=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY;for(let $=h;$<=m;$++){const L=e[$];!Number.isFinite(L.x)||!Number.isFinite(L.y)||(g?n.lineTo(L.x,L.y):(n.moveTo(L.x,L.y),g=!0,w=L),C=L,P+=1,L.x<I&&(I=L.x),L.x>A&&(A=L.x),L.y<M&&(M=L.y),L.y>F&&(F=L.y))}if(!g||P<2||!w||!C)return;if(n.lineTo(C.x,c),n.lineTo(w.x,c),n.closePath(),n.save(),!!(o&&(o.from||o.to))){const $=Number.isFinite(I)?I:l?l.left:0,L=Number.isFinite(A)&&A!==I?A:$+1,O=Number.isFinite(M)?Math.min(M,c):c,Y=Number.isFinite(F)?Math.max(F,c):c+1,ce=ah(n,{minX:$,maxX:L,minY:Number.isFinite(O)?O:0,maxY:Number.isFinite(Y)&&Y!==O?Y:Number.isFinite(O)?O+1:1},o,s);n.fillStyle=ce??s}else n.fillStyle=s;n.fill(),n.restore(),r&&a>0};let u=-1,d=-1;for(let h=0;h<e.length;h++){const m=e[h];Number.isFinite(m.x)&&Number.isFinite(m.y)?(u===-1&&(u=h),d=h):u!==-1&&(f(u,d),u=-1,d=-1)}u!==-1&&f(u,d)})}function NJ(n,e,t,s,o,r){e.length&&V2(n,o,()=>{if(n.beginPath(),!!(r&&(r.from||r.to))){let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;for(const P of e)!Number.isFinite(P.x)||!Number.isFinite(P.y)||(P.x<c&&(c=P.x),P.x>f&&(f=P.x),P.y<u&&(u=P.y),P.y>d&&(d=P.y));const h=Number.isFinite(c)?c:o?o.left:0,m=Number.isFinite(f)&&f!==c?f:h+1,g=Number.isFinite(u)?u:o?o.top:0,w=Number.isFinite(d)&&d!==u?d:g+1,C=ah(n,{minX:h,maxX:m,minY:g,maxY:w},r,t);n.strokeStyle=C??t}else n.strokeStyle=t;let l=!1;for(let c=0;c<e.length-1;c++){const f=e[c],u=e[c+1];!Number.isFinite(f.x)||!Number.isFinite(f.y)||!Number.isFinite(u.x)||!Number.isFinite(u.y)||(l||(n.moveTo(f.x,f.y),l=!0),n.lineTo(u.x,f.y),n.lineTo(u.x,u.y))}l&&(n.lineWidth=s,n.setLineDash([]),n.stroke())})}function Ex(n,e,t,s,o){!e.length||!t.length||V2(n,o,()=>{var a,l;n.beginPath();let r=0;for(;r<e.length&&!(Number.isFinite((a=e[r])==null?void 0:a.x)&&Number.isFinite((l=e[r])==null?void 0:l.y));)r++;if(!(r>=e.length)){for(n.moveTo(e[r].x,e[r].y);r<e.length;r++){const c=e[r];!Number.isFinite(c==null?void 0:c.x)||!Number.isFinite(c==null?void 0:c.y)||n.lineTo(c.x,c.y)}for(let c=t.length-1;c>=0;c--){const f=t[c];!Number.isFinite(f==null?void 0:f.x)||!Number.isFinite(f==null?void 0:f.y)||n.lineTo(f.x,f.y)}n.closePath(),n.save(),n.fillStyle=s,n.fill(),n.restore()}})}class q8{constructor(e){Te(this,"storage");Te(this,"runtime",null);Te(this,"events",{});Te(this,"state");Te(this,"symbolChangeCallbacks",new Set);Te(this,"currentSymbol",null);this.storage=e||YH,this.state=$m({activeSaveId:null,savedLayouts:[],isLoading:!1,lastError:null,initialized:!1}),this.initialize()}async initialize(){try{this.updateState({isLoading:!0});const[e,t]=await Promise.all([this.storage.getActiveSaveId(),this.storage.listSavedLayouts()]);this.updateState({activeSaveId:e,savedLayouts:t,isLoading:!1,lastError:null})}catch(e){console.error("Failed to initialize SaveManager:",e),this.updateState({isLoading:!1,lastError:"Failed to initialize save system"})}}setRuntimeContracts(e){this.runtime=e,this.runtime.onSymbolChange(this.handleSymbolChange.bind(this)),this.currentSymbol=this.runtime.getCurrentSymbol(),this.updateState({initialized:!0}),console.log("✅ SaveManager fully initialized and ready")}setEventHandlers(e){this.events={...this.events,...e}}async handleSymbolChange(e){this.currentSymbol,this.currentSymbol=e;const t=this.getState();if(t.activeSaveId&&this.runtime)try{const s=await this.storage.getSavedLayout(t.activeSaveId);if(s){this.runtime.clearAllDrawings();const o=s.drawingsBySymbol[e]||[];this.runtime.renderDrawings(o)}}catch(s){console.error("Failed to reload drawings for symbol change:",s)}this.symbolChangeCallbacks.forEach(s=>{try{s(e)}catch(o){console.error("Symbol change callback error:",o)}})}onSymbolChange(e){this.symbolChangeCallbacks.add(e)}offSymbolChange(e){this.symbolChangeCallbacks.delete(e)}updateState(e){this.state.update(t=>({...t,...e}))}getState(){let e;return this.state.subscribe(t=>e=t)(),e}validateSaveName(e,t){return!e||e.trim().length===0?{valid:!1,error:"Name is required"}:e.length>100?{valid:!1,error:"Name must be 100 characters or less"}:this.getState().savedLayouts.some(r=>r.name===e&&r.id!==t)?{valid:!1,error:"Name already exists"}:{valid:!0}}async collectCurrentState(){if(!this.runtime)throw new Error("Runtime contracts not set");try{const e=this.runtime.getCurrentSymbol(),t=this.runtime.collectGlobalState(),s=this.runtime.collectDrawings(e);return{global:t,drawings:s,symbol:e}}catch(e){return console.error("Failed to collect chart state:",e),null}}async save(e){var t,s,o,r;try{this.updateState({isLoading:!0,lastError:null});const a=this.validateSaveName(e);if(!a.valid)return this.updateState({isLoading:!1,lastError:a.error}),{success:!1,error:a.error};const l=await this.collectCurrentState();if(!l)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const c={name:e,timezone:l.global.timezone,interval:l.global.interval,chartType:l.global.chartType,theme:l.global.theme,panes:l.global.panes,indicators:l.global.indicators,styles:l.global.styles,options:l.global.options,drawingsBySymbol:{[l.symbol]:l.drawings}},f=await this.storage.createSavedLayout(c);await this.storage.setActiveSaveId(f.id);const u=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:f.id,savedLayouts:u,isLoading:!1}),(s=(t=this.events).onSaved)==null||s.call(t,f),{success:!0,layout:f}}catch(a){console.error("Save failed:",a);const l=a instanceof Error?a.message:"Save failed";return this.updateState({isLoading:!1,lastError:l}),(r=(o=this.events).onError)==null||r.call(o,l),{success:!1,error:l}}}async quickSave(){var t,s,o,r;const e=this.getState();if(!e.activeSaveId)return this.updateState({isLoading:!1,lastError:"No active save to update"}),{success:!1,error:"No active save to update"};try{this.updateState({isLoading:!0,lastError:null});const a=await this.storage.getSavedLayout(e.activeSaveId);if(!a)return this.updateState({isLoading:!1,lastError:"Active save not found"}),{success:!1,error:"Active save not found"};const l=await this.collectCurrentState();if(!l)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const c={timezone:l.global.timezone,interval:l.global.interval,chartType:l.global.chartType,theme:l.global.theme,panes:l.global.panes,indicators:l.global.indicators,styles:l.global.styles,options:l.global.options,drawingsBySymbol:{...a.drawingsBySymbol,[l.symbol]:l.drawings}},f=await this.storage.updateSavedLayout(e.activeSaveId,c),u=await this.storage.listSavedLayouts();return this.updateState({savedLayouts:u,isLoading:!1}),(s=(t=this.events).onSaved)==null||s.call(t,f),{success:!0,layout:f}}catch(a){console.error("Quick save failed:",a);const l=a instanceof Error?a.message:"Quick save failed";return this.updateState({isLoading:!1,lastError:l}),(r=(o=this.events).onError)==null||r.call(o,l),{success:!1,error:l}}}async saveTo(e){var t,s,o,r,a,l;try{this.updateState({isLoading:!0,lastError:null});const c=await this.collectCurrentState();if(!c)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const f=await this.storage.getSavedLayout(e),u={timezone:c.global.timezone,interval:c.global.interval,chartType:c.global.chartType,theme:c.global.theme,panes:c.global.panes,indicators:c.global.indicators,styles:c.global.styles,options:c.global.options,drawingsBySymbol:f?{...f.drawingsBySymbol,[c.symbol]:c.drawings}:{[c.symbol]:c.drawings}};if(!f){console.log("📝 Layout not found locally, creating new layout via API");const m={name:`Layout ${new Date().toLocaleString()}`,...u},g=await this.storage.createSavedLayout(m);await this.storage.setActiveSaveId(g.id);const w=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:g.id,savedLayouts:w,isLoading:!1}),(s=(t=this.events).onSaved)==null||s.call(t,g),{success:!0,layout:g}}const d=await this.storage.updateSavedLayout(e,u);await this.storage.setActiveSaveId(e);const h=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:e,savedLayouts:h,isLoading:!1}),(r=(o=this.events).onSaved)==null||r.call(o,d),{success:!0,layout:d}}catch(c){console.error("Save to existing failed:",c);const f=c instanceof Error?c.message:"Save failed";return this.updateState({isLoading:!1,lastError:f}),(l=(a=this.events).onError)==null||l.call(a,f),{success:!1,error:f}}}async saveAs(e){return this.save(e)}async load(e){var t,s,o,r,a,l,c,f,u,d,h,m;try{this.updateState({isLoading:!0,lastError:null}),console.log("🔄 Loading layout:",e);const g=await this.storage.getSavedLayout(e);if(!g)try{await this.refresh();const P=await this.storage.getSavedLayout(e);if(!P){const F=await this.storage.listSavedLayouts();if(F&&F.length>0){const B=F[0].id,$=await this.storage.getSavedLayout(B);if($){if(!this.runtime)return this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};await this.runtime.applyGlobalState({timezone:$.timezone,interval:$.interval,chartType:$.chartType,theme:$.theme,panes:$.panes,indicators:$.indicators,styles:$.styles,options:$.options});const L=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const O=$.drawingsBySymbol[L]||[];return this.runtime.renderDrawings(O),await this.storage.setActiveSaveId($.id),this.updateState({activeSaveId:$.id,isLoading:!1}),(s=(t=this.events).onLoaded)==null||s.call(t,$),{success:!0}}}return await this.storage.setActiveSaveId(null),this.updateState({isLoading:!1,lastError:"Layout not found"}),{success:!1,error:"Layout not found"}}const I=P;if(!this.runtime)return this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};await this.runtime.applyGlobalState({timezone:I.timezone,interval:I.interval,chartType:I.chartType,theme:I.theme,panes:I.panes,indicators:I.indicators,styles:I.styles,options:I.options});const A=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const M=I.drawingsBySymbol[A]||[];return this.runtime.renderDrawings(M),await this.storage.setActiveSaveId(I.id),this.updateState({activeSaveId:I.id,isLoading:!1}),(r=(o=this.events).onLoaded)==null||r.call(o,I),{success:!0}}catch{return await this.storage.setActiveSaveId(null),this.updateState({isLoading:!1,lastError:"Layout not found"}),{success:!1,error:"Layout not found"}}if(console.log("📊 Layout data loaded:",{name:g.name,indicatorCount:((a=g.indicators)==null?void 0:a.length)||0,indicators:((l=g.indicators)==null?void 0:l.map(P=>P.type))||[]}),!this.runtime)return console.error("❌ Runtime contracts not set"),this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};console.log("🔧 Applying global state with indicators:",((c=g.indicators)==null?void 0:c.length)||0),await this.runtime.applyGlobalState({timezone:g.timezone,interval:g.interval,chartType:g.chartType,theme:g.theme,panes:g.panes,indicators:g.indicators,styles:g.styles,options:g.options});const w=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const C=g.drawingsBySymbol[w]||[];return this.runtime.renderDrawings(C),await this.storage.setActiveSaveId(g.id),this.updateState({activeSaveId:g.id,isLoading:!1}),(u=(f=this.events).onLoaded)==null||u.call(f,g),console.log("✅ Layout loaded successfully:",{layoutId:g.id,name:g.name,indicatorsRestored:((d=g.indicators)==null?void 0:d.length)||0}),{success:!0}}catch(g){console.error("Load failed:",g);const w=g instanceof Error?g.message:"Load failed";return this.updateState({isLoading:!1,lastError:w}),(m=(h=this.events).onError)==null||m.call(h,w),{success:!1,error:w}}}async delete(e){var t,s,o,r;try{this.updateState({isLoading:!0,lastError:null}),await this.storage.deleteSavedLayout(e);const[a,l]=await Promise.all([this.storage.getActiveSaveId(),this.storage.listSavedLayouts()]);return this.updateState({activeSaveId:a,savedLayouts:l,isLoading:!1}),(s=(t=this.events).onDeleted)==null||s.call(t,e),{success:!0}}catch(a){console.error("Delete failed:",a);const l=a instanceof Error?a.message:"Delete failed";return this.updateState({isLoading:!1,lastError:l}),(r=(o=this.events).onError)==null||r.call(o,l),{success:!1,error:l}}}hasActiveSave(){return this.getState().activeSaveId!==null}getActiveSaveId(){return this.getState().activeSaveId}async clearActiveSave(){await this.storage.setActiveSaveId(null),this.updateState({activeSaveId:null})}async refresh(){try{this.updateState({isLoading:!0});const e=await this.storage.listSavedLayouts();this.updateState({savedLayouts:e,isLoading:!1,lastError:null})}catch(e){console.error("Refresh failed:",e),this.updateState({isLoading:!1,lastError:"Failed to refresh layouts"})}}destroy(){this.runtime&&this.symbolChangeCallbacks.clear()}}new q8;const $x="https://noti.dutyai.app/auth/chart/settings";class AJ{constructor(){Te(this,"localStorageProvider");Te(this,"initialized",!1);this.localStorageProvider=new O8}async initialize(){this.initialized||(await this.localStorageProvider.initialize(),this.initialized=!0)}hasUserId(){return!!zg()}getUserId(){return zg()}async saveToApi(e){const t=this.getUserId();if(!t)throw new Error("User ID not found in localStorage");if(e._source==="api"&&!e._isModified)return console.log("🔄 Skipping API save for unmodified API-loaded data"),{...e,_source:"api"};try{console.log(e,"layoutData");const s=e.id||this.generateApiId(),o={clerkId:t,settings:e,id:s};console.log("🌐 Sending to API:",o);const r=await fetch($x,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){const l=await r.text();throw console.error("API error response:",l),new Error(`API request failed: ${r.status} ${r.statusText} - ${l}`)}const a=await r.json();return console.log("✅ API save successful:",a),{...e,id:a.id||s,createdAt:a.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(s){throw console.error("API save failed:",s),new Error("Failed to save to API")}}generateApiId(){return`api_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async loadFromApi(){var t;const e=this.getUserId();if(!e)throw new Error("User ID not found in localStorage");try{const s=`${$x}/${e}`;console.log("🌐 API Request:",s);const o=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("🌐 API Response Status:",o.status,o.statusText),!o.ok)throw new Error(`API request failed: ${o.status} ${o.statusText}`);const r=await o.json();return console.log("🌐 API Response Data:",r),Array.isArray(r)?r.map(a=>{var l;return{id:a.id,name:((l=a.settings)==null?void 0:l.name)||"Untitled Layout",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...a.settings,_source:"api"}}):[{id:r.id,name:((t=r.settings)==null?void 0:t.name)||"Untitled Layout",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...r.settings,_source:"api"}]}catch(s){throw console.error("API load failed:",s),new Error("Failed to load from API")}}async deleteFromApi(e){if(!this.getUserId())throw new Error("User ID not found in localStorage");try{const s=`${$x}/${e}`;console.log("🌐 API Delete Request:",s);const o=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("🌐 API Delete Response Status:",o.status,o.statusText),!o.ok)throw new Error(`API delete request failed: ${o.status} ${o.statusText}`);console.log("✅ Layout deleted successfully from API")}catch(s){throw console.error("API delete failed:",s),new Error("Failed to delete from API")}}async listSavedLayouts(){if(await this.initialize(),this.hasUserId())try{return console.log("🌐 Loading layouts from API (userId found)"),(await this.loadFromApi()).map(t=>({id:t.id,name:t.name||"Untitled Layout",createdAt:t.createdAt||new Date().toISOString(),updatedAt:t.updatedAt||new Date().toISOString()}))}catch(e){console.error("API load failed, falling back to localStorage:",e)}return console.log("💾 Loading layouts from localStorage (no userId or API failed)"),this.localStorageProvider.listSavedLayouts()}async getSavedLayout(e){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Loading specific layout from API");const s=(await this.loadFromApi()).find(o=>o.id===e);if(s)return s;console.log("📖 Layout not found in API response, falling back to localStorage")}catch(t){console.error("API load failed, falling back to localStorage:",t)}return this.localStorageProvider.getSavedLayout(e)}async createSavedLayout(e){if(await this.initialize(),this.hasUserId())try{return console.log("🌐 Saving to API (userId found)"),await this.saveToApi(e)}catch(t){console.error("API save failed, falling back to localStorage:",t)}return console.log("💾 Saving to localStorage (no userId or API failed)"),this.localStorageProvider.createSavedLayout(e)}async updateSavedLayout(e,t){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Updating via API (userId found)");try{const a=(await this.loadFromApi()).find(l=>l.id===e);if(a){console.log("📝 Layout found in API, updating via API");const l={...a,...t,_isModified:!0};return await this.saveToApi(l)}}catch(r){console.log("📖 Layout not found in API, checking localStorage:",r)}const s=await this.localStorageProvider.getSavedLayout(e);if(s){console.log("📝 Layout found in localStorage, updating via API");const r={...s,...t};return await this.saveToApi(r)}console.log("📝 Layout not found, creating new via API");const o={id:e,...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),_isModified:!0};return await this.saveToApi(o)}catch(s){console.error("API update failed, falling back to localStorage:",s)}return console.log("💾 Updating in localStorage"),this.localStorageProvider.updateSavedLayout(e,t)}async deleteSavedLayout(e){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Deleting layout from API"),await this.deleteFromApi(e),console.log("✅ Layout deleted from API successfully");return}catch(t){console.error("API delete failed, falling back to localStorage:",t)}return console.log("💾 Deleting from localStorage"),this.localStorageProvider.deleteSavedLayout(e)}async getActiveSaveId(){return await this.initialize(),this.localStorageProvider.getActiveSaveId()}async setActiveSaveId(e){return await this.initialize(),this.localStorageProvider.setActiveSaveId(e)}async cleanup(){return await this.initialize(),this.localStorageProvider.cleanup()}}function TJ(n,e){Ed(e,!1);const t=sm(),s=()=>wl(r,"$save",t),o=()=>wl(a,"$chart",t),r=gd("save");gd("ctx");const a=gd("chart"),l=gd("drawingManager"),c=(()=>{try{return gd("saveRestoring")||null}catch{return null}})(),f=new AJ,u=new q8(f);let d=null,h=null;function m(){try{console.log("🧹 Clearing persisted chart cache to prevent showing unsaved changes...");const C=s(),P=C!=null&&C.key&&typeof C.key=="string"?C.key:"chart";if(typeof localStorage<"u"){const I=localStorage.getItem(P);if(I)try{const F=JSON.parse(I),B={key:F.key||P,theme:F.theme||"dark",symbol:F.symbol||"BINANCE:BTCUSDT",period:F.period||{timeframe:"1d",timespan:"day"}};localStorage.setItem(P,JSON.stringify(B)),console.log("✅ Cleared unsaved chart changes, kept basic settings")}catch(F){console.warn("⚠️ Could not parse stored chart, clearing completely:",F),localStorage.removeItem(P)}const A=`${P}_drawings`,M=`${P}_overlays`;localStorage.removeItem(A),localStorage.removeItem(M),localStorage.removeItem("dataSpaceOverlays"),console.log("✅ Persisted chart cache cleared successfully")}try{r.update(I=>{var F,B,$,L;const A=((B=(F=I.styles)==null?void 0:F.candle)==null?void 0:B.type)||"candle_solid",M=((L=($=I.styles)==null?void 0:$.candle)==null?void 0:L.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};return I.styles={candle:{type:A,renko:M}},I.options={},I.saveInds={},I})}catch(I){console.warn("⚠️ Failed to clear in‑memory save styles/options:",I)}}catch(C){console.error("❌ Error clearing persisted chart cache:",C)}}Th(async()=>{if(o())g(o());else{const C=a.subscribe(P=>{P&&(C(),g(P))})}});async function g(C){var P,I;try{let A=0;const M=20;for(;!l.get()&&A<M;)await new Promise($=>setTimeout($,100)),A+=1;const F=l.get();F?console.log("✅ DrawingManager is available for save system"):console.error("❌ DrawingManager not available after waiting");const B={getCurrentSymbol:()=>l5(s()),collectGlobalState:()=>EB(s(),C),collectDrawings:$=>{if(!F)return console.warn("⚠️ DrawingManager not available, returning empty drawings"),[];const L=F.getDrawingsForSymbol($);return console.log(`📥 Collected ${L.length} drawings for symbol:`,$),L},applyGlobalState:async $=>await $B($,r,C),clearAllDrawings:()=>{var $,L;F?F.hideRenderedDrawings():console.warn("⚠️ DrawingManager not available, cannot clear drawings");try{const O=(($=C==null?void 0:C.getOverlays)==null?void 0:$.call(C,{groupId:"drawing_tools"}))||[];for(const Y of O)try{(L=C==null?void 0:C.removeOverlay)==null||L.call(C,{id:Y.id})}catch{}console.log("🗑️ Cleared chart overlays for drawing_tools group")}catch{}},renderDrawings:$=>{if(!F){console.warn("⚠️ DrawingManager not available, cannot render drawings");return}const L=l5(s());console.log(`🎨 Rendering ${$.length} drawings for symbol:`,L),F.setCurrentSymbol(L),F.loadDrawingsForSymbol(L,$)},onSymbolChange:$=>{h=_p(r,O=>j0(O.symbol)).subscribe(O=>{d!==null&&d!==O&&(console.log("🔄 Save system detected symbol change:",d,"->",O),$(O)),d=O})},offSymbolChange:$=>{h&&(h(),h=null)}};u.setRuntimeContracts(B),u.setEventHandlers({onSaved:()=>{try{_x()}catch{}},onLoaded:()=>{try{_x()}catch{}}}),typeof window<"u"&&(window.saveManager=u,window.forceRefreshChart=async()=>{console.log("🔄 Force refresh triggered from WebView parent"),await w()},window.clearChartCache=()=>{var $;console.log("🗑️ Clearing chart cache");try{const L=($=s())!=null&&$.key&&typeof s().key=="string"?s().key:"chart";localStorage.removeItem(L);const O=`${L}_drawings`;localStorage.removeItem(O);const Y=`${L}_overlays`;localStorage.removeItem(Y),localStorage.removeItem("dataSpaceOverlays"),console.log("✅ Chart cache cleared")}catch(L){console.error("❌ Error clearing cache:",L)}});try{u.getActiveSaveId()&&(c==null||c.set(!0))}catch{}m();try{const $=(P=s())!=null&&P.key&&typeof s().key=="string"?s().key:"chart";(typeof localStorage<"u"?localStorage.getItem(`${$}.lastTimeframe`):null)||typeof localStorage<"u"&&localStorage.setItem(`${$}.lastTimeframe`,"1d")}catch{}await w();try{const $=(I=s())!=null&&I.key&&typeof s().key=="string"?s().key:"chart",L=typeof localStorage<"u"?localStorage.getItem(`${$}.lastTimeframe`):null;if(L&&typeof L=="string"&&L.length>0){const O=L.slice(-1),Y=parseInt(L.slice(0,-1))||1,ce=O==="M"?"month":O==="w"?"week":O==="d"?"day":O==="h"?"hour":O==="m"?"minute":O==="s"?"second":"day",Q=gp(L);r.update(le=>(le.period={multiplier:Y,timespan:ce,timeframe:L,secs:Q},le))}}catch{}try{_x()}catch{}try{c==null||c.set(!1)}catch{}console.log("✅ Save system initialized successfully")}catch(A){console.error("❌ Failed to initialize save system:",A)}}async function w(){try{console.log("🔍 Starting automatic restoration process (WebView-safe)...");let C=null;try{C=zg()}catch{}if(C){console.log("🌐 User logged in, refreshing saved layouts from server...");try{await u.refresh(),console.log("✅ Saved layouts refreshed from server")}catch(M){console.warn("⚠️ Could not refresh saved layouts from server:",M)}}const P=u.getActiveSaveId();if(console.log("🔍 Active save ID found:",P),P){console.log("🔄 Restoring active saved data:",P);const M=await u.load(P);if(M.success){console.log("✅ Active saved data restored successfully:",P);return}else{console.warn("⚠️ Failed to restore active saved data:",M.error);try{await u.clearActiveSave(),console.log("🧹 Cleared stale activeSaveId after failed restore")}catch(F){console.warn("⚠️ Could not clear activeSaveId:",F)}}}let I=[];const A=u.state.subscribe(M=>{I=(M==null?void 0:M.savedLayouts)||[]});if(A&&A(),I&&I.length>0){const M=I[0];if(console.log("🧭 Auto-selecting first saved layout:",M==null?void 0:M.id,M==null?void 0:M.name),M!=null&&M.id){const F=await u.load(M.id);if(F.success){console.log("✅ First saved layout auto-restored and set active:",M.id);return}else console.warn("⚠️ Failed to auto-load chosen layout:",F.error)}}console.log("ℹ️ No saved layouts found, using default chart configuration")}catch(C){console.error("❌ Error restoring active saved data:",C)}}b0(()=>{h&&h(),u.destroy()}),rv(),$d()}function FJ(n,e){e("cancel")}function LJ(n,e){e("confirm")}var EJ=ke('<div class="ucm-backdrop svelte-16egrl4"><div class="ucm-modal svelte-16egrl4" role="dialog" aria-modal="true" aria-labelledby="ucm-title"><div class="ucm-header svelte-16egrl4"><h2 id="ucm-title" class="svelte-16egrl4"> </h2></div> <div class="ucm-body svelte-16egrl4"><p> </p></div> <div class="ucm-actions svelte-16egrl4"><button class="btn btn-cancel svelte-16egrl4">Cancel</button> <button class="btn btn-confirm svelte-16egrl4">Confirm</button></div></div></div>');function $J(n,e){Ed(e,!1);let t=hi(e,"show",8,!1),s=hi(e,"title",8,"Unsaved changes"),o=hi(e,"message",8,"You have unsaved changes. If you refresh, your changes will be lost.");const r=Fh();rv();var a=Qn(),l=fn(a);Ue(l,t,c=>{var f=EJ(),u=y(f),d=y(u),h=y(d),m=y(h,!0);_(h),_(d);var g=v(d,2),w=y(g),C=y(w,!0);_(w),_(g);var P=v(g,2),I=y(P);I.__click=[FJ,r];var A=v(I,2);A.__click=[LJ,r],_(P),_(u),_(f),Ce(()=>{tt(m,s()),tt(C,o())}),q(c,f)}),q(n,a),$d()}Ip(["click"]);const DJ={lookbackPeriod:50,trendWeight:.3,momentumWeight:.25,volatilityWeight:.2,supportResistanceWeight:.15,volumeWeight:.1};function Jv(n,e){return n.length<e?n[n.length-1]||0:n.slice(-e).reduce((s,o)=>s+o,0)/e}function Dx(n,e){if(n.length===0)return 0;if(n.length<e)return Jv(n,n.length);const t=2/(e+1);let s=Jv(n.slice(0,e),e);for(let o=e;o<n.length;o++)s=(n[o]-s)*t+s;return s}function U8(n,e=14){if(n.length<e+1)return 50;const t=[];for(let c=1;c<n.length;c++)t.push(n[c]-n[c-1]);let s=0,o=0;for(let c=0;c<e;c++)t[c]>=0?s+=t[c]:o-=t[c];let r=s/e,a=o/e;for(let c=e;c<t.length;c++)t[c]>=0?(r=(r*(e-1)+t[c])/e,a=a*(e-1)/e):(r=r*(e-1)/e,a=(a*(e-1)-t[c])/e);return a===0?100:100-100/(1+r/a)}function RJ(n,e=14){if(n.length<2)return 0;const t=[];for(let s=1;s<n.length;s++){const o=n[s].high,r=n[s].low,a=n[s-1].close,l=Math.max(o-r,Math.abs(o-a),Math.abs(r-a));t.push(l)}return Jv(t,Math.min(e,t.length))}function jJ(n,e=3){if(n.length<10)return{support:[],resistance:[]};const t=n.map(a=>a.high),s=n.map(a=>a.low),o=[],r=[];for(let a=2;a<n.length-2;a++)t[a]>t[a-1]&&t[a]>t[a-2]&&t[a]>t[a+1]&&t[a]>t[a+2]&&o.push(t[a]),s[a]<s[a-1]&&s[a]<s[a-2]&&s[a]<s[a+1]&&s[a]<s[a+2]&&r.push(s[a]);return o.sort((a,l)=>l-a),r.sort((a,l)=>a-l),{resistance:o.slice(0,e),support:r.slice(0,e)}}function BJ(n){if(n.length<3)return{pattern:"none",bullish:!0,confidence:.5};const e=n[n.length-1],t=n[n.length-2],s=n[n.length-3],o=Math.abs(e.close-e.open),r=e.high-e.low,a=e.close>e.open,l=Math.abs(t.close-t.open),c=t.close>t.open;if(o>l*1.5){if(a&&!c)return{pattern:"bullish_engulfing",bullish:!0,confidence:.75};if(!a&&c)return{pattern:"bearish_engulfing",bullish:!1,confidence:.75}}if(o<r*.1)return{pattern:"doji",bullish:c,confidence:.4};const f=a?e.open-e.low:e.close-e.low,u=a?e.high-e.close:e.high-e.open;return f>o*2&&u<o*.5?{pattern:"hammer",bullish:!0,confidence:.65}:u>o*2&&f<o*.5?{pattern:"shooting_star",bullish:!1,confidence:.65}:a&&c&&s.close>s.open?{pattern:"three_white_soldiers",bullish:!0,confidence:.7}:!a&&!c&&s.close<s.open?{pattern:"three_black_crows",bullish:!1,confidence:.7}:{pattern:"none",bullish:a,confidence:.5}}function OJ(n){if(n.length<30)return{phase:"accumulation",confidence:.5};const e=n.slice(-30),t=e.map(u=>u.close),s=e.map(u=>u.volume||0),o=e.map(u=>u.high-u.low),r=(t[t.length-1]-t[0])/t.length,a=Jv(s,s.length),l=Jv(s.slice(-5),5),c=Jv(o,o.length),f=Jv(o.slice(-5),5);return Math.abs(r)<c*.1&&l<a*1.1&&f<c*1.1?{phase:"accumulation",confidence:.7}:r>c*.3&&l>a*1.2?{phase:"markup",confidence:.75}:Math.abs(r)<c*.15&&l>a*1.3&&(t[t.length-10]-t[0])/10>0?{phase:"distribution",confidence:.7}:r<-c*.3&&l>a*1.2?{phase:"markdown",confidence:.75}:{phase:"accumulation",confidence:.5}}function zJ(n){if(n.length<20)return{direction:"sideways",strength:.5};const e=n.map($=>$.close),t=n.map($=>$.high),s=n.map($=>$.low),o=Dx(e,9),r=Dx(e,21),a=Dx(e,Math.min(50,e.length)),l=e[e.length-1];let c="sideways",f=0,u=0;o>r?f++:u++,r>a?f++:u++,l>o?f++:u++;const d=t.slice(-5),h=s.slice(-5),m=d[d.length-1]>d[0],g=h[h.length-1]>h[0],w=d[d.length-1]<d[0],C=h[h.length-1]<h[0];m&&g?f+=2:w&&C&&(u+=2);const P=e.slice(-10),I=(P[P.length-1]-P[0])/P.length,A=Jv(P,P.length),M=I/A*100;M>.15?f+=2:M<-.15&&(u+=2),f>u+1?c="up":u>f+1&&(c="down");const F=f+u,B=F>0?Math.abs(f-u)/F:.5;return{direction:c,strength:Math.min(B,1)}}function VJ(n){if(n.length<20)return{value:0,strength:.5};const e=n.map(c=>c.close),t=U8(e,14),s=(t-50)/50,o=(e[e.length-1]-e[e.length-10])/e[e.length-10],r=s*.6+o*10*.4,a=Math.max(-1,Math.min(1,r)),l=Math.abs(t-50)/50;return{value:a,strength:Math.min(l,1)}}function WJ(n){if(n.length<20)return{trend:"stable",relativeCurrent:1};const e=n.map(l=>l.volume||0),t=Jv(e,Math.min(20,e.length)),s=Jv(e.slice(-5),5),o=e[e.length-1],r=t>0?o/t:1;let a="stable";return s>t*1.2?a="increasing":s<t*.8&&(a="decreasing"),{trend:a,relativeCurrent:r}}function HJ(n,e={}){const t={...DJ,...e};if(n.length<10)return console.warn("Not enough historical data for prediction"),null;const s=n.slice(-t.lookbackPeriod),o=s[s.length-1];console.log("🔮 Predicting next candle from",s.length,"candles");const r=zJ(s);console.log("📈 Trend:",r);const a=VJ(s);console.log("⚡ Momentum:",a);const l=RJ(s,14),c=Jv(s.map(Et=>Et.close),s.length),f=l/c*100;console.log("📊 Volatility (ATR%):",f.toFixed(2));const u=jJ(s);console.log("🎯 Support/Resistance:",u);const d=WJ(s);console.log("📦 Volume:",d);const h=BJ(s);console.log("🎨 Pattern:",h);const m=OJ(s);console.log("🔄 Market Cycle:",m);let g=0;const w=(Math.random()-.5)*.8;g+=w;const C=U8(s.map(Et=>Et.close),14),P=C>70,I=C<30,A=r.strength>.7;let M=.15;if(P&&r.direction==="up"&&(M+=.25),I&&r.direction==="down"&&(M+=.25),A&&(M+=.15),Math.random()<M){console.log("🔄 REVERSAL DETECTED - Creating counter-trend candle");const Et=.5+Math.random()*1.5;r.direction==="up"?g-=Et:r.direction==="down"?g+=Et:g+=(Math.random()>.5?1:-1)*Et}else r.direction==="up"?g+=r.strength*t.trendWeight*1.5:r.direction==="down"?g-=r.strength*t.trendWeight*1.5:g+=(Math.random()-.5)*.6,g+=a.value*a.strength*t.momentumWeight*1.8;if(h.pattern!=="none"){const Et=h.confidence*1.2;h.bullish?g+=Et:g-=Et,console.log(`🎯 Pattern impact: ${h.bullish?"+":"-"}${Et.toFixed(2)}%`)}m.phase==="markup"?g+=m.confidence*.5:m.phase==="markdown"?g-=m.confidence*.5:m.phase==="distribution"?g-=m.confidence*.2:m.phase==="accumulation"&&(g+=m.confidence*.2);const B=Math.min(f/2,2)*t.volatilityWeight;let $=0;const L=o.close;for(const Et of u.resistance)L>=Et*.98&&L<=Et*1.02&&($-=.5);for(const Et of u.support)L>=Et*.98&&L<=Et*1.02&&($+=.5);if(g+=$*t.supportResistanceWeight*1.5,d.trend==="increasing"){const Et=t.volumeWeight*.8;(g>0||g<0)&&(g*=1+Et)}else d.trend==="decreasing"&&(g*=.85);const O=(Math.random()-.5)*B*2.5;if(g+=O,Math.random()<.05){const Et=(Math.random()-.5)*3;g+=Et,console.log("📰 Surprise move:",Et.toFixed(2)+"%")}g=Math.max(-6,Math.min(6,g)),console.log("💹 Predicted change:",g.toFixed(2)+"%");const Y=L*(g/100),ce=g>0;let Q,le,ue,fe;const pe=f>2?.15:.05,xe=Math.random()<pe?(Math.random()*.5+.2)*(ce?1:-1):0,oe=Math.abs(Y),Pe=(Math.random()-.5)*.4,$e=oe*(1+Pe);if(ce){Q=L*(1+xe/100),fe=Q+$e;const Et=Math.random();let Mt,Je;Et<.2?(Mt=l*(.05+Math.random()*.15),Je=l*(.05+Math.random()*.15)):Et<.4?(Mt=l*(.4+Math.random()*.5),Je=l*(.1+Math.random()*.2)):Et<.6?(Mt=l*(.05+Math.random()*.15),Je=l*(.4+Math.random()*.6)):(Mt=l*(.15+Math.random()*.35),Je=l*(.15+Math.random()*.35)),le=fe+Mt,ue=Q-Je}else{Q=L*(1+xe/100),fe=Q-$e;const Et=Math.random();let Mt,Je;Et<.2?(Mt=l*(.05+Math.random()*.15),Je=l*(.05+Math.random()*.15)):Et<.4?(Mt=l*(.4+Math.random()*.6),Je=l*(.05+Math.random()*.15)):Et<.6?(Mt=l*(.1+Math.random()*.2),Je=l*(.4+Math.random()*.5)):(Mt=l*(.15+Math.random()*.35),Je=l*(.15+Math.random()*.35)),le=Q+Mt,ue=fe-Je}const ze=r.direction==="sideways"?.15:.05;if(Math.random()<ze){fe=Q+(Math.random()-.5)*l*.1;const Et=l*(.3+Math.random()*.4);le=Math.max(Q,fe)+Et,ue=Math.min(Q,fe)-Et,console.log("🎲 Created Doji candle (indecision)")}le=Math.max(Q,fe,le),ue=Math.min(Q,fe,ue);const Ke=Jv(s.map(Et=>Et.volume||0),20);Jv(s.slice(-5).map(Et=>Et.volume||0),5);let qe=Ke;const nt=Math.min(Math.abs(g)/2,1.5);qe*=.8+nt*.4,d.trend==="increasing"?qe*=1.1+Math.random()*.3:d.trend==="decreasing"?qe*=.7+Math.random()*.2:qe*=.85+Math.random()*.3,h.pattern==="bullish_engulfing"||h.pattern==="bearish_engulfing"?qe*=1.2+Math.random()*.3:h.pattern==="doji"&&(qe*=.7+Math.random()*.2),(m.phase==="distribution"||m.phase==="markdown")&&(qe*=1.1+Math.random()*.2),qe=Math.max(Ke*.3,Math.min(qe,Ke*3));const ft=s.slice(-5).map((Et,Mt,Je)=>Mt>0?Et.timestamp-Je[Mt-1].timestamp:0).filter(Et=>Et>0),ut=ft.length>0?Jv(ft,ft.length):6e4,Pt={timestamp:o.timestamp+ut,open:Math.round(Q*100)/100,high:Math.round(le*100)/100,low:Math.round(ue*100)/100,close:Math.round(fe*100)/100,volume:Math.round(qe)};return console.log("🎯 Predicted candle:",Pt),Pt}function qJ(n,e){return Date.now()-n>e*2}function UJ(){var n;try{(n=window.predictNextCandle)==null||n.call(window)}catch{}Yv(!0)}function GJ(n,e){(!(typeof window<"u")||window.confirm("Exit simulator?"))&&(e(),u6())}function YJ(n){const e=parseFloat(n.target.value);d6(e)}var KJ=ke('<button class="fc-btn svelte-u36ajg" type="button">Stop</button>'),XJ=ke('<button class="fc-btn svelte-u36ajg" type="button">Start</button>'),ZJ=ke('<div class="floating-controls svelte-u36ajg"><div class="fc-content svelte-u36ajg"><div class="fc-header svelte-u36ajg"><div class="fc-title svelte-u36ajg">Simulator</div> <div class="fc-badge svelte-u36ajg"> </div></div> <div class="fc-row svelte-u36ajg"><input type="range" min="0.5" max="10" step="0.5" class="fc-range svelte-u36ajg"></div> <div class="fc-row svelte-u36ajg"><!> <button class="fc-btn fc-danger svelte-u36ajg" type="button">Exit</button></div></div></div>');function JJ(n,e){Ed(e,!0);const t=sm(),s=()=>wl(uh,"$simulator",t);let o=ge(20),r=ge(80),a=ge(!1),l=0,c=0;function f(w){const C="touches"in w?w.touches[0]:w;l=C.clientX-i(o),c=C.clientY-i(r),x(a,!0),window.addEventListener("mousemove",u),window.addEventListener("mouseup",d),window.addEventListener("touchmove",u,{passive:!0}),window.addEventListener("touchend",d)}function u(w){if(!i(a))return;const C="touches"in w?w.touches[0]:w;x(o,C.clientX-l),x(r,C.clientY-c)}function d(){x(a,!1),window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",d),window.removeEventListener("touchmove",u),window.removeEventListener("touchend",d)}function h(){var w;try{(w=window.stopPrediction)==null||w.call(window)}catch{}Yv(!1)}var m=Qn(),g=fn(m);Ue(g,()=>s().mode==="normal",w=>{var C=ZJ(),P=y(C),I=y(P);I.__mousedown=f,I.__touchstart=f;var A=v(y(I),2),M=y(A);_(A),_(I);var F=v(I,2),B=y(F);xn(B),B.__input=[YJ],_(F);var $=v(F,2),L=y($);Ue(L,()=>s().playing,Y=>{var ce=KJ();ce.__click=h,q(Y,ce)},Y=>{var ce=XJ();ce.__click=[UJ],q(Y,ce)});var O=v(L,2);O.__click=[GJ,h],_($),_(P),_(C),Ce(()=>{Ot(C,"style",`left:${i(o)}px;top:${i(r)}px;`),tt(M,`${s().speed??""}x`),Gf(B,s().speed)}),q(w,C)}),q(n,m),$d()}Ip(["mousedown","touchstart","input","click"]);const G8="scriptStudio.scripts";function ky(){try{const n=localStorage.getItem(G8);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch{return[]}}function Sy(n){try{localStorage.setItem(G8,JSON.stringify(n))}catch{}}function n2(){return ky()}function Eb(n){Sy(Array.isArray(n)?n:[])}function E5(n){const e=ky(),t=e.findIndex(s=>s.id===n.id);return t>=0?e[t]={...n,updatedAt:Date.now()}:e.push(n),Sy(e),n}function QJ(n,e,t){const s=ky(),o=Date.now(),a={id:`${o}`,name:n,code:e,tags:t||[],createdAt:o,updatedAt:o};return s.push(a),Sy(s),a}function eQ(n,e){const t=ky(),s=t.findIndex(r=>r.id===n);if(s===-1)return null;const o={...t[s],...e,updatedAt:Date.now()};return t[s]=o,Sy(t),o}function tQ(n){const e=ky(),t=e.filter(s=>s.id!==n);return Sy(t),t.length!==e.length}function nQ(n){let e="",t=null;for(let s=0;s<n.length;s++){const o=n[s],r=n[s+1];if(t){e+=o,o===t&&n[s-1]!=="\\"&&(t=null);continue}if(o==="'"||o==='"'){t=o,e+=o;continue}if(o==="/"&&r==="/")break;e+=o}return e.replace(/\s+$/,"")}function Tr(n){const e=n.trim();return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}function Gr(n){const e=[];let t="",s=0,o=0,r=0,a=null;for(let l=0;l<n.length;l++){const c=n[l];if(a){t+=c,c===a&&n[l-1]!=="\\"&&(a=null);continue}if(c==="'"||c==='"'){a=c,t+=c;continue}if(c==="("){s+=1,t+=c;continue}if(c===")"){s=Math.max(0,s-1),t+=c;continue}if(c==="{"){o+=1,t+=c;continue}if(c==="}"){o=Math.max(0,o-1),t+=c;continue}if(c==="["){r+=1,t+=c;continue}if(c==="]"){r=Math.max(0,r-1),t+=c;continue}if(c===","&&s===0&&o===0&&r===0){e.push(t.trim()),t="";continue}t+=c}return t.trim()&&e.push(t.trim()),e}function su(n){const e={};for(const t of n){const s=t.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+)$/);s&&(e[s[1]]=s[2].trim())}return e}let Y8=!1,K8=!1;function dy(n){let e=n.trim();return e=e.replace(/\bta\./g,""),e=e.replace(/\bmath\./g,""),Y8&&(e=e.replace(/\bsession\./g,"")),e=e.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),e=e.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(t,s,o)=>`${String(s).toLowerCase()}_${o}`),e=(()=>{const t=e;let s="",o=null,r=0;const a=c=>/[A-Za-z_$]/.test(c),l=c=>/[A-Za-z0-9_$]/.test(c);for(;r<t.length;){const c=t[r];if(o){s+=c,c===o&&t[r-1]!=="\\"&&(o=null),r+=1;continue}if(c==="'"||c==='"'){o=c,s+=c,r+=1;continue}if(a(c)){let f=r+1;for(;f<t.length&&l(t[f]);)f+=1;const u=t.slice(r,f);let d=r-1;for(;d>=0&&/\s/.test(t[d]);)d-=1;const h=d>=0&&t[d]===".";let m=f;for(;m<t.length&&/\s/.test(t[m]);)m+=1;if(h){s+=u,r=f;continue}if(t[m]==="["&&K8&&!h){let g=0,w=m,C=null;for(;w<t.length;w++){const P=t[w];if(C){P===C&&t[w-1]!=="\\"&&(C=null);continue}if(P==="'"||P==='"'){C=P;continue}if(P==="[")g+=1;else if(P==="]"&&(g-=1,g===0))break}if(w<t.length&&g===0){const P=t.slice(m+1,w).trim();if(P){s+=`prev(${u}, __hist_index(${P}))`,r=w+1;continue}}}else if(t[m]==="["){let g=m+1;for(;g<t.length&&/\s/.test(t[g]);)g+=1;let w=1;t[g]==="-"&&(w=-1,g+=1);let C=g;for(;C<t.length&&/[0-9]/.test(t[C]);)C+=1;const P=t.slice(g,C);for(;C<t.length&&/\s/.test(t[C]);)C+=1;if(P&&t[C]==="]"){const I=w*Number(P);if(Number.isFinite(I)&&I>=1){s+=`prev(${u}, ${Math.floor(I)})`,r=C+1;continue}if(Number.isFinite(I)&&I===0){s+=u,r=C+1;continue}}}s+=u,r=f;continue}s+=c,r+=1}return s})(),e}function B_(n){let e=dy(n);return e=e.replace(/\bcrossover\s*\(/gi,"crossover("),e=e.replace(/\bcrossunder\s*\(/gi,"crossunder("),e}function zu(n){const e=n.trim();if(!e.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=/))return!1;const s=e.indexOf("=");if(s<0)return!1;const o=e[s-1]??"",r=e[s+1]??"";return!(o==="="||o==="!"||o==="<"||o===">"||r==="=")}function Zg(n){const e=n.trim().toLowerCase();return e==="true"?!0:e==="false"?!1:null}function rh(n){const e=n.trim();if(!/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/.test(e))return null;const t=Number(e);return Number.isFinite(t)?t:null}function sQ(n){const e=Tr(String(n||"").trim()).toLowerCase();return e?e==="background"||e==="bg"?"background":e==="main"||e==="base"?"main":e==="overlay"||e==="over"?"overlay":e==="ui"?"ui":null:null}function Yg(n){if(n!=null)return sQ(n)??void 0}function Kg(n){if(n==null)return;const e=rh(Tr(String(n)));return e??void 0}function Xg(n){if(n==null)return;const e=Tr(String(n)),t=Zg(e);if(t!=null)return t;const s=rh(e);if(s!=null)return s!==0}function oQ(n){const e=String(n||"").trim().match(/^timestamp\s*\((.*)\)\s*$/i);if(!e)return null;const t=Gr(e[1]||"");if(!t.length)return null;const s=C=>{const P=rh(Tr(C));return P??null};let o=0,r=0;const a=Tr(String(t[0]||"")).trim(),l=s(a);if(a&&l==null){const P=a.toUpperCase().match(/^(GMT|UTC)([+-]\d{1,2})?$/);if(P){const I=P[2]?Number(P[2]):0;Number.isFinite(I)&&(r=I*60),o=1}else{const I=Date.parse(a);return Number.isFinite(I)?I:null}}const c=s(t[o]||"");if(c==null)return null;const f=s(t[o+1]||"1")??1,u=s(t[o+2]||"1")??1,d=s(t[o+3]||"0")??0,h=s(t[o+4]||"0")??0,m=s(t[o+5]||"0")??0,g=s(t[o+6]||"0")??0,w=Date.UTC(c,Math.max(0,f-1),u,d,h,m,g);return Number.isFinite(w)?w-r*60*1e3:null}function $5(n){const e=Tr(String(n||"").trim());if(!e)return;if(e.startsWith("#")||e.startsWith("rgb"))return e;const t=e.toLowerCase();if(t==="color.green"||t==="green")return"#16a34a";if(t==="color.red"||t==="red")return"#ef4444";if(t==="color.orange"||t==="orange")return"#f59e0b";if(t==="color.blue"||t==="blue")return"#3b82f6";if(t==="color.gray"||t==="gray"||t==="grey")return"#64748b";if(t==="color.white"||t==="white")return"#e2e8f0";if(t==="color.black"||t==="black")return"#0b1220"}function G0(n,e){if(!n||e==null||!Number.isFinite(e))return n;const t=Math.max(0,Math.min(100,e)),s=Math.max(0,Math.min(1,1-t/100)),o=n.trim();if(o.startsWith("#")){const a=o.slice(1),l=a.length===3?a.split("").map(c=>c+c).join(""):a.length===6?a:"";if(l){const c=parseInt(l.slice(0,2),16),f=parseInt(l.slice(2,4),16),u=parseInt(l.slice(4,6),16);if(Number.isFinite(c)&&Number.isFinite(f)&&Number.isFinite(u))return`rgba(${c},${f},${u},${s})`}}const r=o.match(/^rgba?\((.*)\)$/i);if(r){const a=r[1].split(",").map(l=>l.trim());if(a.length>=3){const l=Number(a[0]),c=Number(a[1]),f=Number(a[2]),u=a.length>=4?Number(a[3]):1;if([l,c,f,u].every(d=>Number.isFinite(d))){const d=Math.max(0,Math.min(1,u*s));return`rgba(${l},${c},${f},${d})`}}}return n}function iQ(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^shape\./,"").replace(/^label\./,"");if(t.includes("none"))return"none";if(t.includes("xcross"))return"xcross";if(t.includes("cross"))return"cross";if(t.includes("diamond"))return"diamond";if(t.includes("triangleup"))return"triangle_up_filled";if(t.includes("triangledown"))return"triangle_down_filled";if(t.includes("arrowup"))return"arrowUp";if(t.includes("arrowdown"))return"arrowDown";if(t.includes("circle"))return"circle";if(t.includes("square"))return"square";if(t.includes("flag"))return"flag";if(t.includes("tag"))return"tag";if(t.includes("pill"))return"pill";if(t.includes("label"))return"label"}function rQ(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^label\./,"").replace(/^style_/,"");return t.includes("none")?"text":t.includes("arrowup")?"arrowUp":t.includes("arrowdown")?"arrowDown":t.includes("triangleup")?"triangle_up_filled":t.includes("triangledown")?"triangle_down_filled":t.includes("circle")?"circle":t.includes("square")?"square":t.includes("xcross")?"xcross":t.includes("cross")?"cross":t.includes("diamond")?"diamond":t.includes("flag")?"flag":t.includes("tag")?"tag":t.includes("pill")?"pill":(t.includes("label"),"label")}function H1(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^size\./,"");if(t==="auto")return 14;if(t==="tiny")return 10;if(t==="small")return 12;if(t==="normal")return 14;if(t==="large")return 18;if(t==="huge")return 22;const s=rh(Tr(e));if(s!=null)return Math.max(6,Math.min(64,s))}function D5(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^size\./,"");if(t==="tiny")return 10;if(t==="small")return 12;if(t==="normal")return 14;if(t==="large")return 16;if(t==="huge")return 18}function u0(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^line\./,"").replace(/^style_/,"");if(t.includes("arrow")&&(t.includes("both")||t.includes("left_right")))return"arrow_both";if(t.includes("arrow")&&t.includes("left"))return"arrow_left";if(t.includes("arrow")&&t.includes("right"))return"arrow_right";if(t.includes("arrow")&&t.includes("none"))return"arrow_none";if(t.includes("dashed"))return"dashed";if(t.includes("dotted"))return"dotted";if(t.includes("solid"))return"solid"}function R5(n){const e=String(n||"").trim().toLowerCase();if(!e||e.startsWith("line."))return;const t=e.replace(/^plot\./,"").replace(/^style_/,"").replace(/^plot\.style_/,"");if(t.includes("histogram")||t.includes("columns"))return"histogram";if(t.includes("stepline")||t.includes("step"))return"stepped";if(t.includes("linebr"))return"line";if(t.includes("area"))return"area";if(t.includes("cross"))return"cross";if(t.includes("circles"))return"dots";if(t.includes("bar"))return"bar";if(t.includes("candles")||t.includes("candle"))return"candles";if(t.includes("ohlc"))return"ohlc";if(t.includes("line"))return"line"}function Rx(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^extend\./,"");if(t.includes("right"))return"right";if(t.includes("left"))return"left";if(t.includes("both"))return"both";if(t.includes("none"))return"none"}function d0(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^xloc\./,"");if(t.includes("bar_time")||t.includes("bartime")||t.includes("time"))return"time";if(t.includes("bar_index")||t.includes("barindex"))return"bar_index"}function u_(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^yloc\./,"");if(t.includes("above"))return"abovebar";if(t.includes("below"))return"belowbar";if(t.includes("price"))return"price"}function d_(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^text\./,"").replace(/^align_/,"");if(t.includes("left"))return"left";if(t.includes("right"))return"right";if(t.includes("center")||t.includes("middle"))return"center"}function q1(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^text\./,"").replace(/^align_/,"");if(t.includes("top"))return"top";if(t.includes("bottom"))return"bottom";if(t.includes("center")||t.includes("middle"))return"middle"}function j5(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^position\./,"");if(t.includes("top_left"))return"top_left";if(t.includes("top_right"))return"top_right";if(t.includes("top_center"))return"top_center";if(t.includes("bottom_left"))return"bottom_left";if(t.includes("bottom_right"))return"bottom_right";if(t.includes("bottom_center"))return"bottom_center";if(t.includes("middle_center")||t.includes("center"))return"middle_center"}function B5(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^location\./,"");if(t.includes("absolute"))return"absolute";if(t.includes("above")||t.includes("top")||t.includes("high"))return"above";if(t.includes("below")||t.includes("bottom")||t.includes("low"))return"below"}function O5(n){const e=String(n||"").trim().toLowerCase();if(e){if(e.includes("on"))return"on";if(e.includes("off"))return"off"}}function z5(n){const e=String(n||"").toLowerCase().replace(/\s+/g,"");if(e){if(e.includes("onceperbarclose")||e.includes("perbarclose")||e.includes("barclose"))return"once_per_bar_close";if(e.includes("onceperbar")||e.includes("perbar")||e.includes("all"))return"once_per_bar";if(e.includes("once"))return"once"}}function V5(n){const e=String(n||"").trim(),t=e.match(/^(?:request\.)?security(?:_lower_tf)?\s*\((.*)\)\s*$/i);if(!t)return null;const s=e.toLowerCase().startsWith("request.security_lower_tf")||e.toLowerCase().startsWith("security_lower_tf"),o=Gr(t[1]||"");if(o.length<2)return null;const r=su(o),a=o.filter(C=>!zu(C)),l=a[0]!=null?String(a[0]).trim():"",c=Tr(l),f=c&&c.toLowerCase()==="syminfo.tickerid"?"syminfo.tickerid":!(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(c)&&!/^\d+$/.test(c)?`\${${c}}`:c,u=a[1]!=null?String(a[1]).trim():"",d=Tr(u),h=d&&d.toLowerCase()==="timeframe.period"?"__CURRENT__":!(u.startsWith('"')&&u.endsWith('"')||u.startsWith("'")&&u.endsWith("'"))&&/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(d)&&!/^\d+$/.test(d)?`\${${d}}`:d,m=a[2]!=null?dy(String(a[2])):"close",g=O5(String(r.lookahead??""))??(String(r.lookahead??"").toLowerCase().includes("lookahead_on")?"on":String(r.lookahead??"").toLowerCase().includes("lookahead_off")?"off":void 0),w=O5(String(r.gaps??""))??(String(r.gaps??"").toLowerCase().includes("gaps_on")?"on":String(r.gaps??"").toLowerCase().includes("gaps_off")?"off":void 0);return{symbol:f,country:r.country!=null?Tr(String(r.country)):void 0,timeframe:h||"__CURRENT__",expr:m||"close",lookahead:g,gaps:w,lower:s}}function Fw(n){var qd,Xf,Vf;const e=[],t=[],s=new Set,o=new Set,r=!0;Y8=r,K8=r;const a="williamsr length must be integer >= 1",l="aroon length must be integer >= 1",c="dmi length must be integer >= 1",f="dmi smoothing must be integer >= 1",u="adx length must be integer >= 1",d="plus_di length must be integer >= 1",h="minus_di length must be integer >= 1",m="dx length must be integer >= 1",g="aroonosc length must be integer >= 1",w="highest length must be integer >= 1",C="lowest length must be integer >= 1",P="sum length must be integer >= 1",I="rising length must be integer >= 1",A="falling length must be integer >= 1",M="valuewhen occurrence must be integer >= 0",F=se=>{let be=0;for(let G=0;G<se.length;G++){const re=se[G];if(re===" ")be+=1;else if(re==="	")be+=2;else break}return be},B=se=>{let be=0,G=null;for(let re=0;re<se.length;re++){const we=se[re];if(G){we===G&&se[re-1]!=="\\"&&(G=null);continue}if(we==="'"||we==='"'){G=we;continue}we==="("?be+=1:we===")"&&(be-=1)}return be},$=se=>{const be=String(se||"").split(/\r?\n/),G=[];let re="",we=1,J=0,Fe=0;for(let yt=0;yt<be.length;yt++){const vt=yt+1,jt=nQ(be[yt]||""),ye=jt.trim();ye&&(re||(we=vt,Fe=F(jt)),re=re?`${re} ${ye}`:ye,J+=B(ye),J<=0&&(G.push({text:re.trim(),indent:Fe,lineNo:we,loopSeq:!1}),re="",J=0,Fe=0))}return re.trim()&&G.push({text:re.trim(),indent:Fe,lineNo:we,loopSeq:!1}),G};let L=$(n);const O=se=>{const be=Tr(String(se||"").trim());if(!be)return null;const G=be.split("/").filter(Boolean);if(!G.length)return null;for(let re=G.length-1;re>=0;re--){const we=G[re];if(!/^\d+$/.test(we))return we}return G[0]||null},Y=se=>se.replace(/^\s*export\s+/i,""),ce=(se,be)=>{const G=[];let re=0,we=null;const J=yt=>/[A-Za-z_$]/.test(yt),Fe=yt=>/[A-Za-z0-9_$]/.test(yt);for(;re<se.length;){const yt=se[re];if(we){G.push(yt),yt===we&&se[re-1]!=="\\"&&(we=null),re+=1;continue}if(yt==="'"||yt==='"'){we=yt,G.push(yt),re+=1;continue}if(J(yt)){let vt=re+1;for(;vt<se.length&&Fe(se[vt]);)vt+=1;const jt=se.slice(re,vt);G.push(be[jt]||jt),re=vt;continue}G.push(yt),re+=1}return G.join("")},Q=se=>{const be=se.toLowerCase();return!!(/tradingview\/ta(\/|$)/.test(be)||/tradingview\/math(\/|$)/.test(be)||/tradingview\/str(\/|$)/.test(be))},le=se=>{const be=Tr(String(se||"").trim());if(!be)return{error:"import path is empty"};if(typeof window>"u")return{error:`import "${be}" is only supported in browser (local library cache)`};const G=n2(),re=yt=>{if(typeof yt=="string"){const vt=yt.trim();if(vt.startsWith("{")&&vt.includes('"script"')){try{const ye=JSON.parse(vt);if(ye&&typeof ye=="object"&&typeof ye.script=="string")return ye.script}catch{}const jt=vt.match(/"script"\s*:\s*"([\s\S]*?)"\s*,\s*"(?:name|userPreferenceId|createdAt)"/);if(jt&&jt[1])try{return JSON.parse(`"${jt[1]}"`)}catch{}}return yt}if(yt&&typeof yt=="object"){const vt=yt.script??yt.code;if(typeof vt=="string")return vt}return String(yt||"")},we=O(be)||be,J=yt=>G.filter(vt=>vt.name===yt).sort((vt,jt)=>(jt.updatedAt||0)-(vt.updatedAt||0))[0],Fe=J(be)||J(we);return Fe?{code:re(Fe.code),name:Fe.name}:{error:`library "${be}" not found in saved scripts`}},ue=se=>{const be=/^\s*export\s+/i.test(se),G=Y(se).trim();if(!G||/^(import|library|indicator|study|strategy)\b/i.test(G))return null;const re=G.match(/^\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\((.*)\)\s*=>/);if(re)return{name:re[1],exported:be};const we=G.match(/^(?:varip\s+|var\s+)?(?:(?:float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)/i);return we?{name:we[1],exported:be}:null},fe=(se,be,G,re,we)=>{if(re>6)return e.push({message:`import "${be}" exceeded max depth`,line:1}),{lines:[],exports:new Set};const J=$(se),Fe=[],yt=new Set,vt=new Set;let jt=!1;for(const Ye of J){const at=Ye.text.trim(),Re=at.match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i);if(Re){const pt=Re[1]||"",Ge=Re[2]||O(pt)||"";Ge&&Fe.push({path:pt,alias:Ge,lineNo:Ye.lineNo});continue}if(/^library\s*\(/i.test(at))continue;const De=ue(at);De&&(yt.add(De.name),De.exported&&(vt.add(De.name),jt=!0))}const ye=jt?vt:new Set(yt),E={},me=[];for(const Ye of Fe){const at=Ye.alias,Re=Tr(Ye.path);if(!at){e.push({message:`import "${Re}" needs an alias`,line:Ye.lineNo});continue}if(Q(Re)){E[at]="";continue}if(we.includes(Re)){e.push({message:`cyclic import detected: ${we.join(" -> ")} -> ${Re}`,line:Ye.lineNo});continue}const De=le(Re);if(De.error||!De.code){e.push({message:De.error||`library "${Re}" not found`,line:Ye.lineNo});continue}const pt=`${G}${at}__`;E[at]=pt;const Ge=fe(De.code,at,pt,re+1,[...we,Re]);me.push(...Ge.lines)}const Se={};yt.forEach(Ye=>{Se[Ye]=`${G}${Ye}`});const Ve=[];for(const Ye of J){const at=Ye.text.trim();if(!at||/^import\b/i.test(at)||/^library\s*\(/i.test(at))continue;let Re=Y(Ye.text);Object.entries(E).forEach(([De,pt])=>{if(!De)return;const Ge=new RegExp(`\\b${De}\\.`,"gi");Re=Re.replace(Ge,pt)}),Re=ce(Re,Se),Ve.push({...Ye,text:Re})}return{lines:[...me,...Ve],exports:ye}},pe={},Z=[],xe=[];for(const se of L){const G=se.text.trim().match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i);if(G){const re=G[1]||"",we=G[2]||O(re)||"",J=Tr(re);if(!we){e.push({message:`import "${J}" needs an alias`,line:se.lineNo});continue}if(pe[we]){e.push({message:`import alias "${we}" already used`,line:se.lineNo});continue}if(Q(J)){pe[we]={replacement:"",exports:new Set};continue}const Fe=le(J);if(Fe.error||!Fe.code){e.push({message:Fe.error||`library "${J}" not found`,line:se.lineNo});continue}const yt=`__lib_${we}__`,vt=fe(Fe.code,we,yt,1,[J]);Z.push(...vt.lines),pe[we]={replacement:yt,exports:vt.exports};continue}xe.push(se)}L=[...Z,...xe];let oe="main";for(const se of L){const be=se.text.trim().match(/^(indicator|study)\s*\((.*)\)\s*$/i);if(!be)continue;const G=Gr(be[2]||""),we=su(G).overlay;if(we!=null){const J=Zg(Tr(String(we)));J==null?e.push({message:"indicator overlay must be true or false",line:se.lineNo}):oe=J?"main":"sub"}else oe="sub";break}const Pe=[{pane:"main",plots:[],labels:[],levels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],overlays:[],fills:[],backgroundZones:[]}],$e=[],ze=[],Ke={},qe=[],nt=[],ft={},ut=[],bt={},Pt={};let Et=null;const Mt={},Je={},Ct={},Ze={},Xe={},Ae={};let Qe=0;const gt=(se,be)=>{const G=be.replace(/[^A-Za-z0-9_]+/g,"_").toLowerCase(),re=G?`__sec_${G}`:"__sec";let we=re,J=1;const Fe=yt=>$e.some(vt=>String((vt==null?void 0:vt.name)||"").toLowerCase()===yt.toLowerCase())||qe.some(vt=>String((vt==null?void 0:vt.name)||"").toLowerCase()===yt.toLowerCase());for(;Fe(we);)J+=1,we=`${re}_${J}`;return qe.push({name:we,type:"security",symbol:se.symbol,country:se.country,timeframe:se.timeframe,expr:se.expr,lookahead:se.lookahead,gaps:se.gaps,lower:se.lower}),we},Ft=(se,be)=>{const G=String(se||"");let re="",we=0,J=null;const Fe=G.toLowerCase();for(;we<G.length;){const yt=G[we];if(J){re+=yt,yt===J&&G[we-1]!=="\\"&&(J=null),we+=1;continue}if(yt==="'"||yt==='"'){J=yt,re+=yt,we+=1;continue}const vt=Fe.slice(we),jt=vt.startsWith("request.security_lower_tf"),ye=!jt&&vt.startsWith("request.security"),E=!jt&&!ye&&vt.startsWith("security_lower_tf")&&(we===0||!/[a-z0-9_$]/i.test(Fe[we-1]||"")),me=!jt&&!ye&&!E&&vt.startsWith("security")&&(we===0||!/[a-z0-9_$]/i.test(Fe[we-1]||""));if(jt||ye||E||me){let Ve=we+(jt?25:ye?16:E?17:8);for(;Ve<G.length&&/\s/.test(G[Ve]);)Ve+=1;if(G[Ve]!=="("){re+=yt,we+=1;continue}let Ye=0,at=Ve,Re=null;for(;at<G.length;at++){const sn=G[at];if(Re){sn===Re&&G[at-1]!=="\\"&&(Re=null);continue}if(sn==="'"||sn==='"'){Re=sn;continue}if(sn==="(")Ye+=1;else if(sn===")"&&(Ye-=1,Ye===0))break}if(at>=G.length){re+=G.slice(we);break}const De=G.slice(we,at+1),pt=V5(De);if(!pt){re+=De,we=at+1;continue}Qe+=1;const Ge=gt(pt,`${be}_${Qe}`);re+=Ge,we=at+1;continue}re+=yt,we+=1}return re};if(!/(^\s*\/\/@\s*pine)|(^\s*\/\/@\s*version)|\b(strategy|indicator|study)\s*\(/m.test(n))return{ok:!1,errors:[{message:"Not a Pine script",line:1}]};const ve=()=>{Pe.some(se=>se.pane==="sub")||Pe.push({pane:"sub",plots:[],labels:[],levels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],overlays:[],fills:[],backgroundZones:[]})},Ie=se=>(se==="sub"&&ve(),Pe.find(be=>be.pane===se)||Pe[0]),It=se=>{const be=String(se||"").trim();return!be||/[+\-*/%]/.test(be)?!1:!!(/\b(crossover|crossunder|between|above|below)\s*\(/i.test(be)||/\bcrosses(Above|Below)\b/i.test(be)||/[<>]=?|==|!=/.test(be)||/\b(and|or|not)\b/i.test(be)||/^\s*true\s*$|^\s*false\s*$/i.test(be))},Dt=se=>String(se||"").trim().replace(/\s+/g,"_").toLowerCase(),Zt=new Set,gn=(se,be)=>{const G=`${be??"?"}:${se}`;Zt.has(G)||(Zt.add(G),e.push({message:se,line:be??1}))},hn=se=>{var pt;if(se.bodyPlan)return se.bodyPlan;const be=/^(varip\s+|var\s+)?(?:(float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i,G=(Ge,sn)=>So(String(Ge||"").trim(),sn),re=Ge=>{for(const sn of Ge){if(sn.kind==="return")return!0;if(sn.kind==="if"){for(const Un of sn.branches)if(re(Un.body))return!0}if((sn.kind==="for"||sn.kind==="while")&&re(sn.body))return!0}return!1},we=(Ge,sn,Un)=>{let Zs=null;for(let vs=sn;vs<Ge.length;vs++){const Oo=Ge[vs];if(Oo.indent<=Un)break;const Pi=String(Oo.text||"").trim();!Pi||Pi.startsWith("//")||(Zs=Oo.lineNo)}return Zs},J=(Ge,sn,Un,Zs,vs)=>{var gl,Ms;const Oo=[],Pi=wo=>Zs.some(fr=>Dt(fr)===Dt(wo));let no=sn;for(;no<Ge.length;){const wo=Ge[no];if(wo.indent<=Un)break;const fr=String(wo.text||"").trim();if(!fr||fr.startsWith("//")){no+=1;continue}Fn=wo.lineNo;const xa=fr.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*switch\s*(?:\((.*)\)|(.*))$/i);if(xa){const qt=xa[3],ht=fr.includes(":=")?":=":"=",dn=String(xa[4]??xa[5]??"").trim(),Ut=wo.indent,Xn=[];let rs=no+1;for(;rs<Ge.length&&Ge[rs].indent>Ut;){const en=Ge[rs].text.trim(),cs=en.indexOf("=>");if(cs>=0){const ps=en.slice(0,cs).trim(),vo=en.slice(cs+2).trim();Xn.push({cond:ps||void 0,expr:vo||void 0,lineNo:Ge[rs].lineNo})}rs+=1}if(!Xn.length){gn("switch requires at least one case",wo.lineNo),no+=1;continue}const _t=dn?So(dn,`fn_switch_${qt}`):"";let Gt="na";for(let en=Xn.length-1;en>=0;en--){const cs=Xn[en],ps=cs.expr?So(cs.expr,`fn_switch_${qt}_case`):"na";if(!cs.cond){Gt=ps;continue}Gt=`iff(${_t?`(${_t}) == (${So(cs.cond,`fn_switch_${qt}_cond`)})`:`(${So(cs.cond,`fn_switch_${qt}_cond`)})`}, ${ps}, ${Gt})`}Ge.splice(no,rs-no,{text:`${qt} ${ht} ${Gt}`,indent:Ut,lineNo:wo.lineNo});continue}const ic=fr.match(/^switch\s*(?:\((.*)\)|(.*))$/i);if(ic){const qt=vs!=null&&wo.lineNo===vs,ht=String(ic[1]??ic[2]??"").trim(),dn=wo.indent,Ut=[];let Xn=no+1;for(;Xn<Ge.length&&Ge[Xn].indent>dn;){const Gt=Ge[Xn].text.trim(),en=Gt.indexOf("=>");if(en>=0){const cs=Gt.slice(0,en).trim(),ps=Gt.slice(en+2).trim();Ut.push({cond:cs||void 0,expr:ps||void 0,lineNo:Ge[Xn].lineNo})}Xn+=1}if(!Ut.length){gn("switch requires at least one case",wo.lineNo),no+=1;continue}const rs=ht?So(ht,"fn_switch_expr"):"";if(qt){const Gt=[];Ut.forEach(en=>{if(!en.expr)return;const cs=en.cond?rs?`(${rs}) == (${So(en.cond,"fn_switch_cond")})`:`(${So(en.cond,"fn_switch_cond")})`:void 0;Gt.push({cond:cs,body:[{kind:"return",expr:G(en.expr,`${se.name}_return`),lineNo:en.lineNo}],lineNo:en.lineNo})}),Gt.some(en=>en.cond==null)||Gt.push({cond:void 0,body:[{kind:"return",expr:"na",lineNo:wo.lineNo}],lineNo:wo.lineNo}),Oo.push({kind:"if",lineNo:wo.lineNo,branches:Gt}),no=Xn;continue}const _t=[];Ut.forEach((Gt,en)=>{if(Gt.expr){if(!Gt.cond)_t.push({text:"else",indent:dn,lineNo:Gt.lineNo});else if(en===0){const cs=rs?`(${rs}) == (${So(Gt.cond,"fn_switch_cond")})`:`(${So(Gt.cond,"fn_switch_cond")})`;_t.push({text:`if (${cs})`,indent:dn,lineNo:Gt.lineNo})}else{const cs=rs?`(${rs}) == (${So(Gt.cond,"fn_switch_cond")})`:`(${So(Gt.cond,"fn_switch_cond")})`;_t.push({text:`else if (${cs})`,indent:dn,lineNo:Gt.lineNo})}_t.push({text:Gt.expr,indent:dn+1,lineNo:Gt.lineNo})}}),Ge.splice(no,Xn-no,..._t);continue}if(fr==="break"){Oo.push({kind:"break",lineNo:wo.lineNo}),no+=1;continue}if(fr==="continue"){Oo.push({kind:"continue",lineNo:wo.lineNo}),no+=1;continue}if(/^return\b/i.test(fr)){const qt=fr.replace(/^return\b/i,"").trim();qt?Oo.push({kind:"return",expr:G(qt,`${se.name}_return`),lineNo:wo.lineNo}):(gn(`Function "${se.name}" return requires an expression`,wo.lineNo),Oo.push({kind:"return",expr:"na",lineNo:wo.lineNo})),no+=1;continue}const ec=fr.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(ec){const qt=vs!=null&&wo.lineNo===vs,ht=wo.indent,dn=[],Ut=String(ec[1]??ec[2]??"").trim();Fn=wo.lineNo;const Xn=Ut?So(Ut,`fn_if_${se.name}`):"",rs=qt?we(Ge,no+1,ht):null,_t=J(Ge,no+1,ht,Zs,rs);qt&&!re(_t.ops)&&_t.ops.push({kind:"return",expr:"na",lineNo:wo.lineNo}),dn.push({cond:Xn||void 0,body:_t.ops,lineNo:wo.lineNo});let Gt=_t.nextIdx;for(;Gt<Ge.length&&Ge[Gt].indent===ht;){const en=String(Ge[Gt].text||"").trim(),cs=en.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(cs){const ps=String(cs[1]??cs[2]??"").trim();Fn=Ge[Gt].lineNo;const vo=ps?So(ps,`fn_if_${se.name}`):"",Ko=qt?we(Ge,Gt+1,ht):null,ho=J(Ge,Gt+1,ht,Zs,Ko);qt&&!re(ho.ops)&&ho.ops.push({kind:"return",expr:"na",lineNo:Ge[Gt].lineNo}),dn.push({cond:vo||void 0,body:ho.ops,lineNo:Ge[Gt].lineNo}),Gt=ho.nextIdx;continue}if(/^else$/i.test(en)){const ps=qt?we(Ge,Gt+1,ht):null,vo=J(Ge,Gt+1,ht,Zs,ps);qt&&!re(vo.ops)&&vo.ops.push({kind:"return",expr:"na",lineNo:Ge[Gt].lineNo}),dn.push({cond:void 0,body:vo.ops,lineNo:Ge[Gt].lineNo}),Gt=vo.nextIdx}break}Oo.push({kind:"if",lineNo:wo.lineNo,branches:dn}),no=Gt;continue}const Lf=fr.match(/^for\s+([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+?)\s+to\s+(.+?)(?:\s+by\s+(.+))?$/i);if(Lf){const qt=Lf[1],ht=String(Lf[2]??"").trim(),dn=String(Lf[3]??"").trim(),Ut=String(Lf[4]??"1").trim();Fn=wo.lineNo;const Xn=So(ht,`fn_for_${qt}`),rs=So(dn,`fn_for_${qt}`),_t=So(Ut,`fn_for_${qt}`),Gt=J(Ge,no+1,wo.indent,[...Zs,qt],null);Gt.nextIdx===no+1&&gn(`Function "${se.name}" for-loop requires an indented body`,wo.lineNo),Oo.push({kind:"for",lineNo:wo.lineNo,varName:qt,startExpr:Xn,endExpr:rs,stepExpr:_t,body:Gt.ops}),no=Gt.nextIdx;continue}const _e=fr.match(/^while\s*(?:\((.*)\)|(.*))$/i);if(_e){const qt=String(_e[1]??_e[2]??"").trim();Fn=wo.lineNo;const ht=So(qt,`fn_while_${se.name}`),dn=J(Ge,no+1,wo.indent,Zs,null);dn.nextIdx===no+1&&gn(`Function "${se.name}" while-loop requires an indented body`,wo.lineNo),Oo.push({kind:"while",lineNo:wo.lineNo,condExpr:ht,body:dn.ops}),no=dn.nextIdx;continue}const We=fr.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(We){const qt=String(We[1]||"").toLowerCase(),ht=Gr(We[2]||""),dn=String(ht[0]||"").trim(),Ut=Dt(dn);if(!dn){gn(`array.${qt} requires array name`,wo.lineNo),no+=1;continue}if(!!Ct[Ut]||((gl=Ze[Ut])==null?void 0:gl.kind)==="string"){gn(`array.${qt} on string arrays is not supported inside functions`,wo.lineNo),no+=1;continue}if(!Ze[Ut]&&!Je[Ut]){gn(`array.${qt} unknown array "${dn}"`,wo.lineNo),no+=1;continue}if(!Ze[Ut]&&Je[Ut]&&Eo(Ut,Je[Ut].length,Je[Ut]),qt==="push"||qt==="unshift"||qt==="insert"){const Gt=Ze[Ut];if(Gt){const en=Math.min(xs,Math.max(Gt.capacity,Gt.size+_o));Lr(Ut,en)}}if(qt==="resize"){const Gt=Ze[Ut];if(Gt){const en=String(ht[1]||"0"),cs=oo(en);if(cs!=null){const ps=Math.min(xs,Math.max(Gt.capacity,Math.floor(cs)));Lr(Ut,ps)}}}Fa(Ut);const rs={};qt==="push"||qt==="unshift"?rs.value=ht[1]:qt==="insert"?(rs.index=ht[1],rs.value=ht[2]):qt==="remove"?rs.index=ht[1]:qt==="resize"&&(rs.size=ht[1]);const _t=dc(Ut,qt,rs,wo.lineNo);if(!_t){no+=1;continue}_t.forEach(Gt=>{Oo.push({kind:"assign",name:Gt.name,op:Gt.op,expr:Gt.rhs,lineNo:Gt.lineNo})}),no+=1;continue}const xt=fr.match(/^array\.set\s*\((.*)\)\s*$/i);if(xt){const qt=Gr(xt[1]||""),ht=String(qt[0]||"").trim(),dn=String(qt[1]||"").trim(),Ut=String(qt[2]||"").trim();if(!ht||!dn||!Ut){gn("array.set(name, index, value) requires 3 args",wo.lineNo),no+=1;continue}const Xn=Dt(ht);if(!Ze[Xn]&&!Je[Xn]&&!Ct[Xn]){gn(`array.set unknown array "${ht}"`,wo.lineNo),no+=1;continue}if(Ct[Xn]){gn("array.set on string arrays is not supported inside functions",wo.lineNo),no+=1;continue}!Ze[Xn]&&Je[Xn]&&Eo(Xn,Je[Xn].length,Je[Xn]);const rs=So(dn,`${Xn}_idx`),_t=Fi(rs),Gt=So(Ut,`${Xn}_set`),en=(Ms=Ze[Xn])==null?void 0:Ms.sizeSeries,cs=en!=null?`(${_t}) >= 0 and (${_t}) < ${en}`:void 0,ps=uc(Xn,_t,Gt,cs);if(!ps){gn("array.set index must be within array size",wo.lineNo),no+=1;continue}ps.forEach((vo,Ko)=>{Oo.push({kind:"assign",name:Rt(Xn,Ko),op:":=",expr:vo,lineNo:wo.lineNo})}),no+=1;continue}const Ht=fr.match(be);if(Ht){const qt=Ht[3];if(Pi(qt)){gn(`Loop variable "${qt}" is read-only`,wo.lineNo),no+=1;continue}const ht=Ht[4],dn=String(Ht[5]||"").trim(),Ut=String(Ht[1]||"").trim().toLowerCase(),Xn=Ut==="var"||Ut==="varip"?Ut:void 0;Fn=wo.lineNo;const rs=So(dn,qt);Oo.push({kind:"assign",name:qt,op:ht,decl:Xn,expr:rs,lineNo:wo.lineNo}),no+=1;continue}if(vs!=null&&wo.lineNo===vs){Oo.push({kind:"return",expr:G(fr,`${se.name}_return`),lineNo:wo.lineNo}),no+=1;continue}gn(`Unsupported statement inside function "${se.name}": ${wo.text}`,wo.lineNo),no+=1}return{ops:Oo,nextIdx:no}};if(!se.bodyLines||!se.bodyLines.length){const Ge=G(se.body,`${se.name}_return`);return se.bodyPlan={name:se.name,args:se.args,lineNo:se.lineNo,body:[{kind:"return",expr:Ge,lineNo:se.lineNo}]},se.bodyPlan}const Fe=se.bodyLines.map(Ge=>({text:String(Ge.text||""),lineNo:Ge.lineNo,indent:Ge.indent})).filter(Ge=>String(Ge.text||"").trim()&&!String(Ge.text||"").trim().startsWith("//")),yt=((pt=Fe[0])==null?void 0:pt.indent)??0;let vt=null;for(let Ge=Fe.length-1;Ge>=0;Ge--){const sn=Fe[Ge];if(sn.indent===yt){vt={text:String(sn.text||"").trim(),lineNo:sn.lineNo};break}}const jt=(vt==null?void 0:vt.text)??"",ye=/^if\b/i.test(jt),E=/^switch\b/i.test(jt),me=/^for\b/i.test(jt),Se=/^while\b/i.test(jt),Ve=ye||E||me||Se,Ye=/^return\b/i.test(jt),at=vt&&!Ye&&!be.test(jt)&&(!Ve||ye||E)?vt.lineNo:null,Re=J(Fe,0,yt-1,[],at),De=Ge=>{for(const sn of Ge){if(sn.kind==="return")return!0;if(sn.kind==="if"){for(const Un of sn.branches)if(De(Un.body))return!0}if((sn.kind==="for"||sn.kind==="while")&&De(sn.body))return!0}return!1};if(!De(Re.ops))if(vt&&be.test(jt)){const Ge=jt.match(be),sn=(Ge==null?void 0:Ge[3])||"";sn&&Re.ops.push({kind:"return",expr:G(sn,`${se.name}_return`),lineNo:vt.lineNo})}else(!vt||Ve)&&(gn(`Function "${se.name}" requires a return expression`,se.lineNo),Re.ops.push({kind:"return",expr:"na",lineNo:se.lineNo}));return se.bodyPlan={name:se.name,args:se.args,lineNo:se.lineNo,body:Re.ops},se.bodyPlan},qn=(se,be)=>se,On=se=>String(se||"").replace(/\barray\.size\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\)/gi,(be,G)=>{const re=Dt(String(G)),we=Ze[re];if(we!=null&&we.dynamic)return be;const J=Je[re],Fe=Ct[re],yt=(we==null?void 0:we.size)??(J==null?void 0:J.length)??(Fe==null?void 0:Fe.length);return Number.isFinite(yt)?String(yt):be}),bn=se=>{switch(se.kind){case"NumberLiteral":return se.value;case"Identifier":{const be=Dt(se.name);if(be==="true")return 1;if(be==="false")return 0;if(be==="na"||be==="nan")return NaN;const G=ft[be]??ft[se.name],re=typeof G=="number"?G:Number(G);return Number.isFinite(re)?re:null}case"MemberExpression":case"IndexExpression":return null;case"UnaryExpression":{if(se.operator!=="not")return null;const be=bn(se.expr);return be==null?null:Number.isFinite(be)&&be!==0?0:1}case"BinaryExpression":{const be=bn(se.left),G=bn(se.right);if(be==null||G==null)return null;switch(se.operator){case"+":return be+G;case"-":return be-G;case"*":return be*G;case"/":return G===0?NaN:be/G;case"%":return G===0?NaN:be%G;case">":return Number.isFinite(be)&&Number.isFinite(G)&&be>G?1:0;case"<":return Number.isFinite(be)&&Number.isFinite(G)&&be<G?1:0;case">=":return Number.isFinite(be)&&Number.isFinite(G)&&be>=G?1:0;case"<=":return Number.isFinite(be)&&Number.isFinite(G)&&be<=G?1:0;case"==":return Number.isFinite(be)&&Number.isFinite(G)&&Math.abs(be-G)<1e-9?1:0;case"!=":return Number.isFinite(be)&&Number.isFinite(G)&&Math.abs(be-G)>=1e-9?1:0;case"and":return Number.isFinite(be)&&be!==0&&Number.isFinite(G)&&G!==0?1:0;case"or":return Number.isFinite(be)&&be!==0||Number.isFinite(G)&&G!==0?1:0;default:return null}}case"CallExpression":{const be=se.callee.toLowerCase();if(be==="iff"&&se.args.length===3){const J=bn(se.args[0]);return J==null?null:bn(J!==0?se.args[1]:se.args[2])}const G=se.args.map(J=>bn(J));if(G.some(J=>J==null))return null;const re=G[0],we=G[1];switch(be){case"min":return Math.min(re,we);case"max":return Math.max(re,we);case"abs":return Math.abs(re);case"ceil":return Math.ceil(re);case"floor":return Math.floor(re);case"round":return Math.round(re);case"sqrt":return Math.sqrt(re);case"pow":return Math.pow(re,we);default:return null}}default:return null}};let Fn=null;const Xs=(se,be)=>{if(be==null)return;let G;try{G=Lp(se)}catch{return}const re=(Fe,yt)=>{Fe!=null&&(!Number.isFinite(Fe)||!Number.isInteger(Fe)||Fe<1)&&e.push({message:yt,line:be})},we=(Fe,yt)=>{Fe!=null&&(!Number.isFinite(Fe)||!Number.isInteger(Fe)||Fe<0)&&e.push({message:yt,line:be})},J=Fe=>{switch(Fe.kind){case"MemberExpression":J(Fe.object);return;case"IndexExpression":J(Fe.object),J(Fe.index);return;case"UnaryExpression":J(Fe.expr);return;case"BinaryExpression":J(Fe.left),J(Fe.right);return;case"CallExpression":{const yt=Fe.callee.toLowerCase();if(yt==="williamsr"&&Fe.args.length>=1){const vt=Fe.args.length===1?Fe.args[0]:Fe.args[3];re(vt?bn(vt):null,a)}yt==="aroon"&&Fe.args.length>=1&&re(bn(Fe.args[0]),l),yt==="dmi"&&Fe.args.length>=2&&(re(bn(Fe.args[0]),c),re(bn(Fe.args[1]),f)),yt==="adx"&&Fe.args.length>=1&&re(bn(Fe.args[0]),u),yt==="plus_di"&&Fe.args.length>=1&&re(bn(Fe.args[0]),d),yt==="minus_di"&&Fe.args.length>=1&&re(bn(Fe.args[0]),h),yt==="dx"&&Fe.args.length>=1&&re(bn(Fe.args[0]),m),yt==="aroonosc"&&Fe.args.length>=1&&re(bn(Fe.args[0]),g),yt==="sum"&&Fe.args.length>=2&&re(bn(Fe.args[1]),P),yt==="highest"&&Fe.args.length>=2&&re(bn(Fe.args[1]),w),yt==="lowest"&&Fe.args.length>=2&&re(bn(Fe.args[1]),C),yt==="rising"&&Fe.args.length>=2&&re(bn(Fe.args[1]),I),yt==="falling"&&Fe.args.length>=2&&re(bn(Fe.args[1]),A),yt==="valuewhen"&&Fe.args.length>=3&&we(bn(Fe.args[2]),M),Fe.args.forEach(vt=>J(vt));return}default:return}};J(G)},oo=se=>{const be=Tr(String(se||"").trim());if(!be)return null;const G=be.match(/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g)||[];for(const vt of G){const jt=Dt(vt);if(bt[jt])return null}const re=rh(be);if(re!=null)return re;const we=Dt(be),J=ft[we]??ft[be],Fe=typeof J=="number"?J:Number(J);if(Number.isFinite(Fe))return Fe;const yt=On(dy(be));try{const vt=Lp(yt),jt=bn(vt);return Number.isFinite(jt)?jt:null}catch{return null}},Yn=se=>{const be=Tr(String(se||"").trim());if(!be)return null;const G=rh(be);if(G!=null)return G;const re=Dt(be),we=ft[re]??ft[be],J=typeof we=="number"?we:Number(we);if(Number.isFinite(J))return J;const Fe=On(dy(be));try{const yt=Lp(Fe),vt=bn(yt);return Number.isFinite(vt)?vt:null}catch{return null}},_o=32,xs=1024,Rt=(se,be)=>`__arr_${se}_${be}`,un=se=>`__arr_${se}__size`,qs=se=>{const be=Dt(se),G=Ct[be];if(G)for(let re=0;re<G.length;re++)ft[Rt(be,re)]=G[re]??""},ri=(se,be)=>{const G=un(se),re=Ke[G];if(typeof re=="number")return ze[re].initExpr||(ze[re].initExpr=String(be)),G;const we=ze.length;return Ke[G]=we,ze.push({name:G,initExpr:String(be),updateExpr:G,selfMode:"current"}),G},Eo=(se,be,G,re)=>{const we=Dt(se),J=Math.max(0,Math.floor(be)),Fe=Ze[we],yt=re??J,vt=Math.min(xs,Math.max((Fe==null?void 0:Fe.capacity)??0,Math.floor(yt))),jt=ri(we,Math.max((Fe==null?void 0:Fe.size)??0,J)),ye=Fe?Fe.elements.slice():[];for(let E=ye.length;E<vt;E++){const me=Rt(we,E);if(ye.push(me),me in Ke){if(G&&G[E]!=null){const Se=Ke[me];ze[Se].initExpr||(ze[Se].initExpr=String(G[E]))}}else{const Se=ze.length;Ke[me]=Se;const Ve=G&&G[E]!=null?String(G[E]):void 0;ze.push({name:me,initExpr:Ve,updateExpr:me,selfMode:"current"})}}return Ze[we]={size:Math.max((Fe==null?void 0:Fe.size)??0,J),capacity:vt,elements:ye,sizeSeries:jt,dynamic:(Fe==null?void 0:Fe.dynamic)??!1,kind:(Fe==null?void 0:Fe.kind)??"number"},{key:we,elements:ye}},Ia=(se,be,G,re)=>{const we=Dt(se),J=Math.max(0,Math.floor(be)),Fe=Ze[we],yt=re??Math.max(J,1),vt=Math.min(xs,Math.max((Fe==null?void 0:Fe.capacity)??0,Math.floor(yt))),jt=ri(we,Math.max((Fe==null?void 0:Fe.size)??0,J)),ye=Fe?Fe.elements.slice():[];for(let E=ye.length;E<vt;E++){const me=Rt(we,E);if(ye.push(me),me in Ke){if(G&&G[E]!=null){const Se=Ke[me];ze[Se].initExpr||(ze[Se].initExpr=JSON.stringify(G[E]))}}else{const Se=ze.length;Ke[me]=Se;const Ve=G&&G[E]!=null?JSON.stringify(G[E]):void 0;ze.push({name:me,initExpr:Ve,updateExpr:me,selfMode:"current"})}}return Ze[we]={size:Math.max((Fe==null?void 0:Fe.size)??0,J),capacity:vt,elements:ye,sizeSeries:jt,dynamic:(Fe==null?void 0:Fe.dynamic)??!1,kind:"string"},{key:we,elements:ye}},Lr=(se,be)=>{const G=Dt(se),re=Ze[G];re&&(re.capacity>=be||Eo(G,re.size,void 0,be))},Qa=(se,be)=>{const G=Dt(se),re=Ze[G];re&&(re.capacity>=be||Ia(G,re.size,void 0,be))},yr=(se,be)=>{var J,Fe,yt,vt;const G=oo(be);if(G==null)return null;const re=G;if(!Number.isFinite(re)||!Number.isInteger(re))return null;const we=((J=Ze[se])==null?void 0:J.capacity)??((Fe=Ze[se])==null?void 0:Fe.size)??((yt=Je[se])==null?void 0:yt.length)??((vt=Ct[se])==null?void 0:vt.length)??0;return re<0||we<=0||re>=we?null:re},Fi=se=>{const be=String(se||"").trim();return!be||/^__arr_index\s*\(/i.test(be)?se:`__arr_index(${se})`},Rc=se=>{const be=String(se||"").trim();return!be||/^__arr_index_str\s*\(/i.test(be)?se:`__arr_index_str(${se})`},Cu=(se,be)=>{const G=Je[se],re=Ct[se],we=Ze[se],J=(we==null?void 0:we.kind)==="string"||!!re&&!G,Fe=(we==null?void 0:we.capacity)??(we==null?void 0:we.size)??(G==null?void 0:G.length)??(re==null?void 0:re.length)??0;if(!Fe)return null;const yt=J?Rc(be):Fi(be);if(re&&!we){const E=String(re.length);let me="na";for(let Se=Fe-1;Se>=0;Se--){const Ve=E?`(${E}) > ${Se}`:"1",Ye=JSON.stringify(re[Se]??"");me=`iff(((${yt}) == ${Se}) and (${Ve}), ${Ye}, ${me})`}return me}J?Ia(se,(we==null?void 0:we.size)??Fe,re,Fe):Eo(se,(we==null?void 0:we.size)??Fe,G,Fe);const vt=Ze[se],jt=vt!=null&&vt.dynamic?vt.sizeSeries:String((vt==null?void 0:vt.size)??(G==null?void 0:G.length)??Fe);let ye="na";for(let E=Fe-1;E>=0;E--){const me=jt?`(${jt}) > ${E}`:"1";ye=`iff(((${yt}) == ${E}) and (${me}), ${Rt(se,E)}, ${ye})`}return ye},uc=(se,be,G,re,we)=>{const J=Je[se],Fe=Ct[se],yt=Ze[se],vt=(yt==null?void 0:yt.kind)==="string"||!!Fe&&!J,jt=(yt==null?void 0:yt.capacity)??(yt==null?void 0:yt.size)??(J==null?void 0:J.length)??(Fe==null?void 0:Fe.length)??0;if(!jt)return null;vt?Ia(se,(yt==null?void 0:yt.size)??jt,Fe,jt):Eo(se,(yt==null?void 0:yt.size)??jt,J,jt);const ye=(we==null?void 0:we.normalizeIndex)===!1?be:vt?Rc(be):Fi(be),E=[];for(let me=0;me<jt;me++){const Se=re?`(${re}) and `:"";E.push(`iff(${Se}(${ye}) == ${me}, ${G}, ${Rt(se,me)})`)}return E},Fl=se=>String(se||"").replace(/\barray\.size\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\)/gi,(be,G)=>{const re=Dt(String(G)),we=Ze[re];if(we)return we.sizeSeries;const J=Je[re];if(J)return String(J.length);const Fe=Ct[re];return Fe?String(Fe.length):be}),jc=(se,be,G)=>{const re=Ze[G],we=Je[G],J=(re==null?void 0:re.capacity)??(re==null?void 0:re.size)??(we==null?void 0:we.length)??0;if(!J)return null;const Fe=`array.size(${be})`,yt=(ye,E)=>{const me=`array.get(${be}, ${ye})`,Se=E?`(${me} * ${me})`:me;return`iff(${Fe} > ${ye}, ${Se}, 0)`};if(se==="sum"||se==="avg"||se==="stdev"){let ye=yt(0,!1);for(let Ve=1;Ve<J;Ve++)ye=`(${ye} + ${yt(Ve,!1)})`;if(se==="sum")return ye;if(se==="avg")return`iff(${Fe} > 0, (${ye}) / ${Fe}, na)`;let E=yt(0,!0);for(let Ve=1;Ve<J;Ve++)E=`(${E} + ${yt(Ve,!0)})`;const me=`iff(${Fe} > 0, (${ye}) / ${Fe}, na)`;return`sqrt(max(${`iff(${Fe} > 0, (${E}) / ${Fe} - (${me} * ${me}), na)`}, 0))`}const vt=se==="min"?"1000000000000":"-1000000000000";let jt=`iff(${Fe} > 0, array.get(${be}, 0), ${vt})`;for(let ye=1;ye<J;ye++){const E=`iff(${Fe} > ${ye}, array.get(${be}, ${ye}), ${vt})`;jt=`${se}(${jt}, ${E})`}return jt},nd=se=>{const be=String(se||"");let G="",re=0,we=null;const J=be.toLowerCase(),Fe=yt=>/[a-z0-9_$]/i.test(yt);for(;re<be.length;){const yt=be[re];if(we){G+=yt,yt===we&&be[re-1]!=="\\"&&(we=null),re+=1;continue}if(yt==="'"||yt==='"'){we=yt,G+=yt,re+=1;continue}const vt=J.slice(re).match(/^array\.(sum|min|max|avg|stdev)\b/);if(!vt||re>0&&Fe(J[re-1]||"")){G+=yt,re+=1;continue}const jt=String(vt[1]||"").toLowerCase();let ye=re+vt[0].length;for(;ye<be.length&&/\s/.test(be[ye]);)ye+=1;if(be[ye]!=="("){G+=yt,re+=1;continue}let E=0,me=ye,Se=null;for(;me<be.length;me++){const pt=be[me];if(Se){pt===Se&&be[me-1]!=="\\"&&(Se=null);continue}if(pt==="'"||pt==='"'){Se=pt;continue}if(pt==="(")E+=1;else if(pt===")"&&(E-=1,E===0))break}if(me>=be.length){G+=be.slice(re);break}const Ve=be.slice(ye+1,me),Ye=Gr(Ve),at=String(Ye[0]||"").trim();if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(at)){G+=be.slice(re,me+1),re=me+1;continue}const Re=Dt(at),De=jc(jt,at,Re);if(!De){G+=be.slice(re,me+1),re=me+1;continue}G+=`(${De})`,re=me+1}return G},Fa=se=>{const be=Ze[se];be&&(be.dynamic=!0)},dc=(se,be,G,re)=>{const we=Ze[se];if(!we)return null;const J=we.sizeSeries,Fe=J,yt=we.capacity,vt=[],jt=ye=>{ye.forEach((E,me)=>{vt.push({name:Rt(se,me),hasVar:!1,declaredType:"",op:":=",rhs:E,lineNo:re})})};if(be==="push"){const ye=So(String(G.value||"na"),`${se}_push`),E=`(${Fe}) < ${yt}`,me=uc(se,Fe,ye,E);return me&&jt(me),vt.push({name:J,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${E}, min(${J} + 1, ${yt}), ${J})`,lineNo:re}),vt}if(be==="pop")return vt.push({name:J,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${J} > 0, max(${J} - 1, 0), ${J})`,lineNo:re}),vt;if(be==="clear")return vt.push({name:J,hasVar:!1,declaredType:"",op:":=",rhs:"0",lineNo:re}),vt;if(be==="resize"){const ye=So(String(G.size||"0"),`${se}_resize`);return vt.push({name:J,hasVar:!1,declaredType:"",op:":=",rhs:`min(max(0, ${ye}), ${yt})`,lineNo:re}),vt}if(be==="shift"||be==="remove"){const ye=be==="shift"?"0":So(String(G.index||"0"),`${se}_remove`),E=Fi(ye),me=`(${E}) >= 0 and (${E}) < ${Fe}`,Se=[];for(let Ve=0;Ve<yt;Ve++){const Ye=Ve<yt-1?`(${me}) and (${Ve} >= (${E})) and (${Ve} < (${Fe} - 1))`:"0",at=Ve<yt-1?Rt(se,Ve+1):Rt(se,Ve);Se.push(`iff(${Ye}, ${at}, ${Rt(se,Ve)})`)}return jt(Se),vt.push({name:J,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${me}, max(${J} - 1, 0), ${J})`,lineNo:re}),vt}if(be==="unshift"||be==="insert"){const ye=be==="unshift"?"0":So(String(G.index||"0"),`${se}_insert`),E=Fi(ye),me=So(String(G.value||"na"),`${se}_insert_val`),Se=`(${prevSize}) < ${yt}`,Ve=`(${E}) >= 0 and (${E}) <= ${Fe}`,Ye=[];for(let at=0;at<yt;at++){const Re=`(${at} == (${E}))`,De=`(${at} > (${E})) and (${at} <= ${Fe})`,pt=at>0?Rt(se,at-1):Rt(se,at);Ye.push(`iff(${Se} and ${Ve} and ${Re}, ${me}, iff(${Se} and ${Ve} and ${De}, ${pt}, ${Rt(se,at)}))`)}return jt(Ye),vt.push({name:J,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${Se} and ${Ve}, min(${J} + 1, ${yt}), ${J})`,lineNo:re}),vt}return null},Bc=(se,be,G)=>{const re=Ze[be];if(!re)return null;Eo(se,re.size,void 0,re.capacity);const we=Ze[se];if(!we)return null;const J=[];for(let Fe=0;Fe<we.capacity;Fe++)J.push({name:Rt(se,Fe),hasVar:!1,declaredType:"",op:":=",rhs:Rt(be,Fe),lineNo:G});return J.push({name:we.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:re.sizeSeries,lineNo:G}),J},rd=(se,be,G,re)=>{const we=Ze[be],J=Ze[G];if(!we||!J)return null;const Fe=Math.min(xs,we.capacity+J.capacity);Eo(se,Math.min(Fe,we.size+J.size),void 0,Fe);const yt=Ze[se];if(!yt)return null;const vt=[];for(let jt=0;jt<yt.capacity;jt++){const ye=`iff(${jt} < ${we.sizeSeries}, array.get(${be}, ${jt}), iff(${jt} < (${we.sizeSeries} + ${J.sizeSeries}), array.get(${G}, ${jt} - ${we.sizeSeries}), na))`;vt.push({name:Rt(se,jt),hasVar:!1,declaredType:"",op:":=",rhs:So(ye,`${se}_concat_${jt}`),lineNo:re})}return vt.push({name:yt.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:`min(${we.sizeSeries} + ${J.sizeSeries}, ${Fe})`,lineNo:re}),Fa(se),vt},uf=se=>{const be=String(se||"");let G="",re=0,we=null;const J=be.toLowerCase();for(;re<be.length;){const Fe=be[re];if(we){G+=Fe,Fe===we&&be[re-1]!=="\\"&&(we=null),re+=1;continue}if(Fe==="'"||Fe==='"'){we=Fe,G+=Fe,re+=1;continue}if(!(J.startsWith("array.get",re)&&(re===0||!/[a-z0-9_$]/i.test(J[re-1]||"")))){G+=Fe,re+=1;continue}let vt=re+9;for(;vt<be.length&&/\s/.test(be[vt]);)vt+=1;if(be[vt]!=="("){G+=Fe,re+=1;continue}let jt=0,ye=vt,E=null;for(;ye<be.length;ye++){const vs=be[ye];if(E){vs===E&&be[ye-1]!=="\\"&&(E=null);continue}if(vs==="'"||vs==='"'){E=vs;continue}if(vs==="(")jt+=1;else if(vs===")"&&(jt-=1,jt===0))break}if(ye>=be.length){G+=be.slice(re);break}const me=be.slice(vt+1,ye),Se=Gr(me),Ve=String(Se[0]||"").trim(),Ye=String(Se[1]||"").trim();if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Ve)||!Ye){G+=be.slice(re,ye+1),re=ye+1;continue}const at=Dt(Ve),Re=Je[at],De=Ct[at],pt=Ze[at];if(!((pt==null?void 0:pt.capacity)??(pt==null?void 0:pt.size)??(Re==null?void 0:Re.length)??(De==null?void 0:De.length)??0)){G+=be.slice(re,ye+1),re=ye+1;continue}const sn=uf(Ye),Un=yr(at,sn);if(Un!=null){if(Ze[at])G+=Rt(at,Un);else if(Re){const vs=Re[Un];G+=typeof vs=="number"&&Number.isFinite(vs)?String(vs):"na"}else De?G+=JSON.stringify(De[Un]??""):G+=Rt(at,Un);re=ye+1;continue}const Zs=Cu(at,sn);G+=Zs??be.slice(re,ye+1),re=ye+1}return G},So=(se,be)=>(()=>{let G=Ft(se,be);const re=Object.entries(pe);return re.length&&re.forEach(([we,J])=>{G=G.replace(new RegExp(`\\b${we}\\.`,"gi"),J.replacement)}),G=qn(G),G=dy(G),G=G.replace(/\bta\./gi,""),G=G.replace(/\bmath\./gi,""),G=G.replace(/\bstr\./gi,""),G=G.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),G=G.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),G=G.replace(/\bstrategy_(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),G=nd(G),G=Fl(G),G=uf(G),G=Wd(G,Fn),Xs(G,Fn),G})(),Ll=(se,be)=>{if(se==null)return{};const G=String(se).trim();return G.startsWith('"')&&G.endsWith('"')||G.startsWith("'")&&G.endsWith("'")?{text:Tr(G)}:G?{textExpr:So(G,be)}:{}},ya=se=>se.when&&Yu(B_(So(String(se.when),"when")))||void 0,hc=se=>Tr(String(se.pane??oe)).toLowerCase()==="sub"?"sub":"main",Pa=(se,be)=>{if(se.pane!=null)return hc(se);const G=be?Dt(String(be)):"";return G&&Xe[G]||oe},Yr=(se,be,G)=>{if(!se)return e.push({message:`${be} requires a value`,line:G}),null;const re=So(String(se),be);return re||(e.push({message:`${be} requires a value`,line:G}),null)},el=se=>{if(!se)return null;const be=Tr(String(se||"")).trim();return!be||be.toLowerCase()==="na"?null:Dt(be)},Yl=se=>{if(se==null)return;const be=Tr(String(se)).trim();return be?be.toLowerCase():void 0},Vu=se=>{if(!se)return;if(Array.isArray(se)){const G=se.map(re=>String(re||"").trim().toLowerCase()).filter(Boolean);return G.length?G:void 0}const be=String(se||"").split(",").map(G=>G.trim().toLowerCase()).filter(Boolean);return be.length?be:void 0},Iu=(se,be,G,re,we,J)=>{const Fe=[];for(let yt=be;yt+1<se.length;yt+=2){const vt=Yr(se[yt],`${re} x`,G),jt=Yr(se[yt+1],`${re} y`,G);!vt||!jt||Fe.push({x:vt,y:jt,xloc:we,yloc:J})}return Fe},Ro=se=>{if(!se)return;const be=String(se||"").trim(),G=be.match(/^color\.new\s*\((.*)\)\s*$/i);if(G){const jt=Gr(G[1]||""),ye=Ro(jt[0]),E=jt[1]!=null?Tr(String(jt[1])):"",me=rh(E);return G0(ye,me??void 0)}const re=be.match(/^color\.from_hex\s*\((.*)\)\s*$/i);if(re){const jt=Gr(re[1]||""),ye=String(jt[0]??"").trim(),E=ye.startsWith('"')||ye.startsWith("'"),me=Tr(ye).trim();if(!E){Fn!=null&&!s.has(Fn)&&(t.push({message:"Color variables are limited. Use inline color.rgb/color.new/hex or input.color().",line:Fn}),s.add(Fn));return}if(!/^#[0-9a-fA-F]{6}$/.test(me)){Fn!=null&&e.push({message:'color.from_hex expects "#RRGGBB"',line:Fn});return}return me}const we=be.match(/^color\.rgb\s*\((.*)\)\s*$/i);if(we){const jt=Gr(we[1]||""),ye=rh(Tr(String(jt[0]??""))),E=rh(Tr(String(jt[1]??""))),me=rh(Tr(String(jt[2]??""))),Se=rh(Tr(String(jt[3]??"")));if(typeof ye=="number"&&typeof E=="number"&&typeof me=="number"){const Ve=Math.max(0,Math.min(255,Math.round(ye))),Ye=Math.max(0,Math.min(255,Math.round(E))),at=Math.max(0,Math.min(255,Math.round(me)));if(typeof Se=="number"&&Number.isFinite(Se)){const Re=Math.max(0,Math.min(255,Math.round(Se))),De=Math.max(0,Math.min(1,Re/255));return`rgba(${Ve},${Ye},${at},${De})`}return`rgb(${Ve},${Ye},${at})`}}const J=be.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(J&&bt[Dt(J[0])]==="color")return`\${${J[0]}}`;const Fe=$5(be);if(Fe)return Fe;const yt=Tr(be);if(yt.startsWith("#")||yt.startsWith("rgb"))return yt;const vt=yt.toLowerCase();vt&&vt!=="na"&&Fn!=null&&!s.has(Fn)&&(t.push({message:"Color variables are limited. Use inline color.rgb/color.new/hex or input.color().",line:Fn}),s.add(Fn))},zr=(se,be)=>{if(!se)return{};const G=So(String(se),be);if(!G)return{};const re=oo(G);return re!=null?{value:re}:{expr:G}},kl=(se,be)=>{if(se==null)return{};const G=H1(String(se));return G!=null?{value:G}:zr(se,be)},Md=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=u0(G);return re||e.push({message:`line style not supported: ${G}`,line:be}),re},nf=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=Rx(G);return re||e.push({message:`line extend not supported: ${G}`,line:be}),re},zf=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=d0(G);return re||e.push({message:`line xloc not supported: ${G}`,line:be}),re},df=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=d0(G);return re||e.push({message:`label xloc not supported: ${G}`,line:be}),re},Pu=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=d0(G);return re||e.push({message:`box xloc not supported: ${G}`,line:be}),re},Dd=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=Rx(G);return re||e.push({message:`box extend not supported: ${G}`,line:be}),re},yf=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=u0(G);if(re&&re.startsWith("arrow")){e.push({message:`box border_style not supported: ${G}`,line:be});return}return re||e.push({message:`box border_style not supported: ${G}`,line:be}),re},$n=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=d_(G);return re||e.push({message:`box text_halign not supported: ${G}`,line:be}),re},ws=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=q1(G);return re||e.push({message:`box text_valign not supported: ${G}`,line:be}),re},Us=(se,be)=>{if(se==null)return{};const G=String(se??"").trim(),re=D5(G);if(re!=null)return{value:re};const we=zr(se,"box.text_size");if(we.value!=null){const J=we.value;!Number.isFinite(J)||!Number.isInteger(J)?e.push({message:"box text_size must be an integer",line:be}):we.value=Math.max(8,Math.min(32,J))}return G&&re==null&&/^size\./i.test(G)&&e.push({message:`box text_size not supported: ${G}`,line:be}),we},Dn=(se,be)=>{const G=zr(se,"box.border_width");if(se!=null&&String(se).trim()){const re=G.value;if(re!=null)(!Number.isFinite(re)||!Number.isInteger(re)||re<0||re>4)&&e.push({message:"box border_width must be an integer between 0 and 4",line:be});else{const we=So(String(se),"box.border_width"),J=String(we??se).trim().toLowerCase();(J==="na"||J==="nan")&&e.push({message:"box border_width must be an integer between 0 and 4",line:be})}}return G},ni=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=String(G).toLowerCase().replace(/^location\./,""),we=re.includes("below")||re.includes("bottom")||re.includes("low"),J=re.includes("above")||re.includes("top")||re.includes("high"),Fe=we?"belowbar":J?"abovebar":void 0;return Fe||e.push({message:`label location not supported: ${G}`,line:be}),Fe},mo=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=d_(G);return re||e.push({message:`label textalign not supported: ${G}`,line:be}),re},sr=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=rQ(G);return re||e.push({message:`label style not supported: ${G}`,line:be}),re},or=(se,be)=>{if(se==null)return{};const G=String(se??"").trim(),re=D5(G);if(re!=null)return{value:re};const we=zr(se,"label.size");if(we.value!=null){const J=we.value;!Number.isFinite(J)||!Number.isInteger(J)?e.push({message:"label size must be an integer",line:be}):we.value=Math.max(8,Math.min(32,J))}return G&&re==null&&/^size\./i.test(G)&&e.push({message:`label size not supported: ${G}`,line:be}),we},hl=(se,be)=>{const G=String(se??"").trim();if(!G)return;const re=u_(G);if(!re){e.push({message:`label yloc not supported: ${G}`,line:be});return}return re||void 0},Oi=(se,be)=>{const G=zr(se,"line.width");if(se!=null&&String(se).trim()){const re=G.value;if(re!=null)(!Number.isFinite(re)||re<1||!Number.isInteger(re))&&e.push({message:"line width must be >= 1",line:be});else{const we=So(String(se),"line.width"),J=String(we??se).trim().toLowerCase();(J==="na"||J==="nan")&&e.push({message:"line width must be >= 1",line:be})}}return G},si=se=>{const be=Tr(String(se||"").trim()).toLowerCase();return be?be==="na"||be==="nan"||be==="inf"||be==="+inf"||be==="-inf"||be==="infinity"||be==="+infinity"||be==="-infinity":!1},Wo=(se,be,G)=>{if(se==null)return;const re=String(se||"").trim();if(!re)return;if(be==="time"){si(re)&&e.push({message:"line x must be a number when xloc=time",line:G});return}const we=oo(re);if(we!=null){(!Number.isFinite(we)||!Number.isInteger(we))&&e.push({message:"line x must be an integer when xloc=bar_index",line:G});return}si(re)&&e.push({message:"line x must be an integer when xloc=bar_index",line:G})},Ua=(se,be,G)=>{if(se==null)return;const re=String(se||"").trim();if(!re)return;if(be==="time"){si(re)&&e.push({message:"label x must be a number when xloc=time",line:G});return}const we=oo(re);if(we!=null){(!Number.isFinite(we)||!Number.isInteger(we))&&e.push({message:"label x must be an integer when xloc=bar_index",line:G});return}si(re)&&e.push({message:"label x must be an integer when xloc=bar_index",line:G})},Hi=(se,be,G)=>{if(se==null)return;const re=String(se||"").trim();if(!re)return;if(be==="time"){si(re)&&e.push({message:"box x must be a number when xloc=time",line:G});return}const we=oo(re);if(we!=null){(!Number.isFinite(we)||!Number.isInteger(we))&&e.push({message:"box x must be an integer when xloc=bar_index",line:G});return}si(re)&&e.push({message:"box x must be an integer when xloc=bar_index",line:G})},to=(se,be)=>{const G=Ie(se);Array.isArray(G.runtimeDrawOps)||(G.runtimeDrawOps=[]),G.runtimeDrawOps.push(be)},Li=(se,be,G,re)=>{const we=Gr(se||""),J=su(we),Fe=we.filter(Un=>!zu(Un)),yt=Yr(Fe[0]??J.x1??J.x,"line.new x1",be),vt=Yr(Fe[1]??J.y1??J.y,"line.new y1",be),jt=Yr(Fe[2]??J.x2,"line.new x2",be),ye=Yr(Fe[3]??J.y2,"line.new y2",be);if(!yt||!vt||!jt||!ye)return!0;const E=hc(J),me=ya(J),Se=Oi(J.width??J.linewidth,be),Ve=Yg(J.layer??J.Layer),Ye=Kg(J.zindex??J.z_index??J.zIndex),at=Xg(J.include_in_autoscale??J.includeInAutoscale??J.autoscale),Re=Yl(J.group??J.group_id??J.groupId),De=Vu(J.tags??J.tag),pt=G?Dt(G):void 0;pt&&(Xe[pt]=E);const Ge=zf(J.xloc!=null?String(J.xloc):void 0,be),sn=Ge||"bar_index";return Wo(yt,sn,be),Wo(jt,sn,be),to(E,{kind:"line_new",assign:pt,once:re?!0:void 0,x1:yt,y1:vt,x2:jt,y2:ye,when:me,color:Ro(String(J.color??""))||void 0,width:Se.value,widthExpr:Se.expr,style:Md(J.style!=null?String(J.style):void 0,be)||void 0,extend:nf(J.extend!=null?String(J.extend):void 0,be)||void 0,xloc:Ge,layer:Ve,zIndex:Ye,includeInAutoscale:at,groupId:Re,tags:De}),!0},Vr=(se,be,G,re)=>{const we=Gr(se||""),J=su(we),Fe=we.filter(xa=>!zu(xa)),yt=Yr(Fe[0]??J.x,"label.new x",be);let vt=Yr(Fe[1]??J.y,"label.new y",be);if(!yt)return!0;const jt=Fe[2]??J.text??J.title??"",ye=Ll(String(jt||""),"label_text"),E=Ll(String(J.tooltip??""),"label_tooltip"),me=hc(J),Se=ya(J),Ve=hl(String(J.yloc??""),be)||ni(String(J.location??J.loc??""),be)||void 0;if(Ve&&(!vt||String(vt).trim().toLowerCase()==="na")&&(vt=Ve==="belowbar"?"low":Ve==="abovebar"?"high":vt),!vt)return!0;const Ye=or(J.size,be),at=Yg(J.layer??J.Layer),Re=Kg(J.zindex??J.z_index??J.zIndex),De=Xg(J.include_in_autoscale??J.includeInAutoscale??J.autoscale),pt=Yl(J.group??J.group_id??J.groupId),Ge=Vu(J.tags??J.tag),sn=J.wrap!=null?String(J.wrap).toLowerCase()==="true"||Number(J.wrap)===1:void 0,Un=zr(J.maxwidth??J.maxWidth,"label.max_width"),Zs=zr(J.bg_opacity??J.bgOpacity,"label.bg_opacity"),vs=zr(J.border_width??J.borderWidth,"label.border_width"),Oo=zr(J.radius,"label.radius"),Pi=zr(J.line_height??J.lineHeight,"label.line_height"),no=J.padding;let gl;if(no!=null){const xa=Number(no);if(Number.isFinite(xa))gl=xa;else{const ic=String(no).trim();if(ic.startsWith("{"))try{gl=JSON.parse(ic.replace(/([A-Za-z0-9_]+)\s*:/g,'"$1":'))}catch{gl=void 0}}}const Ms=G?Dt(G):void 0;Ms&&(Xe[Ms]=me);const wo=df(String(J.xloc??""),be)||void 0;return Ua(yt,wo||"bar_index",be),to(me,{kind:"label_new",assign:Ms,once:re?!0:void 0,x:yt,y:vt,when:Se,yloc:Ve,textAlign:mo(String(J.textalign??J.text_align??J.textAlign??""),be),tooltip:E.text,tooltipExpr:E.textExpr,text:ye.text,textExpr:ye.textExpr,color:Ro(String(J.color??""))||void 0,bgColor:Ro(String(J.bgcolor??J.bgColor??J.background_color??J.backgroundColor??""))||void 0,borderColor:Ro(String(J.bordercolor??J.border_color??J.borderColor??""))||void 0,textColor:Ro(String(J.textcolor??J.textColor??""))||void 0,style:sr(String(J.style??J.shape??""),be)||void 0,size:Ye.value??H1(String(J.size??"")),sizeExpr:Ye.expr,xloc:wo,layer:at,zIndex:Re,includeInAutoscale:De,groupId:pt,tags:Ge,wrap:sn,maxWidth:Un.value,bgOpacity:Zs.value,borderWidth:vs.value,radius:Oo.value,padding:gl,align:mo(String(J.align??J.textalign??J.textAlign??""),be)||void 0,valign:["top","middle","bottom"].includes(String(J.valign??"").toLowerCase())?String(J.valign).toLowerCase():void 0,lineHeight:Pi.value,fontFamily:J.font_family??J.fontFamily,fontSize:zr(J.font_size??J.fontSize,"label.font_size").value,fontWeight:J.font_weight??J.fontWeight,monospace:J.monospace!=null?String(J.monospace).toLowerCase()==="true"||Number(J.monospace)===1:void 0}),!0},ba=(se,be,G,re)=>{const we=Gr(se||""),J=su(we),Fe=we.filter(wo=>!zu(wo)),yt=Yr(Fe[0]??J.left,"box.new left",be),vt=Yr(Fe[1]??J.top,"box.new top",be),jt=Yr(Fe[2]??J.right,"box.new right",be),ye=Yr(Fe[3]??J.bottom,"box.new bottom",be);if(!yt||!vt||!jt||!ye)return!0;const E=hc(J),me=ya(J),Se=Dn(J.border_width??J.borderWidth,be),Ve=J.text??"",Ye=Ll(String(Ve||""),"box_text"),at=Ll(String(J.tooltip??""),"box_tooltip"),Re=Us(J.text_size??J.textSize,be),De=$n(String(J.text_halign??J.textHalign??""),be)||void 0,pt=ws(String(J.text_valign??J.textValign??""),be)||void 0,Ge=J.text_wrap??J.textWrap,sn=Ge!=null?Zg(String(Ge))??void 0:void 0,Un=Yg(J.layer??J.Layer),Zs=Kg(J.zindex??J.z_index??J.zIndex),vs=Xg(J.include_in_autoscale??J.includeInAutoscale??J.autoscale),Oo=Yl(J.group??J.group_id??J.groupId),Pi=Vu(J.tags??J.tag),no=G?Dt(G):void 0;no&&(Xe[no]=E);const gl=Pu(String(J.xloc??""),be)||void 0,Ms=gl||"bar_index";return Hi(yt,Ms,be),Hi(jt,Ms,be),to(E,{kind:"box_new",assign:no,once:re?!0:void 0,left:yt,top:vt,right:jt,bottom:ye,when:me,borderColor:Ro(String(J.border_color??J.borderColor??""))||void 0,width:Se.value,widthExpr:Se.expr,borderStyle:yf(String(J.border_style??J.borderStyle??""),be)||void 0,bgColor:Ro(String(J.bgcolor??J.bgColor??J.color??""))||void 0,text:Ye.text,textExpr:Ye.textExpr,tooltip:at.text,tooltipExpr:at.textExpr,textColor:Ro(String(J.text_color??J.textColor??""))||void 0,textSize:Re.value,textSizeExpr:Re.expr,textHalign:De,textValign:pt,textWrap:sn,extend:Dd(String(J.extend??""),be)||void 0,xloc:gl,layer:Un,zIndex:Zs,includeInAutoscale:vs,groupId:Oo,tags:Pi}),!0},qi=(se,be,G,re)=>{const we=Gr(se||""),J=su(we),Fe=we.filter(Zs=>!zu(Zs)),yt=Fe[0]??J.position??J.pos??"top_right",vt=Fe[1]??J.columns??J.cols,jt=Fe[2]??J.rows,ye=vt!=null?Number(vt):NaN,E=jt!=null?Number(jt):NaN;if(!Number.isFinite(ye)||!Number.isFinite(E))return e.push({message:"table.new(position, columns, rows) requires numeric columns/rows",line:be}),!0;const me=hc(J),Se=ya(J),Ve=zr(J.border_width??J.borderWidth,"table.border_width"),Ye=zr(J.frame_width??J.frameWidth,"table.frame_width"),at=kl(J.text_size??J.textSize,"table.text_size"),Re=Yg(J.layer??J.Layer),De=Kg(J.zindex??J.z_index??J.zIndex),pt=Xg(J.include_in_autoscale??J.includeInAutoscale??J.autoscale),Ge=Yl(J.group??J.group_id??J.groupId),sn=Vu(J.tags??J.tag),Un=G?Dt(G):void 0;return Un&&(Xe[Un]=me),to(me,{kind:"table_new",assign:Un,once:re?!0:void 0,when:Se,position:j5(String(yt))||Tr(String(yt)),columns:Math.max(1,Math.floor(ye)),rows:Math.max(1,Math.floor(E)),bgcolor:Ro(String(J.bgcolor??J.bgColor??""))||void 0,borderColor:Ro(String(J.border_color??J.borderColor??""))||void 0,borderWidth:Ve.value,borderWidthExpr:Ve.expr,textColor:Ro(String(J.text_color??J.textColor??""))||void 0,textSize:at.value,textSizeExpr:at.expr,textHalign:d_(String(J.text_halign??J.textHalign??""))||void 0,textValign:q1(String(J.text_valign??J.textValign??""))||void 0,frameColor:Ro(String(J.frame_color??J.frameColor??""))||void 0,frameWidth:Ye.value,frameWidthExpr:Ye.expr,layer:Re,zIndex:De,includeInAutoscale:pt,groupId:Ge,tags:sn}),!0},Wr=(se,be,G="table_cell")=>{const re=Gr(se||""),we=su(re),J=re.filter(Ge=>!zu(Ge)),Fe=J[0]??"",yt=el(String(Fe||""))||"",vt=J[1]??we.column??we.col,jt=J[2]??we.row,ye=vt!=null?Number(vt):NaN,E=jt!=null?Number(jt):NaN;if(!yt||!Number.isFinite(ye)||!Number.isFinite(E))return t.push({message:"table.cell(table, column, row, text) requires a table id and numeric column/row",line:be}),!0;const me=J[3]??we.text??we.title??"",Se=Ll(String(me||""),"table_cell_text"),Ve=kl(we.text_size??we.textSize,"table.cell_text_size"),Ye=zr(we.width,"table.cell_width"),at=zr(we.height,"table.cell_height"),Re=Pa(we,yt),De=we.tooltip!=null?Ll(String(we.tooltip),"table_cell_tooltip"):{},pt={kind:G,target:yt,targetExpr:Fe!=null?String(Fe):void 0,when:ya(we),column:Math.floor(ye),row:Math.floor(E),text:Se.text,textExpr:Se.textExpr,textColor:Ro(String(we.text_color??we.textColor??""))||void 0,textSize:Ve.value,textSizeExpr:Ve.expr,textHalign:d_(String(we.text_halign??we.textHalign??""))||void 0,textValign:q1(String(we.text_valign??we.textValign??""))||void 0,bgcolor:Ro(String(we.bgcolor??we.bgColor??""))||void 0,width:Ye.value,widthExpr:Ye.expr,height:at.value,heightExpr:at.expr,tooltip:De.text,tooltipExpr:De.textExpr};return to(Re,pt),!0},Kl=(se,be,G)=>{const re=Gr(be||""),we=su(re),J=re.filter(E=>!zu(E)),Fe=J[0],yt=el(Fe);if(!yt)return!0;const vt=String(se||"").toLowerCase().replace(/_/g,""),jt=Pa(we,yt),ye={kind:"line_set",target:yt,targetExpr:Fe!=null?String(Fe):void 0,when:ya(we)};if(vt==="x1")ye.x1=Yr(J[1],"line.set_x1",G);else if(vt==="y1")ye.y1=Yr(J[1],"line.set_y1",G);else if(vt==="x2")ye.x2=Yr(J[1],"line.set_x2",G);else if(vt==="y2")ye.y2=Yr(J[1],"line.set_y2",G);else if(vt==="xy1")ye.x1=Yr(J[1],"line.set_xy1 x",G),ye.y1=Yr(J[2],"line.set_xy1 y",G);else if(vt==="xy2")ye.x2=Yr(J[1],"line.set_xy2 x",G),ye.y2=Yr(J[2],"line.set_xy2 y",G);else if(vt==="xy")ye.x1=Yr(J[1],"line.set_xy x1",G),ye.y1=Yr(J[2],"line.set_xy y1",G),ye.x2=Yr(J[3],"line.set_xy x2",G),ye.y2=Yr(J[4],"line.set_xy y2",G);else if(vt==="color")ye.color=Ro(J[1]??we.color);else if(vt==="width"||vt==="linewidth"){const E=Oi(J[1]??we.width,G);ye.width=E.value,ye.widthExpr=E.expr}else if(vt==="style")ye.style=Md(J[1]??we.style,G)||void 0;else if(vt==="extend")ye.extend=nf(J[1]??we.extend,G)||void 0;else if(vt==="xloc")ye.xloc=zf(J[1]??we.xloc,G)||void 0;else return t.push({message:`Unsupported line.set_${se}()`,line:G}),!0;return to(jt,ye),!0},Wl=(se,be)=>{const G=Gr(se||""),re=su(G),J=G.filter(vt=>!zu(vt))[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe);return to(yt,{kind:"line_delete",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re)}),!0},Ic=(se,be,G,re)=>{const we=Gr(se||""),J=su(we),Fe=we.filter(Re=>!zu(Re)),yt=el(Fe[0]??J.line1??J.line_1??J.l1),vt=el(Fe[1]??J.line2??J.line_2??J.l2);if(!yt||!vt)return t.push({message:"linefill.new(line1, line2) requires two line ids",line:be}),!0;const jt=Pa(J,yt||vt),ye=ya(J),E=Yg(J.layer??J.Layer),me=Kg(J.zindex??J.z_index??J.zIndex),Se=Xg(J.include_in_autoscale??J.includeInAutoscale??J.autoscale),Ve=Yl(J.group??J.group_id??J.groupId),Ye=Vu(J.tags??J.tag),at=G?Dt(G):void 0;return at&&(Xe[at]=jt),to(jt,{kind:"linefill_new",assign:at,once:re?!0:void 0,when:ye,line1:yt,line2:vt,color:Ro(Fe[2]??J.color??J.fillcolor),layer:E,zIndex:me,includeInAutoscale:Se,groupId:Ve,tags:Ye}),!0},Pc=(se,be,G)=>{const re=Gr(be||""),we=su(re),J=re.filter(E=>!zu(E)),Fe=J[0],yt=el(Fe);if(!yt)return!0;const vt=String(se||"").toLowerCase().replace(/_/g,""),jt=Pa(we,yt),ye={kind:"linefill_set",target:yt,targetExpr:Fe!=null?String(Fe):void 0,when:ya(we)};if(vt==="color")ye.color=Ro(J[1]??we.color??we.fillcolor);else if(vt==="line1")ye.line1=el(J[1]??we.line1??we.line_1??we.l1)||void 0;else if(vt==="line2")ye.line2=el(J[1]??we.line2??we.line_2??we.l2)||void 0;else return t.push({message:`Unsupported linefill.set_${se}()`,line:G}),!0;return to(jt,ye),!0},cl=(se,be)=>{const G=Gr(se||""),re=su(G),J=G.filter(vt=>!zu(vt))[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe);return to(yt,{kind:"linefill_delete",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re)}),!0},mr=(se,be,G,re)=>{const we=Gr(se||""),J=su(we),Fe=we.filter(at=>!zu(at)),yt=ya(J),vt=d0(String(J.xloc??""))||void 0,jt=u_(String(J.yloc??""))||void 0,ye=Iu(Fe,0,be,"polyline.new",vt,jt);if(ye.length<2)return t.push({message:"polyline.new requires at least 2 points (x,y pairs)",line:be}),!0;const E=hc(J),me=Yg(J.layer??J.Layer),Se=Kg(J.zindex??J.z_index??J.zIndex),Ve=Xg(J.include_in_autoscale??J.includeInAutoscale??J.autoscale),Ye=G?Dt(G):void 0;return Ye&&(Xe[Ye]=E),to(E,{kind:"polyline_new",assign:Ye,once:re?!0:void 0,when:yt,points:ye,color:Ro(J.color),width:zr(J.width,"polyline.width").value,widthExpr:zr(J.width,"polyline.width").expr,style:u0(String(J.style??""))||void 0,opacity:J.opacity!=null?Number(J.opacity):void 0,xloc:vt,yloc:jt,layer:me,zIndex:Se,includeInAutoscale:Ve,groupId:Yl(J.group??J.group_id??J.groupId),tags:Vu(J.tags??J.tag)}),!0},La=(se,be)=>{const G=Gr(se||""),re=su(G),we=G.filter(me=>!zu(me)),J=we[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe),vt=d0(String(re.xloc??""))||void 0,jt=u_(String(re.yloc??""))||void 0,ye=Iu(we,1,be,"polyline.set_points",vt,jt),E=zr(re.width,"polyline.set_width");return to(yt,{kind:"polyline_set",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re),points:ye.length?ye:void 0,color:Ro(re.color),width:E.value,widthExpr:E.expr,style:u0(String(re.style??""))||void 0,opacity:re.opacity!=null?Number(re.opacity):void 0,xloc:vt,yloc:jt,layer:Yg(re.layer??re.Layer),zIndex:Kg(re.zindex??re.z_index??re.zIndex),includeInAutoscale:Xg(re.include_in_autoscale??re.includeInAutoscale??re.autoscale),groupId:Yl(re.group??re.group_id??re.groupId),tags:Vu(re.tags??re.tag)}),!0},Sl=(se,be)=>{const G=Gr(se||""),re=su(G),J=G.filter(vt=>!zu(vt))[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe);return to(yt,{kind:"polyline_delete",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re)}),!0},Ba=(se,be,G,re)=>{const we=Gr(se||""),J=su(we),Fe=we.filter(Ve=>!zu(Ve)),yt=ya(J),vt=d0(String(J.xloc??""))||void 0,jt=u_(String(J.yloc??""))||void 0,ye=Iu(Fe,0,be,"polygon.new",vt,jt);if(ye.length<3)return t.push({message:"polygon.new requires at least 3 points (x,y pairs)",line:be}),!0;const E=hc(J),me=G?Dt(G):void 0;me&&(Xe[me]=E);const Se=zr(J.stroke_width??J.strokeWidth,"polygon.stroke_width");return to(E,{kind:"polygon_new",assign:me,once:re?!0:void 0,when:yt,points:ye,fillColor:Ro(J.fill_color??J.fillcolor??J.color),strokeColor:Ro(J.stroke_color??J.strokeColor??J.borderColor),strokeWidth:Se.value,strokeWidthExpr:Se.expr,strokeStyle:u0(String(J.stroke_style??J.strokeStyle??""))||void 0,opacity:J.opacity!=null?Number(J.opacity):void 0,xloc:vt,yloc:jt,layer:Yg(J.layer??J.Layer),zIndex:Kg(J.zindex??J.z_index??J.zIndex),includeInAutoscale:Xg(J.include_in_autoscale??J.includeInAutoscale??J.autoscale),groupId:Yl(J.group??J.group_id??J.groupId),tags:Vu(J.tags??J.tag)}),!0},vi=(se,be)=>{const G=Gr(se||""),re=su(G),we=G.filter(me=>!zu(me)),J=we[0],Fe=el(J);if(!Fe)return!0;const yt=d0(String(re.xloc??""))||void 0,vt=u_(String(re.yloc??""))||void 0,jt=Iu(we,1,be,"polygon.set_points",yt,vt),ye=Pa(re,Fe),E=zr(re.stroke_width??re.strokeWidth,"polygon.stroke_width");return to(ye,{kind:"polygon_set",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re),points:jt.length?jt:void 0,fillColor:Ro(re.fill_color??re.fillcolor??re.color),strokeColor:Ro(re.stroke_color??re.strokeColor??re.borderColor),strokeWidth:E.value,strokeWidthExpr:E.expr,strokeStyle:u0(String(re.stroke_style??re.strokeStyle??""))||void 0,opacity:re.opacity!=null?Number(re.opacity):void 0,xloc:yt,yloc:vt,layer:Yg(re.layer??re.Layer),zIndex:Kg(re.zindex??re.z_index??re.zIndex),includeInAutoscale:Xg(re.include_in_autoscale??re.includeInAutoscale??re.autoscale),groupId:Yl(re.group??re.group_id??re.groupId),tags:Vu(re.tags??re.tag)}),!0},vc=(se,be)=>{const G=Gr(se||""),re=su(G),J=G.filter(vt=>!zu(vt))[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe);return to(yt,{kind:"polygon_delete",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re)}),!0},ul=(se,be,G,re)=>{const we=Gr(se||""),J=su(we),Fe=we.filter(Ye=>!zu(Ye)),yt=ya(J),vt=d0(String(J.xloc??""))||void 0,jt=u_(String(J.yloc??""))||void 0,ye=Iu(Fe,0,be,"path.new",vt,jt);if(!ye.length)return t.push({message:"path.new requires at least one (x,y) point",line:be}),!0;const E=ye.map((Ye,at)=>({cmd:at===0?"M":"L",x:Ye.x,y:Ye.y,xloc:Ye.xloc,yloc:Ye.yloc})),me=hc(J),Se=G?Dt(G):void 0;Se&&(Xe[Se]=me);const Ve=zr(J.width,"path.width");return to(me,{kind:"path_new",assign:Se,once:re?!0:void 0,when:yt,commands:E,color:Ro(J.color),width:Ve.value,widthExpr:Ve.expr,style:u0(String(J.style??""))||void 0,opacity:J.opacity!=null?Number(J.opacity):void 0,layer:Yg(J.layer??J.Layer),zIndex:Kg(J.zindex??J.z_index??J.zIndex),includeInAutoscale:Xg(J.include_in_autoscale??J.includeInAutoscale??J.autoscale),groupId:Yl(J.group??J.group_id??J.groupId),tags:Vu(J.tags??J.tag)}),!0},Ga=(se,be)=>{const G=Gr(se||""),re=su(G),we=G.filter(Se=>!zu(Se)),J=we[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe),vt=d0(String(re.xloc??""))||void 0,jt=u_(String(re.yloc??""))||void 0,ye=Iu(we,1,be,"path.set_points",vt,jt),E=ye.length>0?ye.map((Se,Ve)=>({cmd:Ve===0?"M":"L",x:Se.x,y:Se.y,xloc:Se.xloc,yloc:Se.yloc})):void 0,me=zr(re.width,"path.set_width");return to(yt,{kind:"path_set",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re),commands:E,color:Ro(re.color),width:me.value,widthExpr:me.expr,style:u0(String(re.style??""))||void 0,opacity:re.opacity!=null?Number(re.opacity):void 0,layer:Yg(re.layer??re.Layer),zIndex:Kg(re.zindex??re.z_index??re.zIndex),includeInAutoscale:Xg(re.include_in_autoscale??re.includeInAutoscale??re.autoscale),groupId:Yl(re.group??re.group_id??re.groupId),tags:Vu(re.tags??re.tag)}),!0},vl=(se,be)=>{const G=Gr(se||""),re=su(G),J=G.filter(vt=>!zu(vt))[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe);return to(yt,{kind:"path_delete",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re)}),!0},pu=(se,be,G)=>{const re=Gr(be||""),we=su(re),J=re.filter(E=>!zu(E)),Fe=J[0],yt=el(Fe);if(!yt)return!0;const vt=String(se||"").toLowerCase().replace(/_/g,""),jt=Pa(we,yt),ye={kind:"label_set",target:yt,targetExpr:Fe!=null?String(Fe):void 0,when:ya(we)};if(vt==="x")ye.x=Yr(J[1],"label.set_x",G);else if(vt==="y")ye.y=Yr(J[1],"label.set_y",G);else if(vt==="xy")ye.x=Yr(J[1],"label.set_xy x",G),ye.y=Yr(J[2],"label.set_xy y",G);else if(vt==="text"){const E=Ll(String(J[1]??we.text??""),"label_set_text");ye.text=E.text,ye.textExpr=E.textExpr}else if(vt==="color")ye.color=Ro(J[1]??we.color);else if(vt==="textcolor")ye.textColor=Ro(J[1]??we.textcolor??we.textColor);else if(vt==="style")ye.style=sr(String(J[1]??we.style??""),G)||void 0;else if(vt==="size"){const E=or(J[1]??we.size,G);ye.size=E.value??H1(String(J[1]??we.size??"")),ye.sizeExpr=E.expr}else if(vt==="yloc")ye.yloc=hl(String(J[1]??we.yloc??""),G)||void 0;else if(vt==="textalign")ye.textAlign=mo(String(J[1]??we.textalign??we.textAlign??""),G)||void 0;else if(vt==="tooltip"){const E=Ll(String(J[1]??we.tooltip??""),"label_set_tooltip");ye.tooltip=E.text,ye.tooltipExpr=E.textExpr}else if(vt==="xloc")ye.xloc=df(String(J[1]??we.xloc??""),G)||void 0;else return t.push({message:`Unsupported label.set_${se}()`,line:G}),!0;return to(jt,ye),!0},tl=(se,be)=>{const G=Gr(se||""),re=su(G),J=G.filter(vt=>!zu(vt))[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe);return to(yt,{kind:"label_delete",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re)}),!0},Oa=(se,be,G)=>{const re=Gr(be||""),we=su(re),J=re.filter(E=>!zu(E)),Fe=J[0],yt=el(Fe);if(!yt)return!0;const vt=String(se||"").toLowerCase().replace(/_/g,""),jt=Pa(we,yt),ye={kind:"box_set",target:yt,targetExpr:Fe!=null?String(Fe):void 0,when:ya(we)};if(vt==="left")ye.left=Yr(J[1],"box.set_left",G);else if(vt==="right")ye.right=Yr(J[1],"box.set_right",G);else if(vt==="top")ye.top=Yr(J[1],"box.set_top",G);else if(vt==="bottom")ye.bottom=Yr(J[1],"box.set_bottom",G);else if(vt==="lefttop")ye.left=Yr(J[1],"box.set_lefttop left",G),ye.top=Yr(J[2],"box.set_lefttop top",G);else if(vt==="rightbottom")ye.right=Yr(J[1],"box.set_rightbottom right",G),ye.bottom=Yr(J[2],"box.set_rightbottom bottom",G);else if(vt==="bgcolor")ye.bgColor=Ro(J[1]??we.bgcolor??we.bgColor);else if(vt==="bordercolor")ye.borderColor=Ro(J[1]??we.border_color??we.borderColor);else if(vt==="borderwidth"){const E=Dn(J[1]??we.border_width??we.borderWidth,G);ye.width=E.value,ye.widthExpr=E.expr}else if(vt==="borderstyle")ye.borderStyle=yf(String(J[1]??we.border_style??we.borderStyle??""),G)||void 0;else if(vt==="text"){const E=Ll(String(J[1]??we.text??""),"box_set_text");ye.text=E.text,ye.textExpr=E.textExpr}else if(vt==="textcolor")ye.textColor=Ro(J[1]??we.text_color??we.textColor);else if(vt==="textsize"){const E=Us(J[1]??we.text_size??we.textSize,G);ye.textSize=E.value,ye.textSizeExpr=E.expr}else if(vt==="texthalign")ye.textHalign=$n(String(J[1]??we.text_halign??we.textHalign??""),G)||void 0;else if(vt==="textvalign")ye.textValign=ws(String(J[1]??we.text_valign??we.textValign??""),G)||void 0;else if(vt==="textwrap"){const E=J[1]??we.text_wrap??we.textWrap;E!=null&&(ye.textWrap=Zg(String(E))??void 0)}else if(vt==="tooltip"){const E=Ll(String(J[1]??we.tooltip??""),"box_set_tooltip");ye.tooltip=E.text,ye.tooltipExpr=E.textExpr}else if(vt==="extend")ye.extend=Dd(String(J[1]??we.extend??""),G)||void 0;else if(vt==="xloc")ye.xloc=Pu(String(J[1]??we.xloc??""),G)||void 0;else return t.push({message:`Unsupported box.set_${se}()`,line:G}),!0;return to(jt,ye),!0},Oc=(se,be)=>{const G=Gr(se||""),re=su(G),J=G.filter(vt=>!zu(vt))[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe);return to(yt,{kind:"box_delete",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re)}),!0},Gu=(se,be,G)=>{const re=Gr(be||""),we=su(re),J=re.filter(E=>!zu(E)),Fe=J[0],yt=el(Fe);if(!yt)return!0;const vt=String(se||"").toLowerCase().replace(/_/g,""),jt=Pa(we,yt),ye={kind:"table_set",target:yt,targetExpr:Fe!=null?String(Fe):void 0,when:ya(we)};if(vt==="position")ye.position=j5(String(J[1]??we.position??""))||Tr(String(J[1]??we.position??""));else if(vt==="bgcolor")ye.bgcolor=Ro(J[1]??we.bgcolor??we.bgColor);else if(vt==="bordercolor")ye.borderColor=Ro(J[1]??we.border_color??we.borderColor);else if(vt==="borderwidth"){const E=zr(J[1]??we.border_width??we.borderWidth,"table.set_border_width");ye.borderWidth=E.value,ye.borderWidthExpr=E.expr}else if(vt==="textcolor")ye.textColor=Ro(J[1]??we.text_color??we.textColor);else if(vt==="textsize"){const E=kl(J[1]??we.text_size??we.textSize,"table.set_text_size");ye.textSize=E.value,ye.textSizeExpr=E.expr}else if(vt==="texthalign")ye.textHalign=d_(String(J[1]??we.text_halign??we.textHalign??""))||void 0;else if(vt==="textvalign")ye.textValign=q1(String(J[1]??we.text_valign??we.textValign??""))||void 0;else if(vt==="framecolor")ye.frameColor=Ro(J[1]??we.frame_color??we.frameColor);else if(vt==="framewidth"){const E=zr(J[1]??we.frame_width??we.frameWidth,"table.set_frame_width");ye.frameWidth=E.value,ye.frameWidthExpr=E.expr}else return t.push({message:`Unsupported table.set_${se}()`,line:G}),!0;return to(jt,ye),!0},El=(se,be)=>{const G=Gr(se||""),re=su(G),J=G.filter(vt=>!zu(vt))[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe);return to(yt,{kind:"table_delete",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re)}),!0},mu=(se,be)=>{const G=Gr(se||""),re=su(G),we=G.filter(ye=>!zu(ye)),J=we[0],Fe=el(J);if(!Fe)return!0;const yt=Pa(re,Fe),vt=(ye,E)=>{if(!(ye==null||String(ye).trim()===""))return Yr(String(ye),E,be)||void 0},jt={kind:"table_clear",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re)};return jt.startColumn=vt(we[1]??re.start_column??re.start_col,"table.clear start_column"),jt.startRow=vt(we[2]??re.start_row,"table.clear start_row"),jt.endColumn=vt(we[3]??re.end_column??re.end_col,"table.clear end_column"),jt.endRow=vt(we[4]??re.end_row,"table.clear end_row"),to(yt,jt),!0},bc=(se,be)=>{const G=Gr(se||""),re=su(G),we=G.filter(Se=>!zu(Se)),J=we[0],Fe=el(J);if(!Fe)return!0;const yt=we[1]??re.left,vt=we[2]??re.top,jt=we[3]??re.right,ye=we[4]??re.bottom;if(yt==null||vt==null||jt==null||ye==null)return t.push({message:"table.merge(table, left, top, right, bottom) requires 4 numeric args",line:be}),!0;const E=Pa(re,Fe),me={kind:"table_merge",target:Fe,targetExpr:J!=null?String(J):void 0,when:ya(re)};return me.left=Yr(String(yt),"table.merge left",be)||void 0,me.top=Yr(String(vt),"table.merge top",be)||void 0,me.right=Yr(String(jt),"table.merge right",be)||void 0,me.bottom=Yr(String(ye),"table.merge bottom",be)||void 0,to(E,me),!0},nl=(se,be,G)=>{const re=Gr(be||""),we=su(re),J=re.filter(Ye=>!zu(Ye)),Fe=J[0]??"",yt=el(String(Fe||""))||"",vt=J[1]??we.column??we.col,jt=J[2]??we.row,ye=vt!=null?Number(vt):NaN,E=jt!=null?Number(jt):NaN;if(!yt||!Number.isFinite(ye)||!Number.isFinite(E))return t.push({message:"table.cell_set_* requires a table id and numeric column/row",line:G}),!0;const me=String(se||"").toLowerCase().replace(/_/g,""),Se=Pa(we,yt),Ve={kind:"table_cell_set",target:yt,targetExpr:Fe!=null?String(Fe):void 0,when:ya(we),column:Math.floor(ye),row:Math.floor(E)};if(me==="text"){const Ye=Ll(String(J[3]??we.text??""),"table_cell_set_text");Ve.text=Ye.text,Ve.textExpr=Ye.textExpr}else if(me==="textcolor")Ve.textColor=Ro(J[3]??we.text_color??we.textColor);else if(me==="bgcolor")Ve.bgcolor=Ro(J[3]??we.bgcolor??we.bgColor);else if(me==="textsize"){const Ye=kl(J[3]??we.text_size??we.textSize,"table.cell_set_text_size");Ve.textSize=Ye.value,Ve.textSizeExpr=Ye.expr}else if(me==="texthalign")Ve.textHalign=d_(String(J[3]??we.text_halign??we.textHalign??""))||void 0;else if(me==="textvalign")Ve.textValign=q1(String(J[3]??we.text_valign??we.textValign??""))||void 0;else if(me==="width"){const Ye=zr(J[3]??we.width,"table.cell_set_width");Ve.width=Ye.value,Ve.widthExpr=Ye.expr}else if(me==="height"){const Ye=zr(J[3]??we.height,"table.cell_set_height");Ve.height=Ye.value,Ve.heightExpr=Ye.expr}else if(me==="tooltip"){const Ye=Ll(String(J[3]??we.tooltip??""),"table_cell_set_tooltip");Ve.tooltip=Ye.text,Ve.tooltipExpr=Ye.textExpr}else return t.push({message:`Unsupported table.cell_set_${se}()`,line:G}),!0;return to(Se,Ve),!0};for(let se=0;se<L.length;se++){const be=se,G=L[se],re=G.text.match(/^\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\((.*)\)\s*=>\s*(.*)$/);if(!re)continue;const we=re[1],J=re[2]||"";let Fe=String(re[3]||"").trim(),yt;if(!Fe){const ye=G.indent,E=[];let me=se+1;for(;me<L.length&&L[me].indent>ye;)L[me].text.startsWith("//@pine_fn")||E.push(L[me]),me+=1;const Se=E.map(at=>String(at.text||"").trim()).filter(Boolean);if(!Se.length){e.push({message:`Function "${we}" requires a body expression`,line:G.lineNo});continue}yt=E.map(at=>({text:String(at.text||""),lineNo:at.lineNo,indent:at.indent}));const Ve=Se[Se.length-1];Fe=Ve.replace(/^return\s+/i,"").trim()||Ve;for(let at=se+1;at<me;at++)L[at]={...L[at],text:"//@pine_fn"};se=me-1}const vt=Gr(J).map(ye=>String(ye||"").trim()).filter(Boolean).map(ye=>{const E=ye.match(/^(?:(?:varip|var)\s+)?(?:float|int|bool|string)\s+([A-Za-z_$][A-Za-z0-9_$]*)$/i);return(E?E[1]:ye).trim()}),jt=Dt(we);Mt[jt]&&t.push({message:`Duplicate function definition "${we}" (later definition overrides).`,line:G.lineNo}),Mt[jt]={name:we,args:vt,body:Fe,lineNo:G.lineNo,bodyLines:yt},L[be]={...G,text:"//@pine_fn"}}const la=se=>{const be=String(se||"").trim(),G=Dt(be),re=Pt[G];return re||be},Mu=se=>{const be=/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g,G=new Map,re=new Set,we=Fe=>{const yt=Dt(Fe);if(G.has(yt))return G.get(yt);const vt=Pt[yt];if(!vt)return Fe;if(re.has(yt))return vt;re.add(yt);const jt=String(vt).replace(be,ye=>{const E=Dt(ye);return Pt[E]?`(${we(E)})`:ye});return re.delete(yt),G.set(yt,jt),jt},J=la(se);return String(J).replace(be,Fe=>{const yt=Dt(Fe);return Pt[yt]?`(${we(yt)})`:Fe})},Yu=se=>{const be=/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g,G=new Map,re=new Set,we=E=>{const me=Dt(E);if(G.has(me))return G.get(me);const Se=Pt[me];if(!Se)return E;if(re.has(me))return Se;re.add(me);const Ve=String(Se).replace(be,Ye=>{const at=Dt(Ye);return Pt[at]?`(${we(at)})`:Ye});return re.delete(me),G.set(me,Ve),Ve},J=la(se),Fe=String(J).replace(be,E=>{const me=Dt(E);return Pt[me]?`(${we(me)})`:E}),yt=new Set($e.map(E=>Dt(String((E==null?void 0:E.name)||""))).filter(Boolean)),vt=new Set(Object.keys(ft||{}).map(E=>Dt(E)).filter(Boolean)),jt=new Set(["open","high","low","close","volume","time","and","or","not","true","false","crossesabove","crossesbelow"]);return Fe.replace(be,(E,me)=>{const Se=Dt(E);if(!Se||jt.has(Se))return E;const Ve=Fe.slice(me+E.length);return/^\s*\(/.test(Ve)||!vt.has(Se)||yt.has(Se)?E:`\${${E}}`})},zc=se=>se===">"||se==="<"||se===">="||se==="<="||se==="=="||se==="!=",Zd=se=>{if(!se||typeof se!="object")return!1;if(se.kind==="BinaryExpression"){const be=se.left,G=se.right;return zc(se.operator)&&(be.kind==="BinaryExpression"&&zc(be.operator)||G.kind==="BinaryExpression"&&zc(G.operator))?!0:Zd(be)||Zd(G)}return se.kind==="UnaryExpression"?Zd(se.expr):se.kind==="MemberExpression"?Zd(se.object):se.kind==="IndexExpression"?Zd(se.object)||Zd(se.index):se.kind==="CallExpression"?se.args.some(be=>Zd(be)):!1},Yf="Chained comparisons are only supported in simple form. Rewrite as (a < b) and (b < c).",Kf=se=>{se!=null&&(o.has(se)||(e.push({message:Yf,line:se}),o.add(se)))},_d=se=>!!se&&/[A-Za-z0-9_$]/.test(se),Rd=(se,be,G)=>{if(se.slice(be,be+G.length).toLowerCase()!==G)return!1;const re=se[be-1],we=se[be+G.length];return!(_d(re)||_d(we))},fc=se=>{let be=se.trim(),G=0;for(;be.startsWith("(")&&be.endsWith(")");){let re=0,we=null,J=!0;for(let Fe=0;Fe<be.length;Fe++){const yt=be[Fe];if(we){yt===we&&be[Fe-1]!=="\\"&&(we=null);continue}if(yt==="'"||yt==='"'){we=yt;continue}if(yt==="(")re+=1;else if(yt===")"&&(re-=1,re===0&&Fe<be.length-1)){J=!1;break}}if(!J||re!==0||we)break;be=be.slice(1,-1).trim(),G+=1}return{inner:be,wraps:G}},pp=se=>{const be=[],G=[];let re=0,we=0,J=0,Fe=0,yt=null,vt=!1,jt=0;for(;jt<se.length;){const ye=se[jt];if(yt){ye===yt&&se[jt-1]!=="\\"&&(yt=null),jt+=1;continue}if(ye==="'"||ye==='"'){yt=ye,jt+=1;continue}if(ye==="("){we+=1,jt+=1;continue}if(ye===")"){we=Math.max(0,we-1),jt+=1;continue}if(ye==="{"){J+=1,jt+=1;continue}if(ye==="}"){J=Math.max(0,J-1),jt+=1;continue}if(ye==="["){Fe+=1,jt+=1;continue}if(ye==="]"){Fe=Math.max(0,Fe-1),jt+=1;continue}if(we||J||Fe){jt+=1;continue}const E=se.slice(jt,jt+2);if(E==="<="||E===">="||E==="=="||E==="!="){be.push(se.slice(re,jt).trim()),G.push(E),jt+=2,re=jt;continue}if(ye==="<"||ye===">"){be.push(se.slice(re,jt).trim()),G.push(ye),jt+=1,re=jt;continue}if(Rd(se,jt,"and")){vt=!0,jt+=3;continue}if(Rd(se,jt,"or")){vt=!0,jt+=2;continue}if(Rd(se,jt,"not")){vt=!0,jt+=3;continue}if(ye==="?"){vt=!0,jt+=1;continue}if(ye===":"){se[jt+1]==="="&&(jt+=1),vt=!0,jt+=1;continue}if(ye===","){vt=!0,jt+=1;continue}if(ye==="="){vt=!0,jt+=1;continue}jt+=1}return G.length&&be.push(se.slice(re).trim()),{terms:be,ops:G,hasChain:G.length>1,complex:vt}},kd=se=>{const be=se.trim();if(!be)return!1;let G=0,re=null,we=0;for(;we<be.length;){const J=be[we];if(re){J===re&&be[we-1]!=="\\"&&(re=null),we+=1;continue}if(J==="'"||J==='"'){re=J,we+=1;continue}if(J==="("){G+=1,we+=1;continue}if(J===")"){G=Math.max(0,G-1),we+=1;continue}if(J==="{"){we+=1;continue}if(J==="}"){we+=1;continue}if(J==="["){we+=1;continue}if(J==="]"){we+=1;continue}if(Rd(be,we,"and")||Rd(be,we,"or")||Rd(be,we,"not"))return!1;const Fe=be.slice(we,we+2);if(Fe==="<="||Fe===">="||Fe==="=="||Fe==="!="||J==="<"||J===">"||J==="?"||J===":"||J==="="||J===","&&(G<=0||G>1))return!1;we+=1}return!0},Wd=(se,be)=>{if(!/[<>!=]=?|==/.test(se))return se;const{inner:G,wraps:re}=fc(se),we=pp(G);if(we.hasChain&&!we.complex){const J=we.ops.some(jt=>jt==="=="||jt==="!="),Fe=we.terms.length===we.ops.length+1&&we.terms.every(jt=>kd(jt));if(J||!Fe)return Kf(be),se;const yt=[];for(let jt=0;jt<we.ops.length;jt++)yt.push(`(${we.terms[jt]}) ${we.ops[jt]} (${we.terms[jt+1]})`);let vt=yt.join(" and ");for(let jt=0;jt<re;jt++)vt=`(${vt})`;return vt}try{const J=se.replace(/\$\{[^}]+\}/g,"1"),Fe=Lp(J);Zd(Fe)&&Kf(be)}catch{}return se},$l=(se,be)=>{if(se==null)return{};const G=Yu(B_(So(String(se),"when")));if(!G)return{};try{const re=G.replace(/\$\{[^}]+\}/g,"1");Lp(re)}catch(re){const we=(re==null?void 0:re.message)||String(re);e.push({message:`Pine condition parse failed: ${we}`,line:be})}return{whenExpr:G}},Nu=(se,be)=>{const G=String(se||"").trim(),re=So(G,be),we=re.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(we)return we[0];const J=rh(re);if(J!=null){const jt=`__const_${String(J).replace(/[^\d]/g,"_")}`;return $e.some(ye=>ye.name.toLowerCase()===jt.toLowerCase())||$e.push({name:jt,expr:String(J)}),jt}const Fe=be.replace(/[^A-Za-z0-9_]+/g,"_").toLowerCase();let yt=`__${Fe||"expr"}`,vt=1;for(;$e.some(jt=>jt.name.toLowerCase()===yt.toLowerCase());)vt+=1,yt=`__${Fe||"expr"}_${vt}`;return $e.push({name:yt,expr:re}),yt},Ku=(se,be)=>{const G=Tr(String(se||"").trim()),re=Dt(G);return Ae[re]?Ae[re]:Nu(G,be).replace(/\s+/g,"_").toLowerCase()},bf=(se,be,G)=>{const re=Gr(se||"");if(!re.length){e.push({message:"plot() requires at least 1 argument",line:be});return}const we=re[0],J=re[1]&&!re[1].includes("=")?re[1]:null,Fe=su(re),yt=hc(Fe),vt=Ie(yt),jt=Nu(we,Tr(String(Fe.title??Fe.name??J??we??"plot"))),ye=zr(Fe.offset,"plot_offset"),E=zr(Fe.show_last,"plot_show_last"),me=zr(Fe.precision,"plot_precision"),Se=ye.value!=null?ye.value:ye.expr,Ve=E.value!=null?E.value:E.expr,Ye=me.value!=null?me.value:me.expr,at=Fe.display!=null?String(Fe.display):void 0,Re=Fe.trackprice!=null?Zg(String(Fe.trackprice)):void 0,De=Fe.transp??Fe.transparency,pt=De!=null?Number(De):void 0,Ge=Ro(String(Fe.color??"")),sn=G0(Ge,pt),Un=R5(Fe.type),Zs=R5(Fe.style),vs=Un??Zs??Tr(String(Fe.type??"line"))??"line",Oo=Fe.linestyle??Fe.line_style??Fe.lineStyle??(Zs?void 0:Fe.style),Pi=Oo?u0(String(Oo)):void 0,no=jt.replace(/\s+/g,"_").toLowerCase();vt.plots.push({name:Tr(String(Fe.title??Fe.name??J??jt)),source:no,type:vs,color:sn,width:Fe.width!=null?Number(Fe.width):Fe.linewidth!=null?Number(Fe.linewidth):void 0,style:Pi??void 0,offset:Se,showLast:Ve,precision:Ye,display:at,trackPrice:Re}),G&&(Ae[Dt(G)]=no)},Xu=(se,be,G)=>{const re=Gr(be||""),we=su(re),J=re.filter(fr=>!zu(fr));if(J.length<4){e.push({message:`${se} plot requires open/high/low/close`,line:G});return}const Fe=hc(we),yt=Ie(Fe),vt=Nu(J[0],`${se}_open`).replace(/\s+/g,"_").toLowerCase(),jt=Nu(J[1],`${se}_high`).replace(/\s+/g,"_").toLowerCase(),ye=Nu(J[2],`${se}_low`).replace(/\s+/g,"_").toLowerCase(),E=Nu(J[3],`${se}_close`).replace(/\s+/g,"_").toLowerCase(),me=Tr(String(we.title??we.name??J[4]??se)),Se=we.color??J[5]??"",Ve=we.colordown??we.color_down??we.colordn??"",Ye=we.wickcolor??J[6]??"",at=we.bordercolor??J[7]??"",Re=we.transp??we.transparency,De=Re!=null?Number(Re):void 0,pt=G0(Ro(String(Se)),De),Ge=G0(Ro(String(Ve))||pt,De),sn=G0(Ro(String(Ye)),De),Un=G0(Ro(String(at)),De),Zs=zr(we.offset,`${se}_offset`),vs=zr(we.show_last,`${se}_show_last`),Oo=zr(we.precision,`${se}_precision`),Pi=Zs.value!=null?Zs.value:Zs.expr,no=vs.value!=null?vs.value:vs.expr,gl=Oo.value!=null?Oo.value:Oo.expr,Ms=we.display!=null?String(we.display):void 0,wo=we.trackprice!=null?Zg(String(we.trackprice)):void 0;yt.plots.push({name:me||se,type:se,open:vt,high:jt,low:ye,close:E,color:pt||(se==="candles"?"#22c55e":"#64748b"),downColor:Ge||"#ef4444",wickColor:sn||void 0,borderColor:Un||void 0,offset:Pi,showLast:no,precision:gl,display:Ms,trackPrice:wo})},Ql=(se,be,G)=>{const re=be.match(/^input\.(int|float|bool|string|time|session|source|symbol|color)\s*\((.*)\)\s*$/i);if(!re)return!1;const we=re[1].toLowerCase(),J=Gr(re[2]||""),Fe=su(J),yt=J.filter(Re=>!zu(Re)),vt=Fe.defval??yt[0]??"",jt=Fe.title??yt[1]??"",ye=jt?Tr(String(jt)):void 0,E=Re=>{e.push({message:Re,line:G})},me=Re=>{const De=typeof Re=="number"?Re:Number(Re);return Number.isFinite(De)?De:void 0},Se=me(Fe.minval),Ve=me(Fe.maxval),Ye=me(Fe.step);let at=null;if(we==="bool"){const Re=Zg(String(vt));if(Re==null)return E(`input.bool() requires defval true/false for "${se}"`),!0;at=Re}else if(we==="string"||we==="session"||we==="symbol")at=Tr(String(vt||""));else if(we==="color"){const Re=$5(String(vt))||Tr(String(vt||""));if(!Re)return E(`input.color() requires a valid color for "${se}"`),!0;at=Re}else if(we==="time"){const Re=me(String(vt));if(Re!=null)at=Re;else{const De=oQ(String(vt))??(()=>{const pt=Tr(String(vt||"")),Ge=Date.parse(pt);return Number.isFinite(Ge)?Ge:null})();if(De==null)return E(`input.time() requires a numeric or timestamp defval for "${se}"`),!0;at=De}}else if(we==="source"){const Re=So(String(vt||"close"),`input_source_${se}`),De=Re.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);at=De?De[0]:Nu(Re,`input_source_${se}`)}else{const Re=me(vt);if(Re==null)return E(`input.${we}() requires numeric defval for "${se}"`),!0;at=we==="int"?Math.floor(Re):Re}return ft[se]=at,bt[Dt(se)]=we,ut.push({name:se,type:we,title:ye,defval:at,minval:Se,maxval:Ve,step:Ye}),!0},Hd=[];let hu=0;const Jc=(se,be,G,re)=>{var yt,vt;const we=[],J=jt=>re.some(ye=>Dt(ye)===Dt(jt));let Fe=be;for(;Fe<se.length;){const jt=se[Fe];if(jt.indent<=G)break;const ye=String(jt.text||"").trim();if(!ye||ye.startsWith("//")){Fe+=1;continue}if(ye==="break"){we.push({kind:"break",lineNo:jt.lineNo}),Fe+=1;continue}if(ye==="continue"){we.push({kind:"continue",lineNo:jt.lineNo}),Fe+=1;continue}const E=ye.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(E){const Re=jt.indent,De=[],pt=String(E[1]??E[2]??"").trim();Fn=jt.lineNo;const Ge=pt?So(pt,"loop_if"):"",sn=Jc(se,Fe+1,Re,re);De.push({cond:Ge||void 0,body:sn.ops,lineNo:jt.lineNo});let Un=sn.nextIdx;for(;Un<se.length&&se[Un].indent===Re;){const Zs=String(se[Un].text||"").trim(),vs=Zs.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(vs){const Oo=String(vs[1]??vs[2]??"").trim();Fn=se[Un].lineNo;const Pi=Oo?So(Oo,"loop_if"):"",no=Jc(se,Un+1,Re,re);De.push({cond:Pi||void 0,body:no.ops,lineNo:se[Un].lineNo}),Un=no.nextIdx;continue}if(/^else$/i.test(Zs)){const Oo=Jc(se,Un+1,Re,re);De.push({cond:void 0,body:Oo.ops,lineNo:se[Un].lineNo}),Un=Oo.nextIdx}break}we.push({kind:"if",lineNo:jt.lineNo,branches:De}),Fe=Un;continue}const me=ye.match(/^for\s+([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+?)\s+to\s+(.+?)(?:\s+by\s+(.+))?$/i);if(me){const Re=me[1],De=String(me[2]??"").trim(),pt=String(me[3]??"").trim(),Ge=String(me[4]??"1").trim();Fn=jt.lineNo;const sn=So(De,`for_start_${Re}`),Un=So(pt,`for_end_${Re}`),Zs=So(Ge,`for_step_${Re}`),vs=Jc(se,Fe+1,jt.indent,[...re,Re]);vs.nextIdx===Fe+1&&e.push({message:"for-loop requires an indented body",line:jt.lineNo}),we.push({kind:"for",lineNo:jt.lineNo,varName:Re,startExpr:sn,endExpr:Un,stepExpr:Zs,body:vs.ops}),Fe=vs.nextIdx;continue}const Se=ye.match(/^while\s*(?:\((.*)\)|(.*))$/i);if(Se){const Re=String(Se[1]??Se[2]??"").trim();Fn=jt.lineNo;const De=So(Re,"while_cond"),pt=Jc(se,Fe+1,jt.indent,re);pt.nextIdx===Fe+1&&e.push({message:"while-loop requires an indented body",line:jt.lineNo}),we.push({kind:"while",lineNo:jt.lineNo,condExpr:De,body:pt.ops}),Fe=pt.nextIdx;continue}const Ve=ye.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(Ve){const Re=String(Ve[1]||"").toLowerCase(),De=Gr(Ve[2]||""),pt=String(De[0]||"").trim(),Ge=Dt(pt);if(!pt){e.push({message:`array.${Re} requires array name`,line:jt.lineNo}),Fe+=1;continue}if(!!Ct[Ge]||((yt=Ze[Ge])==null?void 0:yt.kind)==="string"){e.push({message:`array.${Re} on string arrays is not supported inside loops`,line:jt.lineNo}),Fe+=1;continue}if(!Ze[Ge]&&!Je[Ge]){e.push({message:`array.${Re} unknown array "${pt}"`,line:jt.lineNo}),Fe+=1;continue}if(!Ze[Ge]&&Je[Ge]&&Eo(Ge,Je[Ge].length,Je[Ge]),Re==="push"||Re==="unshift"||Re==="insert"){const vs=Ze[Ge];if(vs){const Oo=Math.min(xs,Math.max(vs.capacity,vs.size+_o));Lr(Ge,Oo)}}if(Re==="resize"){const vs=Ze[Ge];if(vs){const Oo=String(De[1]||"0"),Pi=oo(Oo);if(Pi!=null){const no=Math.min(xs,Math.max(vs.capacity,Math.floor(Pi)));Lr(Ge,no)}}}Fa(Ge);const Un={};Re==="push"||Re==="unshift"?Un.value=De[1]:Re==="insert"?(Un.index=De[1],Un.value=De[2]):Re==="remove"?Un.index=De[1]:Re==="resize"&&(Un.size=De[1]);const Zs=dc(Ge,Re,Un,jt.lineNo);if(!Zs){Fe+=1;continue}Zs.forEach(vs=>{we.push({kind:"assign",name:vs.name,op:vs.op,expr:vs.rhs,lineNo:vs.lineNo})}),Fe+=1;continue}const Ye=ye.match(/^array\.set\s*\((.*)\)\s*$/i);if(Ye){const Re=Gr(Ye[1]||""),De=String(Re[0]||"").trim(),pt=String(Re[1]||"").trim(),Ge=String(Re[2]||"").trim();if(!De||!pt||!Ge){e.push({message:"array.set(name, index, value) requires 3 args",line:jt.lineNo}),Fe+=1;continue}const sn=Dt(De);if(!Ze[sn]&&!Je[sn]&&!Ct[sn]){e.push({message:`array.set unknown array "${De}"`,line:jt.lineNo}),Fe+=1;continue}if(Ct[sn]){e.push({message:"array.set on string arrays is not supported inside loops",line:jt.lineNo}),Fe+=1;continue}!Ze[sn]&&Je[sn]&&Eo(sn,Je[sn].length,Je[sn]);const Un=So(pt,`${sn}_idx`),Zs=Fi(Un),vs=So(Ge,`${sn}_set`),Oo=(vt=Ze[sn])==null?void 0:vt.sizeSeries,Pi=Oo!=null?`(${Zs}) >= 0 and (${Zs}) < ${Oo}`:void 0,no=uc(sn,Zs,vs,Pi);if(!no){e.push({message:"array.set index must be within array size",line:jt.lineNo}),Fe+=1;continue}no.forEach((gl,Ms)=>{we.push({kind:"assign",name:Rt(sn,Ms),op:":=",expr:gl,lineNo:jt.lineNo})}),Fe+=1;continue}const at=ye.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(at){const Re=at[3];if(J(Re)){e.push({message:`Loop variable "${Re}" is read-only`,line:jt.lineNo}),Fe+=1;continue}const De=at[4],pt=String(at[5]||"").trim();Fn=jt.lineNo;const Ge=So(pt,Re);we.push({kind:"assign",name:Re,op:De,expr:Ge,lineNo:jt.lineNo}),Fe+=1;continue}e.push({message:`Unsupported statement inside loop: ${jt.text}`,line:jt.lineNo}),Fe+=1}return{ops:we,nextIdx:Fe}},Au=(se,be)=>{for(const G of se){if(G.kind==="assign"){be.add(G.name);continue}if(G.kind==="if"){G.branches.forEach(re=>Au(re.body,be));continue}(G.kind==="for"||G.kind==="while")&&Au(G.body,be)}},jd=se=>{const be=se.qty_percent??se.qtyPct??se.qtyPctVal??se.qtyPercent,G=be!=null?Number(be):void 0,re=se.qty??se.quantity,we=se.cash??se.cashQty??se.cash_qty,J=se.oco??se.oca_name??se.ocaName??se.oca,Fe=J?Tr(String(J)):void 0,yt=se.expiresBars!=null?Number(se.expiresBars):void 0,vt=se.commission??se.commissionPct??se.commission_pct,jt=se.slippage??se.slippagePct??se.slippage_pct,ye=se.stop??se.stopPrice,E=se.limit??se.limitPrice,me=se.price,Se=(Un,Zs)=>{if(Un==null)return null;const vs=So(String(Un),Zs);if(!vs)return null;const Oo=vs.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(Oo)return Oo[0];const Pi=rh(Tr(vs));return Pi!=null?String(Pi):Nu(vs,Zs)},Ve=Se(ye,"order_stop"),Ye=Se(E,"order_limit"),at=Se(me,"order_price"),Re=Se(re,"order_qty"),De=Se(we,"order_cash"),pt=vt!=null?rh(Tr(String(vt))):null,Ge=jt!=null?rh(Tr(String(jt))):null,sn={};return typeof G=="number"&&Number.isFinite(G)&&(sn.qtyPct=G),Re&&(sn.qty=Re),De&&(sn.cash=De),Fe&&(sn.oco=Fe),typeof yt=="number"&&Number.isFinite(yt)&&(sn.expiresBars=yt),pt!=null&&Number.isFinite(pt)&&(sn.commissionPct=pt),Ge!=null&&Number.isFinite(Ge)&&(sn.slippagePct=Ge),Ve&&Ye?(sn.kind="stop_limit",sn.stopPrice=Ve,sn.limitPrice=Ye,sn):Ye?(sn.kind="limit",sn.price=Ye,sn):Ve?(sn.kind="stop",sn.price=Ve,sn):at?(sn.kind="market",sn):Object.keys(sn).length?{kind:"market",...sn}:null},Wu=se=>{const be=J=>{let Fe=null,yt=0;const vt=Ve=>/[A-Za-z0-9_$]/.test(Ve),jt=J.toLowerCase(),ye=[{token:"cooldown_bars",key:"cooldown"},{token:"cooldownbars",key:"cooldown"},{token:"cooldown",key:"cooldown"},{token:"score",key:"score"}];let E=null;for(let Ve=0;Ve<J.length;Ve++){const Ye=J[Ve];if(Fe){Ye===Fe&&J[Ve-1]!=="\\"&&(Fe=null);continue}if(Ye==="'"||Ye==='"'){Fe=Ye;continue}if(Ye==="("){yt+=1;continue}if(Ye===")"){yt=Math.max(0,yt-1);continue}if(!(yt>0)&&!(Ve>0&&vt(J[Ve-1])))for(const at of ye){if(!jt.startsWith(at.token,Ve))continue;const Re=Ve+at.token.length;if(Re<J.length&&vt(J[Re]))continue;let De=Re;for(;De<J.length&&/\s/.test(J[De]);)De+=1;const pt=J[De];if(!(pt!=="="&&pt!==":")){E={key:at.key,start:Ve,valueStart:De+1};break}}}if(!E)return null;const me=J.slice(0,E.start).replace(/[,;]+\s*$/,"").trim(),Se=J.slice(E.valueStart).trim();return{key:E.key,when:me,value:Se}};let G=se.trim(),re,we;for(let J=0;J<4;J++){const Fe=be(G);if(!Fe)break;G=Fe.when,Fe.key==="score"&&re==null&&(re=Fe.value),Fe.key==="cooldown"&&we==null&&(we=Fe.value)}return{when:G.trim(),scoreRaw:re,cooldownRaw:we}},sf=(se,be,G)=>{if(se==null)return;const re=So(String(se),G),we=Yn(re);if(we==null||!Number.isFinite(we)){e.push({message:"score must be an integer between 0 and 10",line:be});return}if(!Number.isInteger(we)){e.push({message:"score must be an integer between 0 and 10",line:be});return}if(we<0||we>10){e.push({message:"score must be in range 0..10",line:be});return}return we},ad=(se,be,G)=>{if(se==null)return;const re=So(String(se),G),we=Yn(re);if(we==null||!Number.isFinite(we)){e.push({message:"cooldown must be a non-negative integer",line:be});return}if(!Number.isInteger(we)){e.push({message:"cooldown must be a non-negative integer",line:be});return}if(we<0){e.push({message:"cooldown must be a non-negative integer",line:be});return}return we},yd=(se,be,G)=>{const re=se.cooldown??se.cooldownBars??se.cooldown_bars??se.cooldownbars;return re==null?{value:void 0,hadRaw:!1}:{value:ad(String(re),be,G),hadRaw:!0}};for(let se=0;se<L.length;se++){const be=L[se],G=be.lineNo;Fn=G;let re=be.text.trim();if(!re||re.startsWith("//@pine_fn")||re.startsWith("//@pine_loop")||(/^\s*export\s+/i.test(re)&&(re=Y(re),L[se]={...be,text:re}),re.match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i))||re.match(/^library\s*\((.*)\)\s*$/i))continue;const Fe=re.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*switch\s*(?:\((.*)\)|(.*))$/i);if(Fe){const In=Fe[3],St=re.includes(":=")?":=":"=",Rn=String(Fe[4]??Fe[5]??"").trim(),Cn=be.indent,Ts=[];let Fs=se+1;for(;Fs<L.length&&L[Fs].indent>Cn;){const li=L[Fs].text.trim(),ro=li.indexOf("=>");if(ro>=0){const zo=li.slice(0,ro).trim(),io=li.slice(ro+2).trim();Ts.push({cond:zo||void 0,expr:io||void 0,lineNo:L[Fs].lineNo})}Fs+=1}if(!Ts.length){e.push({message:"switch requires at least one case",line:G});continue}const Es=Rn?So(Rn,`switch_${In}`):"";let Co="na";for(let li=Ts.length-1;li>=0;li--){const ro=Ts[li],zo=ro.expr?So(ro.expr,`switch_${In}_case`):"na";if(!ro.cond){Co=zo;continue}Co=`iff(${Es?`(${Es}) == (${So(ro.cond,`switch_${In}_cond`)})`:`(${So(ro.cond,`switch_${In}_cond`)})`}, ${zo}, ${Co})`}L.splice(se,Fs-se,{text:`${In} ${St} ${Co}`,indent:Cn,lineNo:G}),se-=1;continue}const yt=re.match(/^switch\s*(?:\((.*)\)|(.*))$/i);if(yt){const In=String(yt[1]??yt[2]??"").trim(),St=be.indent,Rn=[];let Cn=se+1;for(;Cn<L.length&&L[Cn].indent>St;){const Es=L[Cn].text.trim(),Co=Es.indexOf("=>");if(Co>=0){const li=Es.slice(0,Co).trim(),ro=Es.slice(Co+2).trim();Rn.push({cond:li||void 0,expr:ro||void 0,lineNo:L[Cn].lineNo})}Cn+=1}if(!Rn.length){e.push({message:"switch requires at least one case",line:G});continue}const Ts=In?So(In,"switch_expr"):"",Fs=[];Rn.forEach((Es,Co)=>{if(Es.expr){if(!Es.cond)Fs.push({text:"else",indent:St,lineNo:Es.lineNo});else if(Co===0){const li=Ts?`(${Ts}) == (${So(Es.cond,"switch_cond")})`:`(${So(Es.cond,"switch_cond")})`;Fs.push({text:`if (${li})`,indent:St,lineNo:Es.lineNo})}else{const li=Ts?`(${Ts}) == (${So(Es.cond,"switch_cond")})`:`(${So(Es.cond,"switch_cond")})`;Fs.push({text:`else if (${li})`,indent:St,lineNo:Es.lineNo})}Fs.push({text:Es.expr,indent:St+1,lineNo:Es.lineNo})}}),L.splice(se,Cn-se,...Fs),se-=1;continue}const vt=re.match(/^for\s+([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+?)\s+to\s+(.+?)(?:\s+by\s+(.+))?$/i);if(vt){const In=vt[1],St=String(vt[2]??"").trim(),Rn=String(vt[3]??"").trim(),Cn=String(vt[4]??"1").trim(),Ts=be.indent,Fs=Jc(L,se+1,Ts,[In]);if(Fs.nextIdx===se+1){e.push({message:"for-loop requires an indented body",line:G});continue}const Es=`__loop_${++hu}`;Fn=G;const Co={id:Es,kind:"for",lineNo:G,varName:In,startExpr:So(St,`for_start_${In}`),endExpr:So(Rn,`for_end_${In}`),stepExpr:So(Cn,`for_step_${In}`),body:Fs.ops};Hd.push(Co);const li=new Set;Au(Co.body,li);const ro=Array.from(li).filter(zo=>!Dt(zo).startsWith("__arr_"));ro.forEach(zo=>{ze.push({name:zo,updateExpr:`__loop_exec("${Es}", "${zo}")`})}),ro.length||ze.push({name:`__loop_exec_${Es}`,updateExpr:`__loop_exec("${Es}")`});for(let zo=se;zo<Fs.nextIdx;zo++)L[zo]={...L[zo],text:"//@pine_loop"};se=Fs.nextIdx-1;continue}const jt=re.match(/^while\s*(?:\((.*)\)|(.*))$/i);if(jt){const In=String(jt[1]??jt[2]??"").trim();if(!In){e.push({message:"while statement missing condition",line:G});continue}const St=be.indent,Rn=Jc(L,se+1,St,[]);if(Rn.nextIdx===se+1){e.push({message:"while-loop requires an indented body",line:G});continue}const Cn=`__loop_${++hu}`;Fn=G;const Ts={id:Cn,kind:"while",lineNo:G,condExpr:So(In,"while_cond"),body:Rn.ops};Hd.push(Ts);const Fs=new Set;Au(Ts.body,Fs);const Es=Array.from(Fs).filter(Co=>!Dt(Co).startsWith("__arr_"));Es.forEach(Co=>{ze.push({name:Co,updateExpr:`__loop_exec("${Cn}", "${Co}")`})}),Es.length||ze.push({name:`__loop_exec_${Cn}`,updateExpr:`__loop_exec("${Cn}")`});for(let Co=se;Co<Rn.nextIdx;Co++)L[Co]={...L[Co],text:"//@pine_loop"};se=Rn.nextIdx-1;continue}const ye=re.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(ye){const In=String(ye[1]??ye[2]??"").trim();if(!In){e.push({message:"if statement missing condition",line:G});continue}const St=be.indent,Rn=us=>{const ko=[];let ur=us;for(;ur<L.length&&L[ur].indent>St;)L[ur].text.startsWith("//@pine_fn")||ko.push(L[ur]),ur+=1;return{body:ko,nextIdx:ur}},Cn=[],Ts=Rn(se+1);if(!Ts.body.length){e.push({message:"if statement requires an indented body",line:G});continue}Cn.push({condRaw:In,body:Ts.body,lineNo:G});let Fs=Ts.nextIdx;for(;Fs<L.length&&L[Fs].indent===St;){const us=L[Fs].text.trim(),ko=us.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(ko){const Pr=String(ko[1]??ko[2]??"").trim();if(!Pr){e.push({message:"else if missing condition",line:L[Fs].lineNo});break}const kr=Rn(Fs+1);if(!kr.body.length){e.push({message:"else if requires an indented body",line:L[Fs].lineNo});break}Cn.push({condRaw:Pr,body:kr.body,lineNo:L[Fs].lineNo}),Fs=kr.nextIdx;continue}if(us.match(/^else$/i)){const Pr=Rn(Fs+1);if(!Pr.body.length){e.push({message:"else requires an indented body",line:L[Fs].lineNo});break}Cn.push({condRaw:void 0,body:Pr.body,lineNo:L[Fs].lineNo}),Fs=Pr.nextIdx;break}break}const Es=[],Co=[];Cn.forEach((us,ko)=>{if(!us.condRaw){Es.push(null),Co.push(null);return}const ur=So(us.condRaw,`if_${ko+1}`);Es.push(Mu(ur)),Co.push(Yu(B_(ur)))});const li=(us,ko)=>{const ur=us.slice(0,ko).filter(Boolean);return ur.length?ur.map(Pr=>`(${Pr})`).join(" or "):""},ro=us=>{const ko=Es[us],ur=li(Es,us);return ko?ur?`((${ko}) and not (${ur}))`:`(${ko})`:ur?`not (${ur})`:"1"},zo=us=>{const ko=Co[us],ur=li(Co,us);return ko?ur?`((${ko}) and not (${ur}))`:`(${ko})`:ur?`not (${ur})`:"1"},io=(us,ko)=>{var bd,Or;const ur=us.match(/^array\.set\s*\((.*)\)\s*$/i);if(ur){const pc=Gr(ur[1]||""),Wc=String(pc[0]||"").trim(),Od=String(pc[1]||"").trim(),Zu=String(pc[2]||"").trim();if(!Wc||!Od||!Zu)return e.push({message:"array.set(name, index, value) requires 3 args",line:ko}),null;const ff=Dt(Wc),xd=Je[ff],Wf=Ze[ff];if(!xd&&!Wf)return e.push({message:`array.set unknown array "${Wc}"`,line:ko}),null;const Ui=yr(ff,Od);if(Ui!=null){const ku=(Wf==null?void 0:Wf.size)??(xd==null?void 0:xd.length)??Ui+1;Eo(ff,ku,xd);const Rm=So(Zu,`${ff}_${Ui}`),Wg=oo(Rm);return xd&&Wg!=null&&(xd[Ui]=Wg),[{name:Rt(ff,Ui),hasVar:!1,declaredType:"",op:":=",rhs:Rm,lineNo:ko}]}const om=So(Od,`${ff}_idx`),Ef=Fi(om),it=So(Zu,`${ff}_set`),gv=(bd=Ze[ff])==null?void 0:bd.sizeSeries,Nv=gv!=null?`(${Ef}) >= 0 and (${Ef}) < ${gv}`:void 0,Ep=uc(ff,Ef,it,Nv);return Ep?Ep.map((ku,Rm)=>({name:Rt(ff,Rm),hasVar:!1,declaredType:"",op:":=",rhs:ku,lineNo:ko})):(e.push({message:"array.set index must be within array size",line:ko}),null)}const Pr=us.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(Pr){const pc=String(Pr[1]||"").toLowerCase(),Wc=Gr(Pr[2]||""),Od=String(Wc[0]||"").trim(),Zu=Dt(Od);if(!Od)return e.push({message:`array.${pc} requires array name`,line:ko}),null;if(!Ze[Zu]&&!Je[Zu])return e.push({message:`array.${pc} unknown array "${Od}"`,line:ko}),null;!Ze[Zu]&&Je[Zu]&&Eo(Zu,Je[Zu].length,Je[Zu]);const ff=Ze[Zu];if(!ff)return null;if(pc==="push"||pc==="unshift"||pc==="insert"){const Ui=Math.min(xs,Math.max(ff.capacity,ff.size+_o));Lr(Zu,Ui)}if(pc==="resize"){const Ui=String(Wc[1]||"0"),om=oo(Ui);if(om!=null){const Ef=Math.min(xs,Math.max(ff.capacity,Math.floor(om)));Lr(Zu,Ef)}}Fa(Zu);const xd={};pc==="push"||pc==="unshift"?xd.value=Wc[1]:pc==="insert"?(xd.index=Wc[1],xd.value=Wc[2]):pc==="remove"?xd.index=Wc[1]:pc==="resize"&&(xd.size=Wc[1]);const Wf=dc(Zu,pc,xd,ko);return Wf||null}const kr=us.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(!kr)return null;const Sr=String(kr[5]||"").trim();if(/^(line|label|box|table|linefill)\.new\s*\(/i.test(Sr)||/^table\.cell\s*\(/i.test(Sr))return null;const Lu=Sr.match(/^array\.(pop|shift|remove)\s*\((.*)\)\s*$/i);if(Lu){const pc=String(Lu[1]||"").toLowerCase(),Wc=Gr(Lu[2]||""),Od=String(Wc[0]||"").trim(),Zu=Dt(Od);if(!Od)return e.push({message:`array.${pc} requires array name`,line:ko}),null;if(!Ze[Zu]&&!Je[Zu])return e.push({message:`array.${pc} unknown array "${Od}"`,line:ko}),null;if(!Ze[Zu]&&Je[Zu]&&Eo(Zu,Je[Zu].length,Je[Zu]),!Ze[Zu])return null;Fa(Zu);const xd=pc==="pop"?`array.size(${Od}) - 1`:pc==="shift"?"0":String(Wc[1]||"0"),Wf=So(`array.get(${Od}, ${xd})`,kr[3]||"array_pop"),Ui=dc(Zu,pc==="pop"?"pop":pc==="shift"?"shift":"remove",{index:Wc[1]},ko);return Ui?[{name:kr[3],hasVar:!!kr[1],declaredType:kr[2]?String(kr[2]).toLowerCase():"",op:kr[4],rhs:Wf,lineNo:ko},...Ui]:null}const iu=Sr.match(/^array\.(copy|concat)\s*\((.*)\)\s*$/i);if(iu){const pc=String(iu[1]||"").toLowerCase(),Wc=Gr(iu[2]||""),Od=Dt(kr[3]);if(pc==="copy"){const om=String(Wc[0]||"").trim(),Ef=Dt(om);if(!om)return e.push({message:"array.copy requires source array name",line:ko}),null;if(Ct[Ef])return Ct[Od]=[...Ct[Ef]],qs(Od),[];if(!Ze[Ef]&&!Je[Ef])return e.push({message:`array.copy unknown array "${om}"`,line:ko}),null;!Ze[Ef]&&Je[Ef]&&Eo(Ef,Je[Ef].length,Je[Ef]);const it=Bc(Od,Ef,ko);return it?((Or=Ze[Ef])!=null&&Or.dynamic&&Ze[Od]&&(Ze[Od].dynamic=!0),it):null}const Zu=String(Wc[0]||"").trim(),ff=String(Wc[1]||"").trim(),xd=Dt(Zu),Wf=Dt(ff);if(!Zu||!ff)return e.push({message:"array.concat requires two arrays",line:ko}),null;if(Ct[xd]||Ct[Wf])return!Ct[xd]||!Ct[Wf]?(e.push({message:"array.concat string arrays must be same type",line:ko}),null):(Ct[Od]=[...Ct[xd],...Ct[Wf]],qs(Od),[]);if(!Ze[xd]&&!Je[xd])return e.push({message:`array.concat unknown array "${Zu}"`,line:ko}),null;if(!Ze[Wf]&&!Je[Wf])return e.push({message:`array.concat unknown array "${ff}"`,line:ko}),null;!Ze[xd]&&Je[xd]&&Eo(xd,Je[xd].length,Je[xd]),!Ze[Wf]&&Je[Wf]&&Eo(Wf,Je[Wf].length,Je[Wf]);const Ui=rd(Od,xd,Wf,ko);return Ui||null}return[{name:kr[3],hasVar:!!kr[1],declaredType:kr[2]?String(kr[2]).toLowerCase():"",op:kr[4],rhs:So(Sr,kr[3]),lineNo:ko}]},Ji={},Hl=[],Vc=(us,ko)=>{for(const ur of us){const Pr=io(ur.text,ur.lineNo);if(Pr){for(const kr of Pr){const Sr=Dt(kr.name),Lu=Ji[Sr]||(Ji[Sr]={base:void 0,branches:new Array(Cn.length).fill(null)});Lu.base||(Lu.base=kr),Lu.branches[ko]=kr}continue}Hl.push({text:ur.text,lineNo:ur.lineNo,branchIndex:ko,indent:ur.indent})}};Cn.forEach((us,ko)=>Vc(us.body,ko));const ol=(us,ko)=>{let ur=!1;const Pr=us.map(kr=>ur||zu(kr)?kr:(ur=!0,ko));return ur||Pr.unshift(ko),Pr},Ac=(us,ko,ur)=>{const Pr=ko.match(new RegExp(`^${us}\\s*\\((.*)\\)\\s*$`,"i"));if(!Pr)return null;const kr=Gr(Pr[1]||""),Sr=ro(ur),Lu=zo(ur);if(us==="plot"){const Or=kr.find(Wc=>!zu(Wc))||"",pc=`iff(${Sr}, ${Or||"na"}, na)`;return`${us}(${ol(kr,pc).join(", ")})`}const iu=kr.find(Or=>!zu(Or))||"",bd=iu?`${Lu} and (${iu})`:Lu;return`${us}(${ol(kr,bd).join(", ")})`},br=(us,ko)=>{const ur=us.match(/^signal\s+([A-Za-z_$][A-Za-z0-9_$]*)\s+when\s+(.+)$/i);if(!ur)return null;const Pr=ur[1],kr=String(ur[2]||"").trim(),Sr=zo(ko),Lu=kr?`${Sr} and (${kr})`:Sr;return`signal ${Pr} when ${Lu}`},fa=(us,ko)=>{const ur=us.match(/^(strategy\.(entry|exit|close|close_all|order|cancel|cancel_all))\s*\((.*)\)\s*$/i);if(!ur)return null;const Pr=ur[1],kr=Gr(ur[3]||""),Sr=zo(ko);let Lu=!1;const iu=kr.map(bd=>/^\s*when\s*=/.test(bd)?(Lu=!0,`when=${Sr} and (${bd.replace(/^\s*when\s*=\s*/i,"")})`):bd);return Lu||iu.push(`when=${Sr}`),`${Pr}(${iu.join(", ")})`},Dl=(us,ko,ur)=>{const Pr=ko.match(new RegExp(`^(?:varip\\s+|var\\s+)?(?:(?:float|int|bool|string|line|label|box|table|linefill)\\s+)?[A-Za-z_$][A-Za-z0-9_$]*\\s*(?::=|=)\\s*${us}\\s*\\((.*)\\)\\s*$`,"i")),kr=ko.match(new RegExp(`^${us}\\s*\\((.*)\\)\\s*$`,"i"));if(!Pr&&!kr)return null;const Sr=Gr(((Pr==null?void 0:Pr[1])||(kr==null?void 0:kr[1]))??""),Lu=zo(ur);let iu=!1;const bd=Sr.map(Or=>/^\s*when\s*=/.test(Or)?(iu=!0,`when=${Lu} and (${Or.replace(/^\s*when\s*=\s*/i,"")})`):Or);return iu||bd.push(`when=${Lu}`),`${us}(${bd.join(", ")})`},Fu=(us,ko)=>{const ur=us.match(/^(line|label|box|table|linefill|polyline|polygon|path)\.([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(!ur)return null;const Pr=`${String(ur[1]).toLowerCase()}.${String(ur[2]).toLowerCase()}`,kr=Gr(ur[3]||""),Sr=zo(ko);let Lu=!1;const iu=kr.map(bd=>/^\s*when\s*=/.test(bd)?(Lu=!0,`when=${Sr} and (${bd.replace(/^\s*when\s*=\s*/i,"")})`):bd);return Lu||iu.push(`when=${Sr}`),`${Pr}(${iu.join(", ")})`},Xr=[],cr=(us,ko,ur)=>Xr.push({text:us,indent:ur??St,lineNo:ko,loopSeq:!!be.loopSeq});Object.values(Ji).forEach(us=>{var Or,pc;const ko=us.base;if(!ko)return;const ur=!!us.branches.some(Wc=>Wc==null?void 0:Wc.hasVar),Pr=((Or=us.branches.find(Wc=>Wc==null?void 0:Wc.declaredType))==null?void 0:Or.declaredType)||"",kr=((pc=us.branches.find(Wc=>Wc==null?void 0:Wc.op))==null?void 0:pc.op)||"=",Sr=kr===":="?ko.name:"na",Lu=Wc=>{for(let Od=Wc;Od<Cn.length;Od++){const Zu=us.branches[Od];if(!Zu)continue;const ff=Es[Od],xd=Lu(Od+1);return ff?`iff(${ff}, ${Zu.rhs}, ${xd})`:Zu.rhs}return Sr},iu=Lu(0),bd=`${ur?"var ":""}${Pr?`${Pr} `:""}`;cr(`${bd}${ko.name} ${kr} ${iu}`,ko.lineNo)});for(const us of Hl){const ko=us.text.trim(),ur=ro(us.branchIndex);zo(us.branchIndex);const Pr=ko.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(Pr){const Lu=String(Pr[1]??Pr[2]??"").trim(),iu=ur&&ur!=="1"?`(${ur}) and (${Lu})`:Lu;cr(`if (${iu})`,us.lineNo,us.indent);continue}const kr=ko.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(kr){const Lu=String(kr[1]??kr[2]??"").trim(),iu=ur&&ur!=="1"?`(${ur}) and (${Lu})`:Lu;cr(`else if (${iu})`,us.lineNo,us.indent);continue}if(/^else$/i.test(ko)){cr(ur&&ur!=="1"?`else if (${ur})`:"else",us.lineNo,us.indent);continue}const Sr=Ac("plot",us.text,us.branchIndex)||Ac("plotshape",us.text,us.branchIndex)||Ac("plotchar",us.text,us.branchIndex)||Dl("line.new",us.text,us.branchIndex)||Dl("linefill.new",us.text,us.branchIndex)||Dl("label.new",us.text,us.branchIndex)||Dl("box.new",us.text,us.branchIndex)||Dl("polyline.new",us.text,us.branchIndex)||Dl("polygon.new",us.text,us.branchIndex)||Dl("path.new",us.text,us.branchIndex)||Dl("table.cell",us.text,us.branchIndex)||Fu(us.text,us.branchIndex)||br(us.text,us.branchIndex)||fa(us.text,us.branchIndex);if(Sr){cr(Sr,us.lineNo,us.indent);continue}e.push({message:`Unsupported statement inside if: ${us.text}`,line:us.lineNo})}Xr.length||t.push({message:"if statement produced no output",line:G}),L.splice(se,Fs-se,...Xr),se-=1;continue}const E=re.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.from\s*\((.*)\)\s*$/i);if(E){const In=Dt(E[1]),St=Gr(E[2]||""),Rn=[],Cn=[];let Ts=!1,Fs=!1,Es=!0;for(const Co of St){const li=String(Co||"").trim();if(li.startsWith('"')&&li.endsWith('"')||li.startsWith("'")&&li.endsWith("'")){Cn.push(Tr(li)),Ts=!0;continue}const zo=So(li,`array_from_${In}`),io=oo(zo);if(io==null){Es=!1;break}Rn.push(io),Fs=!0}if(!Es||!Rn.length&&!Cn.length||Ts&&Fs){e.push({message:"array.from(...) supports only all-numeric or all-string literals (compile-time)",line:G});continue}Ts?(Ct[In]=Cn,qs(In),Ia(In,Cn.length,Cn)):(Eo(In,Rn.length,Rn),Je[In]=Rn);continue}const me=re.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.new_(float|int|bool|string)\s*\((.*)\)\s*$/i);if(me){const In=Dt(me[1]),St=String(me[2]||"").toLowerCase(),Rn=Gr(me[3]||""),Cn=Rn[0]??"0",Ts=Rn[1]??"0",Fs=oo(Cn);if(Fs==null||Fs<0){e.push({message:"array.new_* size must be a numeric constant or param",line:G});continue}if(St==="string"){let li="";const ro=String(Ts??"").trim();(ro.startsWith('"')&&ro.endsWith('"')||ro.startsWith("'")&&ro.endsWith("'"))&&(li=Tr(ro));const io=new Array(Math.floor(Fs));for(let Ji=0;Ji<io.length;Ji++)io[Ji]=li;Ct[In]=io,qs(In),Ia(In,io.length,io);continue}let Es=oo(Ts);if(Es==null){const li=Zg(String(Ts));li!=null&&(Es=li?1:0)}Es==null&&(Es=0);const Co=new Array(Math.floor(Fs));for(let li=0;li<Co.length;li++)Co[li]=Es;Eo(In,Co.length,Co);continue}const Se=re.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(Se){const In=String(Se[1]||"").toLowerCase(),St=Gr(Se[2]||""),Rn=String(St[0]||"").trim(),Cn=Dt(Rn);if(!Rn){e.push({message:`array.${In} requires array name`,line:G});continue}if(!!Ct[Cn]||((qd=Ze[Cn])==null?void 0:qd.kind)==="string"){if(In!=="push"&&In!=="clear"){t.push({message:`array.${In} on string arrays is not supported yet (ignored)`,line:G});continue}if(!Ze[Cn]){const Ji=Ct[Cn];Ia(Cn,(Ji==null?void 0:Ji.length)??0,Ji)}let ro=Ze[Cn];if(!ro)continue;if(In==="push"){const Ji=Math.min(xs,Math.max(ro.capacity,ro.size+_o));if(Qa(Cn,Ji),ro=Ze[Cn],!ro)continue}Fa(Cn);const zo=[];if(In==="push"){const Ji=So(String(St[1]??"na"),`${Cn}_push`),Hl=`__str_num(${Ji})`,Vc=ro.sizeSeries,ol=`(${Vc}) < ${ro.capacity}`,Ac=`__arr_str_valid(${Ji})`,br=`(${ol}) and (${Ac})`,fa=uc(Cn,Vc,Hl,br);fa&&fa.forEach((Dl,Fu)=>{zo.push({name:Rt(Cn,Fu),hasVar:!1,declaredType:"",op:":=",rhs:Dl,lineNo:G})}),zo.push({name:Vc,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${br}, min(${Vc} + 1, ${ro.capacity}), ${Vc})`,lineNo:G})}else In==="clear"&&zo.push({name:ro.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:"0",lineNo:G});const io=zo.map(Ji=>({text:`${Ji.name} ${Ji.op} ${Ji.rhs}`,indent:be.indent,lineNo:G,loopSeq:be.loopSeq}));io.length&&(L.splice(se,1,...io),se-=1);continue}if(!Ze[Cn]&&!Je[Cn]){e.push({message:`array.${In} unknown array "${Rn}"`,line:G});continue}!Ze[Cn]&&Je[Cn]&&Eo(Cn,Je[Cn].length,Je[Cn]);const Fs=Ze[Cn];if(!Fs)continue;if(In==="push"||In==="unshift"||In==="insert"){const ro=Math.min(xs,Math.max(Fs.capacity,Fs.size+_o));Lr(Cn,ro)}if(In==="resize"){const ro=String(St[1]||"0"),zo=oo(ro);if(zo!=null){const io=Math.min(xs,Math.max(Fs.capacity,Math.floor(zo)));Lr(Cn,io)}}Fa(Cn);const Es={};In==="push"||In==="unshift"?Es.value=St[1]:In==="insert"?(Es.index=St[1],Es.value=St[2]):In==="remove"?Es.index=St[1]:In==="resize"&&(Es.size=St[1]);const Co=dc(Cn,In,Es,G);if(!Co)continue;const li=Co.map(ro=>({text:`${ro.name} ${ro.op} ${ro.rhs}`,indent:be.indent,lineNo:G,loopSeq:be.loopSeq}));L.splice(se,1,...li),se-=1;continue}const Ve=re.match(/^array\.set\s*\((.*)\)\s*$/i);if(Ve){const In=Gr(Ve[1]||""),St=String(In[0]||"").trim(),Rn=String(In[1]||"").trim(),Cn=String(In[2]||"").trim();if(!St||!Rn||!Cn){e.push({message:"array.set(name, index, value) requires 3 args",line:G});continue}const Ts=Dt(St),Fs=Je[Ts],Es=Ct[Ts],Co=Ze[Ts],li=!!Es||(Co==null?void 0:Co.kind)==="string";if(!Fs&&!Co&&!Es){e.push({message:`array.set unknown array "${St}"`,line:G});continue}if(li){Ze[Ts]||Ia(Ts,(Es==null?void 0:Es.length)??0,Es);const zo=Ze[Ts];if(!zo)continue;const io=So(Rn,`${Ts}_idx`),Hl=`__str_num(${So(Cn,`${Ts}_set`)})`,Vc=zo.sizeSeries,ol=Vc?`__arr_set_guard(${io}, ${Vc})`:void 0,Ac=uc(Ts,io,Hl,ol,{normalizeIndex:!1});if(!Ac){e.push({message:"array.set index must be within array size",line:G});continue}const br=Ac.map((fa,Dl)=>({text:`${Rt(Ts,Dl)} := ${fa}`,indent:be.indent,lineNo:G,loopSeq:be.loopSeq}));Fa(Ts),L.splice(se,1,...br),se-=1;continue}const ro=yr(Ts,Rn);if(ro!=null){const zo=(Co==null?void 0:Co.size)??(Fs==null?void 0:Fs.length)??ro+1;Eo(Ts,zo,Fs);const io=So(Cn,`${Ts}_${ro}`),Ji=oo(io);Fs&&Ji!=null&&(Fs[ro]=Ji),re=`${Rt(Ts,ro)} := ${io}`}else{const zo=So(Rn,`${Ts}_idx`),io=Fi(zo),Ji=So(Cn,`${Ts}_set`),Hl=(Xf=Ze[Ts])==null?void 0:Xf.sizeSeries,Vc=Hl!=null?`(${io}) >= 0 and (${io}) < ${Hl}`:void 0,ol=uc(Ts,io,Ji,Vc);if(!ol){e.push({message:"array.set index must be within array size",line:G});continue}const Ac=ol.map((br,fa)=>({text:`${Rt(Ts,fa)} := ${br}`,indent:be.indent,lineNo:G,loopSeq:be.loopSeq}));L.splice(se,1,...Ac),se-=1;continue}}{const In=re.match(/^\s*\[([^\]]+)\]\s*(:=|=)\s*(.+)$/);if(In){const St=In[1]||"",Rn=In[2]||"=",Ts=String(In[3]||"").trim().match(/^(?:ta\.)?(bbands|bollinger|macd|stoch|aroon|dmi|supertrend|keltner|kc|donchian|kdj|kst|vortex)\s*\((.*)\)\s*$/i);if(Ts){const Fs=String(Ts[1]||"").toLowerCase(),Es=String(Ts[2]||""),Co=Gr(St).map(io=>io.trim()).filter(Boolean),li=Fs==="stoch"||Fs==="aroon"||Fs==="supertrend"||Fs==="kst"||Fs==="vortex"?2:3;if(Co.length!==li){e.push({message:`${Ts[1]}() assignment requires ${li} target${li===1?"":"s"}`,line:G});continue}const ro=Co.find(io=>io!=="_"&&!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(io));if(ro){e.push({message:`Invalid assignment target "${ro}"`,line:G});continue}const zo=[];for(let io=0;io<Co.length;io++){const Ji=Co[io];if(Ji==="_")continue;const Hl=Es.trim()?`${Es}, ${io}`:String(io);zo.push({text:`${Ji} ${Rn} ${Fs}(${Hl})`,indent:be.indent,lineNo:G,loopSeq:be.loopSeq})}if(zo.length){L.splice(se,1,...zo),se-=1;continue}}}}const Ye=re.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(Ye){const In=!!Ye[1],St=Ye[2]?String(Ye[2]).toLowerCase():"",Rn=Ye[3],Cn=Ye[4],Ts=String(Ye[5]||"").trim(),Fs=Ts.match(/^(line|label|box|table|linefill|polyline|polygon|path)\.new\s*\((.*)\)\s*$/i);if(Fs){const br=String(Fs[1]||"").toLowerCase();if(br==="line"){Li(Fs[2]||"",G,Rn,In);continue}if(br==="linefill"){Ic(Fs[2]||"",G,Rn,In);continue}if(br==="label"){Vr(Fs[2]||"",G,Rn,In);continue}if(br==="box"){ba(Fs[2]||"",G,Rn,In);continue}if(br==="table"){qi(Fs[2]||"",G,Rn,In);continue}if(br==="polyline"){mr(Fs[2]||"",G,Rn,In);continue}if(br==="polygon"){Ba(Fs[2]||"",G,Rn,In);continue}if(br==="path"){ul(Fs[2]||"",G,Rn,In);continue}}const Es=Ts.match(/^table\.cell\s*\((.*)\)\s*$/i);if(Es){Wr(Es[1]||"",G);continue}const Co=Ts.match(/^plot\s*\((.*)\)\s*$/i);if(Co){bf(Co[1]||"",G,Rn);continue}const li=Ts.match(/^array\.(pop|shift|remove)\s*\((.*)\)\s*$/i);if(li){const br=String(li[1]||"").toLowerCase(),fa=Gr(li[2]||""),Dl=String(fa[0]||"").trim(),Fu=Dt(Dl);if(!Dl){e.push({message:`array.${br} requires array name`,line:G});continue}if(!Ze[Fu]&&!Je[Fu]){e.push({message:`array.${br} unknown array "${Dl}"`,line:G});continue}if(!Ze[Fu]&&Je[Fu]&&Eo(Fu,Je[Fu].length,Je[Fu]),!Ze[Fu])continue;Fa(Fu);const cr=br==="pop"?`array.size(${Dl}) - 1`:br==="shift"?"0":String(fa[1]||"0"),us=So(`array.get(${Dl}, ${cr})`,Rn),ko=dc(Fu,br==="pop"?"pop":br==="shift"?"shift":"remove",{index:fa[1]},G);if(!ko)continue;const Pr=[{text:`${`${In?"var ":""}${St?`${St} `:""}`}${Rn} ${Cn} ${us}`,indent:be.indent,lineNo:G,loopSeq:be.loopSeq},...ko.map(kr=>({text:`${kr.name} ${kr.op} ${kr.rhs}`,indent:be.indent,lineNo:G,loopSeq:be.loopSeq}))];L.splice(se,1,...Pr),se-=1;continue}const ro=Ts.match(/^array\.(copy|concat)\s*\((.*)\)\s*$/i);if(ro){const br=String(ro[1]||"").toLowerCase(),fa=Gr(ro[2]||""),Dl=Dt(Rn);if(br==="copy"){const Pr=String(fa[0]||"").trim(),kr=Dt(Pr);if(!Pr){e.push({message:"array.copy requires source array name",line:G});continue}if(Ct[kr]){Ct[Dl]=[...Ct[kr]],qs(Dl),L.splice(se,1),se-=1;continue}if(!Ze[kr]&&!Je[kr]){e.push({message:`array.copy unknown array "${Pr}"`,line:G});continue}!Ze[kr]&&Je[kr]&&Eo(kr,Je[kr].length,Je[kr]);const Sr=Bc(Dl,kr,G);if(!Sr)continue;(Vf=Ze[kr])!=null&&Vf.dynamic&&Ze[Dl]&&(Ze[Dl].dynamic=!0);const Lu=Sr.map(iu=>({text:`${iu.name} ${iu.op} ${iu.rhs}`,indent:be.indent,lineNo:G,loopSeq:be.loopSeq}));L.splice(se,1,...Lu),se-=1;continue}const Fu=String(fa[0]||"").trim(),Xr=String(fa[1]||"").trim(),cr=Dt(Fu),us=Dt(Xr);if(!Fu||!Xr){e.push({message:"array.concat requires two arrays",line:G});continue}if(Ct[cr]||Ct[us]){if(!Ct[cr]||!Ct[us]){e.push({message:"array.concat string arrays must be same type",line:G});continue}Ct[Dl]=[...Ct[cr],...Ct[us]],qs(Dl),L.splice(se,1),se-=1;continue}if(!Ze[cr]&&!Je[cr]){e.push({message:`array.concat unknown array "${Fu}"`,line:G});continue}if(!Ze[us]&&!Je[us]){e.push({message:`array.concat unknown array "${Xr}"`,line:G});continue}!Ze[cr]&&Je[cr]&&Eo(cr,Je[cr].length,Je[cr]),!Ze[us]&&Je[us]&&Eo(us,Je[us].length,Je[us]);const ko=rd(Dl,cr,us,G);if(!ko)continue;const ur=ko.map(Pr=>({text:`${Pr.name} ${Pr.op} ${Pr.rhs}`,indent:be.indent,lineNo:G,loopSeq:be.loopSeq}));L.splice(se,1,...ur),se-=1;continue}if(Cn===":="){const br=Dt(Rn);br in ft||Rn in ft||!!Pt[br]||$e.some(Dl=>Dt(String((Dl==null?void 0:Dl.name)||""))===br)||ze.some(Dl=>Dt(String((Dl==null?void 0:Dl.name)||""))===br)||qe.some(Dl=>Dt(String((Dl==null?void 0:Dl.name)||""))===br)||t.push({message:`":=" used before "${Rn}" is defined (use "=" for first assignment)`,line:G})}const zo=V5(Ts);if(zo){qe.push({name:Rn,type:"security",symbol:zo.symbol,country:zo.country,timeframe:zo.timeframe,expr:zo.expr,lookahead:zo.lookahead,gaps:zo.gaps,lower:zo.lower});continue}const io=So(Ts,Rn);if(!Rn.startsWith("__arr_")&&Ql(Rn,io,G))continue;if(It(io)&&(Pt[Rn.replace(/\s+/g,"_").toLowerCase()]=B_(io)),(In||Cn===":=")&&St!=="bool"&&St!=="string"){const br=Dt(Rn),fa=br.startsWith("__arr_"),Fu=(()=>{const cr=Ke[br];if(typeof cr=="number")return cr;const us=ze.length;return Ke[br]=us,ze.push({name:Rn,initExpr:void 0,updateExpr:Rn,selfMode:fa?"current":void 0}),us})();if(Cn===":="){const cr=Dt(Rn),us=Object.prototype.hasOwnProperty.call(ft,Rn)?Rn:Object.prototype.hasOwnProperty.call(ft,cr)?cr:null;if(us&&ze[Fu]&&!ze[Fu].initExpr){const ko=ft[us];if(typeof ko=="number"&&Number.isFinite(ko))ze[Fu].initExpr=String(ko),delete ft[us];else if(typeof ko=="string"){const ur=Number(ko);Number.isFinite(ur)&&(ze[Fu].initExpr=String(ur),delete ft[us])}}}if((fa||!!be.loopSeq)&&Cn===":="&&typeof Ke[br]=="number"){ze.push({name:Rn,initExpr:void 0,updateExpr:io,selfMode:"current"});continue}if(In&&Cn==="="){ze[Fu].initExpr=io;continue}if(In&&Cn===":="){ze[Fu].initExpr=io,ze[Fu].updateExpr=io;continue}ze[Fu].updateExpr=io;continue}const ol=rh(io);if(ol!=null){ft[Rn]=ol;continue}const Ac=Zg(io);if(Ac!=null){ft[Rn]=Ac;continue}if(io.startsWith('"')&&io.endsWith('"')||io.startsWith("'")&&io.endsWith("'")){ft[Rn]=Tr(io);continue}$e.push({name:Rn,expr:io});continue}const at=re.match(/^strategy\s*\((.*)\)\s*$/i);if(at){const In=Gr(at[1]||""),St=su(In),Rn=Et&&typeof Et=="object"?{...Et}:null,Cn=(...ro)=>{for(const zo of ro){if(St[zo]==null)continue;const io=Tr(String(St[zo])),Ji=rh(io);if(Ji!=null)return Ji}},Ts=(...ro)=>{for(const zo of ro){if(St[zo]==null)continue;const io=Tr(String(St[zo])),Ji=rh(io);return Ji??io}},Fs=(...ro)=>{for(const zo of ro)if(St[zo]!=null)return Tr(String(St[zo]))},Es=Tr(String(St.default_qty_type??St.default_qty_type??"")).toLowerCase(),Co=Number(St.default_qty_value??St.default_qty_value??NaN),li=Es==="cash"?{type:"cash",value:Number.isFinite(Co)?Co:1e4}:Es==="qty"?{type:"qty",value:Number.isFinite(Co)?Co:1}:{type:"percent_of_equity",value:Number.isFinite(Co)?Co:100};if(Et={initialCapital:Cn("initial_capital","initialCapital")??1e4,from:Ts("from","start","startDate","dateFrom","rangeStart"),to:Ts("to","end","endDate","dateTo","rangeEnd"),session:Fs("session","tradingSession","sessionTime"),orderSize:li,commissionPct:Cn("commissionPct","commission")??0,slippagePct:Cn("slippagePct","slippage")??0,spreadPct:Cn("spreadPct","spread_pct","spread")??(Cn("spreadBps","spread_bps")!=null?Cn("spreadBps","spread_bps")/100:void 0),leverage:Cn("leverage","lev","marginLeverage","margin_leverage")??void 0,maintenanceMarginPct:Cn("maintenanceMarginPct","maintenance_margin_pct","maintMarginPct")??void 0,liquidationFeePct:Cn("liquidationFeePct","liquidation_fee_pct","liqFeePct")??void 0,borrowPctPerYear:Cn("borrowPctPerYear","borrow_pct_per_year","shortBorrowPctPerYear")??void 0,fundingPctPerDay:Cn("fundingPctPerDay","funding_pct_per_day","funding")??void 0,positionMode:(()=>{const ro=Tr(String(St.positionMode??St.position_mode??"")).toLowerCase();if(ro)return ro.includes("hedge")?"hedging":"netting"})()??void 0,closeMethod:(()=>{const ro=Tr(String(St.closeMethod??St.close_method??St.costBasis??St.cost_basis??"")).toLowerCase();if(ro)return ro.includes("lifo")?"lifo":ro.includes("avg")||ro.includes("average")?"avg":"fifo"})()??void 0,priceTick:Cn("priceTick","price_tick","tickSize","tick_size","tick","minTick","min_tick")??void 0,qtyStep:Cn("qtyStep","qty_step","quantityStep","quantity_step","lotStep","lot_step")??void 0,minQty:Cn("minQty","min_qty","minimumQty","minimum_qty")??void 0,pyramiding:Cn("pyramiding")??1,execution:Tr(String(St.execution??"intrabar_ohlc")),intrabarTieBreak:Tr(String(St.intrabarTieBreak??"worst_case")),ohlcPath:Tr(String(St.ohlcPath??"open_high_low_close")),allowShort:Zg(String(St.allowShort??""))??void 0,allowLong:Zg(String(St.allowLong??""))??void 0},Rn){const ro=["maxDrawdownPct","maxDrawdownCash","maxPositionPct","maxPositionCash","maxPositionQty","maxIntradayFilledOrders","maxIntradayLossPct","maxIntradayLossCash"];for(const zo of ro)Rn[zo]!=null&&(Et[zo]=Rn[zo])}continue}const Re=re.match(/^strategy\.risk\.([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Re){const In=String(Re[1]||"").trim().toLowerCase(),St=Gr(Re[2]||""),Rn=su(St),Cn=St.filter(Ji=>!zu(Ji)),Ts=Rn.value??Rn.max??Rn.size??Cn[0],Fs=Rn.type??Rn.qty_type??Rn.qtyType??Rn.position_type??Cn[1],Es=Ts!=null?rh(Tr(String(Ts))):null;if(Es==null||!Number.isFinite(Es)){e.push({message:`strategy.risk.${In}(...) requires numeric value`,line:G});continue}const Co=Fs!=null?Tr(String(Fs)).toLowerCase():"",li=Co.includes("percent")||Co.includes("equity"),ro=Co.includes("cash")||Co.includes("currency")||Co.includes("fixed"),zo=Co.includes("qty")||Co.includes("contract"),io=li?"percent":ro?"cash":zo?"qty":"percent";if((!Et||typeof Et!="object")&&(Et={enabled:!0}),In==="max_drawdown"||In==="max_drawdown_percent"){io==="cash"?Et.maxDrawdownCash=Es:Et.maxDrawdownPct=Es;continue}if(In==="max_position_size"||In==="max_position"||In==="max_position_size_contracts"){io==="cash"?Et.maxPositionCash=Es:io==="qty"?Et.maxPositionQty=Es:Et.maxPositionPct=Es;continue}if(In==="max_intraday_filled_orders"||In==="max_intraday_orders"){Et.maxIntradayFilledOrders=Math.max(0,Math.floor(Es));continue}if(In==="max_intraday_loss"||In==="max_daily_loss"){io==="cash"?Et.maxIntradayLossCash=Es:Et.maxIntradayLossPct=Es;continue}t.push({message:`Ignored strategy.risk method: ${In}`,line:G});continue}if(re.match(/^(indicator|study)\s*\((.*)\)\s*$/i))continue;const pt=re.match(/^line\.new\s*\((.*)\)\s*$/i);if(pt){Li(pt[1]||"",G);continue}const Ge=re.match(/^linefill\.new\s*\((.*)\)\s*$/i);if(Ge){Ic(Ge[1]||"",G);continue}const sn=re.match(/^label\.new\s*\((.*)\)\s*$/i);if(sn){Vr(sn[1]||"",G);continue}const Un=re.match(/^box\.new\s*\((.*)\)\s*$/i);if(Un){ba(Un[1]||"",G);continue}const Zs=re.match(/^polyline\.new\s*\((.*)\)\s*$/i);if(Zs){mr(Zs[1]||"",G);continue}const vs=re.match(/^polygon\.new\s*\((.*)\)\s*$/i);if(vs){Ba(vs[1]||"",G);continue}const Oo=re.match(/^path\.new\s*\((.*)\)\s*$/i);if(Oo){ul(Oo[1]||"",G);continue}const Pi=re.match(/^table\.new\s*\((.*)\)\s*$/i);if(Pi){qi(Pi[1]||"",G);continue}const no=re.match(/^table\.clear\s*\((.*)\)\s*$/i);if(no){mu(no[1]||"",G);continue}const gl=re.match(/^table\.merge(?:_cells)?\s*\((.*)\)\s*$/i);if(gl){bc(gl[1]||"",G);continue}const Ms=re.match(/^table\.cell\s*\((.*)\)\s*$/i);if(Ms){Wr(Ms[1]||"",G);continue}const wo=re.match(/^line\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(wo){Kl(wo[1]||"",wo[2]||"",G);continue}const fr=re.match(/^line\.delete\s*\((.*)\)\s*$/i);if(fr){Wl(fr[1]||"");continue}const xa=re.match(/^polyline\.set\s*\((.*)\)\s*$/i);if(xa){La(xa[1]||"",G);continue}const ic=re.match(/^polyline\.delete\s*\((.*)\)\s*$/i);if(ic){Sl(ic[1]||"");continue}const ec=re.match(/^polygon\.set\s*\((.*)\)\s*$/i);if(ec){vi(ec[1]||"",G);continue}const Lf=re.match(/^polygon\.delete\s*\((.*)\)\s*$/i);if(Lf){vc(Lf[1]||"");continue}const _e=re.match(/^path\.set\s*\((.*)\)\s*$/i);if(_e){Ga(_e[1]||"",G);continue}const We=re.match(/^path\.delete\s*\((.*)\)\s*$/i);if(We){vl(We[1]||"");continue}const xt=re.match(/^linefill\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(xt){Pc(xt[1]||"",xt[2]||"",G);continue}const Ht=re.match(/^linefill\.delete\s*\((.*)\)\s*$/i);if(Ht){cl(Ht[1]||"");continue}const qt=re.match(/^label\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(qt){pu(qt[1]||"",qt[2]||"",G);continue}const ht=re.match(/^label\.delete\s*\((.*)\)\s*$/i);if(ht){tl(ht[1]||"");continue}const dn=re.match(/^box\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(dn){Oa(dn[1]||"",dn[2]||"",G);continue}const Ut=re.match(/^box\.delete\s*\((.*)\)\s*$/i);if(Ut){Oc(Ut[1]||"");continue}const Xn=re.match(/^table\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Xn){Gu(Xn[1]||"",Xn[2]||"",G);continue}const rs=re.match(/^table\.delete\s*\((.*)\)\s*$/i);if(rs){El(rs[1]||"");continue}const _t=re.match(/^table\.cell_set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(_t){nl(_t[1]||"",_t[2]||"",G);continue}const Gt=re.match(/^plotcandle\s*\((.*)\)\s*$/i);if(Gt){Xu("candles",Gt[1]||"",G);continue}const en=re.match(/^plotbar\s*\((.*)\)\s*$/i);if(en){Xu("ohlc",en[1]||"",G);continue}const cs=re.match(/^plotohlc\s*\((.*)\)\s*$/i);if(cs){Xu("ohlc",cs[1]||"",G);continue}const ps=re.match(/^plotfill\s*\((.*)\)\s*$/i);if(ps){const In=Gr(ps[1]||""),St=su(In),Rn=In.filter(Co=>!zu(Co));if(Rn.length<2){e.push({message:"plotfill() requires 2 plot series",line:G});continue}const Cn=hc(St),Ts=Ie(Cn),Fs=Ku(Rn[0],"plotfill_a"),Es=Ku(Rn[1],"plotfill_b");Ts.fills=Array.isArray(Ts.fills)?Ts.fills:[],Ts.fills.push({between:[Fs,Es],color:Ro(String(St.color??""))||Tr(String(St.color??""))||"rgba(34,197,94,0.10)"});continue}const vo=re.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*plot\s*\((.*)\)\s*$/i);if(vo){bf(vo[2]||"",G,vo[1]);continue}const Ko=re.match(/^plot\s*\((.*)\)\s*$/i);if(Ko){bf(Ko[1]||"",G);continue}const ho=re.match(/^plotarrow\s*\((.*)\)\s*$/i);if(ho){const In=Gr(ho[1]||""),St=su(In),Rn=In.filter(zo=>!zu(zo));if(!Rn.length){e.push({message:"plotarrow() requires a series",line:G});continue}const Cn=hc(St),Ts=Ie(Cn),Fs=Nu(Rn[0],"plotarrow").replace(/\s+/g,"_").toLowerCase(),Es=B_(So(`${Fs} > 0`,"plotarrow_up")),Co=B_(So(`${Fs} < 0`,"plotarrow_down")),li=Ro(String(St.colorup??St.color_up??""))||"#22c55e",ro=Ro(String(St.colordown??St.color_down??""))||"#ef4444";Ts.labels.push({when:Es,text:"▲",color:li,position:"below",source:"low",shape:"arrowUp"}),Ts.labels.push({when:Co,text:"▼",color:ro,position:"above",source:"high",shape:"arrowDown"});continue}const wa=re.match(/^plotshape\s*\((.*)\)\s*$/i);if(wa){const In=Gr(wa[1]||"");if(!In.length){e.push({message:"plotshape() requires at least 1 argument",line:G});continue}const St=su(In),Rn=In.filter(cr=>!zu(cr)),Cn=Rn[0]?$l(Rn[0],G):{};if(!(Cn.when??Cn.whenExpr)){e.push({message:"plotshape() missing condition",line:G});continue}const Fs=hc(St),Es=Ie(Fs),Co=B5(String(St.location??"")),li=Co==="below",ro=li?"below":"above",zo=St.price??St.y??St.source??St.series,io=zo!=null?Nu(String(zo),"shape_price").replace(/\s+/g,"_").toLowerCase():Co==="absolute"?"close":li?"low":"high",Hl=iQ(String(St.style??St.shape??""))||(li?"triangle_up_filled":"triangle_down_filled");if(Hl==="none")continue;const Vc=Tr(String(St.text??St.title??""))||(li?"BUY":"SELL"),ol=St.transp??St.transparency,Ac=ol!=null?Number(ol):void 0,br=G0(Ro(String(St.color??""))||(li?"#16a34a":"#ef4444"),Ac),fa=Ro(String(St.textcolor??St.textColor??""))||void 0,Dl=H1(String(St.size??""))||void 0,Fu=zr(St.offset,"plotshape_offset");let Xr=Fu.value;Fu.value!=null&&Number.isFinite(Xr)?Xr=Math.trunc(Xr):Fu.expr&&r&&t.push({message:"plotshape offset must be a constant integer",line:G}),Es.labels.push({when:Cn.when,whenExpr:Cn.whenExpr,text:Vc,color:br,textColor:fa,position:ro,source:io,shape:Hl,size:Dl,offset:Xr});continue}const di=re.match(/^plotchar\s*\((.*)\)\s*$/i);if(di){const In=Gr(di[1]||"");if(!In.length){e.push({message:"plotchar() requires at least 1 argument",line:G});continue}const St=su(In),Rn=In.filter(Fu=>!zu(Fu)),Cn=Rn[0]?$l(Rn[0],G):{};if(!(Cn.when??Cn.whenExpr)){e.push({message:"plotchar() missing condition",line:G});continue}const Fs=hc(St),Es=Ie(Fs),Co=B5(String(St.location??"")),li=Co==="below",ro=li?"below":"above",zo=St.price??St.y??St.source??St.series,io=zo!=null?Nu(String(zo),"char_price").replace(/\s+/g,"_").toLowerCase():Co==="absolute"?"close":li?"low":"high",Ji=Tr(String(St.char??""))||Tr(String(St.text??""))||"•",Hl=St.transp??St.transparency,Vc=Hl!=null?Number(Hl):void 0,ol=G0(Ro(String(St.color??""))||(li?"#16a34a":"#ef4444"),Vc),Ac=Ro(String(St.textcolor??St.textColor??""))||void 0,br=H1(String(St.size??""))||14,fa=zr(St.offset,"plotchar_offset");let Dl=fa.value;fa.value!=null&&Number.isFinite(Dl)?Dl=Math.trunc(Dl):fa.expr&&r&&t.push({message:"plotchar offset must be a constant integer",line:G}),Es.labels.push({when:Cn.when,whenExpr:Cn.whenExpr,text:Ji,color:ol,textColor:Ac,position:ro,source:io,shape:"text",size:br,offset:Dl});continue}const Mi=re.match(/^alert\s*\((.*)\)\s*$/i);if(Mi){const In=Gr(Mi[1]||"");if(!In.length){e.push({message:"alert() requires a message",line:G});continue}const St=su(In),Rn=In.filter(io=>!zu(io)),Cn=Rn[0]??St.message??St.msg??"",Ts=Rn[1]??St.freq??St.frequency??St.alert_freq??"",Fs=St.when??null,Es=$l(Fs??"close >= close",G),Co=Es.when??Es.whenExpr??"close >= close",li=Tr(String(St.title??"")),ro=Tr(String(Cn??"")),zo=z5(String(Ts??""));nt.push({id:li?`${li}`:`alert_${G}`,type:"alert",when:Co,whenExpr:Es.whenExpr,title:li||void 0,message:ro||void 0,frequency:zo});continue}const Kr=re.match(/^alertcondition\s*\((.*)\)\s*$/i);if(Kr){const In=Gr(Kr[1]||"");if(!In.length){e.push({message:"alertcondition() requires a condition",line:G});continue}const St=su(In),Rn=In.filter(zo=>!zu(zo)),Cn=Rn[0]!=null?String(Rn[0]):"",Ts=Cn?$l(Cn,G):{},Fs=Ts.when??Ts.whenExpr??null;if(!Fs){e.push({message:"alertcondition() missing condition",line:G});continue}const Es=Tr(String(St.title??"")),Co=Tr(String(St.message??"")),li=St.freq??St.frequency??St.alert_freq??"",ro=z5(String(li??""));nt.push({id:Es?`${Es}`:`alert_${G}`,type:"alert",when:Fs,whenExpr:Ts.whenExpr,title:Es||void 0,message:Co||void 0,frequency:ro});continue}const hr=re.match(/^hline\s*\((.*)\)\s*$/i);if(hr){const In=Gr(hr[1]||"");if(!In.length){e.push({message:"hline() requires value",line:G});continue}const St=su(In),Rn=In.filter(Es=>!zu(Es)),Cn=rh(Tr(Rn[0]??""));if(Cn==null){e.push({message:"hline() value must be a number",line:G});continue}const Ts=hc(St);Ie(Ts).levels.push({name:Tr(String(St.title??St.name??String(Cn))),value:Cn,color:Ro(String(St.color??""))||void 0,style:Tr(String(St.linestyle??St.style??"dashed")),width:St.width!=null?Number(St.width):void 0});continue}const sl=re.match(/^fill\s*\((.*)\)\s*$/i);if(sl){const In=Gr(sl[1]||""),St=su(In),Rn=In.filter(Co=>!zu(Co));if(Rn.length<2){e.push({message:"fill() requires 2 plot series",line:G});continue}const Cn=hc(St),Ts=Ie(Cn),Fs=Nu(Rn[0],"fill_a"),Es=Nu(Rn[1],"fill_b");Ts.fills=Array.isArray(Ts.fills)?Ts.fills:[],Ts.fills.push({between:[Fs,Es],color:Ro(String(St.color??""))||Tr(String(St.color??""))||"rgba(34,197,94,0.10)"});continue}const fo=re.match(/^signal\s+(entry_long|exit_long|entry_short|exit_short|buy|sell|exit)\s+when\s+(.+)$/i);if(fo){const In=Wu(fo[2]||"");if(!In.when){e.push({message:"signal ... when requires a condition",line:G});continue}const St=$l(In.when,G),Rn=St.when??St.whenExpr,Cn=sf(In.scoreRaw,G,"signal_score");if(In.scoreRaw!=null&&Cn==null)continue;const Ts=ad(In.cooldownRaw,G,"signal_cooldown");if(In.cooldownRaw!=null&&Ts==null)continue;const Fs=fo[1].toLowerCase(),Es=Fs==="buy"?"entry_long":Fs==="sell"||Fs==="exit"?"exit_long":Fs;nt.push({type:Es,when:Rn,whenExpr:St.whenExpr,score:Cn??null,cooldownBars:Ts});continue}const wu=re.match(/^strategy\.entry\s*\((.*)\)\s*$/i);if(wu){const In=Gr(wu[1]||""),St=su(In),Cn=In.filter(io=>!zu(io))[0]||"",Ts=In.find(io=>/strategy\.(long|short)/i.test(io))||"",Fs=/short/i.test(Ts)?"short":"long",Es=St.when?$l(St.when,G):{},Co=Es.when??Es.whenExpr??null;if(!Co){e.push({message:"strategy.entry(...) requires when=...",line:G});continue}const li=jd(St),ro=sf(St.score??St.signal_score,G,"entry_score");if((St.score??St.signal_score)!=null&&ro==null)continue;const zo=yd(St,G,"entry_cooldown");if(zo.hadRaw&&zo.value==null)continue;nt.push({id:Cn?Tr(String(Cn)):void 0,type:Fs==="long"?"entry_long":"entry_short",when:Co,whenExpr:Es.whenExpr,order:li||void 0,score:ro??null,cooldownBars:zo.value});continue}const _l=re.match(/^strategy\.order\s*\((.*)\)\s*$/i);if(_l){const In=Gr(_l[1]||""),St=su(In),Rn=In.filter(Ji=>!zu(Ji)),Cn=Rn[0]||"",Ts=Cn?Tr(String(Cn)):"";if(!Ts){e.push({message:"strategy.order(...) requires id",line:G});continue}const Fs=In.find(Ji=>/strategy\.(long|short)/i.test(Ji))||Rn[1]||"",Es=/short/i.test(Fs)?"short":/long/i.test(Fs)?"long":"";if(!Es){e.push({message:"strategy.order(...) requires strategy.long/strategy.short",line:G});continue}St.qty==null&&Rn[2]!=null&&(St.qty=String(Rn[2]));const Co=St.when?$l(St.when,G):{},li=Co.when??Co.whenExpr??null;if(!li){e.push({message:"strategy.order(...) requires when=...",line:G});continue}const ro=jd(St),zo=sf(St.score??St.signal_score,G,"order_score");if((St.score??St.signal_score)!=null&&zo==null)continue;const io=yd(St,G,"order_cooldown");if(io.hadRaw&&io.value==null)continue;nt.push({id:Ts,orderId:Ts,type:Es==="long"?"entry_long":"entry_short",when:li,whenExpr:Co.whenExpr,order:ro||void 0,score:zo??null,cooldownBars:io.value});continue}const Xl=re.match(/^strategy\.(close|exit)\s*\((.*)\)\s*$/i);if(Xl){const In=Gr(Xl[2]||""),St=su(In),Cn=In.filter(fa=>!zu(fa))[0]||"",Ts=St.when?$l(St.when,G):{},Fs=Ts.when??Ts.whenExpr??null,Es=St.side&&/short/i.test(String(St.side))?"short":"long",Co=jd(St),li=sf(St.score??St.signal_score,G,"exit_score");if((St.score??St.signal_score)!=null&&li==null)continue;const ro=yd(St,G,"exit_cooldown");if(ro.hadRaw&&ro.value==null)continue;const zo=St.stop??St.stopPrice,io=St.limit??St.limitPrice,Ji=St.qty_percent??St.qtyPct??St.qtyPctVal??St.qtyPercent,Hl=Ji!=null?Number(Ji):void 0,Vc=zo!=null?Nu(String(zo),"exit_stop"):null,ol=io!=null?Nu(String(io),"exit_limit"):null,Ac=Cn?`${Tr(String(Cn))}__bracket`:`exit__bracket_${G}`;let br=!1;if(zo!=null&&(nt.push({id:`${Cn?Tr(String(Cn)):G}_STOP`,type:Es==="long"?"exit_long":"exit_short",when:`between(${Vc||"close"}, low, high)`,order:{kind:"stop",price:(Vc||"close").replace(/\s+/g,"_").toLowerCase(),qtyPct:typeof Hl=="number"&&Number.isFinite(Hl)?Hl:void 0,oco:Ac},score:li??null,cooldownBars:ro.value}),br=!0),io!=null&&(nt.push({id:`${Cn?Tr(String(Cn)):G}_LIMIT`,type:Es==="long"?"exit_long":"exit_short",when:`between(${ol||"close"}, low, high)`,order:{kind:"limit",price:(ol||"close").replace(/\s+/g,"_").toLowerCase(),qtyPct:typeof Hl=="number"&&Number.isFinite(Hl)?Hl:void 0,oco:Ac},score:li??null,cooldownBars:ro.value}),br=!0),Fs&&(nt.push({id:Cn?Tr(String(Cn)):void 0,type:Es==="long"?"exit_long":"exit_short",when:Fs,whenExpr:Ts.whenExpr,order:zo!=null||io!=null?typeof Hl=="number"&&Number.isFinite(Hl)?{kind:"market",qtyPct:Hl}:void 0:Co||(typeof Hl=="number"&&Number.isFinite(Hl)?{kind:"market",qtyPct:Hl}:void 0),score:li??null,cooldownBars:ro.value}),br=!0),!br){e.push({message:"strategy.exit/close(...) needs when=... or stop=/limit=...",line:G});continue}continue}const rc=re.match(/^strategy\.cancel\s*\((.*)\)\s*$/i);if(rc){const In=Gr(rc[1]||""),St=su(In),Cn=In.filter(Co=>!zu(Co))[0]||"",Ts=Cn?Tr(String(Cn)):"";if(!Ts){e.push({message:"strategy.cancel(...) requires id",line:G});continue}const Fs=$l(St.when??"close >= close",G),Es=Fs.when??Fs.whenExpr??"close >= close";nt.push({id:`cancel_${Ts}_${G}`,type:"cancel",when:Es,whenExpr:Fs.whenExpr,orderId:Ts});continue}const Qc=re.match(/^strategy\.cancel_all\s*\((.*)\)\s*$/i);if(Qc){const In=Gr(Qc[1]||""),St=su(In),Rn=$l(St.when??"close >= close",G),Cn=Rn.when??Rn.whenExpr??"close >= close";nt.push({id:`cancel_all_${G}`,type:"cancel_all",when:Cn,whenExpr:Rn.whenExpr});continue}const na=re.match(/^strategy\.close_all\s*\((.*)\)\s*$/i);if(na){const In=Gr(na[1]||""),St=su(In),Rn=St.when?$l(St.when,G):{},Cn=Rn.when??Rn.whenExpr??null;if(!Cn){e.push({message:"strategy.close_all(...) requires when=...",line:G});continue}const Ts=sf(St.score??St.signal_score,G,"close_all_score");if((St.score??St.signal_score)!=null&&Ts==null)continue;const Fs=yd(St,G,"close_all_cooldown");if(Fs.hadRaw&&Fs.value==null)continue;nt.push({type:"exit_long",when:Cn,whenExpr:Rn.whenExpr,id:`close_all_long_${G}`,order:{kind:"market",qtyPct:100},score:Ts??null,cooldownBars:Fs.value}),nt.push({type:"exit_short",when:Cn,whenExpr:Rn.whenExpr,id:`close_all_short_${G}`,order:{kind:"market",qtyPct:100},score:Ts??null,cooldownBars:Fs.value});continue}const Nc=re.match(/^draw\.clear\s*\((.*)\)\s*$/i);if(Nc){const In=Gr(Nc[1]||""),St=su(In),Rn=hc(St),Cn=String(St.kind??St.type??"").toLowerCase(),Ts=["line","label","box","linefill","table","polyline","polygon","path"].includes(Cn)?Cn:void 0,Fs=Yl(St.group??St.group_id??St.groupId),Es=Yl(St.tag??St.tags);to(Rn,{kind:"draw_clear",when:ya(St),filterKind:Ts,groupId:Fs,tag:Es});continue}const Ea=re.match(/^draw\.for_each\s*\((.*)\)\s*$/i);if(Ea){const In=Gr(Ea[1]||""),St=su(In),Rn=hc(St),Cn=String(St.kind??St.type??"").toLowerCase(),Ts=["line","label","box","linefill","table","polyline","polygon","path"].includes(Cn)?Cn:void 0,Fs=Yl(St.group??St.group_id??St.groupId),Es=Yl(St.tag??St.tags),Co=zr(St.width,"draw.for_each_width"),li=kl(St.text_size??St.textSize,"draw.for_each_text_size"),ro=St.text!=null?Ll(String(St.text),"draw.for_each_text"):{text:void 0,textExpr:void 0},zo={color:Ro(St.color),fillColor:Ro(St.fill_color??St.fillcolor??St.bgcolor??St.bgColor),width:Co.value,widthExpr:Co.expr,style:u0(String(St.style??""))||void 0,extend:Rx(String(St.extend??""))||void 0,xloc:d0(String(St.xloc??""))||void 0,bgColor:Ro(St.bgcolor??St.bgColor),bgOpacity:St.bg_opacity!=null?Number(St.bg_opacity):St.bgOpacity!=null?Number(St.bgOpacity):void 0,borderColor:Ro(St.border_color??St.borderColor),borderWidth:St.border_width!=null?Number(St.border_width):St.borderWidth!=null?Number(St.borderWidth):void 0,textColor:Ro(St.text_color??St.textColor),text:ro.text,textExpr:ro.textExpr,textSize:li.value,textSizeExpr:li.expr,opacity:St.opacity!=null?Number(St.opacity):void 0,wrap:St.wrap!=null?String(St.wrap).toLowerCase()==="true"||Number(St.wrap)===1:void 0,maxWidth:St.maxwidth!=null?Number(St.maxwidth):St.maxWidth!=null?Number(St.maxWidth):void 0,padding:St.padding,radius:St.radius!=null?Number(St.radius):void 0,align:d_(String(St.align??St.textalign??St.textAlign??""))||void 0,valign:["top","middle","bottom"].includes(String(St.valign??"").toLowerCase())?String(St.valign).toLowerCase():void 0,lineHeight:St.line_height!=null?Number(St.line_height):St.lineHeight!=null?Number(St.lineHeight):void 0,fontFamily:St.font_family??St.fontFamily,fontSize:St.font_size!=null?Number(St.font_size):St.fontSize!=null?Number(St.fontSize):void 0,fontWeight:St.font_weight??St.fontWeight,monospace:St.monospace!=null?String(St.monospace).toLowerCase()==="true"||Number(St.monospace)===1:void 0};to(Rn,{kind:"draw_for_each",when:ya(St),filterKind:Ts,groupId:Fs,tag:Es,updates:zo});continue}const Nd=re.match(/^draw\.fib\.auto\s*\((.*)\)\s*$/i);if(Nd){const In=Gr(Nd[1]||""),St=su(In),Rn=Tr(String(St.name??"fibo"));qe.push({name:Rn,type:"auto_fib",method:Tr(String(St.method??"pivots")),pivotLeft:Number(St.left??St.pivotLeft??3),pivotRight:Number(St.right??St.pivotRight??3),lookback:Number(St.lookback??400),direction:Tr(String(St.direction??"up")),draw:!0});continue}re.startsWith("//@")||t.push({message:`Ignored Pine statement: ${re}`,line:G})}if(!Pe.some(se=>Array.isArray(se.plots)&&se.plots.length||Array.isArray(se.labels)&&se.labels.length||Array.isArray(se.levels)&&se.levels.length||Array.isArray(se.lines)&&se.lines.length||Array.isArray(se.runtimeDrawOps)&&se.runtimeDrawOps.length||Array.isArray(se.runtimeLabels)&&se.runtimeLabels.length||Array.isArray(se.runtimeLines)&&se.runtimeLines.length||Array.isArray(se.runtimeBoxes)&&se.runtimeBoxes.length||Array.isArray(se.runtimeTables)&&se.runtimeTables.length)){const se=$e.length?$e[$e.length-1].name:ze.length?ze[ze.length-1].name:null,be=se||"close";Ie(oe).plots.push({name:se?Tr(String(se)):"Close",source:be.replace(/\s+/g,"_").toLowerCase(),type:"line",color:"#60a5fa",width:2}),t.push({message:se?`No plot() found; auto-plotted "${se}". Add plot(...) to control output.`:'No plot() found; auto-plotted "close". Add plot(...) to control output.',line:1})}for(const se of Pe)if((Array.isArray(se.runtimeDrawOps)&&se.runtimeDrawOps.length||Array.isArray(se.runtimeLabels)&&se.runtimeLabels.length||Array.isArray(se.runtimeLines)&&se.runtimeLines.length||Array.isArray(se.runtimeBoxes)&&se.runtimeBoxes.length||Array.isArray(se.runtimeTables)&&se.runtimeTables.length||Array.isArray(se.runtimePolylines)&&se.runtimePolylines.length||Array.isArray(se.runtimePolygons)&&se.runtimePolygons.length?!0:Array.isArray(se.runtimePaths)&&se.runtimePaths.length)&&(!Array.isArray(se.plots)||se.plots.length===0)){const G=$e.length?$e[$e.length-1].name:"close";Array.isArray(se.plots)||(se.plots=[]),se.plots.push({name:"__runtime_stub__",source:String(G||"close").replace(/\s+/g,"_").toLowerCase(),type:"line",color:"rgba(0,0,0,0)",width:0})}if(!(!!Et||nt.length>0)){const be=Pe.findIndex(G=>G.pane==="main");if(be>=0){const G=Pe[be];Array.isArray(G.plots)&&G.plots.length||Array.isArray(G.labels)&&G.labels.length||Array.isArray(G.levels)&&G.levels.length||Array.isArray(G.lines)&&G.lines.length||Pe.some((J,Fe)=>Fe===be?!1:Array.isArray(J.plots)&&J.plots.length||Array.isArray(J.labels)&&J.labels.length||Array.isArray(J.levels)&&J.levels.length||Array.isArray(J.lines)&&J.lines.length)&&Pe.splice(be,1)}}if(e.length)return{ok:!1,errors:e,warnings:t.length?t:void 0};try{const se=Pe.find(be=>be.pane==="sub");if(se&&typeof se.min!="number"&&typeof se.max!="number"){const G=(Array.isArray(se.levels)?se.levels:[]).map(re=>Number(re==null?void 0:re.value)).filter(re=>Number.isFinite(re));if(G.length){const re=Math.min(...G),we=Math.max(...G),J=G.some(yt=>yt<=30),Fe=G.some(yt=>yt>=70);G.length>=2&&re>=0&&we<=100&&J&&Fe&&(se.min=0,se.max=100)}}}catch{}const Mc=Object.values(Mt).map(se=>{const be=hn(se);return{name:be.name,args:be.args,lineNo:be.lineNo,body:be.body}});return{ok:!0,spec:{panes:Pe,calc:qe,series:$e,stateSeries:ze,signals:nt,strategy:Et,params:ft,loopPlans:Hd,userFunctions:Mc.length?Mc:void 0},inputDefs:ut,warnings:t.length?t:void 0}}function aQ(n){return new Worker(""+new URL("../workers/editor.worker-oRlJJsnX.js",import.meta.url).href,{name:n==null?void 0:n.name})}function lQ(n){return new Worker(""+new URL("../workers/json.worker-CPn_BmvY.js",import.meta.url).href,{name:n==null?void 0:n.name})}function cQ(n){return new Worker(""+new URL("../workers/css.worker-DGFkc2qH.js",import.meta.url).href,{name:n==null?void 0:n.name})}function uQ(n){return new Worker(""+new URL("../workers/html.worker-CltiozTZ.js",import.meta.url).href,{name:n==null?void 0:n.name})}function dQ(n){return new Worker(""+new URL("../workers/ts.worker-CGiXAPLT.js",import.meta.url).href,{name:n==null?void 0:n.name})}const fQ=()=>{var e;if(typeof window>"u")return;const n=window;(e=n.MonacoEnvironment)!=null&&e.getWorker||(n.MonacoEnvironment={getWorker(t,s){return s==="json"?new lQ:s==="css"||s==="scss"||s==="less"?new cQ:s==="html"||s==="handlebars"||s==="razor"?new uQ:s==="typescript"||s==="javascript"?new dQ:new aQ}})};function pQ(n,e){e("reset")}function mQ(n,e){e()}function hQ(n,e,t){i(e)&&(x(e,!1),t("fullpage",{enabled:!1})),t("close")}function vQ(n,e){e("guide")}function gQ(){hy.set(!0)}async function _Q(n,e,t){x(e,!0),await t(!1)}function W5(n,e){x(e,!1)}async function yQ(n,e){await e(!0)}function H5(n,e){x(e,!1)}function bQ(n,e,t){x(e,!i(e)),t("labels",{enabled:i(e)})}function q5(n,e){x(e,!1)}function xQ(n,e,t,s,o){if(!i(e))return;const r=i(t).trim()||`Run ${i(s).length+1}`,a=`cmp_${Date.now()}_${i(s).length}`,l=i(o)&&typeof i(o)=="object"?{...i(o)}:null;x(s,V([...i(s),{id:a,label:r,summary:i(e),params:l,ts:Date.now()}])),x(t,"")}function wQ(n,e,t,s){x(e,V([])),x(t,null),x(s,V({}))}function kQ(n,e,t,s){x(e,""),x(t,""),x(s,"")}function SQ(n,e,t,s,o,r,a,l,c,f,u,d,h,m,g,w,C,P,I,A,M,F,B){var ce;if(!i(e).length)return;if(x(t,""),!i(s)){x(t,"Select Param A");return}if(i(o)&&i(o)===i(s)){x(t,"Param B must differ from Param A");return}const $=r(i(s),i(a),i(l),i(c));if(!$.length){x(t,"Invalid range for Param A");return}const L=i(o)?r(i(o),i(f),i(u),i(d)):[null],O=$.length*(L.length||1);if(O>200){x(t,`Too many combos (${O}). Reduce ranges or steps.`);return}const Y=[];for(const Q of $)for(const le of L){const ue={...i(h)};ue[i(s)]=Q,i(o)&&le!=null&&(ue[i(o)]=le),Y.push({params:ue})}x(m,V(Y)),x(g,V([])),x(w,0),x(C,!0),x(P,!1),x(I,"train"),x(A,null),x(M,V(Number(((ce=F())==null?void 0:ce._updatedAt)??0))),B(0)}function CQ(n,e,t,s,o){x(e,!1),x(t,!1),x(s,V([])),x(o,0)}function IQ(n,e,t,s,o,r,a,l,c){x(e,V([])),x(t,null),x(s,""),x(o,0),x(r,V([])),x(a,!1),x(l,!1),x(c,0)}function PQ(n,e,t){x(e,!i(e)),t("fullpage",{enabled:i(e)})}function U5(n,e,t,s,o,r,a,l,c,f){const u=[e(["side","entryIndex","entryTime","entryPrice","exitIndex","exitTime","exitPrice","qty","barsHeld","netPnl","pnlPct","fees","grossPnl","maePct","mfePct","entrySignalId","exitSignalId","exitReason","cumNetPnl"])];for(const d of i(t))u.push(e([s(d.side),d.entryIndex,d.entryTimeLabel,o(d.entryPrice),d.exitIndex,d.exitTimeLabel,o(d.exitPrice),r(d.qty),a(d.barsHeld,0),l(d.netPnl),c(d.pnlPct),l(d.fees),l(d.pnl),d.maePct==null?"-":c(d.maePct),d.mfePct==null?"-":c(d.mfePct),d.entrySignalId,d.exitSignalId,d.exitReason,l(d.cumNet)]));f("backtest_trades.csv",u.join(`
`),"text/csv;charset=utf-8")}function G5(n,e,t,s,o,r,a,l){const c=[e(["id","status","action","side","kind","createdIndex","createdTime","activeFromIndex","expiresAtIndex","qtyPct","qty","cash","tif","price","stopPrice","limitPrice","targetQty","remainingQty","trailPct","trailOffset","trailPrice","filledIndex","filledTime","fillQty","fillPrice","fees","signalId","ocoGroup","note"])];for(const f of i(t))c.push(e([f.id,f.statusLabel,f.actionLabel,f.sideLabel,f.kindLabel,f.createdIndex,f.createdTimeLabel,f.activeFromIndex,f.expiresAtIndex,`${s(f.qtyPct,2)}%`,f.qty==null?"-":o(f.qty),f.cash==null?"-":r(f.cash),f.tif||"-",f.price==null?"-":a(f.price),f.stopPrice==null?"-":a(f.stopPrice),f.limitPrice==null?"-":a(f.limitPrice),f.targetQty==null?"-":o(f.targetQty),f.remainingQty==null?"-":o(f.remainingQty),f.trailPct==null?"-":`${s(f.trailPct,2)}%`,f.trailOffset==null?"-":a(f.trailOffset),f.trailPrice==null?"-":a(f.trailPrice),f.filledIndex,f.filledTimeLabel,f.fillQty==null?"-":o(f.fillQty),f.fillPrice==null?"-":a(f.fillPrice),f.fees==null?"-":r(f.fees),f.signalId,f.ocoGroup,f.note]));l("backtest_orders.csv",c.join(`
`),"text/csv;charset=utf-8")}function MQ(n,e,t,s,o,r,a,l,c,f,u){const d=[e(["side","entryIndex","entryTime","entryPrice","exitIndex","exitTime","exitPrice","qty","barsHeld","netPnl","pnlPct","fees","grossPnl","maePct","mfePct","entrySignalId","exitSignalId","exitReason","cumNetPnl"])];for(const m of i(t))d.push(e([s(m.side),m.entryIndex,m.entryTimeLabel,o(m.entryPrice),m.exitIndex,m.exitTimeLabel,o(m.exitPrice),r(m.qty),a(m.barsHeld,0),l(m.netPnl),c(m.pnlPct),l(m.fees),l(m.pnl),m.maePct==null?"-":c(m.maePct),m.mfePct==null?"-":c(m.mfePct),m.entrySignalId,m.exitSignalId,m.exitReason,l(m.cumNet)]));const h=i(f).type==="all"?"all":`${i(f).type}_${String(i(f).key).replace(/[^a-zA-Z0-9_-]+/g,"_")}`;u(`backtest_trades_${h}.csv`,d.join(`
`),"text/csv;charset=utf-8")}function NQ(n,e,t,s){const o=[e(["index","timestamp","equity"])];for(const r of i(t))o.push(e([r.index,r.timestamp,r.equity]));s("backtest_equity.csv",o.join(`
`),"text/csv;charset=utf-8")}var AQ=n=>n.stopPropagation(),TQ=(n,e)=>{n.stopPropagation(),x(e,"editor")},FQ=(n,e)=>{n.stopPropagation(),x(e,"errors")},LQ=ke("<span> </span>"),EQ=(n,e)=>{n.stopPropagation(),x(e,"results")},$Q=n=>n.stopPropagation(),DQ=(n,e)=>e("main"),RQ=(n,e)=>e("sub"),jQ=ke('<div class="pane-toggle svelte-1ehcy4i" aria-label="Target pane"><button type="button" class="svelte-1ehcy4i">Main</button> <button type="button" class="svelte-1ehcy4i">Sub pane</button></div>'),BQ=ke('<button class="icon svelte-1ehcy4i" type="button" aria-label="Full page view" title="Full page view"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 9V4h5M20 9V4h-5M4 15v5h5M20 15v5h-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg></button>'),OQ=ke('<button class="icon svelte-1ehcy4i" type="button" aria-label="Exit full page view" title="Exit full page view (Esc)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 4H4v5M15 4h5v5M9 20H4v-5M15 20h5v-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg></button>'),zQ=ke('<div class="monaco-loading svelte-1ehcy4i">Loading editor…</div>'),VQ=ke('<div class="monaco-shell svelte-1ehcy4i"><!></div>'),WQ=ke('<div class="gutter-line svelte-1ehcy4i"></div>'),HQ=ke('<div class="editor-gutter svelte-1ehcy4i"></div> <div class="code-shell svelte-1ehcy4i"><pre class="code-overlay svelte-1ehcy4i" aria-hidden="true"><code class="svelte-1ehcy4i"><!></code><mark class="err svelte-1ehcy4i" style="display:none" aria-hidden="true"></mark><mark class="err-warning svelte-1ehcy4i" style="display:none" aria-hidden="true"></mark></pre> <textarea class="code-input svelte-1ehcy4i" spellcheck="false" placeholder="Write or paste your script here, then press Run to see it on the chart"></textarea></div>',1),qQ=ke('<div class="pine-warn-row svelte-1ehcy4i"> </div>'),UQ=ke('<div class="pine-warn svelte-1ehcy4i"></div>'),GQ=(n,e,t)=>e(i(t).name,n.currentTarget.checked),YQ=ke('<label class="toggle svelte-1ehcy4i"><input type="checkbox" class="svelte-1ehcy4i"> <span class="toggle-track svelte-1ehcy4i"></span></label>'),KQ=(n,e,t)=>e(i(t).name,n.currentTarget.value),XQ=ke('<input class="input svelte-1ehcy4i" type="text">'),ZQ=(n,e,t,s)=>{const o=n.currentTarget.value,r=e(o);r!=null&&t(i(s).name,r)},JQ=ke('<input class="input svelte-1ehcy4i" type="datetime-local">'),QQ=(n,e,t)=>e(i(t).name,n.currentTarget.value),eee=ke("<option></option>"),tee=ke('<div class="input-source svelte-1ehcy4i"><input class="input svelte-1ehcy4i"> <datalist></datalist></div>'),nee=(n,e,t)=>e(i(t).name,n.currentTarget.value),see=ke('<input class="input input-color svelte-1ehcy4i" type="color">'),oee=(n,e,t)=>{const s=n.currentTarget.value,o=Number(s);Number.isFinite(o)&&e(i(t).name,i(t).type==="int"?Math.floor(o):o)},iee=ke('<input class="input svelte-1ehcy4i" type="number">'),ree=ke('<div class="input-row svelte-1ehcy4i"><div class="input-label svelte-1ehcy4i"><div class="input-name svelte-1ehcy4i"> </div> <div class="input-key mono svelte-1ehcy4i"> </div></div> <div class="input-control svelte-1ehcy4i"><!></div></div>'),aee=ke('<div class="editor-side svelte-1ehcy4i"><div class="side-card svelte-1ehcy4i"><div class="side-title svelte-1ehcy4i">Inputs</div> <div class="side-sub svelte-1ehcy4i">Script inputs — update values, then press Run.</div> <!> <div class="inputs-list svelte-1ehcy4i"></div> <div class="side-hint svelte-1ehcy4i">Change inputs → press <b>Run</b> to re‑calculate.</div></div></div>'),lee=ke('<div class="no-errors svelte-1ehcy4i">No errors • All good</div>'),cee=ke('<span class="diag-loc svelte-1ehcy4i"> <!> —</span>'),uee=ke('<span class="diag-hint svelte-1ehcy4i"> </span>'),dee=ke('<div><span class="diag-dot svelte-1ehcy4i"></span> <span class="diag-msg svelte-1ehcy4i"><!> </span> <!></div>'),fee=ke('<div class="errors-header svelte-1ehcy4i"><div class="errors-title svelte-1ehcy4i"> </div> <div class="errors-sub svelte-1ehcy4i">Newest errors appear here as you type.</div></div> <div class="errors-list svelte-1ehcy4i" aria-live="polite"></div>',1),pee=ke('<div class="errors-area svelte-1ehcy4i"><!></div>'),mee=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},hee=(n,e)=>x(e,"trades"),vee=(n,e)=>x(e,"orders"),gee=(n,e)=>x(e,V(n.currentTarget.value)),_ee=(n,e)=>x(e,V(i(e)==="compact"?"full":"compact")),yee=(n,e)=>e({type:"all"}),bee=ke('<button class="btn btn-xs btn-outline" type="button">Clear filter</button>'),xee=(n,e)=>e("side"),wee=(n,e)=>e("entryIndex"),kee=(n,e)=>e("exitIndex"),See=(n,e)=>e("qty"),Cee=(n,e)=>e("barsHeld"),Iee=(n,e)=>e("netPnl"),Pee=(n,e)=>e("pnlPct"),Mee=(n,e)=>e("fees"),Nee=(n,e)=>e("pnl"),Aee=(n,e)=>e("maePct"),Tee=(n,e)=>e("mfePct"),Fee=(n,e)=>e("cumNet"),Lee=ke('<th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="svelte-1ehcy4i">Signals</th> <th class="svelte-1ehcy4i">Reason</th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th>',1),Eee=(n,e,t)=>e(i(t)),$ee=(n,e,t)=>{n.key==="Enter"&&e(i(t))},Dee=(n,e,t)=>{var s;try{(s=n==null?void 0:n.stopPropagation)==null||s.call(n)}catch{}e(i(t))},Ree=ke('<td class="right mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td> <td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Entry</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Exit</span><span class="mono svelte-1ehcy4i"> </span></div></div></td> <td class="mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td>',1),jee=ke('<tr tabindex="0" class="svelte-1ehcy4i"><td class="svelte-1ehcy4i"><button class="btn btn-xs btn-ghost svelte-1ehcy4i" type="button" title="Focus this trade on chart">View</button></td><td class="svelte-1ehcy4i"><span class="tt-pill tt-pill-side svelte-1ehcy4i"> </span></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><td class="right mono svelte-1ehcy4i"> </td><td class="right mono svelte-1ehcy4i"> </td><td class="right mono svelte-1ehcy4i"> </td><td class="right mono svelte-1ehcy4i"> </td><!></tr>'),Bee=ke('<div class="tt-scroll svelte-1ehcy4i"><table><thead class="svelte-1ehcy4i"><tr><th class="svelte-1ehcy4i">View</th><th class="svelte-1ehcy4i"><button class="th-btn svelte-1ehcy4i" type="button"> </button></th><th class="svelte-1ehcy4i"><button class="th-btn svelte-1ehcy4i" type="button"> </button></th><th class="svelte-1ehcy4i"><button class="th-btn svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><!></tr></thead><tbody class="svelte-1ehcy4i"></tbody></table></div>'),Oee=ke('<div class="no-errors svelte-1ehcy4i">No trades to show.</div>'),zee=ke(`<div class="tt-toolbar svelte-1ehcy4i"><div class="tt-toolbar-left svelte-1ehcy4i"><div class="tt-title svelte-1ehcy4i">Trades Table <span class="tt-sub mono svelte-1ehcy4i"> </span></div> <div class="tt-note-inline svelte-1ehcy4i">Entry/Exit show index, time, price. Bars = holding
                      duration.</div></div> <div class="tt-toolbar-right"><input class="input input-sm svelte-1ehcy4i" type="text" placeholder="Search trades..."> <button class="btn btn-xs btn-outline" type="button"> </button> <!> <button class="btn btn-xs btn-outline" type="button">Download CSV</button></div></div> <!>`,1),Vee=(n,e)=>x(e,V(i(e)==="compact"?"full":"compact")),Wee=ke('<th class="svelte-1ehcy4i">Active / Expire</th> <th class="svelte-1ehcy4i">Signal / OCO</th> <th class="svelte-1ehcy4i">Note</th>',1),Hee=(n,e,t)=>{var s;try{(s=n==null?void 0:n.stopPropagation)==null||s.call(n)}catch{}e(i(t))},qee=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Qty</span><span class="mono svelte-1ehcy4i"> </span></div>'),Uee=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Cash</span><span class="mono svelte-1ehcy4i"> </span></div>'),Gee=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div>'),Yee=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Stop</span><span class="mono svelte-1ehcy4i"> </span></div>'),Kee=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Limit</span><span class="mono svelte-1ehcy4i"> </span></div>'),Xee=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">TIF</span><span class="mono svelte-1ehcy4i"> </span></div>'),Zee=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Trail%</span><span class="mono svelte-1ehcy4i"> </span></div>'),Jee=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Trail</span><span class="mono svelte-1ehcy4i"> </span></div>'),Qee=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">TrailPx</span><span class="mono svelte-1ehcy4i"> </span></div>'),ete=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Remaining</span><span class="mono svelte-1ehcy4i"> </span></div>'),tte=ke('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Target</span><span class="mono svelte-1ehcy4i"> </span></div>'),nte=ke('<td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Active</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Expire</span><span class="mono svelte-1ehcy4i"> </span></div></div></td> <td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Signal</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">OCO</span><span class="mono svelte-1ehcy4i"> </span></div></div></td> <td class="mono svelte-1ehcy4i"> </td>',1),ste=ke('<tr class="svelte-1ehcy4i"><td class="svelte-1ehcy4i"><button class="btn btn-xs btn-ghost svelte-1ehcy4i" type="button" title="View this order on chart">View</button></td><td class="mono svelte-1ehcy4i"> </td><td class="svelte-1ehcy4i"><span> </span></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Action</span> <span class="tt-pill tt-pill-action svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Side</span> <span class="tt-pill tt-pill-side svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Kind</span> <span class="tt-pill tt-pill-kind svelte-1ehcy4i"> </span></div></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Qty%</span><span class="mono svelte-1ehcy4i"> </span></div> <!> <!> <!> <!> <!> <!> <!> <!> <!></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Qty</span><span class="mono svelte-1ehcy4i"> </span></div> <!> <!> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Fees</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><!></tr>'),ote=ke('<div class="tt-scroll svelte-1ehcy4i"><table><thead class="svelte-1ehcy4i"><tr><th class="svelte-1ehcy4i">View</th><th class="svelte-1ehcy4i">ID</th><th class="svelte-1ehcy4i">Status</th><th class="svelte-1ehcy4i">Type</th><th class="svelte-1ehcy4i">Created</th><th class="svelte-1ehcy4i">Request</th><th class="svelte-1ehcy4i">Fill</th><!></tr></thead><tbody class="svelte-1ehcy4i"></tbody></table></div>'),ite=ke('<div class="no-errors svelte-1ehcy4i">No orders to show.</div>'),rte=ke(`<div class="tt-title-row svelte-1ehcy4i"><div class="tt-title-group svelte-1ehcy4i"><div class="tt-title svelte-1ehcy4i">Orders</div> <div class="tt-sub mono svelte-1ehcy4i"> <!></div> <div class="tt-note-inline svelte-1ehcy4i">Request shows desired qty/price; Fill shows executed
                      values.</div></div> <div class="tt-title-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button"> </button> <button class="btn btn-xs btn-outline" type="button">Download CSV</button></div></div> <!>`,1),ate=ke('<div class="tables-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="tables-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="Trades and Orders"><div class="tables-modal-head svelte-1ehcy4i"><div class="tables-modal-title svelte-1ehcy4i">Trades & Orders</div> <div class="tables-modal-actions svelte-1ehcy4i"><div class="tables-modal-tabs svelte-1ehcy4i" role="tablist" aria-label="Tables"><button type="button" role="tab" class="svelte-1ehcy4i">Trades</button> <button type="button" role="tab" class="svelte-1ehcy4i">Orders</button></div> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="tables-modal-body svelte-1ehcy4i"><!></div></div></div>'),lte=ke("Backtest requires <code>strategy(...)</code> — add it, then press <b>Run</b>.",1),cte=ke('Backtest requires <code>"strategy"</code> — add it, then press <b>Run</b>.',1),ute=ke('<div class="no-errors svelte-1ehcy4i"><!></div>'),dte=ke("No backtest results yet — add <code>strategy.entry/strategy.exit</code>, then press <b>Run</b>.",1),fte=ke('No backtest results yet — add <code>"signals"</code>, then press <b>Run</b>.',1),pte=ke('<div class="no-errors svelte-1ehcy4i"><!></div>'),mte=ke("Ready — press <b>Run</b> to calculate results.",1),hte=ke('<div class="mono svelte-1ehcy4i" style="margin-top:6px; opacity:0.8"> </div>'),vte=ke('<div class="no-errors svelte-1ehcy4i"><!> <!></div>'),gte=ke('<div class="meta-chip svelte-1ehcy4i">Last signal <span class="mono svelte-1ehcy4i"> </span></div>'),_te=ke('<div class="meta-chip svelte-1ehcy4i">Filter <span class="mono svelte-1ehcy4i"> </span></div>'),yte=(n,e)=>e("setup"),bte=(n,e)=>x(e,V(n.currentTarget.value)),xte=(n,e)=>x(e,V(n.currentTarget.value)),wte=(n,e)=>x(e,V(n.currentTarget.value)),kte=ke('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),Ste=ke('<div class="bt-active mono svelte-1ehcy4i"> </div>'),Cte=(n,e)=>x(e,V(n.currentTarget.value)),Ite=ke('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),Pte=(n,e,t)=>e(i(t).id),Mte=(n,e,t)=>e(i(t).id),Nte=ke('<div class="compare-metric svelte-1ehcy4i"><span class="cd-key svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div>'),Ate=ke('<div class="compare-metric svelte-1ehcy4i"><span class="cd-key svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div>'),Tte=ke('<div class="compare-params svelte-1ehcy4i"></div>'),Fte=ke('<div class="cd-empty svelte-1ehcy4i">No params</div>'),Lte=(n,e,t)=>e(i(t).id),Ete=ke('<pre class="compare-raw mono svelte-1ehcy4i"> </pre>'),$te=ke('<div class="compare-details svelte-1ehcy4i"><div class="compare-detail svelte-1ehcy4i"><div class="cd-title svelte-1ehcy4i">Summary</div> <div class="compare-metrics svelte-1ehcy4i"></div></div> <div class="compare-detail svelte-1ehcy4i"><div class="cd-title svelte-1ehcy4i">Params</div> <!></div> <div class="compare-detail svelte-1ehcy4i"><div class="cd-title svelte-1ehcy4i">Raw (optional)</div> <button class="btn btn-xs btn-outline" type="button"> </button> <!></div></div>'),Dte=ke('<div class="compare-row svelte-1ehcy4i"><div class="mono svelte-1ehcy4i"> </div> <div> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="mono svelte-1ehcy4i"> </div> <div class="compare-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button"> </button> <button class="btn btn-xs btn-outline" type="button">Remove</button></div></div> <!>',1),Rte=ke('<div class="compare-table svelte-1ehcy4i"><div class="compare-head svelte-1ehcy4i"><div>Run</div> <div class="right svelte-1ehcy4i">Net</div> <div class="right svelte-1ehcy4i">Ret%</div> <div class="right svelte-1ehcy4i">DD%</div> <div class="right svelte-1ehcy4i">Sharpe</div> <div class="right svelte-1ehcy4i">Win%</div> <div class="right svelte-1ehcy4i">Trades</div> <div>Params</div> <div>Actions</div></div> <!></div>'),jte=ke('<div class="bt-empty svelte-1ehcy4i">Pin runs to compare net PnL, drawdown, Sharpe, and params.</div>'),Bte=(n,e)=>e("performance"),Ote=ke(`No signals matched. Check <code>when</code> conditions and series
                    names; try a simpler condition first.`,1),zte=ke(`Signals matched but no orders filled. Common causes:
                    limit/stop price never touches • stop‑limit expires • try <code>"order": &#123; "kind": "market" &#125;</code> first, then add limit/stop.`,1),Vte=ke('<div class="bt-hint svelte-1ehcy4i"><div class="bt-hint-title svelte-1ehcy4i">No trades yet</div> <div class="bt-hint-body svelte-1ehcy4i"><!></div></div>'),Wte=(n,e)=>e("behavior"),Hte=ke('<div class="sig-row svelte-1ehcy4i"><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),qte=ke('<div class="signal-table svelte-1ehcy4i"><div class="sig-head svelte-1ehcy4i"><div>Signal</div> <div class="right svelte-1ehcy4i">Trades</div> <div class="right svelte-1ehcy4i">Win%</div> <div class="right svelte-1ehcy4i">Net</div> <div class="right svelte-1ehcy4i">PF</div></div> <!></div>'),Ute=ke('<div class="no-errors svelte-1ehcy4i">No signal stats yet.</div>'),Gte=(n,e)=>e("optimization"),Yte=(n,e)=>e(n.currentTarget.value),Kte=ke("<option> </option>"),Xte=(n,e)=>x(e,V(Number(n.currentTarget.value))),Zte=(n,e)=>x(e,V(Number(n.currentTarget.value))),Jte=(n,e)=>x(e,V(Number(n.currentTarget.value))),Qte=(n,e)=>e(n.currentTarget.value),ene=ke("<option> </option>"),tne=(n,e)=>x(e,V(Number(n.currentTarget.value))),nne=(n,e)=>x(e,V(Number(n.currentTarget.value))),sne=(n,e)=>x(e,V(Number(n.currentTarget.value))),one=ke('<div class="opt-range-grid svelte-1ehcy4i"><label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">From</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">To</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">Step</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label></div>'),ine=(n,e)=>x(e,V(n.currentTarget.value)),rne=(n,e)=>x(e,V(n.currentTarget.checked)),ane=(n,e)=>x(e,V(Math.max(10,Math.min(90,Number(n.currentTarget.value)||70)))),lne=ke('<div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Train %</div> <div class="opt-control svelte-1ehcy4i"><input class="input input-sm svelte-1ehcy4i" type="number" min="10" max="90"></div></div>'),cne=ke('<button class="btn btn-xs btn-outline" type="button">Stop</button>'),une=ke('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),dne=ke('<div class="opt-warning svelte-1ehcy4i"> </div>'),fne=ke('<div class="opt-progress svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div>'),pne=ke('<div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Param A</div> <div class="opt-control svelte-1ehcy4i"><select class="input input-sm svelte-1ehcy4i"></select></div></div> <div class="opt-range-grid svelte-1ehcy4i"><label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">From</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">To</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">Step</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label></div> <div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Param B</div> <div class="opt-control svelte-1ehcy4i"><select class="input input-sm svelte-1ehcy4i"><option>None</option><!></select></div></div> <!> <div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Metric</div> <div class="opt-control svelte-1ehcy4i"><select class="input input-sm svelte-1ehcy4i"><option>Net PnL</option><option>Profit Factor</option><option>Sharpe</option><option>Win Rate</option><option>Max Drawdown (lower better)</option></select></div></div> <div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Walk-forward</div> <div class="opt-control opt-toggle svelte-1ehcy4i"><label class="toggle svelte-1ehcy4i"><input type="checkbox" class="svelte-1ehcy4i"> <span class="toggle-track svelte-1ehcy4i"></span></label></div></div> <!> <div class="opt-actions svelte-1ehcy4i"><button class="btn btn-xs btn-primary" type="button">Run grid</button> <!> <span class="opt-note svelte-1ehcy4i">Up to 200 combos per run.</span></div> <!> <!>',1),mne=ke('<div class="bt-empty svelte-1ehcy4i">No numeric inputs found. Add <code>input.int</code> or <code>input.float</code> to optimize.</div>'),hne=ke('<div><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),vne=ke('<div class="opt-test svelte-1ehcy4i"> </div>'),gne=ke('<div class="opt-results-meta svelte-1ehcy4i"> </div> <div class="opt-results svelte-1ehcy4i"><div class="opt-results-head svelte-1ehcy4i"><div>Params</div> <div class="right svelte-1ehcy4i">Metric</div> <div class="right svelte-1ehcy4i">Net</div> <div class="right svelte-1ehcy4i">Ret%</div> <div class="right svelte-1ehcy4i">DD%</div> <div class="right svelte-1ehcy4i">Win%</div> <div class="right svelte-1ehcy4i">Trades</div></div> <!></div> <!>',1),_ne=ke('<div class="bt-empty svelte-1ehcy4i">Run a grid search to see ranked results.</div>'),yne=(n,e)=>e("charts"),bne=(n,e)=>{x(e,"1w")},xne=(n,e)=>{x(e,"1m")},wne=(n,e)=>{x(e,"3m")},kne=(n,e)=>{x(e,"6m")},Sne=(n,e)=>{x(e,"1y")},Cne=(n,e)=>{x(e,"5y")},Ine=(n,e)=>{x(e,"all")},Pne=ke('<div class="report-metrics svelte-1ehcy4i"><div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Start</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">End</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Net</span> <span> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Return</span> <span> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Range</span> <span class="mono svelte-1ehcy4i"> </span></div></div>'),Mne=ta('<path fill="none" stroke="var(--report-benchmark-stroke)" stroke-width="1.25" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path>'),Nne=ta('<circle class="report-dot equity svelte-1ehcy4i" r="1.8"></circle>'),Ane=ke('<svg class="report-svg svelte-1ehcy4i" viewBox="0 0 100 100" preserveAspectRatio="none" aria-label="Equity curve"><path fill="var(--report-equity-fill)"></path><path fill="none" stroke="var(--report-equity-stroke)" stroke-width="1.5" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path><!><line x1="0" y1="25" x2="100" y2="25" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="50" x2="100" y2="50" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="75" x2="100" y2="75" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><!></svg> <div class="chart-axis top mono svelte-1ehcy4i"> </div> <div class="chart-axis bottom mono svelte-1ehcy4i"> </div>',1),Tne=ke('<div class="report-empty svelte-1ehcy4i">No data</div>'),Fne=ke('<div class="crosshair v svelte-1ehcy4i"></div> <div class="crosshair h svelte-1ehcy4i"></div> <div class="chart-tooltip svelte-1ehcy4i"><div class="tt-title mono svelte-1ehcy4i"> </div> <div class="tt-val svelte-1ehcy4i">Equity: <span class="mono svelte-1ehcy4i"> </span></div> <div class="tt-sub svelte-1ehcy4i">Net: <span class="mono svelte-1ehcy4i"> </span></div> <div class="tt-sub svelte-1ehcy4i">Return: <span class="mono svelte-1ehcy4i"> </span></div></div>',1),Lne=ke('<div class="report-legend svelte-1ehcy4i"><div class="legend-item svelte-1ehcy4i"><span class="legend-dot equity svelte-1ehcy4i"></span>Equity</div> <div class="legend-item svelte-1ehcy4i"><span class="legend-dot bench svelte-1ehcy4i"></span>Buy &amp; Hold</div></div>'),Ene=ke('<div class="report-metrics svelte-1ehcy4i"><div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Worst DD</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Avg DD</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Last DD</span> <span class="mono svelte-1ehcy4i"> </span></div></div>'),$ne=ta('<circle class="report-dot dd svelte-1ehcy4i" r="1.8"></circle>'),Dne=ke('<svg class="report-svg svelte-1ehcy4i" viewBox="0 0 100 100" preserveAspectRatio="none" aria-label="Drawdown"><path fill="var(--report-dd-fill)"></path><path fill="none" stroke="var(--report-dd-stroke)" stroke-width="1.5" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path><line x1="0" y1="25" x2="100" y2="25" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="50" x2="100" y2="50" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="75" x2="100" y2="75" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><!></svg> <div class="chart-axis top mono svelte-1ehcy4i"> </div> <div class="chart-axis bottom mono svelte-1ehcy4i"> </div>',1),Rne=ke('<div class="report-empty svelte-1ehcy4i">No data</div>'),jne=ke('<div class="tt-sub svelte-1ehcy4i">Equity: <span class="mono svelte-1ehcy4i"> </span></div>'),Bne=ke('<div class="crosshair v svelte-1ehcy4i"></div> <div class="crosshair h svelte-1ehcy4i"></div> <div class="chart-tooltip svelte-1ehcy4i"><div class="tt-title mono svelte-1ehcy4i"> </div> <div class="tt-val svelte-1ehcy4i">DD: <span class="mono svelte-1ehcy4i"> </span></div> <!></div>',1),One=(n,e)=>e("returns"),zne=(n,e,t,s,o)=>{e({type:"month",key:i(t).key}),s("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades")},Vne=(n,e,t,s,o)=>{n.key==="Enter"&&(e({type:"month",key:i(t).key}),s("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades"))},Wne=ke('<div role="button" tabindex="0"><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),Hne=ke('<div class="returns-table svelte-1ehcy4i"><div class="rt-head svelte-1ehcy4i"><div>Month</div> <div class="right svelte-1ehcy4i">Return</div></div> <!></div>'),qne=ke('<div class="no-errors svelte-1ehcy4i">No monthly returns yet.</div>'),Une=(n,e,t,s,o)=>{e({type:"week",key:i(t).key}),s("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades")},Gne=(n,e,t,s,o)=>{n.key==="Enter"&&(e({type:"week",key:i(t).key}),s("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades"))},Yne=ke('<div role="button" tabindex="0"><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),Kne=ke('<div class="returns-table svelte-1ehcy4i"><div class="rt-head svelte-1ehcy4i"><div>Week</div> <div class="right svelte-1ehcy4i">Return</div></div> <!></div>'),Xne=ke('<div class="no-errors svelte-1ehcy4i">No weekly returns yet.</div>'),Zne=(n,e)=>e("distributions"),Jne=ke('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),Qne=ke('<div class="hist svelte-1ehcy4i"></div>'),ese=ke('<div class="no-errors svelte-1ehcy4i">No trades yet.</div>'),tse=ke('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),nse=ke('<div class="hist svelte-1ehcy4i"></div>'),sse=ke('<div class="no-errors svelte-1ehcy4i">No MAE data.</div>'),ose=ke('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),ise=ke('<div class="hist svelte-1ehcy4i"></div>'),rse=ke('<div class="no-errors svelte-1ehcy4i">No MFE data.</div>'),ase=ke('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),lse=ke('<div class="hist svelte-1ehcy4i"></div>'),cse=ke('<div class="no-errors svelte-1ehcy4i">No duration data.</div>'),use=(n,e)=>e("exports"),dse=(n,e)=>e("trades"),fse=(n,e)=>e("orders"),pse=ke('<button class="btn btn-sm btn-outline" type="button">Download Filtered Trades CSV</button>'),mse=ke('<div class="results-shell svelte-1ehcy4i"><div class="results-hero svelte-1ehcy4i"><div class="results-title-group svelte-1ehcy4i"><div class="results-title svelte-1ehcy4i">Strategy Results</div> <div class="results-sub svelte-1ehcy4i">Latest run summary. Update inputs or filters, then press Run.</div></div> <div class="results-kpis svelte-1ehcy4i"><div class="kpi svelte-1ehcy4i"><div class="kpi-label svelte-1ehcy4i">Final equity</div> <div class="kpi-value mono svelte-1ehcy4i"> </div></div> <div class="kpi svelte-1ehcy4i"><div class="kpi-label svelte-1ehcy4i">Net PnL</div> <div> </div></div> <div class="kpi svelte-1ehcy4i"><div class="kpi-label svelte-1ehcy4i">Max drawdown</div> <div class="kpi-value mono svelte-1ehcy4i"> </div></div></div></div> <div class="results-meta svelte-1ehcy4i"><div class="meta-chip svelte-1ehcy4i">Signals <span class="mono svelte-1ehcy4i"> </span> <span class="meta-sub mono svelte-1ehcy4i"> </span></div> <!> <!></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Setup</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Setup info">i</button></div> <div class="section-sub svelte-1ehcy4i">Limit the backtest window or pin runs for comparison.</div></div></div> <div class="bt-tools svelte-1ehcy4i"><div class="bt-tool-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Backtest Filters</div> <div class="bt-field-grid svelte-1ehcy4i"><label class="bt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">From</span> <input class="input input-sm svelte-1ehcy4i" type="date"></label> <label class="bt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">To</span> <input class="input input-sm svelte-1ehcy4i" type="date"></label> <label class="bt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">Session</span> <input class="input input-sm svelte-1ehcy4i" type="text" placeholder="0930-1600"></label></div> <div class="bt-actions svelte-1ehcy4i"><button class="btn btn-xs btn-primary" type="button">Re-run</button> <!> <!> <div class="bt-note svelte-1ehcy4i">Dates use UTC • Session HHMM‑HHMM</div></div></div> <div class="bt-tool-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Compare Runs</div> <div class="bt-compare-toolbar svelte-1ehcy4i"><input class="input input-sm svelte-1ehcy4i" type="text" placeholder="Label (optional)"> <button class="btn btn-xs btn-primary" type="button">Pin current</button> <!></div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Performance Snapshot</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Performance snapshot info">i</button></div> <div class="section-sub svelte-1ehcy4i">Core stats for this run at a glance.</div></div></div> <div class="results-grid svelte-1ehcy4i"><div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Trades</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> <!></div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Win rate</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Net PnL</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Expectancy</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Risk</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Exposure</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div></div> <!></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Trade Behavior</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Trade behavior info">i</button></div> <div class="section-sub svelte-1ehcy4i">Breakdowns by side and signal.</div></div></div> <div class="breakdown-grid svelte-1ehcy4i"><div class="breakdown-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Long vs Short</div> <div class="breakdown-row svelte-1ehcy4i"><span class="mono svelte-1ehcy4i">Long</span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="breakdown-row svelte-1ehcy4i"><span class="mono svelte-1ehcy4i">Short</span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div></div> <div class="breakdown-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Per‑Signal Stats</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Optimization</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Optimization info">i</button></div> <div class="section-sub svelte-1ehcy4i">Search numeric inputs and rank by the chosen metric.</div></div> <div class="section-meta mono svelte-1ehcy4i"> <!></div></div> <div class="opt-grid svelte-1ehcy4i"><div class="opt-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Params</div> <!></div> <div class="opt-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Results</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Charts</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Charts info">i</button></div> <div class="section-sub svelte-1ehcy4i">Equity and drawdown for the selected range.</div></div> <div class="section-meta svelte-1ehcy4i"><div class="range-toggle svelte-1ehcy4i" role="group" aria-label="Report range"><button type="button" class="svelte-1ehcy4i">1W</button> <button type="button" class="svelte-1ehcy4i">1M</button> <button type="button" class="svelte-1ehcy4i">3M</button> <button type="button" class="svelte-1ehcy4i">6M</button> <button type="button" class="svelte-1ehcy4i">1Y</button> <button type="button" class="svelte-1ehcy4i">5Y</button> <button type="button" class="svelte-1ehcy4i">All</button></div></div></div> <div class="reports-grid svelte-1ehcy4i"><div class="report-card svelte-1ehcy4i"><div class="report-head svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Equity Curve</div> <div class="report-sub mono svelte-1ehcy4i"><!></div></div> <!> <div class="report-canvas svelte-1ehcy4i"><!> <!></div> <!></div> <div class="report-card svelte-1ehcy4i"><div class="report-head svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Drawdown (%)</div> <div class="report-sub mono svelte-1ehcy4i"> </div></div> <!> <div class="report-canvas svelte-1ehcy4i"><!> <!></div></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Returns</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Returns info">i</button></div> <div class="section-sub svelte-1ehcy4i">Monthly and weekly performance snapshots.</div></div></div> <div class="returns-grid svelte-1ehcy4i"><div class="return-card svelte-1ehcy4i"><div class="rc-title-row svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Monthly Returns</div></div> <div class="rc-subhint svelte-1ehcy4i">Click a row to filter trades by that period.</div> <!></div> <div class="return-card svelte-1ehcy4i"><div class="rc-title-row svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Weekly Returns</div></div> <div class="rc-subhint svelte-1ehcy4i">Click a row to filter trades by that period.</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Distributions</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Distributions info">i</button></div> <div class="section-sub svelte-1ehcy4i">See how trades are distributed across outcomes.</div></div></div> <div class="dist-grid svelte-1ehcy4i"><div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">PnL% Distribution</div> <!></div> <div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">MAE% Distribution</div> <!></div> <div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">MFE% Distribution</div> <!></div> <div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Trade Duration (bars)</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Exports & Totals</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Exports info">i</button></div> <div class="section-sub svelte-1ehcy4i">Download data or review totals for this run.</div></div></div> <div class="export-row svelte-1ehcy4i"><button class="btn btn-sm btn-primary" type="button">Open Trades Table</button> <button class="btn btn-sm btn-primary" type="button">Open Orders Table</button> <button class="btn btn-sm btn-outline" type="button">Download Trades CSV</button> <!> <button class="btn btn-sm btn-outline" type="button">Download Orders CSV</button> <button class="btn btn-sm btn-outline" type="button">Download Equity CSV</button></div> <div class="pnl-strip svelte-1ehcy4i"><div class="pnl-item pos svelte-1ehcy4i"> </div> <div class="pnl-item neg svelte-1ehcy4i"> </div> <div> </div></div> <div class="pnl-strip pnl-strip-2 svelte-1ehcy4i"><div class="pnl-item svelte-1ehcy4i"> </div> <div class="pnl-item svelte-1ehcy4i"> </div> <div class="pnl-item svelte-1ehcy4i"> </div></div></div></div>'),hse=ke('<div class="errors-area svelte-1ehcy4i"><!> <!></div>'),vse=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},gse=(n,e)=>x(e,"en"),_se=(n,e)=>x(e,"bn"),yse=ke("<li> </li>"),bse=ke("<li> </li>"),xse=ke('<ul class="info-list svelte-1ehcy4i"></ul> <div class="info-example svelte-1ehcy4i"><div class="info-example-title svelte-1ehcy4i">Example</div> <ul class="svelte-1ehcy4i"></ul></div>',1),wse=ke('<div class="info-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="info-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="Section info"><div class="info-modal-head svelte-1ehcy4i"><div class="info-modal-title svelte-1ehcy4i"> </div> <div class="info-modal-actions svelte-1ehcy4i"><div class="info-lang-toggle svelte-1ehcy4i" role="group" aria-label="Info language"><button type="button" class="svelte-1ehcy4i">EN</button> <button type="button" class="svelte-1ehcy4i">BN</button></div> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="info-modal-body svelte-1ehcy4i"><!></div></div></div>'),kse=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},Sse=(n,e)=>{n.key==="Enter"&&e()},Cse=ke('<div class="library-loading svelte-1ehcy4i">Loading saved scripts…</div>'),Ise=ke('<div class="library-empty svelte-1ehcy4i">No saved scripts yet.</div>'),Pse=(n,e,t)=>x(e,V(i(t).id)),Mse=ke('<button type="button"><div class="save-row-name svelte-1ehcy4i"> </div> <div class="save-row-meta svelte-1ehcy4i"> </div></button>'),Nse=(n,e,t)=>i(e)&&t(i(e)),Ase=ke('<div class="library-error svelte-1ehcy4i"> </div>'),Tse=ke('<div class="library-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="library-modal save-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="Save script"><div class="library-head svelte-1ehcy4i"><div class="library-title svelte-1ehcy4i">Save Script</div> <div class="library-head-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="library-body save-grid svelte-1ehcy4i"><div class="save-panel svelte-1ehcy4i"><div class="save-card svelte-1ehcy4i"><label class="input-label svelte-1ehcy4i" for="save-script-name">Script name</label> <input id="save-script-name" class="input svelte-1ehcy4i" placeholder="Enter a unique name"> <div class="save-actions svelte-1ehcy4i"><button class="btn btn-sm btn-primary" type="button">Save as new</button> <span class="save-hint svelte-1ehcy4i">Names must be unique</span></div></div></div> <div class="save-panel svelte-1ehcy4i"><div class="save-card svelte-1ehcy4i"><div class="save-divider svelte-1ehcy4i">Overwrite existing</div> <div class="save-list svelte-1ehcy4i"><!></div> <div class="save-actions overwrite-actions svelte-1ehcy4i"><button class="btn btn-sm btn-primary" type="button">Overwrite selected</button> <span class="save-hint svelte-1ehcy4i">Replaces the selected script with current code</span></div></div></div> <!></div></div></div>'),Fse=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},Lse=ke('<div class="library-error svelte-1ehcy4i"> </div>'),Ese=ke('<div class="library-loading svelte-1ehcy4i">Loading scripts…</div>'),$se=ke('<div class="library-empty svelte-1ehcy4i">No scripts found.</div>'),Dse=(n,e,t)=>e(i(t)),Rse=(n,e,t)=>e(i(t)),jse=(n,e,t)=>e(i(t)),Bse=(n,e,t)=>e(i(t)),Ose=(n,e,t)=>e(i(t).id),zse=ke('<div class="library-row svelte-1ehcy4i"><div><div class="library-name svelte-1ehcy4i"> </div> <div class="library-meta svelte-1ehcy4i"> </div></div> <div class="library-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button">Edit</button> <button class="btn btn-xs btn-outline" type="button">Insert</button> <button class="btn btn-xs btn-outline" type="button">Run</button> <button class="btn btn-xs btn-outline" type="button">Copy</button> <button class="btn btn-xs btn-danger svelte-1ehcy4i" type="button">Delete</button></div></div>'),Vse=ke('<div class="library-list svelte-1ehcy4i"></div>'),Wse=ke('<div class="library-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="library-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="My script library"><div class="library-head svelte-1ehcy4i"><div class="library-title svelte-1ehcy4i">My Script Library</div> <div class="library-head-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button">Refresh</button> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="library-toolbar svelte-1ehcy4i"><input class="input library-search svelte-1ehcy4i" type="search" placeholder="Search scripts"> <div class="library-count svelte-1ehcy4i"> </div></div> <!> <div class="library-body svelte-1ehcy4i"><!></div></div></div>'),Hse=ke('<span class="footer-alert-line svelte-1ehcy4i"> </span>'),qse=ke('<span tabindex="0"><span class="footer-alert-icon svelte-1ehcy4i">!</span> <span class="footer-alert-label svelte-1ehcy4i"> </span> <span class="footer-alert-tip svelte-1ehcy4i" role="tooltip"><span class="footer-alert-title svelte-1ehcy4i"> </span> <!></span></span>'),Use=ke('<div class="script-studio svelte-1ehcy4i"><div class="studio-header svelte-1ehcy4i"><div class="studio-title svelte-1ehcy4i"><div class="title-dot svelte-1ehcy4i"></div> <div class="title-text-group svelte-1ehcy4i"><div class="title-text svelte-1ehcy4i">Script Studio</div> <div class="title-sub svelte-1ehcy4i">Inline editor · draft → chart</div></div></div> <div class="studio-meta svelte-1ehcy4i"><div class="view-toggle svelte-1ehcy4i"><button type="button" class="svelte-1ehcy4i">Editor</button> <button type="button" class="svelte-1ehcy4i"><span> </span> <!></button> <button type="button" class="svelte-1ehcy4i">Results</button></div> <div class="lang-toggle svelte-1ehcy4i" aria-label="Script mode"><span class="lang-label svelte-1ehcy4i">Mode</span> <select class="lang-select svelte-1ehcy4i"><option>Auto</option><option>JSON</option><option>Pine</option><option>DSL</option><option>JS</option></select></div></div> <div class="studio-actions svelte-1ehcy4i"><!> <button class="ghost svelte-1ehcy4i" type="button" title="Toggle chart labels"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M2 3.5h8M2 6h8M2 8.5h5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span> </span></button> <button class="ghost ghost-secondary svelte-1ehcy4i" type="button"><span>Documentation</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span>Alerts</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span>My Library</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M3 2.5h6v7H3z" stroke="currentColor" stroke-width="1.2"></path><path d="M4 1h4v2H4z" fill="currentColor"></path><path d="M5 7h2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span>Save</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M6 2a4 4 0 1 1-3.5 2.06" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path><path d="M2.5 2.5v3h3" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span>Reset</span></button> <button class="primary svelte-1ehcy4i" type="button"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true"><path d="M4 3.2v5.6L9 6 4 3.2Z"></path></svg></span> <span> </span></button> <!> <button class="icon svelte-1ehcy4i" type="button" aria-label="Collapse script dock">&times;</button></div></div> <div class="editor-area svelte-1ehcy4i"><div class="editor-shell svelte-1ehcy4i"><div class="editor-main svelte-1ehcy4i"><div class="editor-toolbar svelte-1ehcy4i"><div class="editor-file svelte-1ehcy4i"><span class="file-dot svelte-1ehcy4i"></span> <span class="file-name svelte-1ehcy4i"> </span> <span class="file-meta svelte-1ehcy4i"> </span></div> <div class="editor-hints svelte-1ehcy4i"><span class="hint svelte-1ehcy4i">1. Write or paste script</span> <span class="hint svelte-1ehcy4i">2. Press Run ▶</span></div></div> <div class="editor-scroll svelte-1ehcy4i"><!></div></div> <!></div></div> <!> <!> <!> <!> <div class="studio-footer svelte-1ehcy4i"><div class="footer-left svelte-1ehcy4i"><span></span> <span class="footer-text svelte-1ehcy4i"> </span> <!></div> <div class="footer-right svelte-1ehcy4i"><span class="footer-hint svelte-1ehcy4i">Ctrl/Cmd + S to save</span> <span class="footer-divider svelte-1ehcy4i">•</span> <span class="footer-hint svelte-1ehcy4i">Ctrl/Cmd + Enter to run</span></div></div></div>');function Gse(n,e){Ed(e,!0);let t=hi(e,"code",15,""),s=hi(e,"codeVersion",3,0),o=hi(e,"status",3,null),r=hi(e,"error",3,null),a=hi(e,"runtimeDiagnostics",19,()=>[]),l=hi(e,"backtest",3,null),c=hi(e,"signalEvents",19,()=>[]),f=hi(e,"isRunning",3,!1),u=hi(e,"isOpen",3,!0),d=hi(e,"paneTarget",7,"main"),h=hi(e,"labelsEnabled",3,!0);const m=Fh();function g(){const ee=A(t());(typeof t()!="string"||ee!==t())&&(t(ee),i(io)&&Cn&&(Es=!0,Cn.setValue(ee),Es=!1)),m("run",{code:ee,params:i(La),lang:i(Ie),backtest:i(ri)})}const w="https://noti.dutyai.app/auth/chart/scripts",C=ee=>String(ee||"").trim().toLowerCase(),P=ee=>{const de=String(ee||""),He=de.match(/^\s*library\s*\(\s*["']([^"']+)["']/im);if(He)return He[1];const rt=de.match(/^\s*(indicator|study|strategy)\s*\(\s*["']([^"']+)["']/im);return rt?rt[2]:null},I=ee=>{if(typeof ee=="string")return ee;if(ee==null)return"";try{return JSON.stringify(ee,null,2)}catch{return String(ee)}},A=ee=>{if(typeof ee=="string"){const de=ee.trim();if(de.startsWith("{")&&de.includes('"script"')){try{const He=JSON.parse(de);if(He&&typeof He=="object"&&typeof He.script=="string"&&(He.userPreferenceId||He.createdAt||He.updatedAt))return He.script}catch{}if(de.includes('"userPreferenceId"')||de.includes('"createdAt"')){const He=de.match(/"script"\s*:\s*"([\s\S]*?)"\s*,\s*"(?:name|userPreferenceId|createdAt)"/);if(He&&He[1])try{return JSON.parse(`"${He[1]}"`)}catch{}}}return ee}if(ee&&typeof ee=="object"){const de=ee.script??ee.code;if(typeof de=="string")return de}return I(ee)};let M=ge(!1),F=ge(!1),B=ge(!1),$=ge(null),L=ge(""),O=ge(V([])),Y=ge(!1),ce=ge(""),Q=ge(null),le=ge(!1),ue=ge(null);function fe(ee){m("saveStatus",{status:ee})}const pe=ee=>{if(typeof ee=="number"&&Number.isFinite(ee))return ee;if(typeof ee=="string"&&ee.trim()){const de=Date.parse(ee);if(Number.isFinite(de))return de}return Date.now()},Z=ee=>{if(!ee)return null;const de=String(ee.id||ee._id||ee.scriptId||ee.name||"").trim()||`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,He=String(ee.name||ee.title||"Untitled Script").trim(),rt=ee.script??ee.code??ee.source??"",Qt=I(rt).trim(),Lt=pe(ee.createdAt||ee.created_at),_n=pe(ee.updatedAt||ee.updated_at||Lt);return{id:de,name:He,code:Qt,createdAt:Lt,updatedAt:_n}},xe=ee=>[...ee].sort((de,He)=>(He.updatedAt||0)-(de.updatedAt||0));async function oe(ee=!1){if(i(B)&&!ee)return;x(F,!0),x($,null);const de=zg();if(!de){const He=xe(n2());x(O,V(He)),x(B,!0),x(F,!1);return}try{const He=await fetch(`${w}/${de}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!He.ok){const Vn=await He.text();throw new Error(Vn||`${He.status} ${He.statusText}`)}const rt=await He.json(),Lt=(Array.isArray(rt)?rt:Array.isArray(rt==null?void 0:rt.data)?rt.data:Array.isArray(rt==null?void 0:rt.scripts)?rt.scripts:[]).map(Z).filter(Boolean),_n=xe(Lt);x(O,V(_n)),Eb(_n),x(B,!0)}catch{const rt=xe(n2());x(O,V(rt)),x(B,!0),x($,"Could not reach server. Showing local copies.")}finally{x(F,!1)}}function Pe(){x(Y,!0),x(Q,null),x(ue,null);const ee=P(A(t()));x(ce,V(ee||"")),oe(!1)}const $e=(ee,de)=>{const He=C(ee);return He?(i(O).length?i(O):n2()).some(Qt=>C(Qt.name)===He&&Qt.id!==de):!1};async function ze(){if(i(le))return;const ee=String(i(ce)||"").trim();if(!ee){x(Q,"Enter a script name to save.");return}if($e(ee)){x(Q,"That name already exists. Choose a different name.");return}x(le,!0),x(Q,null);const de=zg();try{let He=null;const rt=A(t());if(de){const Qt=await fetch(`${w}/${de}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ee,script:rt})});if(!Qt.ok){const Vn=await Qt.text();throw new Error(Vn||`${Qt.status} ${Qt.statusText}`)}const Lt=await Qt.json(),_n=Z({id:(Lt==null?void 0:Lt.id)||(Lt==null?void 0:Lt.scriptId)||(Lt==null?void 0:Lt._id),name:ee,script:(Lt==null?void 0:Lt.script)||(Lt==null?void 0:Lt.code)||rt,createdAt:Lt==null?void 0:Lt.createdAt,updatedAt:Lt==null?void 0:Lt.updatedAt});_n&&(He=_n,E5(He))}else He=QJ(ee,rt);He&&(x(O,V(xe([He,...i(O).filter(Qt=>Qt.id!==He.id)]))),Eb(i(O)),fe(`Saved • ${He.name}`)),x(Y,!1)}catch{x(Q,"Save failed. Please try again.")}finally{x(le,!1)}}async function Ke(ee){if(i(le))return;const de=i(O).find(Qt=>Qt.id===ee);if(!de)return;const He=String(de.name||"").trim();if(!He)return;if($e(He,ee)){x(Q,"Another script already uses this name.");return}x(le,!0),x(Q,null);const rt=zg();try{let Qt=null;const Lt=A(t());if(rt){const _n=await fetch(`${w}/${ee}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:He,script:Lt})});if(!_n.ok){const Js=await _n.text();throw new Error(Js||`${_n.status} ${_n.statusText}`)}const Vn=await _n.json(),Zn=Z({id:ee,name:He,script:(Vn==null?void 0:Vn.script)||(Vn==null?void 0:Vn.code)||Lt,createdAt:de.createdAt,updatedAt:(Vn==null?void 0:Vn.updatedAt)||Date.now()});Zn&&(Qt=Zn,E5(Qt))}else Qt=eQ(ee,{code:Lt,name:He});Qt&&(x(O,V(xe([Qt,...i(O).filter(_n=>_n.id!==Qt.id)]))),Eb(i(O)),fe(`Saved • ${Qt.name}`)),x(Y,!1)}catch{x(Q,"Update failed. Please try again.")}finally{x(le,!1)}}async function qe(ee){const de=i(O).find(Qt=>Qt.id===ee);if(!de||!(typeof window>"u"?!0:window.confirm(`Delete "${de.name}"? This cannot be undone.`)))return;const rt=zg();try{if(rt){const Lt=await fetch(`${w}/${ee}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!Lt.ok){const _n=await Lt.text();throw new Error(_n||`${Lt.status} ${Lt.statusText}`)}}else tQ(ee);const Qt=i(O).filter(Lt=>Lt.id!==ee);x(O,V(xe(Qt))),Eb(i(O)),fe(`Deleted • ${de.name}`)}catch{x($,"Delete failed. Please try again.")}}async function nt(ee){try{await navigator.clipboard.writeText(String(ee.code||"")),fe(`Copied • ${ee.name}`)}catch{fe("Copy failed")}}async function ft(ee,de){const He=A(t()),rt=A(ee),Qt=de!=null&&de.append&&He?`${He}

${rt}`.trim():rt;t(Qt),i(io)&&Cn&&(Es=!0,Cn.setValue(Qt),Es=!1),x(ve,"editor"),await r2(),requestAnimationFrame(()=>Rn==null?void 0:Rn.layout()),de!=null&&de.run&&g()}function ut(ee){ft(ee)}async function bt(ee){await ft(ee.code||""),x(M,!1),fe(`Loaded • ${ee.name}`)}async function Pt(ee){await ft(ee.code||"",{append:!0}),x(M,!1),fe(`Inserted • ${ee.name}`)}async function Et(ee){await ft(ee.code||"",{run:!0}),x(M,!1)}const Mt=()=>{const ee=String(i(L)||"").trim().toLowerCase();return ee?i(O).filter(de=>String(de.name||"").toLowerCase().includes(ee)):i(O)},Je=ee=>{if(!Number.isFinite(ee))return"";try{return new Date(ee).toLocaleString()}catch{return""}};Fr(()=>{const ee=A(t());ee!==t()&&(t(ee),i(io)&&Cn&&(Es=!0,Cn.setValue(ee),Es=!1))});function Ct(ee){d()!==ee&&(d(ee),m("pane",{target:ee}))}const Ze=ee=>{let de=String(ee||"").trim();return de=r6(de).replace(/#.*$/,""),de=de.split(";")[0],de=de.replace(/,\s*$/,""),de=de.replace(/\b(and|or)\b\s*$/i,""),de=de.replace(/\$\{[^}]+\}/g,"1"),de=de.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),de=de.replace(/\bstr\./gi,""),de=de.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),de=de.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(He,rt,Qt)=>`${String(rt).toLowerCase()}_${Qt}`),de=de.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),de=de.replace(/\bcrosses\s+below\b/gi,"crossesBelow"),de=e1(de,{pineV2:!0}).expr,de=t2(de),de.trim()},Xe=new Set(["na","nan","pi","e","true","false"]),Ae=ee=>{const de=[],He=rt=>{if(!(!rt||typeof rt!="object"))switch(rt.kind){case"Identifier":{const Qt=String(rt.name||"").toLowerCase();Xe.has(Qt)||de.push(rt.name);return}case"UnaryExpression":He(rt.expr);return;case"BinaryExpression":He(rt.left),He(rt.right);return;case"CallExpression":rt.args.forEach(Qt=>He(Qt));return;default:return}};return He(ee),de},Qe=["close","open","high","low","hl2","hlc3","ohlc4","volume"],gt=ee=>{const de=typeof ee=="number"?ee:Number(ee);if(!Number.isFinite(de)||de<=0)return"";try{return new Date(de).toISOString().slice(0,16)}catch{return""}},Ft=ee=>{if(!ee)return null;const de=Date.parse(ee);if(Number.isFinite(de))return de;const He=Number(ee);return Number.isFinite(He)?He:null},ot=ee=>{const de=String(ee||"").trim();if(/^#([0-9a-f]{6}|[0-9a-f]{3})$/i.test(de))return de.length===4?`#${de[1]}${de[1]}${de[2]}${de[2]}${de[3]}${de[3]}`:de;const He=de.match(/^rgba?\(([^)]+)\)$/i);if(He){const rt=He[1].split(",").map(Qt=>Qt.trim());if(rt.length>=3){const Qt=Number(rt[0]),Lt=Number(rt[1]),_n=Number(rt[2]);if([Qt,Lt,_n].every(Vn=>Number.isFinite(Vn))){const Vn=Zn=>Math.max(0,Math.min(255,Math.round(Zn))).toString(16).padStart(2,"0");return`#${Vn(Qt)}${Vn(Lt)}${Vn(_n)}`}}}return"#22c55e"};let ve=ge("editor"),Ie=ge("auto"),It=ge(V(!!h())),Dt=ge(!1),Zt=ge("trades"),gn=ge("compact"),hn=ge("compact"),qn=ge(!1);const On={setup:{en:{title:"Setup",desc:["Backtest Filters define the time window for the run (date range + session).","Filters do not change results until you press Run again.","Session uses HHMM-HHMM (leave blank for full day).","Compare Runs saves a snapshot (results + inputs) when you press Pin current.","Use Compare to see how parameter changes affect results side-by-side."],examples:["From 2025-01-01 to 2025-03-31 + Session 0930-1600 -> Run shows only those hours.","Pin Run A -> change fast=10 -> Run -> Pin Run B to compare."]},bn:{title:"সেটআপ",desc:["Backtest Filters মানে কোন সময়ের ডেটা নিয়ে টেস্ট করবেন (তারিখ + সেশন)।","ফিল্টার বদলালেই ফল বদলায় না—আবার Run দিলেই নতুন ফল আসবে।","Session ফরম্যাট HHMM-HHMM; ফাঁকা রাখলে পুরো দিন ধরা হয়।","Pin current দিলে ওই মুহূর্তের ফল + ইনপুট সেভ হয়।","Compare দিয়ে ছোট পরিবর্তনের ফল পাশাপাশিই দেখা যায়।"],examples:["From 2025-01-01, To 2025-03-31 + Session 0930-1600 দিলে শুধু ওই সময়ের ফল।","Run A Pin -> fast=10 দিন -> Run -> Pin -> দুইটা রানের ফল তুলনা।"]}},performance:{en:{title:"Performance Snapshot",desc:["Trades means a complete position: entry -> exit. For long it is buy->sell; for short it is sell->buy.","Net PnL is your real profit after fees; Return (%) compares that to your starting capital.","Max Drawdown is the biggest fall from a previous peak; smaller is safer.","Profit Factor > 1 means total wins are larger than total losses; Expectancy is avg profit per trade.","Sharpe/Sortino show risk-adjusted return; Exposure shows how long you were in the market."],examples:["A 60% win rate with negative Net PnL means losses are larger than wins.","A smooth, slowly rising equity curve usually means lower risk."]},bn:{title:"পারফরম্যান্স স্ন্যাপশট",desc:["Trades মানে সম্পূর্ণ একটি পজিশন: entry থেকে exit। Long হলে buy->sell, short হলে sell->buy।","Net PnL হলো আসল লাভ/ক্ষতি: মোট লাভ থেকে ফি/চার্জ বাদ।","Return (%) দেখায় শুরু করা টাকার তুলনায় কত শতাংশ লাভ/ক্ষতি হলো।","Max Drawdown মানে আগের সর্বোচ্চ লেভেল থেকে সবচেয়ে বড় পতন—এটা যত কম, তত নিরাপদ।","Profit Factor > 1 হলে লাভ ক্ষতির চেয়ে বেশি; Expectancy হলো প্রতি ট্রেডে গড় লাভ/ক্ষতি।","Sharpe/Sortino বলে একই লাভ করতে কত ঝুঁকি নিয়েছেন; Exposure দেখায় কত সময় ট্রেডে ছিলেন।"],examples:["Win rate বেশি হলেও Net negative হলে loss-গুলো বড় হয়েছে।","কম Drawdown + ধীরে ওপরে ওঠা curve মানে স্টেবল ট্রেডিং।"]}},behavior:{en:{title:"Trade Behavior",desc:["Long vs Short splits performance by direction.","Per-Signal Stats groups trades by signal ID so you can see what works.","Signals with low Net/PF are usually the ones to fix or remove.","Use this section to debug entries/exits, not just profitability."],examples:["Short trades = 0 means a long-only strategy.","If EXIT_FULL is net negative, your exit logic may be hurting results."]},bn:{title:"ট্রেড বিহেভিয়ার",desc:["Long বনাম Short আলাদা করে দেখায় কোন দিক বেশি কাজ করেছে।","Per-Signal Stats দেখায় কোন signal ID লাভ/ক্ষতি দিচ্ছে।","যে signal বারবার ক্ষতি করে, সেটি পরিবর্তন বা বন্ধ করতে পারবেন।","Trades/Net/PF দেখে বোঝা যায় কোনটা শক্তিশালী।"],examples:["Short ট্রেড 0 হলে long-only।","EXIT_FULL যদি net negative হয়, exit logic ঠিক করুন।"]}},optimization:{en:{title:"Optimization",desc:["Optimization only works if your script defines input.int or input.float.","Param A/B choose which inputs to sweep.","From/To/Step sets the grid values for each parameter.","Total runs = count(A) x count(B); too many combos triggers a warning.","Metric controls ranking (Max DD: lower is better).","Walk-forward splits Train/Test so results are more realistic."],examples:["Fast 5->20 step 5 gives 4 values; Slow 20->60 step 10 gives 5 values -> 20 runs.","Top row is best by the chosen metric."]},bn:{title:"অপ্টিমাইজেশন",desc:["Optimization কাজ করবে শুধু input.int বা input.float থাকলে।","Param A/B মানে কোন ইনপুটের মান ঘুরিয়ে দেখা হবে।","From/To/Step দিয়ে রেঞ্জ সেট হয়।","মোট রান = A-র মান x B-র মান (খুব বেশি হলে warning আসবে)।","Metric অনুযায়ী র‍্যাংক হয় (Max DD হলে কম মান ভালো)।","Walk-forward দিলে Train/Test আলাদা হয়ে বাস্তবসম্মত ফল পাওয়া যায়।"],examples:["Fast 5->20 step 5 = 4 মান; Slow 20->60 step 10 = 5 মান -> মোট 20 রান।","Top row মানে সেরা ফল।"]}},charts:{en:{title:"Charts",desc:["Equity curve (area + line) shows how your balance moved over time.","Buy & Hold line is the benchmark: what if you just held.","Drawdown chart shows the depth of pullbacks from peaks.","Range buttons only change the chart window, not the backtest itself."],examples:["Equity above Buy & Hold means the strategy outperformed holding.","Hover to see the exact date and equity value."]},bn:{title:"চার্টস",desc:["Equity curve (area + line) দেখায় আপনার ব্যালেন্স সময়ের সাথে কেমন বদলেছে।","Buy & Hold line হলো তুলনা—শুধু ধরে রাখলে কী হতো।","Drawdown chart দেখায় সবচেয়ে বড় পতন কত % ছিল।","1M/3M/6M/All শুধু চার্ট রেঞ্জ বদলায়, ট্রেড রেজাল্ট নয়।"],examples:["Equity line যদি Buy & Hold-এর উপরে থাকে, স্ট্র্যাটেজি ভালো।","Hover করলে নির্দিষ্ট দিনের equity দেখা যায়।"]}},returns:{en:{title:"Returns",desc:["Monthly/Weekly returns show which periods were good or bad.","Click a row to filter trades for that period.","Great for spotting seasonality or outlier months.","Empty means there were no trades in that period."],examples:["2025-02 +3.2% means that month was profitable.","Click a week row, then open Trades table to see those trades."]},bn:{title:"রিটার্নস",desc:["Monthly/Weekly রিটার্নস দেখায় কোন সময় ভালো বা খারাপ গেছে।","Row ক্লিক করলে ওই সময়ের ট্রেড ফিল্টার হয়।","Seasonality ধরতে কাজে লাগে।","ডেটা না থাকলে ওই সময় ট্রেড হয়নি।"],examples:["2025-02 মাসে +3.2% মানে লাভ।","Week row ক্লিক করলে Trades টেবিলে ফিল্টার হয়।"]}},distributions:{en:{title:"Distributions",desc:["PnL% histogram shows how trade outcomes are spread.","MAE% = worst adverse move; MFE% = best favorable move.","Duration shows how long trades usually last (in bars).","Use these to tune stops, targets, and holding time."],examples:["If most PnL% bins are small, results are consistent but modest.","High MAE suggests trades go deep negative before exit."]},bn:{title:"ডিস্ট্রিবিউশন",desc:["PnL% histogram দেখায় ফলাফল কোন রেঞ্জে বেশি হচ্ছে।","MAE% = সবচেয়ে খারাপ adverse move; MFE% = সবচেয়ে ভালো move।","Duration দিয়ে ট্রেড কত বার ধরে থাকে বোঝা যায়।","এগুলো দেখে stop-loss/TP টিউন করা যায়।"],examples:["PnL% ছোট রেঞ্জে বেশি মানে consistent ছোট লাভ।","MAE বেশি হলে ট্রেড আগে অনেক নিচে যায়।"]}},exports:{en:{title:"Exports & Totals",desc:["Open Trades/Orders tables to inspect each trade and order.","CSV exports are for Excel/Sheets or external analysis.","Totals summarize gross profit, gross loss, net, initial/final equity.","Filtered trades CSV respects the current month/week filter."],examples:["Use Trades CSV to build custom reports.","Total = Gross Profit - Gross Loss (fees shown separately)."]},bn:{title:"এক্সপোর্টস ও টোটালস",desc:["Trades/Orders টেবিলে প্রতিটি ট্রেডের Net PnL/fees/price দেখা যায়।","CSV ডাউনলোড করে Excel/Sheets-এ বিশ্লেষণ করা যায়।","Totals-এ gross profit, gross loss, net, initial/final equity দেখা যায়।","Filtered trades CSV বর্তমান ফিল্টার মেনে চলে।"],examples:["Trades CSV দিয়ে custom রিপোর্ট বানান।","Total = Gross Profit - Gross Loss (fees আলাদা)।"]}}};let bn=ge(!1),Fn=ge("setup"),Xs=ge("bn");function oo(ee){x(Fn,V(ee)),x(bn,!0)}let Yn=ge(V([])),_o=ge("");function xs(ee){x(Yn,V(i(Yn).filter(rt=>rt.id!==ee))),i(zr)===ee&&x(zr,null);const{[ee]:de,...He}=i(kl);x(kl,V(He))}let Rt=ge(""),un=ge(""),qs=ge("");const ri=Bt(()=>{const ee={},de=i(Rt).trim(),He=i(un).trim(),rt=i(qs).trim();return de&&(ee.from=de),He&&(ee.to=He),rt&&(ee.session=rt),Object.keys(ee).length?ee:null}),Eo=Bt(()=>!!i(ri)),Ia=Bt(()=>{const ee=[];return(i(Rt)||i(un))&&ee.push(`${i(Rt)||"…"} → ${i(un)||"…"}`),i(qs)&&ee.push(`Session ${i(qs)}`),ee.join(" • ")}),Lr=Bt(()=>i(mr).filter(ee=>ee.type==="int"||ee.type==="float"));let Qa=ge(!1),yr=ge(""),Fi=ge(""),Rc=ge(0),Cu=ge(0),uc=ge(1),Fl=ge(0),jc=ge(0),nd=ge(1),Fa=ge("netPnl"),dc=ge(!1),Bc=ge(V([])),rd=ge(0),uf=ge(!1),So=ge(V([])),Ll=ge(""),ya=ge(!1),hc=ge(70),Pa=ge("train"),Yr=ge(null),el=ge(0);const Yl=Bt(()=>i(Bc).length),Vu=Bt(()=>i(Yl)>0?Math.min(100,Math.round(i(rd)/i(Yl)*100)):0),Iu=Bt(()=>[...i(So)].sort((ee,de)=>Dn(de.summary)-Dn(ee.summary))),Ro=Bt(()=>i(Fa)==="profitFactor"?"Profit Factor":i(Fa)==="sharpe"?"Sharpe":i(Fa)==="winRate"?"Win Rate":i(Fa)==="maxDrawdownPct"?"Max DD (lower is better)":"Net PnL");let zr=ge(null),kl=ge(V({}));function Md(ee){x(zr,V(i(zr)===ee?null:ee))}function nf(ee){x(kl,V({...i(kl),[ee]:!i(kl)[ee]}))}function zf(ee,de=40){if(ee==null)return"—";let He="";if(typeof ee=="number"||typeof ee=="boolean")He=String(ee);else if(typeof ee=="string")He=ee;else try{He=JSON.stringify(ee)}catch{He=String(ee)}return de>0&&He.length>de?`${He.slice(0,de-1)}…`:He}function df(ee){return ee?Object.entries(ee).slice(0,6).map(([de,He])=>`${de}=${zf(He,18)}`).join(", "):"-"}const Pu=ee=>[{label:"Final",value:ps(ee.finalEquity,2)},{label:"Net",value:`${ee.netPnl>=0?"+":""}${ps(ee.netPnl,2)} (${fo(ee.netPnlPct??0)})`},{label:"DD",value:fo(ee.maxDrawdownPct??0)},{label:"PF",value:wu(ee.profitFactor??0)},{label:"Win",value:fo(ee.winRate??0)},{label:"Trades",value:String(ee.trades??0)},{label:"Sharpe",value:wu(ee.sharpe??0)},{label:"Sortino",value:wu(ee.sortino??0)},{label:"Exposure",value:fo(ee.exposurePct??0)},{label:"Bars/Trade",value:ps(ee.avgBarsInTrade??0,1)}];function Dd(ee){try{return JSON.stringify({label:ee.label,ts:ee.ts,params:ee.params,summary:ee.summary},null,2)}catch{return String(ee.summary)}}function yf(ee){const de=i(Lr).find(_n=>_n.name===ee),He=typeof(de==null?void 0:de.defval)=="number"?de.defval:0,rt=typeof(de==null?void 0:de.minval)=="number"?de.minval:He,Qt=typeof(de==null?void 0:de.maxval)=="number"?de.maxval:He,Lt=typeof(de==null?void 0:de.step)=="number"?de.step:(de==null?void 0:de.type)==="int"?1:.1;return{from:rt,to:Qt,step:Lt}}function $n(ee){x(yr,V(ee));const de=yf(ee);x(Rc,V(de.from)),x(Cu,V(de.to)),x(uc,V(de.step))}function ws(ee){if(x(Fi,V(ee)),!ee)return;const de=yf(ee);x(Fl,V(de.from)),x(jc,V(de.to)),x(nd,V(de.step))}Fr(()=>{i(Qa)||i(Lr).length&&($n(i(Lr)[0].name),i(Lr).length>1&&ws(i(Lr)[1].name),x(Qa,!0))});function Us(ee,de,He,rt){const Qt=i(Lr).find(Os=>Os.name===ee),Lt=(Qt==null?void 0:Qt.type)==="int",_n=Math.abs(rt||1);if(!Number.isFinite(de)||!Number.isFinite(He)||!Number.isFinite(_n)||_n<=0)return[];const Vn=[],Zn=de<=He?1:-1;let Js=de,$o=0;for(;Zn>0&&Js<=He+1e-9||Zn<0&&Js>=He-1e-9;){const Os=Lt?Math.round(Js):Number(Js.toFixed(6));if(Vn.push(Os),Js+=_n*Zn,$o+=1,$o>2e3)break}return Array.from(new Set(Vn))}function Dn(ee){return ee?i(Fa)==="profitFactor"?ee.profitFactor??0:i(Fa)==="sharpe"?ee.sharpe??0:i(Fa)==="winRate"?ee.winRate??0:i(Fa)==="maxDrawdownPct"?-(ee.maxDrawdownPct??0):ee.netPnl??0:-1/0}function ni(ee){return ee?i(Fa)==="profitFactor"?ee.profitFactor??0:i(Fa)==="sharpe"?ee.sharpe??0:i(Fa)==="winRate"?ee.winRate??0:i(Fa)==="maxDrawdownPct"?ee.maxDrawdownPct??0:ee.netPnl??0:0}function mo(ee){const de=ni(ee);return i(Fa)==="winRate"||i(Fa)==="maxDrawdownPct"?fo(de):ps(de,2)}function sr(ee){const de=i(ri)&&typeof i(ri)=="object"?{...i(ri)}:null;return!de&&!ee?null:{...de||{},...ee||{}}}function or(ee){if(!i(Bc).length)return;const de=i(Bc)[ee];if(!de)return;const He=i(ya)?hl(i(Pa)):null,rt=sr(He);x(uf,!0),m("run",{code:t(),params:de.params,lang:i(Ie),backtest:rt})}function hl(ee){var Lt,_n;if(!i(Ql).length)return null;const de=Number((Lt=i(Ql)[0])==null?void 0:Lt.timestamp),He=Number((_n=i(Ql)[i(Ql).length-1])==null?void 0:_n.timestamp);if(!Number.isFinite(de)||!Number.isFinite(He)||He<=de)return null;const rt=Math.max(10,Math.min(90,Number(i(hc))||70))/100,Qt=Math.round(de+(He-de)*rt);return ee==="train"?{from:de,to:Qt}:{from:Qt,to:He}}Fr(()=>{var Lt;if(!i(dc)||!i(uf)||f())return;const ee=p0(l()),de=Number((ee==null?void 0:ee._updatedAt)??0),He=Number(p0(i(el)));if(!ee||!de||de===He)return;x(el,V(de)),x(uf,!1);const rt=((Lt=i(Bc)[i(rd)])==null?void 0:Lt.params)||{},Qt=ee.summary;if(Qt&&(x(So,V([...i(So),{params:rt,summary:Qt}])),i(ya)&&i(Pa)==="test"&&x(Yr,V({params:rt,summary:Qt}))),x(rd,i(rd)+1),i(rd)<i(Bc).length)or(i(rd));else if(i(ya)&&i(Pa)==="train"){const _n=[...i(So)].sort((Vn,Zn)=>Dn(Zn.summary)-Dn(Vn.summary))[0];_n?(x(Bc,V([{params:_n.params}])),x(rd,0),x(Pa,"test"),or(0)):x(dc,!1)}else x(dc,!1)});const Oi=Bt(()=>i(Ie)==="auto"?"auto":i(Ie)),si=ee=>{const de=String(ee||"").trim();return de.startsWith("{")||de.startsWith("[")},Wo=ee=>{const de=String(ee||"");return/^\s*\/\/@\s*(?:pine|version)\b/m.test(de)||/\b(strategy|indicator|library|plot)\s*\(/m.test(de)||/\b(plotshape|plotchar|hline|table|line|label|box|alertcondition)\b/i.test(de)||/\b(request\.security(?:_lower_tf)?|input\.)\b/i.test(de)},Ua=ee=>{const de=String(ee||"").split(/\r?\n/),He=Math.min(8,de.length);for(let rt=0;rt<He;(rt+=1)-1){const Lt=(de[rt]||"").match(/^\s*(?:\/\/|#)\s*@?(?:lang|language)\s*(?::|=)?\s*([A-Za-z]+)\s*$/i);if(!Lt)continue;const _n=String(Lt[1]||"").toLowerCase();if(_n==="auto"||_n==="json"||_n==="pine"||_n==="dsl"||_n==="js")return _n}return null},Hi=Bt(()=>{if(i(Ie)!=="auto")return i(Ie);const ee=Ua(t());return ee||(si(t())?"json":"auto")});Fr(()=>{x(It,V(!!h()))});const to=Bt(()=>i(ve)==="results");function Li(){x(qn,!1),m("fullpage",{enabled:!1})}Th(()=>{const ee=de=>{i(qn)&&de.key==="Escape"&&(de.preventDefault(),Li())};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)}),Th(async()=>{if(!(typeof window>"u")&&i(In)==="idle"){x(In,"loading");try{fQ();const ee=await Bg(()=>import("../chunks/editor.api.CbdTRBW9.js").then(rt=>rt.m),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url);if(await Promise.all([Bg(()=>import("../chunks/monaco.contribution.yTjmHKxc.js"),__vite__mapDeps([15,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Bg(()=>import("../chunks/monaco.contribution.C8bAK3tb.js"),__vite__mapDeps([16,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Bg(()=>import("../chunks/monaco.contribution.DYavRcjr.js"),__vite__mapDeps([17,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Bg(()=>import("../chunks/monaco.contribution.TNax1u8L.js"),__vite__mapDeps([18,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Bg(()=>import("../chunks/suggestController.TAqXY2ko.js"),__vite__mapDeps([19,1,2,3,4,5,6,12,20,21,22]),import.meta.url),Bg(()=>import("../chunks/parameterHints.StIp-S_A.js"),__vite__mapDeps([23,2,1,3,24]),import.meta.url),Bg(()=>import("../chunks/hoverContribution.CisGEAg6.js"),__vite__mapDeps([25,2,1,3,11,4,5,6,20,21,9,10,26]),import.meta.url),Bg(()=>import("../chunks/formatActions.BuL_rer4.js"),__vite__mapDeps([27,2,4,13,11]),import.meta.url)]),St=ee,ol(ee),Ac(ee),br(ee),await r2(),!i(Nd)){x(In,"failed");return}const de=fa(String(t()||""));x(zo,V(de)),Cn=ee.editor.createModel(String(t()||""),de),Rn=ee.editor.create(i(Nd),{model:Cn,automaticLayout:!0,minimap:{enabled:!1},fontSize:13,fontFamily:'JetBrains Mono, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace',lineNumbers:"on",scrollBeyondLastLine:!1,wordWrap:de==="pine"?"off":"on",theme:Dl(),quickSuggestions:{other:!0,comments:!1,strings:!0},suggestOnTriggerCharacters:!0,parameterHints:{enabled:!0},inlineSuggest:{enabled:!0},tabCompletion:"on",snippetSuggestions:"inline",wordBasedSuggestions:!1,quickSuggestionsDelay:40}),Rn.addAction({id:"scriptstudio.format",label:"Format Document",keybindings:[ee.KeyMod.CtrlCmd|ee.KeyMod.Shift|ee.KeyCode.KeyF],run:()=>Rn==null?void 0:Rn.getAction("editor.action.formatDocument").run()}),Ts.push(Rn.onDidType(rt=>{if(Rn&&(rt==="."||rt==="("))try{const Qt=Rn.getAction("editor.action.triggerSuggest");Qt?Qt.run():Rn.trigger("keyboard","editor.action.triggerSuggest",{})}catch{}})),Ts.push(Rn.onDidChangeModelContent(rt=>{if(!Cn||Es)return;ro+=1;const Qt=ro;Co&&clearTimeout(Co);const Lt=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;Lt&&li!=null&&Lt(li),li=null;const Vn=(Array.isArray(rt==null?void 0:rt.changes)?rt.changes.reduce((Zn,Js)=>Zn+String((Js==null?void 0:Js.text)||"").length,0):0)>800?180:60;Co=setTimeout(()=>{const Zn=()=>{if(!Cn||Es||Qt!==ro)return;const $o=Cn.getValue();Fs=!0,$o!==t()&&t($o),Fs=!1},Js=typeof window<"u"?window==null?void 0:window.requestIdleCallback:void 0;Js&&Vn>60?li=Js(Zn,{timeout:250}):Zn()},Vn)}));const He=new MutationObserver(()=>{St&&St.editor.setTheme(Dl())});if(He.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),He.observe(document.body,{attributes:!0,attributeFilter:["data-theme"]}),Ts.push({dispose:()=>He.disconnect()}),Ts.push({dispose:()=>{Co&&clearTimeout(Co),Co=null;const rt=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;rt&&li!=null&&rt(li),li=null}}),typeof ResizeObserver<"u"){const rt=new ResizeObserver(()=>{Rn==null||Rn.layout()});i(Nd)&&rt.observe(i(Nd)),Ts.push({dispose:()=>rt.disconnect()})}x(In,"ready"),Fu()}catch(ee){console.warn("[ScriptStudio] Monaco init failed:",ee),x(In,"failed")}}}),b0(()=>{try{i(qn)&&m("fullpage",{enabled:!1})}catch{}Ts.forEach(ee=>ee.dispose()),Ts=[],Rn==null||Rn.dispose(),Cn==null||Cn.dispose(),Rn=null,Cn=null});const Vr=Bt(()=>{try{if(!si(String(t()||"")))return!1;const ee=JSON.parse(String(t()||"").trim());return!!(ee!=null&&ee.strategy)}catch{return!1}}),ba=Bt(()=>{try{if(!si(String(t()||"")))return!1;const ee=JSON.parse(String(t()||"").trim());return Array.isArray(ee==null?void 0:ee.signals)&&ee.signals.length>0}catch{return!1}});let qi=ge(""),Wr=ge(null);Fr(()=>{const ee=String(t()||""),de=i(Hi);if(!(de==="pine"||de==="auto"&&Wo(ee))){x(qi,""),x(Wr,null);return}let rt=!1,Qt=null;const Lt=ee,_n=()=>{if(!rt&&Lt===String(t()||""))try{const Zn=Fw(Lt);if(rt||Lt!==String(t()||""))return;x(qi,V(Lt)),x(Wr,V(Zn))}catch{if(rt||Lt!==String(t()||""))return;x(qi,V(Lt)),x(Wr,null)}},Vn=setTimeout(()=>{const Zn=typeof window<"u"?window==null?void 0:window.requestIdleCallback:void 0;Zn?Qt=Zn(_n,{timeout:250}):_n()},160);return()=>{rt=!0,clearTimeout(Vn);const Zn=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;Zn&&Qt!=null&&Zn(Qt)}});const Kl=Bt(()=>{const ee=i(Wr);return!!(ee&&ee.ok&&ee.spec&&ee.spec.strategy)}),Wl=Bt(()=>{const ee=i(Wr),de=ee&&ee.ok&&ee.spec?ee.spec.signals:null;return Array.isArray(de)&&de.length>0}),Ic=Bt(()=>!!(i(Vr)||i(Kl))),Pc=Bt(()=>!!(i(ba)||i(Wl))),cl=Bt(()=>{const ee=i(Wr);return!ee||!ee.ok?[]:Array.isArray(ee.warnings)?ee.warnings:[]}),mr=Bt(()=>{const ee=i(Wr);return!ee||!ee.ok?[]:Array.isArray(ee.inputDefs)?ee.inputDefs:[]});let La=ge(null);Fr(()=>{if(!i(mr).length){x(La,null);return}i(La)==null&&x(La,V({}))});const Sl=Bt(()=>{const ee={};for(const de of i(mr))ee[de.name]=i(La)&&de.name in i(La)?i(La)[de.name]:de.defval;return ee}),Ba=(ee,de)=>{x(La,V({...i(La)||{},[ee]:de}))},vi=Bt(()=>{var ee;return((ee=l())==null?void 0:ee.summary)||null}),vc=Bt(()=>{if(!i(to))return{total:0,entryLong:0,exitLong:0,entryShort:0,exitShort:0,lastTs:null};const ee=Array.isArray(c())?c():[],de={total:ee.length,entryLong:0,exitLong:0,entryShort:0,exitShort:0};let He=null;for(const rt of ee){if(!rt)continue;rt.type==="entry_long"?de.entryLong+=1:rt.type==="exit_long"?de.exitLong+=1:rt.type==="entry_short"?de.entryShort+=1:rt.type==="exit_short"&&(de.exitShort+=1);const Qt=Number(rt.timestamp);Number.isFinite(Qt)&&(He=He==null?Qt:Math.max(He,Qt))}return{...de,lastTs:He}}),ul=Bt(()=>{var ee;return i(to)&&Array.isArray((ee=l())==null?void 0:ee.trades)?l().trades:[]}),Ga=Bt(()=>{var ee;return i(to)&&Array.isArray((ee=l())==null?void 0:ee.orders)?l().orders:[]}),vl=ee=>{const de=typeof ee=="number"?ee:Number(ee);return!Number.isFinite(de)||de<=0?null:de<1e12?de*1e3:de},pu=ee=>{const de=vl(ee);if(de==null)return"-";try{const rt=new Date(de).toISOString();return`${rt.slice(0,10)} ${rt.slice(11,16)}`}catch{return"-"}},tl=ee=>{const de=typeof ee=="number"?ee:Number(ee);return Number.isFinite(de)?de:null},Oa=Bt(()=>{var Qt;const ee=i(to)&&Array.isArray((Qt=l())==null?void 0:Qt.roundTrips)?l().roundTrips:[],de=i(ul).length===0&&ee.length>0,He=(de?ee:i(ul)).filter(Lt=>Lt&&Number.isFinite(Number(Lt.entryIndex))&&Number.isFinite(Number(Lt.exitIndex))).slice().sort((Lt,_n)=>Number(Lt.exitIndex)-Number(_n.exitIndex)||Number(Lt.entryIndex)-Number(_n.entryIndex));let rt=0;return He.map((Lt,_n)=>{const Vn=tl(Lt.pnl??Lt.grossPnl??Lt.profit),Zn=tl(Lt.fees??Lt.fee??Lt.commission),Js=de&&Number.isFinite(Number(Lt.netPnl))?Number(Lt.netPnl):(Vn??0)-(Zn??0);rt+=Js;const $o=vl(Lt.entryTimestamp),Os=vl(Lt.exitTimestamp),Xo=pu($o),Ei=pu(Os),ao=[Lt.side||"",Lt.entryIndex,Lt.exitIndex,$o??0,Os??0,Lt.entryOrderId??"",Lt.exitOrderId??"",_n].join(":"),za=tl(de?Lt.avgEntryPrice??Lt.entryPrice??Lt.entry:Lt.entryPrice??Lt.entry_price??Lt.entry),$a=tl(de?Lt.avgExitPrice??Lt.exitPrice??Lt.exit:Lt.exitPrice??Lt.exit_price??Lt.exit);return{id:ao,side:String(Lt.side||""),qty:tl(Lt.qty??Lt.size??Lt.qtyEntered)??0,entryIndex:Number(Lt.entryIndex)||0,exitIndex:Number(Lt.exitIndex)||0,entryTimestamp:$o,exitTimestamp:Os,entryTimeLabel:Xo,exitTimeLabel:Ei,entryPrice:za??0,exitPrice:$a??0,entrySignalId:Lt.entrySignalId!=null?String(Lt.entrySignalId):"",exitSignalId:Lt.exitSignalId!=null?String(Lt.exitSignalId):"",pnl:Vn??0,pnlPct:tl(Lt.pnlPct??Lt.pnl_pct??Lt.returnPct)??0,fees:Zn??0,netPnl:Js,cumNet:rt,exitReason:String(Lt.exitReason||""),maePct:Number.isFinite(Number(Lt.maePct))?Number(Lt.maePct):null,mfePct:Number.isFinite(Number(Lt.mfePct))?Number(Lt.mfePct):null,barsHeld:Math.max(0,(Number(Lt.exitIndex)||0)-(Number(Lt.entryIndex)||0)+1)}})}),Oc=Bt(()=>i(Ga).filter(de=>de&&Number.isFinite(Number(de.createdIndex))).slice().sort((de,He)=>Number(de.createdIndex)-Number(He.createdIndex)||String(de.id||"").localeCompare(String(He.id||""))).map((de,He)=>{const rt=vl(de.createdTimestamp),Qt=vl(de.filledTimestamp),Lt=String(de.kind||"").toLowerCase(),_n=String(de.action||""),Vn=String(de.side||""),Zn=String(de.status||""),Js=tl(de.qty??de.quantity),$o=tl(de.cash),Os=tl(de.price),Xo=tl(de.stopPrice),Ei=tl(de.limitPrice),ao=de.tif!=null?String(de.tif).toUpperCase():"",za=tl(de.remainingQty),$a=tl(de.targetQty),yl=tl(de.trailPct),Cl=tl(de.trailOffset),Rl=tl(de.trailPrice),tc=String(Zn||"").toLowerCase().replace(/[^a-z0-9]+/g,"-");return{id:String(de.id||He),action:_n,actionLabel:_l(_n),side:Vn,sideLabel:_l(Vn),kind:String(de.kind||""),kindLabel:Xl(de.kind),originalKind:String(de.originalKind||""),status:Zn,statusLabel:_l(Zn),statusKey:tc,signalId:de.signalId!=null?String(de.signalId):"",ocoGroup:de.ocoGroup!=null?String(de.ocoGroup):"",createdIndex:Number(de.createdIndex)||0,createdTimestamp:rt,createdTimeLabel:pu(rt),activeFromIndex:Number(de.activeFromIndex)||0,expiresAtIndex:Number.isFinite(Number(de.expiresAtIndex))?Number(de.expiresAtIndex):null,qtyPct:Number(de.qtyPct)||0,qty:Js,cash:$o,tif:ao,remainingQty:za,targetQty:$a,trailPct:yl,trailOffset:Cl,trailPrice:Rl,price:Os,stopPrice:Xo??(Lt==="stop"?Os:null),limitPrice:Ei??(Lt==="limit"?Os:null),filledIndex:Number.isFinite(Number(de.filledIndex))?Number(de.filledIndex):null,filledTimestamp:Qt,filledTimeLabel:pu(Qt),fillPrice:tl(de.fillPrice),fillQty:tl(de.fillQty),fees:tl(de.fees),note:de.note!=null?String(de.note):""}})),Gu=Bt(()=>i(Oc).length>500?i(Oc).slice(i(Oc).length-500):i(Oc));let El=ge(V({type:"all"})),mu=ge(""),bc=ge(V({key:"exitIndex",dir:"desc"}));function nl(ee){i(bc).key===ee?x(bc,V({key:ee,dir:i(bc).dir==="asc"?"desc":"asc"})):x(bc,V({key:ee,dir:"desc"}))}function la(ee){return i(bc).key!==ee?"":i(bc).dir==="asc"?"↑":"↓"}const Mu=Bt(()=>{const ee=i(Oa),de=Vn=>{const Zn=Number(Vn==null?void 0:Vn.exitTimestamp);return!Number.isFinite(Zn)||Zn<=0?!1:i(El).type==="month"?re(Zn)===i(El).key:i(El).type==="week"?we(Zn)===i(El).key:!0},He=i(mu).trim().toLowerCase(),rt=i(El).type==="all"?ee:ee.filter(de),Qt=He?rt.filter(Vn=>[Vn.side,Vn.exitReason,Vn.entrySignalId,Vn.exitSignalId,String(Vn.entryIndex),String(Vn.exitIndex)].filter(Boolean).map(Js=>String(Js).toLowerCase()).some(Js=>Js.includes(He))):rt,Lt=i(bc).dir==="asc"?1:-1,_n=i(bc).key;return Qt.slice().sort((Vn,Zn)=>{const Js=Vn==null?void 0:Vn[_n],$o=Zn==null?void 0:Zn[_n];if(_n==="side")return String(Js).localeCompare(String($o))*Lt;const Os=typeof Js=="number"?Js:Number(Js),Xo=typeof $o=="number"?$o:Number($o);return!Number.isFinite(Os)&&!Number.isFinite(Xo)?0:Number.isFinite(Os)?Number.isFinite(Xo)?(Os-Xo)*Lt:-1:1})}),Yu=ee=>{const de=ee.length;let He=0,rt=0,Qt=0,Lt=0,_n=0,Vn=0,Zn=0,Js=0,$o=0;for(const $a of ee){const yl=Number($a==null?void 0:$a.netPnl)||0,Cl=Number($a==null?void 0:$a.fees)||0,Rl=Number($a==null?void 0:$a.pnl)||0;Qt+=yl,Lt+=Cl,_n+=Rl,Rl>0?Vn+=Rl:Rl<0&&(Zn+=Math.abs(Rl)),yl>0?(He+=1,Js+=yl):yl<0&&(rt+=1,$o+=yl)}const Os=de?He/de*100:0,Xo=He?Js/He:0,Ei=rt?$o/rt:0,ao=Zn>0?Vn/Zn:Vn>0?1/0:0,za=de?He/de*Xo+rt/de*Ei:0;return{trades:de,wins:He,losses:rt,winRate:Os,net:Qt,fees:Lt,gross:_n,grossProfit:Vn,grossLoss:Zn,profitFactor:ao,avgWin:Xo,avgLoss:Ei,expectancy:za}},zc=Bt(()=>{const ee=i(Oa).filter(He=>String(He.side)==="long"),de=i(Oa).filter(He=>String(He.side)==="short");return{long:Yu(ee),short:Yu(de)}}),Zd=Bt(()=>{const ee=i(Oa),de=new Map;for(const rt of ee){const Qt=String(rt.entrySignalId||rt.exitSignalId||"unknown"),Lt=de.get(Qt)||[];Lt.push(rt),de.set(Qt,Lt)}const He=Array.from(de.entries()).map(([rt,Qt])=>({id:rt,...Yu(Qt)}));return He.sort((rt,Qt)=>(Qt.net||0)-(rt.net||0)),He}),Yf=Bt(()=>{const ee=i(Oa).map(de=>Number(de==null?void 0:de.pnlPct)).filter(de=>Number.isFinite(de));return Xf(ee,12)}),Kf=Bt(()=>{const ee=i(Oa).map(de=>Number(de==null?void 0:de.maePct)).filter(de=>Number.isFinite(de));return Xf(ee,10)}),_d=Bt(()=>{const ee=i(Oa).map(de=>Number(de==null?void 0:de.mfePct)).filter(de=>Number.isFinite(de));return Xf(ee,10)}),Rd=Bt(()=>{const ee=i(Oa).map(de=>Number(de==null?void 0:de.barsHeld)).filter(de=>Number.isFinite(de));return Xf(ee,10)}),fc=Bt(()=>i(Mu).length>500?i(Mu).slice(i(Mu).length-500):i(Mu)),pp=Bt(()=>i(Oa).reduce((ee,de)=>ee+(Number(de.netPnl)||0),0));let kd=ge(null);function Wd(ee){x(kd,V((ee==null?void 0:ee.id)||null)),m("selectTrade",{trade:ee||null})}function $l(ee){ee&&(Wd(ee),Xu())}function Nu(ee){ee&&(m("focusOrder",{order:ee}),Xu())}function Ku(ee){x(El,V(ee)),i(kd)&&(i(Mu).some(He=>He.id===i(kd))||x(kd,null))}function bf(ee){x(Zt,V(ee)),x(Dt,!0)}function Xu(){x(Dt,!1)}const Ql=Bt(()=>{var ee;return i(to)&&Array.isArray((ee=l())==null?void 0:ee.equity)?l().equity:[]}),Hd=Bt(()=>{var ee;return i(to)&&Array.isArray((ee=l())==null?void 0:ee.benchmark)?l().benchmark:[]});let hu=ge("6m");function Jc(ee,de){var Lt;if(!Array.isArray(ee)||ee.length===0)return[];if(de==="all")return ee;const He=Number((Lt=ee[ee.length-1])==null?void 0:Lt.timestamp);if(!Number.isFinite(He)||He<=0)return ee;const rt=de==="1w"?7:de==="1m"?30:de==="3m"?90:de==="6m"?180:de==="1y"?365:365*5,Qt=He-rt*864e5;return ee.filter(_n=>Number(_n==null?void 0:_n.timestamp)>=Qt)}const Au=Bt(()=>Jc(i(Ql),i(hu))),jd=Bt(()=>Jc(i(Hd),i(hu))),Wu=Bt(()=>i(Au).map(ee=>({index:Number(ee.index),ts:Number(ee.timestamp),equity:Number(ee.equity)})).filter(ee=>Number.isFinite(ee.index)&&Number.isFinite(ee.ts)&&Number.isFinite(ee.equity))),sf=Bt(()=>i(jd).map(ee=>({index:Number(ee.index),ts:Number(ee.timestamp),equity:Number(ee.equity)})).filter(ee=>Number.isFinite(ee.index)&&Number.isFinite(ee.ts)&&Number.isFinite(ee.equity))),ad=Bt(()=>{if(!i(Wu).length)return[];let ee=-1/0;return i(Wu).map(de=>{ee=Math.max(ee,de.equity);const He=ee>0?(de.equity-ee)/ee*100:0;return{index:de.index,ts:de.ts,ddPct:He}})}),yd=Bt(()=>{if(!i(Wu).length)return null;const ee=i(Wu)[0].equity,de=i(Wu)[i(Wu).length-1].equity;let He=1/0,rt=-1/0;for(const _n of i(Wu))_n.equity<He&&(He=_n.equity),_n.equity>rt&&(rt=_n.equity);const Qt=de-ee,Lt=ee!==0?Qt/ee*100:0;return{first:ee,last:de,net:Qt,retPct:Lt,min:He,max:rt}}),Bd=Bt(()=>{if(!i(ad).length)return null;let ee=0,de=0;for(const Qt of i(ad)){const Lt=Number(Qt.ddPct)||0;Lt<ee&&(ee=Lt),de+=Lt}const He=de/i(ad).length,rt=i(ad)[i(ad).length-1].ddPct??0;return{worstAbs:Math.abs(ee),avgAbs:Math.abs(He),lastAbs:Math.abs(rt)}}),Mc=Bt(()=>{if(!i(se)||!i(Wu).length)return null;const ee=i(Wu)[i(Wu).length-1],de=i(se).maxY-i(se).minY;return!Number.isFinite(de)||de===0?null:{x:100,y:(1-(ee.equity-i(se).minY)/de)*100,value:ee.equity}}),Tu=Bt(()=>{if(!i(G)||!i(ad).length)return null;const ee=i(ad)[i(ad).length-1],de=i(G).maxY-i(G).minY;return!Number.isFinite(de)||de===0?null:{x:100,y:(1-(ee.ddPct-i(G).minY)/de)*100,value:ee.ddPct}});function qd(ee,de){const He=ee.filter(Ei=>Number.isFinite(Ei));if(!He.length)return null;const rt=typeof de=="number"&&Number.isFinite(de)?de:Math.min(...He);let Qt=Math.min(...He,rt),Lt=Math.max(...He,rt);if(!Number.isFinite(Qt)||!Number.isFinite(Lt))return null;Qt===Lt&&(Qt-=1,Lt+=1);const _n=He.length,Vn=Ei=>_n<=1?0:Ei/(_n-1)*100,Zn=Ei=>(1-(Ei-Qt)/(Lt-Qt))*100,Js=Zn(rt),$o=He.map((Ei,ao)=>({x:Vn(ao),y:Zn(Ei)})),Os=$o.map((Ei,ao)=>`${ao===0?"M":"L"} ${Ei.x.toFixed(3)} ${Ei.y.toFixed(3)}`).join(" "),Xo=[`M ${$o[0].x.toFixed(3)} ${Js.toFixed(3)}`,...$o.map(Ei=>`L ${Ei.x.toFixed(3)} ${Ei.y.toFixed(3)}`),`L ${$o[$o.length-1].x.toFixed(3)} ${Js.toFixed(3)}`,"Z"].join(" ");return{line:Os,area:Xo,minY:Qt,maxY:Lt,baselineY:Js}}function Xf(ee,de){const He=ee.filter(Vn=>Number.isFinite(Vn));if(!He.length||de<=0)return[];let rt=Math.min(...He),Qt=Math.max(...He);if(rt===Qt)return[{label:`${ps(rt,2)}`,count:He.length,min:rt,max:Qt}];const Lt=(Qt-rt)/de,_n=[];for(let Vn=0;Vn<de;(Vn+=1)-1){const Zn=rt+Lt*Vn,Js=Vn===de-1?Qt:rt+Lt*(Vn+1);_n.push({label:`${ps(Zn,2)}–${ps(Js,2)}`,count:0,min:Zn,max:Js})}for(const Vn of He){const Zn=Math.min(_n.length-1,Math.floor((Vn-rt)/Lt));_n[Zn].count+=1}return _n}function Vf(ee){let de=0;for(const He of ee)He.count>de&&(de=He.count);return de||1}const se=Bt(()=>qd(i(Wu).map(ee=>ee.equity))),be=Bt(()=>qd(i(sf).map(ee=>ee.equity))),G=Bt(()=>qd(i(ad).map(ee=>ee.ddPct),0));function re(ee){const de=new Date(ee),He=de.getUTCFullYear(),rt=String(de.getUTCMonth()+1).padStart(2,"0");return`${He}-${rt}`}function we(ee){const de=new Date(ee),He=new Date(Date.UTC(de.getUTCFullYear(),de.getUTCMonth(),de.getUTCDate())),rt=He.getUTCDay()||7;He.setUTCDate(He.getUTCDate()+4-rt);const Qt=new Date(Date.UTC(He.getUTCFullYear(),0,1)),Lt=Math.ceil(((He-Qt)/864e5+1)/7);return`${He.getUTCFullYear()}-W${String(Lt).padStart(2,"0")}`}function J(ee,de){if(!(ee!=null&&ee.length))return[];const He=de==="month"?re:we,rt=new Map;for(const Vn of ee){const Zn=Number(Vn==null?void 0:Vn.timestamp),Js=Number(Vn==null?void 0:Vn.equity),$o=Number(Vn==null?void 0:Vn.index);if(!Number.isFinite(Zn)||!Number.isFinite(Js)||!Number.isFinite($o))continue;const Os=He(Zn),Xo=rt.get(Os);Xo?Xo.last={ts:Zn,eq:Js,idx:$o}:rt.set(Os,{first:{ts:Zn,eq:Js,idx:$o},last:{ts:Zn,eq:Js,idx:$o}})}const Qt=Array.from(rt.keys()).sort(),Lt=[];let _n=null;for(const Vn of Qt){const Zn=rt.get(Vn),Js=Number(Zn.last.eq);if(!Number.isFinite(Js))continue;if(_n==null){_n=Js;continue}const $o=_n!==0?(Js-_n)/_n*100:0;Lt.push({key:Vn,retPct:$o,from:_n,to:Js,toIndex:Number(Zn.last.idx),toTs:Number(Zn.last.ts)}),_n=Js}return Lt}const Fe=Bt(()=>J(i(Ql),"month")),yt=Bt(()=>J(i(Ql),"week")),vt=Bt(()=>{const ee=new Map;for(const de of i(Oa)){const He=Number(de==null?void 0:de.exitTimestamp);if(!Number.isFinite(He)||He<=0)continue;const rt=re(He),Qt=ee.get(rt)||{trades:0,wins:0,losses:0,net:0,fees:0},Lt=Number(de==null?void 0:de.netPnl)||0;Qt.trades+=1,Qt.net+=Lt,Qt.fees+=Number(de==null?void 0:de.fees)||0,Lt>0?Qt.wins+=1:Lt<0&&(Qt.losses+=1),ee.set(rt,Qt)}return ee}),jt=Bt(()=>{const ee=new Map;for(const de of i(Oa)){const He=Number(de==null?void 0:de.exitTimestamp);if(!Number.isFinite(He)||He<=0)continue;const rt=we(He),Qt=ee.get(rt)||{trades:0,wins:0,losses:0,net:0,fees:0},Lt=Number(de==null?void 0:de.netPnl)||0;Qt.trades+=1,Qt.net+=Lt,Qt.fees+=Number(de==null?void 0:de.fees)||0,Lt>0?Qt.wins+=1:Lt<0&&(Qt.losses+=1),ee.set(rt,Qt)}return ee});function ye(ee){const de=He=>{const rt=He==null?"":String(He);return/[",\n]/.test(rt)?`"${rt.replace(/"/g,'""')}"`:rt};return ee.map(de).join(",")}function E(ee,de,He){try{const rt=new Blob([de],{type:He}),Qt=URL.createObjectURL(rt),Lt=document.createElement("a");Lt.href=Qt,Lt.download=ee,document.body.appendChild(Lt),Lt.click(),Lt.remove(),setTimeout(()=>URL.revokeObjectURL(Qt),2500)}catch{}}const me=190,Se=86,Ve=10;let Ye=ge(null),at=ge(null);const Re=Bt(()=>{try{const ee=JSON.parse(String(t()||"").trim());return!!(ee!=null&&ee.pane||ee!=null&&ee.panes||ee!=null&&ee.main||ee!=null&&ee.sub)}catch{return!1}});Fr(()=>{i(Wu),i(ad),i(ve),i(ve)});function De(ee){var ao;if(!i(Wu).length)return;const He=ee.currentTarget.getBoundingClientRect(),rt=Math.max(0,Math.min(me,He.width-Ve*2)),Qt=Math.max(0,Math.min(Se,He.height-Ve*2)),Lt=Math.max(0,Math.min(He.width,ee.clientX-He.left)),_n=Math.max(0,Math.min(He.height,ee.clientY-He.top)),Vn=Math.round(Lt/Math.max(1,He.width)*(i(Wu).length-1)),Zn=i(Wu)[Vn];if(!Zn)return;const Js=((ao=i(Wu)[0])==null?void 0:ao.equity)??Zn.equity,$o=Zn.equity-Js,Os=Js!==0?$o/Js*100:0;let Xo=Lt+12;Xo+rt+Ve>He.width&&(Xo=Lt-12-rt),Xo=Math.max(Ve,Math.min(Xo,He.width-rt-Ve));let Ei=_n-12-Qt;Ei<Ve&&(Ei=_n+12),Ei=Math.max(Ve,Math.min(Ei,He.height-Qt-Ve)),x(Ye,V({x:Lt,y:_n,left:Xo,top:Ei,ts:Zn.ts,equity:Zn.equity,net:$o,retPct:Os}))}function pt(ee){var Xo;if(!i(ad).length)return;const He=ee.currentTarget.getBoundingClientRect(),rt=Math.max(0,Math.min(me,He.width-Ve*2)),Qt=Math.max(0,Math.min(Se,He.height-Ve*2)),Lt=Math.max(0,Math.min(He.width,ee.clientX-He.left)),_n=Math.max(0,Math.min(He.height,ee.clientY-He.top)),Vn=Math.round(Lt/Math.max(1,He.width)*(i(ad).length-1)),Zn=i(ad)[Vn];if(!Zn)return;const Js=(Xo=i(Wu)[Vn])==null?void 0:Xo.equity;let $o=Lt+12;$o+rt+Ve>He.width&&($o=Lt-12-rt),$o=Math.max(Ve,Math.min($o,He.width-rt-Ve));let Os=_n-12-Qt;Os<Ve&&(Os=_n+12),Os=Math.max(Ve,Math.min(Os,He.height-Qt-Ve)),x(at,V({x:Lt,y:_n,left:$o,top:Os,ts:Zn.ts,ddPct:Zn.ddPct,equity:Number.isFinite(Js)?Js:null}))}const Ge=Bt(()=>{const ee=String(t()||"");if(!ee)return 1;let de=1;for(let He=0;He<ee.length;(He+=1)-1)ee.charCodeAt(He)===10&&(de+=1);return de}),sn=Bt(()=>i(In)==="failed"?String(t()||"").split(`
`):[]);function Un(ee,de){let He=1,rt=1;for(let Qt=0;Qt<de&&Qt<ee.length;Qt+=1)ee[Qt]===`
`?(He+=1,rt=1):rt+=1;return{line:He,col:rt}}const Zs=ee=>{const de=String(ee||""),He=[[/JS guardrail: loop iteration limit exceeded/i,"Reduce loop size or add a break/guard condition."],[/JS guardrail: time budget exceeded/i,"Reduce per-bar work or heavy calculations; optimize loops."],[/JS guardrail: call depth exceeded/i,"Avoid deep recursion or excessive nested calls."],[/ctx\.hist offset must be a non-negative integer/i,"Use integer offsets only: ctx.hist(series, 0/1/2/...)."],[/strategy\.[^\s]+ is not available in JS/i,"Use documented strategy accessors (snake_case or camelCase)."],[/JS guardrail: max series points exceeded/i,"Reduce loaded bars or increase the guardrail limit."],[/JS guardrail: draw op limit exceeded/i,"Reduce draw calls or gate them with conditions."],[/JS guardrail: total runtime exceeded/i,"Reduce the number of bars or simplify per-bar work."],[/JS engine: no bars available/i,"Load chart data or switch to a symbol/timeframe with candles."]];for(const[rt,Qt]of He)if(rt.test(de))return Qt};function vs(ee){try{return{ok:!0,value:JSON.parse(ee)}}catch(de){const He=String((de==null?void 0:de.message)||"Invalid JSON"),rt=He.match(/position\s+(\d+)/i),Qt=rt?Number(rt[1]):null,Lt=typeof Qt=="number"&&Number.isFinite(Qt)?Un(ee,Qt):void 0;return{ok:!1,error:{level:"error",message:He,hint:"Fix JSON syntax (quotes/commas/braces).",line:Lt==null?void 0:Lt.line,col:Lt==null?void 0:Lt.col}}}}const Oo=ee=>{let de="",He=null;for(let rt=0;rt<ee.length;(rt+=1)-1){const Qt=ee[rt],Lt=ee[rt+1];if(He){de+=Qt,Qt===He&&ee[rt-1]!=="\\"&&(He=null);continue}if(Qt==="'"||Qt==='"'){He=Qt,de+=Qt;continue}if(Qt==="/"&&Lt==="/")break;de+=Qt}return de},Pi=ee=>{let de="",He=null;for(let rt=0;rt<ee.length;(rt+=1)-1){const Qt=ee[rt];if(He){de+=" ",Qt===He&&ee[rt-1]!=="\\"&&(He=null);continue}if(Qt==="'"||Qt==='"'){He=Qt,de+=" ";continue}de+=Qt}return de},no=ee=>{const de=String(ee||"").split(/\r?\n/),He=/[A-Za-z_$][A-Za-z0-9_$]*\s*\[\s*-\s*\d+\s*\]/;for(let rt=0;rt<de.length;(rt+=1)-1){const Qt=Oo(de[rt]||""),Lt=Pi(Qt),_n=He.exec(Lt);if(_n)return{line:rt+1,col:_n.index+1,snippet:_n[0].trim()}}return null},gl=ee=>{const de=String(ee||""),He=[];let rt="",Qt=0,Lt=null,_n=!1;for(let Vn=0;Vn<de.length;(Vn+=1)-1){const Zn=de[Vn];if(Lt){if(rt+=Zn,_n){_n=!1;continue}if(Zn==="\\"){_n=!0;continue}Zn===Lt&&(Lt=null);continue}if(Zn==="'"||Zn==='"'){Lt=Zn,rt+=Zn;continue}if(Zn==="("){Qt+=1,rt+=Zn;continue}if(Zn===")"&&Qt>0){Qt-=1,rt+=Zn;continue}if(Zn===","&&Qt===0){rt.trim()&&He.push(rt.trim()),rt="";continue}rt+=Zn}return rt.trim()&&He.push(rt.trim()),He},Ms=ee=>{const de=String(ee||"").split(/\r?\n/),He={},rt=Lt=>Lt.trim().toLowerCase(),Qt=Lt=>{const _n=String(Lt||"").trim();if(!/^[-+]?\d+(?:\.\d+)?$/.test(_n))return null;const Vn=Number(_n);return Number.isFinite(Vn)?Math.max(0,Math.floor(Vn)):null};for(let Lt=0;Lt<de.length;(Lt+=1)-1){const _n=Oo(de[Lt]||""),Vn=_n.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.new_(?:float|int|bool|string)\s*\(([^)]*)\)/i);if(Vn){const Js=gl(Vn[2]||""),$o=Qt(Js[0]||"");$o!=null&&(He[rt(Vn[1]||"")]=$o);continue}const Zn=_n.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.from\s*\(([^)]*)\)/i);if(Zn){const Js=gl(Zn[2]||"");Js.length&&(He[rt(Zn[1]||"")]=Js.length)}}for(let Lt=0;Lt<de.length;(Lt+=1)-1){const _n=Oo(de[Lt]||""),Vn=Pi(_n),Zn=Vn.match(/\barray\.set\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+(?:\.\d+)?)\b/i);if(Zn){const $o=rt(Zn[1]||""),Os=Number(Zn[2]),Xo=He[$o],Ei=Vn.indexOf(Zn[0]||"")+1;if(Number.isFinite(Os)&&!Number.isInteger(Os))return{line:Lt+1,col:Ei>0?Ei:1,message:"array index must be an integer"};if(Number.isFinite(Os)&&Os<0)return{line:Lt+1,col:Ei>0?Ei:1,message:"Negative array index not allowed"};if(Number.isFinite(Os)&&Xo!=null&&Os>=Xo)return{line:Lt+1,col:Ei>0?Ei:1,message:"array.set index must be within array size"}}const Js=Vn.match(/\barray\.get\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+(?:\.\d+)?)\b/i);if(Js){const $o=Number(Js[2]),Os=Vn.indexOf(Js[0]||"")+1;if(Number.isFinite($o)&&!Number.isInteger($o))return{line:Lt+1,col:Os>0?Os:1,message:"array index must be an integer"};if(Number.isFinite($o)&&$o<0)return{line:Lt+1,col:Os>0?Os:1,message:"Negative array index not allowed"}}}return null},wo=ee=>{const de=String(ee||"").trim();if(!de)return"";const He=de[0];return(He==='"'||He==="'")&&de.endsWith(He)?de.slice(1,-1):de},fr=ee=>{const de=wo(ee).trim().toLowerCase();if(!de)return null;const He=de.replace(/^shape\./,"").replace(/^label\./,"");return He.includes("none")?"none":He.includes("xcross")?"xcross":He.includes("cross")?"cross":He.includes("diamond")?"diamond":He.includes("triangleup")?"triangle_up_filled":He.includes("triangledown")?"triangle_down_filled":He.includes("arrowup")?"arrowUp":He.includes("arrowdown")?"arrowDown":He.includes("circle")?"circle":He.includes("square")?"square":He.includes("flag")?"flag":He.includes("tag")?"tag":He.includes("pill")?"pill":He.includes("label")?"label":null},xa=ee=>{const de=wo(ee).trim().toLowerCase();if(!de)return null;const He=de.replace(/^size\./,"");if(He==="auto")return 14;if(He==="tiny")return 10;if(He==="small")return 12;if(He==="normal")return 14;if(He==="large")return 18;if(He==="huge")return 22;const rt=Number(He);return Number.isFinite(rt)?rt:null},ic=ee=>{const de=String(ee||"").trim().toLowerCase();return de?de.startsWith('"')||de.startsWith("'")||de.startsWith("shape.")||de.startsWith("label.")?!0:["triangleup","triangledown","arrowup","arrowdown","circle","square","label","cross","xcross","diamond","flag","tag","pill","none"].includes(de):!1},ec=ee=>{const de=String(ee||"").trim().toLowerCase();return de?de.startsWith('"')||de.startsWith("'")?!0:de.startsWith("location."):!1},Lf=ee=>{const de=wo(ee).trim().toLowerCase();if(!de)return null;const He=de.replace(/^location\./,"");return He.includes("absolute")?"absolute":/(above|top|high)/.test(He)?"above":/(below|bottom|low)/.test(He)?"below":null},_e=ee=>{const de=String(ee||"").trim().toLowerCase();return de?de.startsWith('"')||de.startsWith("'")||de.startsWith("size.")?!0:/^[-+]?\d+(?:\.\d+)?$/.test(de):!1},We=ee=>{const de={};return ee.forEach(He=>{const rt=He.indexOf("=");if(rt<=0)return;const Qt=He.slice(0,rt).trim().toLowerCase(),Lt=He.slice(rt+1).trim();Qt&&(de[Qt]=Lt)}),de},xt=ee=>{const de=String(ee||"").split(/\r?\n/);for(let He=0;He<de.length;(He+=1)-1){const rt=Oo(de[He]||""),Qt=rt.match(/^\s*(plotshape|plotchar)\s*\((.*)\)\s*$/i);if(!Qt)continue;const Lt=String(Qt[1]||"").toLowerCase(),_n=gl(Qt[2]||""),Vn=We(_n),Zn=Vn.style??Vn.shape;if(Lt==="plotshape"&&Zn&&ic(Zn)&&!fr(Zn)){const Xo=Math.max(1,rt.indexOf(Zn)+1);return{line:He+1,col:Xo,message:`plotshape style not supported: ${Zn}`}}const Js=Vn.location;if(Js&&ec(Js)&&!Lf(Js)){const Xo=Math.max(1,rt.indexOf(Js)+1);return{line:He+1,col:Xo,message:`${Lt} location not supported: ${Js}`}}const $o=Vn.size;if($o&&_e($o)&&xa($o)==null){const Xo=Math.max(1,rt.indexOf($o)+1);return{line:He+1,col:Xo,message:`${Lt} size not supported: ${$o}`}}}return null},Ht=ee=>{const de=String(ee||"").trim();if(!de)return!1;const He=de[0];if(He!=='"'&&He!=="'")return!1;let rt=1,Qt=!1;for(;rt<de.length;(rt+=1)-1){const Lt=de[rt];if(Qt){Qt=!1;continue}if(Lt==="\\"){Qt=!0;continue}if(Lt===He){rt+=1;break}}return rt<=1?!1:de.slice(rt).trim().length===0},qt=ee=>{const de=String(ee||"").split(/\r?\n/);for(let He=0;He<de.length;(He+=1)-1){const rt=de[He]||"";let Qt=null,Lt=0,_n=-1,Vn=-1;for(let Zn=0;Zn<rt.length;(Zn+=1)-1){const Js=rt[Zn],$o=rt[Zn+1];if(Qt){Js===Qt&&rt[Zn-1]!=="\\"&&(Qt=null);continue}if(Js==="'"||Js==='"'){Qt=Js;continue}if(Js==="/"&&$o==="/")break;if(Js==="?"){Lt===0&&(_n=Zn),Lt+=1;continue}if(Js===":"&&Lt>0&&(Lt-=1,Lt===0)){Vn=Zn;break}}if(_n>=0&&Vn>_n){const Zn=rt.slice(_n+1,Vn),Js=rt.slice(Vn+1),$o=Ht(Zn),Os=Ht(Js);if($o!==Os)return{line:He+1,col:_n+1,snippet:rt.slice(_n).trim()}}}return null};function ht(){var Vn,Zn,Js,$o;const ee=[],de=String(t()||""),He=de.trim();if(!He)return ee;const rt=Os=>{const Xo=new Set;Os.forEach(ao=>{const za=`${ao.level}:${String(ao.message||"").trim()}`;za.trim()!==`${ao.level}:`&&Xo.add(za)});const Ei=String(r()||"").trim();if(Ei){const ao=`error:${Ei}`;Xo.has(ao)||(Os.unshift({level:"error",message:Ei,hint:(i(Hi)==="js"?Zs(Ei):void 0)||"See the console for details if needed."}),Xo.add(ao))}return Array.isArray(a())&&a().forEach(ao=>{if(ao&&typeof ao=="object"){const yl=ao.level==="error"||ao.level==="warning"?ao.level:"warning",Cl=String(ao.message||"").trim();if(!Cl)return;const Rl=`${yl}:${Cl}`;if(Xo.has(Rl))return;Xo.add(Rl),Os.push({level:yl,message:Cl,hint:ao.hint?String(ao.hint):void 0,line:typeof ao.line=="number"?ao.line:void 0,col:typeof ao.col=="number"?ao.col:void 0});return}const za=String(ao||"").trim();if(!za)return;const $a=`warning:${za}`;Xo.has($a)||(Xo.add($a),Os.push({level:"warning",message:za}))}),Os},Qt=i(Hi);if(Qt==="pine"||Qt==="auto"&&Wo(de)){try{const Os=i(qi)===de?i(Wr):null;if(Os&&Os.ok===!1&&Array.isArray(Os.errors)&&Os.errors.length)return Os.errors.slice(0,12).forEach(Xo=>{ee.push({level:"error",message:String((Xo==null?void 0:Xo.message)||"Pine error"),hint:"Fix the Pine line or use the Guide examples.",line:typeof(Xo==null?void 0:Xo.line)=="number"?Xo.line:void 0,col:1})}),rt(ee);if(Os&&Os.ok){const Xo=no(He);if(Xo)return ee.push({level:"error",message:`Negative history index not allowed: ${Xo.snippet}`,hint:"Use x[0], x[1], x[2] (negative indices are invalid).",line:Xo.line,col:Xo.col}),rt(ee);const Ei=(Os.warnings||[]).find(Cl=>String((Cl==null?void 0:Cl.message)||"").includes('":=" used before'));if(Ei)return ee.push({level:"error",message:String(Ei.message||'":=" used before declaration'),hint:"Declare with var or use '=' for first assignment.",line:typeof Ei.line=="number"?Ei.line:void 0,col:1}),rt(ee);const ao=qt(He);if(ao)return ee.push({level:"error",message:"Ternary branches must both be numeric or both non-numeric",hint:"Use numeric values on both branches or non-numeric values on both branches.",line:ao.line,col:ao.col}),rt(ee);const za=Ms(He);if(za)return ee.push({level:"error",message:za.message,hint:"Use a valid non-negative index within the array size.",line:za.line,col:za.col}),rt(ee);const $a=xt(He);if($a)return ee.push({level:"error",message:$a.message,hint:"Use a supported plotshape/plotchar option value.",line:$a.line,col:$a.col}),rt(ee);const yl=Y_(Os.spec);yl.ok||(yl.errors||[]).forEach(Cl=>ee.push({level:"error",message:Cl,hint:cr(Cl)}))}}catch{}return rt(ee)}if(Qt==="js"||Qt==="dsl"||Qt==="auto"&&!si(He))return rt(ee);const _n=vs(He);if(!_n.ok)return ee.push(_n.error),rt(ee);try{const Os=_n.value;if(Os&&(Os.plots||Os.calc||Os.panes||Os.main||Os.sub)){const Xo=Os&&typeof Os=="object"?Os.params||{}:{},Ei=Nw(Os,Xo);let ao=Ei;try{ao=Tw(Ei)}catch(Po){return ee.push({level:"error",message:`Template expansion error: ${String((Po==null?void 0:Po.message)||Po)}`,hint:"Check repeat/forEach blocks and loop sizes."}),rt(ee)}const za=Y_(ao);za.ok||(za.errors||[]).forEach(Po=>ee.push({level:"error",message:Po,hint:cr(Po)}));const $a=ao.pane||ao.plots||ao.labels||ao.levels||ao.lines?{pane:ao.pane||"main",plots:ao.plots||[],labels:ao.labels||[],levels:ao.levels||[],lines:ao.lines||[],min:ao.min,max:ao.max}:null,yl=[].concat($a?[$a]:[]).concat(ao.panes||[]).concat(ao.main?[ao.main]:[]).concat(ao.sub?[ao.sub]:[]),Cl=Array.isArray(ao.calc)?ao.calc:[],Rl=Array.isArray(ao.series)?ao.series:[],tc=Array.isArray((Vn=za.spec)==null?void 0:Vn.series)?(Zn=za.spec)==null?void 0:Zn.series:[],Ad=Array.isArray((Js=za.spec)==null?void 0:Js.stateSeries)?($o=za.spec)==null?void 0:$o.stateSeries:[],gc=new Set(["open","high","low","close","volume","time","bar_index"]);Rl.forEach(Po=>{const Mo=String((Po==null?void 0:Po.name)||"").replace(/\s+/g,"_").toLowerCase();Mo&&gc.add(Mo)}),tc.forEach(Po=>{const Mo=String((Po==null?void 0:Po.name)||"").replace(/\s+/g,"_").toLowerCase();Mo&&gc.add(Mo)}),Ad.forEach(Po=>{const Mo=String((Po==null?void 0:Po.name)||"").replace(/\s+/g,"_").toLowerCase();Mo&&gc.add(Mo)}),Cl.forEach(Po=>{const Mo=String((Po==null?void 0:Po.type)||(Po==null?void 0:Po.name)||"").toLowerCase(),$i=String((Po==null?void 0:Po.name)||(Po==null?void 0:Po.type)||"").replace(/\s+/g,"_").toLowerCase();if(Iw.includes(Mo)||Mo&&ee.push({level:"error",message:`Unsupported calc type "${Po==null?void 0:Po.type}"`,hint:`Use one of: ${Array.from(Iw).join(", ")}`}),Mo==="ema"){const Zr=Po==null?void 0:Po.period;(typeof Zr!="number"||!(Zr>0))&&ee.push({level:"error",message:"EMA requires numeric period > 0",hint:'Add "period": e.g., 20'})}if(Mo==="macd"){const Zr=nc=>typeof nc=="number"&&nc>0;(!Zr(Po==null?void 0:Po.fast)||!Zr(Po==null?void 0:Po.slow)||!Zr(Po==null?void 0:Po.signal))&&ee.push({level:"error",message:"MACD requires numeric fast/slow/signal",hint:'Add "fast":12, "slow":26, "signal":9'})}if(Mo==="stoch"){const Zr=nc=>typeof nc=="number"&&nc>0;(!Zr(Po==null?void 0:Po.kPeriod)||!Zr(Po==null?void 0:Po.dPeriod))&&ee.push({level:"error",message:"Stochastic requires kPeriod and dPeriod",hint:'Add "kPeriod":14, "dPeriod":3'})}$i&&(Mo==="bbands"||Mo==="bollinger"||Mo==="bollinger_bands"||Mo==="kc"||Mo==="keltner"||Mo==="donchian"||Mo==="linreg_channel"?(gc.add(`${$i}_mid`),gc.add(`${$i}_upper`),gc.add(`${$i}_lower`)):Mo==="atr_bands"?(gc.add(`${$i}_upper`),gc.add(`${$i}_lower`)):Mo==="macd"?(gc.add("macd_line"),gc.add("macd_signal"),gc.add("macd_hist")):Mo==="stoch"?(gc.add(`${$i}_k`),gc.add(`${$i}_d`)):Mo==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"].forEach(Zr=>gc.add(Zr)):gc.add($i))}),yl.forEach((Po,Mo)=>{(Po.plots||[]).forEach(($i,Zr)=>{const nc=String(($i==null?void 0:$i.type)||"line").toLowerCase();Pw.includes(nc)||ee.push({level:"warning",message:`Pane[${Mo}] plot[${Zr}] unsupported type "${$i==null?void 0:$i.type}"`,hint:`Supported: ${Array.from(Pw).join(", ")}`});const Hu=String(($i==null?void 0:$i.source)||"").replace(/\s+/g,"_").toLowerCase();Hu&&!gc.has(Hu)&&ee.push({level:"error",message:`Pane[${Mo}] plot[${Zr}] source "${$i==null?void 0:$i.source}" not defined`,hint:"Define it in calc/series or use a valid alias."})}),(Po.labels||[]).forEach(($i,Zr)=>{const nc=String(($i==null?void 0:$i.shape)||"label");nc&&!Mw.includes(nc)&&ee.push({level:"warning",message:`Pane[${Mo}] label[${Zr}] unsupported shape "${nc}"`,hint:`Supported: ${Array.from(Mw).join(", ")}`}),$i!=null&&$i.shape||ee.push({level:"warning",message:`Pane[${Mo}] label[${Zr}] no shape set (default: label)`,hint:'Set "shape": triangle_up_filled, triangle_down_filled, label, pill, tag, flag'});const Hu=String(($i==null?void 0:$i.source)||"").replace(/\s+/g,"_").toLowerCase();Hu&&!["open","high","low","close","volume"].includes(Hu)&&!gc.has(Hu)&&ee.push({level:"error",message:`Pane[${Mo}] label[${Zr}] source "${$i==null?void 0:$i.source}" not defined`,hint:"Use high/low/open/close or a defined series"}),String((Po==null?void 0:Po.pane)||"main").toLowerCase()==="sub"&&(Hu==="high"||Hu==="low")&&ee.push({level:"warning",message:`Pane[${Mo}] label[${Zr}] anchors to price in sub pane`,hint:"Move label to main pane for price anchors"});const ld=String(($i==null?void 0:$i.whenExpr)||""),mp=String(($i==null?void 0:$i.when)||"");if(ld.trim())try{const Tc=Lp(Ze(ld));Ae(Tc).forEach(vu=>{const Qi=vu.replace(/\s+/g,"_").toLowerCase();!gc.has(Qi)&&!["open","high","low","close","volume"].includes(Qi)&&ee.push({level:"warning",message:`Label[${Mo}:${Zr}] references unknown series "${vu}"`,hint:"Define via calc/series or use a base series (open/high/low/close/volume)."})})}catch(Tc){const Hp=(Tc==null?void 0:Tc.position)!=null?` at ${Tc.position}`:"",vu=Tc instanceof Zv?Tc.message:String(Tc),Qi=typeof(Tc==null?void 0:Tc.position)=="number"?Un(He,Tc.position):void 0;ee.push({level:"error",message:`Label[${Mo}:${Zr}] Pine expression parse failed${Hp}: ${vu}`,hint:"Use parentheses to disambiguate comparisons; split chained comparisons with and/or.",line:Qi==null?void 0:Qi.line,col:Qi==null?void 0:Qi.col})}else if(mp.trim())try{const Tc=Lp(Ze(mp));Ae(Tc).forEach(vu=>{const Qi=vu.replace(/\s+/g,"_").toLowerCase();!gc.has(Qi)&&!["open","high","low","close","volume"].includes(Qi)&&ee.push({level:"warning",message:`Label[${Mo}:${Zr}] references unknown series "${vu}"`,hint:"Define via calc/series or use a base series (open/high/low/close/volume)."})})}catch(Tc){const Hp=(Tc==null?void 0:Tc.position)!=null?` at ${Tc.position}`:"",vu=Tc instanceof Zv?Tc.message:String(Tc),Qi=typeof(Tc==null?void 0:Tc.position)=="number"?Un(He,Tc.position):void 0;ee.push({level:"error",message:`Label[${Mo}:${Zr}] condition parse failed${Hp}: ${vu}`,hint:"Use parentheses to disambiguate comparisons; split chained comparisons with and/or.",line:Qi==null?void 0:Qi.line,col:Qi==null?void 0:Qi.col})}})});const wd=new Set;yl.forEach(Po=>{(Po.plots||[]).forEach(Mo=>{const $i=String((Mo==null?void 0:Mo.source)||"").replace(/\s+/g,"_").toLowerCase();$i&&wd.add($i)}),(Po.labels||[]).forEach(Mo=>{const $i=String((Mo==null?void 0:Mo.source)||"").replace(/\s+/g,"_").toLowerCase();$i&&wd.add($i);const Zr=String((Mo==null?void 0:Mo.whenExpr)||""),nc=String((Mo==null?void 0:Mo.when)||"");try{if(Zr.trim()){const Hu=Lp(Ze(Zr));Ae(Hu).forEach(mp=>wd.add(mp.replace(/\s+/g,"_").toLowerCase()))}else if(nc.trim()){const Hu=Lp(Ze(nc));Ae(Hu).forEach(mp=>wd.add(mp.replace(/\s+/g,"_").toLowerCase()))}}catch{}}),(Po.lines||[]).forEach(Mo=>{const $i=String((Mo==null?void 0:Mo.segmentsFrom)||"").replace(/\s+/g,"_").toLowerCase();$i&&wd.add($i);const Zr=String((Mo==null?void 0:Mo.start)||"").replace(/\s+/g,"_").toLowerCase();Zr&&wd.add(Zr);const nc=String((Mo==null?void 0:Mo.end)||"").replace(/\s+/g,"_").toLowerCase();nc&&wd.add(nc)})}),(Array.isArray(Os.signals)?Os.signals:[]).forEach(Po=>{const Mo=String((Po==null?void 0:Po.whenExpr)||""),$i=String((Po==null?void 0:Po.when)||"");try{if(Mo.trim()){const Zr=Lp(Ze(Mo));Ae(Zr).forEach(Hu=>wd.add(Hu.replace(/\s+/g,"_").toLowerCase()))}else if($i.trim()){const Zr=Lp(Ze($i));Ae(Zr).forEach(Hu=>wd.add(Hu.replace(/\s+/g,"_").toLowerCase()))}}catch{}});const $u=Rl.map(Po=>String((Po==null?void 0:Po.expr)||"")).join(" ").replace(/\s+/g," ").toLowerCase(),Jd=(Po,Mo)=>{const $i=Po.toLowerCase(),Zr=Mo;return $i==="bbands"||$i==="bollinger"||$i==="bollinger_bands"||$i==="kc"||$i==="keltner"||$i==="donchian"||$i==="linreg_channel"?[`${Zr}_mid`,`${Zr}_upper`,`${Zr}_lower`]:$i==="atr_bands"?[`${Zr}_upper`,`${Zr}_lower`]:$i==="stoch"?[`${Zr}_k`,`${Zr}_d`]:$i==="macd"?["macd_line","macd_signal","macd_hist"]:$i==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"]:[Zr]};return Cl.forEach(Po=>{const Mo=String((Po==null?void 0:Po.name)||(Po==null?void 0:Po.type)||"").replace(/\s+/g,"_").toLowerCase();if(Mo&&!wd.has(Mo)){const $i=String((Po==null?void 0:Po.type)||""),Zr=Jd($i,Mo);if(!Zr.some(Hu=>wd.has(Hu))){const Hu=$u&&new RegExp(`\\b${Mo.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")}\\b`,"i").test($u),ld=$u&&Zr.some(mp=>new RegExp(`\\b${mp.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")}\\b`,"i").test($u));if(Hu||ld)return;ee.push({level:"warning",message:`Calc "${$i}" (${Mo}) is defined but not used`,hint:"Reference it in plots or label conditions"})}}}),rt(ee)}}catch{ee.push({level:"warning",message:"Non‑JSON script detected",hint:"Use JSON spec or the DSL examples from Guide. If JSON, ensure valid commas/quotes/braces.",line:1,col:1})}return rt(ee)}let dn=ge(V([]));Fr(()=>{const ee=String(t()||"");r(),a(),i(Hi),i(qi),i(Wr);let de=!1,He=null;const rt=()=>{de||ee===String(t()||"")&&x(dn,V(ht()))},Qt=setTimeout(()=>{const Lt=typeof window<"u"?window==null?void 0:window.requestIdleCallback:void 0;Lt?He=Lt(rt,{timeout:250}):rt()},140);return()=>{de=!0,clearTimeout(Qt);const Lt=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;Lt&&He!=null&&Lt(He)}});const Ut=Bt(()=>i(dn).filter(ee=>ee.level==="error").length),Xn=Bt(()=>i(dn).filter(ee=>ee.level==="warning").length),rs=Bt(()=>i(dn).length),_t=Bt(()=>i(Ut)>0?"Errors":i(Xn)>0?"Warnings":"Issues"),Gt=Bt(()=>r()?`Error: ${r()}`:f()?"Running…":o()?o():"Ready"),en=Bt(()=>{const ee=String(t()||"");if(!/security_lower_tf/i.test(ee))return null;const de=String(r()||""),He=String(o()||"");return de&&/(lower_tf|lower timeframe)/i.test(de)?{kind:"error",label:"Lower TF",title:"Lower TF not available",lines:["Lower TF must be smaller than the chart timeframe.","Switch chart timeframe higher or lower the requested TF.","Lower TF needs server data; wait if loading."]}:de&&/request\.security/i.test(de)?{kind:"warning",label:"Lower TF",title:"Lower TF data not ready",lines:["Lower TF data may be missing for this range.","Zoom to recent data or wait for fetch to finish."]}:/loading request\.security/i.test(He)?{kind:"info",label:"Lower TF",title:"Lower TF data loading",lines:["Lower TF candles are loading from the server.","The chart will refresh when data arrives."]}:null}),cs=Bt(()=>{const ee=typeof i(en)=="function"?i(en)():i(en);if(!ee)return"";const de=ee.title||"Lower TF",He=Array.isArray(ee.lines)?ee.lines:[];return[de,...He].join(`
`)}),ps=(ee,de=2)=>Number.isFinite(ee)?ee.toFixed(de):"—",vo=(ee,de=2,He=8)=>{if(!Number.isFinite(ee))return"—";const rt=Math.abs(ee);if(rt===0||rt>=1)return ee.toFixed(de);const Qt=Math.ceil(-Math.log10(rt)),Lt=Math.max(de,Math.min(He,de+Qt));return ee.toFixed(Lt)},Ko=ee=>vo(ee,2,6),ho=ee=>vo(ee,2,10),wa=ee=>vo(ee,6,10),di=(ee,de=2)=>{const He=typeof ee=="number"?ee:Number(ee);return Number.isFinite(He)?ps(He,de):"—"},Mi=ee=>{const de=typeof ee=="number"?ee:Number(ee);return Number.isFinite(de)?Ko(de):"—"},Kr=ee=>{const de=typeof ee=="number"?ee:Number(ee);return Number.isFinite(de)?ho(de):"—"},hr=ee=>{const de=typeof ee=="number"?ee:Number(ee);return Number.isFinite(de)?wa(de):"—"},sl=ee=>{const de=typeof ee=="number"?ee:Number(ee);return Number.isFinite(de)?fo(de):"—"},fo=ee=>`${ps(ee,2)}%`,wu=ee=>ee===1/0?"∞":ps(ee,2),_l=ee=>{const de=String(ee||"").replace(/_/g," ").trim();return de?de.charAt(0).toUpperCase()+de.slice(1):"—"},Xl=ee=>{const de=String(ee||"").toLowerCase();return de?de==="stop_limit"?"Stop-limit":de==="trailing_stop"?"Trailing stop":de==="mit"?"MIT":de==="lit"?"LIT":de==="market"?"Market":de==="limit"?"Limit":de==="stop"?"Stop":_l(de):"—"},rc=Bt(()=>i(dn).filter(ee=>typeof ee.line=="number").map(ee=>({line:ee.line,col:ee.col,level:ee.level}))),Qc=Bt(()=>{if(i(In)!=="failed")return"";const ee=String(t()||"").split(`
`),de=new Map;i(rc).forEach(rt=>{de.has(rt.line)||de.set(rt.line,[]),de.get(rt.line).push({col:rt.col,level:rt.level})});const He=rt=>rt.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return ee.map((rt,Qt)=>{const Lt=Qt+1,_n=de.get(Lt)||[],Vn=_n.some(Xo=>!Xo.col),Zn=He(rt||" ");if(Vn)return`<div class="code-line"><mark class="err err-${_n[0].level}">${Zn}</mark></div>`;if(!_n.length)return`<div class="code-line"><span>${Zn}</span></div>`;const Js=_n.filter(Xo=>typeof Xo.col=="number"&&Xo.col>0).sort((Xo,Ei)=>Xo.col-Ei.col);let $o="",Os=0;return Js.forEach((Xo,Ei)=>{const ao=Math.max(0,Xo.col-1);ao>Os&&($o+=He(rt.slice(Os,ao))),$o+=`<mark class="err err-${Xo.level}">${He(rt.slice(ao))||"&nbsp;"}</mark>`,Os=rt.length}),Os<rt.length&&($o+=He(rt.slice(Os))),`<div class="code-line"><span>${$o||"&nbsp;"}</span></div>`}).join("")});let na=ge(void 0),Nc=ge(void 0),Ea=ge(void 0),Nd=ge(void 0),In=ge("idle"),St=null,Rn=null,Cn=null,Ts=[],Fs=!1,Es=!1,Co=null,li=null,ro=0,zo=ge("plaintext");const io=Bt(()=>i(In)==="ready"),Ji={indicator:"Creates an indicator script.",strategy:"Creates a strategy script with backtest settings.",library:"Marks this script as a reusable library.",import:"Import a local library by name.",plot:"Plot a series on chart.",plotcandle:"Plot custom candles from OHLC series.",plotbar:"Plot OHLC bars from series.",plotohlc:"Plot OHLC bars from series.",plotarrow:"Plot up/down arrows from a series.",plotfill:"Fill between two plots.",fill:"Fill between two series.",plotshape:"Plot a shape on chart.",plotchar:"Plot a character on chart.",hline:"Draw a horizontal line.",input:"Create a user input.","input.int":"Integer input.","input.float":"Float input.","input.bool":"Boolean input.","input.string":"String input.","request.security":"Fetch HTF/MTF series.","request.security_lower_tf":"Fetch lower timeframe series.","strategy.entry":"Place an entry order.","strategy.exit":"Place an exit order.","strategy.order":"Place a generic order.",alertcondition:"Emit an alert when condition is true.",barstate:"Bar state flags (islast, isnewbar, isrealtime).",timeframe:"Chart timeframe helpers.",syminfo:"Symbol metadata (ticker, type, etc.)."},Hl={uri:"scriptstudio://schema/script.json",fileMatch:["*"],schema:{type:"object",description:"Script Studio JSON spec",properties:{pane:{type:"string",description:'Default pane ("main" or "sub")'},min:{type:"number"},max:{type:"number"},params:{type:"object",description:"Named params (input values)"},strategy:{type:"object",properties:{initialCapital:{type:"number"},orderSize:{type:"object"},commissionPct:{type:"number"},slippagePct:{type:"number"},execution:{type:"string"},allowShort:{type:"boolean"},pyramiding:{type:"number"}}},calc:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"},source:{type:"string"},period:{type:"number"},fast:{type:"number"},slow:{type:"number"},signal:{type:"number"},expr:{type:"string"},timeframe:{type:"string"},symbol:{type:"string"},country:{type:"string"},lookahead:{type:"string"},gaps:{type:"string"}}}},series:{type:"array",items:{type:"object",properties:{name:{type:"string"},expr:{type:"string"}}}},rules:{type:"array",items:{type:"object",properties:{type:{type:"string",enum:["series","state"]},name:{type:"string"},series:{type:"string"},state:{type:"string"},when:{type:"string"},whenExpr:{type:"string"},then:{type:"string"},value:{type:"string"},expr:{type:"string"},else:{type:"string"},init:{type:"string"},selfMode:{type:"string",enum:["prev","current"]}}}},stateSeries:{type:"array",items:{type:"object",properties:{name:{type:"string"},initExpr:{type:"string"},updateExpr:{type:"string"},selfMode:{type:"string",enum:["prev","current"]}}}},plots:{type:"array",items:{type:"object",properties:{name:{type:"string"},source:{type:"string"},type:{type:"string"},color:{type:"string"},width:{type:"number"},style:{type:"string"},offset:{type:["number","string"]},showLast:{type:["number","string"]},open:{type:"string"},high:{type:"string"},low:{type:"string"},close:{type:"string"},downColor:{type:"string"},wickColor:{type:"string"},borderColor:{type:"string"}}}},labels:{type:"array",items:{type:"object",properties:{when:{type:"string"},whenExpr:{type:"string"},text:{type:"string"},textExpr:{type:"string"},shape:{type:"string"},color:{type:"string"},colorExpr:{type:"string"},position:{type:"string"},source:{type:"string"},bgColor:{type:"string"},bgColorExpr:{type:"string"},borderColor:{type:"string"},borderColorExpr:{type:"string"},textColor:{type:"string"},textColorExpr:{type:"string"},size:{type:"number"},sizeExpr:{type:"string"},offsetY:{type:"number"},offsetYExpr:{type:"string"}}}},lines:{type:"array",items:{type:"object",properties:{name:{type:"string"},start:{type:"string"},end:{type:"string"},color:{type:"string"},colorExpr:{type:"string"},width:{type:"number"},widthExpr:{type:"string"},sizeExpr:{type:"string"},style:{type:"string"},extend:{type:"string"},segmentsFrom:{type:"string"},maxSegments:{type:"number"}}}},signals:{type:"array",items:{type:"object",properties:{id:{type:"string"},type:{type:"string"},when:{type:"string"},whenExpr:{type:"string"},score:{type:"number",minimum:0,maximum:10,multipleOf:1},scoreExpr:{type:"string"},cooldownBars:{type:"number"},cooldownExpr:{type:"string"},order:{type:"object"}}}},panes:{type:"array",items:{type:"object",properties:{pane:{type:"string"},plots:{$ref:"#/properties/plots"},labels:{$ref:"#/properties/labels"},levels:{type:"array"},lines:{$ref:"#/properties/lines"},min:{type:"number"},max:{type:"number"}}}},main:{$ref:"#/properties/panes/items"},sub:{$ref:"#/properties/panes/items"}}}},Vc=ee=>{const de=(Qt,Lt,_n)=>({label:Qt,kind:ee.languages.CompletionItemKind.Function,insertText:Qt,insertTextRules:void 0,detail:Lt}),He=Qt=>({label:Qt,kind:ee.languages.CompletionItemKind.Keyword,insertText:Qt,detail:"keyword"}),rt=(Qt,Lt,_n)=>({label:Qt,kind:ee.languages.CompletionItemKind.Snippet,insertText:Lt,insertTextRules:ee.languages.CompletionItemInsertTextRule.InsertAsSnippet,detail:_n});return[He("if"),He("else"),He("for"),He("while"),He("switch"),He("break"),He("continue"),He("return"),He("var"),He("varip"),He("export"),He("import"),He("library"),rt("indicator",'indicator("${1:Title}", overlay=${2:true})',"indicator(...)"),rt("strategy",'strategy(initial_capital=${1:10000}, execution="bar_close", allowShort=${2:false})',"strategy(...)"),rt("input.int",'input.int(${1:14}, title="${2:Length}")',"input.int(...)"),rt("input.float",'input.float(${1:14.0}, title="${2:Length}")',"input.float(...)"),rt("input.bool",'input.bool(${1:true}, title="${2:Enabled}")',"input.bool(...)"),rt("input.string",'input.string("${1:Value}", title="${2:Title}")',"input.string(...)"),de("plot","plot(series)"),de("plotcandle","plotcandle(open, high, low, close)"),de("plotbar","plotbar(open, high, low, close)"),de("plotohlc","plotohlc(open, high, low, close)"),de("plotarrow","plotarrow(series)"),de("plotfill","plotfill(plotA, plotB, color)"),de("fill","fill(seriesA, seriesB, color)"),de("plotshape","plotshape(condition)"),de("plotchar","plotchar(condition)"),de("hline","hline(price)"),de("line.new","line.new(x1, y1, x2, y2)"),de("label.new","label.new(x, y, text)"),de("box.new","box.new(left, top, right, bottom)"),de("table.new","table.new(position, columns, rows)"),de("table.cell","table.cell(table_id, column, row, text)"),de("table.clear","table.clear(table_id)"),de("request.security","request.security(symbol, timeframe, expr)"),de("request.security_lower_tf","request.security_lower_tf(symbol, timeframe, expr)"),de("strategy.entry","strategy.entry(id, side)"),de("strategy.exit","strategy.exit(id, side)"),de("strategy.order","strategy.order(id, side)"),de("strategy.cancel","strategy.cancel(id)"),de("strategy.close","strategy.close(id)"),de("alertcondition","alertcondition(condition, title, message)"),de("ema","ema(source, length)"),de("sma","sma(source, length)"),de("rsi","rsi(source, length)"),de("macd","macd(source, fast, slow, signal)"),de("highest","highest(source, length)"),de("lowest","lowest(source, length)"),de("atr","atr(high, low, close, length)"),de("stoch","stoch(high, low, close, kPeriod, dPeriod)"),de("array.new_float","array.new_float(size, initial)"),de("array.new_string","array.new_string(size, initial)"),de("array.from","array.from(val1, val2, val3)"),de("array.get","array.get(arr, index)"),de("array.set","array.set(arr, index, value)"),de("array.push","array.push(arr, value)"),de("array.pop","array.pop(arr)"),de("array.size","array.size(arr)")]},ol=ee=>{ee.languages.getLanguages().some(de=>de.id==="pine")||(ee.languages.register({id:"pine"}),ee.languages.setLanguageConfiguration("pine",{comments:{lineComment:"//"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:'"',close:'"'},{open:"'",close:"'"},{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"}],surroundingPairs:[{open:'"',close:'"'},{open:"'",close:"'"},{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"}]}),ee.languages.setMonarchTokensProvider("pine",{keywords:["if","else","for","while","switch","break","continue","return","var","varip","export","import","library","strategy","indicator","study"],types:["int","float","bool","string","line","label","box","table","linefill","color"],tokenizer:{root:[[/\/\/.*$/,"comment"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/\b(true|false|na)\b/,"constant"],[/\b\d+(\.\d+)?\b/,"number"],[/[{}()[\]]/,"@brackets"],[/[=><!~?:&|+\-*\/%^]/,"operator"],[/[A-Za-z_][A-Za-z0-9_]*/,{cases:{"@keywords":"keyword","@types":"type","@default":"identifier"}}]],string_double:[[/[^\\"]+/,"string"],[/\\./,"string.escape"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/\\./,"string.escape"],[/'/,"string","@pop"]]}}),ee.languages.registerCompletionItemProvider("pine",{triggerCharacters:[".","("],provideCompletionItems:(de,He)=>{const rt=de.getWordUntilPosition(He),Qt=new ee.Range(He.lineNumber,rt.startColumn,He.lineNumber,rt.endColumn);return{suggestions:Vc(ee).map(_n=>({..._n,range:Qt}))}}}),ee.languages.registerHoverProvider("pine",{provideHover(de,He){const rt=de.getWordAtPosition(He);if(!rt)return null;const Qt=rt.word,Lt=Ji[Qt]||Ji[Qt.toLowerCase()];return Lt?{range:new ee.Range(He.lineNumber,rt.startColumn,He.lineNumber,rt.endColumn),contents:[{value:`**${Qt}**`},{value:Lt}]}:null}}))},Ac=ee=>{var de,He;(He=(de=ee.languages)==null?void 0:de.json)!=null&&He.jsonDefaults&&ee.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemas:[Hl]})},br=ee=>{ee.editor.getTheme&&ee.editor._scriptStudioThemes||(ee.editor.defineTheme("scriptstudio-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#0b0a1a","editor.foreground":"#e2e8f0","editorLineNumber.foreground":"#475569","editorLineNumber.activeForeground":"#94a3b8","editor.selectionBackground":"#1f2a44","editor.inactiveSelectionBackground":"#1b2338","editorCursor.foreground":"#94a3b8"}}),ee.editor.defineTheme("scriptstudio-light",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#f8fafc","editor.foreground":"#0f172a","editorLineNumber.foreground":"#94a3b8","editorLineNumber.activeForeground":"#334155","editor.selectionBackground":"#dbeafe","editor.inactiveSelectionBackground":"#e2e8f0","editorCursor.foreground":"#1e293b"}}),ee.editor._scriptStudioThemes=!0)},fa=ee=>i(Hi)==="json"?"json":i(Hi)==="dsl"?"plaintext":i(Hi)==="pine"?"pine":i(Hi)==="js"?"javascript":/^\s*\/\/@\s*(?:pine|version)\b/m.test(ee)||/\b(strategy|indicator|library|plot)\s*\(/m.test(ee)||/\b(plotshape|plotchar|hline|table|line|label|box|alertcondition)\b/i.test(ee)||/\b(request\.security(?:_lower_tf)?|input\.)\b/i.test(ee)?"pine":si(ee)?"json":"plaintext",Dl=()=>(document.documentElement.getAttribute("data-theme")||document.body.getAttribute("data-theme"))==="light"?"scriptstudio-light":"scriptstudio-dark",Fu=()=>{if(!St||!Cn)return;const ee=[],de=(He,rt,Qt,Lt,_n)=>{const Vn=Math.max(1,Math.min(Cn.getLineCount(),Qt||1)),Zn=Math.max(1,Lt||1),Js=Cn.getLineContent(Vn)||"",$o=Math.max(Zn+1,Js.length+1);ee.push({startLineNumber:Vn,startColumn:Zn,endLineNumber:Vn,endColumn:$o,message:_n?`${rt} • ${_n}`:rt,severity:He==="error"?St.MarkerSeverity.Error:St.MarkerSeverity.Warning})};i(dn).forEach(He=>de(He.level,He.message,He.line,He.col,He.hint)),i(cl).forEach(He=>de("warning",He.message,He.line,1)),St.editor.setModelMarkers(Cn,"scriptstudio",ee)};function Xr(){var He,rt;const ee=((He=i(na))==null?void 0:He.scrollTop)??0,de=((rt=i(na))==null?void 0:rt.scrollLeft)??0;i(Nc)&&(i(Nc).scrollTop=ee,i(Nc).scrollLeft=de),i(Ea)&&(i(Ea).scrollTop=ee)}function cr(ee){const de=ee.toLowerCase();return de.includes("no panes defined")?'Add pane:"main" or {main:{...}} with plots/labels.':de.includes("has no plots/labels/levels/lines")?"Add at least one plot or label in the pane.":de.includes("series")?"Check series names and expressions; use normalized aliases like macd_line.":"Review field names/types; see Guide examples."}Fr(()=>{if(!St||!Cn||!i(io)||Fs)return;s();const ee=String(t()||"");Cn.getValue()!==ee&&(Es=!0,Cn.setValue(ee),Es=!1)}),Fr(()=>{if(!St||!Rn||!i(io)||s()<=0)return;const ee=String(t()||""),de=fa(ee),He=Rn.getModel();if(He){Cn=He,He.setValue(ee),i(zo)!==de&&(x(zo,V(de)),St.editor.setModelLanguage(He,de));try{Rn.updateOptions({wordWrap:de==="pine"?"off":"on"})}catch{}Fu(),requestAnimationFrame(()=>Rn==null?void 0:Rn.layout())}}),Fr(()=>{if(!St||!Cn||!i(io))return;const ee=fa(String(t()||""));if(ee!==i(zo)){x(zo,V(ee)),St.editor.setModelLanguage(Cn,ee);try{Rn==null||Rn.updateOptions({wordWrap:ee==="pine"?"off":"on"})}catch{}}}),Fr(()=>{!St||!Cn||!i(io)||Fu()}),Fr(()=>{!Rn||!i(io)||i(ve)==="editor"&&requestAnimationFrame(()=>Rn==null?void 0:Rn.layout())}),Fr(()=>{!Rn||!i(io)||(i(mr).length,requestAnimationFrame(()=>Rn==null?void 0:Rn.layout()))}),a_();var us=Use(),ko=y(us);ko.__pointerdown=[AQ];var ur=v(y(ko),2),Pr=y(ur),kr=y(Pr);kr.__click=[TQ,ve];var Sr=v(kr,2);Sr.__click=[FQ,ve];var Lu=y(Sr),iu=y(Lu,!0);_(Lu);var bd=v(Lu,2);Ue(bd,()=>i(rs),ee=>{var de=LQ(),He=y(de,!0);_(de),Ce(()=>{pi(de,`err-badge ${(i(Ut)===0&&i(Xn)>0?"warn":"")??""} svelte-1ehcy4i`),tt(He,i(rs))}),q(ee,de)}),_(Sr);var Or=v(Sr,2);Or.__click=[EQ,ve],_(Pr);var pc=v(Pr,2),Wc=v(y(pc),2);Wc.__click=[$Q];var Od=y(Wc);Od.value=(Od.__value="auto")==null?"":"auto";var Zu=v(Od);Zu.value=(Zu.__value="json")==null?"":"json";var ff=v(Zu);ff.value=(ff.__value="pine")==null?"":"pine";var xd=v(ff);xd.value=(xd.__value="dsl")==null?"":"dsl";var Wf=v(xd);Wf.value=(Wf.__value="js")==null?"":"js",_(Wc),_(pc),_(ur);var Ui=v(ur,2),om=y(Ui);Ue(om,()=>!i(Re),ee=>{var de=jQ(),He=y(de);He.__click=[DQ,Ct];var rt=v(He,2);rt.__click=[RQ,Ct],_(de),Ce(()=>{wr(He,"active",d()==="main"),wr(rt,"active",d()==="sub")}),q(ee,de)});var Ef=v(om,2);Ef.__click=[bQ,It,m];var it=v(y(Ef),2),gv=y(it);_(it),_(Ef);var Nv=v(Ef,2);Nv.__click=[vQ,m];var Ep=v(Nv,2);Ep.__click=[gQ];var ku=v(Ep,2);ku.__click=[_Q,M,oe];var Rm=v(ku,2);Rm.__click=[mQ,Pe];var Wg=v(Rm,2);Wg.__click=[pQ,m];var Sg=v(Wg,2);Sg.__click=g;var Av=v(y(Sg),2),Wp=y(Av,!0);_(Av),_(Sg);var Eu=v(Sg,2);Ue(Eu,()=>!i(qn),ee=>{var de=BQ();de.__click=[PQ,qn,m],q(ee,de)},ee=>{var de=OQ();de.__click=Li,q(ee,de)});var av=v(Eu,2);av.__click=[hQ,qn,m],_(Ui),_(ko);var jm=v(ko,2),ng=y(jm),im=y(ng),xf=y(im),Bm=y(xf),Om=v(y(Bm),2),Lh=y(Om);_(Om);var Gh=v(Om,2),fh=y(Gh);_(Gh),_(Bm),Zi(2),_(xf);var Tv=v(xf,2),w0=y(Tv);Ue(w0,()=>i(In)!=="failed",ee=>{var de=VQ(),He=y(de);Ue(He,()=>i(In)!=="ready",rt=>{var Qt=zQ();q(rt,Qt)}),_(de),tp(de,rt=>x(Nd,rt),()=>i(Nd)),q(ee,de)},ee=>{var de=HQ(),He=fn(de);Yo(He,21,()=>i(sn),Ii,(Zn,Js,$o)=>{var Os=WQ();Os.textContent=$o+1,q(Zn,Os)}),_(He),tp(He,Zn=>x(Ea,Zn),()=>i(Ea));var rt=v(He,2),Qt=y(rt),Lt=y(Qt),_n=y(Lt);zC(_n,()=>i(Qc)),_(Lt),Zi(2),_(Qt),tp(Qt,Zn=>x(Nc,Zn),()=>i(Nc));var Vn=v(Qt,2);hC(Vn),Vn.__input=Xr,tp(Vn,Zn=>x(na,Zn),()=>i(na)),_(rt),vd("scroll",Vn,Xr),Bs(Vn,t),q(ee,de)}),_(Tv),_(im);var Cg=v(im,2);Ue(Cg,()=>i(mr).length,ee=>{var de=aee(),He=y(de),rt=v(y(He),4);Ue(rt,()=>i(cl).length,Lt=>{var _n=UQ();Yo(_n,21,()=>i(cl).slice(0,3),Vn=>Vn.message,(Vn,Zn)=>{var Js=qQ(),$o=y(Js);_(Js),Ce(()=>tt($o,`Line ${i(Zn).line??""}: ${i(Zn).message??""}`)),q(Vn,Js)}),_(_n),q(Lt,_n)});var Qt=v(rt,2);Yo(Qt,21,()=>i(mr),Lt=>Lt.name,(Lt,_n)=>{var Vn=ree(),Zn=y(Vn),Js=y(Zn),$o=y(Js,!0);_(Js);var Os=v(Js,2),Xo=y(Os,!0);_(Os),_(Zn);var Ei=v(Zn,2),ao=y(Ei);Ue(ao,()=>i(_n).type==="bool",za=>{var $a=YQ(),yl=y($a);xn(yl),Ce(()=>Mv(yl,!!i(Sl)[i(_n).name])),yl.__change=[GQ,Ba,_n],Zi(2),_($a),q(za,$a)},za=>{var $a=Qn(),yl=fn($a);Ue(yl,()=>i(_n).type==="string"||i(_n).type==="session"||i(_n).type==="symbol",Cl=>{var Rl=XQ();xn(Rl),Ce(()=>Gf(Rl,String(i(Sl)[i(_n).name]??""))),Rl.__input=[KQ,Ba,_n],q(Cl,Rl)},Cl=>{var Rl=Qn(),tc=fn(Rl);Ue(tc,()=>i(_n).type==="time",Ad=>{var gc=JQ();xn(gc),Ce(()=>Gf(gc,gt(i(Sl)[i(_n).name]??i(_n).defval))),gc.__input=[ZQ,Ft,Ba,_n],q(Ad,gc)},Ad=>{var gc=Qn(),wd=fn(gc);Ue(wd,()=>i(_n).type==="source",Xp=>{var $u=tee(),Jd=y($u);xn(Jd),Ce(()=>Gf(Jd,String(i(Sl)[i(_n).name]??i(_n).defval??"close"))),Jd.__input=[QQ,Ba,_n];var Po=v(Jd,2);Yo(Po,21,()=>Qe,Ii,(Mo,$i)=>{var Zr=eee(),nc={};Ce(()=>{nc!==(nc=i($i))&&(Zr.value=(Zr.__value=i($i))==null?"":i($i))}),q(Mo,Zr)}),_(Po),_($u),Ce(()=>{Ot(Jd,"list",`source-options-${i(_n).name}`),Ot(Po,"id",`source-options-${i(_n).name}`)}),q(Xp,$u)},Xp=>{var $u=Qn(),Jd=fn($u);Ue(Jd,()=>i(_n).type==="color",Po=>{var Mo=see();xn(Mo),Ce(()=>Gf(Mo,ot(i(Sl)[i(_n).name]??i(_n).defval))),Mo.__input=[nee,Ba,_n],q(Po,Mo)},Po=>{var Mo=iee();xn(Mo),Ce(()=>Gf(Mo,Number(i(Sl)[i(_n).name]??i(_n).defval))),Mo.__input=[oee,Ba,_n],Ce(()=>{Ot(Mo,"step",i(_n).step??(i(_n).type==="int"?1:.01)),Ot(Mo,"min",i(_n).minval),Ot(Mo,"max",i(_n).maxval)}),q(Po,Mo)},!0),q(Xp,$u)},!0),q(Ad,gc)},!0),q(Cl,Rl)},!0),q(za,$a)}),_(Ei),_(Vn),Ce(()=>{tt($o,i(_n).title||i(_n).name),tt(Xo,i(_n).name)}),q(Lt,Vn)}),_(Qt),Zi(2),_(He),_(de),q(ee,de)}),_(ng),_(jm);var Fv=v(jm,2);Ue(Fv,()=>i(ve)==="errors",ee=>{var de=pee(),He=y(de);Ue(He,()=>i(dn).length===0,rt=>{var Qt=lee();q(rt,Qt)},rt=>{var Qt=fee(),Lt=fn(Qt),_n=y(Lt),Vn=y(_n);_(_n),Zi(2),_(Lt);var Zn=v(Lt,2);Yo(Zn,21,()=>i(dn),Ii,(Js,$o)=>{var Os=dee(),Xo=v(y(Os),2),Ei=y(Xo);Ue(Ei,()=>i($o).line,$a=>{var yl=cee(),Cl=y(yl),Rl=v(Cl);Ue(Rl,()=>i($o).col,tc=>{var Ad=Y0();Ce(()=>tt(Ad,`· Col ${i($o).col??""}`)),q(tc,Ad)}),Zi(),_(yl),Ce(()=>tt(Cl,`Line ${i($o).line??""}`)),q($a,yl)});var ao=v(Ei);_(Xo);var za=v(Xo,2);Ue(za,()=>i($o).hint,$a=>{var yl=uee(),Cl=y(yl);_(yl),Ce(()=>tt(Cl,`— ${i($o).hint??""}`)),q($a,yl)}),_(Os),Ce(()=>{pi(Os,`${`diag-item ${i($o).level}`??""} svelte-1ehcy4i`),tt(ao,` ${i($o).message??""}`)}),q(Js,Os)}),_(Zn),Ce(()=>tt(Vn,`Errors (${(i(Ut)||0)??""})`)),q(rt,Qt)}),_(de),q(ee,de)},ee=>{var de=Qn(),He=fn(de);Ue(He,()=>i(ve)==="results",rt=>{var Qt=hse(),Lt=y(Qt);Ue(Lt,()=>i(Dt),Vn=>{var Zn=ate();Zn.__click=Xu;var Js=y(Zn);Js.__click=[mee];var $o=y(Js),Os=v(y($o),2),Xo=y(Os),Ei=y(Xo);Ei.__click=[hee,Zt];var ao=v(Ei,2);ao.__click=[vee,Zt],_(Xo);var za=v(Xo,2);za.__click=Xu,_(Os),_($o);var $a=v($o,2),yl=y($a);Ue(yl,()=>i(Zt)==="trades",Cl=>{var Rl=zee(),tc=fn(Rl),Ad=y(tc),gc=y(Ad),wd=v(y(gc)),Xp=y(wd);_(wd),_(gc),Zi(2),_(Ad);var $u=v(Ad,2),Jd=y($u);xn(Jd),Jd.__input=[gee,mu];var Po=v(Jd,2);Po.__click=[_ee,gn];var Mo=y(Po,!0);_(Po);var $i=v(Po,2);Ue($i,()=>i(El).type!=="all",Hu=>{var ld=bee();ld.__click=[yee,Ku],q(Hu,ld)});var Zr=v($i,2);Zr.__click=[U5,ye,Oa,_l,Kr,hr,di,Mi,sl,E],_($u),_(tc);var nc=v(tc,2);Ue(nc,()=>i(fc).length,Hu=>{var ld=Bee(),mp=y(ld),Tc=y(mp),Hp=y(Tc),vu=v(y(Hp)),Qi=y(vu);Qi.__click=[xee,nl];var zm=y(Qi);Ce(()=>tt(zm,`Side ${la("side")??""}`)),_(Qi),_(vu);var sp=v(vu),ym=y(sp);ym.__click=[wee,nl];var vh=y(ym);Ce(()=>tt(vh,`Entry ${la("entryIndex")??""}`)),_(ym),_(sp);var Zp=v(sp),Jp=y(Zp);Jp.__click=[kee,nl];var bm=y(Jp);Ce(()=>tt(bm,`Exit ${la("exitIndex")??""}`)),_(Jp),_(Zp);var Eh=v(Zp),Hf=y(Eh);Hf.__click=[See,nl];var Vm=y(Hf);Ce(()=>tt(Vm,`Qty ${la("qty")??""}`)),_(Hf),_(Eh);var Wm=v(Eh),Yh=y(Wm);Yh.__click=[Cee,nl];var rm=y(Yh);Ce(()=>tt(rm,`Bars ${la("barsHeld")??""}`)),_(Yh),_(Wm);var xm=v(Wm),Hm=y(xm);Hm.__click=[Iee,nl];var hp=y(Hm);Ce(()=>tt(hp,`Net PnL ${la("netPnl")??""}`)),_(Hm),_(xm);var zd=v(xm),lv=y(zd);lv.__click=[Pee,nl];var Lv=y(lv);Ce(()=>tt(Lv,`PnL% ${la("pnlPct")??""}`)),_(lv),_(zd);var qm=v(zd);Ue(qm,()=>i(gn)==="full",Kh=>{var Du=Lee(),$p=fn(Du),_h=y($p);_h.__click=[Mee,nl];var am=y(_h);Ce(()=>tt(am,`Fees ${la("fees")??""}`)),_(_h),_($p);var Um=v($p,2),$f=y(Um);$f.__click=[Nee,nl];var wm=y($f);Ce(()=>tt(wm,`Gross ${la("pnl")??""}`)),_($f),_(Um);var lm=v(Um,2),yh=y(lm);yh.__click=[Aee,nl];var Gm=y(yh);Ce(()=>tt(Gm,`MAE% ${la("maePct")??""}`)),_(yh),_(lm);var Vl=v(lm,2),km=y(Vl);km.__click=[Tee,nl];var Ym=y(km);Ce(()=>tt(Ym,`MFE% ${la("mfePct")??""}`)),_(km),_(Vl);var cm=v(Vl,6),bh=y(cm);bh.__click=[Fee,nl];var cv=y(bh);Ce(()=>tt(cv,`Cum Net ${la("cumNet")??""}`)),_(bh),_(cm),q(Kh,Du)}),_(Hp),_(Tc);var gh=v(Tc);Yo(gh,21,()=>i(fc),Kh=>Kh.id,(Kh,Du)=>{var $p=jee();$p.__click=[Eee,Wd,Du],$p.__keydown=[$ee,Wd,Du];var _h=y($p),am=y(_h);am.__click=[Dee,$l,Du],_(_h);var Um=v(_h),$f=y(Um),wm=y($f,!0);Ce(()=>tt(wm,_l(i(Du).side))),_($f),_(Um);var lm=v(Um),yh=y(lm),Gm=y(yh),Vl=v(y(Gm)),km=y(Vl);_(Vl),_(Gm);var Ym=v(Gm,2),cm=v(y(Ym)),bh=y(cm,!0);_(cm),_(Ym);var cv=v(Ym,2),ig=v(y(cv)),Dp=y(ig,!0);Ce(()=>tt(Dp,Kr(i(Du).entryPrice))),_(ig),_(cv),_(yh),_(lm);var yv=v(lm),op=y(yv),Xh=y(op),Zh=v(y(Xh)),Ev=y(Zh);_(Zh),_(Xh);var kp=v(Xh,2),bp=v(y(kp)),$v=y(bp,!0);_(bp),_(kp);var rg=v(kp,2),Km=v(y(rg)),uv=y(Km,!0);Ce(()=>tt(uv,Kr(i(Du).exitPrice))),_(Km),_(rg),_(op),_(yv);var Jh=v(yv),ag=y(Jh,!0);Ce(()=>tt(ag,hr(i(Du).qty))),_(Jh);var bv=v(Jh),xv=y(bv,!0);Ce(()=>tt(xv,di(i(Du).barsHeld,0))),_(bv);var Rp=v(bv);const lg=Bt(()=>(Number(i(Du).netPnl)>=0?"+":"")??""),Sm=Bt(()=>Mi(i(Du).netPnl)??"");var Dv=y(Rp);Ce(()=>tt(Dv,`${i(lg)}${i(Sm)}`)),_(Rp);var $h=v(Rp),Rv=y($h,!0);Ce(()=>tt(Rv,sl(i(Du).pnlPct))),_($h);var wf=v($h);Ue(wf,()=>i(gn)==="full",sc=>{var ru=Ree(),eu=fn(ru),Dh=y(eu,!0);Ce(()=>tt(Dh,Mi(i(Du).fees))),_(eu);var Xm=v(eu,2);const jv=Bt(()=>(Number(i(Du).pnl)>=0?"+":"")??""),Bv=Bt(()=>Mi(i(Du).pnl)??"");var ip=y(Xm);Ce(()=>tt(ip,`${i(jv)}${i(Bv)}`)),_(Xm);var um=v(Xm,2),dv=y(um,!0);Ce(()=>tt(dv,i(Du).maePct==null?"-":sl(i(Du).maePct))),_(um);var Zm=v(um,2),Rh=y(Zm,!0);Ce(()=>tt(Rh,i(Du).mfePct==null?"-":sl(i(Du).mfePct))),_(Zm);var Cm=v(Zm,2),Ov=y(Cm),jh=y(Ov),zv=v(y(jh)),wv=y(zv,!0);_(zv),_(jh);var xh=v(jh,2),Im=v(y(xh)),Qh=y(Im,!0);_(Im),_(xh),_(Ov),_(Cm);var cg=v(Cm,2),ug=y(cg,!0);_(cg);var Vv=v(cg,2);const dg=Bt(()=>(Number(i(Du).cumNet)>=0?"+":"")??""),fg=Bt(()=>Mi(i(Du).cumNet)??"");var S=y(Vv);Ce(()=>tt(S,`${i(dg)}${i(fg)}`)),_(Vv),Ce(()=>{tt(wv,i(Du).entrySignalId||"-"),tt(Qh,i(Du).exitSignalId||"-"),tt(ug,i(Du).exitReason||"-")}),q(sc,ru)}),_($p),Ce(()=>{wr($p,"selected",i(kd)===i(Du).id),wr($p,"pos",i(Du).netPnl>=0),wr($p,"neg",i(Du).netPnl<0),tt(km,`#${i(Du).entryIndex??""}`),tt(bh,i(Du).entryTimeLabel),tt(Ev,`#${i(Du).exitIndex??""}`),tt($v,i(Du).exitTimeLabel)}),q(Kh,$p)}),_(gh),_(mp),_(ld),Ce(()=>pi(mp,`${`tt-table tt-table-trades ${i(gn)}`??""} svelte-1ehcy4i`)),q(Hu,ld)},Hu=>{var ld=Oee();q(Hu,ld)}),Ce(()=>{tt(Xp,`(${i(Mu).length??""}/${i(Oa).length??""})`),Gf(Jd,i(mu)),tt(Mo,i(gn)==="compact"?"Show details":"Compact view")}),q(Cl,Rl)},Cl=>{var Rl=rte(),tc=fn(Rl),Ad=y(tc),gc=v(y(Ad),2),wd=y(gc),Xp=v(wd);Ue(Xp,()=>i(Oc).length>500,Zr=>{var nc=Y0("• Showing last 500");q(Zr,nc)}),_(gc),Zi(2),_(Ad);var $u=v(Ad,2),Jd=y($u);Jd.__click=[Vee,hn];var Po=y(Jd,!0);_(Jd);var Mo=v(Jd,2);Mo.__click=[G5,ye,Oc,di,hr,Mi,Kr,E],_($u),_(tc);var $i=v(tc,2);Ue($i,()=>i(Oc).length,Zr=>{var nc=ote(),Hu=y(nc),ld=y(Hu),mp=y(ld),Tc=v(y(mp),7);Ue(Tc,()=>i(hn)==="full",vu=>{var Qi=Wee();Zi(4),q(vu,Qi)}),_(mp),_(ld);var Hp=v(ld);Yo(Hp,21,()=>i(Gu),vu=>vu.id,(vu,Qi)=>{var zm=ste(),sp=y(zm),ym=y(sp);ym.__click=[Hee,Nu,Qi],_(sp);var vh=v(sp),Zp=y(vh,!0);_(vh);var Jp=v(vh),bm=y(Jp),Eh=y(bm,!0);_(bm),_(Jp);var Hf=v(Jp),Vm=y(Hf),Wm=y(Vm),Yh=v(y(Wm),2),rm=y(Yh,!0);_(Yh),_(Wm);var xm=v(Wm,2),Hm=v(y(xm),2),hp=y(Hm,!0);_(Hm),_(xm);var zd=v(xm,2),lv=v(y(zd),2),Lv=y(lv,!0);_(lv),_(zd),_(Vm),_(Hf);var qm=v(Hf),gh=y(qm),Kh=y(gh),Du=v(y(Kh)),$p=y(Du);_(Du),_(Kh);var _h=v(Kh,2),am=v(y(_h)),Um=y(am,!0);_(am),_(_h),_(gh),_(qm);var $f=v(qm),wm=y($f),lm=y(wm),yh=v(y(lm)),Gm=y(yh);Ce(()=>tt(Gm,`${di(i(Qi).qtyPct,2)??""}%`)),_(yh),_(lm);var Vl=v(lm,2);Ue(Vl,()=>i(Qi).qty!=null,wf=>{var sc=qee(),ru=v(y(sc)),eu=y(ru,!0);Ce(()=>tt(eu,hr(i(Qi).qty))),_(ru),_(sc),q(wf,sc)});var km=v(Vl,2);Ue(km,()=>i(Qi).cash!=null,wf=>{var sc=Uee(),ru=v(y(sc)),eu=y(ru,!0);Ce(()=>tt(eu,Mi(i(Qi).cash))),_(ru),_(sc),q(wf,sc)});var Ym=v(km,2);Ue(Ym,()=>i(Qi).price!=null,wf=>{var sc=Gee(),ru=v(y(sc)),eu=y(ru,!0);Ce(()=>tt(eu,Kr(i(Qi).price))),_(ru),_(sc),q(wf,sc)});var cm=v(Ym,2);Ue(cm,()=>i(Qi).stopPrice!=null,wf=>{var sc=Yee(),ru=v(y(sc)),eu=y(ru,!0);Ce(()=>tt(eu,Kr(i(Qi).stopPrice))),_(ru),_(sc),q(wf,sc)});var bh=v(cm,2);Ue(bh,()=>i(Qi).limitPrice!=null,wf=>{var sc=Kee(),ru=v(y(sc)),eu=y(ru,!0);Ce(()=>tt(eu,Kr(i(Qi).limitPrice))),_(ru),_(sc),q(wf,sc)});var cv=v(bh,2);Ue(cv,()=>i(Qi).tif,wf=>{var sc=Xee(),ru=v(y(sc)),eu=y(ru,!0);_(ru),_(sc),Ce(()=>tt(eu,i(Qi).tif)),q(wf,sc)});var ig=v(cv,2);Ue(ig,()=>i(Qi).trailPct!=null,wf=>{var sc=Zee(),ru=v(y(sc)),eu=y(ru);Ce(()=>tt(eu,`${di(i(Qi).trailPct,2)??""}%`)),_(ru),_(sc),q(wf,sc)});var Dp=v(ig,2);Ue(Dp,()=>i(Qi).trailOffset!=null,wf=>{var sc=Jee(),ru=v(y(sc)),eu=y(ru,!0);Ce(()=>tt(eu,Kr(i(Qi).trailOffset))),_(ru),_(sc),q(wf,sc)});var yv=v(Dp,2);Ue(yv,()=>i(Qi).trailPrice!=null,wf=>{var sc=Qee(),ru=v(y(sc)),eu=y(ru,!0);Ce(()=>tt(eu,Kr(i(Qi).trailPrice))),_(ru),_(sc),q(wf,sc)}),_(wm),_($f);var op=v($f),Xh=y(op),Zh=y(Xh),Ev=v(y(Zh)),kp=y(Ev,!0);_(Ev),_(Zh);var bp=v(Zh,2),$v=v(y(bp)),rg=y($v,!0);_($v),_(bp);var Km=v(bp,2),uv=v(y(Km)),Jh=y(uv,!0);Ce(()=>tt(Jh,i(Qi).fillQty==null?"-":hr(i(Qi).fillQty))),_(uv),_(Km);var ag=v(Km,2);Ue(ag,()=>i(Qi).remainingQty!=null,wf=>{var sc=ete(),ru=v(y(sc)),eu=y(ru,!0);Ce(()=>tt(eu,hr(i(Qi).remainingQty))),_(ru),_(sc),q(wf,sc)});var bv=v(ag,2);Ue(bv,()=>i(Qi).targetQty!=null,wf=>{var sc=tte(),ru=v(y(sc)),eu=y(ru,!0);Ce(()=>tt(eu,hr(i(Qi).targetQty))),_(ru),_(sc),q(wf,sc)});var xv=v(bv,2),Rp=v(y(xv)),lg=y(Rp,!0);Ce(()=>tt(lg,i(Qi).fillPrice==null?"-":Kr(i(Qi).fillPrice))),_(Rp),_(xv);var Sm=v(xv,2),Dv=v(y(Sm)),$h=y(Dv,!0);Ce(()=>tt($h,i(Qi).fees==null?"-":Mi(i(Qi).fees))),_(Dv),_(Sm),_(Xh),_(op);var Rv=v(op);Ue(Rv,()=>i(hn)==="full",wf=>{var sc=nte(),ru=fn(sc),eu=y(ru),Dh=y(eu),Xm=v(y(Dh)),jv=y(Xm);_(Xm),_(Dh);var Bv=v(Dh,2),ip=v(y(Bv)),um=y(ip,!0);_(ip),_(Bv),_(eu),_(ru);var dv=v(ru,2),Zm=y(dv),Rh=y(Zm),Cm=v(y(Rh)),Ov=y(Cm,!0);_(Cm),_(Rh);var jh=v(Rh,2),zv=v(y(jh)),wv=y(zv,!0);_(zv),_(jh),_(Zm),_(dv);var xh=v(dv,2),Im=y(xh,!0);_(xh),Ce(()=>{tt(jv,`#${i(Qi).activeFromIndex??""}`),tt(um,i(Qi).expiresAtIndex==null?"-":`#${i(Qi).expiresAtIndex}`),tt(Ov,i(Qi).signalId||"-"),tt(wv,i(Qi).ocoGroup||"-"),tt(Im,i(Qi).note||"-")}),q(wf,sc)}),_(zm),Ce(()=>{tt(Zp,i(Qi).id),pi(bm,`${`tt-pill status status-${i(Qi).statusKey}`??""} svelte-1ehcy4i`),tt(Eh,i(Qi).statusLabel),tt(rm,i(Qi).actionLabel),tt(hp,i(Qi).sideLabel),tt(Lv,i(Qi).kindLabel),tt($p,`#${i(Qi).createdIndex??""}`),tt(Um,i(Qi).createdTimeLabel),tt(kp,i(Qi).filledIndex==null?"-":`#${i(Qi).filledIndex}`),tt(rg,i(Qi).filledIndex==null?"-":i(Qi).filledTimeLabel)}),q(vu,zm)}),_(Hp),_(Hu),_(nc),Ce(()=>pi(Hu,`${`tt-table tt-table-orders ${i(hn)}`??""} svelte-1ehcy4i`)),q(Zr,nc)},Zr=>{var nc=ite();q(Zr,nc)}),Ce(()=>{tt(wd,`Rows ${i(Oc).length??""}`),tt(Po,i(hn)==="compact"?"Show details":"Compact view")}),q(Cl,Rl)}),_($a),_(Js),_(Zn),Ce(()=>{wr(Ei,"active",i(Zt)==="trades"),wr(ao,"active",i(Zt)==="orders")}),q(Vn,Zn)});var _n=v(Lt,2);Ue(_n,()=>!i(vi),Vn=>{var Zn=Qn(),Js=fn(Zn);Ue(Js,()=>!i(Ic),$o=>{var Os=ute(),Xo=y(Os);Ue(Xo,()=>i(Kl)||i(Wl),Ei=>{var ao=lte();Zi(4),q(Ei,ao)},Ei=>{var ao=cte();Zi(4),q(Ei,ao)}),_(Os),q($o,Os)},$o=>{var Os=Qn(),Xo=fn(Os);Ue(Xo,()=>!i(Pc),Ei=>{var ao=pte(),za=y(ao);Ue(za,()=>i(Kl)||i(Wl),$a=>{var yl=dte();Zi(4),q($a,yl)},$a=>{var yl=fte();Zi(4),q($a,yl)}),_(ao),q(Ei,ao)},Ei=>{var ao=vte(),za=y(ao);Ue(za,f,yl=>{var Cl=Y0("Running… please wait.");q(yl,Cl)},yl=>{var Cl=mte();Zi(2),q(yl,Cl)});var $a=v(za,2);Ue($a,()=>i(Kl)||i(Wl),yl=>{var Cl=hte(),Rl=y(Cl);_(Cl),Ce(()=>tt(Rl,`Pine parsed: strategy ${(i(Kl)?"yes":"no")??""} • signals
                ${(i(Wl)?"yes":"no")??""}`)),q(yl,Cl)}),_(ao),q(Ei,ao)},!0),q($o,Os)}),q(Vn,Zn)},Vn=>{var Zn=mse(),Js=y(Zn),$o=v(y(Js),2),Os=y($o),Xo=v(y(Os),2),Ei=y(Xo,!0);Ce(()=>tt(Ei,ps(i(vi).finalEquity,2))),_(Xo),_(Os);var ao=v(Os,2),za=v(y(ao),2),$a=y(za);Ce(()=>tt($a,`${(i(vi).netPnl>=0?"+":"")??""}${ps(i(vi).netPnl,2)??""}`)),_(za),_(ao);var yl=v(ao,2),Cl=v(y(yl),2),Rl=y(Cl,!0);Ce(()=>tt(Rl,fo(i(vi).maxDrawdownPct))),_(Cl),_(yl),_($o),_(Js);var tc=v(Js,2),Ad=y(tc),gc=v(y(Ad)),wd=y(gc,!0);_(gc);var Xp=v(gc,2),$u=y(Xp);_(Xp),_(Ad);var Jd=v(Ad,2);Ue(Jd,()=>i(vc).lastTs,oi=>{var Ys=gte(),Er=v(y(Ys)),Hn=y(Er,!0);Ce(()=>tt(Hn,new Date(i(vc).lastTs).toISOString().slice(0,10))),_(Er),_(Ys),q(oi,Ys)});var Po=v(Jd,2);Ue(Po,()=>i(Ia),oi=>{var Ys=_te(),Er=v(y(Ys)),Hn=y(Er,!0);_(Er),_(Ys),Ce(()=>tt(Hn,i(Ia))),q(oi,Ys)}),_(tc);var Mo=v(tc,2),$i=y(Mo),Zr=y($i),nc=y(Zr),Hu=v(y(nc),2);Hu.__click=[yte,oo],_(nc),Zi(2),_(Zr),_($i);var ld=v($i,2),mp=y(ld),Tc=v(y(mp),2),Hp=y(Tc),vu=v(y(Hp),2);xn(vu),vu.__input=[bte,Rt],_(Hp);var Qi=v(Hp,2),zm=v(y(Qi),2);xn(zm),zm.__input=[xte,un],_(Qi);var sp=v(Qi,2),ym=v(y(sp),2);xn(ym),ym.__input=[wte,qs],_(sp),_(Tc);var vh=v(Tc,2),Zp=y(vh);Zp.__click=g;var Jp=v(Zp,2);Ue(Jp,()=>i(Eo),oi=>{var Ys=kte();Ys.__click=[kQ,Rt,un,qs],q(oi,Ys)});var bm=v(Jp,2);Ue(bm,()=>i(Ia),oi=>{var Ys=Ste(),Er=y(Ys,!0);_(Ys),Ce(()=>tt(Er,i(Ia))),q(oi,Ys)}),Zi(2),_(vh),_(mp);var Eh=v(mp,2),Hf=v(y(Eh),2),Vm=y(Hf);xn(Vm),Vm.__input=[Cte,_o];var Wm=v(Vm,2);Wm.__click=[xQ,vi,_o,Yn,La];var Yh=v(Wm,2);Ue(Yh,()=>i(Yn).length,oi=>{var Ys=Ite();Ys.__click=[wQ,Yn,zr,kl],q(oi,Ys)}),_(Hf);var rm=v(Hf,2);Ue(rm,()=>i(Yn).length,oi=>{var Ys=Rte(),Er=v(y(Ys),2);Yo(Er,17,()=>i(Yn),Hn=>Hn.id,(Hn,Mn)=>{var Do=Dte(),Jr=fn(Do),Mr=y(Jr),vr=y(Mr,!0);_(Mr);var Il=v(Mr,2),mi=y(Il);Ce(()=>tt(mi,`${(i(Mn).summary.netPnl>=0?"+":"")??""}${ps(i(Mn).summary.netPnl,2)??""}`)),_(Il);var Xi=v(Il,2),k=y(Xi,!0);Ce(()=>tt(k,fo(i(Mn).summary.netPnlPct??0))),_(Xi);var N=v(Xi,2),j=y(N,!0);Ce(()=>tt(j,fo(i(Mn).summary.maxDrawdownPct??0))),_(N);var D=v(N,2),W=y(D,!0);Ce(()=>tt(W,wu(i(Mn).summary.sharpe??0))),_(D);var H=v(D,2),he=y(H,!0);Ce(()=>tt(he,fo(i(Mn).summary.winRate??0))),_(H);var Le=v(H,2),st=y(Le,!0);_(Le);var Jt=v(Le,2),fs=y(Jt,!0);Ce(()=>tt(fs,df(i(Mn).params))),_(Jt);var ts=v(Jt,2),Bn=y(ts);Bn.__click=[Pte,Md,Mn];var ti=y(Bn,!0);_(Bn);var ci=v(Bn,2);ci.__click=[Mte,xs,Mn],_(ts),_(Jr);var lu=v(Jr,2);Ue(lu,()=>i(zr)===i(Mn).id,Cd=>{var Sf=$te(),rf=y(Sf),rp=v(y(rf),2);Yo(rp,21,()=>Pu(i(Mn).summary),Ii,(sa,wi)=>{var pa=Nte(),er=y(pa),Da=y(er,!0);_(er);var cu=v(er,2),Va=y(cu,!0);_(cu),_(pa),Ce(()=>{tt(Da,i(wi).label),tt(Va,i(wi).value)}),q(sa,pa)}),_(rp),_(rf);var ef=v(rf,2),Cf=v(y(ef),2);Ue(Cf,()=>i(Mn).params&&Object.keys(i(Mn).params).length,sa=>{var wi=Tte();Yo(wi,21,()=>Object.entries(i(Mn).params),Ii,(pa,er)=>{let Da=()=>i(er)[0],cu=()=>i(er)[1];var Va=Ate(),ju=y(Va),Bu=y(ju,!0);_(ju);var oa=v(ju,2),Ul=y(oa,!0);Ce(()=>tt(Ul,zf(cu(),0))),_(oa),_(Va),Ce(()=>tt(Bu,Da())),q(pa,Va)}),_(wi),q(sa,wi)},sa=>{var wi=Fte();q(sa,wi)}),_(ef);var mf=v(ef,2),Id=v(y(mf),2);Id.__click=[Lte,nf,Mn];var If=y(Id,!0);_(Id);var jf=v(Id,2);Ue(jf,()=>i(kl)[i(Mn).id],sa=>{var wi=Ete(),pa=y(wi,!0);Ce(()=>tt(pa,Dd(i(Mn)))),_(wi),q(sa,wi)}),_(mf),_(Sf),Ce(()=>tt(If,i(kl)[i(Mn).id]?"Hide raw":"Show raw")),q(Cd,Sf)}),Ce(()=>{tt(vr,i(Mn).label),pi(Il,`${`right mono ${i(Mn).summary.netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),tt(st,i(Mn).summary.trades??0),Ot(Bn,"aria-expanded",i(zr)===i(Mn).id),tt(ti,i(zr)===i(Mn).id?"Hide":"Details")}),q(Hn,Do)}),_(Ys),q(oi,Ys)},oi=>{var Ys=jte();q(oi,Ys)}),_(Eh),_(ld),_(Mo);var xm=v(Mo,2),Hm=y(xm),hp=y(Hm),zd=y(hp),lv=v(y(zd),2);lv.__click=[Bte,oo],_(zd),Zi(2),_(hp),_(Hm);var Lv=v(Hm,2),qm=y(Lv),gh=v(y(qm),2),Kh=y(gh,!0);_(gh);var Du=v(gh,2),$p=y(Du),_h=v($p);Ue(_h,()=>i(vi).roundTrips!=null,oi=>{var Ys=Y0();Ce(()=>tt(Ys,`• Positions ${i(vi).roundTrips??""}`)),q(oi,Ys)}),_(Du),_(qm);var am=v(qm,2),Um=v(y(am),2),$f=y(Um,!0);Ce(()=>tt($f,fo(i(vi).winRate))),_(Um);var wm=v(Um,2);const lm=Bt(()=>fo(i(vi).maxDrawdownPct)??""),yh=Bt(()=>ps(i(vi).maxDrawdownValue??0,2)??"");var Gm=y(wm);Ce(()=>tt(Gm,`Max DD ${i(lm)} / ${i(yh)}`)),_(wm),_(am);var Vl=v(am,2),km=v(y(Vl),2),Ym=y(km);Ce(()=>tt(Ym,`${(i(vi).netPnl>=0?"+":"")??""}${ps(i(vi).netPnl,2)??""}`)),_(km);var cm=v(km,2);const bh=Bt(()=>fo(i(vi).netPnlPct)??""),cv=Bt(()=>ps(i(vi).feesPaid,2)??""),ig=Bt(()=>wu(i(vi).profitFactor)??"");var Dp=y(cm);Ce(()=>tt(Dp,`${i(bh)} • Fees ${i(cv)} • PF ${i(ig)}`)),_(cm),_(Vl);var yv=v(Vl,2),op=v(y(yv),2),Xh=y(op);Ce(()=>tt(Xh,`${(i(vi).expectancy>=0?"+":"")??""}${ps(i(vi).expectancy??0,2)??""}`)),_(op);var Zh=v(op,2);const Ev=Bt(()=>ps(i(vi).avgTrade??0,2)??""),kp=Bt(()=>wu(i(vi).payoffRatio??0)??""),bp=Bt(()=>i(vi).maxConsecWins??0??""),$v=Bt(()=>i(vi).maxConsecLosses??0??"");var rg=y(Zh);Ce(()=>tt(rg,`Avg ${i(Ev)} • Payoff
                  ${i(kp)} • Streak
                  W ${i(bp)}/L ${i($v)}`)),_(Zh),_(yv);var Km=v(yv,2),uv=v(y(Km),2),Jh=y(uv);Ce(()=>tt(Jh,`Sharpe ${wu(i(vi).sharpe??0)??""}`)),_(uv);var ag=v(uv,2);const bv=Bt(()=>wu(i(vi).sortino??0)??""),xv=Bt(()=>fo(i(vi).volatilityPct??0)??"");var Rp=y(ag);Ce(()=>tt(Rp,`Sortino ${i(bv)} • Vol
                  ${i(xv)}`)),_(ag),_(Km);var lg=v(Km,2),Sm=v(y(lg),2),Dv=y(Sm,!0);Ce(()=>tt(Dv,fo(i(vi).exposurePct??0))),_(Sm);var $h=v(Sm,2);const Rv=Bt(()=>fo(i(vi).maxRunupPct??0)??""),wf=Bt(()=>ps(i(vi).maxRunupValue??0,2)??""),sc=Bt(()=>ps(i(vi).avgBarsInTrade??0,1)??""),ru=Bt(()=>wu(i(vi).calmar??0)??"");var eu=y($h);Ce(()=>tt(eu,`Run-up ${i(Rv)} / ${i(wf)} • Bars/trade
                  ${i(sc)} • Calmar
                  ${i(ru)}`)),_($h),_(lg),_(Lv);var Dh=v(Lv,2);Ue(Dh,()=>i(vi).trades===0,oi=>{var Ys=Vte(),Er=v(y(Ys),2),Hn=y(Er);Ue(Hn,()=>i(vc).total===0,Mn=>{var Do=Ote();Zi(2),q(Mn,Do)},Mn=>{var Do=zte();Zi(2),q(Mn,Do)}),_(Er),_(Ys),q(oi,Ys)}),_(xm);var Xm=v(xm,2),jv=y(Xm),Bv=y(jv),ip=y(Bv),um=v(y(ip),2);um.__click=[Wte,oo],_(ip),Zi(2),_(Bv),_(jv);var dv=v(jv,2),Zm=y(dv),Rh=v(y(Zm),2),Cm=v(y(Rh),2),Ov=y(Cm);_(Cm);var jh=v(Cm,2),zv=y(jh);Ce(()=>tt(zv,`Win ${fo(i(zc).long.winRate)??""}`)),_(jh);var wv=v(jh,2),xh=y(wv);Ce(()=>tt(xh,`Net ${(i(zc).long.net>=0?"+":"")??""}${ps(i(zc).long.net,2)??""}`)),_(wv);var Im=v(wv,2),Qh=y(Im);Ce(()=>tt(Qh,`PF ${wu(i(zc).long.profitFactor)??""}`)),_(Im),_(Rh);var cg=v(Rh,2),ug=v(y(cg),2),Vv=y(ug);_(ug);var dg=v(ug,2),fg=y(dg);Ce(()=>tt(fg,`Win ${fo(i(zc).short.winRate)??""}`)),_(dg);var S=v(dg,2),R=y(S);Ce(()=>tt(R,`Net ${(i(zc).short.net>=0?"+":"")??""}${ps(i(zc).short.net,2)??""}`)),_(S);var X=v(S,2),ae=y(X);Ce(()=>tt(ae,`PF ${wu(i(zc).short.profitFactor)??""}`)),_(X),_(cg),_(Zm);var ne=v(Zm,2),Ee=v(y(ne),2);Ue(Ee,()=>i(Zd).length,oi=>{var Ys=qte(),Er=v(y(Ys),2);Yo(Er,17,()=>i(Zd).slice(0,12),Ii,(Hn,Mn)=>{var Do=Hte(),Jr=y(Do),Mr=y(Jr,!0);_(Jr);var vr=v(Jr,2),Il=y(vr,!0);_(vr);var mi=v(vr,2),Xi=y(mi,!0);Ce(()=>tt(Xi,fo(i(Mn).winRate))),_(mi);var k=v(mi,2),N=y(k);Ce(()=>tt(N,`${(i(Mn).net>=0?"+":"")??""}${ps(i(Mn).net,2)??""}`)),_(k);var j=v(k,2),D=y(j,!0);Ce(()=>tt(D,wu(i(Mn).profitFactor))),_(j),_(Do),Ce(()=>{tt(Mr,i(Mn).id),tt(Il,i(Mn).trades),pi(k,`${`right mono ${i(Mn).net>=0?"pos":"neg"}`??""} svelte-1ehcy4i`)}),q(Hn,Do)}),_(Ys),q(oi,Ys)},oi=>{var Ys=Ute();q(oi,Ys)}),_(ne),_(dv),_(Xm);var je=v(Xm,2),dt=y(je),At=y(dt),Yt=y(At),yn=v(y(Yt),2);yn.__click=[Gte,oo],_(Yt),Zi(2),_(At);var Wt=v(At,2),zn=y(Wt,!0),Pn=v(zn);Ue(Pn,()=>i(dc),oi=>{var Ys=Y0();Ce(()=>tt(Ys,`• Running ${i(rd)??""}/${i(Yl)??""} (${i(Vu)??""}%) • ${i(Pa)??""}`)),q(oi,Ys)}),_(Wt),_(dt);var as=v(dt,2),Cs=y(as),Ks=v(y(Cs),2);Ue(Ks,()=>i(Lr).length,oi=>{var Ys=pne(),Er=fn(Ys),Hn=v(y(Er),2),Mn=y(Hn);e_(Mn,()=>i(yr));var Do;Mn.__change=[Yte,$n],Yo(Mn,21,()=>i(Lr),wi=>wi.name,(wi,pa)=>{var er=Kte(),Da={},cu=y(er,!0);_(er),Ce(()=>{Da!==(Da=i(pa).name)&&(er.value=(er.__value=i(pa).name)==null?"":i(pa).name),tt(cu,i(pa).title||i(pa).name)}),q(wi,er)}),_(Mn),_(Hn),_(Er);var Jr=v(Er,2),Mr=y(Jr),vr=v(y(Mr),2);xn(vr),vr.__input=[Xte,Rc],_(Mr);var Il=v(Mr,2),mi=v(y(Il),2);xn(mi),mi.__input=[Zte,Cu],_(Il);var Xi=v(Il,2),k=v(y(Xi),2);xn(k),k.__input=[Jte,uc],_(Xi),_(Jr);var N=v(Jr,2),j=v(y(N),2),D=y(j);e_(D,()=>i(Fi));var W;D.__change=[Qte,ws];var H=y(D);H.value=((H.__value="")==null,"");var he=v(H);Yo(he,17,()=>i(Lr),wi=>wi.name,(wi,pa)=>{var er=ene(),Da={},cu=y(er,!0);_(er),Ce(()=>{Da!==(Da=i(pa).name)&&(er.value=(er.__value=i(pa).name)==null?"":i(pa).name),tt(cu,i(pa).title||i(pa).name)}),q(wi,er)}),_(D),_(j),_(N);var Le=v(N,2);Ue(Le,()=>i(Fi),wi=>{var pa=one(),er=y(pa),Da=v(y(er),2);xn(Da),Da.__input=[tne,Fl],_(er);var cu=v(er,2),Va=v(y(cu),2);xn(Va),Va.__input=[nne,jc],_(cu);var ju=v(cu,2),Bu=v(y(ju),2);xn(Bu),Bu.__input=[sne,nd],_(ju),_(pa),Ce(()=>{Gf(Da,i(Fl)),Gf(Va,i(jc)),Gf(Bu,i(nd))}),q(wi,pa)});var st=v(Le,2),Jt=v(y(st),2),fs=y(Jt);e_(fs,()=>i(Fa));var ts;fs.__change=[ine,Fa];var Bn=y(fs);Bn.value=(Bn.__value="netPnl")==null?"":"netPnl";var ti=v(Bn);ti.value=(ti.__value="profitFactor")==null?"":"profitFactor";var ci=v(ti);ci.value=(ci.__value="sharpe")==null?"":"sharpe";var lu=v(ci);lu.value=(lu.__value="winRate")==null?"":"winRate";var Cd=v(lu);Cd.value=(Cd.__value="maxDrawdownPct")==null?"":"maxDrawdownPct",_(fs),_(Jt),_(st);var Sf=v(st,2),rf=v(y(Sf),2),rp=y(rf),ef=y(rp);xn(ef),ef.__change=[rne,ya],Zi(2),_(rp),_(rf),_(Sf);var Cf=v(Sf,2);Ue(Cf,()=>i(ya),wi=>{var pa=lne(),er=v(y(pa),2),Da=y(er);xn(Da),Da.__input=[ane,hc],_(er),_(pa),Ce(()=>Gf(Da,i(hc))),q(wi,pa)});var mf=v(Cf,2),Id=y(mf);Id.__click=[SQ,Lr,Ll,yr,Fi,Us,Rc,Cu,uc,Fl,jc,nd,Sl,Bc,So,rd,dc,uf,Pa,Yr,el,l,or];var If=v(Id,2);Ue(If,()=>i(dc),wi=>{var pa=cne();pa.__click=[CQ,dc,uf,Bc,el],q(wi,pa)},wi=>{var pa=Qn(),er=fn(pa);Ue(er,()=>i(So).length,Da=>{var cu=une();cu.__click=[IQ,So,Yr,Ll,rd,Bc,dc,uf,el],q(Da,cu)},null,!0),q(wi,pa)}),Zi(2),_(mf);var jf=v(mf,2);Ue(jf,()=>i(Ll),wi=>{var pa=dne(),er=y(pa,!0);_(pa),Ce(()=>tt(er,i(Ll))),q(wi,pa)});var sa=v(jf,2);Ue(sa,()=>i(dc),wi=>{var pa=fne(),er=y(pa);_(pa),Ce(()=>Ot(er,"style",`width:${i(Vu)}%`)),q(wi,pa)}),Ce(()=>{Do!==(Do=i(yr))&&(Mn.value=(Mn.__value=i(yr))==null?"":i(yr),_0(Mn,i(yr))),Gf(vr,i(Rc)),Gf(mi,i(Cu)),Gf(k,i(uc)),W!==(W=i(Fi))&&(D.value=(D.__value=i(Fi))==null?"":i(Fi),_0(D,i(Fi))),ts!==(ts=i(Fa))&&(fs.value=(fs.__value=i(Fa))==null?"":i(Fa),_0(fs,i(Fa))),Mv(ef,i(ya)),Id.disabled=i(dc)}),q(oi,Ys)},oi=>{var Ys=mne();q(oi,Ys)}),_(Cs);var jn=v(Cs,2),Xt=v(y(jn),2);Ue(Xt,()=>i(Iu).length,oi=>{var Ys=gne(),Er=fn(Ys),Hn=y(Er);_(Er);var Mn=v(Er,2),Do=v(y(Mn),2);Yo(Do,19,()=>i(Iu),(Mr,vr)=>df(Mr.params)+vr,(Mr,vr,Il)=>{var mi=hne(),Xi=y(mi),k=y(Xi,!0);Ce(()=>tt(k,df(i(vr).params))),_(Xi);var N=v(Xi,2),j=y(N,!0);Ce(()=>tt(j,mo(i(vr).summary))),_(N);var D=v(N,2),W=y(D);Ce(()=>tt(W,`${(i(vr).summary.netPnl>=0?"+":"")??""}${ps(i(vr).summary.netPnl,2)??""}`)),_(D);var H=v(D,2),he=y(H,!0);Ce(()=>tt(he,fo(i(vr).summary.netPnlPct??0))),_(H);var Le=v(H,2),st=y(Le,!0);Ce(()=>tt(st,fo(i(vr).summary.maxDrawdownPct??0))),_(Le);var Jt=v(Le,2),fs=y(Jt,!0);Ce(()=>tt(fs,fo(i(vr).summary.winRate??0))),_(Jt);var ts=v(Jt,2),Bn=y(ts,!0);_(ts),_(mi),Ce(()=>{pi(mi,`${`opt-results-row ${i(Il)===0?"best":""}`??""} svelte-1ehcy4i`),pi(D,`${`right mono ${i(vr).summary.netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),tt(Bn,i(vr).summary.trades??0)}),q(Mr,mi)}),_(Mn);var Jr=v(Mn,2);Ue(Jr,()=>i(ya)&&i(Yr),Mr=>{var vr=vne();const Il=Bt(()=>df(i(Yr).params)??""),mi=Bt(()=>(i(Yr).summary.netPnl>=0?"+":"")??""),Xi=Bt(()=>ps(i(Yr).summary.netPnl,2)??""),k=Bt(()=>fo(i(Yr).summary.maxDrawdownPct??0)??""),N=Bt(()=>fo(i(Yr).summary.winRate??0)??"");var j=y(vr);Ce(()=>tt(j,`Test run: ${i(Il)} • Net ${i(mi)}${i(Xi)} • DD ${i(k)} • Win ${i(N)}`)),_(vr),q(Mr,vr)}),Ce(()=>tt(Hn,`Showing ${i(Iu).length??""} runs`)),q(oi,Ys)},oi=>{var Ys=_ne();q(oi,Ys)}),_(jn),_(as),_(je);var Tn=v(je,2),Kn=y(Tn),os=y(Kn),ln=y(os),ms=v(y(ln),2);ms.__click=[yne,oo],_(ln),Zi(2),_(os);var Ns=v(os,2),cn=y(Ns),Gn=y(cn);Gn.__click=[bne,hu];var ls=v(Gn,2);ls.__click=[xne,hu];var on=v(ls,2);on.__click=[wne,hu];var an=v(on,2);an.__click=[kne,hu];var wn=v(an,2);wn.__click=[Sne,hu];var ds=v(wn,2);ds.__click=[Cne,hu];var Wn=v(ds,2);Wn.__click=[Ine,hu],_(cn),_(Ns),_(Kn);var yo=v(Kn,2),Si=y(yo),is=y(Si),To=v(y(is),2),gs=y(To);Ue(gs,()=>i(Wu).length,oi=>{var Ys=Y0();const Er=Bt(()=>ps(i(Wu)[0].equity,2)??""),Hn=Bt(()=>ps(i(Wu)[i(Wu).length-1].equity,2)??"");Ce(()=>tt(Ys,`${i(Er)} → ${i(Hn)}`)),q(oi,Ys)}),_(To),_(is);var No=v(is,2);Ue(No,()=>i(yd),oi=>{var Ys=Pne(),Er=y(Ys),Hn=v(y(Er),2),Mn=y(Hn,!0);Ce(()=>tt(Mn,ps(i(yd).first,2))),_(Hn),_(Er);var Do=v(Er,2),Jr=v(y(Do),2),Mr=y(Jr,!0);Ce(()=>tt(Mr,ps(i(yd).last,2))),_(Jr),_(Do);var vr=v(Do,2),Il=v(y(vr),2),mi=y(Il);Ce(()=>tt(mi,`${(i(yd).net>=0?"+":"")??""}${ps(i(yd).net,2)??""}`)),_(Il),_(vr);var Xi=v(vr,2),k=v(y(Xi),2),N=y(k);Ce(()=>tt(N,`${(i(yd).retPct>=0?"+":"")??""}${fo(i(yd).retPct)??""}`)),_(k),_(Xi);var j=v(Xi,2),D=v(y(j),2);const W=Bt(()=>ps(i(yd).min,2)??""),H=Bt(()=>ps(i(yd).max,2)??"");var he=y(D);Ce(()=>tt(he,`${i(W)}–${i(H)}`)),_(D),_(j),_(Ys),Ce(()=>{pi(Il,`${`mono ${i(yd).net>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),pi(k,`${`mono ${i(yd).retPct>=0?"pos":"neg"}`??""} svelte-1ehcy4i`)}),q(oi,Ys)});var jo=v(No,2);jo.__pointermove=De;var co=y(jo);Ue(co,()=>i(se),oi=>{var Ys=Ane(),Er=fn(Ys),Hn=y(Er),Mn=v(Hn),Do=v(Mn);Ue(Do,()=>i(be),Xi=>{var k=Mne();Ce(()=>Ot(k,"d",i(be).line)),q(Xi,k)});var Jr=v(Do,4);Ue(Jr,()=>i(Mc),Xi=>{var k=Nne();Ce(()=>{Ot(k,"cx",i(Mc).x),Ot(k,"cy",i(Mc).y)}),q(Xi,k)}),_(Er);var Mr=v(Er,2),vr=y(Mr,!0);Ce(()=>tt(vr,ps(i(se).maxY,2))),_(Mr);var Il=v(Mr,2),mi=y(Il,!0);Ce(()=>tt(mi,ps(i(se).minY,2))),_(Il),Ce(()=>{Ot(Hn,"d",i(se).area),Ot(Mn,"d",i(se).line)}),q(oi,Ys)},oi=>{var Ys=Tne();q(oi,Ys)});var Vs=v(co,2);Ue(Vs,()=>i(Ye),oi=>{var Ys=Fne(),Er=fn(Ys),Hn=v(Er,2),Mn=v(Hn,2),Do=y(Mn),Jr=y(Do,!0);Ce(()=>tt(Jr,new Date(i(Ye).ts).toISOString().slice(0,10))),_(Do);var Mr=v(Do,2),vr=v(y(Mr)),Il=y(vr,!0);Ce(()=>tt(Il,ps(i(Ye).equity,2))),_(vr),_(Mr);var mi=v(Mr,2),Xi=v(y(mi)),k=y(Xi);Ce(()=>tt(k,`${(i(Ye).net>=0?"+":"")??""}${Mi(i(Ye).net)??""}`)),_(Xi),_(mi);var N=v(mi,2),j=v(y(N)),D=y(j);Ce(()=>tt(D,`${(i(Ye).retPct>=0?"+":"")??""}${sl(i(Ye).retPct)??""}`)),_(j),_(N),_(Mn),Ce(()=>{Ot(Er,"style",`left:${i(Ye).x}px;`),Ot(Hn,"style",`top:${i(Ye).y}px;`),Ot(Mn,"style",`left:${i(Ye).left}px; top:${i(Ye).top}px;`)}),q(oi,Ys)}),_(jo);var gi=v(jo,2);Ue(gi,()=>i(be),oi=>{var Ys=Lne();q(oi,Ys)}),_(Si);var Hc=v(Si,2),xc=y(Hc),ac=v(y(xc),2),tu=y(ac);Ce(()=>tt(tu,`Max ${fo(i(vi).maxDrawdownPct)??""}`)),_(ac),_(xc);var _c=v(xc,2);Ue(_c,()=>i(Bd),oi=>{var Ys=Ene(),Er=y(Ys),Hn=v(y(Er),2),Mn=y(Hn,!0);Ce(()=>tt(Mn,fo(i(Bd).worstAbs))),_(Hn),_(Er);var Do=v(Er,2),Jr=v(y(Do),2),Mr=y(Jr,!0);Ce(()=>tt(Mr,fo(i(Bd).avgAbs))),_(Jr),_(Do);var vr=v(Do,2),Il=v(y(vr),2),mi=y(Il,!0);Ce(()=>tt(mi,fo(i(Bd).lastAbs))),_(Il),_(vr),_(Ys),q(oi,Ys)});var qc=v(_c,2);qc.__pointermove=pt;var jl=y(qc);Ue(jl,()=>i(G),oi=>{var Ys=Dne(),Er=fn(Ys),Hn=y(Er),Mn=v(Hn),Do=v(Mn,4);Ue(Do,()=>i(Tu),mi=>{var Xi=$ne();Ce(()=>{Ot(Xi,"cx",i(Tu).x),Ot(Xi,"cy",i(Tu).y)}),q(mi,Xi)}),_(Er);var Jr=v(Er,2),Mr=y(Jr);Ce(()=>tt(Mr,`${ps(i(G).maxY,2)??""}%`)),_(Jr);var vr=v(Jr,2),Il=y(vr);Ce(()=>tt(Il,`${ps(i(G).minY,2)??""}%`)),_(vr),Ce(()=>{Ot(Hn,"d",i(G).area),Ot(Mn,"d",i(G).line)}),q(oi,Ys)},oi=>{var Ys=Rne();q(oi,Ys)});var Bl=v(jl,2);Ue(Bl,()=>i(at),oi=>{var Ys=Bne(),Er=fn(Ys),Hn=v(Er,2),Mn=v(Hn,2),Do=y(Mn),Jr=y(Do,!0);Ce(()=>tt(Jr,new Date(i(at).ts).toISOString().slice(0,10))),_(Do);var Mr=v(Do,2),vr=v(y(Mr)),Il=y(vr,!0);Ce(()=>tt(Il,fo(Math.abs(i(at).ddPct)))),_(vr),_(Mr);var mi=v(Mr,2);Ue(mi,()=>i(at).equity!=null,Xi=>{var k=jne(),N=v(y(k)),j=y(N,!0);Ce(()=>tt(j,ps(i(at).equity,2))),_(N),_(k),q(Xi,k)}),_(Mn),Ce(()=>{Ot(Er,"style",`left:${i(at).x}px;`),Ot(Hn,"style",`top:${i(at).y}px;`),Ot(Mn,"style",`left:${i(at).left}px; top:${i(at).top}px;`)}),q(oi,Ys)}),_(qc),_(Hc),_(yo),_(Tn);var _u=v(Tn,2),cd=y(_u),ql=y(cd),jp=y(ql),Uc=v(y(jp),2);Uc.__click=[One,oo],_(jp),Zi(2),_(ql),_(cd);var Ol=v(cd,2),au=y(Ol),of=v(y(au),4);Ue(of,()=>i(Fe).length,oi=>{var Ys=Hne(),Er=v(y(Ys),2);Yo(Er,17,()=>i(Fe),Ii,(Hn,Mn)=>{var Do=Wne();Ce(()=>Ot(Do,"title",(()=>{const mi=i(vt).get(i(Mn).key)||null;if(!mi)return"Click to filter trades by this month";const Xi=mi.trades?mi.wins/mi.trades*100:0,k=mi.net>=0?`+${ps(mi.net,2)}`:`${ps(mi.net,2)}`;return`Trades ${mi.trades} • Win ${fo(Xi)} • Net ${k} • Fees ${ps(mi.fees,2)} • Click to filter`})())),Do.__click=[zne,Ku,Mn,m,bf],Do.__keydown=[Vne,Ku,Mn,m,bf];var Jr=y(Do),Mr=y(Jr,!0);_(Jr);var vr=v(Jr,2),Il=y(vr);Ce(()=>tt(Il,`${(i(Mn).retPct>=0?"+":"")??""}${fo(i(Mn).retPct)??""}`)),_(vr),_(Do),Ce(()=>{pi(Do,`${`rt-row ${i(Mn).retPct>=0?"pos":"neg"} ${i(El).type==="month"&&i(El).key===i(Mn).key?"active":""}`??""} svelte-1ehcy4i`),tt(Mr,i(Mn).key)}),q(Hn,Do)}),_(Ys),q(oi,Ys)},oi=>{var Ys=qne();q(oi,Ys)}),_(au);var Jm=v(au,2),fv=v(y(Jm),4);Ue(fv,()=>i(yt).length,oi=>{var Ys=Kne(),Er=v(y(Ys),2);Yo(Er,17,()=>i(yt),Ii,(Hn,Mn)=>{var Do=Yne();Ce(()=>Ot(Do,"title",(()=>{const mi=i(jt).get(i(Mn).key)||null;if(!mi)return"Click to filter trades by this week";const Xi=mi.trades?mi.wins/mi.trades*100:0,k=mi.net>=0?`+${ps(mi.net,2)}`:`${ps(mi.net,2)}`;return`Trades ${mi.trades} • Win ${fo(Xi)} • Net ${k} • Fees ${ps(mi.fees,2)} • Click to filter`})())),Do.__click=[Une,Ku,Mn,m,bf],Do.__keydown=[Gne,Ku,Mn,m,bf];var Jr=y(Do),Mr=y(Jr,!0);_(Jr);var vr=v(Jr,2),Il=y(vr);Ce(()=>tt(Il,`${(i(Mn).retPct>=0?"+":"")??""}${fo(i(Mn).retPct)??""}`)),_(vr),_(Do),Ce(()=>{pi(Do,`${`rt-row ${i(Mn).retPct>=0?"pos":"neg"} ${i(El).type==="week"&&i(El).key===i(Mn).key?"active":""}`??""} svelte-1ehcy4i`),tt(Mr,i(Mn).key)}),q(Hn,Do)}),_(Ys),q(oi,Ys)},oi=>{var Ys=Xne();q(oi,Ys)}),_(Jm),_(Ol),_(_u);var Df=v(_u,2),Bh=y(Df),kf=y(Bh),Pm=y(kf),dm=v(y(Pm),2);dm.__click=[Zne,oo],_(Pm),Zi(2),_(kf),_(Bh);var Pg=v(Bh,2),pf=y(Pg),wc=v(y(pf),2);Ue(wc,()=>i(Yf).length,oi=>{var Ys=Qne();Yo(Ys,21,()=>i(Yf),Ii,(Er,Hn)=>{var Mn=Jne(),Do=y(Mn),Jr=y(Do,!0);_(Do);var Mr=v(Do,2),vr=y(Mr);const Il=Bt(()=>`width:${i(Hn).count/Vf(i(Yf))*100}%`);_(Mr);var mi=v(Mr,2),Xi=y(mi,!0);_(mi),_(Mn),Ce(()=>{tt(Jr,i(Hn).label),Ot(vr,"style",i(Il)),tt(Xi,i(Hn).count)}),q(Er,Mn)}),_(Ys),q(oi,Ys)},oi=>{var Ys=ese();q(oi,Ys)}),_(pf);var xr=v(pf,2),Qd=v(y(xr),2);Ue(Qd,()=>i(Kf).length,oi=>{var Ys=nse();Yo(Ys,21,()=>i(Kf),Ii,(Er,Hn)=>{var Mn=tse(),Do=y(Mn),Jr=y(Do,!0);_(Do);var Mr=v(Do,2),vr=y(Mr);const Il=Bt(()=>`width:${i(Hn).count/Vf(i(Kf))*100}%`);_(Mr);var mi=v(Mr,2),Xi=y(mi,!0);_(mi),_(Mn),Ce(()=>{tt(Jr,i(Hn).label),Ot(vr,"style",i(Il)),tt(Xi,i(Hn).count)}),q(Er,Mn)}),_(Ys),q(oi,Ys)},oi=>{var Ys=sse();q(oi,Ys)}),_(xr);var xp=v(xr,2),Qm=v(y(xp),2);Ue(Qm,()=>i(_d).length,oi=>{var Ys=ise();Yo(Ys,21,()=>i(_d),Ii,(Er,Hn)=>{var Mn=ose(),Do=y(Mn),Jr=y(Do,!0);_(Do);var Mr=v(Do,2),vr=y(Mr);const Il=Bt(()=>`width:${i(Hn).count/Vf(i(_d))*100}%`);_(Mr);var mi=v(Mr,2),Xi=y(mi,!0);_(mi),_(Mn),Ce(()=>{tt(Jr,i(Hn).label),Ot(vr,"style",i(Il)),tt(Xi,i(Hn).count)}),q(Er,Mn)}),_(Ys),q(oi,Ys)},oi=>{var Ys=rse();q(oi,Ys)}),_(xp);var Oh=v(xp,2),Pp=v(y(Oh),2);Ue(Pp,()=>i(Rd).length,oi=>{var Ys=lse();Yo(Ys,21,()=>i(Rd),Ii,(Er,Hn)=>{var Mn=ase(),Do=y(Mn),Jr=y(Do,!0);_(Do);var Mr=v(Do,2),vr=y(Mr);const Il=Bt(()=>`width:${i(Hn).count/Vf(i(Rd))*100}%`);_(Mr);var mi=v(Mr,2),Xi=y(mi,!0);_(mi),_(Mn),Ce(()=>{tt(Jr,i(Hn).label),Ot(vr,"style",i(Il)),tt(Xi,i(Hn).count)}),q(Er,Mn)}),_(Ys),q(oi,Ys)},oi=>{var Ys=cse();q(oi,Ys)}),_(Oh),_(Pg),_(Df);var pv=v(Df,2),Mg=y(pv),Ng=y(Mg),Ag=y(Ng),pg=v(y(Ag),2);pg.__click=[use,oo],_(Ag),Zi(2),_(Ng),_(Mg);var Mm=v(Mg,2),mg=y(Mm);mg.__click=[dse,bf];var Tg=v(mg,2);Tg.__click=[fse,bf];var kv=v(Tg,2);kv.__click=[U5,ye,Oa,_l,Kr,hr,di,Mi,sl,E];var eh=v(kv,2);Ue(eh,()=>i(El).type!=="all",oi=>{var Ys=pse();Ys.__click=[MQ,ye,Mu,_l,Kr,hr,di,Mi,sl,El,E],q(oi,Ys)});var nr=v(eh,2);nr.__click=[G5,ye,Oc,di,hr,Mi,Kr,E];var Hr=v(nr,2);Hr.__click=[NQ,ye,Ql,E],_(Mm);var nu=v(Mm,2),Sd=y(nu),Rf=y(Sd);Ce(()=>tt(Rf,`Gross Profit: +${ps(i(vi).grossProfit,2)??""}`)),_(Sd);var Ud=v(Sd,2),$t=y(Ud);Ce(()=>tt($t,`Gross Loss: -${ps(i(vi).grossLoss,2)??""}`)),_(Ud);var Gs=v(Ud,2),Zo=y(Gs);Ce(()=>tt(Zo,`Total: ${(i(vi).netPnl>=0?"+":"")??""}${ps(i(vi).netPnl,2)??""}`)),_(Gs),_(nu);var Bo=v(nu,2),ka=y(Bo),Ru=y(ka);Ce(()=>tt(Ru,`Net (from trades): ${(i(pp)>=0?"+":"")??""}${Ko(i(pp))??""}`)),_(ka);var Vo=v(ka,2),il=y(Vo);Ce(()=>tt(il,`Initial: ${ps(i(vi).initialCapital,2)??""}`)),_(Vo);var Ya=v(Vo,2),Zl=y(Ya);Ce(()=>tt(Zl,`Final: ${ps(i(vi).finalEquity,2)??""}`)),_(Ya),_(Bo),_(pv),_(Zn),Ce(()=>{pi(za,`${`kpi-value mono ${i(vi).netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),tt(wd,i(vc).total),tt($u,`L ${i(vc).entryLong??""}/${i(vc).exitLong??""} • S ${i(vc).entryShort??""}/${i(vc).exitShort??""}`),Gf(vu,i(Rt)),Gf(zm,i(un)),Gf(ym,i(qs)),Zp.disabled=f(),Gf(Vm,i(_o)),Wm.disabled=!i(vi),tt(Kh,i(vi).trades),tt($p,`Wins ${i(vi).wins??""} • Loss ${i(vi).losses??""} `),tt(Ov,`Trades ${i(zc).long.trades??""}`),tt(Vv,`Trades ${i(zc).short.trades??""}`),tt(zn,i(Ro)),wr(Gn,"active",i(hu)==="1w"),wr(ls,"active",i(hu)==="1m"),wr(on,"active",i(hu)==="3m"),wr(an,"active",i(hu)==="6m"),wr(wn,"active",i(hu)==="1y"),wr(ds,"active",i(hu)==="5y"),wr(Wn,"active",i(hu)==="all"),pi(Gs,`${`pnl-item ${i(vi).netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`)}),vd("pointerleave",jo,()=>{x(Ye,null)}),vd("pointerleave",qc,()=>{x(at,null)}),q(Vn,Zn)}),_(Qt),q(rt,Qt)},null,!0),q(ee,de)});var _v=v(Fv,2);Ue(_v,()=>i(bn),ee=>{var de=wse();de.__click=[q5,bn];var He=y(de);He.__click=[vse];var rt=y(He),Qt=y(rt),Lt=y(Qt,!0);_(Qt);var _n=v(Qt,2),Vn=y(_n),Zn=y(Vn);Zn.__click=[gse,Xs];var Js=v(Zn,2);Js.__click=[_se,Xs],_(Vn);var $o=v(Vn,2);$o.__click=[q5,bn],_(_n),_(rt);var Os=v(rt,2),Xo=y(Os);Ue(Xo,()=>On[i(Fn)],Ei=>{var ao=xse(),za=fn(ao);Yo(za,21,()=>On[i(Fn)][i(Xs)].desc,Ii,(Cl,Rl)=>{var tc=yse(),Ad=y(tc,!0);_(tc),Ce(()=>tt(Ad,i(Rl))),q(Cl,tc)}),_(za);var $a=v(za,2),yl=v(y($a),2);Yo(yl,21,()=>On[i(Fn)][i(Xs)].examples,Ii,(Cl,Rl)=>{var tc=bse(),Ad=y(tc,!0);_(tc),Ce(()=>tt(Ad,i(Rl))),q(Cl,tc)}),_(yl),_($a),q(Ei,ao)}),_(Os),_(He),_(de),Ce(()=>{var Ei,ao;tt(Lt,(ao=(Ei=On[i(Fn)])==null?void 0:Ei[i(Xs)])==null?void 0:ao.title),wr(Zn,"active",i(Xs)==="en"),wr(Js,"active",i(Xs)==="bn")}),q(ee,de)});var ph=v(_v,2);Ue(ph,()=>i(Y),ee=>{var de=Tse();de.__click=[H5,Y];var He=y(de);He.__click=[kse];var rt=y(He),Qt=v(y(rt),2),Lt=y(Qt);Lt.__click=[H5,Y],_(Qt),_(rt);var _n=v(rt,2),Vn=y(_n),Zn=y(Vn),Js=v(y(Zn),2);xn(Js),Js.__keydown=[Sse,ze];var $o=v(Js,2),Os=y($o);Os.__click=ze,Zi(2),_($o),_(Zn),_(Vn);var Xo=v(Vn,2),Ei=y(Xo),ao=v(y(Ei),2),za=y(ao);Ue(za,()=>i(F),Rl=>{var tc=Cse();q(Rl,tc)},Rl=>{var tc=Qn(),Ad=fn(tc);Ue(Ad,()=>i(O).length===0,gc=>{var wd=Ise();q(gc,wd)},gc=>{var wd=Qn(),Xp=fn(wd);Yo(Xp,17,()=>i(O),Ii,($u,Jd)=>{var Po=Mse();Po.__click=[Pse,ue,Jd];var Mo=y(Po),$i=y(Mo,!0);_(Mo);var Zr=v(Mo,2),nc=y(Zr,!0);Ce(()=>tt(nc,Je(i(Jd).updatedAt))),_(Zr),_(Po),Ce(()=>{pi(Po,`save-row ${(i(ue)===i(Jd).id?"selected":"")??""} svelte-1ehcy4i`),tt($i,i(Jd).name)}),q($u,Po)}),q(gc,wd)},!0),q(Rl,tc)}),_(ao);var $a=v(ao,2),yl=y($a);yl.__click=[Nse,ue,Ke],Zi(2),_($a),_(Ei),_(Xo);var Cl=v(Xo,2);Ue(Cl,()=>i(Q),Rl=>{var tc=Ase(),Ad=y(tc,!0);_(tc),Ce(()=>tt(Ad,i(Q))),q(Rl,tc)}),_(_n),_(He),_(de),Ce(()=>{Os.disabled=i(le),yl.disabled=!i(ue)||i(le)}),Bs(Js,()=>i(ce),Rl=>x(ce,Rl)),q(ee,de)});var mh=v(ph,2);Ue(mh,()=>i(M),ee=>{var de=Wse();de.__click=[W5,M];var He=y(de);He.__click=[Fse];var rt=y(He),Qt=v(y(rt),2),Lt=y(Qt);Lt.__click=[yQ,oe];var _n=v(Lt,2);_n.__click=[W5,M],_(Qt),_(rt);var Vn=v(rt,2),Zn=y(Vn);xn(Zn);var Js=v(Zn,2),$o=y(Js);Ce(()=>tt($o,`${Mt().length??""} scripts`)),_(Js),_(Vn);var Os=v(Vn,2);Ue(Os,()=>i($),ao=>{var za=Lse(),$a=y(za,!0);_(za),Ce(()=>tt($a,i($))),q(ao,za)});var Xo=v(Os,2),Ei=y(Xo);Ue(Ei,()=>i(F),ao=>{var za=Ese();q(ao,za)},ao=>{var za=Qn(),$a=fn(za);Ue($a,()=>Mt().length===0,yl=>{var Cl=$se();q(yl,Cl)},yl=>{var Cl=Vse();Yo(Cl,21,Mt,Ii,(Rl,tc)=>{var Ad=zse(),gc=y(Ad),wd=y(gc),Xp=y(wd,!0);_(wd);var $u=v(wd,2),Jd=y($u);Ce(()=>tt(Jd,`Updated ${Je(i(tc).updatedAt)??""}`)),_($u),_(gc);var Po=v(gc,2),Mo=y(Po);Mo.__click=[Dse,bt,tc];var $i=v(Mo,2);$i.__click=[Rse,Pt,tc];var Zr=v($i,2);Zr.__click=[jse,Et,tc];var nc=v(Zr,2);nc.__click=[Bse,nt,tc];var Hu=v(nc,2);Hu.__click=[Ose,qe,tc],_(Po),_(Ad),Ce(()=>tt(Xp,i(tc).name)),q(Rl,Ad)}),_(Cl),q(yl,Cl)},!0),q(ao,za)}),_(Xo),_(He),_(de),Ce(()=>Lt.disabled=i(F)),Bs(Zn,()=>i(L),ao=>x(L,ao)),q(ee,de)});var sg=v(mh,2),hh=y(sg),og=y(hh),np=v(og,2),z0=y(np,!0);_(np);var Ig=v(np,2);return Ue(Ig,()=>typeof i(en)=="function"?i(en)():i(en),ee=>{var de=qse();const He=Bt(()=>typeof i(en)=="function"?i(en)():i(en));Ce(()=>Ot(de,"title",typeof i(cs)=="function"?i(cs)():i(cs)));var rt=v(y(de),2),Qt=y(rt,!0);_(rt);var Lt=v(rt,2),_n=y(Lt),Vn=y(_n,!0);_(_n);var Zn=v(_n,2);Yo(Zn,17,()=>i(He).lines,Ii,(Js,$o)=>{var Os=Hse(),Xo=y(Os,!0);_(Os),Ce(()=>tt(Xo,i($o))),q(Js,Os)}),_(Lt),_(de),Ce(()=>{pi(de,`${`footer-alert ${i(He).kind}`??""} svelte-1ehcy4i`),tt(Qt,i(He).label),tt(Vn,i(He).title)}),q(ee,de)}),_(hh),Zi(2),_(sg),_(us),Ce(()=>{Ot(us,"aria-hidden",!u()),wr(us,"fullpage",i(qn)),wr(kr,"selected",i(ve)==="editor"),wr(Sr,"selected",i(ve)==="errors"),wr(Sr,"has-errors",i(Ut)>0),wr(Sr,"has-warnings",i(Ut)===0&&i(Xn)>0),tt(iu,i(_t)),wr(Or,"selected",i(ve)==="results"),Ot(Ef,"aria-pressed",i(It)),tt(gv,`Labels ${(i(It)?"On":"Off")??""}`),Sg.disabled=f(),tt(Wp,f()?"Running...":"Run"),wr(jm,"hidden",i(ve)!=="editor"),tt(Lh,`inline-script.${i(Oi)??""}`),tt(fh,`Lines: ${i(Ge)??""}`),wr(Tv,"monaco-mode",i(In)!=="failed"),pi(og,`footer-dot ${(r()?"error":f()?"running":"ok")??""} svelte-1ehcy4i`),tt(z0,i(Gt))}),xo(Wc,()=>i(Ie),ee=>x(Ie,ee)),q(n,us),$d({setEditorCode:ut})}Ip(["pointerdown","click","input","change","keydown","pointermove"]);const Yse=[{id:"js-basic-plot",title:"JS basic plot",format:"js",description:"Plot close as a line (JS mode).",code:`// @lang js
export function onBar(ctx) {
  plot(ctx.close, { color: "#22c55e", title: "Close" });
}`},{id:"js-draw-demo",title:"JS draw tools demo",format:"js",description:"Labels, lines, boxes, and a table updated each bar (draw ops are capped).",code:`// @lang js
let statsTable;

export function onInit(ctx) {
  statsTable = table.new("top_right", 2, 2, {
    bgcolor: "rgba(15, 23, 42, 0.85)",
    text_color: "#e2e8f0",
  });
}

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  plot(ctx.close, { color: "#38bdf8", title: "Close", pane: "main" });

  const every = i % 20 === 0;
  plotshape(every, { style: "cross", location: "abovebar", color: "#f97316" });

  if (every) {
    label.new(ctx.bar_index, ctx.high, "Pulse", {
      style: "label",
      color: "#0f172a",
      textcolor: "#f8fafc",
      avoidOverlap: true,
    });
    line.new(i - 1, ctx.low, i + 1, ctx.high, {
      color: "#22c55e",
      width: 1,
    });
    box.new(i - 2, ctx.high, i + 2, ctx.low, {
      border_color: "#f59e0b",
      bgcolor: "rgba(245, 158, 11, 0.15)",
    });
  }

  if (statsTable) {
    table.cell(statsTable, 0, 0, "Bar");
    table.cell(statsTable, 1, 0, String(i));
  }
}`},{id:"js-heatmap-raster",title:"JS heatmap raster",format:"js",description:"WebGL heatmap raster with bar_index + price anchors.",code:`// @lang js
let hm;

export function onInit(ctx) {
  hm = heatmap.new({
    id: "vol_heat",
    pane: "sub",
    xloc: "bar_index",
    opacity: 0.85,
    xBinPx: 6,
    yBinPx: 6,
    agg: "avg",
    blend: "screen",
    colormap: [
      { stop: 0, color: "#0f172a" },
      { stop: 0.4, color: "#1d4ed8" },
      { stop: 0.7, color: "#22c55e" },
      { stop: 1, color: "#f59e0b" },
    ],
  });
}

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  if (i % 3 === 0) {
    const range = Number(ctx.high) - Number(ctx.low);
    heatmap.push(hm, i, Number(ctx.close), range);
  }
  plot(ta.ema(ctx.close, 20), { color: "#38bdf8", title: "EMA 20" });
}`},{id:"js-gradient-demo",title:"JS gradient demo",format:"js",description:"Area + callout + candle gradients in one script.",code:`// @lang js
export function onBar(ctx) {
  plot(ta.ema(ctx.close, 20), {
    type: "area",
    gradient: { from: "rgba(96,165,250,0.35)", to: "rgba(34,197,94,0.12)", mode: "vertical" },
  });

  plotshape(Number(ctx.bar_index) % 25 === 5, {
    style: "callout",
    text: "BUY",
    location: "belowbar",
    bgGradient: { from: "#16a34a", to: "#22c55e", mode: "horizontal" },
  });

  plotcandle(ctx.open, ctx.high, ctx.low, ctx.close, {
    gradient: { from: "rgba(34,197,94,0.45)", to: "rgba(34,197,94,0.1)" },
    downGradient: { from: "rgba(239,68,68,0.45)", to: "rgba(239,68,68,0.1)" },
  });
}`},{id:"js-str-color-demo",title:"JS strings + color utils",format:"js",description:"str.format + str.upper + color.from_gradient + hsl.",code:`// @lang js
let badge;

export function onBar(ctx) {
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;

  const price = str.tostring(ctx.close, "0.00");
  const tag = str.format("sig {0}", str.pad_left(ctx.bar_index, 4, "0"));
  const text = str.upper(str.format("{0} @ {1}", tag, price));

  const mix = color.from_gradient("#22c55e", "#ef4444", 0.25);
  const bg = color.set_alpha(mix, 0.18);
  const fg = color.hsl(210, 80, 60);

  badge = label.new(ctx.bar_index, ctx.high, text, {
    style: "label",
    color: bg,
    textcolor: fg,
    size: "small",
  });
}`},{id:"js-polygon-demo",title:"JS polygon overlay",format:"js",description:"Polygon overlay (GPU accelerated when WebGL is enabled).",code:`// @lang js
let poly;

export function onBar(ctx) {
  const x0 = ctx.bar_index - 2;
  const x1 = ctx.bar_index - 1;
  const x2 = ctx.bar_index;
  const y0 = ctx.low;
  const y1 = ctx.high;
  const y2 = ctx.low;

  if (!poly) {
    poly = polygon.new(
      x0, y0,
      x1, y1,
      x2, y2,
      {
        fillColor: "rgba(56, 189, 248, 0.25)",
        strokeColor: "#38bdf8",
        strokeWidth: 2,
        strokeStyle: "dashed",
        includeInAutoscale: false,
      }
    );
  }

  polygon.set_points(poly, x0, y0, x1, y1, x2, y2);
}`},{id:"js-overlay-basic",title:"JS overlay templates",format:"js",description:"Template-based overlay (rect) created via overlay.new.",code:`// @lang js
let rect;

export function onBar(ctx) {
  const last = ctx.bar_index.data.length - 1;
  const i = Number(ctx.bar_index);
  if (i !== last) return;
  const low = Number(ctx.low);
  const high = Number(ctx.high);
  if (!Number.isFinite(low) || !Number.isFinite(high)) return;

  rect = overlay.new(
    "rect",
    [
      { index: last - 20, value: low },
      { index: last, value: high },
    ],
    { styles: { polygon: { color: "rgba(14, 165, 233, 0.18)" } } }
  );
}`},{id:"js-overlay-fib-labels",title:"JS overlay fib labels (left)",format:"js",description:"Fibonacci overlay with labels placed on the left side of the levels.",code:`// @lang js
let fib;

export function onBar(ctx) {
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;

  fib = overlay.new(
    "fibonacciSegment",
    [
      { extreme: "low", lookback: 300 },
      { extreme: "high", lookback: 300 },
    ],
    {
      extendData: {
        labelSide: "left",
        labelOffset: 16,
        labelAlign: "right",
        fibonacciLevels: [
          { value: 0, color: "#64748b", label: "0", visible: true },
          { value: 0.382, color: "#60a5fa", label: "0.382", visible: true },
          { value: 0.5, color: "#22c55e", label: "0.5", visible: true },
          { value: 0.618, color: "#f59e0b", label: "0.618", visible: true },
          { value: 1, color: "#64748b", label: "1", visible: true },
        ],
      },
    }
  );
}`},{id:"js-primitives-advanced",title:"JS primitives (glow + gradient)",format:"js",description:"Polyline glow + polygon gradient fill (WebGL or Canvas fallback).",code:`// @lang js
let poly;
let pl;

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  const lowRaw = Number(ctx.low);
  const highRaw = Number(ctx.high);
  const low = Number.isFinite(lowRaw) ? lowRaw : Number(ctx.hist(ctx.low, 1));
  const high = Number.isFinite(highRaw) ? highRaw : Number(ctx.hist(ctx.high, 1));
  const mid = (low + high) / 2;

  if (!poly) {
    poly = polygon.new(
      i - 6, low,
      i - 3, high,
      i, low,
      {
        fillGradient: { from: "rgba(59, 130, 246, 0.35)", to: "rgba(34, 197, 94, 0.12)", mode: "vertical" },
        strokeColor: "#38bdf8",
        strokeWidth: 2,
        glow: 6,
        glowColor: "rgba(56, 189, 248, 0.7)",
        glowOpacity: 0.35,
        includeInAutoscale: false,
      }
    );
  }

  if (!pl) {
    pl = polyline.new(
      i - 4, mid,
      i - 2, high,
      i, mid,
      {
        color: "#f59e0b",
        width: 2,
        glow: 5,
        glowColor: "rgba(245, 158, 11, 0.75)",
        glowOpacity: 0.35,
        includeInAutoscale: false,
      }
    );
  }

  polygon.set_points(poly, i - 6, low, i - 3, high, i, low);
  polyline.set_points(pl, i - 4, mid, i - 2, high, i, mid);

  plot(ta.ema(ctx.close, 20), { color: "#22c55e", title: "EMA 20" });
}`},{id:"js-ema-color-segments",title:"JS EMA color segments",format:"js",description:"Color-switching EMA using fixed polyline segments.",code:`// @lang js
const WINDOW = 140;
let emaHist = [];
let closeHist = [];
let handles = [];

function initHandles() {
  if (handles.length) return;
  for (let i = 0; i < WINDOW; i++) {
    handles.push(
      polyline.new(0, 0, 0, 0, {
        color: "#3b82f6",
        width: 2,
        when: 0,
        includeInAutoscale: false,
      })
    );
  }
}

export function onBar(ctx) {
  const ema = Number(ta.ema(ctx.close, 20));
  const close = Number(ctx.close);
  if (!Number.isFinite(ema) || !Number.isFinite(close)) return;

  emaHist.push(ema);
  closeHist.push(close);
  if (emaHist.length > WINDOW + 1) {
    emaHist.shift();
    closeHist.shift();
  }

  initHandles();
  const lastX = Number(ctx.bar_index);
  const len = emaHist.length;

  for (let s = 0; s < WINDOW; s++) {
    const i1 = len - WINDOW + s;
    const i0 = i1 - 1;
    const h = handles[s];
    if (i0 < 0 || i1 <= 0 || i1 >= len) {
      polyline.set_points(h, 0, 0, 0, 0, { when: 0 });
      continue;
    }

    const x0 = lastX - (len - 1 - i0);
    const x1 = lastX - (len - 1 - i1);
    const y0 = emaHist[i0];
    const y1 = emaHist[i1];
    const color = closeHist[i1] >= emaHist[i1] ? "#3b82f6" : "#ef4444";

    polyline.set_points(h, x0, y0, x1, y1, { color, width: 2, when: 1 });
  }
}
`},{id:"js-interaction-runtime",title:"JS interaction (drag shapes)",format:"js",description:"Drag the last-bar line/polyline/polygon to test snapping + hit-testing.",code:`// @lang js
export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  const lastIdx = ctx.bar_index.data.length - 1;
  const lowRaw = Number(ctx.low);
  const highRaw = Number(ctx.high);
  const low = Number.isFinite(lowRaw) ? lowRaw : Number(ctx.hist(ctx.low, 1));
  const high = Number.isFinite(highRaw) ? highRaw : Number(ctx.hist(ctx.high, 1));
  if (!Number.isFinite(low) || !Number.isFinite(high)) return;
  const mid = (low + high) / 2;
  const when = i === lastIdx;

  polyline.new(
    i - 6, mid,
    i - 3, high,
    i, mid,
    { color: "#22c55e", width: 2, includeInAutoscale: false, when }
  );

  polygon.new(
    i - 9, low,
    i - 4, high,
    i + 1, low,
    {
      fillColor: "rgba(56, 189, 248, 0.2)",
      strokeColor: "#38bdf8",
      strokeWidth: 2,
      when,
      includeInAutoscale: false,
    }
  );

  line.new(i - 12, low, i, high, {
    color: "#f59e0b",
    width: 1,
    when,
    includeInAutoscale: false,
  });
}`},{id:"js-loop-average",title:"JS loop average",format:"js",description:"Simple looped average using ctx.hist (offsets must be integer >= 0).",code:`// @lang js
export function onBar(ctx) {
  let sum = 0;
  for (let i = 0; i < 5; i++) {
    sum += ctx.hist(ctx.close, i);
  }
  const avg = sum / 5;
  plot(avg, { color: "#e879f9", title: "Avg(5)", pane: "sub" });
}`},{id:"js-ta-macd",title:"JS ta.macd",format:"js",description:"MACD with SMA/EMA overlays using ta.*.",code:`// @lang js
export function onBar(ctx) {
  const smaFast = ta.sma(ctx.close, 10);
  const emaSlow = ta.ema(ctx.close, 30);
  plot(smaFast, { color: "#60a5fa", title: "SMA 10" });
  plot(emaSlow, { color: "#f59e0b", title: "EMA 30" });

  const [macdLine, signalLine, hist] = ta.macd(ctx.close, 12, 26, 9);
  plot(macdLine, { color: "#22c55e", title: "MACD", pane: "sub" });
  plot(signalLine, { color: "#ef4444", title: "Signal", pane: "sub" });
  plot(hist, { color: "#94a3b8", title: "Hist", pane: "sub", type: "histogram" });
}`},{id:"js-ta-extended-mas",title:"JS ta extended MAs",format:"js",description:"DEMA/TEMA/HMA/KAMA/ALMA/T3/TRIMA/SWMA/EVWMA family.",code:`// @lang js
export function onBar(ctx) {
  const src = ctx.close;
  plot(ta.dema(src, 20), { title: "DEMA", color: "#ef4444", pane: "sub" });
  plot(ta.tema(src, 20), { title: "TEMA", color: "#f97316", pane: "sub" });
  plot(ta.hma(src, 20), { title: "HMA", color: "#eab308", pane: "sub" });
  plot(ta.kama(src, 10, 2, 30), { title: "KAMA", color: "#22c55e", pane: "sub" });
  plot(ta.alma(src, 20, 0.85, 6), { title: "ALMA", color: "#14b8a6", pane: "sub" });
  plot(ta.t3(src, 10, 0.7), { title: "T3", color: "#3b82f6", pane: "sub" });
  plot(ta.trima(src, 20), { title: "TRIMA", color: "#8b5cf6", pane: "sub" });
  plot(ta.swma(src, 20), { title: "SWMA", color: "#ec4899", pane: "sub" });
  plot(ta.evwma(src, ctx.volume, 20), { title: "EVWMA", color: "#0ea5e9", pane: "sub" });
}`},{id:"js-ta-extended-osc",title:"JS ta extended oscillators",format:"js",description:"CMO/TSI/StochRSI/PPO/TRIX/AO/ZScore/ATRP/NATR set.",code:`// @lang js
export function onBar(ctx) {
  const src = ctx.close;
  plot(ta.cmo(src, 14), { title: "CMO", color: "#ef4444", pane: "sub" });
  plot(ta.tsi(src, 25, 13), { title: "TSI", color: "#f97316", pane: "sub" });
  plot(ta.stochrsi(src, 14, 3, 3), { title: "StochRSI", color: "#eab308", pane: "sub" });
  plot(ta.ppo(src, 12, 26), { title: "PPO", color: "#22c55e", pane: "sub" });
  plot(ta.trix(src, 9), { title: "TRIX", color: "#0ea5e9", pane: "sub" });
  plot(ta.ao(), { title: "AO", color: "#8b5cf6", pane: "sub" });
  plot(ta.zscore(src, 20), { title: "ZScore", color: "#14b8a6", pane: "sub" });
  plot(ta.atrp(14), { title: "ATRP", color: "#94a3b8", pane: "sub" });
  plot(ta.natr(14), { title: "NATR", color: "#64748b", pane: "sub" });
}`},{id:"js-ta-extended-volume",title:"JS ta extended volume",format:"js",description:"AD + CMF volume indicators.",code:`// @lang js
export function onBar(ctx) {
  plot(ta.ad(), { title: "AD", color: "#8b5cf6", pane: "sub" });
  plot(ta.cmf(20), { title: "CMF", color: "#22c55e", pane: "sub" });
}`},{id:"js-ta-uo-cog-bbw",title:"JS ta UO/COG/BBW",format:"js",description:"Ultimate oscillator, center of gravity, and band width.",code:`// @lang js
export function onBar(ctx) {
  plot(ta.uo(7, 14, 28), { title: "UO", color: "#22c55e", pane: "sub" });
  plot(ta.cog(ctx.close, 10), { title: "COG", color: "#3b82f6", pane: "sub" });
  plot(ta.bbw(ctx.close, 20, 2), { title: "BBW", color: "#ef4444", pane: "sub" });
}`},{id:"js-ta-pivot-tr",title:"JS ta pivots + TR",format:"js",description:"Pivot highs/lows, pivot points, and true range.",code:`// @lang js
export function onBar(ctx) {
  const left = 3;
  const right = 3;
  const ph = ta.pivothigh(ctx.high, left, right);
  const pl = ta.pivotlow(ctx.low, left, right);

  plot(ph, { title: "Pivot High", color: "#f97316", offset: -right });
  plot(pl, { title: "Pivot Low", color: "#22c55e", offset: -right });

  const piv = ta.pivot_points(20, "classic");
  plot(piv.pp, { title: "PP", color: "#38bdf8" });
  plot(piv.r1, { title: "R1", color: "#ef4444" });
  plot(piv.s1, { title: "S1", color: "#22c55e" });

  plot(ta.tr(), { title: "TR", color: "#94a3b8", pane: "sub" });
}`},{id:"js-mtf-htf-ema",title:"JS MTF (HTF EMA)",format:"js",description:"Higher-timeframe close + EMA using request.security.",code:`// @lang js
const htfCloseExpr = (s) => s.close;
const htfEmaExpr = (s, env) => env.ta.ema(s.close, 20);

export function onBar(ctx) {
  const htfClose = request.security("240", htfCloseExpr);
  const htfEma = request.security("240", htfEmaExpr);
  plot(htfClose, { color: "#38bdf8", title: "HTF Close" });
  plot(htfEma, { color: "#f59e0b", title: "HTF EMA 20" });
}`},{id:"js-mtf-lower-tf",title:"JS MTF (LTF Close)",format:"js",description:"Lower-timeframe close using request.security_lower_tf.",code:`// @lang js
const ltfCloseExpr = (s) => s.close;

export function onBar(ctx) {
  const ltfClose = request.security_lower_tf("5", ltfCloseExpr);
  plot(ltfClose, { color: "#22c55e", title: "LTF Close (5m)" });
}`},{id:"js-mtf-multi-symbol",title:"JS MTF (multi-symbol)",format:"js",description:"Multi-symbol HTF series via request.security(symbol, tf, expr). Set symbols if available.",code:`// @lang js
const closeExpr = (s) => s.close;

export function onBar(ctx) {
  const symB = ctx.input("Symbol B (optional)", "");
  const symC = ctx.input("Symbol C (optional)", "");
  const bbb = symB
    ? request.security(symB, "240", closeExpr)
    : request.security("240", closeExpr);
  const ccc = symC
    ? request.security(symC, "60", closeExpr)
    : request.security("60", closeExpr);
  plot(bbb, { color: "#22c55e", title: "BBB 240" });
  plot(ccc, { color: "#f97316", title: "CCC 60" });
}`},{id:"js-math-color",title:"JS math + color",format:"js",description:"math.mod and color.new usage on plots.",code:`// @lang js
export function onBar(ctx) {
  const spread = math.max(ctx.high, ctx.low) - math.min(ctx.high, ctx.low);
  plot(spread, { color: color.new(color.teal, 20), title: "Spread", pane: "sub" });

  const tick = math.mod(ctx.bar_index, 10);
  plot(tick, { color: color.rgb(239, 68, 68), title: "Mod(10)", pane: "sub" });
}`},{id:"js-plot-fill-advanced",title:"JS plot + fill (advanced)",format:"js",description:"Advanced plot types with fill and hline.",code:`// @lang js
export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 10);
  const slow = ta.ema(ctx.close, 30);
  const fastPlot = plot(fast, { color: "#38bdf8", type: "neon_line", width: 2 });
  const slowPlot = plot(slow, { color: "#f59e0b", type: "bezier_line", width: 2 });
  fill(fastPlot, slowPlot, { color: "rgba(59, 130, 246, 0.12)" });
  hline(0, { color: "#64748b", style: "dashed", pane: "sub" });
  plot(Number(fast) - Number(slow), { color: "#f472b6", title: "Diff", pane: "sub", type: "area" });
}`},{id:"js-plot-advanced",title:"JS plot advanced (histogram)",format:"js",description:"Histogram + hline in sub pane with cross-only plotshape/plotchar.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);

  plot(fast, { color: "#38bdf8", type: "neon_line", width: 2 });
  plot(slow, { color: "#f59e0b", type: "bezier_line", width: 2 });

  const fastNow = Number(fast);
  const slowNow = Number(slow);
  const diff = fastNow - slowNow;
  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  plot(diff, { type: "histogram", color: "#94a3b8", pane: "sub" });
  hline(0, { color: "#64748b", style: "dashed", pane: "sub" });

  plotshape(crossUp, {
    style: "triangle_up",
    location: "abovebar",
    color: "#22c55e",
    text: "UP",
  });
  plotchar(crossDown, {
    char: "x",
    location: "belowbar",
    color: "#ef4444",
  });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-draw-options-parity",title:"JS draw options parity",format:"js",description:"Labels/lines/boxes/tables with advanced styling + layer/zIndex.",code:`// @lang js
let stats;

export function onInit() {
  stats = table.new("top_right", 2, 2, {
    bgcolor: "rgba(15, 23, 42, 0.85)",
    frameColor: "#334155",
    frameWidth: 1,
    text_color: "#e2e8f0",
    text_halign: "center",
    text_valign: "middle",
  });
}

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  plot(ctx.close, { color: "#38bdf8", title: "Close" });

  if (i % 25 === 0) {
    label.new(ctx.bar_index, ctx.high, "Pulse", {
      style: "flag",
      color: "#0f172a",
      textcolor: "#f8fafc",
      bgcolor: "rgba(59, 130, 246, 0.2)",
      borderColor: "#60a5fa",
      borderWidth: 1,
      align: "center",
      valign: "middle",
      padding: { left: 6, right: 6, top: 3, bottom: 3 },
      tooltip: "Label tooltip",
      layer: "overlay",
      zIndex: 5,
      includeInAutoscale: false,
    });

    line.new(i - 2, ctx.low, i + 2, ctx.high, {
      color: "#22c55e",
      width: 2,
      style: "dashed",
      extend: "right",
      layer: "overlay",
      zIndex: 2,
      includeInAutoscale: false,
    });

    box.new(i - 3, ctx.high, i + 3, ctx.low, {
      border_color: "#f59e0b",
      border_width: 1,
      bgcolor: "rgba(245, 158, 11, 0.12)",
      text: "Zone",
      text_halign: "center",
      text_valign: "middle",
      text_wrap: true,
      tooltip: "Box tooltip",
      layer: "background",
      zIndex: 1,
      includeInAutoscale: false,
    });
  }

  if (stats) {
    table.cell(stats, 0, 0, "Bar", { text_color: "#e2e8f0" });
    table.cell(stats, 1, 0, String(i), { text_color: "#38bdf8" });
    table.cell(stats, 0, 1, "Close", { text_color: "#e2e8f0" });
    table.cell(stats, 1, 1, String(ctx.close), {
      text_color: "#22c55e",
      bgcolor: "rgba(15, 23, 42, 0.5)",
    });
  }
}`},{id:"js-plotcandle-ohlc",title:"JS plotcandle + plotohlc",format:"js",description:"Custom candles/ohlc with colors.",code:`// @lang js
export function onBar(ctx) {
  plotcandle(ctx.open, ctx.high, ctx.low, ctx.close, {
    color: "rgba(34,197,94,0.35)",
    downColor: "rgba(239,68,68,0.35)",
    wickColor: "#94a3b8",
    borderColor: "#334155",
  });
  plotohlc(ctx.open, ctx.high, ctx.low, ctx.close, {
    color: "#0ea5e9",
    downColor: "#f97316",
  });
}`},{id:"js-alert-basic",title:"JS alert basic",format:"js",description:"Alert rules via alertcondition/alert (Alerts Center).",code:`// @lang js
export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = Number(fast) > Number(slow);

  alertcondition(crossUp, "EMA Cross Up", "Fast EMA crossed above slow", {
    id: "ema_cross_up",
    frequency: "once_per_bar",
  });

  alert("Pulse", {
    when: Number(ctx.bar_index) % 50 === 0,
    id: "pulse",
  });

  plot(fast, { color: "#22c55e", title: "EMA 8" });
  plot(slow, { color: "#f59e0b", title: "EMA 21" });
}`},{id:"js-strategy-basic",title:"JS strategy basic",format:"js",description:"Entry/exit signals with backtest config.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.05 });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 10);
  const slow = ta.ema(ctx.close, 30);
  const fastNow = Number(fast);
  const slowNow = Number(slow);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  strategy.entry("L", strategy.long, { when: crossUp, qty: 1 });
  strategy.close("L", { when: crossDown });

  plot(fast, { color: "#22c55e", title: "EMA 10" });
  plot(slow, { color: "#ef4444", title: "EMA 30" });
  plot(strategy.position_size, { color: "#94a3b8", title: "Pos Size", pane: "sub" });
  plot(strategy.equity, { color: "#38bdf8", title: "Equity", pane: "sub" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-bracket",title:"JS strategy bracket",format:"js",description:"Entry with stop/limit exits and bracket sizing.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.04, slippagePct: 0.02 });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const fastNow = Number(fast);
  const slowNow = Number(slow);
  const atr = ta.atr(14);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  const stopPx = Number(ctx.close) - Number(atr) * 1.5;
  const limitPx = Number(ctx.close) + Number(atr) * 2.0;

  strategy.entry("L", strategy.long, { when: crossUp, qty: 1 });
  strategy.exit("L", { when: crossDown, stop: stopPx, limit: limitPx, qtyPct: 50 });

  plot(fast, { color: "#22c55e", title: "EMA 8" });
  plot(slow, { color: "#f97316", title: "EMA 21" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-advanced",title:"JS strategy advanced",format:"js",description:"Order types + bracket/trailing options with strategy.config.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({
    initialCapital: 10000,
    commissionType: "percent",
    commissionPct: 0.03,
    slippageType: "ticks",
    slippageTicks: 2,
    pyramiding: 2,
    orderSize: { type: "percent_of_equity", value: 50 },
    allowShort: true,
    execution: "intrabar_ohlc",
    fillMode: "volume",
    volumeFillPct: 50,
    timeInForce: "gtc",
  });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const fastNow = Number(fast);
  const slowNow = Number(slow);
  const atr = ta.atr(14);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  strategy.entry("L", strategy.long, {
    when: crossUp,
    bracket: { stopLossPct: 1.5, takeProfitPct: 3, trailingStopPct: 1 },
    kind: "mit",
    price: Number(ctx.close) + Number(atr) * 0.5,
    tif: "ioc",
  });

  const stopEntry = Number(ctx.close) + Number(atr) * 0.8;
  const limitEntry = stopEntry + Number(atr) * 0.2;
  strategy.order("S", strategy.short, {
    when: crossDown,
    kind: "lit",
    price: stopEntry,
    limit: limitEntry,
    qty: 1,
    tif: "fok",
    slippageType: "abs",
    slippageAbs: Number(atr) * 0.1,
  });

  strategy.exit("L", {
    kind: "trailing_stop",
    trailPct: 1.2,
    trailPrice: ctx.close,
    qtyPct: 50,
    commissionType: "cash",
    commissionCash: 1.5,
  });

  plot(fast, { color: "#22c55e", title: "EMA 8" });
  plot(slow, { color: "#f97316", title: "EMA 21" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-accessors",title:"JS strategy accessors",format:"js",description:"Plot-only accessors for closed/open trade stats.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.02, pyramiding: 1 });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 10);
  const slow = ta.ema(ctx.close, 30);
  const fastNow = Number(fast);
  const slowNow = Number(slow);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  strategy.entry("L", strategy.long, { when: crossUp, qty: 1 });
  strategy.close("L", { when: crossDown });

  plot(strategy.closedtrades.profit(0), { color: "#38bdf8", title: "Closed PnL", pane: "sub" });
  plot(strategy.closedtrades.net_profit(0), { color: "#22c55e", title: "Closed Net", pane: "sub" });
  plot(strategy.opentrades.profit(0), { color: "#f59e0b", title: "Open PnL", pane: "sub" });
  plot(strategy.closedtrades.fees(0), { color: "#94a3b8", title: "Closed Fees", pane: "sub" });

  plot(fast, { color: "#22c55e", title: "EMA 10" });
  plot(slow, { color: "#ef4444", title: "EMA 30" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-rsi-mean",title:"JS strategy RSI mean reversion",format:"js",description:"RSI oversold/overbought entries with limit orders.",code:`// @lang js
export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.02, pyramiding: 2 });
}

export function onBar(ctx) {
  const rsi = ta.rsi(ctx.close, 14);
  const rsiNow = Number(rsi);

  const longCond = Number.isFinite(rsiNow) && rsiNow < 30;
  const shortCond = Number.isFinite(rsiNow) && rsiNow > 70;

  const limitLong = Number(ctx.close) * 0.995;
  const limitShort = Number(ctx.close) * 1.005;

  strategy.order("RL", strategy.long, { when: longCond, limit: limitLong, qty: 1 });
  strategy.order("RS", strategy.short, { when: shortCond, limit: limitShort, qty: 1 });

  strategy.close("RL", { when: rsiNow > 55 });
  strategy.close("RS", { when: rsiNow < 45 });

  plot(rsi, { color: "#60a5fa", title: "RSI 14", pane: "sub" });
  plot(70, { color: "#94a3b8", title: "OB", pane: "sub" });
  plot(30, { color: "#94a3b8", title: "OS", pane: "sub" });
}`}];var Kse=ke('<span class="svelte-15ifth6"> </span>'),Xse=ke('<span class="svelte-15ifth6"> </span>'),Zse=ke('<span class="svelte-15ifth6"> </span>'),Jse=ke('<span class="svelte-15ifth6"> </span>'),Qse=ke(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">What you can do</a> <a class="svelte-15ifth6">Quick start</a> <a class="svelte-15ifth6">Core concepts</a> <a class="svelte-15ifth6">Supported features</a> <a class="svelte-15ifth6">Limits & safety</a> <a class="svelte-15ifth6">Common mistakes</a> <a class="svelte-15ifth6">Examples</a></div> <h3 id="json-what" class="svelte-15ifth6">What you can do</h3> <ul class="ss-list svelte-15ifth6"><li>Define indicators with calc + plots + labels + lines.</li> <li>Compose series with expression math and condition language.</li> <li>Add trading signals and optional backtest settings.</li> <li>Build multi-pane visuals with main/sub panes.</li></ul> <h3 id="json-quick" class="svelte-15ifth6">Quick start</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch editor mode to JSON.</li> <li>Start from a minimal spec with one plot.</li> <li>Add calc or series definitions you want to draw.</li> <li>Click Run to render the chart overlays.</li></ol> <h3 id="json-core" class="svelte-15ifth6">Core concepts</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">calc</div> <p>Structured indicators (ema, rsi, macd, bbands, etc.).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">series</div> <p>Expression-based series (lag, add, mul, custom math).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">when vs whenExpr</div> <p>Use when for condition language, whenExpr for expressions.</p></div></div> <h3 id="json-supported" class="svelte-15ifth6">Supported features</h3> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Calc types</div> <div class="ss-tag-list svelte-15ifth6"></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Plot types</div> <div class="ss-tag-list svelte-15ifth6"></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Label shapes</div> <div class="ss-tag-list svelte-15ifth6"></div></div></div> <h3 id="json-limits" class="svelte-15ifth6">Limits & safety</h3> <ul class="ss-list svelte-15ifth6"><li>Every pane must include at least one plot/label/level/line.</li> <li>Template loops (repeat/forEach) expand at load time.</li> <li>Signals score must be integers between 0 and 10.</li></ul> <h3 id="json-mistakes" class="svelte-15ifth6">Common mistakes & fixes</h3> <ul class="ss-list svelte-15ifth6"><li>Schema validation failed: check field names and types.</li> <li>pane has no plots/labels/levels/lines: add at least one.</li> <li>Missing series: define calc/series names used in plots.</li> <li>Condition parse failed: validate when syntax.</li> <li>Expressions: dotted calls (<code>ta.sma</code>/<code>math.max</code>/<code>session.isin</code>), dotted fields (<code>syminfo.*</code>/<code>barstate.*</code>/<code>strategy.*</code>/<code>timeframe.*</code>), and inline <code>//</code> comments are supported; if pasted code fails, replace NBSP/odd whitespace with normal spaces.</li></ul> <h3 id="json-mini" class="svelte-15ifth6">Examples</h3> <p class="ss-note svelte-15ifth6">Runnable JSON examples live in the Examples tab → JSON Examples. Suggested
              starting points: EMA baseline, Labels and shapes, Polyline + path, Layer
              ordering, Autoscale exclusion, Draw clear + loop.</p> <details class="ss-dev-notes svelte-15ifth6"><summary>For developers</summary> <div class="ss-dev-body svelte-15ifth6"><p>Feature flags (dev only):</p> <div class="ss-tag-list svelte-15ifth6"></div> <p>Guardrails:</p> <ul class="ss-list svelte-15ifth6"><li>VERIFY mode compares snapshots without updating.</li> <li>UPDATE_SNAPSHOTS=1 regenerates fixtures when intentional.</li></ul></div></details></section>`),eoe=ke(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">What you can do</a> <a class="svelte-15ifth6">Quick start</a> <a class="svelte-15ifth6">Core concepts</a> <a class="svelte-15ifth6">Supported features</a> <a class="svelte-15ifth6">Limits & safety</a> <a class="svelte-15ifth6">Common mistakes</a> <a class="svelte-15ifth6">Examples</a></div> <h3 id="dsl-what" class="svelte-15ifth6">What you can do</h3> <ul class="ss-list svelte-15ifth6"><li>Create quick signals and labels with a short syntax.</li> <li>Define simple series expressions (ema, highest, lowest).</li> <li>Attach scores and cooldowns to signals.</li></ul> <h3 id="dsl-quick" class="svelte-15ifth6">Quick start</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch editor mode to DSL.</li> <li>Define series with <code>name = expr</code>.</li> <li>Add <code>signal ... when ...</code> and <code>label at ...</code>.</li> <li>Click Run to see labels and signal results.</li></ol> <h3 id="dsl-core" class="svelte-15ifth6">Core concepts</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Assignments</div> <p>Numbers become params; expressions become series.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Signals</div> <p>Use signal aliases like buy/sell/top/bot with when.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Labels</div> <p>label at top/bot with text, color, and shape.</p></div></div> <h3 id="dsl-supported" class="svelte-15ifth6">Supported features</h3> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Series</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">ema</span> <span class="svelte-15ifth6">sma</span> <span class="svelte-15ifth6">highest</span> <span class="svelte-15ifth6">lowest</span> <span class="svelte-15ifth6">lag</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Signals</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">signal buy/sell/top/bot</span> <span class="svelte-15ifth6">score</span> <span class="svelte-15ifth6">cooldown</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Labels</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">label at top/bot</span> <span class="svelte-15ifth6">text/color/shape</span></div></div></div> <h3 id="dsl-limits" class="svelte-15ifth6">Limits & safety</h3> <ul class="ss-list svelte-15ifth6"><li>DSL is partial: no plots, no strategy blocks, no tables.</li> <li>Each line must follow a DSL command or assignment.</li></ul> <h3 id="dsl-mistakes" class="svelte-15ifth6">Common mistakes & fixes</h3> <ul class="ss-list svelte-15ifth6"><li>signal ... when requires a condition: add a valid when.</li> <li>Unknown series: define the series before using it.</li> <li>Invalid score/cooldown: use numeric values only.</li> <li>Expressions: dotted calls (<code>ta.sma</code>/<code>math.max</code>/<code>session.isin</code>), dotted fields (<code>syminfo.*</code>/<code>barstate.*</code>/<code>strategy.*</code>/<code>timeframe.*</code>), and inline <code>//</code> comments are supported; if pasted code fails, replace NBSP/odd whitespace with normal spaces.</li></ul> <h3 id="dsl-mini" class="svelte-15ifth6">Examples</h3> <p class="ss-note svelte-15ifth6">DSL examples live in the Examples tab → DSL Examples. DSL is partial, so
              the list may be small compared to JSON/Pine.</p></section>`),toe=ke(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">What you can do</a> <a class="svelte-15ifth6">Quick start</a> <a class="svelte-15ifth6">Core concepts</a> <a class="svelte-15ifth6">Supported features</a> <a class="svelte-15ifth6">Changelog</a> <a class="svelte-15ifth6">How-to</a> <a class="svelte-15ifth6">Sessions</a> <a class="svelte-15ifth6">request.security</a> <a class="svelte-15ifth6">Not supported yet</a> <a class="svelte-15ifth6">Limits & safety</a> <a class="svelte-15ifth6">Common mistakes</a> <a class="svelte-15ifth6">Examples</a></div> <h3 id="pine-what" class="svelte-15ifth6">What you can do</h3> <ul class="ss-list svelte-15ifth6"><li>Build overlay or oscillator indicators with Pine syntax.</li> <li>Use plots (plotcandle/plotbar/plotohlc/plotfill/plotarrow/hline), shapes, labels, lines, boxes, and draw.clear/for_each.</li> <li>Access history (x[n]), nz/na, and var state across bars.</li> <li>Use member fields like <code>syminfo.*</code>, <code>barstate.*</code>, <code>timeframe.*</code>, and <code>strategy.*</code>.</li> <li>Use arrays, time/date fields, and session filters.</li> <li>Use expanded ta.* (MA family + oscillators + channels + volume), including bbands/macd/stoch/cci/mfi/obv and kama/hma/tsi/supertrend/kdj/kst/uo/bbw.</li></ul> <h3 id="pine-quick" class="svelte-15ifth6">Quick start</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch editor mode to Pine.</li> <li>Add <code>//@pine</code> and <code>//@version=5</code>.</li> <li>Define <code>indicator("Name", overlay=true/false)</code>.</li> <li>Create a series and call <code>plot()</code> or <code>plotshape()</code>.</li> <li>Click Run to render the overlays.</li></ol> <p class="ss-note svelte-15ifth6">Pine is strict and deterministic, with extra builtins and runtime validation.</p> <h3 id="pine-core" class="svelte-15ifth6">Core concepts</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Execution model</div> <p>Runs once per bar; each series is an array of values (no lookahead).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">History + na</div> <p>x[0] is current bar, x[1] previous; out-of-range =&gt; na.</p> <p>Negative index raises a diagnostic.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">State</div> <p><code>var</code> initializes once, <code>:=</code> updates the series.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Conditionals</div> <p>if/else and ternary return per-bar series values.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Line rendering</div> <p>Dash styles are deterministic and use pixel units (no zoom scaling).</p> <p>extend is viewport-clipped and recomputed on pan/zoom.</p> <p>xloc=time uses floor + clamp; bar_index requires integers.</p> <p>Line handles use stable ids; line.set after line.delete reports an error.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Labels</div> <p>xloc bar_index/time is strict; bar_index requires integers.</p> <p>xloc=time floors to the previous bar and clamps before-first.</p> <p>textalign left/center/right, tooltip, size, color/textcolor.</p> <p>bgcolor/bordercolor/border_width supported; text/tooltip truncate (24/80).</p> <p>yloc supports price/abovebar/belowbar with fixed padding; location=location.* maps to yloc.</p> <p>label.set after delete reports an error.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Boxes</div> <p>xloc/extend/border_style/text_size/text_halign/text_valign are strict.</p> <p>xloc=time floors to previous bar and clamps before-first; bar_index requires integers.</p> <p>extend expands to viewport edges (left/right/both) using resolved indices.</p> <p>border_width must be 0..4; numeric text_size clamps 8..32.</p> <p>Dash arrays match line policy; text is single-line with fixed padding and truncation.</p> <p>Box cap: max 200 active boxes per script run; extra creates are skipped with a single diagnostic; delete/clear frees capacity.</p> <p>Box handles use stable ids; box.set after delete reports an error.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Arrays</div> <p>Numeric arrays: array.new_float/int + push/get/set/size/clear + pop/shift/unshift/insert/remove/resize.</p> <p>array.from(...) builds compile-time arrays (literals only, all numeric or all string, no mixed types).</p> <p>String arrays: array.new_string + push/get/set/size/clear.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Builtins</div> <p>math.mod/math.fmod, expanded ta.* (MA/oscillator/channel/volume families incl. kama/hma/tsi/stochrsi/supertrend/keltner/donchian/ad/cmf + kdj/kst/uo/bbw/pvi/nvi/vortex/cog), time/date functions (year(time)/hour(time)/timestamp()/timenow()/time_close()), and session.isin(time, "HHMM-HHMM") in UTC.</p></div></div> <h3 id="pine-supported" class="svelte-15ifth6">Supported features</h3> <p class="ss-note svelte-15ifth6">Verified by guardrails. Pine adds stricter validation and extra builtins.</p> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Core syntax (verified)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">if/else</span> <span class="svelte-15ifth6">ternary</span> <span class="svelte-15ifth6">var / :=</span> <span class="svelte-15ifth6">history x[n]</span> <span class="svelte-15ifth6">nz / na</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Plots + primitives</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">plot</span> <span class="svelte-15ifth6">plotshape</span> <span class="svelte-15ifth6">plotchar</span> <span class="svelte-15ifth6">plotcandle</span> <span class="svelte-15ifth6">plotbar/plotohlc</span> <span class="svelte-15ifth6">plotfill/fill</span> <span class="svelte-15ifth6">plotarrow</span> <span class="svelte-15ifth6">hline</span> <span class="svelte-15ifth6">label.new</span> <span class="svelte-15ifth6">line.new</span> <span class="svelte-15ifth6">box.new</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Tables + paths (limited)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">table.new/table.cell</span> <span class="svelte-15ifth6">linefill.new</span> <span class="svelte-15ifth6">polyline.new</span> <span class="svelte-15ifth6">polygon.new</span> <span class="svelte-15ifth6">path.new</span></div> <p>linefill.set_* supports color/line1/line2; table.set_*/table.cell_set_* support a subset (unsupported methods warn).</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Line options (validation)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">style: solid/dashed/dotted</span> <span class="svelte-15ifth6">extend: none/left/right/both</span> <span class="svelte-15ifth6">xloc: bar_index/time</span> <span class="svelte-15ifth6">width: integer &gt;= 1</span></div> <p>Dash arrays: solid [], dashed [6,4] (width &gt;= 3 → [8,5]), dotted [2,4] (width &gt;= 3 → [3,5]).</p> <p>lineDashOffset is fixed to 0 for deterministic renders.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Line lifecycle</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">stable ids</span> <span class="svelte-15ifth6">in-place updates</span> <span class="svelte-15ifth6">delete diagnostics</span></div> <p>line.new ids are deterministic per script run; line.set_* updates in place.</p> <p>line.set_* after line.delete reports <code>line is deleted</code>.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Label options (validation)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">xloc: bar_index/time</span> <span class="svelte-15ifth6">textalign: left/center/right</span> <span class="svelte-15ifth6">size: tiny/small/normal/large/huge</span> <span class="svelte-15ifth6">style: up/down/circle/square/none</span> <span class="svelte-15ifth6">tooltip</span> <span class="svelte-15ifth6">yloc: price/abovebar/belowbar</span> <span class="svelte-15ifth6">location: abovebar/belowbar</span> <span class="svelte-15ifth6">bgcolor/bordercolor/border_width</span></div> <p>label.new ids are deterministic per script run; label.set_* updates in place.</p> <p>label.set_* after label.delete reports <code>label is deleted</code>.</p> <p>above/below defaults includeInAutoscale=false unless set explicitly.</p> <p>Size map: tiny=10, small=12, normal=14, large=16, huge=18; numeric sizes clamp 8..32.</p> <p>Text truncates at 24 chars; tooltip truncates at 80.</p> <p>Label cap: max 500 active labels per script run; extra creates are skipped with a single diagnostic; deleting labels frees capacity.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">plotshape/plotchar options</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">location.abovebar/belowbar</span> <span class="svelte-15ifth6">location.absolute</span> <span class="svelte-15ifth6">shape.triangleup/triangledown</span> <span class="svelte-15ifth6">shape.circle</span> <span class="svelte-15ifth6">shape.cross/xcross/diamond/flag</span> <span class="svelte-15ifth6">text/textcolor</span> <span class="svelte-15ifth6">size.tiny/small/large</span> <span class="svelte-15ifth6">offset</span> <span class="svelte-15ifth6">color</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Runtime draw</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">draw.clear</span> <span class="svelte-15ifth6">draw.for_each</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Arrays</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">array.new_float/int</span> <span class="svelte-15ifth6">array.push/get/set/size/clear</span> <span class="svelte-15ifth6">array.pop/shift/unshift/insert/remove/resize</span> <span class="svelte-15ifth6">array.from (const)</span> <span class="svelte-15ifth6">array.new_string (runtime)</span></div> <p>array.from is compile-time only and requires literal values (all numeric or all string).</p> <p>String arrays: runtime push/get/set/size/clear supported; pop/shift/unshift/insert/remove/resize are not supported yet.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">ta.* subset</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">ta.sma/ta.ema/ta.wma/ta.rma</span> <span class="svelte-15ifth6">ta.dema/ta.tema/ta.hma</span> <span class="svelte-15ifth6">ta.kama/ta.alma/ta.t3</span> <span class="svelte-15ifth6">ta.trima/ta.swma/ta.evwma</span> <span class="svelte-15ifth6">ta.atr/ta.atrp/ta.natr</span> <span class="svelte-15ifth6">ta.bbands</span> <span class="svelte-15ifth6">ta.keltner/ta.donchian</span> <span class="svelte-15ifth6">ta.supertrend</span> <span class="svelte-15ifth6">ta.sar</span> <span class="svelte-15ifth6">ta.macd</span> <span class="svelte-15ifth6">ta.stoch/ta.stochrsi</span> <span class="svelte-15ifth6">ta.cci</span> <span class="svelte-15ifth6">ta.mfi</span> <span class="svelte-15ifth6">ta.obv</span> <span class="svelte-15ifth6">ta.cmo/ta.tsi</span> <span class="svelte-15ifth6">ta.ppo/ta.trix/ta.ao</span> <span class="svelte-15ifth6">ta.zscore</span> <span class="svelte-15ifth6">ta.cog</span> <span class="svelte-15ifth6">ta.highest/ta.lowest</span> <span class="svelte-15ifth6">ta.williamsr</span> <span class="svelte-15ifth6">ta.aroon/ta.aroonosc</span> <span class="svelte-15ifth6">ta.dmi/ta.adx/ta.plus_di/ta.minus_di/ta.dx</span> <span class="svelte-15ifth6">ta.sum</span> <span class="svelte-15ifth6">ta.rising/ta.falling</span> <span class="svelte-15ifth6">ta.valuewhen</span> <span class="svelte-15ifth6">ta.pivothigh/low</span> <span class="svelte-15ifth6">ta.ad/ta.cmf</span> <span class="svelte-15ifth6">ta.kdj/ta.kst</span> <span class="svelte-15ifth6">ta.uo</span> <span class="svelte-15ifth6">ta.bbw</span> <span class="svelte-15ifth6">ta.pvi/ta.nvi</span> <span class="svelte-15ifth6">ta.vortex</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Time + session</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">year(time)/month(time)/dayofweek(time)</span> <span class="svelte-15ifth6">hour(time)/minute(time)/second(time)</span> <span class="svelte-15ifth6">timestamp(...)</span> <span class="svelte-15ifth6">timenow()</span> <span class="svelte-15ifth6">time_close()</span> <span class="svelte-15ifth6">session.isin(time, "HHMM-HHMM")</span></div></div></div> <h3 id="pine-changelog" class="svelte-15ifth6">Changelog</h3> <ul class="ss-list svelte-15ifth6"><li>Function bodies now support control flow (<code>if/for/while/switch</code>), <code>var/varip</code>, and <code>:=</code>.</li> <li>Loops run at runtime with <code>break</code>/<code>continue</code> and a configurable max-iteration cap.</li> <li>Added member access for <code>syminfo.*</code>/<code>barstate.*</code>/<code>timeframe.*</code>/<code>strategy.*</code> and parsing for indexed expressions.</li> <li>Comparisons propagate na (operators &lt;=, &gt;=, !=).</li> <li>Safe math: invalid domains return na; division by 0 returns na; diagnostics are one-time.</li> <li>Added math.mod/math.fmod and ta.williamsr/ta.aroon/ta.dmi/ta.adx (ta.sum alias).</li> <li>Added ta.plus_di/ta.minus_di/ta.dx/ta.aroonosc.</li> <li>Added ta.rising/ta.falling and strict ta.sum length validation.</li> <li>Added ta.highest/ta.lowest with strict length validation and na-aware windows.</li> <li>Expanded ta.* with MA/oscillator/channel/volume families (kama/hma/tsi/stochrsi/supertrend/keltner/donchian/ad/cmf + kdj/kst/uo/bbw/pvi/nvi/vortex/cog).</li> <li>Added plot.style_* mapping (stepline/histogram/area/cross/circles) and plotshape/plotchar offset + extra shapes.</li> <li>Area plots no longer fill across na gaps (prevents triangle artifacts).</li> <li>Script Studio issue panel now recognizes plotshape cross/xcross/diamond/flag/tag/pill/none and location.absolute/size.auto.</li> <li>Added line.style_arrow_* support for runtime line objects.</li> <li>Added string array runtime ops (array.new_string + push/get/set/size/clear).</li> <li>Ternary numeric branches now unify int/float results.</li> <li>Strict integer rules for history/array indices and bar_index xloc values.</li> <li>A4: unified truthiness + tri-value logical ops + short-circuit; when uses expression semantics.</li></ul> <h3 id="pine-howto" class="svelte-15ifth6">How-to</h3> <ul class="ss-list svelte-15ifth6"><li>Operators &lt;=, &gt;=, != are supported.</li> <li>Comparisons return numeric 1/0 and yield na if any input is na.</li> <li>Use parentheses to make complex arithmetic + comparisons explicit.</li> <li>Chained comparisons are supported in simple form (1 &lt; x &lt; 3, a &lt;= b &lt;= c).</li> <li>For complex chains, rewrite explicitly: (a &lt; b) and (b &lt; c).</li> <li>Unsupported in chains: == / !=, or chains mixed with and/or/not or ternary at the same level.</li></ul> <h3 id="pine-known-limitations" class="svelte-15ifth6">Known Limitations (Important)</h3> <p class="ss-note svelte-15ifth6">These are current engine limits. Watch diagnostics for warnings.</p> <p class="ss-note svelte-15ifth6"><strong>1) Color expressions/variables</strong></p> <ul class="ss-list svelte-15ifth6"><li>Supported color forms: "#RRGGBB", color.rgb(r,g,b), color.new(color, transp), input.color(...).</li> <li>Not reliably supported: computed/local color variables in plot/plotshape (e.g., myColor = color.rgb(...); plot(..., color=myColor)).</li> <li>Workaround: inline the color expression in the call or use input.color.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Supported
plot(close, color="#22c55e")
c = input.color("#22c55e", "C")
plot(close, color=c)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Warning
myColor = color.rgb(34, 197, 94)
plot(close, color=myColor)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Workaround
plot(close, color=color.rgb(34, 197, 94))
</code></pre> <p class="ss-note svelte-15ifth6"><strong>2) Function bodies</strong></p> <ul class="ss-list svelte-15ifth6"><li>Multi-line functions support <code>if/for/while/switch</code>, <code>var/varip</code>, and <code>:=</code> assignments.</li> <li>Implicit return uses the final expression or a final <code>if</code>/<code>switch</code> block; use <code>return</code> for early exits.</li> <li>Loop iteration caps apply inside functions too (see loop semantics below).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Supported
f(x) =>
  var acc = 0.0
  if x > 0
    acc := acc + x
  acc
plot(f(close))
</code></pre> <p class="ss-note svelte-15ifth6"><strong>3) Loop semantics</strong></p> <ul class="ss-list svelte-15ifth6"><li>for/while execute at runtime with <code>break</code>/<code>continue</code> support.</li> <li>for-loops run to completion when bounds are finite (no default cap).</li> <li>while-loops use a safety cap (default 1000) to prevent infinite loops; a warning is emitted if exceeded.</li> <li>Set <code>__loop_max_iters</code> via input to override the cap for all loops; set it to 0 for unlimited (use with care). Values above 1,000,000 are clamped.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Supported (small loop)
sum = 0.0
for i = 0 to 5
  sum := sum + i
plot(sum)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Warning
for i = 0 to bar_index
  sum := sum + i
plot(sum)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Workaround
plot(ta.sum(close, 5))
</code></pre> <h3 id="pine-boolean-policy" class="svelte-15ifth6">Boolean + na policy</h3> <ul class="ss-list svelte-15ifth6"><li>Conditions treat na as false; non-zero numbers are true.</li> <li>Conditions must be bool or number; string conditions are treated as false with a runtime warning.</li> <li>Tri-value logic: not(na) =&gt; na; na and false =&gt; false; na or true =&gt; true; other na cases propagate.</li> <li>and/or are short-circuit (skipped branches are not evaluated).</li> <li>Runtime warnings appear once per run per call-site.</li></ul> <h3 id="pine-ta-rules" class="svelte-15ifth6">ta.* rules</h3> <ul class="ss-list svelte-15ifth6"><li>ATR signatures: <code>ta.atr(length)</code>, <code>atr(length)</code>, and <code>atr(high, low, close, length)</code>.</li> <li>ATR uses true range + RMA (smma) smoothing; the seed is SMA of the first length values, so early bars are na.</li> <li>Lengths for ta.highest/ta.lowest/ta.sum/ta.rising/ta.falling must be integers &gt;= 1; invalid returns na with a runtime diagnostic.</li> <li>valuewhen occurrence must be integer &gt;= 0; invalid returns na with a runtime diagnostic.</li> <li>valuewhen conditions use A4 truthiness; na is treated as false (diagnostic once per call-site).</li> <li>highest/lowest ignore na inside the window; if all values are na, the result is na.</li> <li>Early bars use the available window up to the current bar (no warmup requirement).</li></ul> <h3 id="pine-stdlib" class="svelte-15ifth6">Standard Library Support</h3> <ul class="ss-list svelte-15ifth6"><li>math: <code>math.mod(a, b)</code> (modulus; sign follows divisor), <code>math.fmod(a, b)</code> (remainder; sign follows dividend). Divisor 0 returns na with a runtime diagnostic.</li> <li>str: <code>str.tostring</code>, <code>str.length</code>, <code>str.contains</code>, <code>str.replace</code>, <code>str.lower</code>, <code>str.upper</code>, <code>str.startswith</code>, <code>str.endswith</code>.</li> <li>color: <code>color.rgb</code>, <code>color.new</code>, <code>color.from_hex("#RRGGBB")</code>.</li> <li>ta: <code>ta.rma(src, len)</code> (Wilder's smoothing), <code>ta.tr()</code>/<code>ta.tr(high, low, close)</code>, <code>ta.vwap()</code>.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// math + str
modv = math.mod(-5, 4)
ok = str.contains("alpha", "ph")
plot(modv)
plot(ok)

// color + ta
plot(close, color=color.from_hex("#ffcc00"))
plot(ta.vwap())
</code></pre> <p class="ss-note svelte-15ifth6"><strong>Known differences vs TradingView</strong></p> <ul class="ss-list svelte-15ifth6"><li>vwap() resets on UTC day boundaries using HLC3 * volume / volume (basic daily VWAP, not full session rules).</li> <li>math.mod uses mathematical modulus; math.fmod uses remainder (JS-style %).</li></ul> <h3 id="pine-session" class="svelte-15ifth6">Session filters</h3> <ul class="ss-list svelte-15ifth6"><li>Use <code>session.isin(time, "HHMM-HHMM")</code> to filter bars.</li> <li>Session strings must be string literals with an ASCII hyphen (no variables; e.g., "0930-1600").</li> <li>UTC time-of-day only (no exchange timezone yet).</li> <li>Wrap-around supported: <code>"2200-0200"</code> crosses midnight.</li> <li>Returns 1/0 (numeric) for plots or plotshape conditions.</li> <li>Invalid format errors with <code>session.isin session must be in HHMM-HHMM</code>.</li></ul> <h3 id="pine-request-security" class="svelte-15ifth6">request.security</h3> <p class="ss-note svelte-15ifth6">Pulls a series from another symbol/timeframe into the current chart.
              Uses server-backed candles when available, otherwise resamples chart candles.</p> <ul class="ss-list svelte-15ifth6"><li>Supported: HTF/MTF series, multi-symbol, lookahead/gaps flags.</li> <li>Pine accepts <code>ta.*</code> prefixes (e.g., <code>ta.ema</code>); the prefix is optional.</li> <li>Defaults: <code>lookahead=barmerge.lookahead_off</code>, <code>gaps=barmerge.gaps_off</code>.</li> <li>Lower TF: use <code>request.security_lower_tf</code> and the TF must be lower than the chart.</li> <li>Lower TF error: <code>request.security_lower_tf: "&lt;tf&gt;" must be lower than chart timeframe "&lt;chartTf&gt;"</code>.</li> <li>No silent fallback: lower TF without lower-TF candles is a hard error.</li> <li>Lower TF data error: <code>request.security error: request.security: lower timeframe "&lt;tf&gt;" is not available from current chart data (base ~&lt;N&gt;m). Switch chart timeframe lower or provide lower-TF datafeed.</code>.</li> <li>Invalid timeframe error: <code>request.security error: request.security: invalid timeframe "&lt;tf&gt;"</code>.</li> <li>Missing data errors: <code>request.security: no data for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>No overlap errors: <code>request.security: no overlap for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>Loading status: <code>Loading request.security: &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)... loaded &lt;oldest&gt;-&gt;&lt;newest&gt;</code>.</li> <li>Loading status (partial): <code>Loading request.security (partial): &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)... loaded &lt;oldest&gt;-&gt;&lt;newest&gt;</code>.</li></ul> <p class="ss-note svelte-15ifth6">Alignment: each base bar maps to the HTF bucket that contains its end time
              (next base open - 1ms). <code>lookahead_off</code> uses the previous confirmed
              HTF bar until the current HTF bar closes; <code>lookahead_on</code> uses the
              current HTF bar across the bucket. The last bar never confirms an HTF close.</p> <p class="ss-note svelte-15ifth6">Timezone: bucket boundaries use the symbol timezone when available, otherwise
              the chart timezone (UTC if none). Per-call timezone overrides are not supported.</p> <p class="ss-note svelte-15ifth6"><strong>Lookahead & gaps matrix</strong></p> <ul class="ss-list svelte-15ifth6"><li><code>lookahead_off + gaps_off</code>: updates on HTF close, carries forward across gaps (default).</li> <li><code>lookahead_off + gaps_on</code>: updates on HTF close, returns na inside gaps.</li> <li><code>lookahead_on + gaps_off</code>: updates within HTF bucket, carries forward across gaps.</li> <li><code>lookahead_on + gaps_on</code>: updates within HTF bucket, returns na inside gaps.</li></ul> <p class="ss-note svelte-15ifth6">Gap = missing HTF bucket or bucket mismatch. Use off/off for stable signals,
              on/on for live intrabucket updates with explicit gaps.</p> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Default: stable signals
close_htf = request.security(syminfo.tickerid, "240", close,
  lookahead=barmerge.lookahead_off, gaps=barmerge.gaps_off)

// Live within-bucket updates + explicit gaps
close_live = request.security(syminfo.tickerid, "240", close,
  lookahead=barmerge.lookahead_on, gaps=barmerge.gaps_on)
</code></pre> <p class="ss-note svelte-15ifth6">Not supported: nested <code>request.security</code> inside the expression,
              seconds-based timeframes, or synthetic lower-TF bars. Nested calls error: <code>request.security error: request.security: nested request.security inside security expression is not supported</code>.</p> <p class="ss-note svelte-15ifth6"><strong>Common errors</strong></p> <ul class="ss-list svelte-15ifth6"><li>No data: <code>request.security: no data for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>No overlap: <code>request.security: no overlap for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>Invalid timeframe: <code>request.security error: request.security: invalid timeframe "&lt;tf&gt;"</code>.</li> <li>Nested security: <code>request.security error: request.security: nested request.security inside security expression is not supported</code>.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Multi-symbol compare
close_bbb = request.security("BBB", "240", close)
close_ccc = request.security("CCC", "240", close)
spread = close_bbb - close_ccc
plot(spread, title="BBB-CCC Spread")
</code></pre> <p class="ss-note svelte-15ifth6"><strong>request.security_lower_tf</strong></p> <p class="ss-note svelte-15ifth6">Use this to fetch a lower timeframe series than the chart. The requested
              timeframe must be strictly lower, and lower-TF candles must be available
              (no synthetic downsampling).</p> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Lower-TF close from 5m on a 15m chart
close_ltf = request.security_lower_tf(syminfo.tickerid, "5", close)
plot(close_ltf, title="LTF Close")
</code></pre> <p class="ss-note svelte-15ifth6"><strong>Limits &amp; performance</strong></p> <ul class="ss-list svelte-15ifth6"><li>Limits (enforced): 16 calls, 8 symbols, 8 timeframes, 5000 bars per series.</li> <li>Limit errors: <code>request.security error: request.security: limit exceeded: &lt;reason&gt;</code>.</li> <li>Performance: internal caching avoids recompute; outputs are unchanged.</li></ul> <p class="ss-note svelte-15ifth6">If you hit limits, reduce calls/symbols/timeframes or use a higher timeframe.</p> <p class="ss-note svelte-15ifth6"><strong>Minimal examples</strong></p> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// HTF EMA filter
ema_htf = request.security(syminfo.tickerid, "240", ta.ema(close, 20))
filter = close > ema_htf
plot(ema_htf, title="HTF EMA 20")
plot(filter ? 1 : 0, title="EMA Filter", style="histogram")

// Multi-symbol spread
close_bbb = request.security("BBB", "240", close)
close_ccc = request.security("CCC", "240", close)
spread = close_bbb - close_ccc
plot(spread, title="BBB-CCC Spread")
</code></pre> <h3 id="pine-not-supported" class="svelte-15ifth6">Limited / experimental (use with care)</h3> <ul class="ss-list svelte-15ifth6"><li>request.security / request.security_lower_tf (experimental; see request.security section for limits/errors).</li> <li>table.* drawing APIs (supported but limited; unsupported set methods warn and are ignored).</li> <li>strategy.* order functions (supported as signals/backtest; not full TradingView strategy parity).</li></ul> <h3 id="pine-strategy-accessors" class="svelte-15ifth6">Strategy accessors</h3> <ul class="ss-list svelte-15ifth6"><li>Supported: <code>strategy.position_size</code>, <code>strategy.position_avg_price</code>, <code>strategy.equity</code>.</li> <li>position_size is net qty (long &gt; 0, short &lt; 0, flat = 0).</li> <li>position_avg_price is the average entry price for the open position; na when flat.</li> <li>equity updates on bar close and includes unrealized P&amp;L using close (no intrabar fills yet).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Minimal usage
pos = strategy.position_size
avg = strategy.position_avg_price
eq = strategy.equity
plot(pos)
plot(avg)
plot(eq)
</code></pre> <h3 id="pine-limits" class="svelte-15ifth6">Limits & safety</h3> <ul class="ss-list svelte-15ifth6"><li>Caps: labels 500, lines 500, boxes 200, runtime draws 1000.</li> <li>When a cap is exceeded, extra objects are skipped with diagnostics.</li> <li>Label cap frees capacity on delete/clear and emits a single runtime diagnostic.</li> <li>Box cap frees capacity on delete/clear and emits a single runtime diagnostic.</li> <li>Lifecycle is consistent: new() creates, set_* updates in place, delete/clear marks handles deleted and set_* after delete emits &quot;&lt;type&gt; is deleted&quot;.</li> <li>Box options are strict (xloc/extend/border_style/border_width/text_size/text_halign/text_valign).</li> <li>Box xloc is strict (time floors+clamps; bar_index requires integers).</li> <li>Box extend expands to the visible viewport edges.</li> <li>Scripts are bar-based (no tick-level execution).</li> <li>Strict validation for safer, deterministic runs.</li> <li>Line xloc rules are strict (bar_index integer, time uses floor + clamp).</li> <li>Line extend is viewport-clipped and recomputed on pan/zoom.</li></ul> <h3 id="pine-mistakes" class="svelte-15ifth6">Common mistakes & fixes</h3> <ul class="ss-list svelte-15ifth6"><li>Missing //@pine header: add it at the top.</li> <li>plotshape requires a condition and valid style/location options.</li> <li>Negative history index: use x[1] or greater.</li> <li>array.set index must be within array size.</li> <li>valuewhen occurrence must be integer &gt;= 0; pivot left/right must be integer &gt;= 1.</li> <li>ta.highest/ta.lowest/ta.sum/ta.rising/ta.falling length must be integer &gt;= 1.</li> <li>Time fields are functions: use <code>hour(time)</code>, not <code>hour</code>.</li> <li>line style/extend/xloc not supported: use valid literals.</li> <li>line width must be &gt;= 1 (integer).</li> <li>line x must be integer when xloc=bar_index, number when xloc=time.</li> <li>line.set after line.delete triggers: "line is deleted".</li> <li>box.set after box.delete triggers: "box is deleted".</li> <li>label x must be integer when xloc=bar_index, number when xloc=time.</li> <li>label.set after label.delete triggers: "label is deleted".</li> <li>label yloc must be price/abovebar/belowbar.</li> <li>Label text/tooltip may truncate (24/80 chars); shorten if needed.</li> <li>Expect extend to clip to the visible viewport (not full history).</li> <li>Top-level loops inside top-level if blocks are not supported yet; use draw when-conditions to gate last-bar actions.</li> <li>Function bodies now allow <code>if/for/while/switch</code> + <code>var/varip</code> + <code>:=</code>; loop caps still apply.</li> <li>session.isin session must be in HHMM-HHMM (literal string, ASCII '-', example: "0930-1600").</li> <li>Dotted calls and member fields are supported (examples: <code>ta.sma</code>, <code>math.max</code>, <code>session.isin</code>, <code>syminfo.tickerid</code>, <code>barstate.islast</code>, <code>strategy.position_size</code>, <code>timeframe.period</code>).</li> <li>Inline comments using <code>//</code> are supported; block comments (<code>/* ... */</code>) are not supported.</li> <li>If pasted code fails unexpectedly, replace NBSP/odd whitespace with normal spaces.</li></ul> <h3 id="pine-mini" class="svelte-15ifth6">Examples</h3> <p class="ss-note svelte-15ifth6">All runnable Pine examples live in the Examples tab → Pine Examples.</p> <ul class="ss-list svelte-15ifth6"><li>EMA baseline, History + nz, var state, if/ternary basics.</li> <li>Array push/get/size, draw.clear + draw.for_each.</li> <li>Line update + delete, line style + extend, xloc mapping demo.</li> <li>Line extend (viewport clipped), dash styles, width 3 dash parity.</li> <li>Label yloc price/abovebar/belowbar + location alias.</li> <li>Label size mapping + bg/border + text/tooltip truncation.</li> <li>Label cap examples: delete frees capacity + single diagnostic.</li> <li>draw.clear by group/tags for line/label/box.</li> <li>Box lifecycle + delete diagnostics.</li> <li>Box extend examples (viewport-clipped).</li> <li>Box style examples (bg/border/dash/text).</li> <li>ta.highest/ta.lowest, ta.sum, ta.rising/ta.falling, ta.valuewhen, ta.pivothigh/low, ta.bbands/macd/stoch/cci/mfi/obv.</li> <li>Time fields, time_close, session.isin.</li></ul></section>`),noe=ke(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">Start Here</a> <a class="svelte-15ifth6">Quick Index</a> <a class="svelte-15ifth6">Common Recipes</a> <a class="svelte-15ifth6">Implementation Playbook</a> <a class="svelte-15ifth6">Supported vs Not Supported</a> <a class="svelte-15ifth6">Script Structure</a> <a class="svelte-15ifth6">Data Model</a> <a class="svelte-15ifth6">History + NaN</a> <a class="svelte-15ifth6">Plots</a> <a class="svelte-15ifth6">Gradients</a> <a class="svelte-15ifth6">Pane Scaling</a> <a class="svelte-15ifth6">Autoscale Defaults</a> <a class="svelte-15ifth6">Draw Tools</a> <a class="svelte-15ifth6">Polyline/Polygon</a> <a class="svelte-15ifth6">Overlay Templates</a> <a class="svelte-15ifth6">Interaction</a> <a class="svelte-15ifth6">Heatmap</a> <a class="svelte-15ifth6">WebGL Runtime</a> <a class="svelte-15ifth6">Strategy & Backtest</a> <a class="svelte-15ifth6">Alerts</a> <a class="svelte-15ifth6">Multi-Timeframe</a> <a class="svelte-15ifth6">Datafeed Parity</a> <a class="svelte-15ifth6">Stdlib</a> <a class="svelte-15ifth6">JS API Index</a> <a class="svelte-15ifth6">Performance</a> <a class="svelte-15ifth6">Limits & Safety</a> <a class="svelte-15ifth6">Guardrails</a> <a class="svelte-15ifth6">JS Rules (Exact)</a> <a class="svelte-15ifth6">Troubleshooting</a> <a class="svelte-15ifth6">Examples</a> <a class="svelte-15ifth6">Status</a></div> <h3 id="js-start" class="svelte-15ifth6">Start Here (5 steps)</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch Script Studio mode to JS and keep <code>// @lang js</code> on line 1.</li> <li>Choose your goal: indicator, strategy, overlay, or heatmap.</li> <li>Open the Examples tab and pick the closest example.</li> <li>Edit only one thing at a time (inputs → logic → visuals).</li> <li>Run and check the Issues panel if something is not visible.</li></ol> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Indicator</div> <p>Compute a series from <code>ctx.*</code> and plot it.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strategy</div> <p>Use <code>strategy.entry/exit/close</code> and plot equity in a sub pane.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay</div> <p>Use <code>overlay.new</code> or draw primitives (line/box/polygon).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap</div> <p>Create once in <code>onInit</code>, then push points in <code>onBar</code>.</p></div></div> <h3 id="js-index" class="svelte-15ifth6">Quick Index (find by task)</h3> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">I want to…</th><th class="svelte-15ifth6">Go to section</th><th class="svelte-15ifth6">Example to run</th></tr></thead><tbody><tr><td class="svelte-15ifth6">Plot a line indicator</td><td class="svelte-15ifth6">Plots</td><td class="svelte-15ifth6">JS basic plot</td></tr><tr><td class="svelte-15ifth6">Place buy/sell markers</td><td class="svelte-15ifth6">Plots (plotshape)</td><td class="svelte-15ifth6">JS plot advanced</td></tr><tr><td class="svelte-15ifth6">Draw boxes/labels/lines</td><td class="svelte-15ifth6">Draw Tools</td><td class="svelte-15ifth6">JS draw tools demo</td></tr><tr><td class="svelte-15ifth6">Draw polylines / polygons</td><td class="svelte-15ifth6"><a>Polyline/Polygon</a></td><td class="svelte-15ifth6">JS polygon overlay</td></tr><tr><td class="svelte-15ifth6">Create Fibonacci overlays</td><td class="svelte-15ifth6">Overlay Templates</td><td class="svelte-15ifth6">JS overlay fib labels</td></tr><tr><td class="svelte-15ifth6">Build a heatmap</td><td class="svelte-15ifth6">Heatmap</td><td class="svelte-15ifth6">JS heatmap raster</td></tr><tr><td class="svelte-15ifth6">Run a strategy backtest</td><td class="svelte-15ifth6">Strategy & Backtest</td><td class="svelte-15ifth6">JS strategy basic</td></tr><tr><td class="svelte-15ifth6">Create alert rules</td><td class="svelte-15ifth6">Alerts (JS)</td><td class="svelte-15ifth6">JS alert basic</td></tr><tr><td class="svelte-15ifth6">Use higher timeframe data</td><td class="svelte-15ifth6">Multi-Timeframe</td><td class="svelte-15ifth6">JS MTF basic</td></tr></tbody></table></div> <h3 id="js-recipes" class="svelte-15ifth6">Common Recipes (copy + edit)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">1) Indicator (single line)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const value = ta.ema(ctx.close, 20);
  if (!Number.isFinite(value)) return;
  plot(value, &#123; color: "#22c55e", title: "EMA 20" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">2) Indicator + signals</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = fast &gt; slow;
  plot(fast, &#123; color: "#22c55e", title: "EMA 8" &#125;);
  plot(slow, &#123; color: "#f59e0b", title: "EMA 21" &#125;);
  plotshape(crossUp, &#123; style: "triangle_up", location: "belowbar", color: "#22c55e" &#125;);
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">3) Strategy (entry + exit)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = fast &gt; slow;
  const crossDown = fast &lt; slow;
  strategy.entry("L", strategy.long, &#123; when: crossUp &#125;);
  strategy.close("L", &#123; when: crossDown &#125;);
  plot(fast, &#123; color: "#22c55e", title: "EMA 8" &#125;);
  plot(slow, &#123; color: "#f59e0b", title: "EMA 21" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">4) Alerts (rules)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = Number(fast) &gt; Number(slow);
  alertcondition(crossUp, "EMA Cross Up", "Fast EMA crossed above slow", &#123;
    id: "ema_cross_up",
    frequency: "once_per_bar",
  &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">5) Overlay template</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
let rect;
export function onBar(ctx) &#123;
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;
  rect = overlay.new(
    "rect",
    [&#123; index: last - 20, value: ctx.low &#125;, &#123; index: last, value: ctx.high &#125;],
    &#123; styles: &#123; polygon: &#123; color: "rgba(14, 165, 233, 0.18)" &#125; &#125; &#125;
  );
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">6) Heatmap (sub pane)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
let hm;
export function onInit() &#123;
  hm = heatmap.new(&#123; id: "vol", pane: "sub", xBinPx: 6, yBinPx: 6, agg: "avg" &#125;);
&#125;
export function onBar(ctx) &#123;
  if (Number(ctx.bar_index) % 3 === 0) &#123;
    heatmap.push(hm, Number(ctx.bar_index), Number(ctx.close), Number(ctx.volume));
  &#125;
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">7) Color-switching EMA (segments)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const WINDOW = 80;
let emaHist = [];
let closeHist = [];
let handles = [];

function initHandles() &#123;
  if (handles.length) return;
  for (let i = 0; i &lt; WINDOW; i++) &#123;
    handles.push(polyline.new(0, 0, 0, 0, &#123; color: "#3b82f6", width: 2, when: 0 &#125;));
  &#125;
&#125;

export function onBar(ctx) &#123;
  const ema = Number(ta.ema(ctx.close, 20));
  const close = Number(ctx.close);
  if (!Number.isFinite(ema) || !Number.isFinite(close)) return;
  emaHist.push(ema);
  closeHist.push(close);
  if (emaHist.length &gt; WINDOW + 1) &#123;
    emaHist.shift();
    closeHist.shift();
  &#125;
  initHandles();
  const lastX = Number(ctx.bar_index);
  const len = emaHist.length;
  for (let s = 0; s &lt; WINDOW; s++) &#123;
    const i1 = len - WINDOW + s;
    const i0 = i1 - 1;
    const h = handles[s];
    if (i0 &lt; 0 || i1 &lt;= 0 || i1 &gt;= len) &#123;
      polyline.set_points(h, 0, 0, 0, 0, &#123; when: 0 &#125;);
      continue;
    &#125;
    const x0 = lastX - (len - 1 - i0);
    const x1 = lastX - (len - 1 - i1);
    const y0 = emaHist[i0];
    const y1 = emaHist[i1];
    const color = closeHist[i1] &gt;= emaHist[i1] ? "#3b82f6" : "#ef4444";
    polyline.set_points(h, x0, y0, x1, y1, &#123; color, width: 2, when: 1 &#125;);
  &#125;
&#125;</code></pre></div></div> <h3 id="js-playbook" class="svelte-15ifth6">Implementation Playbook (step-by-step)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">A) Script structure</div> <ul class="ss-list svelte-15ifth6"><li>Declare handles in module scope.</li> <li>Use <code>onInit</code> for one-time setup.</li> <li>Use <code>onBar</code> for all logic and visuals.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">B) Indicator build</div> <ul class="ss-list svelte-15ifth6"><li>Pick input: <code>ctx.close</code> / <code>ctx.high</code>.</li> <li>Compute: <code>ta.ema</code> / custom math.</li> <li>Guard NaN, then <code>plot</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">C) Strategy build</div> <ul class="ss-list svelte-15ifth6"><li>Define signals.</li> <li>Use <code>strategy.entry/exit/close</code>.</li> <li>Plot equity in a sub pane.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">D) Overlay build</div> <ul class="ss-list svelte-15ifth6"><li>Create once with <code>overlay.new</code>.</li> <li>Update points with <code>overlay.set_points</code>.</li> <li>Keep handles stable.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">E) Heatmap build</div> <ul class="ss-list svelte-15ifth6"><li>Create in <code>onInit</code>.</li> <li>Push points each bar.</li> <li>Tune bins with <code>set_grid</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">F) Interaction</div> <ul class="ss-list svelte-15ifth6"><li>Interaction is enabled by default.</li> <li>Draw on last bar for visibility.</li> <li>Keep draw order stable.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">G) Performance</div> <ul class="ss-list svelte-15ifth6"><li>Keep loops small.</li> <li>Reuse handles.</li> <li>Prefer heatmap for dense visuals.</li></ul></div></div> <h3 id="js-support" class="svelte-15ifth6">Supported vs Not Supported</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Supported</div> <ul class="ss-list svelte-15ifth6"><li><strong>Execution:</strong> <code>onInit</code> once, <code>onBar</code> per bar, globals persist across bars.</li> <li><strong>Data:</strong> <code>ctx.open/high/low/close</code>, <code>ctx.volume/time</code>, <code>ctx.bar_index</code>.</li> <li><strong>History:</strong> <code>ctx.hist(series, n)</code> (integer <code>n &gt;= 0</code>).</li> <li><strong>Indicators:</strong> <code>ta.*</code> MA family, oscillators, volatility, volume, pivots.</li> <li><strong>Math, color, strings:</strong> <code>math.*</code>, <code>color.*</code>, <code>str.*</code> helpers.</li> <li><strong>Plots:</strong> <code>plot</code>, <code>plotshape</code>, <code>plotchar</code>, <code>plotcandle</code>, <code>plotohlc</code>, <code>plotbar</code>, <code>hline</code>, <code>fill</code>.</li> <li><strong>Plot types:</strong> line/area/histogram/bar + neon/glow/bezier/cloud.</li> <li><strong>Draw tools:</strong> <code>label.new</code>, <code>line.new</code>, <code>box.new</code>, <code>polyline.new</code>, <code>polygon.new</code>, <code>table.new</code>.</li> <li><strong>Styling:</strong> layer/zIndex, glow, gradients, tooltips, avoidOverlap.</li> <li><strong>Overlays:</strong> <code>overlay.new</code> templates (fib, ruler, shapes).</li> <li><strong>Heatmap:</strong> raster heatmap with LOD + tiling, colormap, bin sizes.</li> <li><strong>Strategy:</strong> <code>strategy.entry/exit/close/cancel</code>, config, brackets.</li> <li><strong>Alerts:</strong> <code>alertcondition</code> / <code>alert</code> rules in Alerts Center.</li> <li><strong>Backtest accessors:</strong> <code>strategy.equity</code>, <code>position_size</code>, trade metrics (plot-only).</li> <li><strong>MTF:</strong> <code>request.security</code> / <code>request.security_lower_tf</code> with multi-symbol + lookahead/gaps/timezone/session.</li> <li><strong>Diagnostics:</strong> warnings vs errors in Issues panel.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Not Supported (yet / by design)</div> <ul class="ss-list svelte-15ifth6"><li><strong>Pine syntax:</strong> JS mode does not parse Pine.</li> <li><strong>Async/IO:</strong> no DOM, network, timers, or async APIs.</li> <li><strong>Non-determinism:</strong> <code>Date</code>, <code>Math.random</code>, <code>performance.now</code> blocked.</li> <li><strong>Dynamic code:</strong> no <code>eval</code>, <code>Function</code>, or dynamic <code>import</code>.</li> <li><strong>External libs:</strong> third-party packages not available.</li></ul></div></div> <h3 id="js-structure" class="svelte-15ifth6">Script Structure (skeleton)</h3> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
let handle;

export function onInit(ctx) &#123;
  // one-time setup: tables, heatmaps, config
&#125;

export function onBar(ctx) &#123;
  // per-bar logic
  const i = Number(ctx.bar_index);
  if (!Number.isFinite(i)) return;

  // draw or plot
  plot(ctx.close, &#123; color: "#22c55e", title: "Close" &#125;);
&#125;</code></pre> <ul class="ss-list svelte-15ifth6"><li>Global variables persist across bars: use them for handles.</li> <li><code>onInit</code> runs once, <code>onBar</code> runs on every bar.</li> <li>All visuals should happen inside <code>onBar</code>.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Handle reuse (important)</div> <p>Create once, then update with <code>set_points</code> or <code>set</code> to avoid leaks.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Last-bar pattern</div> <p>Draw only on the last bar to keep visuals stable and visible.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Warmup guard</div> <p>Skip bars where indicators return NaN to avoid noise.</p></div></div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Last-bar only
const last = ctx.bar_index.data.length - 1;
if (Number(ctx.bar_index) !== last) return;</code></pre> <h3 id="js-data" class="svelte-15ifth6">Data Model (ctx)</h3> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">What</th><th class="svelte-15ifth6">How to use</th><th class="svelte-15ifth6">Example</th></tr></thead><tbody><tr><td class="svelte-15ifth6">Price series</td><td class="svelte-15ifth6"><code>ctx.open/high/low/close</code></td><td class="svelte-15ifth6"><code>ta.ema(ctx.close, 20)</code></td></tr><tr><td class="svelte-15ifth6">Volume series</td><td class="svelte-15ifth6"><code>ctx.volume</code></td><td class="svelte-15ifth6"><code>ta.obv()</code></td></tr><tr><td class="svelte-15ifth6">Time & index</td><td class="svelte-15ifth6"><code>ctx.time</code>, <code>ctx.bar_index</code></td><td class="svelte-15ifth6"><code>Number(ctx.bar_index)</code></td></tr><tr><td class="svelte-15ifth6">Inputs</td><td class="svelte-15ifth6"><code>ctx.input(name, default)</code></td><td class="svelte-15ifth6"><code>const len = ctx.input("Len", 20)</code></td></tr></tbody></table></div> <ul class="ss-list svelte-15ifth6"><li>Series arrays are available as <code>ctx.bar_index.data</code> (useful for last-bar checks).</li> <li>Convert to numbers when needed: <code>Number(ctx.close)</code>.</li></ul> <h3 id="js-history" class="svelte-15ifth6">History + NaN Rules</h3> <ul class="ss-list svelte-15ifth6"><li><code>ctx.hist(series, n)</code> only accepts integer <code>n &gt;= 0</code>.</li> <li>Out of range returns <code>NaN</code>.</li> <li>Use <code>Number.isFinite(x)</code> before plotting or using in conditions.</li> <li>Conditions accept number/boolean/string only; objects/arrays are errors.</li> <li><code>NaN</code> is treated as false inside conditions.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Guard warmup bars
const value = ta.ema(ctx.close, 20);
if (!Number.isFinite(value)) return;
plot(value, &#123; title: "EMA 20" &#125;);</code></pre> <h3 id="js-plots" class="svelte-15ifth6">Plots (line / area / histogram)</h3> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Core plots</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">plot</span> <span class="svelte-15ifth6">plotshape</span> <span class="svelte-15ifth6">plotchar</span> <span class="svelte-15ifth6">hline</span> <span class="svelte-15ifth6">fill</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Candle plots</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">plotcandle</span> <span class="svelte-15ifth6">plotohlc</span> <span class="svelte-15ifth6">plotbar</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Advanced types</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">neon_line</span> <span class="svelte-15ifth6">glow_points</span> <span class="svelte-15ifth6">bezier_line</span> <span class="svelte-15ifth6">cloud</span></div></div></div> <p class="ss-note svelte-15ifth6">Legends auto-stack. Hide a legend with <code>legend: false</code>, or move it using <code>legendPosition</code>/<code>legendOffsetX</code>/<code>legendOffsetY</code>.</p> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">Plot option</th><th class="svelte-15ifth6">Meaning</th><th class="svelte-15ifth6">Example</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>type</code></td><td class="svelte-15ifth6">Line/area/histogram/bar/candles/ohlc + advanced types.</td><td class="svelte-15ifth6"><code>&#123; type: "histogram" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>color</code> / <code>width</code></td><td class="svelte-15ifth6">Stroke color and width.</td><td class="svelte-15ifth6"><code>&#123; color: "#22c55e", width: 2 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>gradient</code></td><td class="svelte-15ifth6">Two-stop fill/stroke gradient for plots.</td><td class="svelte-15ifth6"><code>&#123; gradient: &#123; from: "rgba(56,189,248,.4)", to: "rgba(34,197,94,.2)", mode: "vertical" &#125; &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>offset</code></td><td class="svelte-15ifth6">Shift plot forward/backward by bars.</td><td class="svelte-15ifth6"><code>&#123; offset: -1 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>showLast</code></td><td class="svelte-15ifth6">Only show last N bars.</td><td class="svelte-15ifth6"><code>&#123; showLast: 100 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>trackPrice</code></td><td class="svelte-15ifth6">Show last value label at right axis.</td><td class="svelte-15ifth6"><code>&#123; trackPrice: true &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>pane</code></td><td class="svelte-15ifth6">Target pane (<code>"main"</code> or <code>"sub"</code>).</td><td class="svelte-15ifth6"><code>&#123; pane: "sub" &#125;</code></td></tr></tbody></table></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">plotshape styles</div> <p>cross, xcross, triangle_up, triangle_down, circle, square, diamond, star, arrow_up, arrow_down, flag, tag, pill, bubble, spark, box, box_gradient, label, text, circle_pulse, arrow_up_glow, arrow_down_glow, triangle_up_gradient, triangle_down_gradient.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">plotshape options</div> <p><code>size</code>, <code>location</code> (abovebar/belowbar/price), <code>offset</code>, <code>text</code>, <code>textcolor</code>, <code>bgGradient</code>, <code>tooltip</code>.</p></div></div> <h3 id="js-gradient" class="svelte-15ifth6">Gradients (plots + labels + boxes)</h3> <p class="ss-note svelte-15ifth6">Use a two-stop gradient object: <code>&#123; from, to, mode &#125;</code>. Supported modes: <code>"vertical"</code> (default), <code>"horizontal"</code>, <code>"radial"</code>.</p> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">How to use (step-by-step)</div> <ul class="ss-list svelte-15ifth6"><li>Pick the target API: <code>plot</code>, <code>plotcandle</code>, <code>plotshape</code>, <code>label.new</code>, <code>line.new</code>, <code>box.new</code>, <code>polygon.new</code>, <code>fill</code>.</li> <li>Build the gradient object: <code>&#123; from: "#...", to: "#...", mode: "vertical|horizontal|radial" &#125;</code>.</li> <li>Attach it to the right key (see table below).</li> <li>Keep gradients simple: two stops only for best performance.</li> <li>If a gradient looks flat, check pane scaling or set <code>includeInAutoscale: true</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Which key to use</div> <table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">API</th><th class="svelte-15ifth6">Gradient key</th><th class="svelte-15ifth6">Affects</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>plot</code></td><td class="svelte-15ifth6"><code>gradient</code></td><td class="svelte-15ifth6">Line/area/hist/dots/stepped/neon/bezier/cloud</td></tr><tr><td class="svelte-15ifth6"><code>plotcandle</code></td><td class="svelte-15ifth6"><code>gradient</code>, <code>downGradient</code></td><td class="svelte-15ifth6">Up/down candle bodies</td></tr><tr><td class="svelte-15ifth6"><code>plotshape</code> / <code>label.new</code></td><td class="svelte-15ifth6"><code>bgGradient</code></td><td class="svelte-15ifth6">Label background</td></tr><tr><td class="svelte-15ifth6"><code>line.new</code> / <code>polyline.new</code></td><td class="svelte-15ifth6"><code>gradient</code></td><td class="svelte-15ifth6">Stroke color</td></tr><tr><td class="svelte-15ifth6"><code>box.new</code></td><td class="svelte-15ifth6"><code>bgGradient</code></td><td class="svelte-15ifth6">Box fill</td></tr><tr><td class="svelte-15ifth6"><code>polygon.new</code></td><td class="svelte-15ifth6"><code>fillGradient</code></td><td class="svelte-15ifth6">Polygon fill</td></tr><tr><td class="svelte-15ifth6"><code>fill</code></td><td class="svelte-15ifth6"><code>fillGradient</code></td><td class="svelte-15ifth6">Band fill between two series</td></tr></tbody></table></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Plot gradient (line/area/hist)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const v = ta.ema(ctx.close, 20);
  plot(v, &#123;
    type: "area",
    color: "#60a5fa",
    gradient: &#123; from: "rgba(96,165,250,0.35)", to: "rgba(34,197,94,0.12)", mode: "vertical" &#125;
  &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Label / plotshape gradient</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const isBuy = Number(ctx.bar_index) % 25 === 5;
  plotshape(isBuy, &#123;
    style: "callout",
    text: "BUY",
    location: "belowbar",
    bgGradient: &#123; from: "#16a34a", to: "#22c55e", mode: "horizontal" &#125;
  &#125;);
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Candle gradient</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  plotcandle(ctx.open, ctx.high, ctx.low, ctx.close, &#123;
    color: "#22c55e",
    downColor: "#ef4444",
    gradient: &#123; from: "rgba(34,197,94,0.45)", to: "rgba(34,197,94,0.1)", mode: "vertical" &#125;,
    downGradient: &#123; from: "rgba(239,68,68,0.45)", to: "rgba(239,68,68,0.1)", mode: "vertical" &#125;
  &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Box gradient</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  box.new(ctx.bar_index - 10, ctx.high, ctx.bar_index, ctx.low, &#123;
    bgGradient: &#123; from: "rgba(56,189,248,0.25)", to: "rgba(14,116,144,0.12)", mode: "vertical" &#125;,
    borderColor: "#38bdf8"
  &#125;);
&#125;</code></pre></div></div> <h3 id="js-pane-scaling" class="svelte-15ifth6">Pane Scaling (important)</h3> <ul class="ss-list svelte-15ifth6"><li>Each pane has a single y-scale. If you plot very different magnitudes together, small series look flat.</li> <li>Example: <code>strategy.equity</code> (~10,000) vs <code>strategy.position_size</code> (~1).</li> <li>Solution: use <code>pane: "sub"</code> or normalize one series.</li></ul> <h3 id="js-autoscale" class="svelte-15ifth6">Autoscale Defaults</h3> <ul class="ss-list svelte-15ifth6"><li>Draw objects default to <code>includeInAutoscale: false</code> to avoid chart compression.</li> <li>Heatmaps in sub panes default to autoscale on.</li> <li>If a plot is off-screen, set <code>includeInAutoscale: true</code> or adjust pane.</li></ul> <h3 id="js-draw" class="svelte-15ifth6">Draw Tools (labels / lines / boxes)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Labels</div> <p><code>label.new</code> supports padding, wrap, tooltip, font, avoidOverlap.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Lines</div> <p><code>line.new</code> supports dashed/dotted, gradient, extend, glow.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Boxes</div> <p><code>box.new</code> supports borders, text, and background fill/gradient.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polylines / Polygons</div> <p><code>polyline.new</code> / <code>polygon.new</code> support glow + gradients.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Tables</div> <p><code>table.new</code> / <code>table.cell</code> for small dashboards.</p></div></div> <ul class="ss-list svelte-15ifth6"><li>Draw objects default to <code>includeInAutoscale: false</code>.</li> <li>Use <code>layer</code> + <code>zIndex</code> for draw order.</li> <li>Use <code>timestamp + value</code> for overlays to avoid index misalignment.</li> <li>Lock tool locks existing drawings; starting a new draw auto-unlocks for editing.</li> <li>Floating lock toggles only the selected drawing and stays locked until unlocked there.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Label options (common)</div> <p>bgcolor, bgGradient, borderColor, borderWidth, padding, wrap, maxWidth, align, valign, textAlign, fontFamily, fontSize, fontWeight, lineHeight, radius, tooltip, layer, zIndex, includeInAutoscale, xloc, yloc, avoidOverlap, collision.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Line options (common)</div> <p>color, gradient, width, style (solid/dashed/dotted), glow, glowColor, glowOpacity, extend, xloc, layer, zIndex, includeInAutoscale.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polygon options (common)</div> <p>fillColor, fillGradient (vertical/horizontal/radial), strokeColor, strokeWidth, strokeStyle, opacity, glow, glowColor, glowOpacity, layer, zIndex, includeInAutoscale.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Box + table options</div> <p>box: border_color, border_width, border_style, bgcolor, bgGradient, text, text_halign, text_valign, text_wrap, extend, xloc. table: bgcolor, frameColor, frameWidth, borderColor, borderWidth, text_color, text_halign, text_valign, text_size.</p></div></div> <h4 id="js-polyline-polygon">Polylines / Polygons (step-by-step)</h4> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polyline step-by-step</div> <ul class="ss-list svelte-15ifth6"><li>Choose points in bar_index + price (or time + price).</li> <li>Call <code>polyline.new</code> with points and options.</li> <li>Use <code>polyline.set_points</code> if you want to update it.</li> <li>Per-bar color changes require segments (one handle per segment).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const i = Number(ctx.bar_index);
  polyline.new(
    &#123; x: i - 3, y: Number(ctx.low) &#125;,
    &#123; x: i, y: Number(ctx.high) &#125;,
    &#123; x: i + 3, y: Number(ctx.low) &#125;,
    &#123; color: "#22c55e", width: 2, includeInAutoscale: false &#125;
  );
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polygon step-by-step</div> <ul class="ss-list svelte-15ifth6"><li>Use at least 3 points (closed shape).</li> <li>Call <code>polygon.new</code> with points and fill/stroke options.</li> <li>Curves: use fractional x values (ex: <code>i + 0.25</code>) or keep shapes wide enough (8-12 bars).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const i = Number(ctx.bar_index);
  polygon.new(
    &#123; x: i - 3, y: Number(ctx.low) &#125;,
    &#123; x: i, y: Number(ctx.high) &#125;,
    &#123; x: i + 3, y: Number(ctx.low) &#125;,
    &#123;
      fillColor: "rgba(56,189,248,0.25)",
      strokeColor: "#38bdf8",
      strokeWidth: 2,
      includeInAutoscale: false
    &#125;
  );
&#125;</code></pre></div></div> <h3 id="js-overlays" class="svelte-15ifth6">Overlay Templates</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay rules</div> <ul class="ss-list svelte-15ifth6"><li>Prefer <code>&#123;timestamp, value&#125;</code> points for stable alignment.</li> <li>Draw overlays on the last bar so they update cleanly.</li> <li>Use <code>extendData</code> for template-specific settings.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Fibonacci example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;
  overlay.new("fibonacciSegment", [
    &#123; timestamp: Number(ctx.hist(ctx.time, 1)), value: Number(ctx.hist(ctx.low, 1)) &#125;,
    &#123; timestamp: Number(ctx.hist(ctx.time, 0)), value: Number(ctx.hist(ctx.high, 0)) &#125;,
  ], &#123;
    extendData: &#123;
      labelSide: "left",
      labelOffset: 16,
      labelAlign: "right",
      fibonacciLevels: [
        &#123; value: 0, color: "#64748b", label: "0", visible: true &#125;,
        &#123; value: 0.382, color: "#60a5fa", label: "0.382", visible: true &#125;,
        &#123; value: 0.5, color: "#22c55e", label: "0.5", visible: true &#125;,
        &#123; value: 0.618, color: "#f59e0b", label: "0.618", visible: true &#125;,
        &#123; value: 1, color: "#64748b", label: "1", visible: true &#125;,
      ],
    &#125;
  &#125;);
&#125;</code></pre></div></div> <ul class="ss-list svelte-15ifth6"><li>Create with <code>overlay.new(name, points, opts)</code>.</li> <li>Update with <code>overlay.set_points(handle, points)</code>.</li> <li>Points can be pairs (<code>[index, value]</code>) or objects (<code>&#123; index, value &#125;</code>).</li> <li>Common templates: <code>rect</code>, <code>circle</code>, <code>triangle</code>, <code>parallelogram</code>, <code>arrow</code>, <code>text</code>, <code>emoji</code>.</li> <li>Fibonacci: <code>fibonacciSegment</code>, <code>fibonacciExtension</code>, <code>fibonacciCircle</code>, <code>fibonacciSpiral</code>, <code>fibonacciSpeedResistanceFan</code>.</li> <li>Other: <code>horizontalStraightLine</code>, <code>horizontalRayLine</code>, <code>ruler</code>, <code>trade</code>, <code>note</code>, <code>barSignal</code>, <code>gannBox</code>, <code>pointAndFigure</code>.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Point fields</div> <p>index, timestamp, value, source, pivot, extreme, lookback, left, right, which.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Fibonacci labels</div> <p><code>extendData.labelSide</code>, <code>labelOffset</code>, <code>labelAlign</code>, <code>fibonacciLevels</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Guardrails</div> <p>Max overlays and total overlay points are capped to protect performance.</p></div></div> <h3 id="js-interaction" class="svelte-15ifth6">Interaction</h3> <ul class="ss-list svelte-15ifth6"><li>Drag: line, polyline, polygon, path, box, label.</li> <li>Resize: box (edge/corner handles).</li> <li>Draw objects + plots render behind by default; hover lifts them to the foreground.</li> <li>Hover priority: draw/overlay hits take precedence over series hover.</li> <li>Click a candle or plot line/bar to place selection markers every 6 bars (auto‑throttled), with a brighter dot on the selected bar. Click empty space to clear.</li> <li>Snap: hold Alt to disable; hold Shift to lock axis; arrows to nudge.</li> <li>Edits are session-scoped (no script callbacks yet).</li></ul> <h3 id="js-heatmap" class="svelte-15ifth6">Heatmap</h3> <ul class="ss-list svelte-15ifth6"><li>Create once in <code>onInit</code> using <code>heatmap.new</code>.</li> <li>Push points every bar with <code>heatmap.push</code>.</li> <li>Use <code>heatmap.set_grid</code> to adjust bin sizes.</li></ul> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">Option</th><th class="svelte-15ifth6">Meaning</th><th class="svelte-15ifth6">Example</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>pane</code></td><td class="svelte-15ifth6">Target pane (<code>"sub"</code> recommended for heatmaps).</td><td class="svelte-15ifth6"><code>&#123; pane: "sub" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>xloc</code> / <code>yloc</code></td><td class="svelte-15ifth6">Coordinate system: <code>bar_index</code> or <code>time</code>; <code>price</code> for y.</td><td class="svelte-15ifth6"><code>&#123; xloc: "bar_index" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>xBinPx</code> / <code>yBinPx</code></td><td class="svelte-15ifth6">Bin size in pixels (LOD scales up when zoomed out).</td><td class="svelte-15ifth6"><code>&#123; xBinPx: 6, yBinPx: 6 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>agg</code></td><td class="svelte-15ifth6">Aggregation: sum/avg/max/min.</td><td class="svelte-15ifth6"><code>&#123; agg: "avg" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>blend</code> / <code>opacity</code></td><td class="svelte-15ifth6">Blend mode and opacity for visuals.</td><td class="svelte-15ifth6"><code>&#123; blend: "screen", opacity: 0.85 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>colormap</code></td><td class="svelte-15ifth6">Color ramp with stops.</td><td class="svelte-15ifth6"><code>&#123; colormap: [&#123; stop: 0, color: "#0f172a" &#125;] &#125;</code></td></tr></tbody></table></div> <ul class="ss-list svelte-15ifth6"><li>Use <code>heatmap.setGrid</code> (alias) to update bins after creation.</li> <li>Heatmap points are capped; exceeding the cap emits a warning.</li> <li>Heatmaps redraw on zoom/scroll and stay aligned to candles.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>let hm;
export function onInit() &#123;
  hm = heatmap.new(&#123; id: "hm", pane: "sub", xBinPx: 6, yBinPx: 6, agg: "avg" &#125;);
&#125;
export function onBar(ctx) &#123;
  heatmap.push(hm, Number(ctx.bar_index), Number(ctx.close), Number(ctx.volume));
&#125;</code></pre> <h3 id="js-webgl" class="svelte-15ifth6">WebGL Runtime</h3> <ul class="ss-list svelte-15ifth6"><li>Heatmaps use WebGL by default for performance (Canvas fallback if needed).</li> <li>WebGL accelerates polylines/polygons when available.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap raster (WebGL)</div> <p>Bins are rasterized in GPU tiles; zooming out increases bin size for speed.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Primitives (WebGL)</div> <p>Lines/polylines/polygons render in GPU for smooth zoom/scroll.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Glow</div> <p>Glow may render via Canvas for stability; outline stays crisp.</p></div></div> <h3 id="js-strategy" class="svelte-15ifth6">Strategy & Backtest</h3> <ul class="ss-list svelte-15ifth6"><li>Signals evaluate on bar close; market fills next bar open.</li> <li>Enable intrabar fills with <code>execution: "intrabar_ohlc"</code>.</li> <li>Order kinds include <code>market/limit/stop/stop_limit/mit/lit/trailing_stop</code> (use <code>kind</code>).</li> <li>Use <code>tif: "gtc" | "ioc" | "fok"</code> to control time-in-force.</li> <li><code>fillMode: "volume"</code> enables partial fills (use <code>volumeFillPct</code>).</li> <li>Use <code>strategy.entry/exit/close</code> and plot equity in a sub pane.</li> <li>Accessors like <code>strategy.equity</code> are for plots (not entry logic).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = fast &gt; slow;
  const crossDown = fast &lt; slow;
  strategy.entry("L", strategy.long, &#123; when: crossUp, qty: 1 &#125;);
  strategy.exit("L", &#123; stop: Number(ctx.close) * 0.98, limit: Number(ctx.close) * 1.03 &#125;);
  strategy.close("L", &#123; when: crossDown &#125;);
&#125;</code></pre> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Order types</div> <p>market/limit/stop/stop_limit + MIT/LIT + trailing_stop. Use <code>kind</code> to override.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Sizing</div> <p><code>strategy.config(&#123; orderSize: &#123; type, value &#125; &#125;)</code> for default sizing.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Partial fills</div> <p>Enable <code>fillMode: "volume"</code> and set <code>volumeFillPct</code> (ex: 50).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Risk caps</div> <p><code>max_drawdown</code>, <code>max_position_size</code>, <code>max_intraday_loss</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Costs</div> <p><code>commissionType</code> + <code>commissionPct/commissionCash/commissionPerUnit</code>, <code>slippageType</code> + <code>slippagePct/slippageAbs/slippageTicks</code>.</p></div></div> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">Accessor (plot only)</th><th class="svelte-15ifth6">Meaning</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>strategy.position_size</code></td><td class="svelte-15ifth6">Current position size.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.position_avg_price</code></td><td class="svelte-15ifth6">Average entry price.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.equity</code></td><td class="svelte-15ifth6">Equity curve.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.net_profit</code></td><td class="svelte-15ifth6">Total net profit.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.trades</code></td><td class="svelte-15ifth6">Number of completed trades.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.win_rate</code></td><td class="svelte-15ifth6">Win percentage.</td></tr></tbody></table></div> <ul class="ss-list svelte-15ifth6"><li>Trade arrays: <code>strategy.closedtrades.&lt;field&gt;(offset)</code> and <code>strategy.opentrades.&lt;field&gt;(offset)</code>.</li> <li>Fields include <code>profit/net_profit/fees</code>, <code>entry_fee</code>, and <code>exit_fee</code> (closed only).</li> <li>Accessors are computed after backtest; do not use for signals.</li></ul> <h3 id="js-alerts" class="svelte-15ifth6">Alerts (JS)</h3> <ul class="ss-list svelte-15ifth6"><li>Use <code>alertcondition</code> to register alert rules.</li> <li>Use <code>alert</code> for quick, message-based alerts.</li> <li>Provide a stable <code>id</code> or <code>title</code> so the rule persists.</li> <li>Frequency: <code>once</code>, <code>once_per_bar</code>, <code>once_per_bar_close</code>.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = Number(fast) &gt; Number(slow);

  alertcondition(crossUp, "EMA Cross Up", "Fast EMA crossed above slow", &#123;
    id: "ema_cross_up",
    frequency: "once_per_bar",
  &#125;);

  alert("Momentum check", &#123;
    when: Number(ctx.bar_index) % 50 === 0,
    id: "pulse",
  &#125;);
&#125;</code></pre> <h3 id="js-mtf" class="svelte-15ifth6">Multi-Timeframe</h3> <ul class="ss-list svelte-15ifth6"><li>Use <code>request.security(tf, expr, opts)</code> and <code>request.security_lower_tf</code> for HTF/LTF series (multi-symbol supported).</li> <li>Define <code>expr</code> outside <code>onBar</code> to avoid call limits.</li> <li>Nested calls are allowed with a depth guardrail (default 6); lower TF requires datafeed coverage.</li> <li>Alignment defaults to previous bar; use <code>lookahead</code> for same-bar values.</li> <li><code>gaps: true</code> leaves gaps when HTF bars do not align.</li> <li>Invalid timeframe strings throw a deterministic error.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Options</div> <p><code>lookahead</code>, <code>gaps</code>, <code>timezone</code>, <code>session</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Timeframes</div> <p>Supports seconds (ex: <code>30s</code>) and higher TF strings like <code>240</code>, <code>1D</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Limits</div> <p>Call limit per script run is enforced (default 20).</p></div></div> <h4 class="ss-subtitle">MTF step-by-step</h4> <ol class="ss-list svelte-15ifth6"><li><strong>Pick your TFs:</strong> Chart TF is the base. Use HTF with <code>request.security</code> and LTF with <code>request.security_lower_tf</code>.</li> <li><strong>Define expressions once:</strong> Put <code>expr</code> outside <code>onBar</code> to avoid reallocation and call limits.</li> <li><strong>Call from onBar:</strong> Use the same <code>expr</code> function every bar for stable caching.</li> <li><strong>Wait for coverage:</strong> If the status says "Loading request.security...", wait for data to finish loading.</li> <li><strong>Handle errors:</strong> "No data" means the symbol/timeframe is not available. "Lower TF must be lower" means your request TF is not smaller than the chart TF.</li> <li><strong>Multi-symbol:</strong> Use real tickers available in your datafeed. Missing symbols will error deterministically.</li> <li><strong>Nesting:</strong> Nested calls are allowed but capped at depth 6; keep nesting shallow for performance.</li></ol> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">HTF example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const htfCloseExpr = (s) =&gt; s.close;
export function onBar(ctx) &#123;
  const htf = request.security("240", htfCloseExpr);
  plot(htf, &#123; title: "HTF Close" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">LTF example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const ltfCloseExpr = (s) =&gt; s.close;
export function onBar(ctx) &#123;
  const ltf = request.security_lower_tf("5", ltfCloseExpr);
  plot(ltf, &#123; title: "LTF Close" &#125;);
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Multi-symbol example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const closeExpr = (s) =&gt; s.close;
export function onBar(ctx) &#123;
  const sym = ctx.input("Symbol", "");
  const src = sym ? request.security(sym, "240", closeExpr)
                  : request.security("240", closeExpr);
  plot(src, &#123; title: "Symbol HTF" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Common errors</div> <ul class="ss-list svelte-15ifth6"><li><code>no data</code>: symbol/timeframe not available in datafeed.</li> <li><code>must be lower</code>: LTF request is not smaller than chart TF.</li> <li><code>call limit</code>: too many <code>request.security</code> calls.</li></ul></div></div> <h3 id="js-datafeed" class="svelte-15ifth6">Datafeed Parity (Session/Timezone/Adjust)</h3> <ul class="ss-list svelte-15ifth6"><li>Symbol metadata is sourced from the datafeed when available: <code>timezone</code>, <code>session</code>, <code>sessionExtended</code>, <code>tickSize</code>, <code>lotSize</code>, <code>contractSize</code>.</li> <li>Session mode (chart-level): <code>regular</code> (default), <code>extended</code>, or <code>all</code> (24x7).</li> <li>Corporate actions: <code>adjustMode</code> can be <code>none</code>, <code>split</code>, <code>dividend</code>, or <code>all</code> (applies before scripts run).</li> <li>Advanced: chart config can set <code>options.datafeed.sessionMode</code> / <code>options.datafeed.adjustMode</code>.</li> <li>Timezone resolution: symbol timezone → session timezone → chart timezone → UTC.</li> <li>Per-call overrides: <code>request.security(..., &#123; session, timezone &#125;)</code> for alignment control.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Why it matters</div> <p>Session windows control gaps/alignments, timezone affects bucket boundaries, and adjustments keep history consistent across splits/dividends.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Defaults</div> <p><code>sessionMode: "regular"</code>, <code>adjustMode: "none"</code>. Datafeed metadata overrides apply automatically when present.</p></div></div> <h3 id="js-stdlib" class="svelte-15ifth6">Stdlib</h3> <ul class="ss-list svelte-15ifth6"><li><code>ta.*</code>: moving averages, oscillators, volatility, volume, pivots, trend tools.</li> <li><code>math.*</code>: trig/log/pow, clamp, mod/fmod, sum/avg, isfinite/isnan.</li> <li><code>color.*</code>: rgb/rgba/hsl/hsv, gradients, blend/mix, alpha + channel helpers.</li> <li><code>str.*</code>: format, replace, trim, split/join, substring, casing.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">MA family</div> <p>sma, ema, wma, rma, vwma, dema, tema, hma, kama, alma, t3, trima, swma, evwma.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Oscillators</div> <p>rsi, stoch, stochrsi, cmo, roc, mom, tsi, ppo, trix, ao, zscore.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Volatility & ranges</div> <p>tr, atr, atrp, natr, bbands, bbw, donchian, keltner.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Trend tools</div> <p>dmi, adx, aroon, aroonosc, vortex, supertrend, sar, linreg, linreg_slope, linreg_intercept, linreg_angle.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Volume</div> <p>obv, ad, cmf, pvi, nvi.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Helpers</div> <p>sum, highest, lowest, pivot/pivot_points, pivothigh, pivotlow, rising, falling, cross, crossover, crossunder, valuewhen.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strings</div> <p>length, upper/lower, trim, contains, starts/ends, replace, split/join, substring, format.</p></div></div> <h3 id="js-api" class="svelte-15ifth6">JS API Index</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Core</div> <p><code>onInit</code>, <code>onBar</code>, <code>ctx.input</code>, <code>ctx.hist</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Plots</div> <p><code>plot</code>, <code>plotshape</code>, <code>plotchar</code>, <code>plotcandle</code>, <code>plotbar</code>, <code>plotohlc</code>, <code>hline</code>, <code>fill</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Draw</div> <p><code>label.new</code>, <code>line.new</code>, <code>box.new</code>, <code>polyline.new</code>, <code>polygon.new</code>, <code>table.new</code>, <code>table.cell</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay</div> <p><code>overlay.new</code>, <code>overlay.set</code>, <code>overlay.set_points</code>, <code>overlay.delete</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap</div> <p><code>heatmap.new</code>, <code>heatmap.push</code>, <code>heatmap.clear</code>, <code>heatmap.set_grid</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strategy</div> <p><code>strategy.config</code>, <code>strategy.entry</code>, <code>strategy.exit</code>, <code>strategy.close</code>, <code>strategy.cancel</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Alerts</div> <p><code>alertcondition</code>, <code>alert</code> (rules feed the Alerts Center).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">MTF</div> <p><code>request.security</code> / <code>request.security_lower_tf</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Builtins</div> <p><code>ta.*</code>, <code>math.*</code>, <code>color.*</code>, <code>str.*</code>.</p></div></div> <h3 id="js-performance" class="svelte-15ifth6">Performance</h3> <ul class="ss-list svelte-15ifth6"><li>Keep loops small; avoid heavy allocations per bar.</li> <li>Reuse handles instead of recreating shapes every bar.</li> <li>Prefer heatmap for dense visuals.</li> <li>Define MTF expressions once to reduce call overhead.</li> <li>Use sub panes for large-magnitude series (equity vs size).</li> <li>WebGL is used automatically for heatmaps and can accelerate primitives.</li> <li>Rendering is coalesced per frame; redundant redraws are merged.</li> <li>For large data, limit custom loops to the visible window when possible.</li></ul> <h3 id="js-safety" class="svelte-15ifth6">Limits & Safety</h3> <ul class="ss-list svelte-15ifth6"><li>Loop iterations and per-bar runtime are capped.</li> <li>Draw ops per bar are capped (extra calls are skipped with a warning).</li> <li><code>Date</code>, <code>Math.random</code>, <code>performance.now</code> are blocked.</li> <li>Network/timers/DOM APIs are blocked.</li> <li>Diagnostics include warning vs error severity in the Issues panel.</li> <li>Plots that are all NaN/undefined emit a warning.</li> <li>Conditions accept number/boolean/string only.</li> <li>JS mode does not implement Pine syntax or semantics.</li></ul> <h3 id="js-guardrails" class="svelte-15ifth6">Guardrails (always on)</h3> <ul class="ss-list svelte-15ifth6"><li>Loop iteration caps prevent infinite loops.</li> <li>Per-bar time budget prevents UI freezes.</li> <li>Total runtime cap prevents long scripts from blocking the UI.</li> <li>Output caps limit plots and draw ops.</li> <li>Draw ops are capped per bar; extra draw calls are skipped with a warning.</li> <li>Diagnostics include warning vs error severity (non-fatal errors may still render).</li> <li>Plots that are all NaN/undefined emit a warning.</li> <li>AST-based loop guards are injected into <code>for/while/do</code> blocks.</li> <li><code>eval</code>, <code>Function</code>, <code>import</code> are blocked.</li> <li><code>Date</code>, <code>Math.random</code>, <code>performance.now</code> are blocked.</li> <li>Environment globals blocked: <code>window</code>, <code>document</code>, <code>globalThis</code>, <code>self</code>, <code>navigator</code>, <code>location</code>, <code>crypto</code>.</li> <li>Network/timer APIs blocked: <code>fetch</code>, <code>WebSocket</code>, <code>setTimeout</code>, <code>setInterval</code>.</li></ul> <h3 id="js-rules" class="svelte-15ifth6">JS Rules (Exact Behavior)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Execution model</div> <ul class="ss-list svelte-15ifth6"><li><code>onInit</code> runs once before the first bar.</li> <li><code>onBar</code> runs oldest → newest.</li> <li>Global variables persist across bars.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Series + history</div> <ul class="ss-list svelte-15ifth6"><li>Use <code>ctx.open/high/low/close/volume/time/bar_index</code>.</li> <li><code>ctx.hist(series, n)</code> requires integer <code>n &gt;= 0</code>.</li> <li>Out-of-range returns <code>NaN</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">NaN + conditions</div> <ul class="ss-list svelte-15ifth6"><li><code>NaN</code> propagates through math.</li> <li><code>NaN</code> is false in conditions.</li> <li>Only number/boolean/string conditions allowed.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Plot + fill semantics</div> <ul class="ss-list svelte-15ifth6"><li><code>plot()</code> returns a series handle.</li> <li><code>fill(a, b)</code> accepts handles or constants.</li> <li>Calling <code>fill()</code> every bar stacks opacity; guard it when possible.</li> <li>Series used by <code>fill()</code> should be plotted every bar to avoid wedge shapes.</li> <li><code>fill()</code> supports <code>fillGradient</code> using <code>&#123; from, to, mode &#125;</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Layering</div> <ul class="ss-list svelte-15ifth6"><li>Layers: background → main → overlay → ui.</li> <li>Higher <code>zIndex</code> draws on top.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">MTF rules</div> <ul class="ss-list svelte-15ifth6"><li><code>request.security</code> / <code>request.security_lower_tf</code> (multi-symbol).</li> <li>Nested calls allowed with a depth guardrail (default 6).</li> <li>Lower TF requires datafeed coverage.</li> <li>Call limit enforced per run.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strategy fills</div> <ul class="ss-list svelte-15ifth6"><li>Signals on bar close; fills next bar open.</li> <li>Brackets attach to entries.</li> <li>Accessors are plot-only after backtest.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Draw autoscale</div> <ul class="ss-list svelte-15ifth6"><li>Draw objects default to <code>includeInAutoscale: false</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Draw styling</div> <ul class="ss-list svelte-15ifth6"><li>Glow supported on line/polyline/polygon.</li> <li>Polygon gradients: vertical/horizontal/radial.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay templates</div> <ul class="ss-list svelte-15ifth6"><li>Points accept index/time/value fields.</li> <li>Overlay count/points are capped.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap rules</div> <ul class="ss-list svelte-15ifth6"><li>Bins in pixels; LOD scales when zoomed out.</li> <li>Points are capped; warnings on overflow.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Diagnostics</div> <ul class="ss-list svelte-15ifth6"><li>Warnings vs errors in Issues panel.</li> <li>All-NaN plots emit a warning.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Determinism + sandbox</div> <ul class="ss-list svelte-15ifth6"><li><code>Date</code>, <code>Math.random</code>, <code>performance.now</code> blocked.</li> <li>No DOM/network/timers/async APIs.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Stdlib scope</div> <ul class="ss-list svelte-15ifth6"><li>Only <code>ta.*</code>, <code>math.*</code>, <code>color.*</code> exposed.</li> <li>Strings/arrays use native JS methods.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Compatibility</div> <ul class="ss-list svelte-15ifth6"><li>JS mode is not Pine; features not listed are undefined.</li></ul></div></div> <h3 id="js-troubleshoot" class="svelte-15ifth6">Troubleshooting</h3> <ul class="ss-list svelte-15ifth6"><li>JSON syntax error: switch editor mode to JS.</li> <li>Nothing renders: confirm <code>plot()</code> or draw APIs are called.</li> <li>Overlay invisible: use <code>&#123; index, value &#125;</code> points.</li> <li>Chart compresses: set <code>includeInAutoscale: false</code>.</li> <li>MTF errors: check timeframe string and call limits.</li> <li>Heatmap blank: ensure <code>heatmap.push</code> is called each bar.</li> <li>All NaN: add warmup guard with <code>Number.isFinite</code>.</li> <li>Plot overlap: use <code>pane: "sub"</code> for mixed magnitudes.</li> <li><code>__js_draw_stub__</code> label: draw-only scripts auto-add an invisible plot to keep the pane alive. Hide it by adding <code>plot(ctx.close, &#123; color: "rgba(0,0,0,0)", width: 0, legend: false, title: "" &#125;)</code>. Note: keep the stub if your script has only draw calls; hide it if you already plot a series or want a clean legend.</li></ul> <h3 id="js-examples" class="svelte-15ifth6">Examples to run</h3> <p class="ss-note svelte-15ifth6">Examples tab → JS Examples</p> <ul class="ss-list svelte-15ifth6"><li><strong>JS basic plot:</strong> minimal indicator baseline.</li> <li><strong>JS draw tools demo:</strong> label/line/box/table usage.</li> <li><strong>JS heatmap raster:</strong> sub-pane heatmap + EMA.</li> <li><strong>JS overlay templates:</strong> rect/fib overlays.</li> <li><strong>JS primitives (glow + gradient):</strong> WebGL primitives showcase.</li> <li><strong>JS strings + color utils:</strong> str.format + color blend/hsl helpers.</li> <li><strong>JS strategy basic/advanced/accessors:</strong> entries, exits, equity plotting.</li> <li><strong>JS MTF (HTF/LTF/multi-symbol):</strong> request.security examples.</li> <li><strong>JS plot advanced:</strong> plot types + fill + hline.</li> <li><strong>JS draw options parity:</strong> style-rich draw options.</li></ul> <h3 id="js-status" class="svelte-15ifth6">Status</h3> <p class="ss-note svelte-15ifth6">JS mode is stable for indicators, visuals, strategies, and MTF (HTF/LTF + multi-symbol).
              Ensure the datafeed covers requested symbols/timeframes and watch the Issues panel for guardrail warnings.</p></section>`),soe=ke('<div class="ss-loading svelte-15ifth6">Loading examples...</div>'),ooe=ke('<article class="ss-example-card svelte-15ifth6"><div class="ss-example-card-head svelte-15ifth6"><div><h4 class="svelte-15ifth6"> </h4> <p class="svelte-15ifth6"> </p></div></div> <pre class="ss-code ss-code-small svelte-15ifth6"><code> </code></pre> <div class="ss-example-actions svelte-15ifth6"><button class="ss-btn svelte-15ifth6" type="button">Copy</button> <button class="ss-btn primary svelte-15ifth6" type="button">Use in Editor</button></div></article>'),ioe=ke('<div class="ss-empty svelte-15ifth6">No examples match your search.</div>'),roe=ke('<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-examples-toolbar svelte-15ifth6"><div class="ss-tabs svelte-15ifth6" role="tablist" aria-label="Example formats"><button role="tab" type="button" data-examples-tab="json">JSON Examples</button> <button role="tab" type="button" data-examples-tab="dsl">DSL Examples</button> <button role="tab" type="button" data-examples-tab="pine">Pine Examples</button> <button role="tab" type="button" data-examples-tab="js">JS Examples</button></div> <input class="ss-search svelte-15ifth6" type="search" placeholder="Search examples"></div> <!> <div class="ss-examples-grid svelte-15ifth6"></div> <!></section>'),aoe=ke('<div class="ss-toast svelte-15ifth6" role="status"> </div>'),loe=ke('<div class="ss-guide-backdrop svelte-15ifth6" role="dialog" aria-modal="true" aria-labelledby="ss-guide-title"><div class="ss-guide-modal svelte-15ifth6"><div class="ss-guide-header svelte-15ifth6"><div><h2 id="ss-guide-title" class="svelte-15ifth6">Script Studio Documentation</h2> <p class="ss-guide-subhead svelte-15ifth6">Write indicators and drawings with JSON, DSL, Pine, or JS scripts.</p></div> <button class="ss-guide-close svelte-15ifth6" type="button" aria-label="Close guide">&times;</button></div> <div class="ss-tabs svelte-15ifth6" role="tablist" aria-label="Documentation tabs"><button role="tab" type="button" data-tab="json">JSON</button> <button role="tab" type="button" data-tab="dsl">DSL</button> <button role="tab" type="button" data-tab="pine">Pine</button> <button role="tab" type="button" data-tab="js">JS</button> <button role="tab" type="button" data-tab="examples">Examples</button></div> <div class="ss-guide-body svelte-15ifth6"><!></div> <!></div></div>');function coe(n,e){Ed(e,!1);const t=id();let s=hi(e,"show",8,!1);const o=Fh();let r=id("json"),a=id(null),l=id("json"),c=id(""),f=id(""),u=id(!1);const d=[...Iw].sort(),h=[...Pw].sort(),m=[...Mw].sort(),g=[{id:"dsl-signal-label",title:"DSL signal + label",format:"dsl",description:"Simple series, a signal, and two labels for top/bot conditions.",code:`fast = ema(close, 10)
slow = ema(close, 20)

signal buy when (fast crossesAbove slow) score:8 cooldown:5
signal sell when (fast crossesBelow slow) score:6

label at top when (fast crossesAbove slow) text:"BUY" color:#16a34a
label at bot when (fast crossesBelow slow) text:"SELL" color:#ef4444`},{id:"dsl-fractal",title:"DSL fractal tops/bots",format:"dsl",description:"Highest/lowest window with labels at turning points.",code:`win = 5
hi = highest(close, win)
lo = lowest(close, win)

signal top when (close == hi)
signal bot when (close == lo)

label at top when (close == hi) text:"TOP" color:#f59e0b
label at bot when (close == lo) text:"BOT" color:#3b82f6`}];let w=id({json:[],pine:[],dsl:g,js:Yse}),C=!1,P=!1,I=id({json:!1,pine:!1,dsl:!1,js:!1}),A={json:!1,pine:!1,dsl:!0,js:!0};function M(){o("close")}function F(){i(a)&&f0(a,i(a).scrollTop=0)}function B($e){i(r)!==$e&&(x(r,$e),F(),$e==="examples"&&ue(i(l)))}function $($e){var qe,nt,ft;const ze=(nt=(qe=$e.target)==null?void 0:qe.closest)==null?void 0:nt.call(qe,"[data-tab]"),Ke=(ft=ze==null?void 0:ze.dataset)==null?void 0:ft.tab;Ke&&B(Ke)}function L($e){i(l)!==$e&&(x(l,$e),F(),ue($e))}function O($e){var qe,nt,ft;const ze=(nt=(qe=$e.target)==null?void 0:qe.closest)==null?void 0:nt.call(qe,"[data-examples-tab]"),Ke=(ft=ze==null?void 0:ze.dataset)==null?void 0:ft.examplesTab;Ke&&L(Ke)}function Y($e){return String($e||"").replace(/\\r\\n/g,`
`).replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"')}async function ce($e){const ze=Y($e);try{await navigator.clipboard.writeText(ze),Q("Copied to clipboard");return}catch{}try{const Ke=document.createElement("textarea");Ke.value=ze,Ke.setAttribute("readonly","true"),Ke.style.position="absolute",Ke.style.left="-9999px",document.body.appendChild(Ke),Ke.select(),document.execCommand("copy"),document.body.removeChild(Ke),Q("Copied to clipboard")}catch{Q("Copy failed")}}function Q($e){x(f,$e),x(u,!0),window.clearTimeout(Q._t),Q._t=window.setTimeout(()=>{x(u,!1)},2e3)}async function le(){if(C||P)return;P=!0;const $e=await Bg(()=>import("../chunks/registry.BdqBMTdh.js"),[],import.meta.url);x(w,{...i(w),json:$e.jsonExamples||[],pine:$e.pineExamples||[]}),C=!0,P=!1}async function ue($e){A[$e]||i(I)[$e]||(x(I,{...i(I),[$e]:!0}),$e!=="dsl"&&$e!=="js"&&await le(),A={...A,[$e]:!0},x(I,{...i(I),[$e]:!1}))}function fe($e){o("insert",{code:$e.code,mode:$e.format})}const pe=a_(),[Z,xe]=pe;nm(()=>(i(r),i(l)),()=>{i(r)==="examples"&&ue(i(l))}),nm(()=>(i(r),i(l),i(w)),()=>{i(r)==="examples"&&i(l)==="dsl"&&x(w,{...i(w),dsl:g})}),nm(()=>(i(w),i(l),i(c)),()=>{x(t,(()=>{const $e=i(w)[i(l)]||[],ze=i(c).trim().toLowerCase();return ze?$e.filter(Ke=>`${Ke.title} ${Ke.description}`.toLowerCase().includes(ze)):$e})())}),x0(),rv();var oe=Qn(),Pe=fn(oe);Ue(Pe,s,$e=>{var ze=loe(),Ke=y(ze),qe=y(Ke),nt=v(y(qe),2);_(qe);var ft=v(qe,2),ut=y(ft),bt=v(ut,2),Pt=v(bt,2),Et=v(Pt,2),Mt=v(Et,2);_(ft);var Je=v(ft,2),Ct=y(Je);Ue(Ct,()=>i(r)==="json",Xe=>{var Ae=Qse(),Qe=y(Ae),gt=y(Qe);Ce(()=>Ot(gt,"href",Z("#json-what",void 0)));var Ft=v(gt,2);Ce(()=>Ot(Ft,"href",Z("#json-quick",void 0)));var ot=v(Ft,2);Ce(()=>Ot(ot,"href",Z("#json-core",void 0)));var ve=v(ot,2);Ce(()=>Ot(ve,"href",Z("#json-supported",void 0)));var Ie=v(ve,2);Ce(()=>Ot(Ie,"href",Z("#json-limits",void 0)));var It=v(Ie,2);Ce(()=>Ot(It,"href",Z("#json-mistakes",void 0)));var Dt=v(It,2);Ce(()=>Ot(Dt,"href",Z("#json-mini",void 0))),_(Qe);var Zt=v(Qe,16),gn=y(Zt),hn=v(y(gn),2);Yo(hn,5,()=>d,Ii,(_o,xs)=>{var Rt=Kse(),un=y(Rt,!0);_(Rt),Ce(()=>tt(un,i(xs))),q(_o,Rt)}),_(hn),_(gn);var qn=v(gn,2),On=v(y(qn),2);Yo(On,5,()=>h,Ii,(_o,xs)=>{var Rt=Xse(),un=y(Rt,!0);_(Rt),Ce(()=>tt(un,i(xs))),q(_o,Rt)}),_(On),_(qn);var bn=v(qn,2),Fn=v(y(bn),2);Yo(Fn,5,()=>m,Ii,(_o,xs)=>{var Rt=Zse(),un=y(Rt,!0);_(Rt),Ce(()=>tt(un,i(xs))),q(_o,Rt)}),_(Fn),_(bn),_(Zt);var Xs=v(Zt,14),oo=v(y(Xs),2),Yn=v(y(oo),2);Yo(Yn,5,()=>Object.keys(r8),Ii,(_o,xs)=>{var Rt=Jse(),un=y(Rt,!0);_(Rt),Ce(()=>tt(un,i(xs))),q(_o,Rt)}),_(Yn),Zi(4),_(oo),_(Xs),_(Ae),q(Xe,Ae)},Xe=>{var Ae=Qn(),Qe=fn(Ae);Ue(Qe,()=>i(r)==="dsl",gt=>{var Ft=eoe(),ot=y(Ft),ve=y(ot);Ce(()=>Ot(ve,"href",Z("#dsl-what",void 0)));var Ie=v(ve,2);Ce(()=>Ot(Ie,"href",Z("#dsl-quick",void 0)));var It=v(Ie,2);Ce(()=>Ot(It,"href",Z("#dsl-core",void 0)));var Dt=v(It,2);Ce(()=>Ot(Dt,"href",Z("#dsl-supported",void 0)));var Zt=v(Dt,2);Ce(()=>Ot(Zt,"href",Z("#dsl-limits",void 0)));var gn=v(Zt,2);Ce(()=>Ot(gn,"href",Z("#dsl-mistakes",void 0)));var hn=v(gn,2);Ce(()=>Ot(hn,"href",Z("#dsl-mini",void 0))),_(ot),Zi(28),_(Ft),q(gt,Ft)},gt=>{var Ft=Qn(),ot=fn(Ft);Ue(ot,()=>i(r)==="pine",ve=>{var Ie=toe(),It=y(Ie),Dt=y(It);Ce(()=>Ot(Dt,"href",Z("#pine-what",void 0)));var Zt=v(Dt,2);Ce(()=>Ot(Zt,"href",Z("#pine-quick",void 0)));var gn=v(Zt,2);Ce(()=>Ot(gn,"href",Z("#pine-core",void 0)));var hn=v(gn,2);Ce(()=>Ot(hn,"href",Z("#pine-supported",void 0)));var qn=v(hn,2);Ce(()=>Ot(qn,"href",Z("#pine-changelog",void 0)));var On=v(qn,2);Ce(()=>Ot(On,"href",Z("#pine-howto",void 0)));var bn=v(On,2);Ce(()=>Ot(bn,"href",Z("#pine-session",void 0)));var Fn=v(bn,2);Ce(()=>Ot(Fn,"href",Z("#pine-request-security",void 0)));var Xs=v(Fn,2);Ce(()=>Ot(Xs,"href",Z("#pine-not-supported",void 0)));var oo=v(Xs,2);Ce(()=>Ot(oo,"href",Z("#pine-limits",void 0)));var Yn=v(oo,2);Ce(()=>Ot(Yn,"href",Z("#pine-mistakes",void 0)));var _o=v(Yn,2);Ce(()=>Ot(_o,"href",Z("#pine-mini",void 0))),_(It),Zi(146),_(Ie),q(ve,Ie)},ve=>{var Ie=Qn(),It=fn(Ie);Ue(It,()=>i(r)==="js",Dt=>{var Zt=noe(),gn=y(Zt),hn=y(gn);Ce(()=>Ot(hn,"href",Z("#js-start",void 0)));var qn=v(hn,2);Ce(()=>Ot(qn,"href",Z("#js-index",void 0)));var On=v(qn,2);Ce(()=>Ot(On,"href",Z("#js-recipes",void 0)));var bn=v(On,2);Ce(()=>Ot(bn,"href",Z("#js-playbook",void 0)));var Fn=v(bn,2);Ce(()=>Ot(Fn,"href",Z("#js-support",void 0)));var Xs=v(Fn,2);Ce(()=>Ot(Xs,"href",Z("#js-structure",void 0)));var oo=v(Xs,2);Ce(()=>Ot(oo,"href",Z("#js-data",void 0)));var Yn=v(oo,2);Ce(()=>Ot(Yn,"href",Z("#js-history",void 0)));var _o=v(Yn,2);Ce(()=>Ot(_o,"href",Z("#js-plots",void 0)));var xs=v(_o,2);Ce(()=>Ot(xs,"href",Z("#js-gradient",void 0)));var Rt=v(xs,2);Ce(()=>Ot(Rt,"href",Z("#js-pane-scaling",void 0)));var un=v(Rt,2);Ce(()=>Ot(un,"href",Z("#js-autoscale",void 0)));var qs=v(un,2);Ce(()=>Ot(qs,"href",Z("#js-draw",void 0)));var ri=v(qs,2);Ce(()=>Ot(ri,"href",Z("#js-polyline-polygon",void 0)));var Eo=v(ri,2);Ce(()=>Ot(Eo,"href",Z("#js-overlays",void 0)));var Ia=v(Eo,2);Ce(()=>Ot(Ia,"href",Z("#js-interaction",void 0)));var Lr=v(Ia,2);Ce(()=>Ot(Lr,"href",Z("#js-heatmap",void 0)));var Qa=v(Lr,2);Ce(()=>Ot(Qa,"href",Z("#js-webgl",void 0)));var yr=v(Qa,2);Ce(()=>Ot(yr,"href",Z("#js-strategy",void 0)));var Fi=v(yr,2);Ce(()=>Ot(Fi,"href",Z("#js-alerts",void 0)));var Rc=v(Fi,2);Ce(()=>Ot(Rc,"href",Z("#js-mtf",void 0)));var Cu=v(Rc,2);Ce(()=>Ot(Cu,"href",Z("#js-datafeed",void 0)));var uc=v(Cu,2);Ce(()=>Ot(uc,"href",Z("#js-stdlib",void 0)));var Fl=v(uc,2);Ce(()=>Ot(Fl,"href",Z("#js-api",void 0)));var jc=v(Fl,2);Ce(()=>Ot(jc,"href",Z("#js-performance",void 0)));var nd=v(jc,2);Ce(()=>Ot(nd,"href",Z("#js-safety",void 0)));var Fa=v(nd,2);Ce(()=>Ot(Fa,"href",Z("#js-guardrails",void 0)));var dc=v(Fa,2);Ce(()=>Ot(dc,"href",Z("#js-rules",void 0)));var Bc=v(dc,2);Ce(()=>Ot(Bc,"href",Z("#js-troubleshoot",void 0)));var rd=v(Bc,2);Ce(()=>Ot(rd,"href",Z("#js-examples",void 0)));var uf=v(rd,2);Ce(()=>Ot(uf,"href",Z("#js-status",void 0))),_(gn);var So=v(gn,10),Ll=y(So),ya=v(y(Ll)),hc=v(y(ya),3),Pa=v(y(hc)),Yr=y(Pa);Ce(()=>Ot(Yr,"href",Z("#js-polyline-polygon",void 0))),_(Pa),Zi(),_(hc),Zi(5),_(ya),_(Ll),_(So),Zi(186),_(Zt),q(Dt,Zt)},Dt=>{var Zt=Qn(),gn=fn(Zt);Ue(gn,()=>i(r)==="examples",hn=>{var qn=roe(),On=y(qn),bn=y(On),Fn=y(bn),Xs=v(Fn,2),oo=v(Xs,2),Yn=v(oo,2);_(bn);var _o=v(bn,2);xn(_o),_(On);var xs=v(On,2);Ue(xs,()=>i(I)[i(l)]&&!i(w)[i(l)].length,qs=>{var ri=soe();q(qs,ri)});var Rt=v(xs,2);Yo(Rt,5,()=>i(t),Ii,(qs,ri)=>{var Eo=ooe(),Ia=y(Eo),Lr=y(Ia),Qa=y(Lr),yr=y(Qa,!0);_(Qa);var Fi=v(Qa,2),Rc=y(Fi,!0);_(Fi),_(Lr),_(Ia);var Cu=v(Ia,2),uc=y(Cu),Fl=y(uc,!0);_(uc),_(Cu);var jc=v(Cu,2),nd=y(jc),Fa=v(nd,2);_(jc),_(Eo),Ce(()=>{tt(yr,i(ri).title),tt(Rc,i(ri).description),tt(Fl,i(ri).code)}),vd("click",nd,()=>ce(i(ri).code)),vd("click",Fa,()=>fe(i(ri))),q(qs,Eo)}),_(Rt);var un=v(Rt,2);Ue(un,()=>!i(t).length&&!i(I)[i(l)],qs=>{var ri=ioe();q(qs,ri)}),_(qn),Ce(()=>{pi(Fn,`ss-tab ${(i(l)==="json"?"active":"")??""} svelte-15ifth6`),Ot(Fn,"aria-selected",i(l)==="json"),pi(Xs,`ss-tab ${(i(l)==="dsl"?"active":"")??""} svelte-15ifth6`),Ot(Xs,"aria-selected",i(l)==="dsl"),pi(oo,`ss-tab ${(i(l)==="pine"?"active":"")??""} svelte-15ifth6`),Ot(oo,"aria-selected",i(l)==="pine"),pi(Yn,`ss-tab ${(i(l)==="js"?"active":"")??""} svelte-15ifth6`),Ot(Yn,"aria-selected",i(l)==="js")}),vd("click",bn,O),Bs(_o,()=>i(c),qs=>x(c,qs)),q(hn,qn)},null,!0),q(Dt,Zt)},!0),q(ve,Ie)},!0),q(gt,Ft)},!0),q(Xe,Ae)}),_(Je),tp(Je,Xe=>x(a,Xe),()=>i(a));var Ze=v(Je,2);Ue(Ze,()=>i(u),Xe=>{var Ae=aoe(),Qe=y(Ae,!0);_(Ae),Ce(()=>tt(Qe,i(f))),q(Xe,Ae)}),_(Ke),_(ze),Ce(()=>{pi(ut,`ss-tab ${(i(r)==="json"?"active":"")??""} svelte-15ifth6`),Ot(ut,"aria-selected",i(r)==="json"),pi(bt,`ss-tab ${(i(r)==="dsl"?"active":"")??""} svelte-15ifth6`),Ot(bt,"aria-selected",i(r)==="dsl"),pi(Pt,`ss-tab ${(i(r)==="pine"?"active":"")??""} svelte-15ifth6`),Ot(Pt,"aria-selected",i(r)==="pine"),pi(Et,`ss-tab ${(i(r)==="js"?"active":"")??""} svelte-15ifth6`),Ot(Et,"aria-selected",i(r)==="js"),pi(Mt,`ss-tab ${(i(r)==="examples"?"active":"")??""} svelte-15ifth6`),Ot(Mt,"aria-selected",i(r)==="examples")}),vd("click",nt,M),vd("click",ft,$),vd("click",ze,Xe=>{Xe.target===Xe.currentTarget&&M()}),q($e,ze)}),q(n,oe),$d()}const uoe={signals:new Set,label:new Set};function Y5(n,e){uoe[n].forEach(t=>{try{t(e)}catch{}})}const Cy=$m({});function doe(n,e){Cy.update(t=>({...t,[n]:e}))}function foe(n){return vm(Cy)[n]||[]}const poe=Cy;function moe(n){Cy.update(e=>{const{[n]:t,...s}=e;return s})}function hoe(){Cy.set({})}class voe{constructor(e,t,s,o){Te(this,"gl");Te(this,"width");Te(this,"height");Te(this,"padding");Te(this,"texture");Te(this,"cursorX",0);Te(this,"cursorY",0);Te(this,"rowHeight",0);this.gl=e,this.width=Math.max(1,Math.floor(t)),this.height=Math.max(1,Math.floor(s)),this.padding=Math.max(0,Math.floor((o==null?void 0:o.padding)??1));const r=e.createTexture();if(!r)throw new Error("Failed to create WebGL texture.");this.texture=r,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const a=(o==null?void 0:o.filter)??e.LINEAR;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null)}bind(e=0){const t=this.gl;t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.texture)}allocate(e,t){const s=Math.max(1,Math.floor(e)),o=Math.max(1,Math.floor(t)),r=s+this.padding*2,a=o+this.padding*2;if(r>this.width||a>this.height||(this.cursorX+r>this.width&&(this.cursorX=0,this.cursorY+=this.rowHeight,this.rowHeight=0),this.cursorY+a>this.height))return null;const l=this.cursorX+this.padding,c=this.cursorY+this.padding;this.cursorX+=r,this.rowHeight=Math.max(this.rowHeight,a);const f=l/this.width,u=c/this.height,d=(l+s)/this.width,h=(c+o)/this.height;return{x:l,y:c,width:s,height:o,u0:f,v0:u,u1:d,v1:h}}update(e,t){const s=this.gl;s.bindTexture(s.TEXTURE_2D,this.texture),s.texSubImage2D(s.TEXTURE_2D,0,e.x,e.y,s.RGBA,s.UNSIGNED_BYTE,t)}destroy(){this.gl.deleteTexture(this.texture)}}const goe={alpha:!0,antialias:!0,depth:!1,stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!0,powerPreference:"high-performance"},K5=(n,e,t)=>{const s=n.createShader(e);if(!s)return null;if(n.shaderSource(s,t),n.compileShader(s),!n.getShaderParameter(s,n.COMPILE_STATUS)){const o=n.getShaderInfoLog(s);return n.deleteShader(s),console.warn("[WebGL] Shader compile failed:",o),null}return s},_oe=(n,e)=>{const t=K5(n,n.VERTEX_SHADER,e.vertex),s=K5(n,n.FRAGMENT_SHADER,e.fragment);if(!t||!s)return null;const o=n.createProgram();if(!o)return null;if(n.attachShader(o,t),n.attachShader(o,s),n.linkProgram(o),n.deleteShader(t),n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const r=n.getProgramInfoLog(o);return n.deleteProgram(o),console.warn("[WebGL] Program link failed:",r),null}return o},yoe=(n,e)=>{const t={...goe},s=n.getContext("webgl2",t),o=!s&&n.getContext("webgl",t),r=s||o,a=s?"webgl2":o?"webgl1":"canvas",l=r?null:n.getContext("2d"),c=new Map,f=new Map,u=new Map;return{mode:a,canvas:n,gl:r??void 0,ctx2d:l,isWebgl:!!r,isWebgl2:!!s,resize:(h,m,g)=>{const w=Math.max(1,Math.floor(h*g)),C=Math.max(1,Math.floor(m*g));n.width=w,n.height=C,n.style.width=`${h}px`,n.style.height=`${m}px`,r?r.viewport(0,0,w,C):l&&l.setTransform(g,0,0,g,0,0)},getProgram:(h,m)=>{if(!r)return null;const g=m.version?`@${m.version}`:"",w=`${h}${g}`,C=c.get(w);if(C)return C;const P=_oe(r,m);if(!P)return null;const I=new Map,A=new Map;Array.isArray(m.attributes)&&m.attributes.forEach(F=>{I.set(F,r.getAttribLocation(P,F))}),Array.isArray(m.uniforms)&&m.uniforms.forEach(F=>{A.set(F,r.getUniformLocation(P,F))});const M={key:w,program:P,attributes:I,uniforms:A};return c.set(w,M),M},getBuffer:(h,m)=>{if(!r)return null;const g=`${h}:${m??r.ARRAY_BUFFER}`,w=f.get(g);if(w)return w;const C=r.createBuffer();if(!C)return null;const P={key:g,buffer:C,target:m??r.ARRAY_BUFFER};return f.set(g,P),P},createTextureAtlas:(h,m,g)=>{if(!r)return null;const w=u.get(h);if(w)return w;const C=new voe(r,m,g);return u.set(h,C),C},destroy:()=>{if(r){for(const h of c.values())r.deleteProgram(h.program);for(const h of f.values())r.deleteBuffer(h.buffer);for(const h of u.values())h.destroy()}c.clear(),f.clear(),u.clear()}}},X5=[{stop:0,color:"#0b1020"},{stop:.25,color:"#1e4fd8"},{stop:.5,color:"#22c55e"},{stop:.75,color:"#f59e0b"},{stop:1,color:"#ef4444"}],Z5=25e4,X8=1e6,jx=256,J5=256,Q5=512,e3=32,t3=512,Z8=n=>Math.max(0,Math.min(1,n)),boe=n=>{const e=n.replace("#","").trim();if(e.length===3){const t=parseInt(e[0]+e[0],16),s=parseInt(e[1]+e[1],16),o=parseInt(e[2]+e[2],16);return[t,s,o,255]}if(e.length===6||e.length===8){const t=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),o=parseInt(e.slice(4,6),16),r=e.length===8?parseInt(e.slice(6,8),16):255;return[t,s,o,r]}return null},xoe=n=>{const e=n.trim().match(/rgba?\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*(?:,\s*([0-9.]+)\s*)?\)/i);if(!e)return null;const t=Number(e[1]),s=Number(e[2]),o=Number(e[3]),r=e[4],a=r==null?1:Number(r);return[t,s,o,a].every(l=>Number.isFinite(l))?[Math.max(0,Math.min(255,t)),Math.max(0,Math.min(255,s)),Math.max(0,Math.min(255,o)),Math.max(0,Math.min(255,Math.round(a*255)))]:null},woe=n=>{if(!n)return[255,255,255,255];const e=String(n).trim();if(!e)return[255,255,255,255];if(e.startsWith("#")){const t=boe(e);if(t)return t}if(e.startsWith("rgb")){const t=xoe(e);if(t)return t}return[255,255,255,255]},n3=n=>{const e=new Uint8Array(1024),t=n.map(o=>({stop:Z8(Number(o.stop)),color:woe(o.color)})).sort((o,r)=>o.stop-r.stop),s=o=>{if(!t.length)return[255,255,255,255];if(o<=t[0].stop)return t[0].color;if(o>=t[t.length-1].stop)return t[t.length-1].color;for(let r=0;r+1<t.length;r++){const a=t[r],l=t[r+1];if(o>=a.stop&&o<=l.stop){const c=l.stop-a.stop||1,f=(o-a.stop)/c,u=Math.round(a.color[0]+(l.color[0]-a.color[0])*f),d=Math.round(a.color[1]+(l.color[1]-a.color[1])*f),h=Math.round(a.color[2]+(l.color[2]-a.color[2])*f),m=Math.round(a.color[3]+(l.color[3]-a.color[3])*f);return[u,d,h,m]}}return t[t.length-1].color};for(let o=0;o<256;o++){const r=o/255,[a,l,c,f]=s(r),u=o*4;e[u]=a,e[u+1]=l,e[u+2]=c,e[u+3]=f}return e},J8=(n,e,t,s)=>{let o=Math.max(1,e),r=Math.max(1,t),a=Math.max(1,Math.floor(n.width/o)),l=Math.max(1,Math.floor(n.height/r)),c=a*l;if(c>s){const f=Math.sqrt(c/s);o=Math.max(1,Math.floor(o*f)),r=Math.max(1,Math.floor(r*f)),a=Math.max(1,Math.floor(n.width/o)),l=Math.max(1,Math.floor(n.height/r)),c=a*l}return{xBins:a,yBins:l,binX:o,binY:r}},koe=(n,e,t)=>{const s=Math.max(1,e),o=Math.max(1,t),r=Math.max(1,Math.floor(n.width/s)),a=Math.max(1,Math.floor(n.height/o)),l=r*a;let c=1;if(l>Z5){const d=Math.sqrt(l/Z5),h=Math.pow(2,Math.floor(Math.log2(d)));c=Math.max(1,h)}const f=Math.max(1,Math.floor(s*c)),u=Math.max(1,Math.floor(o*c));return J8(n,f,u,X8)},Soe=n=>{let e=jx,t=Math.ceil(n.width/e),s=Math.ceil(n.height/e),o=t*s;if(o>J5){const r=Math.ceil(Math.sqrt(o/J5));e=Math.max(jx,jx*r),t=Math.ceil(n.width/e),s=Math.ceil(n.height/e),o=t*s}return{tileSize:e,cols:t,rows:s}},Coe=(n,e,t,s,o)=>{const{xBins:r,yBins:a,binX:l,binY:c}=J8(e,t,s,X8),f=r*a,u=new Float32Array(f),d=new Uint32Array(f);if(o==="max")for(let w=0;w<f;w++)u[w]=-1/0;else if(o==="min")for(let w=0;w<f;w++)u[w]=1/0;for(const w of n){const C=w.x-e.left,P=w.y-e.top;if(C<0||P<0||C>=e.width||P>=e.height)continue;const I=Math.floor(C/l),A=Math.floor(P/c);if(I<0||A<0||I>=r||A>=a)continue;const M=A*r+I,F=w.value;Number.isFinite(F)&&(o==="max"?u[M]=Math.max(u[M],F):o==="min"?u[M]=Math.min(u[M],F):u[M]+=F,d[M]+=1)}if(o==="avg")for(let w=0;w<f;w++){const C=d[w];u[w]=C>0?u[w]/C:0}let h=1/0,m=-1/0;for(let w=0;w<f;w++){if(!d[w])continue;const C=u[w];Number.isFinite(C)&&(h=Math.min(h,C),m=Math.max(m,C))}const g=new Uint8Array(f);for(let w=0;w<f;w++)d[w]&&(g[w]=1);return{width:r,height:a,accum:u,mask:g,min:h,max:m}},Ioe=(n,e,t,s)=>{const o=n.width*n.height*4,r=s&&s.length===o?s:new Uint8Array(o),a=Number.isFinite(e)?e:0;let l=Number.isFinite(t)?t:a+1;a===l&&(l=a+1);const c=l-a||1;for(let f=0;f<n.accum.length;f++){const u=n.accum[f],d=n.mask[f]===1,h=Number.isFinite(u)?Z8((u-a)/c):0,m=Math.round(h*255),g=f*4;r[g]=m,r[g+1]=0,r[g+2]=0,r[g+3]=d?255:0}return r};class Poe{constructor(e){Te(this,"runtime");Te(this,"program",null);Te(this,"quadBuffer",null);Te(this,"dataTextures",new Map);Te(this,"colormapCache",new Map);Te(this,"tileCache",new Map);Te(this,"cacheTick",0);Te(this,"canvasFallback",null);this.runtime=e}ensureProgram(e){if(this.program)return;const t=`
      attribute vec2 a_pos;
      void main() {
        gl_Position = vec4(a_pos, 0.0, 1.0);
      }
    `,s=`
      precision mediump float;
      uniform sampler2D u_data;
      uniform sampler2D u_colormap;
      uniform vec4 u_bounds;
      uniform vec2 u_canvas;
      uniform float u_opacity;
      void main() {
        vec2 frag = vec2(gl_FragCoord.x, u_canvas.y - gl_FragCoord.y);
        vec2 pos = frag - u_bounds.xy;
        if (pos.x < 0.0 || pos.y < 0.0 || pos.x > u_bounds.z || pos.y > u_bounds.w) {
          discard;
        }
        vec2 uv = vec2(pos.x / u_bounds.z, pos.y / u_bounds.w);
        vec4 data = texture2D(u_data, uv);
        float v = data.r;
        float m = data.a;
        vec4 c = texture2D(u_colormap, vec2(v, 0.5));
        gl_FragColor = vec4(c.rgb, c.a * u_opacity * m);
      }
    `,o=e.createShader(e.VERTEX_SHADER),r=e.createShader(e.FRAGMENT_SHADER);if(!o||!r||(e.shaderSource(o,t),e.shaderSource(r,s),e.compileShader(o),e.compileShader(r),!e.getShaderParameter(o,e.COMPILE_STATUS))||!e.getShaderParameter(r,e.COMPILE_STATUS))return;const a=e.createProgram();a&&(e.attachShader(a,o),e.attachShader(a,r),e.linkProgram(a),e.deleteShader(o),e.deleteShader(r),e.getProgramParameter(a,e.LINK_STATUS)&&(this.program=a))}ensureQuadBuffer(e){if(this.quadBuffer)return;const t=e.createBuffer();if(!t)return;e.bindBuffer(e.ARRAY_BUFFER,t);const s=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW),this.quadBuffer=t}getColormapTexture(e,t){const s=JSON.stringify(t),o=this.colormapCache.get(s);if(o)return o;const r=e.createTexture();if(!r)return null;e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);const a=n3(t);return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,256,1,0,e.RGBA,e.UNSIGNED_BYTE,a),this.colormapCache.set(s,r),r}getDataTexture(e,t,s,o,r,a){const l=this.dataTextures.get(t);if(l&&l.width===s&&l.height===o&&l.version===r)return l.lastUsed=a,l.texture;const c=(l==null?void 0:l.texture)??e.createTexture();return c?(e.bindTexture(e.TEXTURE_2D,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),this.dataTextures.set(t,{texture:c,width:s,height:o,version:r,lastUsed:a}),c):null}getSpecCache(e,t){let s=this.tileCache.get(e);return s||(s={tiles:new Map,lastUsed:t},this.tileCache.set(e,s)),s.lastUsed=t,s}pruneCaches(){if(this.tileCache.size>e3){const t=Array.from(this.tileCache.entries()).sort((o,r)=>o[1].lastUsed-r[1].lastUsed),s=this.tileCache.size-e3;for(let o=0;o<s;o++)this.tileCache.delete(t[o][0])}let e=0;if(this.tileCache.forEach(t=>{e+=t.tiles.size}),e>Q5){const t=[];this.tileCache.forEach((o,r)=>{o.tiles.forEach((a,l)=>{t.push([r,l,a])})}),t.sort((o,r)=>o[2].lastUsed-r[2].lastUsed);const s=e-Q5;for(let o=0;o<s;o++){const[r,a]=t[o],l=this.tileCache.get(r);l==null||l.tiles.delete(a)}}if(this.dataTextures.size>t3){const t=Array.from(this.dataTextures.entries()).sort((o,r)=>o[1].lastUsed-r[1].lastUsed),s=this.dataTextures.size-t3;for(let o=0;o<s;o++){const r=t[o];if(!r)continue;const a=r[1].texture;this.runtime.gl&&this.runtime.gl.deleteTexture(a),this.dataTextures.delete(r[0])}}}buildTiles(e,t){const s=e.bounds,o=e.xBinPx??3,r=e.yBinPx??3,a=e.agg??"sum",l=koe(s,o,r),{tileSize:c,cols:f,rows:u}=Soe(s),d=new Array(f*u);for(const I of e.points){const A=I.x-s.left,M=I.y-s.top;if(A<0||M<0||A>=s.width||M>=s.height)continue;const F=Math.floor(A/c),B=Math.floor(M/c);if(F<0||B<0||F>=f||B>=u)continue;const $=B*f+F;d[$]||(d[$]=[]),d[$].push(I)}const h=e.viewKey??"",m=`${e.id}:${e.version??0}:${h}:${l.binX}:${l.binY}:${a}`,g=this.getSpecCache(m,t),w=[];for(let I=0;I<u;I++)for(let A=0;A<f;A++){const M=I*f+A,F=d[M];if(!F||!F.length)continue;const B=s.left+A*c,$=s.top+I*c,L=Math.min(c,s.width-A*c),O=Math.min(c,s.height-I*c),Y={left:B,top:$,width:L,height:O},ce=`${A}:${I}:${L}:${O}`;let Q=g.tiles.get(ce);if(Q)Q.lastUsed=t;else{const le=Coe(F,Y,l.binX,l.binY,a);Q={grid:le,encoded:new Uint8Array(le.width*le.height*4),min:NaN,max:NaN,lastUsed:t},g.tiles.set(ce,Q)}w.push({key:ce,bounds:Y,grid:Q.grid,encoded:Q.encoded,min:Q.min,max:Q.max})}let C=Number.isFinite(e.minValue)?e.minValue:1/0,P=Number.isFinite(e.maxValue)?e.maxValue:-1/0;if(!Number.isFinite(e.minValue)||!Number.isFinite(e.maxValue))for(const I of w)Number.isFinite(e.minValue)||(C=Math.min(C,I.grid.min)),Number.isFinite(e.maxValue)||(P=Math.max(P,I.grid.max));Number.isFinite(C)||(C=0),Number.isFinite(P)||(P=C+1),C===P&&(P=C+1);for(const I of w)if(I.min!==C||I.max!==P){I.encoded=Ioe(I.grid,C,P,I.encoded),I.min=C,I.max=P;const A=g.tiles.get(I.key);A&&(A.encoded=I.encoded,A.min=C,A.max=P)}return w.map(I=>({key:I.key,bounds:I.bounds,encoded:I.encoded,width:I.grid.width,height:I.grid.height}))}clear(){const e=this.runtime.gl;if(!e){const t=this.runtime.ctx2d;t&&t.clearRect(0,0,this.runtime.canvas.width,this.runtime.canvas.height);return}e.disable(e.SCISSOR_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)}render(e,t){this.cacheTick+=1;const s=this.cacheTick;if(!e.length){(t==null?void 0:t.clear)!==!1&&this.clear(),this.pruneCaches();return}const o=this.runtime,r=o.gl;if(!r){this.renderCanvas(e),this.pruneCaches();return}const a=o.canvas.clientWidth||o.canvas.width||1,l=o.canvas.clientHeight||o.canvas.height||1,c=o.canvas.width/a,f=o.canvas.height/l;if((t==null?void 0:t.clear)!==!1&&(r.disable(r.SCISSOR_TEST),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT)),this.ensureProgram(r),this.ensureQuadBuffer(r),!this.program||!this.quadBuffer)return;r.useProgram(this.program),r.bindBuffer(r.ARRAY_BUFFER,this.quadBuffer);const u=r.getAttribLocation(this.program,"a_pos");r.enableVertexAttribArray(u),r.vertexAttribPointer(u,2,r.FLOAT,!1,0,0);const d=r.getUniformLocation(this.program,"u_data"),h=r.getUniformLocation(this.program,"u_colormap"),m=r.getUniformLocation(this.program,"u_bounds"),g=r.getUniformLocation(this.program,"u_canvas"),w=r.getUniformLocation(this.program,"u_opacity");r.uniform2f(g,o.canvas.width,o.canvas.height),r.enable(r.BLEND),r.disable(r.DEPTH_TEST),r.enable(r.SCISSOR_TEST);for(const C of e)for(const P of C.heatmaps){const I=this.buildTiles(P,s);if(!I.length)continue;const A=P.colormap&&P.colormap.length?P.colormap:X5,M=this.getColormapTexture(r,A);if(!M)continue;const F=Number.isFinite(P.opacity)?Math.max(0,Math.min(1,P.opacity)):1;r.uniform1f(w,F),P.blend==="add"?r.blendFunc(r.SRC_ALPHA,r.ONE):P.blend==="screen"?r.blendFunc(r.ONE,r.ONE_MINUS_SRC_COLOR):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(const B of I){const $=`${P.id}:${B.key}`,L=this.getDataTexture(r,$,B.width,B.height,P.version??0,s);if(!L)continue;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,L),r.pixelStorei(r.UNPACK_ALIGNMENT,1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,B.width,B.height,0,r.RGBA,r.UNSIGNED_BYTE,B.encoded),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,M),r.uniform1i(d,0),r.uniform1i(h,1);const O=B.bounds.left*c,Y=B.bounds.top*f,ce=B.bounds.width*c,Q=B.bounds.height*f;r.uniform4f(m,O,Y,ce,Q);const le=Math.round(O),ue=Math.round(o.canvas.height-(Y+Q)),fe=Math.round(ce),pe=Math.round(Q);r.scissor(le,ue,fe,pe),r.drawArrays(r.TRIANGLES,0,6)}}r.disable(r.SCISSOR_TEST),this.pruneCaches()}renderCanvas(e){const t=this.runtime.ctx2d;if(t){t.clearRect(0,0,this.runtime.canvas.width,this.runtime.canvas.height);for(const s of e)for(const o of s.heatmaps){const r=o.colormap&&o.colormap.length?o.colormap:X5,a=n3(r),l=this.buildTiles(o,this.cacheTick);if(l.length)for(const c of l){const f=t.createImageData(c.width,c.height);for(let m=0;m<c.width*c.height;m++){const g=m*4,C=c.encoded[g]*4;f.data[g]=a[C],f.data[g+1]=a[C+1],f.data[g+2]=a[C+2];const P=c.encoded[g+3]/255;f.data[g+3]=Math.round(a[C+3]*P)}this.canvasFallback||(this.canvasFallback=document.createElement("canvas"));const u=this.canvasFallback;u.width=c.width,u.height=c.height;const d=u.getContext("2d");if(!d)continue;d.putImageData(f,0,0);const h=Number.isFinite(o.opacity)?Math.max(0,Math.min(1,o.opacity)):1;t.save(),t.globalAlpha=h,t.drawImage(u,c.bounds.left,c.bounds.top,c.bounds.width,c.bounds.height),t.restore()}}this.pruneCaches()}}destroy(){const e=this.runtime.gl;e&&this.program&&e.deleteProgram(this.program),e&&this.quadBuffer&&e.deleteBuffer(this.quadBuffer);for(const t of this.dataTextures.values())e&&e.deleteTexture(t.texture);for(const t of this.colormapCache.values())e&&e.deleteTexture(t);this.dataTextures.clear(),this.colormapCache.clear(),this.tileCache.clear(),this.program=null,this.quadBuffer=null,this.canvasFallback=null}}const s2=n=>Math.max(0,Math.min(1,n)),$b=(n,e,t)=>n+(e-n)*t,Moe=(n,e,t)=>[$b(n[0],e[0],t),$b(n[1],e[1],t),$b(n[2],e[2],t),$b(n[3],e[3],t)],Noe=n=>{const e=n.replace("#","").trim();if(e.length===3){const t=parseInt(e[0]+e[0],16),s=parseInt(e[1]+e[1],16),o=parseInt(e[2]+e[2],16);return[t,s,o,255]}if(e.length===6||e.length===8){const t=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),o=parseInt(e.slice(4,6),16),r=e.length===8?parseInt(e.slice(6,8),16):255;return[t,s,o,r]}return null},Aoe=n=>{const e=n.trim().match(/rgba?\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*(?:,\s*([0-9.]+)\s*)?\)/i);if(!e)return null;const t=Number(e[1]),s=Number(e[2]),o=Number(e[3]),r=e[4],a=r==null?1:Number(r);return[t,s,o,a].every(l=>Number.isFinite(l))?[Math.max(0,Math.min(255,t)),Math.max(0,Math.min(255,s)),Math.max(0,Math.min(255,o)),Math.max(0,Math.min(255,Math.round(a*255)))]:null},h_=n=>{if(!n)return[1,1,1,1];const e=String(n).trim();if(!e)return[1,1,1,1];if(e.startsWith("#")){const t=Noe(e);if(t)return[t[0]/255,t[1]/255,t[2]/255,t[3]/255]}if(e.startsWith("rgb")){const t=Aoe(e);if(t)return[t[0]/255,t[1]/255,t[2]/255,t[3]/255]}return[1,1,1,1]},Q8=n=>{const e=n.length;if(e<3)return[];const t=Array.from({length:e},(f,u)=>u),s=[],r=(()=>{let f=0;for(let u=0;u<e;u++){const d=n[u],h=n[(u+1)%e];f+=(h.x-d.x)*(h.y+d.y)}return f})()>0?1:-1,a=(f,u,d)=>{const h=n[f],m=n[u],g=n[d],w=(m.x-h.x)*(g.y-h.y)-(m.y-h.y)*(g.x-h.x);return r*w<0},l=(f,u,d,h)=>{const m=h.x-u.x,g=h.y-u.y,w=d.x-u.x,C=d.y-u.y,P=f.x-u.x,I=f.y-u.y,A=m*m+g*g,M=m*w+g*C,F=m*P+g*I,B=w*w+C*C,$=w*P+C*I,L=1/(A*B-M*M||1),O=(B*F-M*$)*L,Y=(A*$-M*F)*L;return O>=0&&Y>=0&&O+Y<=1};let c=0;for(;t.length>3&&c<1e4;){c+=1;let f=!1;for(let u=0;u<t.length;u++){const d=t[(u-1+t.length)%t.length],h=t[u],m=t[(u+1)%t.length];if(!a(d,h,m))continue;const g=n[d],w=n[h],C=n[m];let P=!1;for(let I=0;I<t.length;I++){const A=t[I];if(!(A===d||A===h||A===m)&&l(n[A],g,w,C)){P=!0;break}}if(!P){s.push(d,h,m),t.splice(u,1),f=!0;break}}if(!f)break}if(t.length===3&&s.push(t[0],t[1],t[2]),!s.length)for(let f=1;f+1<e;f++)s.push(0,f,f+1);return s},O_=(n,e)=>{const t=[];if(n.length<2)return t;const s=e.toLowerCase(),o=s==="dashed"?[6,4]:s==="dotted"?[2,2]:null;if(!o){for(let l=0;l+1<n.length;l++)t.push({a:n[l],b:n[l+1]});return t}let r=0,a=0;for(let l=0;l+1<n.length;l++){const c=n[l],f=n[l+1],u=f.x-c.x,d=f.y-c.y,h=Math.hypot(u,d);if(!Number.isFinite(h)||h<=0)continue;const m=u/h,g=d/h;let w=0;for(;w<h;){const C=o[r%o.length],P=C-a,I=Math.min(P,h-w);if(r%2===0&&I>0){const M=c.x+m*w,F=c.y+g*w,B=c.x+m*(w+I),$=c.y+g*(w+I);t.push({a:{x:M,y:F},b:{x:B,y:$}})}w+=I,a+=I,a>=C-1e-6&&(r+=1,a=0)}}return t},U1=(n,e,t)=>{if(!n.length)return new Float32Array(0);const s=[],o=Math.max(.5,e/2);for(const r of n){const a=r.b.x-r.a.x,l=r.b.y-r.a.y,c=Math.hypot(a,l);if(!Number.isFinite(c)||c<=0)continue;const f=-l/c,u=a/c,d=r.a.x+f*o,h=r.a.y+u*o,m=r.a.x-f*o,g=r.a.y-u*o,w=r.b.x+f*o,C=r.b.y+u*o,P=r.b.x-f*o,I=r.b.y-u*o;s.push(d,h,t[0],t[1],t[2],t[3],m,g,t[0],t[1],t[2],t[3],w,C,t[0],t[1],t[2],t[3],w,C,t[0],t[1],t[2],t[3],m,g,t[0],t[1],t[2],t[3],P,I,t[0],t[1],t[2],t[3])}return new Float32Array(s)},Toe=(n,e)=>{if(n.length<3)return new Float32Array(0);const t=Q8(n);if(!t.length)return new Float32Array(0);const s=[];for(let o=0;o<t.length;o+=3){const r=n[t[o]],a=n[t[o+1]],l=n[t[o+2]];s.push(r.x,r.y,e[0],e[1],e[2],e[3],a.x,a.y,e[0],e[1],e[2],e[3],l.x,l.y,e[0],e[1],e[2],e[3])}return new Float32Array(s)},Foe=(n,e)=>{if(n.length<3||e.length!==n.length)return new Float32Array(0);const t=Q8(n);if(!t.length)return new Float32Array(0);const s=[];for(let o=0;o<t.length;o+=3){const r=t[o],a=t[o+1],l=t[o+2],c=n[r],f=n[a],u=n[l],d=e[r],h=e[a],m=e[l];s.push(c.x,c.y,d[0],d[1],d[2],d[3],f.x,f.y,h[0],h[1],h[2],h[3],u.x,u.y,m[0],m[1],m[2],m[3])}return new Float32Array(s)},Loe=(n,e,t,s=1)=>{if(!e||!e.from&&!e.to)return null;const o=h_(e.from||t||"#38bdf8"),r=h_(e.to||t||e.from||"#38bdf8"),a=Math.min(...n.map(P=>P.x)),l=Math.max(...n.map(P=>P.x)),c=Math.min(...n.map(P=>P.y)),f=Math.max(...n.map(P=>P.y)),u=l-a||1,d=f-c||1,h=String(e.mode||"vertical").toLowerCase();let m=0,g=0,w=1;if(h==="radial"){m=(a+l)/2,g=(c+f)/2,w=0;for(const P of n){const I=Math.hypot(P.x-m,P.y-g);I>w&&(w=I)}(!Number.isFinite(w)||w<=0)&&(w=1)}const C=[];for(const P of n){let I=0;h==="horizontal"?I=(P.x-a)/u:h==="radial"?I=Math.hypot(P.x-m,P.y-g)/w:I=(P.y-c)/d;const A=Moe(o,r,s2(I));A[3]=A[3]*s,C.push(A)}return C};class Eoe{constructor(e){Te(this,"runtime");Te(this,"program",null);Te(this,"buffer",null);this.runtime=e}ensureProgram(e){if(this.program)return;const t=`
      attribute vec2 a_pos;
      attribute vec4 a_color;
      varying vec4 v_color;
      uniform vec2 u_canvas;
      void main() {
        vec2 clip = (a_pos / u_canvas) * 2.0 - 1.0;
        gl_Position = vec4(clip.x, -clip.y, 0.0, 1.0);
        v_color = a_color;
      }
    `,s=`
      precision mediump float;
      varying vec4 v_color;
      void main() {
        gl_FragColor = v_color;
      }
    `,o=e.createShader(e.VERTEX_SHADER),r=e.createShader(e.FRAGMENT_SHADER);if(!o||!r||(e.shaderSource(o,t),e.shaderSource(r,s),e.compileShader(o),e.compileShader(r),!e.getShaderParameter(o,e.COMPILE_STATUS))||!e.getShaderParameter(r,e.COMPILE_STATUS))return;const a=e.createProgram();a&&(e.attachShader(a,o),e.attachShader(a,r),e.linkProgram(a),e.deleteShader(o),e.deleteShader(r),e.getProgramParameter(a,e.LINK_STATUS)&&(this.program=a))}ensureBuffer(e){this.buffer||(this.buffer=e.createBuffer())}clear(){const e=this.runtime.gl;if(!e){const t=this.runtime.ctx2d;t&&t.clearRect(0,0,this.runtime.canvas.width,this.runtime.canvas.height);return}e.disable(e.SCISSOR_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)}render(e,t){const s=this.runtime,o=s.gl;if(!o){this.clear();return}const r=s.canvas.clientWidth||s.canvas.width||1,a=s.canvas.clientHeight||s.canvas.height||1,l=s.canvas.width/r,c=s.canvas.height/a,f=Number.isFinite(l)&&Number.isFinite(c)?(l+c)/2:1;if((t==null?void 0:t.clear)!==!1&&(o.disable(o.SCISSOR_TEST),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT)),!e.length||(this.ensureProgram(o),this.ensureBuffer(o),!this.program||!this.buffer))return;o.useProgram(this.program),o.bindBuffer(o.ARRAY_BUFFER,this.buffer);const u=o.getAttribLocation(this.program,"a_pos"),d=o.getAttribLocation(this.program,"a_color"),h=o.getUniformLocation(this.program,"u_canvas");o.enableVertexAttribArray(u),o.enableVertexAttribArray(d),o.vertexAttribPointer(u,2,o.FLOAT,!1,24,0),o.vertexAttribPointer(d,4,o.FLOAT,!1,24,8),o.uniform2f(h,s.canvas.width,s.canvas.height),o.enable(o.BLEND),o.disable(o.DEPTH_TEST),o.enable(o.SCISSOR_TEST);const m=(g,w)=>w?g.map(C=>({x:Math.round(C.x)+.5,y:Math.round(C.y)+.5})):g;for(const g of e){const w=g.bounds,C=Math.round(w.left*l),P=Math.round(s.canvas.height-(w.top+w.height)*c),I=Math.round(w.width*l),A=Math.round(w.height*c);o.scissor(C,P,I,A);for(const M of g.shapes){const F=Number.isFinite(M.opacity)?s2(M.opacity):1,B=M.blend||"normal";if(B==="add"?o.blendFunc(o.SRC_ALPHA,o.ONE):B==="screen"?o.blendFunc(o.ONE,o.ONE_MINUS_SRC_COLOR):o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),M.kind==="polygon"){const pe=M.points.map(qe=>({x:qe.x*l,y:qe.y*c})),Z=M.fillColor,xe=M.fillGradient,oe=xe?Loe(pe,xe,Z,F):null;if(oe&&oe.length===pe.length){const qe=Foe(pe,oe);qe.length&&(o.bufferData(o.ARRAY_BUFFER,qe,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,qe.length/6))}else if(Z){const qe=h_(Z),nt=[qe[0],qe[1],qe[2],qe[3]*F],ft=Toe(pe,nt);ft.length&&(o.bufferData(o.ARRAY_BUFFER,ft,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,ft.length/6))}const Pe=M.strokeColor,$e=(M.strokeWidth??1)*f,ze=Number.isFinite(M.glow)?M.glow:0,Ke=Number.isFinite(M.glowOpacity)?s2(M.glowOpacity):.35;if(ze>0&&(Pe||Z)){const qe=h_(M.glowColor||Pe||Z||"#e2e8f0"),nt=[qe[0],qe[1],qe[2],qe[3]*F*Ke],ft=Math.max(1,$e+ze*f),ut=m(pe.length?[...pe,pe[0]]:[],!0),bt=O_(ut,"solid"),Pt=U1(bt,ft,nt);Pt.length&&(o.bufferData(o.ARRAY_BUFFER,Pt,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Pt.length/6))}if(Pe&&$e>0){const qe=h_(Pe),nt=[qe[0],qe[1],qe[2],qe[3]*F],ft=M.strokeStyle||"solid",ut=ft==="dashed"||ft==="dotted"||$e<=1,bt=m(pe.length?[...pe,pe[0]]:[],ut),Pt=O_(bt,ft),Et=U1(Pt,$e,nt);Et.length&&(o.bufferData(o.ARRAY_BUFFER,Et,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Et.length/6))}continue}const $=M.style||"solid",L=Math.max(1,(M.width??1)*f),O=M.color||"#e2e8f0",Y=h_(O),ce=[Y[0],Y[1],Y[2],Y[3]*F],Q=Number.isFinite(M.glow)?M.glow:0,le=Number.isFinite(M.glowOpacity)?s2(M.glowOpacity):.35,ue=pe=>{if(!pe.length||Q<=0)return;const Z=h_(M.glowColor||O||"#e2e8f0"),xe=[Z[0],Z[1],Z[2],Z[3]*F*le],oe=Math.max(1,L+Q*f),Pe=U1(pe,oe,xe);Pe.length&&(o.bufferData(o.ARRAY_BUFFER,Pe,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Pe.length/6))};let fe=[];if(M.kind==="path"&&M.commands){let pe=[];const Z=()=>{if(pe.length>=2){const xe=O_(pe,$),oe=m(pe,!0);ue(O_(oe,"solid"));const Pe=U1(xe,L,ce);Pe.length&&(o.bufferData(o.ARRAY_BUFFER,Pe,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Pe.length/6))}pe=[]};for(const xe of M.commands)xe.cmd==="M"?(Z(),pe.push({x:xe.x*l,y:xe.y*c})):xe.cmd==="L"&&pe.push({x:xe.x*l,y:xe.y*c});Z();continue}if(M.points&&(fe=M.points.map(pe=>({x:pe.x*l,y:pe.y*c}))),fe.length>=2){const pe=O_(fe,$),Z=m(fe,!0);ue(O_(Z,"solid"));const xe=U1(pe,L,ce);xe.length&&(o.bufferData(o.ARRAY_BUFFER,xe,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,xe.length/6))}}}o.disable(o.SCISSOR_TEST)}destroy(){const e=this.runtime.gl;e&&this.program&&e.deleteProgram(this.program),e&&this.buffer&&e.deleteBuffer(this.buffer),this.program=null,this.buffer=null}}const W2=$m({}),$oe=W2;function Doe(n,e){const t={...e,_updatedAt:Date.now()};W2.update(s=>({...s,[n]:t}))}function s3(n){W2.update(e=>{const{[n]:t,...s}=e;return s})}function Roe(){W2.set({})}function Cp(n,e){const t=typeof n=="number"?n:Number(n);return Number.isFinite(t)?t:e}function o3(n,e="start"){if(n==null)return null;if(typeof n=="number"&&Number.isFinite(n))return n>1e11?Math.floor(n):Math.floor(n*1e3);const t=String(n).trim();if(!t)return null;if(/^\d+$/.test(t)){const r=Number(t);if(Number.isFinite(r))return r>1e11?Math.floor(r):Math.floor(r*1e3)}const s=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(s){const r=Number(s[1]),a=Number(s[2])-1,l=Number(s[3]);if([r,a,l].every(c=>Number.isFinite(c))){const c=Date.UTC(r,a,l);return Number.isFinite(c)?e==="end"?c+86399999:c:null}}const o=Date.parse(t);return Number.isFinite(o)?o:null}function joe(n){if(!n)return null;const e=String(n).trim();if(!e)return null;const t=e.match(/^(\d{2})(?::?(\d{2}))?\s*-\s*(\d{2})(?::?(\d{2}))?$/);if(!t)return null;const s=Number(t[1]),o=Number(t[2]||"0"),r=Number(t[3]),a=Number(t[4]||"0");return![s,o,r,a].every(l=>Number.isFinite(l))||s<0||s>23||r<0||r>23||o<0||o>59||a<0||a>59?null:{startMin:s*60+o,endMin:r*60+a}}function Boe(n){if(n===!0)return{enabled:!0,execution:"intrabar_ohlc",intrabarTieBreak:"worst_case",ohlcPath:"open_high_low_close",intrabarTicks:6,initialCapital:1e4,fromTs:null,toTs:null,session:null,orderSize:{type:"percent_of_equity",value:100},commissionPct:0,commissionCash:null,commissionPerUnit:null,commissionType:"percent",slippagePct:0,slippageAbs:null,slippageTicks:null,slippageType:"percent",priceTick:null,qtyStep:null,minQty:null,spreadPct:null,leverage:1,maintenanceMarginPct:null,liquidationFeePct:null,borrowPctPerYear:null,fundingPctPerDay:null,positionMode:"netting",closeMethod:"fifo",pyramiding:1,timeInForce:"gtc",fillMode:"full",volumeFillPct:100,stopLossPct:null,takeProfitPct:null,takeProfits:[],trailingStopPct:null,maxDrawdownPct:null,maxDrawdownCash:null,maxPositionPct:null,maxPositionCash:null,maxPositionQty:null,maxIntradayFilledOrders:null,maxIntradayLossPct:null,maxIntradayLossCash:null,allowLong:!0,allowShort:!0,closeOnEnd:!0};if(!n||typeof n!="object")return null;const e=n;if(e.enabled===!1)return null;const t=String(e.execution||e.exec||e.mode||"").trim().toLowerCase()||"intrabar_ohlc",s=t==="bar_close"||t==="barclose"||t==="close"?"bar_close":t==="intrabar_ticks"||t==="intrabarticks"||t==="ticks"?"intrabar_ticks":"intrabar_ohlc",o=String(e.intrabarTieBreak||e.tieBreak||"").trim().toLowerCase(),r=o==="best_case"||o==="best"||o==="tp"?"best_case":o==="ohlc"||o==="path"?"ohlc":"worst_case",a=String(e.ohlcPath||e.path||"").trim().toLowerCase(),l=a==="open_low_high_close"||a==="olhc"?"open_low_high_close":"open_high_low_close",c=e.intrabarTicks??e.ticks??e.tickCount??e.intrabarTickCount??null,f=Math.max(2,Math.min(100,Math.floor(Cp(c,6)))),u=Math.max(0,Cp(e.initialCapital,1e4)),d=Math.max(0,Cp(e.commissionPct,0)),h=e.commissionCash??e.commission_cash??e.commissionFixed??e.commission_fixed??null,m=e.commissionPerUnit??e.commission_per_unit??e.commissionPerShare??e.commission_per_share??null,g=h==null?null:Math.max(0,Cp(h,0)),w=m==null?null:Math.max(0,Cp(m,0)),C=String(e.commissionType??e.commission_mode??e.commissionMode??"").trim().toLowerCase(),P=w!=null||C==="per_unit"?"per_unit":g!=null||C==="cash"?"cash":"percent",I=Math.max(0,Cp(e.slippagePct??e.slippage??e.slippage_percent,0)),A=e.slippageAbs??e.slippage_abs??null,M=e.slippageTicks??e.slippage_ticks??e.slippageTick??null,F=A==null?null:Math.max(0,Cp(A,0)),B=M==null?null:Math.max(0,Cp(M,0)),$=String(e.slippageType??e.slippage_mode??e.slippageMode??"").trim().toLowerCase(),L=B!=null||$==="ticks"?"ticks":F!=null||$==="abs"?"abs":"percent",O=e.priceTick??e.price_tick??e.tickSize??e.tick_size??e.tick??e.minTick??e.min_tick??null,Y=e.qtyStep??e.qty_step??e.quantityStep??e.quantity_step??e.lotStep??e.lot_step??null,ce=e.minQty??e.min_qty??e.minimumQty??e.minimum_qty??null,Q=O==null?null:Math.max(0,Cp(O,0)),le=Y==null?null:Math.max(0,Cp(Y,0)),ue=ce==null?null:Math.max(0,Cp(ce,0)),fe=e.spreadPct??e.spread_pct??e.spread??e.spreadBps??e.spread_bps??null,pe=(()=>{if(fe==null)return null;const yr=Cp(fe,0);return!Number.isFinite(yr)||yr<=0?null:"spreadBps"in e||"spread_bps"in e?yr/100:yr})(),Z=e.leverage??e.lev??e.marginLeverage??e.margin_leverage??1,xe=Math.max(1,Cp(Z,1)),oe=e.maintenanceMarginPct??e.maintenance_margin_pct??e.maintMarginPct??null,Pe=e.liquidationFeePct??e.liquidation_fee_pct??e.liqFeePct??null,$e=e.borrowPctPerYear??e.borrow_pct_per_year??e.shortBorrowPctPerYear??null,ze=e.fundingPctPerDay??e.funding_pct_per_day??e.funding??null,Ke=oe==null?null:Math.max(0,Cp(oe,0)),qe=Pe==null?null:Math.max(0,Cp(Pe,0)),nt=$e==null?null:Math.max(0,Cp($e,0)),ft=ze==null?null:Math.max(0,Cp(ze,0)),ut=String(e.positionMode??e.position_mode??"").trim().toLowerCase(),bt=ut==="hedge"||ut==="hedging"?"hedging":"netting",Pt=String(e.closeMethod??e.close_method??e.costBasis??e.cost_basis??"").trim().toLowerCase(),Et=Pt==="lifo"?"lifo":Pt==="avg"||Pt==="average"?"avg":"fifo",Mt=Math.max(1,Math.min(50,Math.floor(Cp(e.pyramiding??e.maxEntries??e.max_positions??e.maxPositions??1,1)))),Je=String(e.timeInForce??e.tif??e.orderTif??e.order_tif??"").trim().toLowerCase(),Ct=Je==="ioc"||Je==="immediate_or_cancel"?"ioc":Je==="fok"||Je==="fill_or_kill"?"fok":"gtc",Ze=String(e.fillMode??e.fill_mode??"").trim().toLowerCase(),Xe=Ze==="volume"||Ze==="partial"||e.partialFills?"volume":"full",Ae=Math.max(0,Math.min(100,Cp(e.volumeFillPct??e.volume_fill_pct??e.fillPct??100,100))),Qe=e.stopLossPct??e.slPct??e.sl??e.stopLoss??e.stop_loss??null,gt=e.takeProfitPct??e.tpPct??e.tp??e.takeProfit??e.take_profit??null,Ft=e.trailingStopPct??e.trailPct??e.trailing??e.trailingStop??null,ot=Qe==null?null:Math.max(0,Cp(Qe,0)),ve=gt==null?null:Math.max(0,Cp(gt,0)),Ie=Ft==null?null:Math.max(0,Cp(Ft,0)),It=typeof e.allowLong=="boolean"?e.allowLong:e.allowLong!==!1,Dt=typeof e.allowShort=="boolean"?e.allowShort:e.allowShort!==!1,Zt=typeof e.closeOnEnd=="boolean"?e.closeOnEnd:e.closeOnEnd!==!1,gn=o3(e.from??e.start??e.startDate??e.dateFrom??e.fromDate??e.rangeStart,"start")??null,hn=o3(e.to??e.end??e.endDate??e.dateTo??e.toDate??e.rangeEnd,"end")??null,qn=joe(e.session??e.tradingSession??e.sessionTime),On=e.takeProfits??e.tpLevels??e.takeProfitLevels??[],bn=[];if(Array.isArray(On))for(const yr of On){if(!yr||typeof yr!="object")continue;const Fi=Cp(yr.takeProfitPct??yr.tpPct??yr.pct,NaN),Rc=Cp(yr.qtyPct??yr.qty??yr.percent,NaN);!Number.isFinite(Fi)||Fi<=0||!Number.isFinite(Rc)||Rc<=0||bn.push({takeProfitPct:Fi,qtyPct:Math.max(0,Math.min(100,Rc))})}bn.sort((yr,Fi)=>yr.takeProfitPct-Fi.takeProfitPct);const Fn=e.risk&&typeof e.risk=="object"?e.risk:{},Xs=yr=>{if(yr==null)return null;const Fi=Cp(yr,NaN);return Number.isFinite(Fi)?Fi:null},oo=Xs(e.maxDrawdownPct??e.max_drawdown_pct??Fn.maxDrawdownPct??Fn.max_drawdown_pct??Fn.max_drawdown)??null,Yn=Xs(e.maxDrawdownCash??e.max_drawdown_cash??Fn.maxDrawdownCash??Fn.max_drawdown_cash)??null,_o=Xs(e.maxPositionPct??e.max_position_pct??Fn.maxPositionPct??Fn.max_position_pct??Fn.max_position_size)??null,xs=Xs(e.maxPositionCash??e.max_position_cash??Fn.maxPositionCash??Fn.max_position_cash)??null,Rt=Xs(e.maxPositionQty??e.max_position_qty??Fn.maxPositionQty??Fn.max_position_qty??Fn.max_contracts)??null,un=Xs(e.maxIntradayFilledOrders??e.max_intraday_filled_orders??Fn.maxIntradayFilledOrders??Fn.max_intraday_filled_orders)??null,qs=Xs(e.maxIntradayLossPct??e.max_intraday_loss_pct??Fn.maxIntradayLossPct??Fn.max_intraday_loss_pct??Fn.max_intraday_loss)??null,ri=Xs(e.maxIntradayLossCash??e.max_intraday_loss_cash??Fn.maxIntradayLossCash??Fn.max_intraday_loss_cash)??null;let Eo=0;const Ia=[];for(const yr of bn){if(Eo>=100)break;const Fi=100-Eo,Rc=Math.min(Fi,yr.qtyPct);Rc<=0||(Ia.push({takeProfitPct:yr.takeProfitPct,qtyPct:Rc}),Eo+=Rc)}const Lr=e.orderSize??e.positionSize??e.order??null;let Qa={type:"percent_of_equity",value:100};if(Lr&&typeof Lr=="object"){const yr=String(Lr.type||"").trim().toLowerCase(),Fi=Cp(Lr.value,100);yr==="cash"?Qa={type:"cash",value:Math.max(0,Fi)}:yr==="qty"?Qa={type:"qty",value:Math.max(0,Fi)}:yr?Qa={type:"percent_of_equity",value:Math.max(0,Math.min(100,Fi))}:Qa={type:"percent_of_equity",value:Math.max(0,Math.min(100,Fi))}}else if(Lr!=null){const yr=Cp(Lr,100);Qa={type:"percent_of_equity",value:Math.max(0,Math.min(100,yr))}}return{enabled:!0,execution:s,intrabarTieBreak:r,ohlcPath:l,intrabarTicks:f,initialCapital:u,fromTs:gn,toTs:hn,session:qn,orderSize:Qa,commissionPct:d,commissionCash:g,commissionPerUnit:w,commissionType:P,slippagePct:I,slippageAbs:F,slippageTicks:B,slippageType:L,priceTick:Q&&Q>0?Q:null,qtyStep:le&&le>0?le:null,minQty:ue&&ue>0?ue:null,spreadPct:pe&&pe>0?pe:null,leverage:xe,maintenanceMarginPct:Ke&&Ke>0?Ke:null,liquidationFeePct:qe&&qe>0?qe:null,borrowPctPerYear:nt&&nt>0?nt:null,fundingPctPerDay:ft&&ft>0?ft:null,positionMode:bt,closeMethod:Et,pyramiding:Mt,timeInForce:Ct,fillMode:Xe,volumeFillPct:Ae,stopLossPct:ot!=null&&ot>0?ot:null,takeProfitPct:ve!=null&&ve>0?ve:null,takeProfits:Ia,trailingStopPct:Ie!=null&&Ie>0?Ie:null,maxDrawdownPct:oo!=null&&oo>0?oo:null,maxDrawdownCash:Yn!=null&&Yn>0?Yn:null,maxPositionPct:_o!=null&&_o>0?_o:null,maxPositionCash:xs!=null&&xs>0?xs:null,maxPositionQty:Rt!=null&&Rt>0?Rt:null,maxIntradayFilledOrders:un!=null&&un>0?Math.floor(un):null,maxIntradayLossPct:qs!=null&&qs>0?qs:null,maxIntradayLossCash:ri!=null&&ri>0?ri:null,allowLong:It,allowShort:Dt,closeOnEnd:Zt}}function i3(n){return n==="cancel"||n==="cancel_all"?0:n==="exit_long"?1:n==="exit_short"?2:n==="entry_long"?3:n==="entry_short"?4:9}function o2(n){const e=n==null?void 0:n.close;return typeof e=="number"&&Number.isFinite(e)?e:null}function Bx(n){return typeof n=="number"&&Number.isFinite(n)?n:null}function Ooe(n){const e=o2(n);if(e==null)return null;const t=Bx(n==null?void 0:n.open)??e,s=Bx(n==null?void 0:n.high)??Math.max(t,e),o=Bx(n==null?void 0:n.low)??Math.min(t,e);return{o:t,h:s,l:o,c:e}}function zoe(n,e,t){var Fe,yt,vt,jt,ye;const s=t.initialCapital,o=t.commissionPct/100,r=t.commissionCash,a=t.commissionPerUnit,l=t.commissionType,c=t.slippagePct/100,f=t.slippageAbs,u=t.slippageTicks,d=t.slippageType,h=t.priceTick&&t.priceTick>0?t.priceTick:null,m=t.qtyStep&&t.qtyStep>0?t.qtyStep:null,g=t.minQty&&t.minQty>0?t.minQty:null,w=t.spreadPct&&t.spreadPct>0?t.spreadPct/100:0,C=w>0?w/2:0,P=Math.max(1,Number(t.leverage)||1),I=t.maintenanceMarginPct&&t.maintenanceMarginPct>0?t.maintenanceMarginPct/100:null,A=t.liquidationFeePct&&t.liquidationFeePct>0?t.liquidationFeePct/100:null,M=t.borrowPctPerYear&&t.borrowPctPerYear>0?t.borrowPctPerYear/100:null,F=t.fundingPctPerDay&&t.fundingPctPerDay>0?t.fundingPctPerDay/100:null,B=t.maxDrawdownPct&&t.maxDrawdownPct>0?t.maxDrawdownPct/100:null,$=t.maxDrawdownCash&&t.maxDrawdownCash>0?t.maxDrawdownCash:null,L=t.maxPositionPct&&t.maxPositionPct>0?t.maxPositionPct/100:null,O=t.maxPositionCash&&t.maxPositionCash>0?t.maxPositionCash:null,Y=t.maxPositionQty&&t.maxPositionQty>0?t.maxPositionQty:null,ce=t.maxIntradayFilledOrders&&t.maxIntradayFilledOrders>0?Math.floor(t.maxIntradayFilledOrders):null,Q=t.maxIntradayLossPct&&t.maxIntradayLossPct>0?t.maxIntradayLossPct/100:null,le=t.maxIntradayLossCash&&t.maxIntradayLossCash>0?t.maxIntradayLossCash:null,ue=(E,me,Se)=>{const Ve=(Se==null?void 0:Se.commissionMode)??l,Ye=(Se==null?void 0:Se.commissionValue)??(Ve==="per_unit"?a:Ve==="cash"?r:o);return Number.isFinite(Ye)?Ve==="cash"?Math.max(0,Ye):Ve==="per_unit"?Math.max(0,Ye*Math.max(0,E)):Math.max(0,me*Math.max(0,Ye)):0},fe=(E,me)=>{const Se=(me==null?void 0:me.slippageMode)??d,Ve=(me==null?void 0:me.slippageValue)??(Se==="ticks"?u:Se==="abs"?f:c);return Number.isFinite(Ve)?Se==="ticks"?h?Math.max(0,Ve*h):0:Se==="abs"?Math.max(0,Ve):Math.max(0,E*Math.max(0,Ve)):0},pe=E=>{if(!Number.isFinite(E)||E<=0)return 0;const me=String(E),Se=me.match(/e-(\d+)$/i);if(Se)return Math.max(0,Math.min(12,Number(Se[1])||0));const Ve=me.indexOf(".");return Ve>=0?Math.max(0,Math.min(12,me.length-Ve-1)):0},Z=(E,me,Se)=>{if(!Number.isFinite(E))return NaN;if(!Number.isFinite(me)||me<=0)return E;const Ve=pe(me),Ye=Math.pow(10,Ve),at=Math.round(me*Ye);if(!Number.isFinite(at)||at<=0)return E;const Re=E*Ye;return(Se==="ceil"?Math.ceil(Re/at-1e-12):Se==="round"?Math.round(Re/at):Math.floor(Re/at+1e-12))*at/Ye},xe=(E,me)=>m?Z(E,m,me):E,oe=(E,me)=>E==="entry"?me==="long":me==="short",Pe=(E,me)=>C?oe(E,me)?1+C:1-C:1,$e=(E,me,Se)=>{const Ve=Pe(me,Se);return Ve===1?E:{o:E.o*Ve,h:E.h*Ve,l:E.l*Ve,c:E.c*Ve}},ze=(E,me,Se,Ve)=>{if(!h)return Ve;const Ye=oe(E,me);return Z(Ve,h,Se==="limit"?Ye?"floor":"ceil":Ye?"ceil":"floor")},Ke=(E,me,Se)=>{if(!h)return Se;const Ye=oe(E,me)?"ceil":"floor";return Z(Se,h,Ye)};let qe=0,nt=0;const ft={long:[],short:[]},ut=E=>ft[E],bt=E=>ut(E).some(me=>me.qty>1e-12),Pt=()=>bt("long")||bt("short"),Et=E=>ut(E).filter(me=>me.qty>1e-12).length,Mt=E=>E==="long"?"short":"long",Je=[],Ct=[],Ze=[],Xe=new Map;let Ae=1;const Qe=[],gt=()=>`o${Ae++}`,Ft=E=>{var Se;const me=Number((Se=n[E])==null?void 0:Se.timestamp);return Number.isFinite(me)&&me>0?me:Date.now()},ot=E=>{const me=gt(),Se={id:me,...E};return Ze.push(Se),Xe.set(me,Se),Se},ve=(E,me)=>{if(!E)return;const Se=Xe.get(E);Se&&Object.assign(Se,me)},Ie=E=>{const me=E.id?Xe.get(E.id):null;if(!me)return;const Se=Number.isFinite(me.fillQty)?me.fillQty:0,Ve=Number.isFinite(me.fillPrice)?me.fillPrice:0,Ye=Number.isFinite(E.qty)?E.qty:0,at=Se+Ye,Re=at>0?(Ve*Se+E.price*Ye)/at:E.price,De=(Number.isFinite(me.fees)?me.fees:0)+(Number.isFinite(E.fees)?E.fees:0);me.fillQty=at,me.fillPrice=Re,me.fees=De,me.filledIndex=E.index,me.filledTimestamp=E.timestamp,E.targetQty!=null&&(me.targetQty=E.targetQty),E.remainingQty!=null&&(me.remainingQty=E.remainingQty),E.status&&(me.status=E.status),E.note&&(me.note=E.note)},It=n.length,Dt={initialCapital:s,finalEquity:s,netPnl:0,netPnlPct:0,grossProfit:0,grossLoss:0,profitFactor:0,trades:0,roundTrips:0,wins:0,losses:0,winRate:0,maxDrawdownPct:0,maxDrawdownValue:0,feesPaid:0,avgTrade:0,avgWin:0,avgLoss:0,payoffRatio:0,expectancy:0,maxConsecWins:0,maxConsecLosses:0,exposurePct:0,maxRunupPct:0,maxRunupValue:0,avgBarsInTrade:0,volatilityPct:0,sharpe:0,sortino:0,calmar:0};if(!It)return{summary:Dt,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]};const Zt=new Array(It).fill(0),gn=new Array(It).fill(0),hn=new Array(It).fill(0),qn=new Array(It).fill(0),On=new Array(It).fill(0),bn=new Array(It).fill(0),Fn=new Array(It).fill(0),Xs=new Array(It).fill(0),oo=new Array(It).fill(0),Yn=new Array(It).fill(0),_o=new Array(It).fill(0),xs=new Array(It).fill(0),Rt=new Array(It).fill(0),un=new Array(It).fill(0),qs=new Array(It).fill(0),ri=new Array(It).fill(0),Eo=new Array(It).fill(0),Ia=new Array(It).fill(0),Lr=new Array(It).fill(0),Qa=new Array(It).fill(s),yr=new Array(It).fill(0),Fi=Array.from({length:It},()=>[]);let Rc=0,Cu=0,uc=0,Fl=0,jc=0,nd=0,Fa=0,dc="",Bc=s,rd=!1;const uf=t.fromTs!=null&&Number.isFinite(t.fromTs)?t.fromTs:null,So=t.toTs!=null&&Number.isFinite(t.toTs)?t.toTs:null;let Ll=0,ya=It-1;if(uf!=null){const E=n.findIndex(me=>Number(me==null?void 0:me.timestamp)>=uf);if(E>=0)Ll=E;else return{summary:Dt,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}if(So!=null){for(let E=It-1;E>=0;E--){const me=Number((Fe=n[E])==null?void 0:Fe.timestamp);if(Number.isFinite(me)&&me<=So){ya=E;break}}if(ya<Ll)return{summary:Dt,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}const hc=t.session,Pa=E=>{var Re;if(!hc)return!0;const me=Number((Re=n[E])==null?void 0:Re.timestamp);if(!Number.isFinite(me)||me<=0)return!0;const Se=new Date(me),Ve=Se.getUTCHours()*60+Se.getUTCMinutes(),{startMin:Ye,endMin:at}=hc;return Ye<=at?Ve>=Ye&&Ve<=at:Ve>=Ye||Ve<=at},Yr=(Array.isArray(e)?e:[]).filter(E=>typeof(E==null?void 0:E.index)=="number"&&E.index>=0).filter(E=>E.index>=Ll&&E.index<=ya).filter(E=>Pa(E.index)).slice().sort((E,me)=>E.index-me.index||i3(E.type)-i3(me.type));let el=0,Yl=s,Vu=0,Iu=0,Ro=s,zr=0,kl=0,Md=1;const nf={long:null,short:null},zf=(E,me)=>{const Se=nf[E];if(Se)return Se;const Ve={id:`t${Md++}`,side:E,entryIndex:me,entryTimestamp:Ft(me),exitIndex:me,exitTimestamp:Ft(me),qtyEntered:0,entryNotional:0,qtyExited:0,exitNotional:0,grossPnl:0,fees:0,entries:0,exits:0};return nf[E]=Ve,Ve},df=(E,me)=>{if(bt(E))return;const Se=nf[E];if(!Se)return;const Ve=Se.qtyEntered,Ye=Ve>0?Se.entryNotional/Ve:0,at=Se.qtyExited>0?Se.exitNotional/Se.qtyExited:0,Re=Se.entryNotional>0?Se.grossPnl/Se.entryNotional*100:0;Ct.push({id:Se.id,side:Se.side,entryIndex:Se.entryIndex,entryTimestamp:Se.entryTimestamp,exitIndex:Se.exitIndex,exitTimestamp:Se.exitTimestamp,qty:Ve,avgEntryPrice:Ye,avgExitPrice:at,grossPnl:Se.grossPnl,fees:Se.fees,netPnl:Se.grossPnl-Se.fees,pnlPct:Re,entries:Se.entries,exits:Se.exits,maePct:typeof Se.maeMin=="number"&&Number.isFinite(Se.maeMin)?Se.maeMin:void 0,mfePct:typeof Se.mfeMax=="number"&&Number.isFinite(Se.mfeMax)?Se.mfeMax:void 0}),nf[E]=null},Pu=(E,me)=>{let Se=0;for(const Ve of ut("long"))Ve.qty<=0||(Se+=(me-Ve.entryPrice)*Ve.qty);for(const Ve of ut("short"))Ve.qty<=0||(Se+=(Ve.entryPrice-me)*Ve.qty);return s+qe+Se-nt},Dd=E=>{let me=0;for(const Se of ut("long"))Se.qty<=0||(me+=(E-Se.entryPrice)*Se.qty);for(const Se of ut("short"))Se.qty<=0||(me+=(Se.entryPrice-E)*Se.qty);return Number.isFinite(me)?me:0},yf=()=>{let E=0,me=0,Se=0,Ve=0;for(const at of ut("long"))at.qty<=0||(E+=at.qty,me+=at.entryPrice*at.qty);for(const at of ut("short"))at.qty<=0||(Se+=at.qty,Ve+=at.entryPrice*at.qty);const Ye=E-Se;return Ye>0&&E>0?me/E:Ye<0&&Se>0?Ve/Se:NaN},$n=(E,me)=>{if(t.orderSize.type==="cash")return Math.max(0,t.orderSize.value)*P;if(t.orderSize.type==="qty")return Math.max(0,t.orderSize.value*me);const Se=Math.max(0,Math.min(100,t.orderSize.value));return E*Se/100*P},ws=()=>{let E=0;for(const me of ut("long"))E+=me.qty>0?me.entryNotional:0;for(const me of ut("short"))E+=me.qty>0?me.entryNotional:0;return E},Us=()=>P>0?ws()/P:0,Dn=E=>{const me=Number(E);if(!Number.isFinite(me)||me<=0)return{long:0,short:0,total:0};let Se=0,Ve=0;for(const Ye of ut("long"))Se+=Ye.qty>0?Ye.qty*me:0;for(const Ye of ut("short"))Ve+=Ye.qty>0?Ye.qty*me:0;return{long:Se,short:Ve,total:Se+Ve}},ni=(E,me,Se)=>{var Zs,vs;if(!Pt()||!M&&!F||E<=Se)return;const Ve=Number((Zs=n[E-1])==null?void 0:Zs.timestamp),Ye=Number((vs=n[E])==null?void 0:vs.timestamp);if(!Number.isFinite(Ve)||!Number.isFinite(Ye)||Ye<=Ve)return;const at=Ye-Ve,Re=at/864e5,De=at/(365*864e5);if(!Number.isFinite(Re)||Re<=0)return;const pt=Dn(me);let Ge=0,sn=0;F&&(Ge=Math.max(0,pt.total*F*Re)),M&&(sn=Math.max(0,pt.short*M*De));const Un=Ge+sn;if(!(!Number.isFinite(Un)||Un<=0)){if(nt+=Un,Ge>0&&pt.total>0){const Oo=Ge*pt.long/pt.total,Pi=Ge-Oo;nf.long&&(nf.long.fees+=Oo),nf.short&&(nf.short.fees+=Pi)}sn>0&&nf.short&&(nf.short.fees+=sn)}},mo=(E,me,Se)=>{if(!Pt())return!1;const Ve=Ft(E);let Ye=!1;for(const at of["long","short"]){if(!bt(at))continue;const Re=ot({action:"exit",side:at,kind:"market",originalKind:"market",status:"pending",createdIndex:E,createdTimestamp:Ve,activeFromIndex:E,qtyPct:100,price:me,note:Se}),De=Li(at,E,me,"liquidation","market",{orderId:Re.id},A??void 0);De?(ve(Re.id,{status:"filled",filledIndex:E,filledTimestamp:Ve,fillPrice:De.execPrice,fillQty:De.qtyClosed,fees:De.exitFees}),Ye=!0):ve(Re.id,{status:"rejected",note:`${Se} (no fill)`})}if(Ye&&qi.length){for(const at of qi)ve(at.orderId,{status:"canceled",note:"Canceled on liquidation"});qi.length=0}return Ye},sr=(E,me)=>{if(!I||!Pt())return!1;const Se=pt=>{const Ge=Pu(E,pt),Un=Dn(pt).total*I;return{px:pt,equityNow:Ge,req:Un,gap:Ge-Un}},Ve=Se(me.l),Ye=Se(me.h),at=Number.isFinite(Ve.gap)&&Ve.gap<=1e-9,Re=Number.isFinite(Ye.gap)&&Ye.gap<=1e-9;if(!at&&!Re)return!1;const De=at&&Re?Ve.gap<=Ye.gap?Ve:Ye:at?Ve:Ye;return mo(E,De.px,"AUTO liquidation")},or=(E,me,Se,Ve)=>{const Ye=fe(Se,Ve);return!Number.isFinite(Ye)||Ye<=0?Se:oe(E,me)?Se+Ye:Se-Ye},hl=(E,me,Se,Ve)=>{if(Se==="limit")return Ke("entry",E,me);const Ye=me*Pe("entry",E),at=or("entry",E,Ye,Ve);return Ke("entry",E,at)},Oi=(E,me,Se,Ve)=>{if(Se==="limit")return Ke("exit",E,me);const Ye=me*Pe("exit",E),at=or("exit",E,Ye,Ve);return Ke("exit",E,at)},si=E=>{if(!E||typeof E!="object")return;const me=Ge=>{const sn=typeof Ge=="number"?Ge:Number(Ge);return Number.isFinite(sn)?sn:void 0},Se=me(E.stopLossPct),Ve=me(E.takeProfitPct),Ye=me(E.trailingStopPct),at=E.takeProfits,Re=[];if(Array.isArray(at))for(const Ge of at){if(!Ge||typeof Ge!="object")continue;const sn=me(Ge.takeProfitPct),Un=me(Ge.qtyPct);sn==null||sn<=0||Un==null||Un<=0||Re.push({takeProfitPct:Math.max(0,sn),qtyPct:Math.max(0,Math.min(100,Un))})}Re.sort((Ge,sn)=>Ge.takeProfitPct-sn.takeProfitPct);let De=0;const pt=[];for(const Ge of Re){if(De>=100)break;const sn=100-De,Un=Math.min(sn,Ge.qtyPct);Un<=0||(pt.push({takeProfitPct:Ge.takeProfitPct,qtyPct:Un}),De+=Un)}if(!(Se==null&&Ve==null&&Ye==null&&pt.length===0))return{stopLossPct:Se,takeProfitPct:Ve,trailingStopPct:Ye,takeProfits:pt.length?pt:void 0}},Wo=(E,me,Se,Ve,Ye)=>{if(!Number.isFinite(Se)||Se<=0)return{ok:!1,reject:"Invalid fill price"};const at=Pu(me,Se),Re=Ye&&typeof Ye.qty=="number"&&Number.isFinite(Ye.qty)?Math.abs(Ye.qty):null,De=Ye&&typeof Ye.cash=="number"&&Number.isFinite(Ye.cash)?Math.abs(Ye.cash):null;let pt=0;if(Re!=null)pt=Re;else if(De!=null)pt=De*P/Se;else{const vs=Number.isFinite(Ve)?Math.max(0,Math.min(100,Ve)):100;if(vs<=0)return{ok:!1,reject:"qtyPct <= 0"};const Oo=$n(at,Se)*vs/100;if(!Number.isFinite(Oo)||Oo<=0)return{ok:!1,reject:"Notional <= 0"};pt=Oo/Se}if(!Number.isFinite(pt)||pt<=0)return{ok:!1,reject:"Qty <= 0"};const Ge=xe(pt,"floor");if(!Number.isFinite(Ge)||Ge<=0)return m?{ok:!1,reject:`Qty rounded to 0 (qtyStep=${m})`}:{ok:!1,reject:"Qty <= 0"};if(g!=null&&Ge<g)return{ok:!1,reject:`Qty ${Ge} < minQty ${g}`};if(Y!=null&&Vr(E)+Ge>Y)return{ok:!1,reject:"Max position qty exceeded"};if(O!=null&&Dn(Se)[E]+Ge*Se>O)return{ok:!1,reject:"Max position cash exceeded"};if(L!=null&&L>0){const Oo=Dn(Se)[E]+Ge*Se,Pi=at*L;if(Pi>0&&Oo>Pi)return{ok:!1,reject:"Max position percent exceeded"}}const sn=Se*Ge,Un=P>0?sn/P:sn,Zs=Us();return Un>0&&Zs+Un>at+1e-9?{ok:!1,reject:"Insufficient margin"}:{ok:!0,qty:Ge,equityNow:at}},Ua=(E,me,Se,Ve=100,Ye="market",at,Re,De)=>{var Lf,_e,We;if(t.positionMode==="netting"&&bt(Mt(E)))return{ok:!1,reject:"Netting mode: opposite position open"};if(rd)return{ok:!1,reject:"Risk limit reached"};if(ce!=null&&Fa>=ce)return{ok:!1,reject:"Max intraday filled orders reached"};if(Et(E)>=t.pyramiding)return{ok:!1,reject:`Pyramiding limit reached (${t.pyramiding})`};const pt=hl(E,Se,Ye,De),Ge=Wo(E,me,pt,Ve,De);if(!Ge.ok)return{ok:!1,reject:Ge.reject};const sn=Ge.qty,Un=pt*sn,Zs=ue(sn,Un,De);nt+=Zs;{const xt=zf(E,me);xt.qtyEntered+=sn,xt.entryNotional+=Un,xt.fees+=Zs,xt.entries+=1}const vs=t.closeMethod==="avg"?void 0:si(at),Oo=(vs==null?void 0:vs.stopLossPct)!=null?vs.stopLossPct:t.stopLossPct,Pi=(vs==null?void 0:vs.takeProfitPct)!=null?vs.takeProfitPct:t.takeProfitPct,no=(vs==null?void 0:vs.trailingStopPct)!=null?vs.trailingStopPct:t.trailingStopPct,gl=Oo&&Oo>0?E==="long"?pt*(1-Oo/100):pt*(1+Oo/100):null,Ms=Pi&&Pi>0?E==="long"?pt*(1+Pi/100):pt*(1-Pi/100):null,wo=gl!=null&&Number.isFinite(gl)?ze("exit",E,"stop",gl):null,fr=Ms!=null&&Number.isFinite(Ms)?ze("exit",E,"limit",Ms):null,xa={side:E,qty:sn,entryIndex:me,entryTimestamp:((Lf=n[me])==null?void 0:Lf.timestamp)??Date.now(),entryPrice:pt,entrySignalId:Re==null?void 0:Re.signalId,entryOrderId:Re==null?void 0:Re.orderId,entrySignalScore:(Re==null?void 0:Re.score)??null,entryNotional:Un,entryFee:Zs,entryFeeRemaining:Zs,stopPrice:wo&&Number.isFinite(wo)?wo:null,takePrice:fr&&Number.isFinite(fr)?fr:null,trailingPct:no,trailingStop:no&&no>0?E==="long"?ze("exit",E,"stop",pt*(1-no/100)):ze("exit",E,"stop",pt*(1+no/100)):null,takeProfitOrders:[],maxFav:pt,maxAdv:pt},ic=(_e=vs==null?void 0:vs.takeProfits)!=null&&_e.length?vs.takeProfits:t.takeProfits;if(ic!=null&&ic.length){const xt=[];let Ht=0;for(const qt of ic){if(Ht>=sn)break;const ht=Math.max(0,Math.min(sn-Ht,sn*qt.qtyPct/100)),dn=xe(ht,"floor");if(!Number.isFinite(dn)||dn<=0||g!=null&&dn<g&&dn<sn-Ht-1e-12)continue;const Ut=E==="long"?pt*(1+qt.takeProfitPct/100):pt*(1-qt.takeProfitPct/100),Xn=ze("exit",E,"limit",Ut);!Number.isFinite(Xn)||Xn<=0||(xt.push({price:Xn,qty:dn,pct:qt.takeProfitPct}),Ht+=dn)}xa.takeProfitOrders=xt.sort((qt,ht)=>E==="long"?qt.price-ht.price:ht.price-qt.price)}Fa+=1;const ec=ut(E);if(t.closeMethod==="avg"&&ec.length){const xt=ec[0],Ht=xt.qty+xa.qty,qt=xt.entryNotional+xa.entryNotional,ht=Ht>0?qt/Ht:xt.entryPrice;xt.qty=Ht,xt.entryNotional=qt,xt.entryPrice=ht,xt.entryFee+=xa.entryFee,xt.entryFeeRemaining+=xa.entryFeeRemaining;const dn=t.stopLossPct,Ut=t.takeProfitPct,Xn=t.trailingStopPct,rs=dn&&dn>0?E==="long"?ht*(1-dn/100):ht*(1+dn/100):null,_t=Ut&&Ut>0?E==="long"?ht*(1+Ut/100):ht*(1-Ut/100):null;if(xt.stopPrice=rs!=null&&Number.isFinite(rs)?ze("exit",E,"stop",rs):null,xt.takePrice=_t!=null&&Number.isFinite(_t)?ze("exit",E,"limit",_t):null,xt.trailingPct=Xn,xt.trailingStop=Xn&&Xn>0?E==="long"?ze("exit",E,"stop",ht*(1-Xn/100)):ze("exit",E,"stop",ht*(1+Xn/100)):null,xt.takeProfitOrders=[],(We=t.takeProfits)!=null&&We.length){const Gt=[];let en=0;for(const cs of t.takeProfits){if(en>=xt.qty)break;const ps=Math.max(0,Math.min(xt.qty-en,xt.qty*cs.qtyPct/100)),vo=xe(ps,"floor");if(!Number.isFinite(vo)||vo<=0)continue;const Ko=E==="long"?ht*(1+cs.takeProfitPct/100):ht*(1-cs.takeProfitPct/100),ho=ze("exit",E,"limit",Ko);!Number.isFinite(ho)||ho<=0||(Gt.push({price:ho,qty:vo,pct:cs.takeProfitPct}),en+=vo)}xt.takeProfitOrders=Gt.sort((cs,ps)=>E==="long"?cs.price-ps.price:ps.price-cs.price)}return xt.maxFav=xt.maxFav==null?ht:xt.maxFav,xt.maxAdv=xt.maxAdv==null?ht:xt.maxAdv,{ok:!0,lot:xt}}return ec.push(xa),{ok:!0,lot:xa}},Hi=(E,me,Se,Ve,Ye)=>{const at=Vr(E);if(!Number.isFinite(at)||at<=0)return 0;if(Ve!=null&&Number.isFinite(Ve)){const De=Math.abs(Ve);return De>0?Math.min(at,De):0}if(Ye!=null&&Number.isFinite(Ye)){const De=Math.abs(Ye);if(De<=0||!Number.isFinite(me)||me<=0)return 0;const Ge=(P>0?De*P:De)/me;return Number.isFinite(Ge)&&Ge>0?Math.min(at,Ge):0}const Re=Number.isFinite(Se)?Math.max(0,Math.min(100,Se)):100;return Re<=0?0:at*Re/100},to=(E,me,Se,Ve="signal",Ye,at="market",Re,De,pt)=>{var ic;const Ge=E.side;m&&(E.qty=xe(E.qty,"round"));const sn=Oi(Ge,Se,at,pt);if(!Number.isFinite(sn)||sn<=0)return null;const Un=E.qty,Zs=Ye==null?Un:Math.max(0,Math.min(Un,Ye)),vs=Ye==null?m?xe(Zs,"round"):Zs:m?xe(Zs,"floor"):Zs;if(!Number.isFinite(vs)||vs<=0||g!=null&&Ye!=null&&vs<g&&vs<Un-1e-12)return null;const Oo=Un>0&&Number.isFinite(E.entryFeeRemaining)?E.entryFeeRemaining*vs/Un:0,Pi=sn*vs,no=ue(vs,Pi,pt),gl=De&&De>0?Pi*De:0;nt+=no,nt+=gl;const Ms=Ge==="long"?(sn-E.entryPrice)*vs:(E.entryPrice-sn)*vs;qe+=Ms;{const ec=zf(Ge,E.entryIndex);ec.qtyExited+=vs,ec.exitNotional+=Pi,ec.grossPnl+=Ms,ec.fees+=Oo+no+gl,ec.exits+=1,ec.exitIndex=me,ec.exitTimestamp=Ft(me)}const wo=Number.isFinite(E.entryPrice)&&E.entryPrice>0?E.entryPrice*vs:NaN,fr=(()=>{if(!(E.entryPrice<=0)&&!(E.maxAdv==null||!Number.isFinite(E.maxAdv)))return E.side==="long"?(E.maxAdv-E.entryPrice)/E.entryPrice*100:(E.entryPrice-E.maxAdv)/E.entryPrice*100})(),xa=(()=>{if(!(E.entryPrice<=0)&&!(E.maxFav==null||!Number.isFinite(E.maxFav)))return E.side==="long"?(E.maxFav-E.entryPrice)/E.entryPrice*100:(E.entryPrice-E.maxFav)/E.entryPrice*100})();Je.push({side:Ge,qty:vs,entryIndex:E.entryIndex,entryTimestamp:E.entryTimestamp,entryPrice:E.entryPrice,entrySignalId:E.entrySignalId,entryOrderId:E.entryOrderId,entrySignalScore:E.entrySignalScore??null,exitIndex:me,exitTimestamp:((ic=n[me])==null?void 0:ic.timestamp)??Date.now(),exitPrice:sn,exitSignalId:Re==null?void 0:Re.signalId,exitOrderId:Re==null?void 0:Re.orderId,exitSignalScore:(Re==null?void 0:Re.score)??null,exitReason:Ve,pnl:Ms,pnlPct:Number.isFinite(wo)&&wo>0?Ms/wo*100:0,fees:Oo+no+gl,entryFee:Oo,exitFee:no+gl,netPnl:Ms-(Oo+no+gl),maePct:typeof fr=="number"&&Number.isFinite(fr)?fr:void 0,mfePct:typeof xa=="number"&&Number.isFinite(xa)?xa:void 0}),nd+=Math.max(0,me-E.entryIndex+1),Rc+=Oo+no+gl,Ms>0?(Cu+=Ms,Fl+=1):Ms<0&&(uc+=Math.abs(Ms),jc+=1);try{const ec=nf[Ge];typeof fr=="number"&&Number.isFinite(fr)&&ec&&(ec.maeMin=ec.maeMin==null?fr:Math.min(ec.maeMin,fr)),typeof xa=="number"&&Number.isFinite(xa)&&ec&&(ec.mfeMax=ec.mfeMax==null?xa:Math.max(ec.mfeMax,xa))}catch{}return E.qty-=vs,m&&(E.qty=xe(E.qty,"round")),E.entryFeeRemaining=Math.max(0,E.entryFeeRemaining-Oo),E.qty<=1e-12&&(E.entryFeeRemaining=0),{qtyClosed:vs,fees:Oo+no+gl,exitFee:no+gl,execPrice:sn}},Li=(E,me,Se,Ve="signal",Ye="market",at,Re,De)=>{const pt=ut(E);if(!pt.length)return null;const Ge=pt.slice();let sn=0,Un=0,Zs=0,vs=0;for(const Oo of Ge)if(Oo.qty>0){const Pi=to(Oo,me,Se,Ve,Oo.qty,Ye,at,Re,De);Pi&&(sn+=Pi.qtyClosed,Un+=Pi.fees,Zs+=Pi.exitFee,vs+=Pi.execPrice*Pi.qtyClosed)}return ft[E]=ut(E).filter(Oo=>Oo.qty>1e-12),df(E),sn<=0?null:{qtyClosed:sn,fees:Un,exitFees:Zs,execPrice:vs/sn}},Vr=E=>{const me=ut(E);return me.length?me.reduce((Se,Ve)=>Se+(Ve.qty>0?Ve.qty:0),0):0},ba=(E,me,Se,Ve,Ye="signal",at="market",Re,De,pt)=>{const Ge=ut(E);if(!Ge.length)return null;let sn=Math.max(0,Ve),Un=0,Zs=0,vs=0,Oo=0;const Pi=t.closeMethod==="lifo"?Ge.slice().reverse():Ge;for(const no of Pi){if(sn<=0)break;if(no.qty<=0)continue;const gl=Math.min(no.qty,sn),Ms=to(no,me,Se,Ye,gl,at,Re,De,pt);Ms&&(Un+=Ms.qtyClosed,Zs+=Ms.fees,vs+=Ms.exitFee,Oo+=Ms.execPrice*Ms.qtyClosed),sn-=gl}return ft[E]=ut(E).filter(no=>no.qty>1e-12),df(E),Un<=0?null:{qtyClosed:Un,fees:Zs,exitFees:vs,execPrice:Oo/Un}},qi=[],Wr=(E,me)=>{for(let Se=qi.length-1;Se>=0;Se--){const Ve=qi[Se];E(Ve)&&(ve(Ve.orderId,{status:"canceled",note:me}),qi.splice(Se,1))}},Kl=(E,me)=>{if(!E)return;const Se=String(E).trim();Se&&Wr(Ve=>String(Ve.signalId||"")===Se||String(Ve.orderId||"")===Se,me)},Wl=E=>{Wr(()=>!0,E)},Ic=E=>(E==null?void 0:E.order)||{},Pc=E=>{const me=typeof E=="number"?E:Number(E);return!Number.isFinite(me)||me<=0?100:Math.max(0,Math.min(100,me))},cl=E=>{const me=typeof E=="number"?E:Number(E);return Number.isFinite(me)?Math.max(0,me):null},mr=E=>{const me=typeof E=="number"?E:Number(E);return Number.isFinite(me)?me:null},La=E=>{if(!E||typeof E!="object")return null;const me=String(E.commissionType??E.commission_mode??E.commissionMode??"").trim().toLowerCase(),Se=E.commissionCash??E.commission_cash??E.commissionFixed??E.commission_fixed??null,Ve=E.commissionPerUnit??E.commission_per_unit??E.commissionPerShare??E.commission_per_share??null,Ye=E.commissionValue??E.commission_value??null,at=E.commissionPct??E.commission??null;let Re=null,De=null;return me==="cash"?(Re="cash",De=mr(Ye??Se)):me==="per_unit"||me==="perunit"?(Re="per_unit",De=mr(Ye??Ve)):me==="percent"||me==="pct"?(Re="percent",De=cl(at),De!=null&&(De/=100)):Ve!=null?(Re="per_unit",De=mr(Ve)):Se!=null?(Re="cash",De=mr(Se)):Ye!=null?(Re="percent",De=cl(Ye),De!=null&&(De/=100)):at!=null&&(Re="percent",De=cl(at),De!=null&&(De/=100)),!Re||De==null||!Number.isFinite(De)?null:{commissionMode:Re,commissionValue:Math.max(0,De)}},Sl=E=>{if(!E||typeof E!="object")return null;const me=String(E.slippageType??E.slippage_mode??E.slippageMode??"").trim().toLowerCase(),Se=E.slippageAbs??E.slippage_abs??null,Ve=E.slippageTicks??E.slippage_ticks??null,Ye=E.slippageValue??E.slippage_value??null,at=E.slippagePct??E.slippage??null;let Re=null,De=null;return me==="abs"?(Re="abs",De=mr(Ye??Se)):me==="ticks"?(Re="ticks",De=mr(Ye??Ve)):me==="percent"||me==="pct"?(Re="percent",De=cl(at),De!=null&&(De/=100)):Se!=null?(Re="abs",De=mr(Se)):Ve!=null?(Re="ticks",De=mr(Ve)):Ye!=null?(Re="percent",De=cl(Ye),De!=null&&(De/=100)):at!=null&&(Re="percent",De=cl(at),De!=null&&(De/=100)),!Re||De==null||!Number.isFinite(De)?null:{slippageMode:Re,slippageValue:Math.max(0,De)}},Ba=E=>{const me=String(E||"market").trim().toLowerCase();return me==="limit"||me==="lit"?"limit":me==="stop"||me==="trailing_stop"?"stop":"market"},vi=(E,me,Se,Ve,Ye)=>Number.isFinite(Ye)?E==="entry"?me==="long"?Se==="limit"?Ve.l<=Ye:Ve.h>=Ye:Se==="limit"?Ve.h>=Ye:Ve.l<=Ye:me==="long"?Se==="limit"?Ve.h>=Ye:Ve.l<=Ye:Se==="limit"?Ve.l<=Ye:Ve.h>=Ye:!1,vc=(E,me,Se)=>{for(const Ve of Se)E.side==="long"?Ve==="high"?E.maxFav=E.maxFav==null?me.h:Math.max(E.maxFav,me.h):E.maxAdv=E.maxAdv==null?me.l:Math.min(E.maxAdv,me.l):Ve==="low"?E.maxFav=E.maxFav==null?me.l:Math.min(E.maxFav,me.l):E.maxAdv=E.maxAdv==null?me.h:Math.max(E.maxAdv,me.h)},ul=E=>t.intrabarTieBreak==="ohlc"?t.ohlcPath==="open_high_low_close"?["high","low"]:["low","high"]:t.intrabarTieBreak==="best_case"?E==="long"?["high","low"]:["low","high"]:E==="long"?["low","high"]:["high","low"],Ga=E=>{const{lot:me,i:Se,triggerPx:Ve,reason:Ye,qty:at,fillKind:Re,note:De}=E;if(!Number.isFinite(Ve)||Ve<=0||!Number.isFinite(at)||at<=0)return!1;const pt=Re==="limit"?"limit":"stop",Ge=Ft(Se),sn=ot({action:"exit",side:me.side,kind:pt,originalKind:pt,status:"pending",createdIndex:Se,createdTimestamp:Ge,activeFromIndex:Se,qtyPct:100,price:Ve,note:De}),Un=to(me,Se,Ve,Ye,at,Re,{orderId:sn.id});return Un?(ve(sn.id,{status:"filled",filledIndex:Se,filledTimestamp:Ge,fillPrice:Un.execPrice,fillQty:Un.qtyClosed,fees:Un.exitFee,note:De}),!0):(ve(sn.id,{status:"rejected",note:`${De} (no fill)`}),!1)},vl=E=>{var Ve;if(t.fillMode!=="volume")return Number.POSITIVE_INFINITY;const me=Number((Ve=n[E])==null?void 0:Ve.volume);if(!Number.isFinite(me)||me<=0)return Number.POSITIVE_INFINITY;const Se=me*t.volumeFillPct/100;return Number.isFinite(Se)&&Se>0?Se:Number.POSITIVE_INFINITY},pu=(E,me,Se)=>{if(E.targetQty!=null&&E.remainingQty!=null)return{ok:!0,target:E.targetQty,remaining:E.remainingQty};if(E.action==="entry"){const Re=Wo(E.side,me,Se,E.qtyPct,{qty:E.qty,cash:E.cash});return Re.ok?(E.targetQty=Re.qty,E.remainingQty=Re.qty,{ok:!0,target:Re.qty,remaining:Re.qty}):{ok:!1,reject:Re.reject}}const Ve=Hi(E.side,Se,E.qtyPct,E.qty,E.cash),Ye=xe(Ve,"floor");if(!Number.isFinite(Ye)||Ye<=0)return{ok:!1,reject:"Qty <= 0"};const at=Vr(E.side);return g!=null&&Ye>0&&Ye<g&&Ye<at-1e-12?{ok:!1,reject:`Qty ${Ye} < minQty ${g}`}:(E.targetQty=Ye,E.remainingQty=Ye,{ok:!0,target:Ye,remaining:Ye})},tl=E=>E.tif??t.timeInForce,Oa=(E,me,Se,Ve,Ye,at)=>{const Re=pu(E,me,Se);if(!Re.ok)return ve(E.orderId,{status:"rejected",note:Re.reject}),{remove:!0,filled:!1};const De=tl(E),pt=Re.remaining,Ge=vl(me),sn=Math.min(pt,Ge);if(De==="fok"&&sn+1e-12<pt)return ve(E.orderId,{status:"rejected",note:"FOK not fully filled"}),{remove:!0,filled:!1};if(De==="ioc"&&sn<=0)return ve(E.orderId,{status:"canceled",note:"IOC not filled"}),{remove:!0,filled:!1};if(sn<=0)return{remove:!1,filled:!1};const Un=E.slippageMode!=null||E.slippageValue!=null||E.commissionMode!=null||E.commissionValue!=null?{slippageMode:E.slippageMode,slippageValue:E.slippageValue,commissionMode:E.commissionMode,commissionValue:E.commissionValue}:void 0,Zs=Ft(me);let vs=0,Oo=Se,Pi=0,no=!1;if(E.action==="entry"){if(t.positionMode==="netting"){const fr=Mt(E.side);if(bt(fr)){const xa=ot({action:"exit",side:fr,kind:Ve==="limit"?"limit":"market",originalKind:"market",status:"pending",createdIndex:me,createdTimestamp:Zs,activeFromIndex:me,qtyPct:100,price:Se,note:"AUTO netting close (reverse)"}),ic=Li(fr,me,Se,"signal",Ve,{orderId:xa.id,signalId:E.signalId,score:E.score??null});ve(xa.id,{status:ic?"filled":"rejected",filledIndex:ic?me:void 0,filledTimestamp:ic?Zs:void 0,fillPrice:ic==null?void 0:ic.execPrice,fillQty:(ic==null?void 0:ic.qtyClosed)??0,fees:(ic==null?void 0:ic.exitFees)??0,note:ic?"AUTO netting close (reverse)":"AUTO netting close failed"})}}const wo=Ua(E.side,me,Se,E.qtyPct,Ve,E.bracket,{orderId:E.orderId,signalId:E.signalId,score:E.score??null},{qty:sn,...Un});if(wo.ok){const fr=wo.lot;if(vs=fr.qty,Oo=fr.entryPrice,Pi=fr.entryFee,no=!0,t.execution!=="bar_close"){const xa=ul(E.side),ic=xa.indexOf(Ye),ec=ic>=0?xa.slice(ic+1):xa;vc(fr,at,ec),Oc(E.side,me,at,ec)}}}else{const wo=sn>=Vr(E.side)-1e-12?Li(E.side,me,Se,"signal",Ve,{orderId:E.orderId,signalId:E.signalId,score:E.score??null},void 0,Un):ba(E.side,me,Se,sn,"signal",Ve,{orderId:E.orderId,signalId:E.signalId,score:E.score??null},void 0,Un);wo&&(vs=wo.qtyClosed,Oo=wo.execPrice,Pi=wo.exitFees,no=!0)}if(!no||vs<=0)return ve(E.orderId,{status:"rejected",note:"Order not filled"}),{remove:!0,filled:!1};const gl=Math.max(0,pt-vs),Ms=gl<=1e-12?"filled":"partial";return Ie({id:E.orderId,index:me,timestamp:Zs,qty:vs,price:Oo,fees:Pi,targetQty:Re.target,remainingQty:gl,status:Ms,note:Ms==="partial"?"Partial fill":void 0}),E.remainingQty=gl,E.targetQty=Re.target,De==="ioc"?(gl>1e-12&&ve(E.orderId,{status:"canceled",note:"IOC remainder canceled"}),{remove:!0,filled:!0}):{remove:gl<=1e-12,filled:!0}},Oc=(E,me,Se,Ve)=>{if(!bt(E)||t.execution==="bar_close")return!1;let Ye=!1;const at=Re=>{var De,pt;for(const Ge of ut(E)){if(Ge.qty<=0)continue;const sn=$e(Se,"exit",Ge.side);if(Ge.trailingPct&&Ge.trailingPct>0){const Un=Ge.trailingPct/100;if(Ge.side==="long"&&Re==="high"){const Zs=Se.h*(1-Un);Ge.trailingStop=Ge.trailingStop==null?Zs:Math.max(Ge.trailingStop,Zs)}if(Ge.side==="short"&&Re==="low"){const Zs=Se.l*(1+Un);Ge.trailingStop=Ge.trailingStop==null?Zs:Math.min(Ge.trailingStop,Zs)}}if(Ge.side==="long"&&Re==="high"){if((De=Ge.takeProfitOrders)!=null&&De.length){const Un=[];for(const Zs of Ge.takeProfitOrders){if(Ge.qty<=0)break;sn.h>=Zs.price?Ye=Ga({lot:Ge,i:me,triggerPx:Zs.price,reason:"take_profit",qty:Zs.qty,fillKind:"limit",note:`AUTO take_profit (${Zs.pct}%)`})||Ye:Un.push(Zs)}Ge.takeProfitOrders=Un}Ge.takePrice!=null&&sn.h>=Ge.takePrice&&Ge.qty>0&&(Ye=Ga({lot:Ge,i:me,triggerPx:Ge.takePrice,reason:"take_profit",qty:Ge.qty,fillKind:"limit",note:"AUTO take_profit"})||Ye)}if(Ge.side==="short"&&Re==="low"){if((pt=Ge.takeProfitOrders)!=null&&pt.length){const Un=[];for(const Zs of Ge.takeProfitOrders){if(Ge.qty<=0)break;sn.l<=Zs.price?Ye=Ga({lot:Ge,i:me,triggerPx:Zs.price,reason:"take_profit",qty:Zs.qty,fillKind:"limit",note:`AUTO take_profit (${Zs.pct}%)`})||Ye:Un.push(Zs)}Ge.takeProfitOrders=Un}Ge.takePrice!=null&&sn.l<=Ge.takePrice&&Ge.qty>0&&(Ye=Ga({lot:Ge,i:me,triggerPx:Ge.takePrice,reason:"take_profit",qty:Ge.qty,fillKind:"limit",note:"AUTO take_profit"})||Ye)}if(Ge.side==="long"&&Re==="low"){if(Ge.stopPrice!=null&&sn.l<=Ge.stopPrice){Ye=Ga({lot:Ge,i:me,triggerPx:Ge.stopPrice,reason:"stop_loss",qty:Ge.qty,fillKind:"stop",note:"AUTO stop_loss"})||Ye;continue}Ge.trailingStop!=null&&sn.l<=Ge.trailingStop&&(Ye=Ga({lot:Ge,i:me,triggerPx:Ge.trailingStop,reason:"trailing_stop",qty:Ge.qty,fillKind:"stop",note:"AUTO trailing_stop"})||Ye)}if(Ge.side==="short"&&Re==="high"){if(Ge.stopPrice!=null&&sn.h>=Ge.stopPrice){Ye=Ga({lot:Ge,i:me,triggerPx:Ge.stopPrice,reason:"stop_loss",qty:Ge.qty,fillKind:"stop",note:"AUTO stop_loss"})||Ye;continue}Ge.trailingStop!=null&&sn.h>=Ge.trailingStop&&(Ye=Ga({lot:Ge,i:me,triggerPx:Ge.trailingStop,reason:"trailing_stop",qty:Ge.qty,fillKind:"stop",note:"AUTO trailing_stop"})||Ye)}}ft[E]=ut(E).filter(Ge=>Ge.qty>1e-12),df(E)};for(const Re of Ve){if(!bt(E))break;at(Re)}return Ye},Gu=(E,me)=>{if(E)for(let Se=qi.length-1;Se>=0;Se--){const Ve=qi[Se];(Ve==null?void 0:Ve.ocoGroup)===E&&(me&&Ve.orderId===me||(ve(Ve.orderId,{status:"canceled",note:"OCO canceled"}),qi.splice(Se,1)))}},El=(E,me,Se)=>E==="entry"?me==="long"?Se==="limit"?"low":"high":Se==="limit"?"high":"low":me==="long"?Se==="limit"?"high":"low":Se==="limit"?"low":"high",mu=(E,me,Se,Ve,Ye)=>{const at=Ye.o;if(!Number.isFinite(at)||!Number.isFinite(Ve))return{px:Ve,fillsAtOpen:!1};const Re=at*Pe(E,me);return Se==="limit"?E==="entry"&&me==="long"&&at<=Ve||E==="entry"&&me==="short"&&at>=Ve||E==="exit"&&me==="long"&&at>=Ve||E==="exit"&&me==="short"&&at<=Ve?{px:Re,fillsAtOpen:!0}:{px:Ve,fillsAtOpen:!1}:E==="entry"&&me==="long"&&at>=Ve||E==="entry"&&me==="short"&&at<=Ve||E==="exit"&&me==="long"&&at<=Ve||E==="exit"&&me==="short"&&at>=Ve?{px:at,fillsAtOpen:!0}:{px:Ve,fillsAtOpen:!1}},bc=(E,me,Se)=>{var Re,De;if(!bt(E)||t.execution==="bar_close")return!1;const Ve=Se.o;if(!Number.isFinite(Ve)||Ve<=0)return!1;const Ye=Ve*Pe("exit",E);let at=!1;for(const pt of ut(E).slice())if(!(pt.qty<=0))if(pt.side==="long"){if(pt.stopPrice!=null&&Ye<=pt.stopPrice){at=Ga({lot:pt,i:me,triggerPx:Ve,reason:"stop_loss",qty:pt.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||at;continue}if(pt.trailingStop!=null&&Ye<=pt.trailingStop){at=Ga({lot:pt,i:me,triggerPx:Ve,reason:"trailing_stop",qty:pt.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||at;continue}if((Re=pt.takeProfitOrders)!=null&&Re.length){const Ge=[];for(const sn of pt.takeProfitOrders){if(pt.qty<=0)break;Ye>=sn.price?at=Ga({lot:pt,i:me,triggerPx:Ye,reason:"take_profit",qty:sn.qty,fillKind:"limit",note:`AUTO take_profit (${sn.pct}%) (gap)`})||at:Ge.push(sn)}pt.takeProfitOrders=Ge}pt.takePrice!=null&&Ye>=pt.takePrice&&pt.qty>0&&(at=Ga({lot:pt,i:me,triggerPx:Ye,reason:"take_profit",qty:pt.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||at)}else{if(pt.stopPrice!=null&&Ye>=pt.stopPrice){at=Ga({lot:pt,i:me,triggerPx:Ve,reason:"stop_loss",qty:pt.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||at;continue}if(pt.trailingStop!=null&&Ye>=pt.trailingStop){at=Ga({lot:pt,i:me,triggerPx:Ve,reason:"trailing_stop",qty:pt.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||at;continue}if((De=pt.takeProfitOrders)!=null&&De.length){const Ge=[];for(const sn of pt.takeProfitOrders){if(pt.qty<=0)break;Ye<=sn.price?at=Ga({lot:pt,i:me,triggerPx:Ye,reason:"take_profit",qty:sn.qty,fillKind:"limit",note:`AUTO take_profit (${sn.pct}%) (gap)`})||at:Ge.push(sn)}pt.takeProfitOrders=Ge}pt.takePrice!=null&&Ye<=pt.takePrice&&pt.qty>0&&(at=Ga({lot:pt,i:me,triggerPx:Ye,reason:"take_profit",qty:pt.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||at)}return ft[E]=ut(E).filter(pt=>pt.qty>1e-12),df(E),at},nl=(E,me)=>{if(!qi.length)return;if(rd){Wl("Canceled by risk limit");return}ce!=null&&Fa>=ce&&Wr(De=>De.action==="entry","Max intraday filled orders reached");for(let De=qi.length-1;De>=0;De--){const pt=qi[De];if(!(E<pt.activeFromIndex)){if(pt.expiresAtIndex!=null&&E>pt.expiresAtIndex){ve(pt.orderId,{status:"expired",note:"Expired"}),qi.splice(De,1);continue}if(pt.action==="exit"&&!bt(pt.side)){ve(pt.orderId,{status:"canceled",note:"No position"}),qi.splice(De,1);continue}}}for(const De of qi){if(De.kind!=="trailing_stop"||E<De.activeFromIndex||De.action!=="exit"||!bt(De.side))continue;const pt=typeof De.trailPct=="number"&&Number.isFinite(De.trailPct)?De.trailPct:null,Ge=typeof De.trailOffset=="number"&&Number.isFinite(De.trailOffset)?De.trailOffset:null,sn=typeof De.trailPrice=="number"&&Number.isFinite(De.trailPrice)?De.trailPrice:De.side==="long"?me.h:me.l,Un=Ge??(pt!=null&&pt>0?sn*pt/100:null);if(!(!Un||!Number.isFinite(Un)||Un<=0))if(De.side==="long"){const Zs=sn-Un;De.price=De.price==null?Zs:Math.max(De.price,Zs)}else{const Zs=sn+Un;De.price=De.price==null?Zs:Math.min(De.price,Zs)}}const Se=[];for(let De=0;De<qi.length;De++){const pt=qi[De];if(E<pt.activeFromIndex||pt.expiresAtIndex!=null&&E>pt.expiresAtIndex)continue;const Ge=$e(me,pt.action,pt.side);if(pt.action==="exit"){if(!bt(pt.side))continue}else if(Et(pt.side)>=t.pyramiding)continue;const sn=pt.ocoGroup||`__solo__${pt.orderId||De}`,Un=pt.action==="exit"?0:1,Zs=ul(pt.side);if(pt.kind==="stop_limit"){const xa=pt.stopPrice??pt.price,ic=pt.limitPrice??pt.price;if(!Number.isFinite(xa)||!Number.isFinite(ic)||!vi(pt.action,pt.side,"stop",Ge,xa))continue;const Lf=El(pt.action,pt.side,"stop"),_e=Zs.indexOf(Lf),We=mu(pt.action,pt.side,"stop",xa,me),xt=We.fillsAtOpen?0:_e>=0?_e+1:99,Ht=Lf==="high"?xa:-xa;Se.push({groupKey:sn,orderId:pt.orderId,pi:De,action:pt.action,side:pt.side,kind:"stop_limit",triggerExt:Lf,phase:xt,actionRank:Un,priceRank:Ht,sp:xa,lp:ic,stopAtOpen:We.fillsAtOpen,limitAtOpen:mu(pt.action,pt.side,"limit",ic,me).fillsAtOpen});continue}const vs=pt.price;if(vs==null||!Number.isFinite(vs))continue;const Oo=pt.kind==="stop"||pt.kind==="trailing_stop"?"stop":"limit";if(!vi(pt.action,pt.side,Oo,Ge,vs))continue;const no=El(pt.action,pt.side,Oo),gl=Zs.indexOf(no),wo=mu(pt.action,pt.side,Oo,vs,me).fillsAtOpen?0:gl>=0?gl+1:99,fr=no==="high"?vs:-vs;Se.push({groupKey:sn,orderId:pt.orderId,pi:De,action:pt.action,side:pt.side,kind:pt.kind,triggerKind:Oo,triggerExt:no,phase:wo,actionRank:Un,priceRank:fr,px:vs})}if(!Se.length)return;const Ve=new Map,Ye=(De,pt)=>De.phase!==pt.phase?De.phase<pt.phase?De:pt:De.actionRank!==pt.actionRank?De.actionRank<pt.actionRank?De:pt:De.priceRank!==pt.priceRank?De.priceRank<pt.priceRank?De:pt:De.pi<pt.pi?De:pt;for(const De of Se){const pt=Ve.get(De.groupKey);Ve.set(De.groupKey,pt?Ye(pt,De):De)}const at=Array.from(Ve.values()).sort((De,pt)=>De.phase!==pt.phase?De.phase-pt.phase:De.actionRank!==pt.actionRank?De.actionRank-pt.actionRank:De.priceRank!==pt.priceRank?De.priceRank-pt.priceRank:De.pi-pt.pi),Re=(De,pt)=>{if(De){const Ge=qi.findIndex(sn=>sn.orderId===De);if(Ge>=0)return Ge}return typeof pt=="number"?pt:-1};for(const De of at){const pt=Re(De.orderId,De.pi);if(pt<0||pt>=qi.length)continue;const Ge=qi[pt];if(E<Ge.activeFromIndex||Ge.expiresAtIndex!=null&&E>Ge.expiresAtIndex)continue;const sn=$e(me,Ge.action,Ge.side);if(Ge.action==="exit"){if(!bt(Ge.side)){ve(Ge.orderId,{status:"canceled",note:"No position"}),qi.splice(pt,1);continue}}else if(Et(Ge.side)>=t.pyramiding)continue;if(Ge.kind==="stop_limit"){const Ms=Ge.stopPrice??Ge.price,wo=Ge.limitPrice??Ge.price;if(!Number.isFinite(Ms)||!Number.isFinite(wo)||!vi(Ge.action,Ge.side,"stop",sn,Ms))continue;const xa=vi(Ge.action,Ge.side,"limit",sn,wo),ic=El(Ge.action,Ge.side,"stop"),ec=El(Ge.action,Ge.side,"limit"),Lf=ul(Ge.side),_e=Lf.indexOf(ic),We=Lf.indexOf(ec);if(xa&&_e>=0&&We>=0&&_e<We){const qt=mu(Ge.action,Ge.side,"limit",wo,me).px,ht=Oa(Ge,E,qt,"limit",ic,me);ht.filled&&Gu(Ge.ocoGroup,Ge.orderId),ht.remove?qi.splice(pt,1):Ge.remainingQty!=null&&Ge.remainingQty>1e-12&&(Ge.kind="limit",Ge.price=wo,Ge.activeFromIndex=E+1);continue}ve(Ge.orderId,{kind:"limit",note:"Stop triggered → limit active next bar"}),Ge.kind="limit",Ge.price=wo,Ge.activeFromIndex=E+1;continue}const Un=Ge.price;if(Un==null||!Number.isFinite(Un))continue;const Zs=Ge.kind==="stop"||Ge.kind==="trailing_stop"?"stop":"limit";if(!vi(Ge.action,Ge.side,Zs,sn,Un))continue;let Oo=Ba(Ge.kind),Pi=mu(Ge.action,Ge.side,Zs,Un,me).px;const no=El(Ge.action,Ge.side,Zs);if(Ge.kind==="lit"){const Ms=typeof Ge.limitPrice=="number"&&Number.isFinite(Ge.limitPrice)?Ge.limitPrice:Un;if(!vi(Ge.action,Ge.side,"limit",sn,Ms)){ve(Ge.orderId,{kind:"limit",note:"LIT triggered → limit active next bar"}),Ge.kind="limit",Ge.price=Ms,Ge.activeFromIndex=E+1;continue}Pi=mu(Ge.action,Ge.side,"limit",Ms,me).px,Oo="limit"}const gl=Oa(Ge,E,Pi,Oo,no,me);gl.filled&&Gu(Ge.ocoGroup,Ge.orderId),gl.remove&&qi.splice(pt,1)}},la=(E,me)=>{if(!Pt()||t.execution==="bar_close")return!1;const Se=bc("long",E,me),Ve=bc("short",E,me),Ye=Oc("long",E,me,ul("long")),at=Oc("short",E,me,ul("short"));return Se||Ve||Ye||at};let Mu=0,Yu=0;for(let E=Ll;E<=ya;E++){const me=Ooe(n[E]);if(!me)continue;const Se=me.c;ni(E,Se,Ll);const Ve=Number((yt=n[E])==null?void 0:yt.timestamp);if(Number.isFinite(Ve)&&Ve>0){const Re=new Date(Ve).toISOString().slice(0,10);Re&&Re!==dc&&(dc=Re,Bc=Pu(E,Se),Fa=0)}for(const Re of ut("long"))Re.qty<=0||(Re.maxFav=Re.maxFav==null?me.h:Math.max(Re.maxFav,me.h),Re.maxAdv=Re.maxAdv==null?me.l:Math.min(Re.maxAdv,me.l));for(const Re of ut("short"))Re.qty<=0||(Re.maxFav=Re.maxFav==null?me.l:Math.min(Re.maxFav,me.l),Re.maxAdv=Re.maxAdv==null?me.h:Math.max(Re.maxAdv,me.h));for(Pt()&&la(E,me),nl(E,me),sr(E,me);el<Yr.length&&Yr[el].index===E;){const Re=Yr[el];if(Re.type==="cancel"){Kl(Re.orderId??Re.signalId,"Canceled by strategy.cancel"),el+=1;continue}if(Re.type==="cancel_all"){Wl("Canceled by strategy.cancel_all"),el+=1;continue}const De=Ic(Re),Ge=String((De==null?void 0:De.kind)||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit").replace(/market[_\s-]*if[_\s-]*touched|mit/g,"mit").replace(/limit[_\s-]*if[_\s-]*touched|lit/g,"lit").replace(/trailing[_\s-]*stop/g,"trailing_stop"),sn=Pc(De==null?void 0:De.qtyPct),Un=De==null?void 0:De.qty,Zs=De==null?void 0:De.cash,vs=typeof Un=="number"&&Number.isFinite(Un)?Un:Number(Un),Oo=typeof Zs=="number"&&Number.isFinite(Zs)?Zs:Number(Zs),Pi=Number.isFinite(vs)?vs:void 0,no=Number.isFinite(Oo)?Oo:void 0,gl=La(De),Ms=Sl(De),wo=gl||Ms?{...gl,...Ms}:void 0,fr=typeof(De==null?void 0:De.oco)=="string"&&String(De.oco).trim()?String(De.oco).trim():void 0,xa=String((De==null?void 0:De.tif)??(De==null?void 0:De.timeInForce)??"").trim().toLowerCase(),ec=xa?xa==="ioc"||xa==="immediate_or_cancel"?"ioc":xa==="fok"||xa==="fill_or_kill"?"fok":"gtc":t.timeInForce,Lf=De==null?void 0:De.expiresBars,_e=typeof Lf=="number"&&Number.isFinite(Lf)&&Lf>0?Math.floor(Lf):xa==="day"?1:null,We=_e?E+_e:void 0,xt=si(De==null?void 0:De.bracket),Ht=(De==null?void 0:De.trailPct)??(De==null?void 0:De.trail_percent)??(De==null?void 0:De.trailPercent)??(De==null?void 0:De.trailingStopPct)??(De==null?void 0:De.trailing_stop_pct)??null,qt=(De==null?void 0:De.trailOffset)??(De==null?void 0:De.trailPoints)??(De==null?void 0:De.trail_points)??(De==null?void 0:De.trail_offset)??null,ht=(De==null?void 0:De.trailPrice)??(De==null?void 0:De.trail_price)??null,dn=cl(Ht),Ut=mr(qt),Xn=mr(ht),rs=rd?"Risk limit reached":ce!=null&&Fa>=ce?"Max intraday filled orders reached":null,_t={commissionMode:wo==null?void 0:wo.commissionMode,commissionValue:wo==null?void 0:wo.commissionValue,slippageMode:wo==null?void 0:wo.slippageMode,slippageValue:wo==null?void 0:wo.slippageValue},Gt={qtyPct:sn,qty:Pi,cash:no,tif:ec,trailPct:dn??void 0,trailOffset:Ut??void 0,trailPrice:Xn??void 0,..._t},en=(Ge==="limit"||Ge==="stop"||Ge==="mit"||Ge==="lit")&&typeof(De==null?void 0:De.price)=="number"?De.price:Se,cs=typeof(De==null?void 0:De.stopPrice)=="number"?De.stopPrice:typeof(De==null?void 0:De.price)=="number"?De.price:Se,ps=typeof(De==null?void 0:De.limitPrice)=="number"?De.limitPrice:typeof(De==null?void 0:De.price)=="number"?De.price:Se,vo=Ge==="limit"||Ge==="stop"||Ge==="mit"||Ge==="lit"?ze(Re.type.startsWith("entry")?"entry":"exit",Re.type.endsWith("long")?"long":"short",Ge==="stop"?"stop":"limit",en):en,Ko=Ge==="stop_limit"?ze(Re.type.startsWith("entry")?"entry":"exit",Re.type.endsWith("long")?"long":"short","stop",cs):cs,ho=Ge==="stop_limit"||Ge==="lit"?ze(Re.type.startsWith("entry")?"entry":"exit",Re.type.endsWith("long")?"long":"short","limit",ps):ps,wa=Ft(E),di=Ge==="limit"||Ge==="stop"||Ge==="stop_limit"||Ge==="mit"||Ge==="lit"||Ge==="trailing_stop"?Ge:"market";if(Re.type==="exit_long"&&bt("long"))if(di==="stop_limit"){if(Number.isFinite(Ko)&&Ko>0&&Number.isFinite(ho)&&ho>0){const Mi=ot({action:"exit",side:"long",kind:"stop_limit",originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E+1,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec,stopPrice:Ko,limitPrice:ho});qi.push({action:"exit",side:"long",kind:"stop_limit",signalId:Re.signalId,score:Re.score??null,stopPrice:Ko,limitPrice:ho,activeFromIndex:E+1,expiresAtIndex:We,ocoGroup:fr,...Gt,orderId:Mi.id})}}else if(di==="limit"||di==="stop"||di==="mit"||di==="lit"||di==="trailing_stop"){if(Number.isFinite(vo)&&vo>0){const Mi=typeof Xn=="number"&&Number.isFinite(Xn)?Xn:Se,Kr=Ut!=null&&Number.isFinite(Ut)?Ut:dn!=null&&Number.isFinite(dn)?Mi*dn/100:null,hr=di==="trailing_stop"&&Kr!=null?ze("exit","long","stop",Mi-Kr):vo,sl=ot({action:"exit",side:"long",kind:di,originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E+1,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec,trailPct:dn??void 0,trailOffset:Ut??void 0,trailPrice:Xn??void 0,price:hr,limitPrice:di==="lit"?ho:void 0});qi.push({action:"exit",side:"long",kind:di,signalId:Re.signalId,score:Re.score??null,price:hr,limitPrice:di==="lit"?ho:void 0,activeFromIndex:E+1,expiresAtIndex:We,ocoGroup:fr,...Gt,orderId:sl.id})}}else{const Mi=Vr("long"),Kr=Hi("long",Se,sn,Pi,no),hr=xe(Kr,"floor"),sl=ot({action:"exit",side:"long",kind:"market",originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec});if(g!=null&&hr>0&&hr<g&&hr<Mi-1e-12)ve(sl.id,{status:"rejected",note:`Qty ${hr} < minQty ${g}`});else{const fo=hr>=Mi-1e-12?Li("long",E,Se,"signal","market",{signalId:Re.signalId,orderId:sl.id,score:Re.score??null},void 0,wo):ba("long",E,Se,hr,"signal","market",{signalId:Re.signalId,orderId:sl.id,score:Re.score??null},void 0,wo);ve(sl.id,{status:fo?"filled":"rejected",filledIndex:fo?E:void 0,filledTimestamp:fo?wa:void 0,fillPrice:(fo==null?void 0:fo.execPrice)??Oi("long",Se,"market"),fillQty:(fo==null?void 0:fo.qtyClosed)??0,fees:(fo==null?void 0:fo.exitFees)??0,note:fo?void 0:"Exit not filled"})}}else if(Re.type==="exit_short"&&bt("short"))if(di==="stop_limit"){if(Number.isFinite(Ko)&&Ko>0&&Number.isFinite(ho)&&ho>0){const Mi=ot({action:"exit",side:"short",kind:"stop_limit",originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E+1,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec,stopPrice:Ko,limitPrice:ho});qi.push({action:"exit",side:"short",kind:"stop_limit",signalId:Re.signalId,score:Re.score??null,stopPrice:Ko,limitPrice:ho,activeFromIndex:E+1,expiresAtIndex:We,ocoGroup:fr,...Gt,orderId:Mi.id})}}else if(di==="limit"||di==="stop"||di==="mit"||di==="lit"||di==="trailing_stop"){if(Number.isFinite(vo)&&vo>0){const Mi=typeof Xn=="number"&&Number.isFinite(Xn)?Xn:Se,Kr=Ut!=null&&Number.isFinite(Ut)?Ut:dn!=null&&Number.isFinite(dn)?Mi*dn/100:null,hr=di==="trailing_stop"&&Kr!=null?ze("exit","short","stop",Mi+Kr):vo,sl=ot({action:"exit",side:"short",kind:di,originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E+1,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec,trailPct:dn??void 0,trailOffset:Ut??void 0,trailPrice:Xn??void 0,price:hr,limitPrice:di==="lit"?ho:void 0});qi.push({action:"exit",side:"short",kind:di,signalId:Re.signalId,score:Re.score??null,price:hr,limitPrice:di==="lit"?ho:void 0,activeFromIndex:E+1,expiresAtIndex:We,ocoGroup:fr,...Gt,orderId:sl.id})}}else{const Mi=Vr("short"),Kr=Hi("short",Se,sn,Pi,no),hr=xe(Kr,"floor"),sl=ot({action:"exit",side:"short",kind:"market",originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec});if(g!=null&&hr>0&&hr<g&&hr<Mi-1e-12)ve(sl.id,{status:"rejected",note:`Qty ${hr} < minQty ${g}`});else{const fo=hr>=Mi-1e-12?Li("short",E,Se,"signal","market",{signalId:Re.signalId,orderId:sl.id,score:Re.score??null},void 0,wo):ba("short",E,Se,hr,"signal","market",{signalId:Re.signalId,orderId:sl.id,score:Re.score??null},void 0,wo);ve(sl.id,{status:fo?"filled":"rejected",filledIndex:fo?E:void 0,filledTimestamp:fo?wa:void 0,fillPrice:(fo==null?void 0:fo.execPrice)??Oi("short",Se,"market"),fillQty:(fo==null?void 0:fo.qtyClosed)??0,fees:(fo==null?void 0:fo.exitFees)??0,note:fo?void 0:"Exit not filled"})}}else if(Re.type==="entry_long"&&t.allowLong)if(di==="stop_limit"){if(Number.isFinite(Ko)&&Ko>0&&Number.isFinite(ho)&&ho>0){const Mi=ot({action:"entry",side:"long",kind:"stop_limit",originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E+1,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec,stopPrice:Ko,limitPrice:ho});rs?ve(Mi.id,{status:"rejected",note:rs}):qi.push({action:"entry",side:"long",kind:"stop_limit",signalId:Re.signalId,score:Re.score??null,stopPrice:Ko,limitPrice:ho,activeFromIndex:E+1,expiresAtIndex:We,ocoGroup:fr,bracket:xt,...Gt,orderId:Mi.id})}}else if(di==="limit"||di==="stop"||di==="mit"||di==="lit"||di==="trailing_stop"){if(Number.isFinite(vo)&&vo>0){const Mi=typeof Xn=="number"&&Number.isFinite(Xn)?Xn:Se,Kr=Ut!=null&&Number.isFinite(Ut)?Ut:dn!=null&&Number.isFinite(dn)?Mi*dn/100:null,hr=di==="trailing_stop"&&Kr!=null?ze("entry","long","stop",Mi+Kr):vo,sl=ot({action:"entry",side:"long",kind:di,originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E+1,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec,trailPct:dn??void 0,trailOffset:Ut??void 0,trailPrice:Xn??void 0,price:hr,limitPrice:di==="lit"?ho:void 0});rs?ve(sl.id,{status:"rejected",note:rs}):qi.push({action:"entry",side:"long",kind:di,signalId:Re.signalId,score:Re.score??null,price:hr,limitPrice:di==="lit"?ho:void 0,activeFromIndex:E+1,expiresAtIndex:We,ocoGroup:fr,bracket:xt,...Gt,orderId:sl.id})}}else{const Mi=ot({action:"entry",side:"long",kind:"market",originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec});if(rs){ve(Mi.id,{status:"rejected",note:rs}),el+=1;continue}if(t.positionMode==="netting"){const hr="short";if(bt(hr)){const sl=ot({action:"exit",side:hr,kind:"market",originalKind:"market",status:"pending",createdIndex:E,createdTimestamp:wa,activeFromIndex:E,qtyPct:100,price:Se,note:"AUTO netting close (reverse)"}),fo=Li(hr,E,Se,"signal","market",{signalId:Re.signalId,orderId:sl.id,score:Re.score??null});ve(sl.id,{status:fo?"filled":"rejected",filledIndex:fo?E:void 0,filledTimestamp:fo?wa:void 0,fillPrice:(fo==null?void 0:fo.execPrice)??Oi(hr,Se,"market"),fillQty:(fo==null?void 0:fo.qtyClosed)??0,fees:(fo==null?void 0:fo.exitFees)??0})}}const Kr=Ua("long",E,Se,sn,"market",xt,{signalId:Re.signalId,orderId:Mi.id,score:Re.score??null},{qty:Pi,cash:no,...wo});if(Kr.ok){const hr=Kr.lot;ve(Mi.id,{status:"filled",filledIndex:E,filledTimestamp:wa,fillPrice:hr.entryPrice,fillQty:hr.qty,fees:hr.entryFee})}else ve(Mi.id,{status:"rejected",note:Kr.reject||"Entry blocked"})}else if(Re.type==="entry_short"&&t.allowShort)if(di==="stop_limit"){if(Number.isFinite(Ko)&&Ko>0&&Number.isFinite(ho)&&ho>0){const Mi=ot({action:"entry",side:"short",kind:"stop_limit",originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E+1,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec,stopPrice:Ko,limitPrice:ho});rs?ve(Mi.id,{status:"rejected",note:rs}):qi.push({action:"entry",side:"short",kind:"stop_limit",signalId:Re.signalId,score:Re.score??null,stopPrice:Ko,limitPrice:ho,activeFromIndex:E+1,expiresAtIndex:We,ocoGroup:fr,bracket:xt,...Gt,orderId:Mi.id})}}else if(di==="limit"||di==="stop"||di==="mit"||di==="lit"||di==="trailing_stop"){if(Number.isFinite(vo)&&vo>0){const Mi=typeof Xn=="number"&&Number.isFinite(Xn)?Xn:Se,Kr=Ut!=null&&Number.isFinite(Ut)?Ut:dn!=null&&Number.isFinite(dn)?Mi*dn/100:null,hr=di==="trailing_stop"&&Kr!=null?ze("entry","short","stop",Mi-Kr):vo,sl=ot({action:"entry",side:"short",kind:di,originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E+1,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec,trailPct:dn??void 0,trailOffset:Ut??void 0,trailPrice:Xn??void 0,price:hr,limitPrice:di==="lit"?ho:void 0});rs?ve(sl.id,{status:"rejected",note:rs}):qi.push({action:"entry",side:"short",kind:di,signalId:Re.signalId,score:Re.score??null,price:hr,limitPrice:di==="lit"?ho:void 0,activeFromIndex:E+1,expiresAtIndex:We,ocoGroup:fr,bracket:xt,...Gt,orderId:sl.id})}}else{const Mi=ot({action:"entry",side:"short",kind:"market",originalKind:di,status:"pending",signalId:Re.signalId,ocoGroup:fr,createdIndex:E,createdTimestamp:wa,activeFromIndex:E,expiresAtIndex:We,qtyPct:sn,qty:Pi,cash:no,tif:ec});if(rs){ve(Mi.id,{status:"rejected",note:rs}),el+=1;continue}if(t.positionMode==="netting"){const hr="long";if(bt(hr)){const sl=ot({action:"exit",side:hr,kind:"market",originalKind:"market",status:"pending",createdIndex:E,createdTimestamp:wa,activeFromIndex:E,qtyPct:100,price:Se,note:"AUTO netting close (reverse)"}),fo=Li(hr,E,Se,"signal","market",{signalId:Re.signalId,orderId:sl.id,score:Re.score??null});ve(sl.id,{status:fo?"filled":"rejected",filledIndex:fo?E:void 0,filledTimestamp:fo?wa:void 0,fillPrice:(fo==null?void 0:fo.execPrice)??Oi(hr,Se,"market"),fillQty:(fo==null?void 0:fo.qtyClosed)??0,fees:(fo==null?void 0:fo.exitFees)??0})}}const Kr=Ua("short",E,Se,sn,"market",xt,{signalId:Re.signalId,orderId:Mi.id,score:Re.score??null},{qty:Pi,cash:no,...wo});if(Kr.ok){const hr=Kr.lot;ve(Mi.id,{status:"filled",filledIndex:E,filledTimestamp:wa,fillPrice:hr.entryPrice,fillQty:hr.qty,fees:hr.entryFee})}else ve(Mi.id,{status:"rejected",note:Kr.reject||"Entry blocked"})}el+=1}let Ye=Pu(E,Se);if(!rd){const Re=Bc-Ye,De=le??(Q!=null?Bc*Q:null),pt=Yl>0?(Yl-Ye)/Yl:0,Ge=Yl-Ye,sn=B!=null&&pt>=B||$!=null&&Ge>=$,Un=De!=null&&Number.isFinite(Re)&&Re>=De;(sn||Un)&&(rd=!0,Wl("Canceled by risk limit"),bt("long")&&Li("long",E,Se,"signal","market"),bt("short")&&Li("short",E,Se,"signal","market"),Ye=Pu(E,Se))}{const Re=(vt=n==null?void 0:n[E])==null?void 0:vt.timestamp,De=Number(Re);Qe.push({index:E,timestamp:Number.isFinite(De)&&De>0?De:Date.now(),equity:Ye})}if(Ye>Yl&&(Yl=Ye),Yl>0){const Re=(Yl-Ye)/Yl;Re>Vu&&(Vu=Re);const De=Yl-Ye;De>Iu&&(Iu=De)}if(Number.isFinite(Ye)){if(!Number.isFinite(Ro)||Ye<Ro)Ro=Ye;else if(Ro>0){const Re=Ye-Ro;Re>kl&&(kl=Re);const De=Re/Ro;De>zr&&(zr=De)}}Mu+=1,Pt()&&(Yu+=1);const at=Vr("long")-Vr("short");Zt[E]=at,gn[E]=yf(),hn[E]=Et("long")+Et("short"),qn[E]=Je.length,On[E]=Dd(Se),bn[E]=qe-Rc,Fn[E]=Cu,Xs[E]=uc,oo[E]=Fl,Yn[E]=jc,_o[E]=Je.length>0?Fl/Je.length*100:0,xs[E]=Vu*100,Rt[E]=Iu,un[E]=zr*100,qs[E]=kl,Qa[E]=Ye,yr[E]=Ye-s,ri[E]=Je.length>0?(qe-Rc)/Je.length:0,Eo[E]=Fl>0?Cu/Fl:0,Ia[E]=jc>0?-(uc/jc):0,Lr[E]=Je.length>0?nd/Je.length:0;{const Re=[];for(const De of ut("long"))De.qty<=1e-12||Re.push({side:"long",qty:De.qty,entryIndex:De.entryIndex,entryTimestamp:De.entryTimestamp,entryPrice:De.entryPrice,entryFee:De.entryFee,entrySignalId:De.entrySignalId,entryOrderId:De.entryOrderId,entrySignalScore:De.entrySignalScore??null,maxFav:De.maxFav,maxAdv:De.maxAdv});for(const De of ut("short"))De.qty<=1e-12||Re.push({side:"short",qty:De.qty,entryIndex:De.entryIndex,entryTimestamp:De.entryTimestamp,entryPrice:De.entryPrice,entryFee:De.entryFee,entrySignalId:De.entrySignalId,entryOrderId:De.entryOrderId,entrySignalScore:De.entrySignalScore??null,maxFav:De.maxFav,maxAdv:De.maxAdv});Re.sort((De,pt)=>pt.entryIndex-De.entryIndex),Fi[E]=Re}}if(t.closeOnEnd&&Pt()&&n.length){const E=ya,me=o2(n[E]);if(me!=null){bt("long")&&Li("long",E,me,"end","market"),bt("short")&&Li("short",E,me,"end","market");const Se=Pu(E,me);{const Ye=(jt=n==null?void 0:n[E])==null?void 0:jt.timestamp,at=Number(Ye);Qe.push({index:E,timestamp:Number.isFinite(at)&&at>0?at:Date.now(),equity:Se})}if(Se>Yl&&(Yl=Se),Yl>0){const Ye=(Yl-Se)/Yl;Ye>Vu&&(Vu=Ye);const at=Yl-Se;at>Iu&&(Iu=at)}if(Number.isFinite(Se)){if(!Number.isFinite(Ro)||Se<Ro)Ro=Se;else if(Ro>0){const Ye=Se-Ro;Ye>kl&&(kl=Ye);const at=Ye/Ro;at>zr&&(zr=at)}}const Ve=Vr("long")-Vr("short");Zt[E]=Ve,gn[E]=yf(),hn[E]=Et("long")+Et("short"),qn[E]=Je.length,On[E]=Dd(me),bn[E]=qe-Rc,Fn[E]=Cu,Xs[E]=uc,oo[E]=Fl,Yn[E]=jc,_o[E]=Je.length>0?Fl/Je.length*100:0,xs[E]=Vu*100,Rt[E]=Iu,un[E]=zr*100,qs[E]=kl,Qa[E]=Se,yr[E]=Se-s,ri[E]=Je.length>0?(qe-Rc)/Je.length:0,Eo[E]=Fl>0?Cu/Fl:0,Ia[E]=jc>0?-(uc/jc):0,Lr[E]=Je.length>0?nd/Je.length:0,Fi[E]=[]}if(qi.length){for(const Se of qi)ve(Se.orderId,{status:"canceled",note:"Canceled on end"});qi.length=0}}const zc=Qe.length?Qe[Qe.length-1].equity:s,Zd=zc-s,Yf=Je.reduce((E,me)=>E+(me.pnl>0?me.pnl:0),0),Kf=Je.reduce((E,me)=>E+(me.pnl<0?Math.abs(me.pnl):0),0),_d=Je.filter(E=>E.pnl>0).length,Rd=Je.filter(E=>E.pnl<0).length,fc=Je.length,pp=fc?_d/fc*100:0,kd=fc?Zd/fc:0,Wd=_d?Yf/_d:0,$l=Rd?-(Kf/Rd):0,Nu=$l!==0?Math.abs(Wd/$l):Wd>0?1/0:0,Ku=fc>0?Je.reduce((E,me)=>E+Math.max(0,me.exitIndex-me.entryIndex+1),0)/fc:0,bf=Mu>0?Yu/Mu*100:0,Xu=[];{let E="",me=NaN,Se=0;for(const Ve of Qe){const Ye=Number(Ve.timestamp);if(!Number.isFinite(Ye)||Ye<=0)continue;const at=new Date(Ye).toISOString().slice(0,10);E&&at!==E&&Number.isFinite(me)&&Xu.push({ts:Se,eq:me}),E=at,me=Ve.equity,Se=Ye}E&&Number.isFinite(me)&&Xu.push({ts:Se,eq:me})}const Ql=[];for(let E=1;E<Xu.length;E++){const me=Xu[E-1].eq,Se=Xu[E].eq;Number.isFinite(me)&&me!==0&&Number.isFinite(Se)&&Ql.push((Se-me)/me)}const Hd=Ql.length?Ql.reduce((E,me)=>E+me,0)/Ql.length:0,hu=Ql.length>1?Ql.reduce((E,me)=>E+(me-Hd)**2,0)/(Ql.length-1):0,Jc=hu>0?Math.sqrt(hu):0,Au=Ql.filter(E=>E<0),jd=Au.length?Au.reduce((E,me)=>E+me,0)/Au.length:0,Wu=Au.length>1?Au.reduce((E,me)=>E+(me-jd)**2,0)/(Au.length-1):0,sf=Wu>0?Math.sqrt(Wu):0,ad=Jc>0?Hd/Jc*Math.sqrt(252):0,yd=sf>0?Hd/sf*Math.sqrt(252):0,Bd=Jc>0?Jc*Math.sqrt(252)*100:0,Mc=Qe.length?Qe[0].equity:s,Tu=Qe.length?Number(Qe[0].timestamp):NaN,qd=Qe.length?Number(Qe[Qe.length-1].timestamp):NaN,Xf=Number.isFinite(Tu)&&Number.isFinite(qd)&&qd>Tu?(qd-Tu)/(365*864e5):0,Vf=Mc>0?zc/Mc:1,se=Xf>0?Math.pow(Vf,1/Xf)-1:Vf-1,be=Vu>0?se/Vu:se>0?1/0:0,G=[];if(Qe.length){const E=Qe[0].index,me=o2(n[E])??NaN;if(Number.isFinite(me)&&me>0){const Se=s/me;for(let Ve=Ll;Ve<=ya;Ve++){const Ye=o2(n[Ve]);if(Ye==null||!Number.isFinite(Ye))continue;const at=(ye=n==null?void 0:n[Ve])==null?void 0:ye.timestamp,Re=Number(at);G.push({index:Ve,timestamp:Number.isFinite(Re)&&Re>0?Re:Date.now(),equity:Se*Ye})}}}const re=fc?_d/fc*Wd+Rd/fc*$l:0;let we=0,J=0;{let E=0,me=0;for(const Se of Je)Se.pnl>0?(E+=1,me=0,E>we&&(we=E)):Se.pnl<0&&(me+=1,E=0,me>J&&(J=me))}return{summary:{initialCapital:s,finalEquity:zc,netPnl:Zd,netPnlPct:s>0?Zd/s*100:0,grossProfit:Yf,grossLoss:Kf,profitFactor:Kf>0?Yf/Kf:Yf>0?1/0:0,trades:fc,roundTrips:Ct.length,wins:_d,losses:Rd,winRate:pp,maxDrawdownPct:Vu*100,maxDrawdownValue:Iu,feesPaid:nt,avgTrade:kd,avgWin:Wd,avgLoss:$l,payoffRatio:Nu,expectancy:re,maxConsecWins:we,maxConsecLosses:J,exposurePct:bf,maxRunupPct:zr*100,maxRunupValue:kl,avgBarsInTrade:Ku,volatilityPct:Bd,sharpe:ad,sortino:yd,calmar:be},trades:Je,roundTrips:Ct,orders:Ze,equity:Qe,benchmark:G,series:{positionSize:Zt,positionAvgPrice:gn,openTrades:hn,closedTrades:qn,openProfit:On,closedProfit:bn,grossProfit:Fn,grossLoss:Xs,winTrades:oo,lossTrades:Yn,winRate:_o,maxDrawdownPct:xs,maxDrawdownValue:Rt,maxRunupPct:un,maxRunupValue:qs,avgTrade:ri,avgWin:Eo,avgLoss:Ia,avgBarsInTrade:Lr,equity:Qa,netProfit:yr},accessors:{openTradesByBar:Fi,closedTrades:Je}}}function Db(n){return n.replace(/^"|"$/g,"").replace(/^'|'$/g,"")}function Voe(n){const e={},t=/([A-Za-z_$][A-Za-z0-9_$]*)\s*:\s*("([^"\\]|\\.)*"|'([^'\\]|\\.)*'|[^\s]+)/g;let s;for(;s=t.exec(n);){const o=String(s[1]||"").toLowerCase(),r=String(s[2]||"");e[o]=r}return e}function Woe(n){const e=r=>{let a=null,l=0;const c=g=>/[A-Za-z0-9_$]/.test(g),f=r.toLowerCase(),u=[{token:"cooldown_bars",key:"cooldown"},{token:"cooldownbars",key:"cooldown"},{token:"cooldown",key:"cooldown"},{token:"score",key:"score"}];let d=null;for(let g=0;g<r.length;g++){const w=r[g];if(a){w===a&&r[g-1]!=="\\"&&(a=null);continue}if(w==="'"||w==='"'){a=w;continue}if(w==="("){l+=1;continue}if(w===")"){l=Math.max(0,l-1);continue}if(!(l>0)&&!(g>0&&c(r[g-1])))for(const C of u){if(!f.startsWith(C.token,g))continue;const P=g+C.token.length;if(P<r.length&&c(r[P]))continue;let I=P;for(;I<r.length&&/\s/.test(r[I]);)I+=1;const A=r[I];if(!(A!=="="&&A!==":")){d={key:C.key,start:g,valueStart:I+1};break}}}if(!d)return null;const h=r.slice(0,d.start).replace(/[,;]+\s*$/,"").trim(),m=r.slice(d.valueStart).trim();return{key:d.key,when:h,value:m}};let t=n.trim(),s,o;for(let r=0;r<4;r++){const a=e(t);if(!a)break;t=a.when,a.key==="score"&&s==null&&(s=a.value),a.key==="cooldown"&&o==null&&(o=a.value)}return{when:t.trim(),scoreRaw:s,cooldownRaw:o}}function Hoe(n,e,t){const s=n.trim();if(!s)throw new Error(`Line ${t}: score requires a numeric value`);const o=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,r=e[s],a=typeof r=="number"&&Number.isFinite(r)?r:typeof r=="string"&&o.test(r)?Number(r):null,l=a??(o.test(s)?Number(s):null),c=u=>{switch(u.kind){case"NumberLiteral":return u.value;case"Identifier":{const d=e[u.name],h=typeof d=="number"?d:Number(d);return Number.isFinite(h)?h:null}case"MemberExpression":case"IndexExpression":return null;case"UnaryExpression":{if(u.operator!=="not")return null;const d=c(u.expr);return d==null?null:Number.isFinite(d)&&d!==0?0:1}case"BinaryExpression":{const d=c(u.left),h=c(u.right);if(d==null||h==null)return null;switch(u.operator){case"+":return d+h;case"-":return d-h;case"*":return d*h;case"/":return h===0?NaN:d/h;case"%":return h===0?NaN:d%h;case">":return Number.isFinite(d)&&Number.isFinite(h)&&d>h?1:0;case"<":return Number.isFinite(d)&&Number.isFinite(h)&&d<h?1:0;case">=":return Number.isFinite(d)&&Number.isFinite(h)&&d>=h?1:0;case"<=":return Number.isFinite(d)&&Number.isFinite(h)&&d<=h?1:0;case"==":return Number.isFinite(d)&&Number.isFinite(h)&&Math.abs(d-h)<1e-9?1:0;case"!=":return Number.isFinite(d)&&Number.isFinite(h)&&Math.abs(d-h)>=1e-9?1:0;case"and":return Number.isFinite(d)&&d!==0&&Number.isFinite(h)&&h!==0?1:0;case"or":return Number.isFinite(d)&&d!==0||Number.isFinite(h)&&h!==0?1:0;default:return null}}case"CallExpression":{const d=u.callee.toLowerCase();if(d==="iff"&&u.args.length===3){const w=c(u.args[0]);return w==null?null:c(w!==0?u.args[1]:u.args[2])}const h=u.args.map(w=>c(w));if(h.some(w=>w==null))return null;const m=h[0],g=h[1];switch(d){case"min":return Math.min(m,g);case"max":return Math.max(m,g);case"abs":return Math.abs(m);case"ceil":return Math.ceil(m);case"floor":return Math.floor(m);case"round":return Math.round(m);case"sqrt":return Math.sqrt(m);case"pow":return Math.pow(m,g);default:return null}}default:return null}};let f=l;if(f==null)try{const u=Lp(s);f=c(u)}catch{f=null}if(f==null||!Number.isFinite(f))throw new Error(`Line ${t}: score must be an integer between 0 and 10`);if(!Number.isInteger(f))throw new Error(`Line ${t}: score must be an integer between 0 and 10`);if(f<0||f>10)throw new Error(`Line ${t}: score must be in range 0..10`);return f}function qoe(n,e,t){const s=n.trim();if(!s)throw new Error(`Line ${t}: cooldown requires a numeric value`);const o=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,r=e[s],a=typeof r=="number"&&Number.isFinite(r)?r:typeof r=="string"&&o.test(r)?Number(r):null,l=a??(o.test(s)?Number(s):null),c=u=>{switch(u.kind){case"NumberLiteral":return u.value;case"Identifier":{const d=e[u.name],h=typeof d=="number"?d:Number(d);return Number.isFinite(h)?h:null}case"MemberExpression":case"IndexExpression":return null;case"UnaryExpression":{if(u.operator!=="not")return null;const d=c(u.expr);return d==null?null:Number.isFinite(d)&&d!==0?0:1}case"BinaryExpression":{const d=c(u.left),h=c(u.right);if(d==null||h==null)return null;switch(u.operator){case"+":return d+h;case"-":return d-h;case"*":return d*h;case"/":return h===0?NaN:d/h;case"%":return h===0?NaN:d%h;case">":return Number.isFinite(d)&&Number.isFinite(h)&&d>h?1:0;case"<":return Number.isFinite(d)&&Number.isFinite(h)&&d<h?1:0;case">=":return Number.isFinite(d)&&Number.isFinite(h)&&d>=h?1:0;case"<=":return Number.isFinite(d)&&Number.isFinite(h)&&d<=h?1:0;case"==":return Number.isFinite(d)&&Number.isFinite(h)&&d===h?1:0;case"!=":return Number.isFinite(d)&&Number.isFinite(h)&&d!==h?1:0;case"and":return Number.isFinite(d)&&d!==0&&Number.isFinite(h)&&h!==0?1:0;case"or":return Number.isFinite(d)&&d!==0||Number.isFinite(h)&&h!==0?1:0;default:return null}}case"CallExpression":{const d=u.callee.toLowerCase();if(d==="iff"&&u.args.length===3){const w=c(u.args[0]);return w==null?null:c(w!==0?u.args[1]:u.args[2])}const h=u.args.map(w=>c(w));if(h.some(w=>w==null))return null;const m=h[0],g=h[1];switch(d){case"min":return Math.min(m,g);case"max":return Math.max(m,g);case"abs":return Math.abs(m);case"ceil":return Math.ceil(m);case"floor":return Math.floor(m);case"round":return Math.round(m);case"sqrt":return Math.sqrt(m);case"pow":return Math.pow(m,g);default:return null}}default:return null}};let f=l;if(f==null)try{const u=Lp(s);f=c(u)}catch{f=null}if(f==null||!Number.isFinite(f))throw new Error(`Line ${t}: cooldown must be a non-negative integer`);if(!Number.isInteger(f))throw new Error(`Line ${t}: cooldown must be a non-negative integer`);if(f<0)throw new Error(`Line ${t}: cooldown must be a non-negative integer`);return f}function r3(n){const e=String(n||"").split(/\n+/),t={},s=[],o=[],r=[],a=[],l={};for(let f=0;f<e.length;f++){const u=e[f],d=f+1,h=u.replace(/#.*$/,"").replace(/\/\/.*$/,"").trim();if(!h)continue;let m;if(m=h.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+)$/),m){const g=m[1],w=m[2].trim(),C=Number(w);Number.isFinite(C)&&/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/.test(w)?t[g]=C:w.startsWith('"')&&w.endsWith('"')||w.startsWith("'")&&w.endsWith("'")?t[g]=Db(w):s.push({name:g,expr:w});continue}if(m=h.match(/^signal\s+([A-Za-z_$][A-Za-z0-9_$]*)\s+when\s+(.+)\s*$/i),m){const g=m[1],w=Woe(m[2]||"");if(!w.when)throw new Error(`Line ${d}: signal ... when requires a condition`);const C=w.when.trim();l[g.toLowerCase()]=C;const P=g.toLowerCase(),I=P==="top"?"entry_long":P==="bot"?"entry_short":P==="buy"?"entry_long":P==="sell"||P==="exit"?"exit_long":P,A=w.scoreRaw!=null?Hoe(w.scoreRaw,t,d):null,M=w.cooldownRaw!=null?qoe(w.cooldownRaw,t,d):void 0;o.push({type:I,when:C,score:A,cooldownBars:M});continue}if(m=h.match(/^label\s+at\s+(top|bot)(?:\s+when\s*\((.+?)\))?\s+(.+)$/i),m){const g=m[1].toLowerCase(),w=(m[2]||"").trim(),C=m[3]||"",P=Voe(C),I=P.text?Db(P.text):g==="top"?"▲":"▼",A=P.color||(g==="top"?"#f97316":"#3b82f6"),M=g==="top"?"above":"below",F=P.source?Db(P.source):g==="top"?"high":"low",B=P.shape?Db(P.shape):void 0,$=Q=>s.some(le=>le.name.replace(/\s+/g,"_").toLowerCase()===Q.replace(/\s+/g,"_").toLowerCase()),L=typeof t.WIN=="number"||typeof t.WIN=="string"&&Number.isFinite(Number(t.WIN)),O=g==="top"?$("hiwin")?"close == HIWIN":L?"close == highest(close, WIN)":"close < -1e20":$("lowin")?"close == LOWIN":L?"close == lowest(close, WIN)":"close < -1e20",ce={when:w||l[g]||O,text:I,color:A,position:M,source:F,shape:B};F==="high"||F==="low"?r.push(ce):a.push(ce);continue}}const c=[];return(r.length||o.length)&&c.push({pane:"main",plots:[],labels:r,levels:[],lines:[]}),a.length&&c.push({pane:"sub",plots:[],labels:a,levels:[],lines:[],min:0,max:100}),{params:t,series:s,signals:o,panes:c}}function Uoe(n,e,t,s){if(!nv("interactionV2"))return;const{endedId:o}=bw();o&&(x(e,""),x(t,"")),o&&s()}function Goe(n,e,t,s,o){i(e)&&t(),i(s)&&o()}function Yoe(n,e,t,s,o,r,a,l){var c,f,u,d,h,m;i(e)&&(i(t)==="overlay"?i(s)&&i(s).startsWith(o)?(f=(c=i(r))==null?void 0:c.pasteOverlayFromClipboard)==null||f.call(c,i(s),i(e)):(d=(u=i(r))==null?void 0:u.pasteOverlayAtPixel)==null||d.call(u,i(e)):i(t)==="text"&&((m=(h=i(r))==null?void 0:h.pasteTextAtPixel)==null||m.call(h,i(a),i(e))),l())}function Koe(n,e,t,s){var o,r;i(e)&&((r=(o=i(t))==null?void 0:o.cloneOverlayById)==null||r.call(o,i(e)),s())}function Xoe(n,e,t,s){var o,r;i(e)&&((r=(o=i(t))==null?void 0:o.copyOverlayById)==null||r.call(o,i(e)),s())}function Zoe(n,e,t,s){var o,r;i(e)&&((r=(o=i(t))==null?void 0:o.removeOverlayById)==null||r.call(o,i(e)),s())}function Joe(n,e,t){var s,o;(o=(s=i(e))==null?void 0:s.openChartSettings)==null||o.call(s),t()}function Qoe(n,e,t){var s,o;(o=(s=i(e))==null?void 0:s.openLoadLayout)==null||o.call(s),t()}function eie(n,e,t){e(),t()}var tie=(n,e,t)=>Dc(t(),qo(e).clickChart+=1,qo(e)),nie=ke('<div class="duty-loading-overlay svelte-1ddlfai"><div class="loader-content svelte-1ddlfai"><div class="ai-minimal svelte-1ddlfai"><div class="brand-text svelte-1ddlfai">Duty AI</div> <span class="brand-shine svelte-1ddlfai"></span> <div class="orbit svelte-1ddlfai"><span class="o-dot o1 svelte-1ddlfai"></span><span class="o-dot o2 svelte-1ddlfai"></span></div> <div class="progress-line svelte-1ddlfai"><span class="dot svelte-1ddlfai"></span></div> <div class="tagline svelte-1ddlfai">Preparing data</div></div></div></div>'),sie=n=>n.stopPropagation(),oie=ke('<div class="historical-loading-indicator svelte-1ddlfai"><div class="loading-spinner svelte-1ddlfai"></div> <span class="svelte-1ddlfai">Loading historical data...</span></div>'),iie=(n,e,t,s)=>{var r,a,l,c;if(!i(e))return;(a=(r=i(t))==null?void 0:r.toggleOverlayManualLockById)==null||a.call(r,i(e));const o=(c=(l=i(t))==null?void 0:l.getOverlayLockInfo)==null?void 0:c.call(l,i(e));x(s,V(!!(o!=null&&o.manualLock)))},rie=ta('<path d="M8 10V7a4 4 0 0 1 8 0v3" class="svelte-1ddlfai"></path>'),aie=ta('<path d="M8 10V7a4 4 0 0 1 7.5-2" class="svelte-1ddlfai"></path>'),lie=ke('<button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><rect x="7" y="7" width="10" height="10" rx="2" class="svelte-1ddlfai"></rect><rect x="3" y="3" width="10" height="10" rx="2" class="svelte-1ddlfai"></rect></svg> <span class="svelte-1ddlfai">Clone</span></button> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="-1 -1 26 26" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><rect x="9" y="9" width="11" height="11" rx="2" class="svelte-1ddlfai"></rect><rect x="4" y="4" width="11" height="11" rx="2" class="svelte-1ddlfai"></rect></svg> <span class="svelte-1ddlfai">Copy</span></button> <button class="action-btn lock-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><rect x="5" y="10" width="14" height="10" rx="2" class="svelte-1ddlfai"></rect><!></svg> <span class="svelte-1ddlfai"> </span></button> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M4 7h16" class="svelte-1ddlfai"></path><path d="M9 7V4h6v3" class="svelte-1ddlfai"></path><path d="M6 7l1 13h10l1-13" class="svelte-1ddlfai"></path><path d="M10 11v6" class="svelte-1ddlfai"></path><path d="M14 11v6" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai">Remove This Drawing</span></button>',1),cie=ke('<button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M8 4h8l2 2v10a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" class="svelte-1ddlfai"></path><path d="M12 9v6" class="svelte-1ddlfai"></path><path d="m9 12 3 3 3-3" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai">Paste</span></button>'),uie=ke('<button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M4 7h16" class="svelte-1ddlfai"></path><path d="M9 7V4h6v3" class="svelte-1ddlfai"></path><path d="M6 7l1 13h10l1-13" class="svelte-1ddlfai"></path><path d="M10 11v6" class="svelte-1ddlfai"></path><path d="M14 11v6" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai"> </span></button>'),die=ke('<button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M4 7h16" class="svelte-1ddlfai"></path><path d="M9 7V4h6v3" class="svelte-1ddlfai"></path><path d="M6 7l1 13h10l1-13" class="svelte-1ddlfai"></path><path d="M10 11v6" class="svelte-1ddlfai"></path><path d="M14 11v6" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai"> </span></button>'),fie=ke('<button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="-2 -2 28 28" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M3 12a9 9 0 1 0 3-6.7" class="svelte-1ddlfai"></path><path d="M3 3v6h6" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai">Reset View</span></button> <button class="action-btn copy-btn svelte-1ddlfai"><svg viewBox="-1 -1 26 26" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><rect x="9" y="9" width="11" height="11" rx="2" class="svelte-1ddlfai"></rect><rect x="4" y="4" width="11" height="11" rx="2" class="svelte-1ddlfai"></rect></svg> <span class="svelte-1ddlfai"> </span></button> <!> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><rect x="3" y="3" width="7" height="7" rx="1" class="svelte-1ddlfai"></rect><rect x="14" y="3" width="7" height="7" rx="1" class="svelte-1ddlfai"></rect><rect x="3" y="14" width="7" height="7" rx="1" class="svelte-1ddlfai"></rect><rect x="14" y="14" width="7" height="7" rx="1" class="svelte-1ddlfai"></rect></svg> <span class="svelte-1ddlfai"> </span></button> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M12 3v12" class="svelte-1ddlfai"></path><path d="m7 10 5 5 5-5" class="svelte-1ddlfai"></path><path d="M5 21h14" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai">Load Layout</span></button> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="m8 17-5-5 5-5" class="svelte-1ddlfai"></path><path d="m16 7 5 5-5 5" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai">Script Studio</span></button> <!> <!> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 800 800" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1ddlfai"><g clip-path="url(#clip0_settings_menu)" class="svelte-1ddlfai"><path d="M287 733.333C270.734 733.237 254.941 727.855 242 717.999L173 666.666C157.077 654.251 146.512 636.211 143.474 616.25C140.437 596.289 145.158 575.922 156.667 559.333C162.756 550.341 166.627 540.033 167.959 529.255C169.292 518.477 168.049 507.537 164.334 497.333L162.334 491.999C159.746 482.763 155.017 474.267 148.53 467.201C142.044 460.135 133.982 454.699 125 451.333H119.667C100.196 444.785 84.0938 430.821 74.8572 412.473C65.6205 394.124 63.9949 372.873 70.3335 353.333L97.6669 266.666C100.183 256.625 104.815 247.237 111.254 239.131C117.693 231.026 125.789 224.389 135 219.666C143.579 215.246 152.965 212.613 162.59 211.925C172.216 211.238 181.881 212.51 191 215.666C200.93 219.008 211.525 219.874 221.865 218.189C232.206 216.505 241.978 212.32 250.334 205.999L254.667 202.666C262.23 196.631 268.343 188.976 272.554 180.265C276.765 171.554 278.968 162.008 279 152.333V144.333C278.911 123.937 286.882 104.332 301.178 89.7854C315.475 75.2391 334.939 66.9296 355.334 66.666H440.334C450.256 66.6928 460.076 68.6795 469.228 72.5121C478.381 76.3447 486.686 81.9478 493.667 88.9994C508.343 103.926 516.496 124.067 516.334 144.999V154.333C516.164 163.524 518.158 172.627 522.153 180.907C526.148 189.187 532.033 196.412 539.334 201.999L543 204.666C550.481 210.276 559.208 213.994 568.437 215.503C577.665 217.012 587.122 216.268 596 213.333L607.333 209.666C616.936 206.483 627.08 205.267 637.163 206.089C647.245 206.912 657.059 209.757 666.018 214.454C674.977 219.151 682.899 225.605 689.31 233.43C695.721 241.255 700.49 250.291 703.333 259.999L729.667 343.999C735.76 363.412 734.095 384.431 725.02 402.642C715.946 420.854 700.168 434.84 681 441.666L674.333 443.999C664.528 447.21 655.661 452.78 648.512 460.22C641.364 467.659 636.151 476.741 633.333 486.666C630.68 495.893 630.051 505.584 631.489 515.077C632.928 524.569 636.399 533.639 641.667 541.666L650.333 554.333C661.827 571.014 666.503 591.46 663.404 611.479C660.305 631.498 649.666 649.574 633.667 661.999L566.667 713.666C558.572 719.856 549.296 724.324 539.41 726.795C529.524 729.265 519.237 729.686 509.182 728.031C499.127 726.376 489.517 722.68 480.944 717.171C472.371 711.663 465.017 704.457 459.334 695.999L455.334 690.333C449.874 682.128 442.425 675.441 433.682 670.894C424.938 666.347 415.185 664.09 405.334 664.333C395.933 664.576 386.721 667.026 378.441 671.484C370.161 675.943 363.045 682.285 357.667 689.999L350 700.999C344.315 709.517 336.946 716.78 328.346 722.341C319.747 727.901 310.1 731.642 300 733.333C295.677 733.756 291.323 733.756 287 733.333ZM146.667 387.333C165.49 394.045 182.474 405.082 196.253 419.556C210.033 434.029 220.221 451.536 226 470.666V474.666C233.198 494.554 235.561 515.868 232.895 536.85C230.229 557.831 222.61 577.877 210.667 595.333C208.559 597.662 207.391 600.691 207.391 603.833C207.391 606.974 208.559 610.004 210.667 612.333L282.334 666.666C283.269 667.4 284.35 667.926 285.505 668.208C286.66 668.49 287.862 668.522 289.03 668.301C290.198 668.08 291.306 667.611 292.278 666.927C293.25 666.242 294.065 665.358 294.667 664.333L302.333 653.333C313.896 636.625 329.338 622.97 347.335 613.539C365.333 604.107 385.348 599.181 405.667 599.181C425.986 599.181 446.001 604.107 463.998 613.539C481.995 622.97 497.437 636.625 509 653.333L513 659.333C514.433 661.366 516.572 662.792 519 663.333C520.114 663.497 521.249 663.434 522.337 663.148C523.426 662.861 524.445 662.357 525.334 661.666L594 609.666C596.404 607.758 597.985 605.002 598.419 601.964C598.853 598.926 598.107 595.837 596.333 593.333L587.667 580.666C576.374 564.199 568.924 545.407 565.866 525.676C562.809 505.944 564.221 485.778 570 466.666C575.858 446.578 586.455 428.191 600.898 413.052C615.342 397.912 633.21 386.462 653 379.666L659.667 377.333C662.445 376.22 664.671 374.053 665.857 371.305C667.044 368.557 667.095 365.452 666 362.666L640 279.666C639.376 278.214 638.463 276.904 637.317 275.815C636.171 274.726 634.816 273.882 633.333 273.333C632.352 272.835 631.267 272.575 630.167 272.575C629.066 272.575 627.981 272.835 627 273.333L615.667 276.999C596.495 283.327 576.074 284.903 556.158 281.594C536.242 278.284 517.428 270.187 501.334 257.999L500 254.999C484.556 243.303 472.034 228.186 463.416 210.836C454.798 193.485 450.32 174.372 450.334 154.999V144.666C450.394 141.453 449.198 138.344 447 135.999C445.082 134.266 442.585 133.315 440 133.333H355.334C353.976 133.417 352.648 133.77 351.426 134.369C350.205 134.968 349.113 135.803 348.215 136.825C347.317 137.847 346.63 139.036 346.192 140.325C345.755 141.613 345.576 142.975 345.667 144.333V152.666C345.669 172.567 341.102 192.203 332.317 210.061C323.533 227.919 310.766 243.521 295 255.666L290.667 258.999C273.658 271.95 253.724 280.517 232.623 283.947C211.522 287.376 189.902 285.563 169.667 278.666C168.153 278.158 166.514 278.158 165 278.666C163.119 279.809 161.702 281.58 161 283.666L133.334 370.666C132.369 373.629 132.595 376.851 133.964 379.651C135.332 382.45 137.736 384.607 140.667 385.666L146.667 387.333Z" fill="currentColor" class="svelte-1ddlfai"></path><path d="M400 516.667C376.925 516.667 354.369 509.825 335.183 497.006C315.997 484.186 301.044 465.965 292.214 444.647C283.384 423.329 281.073 399.871 285.575 377.24C290.076 354.609 301.188 333.821 317.504 317.505C333.82 301.189 354.608 290.077 377.239 285.576C399.87 281.074 423.328 283.385 444.646 292.215C465.964 301.045 484.185 315.998 497.005 335.184C509.824 354.37 516.666 376.926 516.666 400.001C516.666 430.943 504.375 460.617 482.496 482.496C460.616 504.376 430.942 516.667 400 516.667ZM400 350.001C390.111 350.001 380.444 352.933 372.221 358.427C363.999 363.921 357.59 371.73 353.806 380.867C350.021 390.003 349.031 400.056 350.96 409.755C352.89 419.454 357.652 428.363 364.644 435.356C371.637 442.349 380.546 447.111 390.245 449.04C399.944 450.969 409.998 449.979 419.134 446.195C428.27 442.41 436.079 436.002 441.573 427.779C447.067 419.557 450 409.89 450 400.001C450 386.74 444.732 374.022 435.355 364.645C425.978 355.269 413.261 350.001 400 350.001Z" fill="currentColor" class="svelte-1ddlfai"></path></g><defs class="svelte-1ddlfai"><clipPath id="clip0_settings_menu" class="svelte-1ddlfai"><rect width="800" height="800" fill="white" class="svelte-1ddlfai"></rect></clipPath></defs></svg> <span class="svelte-1ddlfai">Settings</span></button>',1),pie=ke('<div class="reset-menu svelte-1ddlfai"><!></div>'),mie=ke('<div class="duty-main svelte-1ddlfai"><div class="alerts-container svelte-1ddlfai"></div> <!> <div class="chart-container svelte-1ddlfai"><div class="chart-shell svelte-1ddlfai"><div class="duty-content svelte-1ddlfai"><div class="drawbar-host svelte-1ddlfai" style="width: var(--drawing-bar-width); overflow: hidden;"><!></div> <!> <div class="duty-widget svelte-1ddlfai" role="application" tabindex="0"><canvas class="script-webgl-layer svelte-1ddlfai"></canvas> <canvas class="script-overlay svelte-1ddlfai"></canvas> <canvas class="tool-overlay svelte-1ddlfai"></canvas></div> <!></div> <div><div class="dock-resize-handle svelte-1ddlfai" aria-label="Resize script dock"><div class="handle-bar svelte-1ddlfai"></div></div> <div class="dock-body svelte-1ddlfai"><!></div></div></div> <!></div> <!> <!> <!> <!> <!> <!> <!> <!></div>');function hie(n,e){var ug,Vv,dg,fg;Ed(e,!0);const t=sm(),s=()=>wl($(),"$save",t),o=()=>wl(Ie,"$chart",t),r=()=>wl(uh,"$simulator",t),a=()=>wl(B(),"$ctx",t),l=()=>wl(c3,"$page",t),c=()=>wl(O0,"$userPreferences",t),f=()=>wl(Dt,"$alerts",t),u=()=>wl(Oa,"$saveRestoring",t),d=()=>wl($oe,"$scriptBacktests",t),h=()=>wl(poe,"$scriptSignals",t),m=(...S)=>{},g=-10,w=(S,R,X,ae,ne,Ee)=>{const je=Math.max(0,Math.min(Ee,Math.min(ae,ne)/2));S.beginPath(),S.moveTo(R+je,X),S.lineTo(R+ae-je,X),S.quadraticCurveTo(R+ae,X,R+ae,X+je),S.lineTo(R+ae,X+ne-je),S.quadraticCurveTo(R+ae,X+ne,R+ae-je,X+ne),S.lineTo(R+je,X+ne),S.quadraticCurveTo(R,X+ne,R,X+ne-je),S.lineTo(R,X+je),S.quadraticCurveTo(R,X,R+je,X),S.closePath()},C=()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"}catch{return"UTC"}},P=S=>{if(!S)return S??null;const R=iS(S),X={...S},ae=o1((S==null?void 0:S.session)||R.regular)||void 0,ne=o1((S==null?void 0:S.sessionExtended)||R.extended)||void 0;return!X.session&&ae&&(X.session=ae),!X.sessionExtended&&ne&&(X.sessionExtended=ne),!X.timezone&&R.timezone&&(X.timezone=R.timezone),!X.sessionTimezone&&(X.timezone||R.timezone)&&(X.sessionTimezone=X.timezone||R.timezone),X};uk(C());function I(S){const X=`${S??""}`.replace(/0[\{\(](\d+)[\}\)]/g,(ne,Ee)=>{const je=Number(Ee);return!Number.isFinite(je)||je<=0?"0":"0".repeat(Math.min(50,Math.trunc(je)))}),ae=(ne,Ee)=>{if(!Number.isFinite(ne)||ne===0)return`${ne}`;const je=ne<0?"-":"",dt=Math.abs(ne),At=Math.floor(Math.log10(dt))+1;let Yt=dt/Math.pow(10,At),yn=At;const Wt=Number(Yt.toFixed(Ee));return Wt>=1?(Yt=Wt/10,yn=At+1):Yt=Wt,`${je}${Yt.toFixed(Ee)}e${yn}`};try{const ne=/^(-?)([\d,]+)(?:\.(\d+))?$/.exec(X.trim());if(ne){const Ee=ne[1]||"",je=ne[2]||"0",dt=ne[3]||"";if(je.replace(/,/g,"").length>=5&&dt.length>2)return`${Ee}${je}.${dt.slice(0,2).padEnd(2,"0")}`}}catch{}try{const ne=Tb(s().symbol);if(ne==="stock"||ne==="crypto"){const Ee=Number(X.replace(/,/g,"").trim());if(Number.isFinite(Ee)){const je=Math.abs(Ee);if(je>0&&je<1e-4)return ae(Ee,5)}}}catch{}return X}const A=new mR;let M={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},F=null;vE.forEach(S=>T3(S)),kE.forEach(S=>qI(S)),x$.forEach(S=>{S.extendData=="datafeed"&&(S.extendData=A),J2(S)});let B=hi(e,"ctx",23,()=>$m(new b4)),$=hi(e,"save",19,()=>Gw("chart",new Vb)),L=hi(e,"customLoad",3,!1);const O=5e3,Y=[{timeframe:"1m",multiplier:1,timespan:"minute",secs:60},{timeframe:"5m",multiplier:5,timespan:"minute",secs:300},{timeframe:"15m",multiplier:15,timespan:"minute",secs:900},{timeframe:"30m",multiplier:30,timespan:"minute",secs:1800},{timeframe:"1h",multiplier:1,timespan:"hour",secs:3600},{timeframe:"4h",multiplier:4,timespan:"hour",secs:14400},{timeframe:"1d",multiplier:1,timespan:"day",secs:86400},{timeframe:"1w",multiplier:1,timespan:"week",secs:604800},{timeframe:"1M",multiplier:1,timespan:"month",secs:2592e3}],ce=`{
  "pane": "sub",
  "min": -2,
  "max": 2,
  "shortName": "Debug Area",
  "plots": [
    {
      "name": "AreaTest",
      "source": "close",
      "type": "area",
      "color": "rgba(129,140,248,0.4)",
      "width": 1
    }
  ]
}`;try{const S=sessionStorage.getItem("chart.tabId");S?Dc($(),qo(s).key=`chart:${S}`,qo(s)):s().key||Dc($(),qo(s).key="chart",qo(s))}catch{s().key||Dc($(),qo(s).key="chart",qo(s))}try{const S=s()&&s().symbol&&typeof s().symbol=="object",R=s()&&s().period&&typeof s().period=="object";(!S||!R)&&$().set(new Vb)}catch{$().set(new Vb)}$().update(S=>{if(!(S.allExgs instanceof Set)){const R=Array.isArray(S.allExgs)?S.allExgs:[];S.allExgs=new Set(R)}return S});let Q,le,ue,fe,pe=null,Z=null,xe=null,oe=null,Pe=!1,$e=null,ze=[],Ke=null,qe=[];const nt=new Set;let ft=null,ut=[],bt=[],Pt=!1,Et=!1,Mt=!1,Je=ge(!1),Ct=ge(!1),Ze=ge(null),Xe=ge(!1),Ae=ge(void 0),Qe=ge(null),gt=ge(void 0),Ft=ge(void 0),ot=ge(void 0),ve=ge(void 0);const Ie=$m(null),It=500,Dt=BC();let Zt=ge(!1),gn=ge(!1),hn=ge(!1),qn=ge(.35);const On=.2,bn=.6;let Fn=ge(!1),Xs=0,oo=0,Yn=ge(ce),_o=ge(0),xs=ge(void 0),Rt=ge("Ready"),un=ge(null),qs=ge(V([])),ri=ge(!1),Eo=0,Ia=new Set,Lr="",Qa=null,yr=ge(!0),Fi=!1;const Rc="SCRIPT_STUDIO";let Cu=[],uc=[],Fl=ge(null),jc=ge("main"),nd=new Set;const Fa="script-trade-focus",dc="script-order-focus",Bc=()=>{var X;const S=((X=s().options)==null?void 0:X.datafeed)||{},R=P(s().symbol)||s().symbol;return{sessionMode:String(S.sessionMode||"regular"),adjustMode:String(S.adjustMode||"none"),timezone:String((R==null?void 0:R.timezone)||(R==null?void 0:R.sessionTimezone)||C())}};let rd=[],uf=[];const So=(S,R)=>{const X=typeof S=="number"?S:Number(S);if(!Number.isFinite(X))return"-";try{return I(X.toFixed(Math.max(0,Math.min(10,R))))}catch{return`${X}`}},Ll=S=>{const R=typeof S=="number"?S:Number(S);return!Number.isFinite(R)||R<=0?null:R<1e12?R*1e3:R};function ya(){const S=o();if(S){try{for(const R of rd)S.removeOverlay({id:R});rd=[]}catch{}try{S.removeOverlay({groupId:Fa})}catch{}}}function hc(){const S=o();if(S){try{for(const R of uf)S.removeOverlay({id:R});uf=[]}catch{}try{S.removeOverlay({groupId:dc})}catch{}}}function Pa(S){if(S==null)return;const R=String(S);R&&rd.push(R)}function Yr(S){if(S==null)return;const R=String(S);R&&uf.push(R)}function el(S){var X;const R=o();if(!(!R||!S))try{const ae=((X=R.getDataList)==null?void 0:X.call(R))||[],ne=Math.max(0,Math.floor(Number(S.entryIndex)||0)),Ee=Math.max(0,Math.floor(Number(S.exitIndex)||0)),je=ae[ne]||null,dt=ae[Ee]||null,At=Ll(S.entryTimestamp)??Ll((je==null?void 0:je.timestamp)??(je==null?void 0:je.time))??null,Yt=Ll(S.exitTimestamp)??Ll((dt==null?void 0:dt.timestamp)??(dt==null?void 0:dt.time))??null,yn=Number(S.entryPrice),Wt=Number(S.exitPrice);if(!Number.isFinite(yn)||!Number.isFinite(Wt)||At==null||Yt==null)return;ya(),hc();const zn=Number(S.netPnl)>=0,Pn=zn?"#22c55e":"#ef4444",as=zn?"#16a34a":"#ef4444",Cs=zn?"#16a34a":"#f59e0b",Ks=Number(S.netPnl)||0,jn=Number(S.fees)||0,Xt=String(S.exitReason||"").replace(/_/g," "),Tn=R.createOverlay({name:"trade",paneId:"candle_pane",groupId:Fa,lock:!1,visible:!0,points:[{timestamp:At,value:yn},{timestamp:Yt,value:Wt},{timestamp:Yt,value:Wt}],extendData:{line_color:Pn,in_color:as,out_color:Cs,in_text:`ENTRY ${String(S.side||"").toUpperCase()} @ ${So(yn,6)}`,out_text:`EXIT @ ${So(Wt,6)} • ${Xt||"signal"} • Net ${Ks>=0?"+":""}${So(Ks,2)} • Fees ${So(jn,2)}`,selected:!1,active:!1,distance:18}});Pa(Tn);try{const Kn=R.createOverlay({name:"note",paneId:"candle_pane",groupId:Fa,lock:!1,visible:!0,points:[{timestamp:At,value:yn},{timestamp:At,value:yn}],extendData:{line_color:"transparent",in_color:as,in_text:`ENTRY ${String(S.side||"").toUpperCase()} @ ${So(yn,6)}`,out_color:as,out_text:"",distance:24,offsetX:-70,align:"right"}});Pa(Kn);const os=R.createOverlay({name:"note",paneId:"candle_pane",groupId:Fa,lock:!1,visible:!0,points:[{timestamp:Yt,value:Wt},{timestamp:Yt,value:Wt}],extendData:{line_color:"transparent",in_color:Cs,in_text:`EXIT @ ${So(Wt,6)} • ${Xt||"signal"} • Net ${Ks>=0?"+":""}${So(Ks,2)} • Fees ${So(jn,2)}`,out_color:Cs,out_text:"",distance:24,offsetX:70,align:"left"}});Pa(os)}catch{}try{R.scrollToDataIndex(Ee,0)}catch{try{R.scrollToTimestamp(Yt,0)}catch{}}}catch(ae){console.error("[ScriptStudio] focus trade failed",ae)}}function Yl(S){var X;const R=o();if(!(!R||!S))try{const ae=((X=R.getDataList)==null?void 0:X.call(R))||[],ne=Number(S.filledIndex),Ee=Number(S.createdIndex),je=Number.isFinite(ne)?Math.max(0,Math.floor(ne)):Number.isFinite(Ee)?Math.max(0,Math.floor(Ee)):null,dt=je!=null?ae[je]:null,At=Ll(S.filledTimestamp)??Ll(S.createdTimestamp)??Ll((dt==null?void 0:dt.timestamp)??(dt==null?void 0:dt.time))??null,Yt=Number.isFinite(Number(S.fillPrice))?Number(S.fillPrice):Number.isFinite(Number(S.stopPrice))?Number(S.stopPrice):Number.isFinite(Number(S.limitPrice))?Number(S.limitPrice):Number.isFinite(Number(S.price))?Number(S.price):NaN;if(!Number.isFinite(Yt)||At==null)return;hc(),ya();const yn=String(S.action||"").toLowerCase(),Wt=String(S.side||"").toLowerCase(),as=yn==="entry"?Wt==="short"?"#ef4444":"#16a34a":yn==="exit"?"#f59e0b":"#64748b",Cs=String(S.kindLabel||S.kind||"").toUpperCase(),Ks=String(S.statusLabel||S.status||"").replace(/_/g," ").trim(),jn=`ORDER ${Cs}${Wt?` ${Wt.toUpperCase()}`:""}${Ks?` • ${Ks}`:""}`,Xt=R.createOverlay({name:"horizontalStraightLine",paneId:"candle_pane",groupId:dc,lock:!1,visible:!0,points:[{timestamp:At,value:Yt},{timestamp:At,value:Yt}],extendData:{showDot:!0,interactive:!1},styles:{line:{color:as,size:1,style:"dashed"}}});Yr(Xt);const Tn=R.createOverlay({name:"note",paneId:"candle_pane",groupId:dc,lock:!1,visible:!0,points:[{timestamp:At,value:Yt},{timestamp:At,value:Yt}],extendData:{line_color:as,in_color:as,in_text:jn,distance:24,offsetX:-70,align:"right"}});Yr(Tn),je!=null?R.scrollToDataIndex(je,0):R.scrollToTimestamp(At,0)}catch(ae){console.error("[ScriptStudio] focus order failed",ae)}}function Vu(S){const R=o();if(!R)return!1;const X=Math.max(0,Math.floor(Number(S)||0));try{return R.scrollToDataIndex(X,0),!0}catch(ae){return console.error("[ScriptStudio] focus index failed",ae),!1}}function Iu(S){const R=o();if(!R)return!1;const X=Math.floor(Number(S)||0);if(!Number.isFinite(X)||X<=0)return!1;try{return R.scrollToTimestamp(X,0),!0}catch(ae){return console.error("[ScriptStudio] focus timestamp failed",ae),!1}}let Ro=new Map;const zr=new Set;let kl=null,Md=null;const nf={solid:wt.Solid,dashed:wt.Dashed,dotted:wt.Dashed,arrow_left:wt.Solid,arrow_right:wt.Solid,arrow_both:wt.Solid,arrow_none:wt.Solid};let zf={};const df=new Map,Pu=new Map,Dd=S=>{if(!S)return 0;let R=2166136261;for(let ae=0;ae<S.length;(ae+=1)-1)R^=S.charCodeAt(ae),R=Math.imul(R,16777619);const X=R>>>0;return X===0?1:X},yf=S=>{const R=String(S||"");let X="",ae=0;for(;ae<R.length;){const ne=R[ae];if(ne==='"'||ne==="'"){const Ee=ne;ae+=1;let je="",dt=!1;for(;ae<R.length;){const At=R[ae];if(dt){je+=At,dt=!1,ae+=1;continue}if(At==="\\"){dt=!0,ae+=1;continue}if(At===Ee){ae+=1;break}je+=At,ae+=1}X+=String(Dd(je));continue}X+=ne,ae+=1}return X};function $n(S){let R=String(S||"").trim();return R=R.replace(/\$\{([^}]+)\}/g,(X,ae)=>{const ne=zf[String(ae)];if(ne==null)return X;if(typeof ne=="number"&&Number.isFinite(ne)||typeof ne=="string")return String(ne);try{return JSON.stringify(ne)}catch{return String(ne)}}),R=r6(R).replace(/#.*$/,""),R=R.split(";")[0],R=R.replace(/,\s*$/,""),R=R.replace(/\b(and|or)\b\s*$/i,""),R=R.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),R=R.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),R=R.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(X,ae,ne)=>`${String(ae).toLowerCase()}_${ne}`),R=R.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),R=R.replace(/\bcrosses\s+below\b/gi,"crossesBelow"),Fi?(R=R.replace(/\bstr\./gi,""),R=e1(R,{pineV2:!0}).expr,R=t2(R),R.trim()):(R=R.replace(/\bta\./gi,""),R=R.replace(/\bmath\./gi,""),R=R.replace(/\bstr\./gi,""),R=yf(R),R=t2(R),R.trim())}function ws(S){const R=String(S||"");let X="",ae=null,ne=0;const Ee=dt=>/[A-Za-z_$]/.test(dt),je=dt=>/[A-Za-z0-9_$]/.test(dt);for(;ne<R.length;){const dt=R[ne];if(ae){X+=dt,dt===ae&&R[ne-1]!=="\\"&&(ae=null),ne+=1;continue}if(dt==="'"||dt==='"'){ae=dt,X+=dt,ne+=1;continue}if(Ee(dt)){let At=ne+1;for(;At<R.length&&je(R[At]);)At+=1;const Yt=R.slice(ne,At);let yn=At;for(;yn<R.length&&/\s/.test(R[yn]);)yn+=1;if(R[yn]==="["){let Wt=yn+1;for(;Wt<R.length&&/\s/.test(R[Wt]);)Wt+=1;let zn=1;R[Wt]==="-"&&(zn=-1,Wt+=1);let Pn=Wt;for(;Pn<R.length&&/[0-9]/.test(R[Pn]);)Pn+=1;const as=R.slice(Wt,Pn);for(;Pn<R.length&&/\s/.test(R[Pn]);)Pn+=1;if(as&&R[Pn]==="]"){const Cs=zn*Number(as);if(Number.isFinite(Cs)&&Cs>=1){X+=`prev(${Yt}, ${Math.floor(Cs)})`,ne=Pn+1;continue}if(Number.isFinite(Cs)&&Cs===0){X+=Yt,ne=Pn+1;continue}}}X+=Yt,ne=At;continue}X+=dt,ne+=1}return X}function Us(S){let R=String(S||"").replace(/\b(line|label|box|table)\.get_/gi,"$1_get_");return Fi?(R=R.replace(/\bstr\./g,""),e1(R,{pineV2:!0}).expr):(R=R.replace(/\bta\./g,"").replace(/\bmath\./g,"").replace(/\bstr\./g,"").replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2").replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(X,ae,ne)=>`${String(ae).toLowerCase()}_${ne}`),R=yf(R),ws(R))}function Dn(S){let R=String(S||"").replace(/\bta\./g,"").replace(/\bmath\./g,"").replace(/\bstr\./g,"").replace(/\b(line|label|box|table)\.get_/gi,"$1_get_").replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2").replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(X,ae,ne)=>`${String(ae).toLowerCase()}_${ne}`);return ws(R)}let ni=!1,mo=ge(!1),sr=ge(!1),or=ge(null),hl=!0,Oi=null,si=!1,Wo=0,Ua=null,Hi=ge(!1),to=null,Li=0;function Vr(){return Li+=1,Li}let ba=null,qi=null,Wr=null,Kl=null,Wl=null,Ic=null,Pc=null,cl=null,mr=!1,La=null;const Sl=()=>{o()&&(ba&&(clearTimeout(ba),ba=null),qi&&(cancelAnimationFrame(qi),qi=null),qi=requestAnimationFrame(()=>{qi=null,ul.requestKey("window-resize:stage1",()=>{if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const S=fp(s().theme);An.merge(S,p0(s().styles)),o().setStyles(Xd(S)),ho(),El(),kd()})}),ba=setTimeout(()=>{ba=null,ul.requestKey("window-resize:stage2",()=>{var X,ae,ne,Ee,je,dt,At,Yt,yn;if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const S=fp(s().theme);if(An.merge(S,p0(s().styles)),o().setStyles(Xd(S)),ho(),El(),kd(),Ym()){const Wt=o(),zn=((ae=(X=Wt.getSize)==null?void 0:X.call(Wt))==null?void 0:ae.height)??(Q==null?void 0:Q.clientHeight)??((ne=Q==null?void 0:Q.getBoundingClientRect)==null?void 0:ne.call(Q).height)??0,Pn=((je=(Ee=Wt.getSize)==null?void 0:Ee.call(Wt))==null?void 0:je.width)??(Q==null?void 0:Q.clientWidth)??((dt=Q==null?void 0:Q.getBoundingClientRect)==null?void 0:dt.call(Q).width)??0,as=Pn>0&&zn>0&&Pn>zn;if(Wr===null||Wr!==as){Wr=as;try{const Cs=(At=Wt.getPaneOptions)==null?void 0:At.call(Wt);if(Array.isArray(Cs)&&zn>0){const jn=Math.round(zn*(as?.3:.25));Cs.forEach(Xt=>{var Kn;const Tn=Xt==null?void 0:Xt.id;Tn&&(Tn==="candle_pane"||Tn==="x_axis_pane"||Xt!=null&&Xt.state&&Xt.state!=="normal"||(Kn=Wt.setPaneOptions)==null||Kn.call(Wt,{id:Tn,height:jn}))})}}catch{}}}const R=(yn=(Yt=o()).getVisibleRange)==null?void 0:yn.call(Yt);R&&typeof R.to=="number"&&setTimeout(()=>{o()&&o().scrollToDataIndex(R.to,0)},30)})},160))};function Ba(S){const R=(S==null?void 0:S.ticker)||(S==null?void 0:S.symbol);if(R)return`https://s3-api.bayah.app/cdn/symbol/logo/${R}.svg`}function vi(S){if(!S)return S;const R=Ba(S);return S.logo&&S.logo2?S:{...S,logo:S.logo||S.logo2||R,logo2:S.logo2}}const vc=p6(),ul=z2(),Ga=new m6("global-chart",Ie,s().theme||"dark");let vl=null,pu=null,tl=null;const Oa=$m(!1);P0("ctx",B()),P0("save",$()),P0("chart",Ie),P0("alerts",Dt),P0("datafeed",A),P0("renderIntegration",vc),P0("globalThemeManager",Ga),P0("drawingManager",{get:()=>vl}),P0("saveRestoring",Oa);function Oc(S){const R=S.match(/WIN\s*=\s*(\d+)/i),X=Math.max(2,Math.min(500,R&&parseInt(R[1],10)||5)),ae=S.match(/label\s+at\s+top\s+text:\s*\"?([^\"\n]+)\"?/i),ne=S.match(/label\s+at\s+bot\s+text:\s*\"?([^\"\n]+)\"?/i),Ee=S.match(/label\s+at\s+top.*color:\s*([#a-zA-Z0-9]+)/i),je=S.match(/label\s+at\s+bot.*color:\s*([#a-zA-Z0-9]+)/i),dt=((ae==null?void 0:ae[1])||"▲").trim(),At=((ne==null?void 0:ne[1])||"▼").trim(),Yt=((Ee==null?void 0:Ee[1])||"#f97316").trim(),yn=((je==null?void 0:je[1])||"#3b82f6").trim();if(!dt||!At)throw new Error("Script is missing label text for top/bot.");return{window:X,topText:dt,botText:At,topColor:Yt,botColor:yn}}function Gu(S,R){return{name:R,shortName:"Script",precision:4,zLevel:10,calcParams:[S.window],figures:[{key:"hi",title:`HI(${S.window})`,type:"line"},{key:"lo",title:`LO(${S.window})`,type:"line"}],styles:{lines:[{color:"rgba(0,0,0,0)",size:1e-4,style:wt.Solid},{color:"rgba(0,0,0,0)",size:1e-4,style:wt.Solid}]},shouldOhlc:!0,calc:(X,ae)=>{var dt;const ne=Math.max(2,Math.min(500,((dt=ae.calcParams)==null?void 0:dt[0])||S.window||5)),Ee=Math.max(2,Math.floor(ne/2)),je=[];for(let At=0;At<X.length;(At+=1)-1){const Yt=X[At].high??X[At].close,yn=X[At].low??X[At].close;let Wt,zn,Pn=!1,as=!1;if(At>=Ee&&At<=X.length-Ee-1){const Cs=At-Ee,Ks=At+Ee;let jn=-1/0,Xt=1/0;for(let ln=Cs;ln<=Ks;(ln+=1)-1){const ms=X[ln].high??X[ln].close,Ns=X[ln].low??X[ln].close;ms>jn&&(jn=ms),Ns<Xt&&(Xt=Ns)}Wt=jn,zn=Xt;const Tn=Math.max(1e-8,Math.abs(Yt||yn||1)*1e-4);let Kn=-1,os=-1;for(let ln=Cs;ln<=Ks;(ln+=1)-1){const ms=X[ln].high??X[ln].close,Ns=X[ln].low??X[ln].close;if(Kn===-1&&Math.abs(ms-jn)<=Tn&&(Kn=ln),os===-1&&Math.abs(Ns-Xt)<=Tn&&(os=ln),Kn!==-1&&os!==-1)break}Pn=Math.abs(Yt-jn)<=Tn&&At===Kn,as=Math.abs(yn-Xt)<=Tn&&At===os}je.push({hi:Wt,lo:zn,high:Yt,low:yn,topSignal:Pn,botSignal:as})}return je},draw:({ctx:X,indicator:ae,xAxis:ne,yAxis:Ee,bounding:je})=>{if(!X||!ne||!Ee)return!1;const dt=(ae==null?void 0:ae.result)||[];X.save(),je&&(X.beginPath(),X.rect(0,0,je.width,je.height),X.clip()),X.textAlign="center",X.textBaseline="middle",X.font='12px "Inter", "SF Pro", system-ui, -apple-system, sans-serif';for(let At=0;At<dt.length;(At+=1)-1){const Yt=dt[At];if(!Yt)continue;const yn=ne.convertToPixel(At);if(Yt.topSignal&&Yt.hi!==void 0){const Wt=Ee.convertToPixel(Yt.hi);if(Number.isFinite(Wt)){const zn=Wt-8;X.fillStyle=S.topColor,X.strokeStyle="rgba(0,0,0,0.35)",X.lineWidth=1,X.textBaseline="middle",X.fillText(S.topText,yn,zn),X.strokeText(S.topText,yn,zn),X.beginPath(),X.arc(yn,zn-8,3.5,0,Math.PI*2),X.fill(),X.stroke()}}if(Yt.botSignal&&Yt.lo!==void 0){const Wt=Ee.convertToPixel(Yt.lo);if(Number.isFinite(Wt)){const zn=Wt+8;X.fillStyle=S.botColor,X.strokeStyle="rgba(0,0,0,0.35)",X.lineWidth=1,X.textBaseline="middle",X.fillText(S.botText,yn,zn),X.strokeText(S.botText,yn,zn),X.beginPath(),X.arc(yn,zn+8,3.5,0,Math.PI*2),X.fill(),X.stroke()}}}return X.restore(),!0}}}function El(){if(!Q)return;const S=Q.getBoundingClientRect(),R=typeof window<"u"?Math.max(1,window.devicePixelRatio||1):1,X=Ee=>{if(!Ee)return;Ee.style.width=`${S.width}px`,Ee.style.height=`${S.height}px`,Ee.width=Math.floor(S.width*R),Ee.height=Math.floor(S.height*R);const je=Ee.getContext("2d");je&&je.setTransform(R,0,0,R,0,0)},ae=Ee=>{Ee&&(Ee.style.width=`${S.width}px`,Ee.style.height=`${S.height}px`,Ee.width=Math.floor(S.width*R),Ee.height=Math.floor(S.height*R))};X(le),X(fe),ae(ue),pe=le==null?void 0:le.getContext("2d"),$e=fe==null?void 0:fe.getContext("2d"),(nv("webglRuntimeDrawV1")||Pe)&&ue?(Z||(Z=yoe(ue)),!xe&&Z&&(xe=new Poe(Z)),!oe&&Z&&(oe=new Eoe(Z)),Z==null||Z.resize(S.width,S.height,R)):Z&&(Z.destroy(),Z=null,xe&&(xe.destroy(),xe=null),oe&&(oe.destroy(),oe=null))}const mu=()=>{if(Et||Mt){ut=[],bt=[];return}Pt||(Pt=!0,ul.request(()=>{if(Pt=!1,!Z){ut=[],bt=[];return}const S=ut,R=bt;ut=[],bt=[];const X=S.length>0,ae=R.length>0;if(!X&&!ae){xe==null||xe.clear(),oe==null||oe.clear();return}if(xe&&X?xe.render(S,{clear:!0}):xe&&xe.clear(),oe&&ae){const ne=!X;oe.render(R,{clear:ne})}}))},bc=()=>{Z&&(xe==null||xe.clear(),oe==null||oe.clear())},nl=S=>{const{runtimeHeatmaps:R,bounds:X,xAxis:ae,yAxis:ne,offsetX:Ee,offsetY:je,drawConfigMeta:dt,len:At,tsIndex:Yt,timeSeriesMs:yn,avgIntervalMs:Wt}=S;if(!R.length)return[];const zn=(jn,Xt,Tn)=>{var Kn,os,ln;return Hk({xVal:jn,xloc:Xt,len:At,timeSeriesMs:yn,tsIndex:Yt,config:{mode:((Kn=dt==null?void 0:dt.time)==null?void 0:Kn.mode)||"nearest",toleranceBars:Number.isFinite((os=dt==null?void 0:dt.time)==null?void 0:os.toleranceBars)?Math.max(0,Math.floor(dt.time.toleranceBars)):0,toleranceMs:Number.isFinite((ln=dt==null?void 0:dt.time)==null?void 0:ln.toleranceMs)?Math.max(0,Math.floor(dt.time.toleranceMs)):0,futureBars:Number.isFinite(dt==null?void 0:dt.futureBars)?Math.max(0,Math.floor(dt.futureBars)):0,avgIntervalMs:Wt,strictXloc:!1},meta:Tn})},Pn={background:0,main:1,overlay:2,ui:3},as=(()=>{const jn=Ns=>{var Gn;const cn=(Gn=ae==null?void 0:ae.convertToPixel)==null?void 0:Gn.call(ae,Ns);return Number.isFinite(cn)?Math.round(cn):0},Xt=Ns=>{var Gn;const cn=(Gn=ne==null?void 0:ne.convertToPixel)==null?void 0:Gn.call(ne,Ns);return Number.isFinite(cn)?Math.round(cn):0},Tn=jn(0),Kn=jn(Math.max(0,At-1)),os=At>1?jn(1)-jn(0):0,ln=Xt(0),ms=Xt(1);return`${Tn}:${Kn}:${os}:${ln}:${ms}:${Math.round(X.width)}:${Math.round(X.height)}`})(),Cs=R.map((jn,Xt)=>{const Tn=String((jn==null?void 0:jn.layer)||"main").toLowerCase(),Kn=Pn[Tn]??Pn.main,os=jn==null?void 0:jn.zIndex,ln=Number.isFinite(Number(os))?Number(os):0;return{hm:jn,idx:Xt,layer:Kn,zIndex:ln}}).sort((jn,Xt)=>jn.layer-Xt.layer||jn.zIndex-Xt.zIndex||jn.idx-Xt.idx),Ks=[];for(const jn of Cs){const Xt=jn.hm;if(!Xt)continue;const Tn=Array.isArray(Xt.points)?Xt.points:[];if(!Tn.length)continue;const Kn=Xt.xloc??"bar_index";if((Xt.yloc??"price")!=="price")continue;const ln=[];for(const Ns of Tn){const cn=Number(Ns==null?void 0:Ns.x),Gn=Number(Ns==null?void 0:Ns.y),ls=Number(Ns==null?void 0:Ns.value);if(!Number.isFinite(cn)||!Number.isFinite(Gn)||!Number.isFinite(ls))continue;const on=zn(cn,Kn,{kind:"heatmap",id:Xt.id??"heatmap"});if(on==null)continue;const an=ae.convertToPixel(on),wn=ne.convertToPixel(Gn);!Number.isFinite(an)||!Number.isFinite(wn)||ln.push({x:an+Ee,y:wn+je,value:ls})}if(!ln.length)continue;const ms=Xt.id??`heatmap_${jn.idx+1}`;Ks.push({id:ms,bounds:X,points:ln,opacity:Xt.opacity,colormap:Xt.colormap,blend:Xt.blend,xBinPx:Xt.xBinPx,yBinPx:Xt.yBinPx,minValue:Xt.minValue,maxValue:Xt.maxValue,agg:Xt.agg,version:Xt.version,viewKey:as})}return Ks},la=S=>{const{runtimeLineDefs:R,runtimeLineFills:X,runtimePolylineDefs:ae,runtimePolygonDefs:ne,runtimePathDefs:Ee,xAxis:je,yAxis:dt,offsetX:At,offsetY:Yt,fromIndex:yn,toIndex:Wt,len:zn}=S,Pn=[],as=(Xt,Tn)=>{const Kn=je.convertToPixel(Xt),os=dt.convertToPixel(Tn);return!Number.isFinite(Kn)||!Number.isFinite(os)?null:{x:Kn+At,y:os+Yt}},Cs=Xt=>{let Tn=NaN,Kn=NaN,os=NaN,ln=NaN;if(Xt.strictExtend){const ms=typeof dt.getRange=="function"?dt.getRange():null,Ns=xb({startIndex:Xt.startIndex,endIndex:Xt.endIndex,startValue:Xt.startValue,endValue:Xt.endValue,slope:Xt.slope,intercept:Xt.intercept,extend:Xt.extend,fromIndex:yn,toIndex:Wt,yRange:ms,toX:cn=>je.convertToPixel(cn),toY:cn=>dt.convertToPixel(cn)});if(!Ns)return null;Tn=Ns.extended.x1,Kn=Ns.extended.y1,os=Ns.extended.x2,ln=Ns.extended.y2}else{let ms=Xt.startIndex,Ns=Xt.endIndex;Xt.extend==="both"?(ms=0,Ns=Math.max(0,zn-1)):Xt.extend==="left"?ms=0:Xt.extend==="right"&&(Ns=Math.max(0,zn-1));const cn=Number.isFinite(Xt.slope)&&Number.isFinite(Xt.intercept)?Xt.slope*ms+Xt.intercept:Xt.startValue,Gn=Number.isFinite(Xt.slope)&&Number.isFinite(Xt.intercept)?Xt.slope*Ns+Xt.intercept:Xt.endValue;Tn=je.convertToPixel(ms),Kn=dt.convertToPixel(cn),os=je.convertToPixel(Ns),ln=dt.convertToPixel(Gn)}return!Number.isFinite(Tn)||!Number.isFinite(Kn)||!Number.isFinite(os)||!Number.isFinite(ln)?null:{a:{x:Tn+At,y:Kn+Yt},b:{x:os+At,y:ln+Yt}}};for(const Xt of R){if(!Xt)continue;const Tn=String(Xt.style||"solid").toLowerCase();if(Tn.includes("arrow"))continue;const Kn=Cs(Xt);Kn&&Pn.push({kind:"line",points:[Kn.a,Kn.b],color:Xt.color,width:Xt.width,style:Tn,opacity:Xt.opacity})}for(const Xt of ae){if(!(Xt!=null&&Xt.points)||Xt.points.length<2)continue;const Tn=Math.min(...Xt.points.map(ln=>ln.index));if(Math.max(...Xt.points.map(ln=>ln.index))<yn-2||Tn>Wt+2)continue;const os=[];for(const ln of Xt.points){const ms=as(ln.index,ln.value);ms&&os.push(ms)}os.length<2||Pn.push({kind:"polyline",points:os,color:Xt.color,width:Xt.width,style:Xt.style,opacity:Xt.opacity})}for(const Xt of ne){if(!(Xt!=null&&Xt.points)||Xt.points.length<3)continue;const Tn=Math.min(...Xt.points.map(ln=>ln.index));if(Math.max(...Xt.points.map(ln=>ln.index))<yn-2||Tn>Wt+2)continue;const os=[];for(const ln of Xt.points){const ms=as(ln.index,ln.value);ms&&os.push(ms)}os.length<3||Pn.push({kind:"polygon",points:os,fillColor:Xt.fillColor,strokeColor:Xt.strokeColor,strokeWidth:Xt.strokeWidth,strokeStyle:Xt.strokeStyle,opacity:Xt.opacity})}for(const Xt of Ee){if(!(Xt!=null&&Xt.commands)||!Xt.commands.length)continue;const Tn=[];for(const Kn of Xt.commands){const os=as(Kn.index,Kn.value);os&&(Kn.cmd==="M"||Kn.cmd==="L")&&Tn.push({cmd:Kn.cmd,x:os.x,y:os.y})}Tn.length&&Pn.push({kind:"path",commands:Tn,color:Xt.color,width:Xt.width,style:Xt.style,opacity:Xt.opacity})}const Ks=Xt=>{let Tn=Number(Xt==null?void 0:Xt.startIndex),Kn=Number(Xt==null?void 0:Xt.endIndex);if(!Number.isFinite(Tn)||!Number.isFinite(Kn))return null;if(Tn>Kn){const ln=Tn;Tn=Kn,Kn=ln}const os=String((Xt==null?void 0:Xt.extend)||"").toLowerCase();return os==="both"?(Tn=0,Kn=Math.max(0,zn-1)):os==="left"?Tn=0:os==="right"&&(Kn=Math.max(0,zn-1)),{a:Tn,b:Kn}},jn=(Xt,Tn)=>Number.isFinite(Xt==null?void 0:Xt.slope)&&Number.isFinite(Xt==null?void 0:Xt.intercept)?Xt.slope*Tn+Xt.intercept:Number.isFinite(Xt==null?void 0:Xt.startValue)?Xt.startValue:Number.NaN;for(const Xt of X){const Tn=Xt==null?void 0:Xt.line1,Kn=Xt==null?void 0:Xt.line2;if(!Tn||!Kn)continue;const os=Ks(Tn),ln=Ks(Kn);if(!os||!ln)continue;const ms=Math.max(yn,os.a,ln.a),Ns=Math.min(Wt,os.b,ln.b);if(ms>Ns)continue;const cn=[],Gn=[];for(let ls=ms;ls<=Ns;(ls+=1)-1){const on=jn(Tn,ls),an=jn(Kn,ls);if(!Number.isFinite(on)||!Number.isFinite(an))continue;const wn=as(ls,on),ds=as(ls,an);!wn||!ds||(cn.push(wn),Gn.push(ds))}if(cn.length>1&&Gn.length>1){const ls=cn.concat(Gn.reverse());Pn.push({kind:"polygon",points:ls,fillColor:Xt.color||"rgba(59,130,246,0.15)",opacity:Xt.opacity})}}return Pn},Mu=()=>{Z&&qe.length&&(Et||(Et=!0,requestAnimationFrame(()=>{var S,R,X,ae;Et=!1,Mt=!0;try{const ne=o();if(!ne)return;const Ee=(X=(S=ne.getXAxisPane)==null?void 0:(R=S.call(ne)).getAxisComponent)==null?void 0:X.call(R);if(!Ee)return;const je=Yu(),dt=[],At=[],Yt=!!(Z!=null&&Z.isWebgl&&oe);for(const yn of qe){const Wt=(ae=yn.def)==null?void 0:ae.__lastResult;if(!Wt)continue;const zn=Array.isArray(Wt)?Wt:Array.isArray(Wt==null?void 0:Wt.__rows)?Wt.__rows:[],Pn=Number.isFinite(Wt==null?void 0:Wt.__len)?Number(Wt.__len):zn.length,as=Array.isArray(Wt==null?void 0:Wt.__runtimeHeatmaps)?Wt.__runtimeHeatmaps:[],Cs=Array.isArray(Wt==null?void 0:Wt.__runtimeLineDefs)?Wt.__runtimeLineDefs:[],Ks=Array.isArray(Wt==null?void 0:Wt.__runtimeLineFills)?Wt.__runtimeLineFills:[],jn=Array.isArray(Wt==null?void 0:Wt.__runtimePolylineDefs)?Wt.__runtimePolylineDefs:[],Xt=Array.isArray(Wt==null?void 0:Wt.__runtimePolygonDefs)?Wt.__runtimePolygonDefs:[],Tn=Array.isArray(Wt==null?void 0:Wt.__runtimePathDefs)?Wt.__runtimePathDefs:[],Kn=as.length>0,os=Yt&&(Cs.length||Ks.length||jn.length||Xt.length||Tn.length);if(!Kn&&!os)continue;const ln=(Wt==null?void 0:Wt.__tsIndex)||{},ms=Array.isArray(Wt==null?void 0:Wt.__timeSeriesMs)?Wt.__timeSeriesMs:[];let Ns=0;if(ms.length>=2){let To=0;for(let gs=1;gs<ms.length;(gs+=1)-1)To+=Math.abs(ms[gs]-ms[gs-1]);Ns=To/(ms.length-1)}const cn=(Wt==null?void 0:Wt.__drawConfig)||{},Gn=yn.paneId??"candle_pane",ls=je[Gn]||je.candle_pane;if(!ls)continue;const on=zc(Gn),an=on==null?void 0:on.axis;if(!an)continue;const wn={left:ls.left,top:ls.top,width:ls.width,height:ls.height},ds=typeof Ee.getRange=="function"?Ee.getRange():{from:0,to:Pn?Pn-1:0},Wn=Pn?Pn-1:-1,yo=typeof(Wt==null?void 0:Wt.__virtualMaxIndex)=="number"?Math.max(Wn,Number(Wt.__virtualMaxIndex)):Wn,Si=yo>=0?Math.max(0,Math.floor(((ds==null?void 0:ds.from)??0)-2)):0,is=yo>=0?Math.min(yo,Math.ceil(((ds==null?void 0:ds.to)??yo)+2)):-1;if(Kn){const To=nl({runtimeHeatmaps:as,bounds:wn,xAxis:Ee,yAxis:an,offsetX:wn.left,offsetY:wn.top,drawConfigMeta:cn,len:Pn,tsIndex:ln,timeSeriesMs:ms,avgIntervalMs:Ns});To.length&&dt.push({bounds:wn,heatmaps:To})}if(os){const To=la({runtimeLineDefs:Cs,runtimeLineFills:Ks,runtimePolylineDefs:jn,runtimePolygonDefs:Xt,runtimePathDefs:Tn,bounds:wn,xAxis:Ee,yAxis:an,offsetX:wn.left,offsetY:wn.top,fromIndex:Si,toIndex:is,len:Pn});To.length&&At.push({bounds:wn,shapes:To})}}if(xe&&dt.length?xe.render(dt,{clear:!0}):xe&&xe.clear(),oe&&At.length){const yn=dt.length===0;oe.render(At,{clear:yn})}}finally{Mt=!1}})))};function Yu(){const S={},R=Q==null?void 0:Q.getBoundingClientRect(),X=(R==null?void 0:R.width)??((le==null?void 0:le.width)||0),ae=(R==null?void 0:R.height)??((le==null?void 0:le.height)||0),ne=new DOMRect(0,0,X,ae);return((Q==null?void 0:Q.querySelectorAll('[class*="dutycharts-pane"]'))||[]).forEach((je,dt)=>{var Wt;if((Wt=je.classList)!=null&&Wt.contains("dutycharts-pane-separator"))return;const Yt=je.getAttribute("data-pane-id")||je.getAttribute("data-id")||""||(dt===0?"candle_pane":`pane_index_${dt}`);if(!Yt)return;const yn=je.getBoundingClientRect();if(R){const zn=yn.left-R.left,Pn=yn.top-R.top;S[Yt]=new DOMRect(zn,Pn,yn.width,yn.height)}else S[Yt]=ne}),S.candle_pane||(S.candle_pane=ne),S}function zc(S){var Ee,je,dt,At,Yt,yn;if(!o())return null;const R=o(),X=((Ee=R.getDrawPaneById)==null?void 0:Ee.call(R,S))??((je=R._drawPanes)==null?void 0:je.find(Wt=>{var zn;return((zn=Wt==null?void 0:Wt.getId)==null?void 0:zn.call(Wt))===S}));if(!(X!=null&&X.getAxisComponent))return null;const ae=X.getAxisComponent(),ne=((Yt=(At=(dt=X.getMainWidget)==null?void 0:dt.call(X))==null?void 0:At.getBounding)==null?void 0:Yt.call(At))??((yn=X.getBounding)==null?void 0:yn.call(X));return ae?{axis:ae,bounding:ne}:null}function Zd(S){var At,Yt;const R=Ro.get(S);if(!R)return;const X=zc(S);if(!X)return;const{axis:ae}=X,ne=Math.min(R.min,R.max),Ee=Math.max(R.min,R.max),je=Math.max(1e-9,Ee-ne),dt={from:ne,to:Ee,range:je,realFrom:ne,realTo:Ee,realRange:je,displayFrom:ne,displayTo:Ee,displayRange:je};(At=ae.setRange)==null||At.call(ae,dt),(Yt=ae.buildTicks)==null||Yt.call(ae,!0)}function Yf(S){Ro.has(S)&&(zr.has(S)||(zr.add(S),ul.request(()=>{zr.delete(S),Zd(S)})))}const Kf=(S,R)=>{for(let X=S.length-1;X>=0;(X-=1)+1){const ne=(S[X]||{})[R];if(Number.isFinite(ne))return ne}return null},_d=(S,R,X,ae,ne)=>{if(!X||X.legend===!1)return;const Ee=X.plots||[],je=X.plotKeys||[];if(!Ee.length)return;const dt=[],At='12px "Inter", system-ui, -apple-system, sans-serif',Yt=14;for(let an=0;an<Ee.length;(an+=1)-1){const wn=Ee[an]||{},ds=String((wn==null?void 0:wn.display)||"").toLowerCase();if(ds.includes("none")||ds==="display.none"||String(wn.name||"").toLowerCase()==="__zero__"||wn.legend===!1)continue;const Wn=je[an];if(!Wn)continue;const yo=Kf(ae,Wn),Si=typeof wn.precision=="number"&&Number.isFinite(wn.precision)?Math.max(0,Math.min(10,Math.trunc(wn.precision))):4,is=yo==null?"-":So(yo,Si),gs=`${String(wn.name||Wn)} ${is}`,No=wn.color||"#94a3b8",jo=kb(gs,{font:At,color:"#e2e8f0",lineHeight:Yt,align:"left"});dt.push({text:gs,color:No,atlas:jo})}if(!dt.length)return;const yn=6,Wt=8,zn=6,Pn=_J(dt.map(an=>({width:an.atlas?an.atlas.width:0,height:an.atlas?an.atlas.height:Yt})),{pad:yn,swatch:Wt,gap:zn,lineHeight:Yt}),{boxW:as,boxH:Cs}=Pn,Ks=String((X==null?void 0:X.legendPosition)||"top_left").toLowerCase().replace(/\s+/g,"_"),jn=Number((X==null?void 0:X.legendOffsetX)??0),Xt=Number((X==null?void 0:X.legendOffsetY)??0),Tn=Number.isFinite(jn)?jn:0,Kn=Number.isFinite(Xt)?Xt:0,os=8,ln=Ks.includes("right"),ms=Ks.includes("bottom"),Ns=R.top<12?24:8,cn=ln?R.left+R.width-os-as+Tn:R.left+os+Tn,Gn=ms?R.top+R.height-os-Cs-Kn:R.top+Ns+Kn,ls=ms?Gn-ne:Gn+ne;S.save(),S.beginPath(),S.rect(R.left,R.top,R.width,R.height),S.clip(),S.fillStyle="rgba(15,23,42,0.78)",S.strokeStyle="rgba(148,163,184,0.35)",S.lineWidth=1,S.beginPath(),bf(S,cn,ls,as,Cs,6),S.fill(),S.stroke();let on=ls+yn;for(const an of dt){const wn=an.atlas,ds=wn?wn.height:Yt,Wn=Math.max(Yt,ds),yo=on+Wn/2-2;S.fillStyle=an.color,S.fillRect(cn+yn,yo,Wt,4),wn?S.drawImage(wn.canvas,Math.round(cn+yn+Wt+zn),Math.round(on),wn.width,wn.height):(S.font=At,S.fillStyle="#e2e8f0",S.textBaseline="top",S.textAlign="left",S.fillText(an.text,cn+yn+Wt+zn,on)),on+=Wn}return S.restore(),Cs+6},Rd=S=>{const R=pc((S==null?void 0:S.open)??(S==null?void 0:S.o)??(S==null?void 0:S.price)??(S==null?void 0:S.value)),X=pc((S==null?void 0:S.close)??(S==null?void 0:S.c)??(S==null?void 0:S.price)??(S==null?void 0:S.value));return!Or(R)||!Or(X)?null:(R+X)/2},fc=(S,R,X)=>{var Yt;const ae=typeof(S==null?void 0:S.getRange)=="function"?S.getRange():null,ne=(Yt=X==null?void 0:X.getVisibleRange)==null?void 0:Yt.call(X),Ee=Number.isFinite(ae==null?void 0:ae.from)?ae.from:Number.isFinite(ne==null?void 0:ne.from)?ne.from:0,je=Number.isFinite(ae==null?void 0:ae.to)?ae.to:Number.isFinite(ne==null?void 0:ne.to)?ne.to:Math.max(0,R-1),dt=Math.max(0,Math.floor(Ee)),At=Math.min(Math.max(0,R-1),Math.ceil(je));return{from:dt,to:At}},pp=(S,R,X,ae)=>{const ne=typeof(ae==null?void 0:ae.size)=="number"&&ae.size>0?ae.size:5,Ee=typeof(ae==null?void 0:ae.alpha)=="number"&&Number.isFinite(ae.alpha)?Math.max(0,Math.min(1,ae.alpha)):1,je=typeof(ae==null?void 0:ae.glow)=="number"&&ae.glow>=0?ae.glow:10;S.save(),S.globalAlpha=Ee,S.shadowColor="rgba(56,189,248,0.55)",S.shadowBlur=je,S.fillStyle="rgba(15,23,42,0.9)",S.strokeStyle="#38bdf8",S.lineWidth=2,S.beginPath(),S.arc(R,X,ne,0,Math.PI*2),S.fill(),S.stroke(),S.shadowBlur=0,S.fillStyle="#e2e8f0",S.beginPath(),S.arc(R,X,Math.max(1.4,ne*.32),0,Math.PI*2),S.fill(),S.restore()};function kd(){var Yt,yn,Wt,zn,Pn,as,Cs;if(!pe||!o())return;const S=pe;S.clearRect(0,0,le.width,le.height),S.save(),S.font='12px "Inter", system-ui, -apple-system, sans-serif',S.textAlign="center",S.textBaseline="middle";const R=o(),X=Yu(),ae=((Yt=R.getDataList)==null?void 0:Yt.call(R))||[],ne=(zn=(Wt=(yn=R.getXAxisPane)==null?void 0:yn.call(R))==null?void 0:Wt.getAxisComponent)==null?void 0:zn.call(Wt),Ee=new Set,je=[],dt={},At={};for(const Ks of qe){const{def:jn,paneId:Xt}=Ks,Tn=jn==null?void 0:jn.__lastResult,Kn=Array.isArray(Tn)?Tn:Array.isArray(Tn==null?void 0:Tn.__rows)?Tn.__rows:[];if(!Array.isArray(Kn)||Kn.length===0||!Tn)continue;const os=X[Xt]||X.candle_pane,ln={left:os.left,top:os.top,width:os.width,height:os.height},ms=Tn.__labelItems;if(Array.isArray(ms)){const ls=Tn.__tsIndex||{},on={},an={};for(const wn of ms){const ds=wn==null?void 0:wn.meta;if(!ds)continue;const Wn=ds==null?void 0:ds.value;if(typeof Wn!="number"||!Number.isFinite(Wn))continue;const yo=wn==null?void 0:wn.ts,Si=wn==null?void 0:wn.tsMs,is=(()=>{if(typeof(wn==null?void 0:wn.index)=="number")return wn.index;if(typeof yo=="number"&&Number.isFinite(yo)){const gi=ls[String(yo)];if(typeof gi=="number")return gi}if(typeof Si=="number"&&Number.isFinite(Si)){const gi=ls[`${Math.floor(Si)}_ms`]??ls[`${Math.floor(Si/1e3)}_s`];if(typeof gi=="number")return gi}})();if(typeof is!="number"||!Number.isFinite(is))continue;const To=(ds.position||"above")==="above",gs=typeof ds.size=="number"&&ds.size>0?ds.size:12,No=typeof ds.offsetY=="number"?ds.offsetY:10,jo=To?on[is]||0:an[is]||0,co=No+jo*Math.max(6,gs/3);To?on[is]=jo+1:an[is]=jo+1;const Vs=(ds==null?void 0:ds.tooltip)!=null?String(ds.tooltip):"";Vs&&je.push({kind:"label",paneId:Xt,ts:typeof yo=="number"?yo:void 0,index:is,value:Wn,tooltip:Vs,size:gs,isAbove:To,offsetPx:co})}}const Ns=Tn.__runtimeTables;if(Array.isArray(Ns))for(const ls of Ns)(Array.isArray(ls==null?void 0:ls.cells)?ls.cells:[]).some(wn=>wn==null?void 0:wn.tooltip)&&je.push({kind:"table",paneId:Xt,table:ls});const cn=foe(jn.name);if(Array.isArray(cn)&&cn.length)for(const ls of cn){const on=ls.index,an=ae[on],wn=(an==null?void 0:an.timestamp)??(an==null?void 0:an.time);if(!Number.isFinite(wn))continue;let ds,Wn="",yo=!0,Si="";ls.type==="entry_long"?(ds=(an==null?void 0:an.low)??(an==null?void 0:an.close),Wn="#16a34a",yo=!0,Si="BUY"):ls.type==="exit_long"?(ds=(an==null?void 0:an.high)??(an==null?void 0:an.close),Wn="#f59e0b",yo=!1,Si="EXIT"):ls.type==="entry_short"?(ds=(an==null?void 0:an.high)??(an==null?void 0:an.close),Wn="#ef4444",yo=!1,Si="SELL"):ls.type==="exit_short"&&(ds=(an==null?void 0:an.low)??(an==null?void 0:an.close),Wn="#f59e0b",yo=!0,Si="EXIT");const is=Array.isArray(jn==null?void 0:jn.figures)&&((Pn=jn.figures[0])!=null&&Pn.key)?String(jn.figures[0].key):"",To=Xt!=="candle_pane";let gs=ds;if(To&&is){const au=(Kn[on]||{})[is];au!=null&&Number.isFinite(au)&&(gs=au)}if(!Number.isFinite(gs))continue;const No=I2({id:on,t:wn,p:gs},{chart:o(),paneId:Xt});if(!No)continue;const jo=12;S.font=`600 ${jo}px "Inter", system-ui, -apple-system, sans-serif`;const co=Math.max(12,S.measureText(Si).width+18),Vs=Math.max(16,jo+8),gi=6,Hc=6,xc=ln.top+6,ac=ln.top+ln.height-6,tu=xc+gi+Vs,_c=ac-gi-Vs,qc=No.y;let jl=yo?qc-Hc:qc+Hc;jl=Math.max(tu,Math.min(_c,jl));const Bl=No.x-Math.floor(co/2),_u=yo?jl-gi-Vs:jl+gi,cd=Math.max(3,Math.floor(Vs/3)),ql=Wn||"#16a34a",jp="rgba(0,0,0,0.35)",Uc="#f8fafc";S.save(),S.lineWidth=1,S.fillStyle=ql,S.strokeStyle=jp,S.shadowColor="rgba(0,0,0,0.25)",S.shadowBlur=6,w(S,Bl,_u,co,Vs,cd),S.fill(),S.stroke(),S.shadowBlur=0,S.beginPath(),yo?(S.moveTo(No.x-gi,_u+Vs),S.lineTo(No.x+gi,_u+Vs),S.lineTo(No.x,jl)):(S.moveTo(No.x-gi,_u),S.lineTo(No.x+gi,_u),S.lineTo(No.x,jl)),S.closePath(),S.fill(),S.stroke(),Si&&(S.fillStyle=Uc,S.textAlign="center",S.textBaseline="middle",S.fillText(Si,No.x,_u+Vs/2)),S.restore()}const Gn=jn==null?void 0:jn.__plotMeta;if(Gn&&os){const ls=Xt||"candle_pane",an=String((Gn==null?void 0:Gn.legendPosition)||"top_left").toLowerCase().replace(/\s+/g,"_").includes("bottom");ls in At||(At[ls]=Xu(o(),ls));const wn=dt[ls]||0,ds=an?0:At[ls]||0,Wn=wn+ds,yo=_d(S,os,Gn,Kn,Wn);typeof yo=="number"&&Number.isFinite(yo)&&(dt[ls]=(dt[ls]||0)+yo)}}if(i(iu)&&ne){const Ks=i(iu).paneId,jn=X[Ks]||X.candle_pane;if(jn&&!Ee.has(Ks)){const Xt=zc(Ks),Tn=Xt==null?void 0:Xt.axis,Kn=fc(ne,ae.length,R),os=Math.max(0,Kn.to-Kn.from+1);let ln=Math.max(1,Math.floor(us));os/ln>ko&&(ln=Math.max(1,Math.ceil(os/ko)));let ms=null;if(i(iu).kind==="indicator"){const on=((as=R.getIndicators)==null?void 0:as.call(R,{paneId:Ks}))||((Cs=R.getIndicators)==null?void 0:Cs.call(R))||[];ms=on.find(an=>(an==null?void 0:an.id)===i(iu).indicatorId)||on.find(an=>(an==null?void 0:an.name)===i(iu).indicatorName)||null}let Ns=[];const cn=ms&&Wf(ms),Gn=jn?Ui(jn):null,ls=cn&&ms?om(ms,ae,Kn.from,Kn.to):0;if(ms&&xd(ms)&&(Ns=gv(Array.isArray(ms==null?void 0:ms.result)?ms.result:[],Kn.from,Kn.to)),Tn&&os>0){S.save(),S.beginPath(),S.rect(jn.left,jn.top,jn.width,jn.height),S.clip();for(let on=Kn.from;on<=Kn.to;on+=ln){let an=null;if(i(iu).kind==="candle")Ks==="candle_pane"&&(an=Rd(ae[on]));else if(i(iu).kind==="indicator"&&i(iu).plotKey&&ms){const yo=ff(ms,on,ae);yo&&(an=pc(yo[i(iu).plotKey])),!Or(an)&&i(iu).plotKey==="zigzag"&&Ns.length&&(an=Nv(Ns,on))}if(!Or(an))continue;const wn=ne.convertToPixel(on);let ds=Tn.convertToPixel(an)+jn.top;if(cn&&Gn&&ls>0&&i(iu).plotKey==="volume"){const yo=Math.min(1,an/ls),Si=Math.max(1,Math.floor(yo*Gn.effectiveBandHeight));ds=jn.top+Gn.bandBottom-Si}if(!Or(wn)||!Or(ds))continue;const Wn=on===i(iu).barIndex;pp(S,wn,ds,{size:Wn?5:3,alpha:Wn?1:.75,glow:Wn?10:6})}S.restore(),Ee.add(Ks)}}}ze=je,$l(),pe==null||pe.restore()}function Wd(){!$e||!fe||$e.clearRect(0,0,fe.width,fe.height)}function $l(){Ke!=null&&cancelAnimationFrame(Ke),Ke=requestAnimationFrame(()=>{Ke=null,Hd()})}const Nu=(S,R)=>!(S.x+S.width<R.x||R.x+R.width<S.x||S.y+S.height<R.y||R.y+R.height<S.y),Ku=S=>{if((S==null?void 0:S.avoidOverlap)===!0||(S==null?void 0:S.avoid_overlap)===!0)return!0;const R=String((S==null?void 0:S.collision)||"").toLowerCase();return R==="avoid"||R==="hide"},bf=(S,R,X,ae,ne,Ee)=>{const je=Math.max(0,Math.min(Ee,Math.min(ae,ne)/2));S.beginPath(),S.moveTo(R+je,X),S.lineTo(R+ae-je,X),S.quadraticCurveTo(R+ae,X,R+ae,X+je),S.lineTo(R+ae,X+ne-je),S.quadraticCurveTo(R+ae,X+ne,R+ae-je,X+ne),S.lineTo(R+je,X+ne),S.quadraticCurveTo(R,X+ne,R,X+ne-je),S.lineTo(R,X+je),S.quadraticCurveTo(R,X,R+je,X),S.closePath()},Xu=(S,R)=>{var cn,Gn,ls,on,an;if(!S)return 0;const X=(cn=S.getChartStore)==null?void 0:cn.call(S),ae=((Gn=X==null?void 0:X.getStyles)==null?void 0:Gn.call(X))||{},ne=((ls=ae==null?void 0:ae.candle)==null?void 0:ls.tooltip)||{},Ee=((on=ae==null?void 0:ae.indicator)==null?void 0:on.tooltip)||{},je=(wn,ds)=>{const Wn=Number.isFinite(wn==null?void 0:wn.size)?Number(wn.size):ds,yo=Number.isFinite(wn==null?void 0:wn.marginTop)?Number(wn.marginTop):0,Si=Number.isFinite(wn==null?void 0:wn.marginBottom)?Number(wn.marginBottom):0;return Wn+yo+Si},dt=(wn,ds)=>{if((wn==null?void 0:wn.show)===!1)return 0;const Wn=Number.isFinite(wn==null?void 0:wn.size)?Number(wn.size):ds,yo=Number.isFinite(wn==null?void 0:wn.marginTop)?Number(wn.marginTop):0,Si=Number.isFinite(wn==null?void 0:wn.marginBottom)?Number(wn.marginBottom):0;return Wn+yo+Si},At=(ne==null?void 0:ne.legend)||{},Yt=je(At,12),yn=dt(ne==null?void 0:ne.title,14);let Wt=0;const zn=At==null?void 0:At.template;Array.isArray(zn)?Wt=zn.length:Array.isArray(At==null?void 0:At.labels)?Wt=At.labels.length:Wt=5;let Pn=yn+Yt*Math.max(0,Wt);const as=(Ee==null?void 0:Ee.legend)||{},Cs=je(as,12),Ks=dt(Ee==null?void 0:Ee.title,12),jn=Array.isArray((an=S.getIndicators)==null?void 0:an.call(S,{paneId:R}))?S.getIndicators({paneId:R}):[];let Xt=0;for(const wn of jn){if((wn==null?void 0:wn.visible)===!1)continue;const ds=Array.isArray(wn==null?void 0:wn.figures)?wn.figures.length:1,Wn=Math.max(1,ds);Xt+=Wn,Pn+=Ks}Pn+=Cs*Xt;const Tn=(ne==null?void 0:ne.rect)||{},Kn=Number.isFinite(Tn==null?void 0:Tn.paddingTop)?Number(Tn.paddingTop):4,os=Number.isFinite(Tn==null?void 0:Tn.paddingBottom)?Number(Tn.paddingBottom):4,ln=Number.isFinite(Tn==null?void 0:Tn.offsetTop)?Number(Tn.offsetTop):4,ms=Number.isFinite(Tn==null?void 0:Tn.offsetBottom)?Number(Tn.offsetBottom):4,Ns=Number.isFinite(Tn==null?void 0:Tn.borderSize)?Number(Tn.borderSize):1;return Pn+=Kn+os+ln+ms+Ns*2,Math.max(0,Math.ceil(Pn+6))};function Ql(S,R,X,ae,ne,Ee){if(!R)return;const je=260,dt=10,At=8,Yt=16;S.save(),S.font='12px "Inter", system-ui, -apple-system, sans-serif';const yn=kb(R,{font:S.font,color:"#e2e8f0",maxWidth:je-dt*2,wrap:!0,lineHeight:Yt,align:"left"}),Wt=yn?yn.width:S.measureText(R).width,zn=yn?yn.height:Yt,Pn=Math.min(je,Math.max(60,Wt+dt*2)),as=Math.max(Yt+At*2,zn+At*2),Cs=8,Ks=12,jn=[{x:X+Ks,y:ae+Ks},{x:X-Pn-Ks,y:ae+Ks},{x:X+Ks,y:ae-as-Ks},{x:X-Pn-Ks,y:ae-as-Ks}];let Xt=jn[0],Tn=Number.POSITIVE_INFINITY;for(const cn of jn){const Gn=Math.max(0,Cs-cn.x),ls=Math.max(0,cn.x+Pn-(ne-Cs)),on=Math.max(0,Cs-cn.y),an=Math.max(0,cn.y+as-(Ee-Cs)),wn=Gn+ls+on+an;wn<Tn&&(Tn=wn,Xt=cn)}let Kn=Xt.x,os=Xt.y;Kn=Math.max(Cs,Math.min(ne-Pn-Cs,Kn)),os=Math.max(Cs,Math.min(Ee-as-Cs,os));const ln=8;S.fillStyle="rgba(15,23,42,0.92)",S.strokeStyle="rgba(148,163,184,0.35)",S.lineWidth=1,S.beginPath(),S.moveTo(Kn+ln,os),S.lineTo(Kn+Pn-ln,os),S.quadraticCurveTo(Kn+Pn,os,Kn+Pn,os+ln),S.lineTo(Kn+Pn,os+as-ln),S.quadraticCurveTo(Kn+Pn,os+as,Kn+Pn-ln,os+as),S.lineTo(Kn+ln,os+as),S.quadraticCurveTo(Kn,os+as,Kn,os+as-ln),S.lineTo(Kn,os+ln),S.quadraticCurveTo(Kn,os,Kn+ln,os),S.closePath(),S.fill(),S.stroke(),S.fillStyle="#e2e8f0",S.textAlign="left",S.textBaseline="top";const ms=Kn+dt,Ns=os+At;yn?S.drawImage(yn.canvas,Math.round(ms),Math.round(Ns),yn.width,yn.height):S.fillText(R,ms,Ns),S.restore()}function Hd(){var Yt,yn,Wt,zn;if(!$e||!fe||!Q)return;if($e.clearRect(0,0,fe.width,fe.height),!ze.length){try{kd()}catch{}if(!ze.length)return}const S=o();if(!S)return;const R=Q.getBoundingClientRect(),X=Yu();let ae=i(av),ne=i(jm);const Ee=(Wt=(Yt=S.getChartStore)==null?void 0:(yn=Yt.call(S)).getCrosshair)==null?void 0:Wt.call(yn);if(Ee&&(Number.isFinite(Ee.realX)||Number.isFinite(Ee.x))){const Pn=Ee.paneId||"candle_pane",as=X[Pn]||X.candle_pane,Cs=typeof Ee.realX=="number"?Ee.realX:Ee.x;if(typeof Cs=="number"&&Number.isFinite(Cs)&&(ae=Cs),typeof Ee.y=="number"&&Number.isFinite(Ee.y)){const Ks=(as==null?void 0:as.top)??0;ne=Ee.y+Ks}}if(ae==null||ne==null||ae<0||ne<0||ae>R.width||ne>R.height)return;const je=((zn=S.getDataList)==null?void 0:zn.call(S))||[];let dt=null;for(const Pn of ze){if(Pn.kind!=="table")continue;const as=X[Pn.paneId]||X.candle_pane;if(!as)continue;const Cs=ae-as.left,Ks=ne-as.top,jn=Pn.table;if(!jn||Cs<0||Ks<0)continue;const Xt=Math.max(1,Math.floor(Number(jn.columns??1))),Tn=Math.max(1,Math.floor(Number(jn.rows??1))),Kn=typeof jn.textSize=="number"&&jn.textSize>0?jn.textSize:12,os=8,ln=new Array(Xt).fill(0),ms=new Array(Tn).fill(Math.max(20,Kn+8)),Ns=Array.isArray(jn.cells)?jn.cells:[],cn=new Map;for(const gs of Ns){const No=Math.max(0,Math.min(Xt-1,gs.column)),jo=Math.max(0,Math.min(Tn-1,gs.row));cn.set(`${No}:${jo}`,gs)}const Gn=Array.isArray(jn.merges)?jn.merges:[],ls=new Map,on=new Map;for(const gs of Gn){if(!gs)continue;let No=Math.max(0,Math.min(Xt-1,Math.floor(Number(gs.left)))),jo=Math.max(0,Math.min(Xt-1,Math.floor(Number(gs.right)))),co=Math.max(0,Math.min(Tn-1,Math.floor(Number(gs.top)))),Vs=Math.max(0,Math.min(Tn-1,Math.floor(Number(gs.bottom))));if(!Number.isFinite(No)||!Number.isFinite(jo)||!Number.isFinite(co)||!Number.isFinite(Vs))continue;No>jo&&([No,jo]=[jo,No]),co>Vs&&([co,Vs]=[Vs,co]);const gi=`${No}:${co}:${jo}:${Vs}`;on.has(gi)||on.set(gi,{left:No,top:co,right:jo,bottom:Vs,minW:0,minH:0});for(let Hc=No;Hc<=jo;(Hc+=1)-1)for(let xc=co;xc<=Vs;(xc+=1)-1)ls.set(`${Hc}:${xc}`,{left:No,top:co,right:jo,bottom:Vs})}for(const gs of Ns){const No=Math.max(0,Math.min(Xt-1,gs.column)),jo=Math.max(0,Math.min(Tn-1,gs.row)),co=ls.get(`${No}:${jo}`);if(co&&(co.left!==No||co.top!==jo))continue;const Vs=gs.text||"",gi=typeof gs.textSize=="number"&&gs.textSize>0?gs.textSize:Kn;$e.font=`${gi}px "Inter", system-ui, -apple-system, sans-serif`;const Hc=$e.measureText(Vs).width+os*2,xc=typeof gs.width=="number"&&gs.width>0?gs.width:0,ac=typeof gs.height=="number"&&gs.height>0?gs.height:Math.max(20,gi+8);if(co){const tu=`${co.left}:${co.top}:${co.right}:${co.bottom}`,_c=on.get(tu);_c&&(_c.minW=Math.max(_c.minW,Hc,xc),_c.minH=Math.max(_c.minH,ac))}else ln[No]=Math.max(ln[No],Hc,xc),ms[jo]=Math.max(ms[jo],ac)}for(let gs=0;gs<Xt;(gs+=1)-1)ln[gs]<60&&(ln[gs]=60);for(const gs of on.values()){let No=0;for(let co=gs.left;co<=gs.right;(co+=1)-1)No+=ln[co]||0;No<gs.minW&&(ln[gs.right]=(ln[gs.right]||0)+(gs.minW-No));let jo=0;for(let co=gs.top;co<=gs.bottom;(co+=1)-1)jo+=ms[co]||0;jo<gs.minH&&(ms[gs.bottom]=(ms[gs.bottom]||0)+(gs.minH-jo))}const an=ln.reduce((gs,No)=>gs+No,0),wn=ms.reduce((gs,No)=>gs+No,0),ds=String(jn.position||"top_right").toLowerCase();let Wn=os,yo=os;const Si=as.width,is=as.height;if(ds.includes("top_right")?(Wn=Si-an-os,yo=os):ds.includes("bottom_left")?(Wn=os,yo=is-wn-os):ds.includes("bottom_right")?(Wn=Si-an-os,yo=is-wn-os):ds.includes("top_center")?(Wn=(Si-an)/2,yo=os):ds.includes("bottom_center")?(Wn=(Si-an)/2,yo=is-wn-os):(ds.includes("middle_center")||ds.includes("center"))&&(Wn=(Si-an)/2,yo=(is-wn)/2),Cs<Wn||Ks<yo||Cs>Wn+an||Ks>yo+wn)continue;let To=Wn;for(let gs=0;gs<Xt;(gs+=1)-1){let No=yo;for(let jo=0;jo<Tn;(jo+=1)-1){const co=ln[gs],Vs=ms[jo],gi=ls.get(`${gs}:${jo}`);if(gi&&(gi.left!==gs||gi.top!==jo)){No+=Vs;continue}const Hc=gi?(()=>{let tu=0;for(let _c=gi.left;_c<=gi.right;(_c+=1)-1)tu+=ln[_c]||0;return tu})():co,xc=gi?(()=>{let tu=0;for(let _c=gi.top;_c<=gi.bottom;(_c+=1)-1)tu+=ms[_c]||0;return tu})():Vs,ac=cn.get(`${gs}:${jo}`);if(ac!=null&&ac.tooltip&&Cs>=To&&Cs<=To+Hc&&Ks>=No&&Ks<=No+xc){dt={text:String(ac.tooltip),x:as.left+To+Hc/2,y:as.top+No+xc/2};break}No+=Vs}if(dt)break;To+=ln[gs]}if(dt)break}if(dt){Ql($e,dt.text,dt.x,dt.y,R.width,R.height);return}let At=null;for(const Pn of ze){if(Pn.kind!=="label")continue;const as=typeof Pn.ts=="number"?Pn.ts:typeof Pn.index=="number"?(()=>{const Gn=je[Pn.index];return(Gn==null?void 0:Gn.timestamp)??(Gn==null?void 0:Gn.time)??(Gn==null?void 0:Gn.t)})():void 0;if(typeof as!="number"||!Number.isFinite(as))continue;const Cs=as<1e12?as*1e3:as,Ks=I2({t:Cs,p:Pn.value},{chart:S,paneId:Pn.paneId});if(!Ks)continue;let jn=Ks.y;const Xt=typeof Pn.offsetPx=="number"?Pn.offsetPx:10;Pn.isAbove!==!1?jn-=Xt:jn+=Xt;const Kn=X[Pn.paneId]||X.candle_pane,os=typeof Pn.size=="number"&&Pn.size>0?Pn.size/2:6;if(Kn){const Gn=Kn.top+os+2,ls=Kn.top+Kn.height-os-2;jn=Math.max(Gn,Math.min(ls,jn))}const ln=ae-Ks.x,ms=ne-jn,Ns=Math.hypot(ln,ms),cn=Math.max(14,os+10);Ns<=cn&&(!At||Ns<At.dist)&&(At={text:Pn.tooltip,x:Ks.x,y:jn,dist:Ns})}At&&Ql($e,At.text,At.x,At.y,R.width,R.height)}function hu(S){if(!S)return{r:0,g:0,b:0};const R=S.trim();if(R.startsWith("#")&&(R.length===7||R.length===4)){const ae=R.length===4?`#${R[1]}${R[1]}${R[2]}${R[2]}${R[3]}${R[3]}`:R,ne=parseInt(ae.slice(1,3),16),Ee=parseInt(ae.slice(3,5),16),je=parseInt(ae.slice(5,7),16);return{r:ne,g:Ee,b:je}}const X=S.match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);return X?{r:+X[1],g:+X[2],b:+X[3]}:{r:0,g:0,b:0}}function Jc(S){const R=[S.r,S.g,S.b].map(X=>X/255).map(X=>X<=.03928?X/12.92:Math.pow((X+.055)/1.055,2.4));return .2126*R[0]+.7152*R[1]+.0722*R[2]}function Au(S,R){const X=Jc(hu(S)),ae=Jc(hu(R)),ne=Math.max(X,ae),Ee=Math.min(X,ae);return(ne+.05)/(Ee+.05)}function jd(S){const R="#111111",X="#FFFFFF";return Au(X,S)>=Au(R,S)?X:R}const Wu=48,sf=80,ad=6,yd=4,Bd=(S,R)=>{const X=String(S??"").replace(/\s*\n\s*/g," ");return X.length<=R?X:R<=1?"…":`${X.slice(0,Math.max(0,R-1))}…`},Mc=S=>{if(!Number.isFinite(S))return;const R=Math.round(Number(S));return Math.max(8,Math.min(32,R))},Tu=S=>{if(!Number.isFinite(S))return;const R=Math.round(Number(S));return Math.max(0,Math.min(4,R))},qd=S=>{var Yt;if(!S)return S;const R=String(S).trim(),X=R.match(/^rgba?\(([^)]+)\)$/i);if(!X)return R;const ae=((Yt=X[1])==null?void 0:Yt.split(",").map(yn=>yn.trim()))??[];if(ae.length<3)return R;const ne=Number(ae[0]),Ee=Number(ae[1]),je=Number(ae[2]);if(!Number.isFinite(ne)||!Number.isFinite(Ee)||!Number.isFinite(je))return R;if(ae.length<4)return`rgb(${Math.round(ne)}, ${Math.round(Ee)}, ${Math.round(je)})`;const dt=Number(ae[3]),At=Number.isFinite(dt)?Math.max(0,Math.min(1,dt)):1;return`rgba(${Math.round(ne)}, ${Math.round(Ee)}, ${Math.round(je)}, ${At})`},Xf=S=>{var Ee;const X=String(S||"").trim().match(/^rgba\(([^)]+)\)$/i);if(!X)return null;const ae=((Ee=X[1])==null?void 0:Ee.split(",").map(je=>je.trim()))??[];if(ae.length<4)return null;const ne=Number(ae[3]);return Number.isFinite(ne)?Math.max(0,Math.min(1,ne)):null},Vf=S=>{const R=hu(S),X=Xf(S)??1,ae=Ee=>Math.max(0,Math.min(255,Math.round(Ee*.75))),ne=Math.max(0,Math.min(1,X+.15));return`rgba(${ae(R.r)}, ${ae(R.g)}, ${ae(R.b)}, ${ne})`},se=S=>{const R=S.bgColor?qd(String(S.bgColor)):void 0,X=S.borderColor?qd(String(S.borderColor)):void 0;let ae=Tu(typeof S.borderWidth=="number"?S.borderWidth:void 0);ae==null&&(ae=X?1:0);let ne=X;!ne&&ae>0&&R&&(ne=Vf(R)),!ne&&!X&&(ae=0);const Ee=String(S.borderStyle||"solid").toLowerCase(),je=ae>0?Uk(Ee,ae):[],dt=0,At=Bd(S.text??"",Wu),Yt=Bd(S.tooltip??"",sf),yn=S.textColor?qd(String(S.textColor)):void 0,Wt=Mc(S.textSize)??12,zn=S.textHalign==="left"||S.textHalign==="right"?S.textHalign:"center",Pn=S.textValign==="top"||S.textValign==="bottom"?S.textValign:"middle";return{bgColor:R,borderColor:ne,borderWidth:ae,borderStyle:Ee,dash:je,dashOffset:dt,textFinal:At,tooltipFinal:Yt,textColor:yn,fontPx:Wt,textHalign:zn,textValign:Pn,padX:ad,padY:yd}};function be(S,R){let X=S.replace(/\s+/g,"_").toLowerCase().replace(/[^a-z0-9_]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||"plot",ae=1;for(;R.has(X);)X=`${X}_${ae}`,ae+=1;return R.add(X),X}function G(S){if(S){try{uc.forEach(R=>{moe(R),s3(R)})}catch{}Cu.forEach(R=>{try{S.removeIndicator({id:R})}catch{}}),Cu=[],uc.forEach(R=>{try{S.removeIndicator({paneId:"candle_pane",name:R})}catch{}try{S.removeIndicator({paneId:"pane_script",name:R})}catch{}try{S.removeIndicator({paneId:"script_pane",name:R})}catch{}}),uc=[],qe=[];try{bc()}catch{}Ro.forEach((R,X)=>{var ne,Ee,je;const ae=zc(X);(ne=ae==null?void 0:ae.axis)!=null&&ne.setAutoCalcTickFlag&&(ae.axis.setAutoCalcTickFlag(!0),(je=(Ee=ae.axis).buildTicks)==null||je.call(Ee,!0))}),Ro.clear(),zr.clear(),x(Fl,null)}}const re={limits:{line:240,linefill:120,label:300,box:180,table:20,polyline:180,polygon:160,path:160},pruningPolicy:"fifo",futureBars:200,time:{mode:"nearest",toleranceBars:2,toleranceMs:6e4},decimationPx:2},we=500,J=200,Fe={labels:we,lines:500,boxes:J,runtimeDraws:1e3},yt={maxPx:0,offsetPx:0,lastAppliedTs:0},vt=new Map,jt=new Map;function ye(S){if(!Array.isArray(S)||S.length===0)return null;let R=0,X=0;S.forEach(ne=>{if(typeof ne=="string"){X+=1;return}String((ne==null?void 0:ne.level)||"").toLowerCase()==="error"?R+=1:X+=1});const ae=R+X;return ae?R&&X?`issues: ${ae} (${R} error${R===1?"":"s"})`:R?`errors: ${R}`:`warnings: ${X}`:null}function E(S,R){const X=[],ae=new Set,ne=Ee=>{if(!Ee)return;const je=String((Ee==null?void 0:Ee.level)||"warning").toLowerCase(),dt=String((Ee==null?void 0:Ee.message)||Ee||"").trim();if(!dt)return;const At=`${je}:${dt}`;ae.has(At)||(ae.add(At),typeof Ee=="string"?X.push({level:"warning",message:dt}):X.push(Ee))};return(S||[]).forEach(ne),(R||[]).forEach(ne),X}function me(S){if(S==null)return!1;const R=String(S).trim().toLowerCase();if(!R)return!1;if(R==="transparent"||R==="none")return!0;const X=R.match(/rgba?\(([^)]+)\)/);if(X){const ne=X[1].split(",").map(Ee=>Ee.trim());if(ne.length>=4){const Ee=Number(ne[3]);return Number.isFinite(Ee)&&Ee<=0}return!1}const ae=R.match(/hsla?\(([^)]+)\)/);if(ae){const ne=ae[1].split(",").map(Ee=>Ee.trim());if(ne.length>=4){const Ee=Number(ne[3]);return Number.isFinite(Ee)&&Ee<=0}return!1}if(R.startsWith("#")){const ne=R.slice(1);if(ne.length===4)return ne[3]==="0";if(ne.length===8)return ne.slice(6)==="00"}return!1}function Se(S){if(!S||typeof S!="object")return!1;const R=S.gradient||S.upGradient||S.downGradient;if(R){const ne=R==null?void 0:R.from,Ee=R==null?void 0:R.to;return ne!=null||Ee!=null?!me(ne)||!me(Ee):!0}const X=[S.color,S.downColor,S.wickColor,S.borderColor];return X.some(ne=>ne!=null)?X.some(ne=>ne!=null&&!me(ne)):!0}async function Ve(S,R="auto"){var Qd,xp,Qm,Oh,Pp,pv,Mg,Ng,Ag,pg,Mm,mg,Tg,kv,eh,nr,Hr,nu,Sd,Rf,Ud;const X=o();if(!X)throw new Error("Chart not ready yet. Please try again in a moment.");Ia=new Set,R!=="js"&&x(qs,V([]));const ae=String(R||"script").trim().toLowerCase(),ne=R==="pine",Ee=new Map,je=ne?{emitOnce:($t,Gs)=>{const Zo=String($t||Gs||"").trim(),Bo=String(Gs||$t||"").trim();!Zo||!Bo||Ee.has(Zo)||Ee.set(Zo,Bo)}}:void 0,dt=($t,Gs)=>{if(!ne)return;const Zo=`Limit exceeded: ${$t} (max ${Gs})`;Ia.add(Zo)};ne&&((!S.params||typeof S.params!="object")&&(S.params={}),S.params.__pinev2=1),Fi=((Qd=S.params)==null?void 0:Qd.__pinev2)===1;const At=R==="json",Yt=Array.isArray(S.calc)?S.calc:[],yn=Array.isArray(S.series)?S.series:[],Wt=Array.isArray(S.stateSeries)?S.stateSeries:[],zn=$t=>String($t||"").replace(/\s+/g,"_").toLowerCase(),Pn=($t,Gs)=>{const Zo=new Set,Bo=yf($t),ka=/[A-Za-z_$][A-Za-z0-9_$]*/g;let Ru;for(;Ru=ka.exec(Bo);){const Vo=zn(Ru[0]||"");Gs.has(Vo)&&Zo.add(Vo)}return Zo},as=$t=>{const Gs=[],Zo=[],Bo=[],ka=new Map;$t.forEach((Ya,Zl)=>{const oi=zn(String((Ya==null?void 0:Ya.name)||`series_${Zl}`));Bo[Zl]=oi,ka.set(oi,String((Ya==null?void 0:Ya.expr)??""))});const Ru=new Set(ka.keys()),Vo=new Set;ka.forEach((Ya,Zl)=>{/\b__arr_/i.test(Ya)&&Vo.add(Zl)});let il=!0;for(;il;)il=!1,ka.forEach((Ya,Zl)=>{if(Vo.has(Zl))return;const oi=Pn(Ya,Ru);for(const Ys of oi)if(Vo.has(Ys)){Vo.add(Zl),il=!0;break}});return $t.forEach((Ya,Zl)=>{const oi=Bo[Zl]||"";Vo.has(oi)?Zo.push(Ya):Gs.push(Ya)}),{primary:Gs,arrayDependent:Zo}},{primary:Cs,arrayDependent:Ks}=as(yn),jn=[],Xt=Array.isArray(S.signals)?S.signals:[];if(Array.isArray(S.panes))for(const $t of S.panes){const Gs=$t.pane==="sub"?"sub":"main";jn.push({pane:Gs,plots:Array.isArray($t.plots)?$t.plots:[],levels:Array.isArray($t.levels)?$t.levels:[],labels:Array.isArray($t.labels)?$t.labels:[],lines:Array.isArray($t.lines)?$t.lines:[],runtimeDrawOps:Array.isArray($t.runtimeDrawOps)?$t.runtimeDrawOps:[],runtimeLabels:Array.isArray($t.runtimeLabels)?$t.runtimeLabels:[],runtimeLines:Array.isArray($t.runtimeLines)?$t.runtimeLines:[],runtimeBoxes:Array.isArray($t.runtimeBoxes)?$t.runtimeBoxes:[],runtimeTables:Array.isArray($t.runtimeTables)?$t.runtimeTables:[],runtimeHeatmaps:Array.isArray($t.runtimeHeatmaps)?$t.runtimeHeatmaps:[],overlays:Array.isArray($t.overlays)?$t.overlays:[],fills:Array.isArray($t.fills)?$t.fills:[],backgroundZones:Array.isArray($t.backgroundZones)?$t.backgroundZones:[],min:$t.min,max:$t.max,shortName:$t.shortName||S.shortName,height:$t.height})}else if(S.main||S.sub)S.main&&jn.push({pane:"main",plots:Array.isArray(S.main.plots)?S.main.plots:[],levels:Array.isArray(S.main.levels)?S.main.levels:[],labels:Array.isArray(S.main.labels)?S.main.labels:[],lines:Array.isArray(S.main.lines)?S.main.lines:[],runtimeDrawOps:Array.isArray(S.main.runtimeDrawOps)?S.main.runtimeDrawOps:[],runtimeLabels:Array.isArray(S.main.runtimeLabels)?S.main.runtimeLabels:[],runtimeLines:Array.isArray(S.main.runtimeLines)?S.main.runtimeLines:[],runtimeBoxes:Array.isArray(S.main.runtimeBoxes)?S.main.runtimeBoxes:[],runtimeTables:Array.isArray(S.main.runtimeTables)?S.main.runtimeTables:[],runtimeHeatmaps:Array.isArray(S.main.runtimeHeatmaps)?S.main.runtimeHeatmaps:[],overlays:Array.isArray(S.main.overlays)?S.main.overlays:Array.isArray(S.overlays)?S.overlays:[],fills:Array.isArray(S.main.fills)?S.main.fills:[],backgroundZones:Array.isArray(S.main.backgroundZones)?S.main.backgroundZones:[],min:S.main.min,max:S.main.max,shortName:S.main.shortName||S.shortName,height:S.main.height}),S.sub&&jn.push({pane:"sub",plots:Array.isArray(S.sub.plots)?S.sub.plots:[],levels:Array.isArray(S.sub.levels)?S.sub.levels:[],labels:Array.isArray(S.sub.labels)?S.sub.labels:[],lines:Array.isArray(S.sub.lines)?S.sub.lines:[],runtimeDrawOps:Array.isArray(S.sub.runtimeDrawOps)?S.sub.runtimeDrawOps:[],runtimeLabels:Array.isArray(S.sub.runtimeLabels)?S.sub.runtimeLabels:[],runtimeLines:Array.isArray(S.sub.runtimeLines)?S.sub.runtimeLines:[],runtimeBoxes:Array.isArray(S.sub.runtimeBoxes)?S.sub.runtimeBoxes:[],runtimeTables:Array.isArray(S.sub.runtimeTables)?S.sub.runtimeTables:[],runtimeHeatmaps:Array.isArray(S.sub.runtimeHeatmaps)?S.sub.runtimeHeatmaps:[],overlays:Array.isArray(S.sub.overlays)?S.sub.overlays:[],fills:Array.isArray(S.sub.fills)?S.sub.fills:[],backgroundZones:Array.isArray(S.sub.backgroundZones)?S.sub.backgroundZones:[],min:S.sub.min,max:S.sub.max,shortName:S.sub.shortName||S.shortName,height:S.sub.height});else{const Gs=S.pane==="sub"?"sub":S.pane==="main"?"main":i(jc);jn.push({pane:Gs,plots:Array.isArray(S.plots)?S.plots:[],levels:Array.isArray(S.levels)?S.levels:[],labels:Array.isArray(S.labels)?S.labels:[],lines:Array.isArray(S.lines)?S.lines:[],runtimeDrawOps:Array.isArray(S.runtimeDrawOps)?S.runtimeDrawOps:[],runtimeLabels:Array.isArray(S.runtimeLabels)?S.runtimeLabels:[],runtimeLines:Array.isArray(S.runtimeLines)?S.runtimeLines:[],runtimeBoxes:Array.isArray(S.runtimeBoxes)?S.runtimeBoxes:[],runtimeTables:Array.isArray(S.runtimeTables)?S.runtimeTables:[],runtimeHeatmaps:Array.isArray(S.runtimeHeatmaps)?S.runtimeHeatmaps:[],overlays:Array.isArray(S.overlays)?S.overlays:[],fills:Array.isArray(S.fills)?S.fills:[],backgroundZones:Array.isArray(S.backgroundZones)?S.backgroundZones:[],min:S.min,max:S.max,shortName:S.shortName,height:S.height}),x(jc,V(Gs))}if(jn.some($t=>Array.isArray($t.runtimeHeatmaps)&&$t.runtimeHeatmaps.length)){Pe=!0;try{El()}catch{}}if(!jn.length)throw new Error("No panes defined in script.");const Kn=(()=>{const $t=jn.findIndex(Gs=>Gs.pane==="main");return $t>=0?$t:0})(),os=jn.some($t=>$t.plots&&$t.plots.length||$t.overlays&&$t.overlays.length||$t.labels&&$t.labels.length||$t.levels&&$t.levels.length||$t.lines&&$t.lines.length||$t.runtimeDrawOps&&$t.runtimeDrawOps.length||$t.runtimeLabels&&$t.runtimeLabels.length||$t.runtimeLines&&$t.runtimeLines.length||$t.runtimeBoxes&&$t.runtimeBoxes.length||$t.runtimeTables&&$t.runtimeTables.length||$t.runtimeHeatmaps&&$t.runtimeHeatmaps.length),ln=!!(S!=null&&S.strategy)||Xt.length>0;if(!os&&!ln)throw new Error("No plots or labels defined in script.");!os&&ln&&(jn[0]||jn.push({pane:"main",plots:[],levels:[],labels:[],lines:[],overlays:[]}),jn[0].plots=Array.isArray(jn[0].plots)?jn[0].plots:[],jn[0].plots.push({name:"__hidden__",source:"close",type:"line",color:"rgba(0,0,0,0)",width:1e-4,style:"solid",layer:"background"})),G(X);try{X.removeOverlay({groupId:"runtime"})}catch{}const ms=`${Rc}_${Date.now()}`;let Ns=0,cn=!1;const Gn={maxCalls:16,maxSymbols:8,maxTimeframes:8,maxBars:5e3},ls=new Map,on=new Map,an=$t=>{const Gs=String($t||"").trim(),Zo=Gs.lastIndexOf("@");if(Zo>0&&Zo<Gs.length-1){const Bo=Gs.slice(0,Zo).trim(),ka=Gs.slice(Zo+1).trim();if(Bo&&ka)return{ticker:Bo,country:ka}}return{ticker:Gs}},wn=$t=>String($t||"").trim().toLowerCase().replace(/\s+/g,""),ds=Array.isArray((xp=s())==null?void 0:xp.allSymbols)?s().allSymbols:[],Wn=new Map,yo=new Map,Si=new Map;for(const $t of ds){const Gs=wn(String(($t==null?void 0:$t.ticker)||""));Gs&&Wn.set(Gs,$t);const Zo=wn(String(($t==null?void 0:$t.shortName)||""));Zo&&!yo.has(Zo)&&yo.set(Zo,$t);const Bo=wn(String(($t==null?void 0:$t.name)||""));Bo&&!Si.has(Bo)&&Si.set(Bo,$t)}const is=($t,Gs)=>{let Zo=String($t??"").trim();if(!Zo)return"__CURRENT__";try{Zo=Zo.replace(/\$\{([^}]+)\}/g,(Vo,il)=>{var Zl;const Ya=(Gs==null?void 0:Gs[il])??(Gs==null?void 0:Gs[(Zl=il==null?void 0:il.toLowerCase)==null?void 0:Zl.call(il)]);return Ya==null?Vo:String(Ya)})}catch{}const Bo=Zo.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Bo)){const Vo=(Gs==null?void 0:Gs[Bo])??(Gs==null?void 0:Gs[Bo.toLowerCase()]);typeof Vo=="string"&&Vo.trim()&&(Zo=Vo.trim())}const ka=String(Zo).trim(),Ru=ka.toLowerCase();return Ru==="syminfo.tickerid"||Ru==="syminfo.ticker"||Ru==="syminfo.root"||Ru==="__current__"||Ru==="__current_symbol__"?"__CURRENT__":ka},To=Bc(),gs=$t=>({...$t,sessionMode:To.sessionMode,adjustMode:To.adjustMode}),No=$t=>{const Gs=String(To.sessionMode||"regular").toLowerCase(),Zo=String(($t==null?void 0:$t.session)||""),Bo=String(($t==null?void 0:$t.sessionExtended)||"");return Gs==="all"?"24x7":Gs==="extended"&&Bo||Zo},jo=($t,Gs,Zo)=>{const Bo=is($t,Zo);if(Bo==="__CURRENT__")return gs(Vs);const ka=an(Bo),Ru=String(ka.ticker||"").trim(),Vo=wn(Ru),il=Vo&&Wn.get(Vo)||Vo&&yo.get(Vo)||Vo&&Si.get(Vo)||null,Ya=String(Gs||ka.country||(il==null?void 0:il.country)||Vs.country||"BD").trim()||"BD";return il&&String(il.ticker||"").trim()?gs({...il,country:Ya}):gs({...Vs,ticker:Ru,country:Ya})},co=S!=null&&S.params&&typeof S.params=="object"?S.params:{},Vs=((Qm=s())==null?void 0:Qm.symbol)||{ticker:"UNKNOWN"},gi=((Oh=X.getDataList)==null?void 0:Oh.call(X))||[],Hc=typeof((Pp=gi==null?void 0:gi[0])==null?void 0:Pp.timestamp)=="number"?gi[0].timestamp:typeof((pv=gi==null?void 0:gi[0])==null?void 0:pv.time)=="number"?gi[0].time:0,xc=typeof((Mg=gi==null?void 0:gi[gi.length-1])==null?void 0:Mg.timestamp)=="number"?gi[gi.length-1].timestamp:typeof((Ng=gi==null?void 0:gi[gi.length-1])==null?void 0:Ng.time)=="number"?gi[gi.length-1].time:0,ac=$t=>{const Gs=typeof $t=="number"?$t:Number($t);return!Number.isFinite(Gs)||Gs<=0?0:Gs<1e12?Gs*1e3:Gs},tu=ac(Hc),_c=ac(xc),qc=$t=>{const Gs=String($t??"").trim();if(!Gs)return"__CURRENT__";const Zo=Gs.toUpperCase();if(Zo==="CURRENT"||Zo==="__CURRENT__"||Zo==="TIMEFRAME.PERIOD")return"__CURRENT__";if(Zo==="D"||Zo==="1D")return"1d";if(Zo==="W"||Zo==="1W")return"1w";if(Zo==="M"||Zo==="1M")return"1M";if(/^\d+$/.test(Gs))return`${Gs}m`;const Bo=Zo.match(/^(\d+)\s*H$/);return Bo?`${Bo[1]}h`:Gs},jl=$t=>{const Gs=String($t||"").trim();if(!Gs)return 0;if(/^\d+$/.test(Gs))return gp(`${Gs}m`);if(Gs==="M"||Gs==="1M")return gp("1M");const Zo=Gs.toUpperCase();if(Zo==="D"||Zo==="1D")return gp("1d");if(Zo==="W"||Zo==="1W")return gp("1w");const Bo=Gs.match(/^(\d+)\s*([A-Za-z]+)$/);if(Bo){const ka=Bo[1]||"1",Ru=Bo[2]||"";if(Ru==="M")return gp(`${ka}M`);const Vo=Ru.toLowerCase();return Vo.startsWith("min")?gp(`${ka}m`):Vo==="h"||Vo.startsWith("hr")||Vo.startsWith("hour")?gp(`${ka}h`):Vo==="d"||Vo.startsWith("day")?gp(`${ka}d`):Vo==="w"||Vo.startsWith("wk")||Vo.startsWith("week")?gp(`${ka}w`):gp(`${ka}${Vo}`)}try{return gp(Gs)}catch{return 0}},Bl=jl(((pg=(Ag=s())==null?void 0:Ag.period)==null?void 0:pg.timeframe)||""),_u=Bl>0?Bl*1e3:0,cd=_c>0&&_u>0?_c+_u-1:_c;if(ne){(!S.params||typeof S.params!="object")&&(S.params={});const $t=gi.length>=1?gi[gi.length-1]:null,Gs=gi.length>=2?gi[gi.length-2]:null,Zo=ac(($t==null?void 0:$t.timestamp)??($t==null?void 0:$t.time)),Bo=ac((Gs==null?void 0:Gs.timestamp)??(Gs==null?void 0:Gs.time)),Ru=(Number.isFinite(Zo)&&Number.isFinite(Bo)&&Zo>Bo?Zo-Bo:0)||_u||0,Vo=Number.isFinite(Zo)&&Zo>0&&Ru>0?Zo+Ru:Date.now();S.params.__barDurationMs=Ru,S.params.__nowMs=Vo}const ql=$t=>{const Gs=String($t||"").trim();if(!Gs)return"__CURRENT__";const Zo=Gs.toLowerCase();if(Zo.endsWith("m")){const Bo=Number(Zo.slice(0,-1));if(Number.isFinite(Bo)&&Bo>0)return String(Math.floor(Bo))}if(Zo.endsWith("h")){const Bo=Number(Zo.slice(0,-1));if(Number.isFinite(Bo)&&Bo>0)return String(Math.floor(Bo*60))}return Zo.endsWith("d")?"D":Zo.endsWith("w")?"W":Gs==="1M"||Gs==="M"?"M":(/^\d+$/.test(Gs),Gs)},jp=$t=>{let Gs=String($t??"__CURRENT__");try{Gs=Gs.replace(/\$\{([^}]+)\}/g,(Bo,ka)=>{var Vo;const Ru=(co==null?void 0:co[ka])??(co==null?void 0:co[(Vo=ka==null?void 0:ka.toLowerCase)==null?void 0:Vo.call(ka)]);return Ru==null?Bo:String(Ru)});const Zo=Gs.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Zo)){const Bo=(co==null?void 0:co[Zo])??(co==null?void 0:co[Zo.toLowerCase()]);Bo!=null&&(Gs=String(Bo))}}catch{}return Gs},Uc=new Map;let Ol=[];try{const $t=(Yt||[]).filter(Gs=>String((Gs==null?void 0:Gs.type)||"").toLowerCase()==="security");if($t.length&&(Vs!=null&&Vs.ticker)){if(nd.size)for(const Bo of nd){const[ka]=String(Bo).split("@");if(ka&&ka!==Vs.ticker)try{A.stopSymbolPipelines(ka)}catch{}}const Gs=new Set,Zo=new Map;for(const Bo of $t){const ka=String((Bo==null?void 0:Bo.name)||"security").replace(/\s+/g,"_").toLowerCase();if(!ka)continue;const Ru=!!(Bo!=null&&Bo.lower),Vo=jo(Bo==null?void 0:Bo.symbol,Bo==null?void 0:Bo.country,co),il=String((Vo==null?void 0:Vo.ticker)||"").trim(),Ya=String((Vo==null?void 0:Vo.country)||"BD");if(!il)continue;Gs.add(`${il}@${Ya}`);const Zl=jp((Bo==null?void 0:Bo.timeframe)||(Bo==null?void 0:Bo.tf)||"__CURRENT__"),oi=Zl==="__CURRENT__"?((mg=(Mm=s())==null?void 0:Mm.period)==null?void 0:mg.timeframe)||"1m":qc(Zl),Ys=Zl==="__CURRENT__"?ql(((kv=(Tg=s())==null?void 0:Tg.period)==null?void 0:kv.timeframe)||"1m"):String(Zl||"__CURRENT__");Uc.set(ka,{ticker:il,country:Ya,pipelineTf:oi,computeTf:Ys,lower:Ru});const Er=`${il}@${Ya}|${oi}`;oi&&oi!=="__CURRENT__"&&Zo.set(Er,{sym:Vo,tf:oi})}if(Ol=Array.from(Zo.values()),nd=Gs,Zo.size&&tu>0&&cd>0)await Promise.all(Array.from(Zo.values()).map(({sym:Bo,tf:ka})=>A.ensureHistoryCovers(Bo,ka,tu,cd,3e3).catch(()=>null)));else if(Zo.size)for(const{sym:Bo,tf:ka}of Zo.values())try{A.startBackgroundPrefetch(Bo,{timeframe:ka})}catch{}}}catch($t){console.warn("[ScriptStudio] request.security prefetch skipped",$t)}try{ft&&(clearInterval(ft),ft=null)}catch{}if(Ol.length){const $t=Date.now(),Gs=25e3;ft=setInterval(()=>{var ka;const Zo=o();if(!Zo)return;if(Date.now()-$t>Gs){try{clearInterval(ft)}catch{}ft=null;return}let Bo=0;for(const{sym:Ru,tf:Vo}of Ol){const il=A.getHistorySnapshot(Ru,Vo);if(il!=null&&il.error)continue;const Ya=(((ka=il==null?void 0:il.candles)==null?void 0:ka.length)||0)>=2,Zl=tu>0&&cd>0&&((il==null?void 0:il.oldestTimestampLoaded)??1/0)<=tu&&((il==null?void 0:il.newestTimestampLoaded)??0)>=cd;!(il!=null&&il.isComplete)&&(!Ya||!Zl)&&(Bo+=1)}if(Bo<=0){try{clearInterval(ft)}catch{}ft=null;return}ul.requestKey("security:refresh",()=>{try{Zo.resize()}catch{}try{kd()}catch{}})},350)}const au=($t,Gs)=>{var cu,Va,ju,Bu,oa,Ul,ud,dl;const Zo=new Set,Bo=[],ka={min:"__rt_autoscale_min",max:"__rt_autoscale_max"},Ru=$t.plots||[],Vo=S!=null&&S.params&&typeof S.params=="object"?S.params:{},il=U=>{if(U!=null){if(typeof U!="string")return String(U);try{const Kt=U.replace(/\$\{([^}]+)\}/g,(Ds,_s)=>{var ii;const zi=(Vo==null?void 0:Vo[_s])??(Vo==null?void 0:Vo[(ii=_s==null?void 0:_s.toLowerCase)==null?void 0:ii.call(_s)]);return zi==null?Ds:String(zi)});if(Kt!==U)return Kt;const bs=U.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(bs)){const Ds=(Vo==null?void 0:Vo[bs])??(Vo==null?void 0:Vo[bs.toLowerCase()]);if(Ds!=null)return String(Ds)}return Kt}catch{return U}}},Ya=U=>{if(U==null)return;if(typeof U=="number"&&Number.isFinite(U))return U;const Kt=il(U);if(!Kt)return;const bs=Number(Kt);return Number.isFinite(bs)?bs:void 0},Zl=Ru.filter(U=>{const Kt=String((U==null?void 0:U.display)||"").toLowerCase();return Kt?!Kt.includes("none")&&Kt!=="display.none":!0}).map(U=>{const Kt=il(U==null?void 0:U.color),bs=Ya(U==null?void 0:U.offset),Ds=Ya((U==null?void 0:U.showLast)??(U==null?void 0:U.show_last)),_s=Ya(U==null?void 0:U.precision);return{...U,color:Kt??(U==null?void 0:U.color),offset:bs,showLast:Ds,precision:_s}}),oi=$t.runtimeDrawOps||[],Ys=$t.runtimeLabels||[],Er=$t.runtimeLines||[],Hn=$t.runtimeBoxes||[],Mn=$t.runtimeTables||[],Do=$t.runtimeHeatmaps||[],Jr=U=>{const Kt=(bs,Ds)=>{bs.length=0,Array.isArray(Ds)&&bs.push(...Ds)};Kt(oi,U==null?void 0:U.runtimeDrawOps),Kt(Ys,U==null?void 0:U.runtimeLabels),Kt(Er,U==null?void 0:U.runtimeLines),Kt(Hn,U==null?void 0:U.runtimeBoxes),Kt(Mn,U==null?void 0:U.runtimeTables),Kt(Do,U==null?void 0:U.runtimeHeatmaps)},Mr=Zl.some(U=>String((U==null?void 0:U.type)||"").toLowerCase()==="histogram"),vr=Mr,Il=typeof $t.min=="number"||typeof $t.max=="number",mi=$t.pane==="sub"&&!vr&&!Il;$t.pane==="sub"&&Mr&&Zl.push({name:"__zero__",source:"__zero__",type:"line",color:"rgba(0,0,0,0)",width:0});const Xi=[...$t.levels||[],...$t._trackLevels||[]],k=$t.labels||[],N=$t.lines||[],j={},D=Zl.map(U=>{const Kt=be(U.name||U.source||"plot",Zo);Bo.push(Kt);const bs=(U.source||U.name||"").replace(/\s+/g,"_").toLowerCase();bs&&(j[bs]=Kt);const Ds=(U.type||U.style||"").toLowerCase();return Ds==="histogram"?{key:Kt,title:U.name||Kt,type:"bar",baseValue:0}:Ds==="bar"?{key:Kt,title:U.name||Kt,type:"bar",baseValue:0}:{key:Kt,title:U.name||Kt,type:"line"}});D.push({key:ka.min,type:"line"},{key:ka.max,type:"line"});const W=Zl.map((U,Kt)=>{var _s;const bs=String((U==null?void 0:U.type)||"").toLowerCase();return bs!=="candles"&&bs!=="ohlc"?null:{key:Bo[Kt]||((_s=D[Kt])==null?void 0:_s.key)||`plot_${Kt}`,openKey:String((U==null?void 0:U.open)||"open").replace(/\s+/g,"_").toLowerCase(),highKey:String((U==null?void 0:U.high)||"high").replace(/\s+/g,"_").toLowerCase(),lowKey:String((U==null?void 0:U.low)||"low").replace(/\s+/g,"_").toLowerCase(),closeKey:String((U==null?void 0:U.close)||"close").replace(/\s+/g,"_").toLowerCase(),offset:Number.isFinite(U==null?void 0:U.offset)?Math.trunc(U.offset):0,showLast:Number.isFinite(U==null?void 0:U.showLast)?Math.max(0,Math.floor(U.showLast)):0}}).filter(Boolean),H=`${ms}_${$t.pane}_${Gs}`,he=`${ms}__strategy`,Le=(S==null?void 0:S.drawConfig)||{},st={limits:{...re.limits,...Le.limits||{}},pruningPolicy:Le.pruningPolicy==="lru"||Le.pruningPolicy==="byGroup"?Le.pruningPolicy:re.pruningPolicy,futureBars:Number.isFinite(Le.futureBars)?Math.max(0,Math.floor(Le.futureBars)):re.futureBars,time:{mode:((cu=Le==null?void 0:Le.time)==null?void 0:cu.mode)==="prev"||((Va=Le==null?void 0:Le.time)==null?void 0:Va.mode)==="next"?Le.time.mode:re.time.mode,toleranceBars:Number.isFinite((ju=Le==null?void 0:Le.time)==null?void 0:ju.toleranceBars)?Math.max(0,Math.floor(Le.time.toleranceBars)):re.time.toleranceBars,toleranceMs:Number.isFinite((Bu=Le==null?void 0:Le.time)==null?void 0:Bu.toleranceMs)?Math.max(0,Math.floor(Le.time.toleranceMs)):re.time.toleranceMs},decimationPx:Number.isFinite(Le.decimationPx)?Math.max(1,Math.floor(Le.decimationPx)):re.decimationPx},Jt={};let fs="",ts=!1,Bn=-1;const ti=Gs===Kn;let ci=!1,lu="",Cd=null,Sf="",rf=null;const rp=2e4,ef=U=>new Promise((Kt,bs)=>{const Ds=new Worker(new URL(""+new URL("../workers/runtime.worker-B3x7EOJS.js",import.meta.url).href,import.meta.url),{type:"module"}),_s=setTimeout(()=>{try{Ds.terminate()}catch{}bs(new Error("Runtime worker timed out"))},rp);Ds.onerror=()=>{try{clearTimeout(_s)}catch{}try{Ds.terminate()}catch{}bs(new Error("Runtime worker error"))},Ds.onmessage=zi=>{const ii=zi.data;if(!(!ii||ii.id!==U.id)){try{clearTimeout(_s)}catch{}try{Ds.terminate()}catch{}if(ii.error){bs(new Error(String(ii.error)));return}Kt({seriesMap:ii.seriesMap||{},lastPrevSource:ii.lastPrevSource||void 0,diagnostics:Array.isArray(ii.diagnostics)?ii.diagnostics:void 0})}},Ds.postMessage(U)}),Cf=Zl.map((U,Kt)=>{var zi;const bs=(U.source||U.name||"").replace(/\s+/g,"_").toLowerCase();let Ds="#22d3ee";/ema\d+/i.test(bs)?Ds=(zi=/ema(\d+)/i.exec(bs))!=null&&zi[1]&&Number(RegExp.$1)<=20?"#22c55e":"#ef4444":/signal|sig/i.test(bs)?Ds="#f59e0b":/hist|bar/i.test(U.type||U.style||"")&&(Ds="#64748b");const _s=(U.type||U.style||"").toLowerCase();return _s==="histogram"?{color:"rgba(0,0,0,0)",size:1e-4,style:wt.Solid}:_s==="dots"||_s==="cross"?{color:"rgba(0,0,0,0)",size:1e-4,style:wt.Solid}:_s==="candles"||_s==="ohlc"?{color:"rgba(0,0,0,0)",size:1e-4,style:wt.Solid}:{color:U.color||Ds,size:U.width??2,gradient:U==null?void 0:U.gradient,style:nf[(U.style||"solid").toLowerCase()]??wt.Solid}});Cf.push({color:"rgba(0,0,0,0)",size:0,style:wt.Solid},{color:"rgba(0,0,0,0)",size:0,style:wt.Solid});const mf=Zl.filter(U=>{const Kt=(U.type||U.style||"").toLowerCase();return Kt==="histogram"||Kt==="bar"}).map(U=>{const Kt=U.color||"#64748b",bs=U.downColor||Kt;return{style:"fill",borderStyle:"solid",borderSize:0,borderDashedValue:[2,2],upColor:Kt,downColor:bs,noChangeColor:Kt,gradient:U==null?void 0:U.gradient}}),Id={name:H,shortName:$t.shortName||"Script",precision:4,calcParams:[],figures:D,shouldOhlc:!1,zLevel:Pr,minValue:(()=>{const U=$t.pane==="sub",Kt=Zl.some(bs=>String((bs==null?void 0:bs.type)||"").toLowerCase()==="histogram");if(typeof $t.min=="number")return $t.min;if(U&&Kt)return-5})(),maxValue:(()=>{const U=$t.pane==="sub",Kt=Zl.some(bs=>String((bs==null?void 0:bs.type)||"").toLowerCase()==="histogram");if(typeof $t.max=="number")return $t.max;if(U&&Kt)return 5})(),styles:{lines:Cf,...mf.length?{bars:mf}:{}},calc:async U=>{var mv,wh,Qp,Ap,Hh,Am,pm,Fg,Hg,Lg,Eg,i0,$g,hg,kh,C_,Af,nh,qg,k0,I_,Iy,P_,Py,M_,My,Ny,Ay,Ty,c1,Fy,Ly,Ey,N_,A_,$y,Dy,Ry,T_,jy,F_,By,Oy,zy,Vy,Wy,Hy,qy,Uy,Gy,Yy,Ky,Xy,Zy;const Kt=U.length,bs=Kt?U[Kt-1]:null,Ds=(bs==null?void 0:bs.timestamp)??(bs==null?void 0:bs.time)??(bs==null?void 0:bs.t)??0,_s=typeof Ds=="number"?Ds:Number(Ds),zi=Kt?U[0]:null,ii=(zi==null?void 0:zi.timestamp)??(zi==null?void 0:zi.time)??(zi==null?void 0:zi.t)??0,ia=typeof ii=="number"?ii:Number(ii);let $r=0,rr=0,Jl=0,Wa=0;if(Ol.length)for(const{sym:lt,tf:Be}of Ol){const p=A.getHistorySnapshot(lt,Be),b=Number((p==null?void 0:p.lastUpdatedAt)??0);Number.isFinite(b)&&($r=Math.max($r,b));const T=((mv=p==null?void 0:p.candles)==null?void 0:mv.length)??0;rr+=Number.isFinite(T)?T:0,p!=null&&p.error&&(Jl+=1),!(p!=null&&p.error)&&!(p!=null&&p.isComplete)&&(((wh=p==null?void 0:p.candles)==null?void 0:wh.length)??0)<2&&(Wa+=1)}const Ci=`${Kt}:${Number.isFinite(ia)?ia:0}:${Number.isFinite(_s)?_s:0}:${i(yr)?1:0}:${$r}:${rr}:${Jl}:${Wa}:${Eo}:${Lr}:${Ns}`;if(Ci===lu&&Cd)return Cd;const Ha={},ki={},ys={};let tr=!1;const Fo=(S==null?void 0:S.params)||{};zf=Fo;const Lo=(lt,Be,p)=>{if(typeof lt=="number"&&Number.isFinite(lt))return lt;if(typeof lt=="string"){const b=Number(lt);if(Number.isFinite(b))return b;const T=lt.match(/^\$\{([^}]+)\}$/),z=T?T[1]:lt,ie=Fo[z],Ne=typeof ie=="number"?ie:Number(ie);if(Number.isFinite(Ne))return Ne}if(Be&&Fo[Be]!=null){const b=Fo[Be],T=typeof b=="number"?b:Number(b);if(Number.isFinite(T))return T}return p??0},Gi=lt=>{if(typeof lt=="number")return Number.isFinite(lt)?lt:void 0;if(typeof lt=="string"){const p=lt.replace(/[^0-9eE+\\-\\.]/g,"");if(!p||p==="+"||p==="-"||p===".")return;const b=Number(p);return Number.isFinite(b)?b:void 0}const Be=Number(lt);return Number.isFinite(Be)?Be:void 0},Nr=new Array(Kt),Vi=new Array(Kt),Ho=new Array(Kt),Ar=new Array(Kt),ma=new Array(Kt),rl=new Array(Kt),Cr=new Array(Kt);for(let lt=0;lt<Kt;(lt+=1)-1){const Be=U[lt],p=Gi((Be==null?void 0:Be.close)??(Be==null?void 0:Be.c)??(Be==null?void 0:Be.price)??(Be==null?void 0:Be.value)),b=Gi((Be==null?void 0:Be.open)??(Be==null?void 0:Be.o))??p,T=Gi((Be==null?void 0:Be.high)??(Be==null?void 0:Be.h))??p??b,z=Gi((Be==null?void 0:Be.low)??(Be==null?void 0:Be.l))??p??b,ie=Gi((Be==null?void 0:Be.volume)??(Be==null?void 0:Be.vol))??0,Ne=Gi((Be==null?void 0:Be.timestamp)??(Be==null?void 0:Be.time)??(Be==null?void 0:Be.t))??0;Ar[lt]=p,Nr[lt]=b,Vi[lt]=T,Ho[lt]=z,ma[lt]=ie,rl[lt]=Ne,Cr[lt]=lt}ys.open=Nr,ys.close=Ar,ys.high=Vi,ys.low=Ho,ys.volume=ma,ys.time=rl,ys.bar_index=Cr;let Yi=null;const ha=S==null?void 0:S.__jsSeriesMap,Dr=ha?Object.values(ha):[],va=Dr.length>0&&Dr.every(lt=>Array.isArray(lt)&&lt.length===Kt);ha&&va&&(Yi=ha);const al=S==null?void 0:S.__jsCode;if(!Yi&&al){const lt=`${Kt}:${Number.isFinite(ia)?ia:0}:${Number.isFinite(_s)?_s:0}:${Eo}`;if(lt===Sf&&rf)Yi=rf;else try{const Be=await We({id:`${H}_js_${Kt}_${Number.isFinite(_s)?_s:0}`,code:al,base:{open:Nr,high:Vi,low:Ho,close:Ar,volume:ma,time:rl},params:Fo});if(Be!=null&&Be.error)x(un,V(String(Be.error||"JS engine failed"))),x(Rt,"Validation failed");else if((Qp=Be==null?void 0:Be.output)!=null&&Qp.seriesMap){Yi=Be.output.seriesMap,rf=Yi,Sf=lt,S.__jsSeriesMap=Yi;const p=Array.isArray((Ap=Be==null?void 0:Be.output)==null?void 0:Ap.panes)?Be.output.panes:[];if(p.length){const b=($t==null?void 0:$t.pane)||"main",T=p.find(z=>((z==null?void 0:z.pane)??"main")===b)||(p.length===1?p[0]:null);T&&Jr(T)}}}catch(Be){const p=Be instanceof Error?Be.message:"JS engine failed";x(un,V(p)),x(Rt,"Validation failed")}}if(Yi){const lt={};Object.entries(Yi).forEach(([Be,p])=>{const b=String(Be||"").replace(/\s+/g,"_").toLowerCase();!b||!Array.isArray(p)||p.length!==Kt||(lt[b]=p)}),Yi=Object.keys(lt).length?lt:null}const ns=lt=>{const Be=new Array(Kt);for(let p=0;p<Kt;(p+=1)-1)Be[p]=lt;return Be},zs={},Rs=df.get(he),Ni=lt=>Array.isArray(lt)&&lt.length===Kt?lt:null;zs.strategy_position_size=Ni(Rs==null?void 0:Rs.positionSize)??ns(0),zs.strategy_position_avg_price=Ni(Rs==null?void 0:Rs.positionAvgPrice)??ns(NaN),zs.strategy_opentrades=Ni(Rs==null?void 0:Rs.openTrades)??ns(0),zs.strategy_closedtrades=Ni(Rs==null?void 0:Rs.closedTrades)??ns(0),zs.strategy_openprofit=Ni(Rs==null?void 0:Rs.openProfit)??ns(0),zs.strategy_closedprofit=Ni(Rs==null?void 0:Rs.closedProfit)??ns(0),zs.strategy_grossprofit=Ni(Rs==null?void 0:Rs.grossProfit)??ns(0),zs.strategy_grossloss=Ni(Rs==null?void 0:Rs.grossLoss)??ns(0),zs.strategy_wintrades=Ni(Rs==null?void 0:Rs.winTrades)??ns(0),zs.strategy_losstrades=Ni(Rs==null?void 0:Rs.lossTrades)??ns(0),zs.strategy_winrate=Ni(Rs==null?void 0:Rs.winRate)??ns(0),zs.strategy_max_drawdown=Ni(Rs==null?void 0:Rs.maxDrawdownPct)??ns(0),zs.strategy_max_drawdown_value=Ni(Rs==null?void 0:Rs.maxDrawdownValue)??ns(0),zs.strategy_max_runup=Ni(Rs==null?void 0:Rs.maxRunupPct)??ns(0),zs.strategy_max_runup_value=Ni(Rs==null?void 0:Rs.maxRunupValue)??ns(0),zs.strategy_avg_trade=Ni(Rs==null?void 0:Rs.avgTrade)??ns(0),zs.strategy_avg_win=Ni(Rs==null?void 0:Rs.avgWin)??ns(0),zs.strategy_avg_loss=Ni(Rs==null?void 0:Rs.avgLoss)??ns(0),zs.strategy_avg_bars_in_trade=Ni(Rs==null?void 0:Rs.avgBarsInTrade)??ns(0),zs.strategy_equity=Ni(Rs==null?void 0:Rs.equity)??ns(0),zs.strategy_netprofit=Ni(Rs==null?void 0:Rs.netProfit)??ns(0);const Ma=Rs==null?void 0:Rs.initialCapital;zs.strategy_initial_capital=ns(typeof Ma=="number"&&Number.isFinite(Ma)?Ma:0);const ll=String(((Am=(Hh=s())==null?void 0:Hh.period)==null?void 0:Am.timeframe)||"1m").trim(),ir=ll.match(/^(\d+)\s*([a-zA-Z])$/);let Ai=0,ca="";ir?(Ai=Number(ir[1]),ca=ir[2]||""):/^\d+$/.test(ll)&&(Ai=Number(ll),ca="m");const ui=ca==="M"?"M":ca.toLowerCase();let bi=0;if(Ai>0&&ui)try{bi=gp(`${Ai}${ui}`)}catch{}const ai=ui==="s",fi=ui==="m",ra=ui==="h",pr=ui==="d",Ti=ui==="w",Di=ui==="M",Sa=ui==="y",Uo=ai||fi||ra;let ga="";Ai>0&&ui&&(ui==="m"?ga=String(Ai):ui==="h"?ga=String(Ai*60):ui==="s"?ga=`${Ai}S`:ui==="d"?ga=Ai===1?"D":`${Ai}D`:ui==="w"?ga=Ai===1?"W":`${Ai}W`:ui==="M"?ga=Ai===1?"M":`${Ai}M`:ui==="y"&&(ga=Ai===1?"Y":`${Ai}Y`)),zs.timeframe_multiplier=ns(Ai||0),zs.timeframe_seconds=ns(bi||0),zs.timeframe_isseconds=ns(ai?1:0),zs.timeframe_isminutes=ns(fi?1:0),zs.timeframe_ishours=ns(ra?1:0),zs.timeframe_isdaily=ns(pr?1:0),zs.timeframe_isweekly=ns(Ti?1:0),zs.timeframe_ismonthly=ns(Di?1:0),zs.timeframe_isyearly=ns(Sa?1:0),zs.timeframe_isintraday=ns(Uo?1:0),zs.timeframe_period=ns(Dd(ga));const qr=Vs==null?void 0:Vs.pricePrecision,Ri=typeof qr=="number"?qr:Number(qr),Ka=Number.isFinite(Ri)?Math.max(0,Math.floor(Ri)):2,Jo=(Vs==null?void 0:Vs.tickSize)??(Vs==null?void 0:Vs.minTick)??(Vs==null?void 0:Vs.priceStep),Ki=typeof Jo=="number"?Jo:Number(Jo),ua=Number.isFinite(Ki)&&Ki>0?Ki:1/Math.pow(10,Ka);zs.syminfo_mintick=ns(ua),zs.syminfo_tick_size=ns(ua);const Qr=Vs==null?void 0:Vs.lotSize,ar=typeof Qr=="number"?Qr:Number(Qr);zs.syminfo_lot_size=ns(Number.isFinite(ar)?ar:1);const _a=Vs==null?void 0:Vs.contractSize,Pl=typeof _a=="number"?_a:Number(_a);zs.syminfo_pointvalue=ns(Number.isFinite(Pl)?Pl:1);const gr=String((Vs==null?void 0:Vs.ticker)||""),Ur=String((Vs==null?void 0:Vs.country)||""),Ra=Ur?`${gr}@${Ur}`:gr,xi=gr.split(/[:.]/).pop()||gr,Qs=String((Vs==null?void 0:Vs.exchange)||(Vs==null?void 0:Vs.market)||""),ji=String((Vs==null?void 0:Vs.name)||(Vs==null?void 0:Vs.shortName)||""),qa=String((Vs==null?void 0:Vs.type)||""),_i=String((Vs==null?void 0:Vs.priceCurrency)||""),da=String((Vs==null?void 0:Vs.timezone)||(Vs==null?void 0:Vs.sessionTimezone)||((pm=s())==null?void 0:pm.timezone)||"UTC"),dr=String((To==null?void 0:To.sessionMode)||"regular").toLowerCase(),fl=String((Vs==null?void 0:Vs.session)||""),kc=String((Vs==null?void 0:Vs.sessionExtended)||""),Ml=dr==="all"?"24x7":dr==="extended"&&kc||fl;zs.syminfo_tickerid=ns(Dd(Ra)),zs.syminfo_ticker=ns(Dd(gr)),zs.syminfo_root=ns(Dd(xi)),zs.syminfo_prefix=ns(Dd(Qs)),zs.syminfo_exchange=ns(Dd(Qs)),zs.syminfo_description=ns(Dd(ji)),zs.syminfo_type=ns(Dd(qa)),zs.syminfo_currency=ns(Dd(_i)),zs.syminfo_timezone=ns(Dd(da)),zs.syminfo_session=ns(Dd(Ml)),zs.syminfo_session_extended=ns(Dd(kc)),zs.syminfo_isdelayed=ns(0);const Nl=ns(0),Gl=ns(0),uu=ns(0),Sc=ns(Kt>0?1:0),Cc=ns(0),du=ns(Kt>0?1:0),Gc=ns(Kt>0?1:0);if(Kt>0){Nl[0]=1,Gl[Kt-1]=1;const lt=Oe=>{const ct=typeof Oe=="number"?Oe:Number(Oe);return!Number.isFinite(ct)||ct<=0?0:ct<1e12?ct*1e3:ct},Be=Date.now(),p=lt(rl[Kt-1]??0),b=bi>0?bi*1e3:0,T=((Fg=s().options)==null?void 0:Fg.enableRealtime)===!0||r().playing===!0,z=Math.max(6e4,b>0?b*2:6e4),ie=T&&M.active&&M.lastUpdateAt>0&&Be-M.lastUpdateAt<=z,Ne=b>0&&p>0?Be<p+b:ie;if(ie){Ne&&(Cc[Kt-1]=1,du[Kt-1]=0),Sc[Kt-1]=Ne?0:1,Gc.fill(0);const Oe=M.lastNewBarIndex>=0?M.lastNewBarIndex:Kt-1;Oe>=0&&Oe<Kt&&(Gc[Oe]=1);const ct=Ne?Kt-2:Kt-1;ct>=0&&(uu[ct]=1)}else uu[Kt-1]=1}zs.barstate_isfirst=Nl,zs.barstate_islast=Gl,zs.barstate_islastconfirmedhistory=uu,zs.barstate_isconfirmed=Sc,zs.barstate_isrealtime=Cc,zs.barstate_ishistory=du,zs.barstate_isnew=Gc,Object.entries(zs).forEach(([lt,Be])=>{ys[lt]=Be});const bl=Zl.some(lt=>String((lt==null?void 0:lt.source)||"").toLowerCase()==="__zero__");let fu=null;if(bl){fu=new Array(Kt);for(let lt=0;lt<Kt;(lt+=1)-1)fu[lt]=0}const Pd=[];try{const lt=(Yt||[]).filter(Be=>String((Be==null?void 0:Be.type)||"").toLowerCase()==="security");if(lt.length&&Kt>0){const Be=T=>{let z=String(T??"__CURRENT__");try{z=z.replace(/\$\{([^}]+)\}/g,(Ne,Oe)=>{var et;const ct=(Fo==null?void 0:Fo[Oe])??(Fo==null?void 0:Fo[(et=Oe==null?void 0:Oe.toLowerCase)==null?void 0:et.call(Oe)]);return ct==null?Ne:String(ct)});const ie=z.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(ie)){const Ne=(Fo==null?void 0:Fo[ie])??(Fo==null?void 0:Fo[ie.toLowerCase()]);Ne!=null&&(z=String(Ne))}}catch{}return z};if(lt.length>Gn.maxCalls)throw new Error("request.security: limit exceeded: too many calls");const p=new Set,b=new Set;for(const T of lt){const z=jo(T==null?void 0:T.symbol,T==null?void 0:T.country,Fo),ie=String((z==null?void 0:z.ticker)||"").trim(),Ne=String((z==null?void 0:z.country)||"").trim(),Oe=Ne?`${ie}@${Ne}`:ie;p.add(Oe||"__UNKNOWN__");const ct=String(Be((T==null?void 0:T.timeframe)||(T==null?void 0:T.tf)||"__CURRENT__")||"__CURRENT__"),et=ct==="__CURRENT__"?ql(((Lg=(Hg=s())==null?void 0:Hg.period)==null?void 0:Lg.timeframe)||"1m"):ct;b.add(String(et||"__CURRENT__"))}if(p.size>Gn.maxSymbols)throw new Error("request.security: limit exceeded: too many symbols");if(b.size>Gn.maxTimeframes)throw new Error("request.security: limit exceeded: too many timeframes");if(Kt>Gn.maxBars)throw new Error("request.security: limit exceeded: too many bars");for(const T of lt){const z=String((T==null?void 0:T.name)||"security").replace(/\s+/g,"_").toLowerCase();if(!z)continue;const ie=jo(T==null?void 0:T.symbol,T==null?void 0:T.country,Fo),Ne=String(Be((T==null?void 0:T.timeframe)||(T==null?void 0:T.tf)||"__CURRENT__")||"__CURRENT__"),Oe=Ne==="__CURRENT__"?((i0=(Eg=s())==null?void 0:Eg.period)==null?void 0:i0.timeframe)||"1m":qc(Ne),ct=Uc.get(z),et=(ct==null?void 0:ct.pipelineTf)||Oe,Vt=(ct==null?void 0:ct.computeTf)||(Ne==="__CURRENT__"?ql(((hg=($g=s())==null?void 0:$g.period)==null?void 0:hg.timeframe)||"1m"):Ne),rn=!!(ct!=null&&ct.lower||T!=null&&T.lower),kn=String((ie==null?void 0:ie.ticker)||"").trim(),Is=String((ie==null?void 0:ie.country)||"").trim(),Sn=jl(Vt);if(rn&&Bl>0&&Sn>0&&Sn>=Bl){if(!i(un)){const Tl=String(((C_=(kh=s())==null?void 0:kh.period)==null?void 0:C_.timeframe)||"");x(un,`request.security_lower_tf: "${Vt}" must be lower than chart timeframe "${Tl}"`)}ys[z]=new Array(Kt),Pd.push(z);continue}const Ao=et&&et!=="__CURRENT__"?`${kn}${Is?`@${Is}`:""}|${et}`:"",Io=et&&et!=="__CURRENT__"?on.has(Ao)?on.get(Ao):(()=>{const Tl=A.getHistorySnapshot(ie,et);return on.set(Ao,Tl),Tl})():null,go=Io?Io.candles:null,so=Number(rl[0]??0),es=Number(rl[Kt-1]??0);if(et&&et!=="__CURRENT__"){const Tl=mm=>{const lp=typeof mm=="number"?mm:Number(mm);return!Number.isFinite(lp)||lp<=0?0:lp<1e12?lp*1e3:lp},xu=Tl(so),Uf=Tl(es),Sh=go&&go.length>=2,sh=go&&go.length?Number(((Af=go[0])==null?void 0:Af.timestamp)??((nh=go[0])==null?void 0:nh.time)??((qg=go[0])==null?void 0:qg.t)??0):0,V0=go&&go.length?Number(((k0=go[go.length-1])==null?void 0:k0.timestamp)??((I_=go[go.length-1])==null?void 0:I_.time)??((Iy=go[go.length-1])==null?void 0:Iy.t)??0):0,Ug=Tl((Io==null?void 0:Io.oldestTimestampLoaded)??sh),Ch=Tl((Io==null?void 0:Io.newestTimestampLoaded)??V0),Dg=Sh&&xu>0&&Uf>0&&Ug>0&&Ch>0&&Ug<=Uf&&Ch>=xu,em=Dg&&Ug<=xu&&Ch>=Uf;if(!Sh||!Dg){const mm=String((ie==null?void 0:ie.ticker)||""),lp=String((ie==null?void 0:ie.country)||"");if(Io!=null&&Io.error)i(un)||x(un,`request.security: ${mm}${lp?`@${lp}`:""} (${et}) error: ${Io.error}`);else if(Io!=null&&Io.isComplete){if(!i(un)){const Tm=!Sh||!(go&&go.length);if(rn&&Tm){const oh=Bl>0?Math.round(Bl/60):0;x(un,`request.security error: request.security: lower timeframe "${Vt}" is not available from current chart data${oh?` (base ~${oh}m)`:""}. Switch chart timeframe lower or provide lower-TF datafeed.`)}else x(un,V(Tm?`request.security: no data for ${mm}${lp?`@${lp}`:""} (${et})`:`request.security: no overlap for ${mm}${lp?`@${lp}`:""} (${et})`))}}else if(i(Rt)==="Running..."||i(Rt)==="Plotted from Pine"||i(Rt)==="Plotted from DSL"){const Tm=Io!=null&&Io.oldestTimestampLoaded?new Date(Io.oldestTimestampLoaded).toISOString().slice(0,10):"?",oh=Io!=null&&Io.newestTimestampLoaded?new Date(Io.newestTimestampLoaded).toISOString().slice(0,10):"?";x(Rt,`Loading request.security: ${mm}${lp?`@${lp}`:""} (${et})… loaded ${Tm}→${oh}`)}ys[z]=new Array(Kt),Pd.push(z);continue}if(!em&&!(Io!=null&&Io.error)&&!(Io!=null&&Io.isComplete)&&(i(Rt)==="Running..."||i(Rt)==="Plotted from Pine"||i(Rt)==="Plotted from DSL")){const mm=String((ie==null?void 0:ie.ticker)||""),lp=String((ie==null?void 0:ie.country)||""),Tm=Io!=null&&Io.oldestTimestampLoaded?new Date(Io.oldestTimestampLoaded).toISOString().slice(0,10):"?",oh=Io!=null&&Io.newestTimestampLoaded?new Date(Io.newestTimestampLoaded).toISOString().slice(0,10):"?";x(Rt,`Loading request.security (partial): ${mm}${lp?`@${lp}`:""} (${et})… loaded ${Tm}→${oh}`)}}const bo=String((T==null?void 0:T.expr)||"close"),Ir=Fi?e1(bo,{pineV2:!0}).expr:String(bo??"").trim(),Ja=String((T==null?void 0:T.lookahead)||"off").toLowerCase(),zl=Ja==="on"||Ja.includes("on")&&!Ja.includes("off")?"on":"off",Kc=String((T==null?void 0:T.gaps)||"off").toLowerCase(),bu=Kc==="on"||Kc.includes("on")&&!Kc.includes("off")?"on":"off",oc=`${Nr[Kt-1]??""}|${Vi[Kt-1]??""}|${Ho[Kt-1]??""}|${Ar[Kt-1]??""}|${ma[Kt-1]??""}`,gf=go&&go.length?Number(((P_=go[0])==null?void 0:P_.timestamp)??((Py=go[0])==null?void 0:Py.time)??0):0,lr=go&&go.length?Number(((M_=go[go.length-1])==null?void 0:M_.timestamp)??((My=go[go.length-1])==null?void 0:My.time)??0):0,ed=String((ie==null?void 0:ie.timezone)||(ie==null?void 0:ie.sessionTimezone)||((Ny=s())==null?void 0:Ny.timezone)||"UTC"),Qf=No(ie)||No(Vs)||"",Ou=`sym=${kn}${Is?`@${Is}`:""}|tf=${Vt}|srcTf=${et}|srcLen=${go?go.length:0}|src0=${gf}|srcN=${lr}|la=${zl}|gaps=${bu}|lower=${rn?1:0}|expr=${Ir}|len=${Kt}|t0=${so}|tN=${es}|tail=${oc}|tz=${ed}|session=${Qf}`,Al=ls.get(Ou),_f=Al&&Al.len===Kt&&Al.firstTime===so&&Al.lastTime===es&&Al.tailSig===oc?Al.out:(()=>{const Tl=fR({timestamps:rl,open:Nr,high:Vi,low:Ho,close:Ar,volume:ma,sourceCandles:go||void 0,timeframe:Vt,expr:bo,lookahead:zl,gaps:bu,scalars:Fo,userFunctions:S==null?void 0:S.userFunctions,timezone:ed,session:Qf,allowLowerTfFallback:!rn});return ls.set(Ou,{out:Tl,len:Kt,firstTime:so,lastTime:es,tailSig:oc}),Tl})();try{let Tl=!1;const xu=Math.max(0,Kt-250);for(let Uf=Kt-1;Uf>=xu;(Uf-=1)+1){const Sh=_f[Uf];if(Sh!=null&&Number.isFinite(Sh)){Tl=!0;break}}if(!Tl&&!i(un)){const Uf=String((ie==null?void 0:ie.ticker)||""),Sh=String((ie==null?void 0:ie.country)||"");x(Rt,`request.security: no overlap for ${Uf}${Sh?`@${Sh}`:""} (${et}) — try a more recent chart range or switch chart timeframe`)}}catch{}ys[z]=_f,Pd.push(z)}}}catch(lt){const Be=(lt==null?void 0:lt.message)!=null?String(lt.message):String(lt);console.error("[ScriptStudio] request.security error",lt),i(un)||x(un,`request.security error: ${Be}`)}const hf=()=>{if(Cs.length&&Kt>0)try{const lt={open:new Float32Array(Kt),high:new Float32Array(Kt),low:new Float32Array(Kt),close:new Float32Array(Kt),volume:new Float32Array(Kt),time:new Float32Array(Kt),bar_index:new Float32Array(Kt)};for(let b=0;b<Kt;(b+=1)-1)lt.open[b]=Nr[b]??NaN,lt.high[b]=Vi[b]??NaN,lt.low[b]=Ho[b]??NaN,lt.close[b]=Ar[b]??NaN,lt.volume[b]=ma[b]??0,lt.time[b]=rl[b]??0,lt.bar_index[b]=Cr[b]??b;const Be=b=>{if(!lt[b]){if(b==="hl2"){const T=new Float32Array(Kt);for(let z=0;z<Kt;(z+=1)-1){const ie=Vi[z],Ne=Ho[z];T[z]=ie==null||Ne==null?NaN:(ie+Ne)/2}lt[b]=T}else if(b==="hlc3"){const T=new Float32Array(Kt);for(let z=0;z<Kt;(z+=1)-1){const ie=Vi[z],Ne=Ho[z],Oe=Ar[z];T[z]=ie==null||Ne==null||Oe==null?NaN:(ie+Ne+Oe)/3}lt[b]=T}else if(b==="ohlc4"){const T=new Float32Array(Kt);for(let z=0;z<Kt;(z+=1)-1){const ie=Nr[z],Ne=Vi[z],Oe=Ho[z],ct=Ar[z];T[z]=ie==null||Ne==null||Oe==null||ct==null?NaN:(ie+Ne+Oe+ct)/4}lt[b]=T}}};Fo&&typeof Fo=="object"&&Object.entries(Fo).forEach(([b,T])=>{if(typeof T!="string")return;const z=String(b).replace(/\s+/g,"_").toLowerCase(),ie=String(T).replace(/\s+/g,"_").toLowerCase();Be(ie);const Ne=lt[ie];if(Ne){lt[z]=Ne;const Oe=new Array(Kt);for(let ct=0;ct<Kt;(ct+=1)-1){const et=Ne[ct];Oe[ct]=Number.isFinite(et)?et:void 0}ys[z]=Oe}});for(const b of Pd){const T=ys[b];if(!T)continue;const z=new Float32Array(Kt);for(let ie=0;ie<Kt;(ie+=1)-1)z[ie]=T[ie]??NaN;lt[b]=z}Object.entries(zs).forEach(([b,T])=>{if(!T)return;const z=new Float32Array(Kt);for(let ie=0;ie<Kt;(ie+=1)-1)z[ie]=T[ie]??NaN;lt[b]=z});const p=__(Cs.map((b,T)=>({name:String(b.name||`series_${T}`),expr:Us(String(b.expr||"").replace(/\$\{([^}]+)\}/g,(z,ie)=>String(Fo[ie]??z)))})),lt,Fo,Pu.get(he),je,{loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});Object.entries(p).forEach(([b,T])=>{const z=b.replace(/\s+/g,"_").toLowerCase(),ie=new Array(Kt);for(let Ne=0;Ne<Kt;(Ne+=1)-1)ie[Ne]=T[Ne];ys[z]=ie})}catch(lt){const Be=(lt==null?void 0:lt.message)!=null?String(lt.message):String(lt);console.error("[ScriptStudio] expression engine error",lt),i(un)||x(un,`Expression error: ${Be}`),i(Rt)||x(Rt,"Expression error")}bJ({seriesMap:ys,calcDefs:Yt,len:Kt,params:Fo,lastPrevSource:Jt,resolveNum:Lo,onError:(lt,Be)=>{Be&&console.error("[ScriptStudio] expr eval error",Be),i(un)||x(un,V(lt)),i(Rt)||x(Rt,"Expression error")}})};if(Kt>0&&(yn.length||Yt.length||Wt.length)){const lt={...zs};if(Pd.length&&Pd.forEach(p=>{const b=ys[p];b&&(lt[p]=b)}),fu&&(lt.__zero__=fu),Yi&&Object.entries(Yi).forEach(([p,b])=>{!Array.isArray(b)||b.length!==Kt||(lt[p]=b)}),(()=>{const p=/\bstrategy[._](closedtrades|opentrades)[._]/i,b=T=>p.test(String(T??""));return!!(yn.some(T=>b(T==null?void 0:T.expr))||Wt.some(T=>b(T==null?void 0:T.initExpr)||b(T==null?void 0:T.updateExpr)||b(T==null?void 0:T.expr))||Yt.some(T=>b(T==null?void 0:T.expr)||b(T==null?void 0:T.when)))})())hf();else try{const p=`${H}_rt_${Kt}_${Number.isFinite(_s)?_s:0}`,b=mi?"calc_only":"full",T=await ef({id:p,base:{open:Nr,high:Vi,low:Ho,close:Ar,volume:ma,time:rl},calc:Yt,series:yn,stateSeries:Wt,params:Fo,extraSeries:lt,stage:b,autoSortStateSeries:At,loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});T.diagnostics&&Ee.size>=0&&T.diagnostics.forEach(ie=>{const Ne=String(ie||"").trim();Ne&&(Ee.has(Ne)||Ee.set(Ne,ie))});const z=T.seriesMap||{};Object.keys(ys).forEach(ie=>delete ys[ie]),Object.entries(z).forEach(([ie,Ne])=>{ys[ie]=Ne}),T.lastPrevSource&&Object.assign(Jt,T.lastPrevSource),tr=b==="full"}catch(p){console.warn("[ScriptStudio] runtime worker fallback",p),hf()}}else hf();if(bl){if(!fu){fu=new Array(Kt);for(let lt=0;lt<Kt;(lt+=1)-1)fu[lt]=0}ys.__zero__=fu}if($t.pane==="sub"){const lt=new Set,Be=new Set;Zl.forEach(b=>{const T=(b.source||b.name||"").replace(/\s+/g,"_").toLowerCase();T&&lt.add(T),String(b.type||"").toLowerCase()==="histogram"&&T&&Be.add(T)}),($t.labels||[]).forEach(b=>{const T=((b==null?void 0:b.source)||(b==null?void 0:b.name)||"").replace(/\s+/g,"_").toLowerCase();T&&lt.add(T)}),(Ay=$t.fills)==null||Ay.forEach(b=>{(Array.isArray(b==null?void 0:b.between)?b.between:[]).forEach(z=>{const ie=String(z||"").replace(/\s+/g,"_").toLowerCase();ie&&lt.add(ie)})});const p=(b,T)=>{let z=1/0,ie=-1/0;for(let et=0;et<b.length;(et+=1)-1){const Vt=b[et];Vt==null||Number.isNaN(Vt)||(Vt<z&&(z=Vt),Vt>ie&&(ie=Vt))}const Ne=ie-z;if(!(ie>200||z<-50||Ne>200))return b;const ct=new Array(b.length);if(Ne>1e-8){for(let et=0;et<b.length;(et+=1)-1){const Vt=b[et];ct[et]=Vt==null?void 0:(Vt-z)/Ne*100}return ct}if(T){for(let et=0;et<b.length;(et+=1)-1){const Vt=b[et],rn=T[et];ct[et]=Vt==null||rn===void 0||rn===null||rn===0?void 0:Vt/rn*50+50}return ct}return b};!vr&&!Il&&lt.forEach(b=>{ys[b]&&!Be.has(b)&&!/hist|macd|signal/i.test(b)&&(ys[b]=p(ys[b],ys.close))})}if(!tr&&Cs.length&&Kt>0)try{const lt=new Set(Cs.map((b,T)=>String((b==null?void 0:b.name)||`series_${T}`).replace(/\s+/g,"_").toLowerCase()).filter(Boolean)),Be={};Object.entries(ys).forEach(([b,T])=>{const z=String(b||"").replace(/\s+/g,"_").toLowerCase();if(lt.has(z))return;const ie=new Float32Array(Kt);for(let Ne=0;Ne<Kt;(Ne+=1)-1)ie[Ne]=T[Ne]??NaN;Be[z]=ie});const p=__(Cs.map((b,T)=>({name:String(b.name||`series_${T}`),expr:Us(String(b.expr||"").replace(/\$\{([^}]+)\}/g,(z,ie)=>String(Fo[ie]??z)))})),Be,Fo,Pu.get(he),je,{loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});Object.entries(p).forEach(([b,T])=>{const z=b.replace(/\s+/g,"_").toLowerCase(),ie=new Array(Kt);for(let Ne=0;Ne<Kt;(Ne+=1)-1)ie[Ne]=T[Ne];ys[z]=ie})}catch(lt){const Be=(lt==null?void 0:lt.message)!=null?String(lt.message):String(lt);console.error("[ScriptStudio] expression engine error (2nd pass)",lt),i(un)||x(un,`Expression error: ${Be}`),i(Rt)||x(Rt,"Expression error")}const yu=Wt.filter(lt=>/^__arr_/i.test(String((lt==null?void 0:lt.name)||""))),Bf=Wt.filter(lt=>!/^__arr_/i.test(String((lt==null?void 0:lt.name)||"")));if(!tr&&yu.length&&Kt>0)try{const lt={};Object.entries(ys).forEach(([p,b])=>{const T=String(p||"").replace(/\s+/g,"_").toLowerCase(),z=new Float32Array(Kt);for(let ie=0;ie<Kt;(ie+=1)-1)z[ie]=b[ie]??NaN;lt[T]=z});const Be=Dk(yu.map((p,b)=>({name:String((p==null?void 0:p.name)||`state_${b}`),initExpr:(p==null?void 0:p.initExpr)!=null?Us(String(p.initExpr).replace(/\$\{([^}]+)\}/g,(T,z)=>String(Fo[z]??T))):void 0,updateExpr:Us(String((p==null?void 0:p.updateExpr)??(p==null?void 0:p.expr)??"").replace(/\$\{([^}]+)\}/g,(T,z)=>String(Fo[z]??T))),selfMode:p==null?void 0:p.selfMode})),lt,Fo,Pu.get(he),{autoSort:At,diagnostics:je,loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});Object.entries(Be).forEach(([p,b])=>{const T=p.replace(/\s+/g,"_").toLowerCase(),z=new Array(Kt);for(let ie=0;ie<Kt;(ie+=1)-1)z[ie]=b[ie];ys[T]=z})}catch(lt){const Be=(lt==null?void 0:lt.message)!=null?String(lt.message):String(lt);console.error("[ScriptStudio] state series error",lt),i(un)||x(un,`Expression error: ${Be}`),i(Rt)||x(Rt,"Expression error")}if(!tr&&Ks.length&&Kt>0)try{const lt=new Set(Ks.map((b,T)=>String((b==null?void 0:b.name)||`series_${T}`).replace(/\s+/g,"_").toLowerCase()).filter(Boolean)),Be={};Object.entries(ys).forEach(([b,T])=>{const z=String(b||"").replace(/\s+/g,"_").toLowerCase();if(lt.has(z))return;const ie=new Float32Array(Kt);for(let Ne=0;Ne<Kt;(Ne+=1)-1)ie[Ne]=T[Ne]??NaN;Be[z]=ie});const p=__(Ks.map((b,T)=>({name:String(b.name||`series_${T}`),expr:Us(String(b.expr||"").replace(/\$\{([^}]+)\}/g,(z,ie)=>String(Fo[ie]??z)))})),Be,Fo,Pu.get(he),je,{loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});Object.entries(p).forEach(([b,T])=>{const z=b.replace(/\s+/g,"_").toLowerCase(),ie=new Array(Kt);for(let Ne=0;Ne<Kt;(Ne+=1)-1)ie[Ne]=T[Ne];ys[z]=ie})}catch(lt){const Be=(lt==null?void 0:lt.message)!=null?String(lt.message):String(lt);console.error("[ScriptStudio] expression engine error (array pass)",lt),i(un)||x(un,`Expression error: ${Be}`),i(Rt)||x(Rt,"Expression error")}if(!tr&&Bf.length&&Kt>0)try{const lt={};Object.entries(ys).forEach(([p,b])=>{const T=String(p||"").replace(/\s+/g,"_").toLowerCase(),z=new Float32Array(Kt);for(let ie=0;ie<Kt;(ie+=1)-1)z[ie]=b[ie]??NaN;lt[T]=z});const Be=Dk(Bf.map((p,b)=>({name:String((p==null?void 0:p.name)||`state_${b}`),initExpr:(p==null?void 0:p.initExpr)!=null?Us(String(p.initExpr).replace(/\$\{([^}]+)\}/g,(T,z)=>String(Fo[z]??T))):void 0,updateExpr:Us(String((p==null?void 0:p.updateExpr)??(p==null?void 0:p.expr)??"").replace(/\$\{([^}]+)\}/g,(T,z)=>String(Fo[z]??T))),selfMode:p==null?void 0:p.selfMode})),lt,Fo,Pu.get(he),{autoSort:At,diagnostics:je,loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});Object.entries(Be).forEach(([p,b])=>{const T=p.replace(/\s+/g,"_").toLowerCase(),z=new Array(Kt);for(let ie=0;ie<Kt;(ie+=1)-1)z[ie]=b[ie];ys[T]=z})}catch(lt){const Be=(lt==null?void 0:lt.message)!=null?String(lt.message):String(lt);console.error("[ScriptStudio] state series error",lt),i(un)||x(un,`Expression error: ${Be}`),i(Rt)||x(Rt,"Expression error")}Yi&&Object.entries(Yi).forEach(([lt,Be])=>{const p=String(lt||"").replace(/\s+/g,"_").toLowerCase();!Array.isArray(Be)||Be.length!==Kt||(ys[p]=Be)});const Su={};D.forEach(lt=>{Su[lt.key]=new Array(Kt)});const Yc=new Array(Kt),ea=[];for(let lt=0;lt<Kt;(lt+=1)-1){const Be={};Zl.forEach((b,T)=>{const z=Bo[T]||D[T].key,ie=(b.source||b.name||"").replace(/\s+/g,"_").toLowerCase(),Ne=ys[ie]||ys[z]||ys.close,Oe=Lo(b==null?void 0:b.offset,void 0,0),ct=Number.isFinite(Oe)?Math.trunc(Oe):0,et=lt-ct,Vt=Lo((b==null?void 0:b.showLast)??(b==null?void 0:b.show_last),void 0,NaN),rn=Number.isFinite(Vt)?Math.max(0,Math.floor(Vt)):0,Is=(!rn||lt>=Kt-rn)&&et>=0&&et<Ne.length?Ne[et]:void 0;Be[z]=Is,Su[z][lt]=Is}),Be.__open=ys.open[lt],Be.__close=ys.close[lt],Be.__high=ys.high[lt],Be.__low=ys.low[lt],W.length&&W.forEach(b=>{const T=ys[b.openKey]||ys.open,z=ys[b.highKey]||ys.high,ie=ys[b.lowKey]||ys.low,Ne=ys[b.closeKey]||ys.close;if(!T||!z||!ie||!Ne)return;const Oe=Number.isFinite(b.offset)?b.offset:0,ct=lt-Oe,et=Number.isFinite(b.showLast)?b.showLast:0,Vt=!et||lt>=Kt-et,rn=kn=>Vt&&ct>=0&&ct<kn.length?kn[ct]:void 0;Be[`${b.key}__open`]=rn(T),Be[`${b.key}__high`]=rn(z),Be[`${b.key}__low`]=rn(ie),Be[`${b.key}__close`]=rn(Ne)}),Yc[lt]=Be;const p=((Ty=U[lt])==null?void 0:Ty.timestamp)??((c1=U[lt])==null?void 0:c1.time)??((Fy=U[lt])==null?void 0:Fy.t);if(typeof p=="number"){const b=String(p);Ha[b]=Be,ki[b]=lt;const T=p<1e12?Math.floor(p*1e3):Math.floor(p);ea.push(T),ki[`${T}_ms`]=lt,ki[`${Math.floor(T/1e3)}_s`]=lt}}let qf=0;if(ea.length>=2){let lt=0;for(let Be=1;Be<ea.length;(Be+=1)-1)lt+=Math.abs(ea[Be]-ea[Be-1]);qf=lt/(ea.length-1)}const dd=[];Zl.forEach((lt,Be)=>{if(!(lt!=null&&lt.trackPrice))return;const p=Bo[Be]||D[Be].key,b=Su[p];if(!b||!b.length)return;let T=NaN;for(let z=b.length-1;z>=0;(z-=1)+1){const ie=b[z];if(ie!=null&&Number.isFinite(ie)){T=ie;break}}Number.isFinite(T)&&dd.push({value:T,color:lt.color||"#94a3b8",width:1,style:"dashed"})}),$t._trackLevels=dd;const pl={},vf=lt=>{const Be=new Float32Array(Kt);for(let p=0;p<Kt;(p+=1)-1){const b=lt[p];Be[p]=b??NaN}return Be};Object.entries(ys).forEach(([lt,Be])=>{pl[lt.replace(/\s+/g,"_").toLowerCase()]=vf(Be)}),Object.entries(Su).forEach(([lt,Be])=>{pl[lt]=vf(Be)}),Yi&&Object.entries(Yi).forEach(([lt,Be])=>{Array.isArray(Be)&&(pl[lt]||(pl[lt]=vf(Be)))});try{Object.entries(j).forEach(([lt,Be])=>{const p=String(lt||"").replace(/\s+/g,"_").toLowerCase(),b=String(Be||"");!p||!b||pl[p]||pl[b]&&(pl[p]=pl[b])})}catch{}{const lt=Object.keys(pl);for(const Be of lt){if(!Be.includes("_"))continue;const p=Be.replace(/_/g,"");!p||p===Be||pl[p]||(pl[p]=pl[Be])}}const lc=new Map,Pf=new Map,Gd=new Map,af=new Map,fd="condition must be bool or number",Td=lt=>{let Be=String(lt||"").replace(/\$\{([^}]+)\}/g,(b,T)=>String(Fo[T]??b));Be=Be.replace(/\/\/.*$/,"").replace(/#.*$/,""),Be=Be.split(";")[0],Be=Be.replace(/[,;]+\s*$/,""),Be=Be.replace(/\b(and|or)\b\s*$/i,""),Be=Be.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),Be=Be.replace(/\bcrosses\s+below\b/gi,"crossesBelow");const p=Us(Be);return t2(p)},vp=lt=>{const Be=Td(lt);if(!Be)return null;const p=Gd.get(Be);if(p)return p;try{const b=Lp(Be);return Gd.set(Be,b),b}catch{return null}},Xa=lt=>{const Be=Td(lt);if(!Be)return!1;const p=af.get(Be);if(p!=null)return p;const b=vp(lt),T=b?o0(b):!1;return af.set(Be,T),T},Ju=lt=>{const Be=Td(lt);if(!Be)return null;const p=lc.get(Be);if(p)return p;try{const b=yb(Be,pl,Fo,Pu.get(he),je);return lc.set(Be,b),b}catch(b){const T=(b==null?void 0:b.message)!=null?String(b.message):String(b);return i(un)||x(un,`Expression error: ${T}`),i(Rt)||x(Rt,"Expression error"),null}},Bp=lt=>{const Be=Td(lt);if(!Be)return null;const p=Pf.get(Be);if(p)return p;if(ne&&Xa(lt)){je==null||je.emitOnce(`cond_type:${Be}`,fd);const ie=new Uint8Array(Kt);return Pf.set(Be,ie),ie}const b=Ju(lt);if(!b)return null;const T=new Uint8Array(Kt),z=ne?`cond_na:${Be}`:"";for(let ie=0;ie<Kt;(ie+=1)-1){const Ne=b[ie];T[ie]=ne?y0(Ne,je,z)?1:0:Number.isFinite(Ne)&&Ne!==0?1:0}return Pf.set(Be,T),T},Zf=(lt,Be)=>{const p=String(lt||"").trim(),b=String(Be||"").trim(),T=p||b;return T?Bp(T):null};if(ti&&!ci&&yn.length){try{const Be=yn.map(p=>String((p==null?void 0:p.name)||"")).map(p=>p.replace(/\s+/g,"_").toLowerCase()).filter(Boolean).filter(p=>!(p in ys));if(Be.length){const p=`Missing series: ${Be.slice(0,6).join(", ")}${Be.length>6?", ...":""}`;x(un,V(i(un)?`${i(un)} • ${p}`:p))}}catch{}ci=!0}const ap=[],wp=new Map,fm=new Map,Fc=lt=>Us(String(lt||"").replace(/\$\{([^}]+)\}/g,(Be,p)=>String(Fo[p]??Be))),Mf=lt=>Dn(String(lt||"").replace(/\$\{([^}]+)\}/g,(Be,p)=>String(Fo[p]??Be))),Sp=lt=>{const Be=Mf(lt);if(!Be)return null;const p=wp.get(Be);if(p)return p;try{const b=jk(Be,pl,Fo,Pu.get(he),je);return wp.set(Be,b),b}catch(b){const T=(b==null?void 0:b.message)!=null?String(b.message):String(b);return i(un)||x(un,`Expression error: ${T}`),i(Rt)||x(Rt,"Expression error"),null}},qp=lt=>{const Be=Fc(lt);if(!Be)return null;const p=fm.get(Be);if(p)return p;try{const b=yb(Be,pl,Fo,Pu.get(he),je);return fm.set(Be,b),b}catch(b){const T=(b==null?void 0:b.message)!=null?String(b.message):String(b);return i(un)||x(un,`Expression error: ${T}`),i(Rt)||x(Rt,"Expression error"),null}},Up=(lt,Be,p)=>{if(!lt)return p;const b=lt[Be];if(b==null)return p;const T=String(b);return T||p},th=(lt,Be,p)=>{if(!lt)return p;const b=lt[Be];return Number.isFinite(b)?b:p};if(i(yr)&&Array.isArray(k)&&k.length){const lt=ne?Fe.labels:((Ly=S==null?void 0:S.style)==null?void 0:Ly.labelLimit)??((Ey=$t==null?void 0:$t.style)==null?void 0:Ey.labelLimit)??($t==null?void 0:$t.labelLimit),Be=(()=>{const z=typeof lt=="number"?lt:Number(lt);return Number.isFinite(z)?Math.max(0,Math.floor(z)):600})();let p=0,b=!1,T=!1;for(const z of k){if(b)break;if(!z)continue;const ie=String(z.whenExpr||"").trim(),Ne=String(z.when||"").trim();if(!ie&&!Ne)continue;const Oe=!ne&&String(z.shape||"").toLowerCase()==="text"&&String(z.text||"").trim().length<=1;let ct;const et=Zf(ie,Ne);if(!et)continue;ct=et;const Vt=(z.source||z.name||"").replace(/\s+/g,"_").toLowerCase(),rn=Vt==="open"||Vt==="high"||Vt==="low"||Vt==="close"||Vt==="volume"||Vt==="time",kn=j[Vt],Is=kn||((N_=D[0])==null?void 0:N_.key);if(!Oe&&(Be===0||p>=Be)){ne&&!T&&(dt("labels",Be),T=!0),b=!0;break}const Sn=[];for(let Ou=0;Ou<Kt;(Ou+=1)-1)ct[Ou]&&Sn.push(Ou);if(!Sn.length)continue;const Ao=Oe?Sn.length:Math.max(0,Be-p);if(Ao<=0){ne&&!T&&(dt("labels",Be),T=!0),Oe||(b=!0);break}!Oe&&Sn.length>Ao&&ne&&!T&&(dt("labels",Be),T=!0);const Io=Sn.length<=Ao?Sn:(()=>{const Ou=Math.max(1,Math.ceil(Sn.length/Ao)),Al=[];for(let _f=Sn.length-1;_f>=0&&Al.length<Ao;_f-=Ou)Al.push(Sn[_f]);return Al.sort((_f,Tl)=>_f-Tl),Al})(),go=String(z.textExpr||"").trim(),so=go?Sp(go):null,es=String(z.colorExpr||"").trim(),bo=es?Sp(es):null,Ir=String(z.bgColorExpr||"").trim(),Ja=Ir?Sp(Ir):null,zl=String(z.borderColorExpr||"").trim(),Kc=zl?Sp(zl):null,bu=String(z.textColorExpr||"").trim(),oc=bu?Sp(bu):null,gf=String(z.sizeExpr||"").trim(),lr=gf?qp(gf):null,ed=String(z.offsetYExpr||"").trim(),Qf=ed?qp(ed):null;for(const Ou of Io){if(!Oe&&p>=Be){b=!0;break}const Al=Yc[Ou]||(Yc[Ou]={});let _f=(Vt&&ys[Vt]?ys[Vt][Ou]:void 0)??(kn?Al[kn]:void 0)??(Is?Al[Is]:void 0);if($t.pane==="sub"&&rn&&Is&&Al[Is]!==void 0&&Al[Is]!==null&&Number.isFinite(Al[Is])&&(_f=Al[Is]),$t.pane==="sub"&&typeof $t.min=="number"&&typeof $t.max=="number"&&rn&&typeof _f=="number"&&Number.isFinite(_f)&&(_f<$t.min-5||_f>$t.max+5)&&(_f=Is?Al[Is]:_f),_f==null||Number.isNaN(_f)){const lp=j.__zero__||"__zero__",Tm=Al[lp];_f=Tm??0}const Tl=rn&&Vt||Is,xu=`__label_${Tl}_${z.position||"above"}`,Uf=z.text!=null?String(z.text):so?String(so[Ou]??""):"",Sh=Up(bo,Ou,z.color||"#f97316"),sh=Up(Ja,Ou,z.bgColor),V0=Up(Kc,Ou,z.borderColor),Ug=Up(oc,Ou,z.textColor),Ch=th(lr,Ou,z.size),Dg=th(Qf,Ou,z.offsetY);Al[xu]={text:Uf,color:Sh,yKey:Tl,position:z.position||"above",offset:z.offset,value:_f,shape:z.shape,callout:z.callout,bgColor:sh,bgGradient:z.bgGradient??z.gradient,borderColor:V0,textColor:Ug,size:Ch,offsetY:Dg,wrap:z.wrap,maxWidth:z.maxWidth,padding:z.padding,bgOpacity:z.bgOpacity,borderWidth:z.borderWidth,radius:z.radius,align:z.align,valign:z.valign,lineHeight:z.lineHeight,fontFamily:z.fontFamily,fontSize:z.fontSize,fontWeight:z.fontWeight,monospace:z.monospace};const em=((A_=U[Ou])==null?void 0:A_.timestamp)??(($y=U[Ou])==null?void 0:$y.time)??((Dy=U[Ou])==null?void 0:Dy.t),mm=typeof em=="number"&&Number.isFinite(em)?em<1e12?Math.floor(em*1e3):Math.floor(em):void 0;ap.push({index:Ou,ts:em,tsMs:mm,meta:Al[xu]}),Oe||(p+=1);try{Y5("label",{pane:$t.pane,index:Ou,meta:Al[xu]})}catch{}}}}const Nm=new Map,zh=new Map,Sv=new Map,Nf=new Map,Qu=/\b(?:line|label|box|table)_get_[a-z0-9_]+\s*\(/i;let Op=null;const Vh=lt=>Us(String(lt||"").replace(/\$\{([^}]+)\}/g,(Be,p)=>String(Fo[p]??Be))),pd=lt=>Dn(String(lt||"").replace(/\$\{([^}]+)\}/g,(Be,p)=>String(Fo[p]??Be))),te=(lt,Be)=>{const p=Vh(lt);if(!p)return null;const b=Nm.get(p);if(b)return b;const T=p.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(T){const z=T[0].replace(/\s+/g,"_").toLowerCase(),ie=pl==null?void 0:pl[z];if(ie)return Nm.set(p,ie),ie;const Ne=(ys==null?void 0:ys[z])??(Yi?Yi[z]:void 0);if(Array.isArray(Ne)){const Oe=vf(Ne);return pl[z]=Oe,Nm.set(p,Oe),Oe}}try{const z=yb(p,pl,Fo,Pu.get(he),je);return Nm.set(p,z),z}catch(z){const ie=(z==null?void 0:z.message)!=null?String(z.message):String(z);return i(un)||x(un,`Expression error: ${ie}`),i(Rt)||x(Rt,"Expression error"),null}},nn=(lt,Be)=>{const p=pd(lt);if(!p)return null;const b=zh.get(p);if(b)return b;try{const T=jk(p,pl,Fo,Pu.get(he),je);return zh.set(p,T),T}catch(T){const z=(T==null?void 0:T.message)!=null?String(T.message):String(T);return i(un)||x(un,`Expression error: ${z}`),i(Rt)||x(Rt,"Expression error"),null}},mt=lt=>{const Be=Vh(lt);if(!Be)return null;let p=Sv.get(Be);if(p)return p;try{return p=Lp(Be),Sv.set(Be,p),p}catch(b){const T=(b==null?void 0:b.message)!=null?String(b.message):String(b);return i(un)||x(un,`Expression error: ${T}`),i(Rt)||x(Rt,"Expression error"),null}},pn=(lt,Be,p)=>{if(!Op)return null;const b=mt(lt);if(!b)return null;try{return YD(b,pl,Fo,p,Op,Pu.get(he),je)}catch(T){const z=(T==null?void 0:T.message)!=null?String(T.message):String(T);return i(un)||x(un,`Expression error: ${z}`),i(Rt)||x(Rt,"Expression error"),null}},Nt=(lt,Be,p)=>{const b=pn(lt,Be,p);return b!=null&&Number.isFinite(b)?b:void 0},Ps=(lt,Be,p)=>{const b=pd(lt);if(!b||!Op)return"";let T=Nf.get(b);if(!T)try{T=Lp(b),Nf.set(b,T)}catch(z){const ie=(z==null?void 0:z.message)!=null?String(z.message):String(z);return i(un)||x(un,`Expression error: ${ie}`),i(Rt)||x(Rt,"Expression error"),""}try{return KD(T,pl,Fo,p,Op,Pu.get(he))}catch(z){const ie=(z==null?void 0:z.message)!=null?String(z.message):String(z);return i(un)||x(un,`Expression error: ${ie}`),i(Rt)||x(Rt,"Expression error"),""}},Nn=new Set,hs=lt=>{const Be=lt;Nn.has(Be)||(Nn.add(Be),console.warn(lt))},ss=new Set,Ln=lt=>{ss.has(lt)||(ss.add(lt),ne&&(je==null||je.emitOnce(lt,lt)),x(un,V(i(un)?`${i(un)} • ${lt}`:lt)),i(Rt)||x(Rt,"Expression error"))},tn=(lt,Be,p)=>{const b=(p==null?void 0:p.kind)==="label"?"label":(p==null?void 0:p.kind)==="box"?"box":"line",T=ne&&((p==null?void 0:p.kind)==="line"||(p==null?void 0:p.kind)==="label"||(p==null?void 0:p.kind)==="box"),z=(p==null?void 0:p.kind)==="polyline"||(p==null?void 0:p.kind)==="polygon"||(p==null?void 0:p.kind)==="path",ie=Be??"bar_index";if(T){if(ie==="time"){if(!Number.isFinite(lt))return Ln(`${b} x must be a number when xloc=time`),null}else if(!Number.isInteger(lt))return Ln(`${b} x must be an integer when xloc=bar_index`),null}return Hk({xVal:lt,xloc:ie,len:Kt,timeSeriesMs:ea,tsIndex:ki,config:{mode:st.time.mode,toleranceBars:st.time.toleranceBars,toleranceMs:st.time.toleranceMs,futureBars:st.futureBars,avgIntervalMs:qf,strictXloc:T,allowFloatIndex:z},warn:hs,meta:p})},Ws=(lt,Be)=>{const p=[];if(lt)for(let z=0;z<Kt;(z+=1)-1)lt[z]&&p.push(z);else for(let z=0;z<Kt;(z+=1)-1)p.push(z);if(p.length<=Be)return p;const b=Math.max(1,Math.ceil(p.length/Be)),T=[];for(let z=p.length-1;z>=0&&T.length<Be;z-=b)T.push(p[z]);return T.sort((z,ie)=>z-ie),T},Hs=lt=>{if(typeof lt!="string")return;const Be=lt.trim().toLowerCase();if(Be==="background"||Be==="bg")return"background";if(Be==="main"||Be==="base")return"main";if(Be==="overlay"||Be==="over")return"overlay";if(Be==="ui")return"ui"},As=lt=>{if(typeof lt=="number"&&Number.isFinite(lt))return lt;if(typeof lt=="string"){const Be=Number(lt);return Number.isFinite(Be)?Be:void 0}},Ls=lt=>{if(typeof lt=="boolean")return lt;if(typeof lt=="number")return Number.isFinite(lt)?lt!==0:void 0;if(typeof lt=="string"){const Be=lt.trim().toLowerCase();if(Be==="true")return!0;if(Be==="false")return!1;const p=Number(Be);if(Number.isFinite(p))return p!==0}},js=[],ks=[],Jn=[],En=[],Wi=Math.max(Kt-1+st.futureBars,Kt-1),ml=[],Qo=[],po=[],aa=lt=>{if(Number.isFinite(lt)&&!(lt<=0))return Math.min(64,lt)},Za=lt=>{if(Number.isFinite(lt))return Math.max(0,Math.min(1,lt))};let Lc=null,Na=null;if(oi.length){const lt=new Map,Be=zt=>{const mn=String(zt||"").trim();return mn?mn.replace(/\s+/g,"_").toLowerCase():null},p=ne?Be(String(((Ry=S==null?void 0:S.params)==null?void 0:Ry.__scriptId)??(S==null?void 0:S.id)??(S==null?void 0:S.name)??(S==null?void 0:S.title)??""))||"script":"";Lc=`${Be(String((S==null?void 0:S.id)??(S==null?void 0:S.name)??H))}_${$t.pane}_${Gs}`||H;const b=vt.get(Lc)??new Map;vt.set(Lc,b),Na=jt.get(Lc)??{created:{},updated:{},pruned:{}};const T=(zt,mn)=>{const K=Na[mn][zt]??0;Na[mn][zt]=K+1},z=(zt,mn)=>`${zt}:${mn}`,ie=new Map,Ne=new Map,Oe=(zt,mn)=>{const K=Be(zt);return K?mn.get(K)||K:null},ct=(zt,mn)=>{if(!mn)return null;const K=z(zt,mn),lo=ie.get(K);if(lo)return lo;const Me={__handle:!0,kind:zt,id:mn,key:K};return ie.set(K,Me),Me},et=(zt,mn)=>{const K=Be(zt);K&&mn&&Ne.set(K,mn)},Vt=(zt,mn)=>{const K=Be(zt);if(!K)return null;const lo=Ne.get(K);return!lo||mn&&lo.kind!==mn?null:lo},rn=(zt,mn,K,lo)=>{const Me=Vt(K,zt);if(Me)return Me;const kt=Vt(mn,zt);if(kt)return kt;const Ss=Oe(mn,lo);if(!Ss)return null;const vn=ct(zt,Ss);return vn&&et(mn,vn),vn},kn=(zt,mn,K,lo)=>{var Me;return((Me=rn(zt,mn,K,lo))==null?void 0:Me.id)??null},Is=(zt,mn,K)=>{const lo=String(zt||"").trim(),Me=String(mn||"").trim(),kt=lo||Me;if(!kt)return!0;const Ss=Vh(kt);if(Ss&&Qu.test(Ss)){if(ne){const xl=mt(Ss);if(xl&&o0(xl))return je==null||je.emitOnce(`cond_type:${Ss}`,fd),!1;const Ec=pn(Ss,"when",K);return Ec==null?!1:y0(Ec,je,`cond_na:${Ss}`)}const Bi=Nt(Ss,"when",K);return Number.isFinite(Bi)&&Bi!==0}let vn=lt.get(kt);return vn||(vn=Zf(lo,Me),lt.set(kt,vn)),vn?!!vn[K]:!1},Sn=(zt,mn,K)=>{if(!zt)return;const lo=String(zt||"").trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(lo)){const vn=zn(lo),Bi=ys[vn]??(Yi?Yi[vn]:void 0);if(Bi){const xl=Bi[K];return Number.isFinite(xl)?xl:void 0}}const Me=Vh(String(zt));if(Me&&Qu.test(Me))return Nt(Me,mn,K);const kt=te(String(zt));if(!kt)return;const Ss=kt[K];return Number.isFinite(Ss)?Ss:void 0},Ao=(zt,mn,K,lo)=>{if(zt!=null)return String(zt);if(!mn)return"";const Me=pd(String(mn));if(Me&&Qu.test(Me))return Ps(Me,K,lo);const kt=nn(mn);return kt?String(kt[lo]??""):""},Io=24,go=80,so=(zt,mn)=>{const K=String(zt??"");return!ne||K.length<=mn?K:mn<=1?"…":`${K.slice(0,Math.max(0,mn-1))}…`},es=zt=>{if(!ne)return zt;if(Number.isFinite(zt)){if(!Number.isInteger(zt)||zt<1){je==null||je.emitOnce("line_width_int","line width must be an integer >= 1");return}return zt}},bo=zt=>{if(!ne)return zt;if(Number.isFinite(zt)){if(!Number.isInteger(zt)){je==null||je.emitOnce("label_size_int","label size must be an integer");return}return Math.max(8,Math.min(32,zt))}},Ir=zt=>{if(!ne)return zt;if(!Number.isFinite(zt))return;const mn=Math.round(Number(zt));return Math.max(0,Math.min(4,mn))},Ja=zt=>{if(!ne)return zt;if(Number.isFinite(zt)){if(!Number.isInteger(zt)){je==null||je.emitOnce("box_text_size_int","box text_size must be an integer");return}return Math.max(8,Math.min(32,zt))}},zl=zt=>{if(!ne)return zt;if(Number.isFinite(zt)){if(!Number.isInteger(zt)){je==null||je.emitOnce("box_border_width_int","box border_width must be an integer between 0 and 4");return}return Math.max(0,Math.min(4,zt))}},Kc=zt=>ne?zt||"rgba(0,0,0,0)":zt,bu=zt=>ne?zt||"rgba(0,0,0,0)":zt,oc=zt=>{if(Array.isArray(zt)){const mn=zt.map(K=>String(K||"").trim().toLowerCase()).filter(Boolean);return mn.length?mn:void 0}if(typeof zt=="string"){const mn=zt.split(",").map(K=>K.trim().toLowerCase()).filter(Boolean);return mn.length?mn:void 0}},gf=(zt,mn,K)=>{if(!zt)return;mn&&(zt.groupId=mn);const lo=oc(K);lo&&(zt.tags=lo)},lr={line:new Set,label:new Set,box:new Set},ed=(zt,mn,K)=>{if(!ne)return;const lo=`${mn}:${K}`,Me=lr[zt];if(Me.has(lo))return;Me.add(lo);const kt=`${zt} is deleted`;x(un,V(i(un)?`${i(un)} • ${kt}`:kt)),i(Rt)||x(Rt,"Expression error")},Qf=(zt,mn)=>{ne&&(zt==="line"&&u1.add(mn),zt==="label"&&d1.add(mn),zt==="box"&&W0.add(mn))},Ou=(zt,mn)=>ne?zt==="line"?u1.has(mn):zt==="label"?d1.has(mn):zt==="box"?W0.has(mn):!1:!1,Al=zt=>{if(!ne||_6)return;_6=!0;const mn=`line limit reached: ${zt} (skipping new lines)`;x(un,V(i(un)?`${i(un)} • ${mn}`:mn)),i(Rt)||x(Rt,"Expression error")},_f=zt=>{if(!ne||v6)return;v6=!0;const mn=`label limit reached: ${zt} (skipping new labels)`;x(un,V(i(un)?`${i(un)} • ${mn}`:mn)),i(Rt)||x(Rt,"Expression error")},Tl=zt=>{if(!ne||g6)return;g6=!0;const mn=`box limit reached: ${zt} (skipping new boxes)`;x(un,V(i(un)?`${i(un)} • ${mn}`:mn)),i(Rt)||x(Rt,"Expression error")},xu=zt=>String(zt??"").trim().toLowerCase(),Uf=(zt,mn)=>mn?ie.get(z(zt,mn)):null,Sh=(zt,mn,K,lo,Me,kt)=>{if(!mn||lo&&lo!==zt)return!1;const Ss=Uf(zt,mn),vn=xu(Me);if(vn&&xu((K==null?void 0:K.groupId)??(Ss==null?void 0:Ss.groupId))!==vn)return!1;const Bi=xu(kt);if(Bi){const xl=oc((K==null?void 0:K.tags)??(Ss==null?void 0:Ss.tags))??(Ss!=null&&Ss.tags?oc(Ss.tags):void 0);if(!xl||!xl.includes(Bi))return!1}return!0},sh=(zt,mn)=>{var Me;if(!mn)return;const K=z(zt,mn);if(ie.get(K)){ie.delete(K);const kt=Gp==null?void 0:Gp[zt];(Me=kt==null?void 0:kt.delete)==null||Me.call(kt,mn);for(const[vn,Bi]of Ne.entries())(Bi==null?void 0:Bi.key)===K&&Ne.delete(vn);for(const[vn,Bi]of b.entries())(Bi==null?void 0:Bi.key)===K&&b.delete(vn);const Ss=vn=>{for(const[Bi,xl]of vn.entries())xl===mn&&vn.delete(Bi)};zt==="line"&&Ss(em),zt==="linefill"&&Ss(mm),zt==="label"&&Ss(lp),zt==="box"&&Ss(Tm),zt==="table"&&Ss(oh),zt==="polyline"&&Ss(S0),zt==="polygon"&&Ss(r0),zt==="path"&&Ss(a0)}},V0=(zt,mn,K)=>{mn<=0||console.warn(`[ScriptStudio] ${zt} limit ${K} reached; pruned ${mn} via ${st.pruningPolicy} policy`)},Ug=(zt,mn,K)=>{if(st.pruningPolicy==="lru"){const lo=Gp[K];return zt.slice().sort((Me,kt)=>(lo.get(Me)??Number.MIN_SAFE_INTEGER)-(lo.get(kt)??Number.MIN_SAFE_INTEGER))}if(st.pruningPolicy==="byGroup"){const lo=new Map;return zt.forEach((Me,kt)=>{var vn;const Ss=((vn=mn.get(Me))==null?void 0:vn.groupId)||"";lo.has(Ss)||lo.set(Ss,kt)}),zt.slice().sort((Me,kt)=>{var Ec,Ta;const Ss=((Ec=mn.get(Me))==null?void 0:Ec.groupId)||"",vn=((Ta=mn.get(kt))==null?void 0:Ta.groupId)||"",Bi=lo.get(Ss)??0,xl=lo.get(vn)??0;return Bi!==xl?Bi-xl:zt.indexOf(Me)-zt.indexOf(kt)})}return zt.slice()},Ch=(zt,mn,K,lo)=>{const Me=[];if(zt.length<=K)return;const kt=Ug(zt,mn,lo);for(;zt.length>K&&kt.length;){const Ss=kt.shift();if(!Ss)continue;mn.delete(Ss);const vn=zt.indexOf(Ss);vn>=0&&zt.splice(vn,1),C0[lo].push(Ss),sh(lo,Ss),Me.push(Ss),T(lo,"pruned")}Me.length&&V0(lo,Me.length,K)},Dg=(zt,mn,K,lo,Me)=>{const kt=[];if(!zt||!zt.length)return kt;for(const Ss of zt){if(!Ss)continue;const vn=Sn(Ss.x,`${lo}.x`,Me),Bi=Sn(Ss.y,`${lo}.y`,Me);vn==null||Bi==null||kt.push({x:vn,y:Bi,xloc:Ss.xloc||mn,yloc:Ss.yloc||K})}return kt},em=new Map,mm=new Map,lp=new Map,Tm=new Map,oh=new Map,S0=new Map,r0=new Map,a0=new Map,ev=new Map,md=new Map,sd=new Map,Xc=new Map,ep=new Map,Of=new Map,ih=new Map,hm=new Map,u1=new Set,d1=new Set,W0=new Set,f1=[],p1=[],m1=[],h1=[],l_=[],v1=[],g1=[],_1=[],Gp={line:new Map,linefill:new Map,label:new Map,box:new Map,table:new Map,polyline:new Map,polygon:new Map,path:new Map},C0={line:[],linefill:[],label:[],box:[],table:[],polyline:[],polygon:[],path:[]},Jy=()=>ev.size+md.size+sd.size+Xc.size+ep.size+Of.size+ih.size+hm.size,H0=(zt,mn,K,lo)=>!ne||!lo?!1:Rg!=null&&Jy()>=Rg?(dt("runtime draws",Rg),!0):mn!=null&&mn>0&&K>=mn?(dt(zt,mn),!0):!1;let eC=0,tC=0,nC=0,Qy=0,eb=0,v6=!1,tb=0,g6=!1,_6=!1,y1=0,b1=0,x1=0,w1=0,k1=0,S1=0,C1=0,I1=0;b.forEach((zt,mn)=>{if(!zt||!zt.key)return;ie.set(zt.key,zt),Ne.set(mn,zt);const K=zt.id;if(K){if(zt.kind==="line"){em.set(mn,K);const lo=K.match(/line_(\d+)/);lo&&(y1=Math.max(y1,Number(lo[1])))}else if(zt.kind==="linefill"){mm.set(mn,K);const lo=K.match(/linefill_(\d+)/);lo&&(b1=Math.max(b1,Number(lo[1])))}else if(zt.kind==="label"){lp.set(mn,K);const lo=K.match(/label_(\d+)/);lo&&(x1=Math.max(x1,Number(lo[1])))}else if(zt.kind==="box"){Tm.set(mn,K);const lo=K.match(/box_(\d+)/);lo&&(w1=Math.max(w1,Number(lo[1])))}else if(zt.kind==="table"){oh.set(mn,K);const lo=K.match(/table_(\d+)/);lo&&(k1=Math.max(k1,Number(lo[1])))}else if(zt.kind==="polyline"){S0.set(mn,K);const lo=K.match(/polyline_(\d+)/);lo&&(S1=Math.max(S1,Number(lo[1])))}else if(zt.kind==="polygon"){r0.set(mn,K);const lo=K.match(/polygon_(\d+)/);lo&&(C1=Math.max(C1,Number(lo[1])))}else if(zt.kind==="path"){a0.set(mn,K);const lo=K.match(/path_(\d+)/);lo&&(I1=Math.max(I1,Number(lo[1])))}}});const P1=ne?Fe.lines:st.limits.line||240,nb=ne?Fe.labels:st.limits.label||300,y6=ne?Fe.boxes:st.limits.box||180,b6=st.limits.table||20,sC=st.limits.linefill||120,oC=st.limits.polyline||180,iC=st.limits.polygon||160,rC=st.limits.path||160,Rg=ne?Fe.runtimeDraws:null;Op={get:(zt,mn,K,lo)=>{const Me=String(mn||"").toLowerCase().replace(/[^a-z0-9]/g,""),kt=Be(String(K||""));if(kt){if(zt==="line"){const Ss=kn("line",kt,kt,em),vn=ev.get(Ss);return vn?Me==="x1"?Number.isFinite(vn.x1)?vn.x1:NaN:Me==="y1"?Number.isFinite(vn.y1)?vn.y1:NaN:Me==="x2"?Number.isFinite(vn.x2)?vn.x2:NaN:Me==="y2"?Number.isFinite(vn.y2)?vn.y2:NaN:Me==="width"||Me==="linewidth"?Number.isFinite(vn.width)?vn.width:NaN:Me==="color"?vn.color??"":Me==="style"?vn.style??"":Me==="extend"?vn.extend??"":Me==="xloc"?vn.xloc??"":void 0:void 0}if(zt==="label"){const Ss=kn("label",kt,kt,lp),vn=sd.get(Ss);return vn?Me==="x"?Number.isFinite(vn.x)?vn.x:NaN:Me==="y"?Number.isFinite(vn.y)?vn.y:NaN:Me==="size"?Number.isFinite(vn.size)?vn.size:NaN:Me==="text"?vn.text??"":Me==="color"?vn.color??"":Me==="textcolor"?vn.textColor??"":Me==="style"?vn.shape??"":Me==="yloc"?vn.yloc??"":Me==="xloc"?vn.xloc??"":Me==="textalign"?vn.textAlign??"":Me==="tooltip"?vn.tooltip??"":void 0:void 0}if(zt==="box"){const Ss=kn("box",kt,kt,Tm),vn=Xc.get(Ss);return vn?Me==="left"?Number.isFinite(vn.left)?vn.left:NaN:Me==="right"?Number.isFinite(vn.right)?vn.right:NaN:Me==="top"?Number.isFinite(vn.top)?vn.top:NaN:Me==="bottom"?Number.isFinite(vn.bottom)?vn.bottom:NaN:Me==="borderwidth"?Number.isFinite(vn.borderWidth)?vn.borderWidth:NaN:Me==="textsize"?Number.isFinite(vn.textSize)?vn.textSize:NaN:Me==="textwrap"?vn.textWrap?1:0:Me==="bgcolor"?vn.bgColor??"":Me==="bordercolor"?vn.borderColor??"":Me==="borderstyle"?vn.borderStyle??"":Me==="text"?vn.text??"":Me==="textcolor"?vn.textColor??"":Me==="texthalign"?vn.textHalign??"":Me==="textvalign"?vn.textValign??"":Me==="extend"?vn.extend??"":Me==="xloc"?vn.xloc??"":void 0:void 0}if(zt==="table"){const Ss=kn("table",kt,kt,oh),vn=ep.get(Ss);return vn?Me==="position"?vn.position??"":Me==="columns"?Number.isFinite(vn.columns)?vn.columns:NaN:Me==="rows"?Number.isFinite(vn.rows)?vn.rows:NaN:Me==="borderwidth"?Number.isFinite(vn.borderWidth)?vn.borderWidth:NaN:Me==="framewidth"?Number.isFinite(vn.frameWidth)?vn.frameWidth:NaN:Me==="textsize"?Number.isFinite(vn.textSize)?vn.textSize:NaN:Me==="bgcolor"?vn.bgcolor??"":Me==="bordercolor"?vn.borderColor??"":Me==="textcolor"?vn.textColor??"":Me==="texthalign"?vn.textHalign??"":Me==="textvalign"?vn.textValign??"":Me==="framecolor"?vn.frameColor??"":void 0:void 0}}}};let Fm=0;for(let zt=0;zt<Kt;(zt+=1)-1)for(let mn=0;mn<oi.length;(mn+=1)-1){const K=oi[mn];if(Fm+=1,!K||!Is(K.whenExpr,K.when,zt))continue;const lo=`${K.kind}:${mn}`;if(K.kind==="line_new"){const Me=Be(K.assign),kt=Me?Ne.get(Me):null,Ss=Me?em.get(Me):null,vn=Ss?ev.get(Ss):null;if(K.once&&Me&&Ss&&vn)continue;const Bi=ne?!0:!vn;if(ne&&Bi){if(Rg!=null&&Jy()>=Rg){dt("runtime draws",Rg);continue}if(Qy>=P1){dt("lines",P1),Al(P1);continue}}else if(H0("lines",P1,ev.size,Bi))continue;const xl=Sn(K.x1,"line.x1",zt),Ec=Sn(K.y1,"line.y1",zt),Ta=Sn(K.x2,"line.x2",zt),gu=Sn(K.y2,"line.y2",zt);if(xl==null||Ec==null||Ta==null||gu==null)continue;const tf=C0.line.shift(),$c=ne?`pline:${p}:${(eC+=1)-1}`:null,lf=$c||(kt==null?void 0:kt.id)||Ss||tf||`line_${y1+=1}`;if(!$c){const vg=lf.match(/line_(\d+)/);vg&&(y1=Math.max(y1,Number(vg[1])))}const Tf=K.width??Sn(K.widthExpr,"line.width",zt)??void 0,ei=es(Tf),cc=aa(K.glow),Ih=Za(K.glowOpacity),jg=K.glowColor,I0=Hs(K.layer),M1=As(K.zIndex),Wv=Ls(K.includeInAutoscale),Cv=kt&&kt.id===lf?kt:ct("line",lf);gf(Cv,K.groupId,oc(K.tags)),ev.set(lf,{x1:xl,y1:Ec,x2:Ta,y2:gu,color:K.color,gradient:K.gradient,width:ei,glow:cc,glowColor:jg,glowOpacity:Ih,style:K.style,extend:K.extend,xloc:K.xloc,layer:I0,zIndex:M1,includeInAutoscale:Wv,groupId:K.groupId??(Cv==null?void 0:Cv.groupId),tags:oc(K.tags)??(Cv==null?void 0:Cv.tags)}),Gp.line.set(lf,Fm),T("line",Bi?"created":"updated"),f1.push(lf),Ch(f1,ev,P1,"line"),ne&&(Qy=ev.size),Me&&Cv&&(em.set(Me,lf),et(Me,Cv),b.set(Me,Cv));continue}if(K.kind==="line_set"){const Me=kn("line",K.target,K.targetExpr,em);if(!Me)continue;if(ne&&Ou("line",Me)){ed("line",Me,lo);continue}const kt=ev.get(Me);if(!kt)continue;const Ss=Sn(K.x1,"line.set_x1",zt),vn=Sn(K.y1,"line.set_y1",zt),Bi=Sn(K.x2,"line.set_x2",zt),xl=Sn(K.y2,"line.set_y2",zt);if(Ss!=null&&(kt.x1=Ss),vn!=null&&(kt.y1=vn),Bi!=null&&(kt.x2=Bi),xl!=null&&(kt.y2=xl),K.color&&(kt.color=K.color),K.gradient&&(kt.gradient=K.gradient),K.width!=null||K.widthExpr){const Ec=K.width??Sn(K.widthExpr,"line.set_width",zt),Ta=es(Ec);Ta!=null&&(kt.width=Ta)}if(K.glow!=null){const Ec=aa(K.glow);Ec!=null&&(kt.glow=Ec)}if(K.glowOpacity!=null){const Ec=Za(K.glowOpacity);Ec!=null&&(kt.glowOpacity=Ec)}K.glowColor&&(kt.glowColor=K.glowColor),K.style&&(kt.style=K.style),K.extend&&(kt.extend=K.extend),K.xloc&&(kt.xloc=K.xloc),Gp.line.set(Me,Fm),T("line","updated");continue}if(K.kind==="line_delete"){const Me=kn("line",K.target,K.targetExpr,em);if(!Me)continue;ev.delete(Me);const kt=f1.indexOf(Me);kt>=0&&f1.splice(kt,1),ne?(Qf("line",Me),Qy=ev.size):sh("line",Me);continue}if(K.kind==="linefill_new"){const Me=Be(K.assign),kt=Me?Ne.get(Me):null,Ss=Me?mm.get(Me):null,vn=Ss?md.get(Ss):null;if(K.once&&Me&&Ss&&vn)continue;const Bi=!vn;if(H0("runtime draws",null,md.size,Bi))continue;const xl=kn("line",K.line1,K.line1,em),Ec=kn("line",K.line2,K.line2,em);if(!xl||!Ec)continue;const Ta=C0.linefill.shift(),gu=(kt==null?void 0:kt.id)||Ss||Ta||`linefill_${b1+=1}`,tf=gu.match(/linefill_(\d+)/);tf&&(b1=Math.max(b1,Number(tf[1])));const $c=Hs(K.layer),lf=As(K.zIndex),Tf=Ls(K.includeInAutoscale),ei=kt??ct("linefill",gu);gf(ei,K.groupId,oc(K.tags)),md.set(gu,{line1:xl,line2:Ec,color:K.color,layer:$c,zIndex:lf,includeInAutoscale:Tf,groupId:K.groupId??(ei==null?void 0:ei.groupId),tags:oc(K.tags)??(ei==null?void 0:ei.tags)}),Gp.linefill.set(gu,Fm),T("linefill",vn?"updated":"created"),p1.push(gu),Ch(p1,md,sC,"linefill"),Me&&ei&&(mm.set(Me,gu),et(Me,ei),b.set(Me,ei));continue}if(K.kind==="linefill_set"){const Me=kn("linefill",K.target,K.targetExpr,mm);if(!Me)continue;const kt=md.get(Me);if(!kt)continue;if(K.color&&(kt.color=K.color),K.line1){const Ss=kn("line",K.line1,K.line1,em);Ss&&(kt.line1=Ss)}if(K.line2){const Ss=kn("line",K.line2,K.line2,em);Ss&&(kt.line2=Ss)}Gp.linefill.set(Me,Fm),T("linefill","updated");continue}if(K.kind==="linefill_delete"){const Me=kn("linefill",K.target,K.targetExpr,mm);if(!Me)continue;md.delete(Me);const kt=p1.indexOf(Me);kt>=0&&p1.splice(kt,1),sh("linefill",Me);continue}if(K.kind==="label_new"){const Me=Be(K.assign),kt=Me?Ne.get(Me):null,Ss=Me?lp.get(Me):null,vn=Ss?sd.get(Ss):null;if(K.once&&Me&&Ss&&vn)continue;const Bi=ne?!0:!vn;if(ne&&Bi){if(Rg!=null&&Jy()>=Rg){dt("runtime draws",Rg);continue}if(eb>=we){dt("labels",we),_f(we);continue}}else if(H0("labels",nb,sd.size,Bi))continue;const xl=Sn(K.x,"label.x",zt),Ec=Sn(K.y,"label.y",zt);if(xl==null||Ec==null)continue;const Ta=C0.label.shift(),gu=ne?`plabel:${p}:${(tC+=1)-1}`:null,tf=gu||(kt==null?void 0:kt.id)||Ss||Ta||`label_${x1+=1}`;if(!gu){const x6=tf.match(/label_(\d+)/);x6&&(x1=Math.max(x1,Number(x6[1])))}const $c=K.size??Sn(K.sizeExpr,"label.size",zt)??void 0,lf=bo($c),Tf=K.padding,ei=K.radius??Sn(K.radiusExpr,"label.radius",zt),cc=K.maxWidth??Sn(K.maxWidthExpr,"label.max_width",zt),Ih=K.borderWidth??Sn(K.borderWidthExpr,"label.border_width",zt),jg=ne?Ir(Ih)??0:Ih,I0=K.lineHeight??Sn(K.lineHeightExpr,"label.line_height",zt),M1=Hs(K.layer),Wv=As(K.zIndex),Cv=Ls(K.includeInAutoscale),vg=kt&&kt.id===tf?kt:ct("label",tf);gf(vg,K.groupId,oc(K.tags));const aC=Ao(K.text,K.textExpr,"label.text",zt),lC=Ao(K.tooltip,K.tooltipExpr,"label.tooltip",zt);sd.set(tf,{x:xl,y:Ec,text:so(aC,Io),color:K.color,textColor:K.textColor,shape:K.style,size:lf,xloc:K.xloc,yloc:K.yloc,textAlign:K.textAlign,tooltip:so(lC,go),wrap:ne?!1:K.wrap,maxWidth:ne?void 0:cc,padding:Tf,bgColor:Kc(K.bgColor),bgGradient:K.bgGradient??K.gradient,bgOpacity:K.bgOpacity,borderColor:bu(K.borderColor),borderWidth:jg,radius:ei,align:K.align,valign:K.valign,lineHeight:I0,fontFamily:K.fontFamily,fontSize:K.fontSize,fontWeight:K.fontWeight,monospace:K.monospace,pineV2:ne||void 0,layer:M1,zIndex:Wv,includeInAutoscale:Cv,groupId:K.groupId??(vg==null?void 0:vg.groupId),tags:oc(K.tags)??(vg==null?void 0:vg.tags)}),Gp.label.set(tf,Fm),T("label",Bi?"created":"updated"),m1.push(tf),Ch(m1,sd,nb,"label"),ne&&(eb=sd.size),Me&&vg&&(lp.set(Me,tf),et(Me,vg),b.set(Me,vg));continue}if(K.kind==="label_set"){const Me=kn("label",K.target,K.targetExpr,lp);if(!Me)continue;if(ne&&Ou("label",Me)){ed("label",Me,lo);continue}const kt=sd.get(Me);if(!kt)continue;const Ss=Sn(K.x,"label.set_x",zt),vn=Sn(K.y,"label.set_y",zt);if(Ss!=null&&(kt.x=Ss),vn!=null&&(kt.y=vn),K.text!=null||K.textExpr){const Bi=Ao(K.text,K.textExpr,"label.set_text",zt);kt.text=so(Bi,Io)}if(K.color&&(kt.color=K.color),K.textColor&&(kt.textColor=K.textColor),K.style&&(kt.shape=K.style),K.size!=null||K.sizeExpr){const Bi=K.size??Sn(K.sizeExpr,"label.set_size",zt);Bi!=null&&(kt.size=bo(Bi))}if(K.yloc&&(kt.yloc=K.yloc),K.textAlign&&(kt.textAlign=K.textAlign),K.tooltip!=null||K.tooltipExpr){const Bi=Ao(K.tooltip,K.tooltipExpr,"label.set_tooltip",zt);kt.tooltip=so(Bi,go)}K.xloc&&(kt.xloc=K.xloc),!ne&&K.wrap!=null&&(kt.wrap=K.wrap),!ne&&K.maxWidth!=null&&(kt.maxWidth=K.maxWidth),K.padding!=null&&(kt.padding=K.padding),K.bgColor&&(kt.bgColor=Kc(K.bgColor)),K.bgGradient?kt.bgGradient=K.bgGradient:K.gradient&&(kt.bgGradient=K.gradient),K.bgOpacity!=null&&(kt.bgOpacity=K.bgOpacity),K.borderColor&&(kt.borderColor=bu(K.borderColor)),K.borderWidth!=null&&(kt.borderWidth=Ir(K.borderWidth)),K.radius!=null&&(kt.radius=K.radius),K.align&&(kt.align=K.align),K.valign&&(kt.valign=K.valign),K.lineHeight!=null&&(kt.lineHeight=K.lineHeight),K.fontFamily&&(kt.fontFamily=K.fontFamily),K.fontSize!=null&&(kt.fontSize=K.fontSize),K.fontWeight&&(kt.fontWeight=K.fontWeight),K.monospace!=null&&(kt.monospace=K.monospace),Gp.label.set(Me,Fm),T("label","updated");continue}if(K.kind==="label_delete"){const Me=kn("label",K.target,K.targetExpr,lp);if(!Me)continue;sd.delete(Me);const kt=m1.indexOf(Me);kt>=0&&m1.splice(kt,1),ne?(eb=sd.size,Qf("label",Me)):sh("label",Me);continue}if(K.kind==="box_new"){const Me=Be(K.assign),kt=Me?Ne.get(Me):null,Ss=Me?Tm.get(Me):null,vn=Ss?Xc.get(Ss):null;if(K.once&&Me&&Ss&&vn)continue;const Bi=ne?!0:!vn;if(ne&&Bi){if(Rg!=null&&Jy()>=Rg){dt("runtime draws",Rg);continue}if(tb>=J){dt("boxes",J),Tl(J);continue}}else if(H0("boxes",y6,Xc.size,Bi))continue;const xl=Sn(K.left,"box.left",zt),Ec=Sn(K.right,"box.right",zt),Ta=Sn(K.top,"box.top",zt),gu=Sn(K.bottom,"box.bottom",zt);if(xl==null||Ec==null||Ta==null||gu==null)continue;const tf=C0.box.shift(),$c=ne?`pbox:${p}:${(nC+=1)-1}`:null,lf=$c||(kt==null?void 0:kt.id)||Ss||tf||`box_${w1+=1}`;if(!$c){const Cv=lf.match(/box_(\d+)/);Cv&&(w1=Math.max(w1,Number(Cv[1])))}const Tf=K.width??Sn(K.widthExpr,"box.border_width",zt)??void 0,ei=ne?zl(Tf):Tf,cc=K.textSize??Sn(K.textSizeExpr,"box.text_size",zt)??void 0,Ih=ne?Ja(cc):cc,jg=Hs(K.layer),I0=As(K.zIndex),M1=Ls(K.includeInAutoscale),Wv=kt??ct("box",lf);gf(Wv,K.groupId,oc(K.tags)),Xc.set(lf,{left:xl,right:Ec,top:Ta,bottom:gu,borderColor:K.borderColor,bgColor:K.bgColor,bgGradient:K.bgGradient??K.gradient,borderWidth:ei,borderStyle:K.borderStyle,text:Ao(K.text,K.textExpr,"box.text",zt),tooltip:Ao(K.tooltip,K.tooltipExpr,"box.tooltip",zt),textColor:K.textColor,textSize:Ih,textHalign:K.textHalign,textValign:K.textValign,textWrap:K.textWrap,extend:K.extend,xloc:K.xloc,layer:jg,zIndex:I0,includeInAutoscale:M1,groupId:K.groupId??(Wv==null?void 0:Wv.groupId),tags:oc(K.tags)??(Wv==null?void 0:Wv.tags)}),Gp.box.set(lf,Fm),T("box",Bi?"created":"updated"),h1.push(lf),Ch(h1,Xc,y6,"box"),ne&&(tb=Xc.size),Me&&Wv&&(Tm.set(Me,lf),et(Me,Wv),b.set(Me,Wv));continue}if(K.kind==="box_set"){const Me=kn("box",K.target,K.targetExpr,Tm);if(!Me)continue;if(ne&&Ou("box",Me)){ed("box",Me,lo);continue}const kt=Xc.get(Me);if(!kt)continue;const Ss=Sn(K.left,"box.set_left",zt),vn=Sn(K.right,"box.set_right",zt),Bi=Sn(K.top,"box.set_top",zt),xl=Sn(K.bottom,"box.set_bottom",zt);if(Ss!=null&&(kt.left=Ss),vn!=null&&(kt.right=vn),Bi!=null&&(kt.top=Bi),xl!=null&&(kt.bottom=xl),K.borderColor&&(kt.borderColor=K.borderColor),K.bgColor&&(kt.bgColor=K.bgColor),K.bgGradient?kt.bgGradient=K.bgGradient:K.gradient&&(kt.bgGradient=K.gradient),K.width!=null||K.widthExpr){const Ec=K.width??Sn(K.widthExpr,"box.set_border_width",zt),Ta=ne?zl(Ec):Ec;Ta!=null&&(kt.borderWidth=Ta)}if(K.borderStyle&&(kt.borderStyle=K.borderStyle),(K.text!=null||K.textExpr)&&(kt.text=Ao(K.text,K.textExpr,"box.set_text",zt)),K.textColor&&(kt.textColor=K.textColor),K.textSize!=null||K.textSizeExpr){const Ec=K.textSize??Sn(K.textSizeExpr,"box.set_text_size",zt),Ta=ne?Ja(Ec):Ec;Ta!=null&&(kt.textSize=Ta)}(K.tooltip!=null||K.tooltipExpr)&&(kt.tooltip=Ao(K.tooltip,K.tooltipExpr,"box.set_tooltip",zt)),K.textHalign&&(kt.textHalign=K.textHalign),K.textValign&&(kt.textValign=K.textValign),typeof K.textWrap=="boolean"&&(kt.textWrap=K.textWrap),K.extend&&(kt.extend=K.extend),K.xloc&&(kt.xloc=K.xloc),Gp.box.set(Me,Fm),T("box","updated");continue}if(K.kind==="box_delete"){const Me=kn("box",K.target,K.targetExpr,Tm);if(!Me)continue;Xc.delete(Me);const kt=h1.indexOf(Me);kt>=0&&h1.splice(kt,1),ne?(tb=Xc.size,Qf("box",Me)):sh("box",Me);continue}if(K.kind==="polyline_new"){const Me=Be(K.assign),kt=Me?Ne.get(Me):null,Ss=Me?S0.get(Me):null,vn=Ss?Of.get(Ss):null;if(K.once&&Me&&Ss&&vn)continue;const Bi=!vn;if(H0("runtime draws",null,Of.size,Bi))continue;const xl=Dg(K.points,K.xloc,K.yloc,"polyline.points",zt);if(!xl.length)continue;const Ec=C0.polyline.shift(),Ta=(kt==null?void 0:kt.id)||Ss||Ec||`polyline_${S1+=1}`,gu=Ta.match(/polyline_(\d+)/);gu&&(S1=Math.max(S1,Number(gu[1])));const tf=K.width??Sn(K.widthExpr,"polyline.width",zt)??void 0,$c=kt??ct("polyline",Ta);gf($c,K.groupId,oc(K.tags)),Of.set(Ta,{id:Ta,points:xl,color:K.color,gradient:K.gradient,width:tf,style:K.style,opacity:K.opacity,glow:aa(K.glow),glowColor:K.glowColor,glowOpacity:Za(K.glowOpacity),layer:Hs(K.layer),zIndex:As(K.zIndex),includeInAutoscale:Ls(K.includeInAutoscale),groupId:K.groupId??($c==null?void 0:$c.groupId),tags:oc(K.tags)??($c==null?void 0:$c.tags)}),Gp.polyline.set(Ta,Fm),T("polyline",vn?"updated":"created"),v1.push(Ta),Ch(v1,Of,oC,"polyline"),Me&&$c&&(S0.set(Me,Ta),et(Me,$c),b.set(Me,$c));continue}if(K.kind==="polyline_set"){const Me=kn("polyline",K.target,K.targetExpr,S0);if(!Me)continue;const kt=Of.get(Me);if(!kt)continue;if(K.points&&K.points.length){const vn=Dg(K.points,K.xloc,K.yloc,"polyline.set_points",zt);vn.length&&(kt.points=vn)}if(K.color&&(kt.color=K.color),K.gradient&&(kt.gradient=K.gradient),K.width!=null||K.widthExpr){const vn=K.width??Sn(K.widthExpr,"polyline.set_width",zt);vn!=null&&(kt.width=vn)}if(K.style&&(kt.style=K.style),K.opacity!=null&&(kt.opacity=K.opacity),K.glow!=null){const vn=aa(K.glow);vn!=null&&(kt.glow=vn)}if(K.glowOpacity!=null){const vn=Za(K.glowOpacity);vn!=null&&(kt.glowOpacity=vn)}K.glowColor&&(kt.glowColor=K.glowColor),K.layer&&(kt.layer=K.layer),K.zIndex!=null&&(kt.zIndex=K.zIndex),K.includeInAutoscale!=null&&(kt.includeInAutoscale=K.includeInAutoscale),K.groupId&&(kt.groupId=K.groupId);const Ss=oc(K.tags);Ss&&(kt.tags=Ss),Gp.polyline.set(Me,Fm),T("polyline","updated");continue}if(K.kind==="polyline_delete"){const Me=kn("polyline",K.target,K.targetExpr,S0);if(!Me)continue;Of.delete(Me);const kt=v1.indexOf(Me);kt>=0&&v1.splice(kt,1),sh("polyline",Me);continue}if(K.kind==="polygon_new"){const Me=Be(K.assign),kt=Me?Ne.get(Me):null,Ss=Me?r0.get(Me):null,vn=Ss?ih.get(Ss):null;if(K.once&&Me&&Ss&&vn)continue;const Bi=!vn;if(H0("runtime draws",null,ih.size,Bi))continue;const xl=Dg(K.points,K.xloc,K.yloc,"polygon.points",zt);if(xl.length<3)continue;const Ec=C0.polygon.shift(),Ta=(kt==null?void 0:kt.id)||Ss||Ec||`polygon_${C1+=1}`,gu=Ta.match(/polygon_(\d+)/);gu&&(C1=Math.max(C1,Number(gu[1])));const tf=K.strokeWidth??Sn(K.strokeWidthExpr,"polygon.stroke_width",zt)??void 0,$c=kt??ct("polygon",Ta);gf($c,K.groupId,oc(K.tags)),ih.set(Ta,{id:Ta,points:xl,fillColor:K.fillColor,fillGradient:K.fillGradient,strokeColor:K.strokeColor,strokeWidth:tf,strokeStyle:K.strokeStyle,opacity:K.opacity,glow:aa(K.glow),glowColor:K.glowColor,glowOpacity:Za(K.glowOpacity),layer:Hs(K.layer),zIndex:As(K.zIndex),includeInAutoscale:Ls(K.includeInAutoscale),groupId:K.groupId??($c==null?void 0:$c.groupId),tags:oc(K.tags)??($c==null?void 0:$c.tags)}),Gp.polygon.set(Ta,Fm),T("polygon",vn?"updated":"created"),g1.push(Ta),Ch(g1,ih,iC,"polygon"),Me&&$c&&(r0.set(Me,Ta),et(Me,$c),b.set(Me,$c));continue}if(K.kind==="polygon_set"){const Me=kn("polygon",K.target,K.targetExpr,r0);if(!Me)continue;const kt=ih.get(Me);if(!kt)continue;if(K.points&&K.points.length){const vn=Dg(K.points,K.xloc,K.yloc,"polygon.set_points",zt);vn.length>=3&&(kt.points=vn)}if(K.fillColor&&(kt.fillColor=K.fillColor),K.fillGradient&&(kt.fillGradient=K.fillGradient),K.strokeColor&&(kt.strokeColor=K.strokeColor),K.strokeWidth!=null||K.strokeWidthExpr){const vn=K.strokeWidth??Sn(K.strokeWidthExpr,"polygon.stroke_width",zt);vn!=null&&(kt.strokeWidth=vn)}if(K.strokeStyle&&(kt.strokeStyle=K.strokeStyle),K.opacity!=null&&(kt.opacity=K.opacity),K.glow!=null){const vn=aa(K.glow);vn!=null&&(kt.glow=vn)}if(K.glowOpacity!=null){const vn=Za(K.glowOpacity);vn!=null&&(kt.glowOpacity=vn)}K.glowColor&&(kt.glowColor=K.glowColor),K.layer&&(kt.layer=K.layer),K.zIndex!=null&&(kt.zIndex=K.zIndex),K.includeInAutoscale!=null&&(kt.includeInAutoscale=K.includeInAutoscale),K.groupId&&(kt.groupId=K.groupId);const Ss=oc(K.tags);Ss&&(kt.tags=Ss),Gp.polygon.set(Me,Fm),T("polygon","updated");continue}if(K.kind==="polygon_delete"){const Me=kn("polygon",K.target,K.targetExpr,r0);if(!Me)continue;ih.delete(Me);const kt=g1.indexOf(Me);kt>=0&&g1.splice(kt,1),sh("polygon",Me);continue}if(K.kind==="path_new"){const Me=Be(K.assign),kt=Me?Ne.get(Me):null,Ss=Me?a0.get(Me):null,vn=Ss?hm.get(Ss):null;if(K.once&&Me&&Ss&&vn)continue;const Bi=!vn;if(H0("runtime draws",null,hm.size,Bi))continue;const xl=Array.isArray(K.commands)&&K.commands.length?K.commands:(K.points||[]).map((lf,Tf)=>({cmd:Tf===0?"M":"L",x:lf.x,y:lf.y,xloc:lf.xloc||K.xloc,yloc:lf.yloc||K.yloc}));if(!xl.length)continue;const Ec=C0.path.shift(),Ta=(kt==null?void 0:kt.id)||Ss||Ec||`path_${I1+=1}`,gu=Ta.match(/path_(\d+)/);gu&&(I1=Math.max(I1,Number(gu[1])));const tf=K.width??Sn(K.widthExpr,"path.width",zt)??void 0,$c=kt??ct("path",Ta);gf($c,K.groupId,oc(K.tags)),hm.set(Ta,{id:Ta,commands:xl,color:K.color,gradient:K.gradient,width:tf,style:K.style,opacity:K.opacity,glow:aa(K.glow),glowColor:K.glowColor,glowOpacity:Za(K.glowOpacity),layer:Hs(K.layer),zIndex:As(K.zIndex),includeInAutoscale:Ls(K.includeInAutoscale),groupId:K.groupId??($c==null?void 0:$c.groupId),tags:oc(K.tags)??($c==null?void 0:$c.tags)}),Gp.path.set(Ta,Fm),T("path",vn?"updated":"created"),_1.push(Ta),Ch(_1,hm,rC,"path"),Me&&$c&&(a0.set(Me,Ta),et(Me,$c),b.set(Me,$c));continue}if(K.kind==="path_set"){const Me=kn("path",K.target,K.targetExpr,a0);if(!Me)continue;const kt=hm.get(Me);if(!kt)continue;if(K.commands&&K.commands.length&&(kt.commands=K.commands),K.color&&(kt.color=K.color),K.gradient&&(kt.gradient=K.gradient),K.width!=null||K.widthExpr){const vn=K.width??Sn(K.widthExpr,"path.set_width",zt);vn!=null&&(kt.width=vn)}if(K.style&&(kt.style=K.style),K.opacity!=null&&(kt.opacity=K.opacity),K.glow!=null){const vn=aa(K.glow);vn!=null&&(kt.glow=vn)}if(K.glowOpacity!=null){const vn=Za(K.glowOpacity);vn!=null&&(kt.glowOpacity=vn)}K.glowColor&&(kt.glowColor=K.glowColor),K.layer&&(kt.layer=K.layer),K.zIndex!=null&&(kt.zIndex=K.zIndex),K.includeInAutoscale!=null&&(kt.includeInAutoscale=K.includeInAutoscale),K.groupId&&(kt.groupId=K.groupId);const Ss=oc(K.tags);Ss&&(kt.tags=Ss),Gp.path.set(Me,Fm),T("path","updated");continue}if(K.kind==="path_delete"){const Me=kn("path",K.target,K.targetExpr,a0);if(!Me)continue;hm.delete(Me);const kt=_1.indexOf(Me);kt>=0&&_1.splice(kt,1),sh("path",Me);continue}if(K.kind==="table_new"){const Me=Be(K.assign),kt=Me?Ne.get(Me):null,Ss=Me?oh.get(Me):null,vn=Ss?ep.get(Ss):null;if(K.once&&Me&&Ss&&vn)continue;const Bi=!vn;if(H0("runtime draws",null,ep.size,Bi))continue;const xl=Math.max(1,Math.floor(Number(K.columns??0))),Ec=Math.max(1,Math.floor(Number(K.rows??0)));if(!xl||!Ec)continue;const Ta=C0.table.shift(),gu=(kt==null?void 0:kt.id)||Ss||Ta||`table_${k1+=1}`,tf=gu.match(/table_(\d+)/);tf&&(k1=Math.max(k1,Number(tf[1])));const $c=Hs(K.layer),lf=As(K.zIndex),Tf=Ls(K.includeInAutoscale),ei=kt??ct("table",gu);gf(ei,K.groupId,oc(K.tags)),ep.set(gu,{id:gu,position:K.position||"top_right",columns:xl,rows:Ec,bgcolor:K.bgcolor,borderColor:K.borderColor,borderWidth:K.borderWidth??Sn(K.borderWidthExpr,"table.border_width",zt)??void 0,textColor:K.textColor,textSize:K.textSize??Sn(K.textSizeExpr,"table.text_size",zt)??void 0,textHalign:K.textHalign,textValign:K.textValign,frameColor:K.frameColor,frameWidth:K.frameWidth??Sn(K.frameWidthExpr,"table.frame_width",zt)??void 0,cells:new Map,merges:[],layer:$c,zIndex:lf,includeInAutoscale:Tf,groupId:K.groupId??(ei==null?void 0:ei.groupId),tags:oc(K.tags)??(ei==null?void 0:ei.tags)}),Gp.table.set(gu,Fm),T("table",vn?"updated":"created"),l_.push(gu),Ch(l_,ep,b6,"table"),Me&&ei&&(oh.set(Me,gu),et(Me,ei),b.set(Me,ei));continue}if(K.kind==="table_set"){const Me=kn("table",K.target,K.targetExpr,oh);if(!Me)continue;const kt=ep.get(Me);if(!kt)continue;if(K.position&&(kt.position=K.position),K.bgcolor&&(kt.bgcolor=K.bgcolor),K.borderColor&&(kt.borderColor=K.borderColor),K.borderWidth!=null||K.borderWidthExpr){const Ss=K.borderWidth??Sn(K.borderWidthExpr,"table.set_border_width",zt);Ss!=null&&(kt.borderWidth=Ss)}if(K.textColor&&(kt.textColor=K.textColor),K.textSize!=null||K.textSizeExpr){const Ss=K.textSize??Sn(K.textSizeExpr,"table.set_text_size",zt);Ss!=null&&(kt.textSize=Ss)}if(K.textHalign&&(kt.textHalign=K.textHalign),K.textValign&&(kt.textValign=K.textValign),K.frameColor&&(kt.frameColor=K.frameColor),K.frameWidth!=null||K.frameWidthExpr){const Ss=K.frameWidth??Sn(K.frameWidthExpr,"table.set_frame_width",zt);Ss!=null&&(kt.frameWidth=Ss)}Gp.table.set(Me,Fm),T("table","updated");continue}if(K.kind==="table_delete"){const Me=kn("table",K.target,K.targetExpr,oh);if(!Me)continue;ep.delete(Me);const kt=l_.indexOf(Me);kt>=0&&l_.splice(kt,1),sh("table",Me);continue}if(K.kind==="table_clear"){const Me=kn("table",K.target,K.targetExpr,oh);if(!Me)continue;const kt=ep.get(Me);if(!kt)continue;if(!(K.startColumn!=null||K.startRow!=null||K.endColumn!=null||K.endRow!=null)){(jy=(T_=kt.cells)==null?void 0:T_.clear)==null||jy.call(T_),kt.merges=[],Gp.table.set(Me,Fm),T("table","updated");continue}const vn=Sn(K.startColumn,"table.clear_start_col",zt),Bi=Sn(K.startRow,"table.clear_start_row",zt),xl=Sn(K.endColumn,"table.clear_end_col",zt),Ec=Sn(K.endRow,"table.clear_end_row",zt);if(vn==null||Bi==null||xl==null||Ec==null){(By=(F_=kt.cells)==null?void 0:F_.clear)==null||By.call(F_),kt.merges=[];continue}const Ta=Math.min(Math.floor(vn),Math.floor(xl)),gu=Math.max(Math.floor(vn),Math.floor(xl)),tf=Math.min(Math.floor(Bi),Math.floor(Ec)),$c=Math.max(Math.floor(Bi),Math.floor(Ec)),lf=kt.cells||new Map;for(const Tf of Array.from(lf.keys())){const[ei,cc]=String(Tf).split(":"),Ih=Number(ei),jg=Number(cc);Ih>=Ta&&Ih<=gu&&jg>=tf&&jg<=$c&&lf.delete(Tf)}kt.cells=lf,Array.isArray(kt.merges)&&kt.merges.length&&(kt.merges=kt.merges.filter(Tf=>{if(!Tf)return!1;const ei=Math.min(Tf.left,Tf.right),cc=Math.max(Tf.left,Tf.right),Ih=Math.min(Tf.top,Tf.bottom),jg=Math.max(Tf.top,Tf.bottom);return!(ei<=gu&&cc>=Ta&&Ih<=$c&&jg>=tf)})),Gp.table.set(Me,Fm),T("table","updated");continue}if(K.kind==="table_merge"){const Me=kn("table",K.target,K.targetExpr,oh);if(!Me)continue;const kt=ep.get(Me);if(!kt)continue;const Ss=Sn(K.left,"table.merge_left",zt),vn=Sn(K.top,"table.merge_top",zt),Bi=Sn(K.right,"table.merge_right",zt),xl=Sn(K.bottom,"table.merge_bottom",zt);if(Ss==null||vn==null||Bi==null||xl==null)continue;const Ec=Math.min(Math.floor(Ss),Math.floor(Bi)),Ta=Math.max(Math.floor(Ss),Math.floor(Bi)),gu=Math.min(Math.floor(vn),Math.floor(xl)),tf=Math.max(Math.floor(vn),Math.floor(xl));kt.columns=Math.max(kt.columns||1,Ta+1),kt.rows=Math.max(kt.rows||1,tf+1),Array.isArray(kt.merges)||(kt.merges=[]);const $c=`${Ec}:${gu}:${Ta}:${tf}`;kt.merges.some(lf=>`${lf.left}:${lf.top}:${lf.right}:${lf.bottom}`===$c)||kt.merges.push({left:Ec,top:gu,right:Ta,bottom:tf}),Gp.table.set(Me,Fm),T("table","updated");continue}if(K.kind==="table_cell"||K.kind==="table_cell_set"){const Me=kn("table",K.target,K.targetExpr,oh);if(!Me)continue;let kt=ep.get(Me);if(!kt){const Bi=Uf("table",Me);kt={id:Me,position:"top_right",columns:Math.max(1,Math.floor(Number(K.column??0)+1)),rows:Math.max(1,Math.floor(Number(K.row??0)+1)),cells:new Map,merges:[],groupId:Bi==null?void 0:Bi.groupId,tags:Bi==null?void 0:Bi.tags},ep.set(Me,kt),l_.push(Me),Ch(l_,ep,b6,"table")}kt.columns=Math.max(kt.columns||1,Math.floor(Number(K.column??0)+1)),kt.rows=Math.max(kt.rows||1,Math.floor(Number(K.row??0)+1));const Ss=`${K.column??0}:${K.row??0}`,vn=kt.cells.get(Ss)||{column:Math.floor(Number(K.column??0)),row:Math.floor(Number(K.row??0))};if((K.text!=null||K.textExpr)&&(vn.text=Ao(K.text,K.textExpr,"table.cell_text",zt)),K.textColor&&(vn.textColor=K.textColor),K.bgcolor&&(vn.bgcolor=K.bgcolor),K.textSize!=null||K.textSizeExpr){const Bi=K.textSize??Sn(K.textSizeExpr,"table.cell_text_size",zt);Bi!=null&&(vn.textSize=Bi)}if(K.textHalign&&(vn.textHalign=K.textHalign),K.textValign&&(vn.textValign=K.textValign),K.width!=null||K.widthExpr){const Bi=K.width??Sn(K.widthExpr,"table.cell_width",zt);Bi!=null&&(vn.width=Bi)}if(K.height!=null||K.heightExpr){const Bi=K.height??Sn(K.heightExpr,"table.cell_height",zt);Bi!=null&&(vn.height=Bi)}(K.tooltip!=null||K.tooltipExpr)&&(vn.tooltip=Ao(K.tooltip,K.tooltipExpr,"table.cell_tooltip",zt)),kt.cells.set(Ss,vn),Gp.table.set(Me,Fm),T("table","updated");continue}if(K.kind==="draw_clear"){const Me=K.filterKind,kt=xu(K.groupId),Ss=xu(K.tag),vn=(Bi,xl,Ec)=>{const Ta=Array.from(xl.keys());for(const gu of Ta){const tf=xl.get(gu);if(!Sh(Bi,gu,tf,Me,kt,Ss))continue;xl.delete(gu);const $c=Ec.indexOf(gu);$c>=0&&Ec.splice($c,1),ne&&(Bi==="line"||Bi==="label"||Bi==="box")?Qf(Bi,gu):sh(Bi,gu)}};(!Me||Me==="line")&&vn("line",ev,f1),(!Me||Me==="linefill")&&vn("linefill",md,p1),(!Me||Me==="label")&&vn("label",sd,m1),(!Me||Me==="box")&&vn("box",Xc,h1),(!Me||Me==="table")&&vn("table",ep,l_),(!Me||Me==="polyline")&&vn("polyline",Of,v1),(!Me||Me==="polygon")&&vn("polygon",ih,g1),(!Me||Me==="path")&&vn("path",hm,_1),ne&&(!Me||Me==="label")&&(eb=sd.size),ne&&(!Me||Me==="box")&&(tb=Xc.size),ne&&(!Me||Me==="line")&&(Qy=ev.size);continue}if(K.kind==="draw_for_each"){const Me=K.updates||{},kt=K.filterKind,Ss=xu(K.groupId),vn=xu(K.tag),Bi=ei=>{if(Me.color&&(ei.color=Me.color),Me.gradient&&(ei.gradient=Me.gradient),Me.width!=null||Me.widthExpr){const cc=Me.width??Sn(Me.widthExpr,"draw.for_each_line_width",zt),Ih=es(cc);Ih!=null&&(ei.width=Ih)}if(Me.glow!=null){const cc=aa(Me.glow);cc!=null&&(ei.glow=cc)}if(Me.glowOpacity!=null){const cc=Za(Me.glowOpacity);cc!=null&&(ei.glowOpacity=cc)}Me.glowColor&&(ei.glowColor=Me.glowColor),Me.style&&(ei.style=Me.style),Me.extend&&(ei.extend=Me.extend),Me.xloc&&(ei.xloc=Me.xloc)},xl=ei=>{if(Me.color&&(ei.color=Me.color),Me.textColor&&(ei.textColor=Me.textColor),Me.bgGradient&&(ei.bgGradient=Me.bgGradient),Me.text!=null||Me.textExpr){const cc=Ao(Me.text,Me.textExpr,"draw.for_each_label_text",zt);ei.text=so(cc,Io)}if(Me.textSize!=null||Me.textSizeExpr){const cc=Me.textSize??Sn(Me.textSizeExpr,"draw.for_each_label_size",zt);cc!=null&&(ei.size=bo(cc))}Me.xloc&&(ei.xloc=Me.xloc),!ne&&Me.wrap!=null&&(ei.wrap=Me.wrap),!ne&&Me.maxWidth!=null&&(ei.maxWidth=Me.maxWidth),Me.padding!=null&&(ei.padding=Me.padding),Me.bgColor&&(ei.bgColor=Kc(Me.bgColor)),Me.bgOpacity!=null&&(ei.bgOpacity=Me.bgOpacity),Me.borderColor&&(ei.borderColor=bu(Me.borderColor)),Me.borderWidth!=null&&(ei.borderWidth=Ir(Me.borderWidth)),Me.radius!=null&&(ei.radius=Me.radius),Me.align&&(ei.align=Me.align),Me.valign&&(ei.valign=Me.valign),Me.lineHeight!=null&&(ei.lineHeight=Me.lineHeight),Me.fontFamily&&(ei.fontFamily=Me.fontFamily),Me.fontSize!=null&&(ei.fontSize=Me.fontSize),Me.fontWeight&&(ei.fontWeight=Me.fontWeight),Me.monospace!=null&&(ei.monospace=Me.monospace)},Ec=ei=>{if(Me.bgColor&&(ei.bgColor=Me.bgColor),Me.bgGradient&&(ei.bgGradient=Me.bgGradient),Me.borderColor&&(ei.borderColor=Me.borderColor),Me.textColor&&(ei.textColor=Me.textColor),(Me.text!=null||Me.textExpr)&&(ei.text=Ao(Me.text,Me.textExpr,"draw.for_each_box_text",zt)),Me.textSize!=null||Me.textSizeExpr){const cc=Me.textSize??Sn(Me.textSizeExpr,"draw.for_each_box_text_size",zt),Ih=ne?Ja(cc):cc;Ih!=null&&(ei.textSize=Ih)}Me.extend&&(ei.extend=Me.extend),Me.xloc&&(ei.xloc=Me.xloc)},Ta=ei=>{Me.color&&(ei.color=Me.color)},gu=ei=>{if(Me.bgColor&&(ei.bgcolor=Me.bgColor),Me.borderColor&&(ei.borderColor=Me.borderColor),Me.textColor&&(ei.textColor=Me.textColor),Me.textSize!=null||Me.textSizeExpr){const cc=Me.textSize??Sn(Me.textSizeExpr,"draw.for_each_table_text_size",zt);cc!=null&&(ei.textSize=cc)}},tf=ei=>{if(Me.color&&(ei.color=Me.color),Me.gradient&&(ei.gradient=Me.gradient),Me.width!=null||Me.widthExpr){const cc=Me.width??Sn(Me.widthExpr,"draw.for_each_polyline_width",zt);cc!=null&&(ei.width=cc)}if(Me.style&&(ei.style=Me.style),Me.opacity!=null&&(ei.opacity=Me.opacity),Me.glow!=null){const cc=aa(Me.glow);cc!=null&&(ei.glow=cc)}if(Me.glowOpacity!=null){const cc=Za(Me.glowOpacity);cc!=null&&(ei.glowOpacity=cc)}Me.glowColor&&(ei.glowColor=Me.glowColor)},$c=ei=>{if(Me.fillColor&&(ei.fillColor=Me.fillColor),Me.fillGradient&&(ei.fillGradient=Me.fillGradient),Me.color&&(ei.strokeColor=Me.color),Me.borderColor&&(ei.strokeColor=Me.borderColor),Me.width!=null||Me.widthExpr){const cc=Me.width??Sn(Me.widthExpr,"draw.for_each_polygon_width",zt);cc!=null&&(ei.strokeWidth=cc)}if(Me.opacity!=null&&(ei.opacity=Me.opacity),Me.glow!=null){const cc=aa(Me.glow);cc!=null&&(ei.glow=cc)}if(Me.glowOpacity!=null){const cc=Za(Me.glowOpacity);cc!=null&&(ei.glowOpacity=cc)}Me.glowColor&&(ei.glowColor=Me.glowColor)},lf=ei=>{if(Me.color&&(ei.color=Me.color),Me.gradient&&(ei.gradient=Me.gradient),Me.width!=null||Me.widthExpr){const cc=Me.width??Sn(Me.widthExpr,"draw.for_each_path_width",zt);cc!=null&&(ei.width=cc)}if(Me.style&&(ei.style=Me.style),Me.opacity!=null&&(ei.opacity=Me.opacity),Me.glow!=null){const cc=aa(Me.glow);cc!=null&&(ei.glow=cc)}if(Me.glowOpacity!=null){const cc=Za(Me.glowOpacity);cc!=null&&(ei.glowOpacity=cc)}Me.glowColor&&(ei.glowColor=Me.glowColor)},Tf=(ei,cc,Ih)=>{for(const[jg,I0]of cc.entries())Sh(ei,jg,I0,kt,Ss,vn)&&Ih(I0)};(!kt||kt==="line")&&Tf("line",ev,Bi),(!kt||kt==="linefill")&&Tf("linefill",md,Ta),(!kt||kt==="label")&&Tf("label",sd,xl),(!kt||kt==="box")&&Tf("box",Xc,Ec),(!kt||kt==="table")&&Tf("table",ep,gu),(!kt||kt==="polyline")&&Tf("polyline",Of,tf),(!kt||kt==="polygon")&&Tf("polygon",ih,$c),(!kt||kt==="path")&&Tf("path",hm,lf);continue}}if(i(yr)){let zt=0;for(const[mn,K]of sd.entries()){if(zt>=nb){dt("labels",nb);break}const lo=tn(K.x,K.xloc,{kind:"label",id:mn});if(lo==null||lo<0||lo>Wi)continue;const Me=K.yloc||"price";let kt=K.y;if(Me==="abovebar"||Me==="belowbar"){if(lo>=Kt)continue;const Ta=U[lo],gu=(Ta==null?void 0:Ta.high)??(Ta==null?void 0:Ta.h),tf=(Ta==null?void 0:Ta.low)??(Ta==null?void 0:Ta.l);if(Me==="abovebar"){if(!Number.isFinite(gu))continue;kt=Number(gu)}if(Me==="belowbar"){if(!Number.isFinite(tf))continue;kt=Number(tf)}}if(!Number.isFinite(kt))continue;const Ss=K.includeInAutoscale!=null?K.includeInAutoscale:ne?Me==="price":K.includeInAutoscale,vn=Yc[lo]||(Yc[lo]={}),Bi=`__label_rt_${lo}_${ap.length}`;vn[Bi]={id:mn,text:K.text||"",color:K.color||"#f97316",yKey:"__rt__",position:Me==="belowbar"?"below":"above",value:kt,yloc:Me,shape:K.shape,callout:K.callout,textColor:K.textColor,textAlign:K.textAlign,tooltip:K.tooltip,size:K.size,pineV2:ne||void 0,wrap:K.wrap,maxWidth:K.maxWidth,padding:K.padding,bgColor:K.bgColor,bgGradient:K.bgGradient??K.gradient,bgOpacity:K.bgOpacity,borderColor:K.borderColor,borderWidth:K.borderWidth,radius:K.radius,align:K.align,valign:K.valign,lineHeight:K.lineHeight,fontFamily:K.fontFamily,fontSize:K.fontSize,fontWeight:K.fontWeight,monospace:K.monospace,offsetY:0,layer:K.layer,zIndex:K.zIndex,includeInAutoscale:Ss};const xl=((Oy=U[lo])==null?void 0:Oy.timestamp)??((zy=U[lo])==null?void 0:zy.time)??((Vy=U[lo])==null?void 0:Vy.t),Ec=typeof xl=="number"&&Number.isFinite(xl)?xl<1e12?Math.floor(xl*1e3):Math.floor(xl):void 0;ap.push({index:lo,ts:xl,tsMs:Ec,meta:vn[Bi]}),zt+=1}}const H2=new Map;for(const[zt,mn]of ev.entries()){const K={kind:"line",id:zt},lo=tn(mn.x1,mn.xloc,K),Me=tn(mn.x2,mn.xloc,K);if(lo==null||Me==null||!Number.isFinite(mn.y1)||!Number.isFinite(mn.y2))continue;const kt=Me!==lo?(mn.y2-mn.y1)/(Me-lo):void 0,Ss=kt!=null?mn.y1-kt*lo:void 0,vn={id:zt,startIndex:lo,endIndex:Me,startValue:mn.y1,endValue:mn.y2,slope:kt,intercept:Ss,color:mn.color,gradient:mn.gradient,width:mn.width,glow:mn.glow,glowColor:mn.glowColor,glowOpacity:mn.glowOpacity,style:mn.style,extend:mn.extend,strictExtend:ne,layer:mn.layer,zIndex:mn.zIndex,includeInAutoscale:mn.includeInAutoscale};H2.set(zt,vn),js.push(vn)}for(const zt of md.values()){if(!zt)continue;const mn=H2.get(zt.line1),K=H2.get(zt.line2);!mn||!K||ml.push({line1:mn,line2:K,color:zt.color,layer:zt.layer,zIndex:zt.zIndex,includeInAutoscale:zt.includeInAutoscale})}for(const[zt,mn]of Xc.entries()){const K={kind:"box",id:zt},lo=tn(mn.left,mn.xloc,K),Me=tn(mn.right,mn.xloc,K);lo==null||Me==null||!Number.isFinite(mn.top)||!Number.isFinite(mn.bottom)||Qo.push({leftIndex:lo,rightIndex:Me,topValue:mn.top,bottomValue:mn.bottom,borderColor:mn.borderColor,bgColor:mn.bgColor,bgGradient:mn.bgGradient,borderWidth:mn.borderWidth,borderStyle:mn.borderStyle,text:mn.text,textColor:mn.textColor,textSize:mn.textSize,textHalign:mn.textHalign,textValign:mn.textValign,textWrap:mn.textWrap,extend:mn.extend,layer:mn.layer,zIndex:mn.zIndex,includeInAutoscale:mn.includeInAutoscale})}for(const[zt,mn]of Of.entries()){if(!mn||!Array.isArray(mn.points))continue;const K=[];for(const lo of mn.points){if(!lo)continue;const Me=tn(lo.x,lo.xloc||mn.xloc,{kind:"polyline",id:zt});if(Me==null)continue;const kt=lo.y;Number.isFinite(kt)&&K.push({index:Me,value:kt})}K.length<2||ks.push({id:mn.id,points:K,color:mn.color,gradient:mn.gradient,width:mn.width,style:mn.style,opacity:mn.opacity,glow:mn.glow,glowColor:mn.glowColor,glowOpacity:mn.glowOpacity,layer:mn.layer,zIndex:mn.zIndex,includeInAutoscale:mn.includeInAutoscale})}for(const[zt,mn]of ih.entries()){if(!mn||!Array.isArray(mn.points))continue;const K=[];for(const lo of mn.points){if(!lo)continue;const Me=tn(lo.x,lo.xloc||mn.xloc,{kind:"polygon",id:zt});if(Me==null)continue;const kt=lo.y;Number.isFinite(kt)&&K.push({index:Me,value:kt})}K.length<3||Jn.push({id:mn.id,points:K,fillColor:mn.fillColor,fillGradient:mn.fillGradient,strokeColor:mn.strokeColor,strokeWidth:mn.strokeWidth,strokeStyle:mn.strokeStyle,opacity:mn.opacity,glow:mn.glow,glowColor:mn.glowColor,glowOpacity:mn.glowOpacity,layer:mn.layer,zIndex:mn.zIndex,includeInAutoscale:mn.includeInAutoscale})}for(const[zt,mn]of hm.entries()){if(!mn||!Array.isArray(mn.commands))continue;const K=[];for(const lo of mn.commands){if(!lo||!lo.cmd)continue;const Me=tn(lo.x,lo.xloc||mn.xloc,{kind:"path",id:zt});if(Me==null)continue;const kt=lo.y;if(!Number.isFinite(kt))continue;const Ss=String(lo.cmd||"").toUpperCase();Ss!=="M"&&Ss!=="L"||K.push({cmd:Ss,index:Me,value:kt})}K.length&&En.push({id:mn.id,commands:K,color:mn.color,gradient:mn.gradient,width:mn.width,style:mn.style,opacity:mn.opacity,glow:mn.glow,glowColor:mn.glowColor,glowOpacity:mn.glowOpacity,layer:mn.layer,zIndex:mn.zIndex,includeInAutoscale:mn.includeInAutoscale})}for(const zt of ep.values()){const mn=[];(zt.cells||new Map).forEach(lo=>{mn.push({column:Math.floor(Number(lo.column??0)),row:Math.floor(Number(lo.row??0)),text:lo.text||"",textColor:lo.textColor,bgcolor:lo.bgcolor,textSize:lo.textSize,textHalign:lo.textHalign,textValign:lo.textValign,width:lo.width,height:lo.height,tooltip:lo.tooltip})}),po.push({id:zt.id,position:zt.position,columns:Math.max(1,Math.floor(Number(zt.columns??1))),rows:Math.max(1,Math.floor(Number(zt.rows??1))),bgcolor:zt.bgcolor,borderColor:zt.borderColor,textColor:zt.textColor,frameColor:zt.frameColor,borderWidth:zt.borderWidth,frameWidth:zt.frameWidth,textSize:zt.textSize,textHalign:zt.textHalign,textValign:zt.textValign,cells:mn,merges:Array.isArray(zt.merges)?zt.merges:[],layer:zt.layer,zIndex:zt.zIndex,includeInAutoscale:zt.includeInAutoscale})}}if(i(yr)&&Ys.length)for(const Be of Ys){if(!Be||!Be.x||!Be.y)continue;const p=String(Be.whenExpr||"").trim(),b=String(Be.when||"").trim(),T=p||b?Zf(p,b):null,z=te(String(Be.x)),ie=te(String(Be.y));if(!z||!ie)continue;const Ne=Ws(T,300),Oe=Be.textExpr?String(Be.textExpr):"",ct=Oe?nn(Oe):null,et=Be.colorExpr?String(Be.colorExpr):"",Vt=et?nn(et):null,rn=Be.textColorExpr?String(Be.textColorExpr):"",kn=rn?nn(rn):null,Is=Be.sizeExpr?String(Be.sizeExpr):"",Sn=Is?te(Is):null,Ao=Hs(Be.layer),Io=As(Be.zIndex),go=Ls(Be.includeInAutoscale);for(const so of Ne){const es=z[so],bo=tn(es,Be.xloc,{kind:"runtime_label",id:so});if(bo==null||bo<0||bo>Wi)continue;let Ja=ie[so];if(Be.yloc==="abovebar"||Be.yloc==="belowbar"){if(bo>=Kt)continue;const Al=U[bo],_f=(Al==null?void 0:Al.high)??(Al==null?void 0:Al.h),Tl=(Al==null?void 0:Al.low)??(Al==null?void 0:Al.l);Be.yloc==="abovebar"&&Number.isFinite(_f)&&(Ja=_f),Be.yloc==="belowbar"&&Number.isFinite(Tl)&&(Ja=Tl)}if(!Number.isFinite(Ja))continue;const zl=Be.text!=null?String(Be.text):ct?String(ct[so]??""):"",Kc=Vt&&Vt[so]!=null&&String(Vt[so]).trim()?String(Vt[so]):Be.color||"#f97316",bu=kn&&kn[so]!=null&&String(kn[so]).trim()?String(kn[so]):Be.textColor,oc=Sn?Sn[so]:NaN,gf=Number.isFinite(oc)?oc:Be.size,lr=Yc[bo]||(Yc[bo]={}),ed=`__label_rt_${bo}_${ap.length}`;lr[ed]={text:zl,color:Kc,yKey:"__rt__",position:Be.yloc==="belowbar"?"below":"above",value:Ja,shape:Be.shape,callout:Be.callout,textColor:bu,textAlign:Be.textAlign,tooltip:Be.tooltip,size:gf,offsetY:typeof Be.offsetY=="number"?Be.offsetY:0,layer:Ao,zIndex:Io,includeInAutoscale:go,wrap:Be.wrap,maxWidth:Be.maxWidth,padding:Be.padding,bgColor:Be.bgColor,bgOpacity:Be.bgOpacity,borderColor:Be.borderColor,borderWidth:Be.borderWidth,radius:Be.radius,align:Be.align,valign:Be.valign,lineHeight:Be.lineHeight,fontFamily:Be.fontFamily,fontSize:Be.fontSize,fontWeight:Be.fontWeight,monospace:Be.monospace};const Qf=((Wy=U[bo])==null?void 0:Wy.timestamp)??((Hy=U[bo])==null?void 0:Hy.time)??((qy=U[bo])==null?void 0:qy.t),Ou=typeof Qf=="number"&&Number.isFinite(Qf)?Qf<1e12?Math.floor(Qf*1e3):Math.floor(Qf):void 0;ap.push({index:bo,ts:Qf,tsMs:Ou,meta:lr[ed]})}}Ha.__labelItems=ap,Ha.__tsIndex=ki,Ha.__timeSeriesMs=ea;const Jf=[];if(Er.length)for(const Be of Er){if(!Be)continue;const p=String(Be.whenExpr||"").trim(),b=String(Be.when||"").trim(),T=p||b?Zf(p,b):null,z=te(String(Be.x1)),ie=te(String(Be.y1)),Ne=te(String(Be.x2)),Oe=te(String(Be.y2));if(!z||!ie||!Ne||!Oe)continue;const ct=Ws(T,240),et=Be.colorExpr?String(Be.colorExpr):"",Vt=et?nn(et):null,rn=Be.widthExpr||Be.sizeExpr,kn=rn?String(rn):"",Is=kn?te(kn):null;for(const Sn of ct){const Ao={kind:"runtime_line",id:Sn},Io=tn(z[Sn],Be.xloc,Ao),go=tn(Ne[Sn],Be.xloc,Ao);if(Io==null||go==null)continue;const so=ie[Sn],es=Oe[Sn];if(!Number.isFinite(so)||!Number.isFinite(es))continue;const bo=go!==Io?(es-so)/(go-Io):void 0,Ir=bo!=null?so-bo*Io:void 0,Ja=Vt&&Vt[Sn]!=null&&String(Vt[Sn]).trim()?String(Vt[Sn]):Be.color,zl=Is?Is[Sn]:NaN,Kc=Number.isFinite(zl)?zl:Be.width,bu=aa(Be.glow),oc=Za(Be.glowOpacity);Jf.push({startIndex:Io,endIndex:go,startValue:so,endValue:es,slope:bo,intercept:Ir,color:Ja,gradient:Be.gradient,width:Kc,glow:bu,glowColor:Be.glowColor,glowOpacity:oc,style:Be.style,extend:Be.extend,strictExtend:ne,layer:Hs(Be.layer),zIndex:As(Be.zIndex),includeInAutoscale:Ls(Be.includeInAutoscale)})}}const Rr=[];if(Hn.length)for(const Be of Hn){if(!Be)continue;const p=String(Be.whenExpr||"").trim(),b=String(Be.when||"").trim(),T=p||b?Zf(p,b):null,z=te(String(Be.left)),ie=te(String(Be.right)),Ne=te(String(Be.top)),Oe=te(String(Be.bottom)),ct=Be.textExpr?String(Be.textExpr):"",et=ct?nn(ct):null,Vt=Be.bgColorExpr?String(Be.bgColorExpr):"",rn=Vt?nn(Vt):null,kn=Be.borderColorExpr?String(Be.borderColorExpr):"",Is=kn?nn(kn):null,Sn=Be.textColorExpr?String(Be.textColorExpr):"",Ao=Sn?nn(Sn):null,Io=Be.borderWidthExpr||Be.sizeExpr,go=Io?String(Io):"",so=go?te(go):null;if(!z||!ie||!Ne||!Oe)continue;const es=Ws(T,180);for(const bo of es){const Ir={kind:"runtime_box",id:bo},Ja=tn(z[bo],Be.xloc,Ir),zl=tn(ie[bo],Be.xloc,Ir);if(Ja==null||zl==null)continue;const Kc=Ne[bo],bu=Oe[bo];if(!Number.isFinite(Kc)||!Number.isFinite(bu))continue;const oc=Be.text!=null?String(Be.text):et?String(et[bo]??""):"",gf=rn&&rn[bo]!=null&&String(rn[bo]).trim()?String(rn[bo]):Be.bgColor,lr=Is&&Is[bo]!=null&&String(Is[bo]).trim()?String(Is[bo]):Be.borderColor,ed=Ao&&Ao[bo]!=null&&String(Ao[bo]).trim()?String(Ao[bo]):Be.textColor,Qf=so?so[bo]:NaN,Ou=Number.isFinite(Qf)?Qf:Be.borderWidth;Rr.push({leftIndex:Ja,rightIndex:zl,topValue:Kc,bottomValue:bu,borderColor:lr,bgColor:gf,bgGradient:Be.bgGradient??Be.gradient,borderWidth:Ou,borderStyle:Be.borderStyle,text:oc,textColor:ed,textSize:Be.textSize,textHalign:Be.textHalign,textValign:Be.textValign,textWrap:Be.textWrap,extend:Be.extend,layer:Hs(Be.layer),zIndex:As(Be.zIndex),includeInAutoscale:Ls(Be.includeInAutoscale)})}}const Go=[];if(Mn.length){const lt=Math.max(0,Kt-1);for(const Be of Mn){if(!Be)continue;const p=Math.max(1,Math.floor(Number(Be.columns??1))),b=Math.max(1,Math.floor(Number(Be.rows??1))),T=[],z=Array.isArray(Be.cells)?Be.cells:[];for(const ie of z){if(!ie)continue;const Ne=String(ie.whenExpr||"").trim(),Oe=String(ie.when||"").trim();if(Ne||Oe){const Vt=Zf(Ne,Oe);if(Vt&&!Vt[lt])continue}let ct="";if(ie.text!=null)ct=String(ie.text);else if(ie.textExpr){const Vt=nn(String(ie.textExpr));ct=Vt?String(Vt[lt]??""):""}const et=ie.tooltip!=null?String(ie.tooltip):ie.tooltipExpr?evalTextAt(void 0,String(ie.tooltipExpr),"table.tooltip",lt):void 0;T.push({column:Math.floor(Number(ie.column??0)),row:Math.floor(Number(ie.row??0)),text:ct,textColor:ie.textColor,bgcolor:ie.bgcolor,textSize:ie.textSize,textHalign:ie.textHalign,textValign:ie.textValign,width:ie.width,height:ie.height,tooltip:et})}Go.push({id:Be.id,position:Be.position,columns:p,rows:b,bgcolor:Be.bgcolor,borderColor:Be.borderColor,textColor:Be.textColor,frameColor:Be.frameColor,borderWidth:Be.borderWidth,frameWidth:Be.frameWidth,textSize:Be.textSize,textHalign:Be.textHalign,textValign:Be.textValign,cells:T,merges:Array.isArray(Be.merges)?Be.merges:[],layer:Hs(Be.layer),zIndex:As(Be.zIndex),includeInAutoscale:Ls(Be.includeInAutoscale)})}}const Aa=Jf.length||js.length?Jf.concat(js):[],jr=ml.length?ml:[],ja=Rr.length||Qo.length?Rr.concat(Qo):[],qu=ks.length?ks:[],Yd=Jn.length?Jn:[],Mp=En.length?En:[],zp=Go.length||po.length?Go.concat(po):[];if(Ha.__runtimeLineDefs=Aa,Ha.__runtimeLineFills=jr,Ha.__runtimeBoxDefs=ja,Ha.__runtimePolylineDefs=qu,Ha.__runtimePolygonDefs=Yd,Ha.__runtimePathDefs=Mp,Ha.__runtimeTables=zp,Ha.__runtimeHeatmaps=Do,Lc&&Na&&jt.set(Lc,Na),Array.isArray(N)&&N.length){let lt=[];const Be=p=>{const b=[];for(let T=Kt-1;T>=0&&b.length<2;(T-=1)+1){const z=p[T];z!=null&&Number.isFinite(z)&&b.push(T)}return b.reverse()};if(N.forEach(p=>{const b=String(p.colorExpr||"").trim(),T=b?Sp(b):null,z=String(p.widthExpr||p.sizeExpr||"").trim(),ie=z?qp(z):null,Ne=String(p.start||"").replace(/\s+/g,"_").toLowerCase(),Oe=String(p.end||"").replace(/\s+/g,"_").toLowerCase();let et=Jt[Ne]||Jt[Oe]||"";et||(/low/i.test(Ne)||/low/i.test(Oe)?et="pl":(/high/i.test(Ne)||/high/i.test(Oe))&&(et="ph"));const rn=(p.segmentsFrom?String(p.segmentsFrom):"").replace(/\s+/g,"_").toLowerCase(),kn=ys[et],Is=rn&&ys[rn]||void 0,Sn=Is||kn||ys.ph||ys.pl;if(Sn)if(Is){const Ao=[];for(let es=0;es<Kt;(es+=1)-1){const bo=Is[es];bo!=null&&Number.isFinite(bo)&&Ao.push(es)}const Io=Math.max(1,Number(p.maxSegments)||Ao.length-1),go=Math.min(Io,24);let so=0;for(let es=Ao.length-2;es>=0&&!(so>=go);(es-=1)+1){const bo=Ao[es],Ir=Ao[es+1],Ja=Is[bo],zl=Is[Ir];if(!Number.isFinite(Ja)||!Number.isFinite(zl)||Ir===bo)continue;const Kc=(zl-Ja)/(Ir-bo),bu=Ja-Kc*bo;let oc=!1;const gf=Math.max(bo,Kt-80);let lr=NaN;for(let ed=gf;ed<=Math.min(Ir,Kt-1);(ed+=1)-1){const Qf=Kc*ed+bu,Ou=ys.close[ed];if(!Number.isFinite(Qf)||!Number.isFinite(Ou))continue;const Al=Ou-Qf;if(!Number.isNaN(lr)&&Al*lr<0){oc=!0;break}lr=Al}oc||(lt.push({startIndex:bo,endIndex:Ir,startValue:Ja,endValue:zl,slope:Kc,intercept:bu,color:Up(T,Ir,p.color||"#64748b"),width:th(ie,Ir,p.width??1),style:(p.style||"dotted").toLowerCase(),extend:p.extend||"right",name:p.name}),so+=1)}}else{const Ao=Be(Sn);if(Ao.length===2){const Io=Ao[0],go=Ao[1],so=Sn[Io],es=Sn[go];if(Number.isFinite(so)&&Number.isFinite(es)){const bo=(es-so)/(go-Io),Ir=so-bo*Io;let Ja=!1;const zl=Math.max(Io,Kt-80);let Kc=NaN;for(let bu=zl;bu<=Math.min(go,Kt-1);(bu+=1)-1){const oc=bo*bu+Ir,gf=ys.close[bu];if(!Number.isFinite(oc)||!Number.isFinite(gf))continue;const lr=gf-oc;if(!Number.isNaN(Kc)&&lr*Kc<0){Ja=!0;break}Kc=lr}if(Ja)return;lt.push({startIndex:Io,endIndex:go,startValue:so,endValue:es,slope:bo,intercept:Ir,color:Up(T,go,p.color||"#22c55e"),width:th(ie,go,p.width??2),style:(p.style||"solid").toLowerCase(),extend:p.extend||"none",name:p.name})}}}}),lt.length){const p=[],b=new Set;for(const T of lt){const z=Math.round((T.slope||0)*1e4),ie=Math.round((T.intercept||0)*100),Ne=`${z}:${ie}:${T.style}:${T.color}:${T.extend}`;b.has(Ne)||(b.add(Ne),p.push(T))}lt=p.slice(0,60)}if(!lt.length){const p=(b,T,z,ie)=>{const Ne=String(b||"").replace(/\s+/g,"_").toLowerCase(),Oe=ys[Ne];if(!Oe)return;const ct=[];for(let et=0;et<Kt;(et+=1)-1){const Vt=Oe[et];Vt!=null&&Number.isFinite(Vt)&&ct.push(et)}if(ct.length>=2){const et=ct[ct.length-2],Vt=ct[ct.length-1],rn=Oe[et],kn=Oe[Vt];if(Number.isFinite(rn)&&Number.isFinite(kn)&&Vt!==et){const Is=(kn-rn)/(Vt-et),Sn=rn-Is*et;lt.push({startIndex:et,endIndex:Vt,startValue:rn,endValue:kn,slope:Is,intercept:Sn,color:T,width:ie,style:z,extend:"right",name:Ne})}}};p("ph","#64748b","dotted",1),p("pl","#64748b","dotted",1)}Ha.__lineDefs=lt}if(ti&&(Xt.length||S!=null&&S.strategy)){const lt=H;try{const Be=U.map(z=>({timestamp:z.timestamp??z.time??0})),p=Xt.map(z=>({...z,when:$n(String((z==null?void 0:z.when)||"")),frequency:z==null?void 0:z.frequency,cooldownBars:typeof(z==null?void 0:z.cooldownBars)=="number"&&Number.isFinite(z.cooldownBars)?Math.max(0,Math.floor(z.cooldownBars)):void 0}));p.forEach((z,ie)=>{!z||z.id!=null||(z.id=String(ie))});const b=(z,ie)=>{var ev;let Ne=new Array(ie).fill(0),Oe=new Array(ie).fill(NaN),ct=new Array(ie).fill(0),et=new Array(ie).fill(0),Vt=new Array(ie).fill(0),rn=new Array(ie).fill(0),kn=new Array(ie).fill(0),Is=new Array(ie).fill(0),Sn=new Array(ie).fill(0),Ao=new Array(ie).fill(0),Io=new Array(ie).fill(0),go=new Array(ie).fill(0),so=new Array(ie).fill(0),es=new Array(ie).fill(0),bo=new Array(ie).fill(0),Ir=new Array(ie).fill(0),Ja=new Array(ie).fill(0),zl=new Array(ie).fill(0),Kc=new Array(ie).fill(0);const bu=((ev=z==null?void 0:z.summary)==null?void 0:ev.initialCapital)??0;let oc=new Array(ie).fill(bu),gf=new Array(ie).fill(0);if(!z)return{positionSize:Ne,positionAvgPrice:Oe,openTrades:ct,closedTrades:et,openProfit:Vt,closedProfit:rn,grossProfit:kn,grossLoss:Is,winTrades:Sn,lossTrades:Ao,winRate:Io,maxDrawdownPct:go,maxDrawdownValue:so,maxRunupPct:es,maxRunupValue:bo,avgTrade:Ir,avgWin:Ja,avgLoss:zl,avgBarsInTrade:Kc,equity:oc,netProfit:gf,initialCapital:bu};const lr=z==null?void 0:z.series,ed=md=>Array.isArray(md)&&md.length===ie?md:null,Qf=ed(lr==null?void 0:lr.positionSize),Ou=ed(lr==null?void 0:lr.positionAvgPrice),Al=ed(lr==null?void 0:lr.openTrades),_f=ed(lr==null?void 0:lr.closedTrades),Tl=ed(lr==null?void 0:lr.openProfit),xu=ed(lr==null?void 0:lr.closedProfit),Uf=ed(lr==null?void 0:lr.grossProfit),Sh=ed(lr==null?void 0:lr.grossLoss),sh=ed(lr==null?void 0:lr.winTrades),V0=ed(lr==null?void 0:lr.lossTrades),Ug=ed(lr==null?void 0:lr.winRate),Ch=ed(lr==null?void 0:lr.maxDrawdownPct),Dg=ed(lr==null?void 0:lr.maxDrawdownValue),em=ed(lr==null?void 0:lr.maxRunupPct),mm=ed(lr==null?void 0:lr.maxRunupValue),lp=ed(lr==null?void 0:lr.avgTrade),Tm=ed(lr==null?void 0:lr.avgWin),oh=ed(lr==null?void 0:lr.avgLoss),S0=ed(lr==null?void 0:lr.avgBarsInTrade),r0=ed(lr==null?void 0:lr.equity),a0=ed(lr==null?void 0:lr.netProfit);if(Qf&&(Ne=Qf),Ou&&(Oe=Ou),Al&&(ct=Al),_f&&(et=_f),Tl&&(Vt=Tl),xu&&(rn=xu),Uf&&(kn=Uf),Sh&&(Is=Sh),sh&&(Sn=sh),V0&&(Ao=V0),Ug&&(Io=Ug),Ch&&(go=Ch),Dg&&(so=Dg),em&&(es=em),mm&&(bo=mm),lp&&(Ir=lp),Tm&&(Ja=Tm),oh&&(zl=oh),S0&&(Kc=S0),r0&&(oc=r0),a0&&(gf=a0),!Qf){const md=new Array(ie);for(const Xc of z.orders||[]){if(!Xc||Xc.status!=="filled")continue;const ep=Xc==null?void 0:Xc.filledIndex,Of=typeof ep=="number"&&Number.isFinite(ep)?Math.floor(ep):-1;if(Of<0||Of>=ie)continue;const ih=Xc==null?void 0:Xc.fillQty,hm=typeof ih=="number"?ih:Number(ih);if(!Number.isFinite(hm)||hm===0)continue;const u1=String((Xc==null?void 0:Xc.side)||"").toLowerCase(),d1=String((Xc==null?void 0:Xc.action)||"").toLowerCase();let W0=0;d1==="entry"?W0=u1==="short"?-hm:hm:d1==="exit"&&(W0=u1==="short"?hm:-hm),!(!Number.isFinite(W0)||W0===0)&&(md[Of]||(md[Of]=[]),md[Of].push(W0))}let sd=0;for(let Xc=0;Xc<ie;(Xc+=1)-1){const ep=md[Xc];if(ep)for(const Of of ep)sd+=Of;Ne[Xc]=sd}}if(!Al||!_f){const md=new Int32Array(ie+1),sd=new Int32Array(ie+1);for(const Of of z.roundTrips||[]){const ih=typeof Of.entryIndex=="number"&&Number.isFinite(Of.entryIndex)?Math.max(0,Math.floor(Of.entryIndex)):-1,hm=typeof Of.exitIndex=="number"&&Number.isFinite(Of.exitIndex)?Math.max(0,Math.floor(Of.exitIndex)):-1;ih>=0&&ih<ie&&(md[ih]+=1),hm>=0&&hm<ie&&(md[hm]-=1,sd[hm]+=1)}let Xc=0,ep=0;for(let Of=0;Of<ie;(Of+=1)-1){Xc+=md[Of],ep+=sd[Of];const ih=Ne[Of]!==0;Al||(ct[Of]=Xc>0?Xc:ih?1:0),_f||(et[Of]=ep)}}if(!r0&&Array.isArray(z.equity)&&z.equity.length){for(const sd of z.equity){const Xc=Number(sd==null?void 0:sd.index),ep=Number(sd==null?void 0:sd.equity);!Number.isFinite(Xc)||Xc<0||Xc>=ie||Number.isFinite(ep)&&(oc[Math.floor(Xc)]=ep)}let md=oc[0];for(let sd=0;sd<ie;(sd+=1)-1){const Xc=oc[sd];if(!Number.isFinite(Xc)){oc[sd]=md;continue}md=Xc}}if(!a0)for(let md=0;md<ie;(md+=1)-1){const sd=oc[md];gf[md]=Number.isFinite(sd)?sd-bu:NaN}if(!Ug)for(let md=0;md<ie;(md+=1)-1){const sd=et[md]??0,Xc=Sn[md]??0;Io[md]=sd>0?Xc/sd*100:0}if(!Ch){let md=bu;for(let sd=0;sd<ie;(sd+=1)-1){const Xc=oc[sd];if(Number.isFinite(Xc)&&(Xc>md&&(md=Xc),md>0)){const ep=(md-Xc)/md;go[sd]=Math.max(go[sd],ep*100)}}}return{positionSize:Ne,positionAvgPrice:Oe,openTrades:ct,closedTrades:et,openProfit:Vt,closedProfit:rn,grossProfit:kn,grossLoss:Is,winTrades:Sn,lossTrades:Ao,winRate:Io,maxDrawdownPct:go,maxDrawdownValue:so,maxRunupPct:es,maxRunupValue:bo,avgTrade:Ir,avgWin:Ja,avgLoss:zl,avgBarsInTrade:Kc,equity:oc,netProfit:gf,initialCapital:bu}},T=z=>{if(!z)return;if(Array.isArray(z==null?void 0:z.errors)&&z.errors.length){const et=z.errors.slice(0,4).map(Vt=>String(Vt)).join(" • ");x(un,V(i(un)?`${i(un)} • ${et}`:et)),(!i(Rt)||i(Rt)==="Plotted from Pine"||i(Rt)==="Plotted from DSL")&&x(Rt,"Signals error")}const ie=new Map;p.forEach((et,Vt)=>{ie.set(String((et==null?void 0:et.id)??Vt),et)});const Ne=(et,Vt,rn)=>{if(typeof et=="number"&&Number.isFinite(et))return et;if(typeof et=="string"){const kn=et.replace(/\s+/g,"_").toLowerCase(),Is=pl==null?void 0:pl[kn],Sn=Is?Is[Vt]:NaN;if(Number.isFinite(Sn))return Sn;const Ao=Number(et);if(Number.isFinite(Ao))return Ao}return rn},Oe=(et,Vt)=>{if(typeof et=="number"&&Number.isFinite(et))return et;if(typeof et=="string"){const rn=et.replace(/\s+/g,"_").toLowerCase(),kn=pl==null?void 0:pl[rn],Is=kn?kn[Vt]:NaN;if(Number.isFinite(Is))return Is;const Sn=Number(et);if(Number.isFinite(Sn))return Sn}},ct=(z.signals||[]).map(et=>{const Vt=ie.get(String((et==null?void 0:et.signalId)??""))||null,rn=(Vt==null?void 0:Vt.order)||null;if(!rn)return{...et,orderId:(Vt==null?void 0:Vt.orderId)??(et==null?void 0:et.orderId),title:Vt==null?void 0:Vt.title,message:Vt==null?void 0:Vt.message,frequency:Vt==null?void 0:Vt.frequency};const kn=String(rn.kind||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit"),Is=pl==null?void 0:pl.close,Sn=Is?Is[et.index]:NaN,Ao=Number.isFinite(Sn)?Sn:0,Io=Tl=>{const xu=typeof Tl=="string"?Tl.trim():"";return xu||void 0},go=Tl=>{const xu=typeof Tl=="number"?Tl:Number(Tl);if(!(!Number.isFinite(xu)||xu<=0))return Math.floor(xu)},so=(Tl,xu,Uf)=>{if(typeof Tl=="number"&&Number.isFinite(Tl))return Tl;if(typeof Tl=="string")return Ne(Tl,xu,Uf)},es=kn==="limit"||kn==="stop"?Ne(rn.price,et.index,Ao):void 0,bo=rn.stopPrice??rn.stop??rn.trigger,Ir=rn.limitPrice??rn.limit??rn.lmt,Ja=rn.qty??rn.quantity,zl=rn.cash,Kc=Oe(Ja,et.index),bu=Oe(zl,et.index),oc=rn.commissionPct??rn.commission,gf=rn.slippagePct??rn.slippage,lr=Oe(oc,et.index),ed=Oe(gf,et.index),Qf=kn==="stop_limit"?so(bo??rn.price,et.index,Ao):void 0,Ou=kn==="stop_limit"?so(Ir??rn.price,et.index,Ao):void 0,Al=rn==null?void 0:rn.bracket,_f=Al&&typeof Al=="object"?{stopLossPct:typeof Al.stopLossPct=="number"?Al.stopLossPct:Number(Al.stopLossPct),takeProfitPct:typeof Al.takeProfitPct=="number"?Al.takeProfitPct:Number(Al.takeProfitPct),trailingStopPct:typeof Al.trailingStopPct=="number"?Al.trailingStopPct:Number(Al.trailingStopPct),takeProfits:Array.isArray(Al.takeProfits)?Al.takeProfits.map(Tl=>({takeProfitPct:typeof(Tl==null?void 0:Tl.takeProfitPct)=="number"?Tl.takeProfitPct:Number(Tl==null?void 0:Tl.takeProfitPct),qtyPct:typeof(Tl==null?void 0:Tl.qtyPct)=="number"?Tl.qtyPct:Number(Tl==null?void 0:Tl.qtyPct)})).filter(Tl=>Number.isFinite(Tl.takeProfitPct)&&Tl.takeProfitPct>0&&Number.isFinite(Tl.qtyPct)&&Tl.qtyPct>0):void 0}:void 0;return{...et,orderId:(Vt==null?void 0:Vt.orderId)??(et==null?void 0:et.orderId),title:Vt==null?void 0:Vt.title,message:Vt==null?void 0:Vt.message,frequency:Vt==null?void 0:Vt.frequency,order:{kind:kn,price:es,stopPrice:Qf,limitPrice:Ou,qty:Kc,cash:bu,commissionPct:lr,slippagePct:ed,qtyPct:rn.qtyPct==null?void 0:Math.max(0,Math.min(100,Number(rn.qtyPct)||0)),oco:Io(rn.oco),expiresBars:go(rn.expiresBars),bracket:_f}}});doe(lt,ct);try{const et=p.filter(rn=>String((rn==null?void 0:rn.type)||"")==="alert").map(rn=>({id:String((rn==null?void 0:rn.id)??""),title:rn==null?void 0:rn.title,message:rn==null?void 0:rn.message,frequency:rn==null?void 0:rn.frequency})).filter(rn=>rn.id);et.length&&Vz(et);const Vt=ct.filter(rn=>String((rn==null?void 0:rn.type)||"")==="alert");if(Vt.length){const rn=Be.length?Be.length-1:0,kn=pl==null?void 0:pl.close,Is=kn&&kn.length?kn[rn]:void 0;(async()=>{var Ao,Io,go,so,es,bo;const Sn=await Gz({events:Vt.map(Ir=>({signalId:Ir.signalId,title:Ir.title,message:Ir.message,frequency:Ir.frequency,index:Ir.index,timestamp:Ir.timestamp})),context:{symbol:((Io=(Ao=s())==null?void 0:Ao.symbol)==null?void 0:Io.ticker)||((so=(go=s())==null?void 0:go.symbol)==null?void 0:so.name),timeframe:(bo=(es=s())==null?void 0:es.period)==null?void 0:bo.timeframe,price:Number.isFinite(Is)?Is:void 0,latestIndex:rn}});for(const Ir of Sn){const Ja=Ir.deliveries.find(zl=>zl.channel==="app");if(Ja&&Ja.status==="pending"){const zl=Ir.message||Ir.title||"Alert fired";Dt.addAlert("info",zl,4)}}for(const Ir of Sn){if(!Ir.deliveries.some(zl=>zl.status==="pending"))continue;const Ja=await I8(Ir);P8(Ir.id,Ja)}})()}}catch{}try{const et=(S==null?void 0:S.strategy)??null,Vt=et===!0?{enabled:!0}:et,rn=Vt&&typeof Vt=="object"?{...Vt}:Vt,kn=Qa&&typeof Qa=="object"?rn&&typeof rn=="object"?{...rn,...Qa}:{...Qa}:rn,Is=Boe(kn);if(Is){const Sn=es=>{const bo=typeof es=="number"?es:Number(es);return Number.isFinite(bo)?bo:void 0},Ao=U.map((es,bo)=>{const Ir=(es==null?void 0:es.timestamp)??(es==null?void 0:es.time)??0,Ja=typeof Ir=="number"?Ir:Number(Ir),zl=Sn(es==null?void 0:es.close);return{index:bo,timestamp:Number.isFinite(Ja)?Ja:0,open:Sn(es==null?void 0:es.open),high:Sn(es==null?void 0:es.high),low:Sn(es==null?void 0:es.low),close:zl??NaN,volume:Sn(es==null?void 0:es.volume)}}),Io=ct.filter(es=>{const bo=String((es==null?void 0:es.type)||"");return bo==="entry_long"||bo==="exit_long"||bo==="entry_short"||bo==="exit_short"||bo==="cancel"||bo==="cancel_all"}),go=zoe(Ao,Io,Is);Doe(lt,go);const so=b(go,Ao.length);df.set(he,{positionSize:so.positionSize,positionAvgPrice:so.positionAvgPrice,openTrades:so.openTrades,closedTrades:so.closedTrades,openProfit:so.openProfit,closedProfit:so.closedProfit,grossProfit:so.grossProfit,grossLoss:so.grossLoss,winTrades:so.winTrades,lossTrades:so.lossTrades,winRate:so.winRate,maxDrawdownPct:so.maxDrawdownPct,maxDrawdownValue:so.maxDrawdownValue,maxRunupPct:so.maxRunupPct,maxRunupValue:so.maxRunupValue,avgTrade:so.avgTrade,avgWin:so.avgWin,avgLoss:so.avgLoss,avgBarsInTrade:so.avgBarsInTrade,equity:so.equity,netProfit:so.netProfit,initialCapital:so.initialCapital}),go.accessors?Pu.set(he,go.accessors):Pu.delete(he),Ns+=1,cn||(cn=!0,ul.requestKey("strategy:refresh",()=>{var es,bo;try{const Ir=((es=X.getDataList)==null?void 0:es.call(X))||[];(bo=X.applyNewData)==null||bo.call(X,Ir,!1)}catch{}}))}else s3(lt),df.delete(he),Pu.delete(he)}catch(et){console.error("[ScriptStudio] backtest error",et)}try{Y5("signals",{id:z.id,signals:z.signals})}catch{}};if(!p.length)T({id:lt,signals:[]});else{const z=`${Be.length}:${((Uy=Be[Be.length-1])==null?void 0:Uy.timestamp)??0}:${p.map(Ne=>`${String((Ne==null?void 0:Ne.type)||"")}:${String((Ne==null?void 0:Ne.whenExpr)||"")}:${String((Ne==null?void 0:Ne.when)||"")}`).join("|")}`;let ie=!1;if(Eo!==Bn){try{const Ne=[],Oe=Be.length,ct=new Map,et=new Map,Vt=new Map,rn=new Map,kn=so=>Us(String(so||"").replace(/\$\{([^}]+)\}/g,(es,bo)=>String(Fo[bo]??es))),Is=so=>Td(String(so||"").replace(/\$\{([^}]+)\}/g,(es,bo)=>String(Fo[bo]??es))),Sn=(so,es)=>{const bo=es!=null&&es.when?Is(so):kn(so);if(!bo)return null;const Ir=ct.get(bo);if(Ir)return Ir;try{const Ja=yb(bo,pl,Fo,Pu.get(he),je);return ct.set(bo,Ja),Ja}catch{return null}},Ao=so=>{const es=Is(so);if(!es)return null;const bo=Vt.get(es);if(bo)return bo;try{const Ir=Lp(es);return Vt.set(es,Ir),Ir}catch{return null}},Io=so=>{const es=Is(so);if(!es)return!1;const bo=rn.get(es);if(bo!=null)return bo;const Ir=Ao(so),Ja=Ir?o0(Ir):!1;return rn.set(es,Ja),Ja},go=so=>{const es=Is(so);if(!es)return null;const bo=et.get(es);if(bo)return bo;if(ne&&Io(so)){je==null||je.emitOnce(`cond_type:${es}`,fd);const Kc=new Uint8Array(Oe);return et.set(es,Kc),Kc}const Ir=Sn(so,{when:!0});if(!Ir)return null;const Ja=new Uint8Array(Oe),zl=ne?`cond_na:${es}`:"";for(let Kc=0;Kc<Oe;(Kc+=1)-1){const bu=Ir[Kc];Ja[Kc]=ne?y0(bu,je,zl)?1:0:Number.isFinite(bu)&&bu!==0?1:0}return et.set(es,Ja),Ja};for(let so=0;so<p.length;(so+=1)-1){const es=p[so],bo=String((es==null?void 0:es.type)||"");if(bo!=="entry_long"&&bo!=="exit_long"&&bo!=="entry_short"&&bo!=="exit_short"&&bo!=="alert"&&bo!=="cancel"&&bo!=="cancel_all")continue;const Ir=String((es==null?void 0:es.id)??so),Ja=(es==null?void 0:es.orderId)!=null&&String(es.orderId).trim()?String(es.orderId).trim():void 0,zl=String((es==null?void 0:es.whenExpr)||"").trim(),Kc=String((es==null?void 0:es.when)||"").trim();if(!zl&&!Kc)continue;const bu=go(zl||Kc);if(!bu)continue;const oc=String((es==null?void 0:es.cooldownExpr)||"").trim(),gf=oc?Sn(oc):null;if(gf)for(let xu=0;xu<Oe;(xu+=1)-1){const Uf=gf[xu];if(Number.isFinite(Uf)&&(!Number.isInteger(Uf)||Uf<0))throw new Error("cooldownExpr must be a non-negative integer")}const lr=es==null?void 0:es.cooldownBars,ed=typeof lr=="number"&&Number.isFinite(lr)?Math.max(0,Math.floor(lr)):0,Qf=String((es==null?void 0:es.scoreExpr)||"").trim(),Ou=Qf?Sn(Qf):null;if(Ou)for(let xu=0;xu<Oe;(xu+=1)-1){const Uf=Ou[xu];if(Number.isFinite(Uf)&&(!Number.isInteger(Uf)||Uf<0||Uf>10))throw new Error("scoreExpr must be an integer 0..10")}const Al=es==null?void 0:es.score,_f=typeof Al=="number"&&Number.isFinite(Al)?Al:null;let Tl=0;for(let xu=0;xu<Oe;(xu+=1)-1){const Uf=gf&&Number.isFinite(gf[xu])?Math.max(0,Math.floor(gf[xu])):ed;if(Uf>0&&xu<Tl||!bu[xu])continue;const Sh=((Gy=Be[xu])==null?void 0:Gy.timestamp)??Date.now(),sh=Ou&&Number.isFinite(Ou[xu])?Ou[xu]:_f;Ne.push({type:bo,index:xu,timestamp:Sh,signalId:Ir,orderId:Ja,score:sh??null}),Uf>0&&(Tl=xu+Uf)}}T({id:lt,signals:Ne})}catch(Ne){console.error("[ScriptStudio] local signals/backtest error",Ne)}Bn=Eo,ie=!0}if(ie&&(fs=z),!(ts||z===fs)){ts=!0,fs=z;const Ne=new Worker(new URL(""+new URL("../workers/signals.worker-CYmm2_EA.js",import.meta.url).href,import.meta.url),{type:"module"}),Oe={id:lt,condSeries:pl,bars:Be,signals:p,params:Fo,userFunctions:S==null?void 0:S.userFunctions};Ne.onerror=()=>{ts=!1;try{Ne.terminate()}catch{}},Ne.onmessage=ct=>{const et=ct.data;if(!(!et||et.id!==Oe.id)){T(et);try{Ne.terminate()}catch{}ts=!1}},Ne.postMessage(Oe)}}}catch(Be){ts=!1,console.error("[ScriptStudio] signals worker error",Be)}}const Kd=Ls(((Yy=S==null?void 0:S.style)==null?void 0:Yy.runtimeDrawAutoscale)??((Ky=S==null?void 0:S.style)==null?void 0:Ky.includeDrawingsInAutoscale)),Vp=lt=>!!Kd||Ls(lt)===!0;if(!!Kd||ja.some(lt=>Vp(lt==null?void 0:lt.includeInAutoscale))||Aa.some(lt=>Vp(lt==null?void 0:lt.includeInAutoscale))||jr.some(lt=>Vp(lt==null?void 0:lt.includeInAutoscale))||Do.some(lt=>Vp(lt==null?void 0:lt.includeInAutoscale))||ap.some(lt=>{var Be;return Vp((Be=lt==null?void 0:lt.meta)==null?void 0:Be.includeInAutoscale)})){const lt=new Array(Kt),Be=new Array(Kt),p=(Oe,ct)=>{if(!Number.isFinite(ct)||Oe<0||Oe>=Kt)return;const et=lt[Oe],Vt=Be[Oe];lt[Oe]=et==null||ct<et?ct:et,Be[Oe]=Vt==null||ct>Vt?ct:Vt},b=(Oe,ct,et)=>{if(!Number.isFinite(et))return;const Vt=Math.max(0,Math.min(Oe,ct)),rn=Math.min(Kt-1,Math.max(Oe,ct));for(let kn=Vt;kn<=rn;(kn+=1)-1)p(kn,et)},T=Oe=>{let ct=Number(Oe==null?void 0:Oe.startIndex),et=Number(Oe==null?void 0:Oe.endIndex);if(!Number.isFinite(ct)||!Number.isFinite(et))return null;if(ct>et){const rn=ct;ct=et,et=rn}const Vt=String((Oe==null?void 0:Oe.extend)||"").toLowerCase();return Vt==="both"?(ct=0,et=Math.max(0,Kt-1)):Vt==="left"?ct=0:Vt==="right"&&(et=Math.max(0,Kt-1)),{a:ct,b:et}},z=(Oe,ct)=>Number.isFinite(Oe==null?void 0:Oe.slope)&&Number.isFinite(Oe==null?void 0:Oe.intercept)?Oe.slope*ct+Oe.intercept:Number.isFinite(Oe==null?void 0:Oe.startValue)?Oe.startValue:Number.NaN;for(const Oe of ja){if(!Vp(Oe==null?void 0:Oe.includeInAutoscale))continue;let ct=Oe.leftIndex,et=Oe.rightIndex;if(ne){const Vt=Math.max(0,Kt-1),rn=Number.isFinite(fromIndex)?fromIndex:ct,kn=Number.isFinite(toIndex)?toIndex:et,Is=Math.max(0,Math.min(rn,kn)),Sn=Math.min(Vt,Math.max(rn,kn)),Ao=qk({baseLeft:ct,baseRight:et,extend:Oe.extend,vpLeft:Is,vpRight:Sn,lastIndex:Vt});Ao&&(ct=Ao.leftExt,et=Ao.rightExt)}else{const Vt=String(Oe.extend||"").toLowerCase();Vt==="both"?(ct=0,et=Math.max(0,Kt-1)):Vt==="left"?ct=0:Vt==="right"&&(et=Math.max(0,Kt-1))}b(ct,et,Number(Oe.topValue)),b(ct,et,Number(Oe.bottomValue))}for(const Oe of Aa){if(!Vp(Oe==null?void 0:Oe.includeInAutoscale))continue;const ct=T(Oe);if(!ct)continue;const{a:et,b:Vt}=ct;if(Number.isFinite(Oe==null?void 0:Oe.slope)&&Number.isFinite(Oe==null?void 0:Oe.intercept))for(let rn=et;rn<=Vt;(rn+=1)-1){const kn=z(Oe,rn);p(rn,kn)}else p(et,Number(Oe==null?void 0:Oe.startValue)),p(Vt,Number(Oe==null?void 0:Oe.endValue))}for(const Oe of jr){if(!Vp(Oe==null?void 0:Oe.includeInAutoscale))continue;const ct=Oe==null?void 0:Oe.line1,et=Oe==null?void 0:Oe.line2;if(!ct||!et)continue;const Vt=T(ct),rn=T(et);if(!Vt||!rn)continue;const kn=Math.max(Vt.a,rn.a),Is=Math.min(Vt.b,rn.b);if(!(kn>Is))for(let Sn=kn;Sn<=Is;(Sn+=1)-1){const Ao=z(ct,Sn),Io=z(et,Sn);!Number.isFinite(Ao)||!Number.isFinite(Io)||(p(Sn,Math.min(Ao,Io)),p(Sn,Math.max(Ao,Io)))}}for(const Oe of ap){if(!Vp((Xy=Oe==null?void 0:Oe.meta)==null?void 0:Xy.includeInAutoscale))continue;const ct=Oe==null?void 0:Oe.index,et=(Zy=Oe==null?void 0:Oe.meta)==null?void 0:Zy.value;typeof ct!="number"||!Number.isFinite(ct)||Number.isFinite(et)&&p(ct,Number(et))}for(const Oe of Do){if(!Vp(Oe==null?void 0:Oe.includeInAutoscale))continue;const ct=Array.isArray(Oe==null?void 0:Oe.points)?Oe.points:[];if(!ct.length)continue;const et=(Oe==null?void 0:Oe.xloc)??"bar_index";for(const Vt of ct){const rn=Number(Vt==null?void 0:Vt.x),kn=Number(Vt==null?void 0:Vt.y);if(!Number.isFinite(rn)||!Number.isFinite(kn))continue;const Is=tn(rn,et,{kind:"heatmap",id:(Oe==null?void 0:Oe.id)??"heatmap"});Is!=null&&p(Is,kn)}}const ie=Su[ka.min],Ne=Su[ka.max];for(let Oe=0;Oe<Kt;(Oe+=1)-1){const ct=lt[Oe],et=Be[Oe];ie&&(ie[Oe]=ct),Ne&&(Ne[Oe]=et);const Vt=Yc[Oe];Vt&&(Vt[ka.min]=ct,Vt[ka.max]=et)}}Yc.length=Math.max(Yc.length,Wi+1);const Np=Ha;Np.__rows=Yc,Np.__len=Kt,Np.__futureBars=st.futureBars,Np.__virtualMaxIndex=Wi,Np.__drawConfig=st,Np.__scriptSource=ae,lu=Ci,Cd=Np,Id.__lastResult=Cd;try{ul.requestKey("script-overlay:redraw",()=>{try{kd()}catch{}})}catch{}return Cd},draw:({ctx:U,indicator:Kt,bounding:bs,xAxis:Ds,yAxis:_s,chart:zi})=>{var pd;if(!U||!Ds||!_s)return!1;const ii=(Kt==null?void 0:Kt.result)||{},ia=Array.isArray(ii)?ii:Array.isArray(ii.__rows)?ii.__rows:[],$r=nv("interactionV2"),rr=ii.__drawConfig||{},Jl=Number.isFinite(ii.__futureBars)?Math.max(0,Number(ii.__futureBars)):Number.isFinite(rr==null?void 0:rr.futureBars)?Math.max(0,Number(rr.futureBars)):0,Wa=typeof ii.__virtualMaxIndex=="number"?Number(ii.__virtualMaxIndex):ia.length&&Jl?ia.length-1+Jl:ia.length?ia.length-1:-1,Ci=typeof Ds.getRange=="function"?Ds.getRange():{from:0,to:ia.length?ia.length-1:0},Ha=ia.length?ia.length-1:-1,ki=Math.max(Ha,Wa),ys=ki>=0?Math.max(0,Math.floor(((Ci==null?void 0:Ci.from)??0)-2)):0,tr=ki>=0?Math.min(ki,Math.ceil(((Ci==null?void 0:Ci.to)??ki)+2)):-1;if($r&&ki>=1){const te=Math.max(0,Math.min(ys,ki-1)),nn=Ds.convertToPixel(te),mt=Ds.convertToPixel(te+1),pn=Number.isFinite(nn)&&Number.isFinite(mt)?Math.abs(mt-nn):NaN,Nt=typeof _s.getRange=="function"?_s.getRange():null,Ps=Number(Nt==null?void 0:Nt.from),Nn=Number(Nt==null?void 0:Nt.to);let hs=NaN;if(Number.isFinite(Ps)&&Number.isFinite(Nn)&&Ps!==Nn){const ss=(Ps+Nn)/2,Ln=(Nn-Ps)/100,tn=_s.convertToPixel(ss),Ws=_s.convertToPixel(ss+Ln);Number.isFinite(tn)&&Number.isFinite(Ws)&&(hs=Math.abs(Ws-tn))}Gh={x:Number.isFinite(pn)&&pn>0?pn:Gh.x,y:Number.isFinite(hs)&&hs>0?hs:Gh.y}}(()=>{var Nn,hs,ss,Ln,tn,Ws,Hs;if(!Jl||Wa<=Ha){(yt.maxPx||yt.offsetPx)&&(yt.maxPx=0,yt.offsetPx=0,yt.lastAppliedTs=0);return}const te=(tn=(Ln=(ss=(hs=(Nn=Ds==null?void 0:Ds.getParent)==null?void 0:Nn.call(Ds))==null?void 0:hs.getChart)==null?void 0:ss.call(hs))==null?void 0:Ln.getChartStore)==null?void 0:tn.call(Ln);if(!te)return;const nn=typeof performance<"u"?performance.now():Date.now();if(nn-yt.lastAppliedTs<500)return;const mt=((Ws=te.getBarSpace)==null?void 0:Ws.call(te).bar)??6,pn=Math.max(0,Jl*mt),Nt=((Hs=te.getOffsetRightDistance)==null?void 0:Hs.call(te))??0,Ps=Math.max(pn,Nt);typeof te.setMaxOffsetRightDistance=="function"&&Math.abs(Ps-yt.maxPx)>.5&&(te.setMaxOffsetRightDistance(Ps),yt.maxPx=Ps),Nt+.5<pn&&typeof te.setOffsetRightDistance=="function"&&Math.abs(pn-yt.offsetPx)>.5&&(te.setOffsetRightDistance(pn,!0),yt.offsetPx=pn,yt.lastAppliedTs=nn)})();const Lo=bs?{left:0,top:0,width:bs.width,height:bs.height}:void 0;U.save(),Lo&&(U.beginPath(),U.rect(0,0,Lo.width,Lo.height),U.clip());const Gi=Array.isArray(ii.__runtimeBoxDefs)?ii.__runtimeBoxDefs:[],Nr=Array.isArray(ii.__runtimePolylineDefs)?ii.__runtimePolylineDefs:[],Vi=Array.isArray(ii.__runtimePolygonDefs)?ii.__runtimePolygonDefs:[],Ho=Array.isArray(ii.__runtimePathDefs)?ii.__runtimePathDefs:[],Ar=Array.isArray(ii.__runtimeLineFills)?ii.__runtimeLineFills:[],ma=Array.isArray(ii.__runtimeLineDefs)?ii.__runtimeLineDefs:[],rl=Array.isArray(ii.__runtimeTables)?ii.__runtimeTables:[],Cr=Array.isArray(Do)?Do:[],Yi=Array.isArray(ii.__lineDefs)?ii.__lineDefs:[],ha=Array.isArray(ii.__labelItems)?ii.__labelItems:[],Dr=ii.__tsIndex||{},va=Array.isArray(ii.__timeSeriesMs)?ii.__timeSeriesMs:[];let al=0;if(va.length>=2){let te=0;for(let nn=1;nn<va.length;(nn+=1)-1)te+=Math.abs(va[nn]-va[nn-1]);al=te/(va.length-1)}const ns=ia.length,zs=(te,nn)=>{const mt=typeof te=="string"?te.trim().toLowerCase():"";return mt==="background"||mt==="bg"?"background":mt==="main"||mt==="base"?"main":mt==="overlay"||mt==="over"?"overlay":mt==="ui"?"ui":nn},Rs=(te,nn)=>{if(typeof te=="number"&&Number.isFinite(te))return te;if(typeof te=="string"){const mt=Number(te);if(Number.isFinite(mt))return mt}return nn},Ni=te=>{const nn=String(te||"").trim().toLowerCase();return nn?nn.replace(/[^a-z0-9_-]+/g,"_"):"script"},Ma={box:"background",line:"background",linefill:"background",label:"background",table:"ui",lineSegment:"background",polyline:"background",polygon:"background",path:"background"},ll={box:10,lineSegment:20,linefill:30,line:40,label:50,table:60,polyline:25,polygon:15,path:27},ir=$r&&z0(),ca=`${Ni((Kt==null?void 0:Kt.__scriptSource)??(ii==null?void 0:ii.__scriptSource)??(rr==null?void 0:rr.source))}:${(Kt==null?void 0:Kt.name)??"runtime"}:${(Kt==null?void 0:Kt.paneId)??"pane"}`,ui=typeof(bs==null?void 0:bs.left)=="number"&&Number.isFinite(bs.left)?bs.left:0,bi=typeof(bs==null?void 0:bs.top)=="number"&&Number.isFinite(bs.top)?bs.top:0,ai={x:ui,y:bi},fi=Yu(),ra=(Kt==null?void 0:Kt.paneId)??"candle_pane",pr=fi[ra]||fi.candle_pane,Ti=pr&&Number.isFinite(pr.width)&&Number.isFinite(pr.height)?{left:pr.left,top:pr.top,width:pr.width,height:pr.height}:bs&&Number.isFinite(bs.width)&&Number.isFinite(bs.height)?{left:ui,top:bi,width:bs.width,height:bs.height}:null,Di=Ti&&Number.isFinite(Ti.left)?Ti.left:ui,Sa=Ti&&Number.isFinite(Ti.top)?Ti.top:bi,Uo=!!(Z!=null&&Z.isWebgl&&oe&&Ti),ga=[],qr=te=>Uo?(ga.push(te),!0):!1,Ri=te=>te?qr(te):!1;if(Z&&xe&&Ti){if(Cr.length){const te=nl({runtimeHeatmaps:Cr,bounds:Ti,xAxis:Ds,yAxis:_s,offsetX:Ti.left,offsetY:Ti.top,drawConfigMeta:rr,len:ns,tsIndex:Dr,timeSeriesMs:va,avgIntervalMs:al});te.length&&ut.push({bounds:Ti,heatmaps:te})}mu()}const Ka=(pd=zi==null?void 0:zi.getChartStore)==null?void 0:pd.call(zi),Jo=$r&&typeof(Ds==null?void 0:Ds.convertFromPixel)=="function"&&typeof(_s==null?void 0:_s.convertFromPixel)=="function"?{toIndex:te=>typeof(Ka==null?void 0:Ka.coordinateToFloatIndex)=="function"?Ka.coordinateToFloatIndex(te):Ds.convertFromPixel(te),toValue:te=>_s.convertFromPixel(te),toX:te=>typeof(Ka==null?void 0:Ka.dataIndexToCoordinate)=="function"?Ka.dataIndexToCoordinate(te):Ds.convertToPixel(te),toY:te=>_s.convertToPixel(te)}:null,ua=$r?(()=>{var tn,Ws;const te=Number((Ws=(tn=zi==null?void 0:zi.getSymbol)==null?void 0:tn.call(zi))==null?void 0:Ws.pricePrecision),nn=Number.isFinite(te)?te:j_(s().symbol);if(Number.isFinite(nn)&&nn>=0)return Math.pow(10,-Math.max(0,nn));const mt=typeof(_s==null?void 0:_s.getRange)=="function"?_s.getRange():null,pn=Number(mt==null?void 0:mt.from),Nt=Number(mt==null?void 0:mt.to);if(!Number.isFinite(pn)||!Number.isFinite(Nt)||pn===Nt)return Number.NaN;const Nn=Math.abs(Nt-pn)/40;if(!Number.isFinite(Nn)||Nn<=0)return Number.NaN;const hs=Math.pow(10,Math.floor(Math.log10(Nn))),ss=Nn/hs;let Ln=1;return ss>5?Ln=10:ss>2?Ln=5:ss>1&&(Ln=2),Ln*hs})():Number.NaN,Qr=$r&&Jo?{timeStep:1,priceStep:Number.isFinite(ua)&&ua>0?ua:Number.NaN}:null,ar=[],_a=new Map,Pl=[],gr=8,Ur=gr/2,Ra={n:"ns-resize",s:"ns-resize",e:"ew-resize",w:"ew-resize",ne:"nesw-resize",sw:"nesw-resize",nw:"nwse-resize",se:"nwse-resize"},xi=12,Qs=()=>(w0+=1)-1,ji=te=>{var mt;const nn=(te==null?void 0:te.id)??((mt=te==null?void 0:te.meta)==null?void 0:mt.id)??(te==null?void 0:te.name)??(te==null?void 0:te.key);return nn!=null&&String(nn).trim()?String(nn):null},qa=te=>{const nn=ji(te.payload);return nn?`${ca}:${nn}`:`${ca}:${te.kind}:${te.createdAt}`},_i=te=>{const nn=ji(te);return nn?`${ca}:${nn}`:null},da=te=>{if(!$r)return null;const nn=s_(te);return nn||null},dr=te=>{const nn=te==null?void 0:te.box;return nn&&Number.isFinite(nn.leftIndex)&&Number.isFinite(nn.rightIndex)&&Number.isFinite(nn.topValue)&&Number.isFinite(nn.bottomValue)?nn:null},fl=te=>{const nn=te==null?void 0:te.label;return nn&&Number.isFinite(nn.index)&&Number.isFinite(nn.value)?nn:null},kc=te=>{const nn=te==null?void 0:te.translate;if(nn&&Number.isFinite(nn.dxIndex)&&Number.isFinite(nn.dyValue)){const mt=Number(nn.dxIndex),pn=Number(nn.dyValue);if(mt!==0||pn!==0)return{dxIndex:mt,dyValue:pn}}return null},Ml=Number.isFinite(rr==null?void 0:rr.decimationPx)&&Number(rr.decimationPx)>0?Math.floor(Number(rr.decimationPx)):re.decimationPx,Nl=(te,nn)=>nn<ys-2||te>tr+2,Gl=te=>({x:Ds.convertToPixel(te.index),y:_s.convertToPixel(te.value)}),uu=(te,nn)=>{if(!nn)return te;const mt=kc(da(nn));return mt?{index:te.index+mt.dxIndex,value:te.value+mt.dyValue}:te},Sc=(te,nn)=>{if(!nn)return te;const mt=kc(da(nn));return mt?te.map(pn=>({index:pn.index+mt.dxIndex,value:pn.value+mt.dyValue})):te},Cc=(te,nn)=>{if(!nn)return te;const mt=kc(da(nn));if(!mt)return te;const pn=mt.dxIndex,Nt=mt.dyValue,Ps=Number(te==null?void 0:te.slope),Nn=Number.isFinite(Ps)&&Number.isFinite(te==null?void 0:te.intercept)?Number(te.intercept)+Nt-Ps*pn:te==null?void 0:te.intercept;return{...te,startIndex:Number(te.startIndex)+pn,endIndex:Number(te.endIndex)+pn,startValue:Number(te.startValue)+Nt,endValue:Number(te.endValue)+Nt,intercept:Nn}},du=(te,nn)=>{if(!(te!=null&&te.points)||te.points.length<2)return;const mt=Sc(te.points,nn),pn=Math.min(...mt.map(ks=>ks.index)),Nt=Math.max(...mt.map(ks=>ks.index));if(Nl(pn,Nt))return;const Ps=Ml>1?fx(mt,Gl,Ml):mt;if(!Ps.length)return;U.save(),U.beginPath();let Nn=!0,hs=Number.POSITIVE_INFINITY,ss=Number.NEGATIVE_INFINITY,Ln=Number.POSITIVE_INFINITY,tn=Number.NEGATIVE_INFINITY;for(const ks of Ps){const{x:Jn,y:En}=Gl(ks);!Number.isFinite(Jn)||!Number.isFinite(En)||(Nn?(U.moveTo(Jn,En),Nn=!1):U.lineTo(Jn,En),Jn<hs&&(hs=Jn),Jn>ss&&(ss=Jn),En<Ln&&(Ln=En),En>tn&&(tn=En))}if(Nn){U.restore();return}const Ws=typeof te.opacity=="number"?Math.max(0,Math.min(1,te.opacity)):1,Hs=te.width??2,As=Number.isFinite(te.glow)?te.glow:0,Ls=Number.isFinite(te.glowOpacity)?Math.max(0,Math.min(1,te.glowOpacity)):.35;if(As>0&&(U.save(),U.strokeStyle=te.glowColor||te.color||"#e2e8f0",U.globalAlpha=Ws*Ls,U.lineWidth=Hs+As,U.setLineDash([]),U.stroke(),U.restore()),te.gradient&&(te.gradient.from||te.gradient.to)){const ks=ah(U,{minX:Number.isFinite(hs)?hs:0,maxX:Number.isFinite(ss)&&ss!==hs?ss:Number.isFinite(hs)?hs+1:1,minY:Number.isFinite(Ln)?Ln:0,maxY:Number.isFinite(tn)&&tn!==Ln?tn:Number.isFinite(Ln)?Ln+1:1},te.gradient,te.color||"#e2e8f0");U.strokeStyle=ks??(te.color||"#e2e8f0")}else U.strokeStyle=te.color||"#e2e8f0";U.globalAlpha=Ws,U.lineWidth=Hs;const js=String(te.style||"solid").toLowerCase();js==="dashed"?U.setLineDash([6,4]):js==="dotted"?U.setLineDash([2,2]):U.setLineDash([]),U.stroke(),U.setLineDash([]),U.globalAlpha=1,U.restore()},Gc=(te,nn)=>{if(!(te!=null&&te.points)||te.points.length<3)return;const mt=Sc(te.points,nn),pn=Math.min(...mt.map(As=>As.index)),Nt=Math.max(...mt.map(As=>As.index));if(Nl(pn,Nt))return;const Ps=Ml>1?fx(mt,Gl,Ml):mt;if(Ps.length<3)return;U.save(),U.beginPath();let Nn=!0,hs=Number.POSITIVE_INFINITY,ss=Number.NEGATIVE_INFINITY,Ln=Number.POSITIVE_INFINITY,tn=Number.NEGATIVE_INFINITY;for(const As of Ps){const{x:Ls,y:js}=Gl(As);!Number.isFinite(Ls)||!Number.isFinite(js)||(Nn?(U.moveTo(Ls,js),Nn=!1):U.lineTo(Ls,js),Ls<hs&&(hs=Ls),Ls>ss&&(ss=Ls),js<Ln&&(Ln=js),js>tn&&(tn=js))}U.closePath();const Ws=typeof te.opacity=="number"?Math.max(0,Math.min(1,te.opacity)):1;U.globalAlpha=Ws;const Hs=te.fillGradient;if(Hs&&(Hs.from||Hs.to)){const As=Hs.from||te.fillColor||"#38bdf8",Ls=Hs.to||te.fillColor||As,js=String(Hs.mode||"vertical").toLowerCase(),ks=Number.isFinite(hs)?hs:0,Jn=Number.isFinite(ss)&&ss!==hs?ss:ks+1,En=Number.isFinite(Ln)?Ln:0,Wi=Number.isFinite(tn)&&tn!==Ln?tn:En+1;let ml;if(js==="horizontal")ml=U.createLinearGradient(ks,En,Jn,En);else if(js==="radial"){const Qo=(ks+Jn)/2,po=(En+Wi)/2,aa=Math.max(Jn-ks,Wi-En)/2;ml=U.createRadialGradient(Qo,po,0,Qo,po,Math.max(1,aa))}else ml=U.createLinearGradient(ks,En,ks,Wi);ml.addColorStop(0,As),ml.addColorStop(1,Ls),U.fillStyle=ml,U.fill()}else te.fillColor&&(U.fillStyle=te.fillColor,U.fill());if(te.strokeColor||te.strokeWidth){const As=te.strokeWidth??1,Ls=Number.isFinite(te.glow)?te.glow:0,js=Number.isFinite(te.glowOpacity)?Math.max(0,Math.min(1,te.glowOpacity)):.35;Ls>0&&(U.save(),U.strokeStyle=te.glowColor||te.strokeColor||te.fillColor||"#e2e8f0",U.globalAlpha=Ws*js,U.lineWidth=As+Ls,U.setLineDash([]),U.stroke(),U.restore()),U.strokeStyle=te.strokeColor||"#e2e8f0",U.lineWidth=As;const ks=String(te.strokeStyle||"solid").toLowerCase();ks==="dashed"?U.setLineDash([6,4]):ks==="dotted"?U.setLineDash([2,2]):U.setLineDash([]),U.stroke(),U.setLineDash([])}U.globalAlpha=1,U.restore()},bl=(te,nn)=>{if(!(te!=null&&te.commands)||!te.commands.length)return;const mt=te.commands.map(js=>uu({index:js.index,value:js.value},nn)),pn=Math.min(...mt.map(js=>js.index)),Nt=Math.max(...mt.map(js=>js.index));if(Nl(pn,Nt))return;U.save(),U.beginPath();let Ps=!1,Nn=Number.POSITIVE_INFINITY,hs=Number.NEGATIVE_INFINITY,ss=Number.POSITIVE_INFINITY,Ln=Number.NEGATIVE_INFINITY;for(let js=0;js<te.commands.length;(js+=1)-1){const ks=te.commands[js],Jn=mt[js],En=Ds.convertToPixel(Jn.index),Wi=_s.convertToPixel(Jn.value);!Number.isFinite(En)||!Number.isFinite(Wi)||(ks.cmd==="M"?(U.moveTo(En,Wi),Ps=!0):ks.cmd==="L"&&(U.lineTo(En,Wi),Ps=!0),En<Nn&&(Nn=En),En>hs&&(hs=En),Wi<ss&&(ss=Wi),Wi>Ln&&(Ln=Wi))}if(!Ps){U.restore();return}const tn=typeof te.opacity=="number"?Math.max(0,Math.min(1,te.opacity)):1,Ws=te.width??2,Hs=Number.isFinite(te.glow)?te.glow:0,As=Number.isFinite(te.glowOpacity)?Math.max(0,Math.min(1,te.glowOpacity)):.35;if(Hs>0&&(U.save(),U.strokeStyle=te.glowColor||te.color||"#e2e8f0",U.globalAlpha=tn*As,U.lineWidth=Ws+Hs,U.setLineDash([]),U.stroke(),U.restore()),te.gradient&&(te.gradient.from||te.gradient.to)){const js=ah(U,{minX:Number.isFinite(Nn)?Nn:0,maxX:Number.isFinite(hs)&&hs!==Nn?hs:Number.isFinite(Nn)?Nn+1:1,minY:Number.isFinite(ss)?ss:0,maxY:Number.isFinite(Ln)&&Ln!==ss?Ln:Number.isFinite(ss)?ss+1:1},te.gradient,te.color||"#e2e8f0");U.strokeStyle=js??(te.color||"#e2e8f0")}else U.strokeStyle=te.color||"#e2e8f0";U.lineWidth=Ws;const Ls=String(te.style||"solid").toLowerCase();Ls==="dashed"?U.setLineDash([6,4]):Ls==="dotted"?U.setLineDash([2,2]):U.setLineDash([]),U.globalAlpha=tn,U.stroke(),U.setLineDash([]),U.globalAlpha=1,U.restore()},fu=(te,nn)=>{if(!(te!=null&&te.points)||te.points.length<2)return[];const mt=Sc(te.points,nn),pn=Math.min(...mt.map(ss=>ss.index)),Nt=Math.max(...mt.map(ss=>ss.index));if(Nl(pn,Nt))return[];const Ps=Ml>1?fx(mt,Gl,Ml):mt,Nn=[];let hs=null;for(const ss of Ps){const{x:Ln,y:tn}=Gl(ss);if(!Number.isFinite(Ln)||!Number.isFinite(tn))continue;const Ws={x:Ln+ui,y:tn+bi};hs&&Nn.push({a:hs,b:Ws}),hs=Ws}return Nn},Pd=(te,nn)=>{if(!(te!=null&&te.commands)||!te.commands.length)return[];const mt=te.commands.map(hs=>uu({index:hs.index,value:hs.value},nn)),pn=Math.min(...mt.map(hs=>hs.index)),Nt=Math.max(...mt.map(hs=>hs.index));if(Nl(pn,Nt))return[];const Ps=[];let Nn=null;for(let hs=0;hs<te.commands.length;(hs+=1)-1){const ss=te.commands[hs],Ln=mt[hs],tn=Ds.convertToPixel(Ln.index),Ws=_s.convertToPixel(Ln.value);if(!Number.isFinite(tn)||!Number.isFinite(Ws))continue;const Hs={x:tn+ui,y:Ws+bi};ss.cmd==="M"?Nn=Hs:ss.cmd==="L"&&(Nn&&Ps.push({a:Nn,b:Hs}),Nn=Hs)}return Ps},hf=(te,nn)=>{if(!(te!=null&&te.points)||te.points.length<3)return[];const mt=Sc(te.points,nn),pn=Math.min(...mt.map(Nn=>Nn.index)),Nt=Math.max(...mt.map(Nn=>Nn.index));if(Nl(pn,Nt))return[];const Ps=[];for(const Nn of mt){const hs=Ds.convertToPixel(Nn.index),ss=_s.convertToPixel(Nn.value);!Number.isFinite(hs)||!Number.isFinite(ss)||Ps.push({x:hs+ui,y:ss+bi})}return Ps},yu={background:[],main:[],overlay:[],ui:[]};let Bf=0;const Su=(te,nn,mt,pn)=>{const Nt=zs(nn,Ma[te]),Ps=Rs(mt,ll[te]),Nn={kind:te,layer:Nt,zIndex:Ps,createdAt:(Bf+=1)-1,payload:pn};if($r&&te!=="table"&&(i(xf)||i(Bm))){const hs=qa(Nn);(hs===i(xf)||hs===i(Bm))&&(Nn.layer="overlay",Nn.zIndex=Math.max(Nn.zIndex,1e5))}yu[Nn.layer].push(Nn)};if(Gi.length)for(const te of Gi)te&&Su("box",te.layer,te.zIndex,te);if(Vi.length)for(const te of Vi)te&&Su("polygon",te.layer,te.zIndex,te);if(Nr.length)for(const te of Nr)te&&Su("polyline",te.layer,te.zIndex,te);if(Ho.length)for(const te of Ho)te&&Su("path",te.layer,te.zIndex,te);if(Yi.length)for(const te of Yi)te&&Su("lineSegment",te.layer,te.zIndex,te);if(Ar.length)for(const te of Ar)te&&Su("linefill",te.layer,te.zIndex,te);if(ma.length)for(const te of ma)te&&Su("line",te.layer,te.zIndex,te);if(i(yr)&&ha.length)for(const te of ha){const nn=te==null?void 0:te.meta;nn&&Su("label",nn.layer,nn.zIndex,te)}if(rl.length)for(const te of rl)te&&Su("table",te.layer,te.zIndex,te);if(ir&&ki>=0){let te=hh.get(ca);if(!te||!Number.isFinite(te.leftA)||!Number.isFinite(te.rightA)||te.rightA>ki||te.rightB>ki){const nn=typeof(_s==null?void 0:_s.getRange)=="function"?_s.getRange():null,mt=Number(nn==null?void 0:nn.from),pn=Number(nn==null?void 0:nn.to);if(Number.isFinite(mt)&&Number.isFinite(pn)&&mt!==pn){const Nt=Math.min(mt,pn),Ps=Math.max(mt,pn),Nn=Math.max(1e-6,Ps-Nt),hs=Ps-Nn*.25,ss=Ps-Nn*.45,Ln=(hs+ss)/2,tn=Math.max(0,Math.floor((ys+tr)/2)),Ws=Math.max(0,tn-6),Hs=Math.max(0,tn+6),As=Math.max(0,tn-3),Ls=Math.max(0,tn+9);te={leftA:Ws,rightA:Hs,leftB:As,rightB:Ls,topValue:hs,bottomValue:ss,labelValue:Ln,midIndex:tn},hh.set(ca,te)}}te&&(Su("box","overlay",10,{id:"interaction_debug_box_a",leftIndex:te.leftA,rightIndex:te.rightA,topValue:te.topValue,bottomValue:te.bottomValue,borderColor:"rgba(59,130,246,0.9)",bgColor:"rgba(59,130,246,0.08)"}),Su("box","overlay",10,{id:"interaction_debug_box_b",leftIndex:te.leftB,rightIndex:te.rightB,topValue:te.topValue,bottomValue:te.bottomValue,borderColor:"rgba(16,185,129,0.9)",bgColor:"rgba(16,185,129,0.08)"}),Su("label","overlay",20,{index:te.midIndex,meta:{id:"interaction_debug_label_top",text:"TOP",value:te.labelValue,position:"above",shape:"label",size:12,color:"#f97316",textColor:"#0f172a",textAlign:"center",layer:"overlay",zIndex:20}}))}const Yc=te=>{let nn=te.leftIndex,mt=te.rightIndex;if(ne){const Ps=Math.max(0,ns-1),Nn=Number.isFinite(ys)?ys:nn,hs=Number.isFinite(tr)?tr:mt,ss=Math.max(0,Math.min(Nn,hs)),Ln=Math.min(Ps,Math.max(Nn,hs)),tn=qk({baseLeft:nn,baseRight:mt,extend:te.extend,vpLeft:ss,vpRight:Ln,lastIndex:Ps});tn&&(nn=tn.leftExt,mt=tn.rightExt)}else te.extend==="both"?(nn=0,mt=Math.max(0,ns-1)):te.extend==="left"?nn=0:te.extend==="right"&&(mt=Math.max(0,ns-1));const pn=te.topValue,Nt=te.bottomValue;return!Number.isFinite(nn)||!Number.isFinite(mt)||!Number.isFinite(pn)||!Number.isFinite(Nt)?null:{leftIndex:nn,rightIndex:mt,topValue:pn,bottomValue:Nt}},ea=(te,nn)=>{const mt=Yc(te);if(!mt)return null;const pn=nn?da(nn):null;return dr(pn)??mt},qf=(te,nn)=>{const mt=nn?da(nn):null,pn=Yc(te);if(!pn)return null;const Nt=dr(mt)??pn;let Ps=Ds.convertToPixel(Nt.leftIndex),Nn=Ds.convertToPixel(Nt.rightIndex),hs=_s.convertToPixel(Nt.topValue),ss=_s.convertToPixel(Nt.bottomValue);return!Number.isFinite(Ps)||!Number.isFinite(Nn)||!Number.isFinite(hs)||!Number.isFinite(ss)?null:{x1:Ps,x2:Nn,y1:hs,y2:ss}},dd=(te,nn)=>{const mt=qf(te,nn);if(!mt)return;const pn=Math.min(mt.x1,mt.x2),Nt=Math.min(mt.y1,mt.y2),Ps=Math.abs(mt.x2-mt.x1),Nn=Math.abs(mt.y2-mt.y1);if(ne){const ss=se(te);ss.bgColor&&(U.fillStyle=ss.bgColor,U.fillRect(pn,Nt,Ps,Nn)),ss.borderWidth>0&&ss.borderColor&&(U.strokeStyle=ss.borderColor,U.lineWidth=ss.borderWidth,U.setLineDash(ss.dash),U.lineDashOffset=ss.dashOffset,U.strokeRect(pn,Nt,Ps,Nn),U.setLineDash([]),U.lineDashOffset=0);const Ln=String(ss.textFinal||"");if(Ln){const tn=ss.fontPx,Ws=ss.padX,Hs=ss.padY,As=Math.max(0,Ps-Ws*2),Ls=Math.max(0,Nn-Hs*2);if(As<=0||Ls<=0)return;U.save(),U.beginPath(),U.rect(pn+Ws,Nt+Hs,As,Ls),U.clip(),U.font=`${tn}px "Inter", system-ui, -apple-system, sans-serif`,U.fillStyle=ss.textColor||ss.borderColor||"#e2e8f0";const js=ss.textHalign==="left"||ss.textHalign==="right"?ss.textHalign:"center";U.textAlign=js,U.textBaseline="top";const ks=Math.max(12,tn+2),Jn=Math.max(0,Ls);let En=Nt+Hs;ss.textValign==="middle"?En=Nt+Hs+(Jn-ks)/2:ss.textValign==="bottom"&&(En=Nt+Hs+Jn-ks);let Wi=pn+Ws+As/2;js==="left"&&(Wi=pn+Ws),js==="right"&&(Wi=pn+Ws+As),U.fillText(Ln,Wi,En),U.restore()}return}const hs=te.bgGradient??te.gradient;if(hs&&(hs.from||hs.to)){const ss=ah(U,{minX:pn,maxX:pn+Ps,minY:Nt,maxY:Nt+Nn},hs,te.bgColor||"#0f172a");U.fillStyle=ss??(te.bgColor||"#0f172a"),U.fillRect(pn,Nt,Ps,Nn)}else te.bgColor&&(U.fillStyle=te.bgColor,U.fillRect(pn,Nt,Ps,Nn));if(te.borderColor||te.borderWidth){U.strokeStyle=te.borderColor||"#64748b",U.lineWidth=te.borderWidth??1;const ss=String(te.borderStyle||"solid").toLowerCase();ss==="dashed"?U.setLineDash([6,4]):ss==="dotted"?U.setLineDash([2,2]):U.setLineDash([]),U.strokeRect(pn,Nt,Ps,Nn),U.setLineDash([])}if(te.text){const ss=String(te.text||"");if(ss){const Ln=typeof te.textSize=="number"&&te.textSize>0?te.textSize:12,tn=6,Ws=Math.max(0,Ps-tn*2);U.save(),U.font=`${Ln}px "Inter", system-ui, -apple-system, sans-serif`,U.fillStyle=te.textColor||te.borderColor||"#e2e8f0";const Hs=te.textHalign==="left"||te.textHalign==="right"?te.textHalign:"center";U.textAlign=Hs,U.textBaseline="top";const As=te.textWrap===!0,Ls=ss.split(/\n/),js=[];if(As&&Ws>0)for(const Qo of Ls){const po=Qo.split(/\s+/).filter(Boolean);let aa="";const Za=()=>{aa&&(js.push(aa),aa="")},Lc=Na=>{if(!Na)return;if(U.measureText(Na).width>Ws&&Ws>4){Za();let Go="";for(const Aa of Na){const jr=Go+Aa;U.measureText(jr).width>Ws&&Go?(js.push(Go),Go=Aa):Go=jr}Go&&js.push(Go);return}const Rr=aa?`${aa} ${Na}`:Na;U.measureText(Rr).width>Ws&&aa?(Za(),aa=Na):aa=Rr};for(const Na of po)Lc(Na);Za()}else for(const Qo of Ls)js.push(Qo);const ks=Math.max(12,Ln+2),Jn=Math.max(1,Math.floor(Math.max(0,Nn-tn*2)/ks));if(js.length>Jn){js.length=Jn;const Qo="...";let po=js[Jn-1]||"";if(Ws>0)for(;po&&U.measureText(`${po}${Qo}`).width>Ws;)po=po.slice(0,-1);js[Jn-1]=po?`${po}${Qo}`:Qo}const En=js.length*ks;let Wi=Nt+tn;te.textValign==="middle"||te.textValign==="center"?Wi=Nt+(Nn-En)/2:te.textValign==="bottom"&&(Wi=Nt+Nn-tn-En);let ml=pn+Ps/2;Hs==="left"&&(ml=pn+tn),Hs==="right"&&(ml=pn+Ps-tn);for(let Qo=0;Qo<js.length;(Qo+=1)-1)U.fillText(js[Qo],ml,Wi+Qo*ks);U.restore()}}},pl=(te,nn,mt,pn,Nt,Ps)=>{const Nn=Math.atan2(pn-nn,mt-te),hs=Math.max(6,Nt),ss=Nn+Math.PI-Math.PI/6,Ln=Nn+Math.PI+Math.PI/6,tn=mt+hs*Math.cos(ss),Ws=pn+hs*Math.sin(ss),Hs=mt+hs*Math.cos(Ln),As=pn+hs*Math.sin(Ln);U.beginPath(),U.moveTo(mt,pn),U.lineTo(tn,Ws),U.lineTo(Hs,As),U.closePath(),U.fillStyle=Ps,U.fill()},vf=(te,nn)=>{const mt=Cc(te,nn);let pn=NaN,Nt=NaN,Ps=NaN,Nn=NaN;if(mt.strictExtend){const Ls=typeof _s.getRange=="function"?_s.getRange():null,js=xb({startIndex:mt.startIndex,endIndex:mt.endIndex,startValue:mt.startValue,endValue:mt.endValue,slope:mt.slope,intercept:mt.intercept,extend:mt.extend,fromIndex:ys,toIndex:tr,yRange:Ls,toX:ks=>Ds.convertToPixel(ks),toY:ks=>_s.convertToPixel(ks)});if(!js)return;pn=js.extended.x1,Nt=js.extended.y1,Ps=js.extended.x2,Nn=js.extended.y2}else{let Ls=mt.startIndex,js=mt.endIndex;mt.extend==="both"?(Ls=0,js=Math.max(0,ns-1)):mt.extend==="left"?Ls=0:mt.extend==="right"&&(js=Math.max(0,ns-1));const ks=Number.isFinite(mt.slope)&&Number.isFinite(mt.intercept)?mt.slope*Ls+mt.intercept:mt.startValue,Jn=Number.isFinite(mt.slope)&&Number.isFinite(mt.intercept)?mt.slope*js+mt.intercept:mt.endValue;pn=Ds.convertToPixel(Ls),Nt=_s.convertToPixel(ks),Ps=Ds.convertToPixel(js),Nn=_s.convertToPixel(Jn)}if(!Number.isFinite(pn)||!Number.isFinite(Nt)||!Number.isFinite(Ps)||!Number.isFinite(Nn))return;U.beginPath(),U.moveTo(pn,Nt),U.lineTo(Ps,Nn);const hs=typeof mt.opacity=="number"?Math.max(0,Math.min(1,mt.opacity)):1,ss=mt.width??2,Ln=Number.isFinite(mt.glow)?mt.glow:0,tn=Number.isFinite(mt.glowOpacity)?Math.max(0,Math.min(1,mt.glowOpacity)):.35;if(Ln>0&&(U.save(),U.strokeStyle=mt.glowColor||mt.color||"#22c55e",U.globalAlpha=hs*tn,U.lineWidth=ss+Ln,U.setLineDash([]),U.stroke(),U.restore()),mt.gradient&&(mt.gradient.from||mt.gradient.to)){const Ls=ah(U,{minX:Math.min(pn,Ps),maxX:Math.max(pn,Ps),minY:Math.min(Nt,Nn),maxY:Math.max(Nt,Nn)},mt.gradient,mt.color||"#22c55e");U.strokeStyle=Ls??(mt.color||"#22c55e")}else U.strokeStyle=mt.color||"#22c55e";U.globalAlpha=hs,U.lineWidth=ss;const Ws=(mt.style||"solid").toLowerCase(),Hs=Ws.includes("arrow"),As=Hs?"solid":Ws;if(mt.strictExtend){const Ls=Uk(As,mt.width??2);U.setLineDash(Ls),U.lineDashOffset=0}else As==="dashed"?U.setLineDash([6,4]):As==="dotted"?U.setLineDash([2,2]):U.setLineDash([]);if(U.stroke(),U.setLineDash([]),U.globalAlpha=1,Hs){const Ls=Math.max(6,(mt.width??2)*2.5),js=mt.color||"#22c55e";(Ws.includes("left")||Ws.includes("both"))&&pl(Ps,Nn,pn,Nt,Ls,js),(Ws.includes("right")||Ws.includes("both"))&&pl(pn,Nt,Ps,Nn,Ls,js)}},lc=(te,nn)=>{const mt=Cc(te,nn);let pn=NaN,Nt=NaN,Ps=NaN,Nn=NaN;if(mt.strictExtend){const hs=typeof _s.getRange=="function"?_s.getRange():null,ss=xb({startIndex:mt.startIndex,endIndex:mt.endIndex,startValue:mt.startValue,endValue:mt.endValue,slope:mt.slope,intercept:mt.intercept,extend:mt.extend,fromIndex:ys,toIndex:tr,yRange:hs,toX:Ln=>Ds.convertToPixel(Ln),toY:Ln=>_s.convertToPixel(Ln)});if(!ss)return null;pn=ss.extended.x1,Nt=ss.extended.y1,Ps=ss.extended.x2,Nn=ss.extended.y2}else{let hs=mt.startIndex,ss=mt.endIndex;mt.extend==="both"?(hs=0,ss=Math.max(0,ns-1)):mt.extend==="left"?hs=0:mt.extend==="right"&&(ss=Math.max(0,ns-1));const Ln=Number.isFinite(mt.slope)&&Number.isFinite(mt.intercept)?mt.slope*hs+mt.intercept:mt.startValue,tn=Number.isFinite(mt.slope)&&Number.isFinite(mt.intercept)?mt.slope*ss+mt.intercept:mt.endValue;pn=Ds.convertToPixel(hs),Nt=_s.convertToPixel(Ln),Ps=Ds.convertToPixel(ss),Nn=_s.convertToPixel(tn)}return!Number.isFinite(pn)||!Number.isFinite(Nt)||!Number.isFinite(Ps)||!Number.isFinite(Nn)?null:{a:{x:pn+ui,y:Nt+bi},b:{x:Ps+ui,y:Nn+bi}}},Pf=te=>{let nn=Number(te==null?void 0:te.startIndex),mt=Number(te==null?void 0:te.endIndex);if(!Number.isFinite(nn)||!Number.isFinite(mt))return null;if(nn>mt){const Nt=nn;nn=mt,mt=Nt}const pn=String((te==null?void 0:te.extend)||"").toLowerCase();return pn==="both"?(nn=0,mt=Math.max(0,ns-1)):pn==="left"?nn=0:pn==="right"&&(mt=Math.max(0,ns-1)),{a:nn,b:mt}},Gd=(te,nn)=>Number.isFinite(te==null?void 0:te.slope)&&Number.isFinite(te==null?void 0:te.intercept)?te.slope*nn+te.intercept:Number.isFinite(te==null?void 0:te.startValue)?te.startValue:Number.NaN,af=te=>{const nn=te==null?void 0:te.line1,mt=te==null?void 0:te.line2;if(!nn||!mt)return;const pn=Cc(nn,_i(nn)??void 0),Nt=Cc(mt,_i(mt)??void 0),Ps=Pf(pn),Nn=Pf(Nt);if(!Ps||!Nn)return;const hs=Math.max(ys,Ps.a,Nn.a),ss=Math.min(tr,Ps.b,Nn.b);if(hs>ss)return;const Ln=[],tn=[];for(let Ws=hs;Ws<=ss;(Ws+=1)-1){const Hs=Gd(pn,Ws),As=Gd(Nt,Ws);if(!Number.isFinite(Hs)||!Number.isFinite(As))continue;const Ls=Ds.convertToPixel(Ws),js=_s.convertToPixel(Hs),ks=_s.convertToPixel(As);Ln.push({x:Ls,y:js}),tn.push({x:Ls,y:ks})}Ln.length>1&&tn.length>1&&Ex(U,Ln,tn,te.color||"rgba(59,130,246,0.15)",Lo)},fd=(te,nn)=>{const mt=Cc(te,nn),pn=String((mt==null?void 0:mt.style)||"solid").toLowerCase();if(pn.includes("arrow")||Number.isFinite(mt==null?void 0:mt.glow)&&mt.glow>0)return null;let Nt=NaN,Ps=NaN,Nn=NaN,hs=NaN;if(mt.strictExtend){const ss=typeof _s.getRange=="function"?_s.getRange():null,Ln=xb({startIndex:mt.startIndex,endIndex:mt.endIndex,startValue:mt.startValue,endValue:mt.endValue,slope:mt.slope,intercept:mt.intercept,extend:mt.extend,fromIndex:ys,toIndex:tr,yRange:ss,toX:tn=>Ds.convertToPixel(tn),toY:tn=>_s.convertToPixel(tn)});if(!Ln)return null;Nt=Ln.extended.x1,Ps=Ln.extended.y1,Nn=Ln.extended.x2,hs=Ln.extended.y2}else{let ss=mt.startIndex,Ln=mt.endIndex;mt.extend==="both"?(ss=0,Ln=Math.max(0,ns-1)):mt.extend==="left"?ss=0:mt.extend==="right"&&(Ln=Math.max(0,ns-1));const tn=Number.isFinite(mt.slope)&&Number.isFinite(mt.intercept)?mt.slope*ss+mt.intercept:mt.startValue,Ws=Number.isFinite(mt.slope)&&Number.isFinite(mt.intercept)?mt.slope*Ln+mt.intercept:mt.endValue;Nt=Ds.convertToPixel(ss),Ps=_s.convertToPixel(tn),Nn=Ds.convertToPixel(Ln),hs=_s.convertToPixel(Ws)}return!Number.isFinite(Nt)||!Number.isFinite(Ps)||!Number.isFinite(Nn)||!Number.isFinite(hs)?null:{kind:"line",points:[{x:Nt+Di,y:Ps+Sa},{x:Nn+Di,y:hs+Sa}],color:mt.color,width:mt.width,glow:mt.glow,glowColor:mt.glowColor,glowOpacity:mt.glowOpacity,style:pn,opacity:mt.opacity}},Td=(te,nn)=>{if(Number.isFinite(te==null?void 0:te.glow)&&te.glow>0||!(te!=null&&te.points)||te.points.length<2)return null;const mt=Sc(te.points,nn),pn=Math.min(...mt.map(Nn=>Nn.index));if(Math.max(...mt.map(Nn=>Nn.index))<ys-2||pn>tr+2)return null;const Ps=[];for(const Nn of mt){const hs=Ds.convertToPixel(Nn.index),ss=_s.convertToPixel(Nn.value);!Number.isFinite(hs)||!Number.isFinite(ss)||Ps.push({x:hs+Di,y:ss+Sa})}return Ps.length<2?null:{kind:"polyline",points:Ps,color:te.color,width:te.width,glow:te.glow,glowColor:te.glowColor,glowOpacity:te.glowOpacity,style:te.style,opacity:te.opacity}},vp=(te,nn)=>{if(Number.isFinite(te==null?void 0:te.glow)&&te.glow>0||!(te!=null&&te.points)||te.points.length<3)return null;const mt=Sc(te.points,nn),pn=Math.min(...mt.map(Nn=>Nn.index));if(Math.max(...mt.map(Nn=>Nn.index))<ys-2||pn>tr+2)return null;const Ps=[];for(const Nn of mt){const hs=Ds.convertToPixel(Nn.index),ss=_s.convertToPixel(Nn.value);!Number.isFinite(hs)||!Number.isFinite(ss)||Ps.push({x:hs+Di,y:ss+Sa})}return Ps.length<3?null:{kind:"polygon",points:Ps,fillColor:te.fillColor,fillGradient:te.fillGradient,strokeColor:te.strokeColor,strokeWidth:te.strokeWidth,strokeStyle:te.strokeStyle,opacity:te.opacity,glow:te.glow,glowColor:te.glowColor,glowOpacity:te.glowOpacity}},Xa=(te,nn)=>{if(Number.isFinite(te==null?void 0:te.glow)&&te.glow>0||!(te!=null&&te.commands)||!te.commands.length)return null;const mt=[];for(const pn of te.commands){const Nt=uu({index:pn.index,value:pn.value},nn),Ps=Ds.convertToPixel(Nt.index),Nn=_s.convertToPixel(Nt.value);!Number.isFinite(Ps)||!Number.isFinite(Nn)||(pn.cmd==="M"||pn.cmd==="L")&&mt.push({cmd:pn.cmd,x:Ps+Di,y:Nn+Sa})}return mt.length?{kind:"path",commands:mt,color:te.color,width:te.width,glow:te.glow,glowColor:te.glowColor,glowOpacity:te.glowOpacity,style:te.style,opacity:te.opacity}:null},Ju=te=>{const nn=te==null?void 0:te.line1,mt=te==null?void 0:te.line2;if(!nn||!mt)return null;const pn=Cc(nn,_i(nn)??void 0),Nt=Cc(mt,_i(mt)??void 0),Ps=Pf(pn),Nn=Pf(Nt);if(!Ps||!Nn)return null;const hs=Math.max(ys,Ps.a,Nn.a),ss=Math.min(tr,Ps.b,Nn.b);if(hs>ss)return null;const Ln=[],tn=[];for(let Hs=hs;Hs<=ss;(Hs+=1)-1){const As=Gd(pn,Hs),Ls=Gd(Nt,Hs);if(!Number.isFinite(As)||!Number.isFinite(Ls))continue;const js=Ds.convertToPixel(Hs),ks=_s.convertToPixel(As),Jn=_s.convertToPixel(Ls);!Number.isFinite(js)||!Number.isFinite(ks)||!Number.isFinite(Jn)||(Ln.push({x:js+Di,y:ks+Sa}),tn.push({x:js+Di,y:Jn+Sa}))}return Ln.length<2||tn.length<2?null:{kind:"polygon",points:Ln.concat(tn.reverse()),fillColor:te.color||"rgba(59,130,246,0.15)",fillGradient:te.fillGradient,opacity:te.opacity}},Bp=(te,nn)=>{const mt=Number(te);if(Number.isFinite(mt))return{left:mt,right:mt,top:mt,bottom:mt};if(te&&typeof te=="object"){const pn=te,Nt=Number(pn.left),Ps=Number(pn.right),Nn=Number(pn.top),hs=Number(pn.bottom);return{left:Number.isFinite(Nt)?Nt:nn.left,right:Number.isFinite(Ps)?Ps:nn.right,top:Number.isFinite(Nn)?Nn:nn.top,bottom:Number.isFinite(hs)?hs:nn.bottom}}return nn},Zf=te=>{const nn=Number.isFinite(te==null?void 0:te.fontSize)&&Number(te.fontSize)>0?Number(te.fontSize):Number.isFinite(te==null?void 0:te.size)&&Number(te.size)>0?Number(te.size):12,mt=(te==null?void 0:te.fontFamily)||(te!=null&&te.monospace?'"SFMono-Regular", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace':'"Inter", system-ui, -apple-system, sans-serif');return{font:`${(te==null?void 0:te.fontWeight)||"600"} ${nn}px ${mt}`,size:nn}},ap=(te,nn,mt,pn,Nt,Ps)=>{const Nn=Math.max(0,Math.min(Ps,Math.min(pn,Nt)/2));te.beginPath(),te.moveTo(nn+Nn,mt),te.lineTo(nn+pn-Nn,mt),te.quadraticCurveTo(nn+pn,mt,nn+pn,mt+Nn),te.lineTo(nn+pn,mt+Nt-Nn),te.quadraticCurveTo(nn+pn,mt+Nt,nn+pn-Nn,mt+Nt),te.lineTo(nn+Nn,mt+Nt),te.quadraticCurveTo(nn,mt+Nt,nn,mt+Nt-Nn),te.lineTo(nn,mt+Nn),te.quadraticCurveTo(nn,mt,nn+Nn,mt),te.closePath()},wp=(te,nn,mt)=>{if(!mt)return{index:te,value:nn};const pn=da(mt),Nt=fl(pn);return Nt?{index:Nt.index,value:Nt.value}:{index:te,value:nn}},fm=8,Fc=te=>{var Nn,hs,ss,Ln,tn;const nn=typeof(te==null?void 0:te.getRange)=="function"?te.getRange():null,mt=typeof(te==null?void 0:te.getParent)=="function"?(tn=(Ln=(ss=(hs=(Nn=te.getParent())==null?void 0:Nn.getYAxisWidget)==null?void 0:hs.call(Nn))==null?void 0:ss.getBounding)==null?void 0:Ln.call(ss))==null?void 0:tn.height:0,pn=nn&&Number.isFinite(nn.realRange)?Number(nn.realRange):nn&&Number.isFinite(nn.displayRange)?Number(nn.displayRange):null,Nt=Number.isFinite(mt)&&mt>0&&pn!=null?Math.abs(pn)/Math.max(1,mt):null;let Ps=null;if(Nt==null){const Ws=j_(s().symbol),Hs=Math.max(0,Math.min(8,Math.trunc(Ws))),As=Math.pow(10,-Hs);Ps=Number.isFinite(As)?As:.01}return{padPx:fm,pricePerPixel:Nt,fallbackStep:Ps}},Mf=typeof _s<"u"?_s:null,Sp=Fc(Mf),qp=(te,nn,mt)=>{if(!ne)return te;const pn=typeof(mt==null?void 0:mt.convertToPixel)=="function"?mt.convertToPixel(te):NaN;if(Number.isFinite(pn)&&typeof(mt==null?void 0:mt.convertFromPixel)=="function"){const Nt=pn+(nn==="above"?-Sp.padPx:Sp.padPx),Ps=mt.convertFromPixel(Nt);if(Number.isFinite(Ps))return Ps}return Sp.pricePerPixel!=null?te+(nn==="above"?Sp.pricePerPixel:-Sp.pricePerPixel)*Sp.padPx:Sp.fallbackStep!=null?te+(nn==="above"?Sp.fallbackStep:-Sp.fallbackStep):te},Up=(te,nn)=>{const mt=te==null?void 0:te.ts,pn=te==null?void 0:te.tsMs,Nt=te==null?void 0:te.meta;if(!Nt)return null;const Ps=(()=>{let tn;return typeof mt=="number"&&Number.isFinite(mt)&&(tn=Dr[String(mt)]),tn==null&&typeof pn=="number"&&Number.isFinite(pn)&&(tn=Dr[`${Math.floor(pn)}_ms`]??Dr[`${Math.floor(pn/1e3)}_s`]),typeof tn=="number"&&Number.isFinite(tn)?tn:te==null?void 0:te.index})();if(typeof Ps!="number"||!Number.isFinite(Ps))return null;const Nn=Nt==null?void 0:Nt.value;if(Nn==null)return null;const hs=typeof Nt.offset=="number"&&Number.isFinite(Nt.offset)?Math.trunc(Nt.offset):0,ss=wp(Ps+hs,Number(Nn),nn);let Ln=ss.value;return ne&&(Nt==null?void 0:Nt.yloc)==="abovebar"?Ln=qp(Ln,"above",Mf):ne&&(Nt==null?void 0:Nt.yloc)==="belowbar"&&(Ln=qp(Ln,"below",Mf)),{index:ss.index,value:Ln}},th=(te,nn,mt)=>{const pn=typeof(te==null?void 0:te.offsetY)=="number"?te.offsetY:10,Nt=((te==null?void 0:te.position)||"above")==="above",Ps=typeof(te==null?void 0:te.size)=="number"&&te.size>0?te.size:12,Nn=Nt?mt.above[nn]||0:mt.below[nn]||0,hs=pn+Nn*Math.max(6,Ps/3);return{isAbove:Nt,offset:hs,size:Ps}},Nm=(te,nn,mt)=>{mt?te.above[nn]=(te.above[nn]||0)+1:te.below[nn]=(te.below[nn]||0)+1},zh=(te,nn,mt)=>{const pn=te==null?void 0:te.meta;if(!pn)return null;const Nt=Up(te,mt);if(!Nt)return null;let Ps=Nt.index;const Nn=Nt.value;if(tr>=0&&(Ps<ys||Ps>tr))return null;const hs=Ds.convertToPixel(Ps);if(!Number.isFinite(hs))return null;let ss=_s.convertToPixel(Nn);if(!Number.isFinite(ss))return null;const{isAbove:Ln,offset:tn,size:Ws}=th(pn,Ps,nn);Ln?ss-=tn:ss+=tn,Nm(nn,Ps,Ln);const Hs=Ws/2;if(Lo||bs){const En=0+Hs+2,Wi=((Lo==null?void 0:Lo.height)??bs.height)-Hs-2;ss=Math.max(En,Math.min(Wi,ss))}if(pn.wrap===!0||pn.maxWidth!=null||pn.padding!=null||pn.bgOpacity!=null||pn.radius!=null||pn.borderWidth!=null||pn.align||pn.valign||pn.lineHeight!=null||pn.fontFamily||pn.fontSize!=null||pn.fontWeight||pn.monospace){const En=Zf(pn),Wi=Bp(pn.padding,{left:8,right:8,top:6,bottom:6}),ml=pn.align||pn.textAlign,Qo=ml==="left"||ml==="right"?ml:"center",po=kb(String(pn.text??""),{font:En.font,color:"#e2e8f0",maxWidth:pn.maxWidth,wrap:pn.wrap===!0||pn.textWrap===!0,lineHeight:pn.lineHeight,align:Qo}),aa=po?{width:po.width,height:po.height}:Z1({text:String(pn.text??""),font:En.font,maxWidth:pn.maxWidth,wrap:pn.wrap===!0||pn.textWrap===!0,lineHeight:pn.lineHeight}),Za=Math.ceil(aa.width+Wi.left+Wi.right),Lc=Math.ceil(aa.height+Wi.top+Wi.bottom),Na=pn.valign,Jf=Na==="top"||Na==="middle"||Na==="bottom"?Na:Ln?"bottom":"top";let Rr=hs;Qo==="center"?Rr=hs-Za/2:Qo==="right"&&(Rr=hs-Za);let Go=ss;if(Jf==="middle"?Go=ss-Lc/2:Jf==="bottom"&&(Go=ss-Lc),Lo||bs){const jr=((Lo==null?void 0:Lo.height)??bs.height)-Lc;Go=Math.max(0,Math.min(jr,Go))}return{x:Rr+ui,y:Go+bi,width:Za,height:Lc}}let Ls=Ws,js=Ws;const ks=String(pn.shape||"").toLowerCase(),Jn=String(pn.text??"");if(Jn&&(ks==="text"||ks==="emoji"||ks==="label")){const En=Zf(pn),Wi=Z1({text:Jn,font:En.font,maxWidth:pn.maxWidth,wrap:pn.wrap===!0||pn.textWrap===!0,lineHeight:pn.lineHeight});Ls=Math.max(Ls,Math.ceil(Wi.width)),js=Math.max(js,Math.ceil(Wi.height))}return{x:hs-Ls/2+ui,y:ss-js/2+bi,width:Ls,height:js}},Sv=(te,nn,mt,pn)=>{U.font='12px "Inter", system-ui, -apple-system, sans-serif';const Nt=te==null?void 0:te.meta;if(!Nt)return;const Ps=Nt.textAlign==="left"||Nt.textAlign==="right"?Nt.textAlign:"center";U.textAlign=Ps;const Nn=Up(te,mt);if(!Nn)return;let hs=Nn.index;const ss=Nn.value;if(tr>=0&&(hs<ys||hs>tr))return;const Ln=Ds.convertToPixel(hs);if(!Number.isFinite(Ln))return;let tn=_s.convertToPixel(ss);if(!Number.isFinite(tn))return;const{isAbove:Ws,offset:Hs,size:As}=th(Nt,hs,nn);if(Ws?(tn-=Hs,U.textBaseline="bottom"):(tn+=Hs,U.textBaseline="top"),Nm(nn,hs,Ws),mt&&(pn!=null&&pn.has(mt)))return;const Ls=As/2;if(Lo||bs){const Rr=0+Ls+2,Go=((Lo==null?void 0:Lo.height)??bs.height)-Ls-2;tn=Math.max(Rr,Math.min(Go,tn))}if(Nt.wrap===!0||Nt.maxWidth!=null||Nt.padding!=null||Nt.bgOpacity!=null||Nt.radius!=null||Nt.borderWidth!=null||Nt.align||Nt.valign||Nt.lineHeight!=null||Nt.fontFamily||Nt.fontSize!=null||Nt.fontWeight||Nt.monospace||Nt.callout===!0){const Rr=Zf(Nt),Go=Bp(Nt.padding,{left:8,right:8,top:6,bottom:6}),Aa=Nt.align||Nt.textAlign,jr=Aa==="left"||Aa==="right"?Aa:"center",ja=String(Nt.shape||"").toLowerCase(),qu=Nt.callout===!0||ja==="callout"||ja==="pill"||ja==="label"||ja==="tag"||ja==="flag"||ja==="box_gradient",Yd=Nt.callout===!0||ja==="callout",Mp=Nt.textColor||(qu?"#f8fafc":Nt.color||"#f97316"),zp=!qu,Kd=Yd?null:kb(String(Nt.text??""),{font:Rr.font,color:Mp,maxWidth:Nt.maxWidth,wrap:Nt.wrap===!0||Nt.textWrap===!0,lineHeight:Nt.lineHeight,align:jr}),Vp=Kd?{width:Kd.width,height:Kd.height,lineHeight:Kd.lineHeight}:Z1({text:String(Nt.text??""),font:Rr.font,maxWidth:Nt.maxWidth,wrap:Nt.wrap===!0||Nt.textWrap===!0,lineHeight:Nt.lineHeight}),Wh=Math.ceil(Vp.width+Go.left+Go.right),Np=Math.ceil(Vp.height+Go.top+Go.bottom),mv=Nt.valign,wh=mv==="top"||mv==="middle"||mv==="bottom"?mv:Ws?"bottom":"top";let Qp=Ln;jr==="center"?Qp=Ln-Wh/2:jr==="right"&&(Qp=Ln-Wh);let Ap=tn;wh==="middle"?Ap=tn-Np/2:wh==="bottom"&&(Ap=tn-Np);const Hh=Nt.callout===!0?Math.max(4,Math.round(Np/4)):0;if(Lo||bs){const Af=0+(Nt.callout===!0&&!Ws?Hh:0),nh=((Lo==null?void 0:Lo.height)??bs.height)-Np-(Nt.callout===!0&&Ws?Hh:0);Ap=Math.max(Af,Math.min(nh,Ap))}const Am=Nt!=null&&Nt.pineV2?Nt.bgColor||"rgba(0,0,0,0)":Nt.bgColor||Nt.color||"rgba(15,23,42,0.95)",pm=(Nt==null?void 0:Nt.bgGradient)??(Nt==null?void 0:Nt.gradient),Fg=Nt.bgOpacity!=null?Math.max(0,Math.min(1,Number(Nt.bgOpacity))):null,Hg=Nt!=null&&Nt.pineV2?Nt.borderColor||"rgba(0,0,0,0)":Nt.borderColor||"rgba(0,0,0,0.65)",Lg=Nt.borderWidth!=null?Math.max(0,Number(Nt.borderWidth)):Nt!=null&&Nt.pineV2||qu?0:1,Eg=Nt.radius!=null?Number(Nt.radius):String(Nt.shape||"").toLowerCase()==="pill"?Np/2:void 0,i0=Math.max(0,Eg??6),$g=U.globalAlpha;if(U.globalAlpha=typeof Nt.opacity=="number"?Math.max(0,Math.min(1,Nt.opacity)):1,U.save(),ap(U,Qp,Ap,Wh,Np,i0),Am||pm&&(pm.from||pm.to)){const Af=U.globalAlpha;if(Fg!=null&&(U.globalAlpha=Af*Fg),pm&&(pm.from||pm.to)){const nh=ah(U,{minX:Qp,maxX:Qp+Wh,minY:Ap,maxY:Ap+Np},pm,Am||"#0f172a");U.fillStyle=nh??Am}else U.fillStyle=Am;U.fill(),U.globalAlpha=Af}if(Lg>0&&(U.strokeStyle=Hg,U.lineWidth=Lg,U.stroke()),Nt.callout===!0){const Af=Math.max(4,Math.round(Np/4)),nh=Ln,qg=Ws?Ap+Np:Ap,k0=Ws?qg+Af:qg-Af;if(U.beginPath(),U.moveTo(nh-Af,qg),U.lineTo(nh+Af,qg),U.lineTo(nh,k0),U.closePath(),pm&&(pm.from||pm.to)){const I_=ah(U,{minX:Qp,maxX:Qp+Wh,minY:Math.min(Ap,k0),maxY:Math.max(Ap+Np,k0)},pm,Am||"#0f172a");U.fillStyle=I_??Am}else Am&&(U.fillStyle=Am);U.fill(),Lg>0&&(U.strokeStyle=Hg,U.lineWidth=Lg,U.stroke())}U.textBaseline="top",U.textAlign=jr==="left"?"left":jr==="right"?"right":"center";const hg=jr==="left"?Qp+Go.left:jr==="right"?Qp+Wh-Go.right:Qp+Wh/2;let kh=Ap+Go.top;const C_=U.globalCompositeOperation;if(U.globalCompositeOperation="source-over",Kd){const Af=jr==="left"?hg:jr==="right"?hg-Kd.width:hg-Kd.width/2;U.drawImage(Kd.canvas,Math.round(Af),Math.round(kh),Kd.width,Kd.height)}else{U.font=Rr.font,U.fillStyle=Mp,zp&&(U.strokeStyle="rgba(0,0,0,0.45)",U.lineWidth=1);const Af=Z1({text:String(Nt.text??""),font:Rr.font,maxWidth:Nt.maxWidth,wrap:Nt.wrap===!0||Nt.textWrap===!0,lineHeight:Nt.lineHeight});for(const nh of Af.lines)U.fillText(nh,Math.round(hg),Math.round(kh)),zp&&U.strokeText(nh,Math.round(hg),Math.round(kh)),kh+=Af.lineHeight}U.globalCompositeOperation=C_,U.restore(),U.globalAlpha=$g;return}const ks=Nt.shape||"",Jn=ks==="arrow_up"?"arrowUp":ks==="arrow_down"?"arrowDown":ks==="triangle_up_filled"?"triangleUpFilled":ks==="triangle_down_filled"?"triangleDownFilled":ks==="cross"?"cross":ks==="xcross"?"xcross":ks==="diamond"?"diamond":ks==="arrow_up_glow"?"arrowUpGlow":ks==="arrow_down_glow"?"arrowDownGlow":ks==="triangle_up_gradient"?"triangleUpGradient":ks==="triangle_down_gradient"?"triangleDownGradient":ks==="circle_pulse"?"circlePulse":ks==="callout"?"callout":ks==="tag"?"tag":ks==="flag"?"flag":ks==="pill"?"pill":ks==="box_gradient"?"boxGradient":ks==="bubble"?"bubble":ks==="spark"?"spark":ks==="star"?"star":ks==="label"?"label":ks==="text"||ks==="emoji"?"text":ks,En=As/2,Wi=Nt!=null&&Nt.pineV2?Nt.bgColor||"rgba(0,0,0,0)":Nt.bgColor||"rgba(15,23,42,0.95)",ml=(Nt==null?void 0:Nt.bgGradient)??(Nt==null?void 0:Nt.gradient),Qo=Nt!=null&&Nt.pineV2?Nt.borderColor||"rgba(0,0,0,0)":Nt.borderColor||"rgba(0,0,0,0.65)",po=String(Nt.shape||"").toLowerCase(),aa=Nt.callout===!0||po==="callout"||po==="pill"||po==="label"||po==="tag"||po==="flag"||po==="box_gradient",Za=Nt.textColor||(aa?"#f8fafc":Nt.color||"#f8fafc"),Lc=String(Nt.text||""),Na=typeof Nt.borderWidth=="number"?Math.max(0,Nt.borderWidth):Nt!=null&&Nt.pineV2||aa?0:1;U.lineWidth=Na;const Jf=U.globalAlpha;if(U.globalAlpha=typeof Nt.opacity=="number"?Math.max(0,Math.min(1,Nt.opacity)):1,Jn==="circle"||Jn==="square"||Jn==="arrowUp"||Jn==="arrowDown"||Jn==="cross"||Jn==="xcross"||Jn==="diamond"||Jn==="box"||Jn==="triangleUpFilled"||Jn==="triangleDownFilled"||Jn==="label"||Jn==="arrowUpGlow"||Jn==="arrowDownGlow"||Jn==="triangleUpGradient"||Jn==="triangleDownGradient"||Jn==="circlePulse"||Jn==="callout"||Jn==="tag"||Jn==="flag"||Jn==="pill"||Jn==="boxGradient"||Jn==="bubble"||Jn==="spark"||Jn==="star"||Jn==="text"){if(U.save(),U.strokeStyle=Qo,ml&&(ml.from||ml.to)){const Rr=ah(U,{minX:Ln-En,maxX:Ln+En,minY:tn-En,maxY:tn+En},ml,Wi||"#0f172a");U.fillStyle=Rr??(Nt!=null&&Nt.pineV2?Wi:Nt.color||Wi)}else U.fillStyle=Nt!=null&&Nt.pineV2?Wi:Nt.color||Wi;if(Jn==="circle")U.beginPath(),U.arc(Ln,tn,En,0,Math.PI*2),U.fill(),Na>0&&U.stroke();else if(Jn==="square")U.beginPath(),U.rect(Ln-En,tn-En,As,As),U.fill(),Na>0&&U.stroke();else if(Jn==="cross")U.strokeStyle=Nt.color||Qo,U.beginPath(),U.moveTo(Ln-En,tn),U.lineTo(Ln+En,tn),U.moveTo(Ln,tn-En),U.lineTo(Ln,tn+En),Na>0&&U.stroke();else if(Jn==="xcross")U.strokeStyle=Nt.color||Qo,U.beginPath(),U.moveTo(Ln-En,tn-En),U.lineTo(Ln+En,tn+En),U.moveTo(Ln-En,tn+En),U.lineTo(Ln+En,tn-En),Na>0&&U.stroke();else if(Jn==="diamond")U.beginPath(),U.moveTo(Ln,tn-En),U.lineTo(Ln+En,tn),U.lineTo(Ln,tn+En),U.lineTo(Ln-En,tn),U.closePath(),U.fill(),Na>0&&U.stroke();else if(Jn==="arrowUp"||Jn==="arrowUpGlow")U.beginPath(),U.moveTo(Ln,tn-En),U.lineTo(Ln-En,tn+En),U.lineTo(Ln+En,tn+En),U.closePath(),(Jn==="arrowUpGlow"||Nt.shadow)&&(U.shadowColor=Nt.color||Wi,U.shadowBlur=12),U.fill(),Na>0&&U.stroke();else if(Jn==="arrowDown"||Jn==="arrowDownGlow")U.beginPath(),U.moveTo(Ln,tn+En),U.lineTo(Ln-En,tn-En),U.lineTo(Ln+En,tn-En),U.closePath(),(Jn==="arrowDownGlow"||Nt.shadow)&&(U.shadowColor=Nt.color||Wi,U.shadowBlur=12),U.fill(),Na>0&&U.stroke();else if(Jn==="triangleUpFilled")U.beginPath(),U.moveTo(Ln,tn-En),U.lineTo(Ln-En,tn+En),U.lineTo(Ln+En,tn+En),U.closePath(),U.fill(),Na>0&&U.stroke();else if(Jn==="triangleDownFilled")U.beginPath(),U.moveTo(Ln,tn+En),U.lineTo(Ln-En,tn-En),U.lineTo(Ln+En,tn-En),U.closePath(),U.fill(),Na>0&&U.stroke();else if(Jn==="triangleUpGradient"||Jn==="triangleDownGradient"){const Rr=U.createLinearGradient(Ln-En,tn-En,Ln+En,tn+En);Rr.addColorStop(0,Nt.bgColor||"rgba(59,130,246,0.6)"),Rr.addColorStop(1,Nt.color||"rgba(34,197,94,0.6)"),U.fillStyle=Rr,U.beginPath(),Jn==="triangleUpGradient"?(U.moveTo(Ln,tn-En),U.lineTo(Ln-En,tn+En),U.lineTo(Ln+En,tn+En)):(U.moveTo(Ln,tn+En),U.lineTo(Ln-En,tn-En),U.lineTo(Ln+En,tn-En)),U.closePath(),U.fill(),Na>0&&U.stroke()}else if(Jn==="circlePulse")U.beginPath(),U.arc(Ln,tn,En,0,Math.PI*2),U.fill(),Na>0&&U.stroke(),U.globalAlpha=.4,U.beginPath(),U.arc(Ln,tn,En*1.6,0,Math.PI*2),U.stroke(),U.globalAlpha=1;else if(Jn==="pill"){const Rr=Math.max(10,U.measureText(Lc||"").width+16),Go=Math.max(12,As),Aa=Ln-Math.floor(Rr/2),jr=tn-Math.floor(Go/2),ja=Go/2;U.beginPath(),U.moveTo(Aa+ja,jr),U.lineTo(Aa+Rr-ja,jr),U.arc(Aa+Rr-ja,jr+ja,ja,-Math.PI/2,Math.PI/2),U.lineTo(Aa+ja,jr+Go),U.arc(Aa+ja,jr+ja,ja,Math.PI/2,-Math.PI/2),U.closePath(),U.fill(),Na>0&&U.stroke()}else if(Jn==="callout"){const Rr=Math.max(10,U.measureText(Lc||"").width+18),Go=Math.max(12,As+6),Aa=Ln-Math.floor(Rr/2),jr=tn-Math.floor(Go/2),ja=Math.max(4,Math.floor(Go/3));ap(U,Aa,jr,Rr,Go,ja),U.fill(),Na>0&&U.stroke();const qu=Math.max(4,Math.floor(Go/4));U.beginPath(),Ws?(U.moveTo(Ln-qu,jr+Go),U.lineTo(Ln+qu,jr+Go),U.lineTo(Ln,jr+Go+qu)):(U.moveTo(Ln-qu,jr),U.lineTo(Ln+qu,jr),U.lineTo(Ln,jr-qu)),U.closePath(),U.fill(),Na>0&&U.stroke()}else if(Jn==="tag"||Jn==="flag"){const Rr=Math.max(10,U.measureText(Lc||"").width+20),Go=Math.max(12,As+4),Aa=Ln-Math.floor(Rr/2),jr=tn-Math.floor(Go/2);U.beginPath(),U.rect(Aa,jr,Rr,Go),U.fill(),Na>0&&U.stroke(),Jn==="flag"&&(U.beginPath(),U.moveTo(Aa,jr),U.lineTo(Aa-Go/2,jr+Go/2),U.lineTo(Aa,jr+Go),U.closePath(),U.fill(),U.stroke())}else if(Jn==="boxGradient"){const Rr=Math.max(10,U.measureText(Lc||"").width+12),Go=Math.max(12,As+6),Aa=Ln-Math.floor(Rr/2),jr=tn-Math.floor(Go/2),ja=U.createLinearGradient(Aa,jr,Aa+Rr,jr+Go);ja.addColorStop(0,Nt.bgColor||"rgba(15,23,42,0.5)"),ja.addColorStop(1,Nt.color||"rgba(59,130,246,0.35)"),U.fillStyle=ja,U.beginPath(),U.rect(Aa,jr,Rr,Go),U.fill(),Na>0&&U.stroke()}else if(Jn==="bubble")U.beginPath(),U.arc(Ln,tn,En,0,Math.PI*2),U.fill(),Na>0&&U.stroke(),U.beginPath(),U.moveTo(Ln,tn+En),U.lineTo(Ln+En,tn+En+6),Na>0&&U.stroke();else if(Jn==="spark")U.beginPath(),U.moveTo(Ln,tn-En),U.lineTo(Ln,tn+En),U.moveTo(Ln-En,tn),U.lineTo(Ln+En,tn),Na>0&&U.stroke();else if(Jn==="star"){U.beginPath();for(let Rr=0;Rr<5;(Rr+=1)-1){const Go=Math.PI*2*Rr/5,Aa=Ln+Math.cos(Go)*En,jr=tn+Math.sin(Go)*En,ja=Go+Math.PI/5,qu=Ln+Math.cos(ja)*(En/2),Yd=tn+Math.sin(ja)*(En/2);Rr===0?U.moveTo(Aa,jr):U.lineTo(Aa,jr),U.lineTo(qu,Yd)}U.closePath(),U.fill(),Na>0&&U.stroke()}else if(Jn==="box"){const Rr=row.__open,Go=row.__close,Aa=row.__high,jr=row.__low;if(Rr!=null&&Go!=null&&Aa!=null&&jr!=null){const ja=Nt.boxMode||"body",qu=ja==="wick"?Aa:Math.max(Rr,Go),Yd=ja==="wick"?jr:Math.min(Rr,Go),Mp=_s.convertToPixel(qu),zp=_s.convertToPixel(Yd);if(Number.isFinite(Mp)&&Number.isFinite(zp)){const Kd=Ds.convertToPixel(hs),Vp=hs>0?Ds.convertToPixel(hs-1):Kd-Math.abs(Ds.convertToPixel(1)-Ds.convertToPixel(0)),Wh=hs<ia.length-1?Ds.convertToPixel(hs+1):Kd+Math.abs(Ds.convertToPixel(1)-Ds.convertToPixel(0)),Np=0,mv=((Lo==null?void 0:Lo.width)??bs.width)||0,wh=Math.min(Kd,Math.max(Np,Math.floor((Vp+Kd)/2))),Qp=Math.max(Kd,Math.min(mv,Math.ceil((Kd+Wh)/2))),Ap=Math.min(Mp,zp),Hh=Math.max(1,Math.abs(zp-Mp)),Am=Math.max(2,Qp-wh);U.beginPath(),U.rect(wh,Ap,Am,Hh),U.fill(),U.strokeStyle=Qo,U.lineWidth=As,U.stroke()}}}else if(Jn==="label"){const Rr=U.measureText(Lc||""),Go=Math.max(10,Rr.width+12),Aa=Math.max(12,As+6),jr=Math.max(3,Math.floor(Aa/3)),ja=Ln-Math.floor(Go/2),qu=tn-Math.floor(Aa/2);U.beginPath();const Yd=jr;U.moveTo(ja+Yd,qu),U.lineTo(ja+Go-Yd,qu),U.quadraticCurveTo(ja+Go,qu,ja+Go,qu+Yd),U.lineTo(ja+Go,qu+Aa-Yd),U.quadraticCurveTo(ja+Go,qu+Aa,ja+Go-Yd,qu+Aa),U.lineTo(ja+Yd,qu+Aa),U.quadraticCurveTo(ja,qu+Aa,ja,qu+Aa-Yd),U.lineTo(ja,qu+Yd),U.quadraticCurveTo(ja,qu,ja+Yd,qu),U.closePath(),U.fill(),U.stroke()}else if(Jn==="text"){U.fillStyle=Za,U.textAlign=Ps;const Rr=typeof Nt.size=="number"&&Nt.size>0?Nt.size:14;U.font=`${Rr}px sans-serif`;const Go=Ws?tn-(Rr/2+4):tn+(Rr/2+4);U.fillText(Lc||"",Ln,Go)}if(Lc&&Jn!=="text"){const Rr=typeof Nt.size=="number"&&Nt.size>0?Nt.size:12,Go=Jn==="callout"||Jn==="label"||Jn==="pill"||Jn==="tag"||Jn==="flag"||Jn==="boxGradient"||Nt.callout===!0,Aa=Rr/2,jr=typeof Nt.textPadding=="number"?Math.max(0,Nt.textPadding):Aa+6,ja=Go?tn:Ws?tn-jr:tn+jr,qu=U.globalCompositeOperation;U.globalCompositeOperation="source-over",U.fillStyle=Nt.callout===!0?Nt.textColor||"#f8fafc":Za,Go||(U.strokeStyle="rgba(0,0,0,0.45)"),U.textAlign="center",U.textBaseline="middle",U.fillText(Lc,Ln,ja),Go||U.strokeText(Lc,Ln,ja),U.globalCompositeOperation=qu}U.restore(),U.globalAlpha=Jf}else if(Lc)U.fillStyle=Za,U.strokeStyle="rgba(0,0,0,0.45)",U.lineWidth=1,U.fillText(Lc,Ln,tn),U.strokeText(Lc,Ln,tn);else{const Rr=String(ks||"");if(!nt.has(Rr)){nt.add(Rr);try{console.warn("[ScriptStudio] Unknown label shape:",Rr)}catch{}}U.beginPath(),U.arc(Ln,tn,Math.max(3,As/3),0,Math.PI*2),U.fillStyle=Nt.color||"#22d3ee",U.fill()}},Nf=te=>{if(!te||!te.columns||!te.rows)return;const nn=8,mt=((Lo==null?void 0:Lo.width)??bs.width)||0,pn=((Lo==null?void 0:Lo.height)??bs.height)||0,Nt=Math.max(1,Math.floor(te.columns)),Ps=Math.max(1,Math.floor(te.rows)),Nn=typeof te.textSize=="number"&&te.textSize>0?te.textSize:12,hs=new Array(Nt).fill(0),ss=new Array(Ps).fill(Math.max(20,Nn+8)),Ln=Array.isArray(te.cells)?te.cells:[],tn=new Map;for(const Qo of Ln){const po=Math.max(0,Math.min(Nt-1,Qo.column)),aa=Math.max(0,Math.min(Ps-1,Qo.row));tn.set(`${po}:${aa}`,Qo)}const Ws=Array.isArray(te.merges)?te.merges:[],Hs=new Map,As=new Map;for(const Qo of Ws){if(!Qo)continue;let po=Math.max(0,Math.min(Nt-1,Math.floor(Number(Qo.left)))),aa=Math.max(0,Math.min(Nt-1,Math.floor(Number(Qo.right)))),Za=Math.max(0,Math.min(Ps-1,Math.floor(Number(Qo.top)))),Lc=Math.max(0,Math.min(Ps-1,Math.floor(Number(Qo.bottom))));if(!Number.isFinite(po)||!Number.isFinite(aa)||!Number.isFinite(Za)||!Number.isFinite(Lc))continue;po>aa&&([po,aa]=[aa,po]),Za>Lc&&([Za,Lc]=[Lc,Za]);const Na=`${po}:${Za}:${aa}:${Lc}`;As.has(Na)||As.set(Na,{left:po,top:Za,right:aa,bottom:Lc,minW:0,minH:0});for(let Jf=po;Jf<=aa;(Jf+=1)-1)for(let Rr=Za;Rr<=Lc;(Rr+=1)-1)Hs.set(`${Jf}:${Rr}`,{left:po,top:Za,right:aa,bottom:Lc})}for(const Qo of Ln){const po=Math.max(0,Math.min(Nt-1,Qo.column)),aa=Math.max(0,Math.min(Ps-1,Qo.row)),Za=Hs.get(`${po}:${aa}`);if(Za&&(Za.left!==po||Za.top!==aa))continue;const Lc=Qo.text||"",Na=typeof Qo.textSize=="number"&&Qo.textSize>0?Qo.textSize:Nn;U.font=`${Na}px "Inter", system-ui, -apple-system, sans-serif`;const Jf=U.measureText(Lc).width+nn*2,Rr=typeof Qo.width=="number"&&Qo.width>0?Qo.width:0,Go=typeof Qo.height=="number"&&Qo.height>0?Qo.height:Math.max(20,Na+8);if(Za){const Aa=`${Za.left}:${Za.top}:${Za.right}:${Za.bottom}`,jr=As.get(Aa);jr&&(jr.minW=Math.max(jr.minW,Jf,Rr),jr.minH=Math.max(jr.minH,Go))}else hs[po]=Math.max(hs[po],Jf,Rr),ss[aa]=Math.max(ss[aa],Go)}for(let Qo=0;Qo<Nt;(Qo+=1)-1)hs[Qo]<60&&(hs[Qo]=60);for(const Qo of As.values()){let po=0;for(let Za=Qo.left;Za<=Qo.right;(Za+=1)-1)po+=hs[Za]||0;po<Qo.minW&&(hs[Qo.right]=(hs[Qo.right]||0)+(Qo.minW-po));let aa=0;for(let Za=Qo.top;Za<=Qo.bottom;(Za+=1)-1)aa+=ss[Za]||0;aa<Qo.minH&&(ss[Qo.bottom]=(ss[Qo.bottom]||0)+(Qo.minH-aa))}const Ls=hs.reduce((Qo,po)=>Qo+po,0),js=ss.reduce((Qo,po)=>Qo+po,0),ks=String(te.position||"top_right").toLowerCase();let Jn=nn,En=nn;ks.includes("top_right")?(Jn=mt-Ls-nn,En=nn):ks.includes("bottom_left")?(Jn=nn,En=pn-js-nn):ks.includes("bottom_right")?(Jn=mt-Ls-nn,En=pn-js-nn):ks.includes("top_center")?(Jn=(mt-Ls)/2,En=nn):ks.includes("bottom_center")?(Jn=(mt-Ls)/2,En=pn-js-nn):(ks.includes("middle_center")||ks.includes("center"))&&(Jn=(mt-Ls)/2,En=(pn-js)/2),U.save(),te.bgcolor&&(U.fillStyle=te.bgcolor,U.fillRect(Jn,En,Ls,js));const Wi=te.frameColor||te.borderColor;Wi&&(U.strokeStyle=Wi,U.lineWidth=typeof te.frameWidth=="number"&&te.frameWidth>0?te.frameWidth:typeof te.borderWidth=="number"&&te.borderWidth>0?te.borderWidth:1,U.strokeRect(Jn,En,Ls,js));let ml=Jn;for(let Qo=0;Qo<Nt;(Qo+=1)-1){let po=En;for(let aa=0;aa<Ps;(aa+=1)-1){const Za=hs[Qo],Lc=ss[aa],Na=Hs.get(`${Qo}:${aa}`);if(Na&&(Na.left!==Qo||Na.top!==aa)){po+=Lc;continue}const Jf=Na?(()=>{let zp=0;for(let Kd=Na.left;Kd<=Na.right;(Kd+=1)-1)zp+=hs[Kd]||0;return zp})():Za,Rr=Na?(()=>{let zp=0;for(let Kd=Na.top;Kd<=Na.bottom;(Kd+=1)-1)zp+=ss[Kd]||0;return zp})():Lc,Go=tn.get(`${Qo}:${aa}`);Go!=null&&Go.bgcolor&&(U.fillStyle=Go.bgcolor,U.fillRect(ml,po,Jf,Rr)),U.strokeStyle=te.borderColor||"rgba(148,163,184,0.5)",U.lineWidth=typeof te.borderWidth=="number"&&te.borderWidth>0?te.borderWidth:1,U.strokeRect(ml,po,Jf,Rr);const Aa=(Go==null?void 0:Go.text)||"",jr=typeof(Go==null?void 0:Go.textSize)=="number"&&Go.textSize>0?Go.textSize:Nn;U.font=`${jr}px "Inter", system-ui, -apple-system, sans-serif`;const ja=(Go==null?void 0:Go.textHalign)||te.textHalign||"left",qu=(Go==null?void 0:Go.textValign)||te.textValign||"middle";U.textAlign=ja==="center"||ja==="right"?ja:"left",U.textBaseline=qu==="top"?"top":qu==="bottom"?"bottom":"middle";let Yd=ml+nn;U.textAlign==="center"&&(Yd=ml+Jf/2),U.textAlign==="right"&&(Yd=ml+Jf-nn);let Mp=po+Rr/2;U.textBaseline==="top"&&(Mp=po+nn),U.textBaseline==="bottom"&&(Mp=po+Rr-nn),U.fillStyle=(Go==null?void 0:Go.textColor)||te.textColor||"#e2e8f0",U.fillText(Aa,Yd,Mp),po+=Lc}ml+=hs[Qo]}U.restore()},Qu=te=>{var ss,Ln;const nn=yu[te];if(!nn||!nn.length)return;const mt=nn.slice().sort((tn,Ws)=>tn.zIndex!==Ws.zIndex?tn.zIndex-Ws.zIndex:tn.createdAt-Ws.createdAt),pn={above:{},below:{}},Nt={above:{},below:{}},Ps=[],Nn=new Map,hs=new Set;for(const tn of mt){const Ws=qa(tn);if(!($r&&((ss=s_(Ws))!=null&&ss.hidden))){if(tn.kind==="label"){const Hs=(Ln=tn==null?void 0:tn.payload)==null?void 0:Ln.meta,As=zh(tn.payload,Nt,Ws);As&&Nn.set(Ws,As),As&&Ku(Hs)&&(Ps.some(js=>Nu(js,As))?hs.add(Ws):Ps.push(As))}if($r){if(tn.kind==="box"){const Hs=ea(tn.payload,Ws),As=qf(tn.payload,Ws),Ls=As?{x:Math.min(As.x1,As.x2)+ui,y:Math.min(As.y1,As.y2)+bi,width:Math.abs(As.x2-As.x1),height:Math.abs(As.y2-As.y1)}:null;if(Ls&&Hs&&(ar.push({id:Ws,type:tn.kind,zIndex:tn.zIndex,createdAt:Qs(),rect:Ls,box:Hs,axis:Jo??void 0,offset:ai,snap:Qr??void 0}),_a.set(Ws,Ls)),i(Bm)&&i(Bm)===Ws&&As){const js=Math.min(As.x1,As.x2),ks=Math.max(As.x1,As.x2),Jn=Math.min(As.y1,As.y2),En=Math.max(As.y1,As.y2),Wi={left:js,right:ks,top:Jn,bottom:En},ml=2,Qo=Math.max(gr,8),po=(()=>{const Aa=_s.convertFromPixel(Jn),jr=_s.convertFromPixel(Jn+Qo);return Number.isFinite(Aa)&&Number.isFinite(jr)?Math.abs(jr-Aa):0})(),aa=js+ui,Za=ks+ui,Lc=Jn+bi,Na=En+bi,Jf=(aa+Za)/2,Rr=(Lc+Na)/2,Go={n:{x:Jf,y:Lc},s:{x:Jf,y:Na},e:{x:Za,y:Rr},w:{x:aa,y:Rr},ne:{x:Za,y:Lc},nw:{x:aa,y:Lc},se:{x:Za,y:Na},sw:{x:aa,y:Na}};Object.keys(Go).forEach(Aa=>{const jr=Go[Aa],ja={x:jr.x-Ur,y:jr.y-Ur,width:gr,height:gr},qu={x:ja.x-ui,y:ja.y-bi,width:ja.width,height:ja.height},Yd=`__handle:${Ws}:${Aa}`;Pl.push({id:Yd,targetId:Ws,position:Aa,rect:ja,rectLocal:qu,boundsPx:Wi,cursor:Ra[Aa],minWidthIndex:ml,minHeightValue:po}),ar.push({id:Yd,type:"handle",zIndex:1e5,createdAt:Qs(),rect:ja,handle:{targetId:Ws,position:Aa,boundsPx:Wi,minWidthIndex:ml,minHeightValue:po},axis:Jo??void 0,offset:ai,snap:Qr??void 0})})}}else if(tn.kind==="line"||tn.kind==="lineSegment"){const Hs=lc(tn.payload,Ws);Hs&&ar.push({id:Ws,type:tn.kind,zIndex:tn.zIndex,createdAt:Qs(),segment:Hs,tolerance:xi,axis:Jo??void 0,offset:ai,snap:Qr??void 0})}else if(tn.kind==="label"){const Hs=Up(tn.payload,Ws),As=Nn.get(Ws)||null;As&&Hs&&!hs.has(Ws)&&ar.push({id:Ws,type:tn.kind,zIndex:tn.zIndex,createdAt:Qs(),rect:As,label:Hs,axis:Jo??void 0,offset:ai,snap:Qr??void 0})}else if(tn.kind==="polyline"){const Hs=fu(tn.payload,Ws);Hs.length&&ar.push({id:Ws,type:tn.kind,zIndex:tn.zIndex,createdAt:Qs(),segments:Hs,tolerance:xi,axis:Jo??void 0,offset:ai,snap:Qr??void 0})}else if(tn.kind==="polygon"){const Hs=hf(tn.payload,Ws);if(Hs.length>=3){let As=Number.POSITIVE_INFINITY,Ls=Number.POSITIVE_INFINITY,js=Number.NEGATIVE_INFINITY,ks=Number.NEGATIVE_INFINITY;for(const En of Hs)!Number.isFinite(En.x)||!Number.isFinite(En.y)||(En.x<As&&(As=En.x),En.x>js&&(js=En.x),En.y<Ls&&(Ls=En.y),En.y>ks&&(ks=En.y));const Jn=Number.isFinite(As)&&Number.isFinite(Ls)&&Number.isFinite(js)&&Number.isFinite(ks)?{x:As,y:Ls,width:Math.max(0,js-As),height:Math.max(0,ks-Ls)}:null;Jn&&_a.set(Ws,Jn),ar.push({id:Ws,type:tn.kind,zIndex:tn.zIndex,createdAt:Qs(),polygon:Hs,rect:Jn??void 0,tolerance:xi,axis:Jo??void 0,offset:ai,snap:Qr??void 0})}}else if(tn.kind==="path"){const Hs=Pd(tn.payload,Ws);Hs.length&&ar.push({id:Ws,type:tn.kind,zIndex:tn.zIndex,createdAt:Qs(),segments:Hs,tolerance:xi,axis:Jo??void 0,offset:ai,snap:Qr??void 0})}}tn.kind==="box"?dd(tn.payload,Ws):tn.kind==="polygon"?Ri(vp(tn.payload,Ws))||Gc(tn.payload,Ws):tn.kind==="polyline"?Ri(Td(tn.payload,Ws))||du(tn.payload,Ws):tn.kind==="path"?Ri(Xa(tn.payload,Ws))||bl(tn.payload,Ws):tn.kind==="line"||tn.kind==="lineSegment"?Ri(fd(tn.payload,Ws))||vf(tn.payload,Ws):tn.kind==="linefill"?Ri(Ju(tn.payload))||af(tn.payload):tn.kind==="label"?Sv(tn.payload,pn,Ws,hs):tn.kind==="table"&&Nf(tn.payload)}}};Qu("background"),Zl.forEach((te,nn)=>{var Nt,Ps,Nn,hs,ss,Ln,tn,Ws;const mt=Bo[nn]||D[nn].key,pn=(te.type||"").toLowerCase();if(pn==="candles"||pn==="ohlc"){const Hs=`${mt}__open`,As=`${mt}__high`,Ls=`${mt}__low`,js=`${mt}__close`,ks=Ds.convertToPixel(ys),Jn=ys+1<=tr?Ds.convertToPixel(ys+1):Ds.convertToPixel(Math.max(ys-1,0)),En=Number.isFinite(ks)&&Number.isFinite(Jn)?Math.max(2,Math.abs(Jn-ks)):6,Wi=Math.max(2,Math.min(14,En*.7)),ml=Wi/2,Qo=te.color||"#22c55e",po=te.downColor||"#ef4444",aa=te.upGradient??te.gradient,Za=te.downGradient??te.gradient,Lc=te.borderColor||Qo,Na=te.borderColor||po,Jf=te.wickColor||Qo,Rr=te.wickColor||po;for(let Go=ys;Go<=tr;(Go+=1)-1){const Aa=ia[Go]||{},jr=Aa[Hs]??Aa.__open,ja=Aa[As]??Aa.__high,qu=Aa[Ls]??Aa.__low,Yd=Aa[js]??Aa.__close;if(jr==null||ja==null||qu==null||Yd==null||Number.isNaN(jr)||Number.isNaN(ja)||Number.isNaN(qu)||Number.isNaN(Yd))continue;const Mp=Ds.convertToPixel(Go),zp=Yd>=jr,Kd=_s.convertToPixel(Math.max(jr,Yd)),Vp=_s.convertToPixel(Math.min(jr,Yd)),Wh=_s.convertToPixel(ja),Np=_s.convertToPixel(qu),mv=zp?Jf:Rr;if(U.beginPath(),U.strokeStyle=mv,U.lineWidth=1,U.moveTo(Mp,Wh),U.lineTo(Mp,Np),U.stroke(),pn==="candles"){const wh=zp?Qo:po,Qp=zp?Lc:Na,Ap=Math.max(1,Math.abs(Vp-Kd)),Hh=zp?aa:Za;if(Hh&&(Hh.from||Hh.to)){const Am=ah(U,{minX:Mp-ml,maxX:Mp+ml,minY:Math.min(Kd,Vp),maxY:Math.max(Kd,Vp)},Hh,wh);U.fillStyle=Am??wh}else U.fillStyle=wh;U.strokeStyle=Qp,U.lineWidth=1,U.beginPath(),U.rect(Mp-ml,Math.min(Kd,Vp),Wi,Ap),U.fill(),U.stroke()}else{const wh=zp?Lc:Na;U.strokeStyle=wh,U.lineWidth=1,U.beginPath(),U.moveTo(Mp-ml,_s.convertToPixel(jr)),U.lineTo(Mp,_s.convertToPixel(jr)),U.moveTo(Mp,_s.convertToPixel(Yd)),U.lineTo(Mp+ml,_s.convertToPixel(Yd)),U.stroke()}}}if(pn==="dots"){const Hs=te.color||"#22d3ee",As=te.width||4,Ls=[];for(let js=ys;js<=tr;(js+=1)-1){const ks=(Nt=ia[js])==null?void 0:Nt[mt];if(ks==null){Ls.push({x:NaN,y:NaN});continue}const Jn=Ds.convertToPixel(js),En=_s.convertToPixel(ks);Ls.push({x:Jn,y:En})}L5(U,Ls,Hs,As,Lo,te==null?void 0:te.gradient)}if(pn==="cross"){const Hs=te.color||"#22d3ee",As=te.width||6;U.save();const Ls=te==null?void 0:te.gradient;if(Ls&&(Ls.from||Ls.to)){const js=Lo??{left:0,top:0,width:bs.width,height:bs.height},ks=ah(U,{minX:js.left,maxX:js.left+js.width,minY:js.top,maxY:js.top+js.height},Ls,Hs);U.strokeStyle=ks??Hs}else U.strokeStyle=Hs;U.lineWidth=Math.max(1,Math.round(As/3));for(let js=ys;js<=tr;(js+=1)-1){const ks=(Ps=ia[js])==null?void 0:Ps[mt];if(ks==null)continue;const Jn=Ds.convertToPixel(js),En=_s.convertToPixel(ks);if(!Number.isFinite(Jn)||!Number.isFinite(En))continue;const Wi=As/2;U.beginPath(),U.moveTo(Jn-Wi,En),U.lineTo(Jn+Wi,En),U.moveTo(Jn,En-Wi),U.lineTo(Jn,En+Wi),U.stroke()}U.restore()}if(pn==="stepped"||pn==="step"){const Hs=te.color||"#22c55e",As=te.width||2,Ls=[];for(let js=ys;js<=tr;(js+=1)-1){const ks=(Nn=ia[js])==null?void 0:Nn[mt];if(ks==null){Ls.push({x:NaN,y:NaN});continue}Ls.push({x:Ds.convertToPixel(js),y:_s.convertToPixel(ks)})}NJ(U,Ls,Hs,As,Lo,te==null?void 0:te.gradient)}if(pn==="area"){const Hs=te.color||"rgba(56,189,248,0.3)",As=[];for(let Jn=ys;Jn<=tr;(Jn+=1)-1){const En=(hs=ia[Jn])==null?void 0:hs[mt];if(En==null){As.push({x:NaN,y:NaN});continue}const Wi=Ds.convertToPixel(Jn),ml=_s.convertToPixel(En);As.push({x:Wi,y:ml})}const Ls=_s.convertToPixel(0),ks=String(te.baseline||"").toLowerCase()==="zero"?Ls:Lo?Lo.height:bs.top+bs.height;MJ(U,As,ks,Hs,te==null?void 0:te.gradient,null,0,Lo)}if(pn==="glow_points"){const Hs=te.color||"#22d3ee",As=(te.width||4)+2,Ls=[];for(let js=ys;js<=tr;(js+=1)-1){const ks=(ss=ia[js])==null?void 0:ss[mt];if(ks==null){Ls.push({x:NaN,y:NaN});continue}Ls.push({x:Ds.convertToPixel(js),y:_s.convertToPixel(ks)})}U.save(),U.shadowColor=Hs,U.shadowBlur=12,L5(U,Ls,Hs,As,Lo,te==null?void 0:te.gradient),U.restore()}if(pn==="neon_line"){const Hs=te.color||"#22d3ee",As=te.width||2;U.save(),U.shadowColor=Hs,U.shadowBlur=14;const Ls=te==null?void 0:te.gradient;if(Ls&&(Ls.from||Ls.to)){const ks=Lo??{left:0,top:0,width:bs.width,height:bs.height},Jn=ah(U,{minX:ks.left,maxX:ks.left+ks.width,minY:ks.top,maxY:ks.top+ks.height},Ls,Hs);U.strokeStyle=Jn??Hs}else U.strokeStyle=Hs;U.beginPath();let js=!1;for(let ks=ys;ks<=tr;(ks+=1)-1){const Jn=(Ln=ia[ks])==null?void 0:Ln[mt];if(Jn==null)continue;const En=Ds.convertToPixel(ks),Wi=_s.convertToPixel(Jn);js?U.lineTo(En,Wi):(U.moveTo(En,Wi),js=!0)}U.lineWidth=As,U.stroke(),U.restore()}if(pn==="bezier_line"){const Hs=te.color||"#34d399",As=te.width||2;U.save();const Ls=te==null?void 0:te.gradient;if(Ls&&(Ls.from||Ls.to)){const En=Lo??{left:0,top:0,width:bs.width,height:bs.height},Wi=ah(U,{minX:En.left,maxX:En.left+En.width,minY:En.top,maxY:En.top+En.height},Ls,Hs);U.strokeStyle=Wi??Hs}else U.strokeStyle=Hs;U.beginPath();let js=NaN,ks=NaN,Jn=!1;for(let En=ys;En<=tr;(En+=1)-1){const Wi=(tn=ia[En])==null?void 0:tn[mt];if(Wi==null)continue;const ml=Ds.convertToPixel(En),Qo=_s.convertToPixel(Wi);if(!Jn)U.moveTo(ml,Qo),Jn=!0;else{const po=(js+ml)/2,aa=(ks+Qo)/2;U.quadraticCurveTo(js,ks,po,aa)}js=ml,ks=Qo}U.lineWidth=As,U.stroke(),U.restore()}if(pn==="cloud"||pn==="supertrend_cloud"){const Hs=te.color||"rgba(14,165,233,0.12)";U.save();const As=[],Ls=[];for(let Jn=ys;Jn<=tr;(Jn+=1)-1){const En=ia[Jn]||{},Wi=Ds.convertToPixel(Jn),ml=_s.convertToPixel(En[mt]),Qo=_s.convertToPixel(En[Bo[0]]);As.push({x:Wi,y:ml}),Ls.push({x:Wi,y:Qo})}let js=Hs;const ks=te==null?void 0:te.gradient;if(ks&&(ks.from||ks.to)){let Jn=Number.POSITIVE_INFINITY,En=Number.NEGATIVE_INFINITY,Wi=Number.POSITIVE_INFINITY,ml=Number.NEGATIVE_INFINITY;for(const po of As)!Number.isFinite(po.x)||!Number.isFinite(po.y)||(po.x<Jn&&(Jn=po.x),po.x>En&&(En=po.x),po.y<Wi&&(Wi=po.y),po.y>ml&&(ml=po.y));for(const po of Ls)!Number.isFinite(po.x)||!Number.isFinite(po.y)||(po.x<Jn&&(Jn=po.x),po.x>En&&(En=po.x),po.y<Wi&&(Wi=po.y),po.y>ml&&(ml=po.y));const Qo=ah(U,{minX:Number.isFinite(Jn)?Jn:0,maxX:Number.isFinite(En)&&En!==Jn?En:Number.isFinite(Jn)?Jn+1:1,minY:Number.isFinite(Wi)?Wi:0,maxY:Number.isFinite(ml)&&ml!==Wi?ml:Number.isFinite(Wi)?Wi+1:1},ks,Hs);Qo&&(js=Qo)}Ex(U,As,Ls,js,Lo),U.restore()}if(pn==="aura"||pn==="candleshadow"){const Hs=te.color||"#a78bfa",As=te.width||2;U.save(),U.shadowColor=Hs,U.shadowBlur=18;const Ls=te==null?void 0:te.gradient;if(Ls&&(Ls.from||Ls.to)){const ks=Lo??{left:0,top:0,width:bs.width,height:bs.height},Jn=ah(U,{minX:ks.left,maxX:ks.left+ks.width,minY:ks.top,maxY:ks.top+ks.height},Ls,Hs);U.strokeStyle=Jn??Hs}else U.strokeStyle=Hs;U.beginPath();let js=!1;for(let ks=ys;ks<=tr;(ks+=1)-1){const Jn=(Ws=ia[ks])==null?void 0:Ws[mt];if(Jn==null)continue;const En=Ds.convertToPixel(ks),Wi=_s.convertToPixel(Jn);js?U.lineTo(En,Wi):(U.moveTo(En,Wi),js=!0)}U.lineWidth=As,U.stroke(),U.restore()}});const Op=$t.fills||[];if(Array.isArray(Op)&&Op.length)for(const te of Op){const nn=Array.isArray(te==null?void 0:te.between)?te.between:[];if(!nn||nn.length!==2)continue;const mt=(nn[0]||"").replace(/\s+/g,"_").toLowerCase(),pn=(nn[1]||"").replace(/\s+/g,"_").toLowerCase(),Nt=j[mt],Ps=j[pn];if(!Nt||!Ps)continue;const Nn=[],hs=[];for(let tn=ys;tn<=tr;(tn+=1)-1){const Ws=ia[tn]||{},Hs=Ds.convertToPixel(tn),As=_s.convertToPixel(Ws[Nt]),Ls=_s.convertToPixel(Ws[Ps]);Nn.push({x:Hs,y:As}),hs.push({x:Hs,y:Ls})}let ss=te.color||"rgba(0,0,0,0.12)";const Ln=te.fillGradient;if(Ln&&(Ln.from||Ln.to)){let tn=Number.POSITIVE_INFINITY,Ws=Number.NEGATIVE_INFINITY,Hs=Number.POSITIVE_INFINITY,As=Number.NEGATIVE_INFINITY;for(const po of Nn)!Number.isFinite(po==null?void 0:po.x)||!Number.isFinite(po==null?void 0:po.y)||(po.x<tn&&(tn=po.x),po.x>Ws&&(Ws=po.x),po.y<Hs&&(Hs=po.y),po.y>As&&(As=po.y));for(const po of hs)!Number.isFinite(po==null?void 0:po.x)||!Number.isFinite(po==null?void 0:po.y)||(po.x<tn&&(tn=po.x),po.x>Ws&&(Ws=po.x),po.y<Hs&&(Hs=po.y),po.y>As&&(As=po.y));const Ls=Ln.from||ss,js=Ln.to||ss||Ls,ks=String(Ln.mode||"vertical").toLowerCase(),Jn=Number.isFinite(tn)?tn:0,En=Number.isFinite(Ws)&&Ws!==tn?Ws:Jn+1,Wi=Number.isFinite(Hs)?Hs:0,ml=Number.isFinite(As)&&As!==Hs?As:Wi+1;let Qo;if(ks==="horizontal")Qo=U.createLinearGradient(Jn,Wi,En,Wi);else if(ks==="radial"){const po=(Jn+En)/2,aa=(Wi+ml)/2,Za=Math.max(En-Jn,ml-Wi)/2;Qo=U.createRadialGradient(po,aa,0,po,aa,Math.max(1,Za))}else Qo=U.createLinearGradient(Jn,Wi,Jn,ml);Qo.addColorStop(0,String(Ls)),Qo.addColorStop(1,String(js)),ss=Qo}Ex(U,Nn,hs,ss,Lo)}Qu("main"),Xi.forEach(te=>{const nn=_s.convertToPixel(te.value);if(!Number.isFinite(nn))return;U.beginPath(),U.moveTo(0,nn),U.lineTo(((Lo==null?void 0:Lo.width)??bs.width)||0,nn),U.strokeStyle=te.color||"#64748b",U.lineWidth=te.width??1;const mt=(te.style||"dashed").toLowerCase();mt==="dashed"||mt==="dotted"?U.setLineDash(mt==="dashed"?[4,4]:[2,2]):U.setLineDash([]),U.stroke(),U.setLineDash([])});const Vh=$t.backgroundZones||[];if(Array.isArray(Vh)&&Vh.length)for(const te of Vh){const nn=Number.isFinite(te.from)?_s.convertToPixel(te.from):0,mt=Number.isFinite(te.to)?_s.convertToPixel(te.to):(Lo==null?void 0:Lo.height)??bs.height,pn=Math.min(nn,mt),Nt=Math.abs(mt-nn);U.beginPath(),U.rect(0,pn,((Lo==null?void 0:Lo.width)??bs.width)||0,Nt),U.fillStyle=te.color||"rgba(34,197,94,0.08)",U.fill()}if(Qu("overlay"),Qu("ui"),Uo&&Ti&&ga.length&&(bt.push({bounds:Ti,shapes:ga}),mu()),$r&&Pl.length){U.save(),U.fillStyle="rgba(226,232,240,0.9)",U.strokeStyle="rgba(15,23,42,0.65)",U.lineWidth=1;for(const te of Pl){const nn=te.rectLocal;U.beginPath(),U.rect(nn.x+.5,nn.y+.5,nn.width,nn.height),U.fill(),U.stroke()}U.restore()}if($r&&i(xf)){const te=_a.get(i(xf));te&&(U.save(),U.strokeStyle="rgba(148,163,184,0.75)",U.lineWidth=1,U.strokeRect(te.x-ui+.5,te.y-bi+.5,te.width,te.height),U.restore())}return $r?(fh.set(ca,ar),Tv=Array.from(fh.values()).flat()):fh.has(ca)&&(fh.delete(ca),Tv=Array.from(fh.values()).flat()),U.restore(),!1}},If=($t==null?void 0:$t.legend)??((oa=S==null?void 0:S.style)==null?void 0:oa.legend)??!0,jf=U=>{if(U==null)return;const Kt=String(U).toLowerCase().replace(/\s+/g,"_");if(Kt.includes("bottom")&&Kt.includes("right"))return"bottom_right";if(Kt.includes("bottom")&&Kt.includes("left"))return"bottom_left";if(Kt.includes("top")&&Kt.includes("right"))return"top_right";if(Kt.includes("top")&&Kt.includes("left"))return"top_left";if(Kt.includes("bottom"))return"bottom_left";if(Kt.includes("top"))return"top_left"},sa=U=>{const Kt=Ya(U);return Number.isFinite(Kt)?Kt:void 0},wi=Zl.find(U=>(U==null?void 0:U.legendPosition)!=null||(U==null?void 0:U.legendOffsetX)!=null||(U==null?void 0:U.legendOffsetY)!=null),pa=jf(($t==null?void 0:$t.legendPosition)??($t==null?void 0:$t.legend_position)??(wi==null?void 0:wi.legendPosition)??(wi==null?void 0:wi.legend_position)??((Ul=S==null?void 0:S.style)==null?void 0:Ul.legendPosition))||"top_left",er=sa(($t==null?void 0:$t.legendOffsetX)??($t==null?void 0:$t.legend_offset_x)??(wi==null?void 0:wi.legendOffsetX)??(wi==null?void 0:wi.legend_offset_x)??((ud=S==null?void 0:S.style)==null?void 0:ud.legendOffsetX))??0,Da=sa(($t==null?void 0:$t.legendOffsetY)??($t==null?void 0:$t.legend_offset_y)??(wi==null?void 0:wi.legendOffsetY)??(wi==null?void 0:wi.legend_offset_y)??((dl=S==null?void 0:S.style)==null?void 0:dl.legendOffsetY))??0;return Id.__plotMeta={plots:Zl,plotKeys:Bo,legend:If,legendPosition:pa,legendOffsetX:er,legendOffsetY:Da},Id.__scriptSource=ae,Id},of=[],Jm=[];jn.forEach(($t,Gs)=>{var Ys,Er,Hn,Mn,Do,Jr,Mr;const Zo=au($t,Gs);try{J2(Zo)}catch(vr){console.debug("Script indicator register error",vr)}const Bo=$t.pane==="main"?"candle_pane":`pane_script_${Gs}`;Jm[Gs]=Bo;const ka=$t.pane==="main",Ru=typeof $t.min=="number"&&typeof $t.max=="number",Vo=$t.pane==="sub"?{gap:Ru?{top:0,bottom:0}:{top:2,bottom:2}}:void 0;let il=X.createIndicator(Zo.name,ka,{id:Bo,height:typeof $t.height=="number"&&Number.isFinite($t.height)?$t.height:$t.pane==="sub"?((Ys=S==null?void 0:S.sub)==null?void 0:Ys.height)??(S==null?void 0:S.height)??200:((Er=S==null?void 0:S.main)==null?void 0:Er.height)??(S==null?void 0:S.height)??void 0,axis:Vo});if(il||(il=X.createIndicator(Zo,ka,{id:Bo,height:typeof $t.height=="number"&&Number.isFinite($t.height)?$t.height:$t.pane==="sub"?((Hn=S==null?void 0:S.sub)==null?void 0:Hn.height)??(S==null?void 0:S.height)??200:((Mn=S==null?void 0:S.main)==null?void 0:Mn.height)??(S==null?void 0:S.height)??void 0,axis:Vo})),!il)throw new Error("Unable to render script indicator.");Cu.push(il),uc.push(Zo.name),qe.push({def:Zo,paneId:Bo}),Ru?(Ro.set(Bo,{min:$t.min,max:$t.max}),Zd(Bo),Yf(Bo)):Ro.delete(Bo);try{X.createOverlay({name:"script-layer",visible:!0,lock:!0,groupId:"runtime"})}catch{}const Ya=(Mr=Zo.calc)==null?void 0:Mr.call(Zo,((Jr=(Do=o())==null?void 0:Do.getDataList)==null?void 0:Jr.call(Do))||[],{calcParams:[]}),Zl=Array.isArray(Ya)?Ya:Array.isArray(Ya==null?void 0:Ya.__rows)?Ya.__rows:[],oi=i(yr)?Zl.reduce((vr,Il)=>vr+Object.keys(Il||{}).filter(mi=>mi.startsWith("__label_")).length,0):0;of.push(oi)});try{const $t=qe.find(Gs=>Gs.paneId==="candle_pane");x(Fl,V(((eh=$t==null?void 0:$t.def)==null?void 0:eh.name)||((Hr=(nr=qe[0])==null?void 0:nr.def)==null?void 0:Hr.name)||null))}catch{x(Fl,null)}try{const $t=((nu=X.getDataList)==null?void 0:nu.call(X))||[],Gs=Hn=>{const Mn=typeof Hn=="number"?Hn:Number(Hn);return Number.isFinite(Mn)?Mn:void 0},Zo=$t.map(Hn=>{const Mn=Gs((Hn==null?void 0:Hn.close)??(Hn==null?void 0:Hn.c)??(Hn==null?void 0:Hn.price));return Gs((Hn==null?void 0:Hn.high)??(Hn==null?void 0:Hn.h))??Mn}),Bo=$t.map(Hn=>{const Mn=Gs((Hn==null?void 0:Hn.close)??(Hn==null?void 0:Hn.c)??(Hn==null?void 0:Hn.price));return Gs((Hn==null?void 0:Hn.low)??(Hn==null?void 0:Hn.l))??Mn}),ka=$t.map(Hn=>Gs((Hn==null?void 0:Hn.close)??(Hn==null?void 0:Hn.c)??(Hn==null?void 0:Hn.price))),Ru=(Hn,Mn)=>{const Do=Hn[Mn];return typeof Do=="number"&&Number.isFinite(Do)?Do:null},Vo=(Hn,Mn)=>{const Do=$t.length;if(Do<=0)return null;const Jr=Math.max(1,Math.floor(Mn.left)),Mr=Math.max(1,Math.floor(Mn.right)),vr=Math.max(2,Math.floor(Mn.lookback)),Il=Do-1,mi=Math.max(0,Il-vr+1),Xi=Math.max(0,Il-Mr);if(Xi<mi)return null;const k=Hn==="high"?Zo:Bo,N=[];for(let W=mi+Jr;W<=Xi;(W+=1)-1){const H=Ru(k,W);if(H==null)continue;let he=!0;for(let Le=W-Jr;Le<=W+Mr;(Le+=1)-1){if(Le===W)continue;const st=Ru(k,Le);if(st==null){he=!1;break}if(Hn==="high"){if(st>=H){he=!1;break}}else if(st<=H){he=!1;break}}he&&N.push(W)}if(!N.length)return null;const j=Math.trunc(Mn.which);if(j===0)return N[N.length-1];if(j<0){const W=N.length+j;return W>=0?N[W]:null}const D=j-1;return D>=0&&D<N.length?N[D]:null},il=(Hn,Mn)=>{const Do=$t.length;if(Do<=0)return null;const Jr=Math.max(2,Math.floor(Mn.lookback)),Mr=Do-1,vr=Math.max(0,Mr-Jr+1),Il=Hn==="high"?Zo:Bo;let mi=null,Xi=Hn==="high"?-1/0:1/0;for(let k=vr;k<=Mr;(k+=1)-1){const N=Ru(Il,k);N!=null&&(Hn==="high"?N>Xi&&(Xi=N,mi=k):N<Xi&&(Xi=N,mi=k))}return mi},Ya=Hn=>{const Mn=typeof Hn=="number"?Hn:Number(Hn);if(!Number.isFinite(Mn))return null;const Do=$t.length,Jr=Mn<0?Do+Math.trunc(Mn):Math.trunc(Mn);return Jr<0||Jr>=Do?null:Jr},Zl=Hn=>{var vr,Il;if(!Hn||typeof Hn!="object")return null;if(Hn.pivot){const mi=String(Hn.pivot).toLowerCase()==="low"?"low":"high",Xi=Vo(mi,{left:Number(Hn.left??Hn.pivotLeft??3),right:Number(Hn.right??Hn.pivotRight??3),lookback:Number(Hn.lookback??400),which:Number(Hn.which??-1)});Xi!=null&&(Hn={index:Xi,source:mi})}else if(Hn.extreme){const mi=String(Hn.extreme).toLowerCase()==="low"?"low":"high",Xi=il(mi,{lookback:Number(Hn.lookback??400)});Xi!=null&&(Hn={index:Xi,source:mi})}const Mn=Ya(Hn.index),Do=typeof Hn.timestamp=="number"&&Number.isFinite(Hn.timestamp)?Hn.timestamp:Mn!=null?((vr=$t[Mn])==null?void 0:vr.timestamp)??((Il=$t[Mn])==null?void 0:Il.time)??null:null;let Jr=typeof Hn.value=="number"&&Number.isFinite(Hn.value)?Hn.value:null;if(Jr==null&&Mn!=null&&Hn.source){const mi=String(Hn.source||"").replace(/\s+/g,"_").toLowerCase(),Xi=$t[Mn],k=mi==="open"?Xi==null?void 0:Xi.open:mi==="high"?Xi==null?void 0:Xi.high:mi==="low"?Xi==null?void 0:Xi.low:mi==="close"?Xi==null?void 0:Xi.close:mi==="volume"?Xi==null?void 0:Xi.volume:null;typeof k=="number"&&Number.isFinite(k)&&(Jr=k)}const Mr={};return Do!=null&&(Mr.timestamp=Do),Jr!=null&&(Mr.value=Jr),Mn!=null&&(Mr.__index=Mn),Object.keys(Mr).length?Mr:null},oi=[];jn.forEach((Hn,Mn)=>{(Array.isArray(Hn.overlays)?Hn.overlays:[]).forEach(Jr=>oi.push({paneId:Jm[Mn]||(Hn.pane==="main"?"candle_pane":"pane_script"),overlay:Jr}))});let Ys=0;const Er=[];oi.forEach(({paneId:Hn,overlay:Mn})=>{try{const Do=String((Mn==null?void 0:Mn.name)||"").trim();if(!Do)return;const Mr=(Array.isArray(Mn==null?void 0:Mn.points)?Mn.points:[]).map(Zl).filter(Boolean),vr={name:Do,paneId:(Mn==null?void 0:Mn.pane)==="main"?"candle_pane":((Mn==null?void 0:Mn.pane)==="sub",Hn),groupId:"runtime",lock:(Mn==null?void 0:Mn.lock)===!0,visible:(Mn==null?void 0:Mn.visible)!==!1,points:Mr};Mn!=null&&Mn.styles&&(vr.styles=Mn.styles),Mn!=null&&Mn.extendData&&(vr.extendData=Mn.extendData),X.createOverlay(vr),Ys+=1}catch(Do){Er.push(String((Do==null?void 0:Do.message)||Do))}});try{const Hn=Array.isArray(Yt)?Yt:[];for(const Mn of Hn){const Do=String((Mn==null?void 0:Mn.type)||"").trim().toLowerCase();if(Do!=="auto_fib"&&Do!=="autofib"||!(Mn.draw===!0||Mn.autoDraw===!0)||$t.length<2)continue;const Mr=Math.max(2,Math.floor(Number(Mn.lookback)||200)),Il=String(Mn.direction||"up").trim().toLowerCase()==="down"?"down":"up",mi=String(Mn.method||Mn.mode||"extremes").trim().toLowerCase(),Xi=mi==="pivots"||mi==="pivot"||mi==="swing"?"pivots":"extremes",k=Math.max(1,Math.floor(Number(Mn.pivotLeft??Mn.left??3))),N=Math.max(1,Math.floor(Number(Mn.pivotRight??Mn.right??3))),j=W8(Zo,Bo,ka,$t.length-1,{lookback:Mr,direction:Il,method:Xi,pivotLeft:k,pivotRight:N});if(!j)continue;const D=$t[j.fromIndex],W=$t[j.toIndex],H=(D==null?void 0:D.timestamp)??(D==null?void 0:D.time)??null,he=(W==null?void 0:W.timestamp)??(W==null?void 0:W.time)??null;if(H==null||he==null)continue;const Le=Mn.levels,st=Array.isArray(Le)&&Le.length?Le.map(Jt=>{if(typeof Jt=="number")return{value:Jt,color:"#64748b",label:String(Jt)};if(Jt&&typeof Jt=="object"){const fs=typeof Jt.value=="number"?Jt.value:Number(Jt.value);return Number.isFinite(fs)?{value:fs,color:String(Jt.color||"#64748b"),label:String(Jt.label??fs)}:null}return null}).filter(Boolean):[{value:0,color:"#64748b",label:"0"},{value:.382,color:"#60a5fa",label:"0.382"},{value:.5,color:"#22c55e",label:"0.5"},{value:.618,color:"#f59e0b",label:"0.618"},{value:1,color:"#64748b",label:"1"}];X.createOverlay({name:"fibonacciSegment",paneId:"candle_pane",groupId:"runtime",lock:!1,visible:!0,points:[{timestamp:H,value:j.fromValue},{timestamp:he,value:j.toValue}],extendData:{fibonacciLevels:st}}),Ys+=1}}catch(Hn){Er.push(String((Hn==null?void 0:Hn.message)||Hn))}Ys&&x(Rt,`${i(Rt)||"Plotted"} • overlays: ${Ys}`),Er.length&&x(un,`Overlay error: ${Er.slice(0,2).join(" • ")}`)}catch($t){console.error("[ScriptStudio] overlay create error",$t)}try{const $t=qe.find(Gs=>Gs.paneId==="candle_pane");x(Fl,V(((Sd=$t==null?void 0:$t.def)==null?void 0:Sd.name)||((Ud=(Rf=qe[0])==null?void 0:Rf.def)==null?void 0:Ud.name)||null))}catch{x(Fl,null)}const fv=jn.map($t=>$t.pane).join("+"),Df=of.reduce(($t,Gs)=>$t+Gs,0),Bh=jn.flatMap($t=>$t.plots||[]),kf=Bh.length,Pm=Bh.filter(Se).length,dm=jn.some($t=>Array.isArray($t.labels)&&$t.labels.length>0||Array.isArray($t.runtimeLabels)&&$t.runtimeLabels.length>0),Pg=jn.some($t=>Array.isArray($t.runtimeLines)&&$t.runtimeLines.length>0||Array.isArray($t.runtimeBoxes)&&$t.runtimeBoxes.length>0||Array.isArray($t.runtimeTables)&&$t.runtimeTables.length>0||Array.isArray($t.runtimeDrawOps)&&$t.runtimeDrawOps.length>0||Array.isArray($t.overlays)&&$t.overlays.length>0),pf=[],wc=Pm===0&&!Pg;if(wc&&!i(yr)&&(Df>0||dm)&&pf.push({level:"warning",message:"Labels are disabled; this script only outputs labels, so nothing is visible.",hint:"Turn Labels On or add a plot/line/box."}),wc&&dm&&Df===0&&pf.push({level:"warning",message:"No label signals matched, so nothing was drawn.",hint:"Loosen your conditions or add a plot for context."}),wc&&pf.length===0&&(kf>0?pf.push({level:"warning",message:"All plots are hidden (transparent/opacity 0) and no draws are visible.",hint:"Use a visible color or remove transparent plots while debugging."}):pf.push({level:"warning",message:"No visible output: no plots or draw calls were produced.",hint:"Check conditions/returns or add a plot for context."})),pf.length&&x(qs,V(E(i(qs),pf))),x(Rt,`Plotted (${fv}) • labels: ${i(yr)?Df:"off"}`),Ia.size&&x(Rt,`${i(Rt)} • limits: ${Array.from(Ia).join(" • ")}`),ne&&x(qs,V(Array.from(Ee.values()))),Df===0)try{const $t=jn.reduce((Vo,il)=>Vo+(il.plots||[]).length,0),Gs=[],Zo=jn.some(Vo=>Array.isArray(Vo.labels)&&Vo.labels.length>0),Bo=jn.some(Vo=>Array.isArray(Vo.runtimeDrawOps)&&Vo.runtimeDrawOps.length>0||Array.isArray(Vo.overlays)&&Vo.overlays.length>0||Array.isArray(Vo.runtimeLabels)&&Vo.runtimeLabels.length>0||Array.isArray(Vo.runtimeLines)&&Vo.runtimeLines.length>0||Array.isArray(Vo.runtimeBoxes)&&Vo.runtimeBoxes.length>0||Array.isArray(Vo.runtimeTables)&&Vo.runtimeTables.length>0);$t===0&&!Zo&&!Bo&&Gs.push("Pane has no plots");const ka=new Set(["open","high","low","close","volume","time","bar_index","barstate_isfirst","barstate_islast","barstate_islastconfirmedhistory","barstate_isconfirmed","barstate_isrealtime","barstate_ishistory","barstate_isnew","timeframe_multiplier","timeframe_seconds","timeframe_isseconds","timeframe_isminutes","timeframe_ishours","timeframe_isdaily","timeframe_isweekly","timeframe_ismonthly","timeframe_isyearly","timeframe_isintraday","timeframe_period","syminfo_mintick","syminfo_pointvalue","syminfo_tickerid","syminfo_ticker","syminfo_root","syminfo_prefix","syminfo_exchange","syminfo_description","syminfo_type","syminfo_currency","syminfo_timezone","syminfo_session","syminfo_isdelayed","strategy_position_size","strategy_position_avg_price","strategy_opentrades","strategy_closedtrades","strategy_openprofit","strategy_closedprofit","strategy_grossprofit","strategy_grossloss","strategy_wintrades","strategy_losstrades","strategy_winrate","strategy_max_drawdown","strategy_max_drawdown_value","strategy_max_runup","strategy_max_runup_value","strategy_avg_trade","strategy_avg_win","strategy_avg_loss","strategy_avg_bars_in_trade","strategy_equity","strategy_netprofit","strategy_initial_capital"]),Ru=(Vo,il)=>{const Ya=(Vo||"").toLowerCase(),Zl=il.replace(/\s+/g,"_").toLowerCase();return Ya==="bbands"||Ya==="bollinger"||Ya==="bollinger_bands"||Ya==="kc"||Ya==="keltner"||Ya==="donchian"||Ya==="linreg_channel"?[`${Zl}_mid`,`${Zl}_upper`,`${Zl}_lower`]:Ya==="atr_bands"?[`${Zl}_upper`,`${Zl}_lower`]:Ya==="stoch"?[`${Zl}_k`,`${Zl}_d`]:Ya==="macd"?["macd_line","macd_signal","macd_hist"]:Ya==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"]:[Zl]};if(Yt.forEach(Vo=>{const il=String((Vo==null?void 0:Vo.name)||(Vo==null?void 0:Vo.type)||"").replace(/\s+/g,"_").toLowerCase();Ru(String((Vo==null?void 0:Vo.type)||""),il).forEach(Ya=>ka.add(Ya))}),yn.forEach(Vo=>{const il=String((Vo==null?void 0:Vo.name)||"").replace(/\s+/g,"_").toLowerCase();il&&ka.add(il)}),jn.forEach((Vo,il)=>{(Vo.labels||[]).forEach((Ya,Zl)=>{const oi=String((Ya==null?void 0:Ya.when)||"").trim(),Er=String((Ya==null?void 0:Ya.whenExpr)||"").trim()||oi;if(!Er){Gs.push(`Label[${il}:${Zl}] has empty condition`);return}try{const Hn=S!=null&&S.params&&typeof S.params=="object"?S.params:{},Mn=Er.replace(/\$\{([^}]+)\}/g,(mi,Xi)=>{const k=Hn[Xi],N=typeof k=="number"?k:Number(k);return Number.isFinite(N)?String(N):"0"}),Do=$n(Mn),Jr=[],Mr=Lp(Do),vr=mi=>{!mi||typeof mi!="object"||(mi.kind==="Identifier"&&Jr.push(String(mi.name||"")),Object.values(mi).forEach(vr))};vr(Mr);const Il=Jr.filter(mi=>{const Xi=mi.replace(/\s+/g,"_").toLowerCase();return Xi==="na"||Xi==="nan"||Xi==="true"||Xi==="false"||Xi==="pi"||Xi==="e"?!1:!ka.has(Xi)&&!["open","high","low","close","volume"].includes(Xi)});Il.length&&Gs.push(`Label[${il}:${Zl}] unknown series: ${Il.join(", ")}`)}catch(Hn){const Mn=(Hn==null?void 0:Hn.position)!=null?` at ${Hn.position}`:"",Do=Hn!=null&&Hn.message?String(Hn.message):String(Hn);Gs.push(`Label[${il}:${Zl}] parse failed${Mn}: ${Do}`)}})}),Gs.length){const Vo=Gs.join(" • ");x(un,V(i(un)?`${i(un)} • ${Vo}`:Vo))}else x(Rt,"No label signals matched")}catch{}const xr=ye(i(qs));xr&&x(Rt,`${i(Rt)||"Plotted"} • ${xr}`),El();try{ft&&(clearInterval(ft),ft=null)}catch{}kd()}function Ye(S){const R=String(S||"").split(/\r?\n/),X=Math.min(8,R.length);for(let ae=0;ae<X;(ae+=1)-1){const Ee=(R[ae]||"").match(/^\s*(?:\/\/|#)\s*@?(?:lang|language)\s*(?::|=)?\s*([A-Za-z]+)\s*$/i);if(!Ee)continue;const je=String(Ee[1]||"").toLowerCase();if(je==="auto"||je==="json"||je==="pine"||je==="dsl"||je==="js")return je}return null}function at(S,R){return R&&R!=="auto"?R:Ye(S)||"auto"}function Re(S){let R="",X=null;for(let ae=0;ae<S.length;(ae+=1)-1){const ne=S[ae],Ee=S[ae+1];if(X){R+=ne,ne===X&&S[ae-1]!=="\\"&&(X=null);continue}if(ne==="'"||ne==='"'){X=ne,R+=ne;continue}if(ne==="/"&&Ee==="/")break;R+=ne}return R}function De(S){let R="",X=null;for(let ae=0;ae<S.length;(ae+=1)-1){const ne=S[ae];if(X){R+=" ",ne===X&&S[ae-1]!=="\\"&&(X=null);continue}if(ne==="'"||ne==='"'){X=ne,R+=" ";continue}R+=ne}return R}function pt(S){const R=String(S||"").split(/\r?\n/),X=/[A-Za-z_$][A-Za-z0-9_$]*\s*\[\s*-\s*\d+\s*\]/;for(let ae=0;ae<R.length;(ae+=1)-1){const ne=Re(R[ae]||""),Ee=De(ne),je=X.exec(Ee);if(je)return{line:ae+1,col:je.index+1,snippet:je[0].trim()}}return null}function Ge(S){const R=String(S||""),X=[];let ae="",ne=0,Ee=null,je=!1;for(let dt=0;dt<R.length;(dt+=1)-1){const At=R[dt];if(Ee){if(ae+=At,je){je=!1;continue}if(At==="\\"){je=!0;continue}At===Ee&&(Ee=null);continue}if(At==="'"||At==='"'){Ee=At,ae+=At;continue}if(At==="("){ne+=1,ae+=At;continue}if(At===")"&&ne>0){ne-=1,ae+=At;continue}if(At===","&&ne===0){ae.trim()&&X.push(ae.trim()),ae="";continue}ae+=At}return ae.trim()&&X.push(ae.trim()),X}function sn(S){const R=String(S||"").split(/\r?\n/),X={},ae=Ee=>Ee.trim().toLowerCase(),ne=Ee=>{const je=String(Ee||"").trim();if(!/^[-+]?\d+(?:\.\d+)?$/.test(je))return null;const dt=Number(je);return Number.isFinite(dt)?Math.max(0,Math.floor(dt)):null};for(let Ee=0;Ee<R.length;(Ee+=1)-1){const je=Re(R[Ee]||""),dt=je.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.new_(?:float|int|bool|string)\s*\(([^)]*)\)/i);if(dt){const Yt=Ge(dt[2]||""),yn=ne(Yt[0]||"");yn!=null&&(X[ae(dt[1]||"")]=yn);continue}const At=je.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.from\s*\(([^)]*)\)/i);if(At){const Yt=Ge(At[2]||"");Yt.length&&(X[ae(At[1]||"")]=Yt.length)}}for(let Ee=0;Ee<R.length;(Ee+=1)-1){const je=Re(R[Ee]||""),dt=De(je),At=dt.match(/\barray\.set\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+)\b/i);if(At){const yn=ae(At[1]||""),Wt=Number(At[2]),zn=X[yn],Pn=dt.indexOf(At[0]||"")+1;if(Number.isFinite(Wt)&&Wt<0)return{line:Ee+1,col:Pn>0?Pn:1,message:"Negative array index not allowed"};if(Number.isFinite(Wt)&&zn!=null&&Wt>=zn)return{line:Ee+1,col:Pn>0?Pn:1,message:"array.set index must be within array size"}}const Yt=dt.match(/\barray\.get\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+)\b/i);if(Yt){const yn=Number(Yt[2]),Wt=dt.indexOf(Yt[0]||"")+1;if(Number.isFinite(yn)&&yn<0)return{line:Ee+1,col:Wt>0?Wt:1,message:"Negative array index not allowed"}}}return null}function Un(S){const R=String(S||"").trim();if(!R)return"";const X=R[0];return(X==='"'||X==="'")&&R.endsWith(X)?R.slice(1,-1):R}function Zs(S){const R=Un(S).trim().toLowerCase();if(!R)return null;const X=R.replace(/^shape\./,"").replace(/^label\./,"");return X.includes("none")?"none":X.includes("xcross")?"xcross":X.includes("cross")?"cross":X.includes("diamond")?"diamond":X.includes("triangleup")?"triangle_up_filled":X.includes("triangledown")?"triangle_down_filled":X.includes("arrowup")?"arrowUp":X.includes("arrowdown")?"arrowDown":X.includes("circle")?"circle":X.includes("square")?"square":X.includes("flag")?"flag":X.includes("tag")?"tag":X.includes("pill")?"pill":X.includes("label")?"label":null}function vs(S){const R=Un(S).trim().toLowerCase();if(!R)return null;const X=R.replace(/^size\./,"");if(X==="auto")return 14;if(X==="tiny")return 10;if(X==="small")return 12;if(X==="normal")return 14;if(X==="large")return 18;if(X==="huge")return 22;const ae=Number(X);return Number.isFinite(ae)?ae:null}function Oo(S){const R=String(S||"").trim().toLowerCase();return R?R.startsWith('"')||R.startsWith("'")||R.startsWith("shape.")||R.startsWith("label.")?!0:["triangleup","triangledown","arrowup","arrowdown","circle","square","label","diamond","cross","xcross","flag","tag","pill","none"].includes(R):!1}function Pi(S){const R=String(S||"").trim().toLowerCase();return R?R.startsWith('"')||R.startsWith("'")?!0:R.startsWith("location."):!1}function no(S){const R=Un(S).trim().toLowerCase();if(!R)return null;const X=R.replace(/^location\./,"");return X.includes("absolute")?"absolute":/(above|top|high)/.test(X)?"above":/(below|bottom|low)/.test(X)?"below":null}function gl(S){const R=String(S||"").trim().toLowerCase();return R?R.startsWith('"')||R.startsWith("'")||R.startsWith("size.")?!0:/^[-+]?\d+(?:\.\d+)?$/.test(R):!1}function Ms(S){const R={};return S.forEach(X=>{const ae=X.indexOf("=");if(ae<=0)return;const ne=X.slice(0,ae).trim().toLowerCase(),Ee=X.slice(ae+1).trim();ne&&(R[ne]=Ee)}),R}function wo(S){const R=String(S||"").split(/\r?\n/);for(let X=0;X<R.length;(X+=1)-1){const ae=Re(R[X]||""),ne=ae.match(/^\s*(plotshape|plotchar)\s*\((.*)\)\s*$/i);if(!ne)continue;const Ee=String(ne[1]||"").toLowerCase(),je=Ge(ne[2]||""),dt=Ms(je),At=dt.style??dt.shape;if(Ee==="plotshape"&&At&&Oo(At)&&!Zs(At)){const zn=Math.max(1,ae.indexOf(At)+1);return{line:X+1,col:zn,message:`plotshape style not supported: ${At}`}}const Yt=dt.location;if(Yt&&Pi(Yt)&&!no(Yt)){const zn=Math.max(1,ae.indexOf(Yt)+1);return{line:X+1,col:zn,message:`${Ee} location not supported: ${Yt}`}}const yn=dt.size;if(yn&&gl(yn)&&vs(yn)==null){const zn=Math.max(1,ae.indexOf(yn)+1);return{line:X+1,col:zn,message:`${Ee} size not supported: ${yn}`}}}return null}function fr(S){const R=String(S||"").trim();if(!R)return!1;const X=R[0];if(X!=='"'&&X!=="'")return!1;let ae=1,ne=!1;for(;ae<R.length;(ae+=1)-1){const Ee=R[ae];if(ne){ne=!1;continue}if(Ee==="\\"){ne=!0;continue}if(Ee===X){ae+=1;break}}return ae<=1?!1:R.slice(ae).trim().length===0}function xa(S){const R=String(S||"").split(/\r?\n/);for(let X=0;X<R.length;(X+=1)-1){const ae=R[X]||"";let ne=null,Ee=0,je=-1,dt=-1;for(let At=0;At<ae.length;(At+=1)-1){const Yt=ae[At],yn=ae[At+1];if(ne){Yt===ne&&ae[At-1]!=="\\"&&(ne=null);continue}if(Yt==="'"||Yt==='"'){ne=Yt;continue}if(Yt==="/"&&yn==="/")break;if(Yt==="?"){Ee===0&&(je=At),Ee+=1;continue}if(Yt===":"&&Ee>0&&(Ee-=1,Ee===0)){dt=At;break}}if(je>=0&&dt>je){const At=ae.slice(je+1,dt),Yt=ae.slice(dt+1),yn=fr(At),Wt=fr(Yt);if(yn!==Wt)return{line:X+1,col:je+1,snippet:ae.slice(je).trim()}}}return null}const ic=S=>{const R=S.match(/^\s*(indicator|study)\s*\(\s*("([^"]+)"|'([^']+)')/m);return(R?(R[3]||R[4]||"").trim():"")||null},ec=S=>{let R=0;for(let X=0;X<S.length;(X+=1)-1)R=R*31+S.charCodeAt(X)>>>0;return R.toString(36)},Lf=S=>{const R=ic(S);return R||`pine_${ec(S)}`},_e=2e4,We=S=>new Promise((R,X)=>{const ae=new Worker(new URL(""+new URL("../workers/js.worker-C5qL6ZgK.js",import.meta.url).href,import.meta.url),{type:"module"}),ne=setTimeout(()=>{try{ae.terminate()}catch{}X(new Error("JS worker timed out"))},_e);ae.onerror=()=>{try{clearTimeout(ne)}catch{}try{ae.terminate()}catch{}X(new Error("JS worker error"))},ae.onmessage=Ee=>{const je=Ee.data;if(!(!je||je.id!==S.id)){try{clearTimeout(ne)}catch{}try{ae.terminate()}catch{}R(je)}},ae.postMessage(S)});async function xt(S,R,X,ae){var dt,At,Yt,yn,Wt,zn,Pn,as,Cs,Ks,jn,Xt,Tn;x(un,null),x(Rt,"Running..."),x(qs,V([])),x(ri,!0),Eo+=1,Wz(),Qa=ae&&typeof ae=="object"?{...ae}:null,Lr=(()=>{if(!Qa)return"";const Kn=Qa,os=Kn.from??"",ln=Kn.to??"",ms=Kn.session??"";return`${os}|${ln}|${ms}`})();let ne="parse",Ee=X||void 0,je;try{let Kn=null;const os=String(S||""),ln=os.trim(),ms=at(os,X);Ee=ms;const Ns=ln.startsWith("{")||ln.startsWith("["),cn=on=>{try{return JSON.parse(on)}catch{return null}},Gn=on=>on&&typeof on=="object"&&(on.plots||on.calc||on.series||on.signals||on.strategy||on.labels||on.levels||on.lines||on.overlays||on.panes||on.main||on.sub);if(ms==="json"){const on=cn(ln);if(!on){x(un,"Invalid JSON: expected a script spec object"),x(Rt,"Validation failed");return}if(!Gn(on)){x(un,"JSON mode expects a script spec object"),x(Rt,"Validation failed");return}try{const an=on&&typeof on=="object"?on.params||{}:{},wn=Nw(on,an);let ds=wn;try{ds=Tw(wn)}catch(yo){const Si=yo instanceof Error?yo.message:String(yo);x(un,`Template expansion error: ${Si}`),x(Rt,"Validation failed");return}je=String(ds&&(ds.shortName||ds.name||ds.title)||"").trim()||void 0,ne="normalize";const Wn=Y_(ds);if(Wn.ok&&Wn.spec)ae&&typeof ae=="object"&&(ds.strategy={...ds.strategy||{},...ae}),ne="draw",await Ve(ds,"json"),x(Rt,"Plotted from JSON");else{const yo=(Wn.errors||[]).join("; ");x(un,V(yo?`Schema validation failed: ${yo}`:"Schema validation failed")),x(Rt,"Validation failed");return}}catch(an){const wn=an instanceof Error?an.message:String(an);x(un,`Schema validation error: ${wn}`),x(Rt,"Validation failed");return}return}if(ms==="js"){const on=o();if(!on){x(un,"Chart not ready yet. Please try again in a moment."),x(Rt,"Validation failed");return}const an=((dt=on.getDataList)==null?void 0:dt.call(on))||[];if(!an.length){x(un,"JS engine: no bars available"),x(Rt,"Validation failed");return}const wn=an.length,ds=new Array(wn),Wn=new Array(wn),yo=new Array(wn),Si=new Array(wn),is=new Array(wn),To=new Array(wn),gs=wc=>{if(typeof wc=="number")return Number.isFinite(wc)?wc:void 0;if(typeof wc=="string"){const Qd=wc.replace(/[^0-9eE+\\-\\.]/g,"");if(!Qd||Qd==="+"||Qd==="-"||Qd===".")return;const xp=Number(Qd);return Number.isFinite(xp)?xp:void 0}const xr=Number(wc);return Number.isFinite(xr)?xr:void 0};for(let wc=0;wc<wn;(wc+=1)-1){const xr=an[wc],Qd=gs((xr==null?void 0:xr.close)??(xr==null?void 0:xr.c)??(xr==null?void 0:xr.price)??(xr==null?void 0:xr.value)),xp=gs((xr==null?void 0:xr.open)??(xr==null?void 0:xr.o))??Qd,Qm=gs((xr==null?void 0:xr.high)??(xr==null?void 0:xr.h))??Qd??xp,Oh=gs((xr==null?void 0:xr.low)??(xr==null?void 0:xr.l))??Qd??xp,Pp=gs((xr==null?void 0:xr.volume)??(xr==null?void 0:xr.vol))??0,pv=gs((xr==null?void 0:xr.timestamp)??(xr==null?void 0:xr.time)??(xr==null?void 0:xr.t))??0;Si[wc]=Qd,ds[wc]=xp,Wn[wc]=Qm,yo[wc]=Oh,is[wc]=Pp,To[wc]=pv}const No=R&&typeof R=="object"?{...R}:{},jo=/request\s*\.\s*security/i.test(S),co=((At=s())==null?void 0:At.symbol)||{ticker:"UNKNOWN"},Vs=String((co==null?void 0:co.country)||"BD").trim()||"BD",gi=`${String((co==null?void 0:co.ticker)||"UNKNOWN").trim()}@${Vs}`,Hc=String(((yn=(Yt=s())==null?void 0:Yt.period)==null?void 0:yn.timeframe)||"1m").trim()||"1m",xc=wc=>{const xr=typeof wc=="number"?wc:Number(wc);return!Number.isFinite(xr)||xr<=0?0:xr<1e12?xr*1e3:xr},ac=xc(To[0]??0),tu=xc(To[wn-1]??0),_c=wc=>{const xr=String(wc||"").trim();if(!xr)return 0;if(/^\d+$/.test(xr))return gp(`${xr}m`);if(xr==="M"||xr==="1M")return gp("1M");const Qd=xr.toUpperCase();if(Qd==="D"||Qd==="1D")return gp("1d");if(Qd==="W"||Qd==="1W")return gp("1w");const xp=xr.match(/^(\d+)\s*([A-Za-z]+)$/);if(xp){const Qm=xp[1]||"1",Oh=xp[2]||"";if(Oh==="M")return gp(`${Qm}M`);const Pp=Oh.toLowerCase();return Pp.startsWith("min")?gp(`${Qm}m`):Pp==="h"||Pp.startsWith("hr")||Pp.startsWith("hour")?gp(`${Qm}h`):Pp==="d"||Pp.startsWith("day")?gp(`${Qm}d`):Pp==="w"||Pp.startsWith("wk")||Pp.startsWith("week")?gp(`${Qm}w`):Pp.startsWith("sec")?gp(`${Qm}s`):gp(`${Qm}${Pp}`)}try{return gp(xr)}catch{return 0}},qc=_c(Hc),jl=qc>0?qc*1e3:0,Bl=tu>0&&jl>0?tu+jl-1:tu,_u=(zn=(Wt=o())==null?void 0:Wt.getVisibleRange)==null?void 0:zn.call(Wt),cd=wc=>Number.isFinite(wc)?Math.max(0,Math.min(wn-1,Math.floor(wc))):0,ql=_u?cd(_u.from):0,jp=_u?cd(_u.to):wn-1,Uc=xc(To[ql]??0),Ol=xc(To[jp]??0),au=Uc||ac,of=Ol>0&&jl>0?Ol+jl-1:Bl;let Jm,fv,Df=null;if(jo){let wc=null;try{wc=await We({id:`js_mtf_${Date.now()}`,code:S,base:{open:ds,high:Wn,low:yo,close:Si,volume:is,time:To},params:No,mtf:{baseSymbol:gi,baseTimeframe:Hc,collectOnly:!0}})}catch(Qd){const xp=Qd instanceof Error?Qd.message:"JS engine failed";x(un,V(xp)),x(Rt,"Validation failed");return}if(!wc||wc.error){x(un,V(String((wc==null?void 0:wc.error)||"JS engine failed"))),x(Rt,"Validation failed");return}const xr=Array.isArray(wc==null?void 0:wc.mtfRequests)?wc.mtfRequests:[];if(xr.length){const Qd=nr=>String(nr||"").trim().toLowerCase().replace(/\s+/g,""),xp=nr=>{const Hr=String(nr||"").trim(),nu=Hr.lastIndexOf("@");if(nu>0&&nu<Hr.length-1){const Sd=Hr.slice(0,nu).trim(),Rf=Hr.slice(nu+1).trim();if(Sd&&Rf)return{ticker:Sd,country:Rf}}return{ticker:Hr}},Qm=Array.isArray((Pn=s())==null?void 0:Pn.allSymbols)?s().allSymbols:[],Oh=new Map,Pp=new Map,pv=new Map;for(const nr of Qm){const Hr=Qd(String((nr==null?void 0:nr.ticker)||""));Hr&&Oh.set(Hr,nr);const nu=Qd(String((nr==null?void 0:nr.shortName)||""));nu&&!Pp.has(nu)&&Pp.set(nu,nr);const Sd=Qd(String((nr==null?void 0:nr.name)||""));Sd&&!pv.has(Sd)&&pv.set(Sd,nr)}const Mg=nr=>{const Hr=String(nr??"").trim();if(!Hr)return"__CURRENT__";const nu=Hr.toLowerCase();return nu==="syminfo.tickerid"||nu==="syminfo.ticker"||nu==="syminfo.root"||nu==="__current__"||nu==="__current_symbol__"?"__CURRENT__":Hr},Ng=nr=>{const Hr=Mg(nr);if(Hr==="__CURRENT__")return{sym:co,found:!0,raw:Hr};const nu=xp(Hr),Sd=String(nu.ticker||"").trim(),Rf=Qd(Sd),Ud=Rf&&Oh.get(Rf)||Rf&&Pp.get(Rf)||Rf&&pv.get(Rf)||null,$t=String(nu.country||(Ud==null?void 0:Ud.country)||Vs).trim()||Vs;return Ud&&String(Ud.ticker||"").trim()?{sym:{...Ud,country:$t},found:!0,raw:Hr}:{sym:{...co,ticker:Sd,country:$t},found:!1,raw:Hr}},Ag=nr=>{const Hr=String(nr??"").trim();if(!Hr)return"__CURRENT__";const nu=Hr.toUpperCase();if(nu==="CURRENT"||nu==="__CURRENT__"||nu==="TIMEFRAME.PERIOD")return"__CURRENT__";if(nu==="D"||nu==="1D")return"1d";if(nu==="W"||nu==="1W")return"1w";if(nu==="M"||nu==="1M")return"1M";if(/^\d+$/.test(Hr))return`${Hr}m`;const Sd=nu.match(/^(\d+)\s*H$/);if(Sd)return`${Sd[1]}h`;const Rf=nu.match(/^(\d+)\s*S$/);return Rf?`${Rf[1]}s`:Hr},pg=new Set,Mm=new Map,mg={},Tg=(nr,Hr)=>{nr&&(mg[Qd(nr)]=Hr)};for(const nr of xr){const Hr=nr==null?void 0:nr.symbol,nu=Ng(Hr);if(Hr!=null&&String(Hr).trim()&&!nu.found&&nu.raw!=="__CURRENT__"){x(un,`request.security: unknown symbol "${String(Hr).trim()}"`),x(Rt,"Validation failed");return}const Sd=nu.sym,Rf=String((Sd==null?void 0:Sd.ticker)||"").trim();if(!Rf)continue;const Ud=String((Sd==null?void 0:Sd.country)||Vs).trim()||Vs,$t=`${Rf}@${Ud}`,Gs=Qd($t);pg.add($t),Tg(Hr?String(Hr):void 0,$t);const Zo=String((nr==null?void 0:nr.timeframe)||"__CURRENT__").trim()||"__CURRENT__",Bo=Zo==="__CURRENT__"?Hc:Ag(Zo);if(!Bo||Bo==="__CURRENT__")continue;const ka=_c(Bo);if(nr!=null&&nr.lower&&qc>0&&ka>=qc){x(un,`request.security_lower_tf: "${Zo}" must be lower than chart timeframe "${Hc}"`),x(Rt,"Validation failed");return}const Ru=`${Gs}|${Bo}`;Mm.has(Ru)||Mm.set(Ru,{sym:Sd,tf:Bo,computeTf:Zo,lower:!!(nr!=null&&nr.lower),symbolKey:Gs,rawSymbol:Hr?String(Hr):void 0})}if(nd.size)for(const nr of nd){const[Hr]=String(nr).split("@");if(Hr&&Hr!==co.ticker)try{A.stopSymbolPipelines(Hr)}catch{}}if(nd=pg,Mm.size&&ac>0&&Bl>0)await Promise.all(Array.from(Mm.values()).map(({sym:nr,tf:Hr,lower:nu})=>{const Sd=nu?8e3:3500;return A.ensureHistoryCovers(nr,Hr,au,of,Sd).catch(()=>null)}));else if(Mm.size)for(const{sym:nr,tf:Hr}of Mm.values())try{A.startBackgroundPrefetch(nr,{timeframe:Hr})}catch{}Jm={},fv=mg;let kv=0,eh="";for(const nr of Mm.values()){const Hr=A.getHistorySnapshot(nr.sym,nr.tf);if(Hr!=null&&Hr.error){x(un,`request.security: ${nr.sym.ticker}${nr.sym.country?`@${nr.sym.country}`:""} (${nr.tf}) error: ${Hr.error}`),x(Rt,"Validation failed");return}const nu=Array.isArray(Hr==null?void 0:Hr.candles)?Hr.candles:[];if(!nu.length){if(!(Hr!=null&&Hr.isComplete)){kv+=1,eh||(eh=`Loading request.security: ${nr.sym.ticker}${nr.sym.country?`@${nr.sym.country}`:""} (${nr.tf})… waiting for candles`);continue}x(un,`request.security: no data for ${nr.sym.ticker}${nr.sym.country?`@${nr.sym.country}`:""} (${nr.tf})`),x(Rt,"Validation failed");return}const Sd=xc((Hr==null?void 0:Hr.oldestTimestampLoaded)??0),Rf=xc((Hr==null?void 0:Hr.newestTimestampLoaded)??0),Ud=au>0&&of>0&&Sd>0&&Rf>0&&Sd<=au&&Rf>=of;if(!(au===0||of===0||Rf>=au&&Sd<=of)){if(!(Hr!=null&&Hr.isComplete)){kv+=1,eh||(eh=`Loading request.security: ${nr.sym.ticker}${nr.sym.country?`@${nr.sym.country}`:""} (${nr.tf})… waiting for overlap`);continue}x(un,`request.security: no overlap for ${nr.sym.ticker}${nr.sym.country?`@${nr.sym.country}`:""} (${nr.tf})`),x(Rt,"Validation failed");return}if(!(Hr!=null&&Hr.isComplete)&&!Ud&&(kv+=1,!eh)){const Zo=Sd||0,Bo=Rf||0;eh=`Loading request.security: ${nr.sym.ticker}${nr.sym.country?`@${nr.sym.country}`:""} (${nr.tf})… loaded ${Zo}→${Bo}`}const Gs=`${nr.symbolKey}|${nr.tf}`;Jm[Gs]={key:Gs,symbol:nr.sym.ticker,country:nr.sym.country,timeframe:nr.tf,candles:nu}}if(kv>0&&eh){Df=eh,x(Rt,V(eh));const nr=Eo,Hr=Date.now(),nu=25e3;try{ft&&(clearInterval(ft),ft=null)}catch{}ft=setInterval(()=>{if(Eo!==nr){try{clearInterval(ft)}catch{}ft=null;return}if(Date.now()-Hr>nu){try{clearInterval(ft)}catch{}ft=null;return}if(i(ri))return;let Sd=0;for(const Rf of Mm.values()){const Ud=A.getHistorySnapshot(Rf.sym,Rf.tf);if(Ud!=null&&Ud.error)continue;const $t=xc((Ud==null?void 0:Ud.oldestTimestampLoaded)??0),Gs=xc((Ud==null?void 0:Ud.newestTimestampLoaded)??0),Zo=au>0&&of>0&&$t>0&&Gs>0&&$t<=au&&Gs>=of;(!(Array.isArray(Ud==null?void 0:Ud.candles)&&Ud.candles.length>0)||!(Ud!=null&&Ud.isComplete)&&!Zo)&&(Sd+=1)}if(Sd<=0){try{clearInterval(ft)}catch{}ft=null,xt(S,R,"js",ae)}},400);return}}}const Bh=`js_${Date.now()}`;let kf=null;try{kf=await We({id:Bh,code:S,base:{open:ds,high:Wn,low:yo,close:Si,volume:is,time:To},params:No,mtf:jo?{baseSymbol:gi,baseTimeframe:Hc,symbolAliases:fv,sources:Jm}:void 0})}catch(wc){const xr=wc instanceof Error?wc.message:"JS engine failed";x(un,V(xr)),x(Rt,"Validation failed");return}if(!kf||kf.error){x(un,V(String((kf==null?void 0:kf.error)||"JS engine failed"))),x(Rt,"Validation failed");return}const Pm=Array.isArray(kf==null?void 0:kf.diagnostics)?kf.diagnostics:[],dm=kf.output;if(!dm||!Array.isArray(dm.panes)||!dm.panes.length){x(un,"JS script produced no plots or draws"),x(Rt,"Validation failed");return}Pe=Array.isArray(dm.panes)&&dm.panes.some(wc=>Array.isArray(wc==null?void 0:wc.runtimeHeatmaps)&&wc.runtimeHeatmaps.length),El();const pf={panes:dm.panes,params:R&&typeof R=="object"?{...R}:{},signals:dm.signals||[],strategy:dm.strategy||void 0};ae&&typeof ae=="object"&&(pf.strategy={...pf.strategy||{},...ae}),pf.__jsCode=S,pf.__jsParams=pf.params,pf.__jsSeriesMap=dm.seriesMap||{},ne="draw",await Ve(pf,"js"),x(qs,V(E(i(qs),Pm))),x(Rt,V(Df||"Plotted from JS"));return}if(ms==="pine"){const on=Fw(S);if(on.ok){try{const gs=on.spec&&typeof on.spec=="object"?on.spec.params||{}:{},No=R&&typeof R=="object"?{...gs,...R}:gs;on.spec.params=No}catch{}const an=Lf(S);je=String(((as=on.spec)==null?void 0:as.shortName)||((Cs=on.spec)==null?void 0:Cs.name)||((Ks=on.spec)==null?void 0:Ks.title)||"").trim()||""||an||void 0,ae&&typeof ae=="object"&&(on.spec.strategy={...on.spec.strategy||{},...ae}),(!on.spec.params||typeof on.spec.params!="object")&&(on.spec.params={}),je&&(on.spec.params.__scriptId=je),ne="normalize";const ds=pt(S);if(ds){x(un,`Negative history index not allowed: ${ds.snippet} (line ${ds.line})`),x(Rt,"Validation failed");return}const Wn=(on.warnings||[]).find(gs=>String((gs==null?void 0:gs.message)||"").includes('":=" used before'));if(Wn){const gs=typeof Wn.line=="number"?` (line ${Wn.line})`:"";x(un,`${String(Wn.message||'":=" used before declaration')}${gs}`),x(Rt,"Validation failed");return}if(xa(S)){x(un,"Ternary branches must both be numeric or both non-numeric"),x(Rt,"Validation failed");return}const Si=sn(S);if(Si){x(un,V(Si.message)),x(Rt,"Validation failed");return}const is=wo(S);if(is){x(un,V(is.message)),x(Rt,"Validation failed");return}const To=Y_(on.spec);if(To.ok&&To.spec)ne="draw",await Ve(To.spec,"pine"),x(Rt,"Plotted from Pine");else{const gs=(To.errors||[]).join("; ");x(un,V(gs?`Schema validation failed: ${gs}`:"Schema validation failed")),x(Rt,"Validation failed");return}}else x(un,V((on.errors||[]).slice(0,6).map(an=>`Line ${an.line}: ${an.message}`).join(" • "))),x(Rt,"Validation failed");return}if(ms==="dsl"){const on=r3(S),an={calc:[],series:on.series,panes:on.panes,signals:on.signals,params:R&&typeof R=="object"?{...on.params,...R}:on.params};je=String(an.shortName||an.name||an.title||"").trim()||void 0,ae&&typeof ae=="object"&&(an.strategy={...an.strategy||{},...ae}),ne="draw",await Ve(an,"dsl"),x(Rt,"Plotted from DSL");return}if(Ns)try{Kn=JSON.parse(ln)}catch(on){const an=String((on==null?void 0:on.message)||"Invalid JSON");x(un,`Invalid JSON: ${an}`),x(Rt,"Validation failed");return}else try{Kn=JSON.parse(ln)}catch{}if(Gn(Kn))try{const on=Kn&&typeof Kn=="object"?Kn.params||{}:{},an=Nw(Kn,on);let wn=an;try{wn=Tw(an)}catch(Wn){const yo=Wn instanceof Error?Wn.message:String(Wn);x(un,`Template expansion error: ${yo}`),x(Rt,"Validation failed");return}je=String(wn&&(wn.shortName||wn.name||wn.title)||"").trim()||void 0,ne="normalize";const ds=Y_(wn);if(ds.ok&&ds.spec)ae&&typeof ae=="object"&&(wn.strategy={...wn.strategy||{},...ae}),ne="draw",await Ve(wn,"json");else{const Wn=(ds.errors||[]).join("; ");x(un,V(Wn?`Schema validation failed: ${Wn}`:"Schema validation failed")),x(Rt,"Validation failed");return}}catch(on){const an=on instanceof Error?on.message:String(on);x(un,`Schema validation error: ${an}`),x(Rt,"Validation failed");return}else try{const on=Fw(S);if(on.ok){try{const No=on.spec&&typeof on.spec=="object"?on.spec.params||{}:{},jo=R&&typeof R=="object"?{...No,...R}:No;on.spec.params=jo}catch{}ae&&typeof ae=="object"&&(on.spec.strategy={...on.spec.strategy||{},...ae}),ne="normalize";const ds=pt(S);if(ds){x(un,`Negative history index not allowed: ${ds.snippet} (line ${ds.line})`),x(Rt,"Validation failed");return}const Wn=(on.warnings||[]).find(No=>String((No==null?void 0:No.message)||"").includes('":=" used before'));if(Wn){const No=typeof Wn.line=="number"?` (line ${Wn.line})`:"";x(un,`${String(Wn.message||'":=" used before declaration')}${No}`),x(Rt,"Validation failed");return}if(xa(S)){x(un,"Ternary branches must both be numeric or both non-numeric"),x(Rt,"Validation failed");return}const Si=sn(S);if(Si){x(un,V(Si.message)),x(Rt,"Validation failed");return}const is=wo(S);if(is){x(un,V(is.message)),x(Rt,"Validation failed");return}const To=Y_(on.spec);if(To.ok&&To.spec){ne="draw",await Ve(To.spec,"pine"),x(Rt,"Plotted from Pine");return}const gs=(To.errors||[]).join("; ");x(un,V(gs?`Schema validation failed: ${gs}`:"Schema validation failed")),x(Rt,"Validation failed");return}else{const ds=(on.errors||[]).filter(Wn=>String((Wn==null?void 0:Wn.message)||"")!=="Not a Pine script");if(ds.length){x(un,V(ds.slice(0,6).map(Wn=>`Line ${Wn.line}: ${Wn.message}`).join(" • "))),x(Rt,"Validation failed");return}}const an=r3(S),wn={calc:[],series:an.series,panes:an.panes,signals:an.signals,params:R&&typeof R=="object"?{...an.params,...R}:an.params};je=String(wn.shortName||wn.name||wn.title||"").trim()||void 0,ae&&typeof ae=="object"&&(wn.strategy={...wn.strategy||{},...ae}),ne="draw",await Ve(wn,"dsl"),x(Rt,"Plotted from DSL")}catch{const an=Oc(S),wn=o();if(!wn)throw new Error("Chart not ready yet. Please try again in a moment.");G(wn);const ds=`${Rc}_${Date.now()}`,Wn=Gu(an,ds);try{J2(Wn)}catch(jo){console.debug("Script indicator register error",jo)}const yo=i(jc)==="main"?"candle_pane":"pane_script",Si=i(jc)==="main";let is=wn.createIndicator(Wn.name,Si,{id:yo,axis:i(jc)==="sub"?{gap:{top:2,bottom:2}}:void 0});if(is||(is=wn.createIndicator(Wn,Si,{id:yo,axis:i(jc)==="sub"?{gap:{top:2,bottom:2}}:void 0})),!is)throw new Error("Unable to render script indicator.");Cu.push(is),uc.push(Wn.name),x(Fl,V(Wn.name));const To=((Tn=Wn.calc)==null?void 0:Tn.call(Wn,((Xt=(jn=o())==null?void 0:jn.getDataList)==null?void 0:Xt.call(jn))||[],{calcParams:[an.window]}))||[],gs=To.filter(jo=>jo==null?void 0:jo.topSignal).length,No=To.filter(jo=>jo==null?void 0:jo.botSignal).length;x(Rt,`Plotted (WIN=${an.window}) • ▲ ${gs} / ▼ ${No}`)}}catch(Kn){const os=Kn instanceof Error?Kn.message:"Script failed to run.";x(un,V(os)),x(Rt,null);try{G(o())}catch{}IJ({scriptId:je,format:Ee,stage:ne,message:os,stack:Kn instanceof Error?Kn.stack:void 0}),console.error("[ScriptStudio] run failed",Kn)}finally{x(ri,!1)}pe==null||pe.restore()}function Ht(){const S=o();try{G(S)}catch{}try{ya()}catch{}try{hc()}catch{}try{S==null||S.removeOverlay({groupId:"runtime"})}catch{}try{S==null||S.removeOverlay({name:"script-layer"})}catch{}qe=[];try{ft&&(clearInterval(ft),ft=null)}catch{}try{pe&&le&&pe.clearRect(0,0,le.width,le.height)}catch{}try{bc()}catch{}Pe=!1;try{El()}catch{}try{hoe()}catch{}try{Roe()}catch{}x(Rt,"Reset"),x(un,null),x(ri,!1),x(Fl,null),Qa=null,Lr=""}function qt(){typeof requestAnimationFrame>"u"||requestAnimationFrame(()=>{ul.requestKey("dock:resize",()=>{var X,ae;if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const S=fp(s().theme);An.merge(S,p0(s().styles)),o().setStyles(Xd(S)),ho();const R=(ae=(X=o()).getVisibleRange)==null?void 0:ae.call(X);R&&typeof R.to=="number"&&setTimeout(()=>{o()&&o().scrollToDataIndex(R.to,0)},30)})})}function ht(){x(Zt,!0),qt()}function dn(){x(Zt,!1),x(gn,!1),qt()}const Ut=()=>{window.removeEventListener("mousemove",rs),window.removeEventListener("touchmove",rs),window.removeEventListener("mouseup",_t),window.removeEventListener("touchend",_t)};function Xn(S){if(!i(Zt))return;const R="touches"in S?S.touches[0]:S,{clientY:X}=R;Xs=X,oo=i(qn),x(Fn,!0),window.addEventListener("mousemove",rs),window.addEventListener("touchmove",rs,{passive:!1}),window.addEventListener("mouseup",_t),window.addEventListener("touchend",_t),S.preventDefault()}function rs(S){var je;if(!i(Fn))return;const R="touches"in S?S.touches[0]:S,X=(je=i(ot))==null?void 0:je.getBoundingClientRect();if(!X)return;const ae=Xs-R.clientY,ne=oo*X.height+ae,Ee=Math.min(bn,Math.max(On,ne/X.height));x(qn,V(Ee)),qt(),S.preventDefault()}function _t(){i(Fn)&&(x(Fn,!1),Ut(),qt(),setTimeout(()=>{ul.requestKey("dock:resize-final",()=>{var X,ae;if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const S=fp(s().theme);An.merge(S,p0(s().styles)),o().setStyles(Xd(S)),ho();const R=(ae=(X=o()).getVisibleRange)==null?void 0:ae.call(X);R&&typeof R.to=="number"&&setTimeout(()=>{o()&&o().scrollToDataIndex(R.to,0)},30)})},140))}b0(()=>{if(Ut(),ft){try{clearInterval(ft)}catch{}ft=null}Z&&(Z.destroy(),Z=null,oe&&(oe.destroy(),oe=null))});function Gt(S){if(!S)return"";if(Array.isArray(S.colors)&&S.colors.length>0){const R=S.angle||S.direction||0,X=S.colors.map(ae=>`${ae.color} ${ae.position}%`).join(", ");return`linear-gradient(${R}deg, ${X})`}if(Array.isArray(S.stops)&&S.stops.length>0){const R=S.type==="radial"?"radial":"linear",X=S.direction??S.angle??0,ne=[...S.stops].sort((Ee,je)=>(Ee.position??0)-(je.position??0)).map(Ee=>{const je=(Ee.color||"").trim(),dt=Ee.position??0,At=(Ee.opacity??100)/100;if(je.startsWith("#")){const Yt=parseInt(je.slice(1,3),16),yn=parseInt(je.slice(3,5),16),Wt=parseInt(je.slice(5,7),16);return`rgba(${Yt}, ${yn}, ${Wt}, ${At}) ${dt}%`}if(je.startsWith("rgb(")||je.startsWith("rgba(")){const Yt=je.match(/rgba?\(([^)]+)\)/i);if(Yt){const yn=Yt[1].split(",").map(as=>as.trim()),[Wt,zn,Pn]=yn;return`rgba(${Wt}, ${zn}, ${Pn}, ${At}) ${dt}%`}}return`${je} ${dt}%`});return R==="radial"?`radial-gradient(circle, ${ne.join(", ")})`:`linear-gradient(${X}deg, ${ne.join(", ")})`}return""}function en(S){return Math.max(0,Math.min(1,S))}function cs(S){const R=(S||"").trim();if(!R)return null;if(/^#([0-9a-fA-F]{6})$/.test(R)){const ae=R.slice(1);return{r:parseInt(ae.slice(0,2),16),g:parseInt(ae.slice(2,4),16),b:parseInt(ae.slice(4,6),16),a:1}}if(/^#([0-9a-fA-F]{3})$/.test(R)){const ae=R.slice(1);return{r:parseInt(ae[0]+ae[0],16),g:parseInt(ae[1]+ae[1],16),b:parseInt(ae[2]+ae[2],16),a:1}}const X=R.match(/^rgba?\(([^)]+)\)$/i);if(X){const ae=X[1].split(",").map(ne=>ne.trim());if(ae.length>=3){const ne=Number(ae[0]),Ee=Number(ae[1]),je=Number(ae[2]);if(Number.isFinite(ne)&&Number.isFinite(Ee)&&Number.isFinite(je)){const dt=ae.length>=4&&Number.isFinite(Number(ae[3]))?en(Number(ae[3])):1;return{r:ne,g:Ee,b:je,a:dt}}}}return null}function ps(S){if(!S)return 1;if(typeof S.opacity=="number")return en(S.opacity/100);if(typeof S.alpha=="number"){const R=S.alpha;return en(R>1?R/100:R)}return 1}function vo(S,R,X){const ae=Math.max(0,Math.min(255,Math.round(S))).toString(16).padStart(2,"0"),ne=Math.max(0,Math.min(255,Math.round(R))).toString(16).padStart(2,"0"),Ee=Math.max(0,Math.min(255,Math.round(X))).toString(16).padStart(2,"0");return`#${ae}${ne}${Ee}`}function Ko(S){if(!S||!Array.isArray(S.stops)||!S.stops.length)return"";const R=[...S.stops].sort((Pn,as)=>(Pn.position??Pn.offset??0)-(as.position??as.offset??0)),X=R[0],ae=R[R.length-1],ne=((X==null?void 0:X.color)||"").trim(),Ee=((ae==null?void 0:ae.color)||"").trim(),je=cs(ne),dt=cs(Ee);if(!je&&!dt)return Ee||ne||"";if(!je)return Ee||"";if(!dt)return ne||"";const At=.5,Yt=Math.round(je.r*(1-At)+dt.r*At),yn=Math.round(je.g*(1-At)+dt.g*At),Wt=Math.round(je.b*(1-At)+dt.b*At),zn=ps(X)*je.a*(1-At)+ps(ae)*dt.a*At;return zn<1?`rgba(${Yt}, ${yn}, ${Wt}, ${en(zn)})`:vo(Yt,yn,Wt)}function ho(){var S,R,X,ae,ne,Ee,je,dt,At,Yt,yn,Wt;if(!si){hr=!0;try{const zn=s().styles;if(!zn)return;const Pn=fp(s().theme),as=An.get(Pn,"pane.backgroundColor")||(s().theme==="dark"?"#0A0F1A":"#ffffff"),Cs=s().theme==="dark"?"#ffffff":"#0A0F1A",Ks=zn.backgroundType||"solid",jn=document.querySelector(".duty-main"),Xt=document.querySelector(".duty-widget");let Tn="";const Kn=Ks==="gradient"&&!!zn.backgroundGradient;if(!window.__forceApplyThemeDefaults&&!window.__forceApplySavedCanvasColors&&!Kn){const Ns=cn=>{if(!cn)return"";const Gn=cn,on=(window.getComputedStyle(Gn).getPropertyValue("--chart-background-color")||"").trim(),an=(Gn.style.background||Gn.style.backgroundColor||"").trim();return on||an||""};Tn=Ns(jn)||Ns(Xt)}if(!window.__forceApplyThemeDefaults&&!window.__forceApplySavedCanvasColors&&!Kn&&Tn)[jn,Xt].forEach(Ns=>{Ns&&(Ns.style.background=Tn,Ns.style.backgroundColor=Tn,Ns.style.setProperty("--chart-background-color",Tn))}),m("🎨 Preserved live preview background:",Tn);else if(Ks==="solid"){let Ns=zn.backgroundColor||as;const cn=(zn.backgroundOpacity??100)/100,Gn=typeof zn.backgroundColor=="string"&&zn.backgroundColor.trim().toLowerCase()===Cs.toLowerCase(),ls=!!zn.backgroundType||!!zn.backgroundGradient||typeof zn.backgroundOpacity=="number";Gn&&!ls&&(Ns=as);let on=Ns;if(cn!==1&&Ns.startsWith("#")){const an=parseInt(Ns.slice(1,3),16),wn=parseInt(Ns.slice(3,5),16),ds=parseInt(Ns.slice(5,7),16);on=`rgba(${an}, ${wn}, ${ds}, ${cn})`}[jn,Xt].forEach(an=>{an&&(an.style.background=on,an.style.backgroundColor=on,an.style.setProperty("--chart-background-color",on))}),m("🎨 Applied saved background color:",on)}else if(Ks==="gradient"&&zn.backgroundGradient){const Ns=zn.backgroundGradient,cn=Ns.css||Gt(Ns);[jn,Xt].forEach(Gn=>{Gn&&(Gn.style.background=cn,Gn.style.backgroundColor=cn,Gn.style.setProperty("--chart-background-color",cn))}),m("🎨 Applied saved gradient background:",cn)}const os=zn.gridType||"solid",ln=An.get(Pn,"grid.horizontal.color")||(s().theme==="dark"?"#111B2B":"#F3F3F3"),ms=s().theme==="dark"?"#F3F3F3":"#111B2B";if(o()&&os==="solid"){const Ns=((R=(S=o()).getStyles)==null?void 0:R.call(S))??{},cn=window.__forceApplyThemeDefaults||window.__forceApplySavedCanvasColors?void 0:An.get(Ns,"grid.horizontal.color")||An.get(Ns,"grid.vertical.color"),Gn=((ae=(X=zn.grid)==null?void 0:X.horizontal)==null?void 0:ae.color)||((Ee=(ne=zn.grid)==null?void 0:ne.vertical)==null?void 0:Ee.color),ls=typeof zn.gridOpacity=="number"?zn.gridOpacity:100,on=Math.max(0,Math.min(100,ls))/100;let an=cn||Gn||ln;const wn=!cn&&typeof Gn=="string"&&Gn.trim().toLowerCase()===ms.toLowerCase(),ds=!!zn.gridType||!!zn.gridGradient||typeof zn.gridOpacity=="number";if(wn&&!ds&&(an=ln),!cn&&typeof an=="string"&&an.startsWith("#")&&on!==1){const yo=parseInt(an.slice(1,3),16),Si=parseInt(an.slice(3,5),16),is=parseInt(an.slice(5,7),16);an=`rgba(${yo}, ${Si}, ${is}, ${on})`}const Wn=An.cloneDeep(Ns);An.set(Wn,"grid.horizontal.color",an),An.set(Wn,"grid.vertical.color",an),(dt=(je=s().styles)==null?void 0:je.candle)!=null&&dt.type&&An.set(Wn,"candle.type",s().styles.candle.type),Kr?Kr(Xd(Wn)):o().setStyles(Xd(Wn)),m("🎨 Applied grid color (preserving preview when available):",an)}else if(o()&&os==="gradient"&&zn.gridGradient){const Ns=((Yt=(At=o()).getStyles)==null?void 0:Yt.call(At))??{},cn=window.__forceApplyThemeDefaults||window.__forceApplySavedCanvasColors?void 0:An.get(Ns,"grid.horizontal.color")||An.get(Ns,"grid.vertical.color"),Gn=zn.gridGradient,ls=Ko(Gn),on=cn||ls||ln,an=An.cloneDeep(Ns);An.set(an,"grid.horizontal.color",on),An.set(an,"grid.vertical.color",on),(Wt=(yn=s().styles)==null?void 0:yn.candle)!=null&&Wt.type&&An.set(an,"candle.type",s().styles.candle.type),Kr?Kr(Xd(an)):o().setStyles(Xd(an)),m("🎨 Applied gradient grid (solid fallback):",on)}}catch(zn){console.error("Error applying canvas colors:",zn)}finally{hr=!1,window.__forceApplyThemeDefaults&&(window.__forceApplyThemeDefaults=!1),window.__forceApplySavedCanvasColors&&(window.__forceApplySavedCanvasColors=!1)}}}Dc(B(),qo(a).applyCanvasColors=ho,qo(a)),vc.setApplyCanvasColorsFunction(ho),Ga.setApplyCanvasColorsFunction(ho);const wa=S=>S?!(S.__alwaysOnTop||S.__forceOnTop||S.alwaysOnTop):!0,di=(S,R)=>{var ae;if(!(S!=null&&S.getIndicators)||!(S!=null&&S.overrideIndicator))return;const X=S.getIndicators(R??{})||[];if(!(!Array.isArray(X)||!X.length))for(const ne of X){if(!ne||!wa(ne))continue;const Ee=ne.paneId??(R==null?void 0:R.paneId)??"candle_pane";if((typeof ne.zLevel=="number"?ne.zLevel:0)===g)continue;const dt={paneId:Ee,zLevel:g};ne.id?dt.id=ne.id:ne.name&&(dt.name=ne.name),(ae=S.overrideIndicator)==null||ae.call(S,dt)}};let Mi=null,Kr=null,hr=!1,sl=null;Fr(()=>{var S;if(o()&&o()!==Mi){Mi=o(),Kr=o().setStyles.bind(o());const R=o().resize.bind(o());sl=((S=o().createIndicator)==null?void 0:S.bind(o()))??null,Dc(Ie,qo(o).setStyles=function(X){const ae=Kr(X);return hr||ul.requestKey("canvas:reapply",()=>ho()),ae},qo(o)),Dc(Ie,qo(o).resize=function(){const X=R();return ul.requestKey("canvas:reapply",()=>ho()),X},qo(o)),sl&&Dc(Ie,qo(o).createIndicator=function(X,ae,ne){var Yt,yn,Wt,zn,Pn,as;const Ee=this;wd(Ee);let je=[];try{const Cs=(Yt=Ee.getPaneOptions)==null?void 0:Yt.call(Ee);Array.isArray(Cs)&&(je=Cs)}catch{}const dt=sl(X,ae,ne);if(dt)try{di(Ee,{id:dt})}catch{}let At=[];try{const Cs=(yn=Ee.getPaneOptions)==null?void 0:yn.call(Ee);Array.isArray(Cs)&&(At=Cs)}catch{return dt}try{const Cs=new Set(je.map(ms=>ms==null?void 0:ms.id).filter(Boolean)),Ks=ms=>(ms==null?void 0:ms.id)&&ms.id!=="candle_pane"&&ms.id!=="x_axis_pane",jn=je.filter(Ks),Xt=At.filter(Ks),Tn=Xt.filter(ms=>(ms==null?void 0:ms.id)&&!Cs.has(ms.id));if(Tn.length===0)return dt;const Kn=Jd(Ee),os=$u(Ee);let ln=0;if(jn.length===0){const ms=os||(typeof((Wt=Tn[0])==null?void 0:Wt.height)=="number"?Tn[0].height:0);ln=Po(ms,Kn)}else{const ms=((zn=jn.find(Ns=>typeof Ns.height=="number"&&Ns.height>0))==null?void 0:zn.height)||os;ln=Po(ms*.8,Kn)}if(ln>0){const ms=Xt.map(Ns=>Ns==null?void 0:Ns.id).filter(Boolean);Mo(Ee,ms,ln)}try{(as=(Pn=i(Ae))==null?void 0:Pn.externalEnsureCrossPaneLines)==null||as.call(Pn)}catch{}}catch{}return dt},qo(o));try{di(o())}catch{}}});let fo=`${((ug=s().period)==null?void 0:ug.timespan)||""}_${((Vv=s().period)==null?void 0:Vv.multiplier)||""}`;Fr(()=>{const S=s().period;if(!o()||!S||!S.timespan)return;const X={s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month"}[S.timespan]??"day",ae=Number(S.multiplier)||1,ne=`${X}_${ae}`;if(ne!==fo){fo=ne;try{o().setPeriod({type:X,span:ae});const Ee=fp(s().theme);An.merge(Ee,p0(s().styles)),o().setStyles(Xd(Ee))}catch{}}}),_l().then(()=>{m("📊 allSymbols length:",s().allSymbols.length)}).catch(S=>{console.error("❌ loadSymbols failed:",S)}),Th(async()=>{var Yt,yn,Wt,zn,Pn,as,Cs,Ks,jn,Xt,Tn,Kn,os,ln,ms,Ns;if(!Q){console.error("❌ chartRef is not available");return}og||(og=()=>{if(!nv("interactionV2"))return;const{endedId:cn}=bw();cn&&(x(Om,""),x(Lh,"")),cn&&Eu()},window.addEventListener("mouseup",og)),np||(np=()=>{if(!nv("interactionV2"))return;const{endedId:cn}=bw();cn&&(x(Om,""),x(Lh,"")),cn&&Eu()},window.addEventListener("touchend",np)),!Fv&&Q&&(Fv=cn=>{if(!nv("interactionV2")||cn.button!==0)return;const Gn=Fu(cn),ls=!!(Gn&&(Gn.selectedId||Gn.draggingId||Gn.resizingId));cn.__interactionV2Handled=ls,ls&&(cn.preventDefault(),cn.stopPropagation(),cn.stopImmediatePropagation())},Q.addEventListener("mousedown",Fv,{capture:!0})),!ph&&Q&&(ph=cn=>{cn.preventDefault(),cn.stopPropagation(),cn.stopImmediatePropagation(),mp(cn)},Q.addEventListener("contextmenu",ph,{capture:!0})),!mh&&Q&&(mh=cn=>{cn.preventDefault(),cn.stopPropagation(),cn.stopImmediatePropagation(),Zr(cn)},Q.addEventListener("dblclick",mh,{capture:!0})),!sg&&Q&&(sg=cn=>{cn.button!==2||!(typeof window<"u"&&window.__overlayHover)||(cn.preventDefault(),cn.stopPropagation(),cn.stopImmediatePropagation())},Q.addEventListener("mousedown",sg,{capture:!0})),_v||(_v=cn=>{if(!nv("interactionV2")||!i(Om)&&!i(Lh)||Q&&cn.target instanceof Node&&Q.contains(cn.target))return;const Gn=Q==null?void 0:Q.getBoundingClientRect();if(!Gn)return;const ls=cn.clientX-Gn.left,on=cn.clientY-Gn.top,an=Zk(cn),{hoverId:wn,draggingId:ds,resizingId:Wn,cursor:yo}=n5(ls,on,Tv,an);x(xf,V(wn??"")),x(Om,V(ds??"")),x(Lh,V(Wn??"")),Eu(yo),Dl(),cn.preventDefault(),cn.stopPropagation(),cn.stopImmediatePropagation()},window.addEventListener("mousemove",_v)),!Cg&&Q&&(Cg=cn=>{if(!nv("interactionV2")||!i(Bm))return;const Gn=cn.key;Gn!=="Escape"&&Gn!=="Delete"&&Gn!=="Backspace"&&!(Gn==="ArrowLeft"||Gn==="ArrowRight"||Gn==="ArrowUp"||Gn==="ArrowDown")||fa(cn)},Q.addEventListener("keydown",Cg,{capture:!0}));try{let cn=!1;typeof window<"u"&&(cn=!!localStorage.getItem("chart.activeSaveId")),cn&&Oa.set(!0)}catch{}(yn=(Yt=s().styles)==null?void 0:Yt.candle)!=null&&yn.type||$().update(cn=>(cn.styles=cn.styles||{},cn.styles.candle=cn.styles.candle||{},cn.styles.candle.type="candle_solid",cn.styles.candle.renko||(cn.styles.candle.renko={method:"ATR",atrLength:14,source:"close",wick:!1}),cn));const S=fp(s().theme),R=An.merge({},S,s().styles);if(m("🎨 onMount - Theme styles:",JSON.stringify(S,null,2)),m("💾 onMount - Saved styles:",JSON.stringify(s().styles,null,2)),m("🔄 onMount - Merged styles:",JSON.stringify(R,null,2)),l3(Ie,V(rP(Q,{styles:(()=>{var cn,Gn,ls,on,an,wn,ds,Wn,yo,Si,is,To,gs,No,jo,co,Vs,gi,Hc,xc,ac,tu,_c,qc;try{if((Gn=(cn=R==null?void 0:R.candle)==null?void 0:cn.tooltip)!=null&&Gn.legend){const jl=R.candle.tooltip.legend.color;R.candle.tooltip.legend.template=({current:Bl,prev:_u},cd)=>{var kf,Pm;const ql=(cd==null?void 0:cd.bar)||{},jp=((Pm=(kf=cd==null?void 0:cd.tooltip)==null?void 0:kf.legend)==null?void 0:Pm.color)??jl,Uc=(Bl==null?void 0:Bl.open)??0,Ol=(Bl==null?void 0:Bl.close)??0,of=(ql.compareRule||"current_open")==="current_open"?Uc:(_u==null?void 0:_u.close)??Ol,fv=Uc===Ol||Ol>=of?ql.upBorderColor||jp:ql.downBorderColor||jp,Df=dm=>({text:dm,color:fv});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:Df("{open}")},{title:"H",value:Df("{high}")},{title:"L",value:Df("{low}")},{title:"C",value:Df("{close}")},{title:"V",value:Df("{volume}")}]:[{title:"O",value:Df("{open}")},{title:"H",value:Df("{high}")},{title:"L",value:Df("{low}")},{title:"C",value:Df("{close}")},{title:"V",value:Df("{volume}")}]}}}catch{}try{const jl=(an=(on=(ls=S==null?void 0:S.xAxis)==null?void 0:ls.tickText)==null?void 0:on.style)==null?void 0:an.color,Bl=(Wn=(ds=(wn=S==null?void 0:S.yAxis)==null?void 0:wn.tickText)==null?void 0:ds.style)==null?void 0:Wn.color;if(jl&&((Si=(yo=R==null?void 0:R.xAxis)==null?void 0:yo.tickText)!=null&&Si.style)&&(R.xAxis.tickText.style.color=jl,(is=R==null?void 0:R.xAxis)!=null&&is.tickText)){delete R.xAxis.tickText.color,delete R.xAxis.tickText.opacity,R.xAxis.tickText.color=jl;try{$().update(ql=>(ql.styles||(ql.styles={}),An.unset(ql.styles,"xAxis.tickText.color"),An.unset(ql.styles,"xAxis.tickText.opacity"),An.set(ql.styles,"xAxis.tickText.style.color",jl),ql))}catch{}}if(Bl&&((gs=(To=R==null?void 0:R.yAxis)==null?void 0:To.tickText)!=null&&gs.style)&&(R.yAxis.tickText.style.color=Bl,(No=R==null?void 0:R.yAxis)!=null&&No.tickText)){delete R.yAxis.tickText.color,delete R.yAxis.tickText.opacity,R.yAxis.tickText.color=Bl;try{$().update(ql=>(ql.styles||(ql.styles={}),An.unset(ql.styles,"yAxis.tickText.color"),An.unset(ql.styles,"yAxis.tickText.opacity"),An.set(ql.styles,"yAxis.tickText.style.color",Bl),ql))}catch{}}const _u=(Vs=(co=(jo=S==null?void 0:S.candle)==null?void 0:jo.tooltip)==null?void 0:co.legend)==null?void 0:Vs.color,cd=(xc=(Hc=(gi=S==null?void 0:S.indicator)==null?void 0:gi.tooltip)==null?void 0:Hc.legend)==null?void 0:xc.color;if(_u&&((tu=(ac=R==null?void 0:R.candle)==null?void 0:ac.tooltip)!=null&&tu.legend)){R.candle.tooltip.legend.color=_u;try{$().update(ql=>(ql.styles||(ql.styles={}),An.set(ql.styles,"candle.tooltip.legend.color",_u),ql))}catch{}}if(cd&&((qc=(_c=R==null?void 0:R.indicator)==null?void 0:_c.tooltip)!=null&&qc.legend)){R.indicator.tooltip.legend.color=cd;try{$().update(ql=>(ql.styles||(ql.styles={}),An.set(ql.styles,"indicator.tooltip.legend.color",cd),ql))}catch{}}}catch{}try{const jl=R.crosshair??{},Bl=jl.vertical??{},_u=Bl.text??{};R.crosshair={...jl,show:jl.show??!0},R.crosshair.vertical={...Bl,show:Bl.show??!0},R.crosshair.vertical.text={..._u,show:!0}}catch{}return Xd(R)})(),decimalFold:{threshold:999,format:I},formatter:{formatDate:({timestamp:cn,template:Gn,type:ls})=>ck(s().period.timespan)(cn,Gn,ls)}}))),o()){const cn=on=>(on||"").toUpperCase(),Gn=on=>{var ds,Wn;const an=(Wn=(ds=s().allSymbols)==null?void 0:ds.find)==null?void 0:Wn.call(ds,yo=>cn(yo.ticker)===cn(on));return an!=null&&an.name?an.name:{GP:"Grameen Phone",DSEBD:"DSE Board Index",DSEX:"Dhaka Stock Exchange"}[cn(on)]||""},ls={...s().symbol,ticker:s().symbol.ticker,name:s().symbol.name||Gn(s().symbol.ticker)||s().symbol.ticker,pricePrecision:j_(s().symbol),volumePrecision:s().symbol.volumePrecision};o().setSymbol(ls);try{const on=s().period;if(on!=null&&on.timespan&&(on!=null&&on.multiplier)){const wn={second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month",year:"year",s:"second",m:"minute",h:"hour",d:"day",w:"week"}[on.timespan]??"day",ds=Number(on.multiplier)||1;o().setPeriod({type:wn,span:ds})}}catch{}}if(El(),o()){const cn=Gn=>{var Wn,yo,Si,is;const ls=typeof Gn=="object"&&Gn&&"paneId"in Gn?Gn.paneId:void 0;if(!ls)return;const on=ls.startsWith("pane_script")||qe.some(To=>To.paneId===ls),an=on?zc(ls):null,wn=(yo=(Wn=an==null?void 0:an.axis)==null?void 0:Wn.getRange)==null?void 0:yo.call(Wn),ds=(is=(Si=an==null?void 0:an.axis)==null?void 0:Si.getAutoCalcTickFlag)==null?void 0:is.call(Si);Ro.has(ls)&&Yf(ls),on&&requestAnimationFrame(()=>{var To,gs,No,jo,co,Vs;an!=null&&an.axis&&wn&&on&&((gs=(To=an.axis).setRange)==null||gs.call(To,wn),(jo=(No=an.axis).buildTicks)==null||jo.call(No,!0),ds&&((Vs=(co=an.axis).setAutoCalcTickFlag)==null||Vs.call(co,!0)))})};(zn=(Wt=o()).subscribeAction)==null||zn.call(Wt,Jg.OnPaneDrag,cn),kl=()=>{var Gn,ls;return(ls=(Gn=o())==null?void 0:Gn.unsubscribeAction)==null?void 0:ls.call(Gn,Jg.OnPaneDrag,cn)}}try{const cn=(as=(Pn=s().styles)==null?void 0:Pn.candle)==null?void 0:as.type;o()&&(cn==="renko_atr"||cn==="point_and_figure"||cn==="heikin_ashi")&&vc.switchChartType({chart:o(),newType:cn,reloadDataFn:async()=>{await na()}})}catch{}if(o()){const cn=new rJ(o()),Gn=new lJ(o()),ls=new cJ(o());pu=cn,tl=ls;const on=j8(o());hJ(on),Gn.setProjectionManager(cn),Gn.setCreationManager(ls),Gn.initialize(),vl=RB({chart:o(),persistenceKey:s().key+"_drawings",onDrawingCreated:wn=>{m("✅ Drawing created:",wn.id,"for symbol:",wn.symbolKey)},onDrawingRemoved:(wn,ds)=>{},onSymbolChanged:(wn,ds)=>{}});const an=j0(s().symbol);vl.setCurrentSymbol(an),ls.setCurrentSymbolKey(an),typeof window<"u"&&(window.overlayCreationManager=ls)}Dc(B(),qo(a).cloudIndLoaded+=1,qo(a)),r5.set(s().symbol),ww.set(s().period),await _l();try{window.__datafeed=A,window.__pipelineMetrics=()=>{var cn;return(cn=A.getPipelineMetrics)==null?void 0:cn.call(A)}}catch{}window.addEventListener("resize",Sl);let X=o();try{La=new ResizeObserver(()=>{Sl()}),Q&&La.observe(Q),i(ot)&&La.observe(i(ot)),i(gt)&&La.observe(i(gt))}catch{}const ae=()=>{mr||qe.length&&(mr=!0,ul.requestKey("script-view:redraw",()=>{var cn;mr=!1;try{(cn=o())==null||cn.updatePane(rx.Drawer)}catch{}try{kd()}catch{}}))},ne=()=>{o()&&ul.requestKey("chart:redraw",()=>{try{o().updatePane(rx.All)}catch{}})},Ee=()=>{ae(),Mu(),ne()},je=()=>{ae(),Mu(),ne()},dt=cn=>{var ds,Wn;const Gn=!cn||cn&&cn.x==null&&cn.y==null;if(!Gn&&cn&&typeof cn.x=="number"&&typeof cn.y=="number"&&(x(av,V(cn.x)),x(jm,V(cn.y)),ze.length&&$l()),!Gn||!Q)return;const ls=Q.getBoundingClientRect();if(!(i(ng)>=ls.left&&i(ng)<=ls.right&&i(im)>=ls.top&&i(im)<=ls.bottom))return;const an=i(ng)-ls.left,wn=i(im)-ls.top;try{(Wn=(ds=o())==null?void 0:ds.getChartStore)==null||Wn.call(ds).setCrosshair({x:an,y:wn,paneId:"candle_pane"},{forceInvalidate:!0})}catch{}};if(o()&&((Ks=(Cs=o()).subscribeAction)==null||Ks.call(Cs,Jg.OnZoom,Ee),(Xt=(jn=o()).subscribeAction)==null||Xt.call(jn,Jg.OnScroll,je),(Kn=(Tn=o()).subscribeAction)==null||Kn.call(Tn,Jg.OnCrosshairChange,dt),Ic=()=>{var cn,Gn;return(Gn=(cn=o())==null?void 0:cn.unsubscribeAction)==null?void 0:Gn.call(cn,Jg.OnZoom,Ee)},Pc=()=>{var cn,Gn;return(Gn=(cn=o())==null?void 0:cn.unsubscribeAction)==null?void 0:Gn.call(cn,Jg.OnScroll,je)},cl=()=>{var cn,Gn;return(Gn=(cn=o())==null?void 0:cn.unsubscribeAction)==null?void 0:Gn.call(cn,Jg.OnCrosshairChange,dt)}),setTimeout(()=>{var cn,Gn;if(X)try{const ls=((cn=X.getDataList)==null?void 0:cn.call(X))??[];Array.isArray(ls)&&ls.length>0&&x(Je,!0);const on=(Gn=X.getVisibleRange)==null?void 0:Gn.call(X);(Array.isArray(ls)&&ls.length>0&&on&&typeof on.to=="number"?on.to>=ls.length-2:!1)&&X.scrollToRealTime()}catch{}},100),to){try{to()}catch{}to=null}to=wu(X);const At=fp(s().theme);An.merge(At,p0(s().styles)),(os=o())==null||os.setStyles(Xd(At)),ho();try{const cn=()=>{var is,To,gs,No,jo,co,Vs,gi,Hc,xc,ac,tu,_c;if(!o())return;const Wn=o();let yo=[];try{yo=((is=Wn.getIndicators)==null?void 0:is.call(Wn))??[]}catch{yo=[]}const Si=Object.entries(s().saveInds||{});for(const[,qc]of Si){const jl=qc==null?void 0:qc.name;if(!jl)continue;const Bl=(qc==null?void 0:qc.pane_id)||"";if(yo.some(Uc=>Uc.name===jl&&(!Bl||Uc.paneId===Bl)))continue;let cd;if(Array.isArray(qc.styles)&&qc.styles.length>0){const Uc=Ol=>Ol==="dashed"||Ol==="dotted"?{style:wt.Dashed,dashedValue:Ol==="dotted"?[2,2]:[4,4]}:{style:wt.Solid,dashedValue:[2,2]};cd={lines:qc.styles.map(Ol=>{const au=Uc(Ol==null?void 0:Ol.lineStyle);return{color:Ol==null?void 0:Ol.color,size:(Ol==null?void 0:Ol.thickness)??1,style:au.style,dashedValue:au.dashedValue}})}}let ql;if(jl==="SMARTTREND"){const Uc=qc.superTrendGroup;if(ql=Uc?{showLabels:!!Uc.showLabels,uptrendColor:((gs=(To=Uc.styles)==null?void 0:To.uptrend)==null?void 0:gs.color)??"#00FF00",downtrendColor:((jo=(No=Uc.styles)==null?void 0:No.downtrend)==null?void 0:jo.color)??"#FF0000",uptrendThickness:((Vs=(co=Uc.styles)==null?void 0:co.uptrend)==null?void 0:Vs.thickness)??1,downtrendThickness:((Hc=(gi=Uc.styles)==null?void 0:gi.downtrend)==null?void 0:Hc.thickness)??1,uptrendLineStyle:((ac=(xc=Uc.styles)==null?void 0:xc.uptrend)==null?void 0:ac.lineStyle)??"dashed",downtrendLineStyle:((_c=(tu=Uc.styles)==null?void 0:tu.downtrend)==null?void 0:_c.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},!cd){const Ol=ql.uptrendLineStyle==="dotted"||ql.uptrendLineStyle==="dashed";cd={lines:[{color:ql.uptrendColor,size:ql.uptrendThickness,style:Ol?wt.Dashed:wt.Solid,dashedValue:ql.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}const jp=Bl==="candle_pane";try{Wn.createIndicator({name:jl,calcParams:qc==null?void 0:qc.params,styles:cd,...ql?{extendData:ql}:{}},jp,Bl?{id:Bl}:void 0)}catch(Uc){console.warn("⚠️ Failed to restore indicator:",jl,Uc)}}};let Gn=null;try{Gn=typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null}catch{}const ls=(()=>{if(typeof window>"u")return!1;try{const Wn=localStorage.getItem("chart.saves.v1")||localStorage.getItem("chart.saves.v0");if(!Wn)return!1;const yo=JSON.parse(Wn);return Array.isArray(yo)&&yo.length>0}catch{return!1}})();m(Gn?"ℹ️ Active layout detected, SaveSystem will restore indicators.":"ℹ️ No active layout, will add default indicators if needed.");async function on(Wn,yo,Si,is=1200){var gs;const To=Date.now();for(;Date.now()-To<is;){try{const No=Si?{name:yo,paneId:Si}:{name:yo},jo=((gs=Wn.getIndicators)==null?void 0:gs.call(Wn,No))??[];if(jo.length>0&&jo.some(Vs=>(Vs==null?void 0:Vs.result)&&Object.keys(Vs.result).length>0))return!0}catch{}await new Promise(No=>setTimeout(No,16))}return!1}async function an(Wn,yo){const Si=[];Si.push(on(Wn,"MACD","pane_MACD")),yo||Si.push(on(Wn,"RSI","pane_RSI")),yo&&Si.push(on(Wn,"SMARTTREND","candle_pane")),Si.push(on(Wn,"VOL","candle_pane")),await Promise.all(Si)}const wn=async Wn=>{let yo=!1;try{if(!o())return;const Si=o();m("🎨 Adding default indicators...");const is="candle_pane",To=St();if(x(mo,!0),yo=!0,To)try{Si.createIndicator({name:"SMARTTREND",calcParams:[10,3],styles:{lines:[{color:"#00FF00",size:1,style:wt.Dashed,dashedValue:[4,4]}]},extendData:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"}},!0,{id:is})&&$().update(No=>(No.saveInds[`${is}_SMARTTREND`]={name:"SMARTTREND",pane_id:is,params:[10,3]},No))}catch{}try{const gs="pane_MACD",No=[12,26,9];Si.createIndicator({name:"MACD",calcParams:No},!1,{id:gs,axis:{gap:{bottom:2}}})&&$().update(co=>(co.saveInds[`${gs}_MACD`]={name:"MACD",pane_id:gs,params:No},co))}catch{}if(!To)try{const gs="pane_RSI",No=[14];Si.createIndicator({name:"RSI",calcParams:No},!1,{id:gs,axis:{gap:{bottom:2}}})&&$().update(co=>(co.saveInds[`${gs}_RSI`]={name:"RSI",pane_id:gs,params:No},co))}catch{}try{const gs="candle_pane";Si.createIndicator({name:"VOL",calcParams:[20],styles:{lines:[]}},!0,{id:gs})&&$().update(jo=>(jo.saveInds[`${gs}_VOL`]={name:"VOL",pane_id:gs,params:[20]},jo))}catch{}m("✅ Default indicators applied",{force:Wn}),await an(Si,To)}catch(Si){console.warn("⚠️ Failed to add default indicators:",Si)}finally{yo&&x(mo,!1)}};let ds=!1;try{const Wn=(ln=performance.getEntriesByType)==null?void 0:ln.call(performance,"navigation");Wn&&Wn.length>0?ds=Wn[0].type==="reload":performance.navigation&&(ds=performance.navigation.type===1)}catch{}$().update(Wn=>(Wn.saveInds={},Wn)),Gn?(m("✅ Active saved layout will be restored by SaveSystem"),setTimeout(()=>{var Wn,yo;try{const Si=typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null,is=((yo=(Wn=o())==null?void 0:Wn.getIndicators)==null?void 0:yo.call(Wn))??[];!Si&&(!is||is.length===0)&&(m("🛟 No active layout after restore attempt; applying default indicators"),wn(!0))}catch{}},500)):ls?(m("🎨 No active layout yet; waiting before adding defaults"),setTimeout(()=>{try{(typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null)?m("ℹ️ activeSaveId appeared; skipping default indicators"):wn(!0)}catch{wn(!0)}},250)):(m("🎨 No saved layouts found, adding default indicators now"),wn(!0))}catch(cn){console.warn("⚠️ Indicator restore failed:",cn)}if(((Ns=(ms=s().styles)==null?void 0:ms.candle)==null?void 0:Ns.type)==="point_and_figure"&&o())try{o().createIndicator("PNF",!1,{id:"candle_pane"}),m("📊 Added PNF indicator for initial Point & Figure chart")}catch(cn){console.warn("Failed to add initial PNF indicator:",cn)}Dc(B(),qo(a).initDone+=1,qo(a)),L()||setTimeout(()=>{o()&&!a().loadingDuty&&na()},100),_l(),setTimeout(()=>{m("🔍 Current allSymbols:",s().allSymbols),m("🔍 allSymbols length:",s().allSymbols.length)},3e3),Q==null||Q.focus();try{typeof window<"u"&&(window.drawBarRef=i(Ae),window.sidebarHostRef=i(ve),window.predictNextCandle=()=>Xh(),window.getAutoPlayState=()=>i(Os),window.getPlaybackSpeed=()=>i(Ei),window.setPlaybackSpeed=cn=>Dp(cn),window.stopPrediction=()=>op())}catch{}Kl=cn=>{if(!yx())return;(cn.key==="F5"||(cn.metaKey||cn.ctrlKey)&&(cn.key==="r"||cn.key==="R"))&&(cn.preventDefault(),cn.stopPropagation(),x(Hi,!0))},window.addEventListener("keydown",Kl,{capture:!0}),Wl=cn=>{var Gn,ls;if(yx()){try{const on=(((Gn=s())==null?void 0:Gn.key)||"chart")+"_drawings";localStorage.removeItem(on)}catch{}try{const on=(((ls=s())==null?void 0:ls.key)||"chart")+"_overlays";localStorage.removeItem(on)}catch{}try{localStorage.removeItem("dataSpaceOverlays")}catch{}cn.preventDefault(),cn.returnValue=""}},window.addEventListener("beforeunload",Wl),setTimeout(()=>{const cn=Q==null?void 0:Q.querySelectorAll(".dutycharts-pane-separator");cn==null||cn.forEach(Gn=>{const ls=Gn;ls.style.transition="background-color 0.2s ease, transform 0.1s ease",ls.addEventListener("mouseenter",()=>{ls.style.cursor="row-resize",ls.style.transform="scaleY(1.2)"}),ls.addEventListener("mouseleave",()=>{ls.style.transform="scaleY(1)"}),ls.addEventListener("mousedown",()=>{ls.classList.add("dragging"),document.body.style.cursor="row-resize"});const on=()=>{ls.classList.remove("dragging"),document.body.style.cursor=""};document.addEventListener("mouseup",on),ls.addEventListener("touchstart",an=>{an.preventDefault(),ls.classList.add("dragging"),"vibrate"in navigator&&navigator.vibrate(10)}),ls.addEventListener("touchend",()=>{ls.classList.remove("dragging")})})},500)}),b0(()=>{op(),ba&&(clearTimeout(ba),ba=null),qi&&(cancelAnimationFrame(qi),qi=null),Kl&&window.removeEventListener("keydown",Kl,{capture:!0}),Wl&&window.removeEventListener("beforeunload",Wl);try{const S=Md}catch{}try{window.removeEventListener("resize",Sl)}catch{}if(Ic){try{Ic()}catch{}Ic=null}if(Pc){try{Pc()}catch{}Pc=null}if(cl){try{cl()}catch{}cl=null}if(og&&(window.removeEventListener("mouseup",og),og=null),np&&(window.removeEventListener("touchend",np),np=null),Fv&&Q&&(Q.removeEventListener("mousedown",Fv,{capture:!0}),Fv=null),_v&&(window.removeEventListener("mousemove",_v),_v=null),Cg&&Q&&(Q.removeEventListener("keydown",Cg,{capture:!0}),Cg=null),ph&&Q&&(Q.removeEventListener("contextmenu",ph,{capture:!0}),ph=null),mh&&Q&&(Q.removeEventListener("dblclick",mh,{capture:!0}),mh=null),sg&&Q&&(Q.removeEventListener("mousedown",sg,{capture:!0}),sg=null),kl){try{kl()}catch{}kl=null}if(La){try{La.disconnect()}catch{}La=null}if(to){try{to()}catch{}to=null}o()&&G(o())});function wu(S){let R=null,X=!1,ae=0;const ne=800;let Ee=0;const je=5;let dt=null,At=!1;const Yt={ratio:.2,minBars:4,maxBars:12,durationMs:180},yn=()=>{try{if(At)return;const Pn=S.getVisibleRange();if(!Pn||X)return;const as=S.getDataList();if(as.length===0)return;const Cs=as.length-1;hl=Pn.to>=Cs-1;const jn=Pn.to-Pn.from;dt=jn;const Xt=Math.max(5,Math.min(35,Math.floor(jn*.25))),Tn=R&&Pn.from<R.from,Kn=Pn.from<=Xt,os=!R||Math.abs(Pn.from-R.from)>1,ln=Date.now(),ms=Ee>=je?ne*3:ne,Ns=ln-ae>ms;if(Pn.from<=Math.max(1,Math.floor(Xt/2))&&Ns||Kn&&Ns){const on=as[0];m(`🚀 Infinite scroll triggered: from=${Pn.from}, threshold=${Xt}, dataLength=${as.length}, consecutive=${Ee}`),Wt(on.timestamp),ae=ln,Ee+=1,setTimeout(()=>{Ee=Math.max(0,Ee-1)},ne*1.5)}R={...Pn}}catch(Pn){console.error("❌ Error checking scroll position:",Pn)}},Wt=async Pn=>{var as,Cs,Ks,jn,Xt,Tn,Kn,os,ln,ms,Ns,cn;if(!(X||a().loadingDuty||i(sr))){X=!0,x(sr,!0),x(or,null);try{const ls=((Cs=(as=s().styles)==null?void 0:as.candle)==null?void 0:Cs.type)==="renko_atr"?Oi??Pn:Pn,on=S.getVisibleRange(),an=(on==null?void 0:on.to)!=null&&(on==null?void 0:on.from)!=null?on.to-on.from:dt,wn=(on==null?void 0:on.from)!=null?on.from<=Math.max(2,Math.floor((an??0)*.1)):!1,ds=await A.loadMoreHistoricalData(s().symbol,s().period,ls);if(ds.data.length>0){let Wn=ds.data;if(((jn=(Ks=s().styles)==null?void 0:Ks.candle)==null?void 0:jn.type)==="heikin_ashi")Wn=Pb(Wn);else if(((Tn=(Xt=s().styles)==null?void 0:Xt.candle)==null?void 0:Tn.type)==="renko_atr"){const To=((os=(Kn=s().styles)==null?void 0:Kn.candle)==null?void 0:os.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};Wn=Mb(Wn,To);try{const gs=Qc(ds.data);gs!=null&&(!Oi||gs<Oi)&&(Oi=gs)}catch{}}else if(((ms=(ln=s().styles)==null?void 0:ln.candle)==null?void 0:ms.type)==="point_and_figure"){const To=((cn=(Ns=s().styles)==null?void 0:Ns.candle)==null?void 0:cn.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};Wn=Nb(Wn,To)}const yo=S.getDataList();Wn.sort((To,gs)=>To.timestamp-gs.timestamp);const Si=new Set(yo.map(To=>To.timestamp)),is=Wn.filter(To=>!Si.has(To.timestamp));if(is.length>0){const To=yo.length>0?yo[0].timestamp:null,gs=To!=null?is.filter(No=>No.timestamp<To):is;if(gs.length>0){if(S.addData(gs,"forward",{backward:!0,forward:!0}),wn&&an!=null&&an>0){const No=S.getBarSpace().bar,jo=Math.min(gs.length,Yt.maxBars,Math.max(Yt.minBars,Math.floor(an*Yt.ratio)));jo>0&&Number.isFinite(No)&&No>0&&requestAnimationFrame(()=>{S.scrollByDistance(jo*No,Yt.durationMs)})}try{Gm()}catch{}try{yo.length+gs.length>0&&x(Je,!0)}catch{}m(`✅ Successfully loaded and prepended ${gs.length} historical bars`),x(or,null)}else m("📭 No new unique historical data to add")}else m("📭 No new unique historical data to add");ds.lays&&ds.lays.length>0&&i(Ae)&&ds.lays.forEach(To=>{i(Ae).addOverlay(To)})}else m("📭 No historical chunk available from cache at the moment"),At=!A.hasMoreServerHistory(s().symbol,s().period)}catch(Gn){console.error("❌ Error loading more historical data:",Gn),x(or,V(Gn instanceof Error?Gn.message:"Failed to load historical data")),Dt.addAlert("error",`Failed to load historical data: ${i(or)}`)}finally{X=!1,x(sr,!1)}}},zn=setInterval(yn,100);return()=>{clearInterval(zn)}}async function _l(){s().allSymbols||Dc($(),qo(s).allSymbols=[],qo(s)),m("🚀 loadSymbols function called. loadingPairs:",a().loadingPairs,"allSymbols length:",s().allSymbols.length),Dc(B(),qo(a).loadingPairs=!0,qo(a));const S=await A.getSymbols();m("📊 Symbols loaded count:",S.length),Dc($(),qo(s).allSymbols=S,qo(s));try{const X=s().symbol,ae=String((X==null?void 0:X.ticker)||"").trim().toUpperCase();if(ae){const ne=S.find(je=>String((je==null?void 0:je.ticker)||"").trim().toUpperCase()===ae),Ee=P(ne?{...ne,...X}:X);Ee&&$().update(je=>(je.symbol=Ee,je))}}catch{}const R=new Set;S.forEach(X=>{X.exchange&&R.add(X.exchange)}),$().update(X=>(R.forEach(ae=>{X.allExgs.add(ae)}),X)),Dc(B(),qo(a).loadingPairs=!1,qo(a))}async function Xl(S,R,X,ae,ne=!0,Ee=Li){var jn,Xt,Tn,Kn,os,ln,ms,Ns,cn,Gn,ls;const je=o();if(!je)return;M={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},Ee===Li&&Dc(B(),qo(a).loadingDuty=!0,qo(a));const dt=l().url.searchParams.get("strategy"),At=Bc(),Yt=await A.getHistoryDutyData({symbol:S,period:R,from:X,to:ae,strategy:dt,sessionMode:At.sessionMode,adjustMode:At.adjustMode,timezone:At.timezone});let Wt=(Yt.data||[]).slice(Math.max(0,(Yt.data||[]).length-600));if(!Wt||Wt.length===0){Ee===Li&&Dc(B(),qo(a).loadingDuty=!1,qo(a));return}const zn=((Xt=(jn=s().styles)==null?void 0:jn.candle)==null?void 0:Xt.type)||gx((Kn=(Tn=o())==null?void 0:Tn.getStyles)==null?void 0:Kn.call(Tn),s().styles),Pn=Tb(S),as=zn;if(as==="heikin_ashi")Wt=Pb(Wt);else if(as==="renko_atr"){try{const an=Qc(Yt.data);an!=null&&(!Oi||an<Oi)&&(Oi=an)}catch{}const on=((ln=(os=s().styles)==null?void 0:os.candle)==null?void 0:ln.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};Wt=Mb(Wt,on)}else if(as==="point_and_figure"){const on=((Ns=(ms=s().styles)==null?void 0:ms.candle)==null?void 0:Ns.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};Wt=Nb(Wt,on)}if(Wt=Wt.map((on,an)=>((!on.timestamp||isNaN(on.timestamp)||on.timestamp<=0)&&(console.warn(`Invalid timestamp in dutys at index ${an}:`,on.timestamp),on.timestamp=Date.now()-(Wt.length-an)*6e4),on)),Ee!==Li)return;try{let on=j_(S,Yt.data);try{const ds=Array.isArray(Yt.data)?Yt.data[Yt.data.length-1]:null,Wn=ds&&typeof ds=="object"?Number(ds.close):Array.isArray(ds)?Number(ds[4]):NaN;(Number.isFinite(Wn)&&Math.abs(Wn)>=1e4||Pn==="crypto"&&Number.isFinite(Wn)&&Math.abs(Wn)>=1e3)&&(on=2)}catch{}((Gn=(cn=je==null?void 0:je.getSymbol)==null?void 0:cn.call(je))==null?void 0:Gn.pricePrecision)!==on&&(je==null||je.setSymbol({pricePrecision:on}));const wn=S==null?void 0:S.pricePrecision;(!Number.isFinite(wn)||wn!==on)&&$().update(ds=>(ds.symbol&&ds.symbol.ticker===S.ticker&&(ds.symbol.pricePrecision=on),ds))}catch{}const Cs=as==="renko_atr",Ks=!Cs&&ne&&Wt.length>0;je.applyNewData(Wt,!!Ks);try{Gm()}catch{}try{(Wt??[]).length>0&&x(Je,!0)}catch{}try{A.startBackgroundPrefetch(S,{timeframe:R.timeframe})}catch{}if(Yt.lays&&Yt.lays.length>0&&i(Ae)&&Yt.lays.forEach(on=>{i(Ae).addOverlay(on)}),Ee===Li&&Dc(B(),qo(a).loadingDuty=!1,qo(a)),Dc(B(),qo(a).dutyLoaded+=1,qo(a)),Wt.length){const on=gp(R.timeframe)*1e3,an=new Date().getTime(),wn=Wt[Wt.length-1].timestamp+on;!Cs&&wn+on>an&&(((ls=s().options)==null?void 0:ls.enableRealtime)===!0||r().playing===!0)&&A.subscribe(S,Wn=>{var _c,qc;const yo=Wn;if(!(S.exchange==="DSEBD"?(()=>{var Uc,Ol,au;const jl=new Date,Bl=new Intl.DateTimeFormat("en-GB",{timeZone:"Asia/Dhaka",hour12:!1,weekday:"short",hour:"2-digit",minute:"2-digit"}).formatToParts(jl),_u=((Uc=Bl.find(of=>of.type==="weekday"))==null?void 0:Uc.value)??"",cd=Number(((Ol=Bl.find(of=>of.type==="hour"))==null?void 0:Ol.value)??"0"),ql=Number(((au=Bl.find(of=>of.type==="minute"))==null?void 0:au.value)??"0"),jp=cd*60+ql;return["Sun","Mon","Tue","Wed","Thu"].includes(_u)&&jp>=600&&jp<=870})():!0))return;const is=je.getDataList(),To=is[is.length-1],gs=To&&To.timestamp?[To.timestamp,To.open,To.high,To.low,To.close,To.volume??0]:null,No=FB(yo.bars,yo.secs*1e3,on,gs),jo=je.getChartStore(),co=je.getVisibleRange(),Vs=je.getDataList(),gi=co&&Vs[co.from]?Vs[co.from].timestamp:null,Hc=Vs.length-1,xc=co?co.to>=Hc-1:!0,ac=Vs&&Vs.length?Number(((_c=Vs[Vs.length-1])==null?void 0:_c.timestamp)??0):0,tu=No.map(([jl,Bl,_u,cd,ql,jp])=>({timestamp:jl,open:Bl,high:_u,low:cd,close:ql,volume:jp}));jo.addData(tu,"backward",{forward:xc,backward:!1});try{const jl=je.getDataList();Array.isArray(jl)&&jl.length>0&&x(Je,!0);const Bl=jl&&jl.length?Number(((qc=jl[jl.length-1])==null?void 0:qc.timestamp)??0):0;if(Bl>0){const _u=Bl>ac;M.active=!0,M.lastUpdateAt=Date.now(),M.lastBarTs=Bl,_u&&(M.lastNewBarIndex=jl.length-1),M.lastNewBarIndex<0&&(M.lastNewBarIndex=jl.length-1)}}catch{}!xc&&co&&gi&&requestAnimationFrame(()=>{try{const Bl=je.getDataList().findIndex(_u=>_u.timestamp===gi);Bl!==-1?je.scrollToDataIndex(Bl):je.scrollToDataIndex(co.from)}catch{}})})}}async function rc(){x(Je,!1);const S=ak(s().dateStart);let R=ak(s().dateEnd);if(!S||!R){Dt.addAlert("error","invalid time, please use: 202301011200");return}const X=gp(s().period.timeframe)*1e3;(R-S)/X>O&&(R=S+X*O),await Xl(s().symbol,s().period,S,R,!1)}const Qc=S=>{if(!Array.isArray(S)||S.length===0)return null;let R=1/0;for(const X of S){const ae=X==null?void 0:X.timestamp,ne=typeof ae=="number"?ae:Number(ae);Number.isFinite(ne)&&ne<R&&(R=ne)}return Number.isFinite(R)?R:null};async function na(S){x(Je,!1);const R=s().symbol,X=s().period;m("🔄 Loading symbol:",R.ticker,"period:",X.timeframe);const ae=new Date().getTime(),[ne,Ee]=mP(X,ae,It),je=S??Li,dt=R.ticker,At=X.timeframe;try{await Xl(R,X,ne,ae,!L(),je)}catch(Yt){console.warn("⚠️ loadSymbolPeriod failed:",Yt)}try{setTimeout(()=>{var Yt;try{if(je!==Li||dt!==s().symbol.ticker||At!==s().period.timeframe)return;const yn=o(),Wt=((Yt=yn==null?void 0:yn.getDataList)==null?void 0:Yt.call(yn))??[];if(!Array.isArray(Wt)||Wt.length===0){const zn=je;m("🔁 Retrying loadSymbolPeriod due to empty data after TF change"),Xl(R,X,ne,ae,!L(),zn)}}catch{}},250)}catch{}}_p($(),S=>S.period.timeframe).subscribe(async S=>{var X,ae,ne,Ee,je,dt,At,Yt,yn,Wt,zn;const R=((ae=(X=s().styles)==null?void 0:X.candle)==null?void 0:ae.type)==="renko_atr";try{if(!R){const Pn=`${s().period.timespan}`;if(Ua!==Pn){const as=ck(s().period.timespan),Cs=new Map,Ks=800,jn=({timestamp:Kn,template:os,type:ln})=>{const ms=`${ln}|${os}|${Kn}`,Ns=Cs.get(ms);if(Ns)return Ns;const cn=as(Kn,os,ln);return Cs.size>=Ks&&Cs.clear(),Cs.set(ms,cn),cn},Xt=o(),Tn=(ne=Xt==null?void 0:Xt.getChartStore)==null?void 0:ne.call(Xt);Tn!=null&&Tn.setFormatter&&(Tn.setFormatter({formatDate:jn}),Ua=Pn)}}}catch{}ww.set(s().period);try{const Pn=s().period,Cs={s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month"}[Pn.timespan]??"day",Ks=Number(Pn.multiplier)||1;((je=(Ee=s().styles)==null?void 0:Ee.candle)==null?void 0:je.type)!=="renko_atr"&&((dt=o())==null||dt.setPeriod({type:Cs,span:Ks}))}catch{}if(Oi=null,!(L()||!o())){if(bp()){try{A.unsubscribe()}catch{}if(M={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},to){try{to()}catch{}to=null}op(),Yv(!1);return}try{A.unsubscribe()}catch{}if(M={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},!R&&si&&(si=!1),R){Wo+=1;const Pn=Wo,as=Vr();si=!0;try{try{(At=o())==null||At.setScrollEnabled(!1),(Yt=o())==null||Yt.setZoomEnabled(!1)}catch{}try{x(Je,!1)}catch{}try{(yn=o())==null||yn.applyNewData([],!1)}catch{}try{const Cs=A;typeof Cs.stopSymbolPipelines=="function"&&Cs.stopSymbolPipelines(s().symbol.ticker)}catch{}await na(as),Li===as&&Wo===Pn&&(si=!1,ul.requestKey("renko:resize",()=>{var Cs;try{(Cs=o())==null||Cs.resize()}catch{}ho()}))}catch(Cs){console.warn("⚠️ Renko timeframe refresh failed:",Cs)}finally{try{(Wt=o())==null||Wt.setScrollEnabled(!0),(zn=o())==null||zn.setZoomEnabled(!0)}catch{}Wo===Pn&&(si=!1)}}else km(o()),vc.changeTimeframe({chart:o(),period:s().period,loadDataFn:async()=>{const Pn=Vr();try{x(Je,!1)}catch{}await na(Pn),km(o())}});if(to){try{to()}catch{}to=null}o()&&(to=wu(o()))}}),_p($(),S=>S.symbol.ticker).subscribe(S=>{var Ee,je,dt,At,Yt,yn,Wt,zn,Pn;m("📊 Current symbol:",s().symbol),m("📊 Loading state:",a().loadingDuty,"Custom load:",L()),r5.set(s().symbol);const R=vi(s().symbol);R!==s().symbol&&$().update(as=>(as.symbol=R,as));const X={...R,ticker:s().symbol.ticker,pricePrecision:j_(s().symbol),volumePrecision:s().symbol.volumePrecision};try{b3({logo:R.logo,logo2:R.logo2})}catch{}if((Ee=o())==null||Ee.setSymbol(X),Oi=null,vl){const as=j0(s().symbol);vl.setCurrentSymbol(as),vl.renderCurrentSymbolDrawings()}try{const as=tl||window.overlayCreationManager;as&&as.setCurrentSymbolKey(j0(s().symbol))}catch{}if(L())return;if(bp()){try{A.unsubscribe()}catch{}if(M={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},to){try{to()}catch{}to=null}op(),Yv(!1);return}const ae=F;F=s().symbol,ae&&ae.ticker!==s().symbol.ticker?A.unsubscribe(ae):A.unsubscribe(),M={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1};try{x(Je,!1)}catch{}try{const as=A==null?void 0:A.getHistorySnapshot;if(o()&&typeof as=="function"){const Cs=as(s().symbol,s().period.timeframe),Ks=Cs==null?void 0:Cs.candles;if(Array.isArray(Ks)&&Ks.length>0){let Xt=Ks.slice(Math.max(0,Ks.length-600));const Tn=((dt=(je=s().styles)==null?void 0:je.candle)==null?void 0:dt.type)||gx((Yt=(At=o())==null?void 0:At.getStyles)==null?void 0:Yt.call(At),s().styles);if(Tn==="heikin_ashi")Xt=Pb(Xt);else if(Tn==="renko_atr"){try{const os=Qc(Ks);os!=null&&(!Oi||os<Oi)&&(Oi=os)}catch{}const Kn=((Wt=(yn=s().styles)==null?void 0:yn.candle)==null?void 0:Wt.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};Xt=Mb(Xt,Kn)}else if(Tn==="point_and_figure"){const Kn=((Pn=(zn=s().styles)==null?void 0:zn.candle)==null?void 0:Pn.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};Xt=Nb(Xt,Kn)}o().applyNewData(Xt,!1),x(Je,!0)}}}catch{}if(to){try{to()}catch{}to=null}o()&&(to=wu(o()));const ne=Vr();na(ne)}),Fr(()=>{if(!bp()){Ad&&(Ad=!1,bv());return}Ad=!0;const R=Number(r().replayFrom),X=Number(r().replayTo);if(!Number.isFinite(R)||!Number.isFinite(X))return;const ae=`${s().symbol.ticker}|${s().period.timeframe}|${R}|${X}`;ae!==tc&&(tc=ae,Yv(!1),uv(R,X))}),Fr(()=>{const S=r().mode;gc!=="none"&&S==="none"&&(op(),Zh()),gc=S});const Nd=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"],In=[...Nd,"SMARTTREND"];function St(){var R;const S=(R=c())==null?void 0:R.data;return(S==null?void 0:S.isPremium)===!0||(S==null?void 0:S.isTrial)===!0}function Rn(S){var Yt,yn,Wt,zn,Pn,as,Cs,Ks,jn,Xt,Tn,Kn,os;if(!o())return;const R=o(),X=S==null?void 0:S.name;if(!X)return;const ae=(S==null?void 0:S.pane_id)||"";let ne=[];try{ne=((Yt=R.getIndicators)==null?void 0:Yt.call(R))??[]}catch{ne=[]}if(ne.some(ln=>ln.name===X&&(!ae||ln.paneId===ae)))return;let je;if(Array.isArray(S.styles)&&S.styles.length>0){const ln=ms=>ms==="dashed"||ms==="dotted"?{style:wt.Dashed,dashedValue:ms==="dotted"?[2,2]:[4,4]}:{style:wt.Solid,dashedValue:[2,2]};je={lines:S.styles.map(ms=>{const Ns=ln(ms==null?void 0:ms.lineStyle);return{color:ms==null?void 0:ms.color,size:(ms==null?void 0:ms.thickness)??1,style:Ns.style,dashedValue:Ns.dashedValue}})}}let dt;if(X==="SMARTTREND"){const ln=S.superTrendGroup;if(dt=ln?{showLabels:!!ln.showLabels,uptrendColor:((Wt=(yn=ln.styles)==null?void 0:yn.uptrend)==null?void 0:Wt.color)??"#00FF00",downtrendColor:((Pn=(zn=ln.styles)==null?void 0:zn.downtrend)==null?void 0:Pn.color)??"#FF0000",uptrendThickness:((Cs=(as=ln.styles)==null?void 0:as.uptrend)==null?void 0:Cs.thickness)??1,downtrendThickness:((jn=(Ks=ln.styles)==null?void 0:Ks.downtrend)==null?void 0:jn.thickness)??1,uptrendLineStyle:((Tn=(Xt=ln.styles)==null?void 0:Xt.uptrend)==null?void 0:Tn.lineStyle)??"dashed",downtrendLineStyle:((os=(Kn=ln.styles)==null?void 0:Kn.downtrend)==null?void 0:os.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},!je){const ms=dt.uptrendLineStyle==="dotted"||dt.uptrendLineStyle==="dashed";je={lines:[{color:dt.uptrendColor,size:dt.uptrendThickness,style:ms?wt.Dashed:wt.Solid,dashedValue:dt.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}const At=ae==="candle_pane";R.createIndicator({name:X,calcParams:S==null?void 0:S.params,styles:je,...dt?{extendData:dt}:{}},At,ae?{id:ae}:void 0)}function Cn(){var R;if(!o()||St())return;const S=o();try{const X=((R=S.getIndicators)==null?void 0:R.call(S))??[];for(const ae of X)if(ae.name&&Nd.includes(ae.name))try{S.removeIndicator({paneId:ae.paneId||"candle_pane",name:ae.name}),m(`✅ Removed AI indicator: ${ae.name} from pane: ${ae.paneId}`)}catch(ne){console.warn(`⚠️ Failed to remove indicator ${ae.name}:`,ne)}}catch(X){console.error("❌ Error removing AI indicators:",X)}}function Ts(){var R;if(!o()||St())return;const S=o();try{const X=((R=S.getIndicators)==null?void 0:R.call(S))??[];for(const ae of X)ae.name==="SMARTTREND"&&(S.removeIndicator({paneId:ae.paneId||"candle_pane",name:ae.name}),m(`✅ Removed Smart Trend indicator from pane: ${ae.paneId}`))}catch(X){console.error("❌ Error removing Smart Trend:",X)}}function Fs(){if(!(!o()||!St()))try{const S=Object.entries(s().saveInds||{});for(const[,R]of S)!(R!=null&&R.name)||!In.includes(R.name)||Rn(R)}catch(S){console.error("❌ Error restoring premium indicators:",S)}}let Es=ge(null),Co=ge(!1);Fr(()=>{var ae;if(!o()||((ae=c())==null?void 0:ae.data)===void 0)return;const R=St();(!i(Co)||i(Es)===!0&&R===!1)&&R===!1&&setTimeout(()=>{Cn(),Ts()},1e3),i(Es)===!1&&R===!0&&setTimeout(()=>{Fs()},800),x(Es,V(R)),x(Co,!0)});const li=_p($(),S=>S.theme);let ro=s().theme;li.subscribe(S=>{var je,dt,At,Yt,yn,Wt,zn,Pn,as,Cs,Ks,jn,Xt,Tn,Kn,os,ln,ms,Ns,cn,Gn,ls,on,an,wn,ds,Wn,yo,Si,is,To,gs,No,jo,co,Vs,gi,Hc,xc,ac,tu,_c,qc,jl,Bl,_u,cd,ql,jp;if(S===ro||(ro=S,ni)||a().isApplyingManualStyles)return;S=="light"?(Dc($(),qo(s).colorLong="green",qo(s)),Dc($(),qo(s).colorShort="red",qo(s))):(Dc($(),qo(s).colorLong="green",qo(s)),Dc($(),qo(s).colorShort="rgb(255,135,8)",qo(s)));const R=fp(s().theme);m("🎨 Theme styles from getThemeStyles:",JSON.stringify(R,null,2)),m("💾 Current save.styles:",JSON.stringify(s().styles,null,2));const X=p0(s().styles),ae=(je=X==null?void 0:X.candle)==null?void 0:je.type,ne=An.merge({},R,X);m("🎨 theme axis colors:",(Yt=(At=(dt=R==null?void 0:R.xAxis)==null?void 0:dt.tickText)==null?void 0:At.style)==null?void 0:Yt.color,(zn=(Wt=(yn=R==null?void 0:R.yAxis)==null?void 0:yn.tickText)==null?void 0:Wt.style)==null?void 0:zn.color),m("💾 saved axis colors:",An.get(X,"xAxis.tickText.style.color"),An.get(X,"yAxis.tickText.style.color")),ae&&ne.candle&&(ne.candle.type=ae);try{const Uc=(Cs=(as=(Pn=R==null?void 0:R.candle)==null?void 0:Pn.tooltip)==null?void 0:as.title)==null?void 0:Cs.color;if(Uc&&((jn=(Ks=ne==null?void 0:ne.candle)==null?void 0:Ks.tooltip)!=null&&jn.title)){ne.candle.tooltip.title.color=Uc;try{$().update(Ol=>(Ol.styles||(Ol.styles={}),An.set(Ol.styles,"candle.tooltip.title.color",Uc),Ol))}catch{}}}catch{}try{const Uc=(Kn=(Tn=(Xt=R==null?void 0:R.candle)==null?void 0:Xt.tooltip)==null?void 0:Tn.legend)==null?void 0:Kn.color,Ol=(ms=(ln=(os=R==null?void 0:R.indicator)==null?void 0:os.tooltip)==null?void 0:ln.legend)==null?void 0:ms.color;if(Uc&&((cn=(Ns=ne==null?void 0:ne.candle)==null?void 0:Ns.tooltip)!=null&&cn.legend)){ne.candle.tooltip.legend.color=Uc;try{$().update(au=>(au.styles||(au.styles={}),An.set(au.styles,"candle.tooltip.legend.color",Uc),au))}catch{}}if(Ol&&((ls=(Gn=ne==null?void 0:ne.indicator)==null?void 0:Gn.tooltip)!=null&&ls.legend)){ne.indicator.tooltip.legend.color=Ol;try{$().update(au=>(au.styles||(au.styles={}),An.set(au.styles,"indicator.tooltip.legend.color",Ol),au))}catch{}}}catch{}try{const Uc=(wn=(an=(on=R==null?void 0:R.xAxis)==null?void 0:on.tickText)==null?void 0:an.style)==null?void 0:wn.color,Ol=(yo=(Wn=(ds=R==null?void 0:R.yAxis)==null?void 0:ds.tickText)==null?void 0:Wn.style)==null?void 0:yo.color;Uc&&((is=(Si=ne==null?void 0:ne.xAxis)==null?void 0:Si.tickText)!=null&&is.style)&&(ne.xAxis.tickText.style.color=Uc,(To=ne==null?void 0:ne.xAxis)!=null&&To.tickText&&(delete ne.xAxis.tickText.color,delete ne.xAxis.tickText.opacity,ne.xAxis.tickText.color=Uc)),Ol&&((No=(gs=ne==null?void 0:ne.yAxis)==null?void 0:gs.tickText)!=null&&No.style)&&(ne.yAxis.tickText.style.color=Ol,(jo=ne==null?void 0:ne.yAxis)!=null&&jo.tickText&&(delete ne.yAxis.tickText.color,delete ne.yAxis.tickText.opacity,ne.yAxis.tickText.color=Ol))}catch{}try{if((Vs=(co=ne==null?void 0:ne.candle)==null?void 0:co.tooltip)!=null&&Vs.legend){const Uc=ne.candle.tooltip.legend.color;ne.candle.tooltip.legend.template=({current:Ol,prev:au},of)=>{var xr,Qd;const Jm=(of==null?void 0:of.bar)||{},fv=((Qd=(xr=of==null?void 0:of.tooltip)==null?void 0:xr.legend)==null?void 0:Qd.color)??Uc,Df=(Ol==null?void 0:Ol.open)??0,Bh=(Ol==null?void 0:Ol.close)??0,Pm=(Jm.compareRule||"current_open")==="current_open"?Df:(au==null?void 0:au.close)??Bh,Pg=Df===Bh||Bh>=Pm?Jm.upBorderColor||fv:Jm.downBorderColor||fv,pf=xp=>({text:xp,color:Pg});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:pf("{open}")},{title:"H",value:pf("{high}")},{title:"L",value:pf("{low}")},{title:"C",value:pf("{close}")},{title:"V",value:pf("{volume}")}]:[{title:"O",value:pf("{open}")},{title:"H",value:pf("{high}")},{title:"L",value:pf("{low}")},{title:"C",value:pf("{close}")},{title:"V",value:pf("{volume}")}]}}}catch{}m("🔄 Merged styles (theme + saved):",JSON.stringify(ne,null,2)),m("🔄 merged axis colors before process:",(xc=(Hc=(gi=ne==null?void 0:ne.xAxis)==null?void 0:gi.tickText)==null?void 0:Hc.style)==null?void 0:xc.color,(_c=(tu=(ac=ne==null?void 0:ne.yAxis)==null?void 0:ac.tickText)==null?void 0:tu.style)==null?void 0:_c.color);const Ee=Xd(ne);m("✨ Final processed styles:",JSON.stringify(Ee,null,2)),m("✨ processed axis colors:",(Bl=(jl=(qc=Ee==null?void 0:Ee.xAxis)==null?void 0:qc.tickText)==null?void 0:jl.style)==null?void 0:Bl.color,(ql=(cd=(_u=Ee==null?void 0:Ee.yAxis)==null?void 0:_u.tickText)==null?void 0:cd.style)==null?void 0:ql.color),(jp=o())==null||jp.setStyles(Ee),setTimeout(()=>{ho()},100),setTimeout(()=>{var Ol,au,of;const Uc=(Ol=o())==null?void 0:Ol.getStyles();m("  - Current chart styles:",JSON.stringify(Uc,null,2)),m("  - Saved chart type in $save.styles:",(of=(au=s().styles)==null?void 0:au.candle)==null?void 0:of.type)},200)}),_p($(),S=>S.timezone).subscribe(S=>{var R;(R=o())==null||R.setTimezone(S),uk(S);try{pu==null||pu.onTimezoneChange()}catch{}});const io=_p($(),S=>{var R,X;return(X=(R=S.styles)==null?void 0:R.candle)==null?void 0:X.type});let Ji=((fg=(dg=s().styles)==null?void 0:dg.candle)==null?void 0:fg.type)||null;io.subscribe(S=>{if(a().loadingDuty||L())return;const R=o();if(!R)return;Oi=null;const X=Ji==="point_and_figure",ae=S==="point_and_figure";if(ae&&!X)try{R.createIndicator("PNF",!1,{id:"candle_pane"}),m("📊 Added PNF indicator for Point & Figure chart")}catch(ne){console.warn("Failed to add PNF indicator:",ne)}else if(!ae&&X)try{R.removeIndicator({paneId:"candle_pane",name:"PNF"}),m("📊 Removed PNF indicator (switched from P&F)");const ne=fp(s().theme),Ee=An.merge({},ne,p0(s().styles)),je=Xd(Ee);R.setStyles(je),m("🎨 Refreshed styles after P&F exit - candle colors restored")}catch(ne){console.warn("Failed to cleanup after P&F:",ne)}Ji=S||null,(S==="heikin_ashi"||S==="renko_atr"||S==="point_and_figure"||S!=="heikin_ashi"&&S!=="renko_atr"&&S!=="point_and_figure"&&R.getDataList().length>0)&&vc.switchChartType({chart:R,newType:S||"candle_solid",reloadDataFn:async()=>{await na()}})}),_p($(),S=>{var X,ae;const R=((ae=(X=S.styles)==null?void 0:X.candle)==null?void 0:ae.renko)||{};return JSON.stringify(R)}).subscribe(S=>{var X,ae;if(a().loadingDuty||L()||((ae=(X=s().styles)==null?void 0:X.candle)==null?void 0:ae.type)!=="renko_atr")return;const R=o();R&&vc.switchChartType({chart:R,newType:"renko_atr",reloadDataFn:async()=>{await na()}})}),_p($(),S=>{var X,ae;const R=((ae=(X=S.styles)==null?void 0:X.candle)==null?void 0:ae.pnf)||{};return JSON.stringify(R)}).subscribe(S=>{var X,ae;if(a().loadingDuty||L()||((ae=(X=s().styles)==null?void 0:X.candle)==null?void 0:ae.type)!=="point_and_figure")return;const R=o();R&&vc.switchChartType({chart:R,newType:"point_and_figure",reloadDataFn:async()=>{await na()}})}),_p(B(),S=>S.fireOhlcv).subscribe(async S=>{a().timeStart&&a().timeEnd?(await Xl(s().symbol,s().period,a().timeStart,a().timeEnd),Dc(B(),qo(a).timeStart=0,qo(a)),Dc(B(),qo(a).timeEnd=0,qo(a))):await rc()});function Ac(){return o()}function br(S){ni=S}function fa(S){var R;if(nv("interactionV2")){const X=S.target;if(X&&(X.closest("input, textarea, select")||X.closest("[contenteditable='true']")||X.closest(".monaco-editor")||X.closest("[role='textbox']")||X.isContentEditable))return;if(S.key==="Escape"){S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation(),NR(),x(Bm,""),x(xf,""),x(Om,""),x(Lh,""),Eu();return}if((S.key==="Delete"||S.key==="Backspace")&&i(Bm)){S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation();const ne=s_(i(Bm));$0(i(Bm),{box:ne==null?void 0:ne.box,label:ne==null?void 0:ne.label,hidden:!0}),x(Bm,""),x(xf,""),x(Om,""),x(Lh,""),Eu();return}if((S.key==="ArrowLeft"||S.key==="ArrowRight"||S.key==="ArrowUp"||S.key==="ArrowDown")&&i(Bm)){const ne=Tv.find(Yt=>Yt.id===i(Bm)&&(Yt.type==="box"||Yt.type==="label"));if(!ne)return;S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation();const Ee=S.shiftKey?5:1;let je=0,dt=0;if(S.key==="ArrowLeft"&&(je=-Ee),S.key==="ArrowRight"&&(je=Ee),S.key==="ArrowUp"||S.key==="ArrowDown"){const Yt=ne.axis,yn=Gh.y*Ee;if(Yt&&typeof Yt.toValue=="function"&&typeof Yt.toY=="function"){let Wt=NaN;if(ne.type==="box"&&ne.box){const zn=(ne.box.topValue+ne.box.bottomValue)/2;Wt=Yt.toY(zn)}else ne.type==="label"&&ne.label&&(Wt=Yt.toY(ne.label.value));if(Number.isFinite(Wt)){const zn=Yt.toValue(Wt+(S.key==="ArrowUp"?-yn:yn))-Yt.toValue(Wt);Number.isFinite(zn)&&(dt=zn)}}}const{nudgedId:At}=AR(ne,je,dt);At&&Dl();return}}(S.key==="Delete"||S.key==="Backspace")&&(S.preventDefault(),(R=i(Ae))==null||R.clickRemove())}function Dl(){o()&&ul.requestKey("interaction:redraw",()=>{try{o().updatePane(rx.Drawer)}catch{}})}function Fu(S){if(!nv("interactionV2"))return null;const R=Q==null?void 0:Q.getBoundingClientRect();if(!R)return null;const X=S.clientX-R.left,ae=S.clientY-R.top,Ee=MR(X,ae,Tv);if(x(Bm,V(Ee.selectedId??"")),x(Om,V(Ee.draggingId??"")),x(Lh,V(Ee.resizingId??"")),Ee.selectedId||x(xf,""),Q){try{Q.focus({preventScroll:!0})}catch{Q.focus()}Eu(Ee.cursor)}return Dl(),Ee}const Xr=16,cr=8,us=6,ko=1200,ur=50,Pr=g,kr=new Map,Sr=gJ;let Lu=ge(null),iu=ge(null),bd=ge(null);const Or=S=>typeof S=="number"&&Number.isFinite(S),pc=S=>{if(typeof S=="number")return Number.isFinite(S)?S:null;if(typeof S=="string"){const X=Number(S);return Number.isFinite(X)?X:null}const R=Number(S);return Number.isFinite(R)?R:null},Wc=(S,R)=>`${S}::${R}`,Od=S=>Array.isArray(S)?S:Array.isArray(S==null?void 0:S.__rows)?S.__rows:[],Zu=(S,R)=>{if(!S||typeof S.convertToPixel!="function")return null;const X=S.convertToPixel(R);if(!Or(X))return null;const ae=S.convertToPixel(R-1),ne=S.convertToPixel(R+1),Ee=[Math.abs(X-ae),Math.abs(ne-X)].filter(At=>Number.isFinite(At)),je=Ee.length?Math.max(...Ee):6,dt=Math.max(2,Math.min(14,je*.7))/2;return{x:X,half:dt}},ff=(S,R,X)=>{const ae=(S==null?void 0:S.result)||{},ne=Od(ae);if(ne.length)return ne[R]??null;const Ee=X[R],je=(Ee==null?void 0:Ee.timestamp)??(Ee==null?void 0:Ee.time)??(Ee==null?void 0:Ee.t);return je==null?null:ae[je]??ae[String(je)]??null},xd=S=>String((S==null?void 0:S.name)||(S==null?void 0:S.shortName)||"").toUpperCase()==="ZIGZAG",Wf=S=>{const R=String((S==null?void 0:S.name)||(S==null?void 0:S.shortName)||"").toUpperCase();return R==="VOL"||R==="VOLUME"},Ui=S=>{const X=Math.max(10,Math.floor(S.height*.22)),ae=S.height-1,Ee=Math.max(1,Math.floor(X*.56));return{bandBottom:ae,effectiveBandHeight:Ee}},om=(S,R,X,ae)=>{var Ee;if(!(S!=null&&S.result)||!Array.isArray(R))return 0;let ne=0;for(let je=X;je<=ae&&je<R.length;je+=1){const dt=(Ee=R[je])==null?void 0:Ee.timestamp;if(dt==null)continue;const At=S.result[dt];if(!At)continue;const Yt=pc(At.volume),yn=pc(At.ema);Or(Yt)&&(ne=Math.max(ne,Yt)),Or(yn)&&(ne=Math.max(ne,yn))}return ne},Ef=(S,R,X,ae)=>{if(!Array.isArray(S)||!S.length)return null;let ne=0;for(let Ee=R;Ee>=0&&Ee<S.length&&ne<=ae;Ee+=X,ne+=1){const je=S[Ee],dt=pc(je==null?void 0:je.zigzag);if(Or(dt))return{index:Ee,price:dt}}return null},it=(S,R)=>{if(!Array.isArray(S)||!S.length)return null;const X=S[R],ae=pc(X==null?void 0:X.zigzag);if(Or(ae))return ae;const ne=Ef(S,R,-1,800),Ee=Ef(S,R,1,800);if(!ne||!Ee||ne.index===Ee.index)return null;const je=(R-ne.index)/(Ee.index-ne.index);return ne.price+(Ee.price-ne.price)*je},gv=(S,R,X)=>{if(!Array.isArray(S)||!S.length)return[];const ae=Math.max(0,R-50),ne=Math.min(S.length-1,X+50),Ee=[];for(let je=ae;je<=ne;je+=1){const dt=S[je],At=pc(dt==null?void 0:dt.zigzag);Or(At)&&Ee.push({index:je,price:At})}return Ee},Nv=(S,R)=>{if(!S.length)return null;let X=0;for(;X<S.length-1&&R>S[X+1].index;)X+=1;const ae=S[X],ne=S[Math.min(X+1,S.length-1)];if(!ae||!ne||ae.index===ne.index)return(ae==null?void 0:ae.price)??null;if(R<ae.index||R>ne.index)return null;const Ee=(R-ae.index)/(ne.index-ae.index);return ae.price+(ne.price-ae.price)*Ee},Ep=(S,R)=>{const X=Yu();for(const[ae,ne]of Object.entries(X)){if(!ne||ae==="x_axis_pane")continue;const Ee=S>=ne.left&&S<=ne.left+ne.width,je=R>=ne.top&&R<=ne.top+ne.height;if(Ee&&je)return{paneId:ae,rect:ne}}return null},ku=(S,R)=>{var Ns,cn,Gn,ls,on,an,wn,ds,Wn,yo,Si;if(!o()||!Q)return null;const X=Q.getBoundingClientRect();if(S<0||R<0||S>X.width||R>X.height)return null;const ae=Ep(S,R);if(!ae)return null;const{paneId:ne,rect:Ee}=ae,je=o(),dt=((Ns=je.getDataList)==null?void 0:Ns.call(je))||[],At=(ls=(Gn=(cn=je.getXAxisPane)==null?void 0:cn.call(je))==null?void 0:Gn.getAxisComponent)==null?void 0:ls.call(Gn),Yt=S-Ee.left;if(!dt.length)return null;const yn=(on=je.getChartStore)==null?void 0:on.call(je),Wt=typeof(yn==null?void 0:yn.coordinateToFloatIndex)=="function"?yn.coordinateToFloatIndex(Yt):(an=At==null?void 0:At.convertFromPixel)==null?void 0:an.call(At,Yt),zn=typeof(yn==null?void 0:yn.coordinateToDataIndex)=="function"?yn.coordinateToDataIndex(Yt):null;if(!Or(Wt)&&!Or(zn))return null;let Pn=0;const as=new Set;if(Or(Wt)&&(as.add(Math.max(0,Math.min(dt.length-1,Math.round(Wt)))),as.add(Math.max(0,Math.min(dt.length-1,Math.floor(Wt)))),as.add(Math.max(0,Math.min(dt.length-1,Math.ceil(Wt))))),Or(zn)&&as.add(Math.max(0,Math.min(dt.length-1,Math.round(zn)))),At!=null&&At.convertToPixel&&as.size){let is=-1,To=Number.POSITIVE_INFINITY;for(const gs of as){const No=At.convertToPixel(gs);if(!Or(No))continue;const jo=Math.abs(Yt-No);jo<To&&(To=jo,is=gs)}is>=0?Pn=is:Pn=Math.max(0,Math.min(dt.length-1,Math.round(Number(Wt||zn))))}else Pn=Math.max(0,Math.min(dt.length-1,Math.round(Or(zn)?zn:Wt)));const Cs=zc(ne);if(!(Cs!=null&&Cs.axis))return null;const Ks=Cs.axis,jn=R-Ee.top;let Xt=null,Tn=Number.POSITIVE_INFINITY;const Kn=Zu(At,Pn),os=Kn&&Number.isFinite(Yt)?Math.abs(Yt-Kn.x)<=Kn.half+cr||Math.abs(S-(Kn.x+Ee.left))<=Kn.half+cr:!0,ln=((wn=je.getIndicators)==null?void 0:wn.call(je,{paneId:ne}))||[],ms=new Set(["line","bar","circle","rect"]);for(const is of ln){const To=is==null?void 0:is.__plotMeta,gs=Array.isArray(To==null?void 0:To.plots)?To.plots:[],No=Array.isArray(To==null?void 0:To.plotKeys)?To.plotKeys:[],jo=ff(is,Pn,dt);if(!(!jo&&!xd(is))){if(gs.length)gs.forEach((co,Vs)=>{var _c;const gi=String((co==null?void 0:co.type)||"line").toLowerCase();if(gi==="candles"||gi==="ohlc"||!Sr.has(gi)&&gi!=="line")return;const Hc=No[Vs]||(co==null?void 0:co.key);if(!Hc||String(Hc).startsWith("__"))return;const xc=pc(jo[Hc]);if(!Or(xc))return;const ac=Ks.convertToPixel(xc);if(!Or(ac))return;let tu=Math.abs(jn-ac);if(gi==="histogram"||gi==="bar"){const qc=(_c=Ks.getRange)==null?void 0:_c.call(Ks),jl=(co==null?void 0:co.baseValue)??(qc&&Number.isFinite(qc.from)?qc.from:0),Bl=Ks.convertToPixel(jl);if(Or(Bl)){const _u=Math.min(ac,Bl),cd=Math.max(ac,Bl);tu=os&&jn>=_u-1&&jn<=cd+1?0:tu}}tu>Xr+4||tu<Tn&&(Tn=tu,Xt={kind:"indicator",paneId:ne,barIndex:Pn,indicatorId:is==null?void 0:is.id,indicatorName:(is==null?void 0:is.name)||(To==null?void 0:To.legend)||"indicator",plotKey:Hc,distance:tu})});else if(Array.isArray(is==null?void 0:is.figures))for(const co of is.figures){const Vs=String((co==null?void 0:co.type)||"line").toLowerCase();if(!ms.has(Vs))continue;const gi=co==null?void 0:co.key;if(!gi)continue;const Hc=pc(jo[gi]);if(!Or(Hc))continue;const xc=Ks.convertToPixel(Hc);if(!Or(xc))continue;let ac=Math.abs(jn-xc);if(Vs==="bar"){const tu=(ds=Ks.getRange)==null?void 0:ds.call(Ks),_c=(co==null?void 0:co.baseValue)??(tu&&Number.isFinite(tu.from)?tu.from:0),qc=Ks.convertToPixel(_c);if(Or(qc)){const jl=Math.min(xc,qc),Bl=Math.max(xc,qc);ac=os&&jn>=jl-1&&jn<=Bl+1?0:ac}}ac>Xr+4||ac<Tn&&(Tn=ac,Xt={kind:"indicator",paneId:ne,barIndex:Pn,indicatorId:is==null?void 0:is.id,indicatorName:(is==null?void 0:is.name)||"indicator",plotKey:gi,distance:ac})}if(!gs.length&&(!Array.isArray(is==null?void 0:is.figures)||is.figures.length===0)){if(Wf(is)){const co=(Wn=je.getVisibleRange)==null?void 0:Wn.call(je),Vs=Number.isFinite(co==null?void 0:co.from)?co.from:Math.max(0,Pn-200),gi=Number.isFinite(co==null?void 0:co.to)?co.to:Math.min(dt.length-1,Pn+200),Hc=om(is,dt,Vs,gi);if(Hc>0){const xc=(yo=dt[Pn])==null?void 0:yo.timestamp,ac=xc!=null?(Si=is.result)==null?void 0:Si[xc]:null,tu=pc(ac==null?void 0:ac.volume);if(Or(tu)){const _c=Ui(Ee),qc=Math.min(1,tu/Hc),jl=Math.max(1,Math.floor(qc*_c.effectiveBandHeight)),Bl=_c.bandBottom-jl;os&&jn>=Bl-1&&jn<=_c.bandBottom+1&&(Tn=0,Xt={kind:"indicator",paneId:ne,barIndex:Pn,indicatorId:is==null?void 0:is.id,indicatorName:(is==null?void 0:is.name)||"VOL",plotKey:"volume",distance:0})}}}else if(xd(is)){const co=it(Array.isArray(is==null?void 0:is.result)?is.result:[],Pn);if(Or(co)){const Vs=Ks.convertToPixel(co);if(Or(Vs)){const gi=Math.abs(jn-Vs);os&&gi<=Xr+6&&gi<Tn&&(Tn=gi,Xt={kind:"indicator",paneId:ne,barIndex:Pn,indicatorId:is==null?void 0:is.id,indicatorName:(is==null?void 0:is.name)||"ZIGZAG",plotKey:"zigzag",distance:gi})}}}}}}if(ne==="candle_pane"){const is=dt[Pn],To=pc((is==null?void 0:is.open)??(is==null?void 0:is.o)??(is==null?void 0:is.price)??(is==null?void 0:is.value)),gs=pc((is==null?void 0:is.close)??(is==null?void 0:is.c)??(is==null?void 0:is.price)??(is==null?void 0:is.value)),No=pc((is==null?void 0:is.high)??(is==null?void 0:is.h)),jo=pc((is==null?void 0:is.low)??(is==null?void 0:is.l));if(Or(To)&&Or(gs)&&Or(No)&&Or(jo)&&Kn){const co=Ks.convertToPixel(Math.max(To,gs)),Vs=Ks.convertToPixel(Math.min(To,gs)),gi=Ks.convertToPixel(No),Hc=Ks.convertToPixel(jo),xc=Math.min(gi,Hc,co,Vs),ac=Math.max(gi,Hc,co,Vs);if(os&&jn>=xc-6&&jn<=ac+6){const tu=(To+gs)/2,_c=Ks.convertToPixel(tu);Or(_c)&&Math.abs(jn-_c)<Tn&&(Tn=Math.abs(jn-_c),Xt={kind:"candle",paneId:ne,barIndex:Pn,distance:Tn})}}}return Xt},Rm=()=>{var ne;if(!o()||!i(bd))return;const S=o(),R=Wc(i(bd).paneId,i(bd).id),X=kr.get(R);if(X==null)return;const ae={paneId:i(bd).paneId,zLevel:X};i(bd).id?ae.id=i(bd).id:i(bd).name&&(ae.name=i(bd).name),(ne=S.overrideIndicator)==null||ne.call(S,ae)},Wg=S=>{var Wt,zn,Pn,as,Cs;const R=(S==null?void 0:S.kind)==="indicator"?S.indicatorId:"",X=(S==null?void 0:S.kind)==="indicator"?S.indicatorName:"",ae=(S==null?void 0:S.kind)==="indicator"?S.paneId:"",ne=((Wt=i(bd))==null?void 0:Wt.id)||"",Ee=((zn=i(bd))==null?void 0:zn.paneId)||"";if(R===ne&&ae===Ee||(ne&&Rm(),x(bd,V(R?{id:R,name:X,paneId:ae}:null)),!o()||!R))return;const je=o(),dt=Wc(ae,R),Yt=(((Pn=je.getIndicators)==null?void 0:Pn.call(je,{id:R,paneId:ae}))||((as=je.getIndicators)==null?void 0:as.call(je,{name:X,paneId:ae}))||[])[0];if(!Yt)return;kr.has(dt)||kr.set(dt,Yt.zLevel);const yn={paneId:ae,zLevel:Math.max(ur,Yt.zLevel)};R?yn.id=R:X&&(yn.name=X),(Cs=je.overrideIndicator)==null||Cs.call(je,yn)},Sg=S=>{x(Lu,V(S)),Wg(S)},Av=()=>{i(bd)&&Rm(),x(bd,null),x(Lu,null)},Wp=S=>{x(iu,V(S?{kind:S.kind,paneId:S.paneId,barIndex:S.barIndex,indicatorId:S.indicatorId,indicatorName:S.indicatorName,plotKey:S.plotKey}:null))},Eu=S=>{var Ee;if(!Q)return;const R=o(),X=((Ee=R==null?void 0:R.getDrawPanes)==null?void 0:Ee.call(R))??(R==null?void 0:R._drawPanes)??[],ae=typeof window<"u"&&!!window.__overlayHover,ne=S||(i(Om)||i(Lh)?"grabbing":i(xf)||i(Lu)||ae?"pointer":null);X.forEach(je=>{var dt,At,Yt;try{(Yt=(At=(dt=je==null?void 0:je.getMainWidget)==null?void 0:dt.call(je))==null?void 0:At.setForceCursor)==null||Yt.call(At,ne)}catch{}}),Q.style.cursor=ne??""};let av=ge(0),jm=ge(0),ng=ge(0),im=ge(0),xf=ge(""),Bm=ge(""),Om=ge(""),Lh=ge(""),Gh={x:6,y:4};const fh=new Map;let Tv=[],w0=0,Cg=null,Fv=null,_v=null,ph=null,mh=null,sg=null;const hh=new Map;let og=null,np=null;const z0=()=>!1;let Ig=ge(!1),ee=ge(0),de=ge(0),He=ge(""),rt,Qt=ge(!1),Lt=ge(""),_n=0,Vn=0,Zn=null,Js=ge(V([])),$o=ge(0),Os=ge(!1),Xo=null,Ei=ge(1),ao=ge(V([])),za=ge(0),$a=ge(!1),yl=ge(!1),Cl=0,Rl="",tc="",Ad=!1,gc="none";const wd=S=>{var R;try{const X=(R=S==null?void 0:S.getPaneOptions)==null?void 0:R.call(S);if(!Array.isArray(X)||!X.some(ne=>(ne==null?void 0:ne.state)==="maximize"))return;X.forEach(ne=>{var Ee;(ne==null?void 0:ne.state)==="maximize"&&((Ee=S.setPaneOptions)==null||Ee.call(S,{id:ne.id,state:"normal"}))}),Sl()}catch{}},Xp=S=>{var ae,ne,Ee,je,dt,At;const R=((ne=(ae=S.getSize)==null?void 0:ae.call(S))==null?void 0:ne.height)??(Q==null?void 0:Q.clientHeight)??((Ee=Q==null?void 0:Q.getBoundingClientRect)==null?void 0:Ee.call(Q).height)??0;return{width:((dt=(je=S.getSize)==null?void 0:je.call(S))==null?void 0:dt.width)??(Q==null?void 0:Q.clientWidth)??((At=Q==null?void 0:Q.getBoundingClientRect)==null?void 0:At.call(Q).width)??0,height:R}},$u=S=>{const{width:R,height:X}=Xp(S);if(!X)return 0;if(Ym()){const ne=R>0&&X>0&&R>X?.3:.25;return Math.round(X*ne)}return Math.round(X*.3)},Jd=S=>{const{height:R}=Xp(S),X=R>0?Math.round(R*.06):0;return Math.max(sy,X)},Po=(S,R)=>Math.max(R,Math.round(S||0)),Mo=(S,R,X)=>{var ne;Array.from(new Set(R.filter(Boolean))).forEach(Ee=>{var dt,At,Yt,yn,Wt;const je=((dt=S.getDrawPaneById)==null?void 0:dt.call(S,Ee))??((At=S._drawPanes)==null?void 0:At.find(zn=>{var Pn;return((Pn=zn==null?void 0:zn.getId)==null?void 0:Pn.call(zn))===Ee}));if(je){try{(Yt=je.setOptions)==null||Yt.call(je,{height:X})}catch{}try{(yn=je.setOriginalBounding)==null||yn.call(je,{height:X})}catch{}try{(Wt=je.setBounding)==null||Wt.call(je,{height:X})}catch{}}});try{(ne=S.layout)==null||ne.call(S,{measureHeight:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0})}catch{}};function $i(S){var R,X;if(o())try{const ae=o(),ne=((R=ae.getPaneOptions)==null?void 0:R.call(ae,S))||null,Ee=(ne==null?void 0:ne.state)||"normal",je=Ee==="maximize"?"normal":"maximize";(X=ae.setPaneOptions)==null||X.call(ae,{id:S,state:je}),Sl(),m("🖱️ Pane double-click toggle",{paneId:S,from:Ee,to:je})}catch(ae){console.warn("⚠️ Failed to toggle pane state",S,ae)}}function Zr(S){var je;if(!o()||!Q)return;const R=o();try{if(!(((je=R.getIndicators)==null?void 0:je.call(R))??[]).some(Yt=>Yt.paneId&&Yt.paneId!=="candle_pane"))return}catch{return}const X=R._drawPanes;if(!Array.isArray(X)||X.length===0){$i("candle_pane");return}const ae=Q.getBoundingClientRect(),ne=S.clientY-ae.top;let Ee=null;for(const dt of X){if(!dt||typeof dt.getId!="function"||typeof dt.getBounding!="function")continue;const At=dt.getId();if(At==="x_axis_pane")continue;const Yt=dt.getBounding();if(!Yt||typeof Yt.height!="number")continue;const yn=typeof Yt.top=="number"?Yt.top:0,Wt=Yt.height;if(ne>=yn&&ne<=yn+Wt){Ee=At;break}}Ee||(Ee="candle_pane"),$i(Ee)}function nc(S){const R=Q==null?void 0:Q.getBoundingClientRect();if(R){x(av,S.clientX-R.left),x(jm,S.clientY-R.top);let X;if(nv("interactionV2")){const Ee=Zk(S),{hoverId:je,draggingId:dt,resizingId:At,cursor:Yt}=n5(i(av),i(jm),Tv,Ee);x(xf,V(je??"")),x(Om,V(dt??"")),x(Lh,V(At??"")),X=Yt,(dt||At)&&(S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation(),Dl())}const ae=typeof window<"u"&&!!window.__overlayHover,ne=!!(i(Om)||i(Lh)||i(xf));I5({interactionActive:ne,overlayHover:ae})?Sg(ku(i(av),i(jm))):Sg(null),Eu(X)}x(ng,V(S.clientX)),x(im,V(S.clientY)),ze.length&&$l()}function Hu(S){if(S.__interactionV2Handled)return;const R=Fu(S);if(R&&(R.selectedId||R.draggingId||R.resizingId)){S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation();return}if(S.button!==0)return;const X=Q==null?void 0:Q.getBoundingClientRect();if(!X)return;const ae=typeof window<"u"&&!!window.__overlayHover,ne=!!(i(Om)||i(Lh)||i(xf));if(!I5({interactionActive:ne,overlayHover:ae}))return;const Ee=S.clientX-X.left,je=S.clientY-X.top,dt=ku(Ee,je);Wp(dt),Dl()}function ld(){x(av,-1),x(jm,-1),x(ng,-1),x(im,-1),nv("interactionV2")&&x(xf,""),Av(),Eu(),Wd()}function mp(S){var ae;if(S.preventDefault(),Ym()&&Date.now()-i(lv)<1e3)return;const R=Q==null?void 0:Q.getBoundingClientRect(),X=(ae=i(gt))==null?void 0:ae.getBoundingClientRect();if(R&&X){const ne=S.clientX-X.left,Ee=S.clientY-X.top,je=S.clientX-R.left,dt=S.clientY-R.top,At=Ep(je,dt);x(Vm,V({x:je,y:dt,paneId:(At==null?void 0:At.paneId)||"candle_pane"}));const yn=typeof window<"u"&&!!window.__overlayHover&&typeof window<"u"?window.__overlayHoverId:null,Wt=typeof window<"u"?window.__overlayRightClickId:null,zn=typeof window<"u"?window.__overlayRightClickAt:null,Pn=Date.now(),as=Wt&&typeof zn=="number"&&Pn-zn<500,Cs=as?Wt:yn;x(ee,ne),x(de,Ee),x(He,V(xv())),as&&typeof window<"u"&&(window.__overlayRightClickId=null,window.__overlayRightClickAt=null),Um(ne,Ee,Cs??null)}}function Tc(S){var R;if(S.touches.length===1){const X=S.touches[0];x(lv,V(Date.now()));const ae=Q==null?void 0:Q.getBoundingClientRect();ae&&(x(av,X.clientX-ae.left),x(jm,X.clientY-ae.top)),x(ng,V(X.clientX)),x(im,V(X.clientY));const ne=S.target;if(i(Ig)&&ne&&(ne.closest(".modal-content")||ne.closest(".action-btn")))return;const Ee=Date.now(),je=Ee-_n;if(je<300&&je>0){if(Vn+=1,Vn===2){S.preventDefault();const dt=(R=i(gt))==null?void 0:R.getBoundingClientRect();if(ae&&dt){const At=X.clientX-dt.left,Yt=X.clientY-dt.top,yn=X.clientX-ae.left,Wt=X.clientY-ae.top,zn=Ep(yn,Wt);x(Vm,V({x:yn,y:Wt,paneId:(zn==null?void 0:zn.paneId)||"candle_pane"})),x(He,V(xv())),Um(At,Yt,null)}Vn=0;return}}else if(Vn=1,i(Ig)){S.preventDefault(),Hp(),Vn=0;return}_n=Ee,Zn&&clearTimeout(Zn),Zn=setTimeout(()=>{Vn=0},300)}}function Hp(){x(Ig,!1)}let vu=ge(!1),Qi=ge(0),zm=ge(0),sp=ge(null),ym=ge(!1),vh=ge(0),Zp=ge(0),Jp=ge(!0),bm=ge(""),Eh=ge(""),Hf=ge(""),Vm=ge(null),Wm=ge(""),Yh=ge(""),rm=ge(""),xm=ge(""),Hm=ge("");const hp=8,zd="__SMARTCHART_OVERLAY__:";let lv=ge(0);function Lv(){var S,R;try{const X=(S=s())==null?void 0:S.styles;if((X==null?void 0:X.backgroundType)==="gradient"&&X.backgroundGradient){const ae=Ko(X.backgroundGradient);if(ae)return ae}if(X!=null&&X.backgroundColor)return X.backgroundColor}catch{}{const X=document.querySelector(".duty-widget")||document.querySelector(".duty-main");if(X){const ae=window.getComputedStyle(X),ne=(ae.getPropertyValue("--chart-background-color")||"").trim();if(ne&&!/gradient/i.test(ne))return ne;const Ee=(ae.backgroundColor||"").trim();if(Ee&&Ee!=="transparent"&&Ee!=="rgba(0, 0, 0, 0)")return Ee}}return((R=s())==null?void 0:R.theme)==="dark"?"#0A0F1A":"#ffffff"}function qm(){const S=Lv(),R=jd(S);x(Wm,V(R));const ae=Jc(hu(R))>.5;x(Yh,V(ae?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.12)")),x(rm,V(ae?"rgba(255, 255, 255, 0.28)":"rgba(0, 0, 0, 0.2)")),x(xm,V(ae?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.04)"))}function gh(){const S=[`left: ${i(Qi)}px`,`top: ${i(zm)}px`];i(Wm)&&S.push(`--menu-text: ${i(Wm)}`),i(Yh)&&S.push(`--menu-btn-border: ${i(Yh)}`),i(rm)&&S.push(`--menu-btn-hover-border: ${i(rm)}`),i(xm)&&S.push(`--menu-hover-bg: ${i(xm)}`),x(Hm,V(S.join("; ")))}async function Kh(){var R,X,ae;x(bm,""),x(Eh,""),x(Hf,"");const S=!!((X=(R=i(Ae))==null?void 0:R.hasCopiedOverlay)!=null&&X.call(R));if(!((ae=navigator==null?void 0:navigator.clipboard)!=null&&ae.readText)){S&&x(bm,"overlay");return}try{const Ee=(await navigator.clipboard.readText()).trim();if(Ee&&Ee.startsWith(zd)){x(bm,"overlay"),x(Hf,V(Ee));return}if(Ee){x(bm,"text"),x(Eh,V(Ee)),x(Hf,V(Ee));return}}catch{}S&&x(bm,"overlay")}function Du(S){if(!S)return!0;const R=An.get(S,"grid.show");if(typeof R=="boolean")return R;const X=An.get(S,"grid.horizontal.show"),ae=An.get(S,"grid.vertical.show");return typeof X=="boolean"||typeof ae=="boolean"?(typeof X=="boolean"?X:!0)&&(typeof ae=="boolean"?ae:!0):!0}function $p(){var Ee,je,dt;const S=o();if(!S){$f();return}const R=((Ee=S.getStyles)==null?void 0:Ee.call(S))??{},ae=!Du(R),ne=An.cloneDeep(R);(dt=(je=s().styles)==null?void 0:je.candle)!=null&&dt.type&&An.set(ne,"candle.type",s().styles.candle.type),An.set(ne,"grid.show",ae),An.set(ne,"grid.horizontal.show",ae),An.set(ne,"grid.vertical.show",ae);try{S.setStyles(Xd(ne))}catch{S.setStyles(ne)}try{$().update(At=>(At.styles||(At.styles={}),An.set(At.styles,"grid.show",ae),An.set(At.styles,"grid.horizontal.show",ae),An.set(At.styles,"grid.vertical.show",ae),At))}catch{}x(Jp,ae),$f()}function _h(){if(!i(Ft)||!Q||!i(gt))return;const S=i(Ft).getBoundingClientRect(),R=i(gt).getBoundingClientRect(),X=Q.getBoundingClientRect(),ae=X.left-R.left,ne=X.top-R.top,Ee=ae+X.width,je=ne+X.height;let dt=i(Qi),At=i(zm);dt+S.width+hp>Ee&&(dt=Ee-S.width-hp),dt<ae+hp&&(dt=ae+hp),At+S.height+hp>je&&(At=je-S.height-hp),At<ne+hp&&(At=ne+hp),(dt!==i(Qi)||At!==i(zm))&&(x(Qi,V(Math.round(dt))),x(zm,V(Math.round(At))),gh())}function am(){requestAnimationFrame(()=>{_h()})}function Um(S,R,X){var ae,ne,Ee,je;if(x(Qi,V(Math.round(S))),x(zm,V(Math.round(R))),x(sp,V(X??null)),x(ym,!1),x(vh,0),x(Zp,0),i(sp)&&((ae=i(Ae))!=null&&ae.getOverlayLockInfo)){const dt=i(Ae).getOverlayLockInfo(i(sp));dt?x(ym,V(!!dt.manualLock)):x(sp,null)}try{const dt=o();if(dt!=null&&dt.getIndicators){const At=dt.getIndicators()||[];x(vh,V(Array.isArray(At)?At.length:0))}}catch{}try{let dt=0,At=0;if(vl&&(dt=vl.getCurrentSymbolDrawings().length),(ne=o())!=null&&ne.getOverlays){const Yt=o().getOverlays({groupId:"drawing_tools"})||[];At=Array.isArray(Yt)?Yt.length:0}x(Zp,V(Math.max(dt,At)))}catch{}try{x(Jp,V(Du((je=(Ee=o())==null?void 0:Ee.getStyles)==null?void 0:je.call(Ee))))}catch{}i(sp)?(x(bm,""),x(Eh,""),x(Hf,"")):Kh(),qm(),gh(),x(vu,!0),am()}function $f(){x(vu,!1),x(sp,null),x(ym,!1),x(vh,0),x(Zp,0),x(Jp,!0),x(bm,""),x(Eh,""),x(Hf,""),x(Vm,null),x(Wm,""),x(Yh,""),x(rm,""),x(xm,""),x(Hm,"")}function wm(){x(Zt,!i(Zt)),i(Zt)||x(gn,!1),qt()}function lm(){var R;if(!o())return;const S=o();try{(((R=S.getIndicators)==null?void 0:R.call(S))??[]).forEach(ae=>{const ne=ae.paneId||"candle_pane";try{if(ae.id){S.removeIndicator({id:ae.id,paneId:ne});return}}catch{}try{ae.name&&S.removeIndicator({name:ae.name,paneId:ne})}catch{}})}catch{}try{$().update(X=>(X.saveInds={},X)),iv()}catch{}$f()}function yh(){var S,R,X,ae;try{vl&&vl.clearCurrentSymbolDrawings()}catch{}try{const ne=((R=(S=o())==null?void 0:S.getOverlays)==null?void 0:R.call(S,{groupId:"drawing_tools"}))||[];for(const Ee of ne)try{(ae=(X=o())==null?void 0:X.removeOverlay)==null||ae.call(X,{id:Ee.id})}catch{}}catch{}$f()}function Gm(){var S;try{if(i(Ct))return;const R=o();if(!R)return;const X=R.getVisibleRange(),ae=((S=R.getDataList)==null?void 0:S.call(R))??[];if(!X||!Array.isArray(ae)||ae.length===0)return;const ne=X.to-X.from+1;x(Ze,ne),x(Xe,X.to>=ae.length-2),x(Ct,!0)}catch{}}function Vl(){var R,X,ae;const S=o();if(S)try{Gm();const ne=Q==null?void 0:Q.getBoundingClientRect(),Ee=ne?ne.width:((R=S.getSize())==null?void 0:R.width)??0,je=S.getDataList(),dt=Math.min(180,Array.isArray(je)?je.length:180),At=Math.max(1,i(Ze)??dt),Yt=S.getChartStore(),yn=Ee>0?Math.floor(Ee/At):Yt.getBarSpace().bar,Wt=Math.max(1,Math.min(50,yn));Yt.setBarSpace(Wt);const zn=((X=Yt.getInitialOffsetRightDistance)==null?void 0:X.call(Yt))??Yt.getOffsetRightDistance();Yt.setOffsetRightDistance(zn,!0),S.scrollToRealTime(),(ae=S._drawPanes)==null||ae.forEach(as=>{var Ks,jn,Xt,Tn;const Cs=(Ks=as==null?void 0:as.getAxisComponent)==null?void 0:Ks.call(as);(jn=Cs==null?void 0:Cs.forceAutoscaleInstant)==null||jn.call(Cs),(Xt=Cs==null?void 0:Cs.setAutoCalcTickFlag)==null||Xt.call(Cs,!0),(Tn=Cs==null?void 0:Cs.buildTicks)==null||Tn.call(Cs,!0)})}finally{$f()}}function km(S){var X,ae;if(!S)return;const R=typeof S.getDrawPanes=="function"&&S.getDrawPanes()||S._drawPanes||[];for(const ne of R){const Ee=(X=ne==null?void 0:ne.getAxisComponent)==null?void 0:X.call(ne);(ae=Ee==null?void 0:Ee.forceAutoscaleInstant)==null||ae.call(Ee)}}function Ym(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0}async function cm(S){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(S),m("✅ Copied using modern clipboard API"),!0}catch(R){console.warn("Modern clipboard API failed:",R)}try{const R=document.createElement("textarea");R.value=S,R.style.position="fixed",R.style.left="-999999px",R.style.top="-999999px",R.style.opacity="0",R.style.pointerEvents="none",R.setAttribute("readonly",""),document.body.appendChild(R),R.focus(),R.select(),R.setSelectionRange(0,S.length);const X=document.execCommand("copy");if(document.body.removeChild(R),X)return m("✅ Copied using fallback method"),!0}catch(R){console.error("Fallback copy method failed:",R)}try{const R=window.getSelection();if(R){const X=document.createRange(),ae=document.createElement("span");ae.textContent=S,ae.style.position="fixed",ae.style.left="-999999px",ae.style.opacity="0",document.body.appendChild(ae),X.selectNode(ae),R.removeAllRanges(),R.addRange(X);const ne=document.execCommand("copy");if(document.body.removeChild(ae),R.removeAllRanges(),ne)return m("✅ Copied using selection API fallback"),!0}}catch(R){console.error("Selection API fallback failed:",R)}return console.error("❌ All copy methods failed"),!1}function bh(){const S=o();if(!S)return console.error("Chart not initialized"),!1;try{const R=S.getDataList();if(R.length<10)return console.warn("⚠️ Need more historical data for prediction"),!1;const X=R[R.length-1],ne=gp(s().period.timeframe)*1e3;if(!qJ(X.timestamp,ne)&&i($o)===0){const as=Date.now()-X.timestamp,Cs=Math.floor(as/6e4);console.info(`ℹ️ Market appears to be open (last candle ${Cs}m ago). Prediction is most useful when market is closed.`)}const je=R,dt=HJ(je);if(!dt)return console.error("❌ Failed to generate prediction"),!1;x(Js,V([...i(Js),dt])),$C($o);const At=[...je,dt],Yt=S.getVisibleRange(),yn=Yt?Yt.to>=je.length-2:!0;S.applyNewData(At,!1);try{(At??[]).length>0&&x(Je,!0)}catch{}yn&&setTimeout(()=>{S.scrollToRealTime()},50);const Wt=je[je.length-1].close,zn=(dt.close-Wt)/Wt*100,Pn=zn>0?"📈":"📉";return m(`${Pn} Prediction #${i($o)}: ${zn>0?"+":""}${zn.toFixed(2)}% (Close: ${dt.close.toFixed(2)})`),m("✅ Prediction added:",dt),m("📊 Total predictions so far:",i($o)),!0}catch(R){return console.error("❌ Prediction error:",R),!1}}function cv(){return Math.round(2e3/i(Ei))}function ig(){if(!i(Os))return;Xo&&(clearInterval(Xo),Xo=null);const S=cv();Xo=setInterval(()=>{i(Os)&&(bp()?Jh():bh())},S),m(`⚡ Speed changed: ${i(Ei)}x (${S}ms interval)`)}function Dp(S){x(Ei,V(S)),ig()}async function yv(){if(i(Os))return;if(bp()&&!await ag()){Yv(!1);return}x(Os,!0),bp()?Jh():bh();const S=cv();Xo=setInterval(()=>{i(Os)&&(bp()?Jh():bh())},S)}function op(){x(Os,!1),Xo&&(clearInterval(Xo),Xo=null)}async function Xh(){i(Os)?op():await yv()}function Zh(){const S=o();if(!(!S||i(Js).length===0)){op();try{const R=S.getDataList(),X=new Set(i(Js).map(ne=>ne.timestamp)),ae=R.filter(ne=>!X.has(ne.timestamp));S.applyNewData(ae,!1),x(Js,V([])),x($o,0),m("🧹 Predictions cleared")}catch(R){console.error("❌ Error clearing predictions:",R)}}}const Ev=S=>{try{return new Date(S).toLocaleDateString()}catch{return String(S)}},kp=(S,R)=>`${Ev(S)} - ${Ev(R)}`;function bp(){const S=r().replayFrom,R=r().replayTo;return!!(r().replayActive&&Number.isFinite(S)&&Number.isFinite(R))}async function $v(S){let R=null;for(const X of Y)try{const ae=await A.ensureHistoryBefore(S,X.timeframe,0,1200),ne=Array.isArray(ae==null?void 0:ae.candles)?ae.candles:[];if(!ne.length)continue;const Ee=ne[ne.length-1].timestamp-ne[0].timestamp,je=ne.length;(!R||Ee>R.span||Ee===R.span&&je>R.count)&&(R={period:X,span:Ee,count:je})}catch{}return(R==null?void 0:R.period)??null}const rg=S=>{var ae,ne,Ee,je,dt,At,Yt,yn;if(!S.length)return S;let R=S.slice();const X=((ne=(ae=s().styles)==null?void 0:ae.candle)==null?void 0:ne.type)||gx((je=(Ee=o())==null?void 0:Ee.getStyles)==null?void 0:je.call(Ee),s().styles);if(X==="heikin_ashi")R=Pb(R);else if(X==="renko_atr"){try{const zn=Qc(S);zn!=null&&(!Oi||zn<Oi)&&(Oi=zn)}catch{}const Wt=((At=(dt=s().styles)==null?void 0:dt.candle)==null?void 0:At.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};R=Mb(R,Wt)}else if(X==="point_and_figure"){const Wt=((yn=(Yt=s().styles)==null?void 0:Yt.candle)==null?void 0:yn.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};R=Nb(R,Wt)}return R};async function Km(S){const{symbol:R,timeframe:X,available:ae}=S;if(ae){const Ee=`${R.ticker}|${X}|${ae.earliest}|${ae.latest}`;if(Ee!==Rl){Rl=Ee;const je=`Historical data not available for ${R.ticker} (${X}). Available range: ${kp(ae.earliest,ae.latest)}.
OK = continue with available data. Cancel = change timeframe.`;if(typeof window<"u"?window.confirm(je):!1){y8(ae.earliest,ae.latest);return}}}const ne=await $v(R);if(ne){$().update(Ee=>(Ee.period=ne,Ee));return}Dt.addAlert("warning",`No historical data available for ${R.ticker}. Simulator stopped.`),u6()}async function uv(S,R){const X=o();if(X&&!(!Number.isFinite(S)||!Number.isFinite(R))){x(yl,!0),x($a,!1),x(ao,V([])),x(za,0),op(),Yv(!1),Zh();try{if(to){try{to()}catch{}to=null}try{A.unsubscribe()}catch{}M={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1};const ae=Cl+=1,ne=s().symbol,Ee=s().period.timeframe,je=await A.ensureHistoryCovers(ne,Ee,S,R,3500);if(ae!==Cl)return;const dt=Array.isArray(je==null?void 0:je.candles)?je.candles.slice():[];if(!dt.length){await Km({symbol:ne,timeframe:Ee,available:null});return}dt.sort((Wt,zn)=>Wt.timestamp-zn.timestamp);const At={earliest:dt[0].timestamp,latest:dt[dt.length-1].timestamp},Yt=dt.filter(Wt=>Wt.timestamp>=S&&Wt.timestamp<=R);if(!Yt.length){await Km({symbol:ne,timeframe:Ee,available:At});return}let yn=rg(Yt);yn=yn.slice().sort((Wt,zn)=>Wt.timestamp-zn.timestamp),x(ao,V(yn)),x($a,!0),x(za,0);try{X.applyNewData([],!1),x(Je,!0)}catch{}m("✅ Replay data prepared",{symbol:ne.ticker,timeframe:Ee,bars:i(ao).length})}catch(ae){console.error("❌ Failed to prepare replay data:",ae),Dt.addAlert("error","Failed to load historical data for simulator.")}finally{x(yl,!1)}}}function Jh(){var ae;const S=o();if(!S||!i($a))return!1;if(i(za)>=i(ao).length)return op(),Yv(!1),Dt.addAlert("info","Simulation complete (last candle reached)."),!1;const R=i(ao)[i(za)];x(za,i(za)+1);const X=((ae=S.getDataList)==null?void 0:ae.call(S))??[];if(X.length)try{S.getChartStore().addData([R],"backward",{forward:!0,backward:!1})}catch{const ne=[...X,R].sort((Ee,je)=>Ee.timestamp-je.timestamp);S.applyNewData(ne,!1)}else{S.applyNewData([R],!1);try{Gm()}catch{}x(Je,!0)}try{requestAnimationFrame(()=>{var ne;(ne=S.scrollToRealTime)==null||ne.call(S)})}catch{}return i(za)>=i(ao).length&&(op(),Yv(!1),Dt.addAlert("info","Simulation complete (last candle reached).")),!0}async function ag(){if(!bp())return!1;if(i($a))return!0;if(i(yl)){const X=Date.now();for(;i(yl)&&Date.now()-X<8e3;)await new Promise(ae=>setTimeout(ae,150));return i($a)}const S=Number(r().replayFrom),R=Number(r().replayTo);return!Number.isFinite(S)||!Number.isFinite(R)?!1:(await uv(S,R),i($a))}function bv(S){if(op(),x($a,!1),x(ao,V([])),x(za,0),Rl="",tc="",!L()){const R=Vr();na(R),o()&&(to=wu(o()))}}function xv(){var R,X,ae,ne;const S=o();if(!S||i(av)===null||i(jm)===null)return"";try{const Ee=(ln,ms)=>{if(!Number.isFinite(ln)||ln===0)return`${ln}`;const Ns=ln<0?"-":"",cn=Math.abs(ln),Gn=Math.floor(Math.log10(cn))+1;let ls=cn/Math.pow(10,Gn),on=Gn;const an=Number(ls.toFixed(ms));return an>=1?(ls=an/10,on=Gn+1):ls=an,`${Ns}${ls.toFixed(ms)}e${on}`},je=ln=>{var Gn,ls;const ms=Number((ls=(Gn=S==null?void 0:S.getSymbol)==null?void 0:Gn.call(S))==null?void 0:ls.pricePrecision);let Ns=Number.isFinite(ms)?Math.max(0,Math.min(12,Math.trunc(ms))):j_(s().symbol);const cn=Tb(s().symbol);if(Number.isFinite(ln)&&Math.abs(ln)>=1e4)Ns=2;else if(cn==="crypto"&&Number.isFinite(ln)){const on=Math.abs(ln);on>=1e3?Ns=2:on>=1?Ns=Math.min(Math.max(Ns,2),4):on>=.01?Ns=Math.min(Math.max(Ns,4),8):Ns=Math.min(Math.max(Ns,6),12)}return Math.max(0,Math.min(12,Math.trunc(Ns)))},dt=ln=>{try{const ms=Tb(s().symbol);if((ms==="stock"||ms==="crypto")&&Number.isFinite(ln)){const Ns=Math.abs(ln);if(Ns>0&&Ns<1e-4)return Ee(ln,5)}}catch{}return ln.toFixed(je(ln))},At=Ep(i(av),i(jm)),Yt=(ne=(ae=(R=S.getChartStore)==null?void 0:(X=R.call(S)).getCrosshair)==null?void 0:ae.call(X))==null?void 0:ne.paneId,yn=(At==null?void 0:At.paneId)||Yt||"candle_pane",Wt=yn==="candle_pane",zn=ln=>{var ms,Ns,cn,Gn;if(!Number.isFinite(ln))return"";try{const on=(((ms=S.getIndicators)==null?void 0:ms.call(S,{paneId:yn}))||[]).reduce((ds,Wn)=>{const yo=Number(Wn==null?void 0:Wn.precision);return Number.isFinite(yo)?Math.max(ds,yo):ds},2),an=((Ns=S.getDrawPaneById)==null?void 0:Ns.call(S,yn))??((cn=S._drawPanes)==null?void 0:cn.find(ds=>{var Wn;return((Wn=ds==null?void 0:ds.getId)==null?void 0:Wn.call(ds))===yn})),wn=(Gn=an==null?void 0:an.getAxisComponent)==null?void 0:Gn.call(an);return wn!=null&&wn.displayValueToText?wn.displayValueToText(ln,on):ln.toFixed(Math.max(0,Math.min(12,on)))}catch{return ln.toFixed(2)}};if(S&&typeof S.convertFromPixel=="function")try{const ln=S.convertFromPixel([{x:i(av),y:i(jm)}],{paneId:yn,absolute:!0});if(ln&&Array.isArray(ln)&&ln[0]&&typeof ln[0].value=="number")return Wt?dt(ln[0].value):zn(ln[0].value)}catch{}if(!Wt)return"";const Pn=S.getVisibleRange(),as=S.getDataList();if(!as||as.length===0||!Pn)return"";const Cs=as.slice(Pn.from,Pn.to+1);if(Cs.length===0)return"";let Ks=1/0,jn=-1/0;Cs.forEach(ln=>{Ks=Math.min(Ks,ln.low),jn=Math.max(jn,ln.high)});const Xt=jn-Ks;if(Xt<=0)return"";const Tn=Q==null?void 0:Q.getBoundingClientRect();if(!Tn)return"";const Kn=i(jm)/Tn.height,os=jn-Kn*Xt;return dt(os)}catch{return""}}var Rp=mie();Rp.__click=[tie,a,B];var lg=y(Rp);Yo(lg,5,f,S=>S.id,(S,R)=>{RC(S,{get type(){return i(R).type},get text(){return i(R).text}})}),_(lg);var Sm=v(lg,2);tp(sJ(Sm,{get customLoad(){return L()},get mainContainer(){return i(gt)},set mainContainer(S){x(gt,V(S))},get sidebarHost(){return i(ve)},set sidebarHost(S){x(ve,V(S))},onToggleScriptStudio:wm}),S=>x(Qe,V(S)),()=>i(Qe));var Dv=v(Sm,2),$h=y(Dv),Rv=y($h),wf=y(Rv),sc=y(wf);tp(lz(sc,{}),S=>x(Ae,V(S)),()=>i(Ae)),_(wf);var ru=v(wf,2);Ue(ru,()=>!i(Je)||i(mo),S=>{var R=nie();q(S,R)});var eu=v(ru,2);eu.__keydown=fa,eu.__contextmenu=mp,eu.__mousemove=nc,eu.__mousedown=Hu,eu.__mouseup=[Uoe,Om,Lh,Eu],eu.__dblclick=Zr,eu.__touchstart=Tc,eu.__click=[Goe,Ig,Hp,vu,$f];var Dh=y(eu);tp(Dh,S=>ue=S,()=>ue);var Xm=v(Dh,2);tp(Xm,S=>le=S,()=>le);var jv=v(Xm,2);tp(jv,S=>fe=S,()=>fe),_(eu),tp(eu,S=>Q=S,()=>Q);var Bv=v(eu,2);JJ(Bv,{}),_(Rv);var ip=v(Rv,2);const um=Bt(()=>`height: ${i(Zt)?`${Math.round(i(qn)*100)}%`:"0px"};`);var dv=y(ip);dv.__mousedown=Xn,dv.__touchstart=Xn;var Zm=v(dv,2);Zm.__touchmove=[sie];var Rh=y(Zm);jC(Rh,()=>i(_o),S=>{var R=Bt(()=>i(Fl)?d()[i(Fl)]:null),X=Bt(()=>i(Fl)?h()[i(Fl)]||[]:[]);tp(Gse(S,{get code(){return i(Yn)},set code(ae){x(Yn,V(ae))},get codeVersion(){return i(_o)},get status(){return i(Rt)},get error(){return i(un)},get runtimeDiagnostics(){return i(qs)},get backtest(){return i(R)},get signalEvents(){return i(X)},get isRunning(){return i(ri)},get isOpen(){return i(Zt)},get paneTarget(){return i(jc)},get labelsEnabled(){return i(yr)},$$events:{fullpage:ae=>{var ne;x(gn,V(!!((ne=ae==null?void 0:ae.detail)!=null&&ne.enabled)))},run:ae=>{var ne,Ee,je;return xt(ae.detail.code,((ne=ae==null?void 0:ae.detail)==null?void 0:ne.params)||null,(Ee=ae==null?void 0:ae.detail)==null?void 0:Ee.lang,((je=ae==null?void 0:ae.detail)==null?void 0:je.backtest)||null)},reset:Ht,saveStatus:ae=>{var ne;return x(Rt,V(((ne=ae==null?void 0:ae.detail)==null?void 0:ne.status)||i(Rt)))},close:dn,pane:ae=>x(jc,V(ae.detail.target)),labels:ae=>x(yr,V(ae.detail.enabled)),selectTrade:ae=>{var Ee;const ne=(Ee=ae==null?void 0:ae.detail)==null?void 0:Ee.trade;ne?el(ne):ya()},focusIndex:ae=>{var dt,At;const ne=(dt=ae==null?void 0:ae.detail)==null?void 0:dt.index,Ee=(At=ae==null?void 0:ae.detail)==null?void 0:At.timestamp;let je=!1;typeof ne=="number"&&Number.isFinite(ne)&&(je=Vu(ne)),!je&&typeof Ee=="number"&&Number.isFinite(Ee)&&Iu(Ee)},focusOrder:ae=>{var Ee;const ne=(Ee=ae==null?void 0:ae.detail)==null?void 0:Ee.order;ne&&Yl(ne)},guide:()=>x(hn,!0)}}),ae=>x(xs,V(ae)),()=>i(xs))}),_(Zm),_(ip),_($h),tp($h,S=>x(ot,S),()=>i(ot));var Cm=v($h,2);tp(aW(Cm,{$$events:{"sidebar:toggle":Sl,"sidebar:resize:move":Sl,"sidebar:resize:end":Sl}}),S=>x(ve,V(S)),()=>i(ve)),_(Dv);var Ov=v(Dv,2);Ue(Ov,()=>i(sr),S=>{var R=oie();q(S,R)});var jh=v(Ov,2);coe(jh,{get show(){return i(hn)},$$events:{close:()=>x(hn,!1),insert:S=>{const R=S.detail||{};x(Yn,V(R.code)),x(_o,i(_o)+1),x(hn,!1),ht(),setTimeout(()=>{var X,ae,ne,Ee;try{R.mode?(ae=(X=i(xs))==null?void 0:X.setEditorCodeWithMode)==null||ae.call(X,i(Yn),R.mode):(Ee=(ne=i(xs))==null?void 0:ne.setEditorCode)==null||Ee.call(ne,i(Yn))}catch{}qt()},0)}}});var zv=v(jh,2);iJ(zv,{get isOpen(){return i(Ig)},set isOpen(S){x(Ig,V(S))},get x(){return i(ee)},get y(){return i(de)},get currentPrice(){return i(He)},$$events:{copy:async S=>{S.detail.price&&(await cm(S.detail.price)?(x(Lt,`Price ${S.detail.price} copied!`),rt==null||rt.showToast(),Hp()):(x(Lt,"Failed to copy price"),rt==null||rt.showToast()))},reset:Vl,close:Hp}});var wv=v(zv,2);Ue(wv,()=>i(vu),S=>{var R=pie(),X=y(R);Ue(X,()=>i(sp),ae=>{var ne=lie(),Ee=fn(ne);Ee.__click=[Koe,sp,Ae,$f];var je=v(Ee,2);je.__click=[Xoe,sp,Ae,$f];var dt=v(je,2);dt.__click=[iie,sp,Ae,ym];var At=y(dt),Yt=v(y(At));Ue(Yt,()=>i(ym),Pn=>{var as=rie();q(Pn,as)},Pn=>{var as=aie();q(Pn,as)}),_(At);var yn=v(At,2),Wt=y(yn,!0);_(yn),_(dt);var zn=v(dt,2);zn.__click=[Zoe,sp,Ae,$f],Ce(()=>tt(Wt,i(ym)?"Unlock Drawing":"Lock Drawing")),q(ae,ne)},ae=>{var ne=fie(),Ee=fn(ne);Ee.__click=Vl;var je=v(Ee,2);je.__click=async()=>{await cm(i(He))?x(Lt,`Price ${i(He)} copied!`):x(Lt,"Failed to copy price"),rt==null||rt.showToast(),$f()};var dt=v(y(je),2),At=y(dt);_(dt),_(je);var Yt=v(je,2);Ue(Yt,()=>i(bm),Xt=>{var Tn=cie();Tn.__click=[Yoe,Vm,bm,Hf,zd,Ae,Eh,$f],q(Xt,Tn)});var yn=v(Yt,2);yn.__click=$p;var Wt=v(y(yn),2),zn=y(Wt,!0);_(Wt),_(yn);var Pn=v(yn,2);Pn.__click=[Qoe,Qe,$f];var as=v(Pn,2);as.__click=[eie,wm,$f];var Cs=v(as,2);Ue(Cs,()=>i(vh)>0,Xt=>{var Tn=uie();Tn.__click=lm;var Kn=v(y(Tn),2),os=y(Kn);_(Kn),_(Tn),Ce(()=>tt(os,`Remove ${i(vh)??""} Indicator${(i(vh)===1?"":"s")??""}`)),q(Xt,Tn)});var Ks=v(Cs,2);Ue(Ks,()=>i(Zp)>0,Xt=>{var Tn=die();Tn.__click=yh;var Kn=v(y(Tn),2),os=y(Kn);_(Kn),_(Tn),Ce(()=>tt(os,`Remove ${i(Zp)??""} Drawing${(i(Zp)===1?"":"s")??""}`)),q(Xt,Tn)});var jn=v(Ks,2);jn.__click=[Joe,Qe,$f],Ce(()=>{tt(At,`Copy Price ${(i(He)?`(${i(He)})`:"")??""}`),tt(zn,i(Jp)?"Hide Grid":"Show Grid")}),q(ae,ne)}),_(R),tp(R,ae=>x(Ft,ae),()=>i(Ft)),Ce(()=>Ot(R,"style",i(Hm))),q(S,R)});var xh=v(wv,2);tp(V8(xh,{get visible(){return i(Qt)},set visible(S){x(Qt,V(S))},get message(){return i(Lt)},duration:2e3}),S=>rt=S,()=>rt);var Im=v(xh,2);$J(Im,{get show(){return i(Hi)},title:"Unsaved changes",message:"You made changes but did not save. Refresh will discard them.",$$events:{cancel:()=>{x(Hi,!1)},confirm:()=>{var S;x(Hi,!1);try{if(vl&&yx()){vl.clearPersistedStorage();try{const R=(((S=s())==null?void 0:S.key)||"chart")+"_overlays";localStorage.removeItem(R)}catch{}try{localStorage.removeItem("dataSpaceOverlays")}catch{}}}catch{}location.reload()}}});var Qh=v(Im,2);DW(Qh,{});var cg=v(Qh,2);return TJ(cg,{}),_(Rp),tp(Rp,S=>x(gt,S),()=>i(gt)),Ce(()=>{Ot(Rp,"data-theme",s().theme),wr($h,"restoring",u()),pi(ip,`${`script-dock ${i(Zt)?"open":""} ${i(gn)?"fullpage":""}`??""} svelte-1ddlfai`),Ot(ip,"style",i(um)),Ot(ip,"aria-hidden",!i(Zt)),Ot(Zm,"style",`opacity:${i(Zt)?1:0}; pointer-events:${i(Zt)?"auto":"none"}; transform: ${i(Zt)?"none":"translateY(6px)"};`)}),vd("mouseleave",eu,ld),vd("wheel",Zm,S=>S.stopPropagation()),q(n,Rp),$d({getChart:Ac,setManualStylesFlag:br})}Ip(["click","keydown","contextmenu","mousemove","mousedown","mouseup","dblclick","touchstart","touchmove"]);function kie(n,e){Ed(e,!1);const t=sm(),s=()=>wl(c3,"$page",t),o=()=>wl(l,"$save",t);console.log("📄 +page.svelte loaded");const r=$m(new b4);let a;try{const w=sessionStorage.getItem("chart.tabId");w?a=w:(a=`${Date.now()}-${Math.random().toString(36).slice(2)}`,sessionStorage.setItem("chart.tabId",a))}catch{a=`${Date.now()}-${Math.random().toString(36).slice(2)}`}const l=Gw(`chart:${a}`,new Vb);let c=id(!1),f="light";function u(w){f=w,document.documentElement.classList.toggle("dark",w==="dark"),document.documentElement.setAttribute("data-theme",w),window.dispatchEvent(new CustomEvent("themechange",{detail:{theme:w}})),console.log("🖌️ Applied theme to document:",w)}function d(){window.location.href="https://dutyai.app/chart"}let h=null;Th(()=>((async()=>{var $,L,O,Y;const w=Gj(s().url);let C=w.userId;if(w.fromUrl&&C)if(console.log("👤 User ID parameter found in URL:",C),w.persisted){console.log("✅ User ID saved to storage:",C);const ce=new URL(window.location.href);c8.forEach(Q=>ce.searchParams.delete(Q)),ce.toString()!==window.location.href&&window.history.replaceState({},"",ce.toString()),console.log("🔗 User ID parameter removed from URL")}else console.warn("⚠️ User ID could not be persisted. Keeping URL parameter for reload safety.");else C&&console.log("👤 User ID found in storage:",C);if(!C){console.warn("⚠️ No userId found in URL or localStorage. Redirecting..."),d();return}PB(!0);try{console.log("📡 Fetching user preferences for userId:",C);const ce=s().url.searchParams.get("isFree")==="true",Q=await kB(C,ce,{retries:3,baseDelayMs:350,maxDelayMs:1500,bootstrapMissing:!0});console.log("✅ User preferences fetched successfully:",Q),i5(Q)}catch(ce){console.error("❌ Failed to fetch user preferences:",ce);const Q=IB(C);console.warn("⚠️ Using fallback preferences:",Q),i5(Q)}const P=s().url.searchParams.get("theme"),I=(O=(L=($=vm(O0))==null?void 0:$.data)==null?void 0:L.theme)==null?void 0:O.toLowerCase(),A=(Y=vm(l))==null?void 0:Y.theme,M=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,F=P==="dark"||P==="light"?P:I==="dark"||I==="light"?I==="dark"?"dark":"light":A==="dark"||A==="light"?A:M?"dark":"light";l.update(ce=>(ce.theme=F,ce)),u(F),h=l.subscribe(ce=>{const Q=ce.theme==="dark"||ce.theme==="light"?ce.theme:M?"dark":"light";Q!==f&&u(Q)});const B=s().url.searchParams.get("symbol");if(B){console.log("🔗 Symbol parameter found in URL:",B);let ce=0;const Q=50,le=()=>{ce+=1;const ue=o();if(ue.allSymbols&&ue.allSymbols.length>0){const fe=ue.allSymbols.find(pe=>pe.ticker.toLowerCase()===B.toLowerCase());if(fe)console.log("✅ Found symbol from URL parameter:",fe),l.update(pe=>(pe.symbol=fe,pe));else{console.warn("⚠️ Symbol not found in available symbols:",B),console.log("📊 Available symbols:",ue.allSymbols.map(Z=>Z.ticker).join(", "));const pe=ue.allSymbols.slice(0,10).map(Z=>Z.ticker).join(", ");console.log(`💡 Try one of these symbols: ${pe}${ue.allSymbols.length>10?"...":""}`)}}else ce<Q?(console.log(`⏳ Waiting for symbols to load... (attempt ${ce}/${Q})`),setTimeout(le,100)):console.error("❌ Timeout waiting for symbols to load. Symbol parameter will be ignored.")};le()}x(c,!0)})(),()=>{h&&h()})),rv();var m=Qn(),g=fn(m);Ue(g,()=>i(c),w=>{hie(w,{ctx:r,save:l})}),q(n,m),$d()}export{kie as component};
