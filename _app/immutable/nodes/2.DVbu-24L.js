const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/editor.api.DpKcps1Q.js","../chunks/iconRegistry.BQALo55A.js","../chunks/editorContextKeys.Cdn_dJhV.js","../assets/iconRegistry.DaOXeWeJ.css","../chunks/stableEditorScroll.DHPB0mmN.js","../chunks/codeEditorWidget.B5nwRVQy.js","../assets/codeEditorWidget.Bg48Qpty.css","../chunks/preload-helper.Df2iXy6c.js","../chunks/entry._fCxnSSv.js","../chunks/toolbar.B99RUac-.js","../assets/toolbar.CglUw5ev.css","../chunks/editorBrowser.CzkYJKPy.js","../chunks/clipboardService.BTmHAzm-.js","../chunks/format.Bb1_og6G.js","../assets/editor.BcE45i8R.css","../chunks/monaco.contribution.Bf0eDI41.js","../chunks/monaco.contribution.B8wnmoa3.js","../chunks/monaco.contribution.CLgm81C9.js","../chunks/monaco.contribution.naCy6iCV.js","../chunks/suggestController.CNhpv9Eh.js","../chunks/resizable.BRTVkcIb.js","../assets/resizable.BfBUCCsp.css","../assets/suggestController.ChoziUlt.css","../chunks/parameterHints.D3SwLJfR.js","../assets/parameterHints.BBE0dURY.css","../chunks/hoverContribution.CrobZDmU.js","../assets/hoverContribution.NSOZYWNZ.css","../chunks/formatActions.BuL_rer4.js"])))=>i.map(i=>d[i]);
var j5=Object.defineProperty;var R5=Object.getPrototypeOf;var B5=Reflect.get;var wy=n=>{throw TypeError(n)};var O5=(n,e,t)=>e in n?j5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ce=(n,e,t)=>O5(n,typeof e!="symbol"?e+"":e,t),ky=(n,e,t)=>e.has(n)||wy("Cannot "+t);var Ap=(n,e,t)=>(ky(n,e,"read from private field"),t?t.call(n):e.get(n)),wh=(n,e,t)=>e.has(n)?wy("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t);var C0=(n,e,t)=>(ky(n,e,"access private method"),t);var Sy=(n,e,t)=>B5(R5(n),t,e);import{r as C1,v as z5,w as Cy,x as V5,y as __,e as Ln,a as z,z as gr,b as ze,l as qu,t as fe,s as wp,c as ya,A as sc,B as kl,n as I2,C as B_,D as M2,f as fg,E as W5,p as A2}from"../chunks/stores.D6YL5VoG.js";import{v as q5,E as H5,w as U5,F as T2,J as lm,K as a_,H as L2,Q as Oh,aB as G5,aS as Y5,aR as K5,O as P1,at as F2,as as $2,L as E2,al as Z5,P as Py,C as I1,aY as N2,I as X5,G as J5,l as y_,e as rs,aZ as Q5,a_ as ek,a$ as tk,a6 as nk,q as M1,aC as Mg,b0 as ok,b1 as sk,aK as Iy,Z as My,av as ik,ai as rk,m as J1,aL as D2,B as ak,A as x,aJ as zp,c as g,f as Dt,b2 as ai,r as f,t as Se,p as gd,ad as Jv,ae as Eg,i as s,s as u,a as hd,af as Qd,j as jv,ag as tv,ab as ae,k as vt,b3 as Ay,a2 as Rv,aI as Kc,b as mr,b4 as Lu,b5 as P0,aa as A1,b6 as Zm,y as Vg,b7 as lk,aH as Xm,a5 as ck}from"../chunks/entry._fCxnSSv.js";import{b as j2,l as Do,p as Ws,i as Te,a as N,c as xp,s as Vp}from"../chunks/runtime.DguwBUhj.js";import{i as Bv}from"../chunks/lifecycle.1hA6gKzz.js";import{s as zt,t as Fi,e as vs,i as Vs,r as Qt,h as Us,j as Jd,l as zh,f as dk,m as Ng,b as Lp,n as Ty,o as Qv,p as T1,A as uk,k as pk,q as vk}from"../chunks/alert.BxU5lfDm.js";import{c as mv,a as Lm,b as Xu,_ as im,o as fv}from"../chunks/preload-helper.Df2iXy6c.js";const fk=[];function Cm(n,e=!1){return K0(n,new Map,"",fk)}function K0(n,e,t,o,i=null){if(typeof n=="object"&&n!==null){const a=e.get(n);if(a!==void 0)return a;if(n instanceof Map)return new Map(n);if(n instanceof Set)return new Set(n);if(q5(n)){const l=[];e.set(n,l),i!==null&&e.set(i,l);for(let c=0;c<n.length;c+=1)l.push(K0(n[c],e,t,o));return l}if(H5(n)===U5){const l={};e.set(n,l),i!==null&&e.set(i,l);for(var r in n)l[r]=K0(n[r],e,t,o);return l}if(n instanceof Date)return structuredClone(n);if(typeof n.toJSON=="function")return K0(n.toJSON(),e,t,o,n)}if(n instanceof EventTarget)return n;try{return structuredClone(n)}catch{return n}}function mk(n,e,t,o,i){var r=n,a="",l;T2(()=>{if(a===(a=e()??"")){lm&&a_();return}l!==void 0&&($2(l),l=void 0),a!==""&&(l=L2(()=>{if(lm){Oh.data;for(var c=a_(),d=c;c!==null&&(c.nodeType!==8||c.data!=="");)d=c,c=G5(c);if(c===null)throw Y5(),K5;C1(Oh,d),r=P1(c);return}var p=a+"",m=z5(p);C1(F2(m),m.lastChild),r.before(m)}))})}function gk(n,e,t,o,i,r){let a=lm;lm&&a_();var l,c,d=null;lm&&Oh.nodeType===1&&(d=Oh,a_());var p=lm?Oh:n,m;T2(()=>{const h=e()||null;var _=N2;h!==l&&(m&&(h===null?X5(m,()=>{m=null,c=null}):h===c?J5(m):($2(m),Cy(!1))),h&&h!==c&&(m=L2(()=>{if(d=lm?d:document.createElementNS(_,h),C1(d,d),o){var w=lm?F2(d):d.appendChild(Z5());lm&&(w===null?Py(!1):P1(w)),o(d,w)}I1.nodes_end=d,p.before(d)})),l=h,l&&(c=l),Cy(!0))},E2),a&&(Py(!0),P1(p))}function Ly(n,e,t){y_(()=>{var o=rs(()=>e(n,t==null?void 0:t())||{});if(o!=null&&o.destroy)return()=>o.destroy()})}const hk=()=>performance.now(),mg={tick:n=>requestAnimationFrame(n),now:()=>hk(),tasks:new Set};function R2(n){mg.tasks.forEach(e=>{e.c(n)||(mg.tasks.delete(e),e.f())}),mg.tasks.size!==0&&mg.tick(R2)}function _k(n){let e;return mg.tasks.size===0&&mg.tick(R2),{promise:new Promise(t=>{mg.tasks.add(e={c:n,f:t})}),abort(){mg.tasks.delete(e)}}}function I0(n,e){n.dispatchEvent(new CustomEvent(e))}function yk(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const e=n.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Fy(n){const e={},t=n.split(";");for(const o of t){const[i,r]=o.split(":");if(!i||r===void 0)break;const a=yk(i.trim());e[a]=r.trim()}return e}const bk=n=>n;function Mf(n,e,t,o){var i=(n&tk)!==0,r=(n&ok)!==0,a=i&&r,l=(n&sk)!==0,c=a?"both":i?"in":"out",d,p=e.inert,m,h;function _(){var C=ik,M=I1;Iy(null),My(null);try{return d??(d=t()(e,(o==null?void 0:o())??{},{direction:c}))}finally{Iy(C),My(M)}}var w={is_global:l,in(){var C;if(e.inert=p,!i){h==null||h.abort(),(C=h==null?void 0:h.reset)==null||C.call(h);return}r||m==null||m.abort(),I0(e,"introstart"),m=L1(e,_(),h,1,()=>{I0(e,"introend"),m==null||m.abort(),m=d=void 0})},out(C){if(!r){C==null||C(),d=void 0;return}e.inert=!0,I0(e,"outrostart"),h=L1(e,_(),m,0,()=>{I0(e,"outroend"),C==null||C()})},stop:()=>{m==null||m.abort(),h==null||h.abort()}},S=I1;if((S.transitions??(S.transitions=[])).push(w),i&&V5){var P=l;if(!P){for(var I=S.parent;I&&I.f&E2;)for(;(I=I.parent)&&!(I.f&Q5););P=!I||(I.f&ek)!==0}P&&y_(()=>{rs(()=>w.in())})}}function L1(n,e,t,o,i){var r=o===1;if(nk(e)){var a,l=!1;return M1(()=>{if(!l){var P=e({direction:r?"in":"out"});a=L1(n,P,t,o,i)}}),{abort:()=>{l=!0,a==null||a.abort()},deactivate:()=>a.deactivate(),reset:()=>a.reset(),t:()=>a.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return i(),{abort:Mg,deactivate:Mg,reset:Mg,t:()=>o};const{delay:c=0,css:d,tick:p,easing:m=bk}=e;var h=[];if(r&&t===void 0&&(p&&p(0,1),d)){var _=Fy(d(0,1));h.push(_,_)}var w=()=>1-o,S=n.animate(h,{duration:c});return S.onfinish=()=>{var P=(t==null?void 0:t.t())??1-o;t==null||t.abort();var I=o-P,C=e.duration*Math.abs(I),M=[];if(C>0){if(d)for(var F=Math.ceil(C/16.666666666666668),V=0;V<=F;V+=1){var j=P+I*m(V/F),D=d(j,1-j);M.push(Fy(D))}w=()=>{var R=S.currentTime;return P+I*m(R/C)},p&&_k(()=>{if(S.playState!=="running")return!1;var R=w();return p(R,1-R),!0})}S=n.animate(M,{duration:C,fill:"forwards"}),S.onfinish=()=>{w=()=>o,p==null||p(o,1-o),i()}},{abort:()=>{S&&(S.cancel(),S.effect=null,S.onfinish=Mg)},deactivate:()=>{i=Mg},reset:()=>{o===0&&(p==null||p(1,0))},t:()=>w()}}function po(n,e,t=e){var o=rk();__(n,"input",()=>{var i=z_(n)?V_(n.value):n.value;t(i),o&&i!==(i=e())&&(n.value=i??"")}),J1(()=>{var i=e();if(lm&&n.defaultValue!==n.value){t(z_(n)?V_(n.value):n.value);return}z_(n)&&i===V_(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}const O_=new Set;function xk(n,e,t,o,i=o){var r=t.getAttribute("type")==="checkbox",a=n;let l=!1;if(e!==null)for(var c of e)a=a[c]??(a[c]=[]);a.push(t),__(t,"change",()=>{var d=t.__value;r&&(d=$y(a,d,t.checked)),i(d)},()=>i(r?[]:null)),J1(()=>{var d=o();if(lm&&t.defaultChecked!==t.checked){l=!0;return}r?(d=d||[],t.checked=d.includes(t.__value)):t.checked=j2(t.__value,d)}),D2(()=>{var d=a.indexOf(t);d!==-1&&a.splice(d,1)}),O_.has(a)||(O_.add(a),M1(()=>{a.sort((d,p)=>d.compareDocumentPosition(p)===4?-1:1),O_.delete(a)})),M1(()=>{if(l){var d;if(r)d=$y(a,d,t.checked);else{var p=a.find(m=>m.checked);d=p==null?void 0:p.__value}i(d)}})}function zf(n,e,t=e){__(n,"change",()=>{var o=n.checked;t(o)}),e()==null&&t(!1),J1(()=>{var o=e();n.checked=!!o})}function $y(n,e,t){for(var o=new Set,i=0;i<n.length;i+=1)n[i].checked&&o.add(n[i].__value);return t||o.delete(e),Array.from(o)}function z_(n){var e=n.type;return e==="number"||e==="range"}function V_(n){return n===""?null:+n}function Ey(n,e,t){var o=ak(n,e);o&&o.set&&(n[e]=t,D2(()=>{n[e]=null}))}function Am(n,e,t){if(n.multiple)return wk(n,e);for(var o of n.options){var i=Vh(o);if(j2(i,e)){o.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function _g(n,e){let t=!0;y_(()=>{e&&Am(n,rs(e),t),t=!1;var o=new MutationObserver(()=>{var i=n.__value;Am(n,i)});return o.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{o.disconnect()}})}function qo(n,e,t=e){var o=!0;__(n,"change",()=>{var i;if(n.multiple)i=[].map.call(n.querySelectorAll(":checked"),Vh);else{var r=n.querySelector(":checked");i=r&&Vh(r)}t(i)}),y_(()=>{var i=e();if(Am(n,i,o),o&&i===void 0){var r=n.querySelector(":checked");r!==null&&(i=Vh(r),t(i))}n.__value=i,o=!1}),_g(n)}function wk(n,e){for(var t of n.options)t.selected=~e.indexOf(Vh(t))}function Vh(n){return"__value"in n?n.__value:n.value}function kh(n){x(n,n.v+1)}function Op(n,e){if(!(!Af(n)&&!Af(e))){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const o=n[t],i=e[t];Af(i)&&Af(o)?Op(o,i):_o(e[t])&&(n[t]=th(e[t]))}}}function th(n){if(!Af(n))return n;let e=null;pm(n)?e=[]:e={};for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const o=n[t];Af(o)?e[t]=th(o):e[t]=o}return e}function pm(n){return Object.prototype.toString.call(n)==="[object Array]"}function pf(n){return typeof n=="function"}function Af(n){return typeof n=="object"&&_o(n)}function fl(n){return typeof n=="number"&&Number.isFinite(n)}function _o(n){return n!=null}function Yh(n){return typeof n=="boolean"}function au(n){return typeof n=="string"}const kk=/\\(\\)?/g,Sk=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g");function nv(n,e,t){if(_o(n)){const o=[];e.replace(Sk,(l,...c)=>{let d=l;return _o(c[1])?d=c[2].replace(kk,"$1"):_o(c[0])&&(d=c[0].trim()),o.push(d),""});let i=n,r=0;const a=o.length;for(;_o(i)&&r<a;)i=i==null?void 0:i[o[r++]];return _o(i)?i:t??"--"}return t??"--"}function Ck(n,e){const t={};return n.formatToParts(new Date(e)).forEach(({type:o,value:i})=>{switch(o){case"year":{t.YYYY=i;break}case"month":{t.MM=i;break}case"day":{t.DD=i;break}case"hour":{t.HH=i==="24"?"00":i;break}case"minute":{t.mm=i;break}case"second":{t.ss=i;break}}}),t}function B2(n,e,t){const o=Ck(n,e);return t.replace(/YYYY|MM|DD|HH|mm|ss/g,i=>o[i])}function Mv(n,e){const t=+n;return fl(t)?t.toFixed(e??2):`${n}`}function O2(n){const e=+n;if(fl(e)){if(e>1e9)return`${+(e/1e9).toFixed(3)}B`;if(e>1e6)return`${+(e/1e6).toFixed(3)}M`;if(e>1e3)return`${+(e/1e3).toFixed(3)}K`}return`${n}`}function z2(n,e){const t=`${n}`;if(e.length===0)return t;if(t.includes(".")){const o=t.split(".");return`${o[0].replace(/(\d)(?=(\d{3})+$)/g,i=>`${i}${e}`)}.${o[1]}`}return t.replace(/(\d)(?=(\d{3})+$)/g,o=>`${o}${e}`)}function V2(n,e){const t=`${n}`;if(new RegExp("\\.0{"+e+",}[1-9][0-9]*$").test(t)){const i=t.split("."),r=i.length-1,a=i[r],l=/0*/.exec(a);if(_o(l)){const c=l[0].length;return i[r]=a.replace(/0*/,`0{${c}}`),i.join(".")}}return t}function Ny(n,e){return n.replace(/\{(\w+)\}/g,(t,o)=>{const i=e[o];return _o(i)?i:`{${o}}`})}let Sh=null;function yg(n){var e;return((e=n.ownerDocument.defaultView)==null?void 0:e.devicePixelRatio)??1}function sg(n,e,t){return`${e??"normal"} ${n??12}px ${t??"Helvetica Neue"}`}function Av(n,e,t,o){if(!_o(Sh)){const i=document.createElement("canvas"),r=yg(i);Sh=i.getContext("2d"),Sh.scale(r,r)}return Sh.font=sg(e,t,o),Math.round(Sh.measureText(n).width)}function l_(n){const e={width:0,height:0,left:0,right:0,top:0,bottom:0};return _o(n)&&Op(e,n),e}var fu=(n=>(n[n.Main=0]="Main",n[n.Overlay=1]="Overlay",n[n.Separator=2]="Separator",n[n.Drawer=3]="Drawer",n[n.All=4]="All",n))(fu||{});const W_=-1;function og(n){return pf(window.requestAnimationFrame)?window.requestAnimationFrame(n):window.setTimeout(n,20)}function Dy(n){pf(window.cancelAnimationFrame)?window.cancelAnimationFrame(n):window.clearTimeout(n)}class F1{constructor(e){Ce(this,"_options",{duration:500,iterationCount:1});Ce(this,"_doFrameCallback");Ce(this,"_currentIterationCount",0);Ce(this,"_running",!1);Ce(this,"_time",0);Op(this._options,e)}_loop(){this._running=!0;const e=()=>{var t;if(this._running){const o=new Date().getTime()-this._time;o<this._options.duration?((t=this._doFrameCallback)==null||t.call(this,o),og(e)):(this.stop(),this._currentIterationCount++,this._currentIterationCount<this._options.iterationCount&&this.start())}};og(e)}doFrame(e){return this._doFrameCallback=e,this}setDuration(e){return this._options.duration=e,this}setIterationCount(e){return this._options.iterationCount=e,this}start(){this._running||(this._time=new Date().getTime(),this._loop())}stop(){var e;this._running&&((e=this._doFrameCallback)==null||e.call(this,this._options.duration)),this._running=!1}}let q_=1,jy=new Date().getTime();function Nh(n){const e=new Date().getTime();return e===jy?++q_:q_=1,jy=e,`${n??""}${e}_${q_}`}function rg(n,e){const t=document.createElement(n),o=e??{};for(const i in o)t.style[i]=o[i]??"";return t}function $1(n,e,t){let o=0,i=0;for(i=n.length-1;o!==i;){const r=Math.floor((i+o)/2),a=i-o,l=n[r][e];if(t===n[o][e])return o;if(t===n[i][e])return i;if(t===l)return r;if(t>l?o=r:i=r,a<=2)break}return o}function Ry(n){const e=Math.floor(Qm(n)),t=Ag(e),o=n/t;let i=0;return o<1.5?i=1:o<2.5?i=2:o<3.5?i=3:o<4.5?i=4:o<5.5?i=5:o<6.5?i=6:i=8,n=i*t,+n.toFixed(Math.abs(e))}function By(n,e){e=Math.max(0,e??0);const t=Math.pow(10,e);return Math.round(n*t)/t}function Pk(n){const e=n.toString(),t=e.indexOf("e");if(t>0){const i=+e.slice(t+1);return i<0?-i:0}const o=e.indexOf(".");return o<0?0:e.length-1-o}function W2(n,e,t){const o=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],i=n.length;let r=0;for(;r<i;){const a=n[r];o[0]=Math.max(a[e]??Number.MIN_SAFE_INTEGER,o[0]),o[1]=Math.min(a[t]??Number.MAX_SAFE_INTEGER,o[1]),++r}return o}function Qm(n){return n===0?0:Math.log10(n)}function Ag(n){return Math.pow(10,n)}function Oy(){return{from:0,to:0,realFrom:0,realTo:0}}function zy(...n){return n.join("_")}const Ik=5;class Mk{constructor(e){Ce(this,"_limit");Ce(this,"_running",0);Ce(this,"_queue",[]);Ce(this,"_taskMap",new Map);this._limit=e??Ik}async add(e){return await new Promise((t,o)=>{const{id:i,handler:r}=e,a=()=>{this._running++,r().then(c=>{t(c)}).catch(()=>{o("failed")}).finally(()=>{this._running--,this._taskMap.delete(i),this._next()})},l=this._taskMap.get(i);if(_o(l)){l.reject("canceled");const c=this._queue.indexOf(l.run);c>-1&&this._queue.splice(c,1)}this._taskMap.set(i,{run:a,reject:o}),this._queue.push(a),this._next()})}_next(){for(;this._running<this._limit&&this._queue.length>0;){const e=this._queue.shift();e==null||e()}}remove(e){const t=this._taskMap.get(e);if(_o(t)){this._taskMap.delete(e);const o=this._queue.indexOf(t.run);o>-1&&this._queue.splice(o,1),t.reject("canceled")}}clear(){for(const[,{reject:e}]of this._taskMap)e("canceled");this._taskMap.clear(),this._queue=[]}}const Tv={PRICE:2,VOLUME:0};class Ak{constructor(){Ce(this,"_callbacks",[])}subscribe(e){this._callbacks.indexOf(e)<0&&this._callbacks.push(e)}unsubscribe(e){if(pf(e)){const t=this._callbacks.indexOf(e);t>-1&&this._callbacks.splice(t,1)}else this._callbacks=[]}execute(e){this._callbacks.forEach(t=>{t(e)})}isEmpty(){return this._callbacks.length===0}}function nh(n){return n==="transparent"||n==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(n)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(n)}function bg(n,e){const t=n.replace(/^#/,""),o=parseInt(t,16),i=o>>16&255,r=o>>8&255,a=o&255;return`rgba(${i}, ${r}, ${a}, ${e??1})`}const El={RED:"#F92855",GREEN:"#2DC08E",WHITE:"#FFFFFF",GREY:"#76808F",BLUE:"#1677FF"};function Tk(){return{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]}}}function Lk(){const n={show:!0,color:El.GREY,textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"};return{type:"candle_solid",bar:{compareRule:"current_open",upColor:El.GREEN,downColor:El.RED,noChangeColor:El.GREY,upBorderColor:El.GREEN,downBorderColor:El.RED,noChangeBorderColor:El.GREY,upWickColor:El.GREEN,downWickColor:El.RED,noChangeWickColor:El.GREY},area:{lineSize:2,lineColor:El.BLUE,smooth:!1,value:"close",backgroundColor:[{offset:0,color:bg(El.BLUE,.01)},{offset:1,color:bg(El.BLUE,.2)}],point:{show:!0,color:El.BLUE,radius:4,rippleColor:bg(El.BLUE,.3),rippleRadius:8,animation:!0,animationDuration:1e3}},priceMark:{show:!0,high:{...n},low:{...n},last:{show:!0,compareRule:"current_open",upColor:El.GREEN,downColor:El.RED,noChangeColor:El.GREY,line:{show:!0,style:"dashed",dashedValue:[4,4],size:1},text:{show:!0,style:"fill",size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderColor:"transparent",borderStyle:"solid",borderSize:0,borderDashedValue:[2,2],color:El.WHITE,family:"Helvetica Neue",weight:"normal",borderRadius:2},extendTexts:[]}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",rect:{position:"fixed",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,offsetLeft:4,offsetTop:4,offsetRight:4,offsetBottom:4,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},title:{show:!0,size:14,family:"Helvetica Neue",weight:"normal",color:El.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,template:"{ticker} · {period}"},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:El.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a",template:[{title:"open",value:"{open}"},{title:"high",value:"{high}"},{title:"low",value:"{low}"},{title:"close",value:"{close}"},{title:"volume",value:"{volume}"}]},features:[]}}}function Fk(){const n=bg(El.GREEN,.7),e=bg(El.RED,.7);return{ohlc:{compareRule:"current_open",upColor:n,downColor:e,noChangeColor:El.GREY},bars:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:n,downColor:e,noChangeColor:El.GREY}],lines:["#FF9600","#935EBD",El.BLUE,"#E11D74","#01C5C4"].map(t=>({style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:t})),circles:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:n,downColor:e,noChangeColor:El.GREY}],lastValueMark:{show:!1,text:{show:!1,style:"fill",color:El.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderColor:"transparent",borderSize:0,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",title:{show:!0,showName:!0,showParams:!0,size:12,family:"Helvetica Neue",weight:"normal",color:El.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:El.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a"},features:[]}}}function Vy(){return{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:El.GREY,size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}}}function $k(){return{show:!0,horizontal:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:El.GREY},text:{show:!0,style:"fill",color:El.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:El.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:El.GREY},features:[]},vertical:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:El.GREY},text:{show:!0,style:"fill",color:El.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:El.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:El.GREY}}}}function Ek(){const n=bg(El.BLUE,.35),e=bg(El.BLUE,.25);function t(){return{style:"fill",color:El.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:El.BLUE,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:El.BLUE}}return{point:{color:El.BLUE,borderColor:n,borderSize:1,radius:5,activeColor:El.BLUE,activeBorderColor:n,activeBorderSize:3,activeRadius:5},line:{style:"solid",smooth:!1,color:El.BLUE,size:1,dashedValue:[2,2]},rect:{style:"fill",color:e,borderColor:El.BLUE,borderSize:1,borderRadius:0,borderStyle:"solid",borderDashedValue:[2,2]},polygon:{style:"fill",color:El.BLUE,borderColor:El.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},circle:{style:"fill",color:e,borderColor:El.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},arc:{style:"solid",color:El.BLUE,size:1,dashedValue:[2,2]},text:t()}}function Nk(){return{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:bg(El.BLUE,.08)}}function Dk(){return{grid:Tk(),candle:Lk(),indicator:Fk(),xAxis:Vy(),yAxis:Vy(),separator:Nk(),crosshair:$k(),overlay:Ek()}}function Q1(n,e,t,o){const i=n.result,r=n.figures,a=n.styles,l=nv(a,"circles",t.circles),c=l.length,d=nv(a,"bars",t.bars),p=d.length,m=nv(a,"lines",t.lines),h=m.length;let _=0,w=0,S=0,P,I=0;r.forEach(C=>{var M;switch(C.type){case"circle":{I=_;const F=l[_%c];P={...F,color:F.noChangeColor},_++;break}case"bar":{I=w;const F=d[w%p];P={...F,color:F.noChangeColor},w++;break}case"line":{I=S,P=m[S%h],S++;break}}if(_o(C.type)){const F=(M=C.styles)==null?void 0:M.call(C,{data:{prev:i[e.prev??""],current:i[e.current??""],next:i[e.next??""]},indicator:n,defaultStyles:t});o(C,{...P,...F},I)}})}class b_{constructor(e){Ce(this,"id");Ce(this,"paneId");Ce(this,"name");Ce(this,"shortName");Ce(this,"precision",4);Ce(this,"calcParams",[]);Ce(this,"shouldOhlc",!1);Ce(this,"shouldFormatBigNumber",!1);Ce(this,"visible",!0);Ce(this,"zLevel",0);Ce(this,"extendData");Ce(this,"series","normal");Ce(this,"figures",[]);Ce(this,"minValue",null);Ce(this,"maxValue",null);Ce(this,"styles",null);Ce(this,"shouldUpdate",(e,t)=>{const o=JSON.stringify(e.calcParams)!==JSON.stringify(t.calcParams)||e.figures!==t.figures||e.calc!==t.calc,i=o||e.shortName!==t.shortName||e.series!==t.series||e.minValue!==t.minValue||e.maxValue!==t.maxValue||e.precision!==t.precision||e.shouldOhlc!==t.shouldOhlc||e.shouldFormatBigNumber!==t.shouldFormatBigNumber||e.visible!==t.visible||e.zLevel!==t.zLevel||e.extendData!==t.extendData||e.regenerateFigures!==t.regenerateFigures||e.createTooltipDataSource!==t.createTooltipDataSource||e.draw!==t.draw;return{calc:o,draw:i}});Ce(this,"calc",()=>({}));Ce(this,"regenerateFigures",null);Ce(this,"createTooltipDataSource",null);Ce(this,"draw",null);Ce(this,"onDataStateChange",null);Ce(this,"result",{});Ce(this,"_prevIndicator");Ce(this,"_lockSeriesPrecision",!1);this.override(e),this._lockSeriesPrecision=!1}override(e){const{result:t,...o}=this;this._prevIndicator={...th(o),result:t};const{id:i,name:r,shortName:a,precision:l,styles:c,figures:d,calcParams:p,...m}=e;!au(this.id)&&au(i)&&(this.id=i),au(this.name)||(this.name=r??""),this.shortName=a??this.shortName??this.name,fl(l)&&(this.precision=l,this._lockSeriesPrecision=!0),_o(c)&&(this.styles??(this.styles={}),Op(this.styles,c)),Op(this,m),_o(p)&&(this.calcParams=p,pf(this.regenerateFigures)&&(this.figures=this.regenerateFigures(this.calcParams))),this.figures=d??this.figures}setSeriesPrecision(e){this._lockSeriesPrecision||(this.precision=e)}shouldUpdateImp(){const e=this._prevIndicator.zLevel!==this.zLevel,t=this.shouldUpdate(this._prevIndicator,this);return Yh(t)?{calc:t,draw:t,sort:e}:{...t,sort:e}}async calcImp(e){try{const t=await this.calc(e,this);return this.result=t,!0}catch{return!1}}static extend(e){class t extends b_{constructor(){super(e)}}return t}}const jk={name:"AVP",shortName:"AVP",series:"price",precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:n=>{let e=0,t=0;return n.reduce((o,i)=>{const r={},a=i.turnover??0,l=i.volume??0;return e+=a,t+=l,t!==0&&(r.avp=e/t),o[i.timestamp]=r,o},{})}},Rk={name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{const{prev:o,current:i}=n,r=(o==null?void 0:o.ao)??Number.MIN_SAFE_INTEGER,a=(i==null?void 0:i.ao)??Number.MIN_SAFE_INTEGER;let l="";a>r?l=nv(e.styles,"bars[0].upColor",t.bars[0].upColor):l=nv(e.styles,"bars[0].downColor",t.bars[0].downColor);const c=a>r?"stroke":"fill";return{color:l,style:c,borderColor:l}}}],calc:(n,e)=>{const t=e.calcParams,o=Math.max(t[0],t[1]);let i=0,r=0,a=0,l=0;return n.reduce((c,d,p)=>{const m={},h=(d.low+d.high)/2;if(i+=h,r+=h,p>=t[0]-1){a=i/t[0];const _=n[p-(t[0]-1)];i-=(_.low+_.high)/2}if(p>=t[1]-1){l=r/t[1];const _=n[p-(t[1]-1)];r-=(_.low+_.high)/2}return p>=o-1&&(m.ao=a-l),c[d.timestamp]=m,c},{})}},Bk={name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`bias${t+1}`,title:`BIAS${e}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:o}=e,i=[];return n.reduce((r,a,l)=>{const c={},d=a.close;return t.forEach((p,m)=>{if(i[m]=(i[m]??0)+d,l>=p-1){const h=i[m]/t[m];c[o[m].key]=(d-h)/h*100,i[m]-=n[l-(p-1)].close}}),r[a.timestamp]=c,r},{})}};function Ok(n,e){const t=n.length;let o=0;return n.forEach(i=>{const r=i.close-e;o+=r*r}),o=Math.abs(o),Math.sqrt(o/t)}const zk={name:"BOLL",shortName:"BOLL",series:"price",calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,o=t[0]-1;let i=0;return n.reduce((r,a,l)=>{const c=a.close,d={};if(i+=c,l>=o){d.mid=i/t[0];const p=Ok(n.slice(l-o,l+1),d.mid);d.up=d.mid+t[1]*p,d.dn=d.mid-t[1]*p,i-=n[l-o].close}return r[a.timestamp]=d,r},{})}},Vk={name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let o=0,i=0,r=0,a=0;return n.reduce((l,c,d)=>{const p={},m=c.high,h=c.low,_=c.open,w=(n[d-1]??c).close;if(r+=m-_,a+=_-h,o+=m-w,i+=w-h,d>=t[0]-1){a!==0?p.ar=r/a*100:p.ar=0,i!==0?p.br=o/i*100:p.br=0;const S=n[d-(t[0]-1)],P=S.high,I=S.low,C=S.open,M=(n[d-t[0]]??n[d-(t[0]-1)]).close;o-=P-M,i-=M-I,r-=P-C,a-=C-I}return l[c.timestamp]=p,l},{})}},Wk={name:"BBI",shortName:"BBI",series:"price",precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,o=Math.max(...t),i=[],r=[];return n.reduce((a,l,c)=>{const d={},p=l.close;if(t.forEach((m,h)=>{i[h]=(i[h]??0)+p,c>=m-1&&(r[h]=i[h]/m,i[h]-=n[c-(m-1)].close)}),c>=o-1){let m=0;r.forEach(h=>{m+=h}),d.bbi=m/4}return a[l.timestamp]=d,a},{})}},qk={name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,o=t[0]-1;let i=0;const r=[];return n.reduce((a,l,c)=>{const d={},p=(l.high+l.low+l.close)/3;if(i+=p,r.push(p),c>=o){const m=i/t[0],h=r.slice(c-o,c+1);let _=0;h.forEach(P=>{_+=Math.abs(P-m)});const w=_/t[0];d.cci=w!==0?(p-m)/w/.015:0;const S=(n[c-o].high+n[c-o].low+n[c-o].close)/3;i-=S}return a[l.timestamp]=d,a},{})}},Hk={name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,o=Math.ceil(t[1]/2.5+1),i=Math.ceil(t[2]/2.5+1),r=Math.ceil(t[3]/2.5+1),a=Math.ceil(t[4]/2.5+1);let l=0;const c=[];let d=0;const p=[];let m=0;const h=[];let _=0;const w=[],S=[],P={};return n.forEach((I,C)=>{const M={},F=n[C-1]??I,V=(F.high+F.close+F.low+F.open)/4,j=Math.max(0,I.high-V),D=Math.max(0,V-I.low);C>=t[0]-1&&(D!==0?M.cr=j/D*100:M.cr=0,l+=M.cr,d+=M.cr,m+=M.cr,_+=M.cr,C>=t[0]+t[1]-2&&(c.push(l/t[1]),C>=t[0]+t[1]+o-3&&(M.ma1=c[c.length-1-o]),l-=S[C-(t[1]-1)].cr??0),C>=t[0]+t[2]-2&&(p.push(d/t[2]),C>=t[0]+t[2]+i-3&&(M.ma2=p[p.length-1-i]),d-=S[C-(t[2]-1)].cr??0),C>=t[0]+t[3]-2&&(h.push(m/t[3]),C>=t[0]+t[3]+r-3&&(M.ma3=h[h.length-1-r]),m-=S[C-(t[3]-1)].cr??0),C>=t[0]+t[4]-2&&(w.push(_/t[4]),C>=t[0]+t[4]+a-3&&(M.ma4=w[w.length-1-a]),_-=S[C-(t[4]-1)].cr??0)),S.push(M),P[I.timestamp]=M}),P}},Uk={name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,o=Math.max(t[0],t[1]);let i=0,r=0,a=0;const l=[],c={};return n.forEach((d,p)=>{const m={},h=d.close;i+=h,r+=h;let _=0,w=0;if(p>=t[0]-1&&(_=i/t[0],i-=n[p-(t[0]-1)].close),p>=t[1]-1&&(w=r/t[1],r-=n[p-(t[1]-1)].close),p>=o-1){const S=_-w;m.dma=S,a+=S,p>=o+t[2]-2&&(m.ama=a/t[2],a-=l[p-(t[2]-1)].dma??0)}l.push(m),c[d.timestamp]=m}),c}},Gk={name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let o=0,i=0,r=0,a=0,l=0,c=0,d=0,p=0;const m=[],h={};return n.forEach((_,w)=>{const S={},P=n[w-1]??_,I=P.close,C=_.high,M=_.low,F=C-M,V=Math.abs(C-I),j=Math.abs(I-M),D=C-P.high,R=P.low-M,W=Math.max(Math.max(F,V),j),J=D>0&&D>R?D:0,Z=R>0&&R>D?R:0;if(o+=W,i+=J,r+=Z,w>=t[0]-1){w>t[0]-1?(a=a-a/t[0]+W,l=l-l/t[0]+J,c=c-c/t[0]+Z):(a=o,l=i,c=r);let G=0,se=0;a!==0&&(G=l*100/a,se=c*100/a),S.pdi=G,S.mdi=se;let Y=0;se+G!==0&&(Y=Math.abs(se-G)/(se+G)*100),d+=Y,w>=t[0]*2-2&&(w>t[0]*2-2?p=(p*(t[0]-1)+Y)/t[0]:p=d/t[0],S.adx=p,w>=t[0]*2+t[1]-3&&(S.adxr=((m[w-(t[1]-1)].adx??0)+p)/2))}m.push(S),h[_.timestamp]=S}),h}},Yk={name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let o=0;const i=[];return n.reduce((r,a,l)=>{const c={};if(l>0){const d=n[l-1],p=a.high,m=a.low,h=a.volume??0,_=(p+m)/2-(d.high+d.low)/2;if(h===0||p-m===0)c.emv=0;else{const w=h/1e8/(p-m);c.emv=_/w}o+=c.emv,i.push(c.emv),l>=t[0]&&(c.maEmv=o/t[0],o-=i[l-t[0]])}return r[a.timestamp]=c,r},{})}},Kk={name:"EMA",shortName:"EMA",series:"price",calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`ema${t+1}`,title:`EMA${e}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:o}=e;let i=0;const r=[];return n.reduce((a,l,c)=>{const d={},p=l.close;return i+=p,t.forEach((m,h)=>{c>=m-1&&(c>m-1?r[h]=(2*p+(m-1)*r[h])/(m+1):r[h]=i/m,d[o[h].key]=r[h])}),a[l.timestamp]=d,a},{})}},Zk={name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let o=0;const i=[],r={};return n.forEach((a,l)=>{const c={};if(l>=t[0]){const d=a.close,p=n[l-t[0]].close;c.mtm=d-p,o+=c.mtm,l>=t[0]+t[1]-1&&(c.maMtm=o/t[1],o-=i[l-(t[1]-1)].mtm??0)}i.push(c),r[a.timestamp]=c}),r}},Xk={name:"MA",shortName:"MA",series:"price",calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA30: ",type:"line"},{key:"ma4",title:"MA60: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`ma${t+1}`,title:`MA${e}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:o}=e,i=[];return n.reduce((r,a,l)=>{const c={},d=a.close;return t.forEach((p,m)=>{i[m]=(i[m]??0)+d,l>=p-1&&(c[o[m].key]=i[m]/p,i[m]-=n[l-(p-1)].close)}),r[a.timestamp]=c,r},{})}},Jk={name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{const{prev:o,current:i}=n,r=(o==null?void 0:o.macd)??Number.MIN_SAFE_INTEGER,a=(i==null?void 0:i.macd)??Number.MIN_SAFE_INTEGER;let l="";return a>0?l=nv(e.styles,"bars[0].upColor",t.bars[0].upColor):a<0?l=nv(e.styles,"bars[0].downColor",t.bars[0].downColor):l=nv(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor),{style:r<a?"stroke":"fill",color:l,borderColor:l}}}],calc:(n,e)=>{const t=e.calcParams;let o=0,i=0,r=0,a=0,l=0,c=0;const d=Math.max(t[0],t[1]);return n.reduce((p,m,h)=>{const _={},w=m.close;return o+=w,h>=t[0]-1&&(h>t[0]-1?i=(2*w+(t[0]-1)*i)/(t[0]+1):i=o/t[0]),h>=t[1]-1&&(h>t[1]-1?r=(2*w+(t[1]-1)*r)/(t[1]+1):r=o/t[1]),h>=d-1&&(a=i-r,_.dif=a,l+=a,h>=d+t[2]-2&&(h>d+t[2]-2?c=(a*2+c*(t[2]-1))/(t[2]+1):c=l/t[2],_.macd=(a-c)*2,_.dea=c)),p[m.timestamp]=_,p},{})}},Qk={name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let o=0,i=0;const r=[],a={};return n.forEach((l,c)=>{const d=n[c-1]??l;l.close<d.close?i-=l.volume??0:l.close>d.close&&(i+=l.volume??0);const p={obv:i};o+=i,c>=t[0]-1&&(p.maObv=o/t[0],o-=r[c-(t[0]-1)].obv??0),r.push(p),a[l.timestamp]=p}),a}},e3={name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:n=>{let e=0;return n.reduce((t,o,i)=>{const r={},a=o.close,l=o.volume??1,c=(n[i-1]??o).close;let d=0;const p=c*l;return p!==0&&(d=(a-c)/p),e+=d,r.pvt=e,t[o.timestamp]=r,t},{})}},t3={name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let o=0,i=0;const r=[],a=[],l={};return n.forEach((c,d)=>{const p={},m=(n[d-1]??c).close,h=c.close-m>0?1:0;r.push(h),o+=h,d>=t[0]-1&&(p.psy=o/t[0]*100,i+=p.psy,d>=t[0]+t[1]-2&&(p.maPsy=i/t[1],i-=a[d-(t[1]-1)].psy??0),o-=r[d-(t[0]-1)]),a.push(p),l[c.timestamp]=p}),l}},n3={name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,o=[],i={};let r=0;return n.forEach((a,l)=>{const c={};if(l>=t[0]-1){const d=a.close,p=(n[l-t[0]]??n[l-(t[0]-1)]).close;p!==0?c.roc=(d-p)/p*100:c.roc=0,r+=c.roc,l>=t[0]-1+t[1]-1&&(c.maRoc=r/t[1],r-=o[l-(t[1]-1)].roc??0)}o.push(c),i[a.timestamp]=c}),i}},o3={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>{const o=t+1;return{key:`rsi${o}`,title:`RSI${o}: `,type:"line"}}),calc:(n,e)=>{const{calcParams:t,figures:o}=e,i=[],r=[];return n.reduce((a,l,c)=>{const d={},p=(n[c-1]??l).close,m=l.close-p;return t.forEach((h,_)=>{if(m>0?i[_]=(i[_]??0)+m:r[_]=(r[_]??0)+Math.abs(m),c>=h-1){r[_]!==0?d[o[_].key]=100-100/(1+i[_]/r[_]):d[o[_].key]=0;const w=n[c-(h-1)],S=n[c-h]??w,P=w.close-S.close;P>0?i[_]-=P:r[_]-=Math.abs(P)}}),a[l.timestamp]=d,a},{})}},s3={name:"SMA",shortName:"SMA",series:"price",calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:(n,e)=>{const t=e.calcParams;let o=0,i=0;return n.reduce((r,a,l)=>{const c={},d=a.close;return o+=d,l>=t[0]-1&&(l>t[0]-1?i=(d*t[1]+i*(t[0]-t[1]+1))/(t[0]+1):i=o/t[0],c.sma=i),r[a.timestamp]=c,r},{})}},i3={name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,o=[],i={};return n.forEach((r,a)=>{var d,p;const l={},c=r.close;if(a>=t[0]-1){const m=W2(n.slice(a-(t[0]-1),a+1),"high","low"),h=m[0],_=m[1],w=h-_,S=(c-_)/(w===0?1:w)*100;l.k=((t[1]-1)*(((d=o[a-1])==null?void 0:d.k)??50)+S)/t[1],l.d=((t[2]-1)*(((p=o[a-1])==null?void 0:p.d)??50)+l.k)/t[2],l.j=3*l.k-2*l.d}o.push(l),i[r.timestamp]=l}),i}},r3={name:"SAR",shortName:"SAR",series:"price",calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:({data:n,indicator:e,defaultStyles:t})=>{const{current:o}=n,i=(o==null?void 0:o.sar)??Number.MIN_SAFE_INTEGER,r=(((o==null?void 0:o.high)??0)+((o==null?void 0:o.low)??0))/2;return{color:i<r?nv(e.styles,"circles[0].upColor",t.circles[0].upColor):nv(e.styles,"circles[0].downColor",t.circles[0].downColor)}}}],calc:(n,e)=>{const t=e.calcParams,o=t[0]/100,i=t[1]/100,r=t[2]/100;let a=o,l=-100,c=!1,d=0;return n.reduce((p,m,h)=>{const _=d,w=m.high,S=m.low;if(c){(l===-100||l<w)&&(l=w,a=Math.min(a+i,r)),d=_+a*(l-_);const P=Math.min(n[Math.max(1,h)-1].low,S);d>m.low?(d=l,a=o,l=-100,c=!c):d>P&&(d=P)}else{(l===-100||l>S)&&(l=S,a=Math.min(a+i,r)),d=_+a*(l-_);const P=Math.max(n[Math.max(1,h)-1].high,w);d<m.high?(d=l,a=0,l=-100,c=!c):d<P&&(d=P)}return p[m.timestamp]={high:w,low:S,sar:d},p},{})}},a3={name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let o=0,i=0,r=0,a=0,l=0,c=0,d=0;const p=[],m={};return n.forEach((h,_)=>{const w={},S=h.close;if(o+=S,_>=t[0]-1&&(_>t[0]-1?i=(2*S+(t[0]-1)*i)/(t[0]+1):i=o/t[0],l+=i,_>=t[0]*2-2&&(_>t[0]*2-2?r=(2*i+(t[0]-1)*r)/(t[0]+1):r=l/t[0],c+=r,_>=t[0]*3-3))){let P=0,I=0;_>t[0]*3-3?(P=(2*r+(t[0]-1)*a)/(t[0]+1),I=(P-a)/a*100):P=c/t[0],a=P,w.trix=I,d+=I,_>=t[0]*3+t[1]-4&&(w.maTrix=d/t[1],d-=p[_-(t[1]-1)].trix??0)}p.push(w),m[h.timestamp]=w}),m}};function Wy(){return{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{const o=n.current;let i=nv(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor);return _o(o)&&(o.close>o.open?i=nv(e.styles,"bars[0].upColor",t.bars[0].upColor):o.close<o.open&&(i=nv(e.styles,"bars[0].downColor",t.bars[0].downColor))),{color:i}}}}const l3={name:"VOL",shortName:"VOL",series:"volume",calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},Wy()],regenerateFigures:n=>{const e=n.map((t,o)=>({key:`ma${o+1}`,title:`MA${t}: `,type:"line"}));return e.push(Wy()),e},calc:(n,e)=>{const{calcParams:t,figures:o}=e,i=[];return n.reduce((r,a,l)=>{const c=a.volume??0,d={volume:c,open:a.open,close:a.close};return t.forEach((p,m)=>{i[m]=(i[m]??0)+c,l>=p-1&&(d[o[m].key]=i[m]/p,i[m]-=n[l-(p-1)].volume??0)}),r[a.timestamp]=d,r},{})}},c3={name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let o=0,i=0,r=0,a=0;const l=[],c={};return n.forEach((d,p)=>{const m={},h=d.close,_=(n[p-1]??d).close,w=d.volume??0;if(h>_?o+=w:h<_?i+=w:r+=w,p>=t[0]-1){const S=r/2;i+S===0?m.vr=0:m.vr=(o+S)/(i+S)*100,a+=m.vr,p>=t[0]+t[1]-2&&(m.maVr=a/t[1],a-=l[p-(t[1]-1)].vr??0);const P=n[p-(t[0]-1)],I=n[p-t[0]]??P,C=P.close,M=P.volume??0;C>I.close?o-=M:C<I.close?i-=M:r-=M}l.push(m),c[d.timestamp]=m}),c}},d3={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`wr${t+1}`,title:`WR${t+1}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:o}=e;return n.reduce((i,r,a)=>{const l={},c=r.close;return t.forEach((d,p)=>{const m=d-1;if(a>=m){const h=W2(n.slice(a-m,a+1),"high","low"),_=h[0],w=h[1],S=_-w;l[o[p].key]=S===0?0:(c-_)/S*100}}),i[r.timestamp]=l,i},{})}},ey={},u3=[jk,Rk,Bk,zk,Vk,Wk,qk,Hk,Uk,Gk,Yk,Kk,Zk,Xk,Jk,Qk,e3,t3,n3,o3,s3,i3,r3,a3,l3,c3,d3];u3.forEach(n=>{ey[n.name]=b_.extend(n)});function H_(n){ey[n.name]=b_.extend(n)}function q2(n){return ey[n]??null}function Jf(n,e){const t=(e==null?void 0:e.ignoreEvent)??!1;return Yh(t)?!t:!t.includes(n)}const qy=1,Ch=-1,p3="overlay_",Wg="overlay_figure_";class x_{constructor(e){Ce(this,"id");Ce(this,"groupId","");Ce(this,"paneId");Ce(this,"name");Ce(this,"totalStep",1);Ce(this,"currentStep",qy);Ce(this,"lock",!1);Ce(this,"visible",!0);Ce(this,"zLevel",0);Ce(this,"needDefaultPointFigure",!1);Ce(this,"needDefaultXAxisFigure",!1);Ce(this,"needDefaultYAxisFigure",!1);Ce(this,"mode","normal");Ce(this,"modeSensitivity",8);Ce(this,"points",[]);Ce(this,"extendData");Ce(this,"styles",null);Ce(this,"createPointFigures",null);Ce(this,"createXAxisFigures",null);Ce(this,"createYAxisFigures",null);Ce(this,"performEventPressedMove",null);Ce(this,"performEventMoveForDrawing",null);Ce(this,"onDrawStart",null);Ce(this,"onDrawing",null);Ce(this,"onDrawEnd",null);Ce(this,"onClick",null);Ce(this,"onDoubleClick",null);Ce(this,"onRightClick",null);Ce(this,"onPressedMoveStart",null);Ce(this,"onPressedMoving",null);Ce(this,"onPressedMoveEnd",null);Ce(this,"onMouseMove",null);Ce(this,"onMouseEnter",null);Ce(this,"onMouseLeave",null);Ce(this,"onRemoved",null);Ce(this,"onSelected",null);Ce(this,"onDeselected",null);Ce(this,"_prevZLevel",0);Ce(this,"_prevOverlay");Ce(this,"_prevPressedPoint",null);Ce(this,"_prevPressedPoints",[]);this.override(e)}override(e){var c;this._prevOverlay=th(this);const{id:t,name:o,currentStep:i,points:r,styles:a,...l}=e;if(Op(this,l),au(this.name)||(this.name=o??""),!au(this.id)&&au(t)&&(this.id=t),_o(a)&&(this.styles??(this.styles={}),Op(this.styles,a)),pm(r)&&r.length>0){let d=0;if(this.points=[...r],r.length>=this.totalStep-1?(this.currentStep=Ch,d=this.totalStep-1):(this.currentStep=r.length+1,d=r.length),pf(this.performEventMoveForDrawing))for(let p=0;p<d;p++)this.performEventMoveForDrawing({currentStep:p+2,mode:this.mode,points:this.points,performPointIndex:p,performPoint:this.points[p]});this.currentStep===Ch&&((c=this.performEventPressedMove)==null||c.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}))}}getPrevZLevel(){return this._prevZLevel}setPrevZLevel(e){this._prevZLevel=e}shouldUpdate(){const e=this._prevOverlay.zLevel!==this.zLevel,t=e||JSON.stringify(this._prevOverlay.points)!==JSON.stringify(this.points)||this._prevOverlay.visible!==this.visible||this._prevOverlay.extendData!==this.extendData||this._prevOverlay.styles!==this.styles;return{sort:e,draw:t}}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=Ch:this.currentStep++}forceComplete(){this.currentStep=Ch}isDrawing(){return this.currentStep!==Ch}isStart(){return this.currentStep===qy}eventMoveForDrawing(e){var i;const t=this.currentStep-1,o={};fl(e.timestamp)&&(o.timestamp=e.timestamp),fl(e.dataIndex)&&(o.dataIndex=e.dataIndex),fl(e.value)&&(o.value=e.value),this.points[t]=o,(i=this.performEventMoveForDrawing)==null||i.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:t,performPoint:o})}eventPressedPointMove(e,t){var o;this.points[t].timestamp=e.timestamp,fl(e.value)&&(this.points[t].value=e.value),(o=this.performEventPressedMove)==null||o.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:t,performPoint:this.points[t]})}startPressedMove(e){this._prevPressedPoint={...e},this._prevPressedPoints=th(this.points)}eventPressedOtherMove(e,t){if(this._prevPressedPoint!==null){let o=null;fl(e.dataIndex)&&fl(this._prevPressedPoint.dataIndex)&&(o=e.dataIndex-this._prevPressedPoint.dataIndex);let i=null;fl(e.value)&&fl(this._prevPressedPoint.value)&&(i=e.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map(r=>{fl(r.timestamp)&&(r.dataIndex=t.timestampToDataIndex(r.timestamp));const a={...r};return fl(o)&&fl(r.dataIndex)&&(a.dataIndex=r.dataIndex+o,a.timestamp=t.dataIndexToTimestamp(a.dataIndex)??void 0),fl(i)&&fl(r.value)&&(a.value=r.value+i),a})}}static extend(e){class t extends x_{constructor(){super(e)}}return t}}const v3={name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:n,coordinates:e,bounding:t,overlay:o,yAxis:i})=>{var a;const r=o.points;if(e.length>0){let l=0;(i==null?void 0:i.isInCandle())??!0?l=((a=n.getSymbol())==null?void 0:a.pricePrecision)??Tv.PRICE:n.getIndicators({paneId:o.paneId}).forEach(_=>{l=Math.max(l,_.precision)});const c=[],d=[],p=0,m=t.width;if(e.length>1&&fl(r[0].value)&&fl(r[1].value)){const h=[1,.786,.618,.5,.382,.236,0],_=e[0].y-e[1].y,w=r[0].value-r[1].value;h.forEach(S=>{const P=e[1].y+_*S,I=n.getDecimalFold().format(n.getThousandsSeparator().format(((r[1].value??0)+w*S).toFixed(l)));c.push({coordinates:[{x:p,y:P},{x:m,y:P}]}),d.push({x:p,y:P,text:`${I} (${(S*100).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:c},{type:"text",isCheckEvent:!1,attrs:d}]}return[]}},f3={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const t={x:0,y:n[0].y};return _o(n[1])&&n[0].x<n[1].x&&(t.x=e.width),[{type:"line",attrs:{coordinates:[n[0],t]}}]},performEventPressedMove:({points:n,performPoint:e})=>{n[0].value=e.value,n[1].value=e.value},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].value=t.value)}},m3={name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const e=[];return n.length===2&&e.push({coordinates:n}),[{type:"line",attrs:e}]},performEventPressedMove:({points:n,performPoint:e})=>{n[0].value=e.value,n[1].value=e.value},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].value=t.value)}},g3={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:0,y:n[0].y},{x:e.width,y:n[0].y}]}}]};class ty{constructor(){Ce(this,"_children",[]);Ce(this,"_callbacks",new Map)}registerEvent(e,t){return this._callbacks.set(e,t),this}onEvent(e,t){const o=this._callbacks.get(e);return _o(o)&&this.checkEventOn(t)?o(t):!1}dispatchEventToChildren(e,t){const o=this._children.length-1;if(o>-1){for(let i=o;i>-1;i--)if(this._children[i].dispatchEvent(e,t))return!0}return!1}dispatchEvent(e,t){return this.dispatchEventToChildren(e,t)?!0:this.onEvent(e,t)}addChild(e){return this._children.push(e),this}clear(){this._children=[]}}const vv=2;class w_ extends ty{constructor(t){super();Ce(this,"attrs");Ce(this,"styles");this.attrs=t.attrs,this.styles=t.styles}checkEventOn(t){return this.checkEventOnImp(t,this.attrs,this.styles)}setAttrs(t){return this.attrs=t,this}setStyles(t){return this.styles=t,this}draw(t){this.drawImp(t,this.attrs,this.styles)}static extend(t){class o extends w_{checkEventOnImp(r,a,l){return t.checkEventOn(r,a,l)}drawImp(r,a,l){t.draw(r,a,l)}}return o}}function H2(n,e){let t=[];t=t.concat(e);for(const o of t){const{coordinates:i}=o;if(i.length>1)for(let r=1;r<i.length;r++){const a=i[r-1],l=i[r];if(a.x===l.x){if(Math.abs(a.y-n.y)+Math.abs(l.y-n.y)-Math.abs(a.y-l.y)<vv+vv&&Math.abs(n.x-a.x)<vv)return!0}else{const c=k_(a,l),d=ny(c,n),p=Math.abs(d-n.y);if(Math.abs(a.x-n.x)+Math.abs(l.x-n.x)-Math.abs(a.x-l.x)<vv+vv&&p*p/(c[0]*c[0]+1)<vv*vv)return!0}}}return!1}function ny(n,e){return n!==null?e.x*n[0]+n[1]:e.y}function Kh(n,e,t){const o=k_(n,e);return ny(o,t)}function k_(n,e){const t=n.x-e.x;if(t!==0){const o=(n.y-e.y)/t,i=n.y-o*n.x;return[o,i]}return null}function U2(n,e,t){const o=e.length,i=fl(t)?t>0&&t<1?t:0:t?.5:0;if(i>0&&o>2){let r=e[0].x,a=e[0].y;for(let c=1;c<o-1;c++){const d=e[c-1],p=e[c],m=e[c+1],h=p.x-d.x,_=p.y-d.y,w=m.x-p.x,S=m.y-p.y;let P=m.x-d.x,I=m.y-d.y;const C=Math.sqrt(h*h+_*_),M=Math.sqrt(w*w+S*S),F=M/(M+C);let V=p.x+P*i*F,j=p.y+I*i*F;V=Math.min(V,Math.max(m.x,p.x)),j=Math.min(j,Math.max(m.y,p.y)),V=Math.max(V,Math.min(m.x,p.x)),j=Math.max(j,Math.min(m.y,p.y)),P=V-p.x,I=j-p.y;let D=p.x-P*C/M,R=p.y-I*C/M;D=Math.min(D,Math.max(d.x,p.x)),R=Math.min(R,Math.max(d.y,p.y)),D=Math.max(D,Math.min(d.x,p.x)),R=Math.max(R,Math.min(d.y,p.y)),P=p.x-D,I=p.y-R,V=p.x+P*M/C,j=p.y+I*M/C,n.bezierCurveTo(r,a,D,R,p.x,p.y),r=V,a=j}const l=e[o-1];n.bezierCurveTo(r,a,l.x,l.y,l.x,l.y)}else for(let r=1;r<o;r++)n.lineTo(e[r].x,e[r].y)}function h3(n,e,t){let o=[];o=o.concat(e);const{style:i="solid",smooth:r=!1,size:a=1,color:l="currentColor",dashedValue:c=[2,2]}=t;n.lineWidth=a,n.strokeStyle=l,i==="dashed"?n.setLineDash(c):n.setLineDash([]);const d=a%2===1?.5:0;o.forEach(({coordinates:p})=>{p.length>1&&(p.length===2&&(p[0].x===p[1].x||p[0].y===p[1].y)?(n.beginPath(),p[0].x===p[1].x?(n.moveTo(p[0].x+d,p[0].y),n.lineTo(p[1].x+d,p[1].y)):(n.moveTo(p[0].x,p[0].y+d),n.lineTo(p[1].x,p[1].y+d)),n.stroke(),n.closePath()):(n.save(),a%2===1&&n.translate(.5,.5),n.beginPath(),n.moveTo(p[0].x,p[0].y),U2(n,p,r),n.stroke(),n.closePath(),n.restore()))})}const _3={name:"line",checkEventOn:H2,draw:(n,e,t)=>{h3(n,e,t)}};function G2(n,e,t){const o=t??0,i=[];if(n.length>1)if(n[0].x===n[1].x){const a=e.height;if(i.push({coordinates:[{x:n[0].x,y:0},{x:n[0].x,y:a}]}),n.length>2){i.push({coordinates:[{x:n[2].x,y:0},{x:n[2].x,y:a}]});const l=n[0].x-n[2].x;for(let c=0;c<o;c++){const d=l*(c+1);i.push({coordinates:[{x:n[0].x+d,y:0},{x:n[0].x+d,y:a}]})}}}else{const a=e.width,l=k_(n[0],n[1]),c=l[0],d=l[1];if(i.push({coordinates:[{x:0,y:0*c+d},{x:a,y:a*c+d}]}),n.length>2){const p=n[2].y-c*n[2].x;i.push({coordinates:[{x:0,y:0*c+p},{x:a,y:a*c+p}]});const m=d-p;for(let h=0;h<o;h++){const _=d+m*(h+1);i.push({coordinates:[{x:0,y:0*c+_},{x:a,y:a*c+_}]})}}}return i}const y3={name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>[{type:"line",attrs:G2(n,e)}]},b3={name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>[{type:"line",attrs:G2(n,e,1)}]},x3={name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:n,coordinates:e,bounding:t,overlay:o,yAxis:i})=>{var l;let r=0;(i==null?void 0:i.isInCandle())??!0?r=((l=n.getSymbol())==null?void 0:l.pricePrecision)??Tv.PRICE:n.getIndicators({paneId:o.paneId}).forEach(d=>{r=Math.max(r,d.precision)});const{value:a=0}=o.points[0];return[{type:"line",attrs:{coordinates:[e[0],{x:t.width,y:e[0].y}]}},{type:"text",ignoreEvent:!0,attrs:{x:e[0].x,y:e[0].y,text:n.getDecimalFold().format(n.getThousandsSeparator().format(a.toFixed(r))),baseline:"bottom"}}]}};function w3(n,e){if(n.length>1){let t={x:0,y:0};return n[0].x===n[1].x&&n[0].y!==n[1].y?n[0].y<n[1].y?t={x:n[0].x,y:e.height}:t={x:n[0].x,y:0}:n[0].x>n[1].x?t={x:0,y:Kh(n[0],n[1],{x:0,y:n[0].y})}:t={x:e.width,y:Kh(n[0],n[1],{x:e.width,y:n[0].y})},{coordinates:[n[0],t]}}return[]}const k3={name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>[{type:"line",attrs:w3(n,e)}]},S3={name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length===2?[{type:"line",attrs:{coordinates:n}}]:[]},C3={name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>n.length===2?n[0].x===n[1].x?[{type:"line",attrs:{coordinates:[{x:n[0].x,y:0},{x:n[0].x,y:e.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:Kh(n[0],n[1],{x:0,y:n[0].y})},{x:e.width,y:Kh(n[0],n[1],{x:e.width,y:n[0].y})}]}}]:[]},P3={name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{if(n.length===2){const t={x:n[0].x,y:0};return n[0].y<n[1].y&&(t.y=e.height),[{type:"line",attrs:{coordinates:[n[0],t]}}]}return[]},performEventPressedMove:({points:n,performPoint:e})=>{n[0].timestamp=e.timestamp,n[0].dataIndex=e.dataIndex,n[1].timestamp=e.timestamp,n[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex)}},I3={name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length===2?[{type:"line",attrs:{coordinates:n}}]:[],performEventPressedMove:({points:n,performPoint:e})=>{n[0].timestamp=e.timestamp,n[0].dataIndex=e.dataIndex,n[1].timestamp=e.timestamp,n[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex)}},M3={name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:n[0].x,y:0},{x:n[0].x,y:e.height}]}}]},A3={name:"simpleAnnotation",totalStep:2,styles:{line:{style:"dashed"}},createPointFigures:({overlay:n,coordinates:e})=>{let t="";_o(n.extendData)&&(pf(n.extendData)?t=n.extendData(n):t=n.extendData??"");const o=e[0].x,i=e[0].y-6,r=i-50,a=r-5;return[{type:"line",attrs:{coordinates:[{x:o,y:i},{x:o,y:r}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:o,y:r},{x:o-4,y:a},{x:o+4,y:a}]},ignoreEvent:!0},{type:"text",attrs:{x:o,y:a,text:t,align:"center",baseline:"bottom"},ignoreEvent:!0}]}},T3={name:"simpleTag",totalStep:2,styles:{line:{style:"dashed"}},createPointFigures:({bounding:n,coordinates:e})=>({type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:n.width,y:e[0].y}]},ignoreEvent:!0}),createYAxisFigures:({chart:n,overlay:e,coordinates:t,bounding:o,yAxis:i})=>{var d;const r=(i==null?void 0:i.isFromZero())??!1;let a="left",l=0;r?(a="left",l=0):(a="right",l=o.width);let c="";return _o(e.extendData)&&(pf(e.extendData)?c=e.extendData(e):c=e.extendData??""),!_o(c)&&fl(e.points[0].value)&&(c=Mv(e.points[0].value,((d=n.getSymbol())==null?void 0:d.pricePrecision)??Tv.PRICE)),{type:"text",attrs:{x:l,y:t[0].y,text:c,align:a,baseline:"middle"}}}},oy={},L3=[v3,f3,m3,g3,y3,b3,x3,k3,S3,C3,P3,I3,M3,A3,T3];L3.forEach(n=>{oy[n.name]=x_.extend(n)});function Y2(n){oy[n.name]=x_.extend(n)}function F3(n){return oy[n]??null}const $3={grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},title:{color:"#76808F"},legend:{color:"#76808F"}}},indicator:{tooltip:{title:{color:"#76808F"},legend:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},E3={grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},title:{color:"#929AA5"},legend:{color:"#929AA5"}}},indicator:{tooltip:{title:{color:"#929AA5"},legend:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}},N3={light:$3,dark:E3};function D3(n){return N3[n]??null}const Z0=30,K2=100,nd={CANDLE:"candle_pane",INDICATOR:"indicator_pane_",X_AXIS:"x_axis_pane"},Hy={MIN:1,MAX:500},j3=10,R3=80,B3=.2,E1=10,Zu=24*60*60*1e3;function U_(n){if(n.length===0)return 0;const e=n.slice().sort((t,o)=>t-o);return e[Math.floor(e.length/2)]}function G_(n,e){if(n.length===0)return 0;const t=Math.max(0,Math.min(1,e)),o=Math.floor(t*(n.length-1));return n[o]}function O3(n){if(n.length===0)return 0;let e=0,t=0;for(const r of n){const a=2*Math.PI*(r/Zu);e+=Math.sin(a),t+=Math.cos(a)}const o=Math.atan2(e/n.length,t/n.length);return(o<0?o+2*Math.PI:o)/(2*Math.PI)*Zu}function $g(n,e){return Math.floor((n-e)/Zu)*Zu+e}function oh(n){return new Date(n).getUTCDay()}function Z2(n,e,t){if(e<=0)return 0;const o=t.reduce((l,c)=>l+(c?1:0),0);if(o<=0)return 0;let r=Math.floor(e/7)*o;const a=e%7;for(let l=0;l<a;l++){const c=(n+1+l)%7;t[c]&&r++}return r}function z3(n,e,t){if(e<=0)return 0;const o=t.reduce((l,c)=>l+(c?1:0),0);if(o<=0)return 0;let r=Math.floor(e/7)*o;const a=e%7;for(let l=0;l<a;l++){const c=(n+7-(1+l)%7)%7;t[c]&&r++}return r}function V3(n){try{if(!Array.isArray(n)||n.length<20)return null;const e=n.slice(Math.max(0,n.length-2500)),t=[];for(const F of e){const V=F==null?void 0:F.timestamp;typeof V=="number"&&isFinite(V)&&t.push(V)}if(t.length<20)return null;t.sort((F,V)=>F-V);const o=[];for(let F=1;F<t.length;F++){const V=t[F]-t[F-1];V>0&&isFinite(V)&&o.push(V)}if(o.length<10)return null;o.sort((F,V)=>F-V);const i=G_(o,.1)||o[0];if(!i||!isFinite(i)||i<=0)return null;const r=Math.max(i*6,i*3+6e4),a=[];for(let F=1;F<t.length;F++)if(t[F]-t[F-1]>r){const D=((t[F]+t[F-1])/2%Zu+Zu)%Zu;a.push(D)}const l=a.length>=4?O3(a):0,c=new Map;for(const F of t){const V=$g(F,l),j=c.get(V);j?(j.count++,F<j.minTs&&(j.minTs=F),F>j.maxTs&&(j.maxTs=F)):c.set(V,{minTs:F,maxTs:F,count:1})}const d=Array.from(c.keys()).sort((F,V)=>F-V),p=d.slice(Math.max(0,d.length-40)),m=[],h=[],_=new Array(7).fill(!1),w=[];for(const F of p){const V=c.get(F);V!=null&&V.count&&w.push(V.count)}const S=U_(w.filter(F=>F>0)),P=Math.max(2,Math.floor(S*.6));for(const F of p){const V=c.get(F);if(!V)continue;const j=oh(F);_[j]=!0;const D=V.minTs-F,R=V.maxTs-F+i;V.count>=P&&isFinite(D)&&isFinite(R)&&D>=0&&R>=0&&D<Zu&&R<=Zu&&R>D&&(m.push(D),h.push(R))}let I=0,C=Zu;if(m.length>=5&&h.length>=5)I=U_(m),C=U_(h);else{const F=[];for(const D of t){const R=((D-l)%Zu+Zu)%Zu;F.push(R)}F.sort((D,R)=>D-R);const V=G_(F,.05),j=G_(F,.95);I=V,C=Math.min(Zu,j+i)}if(I>=0&&C>I&&C<=Zu||(I=0,C=Zu),C-I>Zu*.92&&(I=0,C=Zu),!_.some(Boolean))for(let F=0;F<7;F++)_[F]=!0;return{boundaryOffsetMs:l,openMs:I,closeMs:C,activeWeekdays:_}}catch{return null}}function Y_(n,e,t){if(n===e)return 0;let o=1,i=n,r=e;i>r&&(o=-1,i=e,r=n);const{boundaryOffsetMs:a,openMs:l,closeMs:c,activeWeekdays:d}=t,p=Math.max(0,c-l);if(p<=0)return 0;const m=$g(i,a),h=$g(r,a),_=i-m,w=r-h,S=oh(m),P=oh(h);if(m===h){if(!d[S])return 0;const F=Math.max(_,l),V=Math.min(w,c);return o*Math.max(0,V-F)}let I=0;d[S]&&(I+=Math.max(0,c-Math.max(_,l))),d[P]&&(I+=Math.max(0,Math.min(w,c)-l));const C=Math.max(0,Math.round((h-m)/Zu)),M=Math.max(0,C-1);if(M>0){const F=Z2(S,M,d);I+=F*p}return o*I}function Wh(n,e,t){let o=n,i=e;for(let r=0;r<14;r++)if(o+=Zu,i=(i+1)%7,t[i])return{dayStart:o,weekday:i};return{dayStart:n+Zu,weekday:(e+1)%7}}function qh(n,e,t){let o=n,i=e;for(let r=0;r<14;r++)if(o-=Zu,i=(i+6)%7,t[i])return{dayStart:o,weekday:i};return{dayStart:n-Zu,weekday:(e+6)%7}}function K_(n,e,t){if(e===0||!Number.isFinite(e))return n;const{boundaryOffsetMs:o,openMs:i,closeMs:r,activeWeekdays:a}=t;if(Math.max(0,r-i)<=0)return n;let c=n,d=e;const p=d>0;for(d=Math.abs(d);d>0;){let m=$g(c,o),h=oh(m),_=c-m;if(!a[h]){const w=p?Wh(m,h,a):qh(m,h,a);m=w.dayStart,h=w.weekday,_=p?i:r,c=m+_}if(p){if(_<i)_=i,c=m+_;else if(_>=r){const P=Wh(m,h,a);m=P.dayStart,h=P.weekday,_=i,c=m+_}const w=Math.max(0,r-_);if(d<w)return c+d;d-=w,c=Wh(m,h,a).dayStart+i}else{if(_>r)_=r,c=m+_;else if(_<=i){const P=qh(m,h,a);m=P.dayStart,h=P.weekday,_=r,c=m+_}const w=Math.max(0,_-i);if(d<w)return c-d;d-=w,c=qh(m,h,a).dayStart+r}}return c}function W3(n,e,t){if(n===e)return 0;const{boundaryOffsetMs:o,activeWeekdays:i}=t,r=$g(n,o),a=$g(e,o);if(r===a)return 0;const l=oh(r),c=Math.round((a-r)/Zu);return c>0?Z2(l,c,i):-z3(l,Math.abs(c),i)}function q3(n,e,t){if(e===0||!Number.isFinite(e))return n;const{boundaryOffsetMs:o,activeWeekdays:i}=t,r=i.reduce((h,_)=>h+(_?1:0),0);if(r<=0)return n;let a=$g(n,o),l=oh(a),c=n-a;if(!i[l])if(e>0){const h=Wh(a,l,i);a=h.dayStart,l=h.weekday}else{const h=qh(a,l,i);a=h.dayStart,l=h.weekday}let d=Math.abs(e);const p=e>0,m=Math.floor(d/r);for(m>0&&(a+=(p?1:-1)*m*7*Zu,d-=m*r);d>0;){const h=p?Wh(a,l,i):qh(a,l,i);a=h.dayStart,l=h.weekday,d--}return c=Math.max(0,Math.min(Zu-1,c)),a+c}class H3{constructor(e,t){Ce(this,"_chart");Ce(this,"_styles",Dk());Ce(this,"_formatter",{formatDate:({dateTimeFormat:e,timestamp:t,template:o})=>B2(e,t,o),formatBigNumber:O2,formatExtendText:e=>""});Ce(this,"_innerFormatter",{formatDate:(e,t,o)=>this._formatter.formatDate({dateTimeFormat:this._dateTimeFormat,timestamp:e,template:t,type:o}),formatBigNumber:e=>this._formatter.formatBigNumber(e),formatExtendText:e=>this._formatter.formatExtendText(e)});Ce(this,"_locale","en-US");Ce(this,"_thousandsSeparator",{sign:",",format:e=>z2(e,this._thousandsSeparator.sign)});Ce(this,"_decimalFold",{threshold:3,format:e=>V2(e,this._decimalFold.threshold)});Ce(this,"_symbol",null);Ce(this,"_period",null);Ce(this,"_sessionCacheKey",null);Ce(this,"_sessionCache",null);Ce(this,"_sessionBySymbol",new Map);Ce(this,"_dataList",[]);Ce(this,"_dataLoader",null);Ce(this,"_loading",!1);Ce(this,"_dataLoadMore",{forward:!1,backward:!1});Ce(this,"_dateTimeFormat");Ce(this,"_zoomEnabled",!0);Ce(this,"_scrollEnabled",!0);Ce(this,"_totalBarSpace",0);Ce(this,"_barSpace",j3);Ce(this,"_gapBarSpace",0);Ce(this,"_offsetRightDistance",R3);Ce(this,"_lastBarRightSideDiffBarCount");Ce(this,"_startLastBarRightSideDiffBarCount",0);Ce(this,"_scrollLimitRole","bar_count");Ce(this,"_minVisibleBarCount",{left:2,right:2});Ce(this,"_maxOffsetDistance",{left:50,right:50});Ce(this,"_visibleRange",Oy());Ce(this,"_visibleRangeDataList",[]);Ce(this,"_visibleRangeHighLowPrice",[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}]);Ce(this,"_crosshair",{});Ce(this,"_actions",new Map);Ce(this,"_indicators",new Map);Ce(this,"_taskScheduler",new Mk);Ce(this,"_overlays",new Map);Ce(this,"_progressOverlayInfo",null);Ce(this,"_lastPriceMarkExtendTextUpdateTimers",[]);Ce(this,"_pressedOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});Ce(this,"_hoverOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});Ce(this,"_clickOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});Ce(this,"_layoutRafId",null);Ce(this,"_pendingLayoutOptions",{measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1});Ce(this,"_overlayRafId",null);Ce(this,"_perfScrollCalls",0);Ce(this,"_perfZoomCalls",0);Ce(this,"_perfLayoutSchedules",0);Ce(this,"_perfLastWindowTs",typeof performance<"u"?performance.now():Date.now());this._chart=e,this._calcOptimalBarSpace(),this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace;const{styles:o,locale:i,timezone:r,formatter:a,thousandsSeparator:l,decimalFold:c}=t??{};_o(o)&&this.setStyles(o),au(i)&&this.setLocale(i),this.setTimezone(r??""),_o(a)&&this.setFormatter(a),_o(l)&&this.setThousandsSeparator(l),_o(c)&&this.setDecimalFold(c)}setStyles(e){var o,i,r,a,l,c;let t=null;if(au(e)?t=D3(e):t=e,Op(this._styles,t),pm((r=(i=(o=t==null?void 0:t.candle)==null?void 0:o.tooltip)==null?void 0:i.legend)==null?void 0:r.template)&&(this._styles.candle.tooltip.legend.template=t.candle.tooltip.legend.template),_o((c=(l=(a=t==null?void 0:t.candle)==null?void 0:a.priceMark)==null?void 0:l.last)==null?void 0:c.extendTexts)){this._clearLastPriceMarkExtendTextUpdateTimer();const d=[];this._styles.candle.priceMark.last.extendTexts.forEach(p=>{const m=p.updateInterval;if(p.show&&m>0&&!d.includes(m)){d.push(m);const h=setInterval(()=>{this._chart.updatePane(fu.Main,nd.CANDLE)},m);this._lastPriceMarkExtendTextUpdateTimers.push(h)}})}}getStyles(){return this._styles}setFormatter(e){Op(this._formatter,e)}getFormatter(){return this._formatter}getInnerFormatter(){return this._innerFormatter}setLocale(e){this._locale=e}getLocale(){return this._locale}setTimezone(e){if(!_o(this._dateTimeFormat)||this.getTimezone()!==e){const t={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};e.length>0&&(t.timeZone=e);let o=null;try{o=new Intl.DateTimeFormat("en",t)}catch{}o!==null&&(this._dateTimeFormat=o)}}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getDateTimeFormat(){return this._dateTimeFormat}setThousandsSeparator(e){Op(this._thousandsSeparator,e)}getThousandsSeparator(){return this._thousandsSeparator}setDecimalFold(e){Op(this._decimalFold,e)}getDecimalFold(){return this._decimalFold}setSymbol(e){this.resetData(()=>{this._symbol={pricePrecision:Tv.PRICE,volumePrecision:Tv.VOLUME,...this._symbol,...e},this._synchronizeIndicatorSeriesPrecision()})}getSymbol(){return this._symbol}setPeriod(e){this.resetData(()=>{this._period=e})}getPeriod(){return this._period}_getSessionSymbolKey(){var o,i;const e=(o=this._symbol)==null?void 0:o.ticker;if(!e||typeof e!="string")return"";const t=(i=this._symbol)==null?void 0:i.exchange;return`${typeof t=="string"?t:""}:${e}`}_getInferredSession(){var e,t;try{const o=this._getSessionSymbolKey(),i=this._dataList.length,r=i>0?(e=this._dataList[0])==null?void 0:e.timestamp:0,a=i>0?(t=this._dataList[i-1])==null?void 0:t.timestamp:0,l=`${o}|${i}|${r}|${a}`;if(this._sessionCacheKey===l)return this._sessionCache;let c=V3(this._dataList);return c&&o?this._sessionBySymbol.set(o,c):!c&&o&&(c=this._sessionBySymbol.get(o)??null),this._sessionCacheKey=l,this._sessionCache=c,c}catch{return null}}_refineDataIndexByTimestamp(e,t,o){const i=Math.max(0,Math.min(50,Math.floor(o)));let r=t,a=Number.POSITIVE_INFINITY;for(let l=t-i;l<=t+i;l++){const c=this.dataIndexToTimestamp(l);if(!fl(c))continue;const d=Math.abs(c-e);d<a&&(a=d,r=l)}return r}_inferPeriodFromData(){const e=this._dataList.length;if(e<2)return null;const t=this._dataList[e-2].timestamp,o=this._dataList[e-1].timestamp,i=Math.max(1,o-t),r=1e3,a=60*r,l=60*a,c=24*l,d=7*c,p=30*c,m=365*c,h=[{type:"second",unit:r},{type:"minute",unit:a},{type:"hour",unit:l},{type:"day",unit:c},{type:"week",unit:d},{type:"month",unit:p},{type:"year",unit:m}];let _=null,w=Number.MAX_VALUE;for(const S of h){const P=Math.max(1,Math.round(i/S.unit)),I=P*S.unit,C=Math.abs(I-i);C<w&&(w=C,_={type:S.type,span:P})}return _}getDataList(){return this._dataList}getVisibleRangeDataList(){return this._visibleRangeDataList}getVisibleRangeHighLowPrice(){return this._visibleRangeHighLowPrice}_addData(e,t,o){let i=!1,r=!1,a=0;if(pm(e)){const l={backward:!1,forward:!1};switch(Yh(o)?(l.backward=o,l.forward=o):(l.backward=(o==null?void 0:o.backward)??!1,l.forward=(o==null?void 0:o.forward)??!1),a=e.length,t){case"init":{this._clearData(),this._dataList=e,this._dataLoadMore.backward=l.backward,this._dataLoadMore.forward=l.forward,this.setOffsetRightDistance(this._offsetRightDistance),r=!0;break}case"backward":{this._dataList=this._dataList.concat(e),this._dataLoadMore.backward=l.backward,this._lastBarRightSideDiffBarCount-=a,r=a>0;break}case"forward":{this._dataList=e.concat(this._dataList),this._dataLoadMore.forward=l.forward,r=a>0;break}}i=!0}else{const l=this._dataList.length,c=e.timestamp,d=nv(this._dataList[l-1],"timestamp",0);if(c>d){this._dataList.push(e);let p=this.getLastBarRightSideDiffBarCount();p<0&&this.setLastBarRightSideDiffBarCount(--p),a=1,i=!0,r=!0}else c===d&&(this._dataList[l-1]=e,i=!0,r=!0)}i&&r&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this.getIndicatorsByFilter({}).forEach(c=>{this._addIndicatorCalcTask(c,t)}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:t!=="init"}))}setDataLoader(e){this.resetData(()=>{this._dataLoader=e})}_calcOptimalBarSpace(){const t=1-B3*Math.atan(Math.max(4,this._barSpace)-4)/(Math.PI*.5);let o=Math.min(Math.floor(this._barSpace*t),Math.floor(this._barSpace));o%2===0&&o+2>=this._barSpace&&--o,this._gapBarSpace=Math.max(1,o)}_adjustVisibleRange(){const e=this._dataList.length,t=this._totalBarSpace/this._barSpace;let o=0,i=0;this._scrollLimitRole==="distance"?(o=(this._totalBarSpace-this._maxOffsetDistance.right)/this._barSpace,i=(this._totalBarSpace-this._maxOffsetDistance.left)/this._barSpace):(o=this._minVisibleBarCount.left,i=this._minVisibleBarCount.right),o=Math.max(0,o),i=Math.max(0,i);const r=t-Math.min(o,e);this._lastBarRightSideDiffBarCount>r&&(this._lastBarRightSideDiffBarCount=r);const a=-e+Math.min(i,e);this._lastBarRightSideDiffBarCount<a&&(this._lastBarRightSideDiffBarCount=a);let l=Math.round(this._lastBarRightSideDiffBarCount+e+.5);const c=l;l>e&&(l=e);let d=Math.round(l-t)-1;d<0&&(d=0);const p=this._lastBarRightSideDiffBarCount>0?Math.round(e+this._lastBarRightSideDiffBarCount-t)-1:d;this._visibleRange={from:d,to:l,realFrom:p,realTo:c},this.executeAction("onVisibleRangeChange",this._visibleRange),this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}];for(let m=p;m<c;m++){const h=this._dataList[m],_=this.dataIndexToCoordinate(m);this._visibleRangeDataList.push({dataIndex:m,x:_,data:{prev:this._dataList[m-1]??h,current:h,next:this._dataList[m+1]??h}}),_o(h)&&(this._visibleRangeHighLowPrice[0].price<h.high&&(this._visibleRangeHighLowPrice[0].price=h.high,this._visibleRangeHighLowPrice[0].x=_),this._visibleRangeHighLowPrice[1].price>h.low&&(this._visibleRangeHighLowPrice[1].price=h.low,this._visibleRangeHighLowPrice[1].x=_))}d===0?this._dataLoadMore.forward&&this._processDataLoad("forward"):l===e&&this._dataLoadMore.backward&&this._processDataLoad("backward")}_processDataLoad(e){var t,o;if(!this._loading&&_o(this._dataLoader)&&_o(this._symbol)&&_o(this._period)){this._loading=!0,console.warn("ℹ️ klinecharts: data load triggered",{type:e});const i={type:e,symbol:this._symbol,period:this._period,timestamp:null,callback:(r,a)=>{var c,d;this._loading=!1,!(pm(r)&&r.length>0)&&(e==="forward"?this._dataLoadMore.forward=!1:e==="backward"&&(this._dataLoadMore.backward=!1)),this._addData(r,e,a),e==="init"&&((d=(c=this._dataLoader)==null?void 0:c.subscribeBar)==null||d.call(c,{symbol:this._symbol,period:this._period,callback:p=>{this._addData(p,"update")}}))}};switch(e){case"backward":{i.timestamp=((t=this._dataList[this._dataList.length-1])==null?void 0:t.timestamp)??null;break}case"forward":{i.timestamp=((o=this._dataList[0])==null?void 0:o.timestamp)??null;break}}try{this._dataLoader.getBars(i)}catch(r){this._loading=!1,console.warn("⚠️ klinecharts: getBars threw",r)}}}_processDataUnsubscribe(){var e,t;_o(this._dataLoader)&&_o(this._symbol)&&_o(this._period)&&((t=(e=this._dataLoader).unsubscribeBar)==null||t.call(e,{symbol:this._symbol,period:this._period}))}resetData(e){this._processDataUnsubscribe(),e==null||e(),this._loading=!1,this._processDataLoad("init")}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:Math.floor(this._gapBarSpace/2)}}setBarSpace(e,t){e<Hy.MIN||e>Hy.MAX||this._barSpace===e||(this._barSpace=e,this._calcOptimalBarSpace(),t==null||t(),this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}setTotalBarSpace(e){this._totalBarSpace!==e&&(this._totalBarSpace=e,this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}setOffsetRightDistance(e,t){return this._offsetRightDistance=this._scrollLimitRole==="distance"?Math.min(this._maxOffsetDistance.right,e):e,this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace,(t??!1)&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0})),this}getInitialOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightDistance(){return Math.max(0,this._lastBarRightSideDiffBarCount*this._barSpace)}getLastBarRightSideDiffBarCount(){return this._lastBarRightSideDiffBarCount}setLastBarRightSideDiffBarCount(e){this._lastBarRightSideDiffBarCount=e}setMaxOffsetLeftDistance(e){this._scrollLimitRole="distance",this._maxOffsetDistance.left=e}setMaxOffsetRightDistance(e){this._scrollLimitRole="distance",this._maxOffsetDistance.right=e}setLeftMinVisibleBarCount(e){this._scrollLimitRole="bar_count",this._minVisibleBarCount.left=e}setRightMinVisibleBarCount(e){this._scrollLimitRole="bar_count",this._minVisibleBarCount.right=e}getVisibleRange(){return this._visibleRange}startScroll(){this._startLastBarRightSideDiffBarCount=this._lastBarRightSideDiffBarCount}scroll(e){if(!this._scrollEnabled)return;const t=typeof performance<"u"?performance.now():Date.now();t-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=t),this._perfScrollCalls++,this._perfScrollCalls>80&&console.warn("⚠️ klinecharts: High-frequency scroll detected");const o=e/this._barSpace,i=this._lastBarRightSideDiffBarCount*this._barSpace;this._lastBarRightSideDiffBarCount=this._startLastBarRightSideDiffBarCount-o;const r=Math.round(i-this._lastBarRightSideDiffBarCount*this._barSpace);r!==0&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}),this.executeAction("onScroll",{distance:r}))}getDataByDataIndex(e){return this._dataList[e]??null}coordinateToFloatIndex(e){const t=this._dataList.length,o=(this._totalBarSpace-e)/this._barSpace,i=t+this._lastBarRightSideDiffBarCount-o;return Math.round(i*1e6)/1e6}dataIndexToTimestamp(e){const t=this._dataList.length;if(t===0)return null;const o=this.getDataByDataIndex(e);if(_o(o))return o.timestamp;if(_o(this._period)||this._dataList.length>0){const i=t-1;let r=null,a=0;if(e>i?(r=this._dataList[i].timestamp,a=e-i):e<0&&(r=this._dataList[0].timestamp,a=e),fl(r)){const l=this._period??this._inferPeriodFromData();if(_o(l)){const{type:c,span:d}=l;switch(c){case"second":{const p=this._getInferredSession();return p?K_(r,d*1e3*a,p):r+d*1e3*a}case"minute":{const p=this._getInferredSession();return p?K_(r,d*60*1e3*a,p):r+d*60*1e3*a}case"hour":{const p=this._getInferredSession();return p?K_(r,d*60*60*1e3*a,p):r+d*60*60*1e3*a}case"day":{const p=this._getInferredSession();return p?q3(r,d*a,p):r+d*24*60*60*1e3*a}case"week":return r+d*7*24*60*60*1e3*a;case"month":{const p=new Date(r),m=p.getDate();p.setDate(1),p.setMonth(p.getMonth()+d*a);const h=new Date(p.getFullYear(),p.getMonth()+1,0).getDate();return p.setDate(Math.min(m,h)),p.getTime()}case"year":{const p=new Date(r);return p.setFullYear(p.getFullYear()+d*a),p.getTime()}}}}}return null}timestampToDataIndex(e){const t=this._dataList.length;if(t===0)return 0;if(_o(this._period)||this._dataList.length>0){let o=null,i=0;const r=t-1,a=this._dataList[r].timestamp;e>a&&(o=a,i=r);const l=this._dataList[0].timestamp;if(e<l&&(o=l,i=0),fl(o)){const c=this._period??this._inferPeriodFromData();if(_o(c)){const{type:d,span:p}=c;switch(d){case"second":{const m=this._getInferredSession();if(m){const h=Y_(o,e,m),_=p*1e3,w=i+h/_;return Math.round(w*1e6)/1e6}return i+(e-o)/(p*1e3)}case"minute":{const m=this._getInferredSession();if(m){const h=Y_(o,e,m),_=p*60*1e3,w=i+h/_;return Math.round(w*1e6)/1e6}return i+(e-o)/(p*60*1e3)}case"hour":{const m=this._getInferredSession();if(m){const h=Y_(o,e,m),_=p*60*60*1e3,w=i+h/_;return Math.round(w*1e6)/1e6}return i+(e-o)/(p*60*60*1e3)}case"day":{const m=this._getInferredSession();if(m){const h=W3(o,e,m),_=i+Math.floor(h/p);return this._refineDataIndexByTimestamp(e,_,6)}return i+Math.floor((e-o)/(p*24*60*60*1e3))}case"week":return i+Math.floor((e-o)/(p*7*24*60*60*1e3));case"month":{const m=new Date(o),h=new Date(e),_=m.getFullYear(),w=h.getFullYear(),S=m.getMonth(),P=h.getMonth();return i+Math.floor(((w-_)*12+(P-S))/p)}case"year":{const m=new Date(o).getFullYear(),h=new Date(e).getFullYear();return i+Math.floor((h-m)/p)}}}}}return $1(this._dataList,"timestamp",e)}dataIndexToCoordinate(e){const o=this._dataList.length+this._lastBarRightSideDiffBarCount-e;return Math.floor(this._totalBarSpace-(o-.5)*this._barSpace+.5)}coordinateToDataIndex(e){return Math.ceil(this.coordinateToFloatIndex(e))-1}zoom(e,t){if(!this._zoomEnabled)return;const o=typeof performance<"u"?performance.now():Date.now();o-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=o),this._perfZoomCalls++,this._perfZoomCalls>60&&console.warn("⚠️ klinecharts: High-frequency zoom detected");let i=t??null;fl(i==null?void 0:i.x)||(i={x:this._crosshair.x??this._totalBarSpace/2});const r=i.x,a=this.coordinateToFloatIndex(r),l=this._barSpace,c=this._barSpace+e*(this._barSpace/E1);this.setBarSpace(c,()=>{this._lastBarRightSideDiffBarCount+=a-this.coordinateToFloatIndex(r)});const d=this._barSpace/l;d!==1&&this.executeAction("onZoom",{scale:d})}setZoomEnabled(e){this._zoomEnabled=e}isZoomEnabled(){return this._zoomEnabled}setScrollEnabled(e){this._scrollEnabled=e}isScrollEnabled(){return this._scrollEnabled}setCrosshair(e,t){const{notInvalidate:o,notExecuteAction:i,forceInvalidate:r}=t??{},a=e??{};let l=0,c=0;fl(a.x)?(l=this.coordinateToDataIndex(a.x),l<0?c=0:l>this._dataList.length-1?c=this._dataList.length-1:c=l):(l=this._dataList.length-1,c=l);const d=this._dataList[c],p=this.dataIndexToCoordinate(l),m={x:this._crosshair.x,y:this._crosshair.y,paneId:this._crosshair.paneId};this._crosshair={...a,realX:p,kLineData:d,realDataIndex:l,dataIndex:c,timestamp:this.dataIndexToTimestamp(l)??void 0},(m.x!==a.x||m.y!==a.y||m.paneId!==a.paneId||(r??!1))&&(_o(d)&&!(i??!1)&&this.hasAction("onCrosshairChange")&&au(this._crosshair.paneId)&&this.executeAction("onCrosshairChange",e),(o??!1)||this._scheduleOverlayUpdate())}getCrosshair(){return this._crosshair}executeAction(e,t){var o;(o=this._actions.get(e))==null||o.execute(t)}subscribeAction(e,t){var o;this._actions.has(e)||this._actions.set(e,new Ak),(o=this._actions.get(e))==null||o.subscribe(t)}unsubscribeAction(e,t){const o=this._actions.get(e);_o(o)&&(o.unsubscribe(t),o.isEmpty()&&this._actions.delete(e))}hasAction(e){const t=this._actions.get(e);return _o(t)&&!t.isEmpty()}_sortIndicators(e){var t;au(e)?(t=this._indicators.get(e))==null||t.sort((o,i)=>o.zLevel-i.zLevel):this._indicators.forEach(o=>{o.sort((i,r)=>i.zLevel-r.zLevel)})}_addIndicatorCalcTask(e,t){var o;(o=e.onDataStateChange)==null||o.call(e,{state:"loading",type:t,indicator:e}),this._taskScheduler.add({id:zy(e.id),handler:async()=>{const i=typeof performance<"u"?performance.now():Date.now(),r=await e.calcImp(this._dataList).then(c=>c),l=(typeof performance<"u"?performance.now():Date.now())-i;return l>50&&console.warn("⚠️ klinecharts: indicator calc slow",{name:e.name,durationMs:Math.round(l)}),r}}).then(i=>{var r;i&&(this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:t!=="init"}),(r=e.onDataStateChange)==null||r.call(e,{state:"ready",type:t,indicator:e}))}).catch(i=>{var r;i!=="canceled"&&((r=e.onDataStateChange)==null||r.call(e,{state:"error",type:t,indicator:e}))})}addIndicator(e,t,o){const{name:i}=e;if(this.getIndicatorsByFilter(e).length>0)return!1;let a=this.getIndicatorsByPaneId(t);const l=q2(i),c=new l;return this._synchronizeIndicatorSeriesPrecision(c),c.paneId=t,c.override(e),o||(this.removeIndicator({paneId:t}),a=[]),a.push(c),this._indicators.set(t,a),this._sortIndicators(t),this._addIndicatorCalcTask(c,"init"),!0}getIndicatorsByPaneId(e){return this._indicators.get(e)??[]}getIndicatorsByFilter(e){const{paneId:t,name:o,id:i}=e,r=_o(o)?o.split("(")[0].trim():void 0,a=c=>_o(i)?c.id===i:_o(r)?c.name===r||c.shortName===r:!0;let l=[];return _o(t)?l=l.concat(this.getIndicatorsByPaneId(t).filter(a)):this._indicators.forEach(c=>{l=l.concat(c.filter(a))}),l}removeIndicator(e){let t=!1;return this.getIndicatorsByFilter(e??{}).forEach(i=>{const r=this.getIndicatorsByPaneId(i.paneId),a=r.findIndex(l=>l.id===i.id);a>-1&&(this._taskScheduler.remove(zy(i.id)),r.splice(a,1),t=!0),r.length===0&&this._indicators.delete(i.paneId)}),t}hasIndicators(e){return this._indicators.has(e)}_synchronizeIndicatorSeriesPrecision(e){if(_o(this._symbol)){const{pricePrecision:t=Tv.PRICE,volumePrecision:o=Tv.VOLUME}=this._symbol,i=r=>{switch(r.series){case"price":{r.setSeriesPrecision(t);break}case"volume":{r.setSeriesPrecision(o);break}}};_o(e)?i(e):this._indicators.forEach(r=>{r.forEach(a=>{i(a)})})}}overrideIndicator(e){let t=!1,o=!1;return this.getIndicatorsByFilter(e).forEach(r=>{r.override(e);const{calc:a,draw:l,sort:c}=r.shouldUpdateImp();c&&(o=!0),a?this._addIndicatorCalcTask(r,"update"):l&&(t=!0)}),o&&this._sortIndicators(),t?(this._scheduleLayout({update:!0}),!0):!1}_scheduleLayout(e){this._pendingLayoutOptions.measureWidth=this._pendingLayoutOptions.measureWidth||(e.measureWidth??!1),this._pendingLayoutOptions.update=this._pendingLayoutOptions.update||(e.update??!1),this._pendingLayoutOptions.buildYAxisTick=this._pendingLayoutOptions.buildYAxisTick||(e.buildYAxisTick??!1),this._pendingLayoutOptions.cacheYAxisWidth=this._pendingLayoutOptions.cacheYAxisWidth||(e.cacheYAxisWidth??!1);const t=typeof performance<"u"?performance.now():Date.now();t-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=t),this._perfLayoutSchedules++,this._perfLayoutSchedules>40&&console.warn("⚠️ klinecharts: Frequent layout scheduling detected"),this._layoutRafId===null&&(this._layoutRafId=og(()=>{const o={...this._pendingLayoutOptions};this._pendingLayoutOptions={measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1},this._layoutRafId=null,this._chart.layout(o)}))}_scheduleOverlayUpdate(){this._overlayRafId===null&&(this._overlayRafId=og(()=>{this._overlayRafId=null,this._chart.updatePane(fu.Overlay)}))}getOverlaysByFilter(e){var d;const{id:t,groupId:o,paneId:i,name:r}=e,a=p=>_o(t)?p.id===t:_o(o)?p.groupId===o&&(!_o(r)||p.name===r):!_o(r)||p.name===r;let l=[];_o(i)?l=l.concat(this.getOverlaysByPaneId(i).filter(a)):this._overlays.forEach(p=>{l=l.concat(p.filter(a))});const c=(d=this._progressOverlayInfo)==null?void 0:d.overlay;return _o(c)&&a(c)&&l.push(c),l}getOverlaysByPaneId(e){if(!au(e)){let t=[];return this._overlays.forEach(o=>{t=t.concat(o)}),t}return this._overlays.get(e)??[]}_sortOverlays(e){var t;au(e)?(t=this._overlays.get(e))==null||t.sort((o,i)=>o.zLevel-i.zLevel):this._overlays.forEach(o=>{o.sort((i,r)=>i.zLevel-r.zLevel)})}addOverlays(e,t){const o=[],i=e.map((r,a)=>{var c,d;if(_o(r.id)){let p=null;for(const m of this._overlays){const _=m[1].find(w=>w.id===r.id);if(_o(_)){p=_;break}}if(_o(p))return r.id}const l=F3(r.name);if(_o(l)){const p=r.id??Nh(p3),m=new l,h=r.paneId??nd.CANDLE;r.id=p,r.groupId??(r.groupId=p);const _=this.getOverlaysByPaneId(h).length;return r.zLevel??(r.zLevel=_),m.override(r),o.includes(h)||o.push(h),m.isDrawing()?this._progressOverlayInfo={paneId:h,overlay:m,appointPaneFlag:t[a]}:(this._overlays.has(h)||this._overlays.set(h,[]),(c=this._overlays.get(h))==null||c.push(m)),m.isStart()&&((d=m.onDrawStart)==null||d.call(m,{overlay:m,chart:this._chart})),p}return null});return o.length>0&&(this._sortOverlays(),o.forEach(r=>{this._chart.updatePane(fu.Overlay,r)}),this._chart.updatePane(fu.Overlay,nd.X_AXIS)),i}getProgressOverlayInfo(){return this._progressOverlayInfo}progressOverlayComplete(){var e;if(this._progressOverlayInfo!==null){const{overlay:t,paneId:o}=this._progressOverlayInfo;t.isDrawing()||(this._overlays.has(o)||this._overlays.set(o,[]),(e=this._overlays.get(o))==null||e.push(t),this._sortOverlays(o),this._progressOverlayInfo=null)}}updateProgressOverlayInfo(e,t){this._progressOverlayInfo!==null&&(Yh(t)&&t&&(this._progressOverlayInfo.appointPaneFlag=t),this._progressOverlayInfo.paneId=e,this._progressOverlayInfo.overlay.override({paneId:e}))}overrideOverlay(e){let t=!1;const o=[];return this.getOverlaysByFilter(e).forEach(r=>{r.override(e);const{sort:a,draw:l}=r.shouldUpdate();a&&(t=!0),(a||l)&&(o.includes(r.paneId)||o.push(r.paneId))}),t&&this._sortOverlays(),o.length>0?(o.forEach(r=>{this._chart.updatePane(fu.Overlay,r)}),this._chart.updatePane(fu.Overlay,nd.X_AXIS),!0):!1}removeOverlay(e){const t=[];return this.getOverlaysByFilter(e??{}).forEach(i=>{var l;const r=i.paneId,a=this.getOverlaysByPaneId(i.paneId);if((l=i.onRemoved)==null||l.call(i,{overlay:i,chart:this._chart}),t.includes(r)||t.push(r),i.isDrawing())this._progressOverlayInfo=null;else{const c=a.findIndex(d=>d.id===i.id);c>-1&&a.splice(c,1)}a.length===0&&this._overlays.delete(r)}),t.length>0?(t.forEach(i=>{this._chart.updatePane(fu.Overlay,i)}),this._chart.updatePane(fu.Overlay,nd.X_AXIS),!0):!1}setPressedOverlayInfo(e){this._pressedOverlayInfo=e}getPressedOverlayInfo(){return this._pressedOverlayInfo}setHoverOverlayInfo(e,t,o){const{overlay:i,figureType:r,figureIndex:a,figure:l}=this._hoverOverlayInfo,c=e.overlay;if(((i==null?void 0:i.id)!==(c==null?void 0:c.id)||r!==e.figureType||a!==e.figureIndex)&&(this._hoverOverlayInfo=e,(i==null?void 0:i.id)!==(c==null?void 0:c.id))){let d=!1,p=!1;i!==null&&(i.override({zLevel:i.getPrevZLevel()}),p=!0,o(i,l)&&(d=!0)),c!==null&&(c.setPrevZLevel(c.zLevel),c.override({zLevel:Number.MAX_SAFE_INTEGER}),p=!0,t(c,e.figure)&&(d=!0)),p&&this._sortOverlays(),d||this._chart.updatePane(fu.Overlay)}}getHoverOverlayInfo(){return this._hoverOverlayInfo}setClickOverlayInfo(e,t,o){const{paneId:i,overlay:r,figureType:a,figure:l,figureIndex:c}=this._clickOverlayInfo,d=e.overlay;((r==null?void 0:r.id)!==(d==null?void 0:d.id)||a!==e.figureType||c!==e.figureIndex)&&(this._clickOverlayInfo=e,(r==null?void 0:r.id)!==(d==null?void 0:d.id)&&(_o(r)&&o(r,l),_o(d)&&t(d,e.figure),this._chart.updatePane(fu.Overlay,e.paneId),i!==e.paneId&&this._chart.updatePane(fu.Overlay,i),this._chart.updatePane(fu.Overlay,nd.X_AXIS)))}getClickOverlayInfo(){return this._clickOverlayInfo}isOverlayEmpty(){return this._overlays.size===0&&this._progressOverlayInfo===null}isOverlayDrawing(){var e;return((e=this._progressOverlayInfo)==null?void 0:e.overlay.isDrawing())??!1}_clearLastPriceMarkExtendTextUpdateTimer(){this._lastPriceMarkExtendTextUpdateTimers.forEach(e=>{clearInterval(e)}),this._lastPriceMarkExtendTextUpdateTimers=[]}_clearData(){this._dataLoadMore.backward=!1,this._dataLoadMore.forward=!1,this._loading=!1,this._dataList=[],this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}],this._visibleRange=Oy(),this._crosshair={}}getChart(){return this._chart}destroy(){this._clearData(),this._clearLastPriceMarkExtendTextUpdateTimer(),this._taskScheduler.clear(),this._overlays.clear(),this._indicators.clear(),this._actions.clear()}applyNewData(e,t){this._addData(e,"init",t)}addData(e,t,o){this._addData(e,t,o)}}const fd={MAIN:"main",X_AXIS:"xAxis",Y_AXIS:"yAxis",SEPARATOR:"separator"},Hh=7;async function U3(){return await new Promise(n=>{const e=new ResizeObserver(t=>{n(t.every(o=>"devicePixelContentBoxSize"in o)),e.disconnect()});e.observe(document.body,{box:"device-pixel-content-box"})}).catch(()=>!1)}class Uy{constructor(e,t){Ce(this,"_element");Ce(this,"_resizeObserver");Ce(this,"_mediaQueryList");Ce(this,"_ctx");Ce(this,"_listener");Ce(this,"_supportedDevicePixelContentBox",!1);Ce(this,"_width",0);Ce(this,"_height",0);Ce(this,"_pixelWidth",0);Ce(this,"_pixelHeight",0);Ce(this,"_nextPixelWidth",0);Ce(this,"_nextPixelHeight",0);Ce(this,"_requestAnimationId",W_);Ce(this,"_mediaQueryListener",()=>{const e=yg(this._element);this._nextPixelWidth=Math.round(this._element.clientWidth*e),this._nextPixelHeight=Math.round(this._element.clientHeight*e),this._resetPixelRatio()});this._listener=t,this._element=rg("canvas",e),this._ctx=this._element.getContext("2d"),U3().then(o=>{this._supportedDevicePixelContentBox=o,o?(this._resizeObserver=new ResizeObserver(i=>{const r=i.find(l=>l.target===this._element),a=r==null?void 0:r.devicePixelContentBoxSize[0];_o(a)&&(this._nextPixelWidth=a.inlineSize,this._nextPixelHeight=a.blockSize,(this._pixelWidth!==this._nextPixelWidth||this._pixelHeight!==this._nextPixelHeight)&&this._resetPixelRatio())}),this._resizeObserver.observe(this._element,{box:"device-pixel-content-box"})):(this._mediaQueryList=window.matchMedia(`(resolution: ${yg(this._element)}dppx)`),this._mediaQueryList.addListener(this._mediaQueryListener))}).catch(o=>!1)}_resetPixelRatio(){this._executeListener(()=>{const e=this._element.clientWidth,t=this._element.clientHeight;this._width=e,this._height=t,this._pixelWidth=this._nextPixelWidth,this._pixelHeight=this._nextPixelHeight,this._element.width=this._nextPixelWidth,this._element.height=this._nextPixelHeight;const o=this._nextPixelWidth/e,i=this._nextPixelHeight/t;this._ctx.scale(o,i)})}_executeListener(e){this._requestAnimationId===W_&&(this._requestAnimationId=og(()=>{this._ctx.clearRect(0,0,this._width,this._height),e==null||e(),this._listener(),this._requestAnimationId=W_}))}update(e,t){if(this._width!==e||this._height!==t){if(this._element.style.width=`${e}px`,this._element.style.height=`${t}px`,!this._supportedDevicePixelContentBox){const o=yg(this._element);this._nextPixelWidth=Math.round(e*o),this._nextPixelHeight=Math.round(t*o),this._resetPixelRatio()}}else this._executeListener()}getElement(){return this._element}getContext(){return this._ctx}destroy(){_o(this._resizeObserver)&&this._resizeObserver.unobserve(this._element),_o(this._mediaQueryList)&&this._mediaQueryList.removeListener(this._mediaQueryListener)}}class X2 extends ty{constructor(t,o){super();Ce(this,"_rootContainer");Ce(this,"_pane");Ce(this,"_container");Ce(this,"_bounding",l_());Ce(this,"_cursor","crosshair");Ce(this,"_forceCursor",null);this._pane=o,this._rootContainer=t,this._container=this.createContainer(),t.appendChild(this._container)}setBounding(t){return Op(this._bounding,t),this}getContainer(){return this._container}getBounding(){return this._bounding}getPane(){return this._pane}checkEventOn(t){return!0}setCursor(t){au(this._forceCursor)||t!==this._cursor&&(this._cursor=t,this._container.style.cursor=this._cursor)}setForceCursor(t){t!==this._forceCursor&&(this._forceCursor=t,this._container.style.cursor=this._forceCursor??this._cursor)}getForceCursor(){return this._forceCursor}update(t){this.updateImp(this._container,this._bounding,t??fu.Drawer)}destroy(){this._rootContainer.removeChild(this._container)}}class sy extends X2{constructor(t,o){super(t,o);Ce(this,"_mainCanvas");Ce(this,"_overlayCanvas");this._mainCanvas=new Uy({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},()=>{this.updateMain(this._mainCanvas.getContext())}),this._overlayCanvas=new Uy({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},()=>{this.updateOverlay(this._overlayCanvas.getContext())});const i=this.getContainer();i.appendChild(this._mainCanvas.getElement()),i.appendChild(this._overlayCanvas.getElement())}createContainer(){return rg("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box",zIndex:"1"})}updateImp(t,o,i){const{width:r,height:a,left:l}=o;t.style.left=`${l}px`;let c=i;const d=t.clientWidth,p=t.clientHeight;switch((r!==d||a!==p)&&(t.style.width=`${r}px`,t.style.height=`${a}px`,c=fu.Drawer),c){case fu.Main:{this._mainCanvas.update(r,a);break}case fu.Overlay:{this._overlayCanvas.update(r,a);break}case fu.Drawer:case fu.All:{this._mainCanvas.update(r,a),this._overlayCanvas.update(r,a);break}}}destroy(){this._mainCanvas.destroy(),this._overlayCanvas.destroy()}getImage(t){const{width:o,height:i}=this.getBounding(),r=rg("canvas",{width:`${o}px`,height:`${i}px`,boxSizing:"border-box"}),a=r.getContext("2d"),l=yg(r);return r.width=o*l,r.height=i*l,a.scale(l,l),a.drawImage(this._mainCanvas.getElement(),0,0,o,i),t&&a.drawImage(this._overlayCanvas.getElement(),0,0,o,i),r}}function J2(n,e){let t=[];t=t.concat(e);for(const o of t){const{x:i,y:r,r:a}=o,l=n.x-i,c=n.y-r;if(!(l*l+c*c>a*a))return!0}return!1}function G3(n,e,t){let o=[];o=o.concat(e);const{style:i="fill",color:r="currentColor",borderSize:a=1,borderColor:l="currentColor",borderStyle:c="solid",borderDashedValue:d=[2,2]}=t,p=(i==="fill"||t.style==="stroke_fill")&&(!au(r)||!nh(r));p&&(n.fillStyle=r,o.forEach(({x:m,y:h,r:_})=>{n.beginPath(),n.arc(m,h,_,0,Math.PI*2),n.closePath(),n.fill()})),(i==="stroke"||t.style==="stroke_fill")&&a>0&&!nh(l)&&(n.strokeStyle=l,n.lineWidth=a,c==="dashed"?n.setLineDash(d):n.setLineDash([]),o.forEach(({x:m,y:h,r:_})=>{(!p||_>a)&&(n.beginPath(),n.arc(m,h,_,0,Math.PI*2),n.closePath(),n.stroke())}))}const Y3={name:"circle",checkEventOn:J2,draw:(n,e,t)=>{G3(n,e,t)}};function Q2(n,e){let t=[];t=t.concat(e);for(const o of t){let i=!1;const{coordinates:r}=o;for(let a=0,l=r.length-1;a<r.length;l=a++)r[a].y>n.y!=r[l].y>n.y&&n.x<(r[l].x-r[a].x)*(n.y-r[a].y)/(r[l].y-r[a].y)+r[a].x&&(i=!i);if(i)return!0}return!1}function K3(n,e,t){let o=[];o=o.concat(e);const{style:i="fill",color:r="currentColor",borderSize:a=1,borderColor:l="currentColor",borderStyle:c="solid",borderDashedValue:d=[2,2]}=t;(i==="fill"||t.style==="stroke_fill")&&(!au(r)||!nh(r))&&(n.fillStyle=r,o.forEach(({coordinates:p})=>{n.beginPath(),n.moveTo(p[0].x,p[0].y);for(let m=1;m<p.length;m++)n.lineTo(p[m].x,p[m].y);n.closePath(),n.fill()})),(i==="stroke"||t.style==="stroke_fill")&&a>0&&!nh(l)&&(n.strokeStyle=l,n.lineWidth=a,c==="dashed"?n.setLineDash(d):n.setLineDash([]),o.forEach(({coordinates:p})=>{n.beginPath(),n.moveTo(p[0].x,p[0].y);for(let m=1;m<p.length;m++)n.lineTo(p[m].x,p[m].y);n.closePath(),n.stroke()}))}const Z3={name:"polygon",checkEventOn:Q2,draw:(n,e,t)=>{K3(n,e,t)}};function iy(n,e){let t=[];t=t.concat(e);for(const o of t){let i=o.x,r=o.width;r<vv*2&&(i-=vv,r=vv*2);let a=o.y,l=o.height;if(l<vv*2&&(a-=vv,l=vv*2),n.x>=i&&n.x<=i+r&&n.y>=a&&n.y<=a+l)return!0}return!1}function ex(n,e,t){let o=[];o=o.concat(e);const{style:i="fill",color:r="transparent",borderSize:a=1,borderColor:l="transparent",borderStyle:c="solid",borderRadius:d=0,borderDashedValue:p=[2,2]}=t,m=n.roundRect??n.rect,h=(i==="fill"||t.style==="stroke_fill")&&(!au(r)||!nh(r));if(h&&(n.fillStyle=r,o.forEach(({x:_,y:w,width:S,height:P})=>{n.beginPath(),m.call(n,_,w,S,P,d),n.closePath(),n.fill()})),(i==="stroke"||t.style==="stroke_fill")&&a>0&&!nh(l)){n.strokeStyle=l,n.fillStyle=l,n.lineWidth=a,c==="dashed"?n.setLineDash(p):n.setLineDash([]);const _=a%2===1?.5:0,w=Math.round(_*2);o.forEach(({x:S,y:P,width:I,height:C})=>{I>a*2&&C>a*2?(n.beginPath(),m.call(n,S+_,P+_,I-w,C-w,d),n.closePath(),n.stroke()):h||n.fillRect(S,P,I,C)})}}const X3={name:"rect",checkEventOn:iy,draw:(n,e,t)=>{ex(n,e,t)}};function tx(n,e){const{size:t=12,paddingLeft:o=0,paddingTop:i=0,paddingRight:r=0,paddingBottom:a=0,weight:l="normal",family:c}=e,{x:d,y:p,text:m,align:h="left",baseline:_="top",width:w,height:S}=n,P=w??o+Av(m,t,l,c)+r,I=S??i+t+a;let C=0;switch(h){case"left":case"start":{C=d;break}case"right":case"end":{C=d-P;break}default:{C=d-P/2;break}}let M=0;switch(_){case"top":case"hanging":{M=p;break}case"bottom":case"ideographic":case"alphabetic":{M=p-I;break}default:{M=p-I/2;break}}return{x:C,y:M,width:P,height:I}}function nx(n,e,t){let o=[];o=o.concat(e);for(const i of o){const{x:r,y:a,width:l,height:c}=tx(i,t);if(n.x>=r&&n.x<=r+l&&n.y>=a&&n.y<=a+c)return!0}return!1}function J3(n,e,t){let o=[];o=o.concat(e);const{color:i="currentColor",size:r=12,family:a,weight:l,paddingLeft:c=0,paddingTop:d=0,paddingRight:p=0}=t,m=o.map(h=>tx(h,t));ex(n,m,{...t,color:t.backgroundColor}),n.textAlign="left",n.textBaseline="top",n.font=sg(r,l,a),n.fillStyle=i,o.forEach((h,_)=>{const w=m[_];n.fillText(h.text,w.x+c,w.y+d,w.width-c-p)})}const Q3={name:"text",checkEventOn:nx,draw:(n,e,t)=>{J3(n,e,t)}};function e6(n,e){const t=n.x-e.x,o=n.y-e.y;return Math.sqrt(t*t+o*o)}function ox(n,e){let t=[];t=t.concat(e);for(const o of t)if(Math.abs(e6(n,o)-o.r)<vv){const{r:i,startAngle:r,endAngle:a}=o,l=i*Math.cos(r)+o.x,c=i*Math.sin(r)+o.y,d=i*Math.cos(a)+o.x,p=i*Math.sin(a)+o.y;if(n.x<=Math.max(l,d)+vv&&n.x>=Math.min(l,d)-vv&&n.y<=Math.max(c,p)+vv&&n.y>=Math.min(c,p)-vv)return!0}return!1}function t6(n,e,t){let o=[];o=o.concat(e);const{style:i="solid",size:r=1,color:a="currentColor",dashedValue:l=[2,2]}=t;n.lineWidth=r,n.strokeStyle=a,i==="dashed"?n.setLineDash(l):n.setLineDash([]),o.forEach(({x:c,y:d,r:p,startAngle:m,endAngle:h})=>{n.beginPath(),n.arc(c,d,p,m,h),n.stroke(),n.closePath()})}const n6={name:"arc",checkEventOn:ox,draw:(n,e,t)=>{t6(n,e,t)}};function Gy(n,e,t,o,i,r,a){const[l,c,d,p,m,h,_]=o,w=a?e+h:h+i,S=a?t+_:_+r;o6(e,t,l,c,d,p,m,w,S).forEach(I=>{n.bezierCurveTo(I[0],I[1],I[2],I[3],I[4],I[5])})}function o6(n,e,t,o,i,r,a,l,c){const{cx:d,cy:p,startAngle:m,deltaAngle:h}=s6(n,e,t,o,i,r,a,l,c),_=[],w=Math.ceil(Math.abs(h)/(Math.PI/2));for(let S=0;S<w;S++){const P=m+S*h/w,I=m+(S+1)*h/w,C=i6(d,p,t,o,i,P,I);_.push(C)}return _}function s6(n,e,t,o,i,r,a,l,c){const d=i*Math.PI/180,p=(n-l)/2,m=(e-c)/2,h=Math.cos(d)*p+Math.sin(d)*m,_=-Math.sin(d)*p+Math.cos(d)*m,w=h**2/t**2+_**2/o**2;w>1&&(t*=Math.sqrt(w),o*=Math.sqrt(w));const S=r===a?-1:1,P=t**2*o**2-t**2*_**2-o**2*h**2,I=t**2*_**2+o**2*h**2,C=S*Math.sqrt(Math.abs(P/I))*(t*_/o),M=S*Math.sqrt(Math.abs(P/I))*(-o*h/t),F=Math.cos(d)*C-Math.sin(d)*M+(n+l)/2,V=Math.sin(d)*C+Math.cos(d)*M+(e+c)/2,j=Math.atan2((_-M)/o,(h-C)/t);let D=Math.atan2((-_-M)/o,(-h-C)/t)-j;return D<0&&a===1?D+=2*Math.PI:D>0&&a===0&&(D-=2*Math.PI),{cx:F,cy:V,startAngle:j,deltaAngle:D}}function i6(n,e,t,o,i,r,a){const l=Math.sin(a-r)*(Math.sqrt(4+3*Math.tan((a-r)/2)**2)-1)/3,c=Math.cos(i),d=Math.sin(i),p=n+t*Math.cos(r)*c-o*Math.sin(r)*d,m=e+t*Math.cos(r)*d+o*Math.sin(r)*c,h=n+t*Math.cos(a)*c-o*Math.sin(a)*d,_=e+t*Math.cos(a)*d+o*Math.sin(a)*c,w=p+l*(-t*Math.sin(r)*c-o*Math.cos(r)*d),S=m+l*(-t*Math.sin(r)*d+o*Math.cos(r)*c),P=h-l*(-t*Math.sin(a)*c-o*Math.cos(a)*d),I=_-l*(-t*Math.sin(a)*d+o*Math.cos(a)*c);return[w,S,P,I,h,_]}function r6(n,e,t){let o=[];o=o.concat(e);const{lineWidth:i=1,color:r="currentColor"}=t;n.lineWidth=i,n.strokeStyle=r,n.setLineDash([]),o.forEach(({x:a,y:l,path:c})=>{const d=c.match(/[MLHVCSQTAZ][^MLHVCSQTAZ]*/gi);if(_o(d)){const p=a,m=l;n.beginPath(),d.forEach(h=>{let _=0,w=0,S=0,P=0;const I=h[0],C=h.slice(1).trim().split(/[\s,]+/).map(Number);switch(I){case"M":_=C[0]+p,w=C[1]+m,n.moveTo(_,w),S=_,P=w;break;case"m":_+=C[0],w+=C[1],n.moveTo(_,w),S=_,P=w;break;case"L":_=C[0]+p,w=C[1]+m,n.lineTo(_,w);break;case"l":_+=C[0],w+=C[1],n.lineTo(_,w);break;case"H":_=C[0]+p,n.lineTo(_,w);break;case"h":_+=C[0],n.lineTo(_,w);break;case"V":w=C[0]+m,n.lineTo(_,w);break;case"v":w+=C[0],n.lineTo(_,w);break;case"C":n.bezierCurveTo(C[0]+p,C[1]+m,C[2]+p,C[3]+m,C[4]+p,C[5]+m),_=C[4]+p,w=C[5]+m;break;case"c":n.bezierCurveTo(_+C[0],w+C[1],_+C[2],w+C[3],_+C[4],w+C[5]),_+=C[4],w+=C[5];break;case"S":n.bezierCurveTo(_,w,C[0]+p,C[1]+m,C[2]+p,C[3]+m),_=C[2]+p,w=C[3]+m;break;case"s":n.bezierCurveTo(_,w,_+C[0],w+C[1],_+C[2],w+C[3]),_+=C[2],w+=C[3];break;case"Q":n.quadraticCurveTo(C[0]+p,C[1]+m,C[2]+p,C[3]+m),_=C[2]+p,w=C[3]+m;break;case"q":n.quadraticCurveTo(_+C[0],w+C[1],_+C[2],w+C[3]),_+=C[2],w+=C[3];break;case"T":n.quadraticCurveTo(_,w,C[0]+p,C[1]+m),_=C[0]+p,w=C[1]+m;break;case"t":n.quadraticCurveTo(_,w,_+C[0],w+C[1]),_+=C[0],w+=C[1];break;case"A":Gy(n,_,w,C,p,m,!1),_=C[5]+p,w=C[6]+m;break;case"a":Gy(n,_,w,C,p,m,!0),_+=C[5],w+=C[6];break;case"Z":case"z":n.closePath(),_=S,w=P;break}}),t.style==="fill"?n.fill():n.stroke()}})}const a6={name:"path",checkEventOn:iy,draw:(n,e,t)=>{r6(n,e,t)}},l6={name:"image",draw:(n,e)=>{const{x:t,y:o,width:i,height:r,image:a,borderRadius:l=0}=e;if(!(!a||!a.complete||a.naturalWidth===0))if(l&&l>0){n.save();const c=Math.min(l,Math.floor(Math.min(i,r)/2));n.beginPath(),n.moveTo(t+c,o),n.arcTo(t+i,o,t+i,o+r,c),n.arcTo(t+i,o+r,t,o+r,c),n.arcTo(t,o+r,t,o,c),n.arcTo(t,o,t+i,o,c),n.closePath(),n.clip(),n.drawImage(a,t,o,i,r),n.restore()}else n.drawImage(a,t,o,i,r)},checkEventOn:(n,e)=>!1},ry={},c6=[Y3,_3,Z3,X3,Q3,n6,a6,l6];c6.forEach(n=>{ry[n.name]=w_.extend(n)});function d6(n){ry[n.name]=w_.extend(n)}function u6(n){return ry[n]??null}class Wf extends ty{constructor(t){super();Ce(this,"_widget");this._widget=t}getWidget(){return this._widget}createFigure(t,o){const i=u6(t.name);if(i!==null){const r=new i(t);if(_o(o)){for(const a in o)o.hasOwnProperty(a)&&r.registerEvent(a,o[a]);this.addChild(r)}return r}return null}draw(t,...o){this.clear(),this.drawImp(t,o)}checkEventOn(t){return!0}}class p6 extends Wf{drawImp(e){var c,d;const t=this.getWidget(),o=this.getWidget().getPane(),i=o.getChart(),r=t.getBounding(),a=i.getStyles().grid;if(a.show){e.save(),e.globalCompositeOperation="destination-over";const p=a.horizontal;if(p.show){const S=o.getAxisComponent().getTicks().map(P=>({coordinates:[{x:0,y:P.coord},{x:r.width,y:P.coord}]}));(c=this.createFigure({name:"line",attrs:S,styles:p}))==null||c.draw(e)}const h=a.vertical;if(h.show){const S=i.getXAxisPane().getAxisComponent().getTicks(),P=S.map(I=>({coordinates:[{x:I.coord,y:0},{x:I.coord,y:r.height}]}));if(S.length>=2){const I=S[S.length-1].coord,C=S[S.length-2].coord,M=I-C;if(M>0){let F=I+M;for(;F<=r.width;)P.push({coordinates:[{x:F,y:0},{x:F,y:r.height}]}),F+=M}}(d=this.createFigure({name:"line",attrs:P,styles:h}))==null||d.draw(e)}e.restore()}}}class sx extends Wf{eachChildren(e){const o=this.getWidget().getPane().getChart().getChartStore(),i=o.getVisibleRangeDataList(),r=o.getBarSpace(),a=i.length;let l=0;for(;l<a;)e(i[l],r,l),++l}}class ix extends sx{constructor(){super(...arguments);Ce(this,"_boundCandleBarClickEvent",t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCandleBarClick",t),!1))}drawImp(t){const o=this.getWidget().getPane(),i=o.getId()===nd.CANDLE,r=o.getChart().getChartStore(),a=this.getCandleBarOptions();if(a!==null){const{type:l,styles:c}=a;let d=0,p=0;if(a.type==="ohlc"){const{gapBar:h}=r.getBarSpace();d=Math.min(Math.max(Math.round(h*.2),1),8),d>2&&d%2===1&&d--,p=Math.floor(d/2)}const m=o.getAxisComponent();this.eachChildren((h,_)=>{const{x:w,data:{current:S,prev:P}}=h;if(_o(S)){const{open:I,high:C,low:M,close:F}=S,V=c.compareRule==="current_open"?I:(P==null?void 0:P.close)??F,j=[];F>V?(j[0]=c.upColor,j[1]=c.upBorderColor,j[2]=c.upWickColor):F<V?(j[0]=c.downColor,j[1]=c.downBorderColor,j[2]=c.downWickColor):(j[0]=c.noChangeColor,j[1]=c.noChangeBorderColor,j[2]=c.noChangeWickColor);const D=m.convertToPixel(I),R=m.convertToPixel(F),W=[D,R,m.convertToPixel(C),m.convertToPixel(M)];W.sort((G,se)=>G-se);const J=_.gapBar%2===0?1:0;let Z=[];switch(l){case"candle_solid":{Z=this._createSolidBar(w,W,_,j,J);break}case"candle_stroke":{Z=this._createStrokeBar(w,W,_,j,J);break}case"candle_up_stroke":{F>I?Z=this._createStrokeBar(w,W,_,j,J):Z=this._createSolidBar(w,W,_,j,J);break}case"candle_down_stroke":{I>F?Z=this._createStrokeBar(w,W,_,j,J):Z=this._createSolidBar(w,W,_,j,J);break}case"ohlc":{Z=[{name:"rect",attrs:[{x:w-p,y:W[0],width:d,height:W[3]-W[0]},{x:w-_.halfGapBar,y:D+d>W[3]?W[3]-d:D,width:_.halfGapBar-p,height:d},{x:w+p,y:R+d>W[3]?W[3]-d:R,width:_.halfGapBar-p,height:d}],styles:{color:j[0]}}];break}}Z.forEach(G=>{var Y;let se=null;i&&(se={mouseClickEvent:this._boundCandleBarClickEvent(h)}),(Y=this.createFigure(G,se??void 0))==null||Y.draw(t)})}})}}getCandleBarOptions(){const t=this.getWidget().getPane().getChart().getStyles().candle;return{type:t.type,styles:t.bar}}_createSolidBar(t,o,i,r,a){return[{name:"rect",attrs:{x:t,y:o[0],width:1,height:o[3]-o[0]},styles:{color:r[2]}},{name:"rect",attrs:{x:t-i.halfGapBar,y:o[1],width:i.gapBar+a,height:Math.max(1,o[2]-o[1])},styles:{style:"stroke_fill",color:r[0],borderColor:r[1]}}]}_createStrokeBar(t,o,i,r,a){return[{name:"rect",attrs:[{x:t,y:o[0],width:1,height:o[1]-o[0]},{x:t,y:o[2],width:1,height:o[3]-o[2]}],styles:{color:r[2]}},{name:"rect",attrs:{x:t-i.halfGapBar,y:o[1],width:i.gapBar+a,height:Math.max(1,o[2]-o[1])},styles:{style:"stroke",borderColor:r[1]}}]}}class v6 extends ix{getCandleBarOptions(){const e=this.getWidget().getPane();if(!e.getAxisComponent().isInCandle()){const o=e.getChart().getChartStore(),i=o.getIndicatorsByPaneId(e.getId());for(const r of i)if(r.shouldOhlc&&r.visible){const a=r.styles,l=o.getStyles().indicator,c=nv(a,"ohlc.compareRule",l.ohlc.compareRule),d=nv(a,"ohlc.upColor",l.ohlc.upColor),p=nv(a,"ohlc.downColor",l.ohlc.downColor),m=nv(a,"ohlc.noChangeColor",l.ohlc.noChangeColor);return{type:"ohlc",styles:{compareRule:c,upColor:d,downColor:p,noChangeColor:m,upBorderColor:d,downBorderColor:p,noChangeBorderColor:m,upWickColor:d,downWickColor:p,noChangeWickColor:m}}}}return null}drawImp(e){super.drawImp(e);const t=this.getWidget(),o=t.getPane(),i=o.getChart(),r=t.getBounding(),a=i.getXAxisPane().getAxisComponent(),l=o.getAxisComponent(),c=i.getChartStore(),d=c.getIndicatorsByPaneId(o.getId()),p=c.getStyles().indicator;e.save(),d.forEach(m=>{if(m.visible){m.zLevel<0?e.globalCompositeOperation="destination-over":e.globalCompositeOperation="source-over";let h=!1;if(m.draw!==null&&(e.save(),h=m.draw({ctx:e,chart:i,indicator:m,bounding:r,xAxis:a,yAxis:l}),e.restore()),!h){const _=m.result,w=[];this.eachChildren((S,P)=>{var se,Y,oe,ee,re,me;const{halfGapBar:I}=P,{dataIndex:C,x:M,data:F}=S,V=a.convertToPixel(C-1),j=a.convertToPixel(C+1),D=_[((se=F.prev)==null?void 0:se.timestamp)??""]??{},R=_[((Y=F.current)==null?void 0:Y.timestamp)??""]??{},W=_[((oe=F.next)==null?void 0:oe.timestamp)??""]??{},J={x:V},Z={x:M},G={x:j};m.figures.forEach(({key:K})=>{const ye=D[K];fl(ye)&&(J[K]=l.convertToPixel(ye));const Me=R[K];fl(Me)&&(Z[K]=l.convertToPixel(Me));const Fe=W[K];fl(Fe)&&(G[K]=l.convertToPixel(Fe))}),Q1(m,{prev:((ee=F.prev)==null?void 0:ee.timestamp)??null,current:((re=F.current)==null?void 0:re.timestamp)??null,next:((me=F.next)==null?void 0:me.timestamp)??null},p,(K,ye,Me)=>{var Fe,Ze;if(_o(R[K.key])){const Ge=Z[K.key];let it=(Fe=K.attrs)==null?void 0:Fe.call(K,{data:{prev:D,current:R,next:W},coordinate:{prev:J,current:Z,next:G},bounding:r,barSpace:P,xAxis:a,yAxis:l});if(!_o(it))switch(K.type){case"circle":{it={x:M,y:Ge,r:Math.max(1,I)};break}case"rect":case"bar":{const ct=K.baseValue??l.getRange().from,kt=l.convertToPixel(ct);let ft=Math.abs(kt-Ge);ct!==R[K.key]&&(ft=Math.max(1,ft));let bt=0;Ge>kt?bt=kt:bt=Ge,it={x:M-I,y:bt,width:Math.max(1,I*2),height:ft};break}case"line":{_o(w[Me])||(w[Me]=[]),fl(Z[K.key])&&fl(G[K.key])&&w[Me].push({coordinates:[{x:Z.x,y:Z[K.key]},{x:G.x,y:G[K.key]}],styles:ye});break}}const Ye=K.type;_o(it)&&Ye!=="line"&&((Ze=this.createFigure({name:Ye==="bar"?"rect":Ye,attrs:it,styles:ye}))==null||Ze.draw(e))}})}),w.forEach(S=>{var P,I,C,M;if(S.length>1){const F=[{coordinates:[S[0].coordinates[0],S[0].coordinates[1]],styles:S[0].styles}];for(let V=1;V<S.length;V++){const j=F[F.length-1],D=S[V],R=j.coordinates[j.coordinates.length-1];R.x===D.coordinates[0].x&&R.y===D.coordinates[0].y&&j.styles.style===D.styles.style&&j.styles.color===D.styles.color&&j.styles.size===D.styles.size&&j.styles.smooth===D.styles.smooth&&((P=j.styles.dashedValue)==null?void 0:P[0])===((I=D.styles.dashedValue)==null?void 0:I[0])&&((C=j.styles.dashedValue)==null?void 0:C[1])===((M=D.styles.dashedValue)==null?void 0:M[1])?j.coordinates.push(D.coordinates[1]):F.push({coordinates:[D.coordinates[0],D.coordinates[1]],styles:D.styles})}F.forEach(({coordinates:V,styles:j})=>{var D;(D=this.createFigure({name:"line",attrs:{coordinates:V},styles:j}))==null||D.draw(e)})}})}}}),e.restore()}}class f6 extends Wf{drawImp(e){const t=this.getWidget(),o=t.getPane(),i=t.getBounding(),r=t.getPane().getChart().getChartStore(),a=r.getCrosshair(),l=r.getStyles().crosshair;if(au(a.paneId)&&l.show){if(a.paneId===o.getId()){const d=a.y;this._drawLine(e,[{x:0,y:d},{x:i.width,y:d}],l.horizontal)}const c=a.realX;this._drawLine(e,[{x:c,y:0},{x:c,y:i.height}],l.vertical)}}_drawLine(e,t,o){var i;if(o.show){const r=o.line;r.show&&((i=this.createFigure({name:"line",attrs:{coordinates:t},styles:r}))==null||i.draw(e))}}}class rx extends Wf{constructor(t){super(t);Ce(this,"_activeFeatureInfo",null);Ce(this,"_featureClickEvent",(t,o)=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction(t,o),!0));Ce(this,"_featureMouseMoveEvent",t=>()=>(this._activeFeatureInfo=t,!0));this.registerEvent("mouseMoveEvent",o=>(this._activeFeatureInfo=null,!1))}drawImp(t){const o=this.getWidget(),r=o.getPane().getChart().getChartStore(),a=r.getCrosshair();if(_o(a.kLineData)){const l=o.getBounding(),{offsetLeft:c,offsetTop:d,offsetRight:p}=r.getStyles().indicator.tooltip;this.drawIndicatorTooltip(t,c,d,l.width-p)}}drawIndicatorTooltip(t,o,i,r){const a=this.getWidget().getPane(),l=a.getChart().getChartStore(),d=l.getStyles().indicator.tooltip;if(this.isDrawTooltip(l.getCrosshair(),d)){const p=l.getIndicatorsByPaneId(a.getId()),m=d.title,h=d.legend;p.forEach(_=>{let w=0;const S={x:o,y:i},{name:P,calcParamsText:I,legends:C,features:M}=this.getIndicatorTooltipData(_),F=P.length>0,V=C.length>0;if(F||V){const j=this.classifyTooltipFeatures(M);if(w=this.drawStandardTooltipFeatures(t,j[0],S,_,o,w,r),F){let D=P;I.length>0&&(D=`${D}${I}`);const R=m.color;w=this.drawStandardTooltipLegends(t,[{title:{text:"",color:R},value:{text:D,color:R}}],S,o,w,r,m)}w=this.drawStandardTooltipFeatures(t,j[1],S,_,o,w,r),V&&(w=this.drawStandardTooltipLegends(t,C,S,o,w,r,h)),w=this.drawStandardTooltipFeatures(t,j[2],S,_,o,w,r),i=S.y+w}})}return i}drawStandardTooltipFeatures(t,o,i,r,a,l,c){if(o.length>0){let d=0,p=0;o.forEach(_=>{const{marginLeft:w=0,marginTop:S=0,marginRight:P=0,marginBottom:I=0,paddingLeft:C=0,paddingTop:M=0,paddingRight:F=0,paddingBottom:V=0,size:j=0,type:D,content:R}=_;let W=0;if(D==="icon_font"){const J=R;t.font=sg(j,"normal",J.family),W=t.measureText(J.code).width}else W=j;d+=w+C+W+F+P,p=Math.max(p,S+M+j+V+I)}),i.x+d>c?(i.x=a,i.y+=l,l=p):l=Math.max(l,p);const h=this.getWidget().getPane().getId();o.forEach(_=>{var K,ye,Me,Fe,Ze;const{marginLeft:w=0,marginTop:S=0,marginRight:P=0,paddingLeft:I=0,paddingTop:C=0,paddingRight:M=0,paddingBottom:F=0,backgroundColor:V,activeBackgroundColor:j,borderRadius:D,size:R=0,color:W,activeColor:J,type:Z,content:G}=_;let se=W,Y=V;((K=this._activeFeatureInfo)==null?void 0:K.paneId)===h&&((ye=this._activeFeatureInfo.indicator)==null?void 0:ye.id)===(r==null?void 0:r.id)&&this._activeFeatureInfo.feature.id===_.id&&(se=J??W,Y=j??V);let oe="onCandleTooltipFeatureClick";const ee={paneId:h,feature:_};_o(r)&&(oe="onIndicatorTooltipFeatureClick",ee.indicator=r);const re={mouseClickEvent:this._featureClickEvent(oe,ee),mouseMoveEvent:this._featureMouseMoveEvent(ee)};let me=0;if(Z==="icon_font"){const Ge=G;(Me=this.createFigure({name:"text",attrs:{text:Ge.code,x:i.x+w,y:i.y+S},styles:{paddingLeft:I,paddingTop:C,paddingRight:M,paddingBottom:F,borderRadius:D,size:R,family:Ge.family,color:se,backgroundColor:Y}},re))==null||Me.draw(t),me=t.measureText(Ge.code).width}else{(Fe=this.createFigure({name:"rect",attrs:{x:i.x+w,y:i.y+S,width:R,height:R},styles:{paddingLeft:I,paddingTop:C,paddingRight:M,paddingBottom:F,color:Y}},re))==null||Fe.draw(t);const Ge=G;(Ze=this.createFigure({name:"path",attrs:{path:Ge.path,x:i.x+w+I,y:i.y+S+C,width:R,height:R},styles:{style:Ge.style,lineWidth:Ge.lineWidth,color:se}}))==null||Ze.draw(t),me=R}i.x+=w+I+me+M+P})}return l}drawStandardTooltipLegends(t,o,i,r,a,l,c){if(o.length>0){const{marginLeft:d,marginTop:p,marginRight:m,marginBottom:h,size:_,family:w,weight:S}=c;t.font=sg(_,S,w),o.forEach(P=>{var R,W;const I=P.title,C=P.value,M=t.measureText(I.text).width,F=t.measureText(C.text).width,V=I.text.length>0&&C.text.length>0?2:0,j=M+V+F,D=p+_+h;i.x+d+j+m>l?(i.x=r,i.y+=a,a=D):a=Math.max(a,D),I.text.length>0&&((R=this.createFigure({name:"text",attrs:{x:i.x+d,y:i.y+p,text:I.text},styles:{color:I.color,size:_,family:w,weight:S}}))==null||R.draw(t)),(W=this.createFigure({name:"text",attrs:{x:i.x+d+M+V,y:i.y+p,text:C.text},styles:{color:C.color,size:_,family:w,weight:S}}))==null||W.draw(t),i.x+=d+j+m})}return a}isDrawTooltip(t,o){const i=o.showRule;return i==="always"||i==="follow_cross"&&au(t.paneId)}getIndicatorTooltipData(t){var P;const o=this.getWidget().getPane().getChart().getChartStore(),i=o.getStyles().indicator,r=i.tooltip,a=r.title;let l="",c="";if(a.show&&(a.showName&&(l=t.shortName),a.showParams)){const I=t.calcParams;I.length>0&&(c=`(${I.join(",")})`)}const d={name:l,calcParamsText:c,legends:[],features:r.features},p=o.getCrosshair().dataIndex,m=t.result,h=o.getInnerFormatter(),_=o.getDecimalFold(),w=o.getThousandsSeparator(),S=[];if(t.visible){const I=o.getDataList(),C=I[p]??{},M=I[p-1]??{};let F=m[C.timestamp];!_o(F)&&p===I.length-1&&(F=m[M.timestamp]);const V=r.legend.defaultValue;Q1(t,{prev:M.timestamp,current:C.timestamp,next:(P=I[p])==null?void 0:P.timestamp},i,(j,D)=>{if(au(j.title)){const R=D.color;let W=F==null?void 0:F[j.key];fl(W)&&(W=Mv(W,t.precision),t.shouldFormatBigNumber&&(W=h.formatBigNumber(W)),W=_.format(w.format(W))),S.push({title:{text:j.title,color:R},value:{text:W??V,color:R}})}}),d.legends=S}if(pf(t.createTooltipDataSource)){const I=this.getWidget(),C=I.getPane(),M=C.getChart(),{name:F,calcParamsText:V,legends:j,features:D}=t.createTooltipDataSource({chart:M,indicator:t,crosshair:o.getCrosshair(),bounding:I.getBounding(),xAxis:C.getChart().getXAxisPane().getAxisComponent(),yAxis:C.getAxisComponent()});if(a.show&&(au(F)&&a.showName&&(d.name=F),au(V)&&a.showParams&&(d.calcParamsText=V)),_o(D)&&(d.features=D),_o(j)&&t.visible){const R=[],W=i.tooltip.legend.color;j.forEach(J=>{let Z={text:"",color:W};Af(J.title)?Z=J.title:Z.text=J.title;let G={text:"",color:W};Af(J.value)?G=J.value:G.text=J.value,fl(Number(G.text))&&(G.text=_.format(w.format(G.text))),R.push({title:Z,value:G})}),d.legends=R}}return d}classifyTooltipFeatures(t){const o=[],i=[],r=[];return t.forEach(a=>{switch(a.position){case"left":{o.push(a);break}case"middle":{i.push(a);break}case"right":{r.push(a);break}}}),[o,i,r]}}class ax extends Wf{constructor(e){super(e),this._initEvent()}_initEvent(){const e=this.getWidget(),t=e.getPane(),o=t.getId(),i=t.getChart(),r=i.getChartStore();this.registerEvent("mouseMoveEvent",a=>{var c;const l=r.getProgressOverlayInfo();if(l!==null){const d=l.overlay;let p=l.paneId;d.isStart()&&(r.updateProgressOverlayInfo(o),p=o);const m=d.points.length-1;if(d.isDrawing()&&p===o){const h=this._coordinateToPoint(d,a);d.eventMoveForDrawing(h),(c=d.onDrawing)==null||c.call(d,{chart:i,overlay:d,...a})}return this._figureMouseMoveEvent(d,"point",m,{key:`${Wg}point_${m}`,type:"circle",attrs:{}})(a)}return r.setHoverOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null},(d,p)=>this._processOverlayMouseEnterEvent(d,p,a),(d,p)=>this._processOverlayMouseLeaveEvent(d,p,a)),e.setForceCursor(null),!1}).registerEvent("mouseClickEvent",a=>{var c,d;const l=r.getProgressOverlayInfo();if(l!==null){const p=l.overlay;let m=l.paneId;p.isStart()&&(r.updateProgressOverlayInfo(o,!0),m=o);const h=p.points.length-1;if(p.isDrawing()&&m===o){const _=this._coordinateToPoint(p,a);p.eventMoveForDrawing(_),(c=p.onDrawing)==null||c.call(p,{chart:i,overlay:p,...a}),p.nextStep(),p.isDrawing()||(r.progressOverlayComplete(),(d=p.onDrawEnd)==null||d.call(p,{chart:i,overlay:p,...a}))}return this._figureMouseClickEvent(p,"point",h,{key:`${Wg}point_${h}`,type:"circle",attrs:{}})(a)}return r.setClickOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null},(p,m)=>this._processOverlaySelectedEvent(p,m,a),(p,m)=>this._processOverlayDeselectedEvent(p,m,a)),!1}).registerEvent("mouseDoubleClickEvent",a=>{var c;const l=r.getProgressOverlayInfo();if(l!==null){const d=l.overlay,p=l.paneId;d.isDrawing()&&p===o&&(d.forceComplete(),d.isDrawing()||(r.progressOverlayComplete(),(c=d.onDrawEnd)==null||c.call(d,{chart:i,overlay:d,...a})));const m=d.points.length-1;return this._figureMouseClickEvent(d,"point",m,{key:`${Wg}point_${m}`,type:"circle",attrs:{}})(a)}return!1}).registerEvent("mouseRightClickEvent",a=>{const l=r.getProgressOverlayInfo();if(l!==null){const c=l.overlay;if(c.isDrawing()){const d=c.points.length-1;return this._figureMouseRightClickEvent(c,"point",d,{key:`${Wg}point_${d}`,type:"circle",attrs:{}})(a)}}return!1}).registerEvent("mouseUpEvent",a=>{var d;const{overlay:l,figure:c}=r.getPressedOverlayInfo();return l!==null&&Jf("onPressedMoveEnd",c)&&((d=l.onPressedMoveEnd)==null||d.call(l,{chart:i,overlay:l,figure:c??void 0,...a})),r.setPressedOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null}),!1}).registerEvent("pressedMouseMoveEvent",a=>{var m;const{overlay:l,figureType:c,figureIndex:d,figure:p}=r.getPressedOverlayInfo();if(l!==null&&Jf("onPressedMoving",p)){if(!l.lock){const h=this._coordinateToPoint(l,a);c==="point"?l.eventPressedPointMove(h,d):l.eventPressedOtherMove(h,this.getWidget().getPane().getChart().getChartStore());let _=!1;(m=l.onPressedMoving)==null||m.call(l,{chart:i,overlay:l,figure:p??void 0,...a,preventDefault:()=>{_=!0}}),_?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return!0}return this.getWidget().setForceCursor(null),!1})}_createFigureEvents(e,t,o,i){return e.isDrawing()?null:{mouseMoveEvent:this._figureMouseMoveEvent(e,t,o,i),mouseDownEvent:this._figureMouseDownEvent(e,t,o,i),mouseClickEvent:this._figureMouseClickEvent(e,t,o,i),mouseRightClickEvent:this._figureMouseRightClickEvent(e,t,o,i),mouseDoubleClickEvent:this._figureMouseDoubleClickEvent(e,t,o,i)}}_processOverlayMouseEnterEvent(e,t,o){return pf(e.onMouseEnter)&&Jf("onMouseEnter",t)?(e.onMouseEnter({chart:this.getWidget().getPane().getChart(),overlay:e,figure:t??void 0,...o}),!0):!1}_processOverlayMouseLeaveEvent(e,t,o){return pf(e.onMouseLeave)&&Jf("onMouseLeave",t)?(e.onMouseLeave({chart:this.getWidget().getPane().getChart(),overlay:e,figure:t??void 0,...o}),!0):!1}_processOverlaySelectedEvent(e,t,o){var i;return Jf("onSelected",t)?((i=e.onSelected)==null||i.call(e,{chart:this.getWidget().getPane().getChart(),overlay:e,figure:t??void 0,...o}),!0):!1}_processOverlayDeselectedEvent(e,t,o){var i;return Jf("onDeselected",t)?((i=e.onDeselected)==null||i.call(e,{chart:this.getWidget().getPane().getChart(),overlay:e,figure:t??void 0,...o}),!0):!1}_figureMouseMoveEvent(e,t,o,i){return r=>{var c;const a=this.getWidget().getPane(),l=!e.isDrawing()&&Jf("onMouseMove",i);if(l){let d=!1;(c=e.onMouseMove)==null||c.call(e,{chart:a.getChart(),overlay:e,figure:i,...r,preventDefault:()=>{d=!0}}),d?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return a.getChart().getChartStore().setHoverOverlayInfo({paneId:a.getId(),overlay:e,figureType:t,figure:i,figureIndex:o},(d,p)=>this._processOverlayMouseEnterEvent(d,p,r),(d,p)=>this._processOverlayMouseLeaveEvent(d,p,r)),l}}_figureMouseDownEvent(e,t,o,i){return r=>{var c;const a=this.getWidget().getPane(),l=a.getId();return e.startPressedMove(this._coordinateToPoint(e,r)),Jf("onPressedMoveStart",i)?((c=e.onPressedMoveStart)==null||c.call(e,{chart:a.getChart(),overlay:e,figure:i,...r}),a.getChart().getChartStore().setPressedOverlayInfo({paneId:l,overlay:e,figureType:t,figureIndex:o,figure:i}),!e.isDrawing()):!1}}_figureMouseClickEvent(e,t,o,i){return r=>{var d;const a=this.getWidget().getPane(),l=a.getId(),c=!e.isDrawing()&&Jf("onClick",i);return c&&((d=e.onClick)==null||d.call(e,{chart:this.getWidget().getPane().getChart(),overlay:e,figure:i,...r})),a.getChart().getChartStore().setClickOverlayInfo({paneId:l,overlay:e,figureType:t,figureIndex:o,figure:i},(p,m)=>this._processOverlaySelectedEvent(p,m,r),(p,m)=>this._processOverlayDeselectedEvent(p,m,r)),c}}_figureMouseDoubleClickEvent(e,t,o,i){return r=>{var a;return Jf("onDoubleClick",i)?((a=e.onDoubleClick)==null||a.call(e,{...r,chart:this.getWidget().getPane().getChart(),figure:i,overlay:e}),!e.isDrawing()):!1}}_figureMouseRightClickEvent(e,t,o,i){return r=>{var a;if(Jf("onRightClick",i)){let l=!1;return(a=e.onRightClick)==null||a.call(e,{chart:this.getWidget().getPane().getChart(),overlay:e,figure:i,...r,preventDefault:()=>{l=!0}}),l||this.getWidget().getPane().getChart().getChartStore().removeOverlay(e),!e.isDrawing()}return!1}}_coordinateToPoint(e,t){const o={},i=this.getWidget().getPane(),r=i.getChart(),a=i.getId(),l=r.getChartStore();if(this.coordinateToPointTimestampDataIndexFlag()){const d=r.getXAxisPane().getAxisComponent().convertFromPixel(t.x),p=l.dataIndexToTimestamp(d)??void 0;o.timestamp=p,o.dataIndex=d}if(this.coordinateToPointValueFlag()){const c=i.getAxisComponent();let d=c.convertFromPixel(t.y);if(e.mode!=="normal"&&a===nd.CANDLE&&fl(o.dataIndex)){const p=l.getDataByDataIndex(o.dataIndex);if(p!==null){const m=e.modeSensitivity;if(d>p.high)if(e.mode==="weak_magnet"){const h=c.convertToPixel(p.high),_=c.convertFromPixel(h-m);d<_&&(d=p.high)}else d=p.high;else if(d<p.low)if(e.mode==="weak_magnet"){const h=c.convertToPixel(p.low),_=c.convertFromPixel(h-m);d>_&&(d=p.low)}else d=p.low;else{const h=Math.max(p.open,p.close),_=Math.min(p.open,p.close);d>h?d-h<p.high-d?d=h:d=p.high:d<_?d-p.low<_-d?d=p.low:d=_:h-d<d-_?d=h:d=_}}}o.value=d}return o}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(e,t){return this.getWidget().getPane().getChart().getChartStore().isOverlayDrawing()?this.onEvent(e,t):super.dispatchEvent(e,t)}drawImp(e){this.getCompleteOverlays().forEach(i=>{i.visible&&this._drawOverlay(e,i)});const o=this.getProgressOverlay();_o(o)&&o.visible&&this._drawOverlay(e,o)}_drawOverlay(e,t){const{points:o}=t,i=this.getWidget().getPane(),r=i.getChart(),a=r.getChartStore(),l=i.getAxisComponent(),c=r.getXAxisPane().getAxisComponent(),p=a.getDataList().length,m=p-1,h=o.map((_,w)=>{let S=null;fl(_.timestamp)?S=a.timestampToDataIndex(_.timestamp):fl(_.dataIndex)?S=_.dataIndex:p>0&&(S=m);const P={x:0,y:0};return fl(S)&&(P.x=c.convertToPixel(S)),fl(_.value)&&(P.y=(l==null?void 0:l.convertToPixel(_.value))??0),P});if(h.length>0){const _=[].concat(this.getFigures(t,h));this.drawFigures(e,t,_)}this.drawDefaultFigures(e,t,h)}drawFigures(e,t,o){const i=this.getWidget().getPane().getChart().getStyles().overlay;o.forEach((r,a)=>{const{type:l,styles:c,attrs:d}=r;[].concat(d).forEach(m=>{var w,S;const h=this._createFigureEvents(t,"other",a,r),_={...i[l],...(w=t.styles)==null?void 0:w[l],...c};(S=this.createFigure({name:l,attrs:m,styles:_},h??void 0))==null||S.draw(e)})})}getCompleteOverlays(){const e=this.getWidget().getPane();return e.getChart().getChartStore().getOverlaysByPaneId(e.getId())}getProgressOverlay(){const e=this.getWidget().getPane(),t=e.getChart().getChartStore().getProgressOverlayInfo();return _o(t)&&t.paneId===e.getId()?t.overlay:null}getFigures(e,t){var d;const o=this.getWidget(),i=o.getPane(),r=i.getChart(),a=i.getAxisComponent(),l=r.getXAxisPane().getAxisComponent(),c=o.getBounding();return((d=e.createPointFigures)==null?void 0:d.call(e,{chart:r,overlay:e,coordinates:t,bounding:c,xAxis:l,yAxis:a}))??[]}drawDefaultFigures(e,t,o){var i,r;if(t.needDefaultPointFigure){const a=this.getWidget().getPane().getChart().getChartStore(),l=a.getHoverOverlayInfo(),c=a.getClickOverlayInfo();if(((i=l.overlay)==null?void 0:i.id)===t.id&&l.figureType!=="none"||((r=c.overlay)==null?void 0:r.id)===t.id&&c.figureType!=="none"){const d=a.getStyles().overlay,p=t.styles,m={...d.point,...p==null?void 0:p.point};o.forEach(({x:h,y:_},w)=>{var M,F,V,j;let S=m.radius,P=m.color,I=m.borderColor,C=m.borderSize;((M=l.overlay)==null?void 0:M.id)===t.id&&l.figureType==="point"&&((F=l.figure)==null?void 0:F.key)===`${Wg}point_${w}`&&(S=m.activeRadius,P=m.activeColor,I=m.activeBorderColor,C=m.activeBorderSize),(V=this.createFigure({name:"circle",attrs:{x:h,y:_,r:S+C},styles:{color:I}},this._createFigureEvents(t,"point",w,{key:`${Wg}point_${w}`,type:"circle",attrs:{x:h,y:_,r:S+C},styles:{color:I}})??void 0))==null||V.draw(e),(j=this.createFigure({name:"circle",attrs:{x:h,y:_,r:S},styles:{color:P}}))==null||j.draw(e)})}}}}class lx extends sy{constructor(t,o){super(t,o);Ce(this,"_gridView",new p6(this));Ce(this,"_indicatorView",new v6(this));Ce(this,"_crosshairLineView",new f6(this));Ce(this,"_tooltipView",this.createTooltipView());Ce(this,"_overlayView",new ax(this));this.addChild(this._tooltipView),this.addChild(this._overlayView)}getName(){return fd.MAIN}updateMain(t){this.getPane().getOptions().state!=="minimize"&&(this.updateMainContent(t),this._indicatorView.draw(t),this._gridView.draw(t))}createTooltipView(){return new rx(this)}updateMainContent(t){}updateOverlayContent(t){}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this._overlayView.draw(t),this._crosshairLineView.draw(t),this.updateOverlayContent(t)),this._tooltipView.draw(t)}}class m6 extends sx{constructor(){super(...arguments);Ce(this,"_ripplePoint",this.createFigure({name:"circle",attrs:{x:0,y:0,r:0},styles:{style:"fill"}}));Ce(this,"_animationFrameTime",0);Ce(this,"_animation",new F1({iterationCount:1/0}).doFrame(t=>{this._animationFrameTime=t;const o=this.getWidget().getPane();o.getChart().updatePane(fu.Main,o.getId())}))}drawImp(t){var P,I,C;const o=this.getWidget(),i=o.getPane(),r=i.getChart(),l=r.getDataList().length-1,c=o.getBounding(),d=i.getAxisComponent(),p=r.getStyles().candle.area,m=[];let h=Number.MAX_SAFE_INTEGER,_=Number.MIN_SAFE_INTEGER,w=null;if(this.eachChildren(M=>{const F=M.x,{current:V}=M.data,j=V==null?void 0:V[p.value];if(fl(j)){const D=d.convertToPixel(j);_===Number.MIN_SAFE_INTEGER&&(_=F),m.push({x:F,y:D}),h=Math.min(h,D),M.dataIndex===l&&(w={x:F,y:D})}}),m.length>0){(P=this.createFigure({name:"line",attrs:{coordinates:m},styles:{color:p.lineColor,size:p.lineSize,smooth:p.smooth}}))==null||P.draw(t);const M=p.backgroundColor;let F="";if(pm(M)){const V=t.createLinearGradient(0,c.height,0,h);try{M.forEach(({offset:j,color:D})=>{V.addColorStop(j,D)})}catch{}F=V}else F=M;t.fillStyle=F,t.beginPath(),t.moveTo(_,c.height),t.lineTo(m[0].x,m[0].y),U2(t,m,p.smooth),t.lineTo(m[m.length-1].x,c.height),t.closePath(),t.fill()}const S=p.point;if(S.show&&_o(w)){(I=this.createFigure({name:"circle",attrs:{x:w.x,y:w.y,r:S.radius},styles:{style:"fill",color:S.color}}))==null||I.draw(t);let M=S.rippleRadius;S.animation&&(M=S.radius+this._animationFrameTime/S.animationDuration*(S.rippleRadius-S.radius),this._animation.setDuration(S.animationDuration).start()),(C=this._ripplePoint)==null||C.setAttrs({x:w.x,y:w.y,r:M}).setStyles({style:"fill",color:S.rippleColor}).draw(t)}else this.stopAnimation()}stopAnimation(){this._animation.stop()}}class g6 extends Wf{drawImp(e){var c;const o=this.getWidget().getPane(),i=o.getChart().getChartStore(),r=i.getStyles().candle.priceMark,a=r.high,l=r.low;if(r.show&&(a.show||l.show)){const d=i.getVisibleRangeHighLowPrice(),p=((c=i.getSymbol())==null?void 0:c.pricePrecision)??Tv.PRICE,m=o.getAxisComponent(),{price:h,x:_}=d[0],{price:w,x:S}=d[1],P=m.convertToPixel(h),I=m.convertToPixel(w),C=i.getDecimalFold(),M=i.getThousandsSeparator();a.show&&h!==Number.MIN_SAFE_INTEGER&&this._drawMark(e,C.format(M.format(Mv(h,p))),{x:_,y:P},P<I?[-2,-5]:[2,5],a),l.show&&w!==Number.MAX_SAFE_INTEGER&&this._drawMark(e,C.format(M.format(Mv(w,p))),{x:S,y:I},P<I?[2,5]:[-2,-5],l)}}_drawMark(e,t,o,i,r){var _,w,S;const a=o.x,l=o.y+i[0];(_=this.createFigure({name:"line",attrs:{coordinates:[{x:a-2,y:l+i[0]},{x:a,y:l},{x:a+2,y:l+i[0]}]},styles:{color:r.color}}))==null||_.draw(e);let c=0,d=0,p="left";const{width:m}=this.getWidget().getBounding();a>m/2?(c=a-5,d=c-r.textOffset,p="right"):(c=a+5,p="left",d=c+r.textOffset);const h=l+i[1];(w=this.createFigure({name:"line",attrs:{coordinates:[{x:a,y:l},{x:a,y:h},{x:c,y:h}]},styles:{color:r.color}}))==null||w.draw(e),(S=this.createFigure({name:"text",attrs:{x:d,y:h,text:t,align:p,baseline:"middle"},styles:{color:r.color,size:r.textSize,family:r.textFamily,weight:r.textWeight}}))==null||S.draw(e)}}class h6 extends Wf{drawImp(e){var d,p;const t=this.getWidget(),o=t.getPane(),i=t.getBounding(),r=o.getChart().getChartStore(),a=r.getStyles().candle.priceMark,l=a.last,c=l.line;if(a.show&&l.show&&c.show){const m=o.getAxisComponent(),h=r.getDataList(),_=h[h.length-1];if(_o(_)){const{close:w,open:S}=_,P=l.compareRule==="current_open"?S:((d=h[h.length-2])==null?void 0:d.close)??w,I=m.convertToPixel(w);let C="";w>P?C=l.upColor:w<P?C=l.downColor:C=l.noChangeColor,(p=this.createFigure({name:"line",attrs:{coordinates:[{x:0,y:I},{x:i.width,y:I}]},styles:{style:c.style,color:C,size:c.size,dashedValue:c.dashedValue}}))==null||p.draw(e)}}}}const _6={second:"HH:mm:ss",minute:"HH:mm",hour:"MM-DD HH:mm",day:"YYYY-MM-DD",week:"YYYY-MM-DD",month:"YYYY-MM",year:"YYYY"},cx={second:"HH:mm:ss",minute:"YYYY-MM-DD HH:mm",hour:"YYYY-MM-DD HH:mm",day:"YYYY-MM-DD",week:"YYYY-MM-DD",month:"YYYY-MM",year:"YYYY"},y6={time:"时间：",open:"开：",high:"高：",low:"低：",close:"收：",volume:"成交量：",turnover:"成交额：",change:"涨幅：",second:"秒",minute:"",hour:"小时",day:"天",week:"周",month:"月",year:"年"},b6={time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: ",turnover:"Turnover: ",change:"Change: ",second:"S",minute:"",hour:"H",day:"D",week:"W",month:"M",year:"Y"},x6={"zh-CN":y6,"en-US":b6};function w6(n,e){return x6[e][n]??n}const Xg={},M0={},X0={},J0={};function k6(n){if(n)return Xg[n]}function S6(n){const e=J0[n];!e||e.size===0||e.forEach(t=>{try{t()}catch{}})}async function C6(n,e=2){if(Xg[n])return Xg[n];if(M0[n])return M0[n];X0[n]="loading";const t=new Promise((o,i)=>{let r=0;const a=()=>{const l=new Image;l.crossOrigin="anonymous";try{l.referrerPolicy="no-referrer"}catch{}const c=async()=>{var p;try{await((p=l.decode)==null?void 0:p.call(l))}catch{}Xg[n]=l,X0[n]="loaded",S6(n),o(l)},d=()=>{if(r+=1,r<=e){const p=Math.min(500*r,1500);setTimeout(a,p)}else X0[n]="error",i(new Error("load error"))};l.onload=c,l.onerror=d,l.src=n};a()});M0[n]=t;try{return await t}finally{delete M0[n]}}function N1(n){if(n&&!(Xg[n]||X0[n]==="loading"))try{C6(n)}catch{}}function P6(n,e){if(J0[n]||(J0[n]=new Set),J0[n].add(e),Xg[n])try{e()}catch{}}function dx(n){n&&(N1(n.logo),N1(n.logo2))}class I6 extends rx{constructor(){super(...arguments);Ce(this,"_logoCache",{});Ce(this,"_logoSubscribed",{})}drawImp(t){const o=this.getWidget(),i=o.getPane().getChart().getChartStore(),r=i.getCrosshair();if(_o(r.kLineData)){const a=o.getBounding(),l=i.getStyles(),c=l.candle,d=l.indicator;if(c.tooltip.showType==="rect"&&d.tooltip.showType==="rect"){const p=this.isDrawTooltip(r,c.tooltip),m=this.isDrawTooltip(r,d.tooltip);this._drawRectTooltip(t,p,m,c.tooltip.offsetTop)}else if(c.tooltip.showType==="standard"&&d.tooltip.showType==="standard"){const{offsetLeft:p,offsetTop:m,offsetRight:h}=c.tooltip,_=a.width-h,w=this._drawCandleStandardTooltip(t,p,m,_);this.drawIndicatorTooltip(t,p,w,_)}else if(c.tooltip.showType==="rect"&&d.tooltip.showType==="standard"){const{offsetLeft:p,offsetTop:m,offsetRight:h}=c.tooltip,_=a.width-h,w=this.drawIndicatorTooltip(t,p,m,_),S=this.isDrawTooltip(r,c.tooltip);this._drawRectTooltip(t,S,!1,w)}else{const{offsetLeft:p,offsetTop:m,offsetRight:h}=c.tooltip,_=a.width-h,w=this._drawCandleStandardTooltip(t,p,m,_),S=this.isDrawTooltip(r,d.tooltip);this._drawRectTooltip(t,!1,S,w)}}}_drawCandleStandardTooltip(t,o,i,r){var _;const a=this.getWidget().getPane().getChart().getChartStore(),c=a.getStyles().candle.tooltip,d=c.legend;let p=0;const m={x:o,y:i},h=a.getCrosshair();if(this.isDrawTooltip(h,c)){const w=c.title;if(w.show){const{type:I="",span:C=""}=a.getPeriod()??{},M=a.getSymbol(),F=((M==null?void 0:M.type)||"").toLowerCase(),V=((M==null?void 0:M.exchange)||"").toUpperCase();let j=F;(j==="forex"||j==="crypto")&&(j="");const D={second:"s",minute:"m",hour:"h",day:"d",week:"w",month:"mo",year:"y"},R=(C?`${C}`:"")+(D[I]??"");let W=w.template;!j&&typeof W=="string"&&(W=W.replace(/(?:\s*[·\.]\s*)\{segment\}/i,""));let J=Ny(W,{...M,period:R,exchange:V,segment:j});try{if(typeof window<"u"&&window.innerWidth<=768){const oe=(M==null?void 0:M.name)||(M==null?void 0:M.ticker)||"",ee=w.marginLeft??0,re=w.marginRight??0,me=20,ye=!!(M!=null&&M.logo2)?me*2-6+6:me+6,Me=Math.max(0,r-ye-ee-re),Fe=w.size??14,Ze=w.family,Ge=w.weight,it="...",Ye=Av(it,Fe,Ge,Ze);let ct=oe;if(Av(ct,Fe,Ge,Ze)>Me&&Me>Ye){let ft=0,bt=ct.length;for(;ft<bt;){const Pt=Math.floor((ft+bt)/2),Qe=ct.slice(0,Pt)+it;Av(Qe,Fe,Ge,Ze)<=Me?ft=Pt+1:bt=Pt}const nt=Math.max(1,ft-1);ct=ct.slice(0,nt)+it}J=ct}}catch{}const Z=w.color;let G={...w};try{const Y=(M==null?void 0:M.logo)||"",oe=(M==null?void 0:M.logo2)||"",ee=20,re=Math.floor(m.x+(G.marginLeft??0)),me=Math.floor(m.y+(G.marginTop??0)+Math.max(0,Math.floor(((G.size??12)-ee)/2))),K=[Y].filter(Boolean);oe&&K.push(oe);const ye=a.getStyles(),Me=((_=ye==null?void 0:ye.pane)==null?void 0:_.backgroundColor)||"#ffffff";let Fe=255,Ze=255,Ge=255;if(Me.startsWith("#")){const bt=Me.replace(/^#/,""),nt=parseInt(bt.length===3?bt.split("").map(Pt=>Pt+Pt).join(""):bt,16);Fe=nt>>16&255,Ze=nt>>8&255,Ge=nt&255}else if(/rgba?\(/i.test(Me)){const bt=Me.match(/rgba?\(([^)]+)\)/i);if(bt){const nt=bt[1].split(",").map(Pt=>parseFloat(Pt.trim()));Fe=nt[0]??Fe,Ze=nt[1]??Ze,Ge=nt[2]??Ge}}const it=.299*Fe+.587*Ze+.114*Ge,Ye=it>186?"#CBD5E1":"#4B5563",ct=it>186?"rgba(255,255,255,0.7)":"rgba(17,24,39,0.6)",kt=bt=>{var St,Ne;const Pt=((M==null?void 0:M.shortName)||(M==null?void 0:M.ticker)||(M==null?void 0:M.name)||""||"").toString().trim().charAt(0).toUpperCase(),Qe=2,yt=Math.max(8,ee-Qe*2),xe=Av(Pt,yt,G.weight,G.family),Ve=Math.max(0,Math.floor((ee-Qe*2-xe)/2)),Je=Qe;(St=this.createFigure({name:"rect",attrs:{x:bt,y:me,width:ee,height:ee},styles:{style:"stroke_fill",color:ct,borderColor:Ye,borderSize:1,borderRadius:ee/2}}))==null||St.draw(t),(Ne=this.createFigure({name:"text",attrs:{x:bt+Qe,y:me+Qe,text:Pt,width:ee-Qe*2,height:ee-Qe*2},styles:{backgroundColor:ct,borderRadius:(ee-Qe*2)/2,size:yt,family:G.family,weight:G.weight,color:Ye,paddingLeft:Ve,paddingTop:Je,paddingRight:0,paddingBottom:0}}))==null||Ne.draw(t)};let ft=ee;K.forEach((bt,nt)=>{var Qe,yt;const Pt=Math.floor(re+(nt===0?0:ee-8));if(bt){if(!this._logoSubscribed[bt]){this._logoSubscribed[bt]=!0;try{P6(bt,()=>{try{this.getWidget().getPane().getChart().updatePane(fu.Overlay,nd.CANDLE)}catch{}})}catch{}}N1(bt);let xe=k6(bt)||this._logoCache[bt];xe.complete&&xe.naturalWidth>0?((Qe=this.createFigure({name:"rect",attrs:{x:Pt,y:me,width:ee,height:ee},styles:{style:"stroke_fill",color:ct,borderColor:Ye,borderSize:1,borderRadius:ee/2}}))==null||Qe.draw(t),(yt=this.createFigure({name:"image",attrs:{x:Pt+2,y:me+2,width:ee-4,height:ee-4,image:xe,borderRadius:(ee-4)/2},styles:{}}))==null||yt.draw(t)):kt(Pt)}else kt(Pt)}),ft=K.length===2?ee*2-8:ee,G.marginLeft=(G.marginLeft??0)+ft+6}catch{}const se=this.drawStandardTooltipLegends(t,[{title:{text:"",color:Z},value:{text:J,color:Z}}],m,o,0,typeof window<"u"&&window.innerWidth<=768?r-(M!=null&&M.logo2?20*2-6:20):r,G);p=Math.max(p,se)}const S=this._getCandleTooltipLegends(),P=this.classifyTooltipFeatures(c.features);p=this.drawStandardTooltipFeatures(t,P[0],m,null,o,p,r),p=this.drawStandardTooltipFeatures(t,P[1],m,null,o,p,r);try{typeof window<"u"&&window.innerWidth<=768&&(m.x=o,m.y+=p,p=0)}catch{}if(S.length>0){let I={...d};try{if(typeof window<"u"&&window.innerWidth<=768){let F=I.size;const V=I.family,j=I.weight;let D=I.marginLeft??0,R=I.marginRight??0;for(D=Math.min(D,4),R=Math.min(R,4),I.marginLeft=D,I.marginRight=R;F>8;){t.font=sg(F,j,V);let W=0;if(S.forEach(J=>{const Z=J.title,G=J.value,se=Z.text.length>0?t.measureText(Z.text).width:0,Y=t.measureText(G.text).width,oe=Z.text.length>0&&G.text.length>0?2:0;W+=D+se+oe+Y+R}),m.x+W<=r)break;F-=1}I.size=F}}catch{}const C={...I,marginTop:Math.max(I.marginTop??0,Math.floor((p-I.size)/2))};p=this.drawStandardTooltipLegends(t,S,m,o,p,r,C)}p=this.drawStandardTooltipFeatures(t,P[2],m,null,o,p,r)}return m.y+p}_drawRectTooltip(t,o,i,r){var w;const a=this.getWidget(),l=a.getPane(),c=l.getChart().getChartStore(),d=c.getStyles(),p=d.candle,m=d.indicator,h=p.tooltip,_=m.tooltip;if(o||i){const S=this._getCandleTooltipLegends(),{offsetLeft:P,offsetTop:I,offsetRight:C,offsetBottom:M}=h,{marginLeft:F,marginRight:V,marginTop:j,marginBottom:D,size:R,weight:W,family:J}=h.legend,{position:Z,paddingLeft:G,paddingRight:se,paddingTop:Y,paddingBottom:oe,offsetLeft:ee,offsetRight:re,offsetTop:me,offsetBottom:K,borderSize:ye,borderRadius:Me,borderColor:Fe,color:Ze}=h.rect;let Ge=0,it=0,Ye=0;o&&(t.font=sg(R,W,J),S.forEach(xe=>{const Ve=xe.title,Je=xe.value,St=`${Ve.text}${Je.text}`,Ne=t.measureText(St).width+F+V;Ge=Math.max(Ge,Ne)}),Ye+=(D+j+R)*S.length);const{marginLeft:ct,marginRight:kt,marginTop:ft,marginBottom:bt,size:nt,weight:Pt,family:Qe}=_.legend,yt=[];if(i){const xe=c.getIndicatorsByPaneId(l.getId());t.font=sg(nt,Pt,Qe),xe.forEach(Ve=>{const Je=this.getIndicatorTooltipData(Ve).legends;yt.push(Je),Je.forEach(St=>{const Ne=St.title,ue=St.value,he=`${Ne.text}${ue.text}`,_t=t.measureText(he).width+ct+kt;Ge=Math.max(Ge,_t),Ye+=ft+bt+nt})})}if(it+=Ge,it!==0&&Ye!==0){const xe=c.getCrosshair(),Ve=a.getBounding(),Je=l.getYAxisWidget().getBounding();it+=ye*2+G+se,Ye+=ye*2+Y+oe;const St=Ve.width/2,Ne=Z==="pointer"&&xe.paneId===nd.CANDLE,ue=(xe.realX??0)>St;let he=0;if(Ne){const Zt=xe.realX;ue?he=Zt-re-it:he=Zt+ee}else{const Zt=this.getWidget().getPane().getAxisComponent();ue?(he=ee+P,Zt.inside&&Zt.position==="left"&&(he+=Je.width)):(he=Ve.width-re-it-C,Zt.inside&&Zt.position==="right"&&(he-=Je.width))}let _t=r+me;Ne&&(_t=xe.y-Ye/2,_t+Ye>Ve.height-K-M&&(_t=Ve.height-K-Ye-M),_t<r+me&&(_t=r+me+I)),(w=this.createFigure({name:"rect",attrs:{x:he,y:_t,width:it,height:Ye},styles:{style:"stroke_fill",color:Ze,borderColor:Fe,borderSize:ye,borderRadius:Me}}))==null||w.draw(t);const Wt=he+ye+G+F;let jt=_t+ye+Y;if(o&&S.forEach(Zt=>{var un,On;jt+=j;const dn=Zt.title;(un=this.createFigure({name:"text",attrs:{x:Wt,y:jt,text:dn.text},styles:{color:dn.color,size:R,family:J,weight:W}}))==null||un.draw(t);const zn=Zt.value;(On=this.createFigure({name:"text",attrs:{x:he+it-ye-V-se,y:jt,text:zn.text,align:"right"},styles:{color:zn.color,size:R,family:J,weight:W}}))==null||On.draw(t),jt+=R+D}),i){const Zt=he+ye+G+ct;yt.forEach(dn=>{dn.forEach(zn=>{var no,fs;jt+=ft;const un=zn.title,On=zn.value;(no=this.createFigure({name:"text",attrs:{x:Zt,y:jt,text:un.text},styles:{color:un.color,size:nt,family:Qe,weight:Pt}}))==null||no.draw(t),(fs=this.createFigure({name:"text",attrs:{x:he+it-ye-kt-se,y:jt,text:On.text,align:"right"},styles:{color:On.color,size:nt,family:Qe,weight:Pt}}))==null||fs.draw(t),jt+=nt+bt})})}}}}_getCandleTooltipLegends(){const t=this.getWidget().getPane().getChart().getChartStore(),o=t.getStyles().candle,i=t.getDataList(),r=t.getInnerFormatter(),a=t.getDecimalFold(),l=t.getThousandsSeparator(),c=t.getLocale(),{pricePrecision:d=Tv.PRICE,volumePrecision:p=Tv.VOLUME}=t.getSymbol()??{},m=t.getPeriod(),h=t.getCrosshair().dataIndex??0,_=t.getSymbol(),S=((_==null?void 0:_.type)||"").toLowerCase()==="stock",I=o.tooltip.legend,{color:C,defaultValue:M}=I,F=I.template,V=i[h-1]??null,j=i[h],D=(V==null?void 0:V.close)??j.close,R=j.close-D,W={...j,time:r.formatDate(j.timestamp,cx[(m==null?void 0:m.type)??"day"],"tooltip"),open:a.format(l.format(Mv(j.open,d))),high:a.format(l.format(Mv(j.high,d))),low:a.format(l.format(Mv(j.low,d))),close:a.format(l.format(Mv(j.close,d))),volume:a.format(l.format(r.formatBigNumber(Mv(j.volume??M,p)))),turnover:a.format(l.format(Mv(j.turnover??M,d))),change:D===0?M:`${l.format(Mv(R/D*100))}%`},J=pf(F)?F({prev:V,current:j,next:i[h+1]??null},o):F;return(S?J:J.filter(G=>{const se=Af(G.title)?G.title.text:G.title,Y=Af(G.value)?G.value.text:G.value,oe=(se||"").toString().trim().toLowerCase(),ee=(Y||"").toString();return!(oe==="volume"||/\{volume\}/i.test(ee))})).map(G=>{const{title:se,value:Y}=G;let oe={text:"",color:C};Af(se)?oe=se:oe.text=se,oe.text=w6(oe.text,c);let ee={text:M,color:C};return Af(Y)?ee=Y:ee.text=Y,_o(/{change}/.exec(ee.text))&&(ee.color=R===0?o.priceMark.last.noChangeColor:R>0?o.priceMark.last.upColor:o.priceMark.last.downColor),ee.text=Ny(ee.text,W),{title:oe,value:ee}})}}class M6 extends Wf{constructor(t){super(t);Ce(this,"_activeFeatureInfo",null);Ce(this,"_featureClickEvent",t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCrosshairFeatureClick",t),!0));Ce(this,"_featureMouseMoveEvent",t=>()=>(this._activeFeatureInfo=t,this.getWidget().setForceCursor("pointer"),!0));this.registerEvent("mouseMoveEvent",o=>(this._activeFeatureInfo=null,this.getWidget().setForceCursor(null),!1))}drawImp(t){var d;const o=this.getWidget(),i=o.getPane(),r=o.getPane().getChart().getChartStore(),a=r.getCrosshair(),l=this.getWidget(),c=l.getPane().getAxisComponent();if(au(a.paneId)&&a.paneId===i.getId()&&c.isInCandle()){const p=r.getStyles().crosshair,m=p.horizontal.features;if(p.show&&p.horizontal.show&&m.length>0){const h=c.position==="right",_=l.getBounding();let w=0;const S=p.horizontal.text;if(c.inside&&S.show){const C=c.convertFromPixel(a.y),M=c.getRange();let F=c.displayValueToText(c.realValueToDisplayValue(c.valueToRealValue(C,{range:M}),{range:M}),((d=r.getSymbol())==null?void 0:d.pricePrecision)??Tv.PRICE);F=r.getDecimalFold().format(r.getThousandsSeparator().format(F)),w=S.paddingLeft+Av(F,S.size,S.weight,S.family)+S.paddingRight}let P=w;h&&(P=_.width-w);const I=a.y;m.forEach(C=>{var Fe,Ze,Ge,it;const{marginLeft:M=0,marginTop:F=0,marginRight:V=0,paddingLeft:j=0,paddingTop:D=0,paddingRight:R=0,paddingBottom:W=0,color:J,activeColor:Z,backgroundColor:G,activeBackgroundColor:se,borderRadius:Y,size:oe=0,type:ee,content:re}=C;let me=oe;if(ee==="icon_font"){const Ye=re;me=j+Av(Ye.code,oe,"normal",Ye.family)+R}h?P-=me+V:P+=M;let K=J,ye=G;((Fe=this._activeFeatureInfo)==null?void 0:Fe.feature.id)===C.id&&(K=Z??J,ye=se??G);const Me={mouseClickEvent:this._featureClickEvent({crosshair:a,feature:C}),mouseMoveEvent:this._featureMouseMoveEvent({crosshair:a,feature:C})};if(ee==="icon_font"){const Ye=re;(Ze=this.createFigure({name:"text",attrs:{text:Ye.code,x:P,y:I+F,baseline:"middle"},styles:{paddingLeft:j,paddingTop:D,paddingRight:R,paddingBottom:W,borderRadius:Y,size:oe,family:Ye.family,color:K,backgroundColor:ye}},Me))==null||Ze.draw(t)}else{(Ge=this.createFigure({name:"rect",attrs:{x:P,y:I+F-oe/2,width:oe,height:oe},styles:{paddingLeft:j,paddingTop:D,paddingRight:R,paddingBottom:W,color:ye}},Me))==null||Ge.draw(t);const Ye=re;(it=this.createFigure({name:"path",attrs:{path:Ye.path,x:P,y:I+F+D-oe/2,width:oe,height:oe},styles:{style:Ye.style,lineWidth:Ye.lineWidth,color:K}}))==null||it.draw(t)}h?P-=M:P+=me+V})}}}}class A6 extends lx{constructor(t,o){super(t,o);Ce(this,"_candleBarView",new ix(this));Ce(this,"_candleAreaView",new m6(this));Ce(this,"_candleHighLowPriceView",new g6(this));Ce(this,"_candleLastPriceLineView",new h6(this));Ce(this,"_crosshairFeatureView",new M6(this));this.addChild(this._candleBarView),this.addChild(this._crosshairFeatureView)}updateMainContent(t){this.getPane().getChart().getStyles().candle.type!=="area"?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleAreaView.stopAnimation()):this._candleAreaView.draw(t),this._candleLastPriceLineView.draw(t)}updateOverlayContent(t){this._crosshairFeatureView.draw(t)}createTooltipView(){return new I6(this)}}class ux extends Wf{drawImp(e,t){var c,d;const o=this.getWidget(),i=o.getPane(),r=o.getBounding(),a=i.getAxisComponent(),l=this.getAxisStyles(i.getChart().getStyles());if(l.show&&(l.axisLine.show&&((c=this.createFigure({name:"line",attrs:this.createAxisLine(r,l),styles:l.axisLine}))==null||c.draw(e)),!t[0])){const p=a.getTicks();if(l.tickLine.show&&this.createTickLines(p,r,l).forEach(h=>{var _;(_=this.createFigure({name:"line",attrs:h,styles:l.tickLine}))==null||_.draw(e)}),l.tickText.show){const m=this.createTickTexts(p,r,l);(d=this.createFigure({name:"text",attrs:m,styles:l.tickText}))==null||d.draw(e)}}}}class T6 extends ux{getAxisStyles(e){return e.yAxis}createAxisLine(e,t){const o=this.getWidget().getPane().getAxisComponent(),i=t.axisLine.size;let r=0;return o.isFromZero()?r=0:r=e.width-i,{coordinates:[{x:r,y:0},{x:r,y:e.height}]}}createTickLines(e,t,o){const i=this.getWidget().getPane().getAxisComponent(),r=o.axisLine,a=o.tickLine;let l=0,c=0;return i.isFromZero()?(l=0,r.show&&(l+=r.size),c=l+a.length):(l=t.width,r.show&&(l-=r.size),c=l-a.length),e.map(d=>({coordinates:[{x:l,y:d.coord},{x:c,y:d.coord}]}))}createTickTexts(e,t,o){const i=this.getWidget().getPane().getAxisComponent(),r=o.axisLine,a=o.tickLine,l=o.tickText;let c=0;i.isFromZero()?(c=l.marginStart,r.show&&(c+=r.size),a.show&&(c+=a.length)):(c=t.width-l.marginEnd,r.show&&(c-=r.size),a.show&&(c-=a.length));const d=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return e.map(p=>({x:c,y:p.coord,text:p.text,align:d,baseline:"middle"}))}}class L6 extends Wf{drawImp(e){var d,p,m,h,_,w;const t=this.getWidget(),o=t.getPane(),i=t.getBounding(),r=o.getChart().getChartStore(),a=r.getStyles().candle.priceMark,l=a.last,c=l.text;if(a.show&&l.show&&c.show){const S=r.getStyles().yAxis,P=S.axisLine.show?S.axisLine.size:0,I=S.tickLine.show?S.tickLine.length:0,C=S.tickText.marginStart,M=S.tickText.marginEnd,F=1,V=((d=r.getSymbol())==null?void 0:d.pricePrecision)??Tv.PRICE,j=o.getAxisComponent(),D=r.getVisibleRangeDataList(),R=j.position==="right"?D.length-1:0,W=r.getDataList(),J=W[W.length-1];if(_o(J)){const{close:Z,open:G}=J,se=l.compareRule==="current_open"?G:((p=W[W.length-2])==null?void 0:p.close)??Z,Y=j.convertToPixel(Z);let oe="";Z>se?oe=l.upColor:Z<se?oe=l.downColor:oe=l.noChangeColor;let ee=0,re="left";const me={...c};if(j.isFromZero())ee=P+F,re="left",me.paddingLeft=I+C-F;else{ee=i.width-P-F,re="right";const Ve=i.width-P-F,Je=i.width-(S.axisLine.show?S.axisLine.size:0)-(S.tickLine.show?S.tickLine.length:0)-M;me.paddingRight=Ve-Je}const K=[],ye=j.getRange();let Me=j.displayValueToText(j.realValueToDisplayValue(j.valueToRealValue(Z,{range:ye}),{range:ye}),V);Me=r.getDecimalFold().format(r.getThousandsSeparator().format(Me));const{paddingLeft:Fe,paddingRight:Ze,paddingTop:Ge,paddingBottom:it,size:Ye,family:ct,weight:kt}=me;let ft=Fe+Av(Me,Ye,kt,ct)+Ze;const bt=Ge+Ye+it;K.push({name:"text",attrs:{x:ee,y:Y,width:ft,height:bt,text:Me,align:re,baseline:"middle"},styles:{...me,backgroundColor:oe}});const nt=r.getInnerFormatter().formatExtendText,Pt=Ye/2;let Qe=Y-Pt-Ge,yt=Y+Pt+it;l.extendTexts.forEach((Ve,Je)=>{const St=nt({type:"last_price",data:J,index:Je});if(St.length>0&&Ve.show){const Ne=Ve.size/2;let ue=0;Ve.position==="above_price"?(Qe-=Ve.paddingBottom+Ne,ue=Qe,Qe-=Ne+Ve.paddingTop):(yt+=Ve.paddingTop+Ne,ue=yt,yt+=Ne+Ve.paddingBottom),ft=Math.max(ft,Ve.paddingLeft+Av(St,Ve.size,Ve.weight,Ve.family)+Ve.paddingRight),K.push({name:"text",attrs:{x:ee,y:ue,width:ft,height:Ve.paddingTop+Ve.size+Ve.paddingBottom,text:St,align:re,baseline:"middle"},styles:{...Ve,backgroundColor:oe}})}});const xe=(m=D[R])==null?void 0:m.data.current;if(_o(xe)&&xe.timestamp!==J.timestamp){const{close:Ve,open:Je}=xe,St=j.position==="right"?(h=D[R-1])==null?void 0:h.data.current:(_=D[R+1])==null?void 0:_.data.current,Ne=l.compareRule==="current_open"?Je:(St==null?void 0:St.close)??((w=W[W.length-2])==null?void 0:w.close)??Ve,ue=j.convertToPixel(Ve);let he="";Ve>Ne?he=l.upColor:Ve<Ne?he=l.downColor:he=l.noChangeColor;let _t=j.displayValueToText(j.realValueToDisplayValue(j.valueToRealValue(Ve,{range:ye}),{range:ye}),V);_t=r.getDecimalFold().format(r.getThousandsSeparator().format(_t));let Wt=Fe+Av(_t,Ye,kt,ct)+Ze;const jt=Ge+Ye+it;K.push({name:"text",attrs:{x:ee,y:ue,width:Wt,height:jt,text:_t,align:re,baseline:"middle"},styles:{...me,backgroundColor:he}});const Zt=Ye/2;let dn=ue-Zt-Ge,zn=ue+Zt+it;l.extendTexts.forEach((un,On)=>{const no=nt({type:"last_price",data:xe,index:On});if(no.length>0&&un.show){const fs=un.size/2;let ps=0;un.position==="above_price"?(dn-=un.paddingBottom+fs,ps=dn,dn-=fs+un.paddingTop):(zn+=un.paddingTop+fs,ps=zn,zn+=fs+un.paddingBottom),Wt=Math.max(Wt,un.paddingLeft+Av(no,un.size,un.weight,un.family)+un.paddingRight),K.push({name:"text",attrs:{x:ee,y:ps,width:Wt,height:un.paddingTop+un.size+un.paddingBottom,text:no,align:re,baseline:"middle"},styles:{...un,backgroundColor:he}})}})}K.forEach(Ve=>{var Je;(Je=this.createFigure(Ve))==null||Je.draw(e)})}}}}class F6 extends Wf{drawImp(e){var d,p;const t=this.getWidget(),o=t.getPane(),i=t.getBounding(),r=o.getChart().getChartStore(),a=r.getStyles().indicator,l=a.lastValueMark,c=l.text;if(l.show){const m=r.getStyles().yAxis,h=m.axisLine.show?m.axisLine.size:0,_=m.tickLine.show?m.tickLine.length:0,w=m.tickText.marginStart,S=m.tickText.marginEnd,P=1,I=o.getAxisComponent(),C=I.getRange(),M=r.getVisibleRangeDataList(),F=I.position==="right"?M.length-1:0,V=r.getDataList(),j=((d=M[F])==null?void 0:d.data.current)??V[V.length-1]??{},D=((p=M[F-(I.position==="right"?1:-1)])==null?void 0:p.data.current)??V[V.length-2]??{},R=r.getIndicatorsByPaneId(o.getId()),W=r.getInnerFormatter(),J=r.getDecimalFold(),Z=r.getThousandsSeparator();R.forEach(G=>{const se=G.result,Y=se[j.timestamp]??se[D.timestamp]??{};if(_o(Y)&&G.visible){const oe=G.precision;Q1(G,{prev:D.timestamp,current:j.timestamp,next:null},a,(ee,re)=>{var K;const me=Y[ee.key];if(fl(me)){const ye=I.convertToPixel(me);let Me=I.displayValueToText(I.realValueToDisplayValue(I.valueToRealValue(me,{range:C}),{range:C}),oe);G.shouldFormatBigNumber&&(Me=W.formatBigNumber(Me)),Me=J.format(Z.format(Me));let Fe=0,Ze="left";const Ge={...c};if(I.isFromZero())Fe=h+P,Ze="left",Ge.paddingLeft=_+w-P;else{Fe=i.width-h-P,Ze="right";const it=i.width-h-P,Ye=i.width-(m.axisLine.show?m.axisLine.size:0)-(m.tickLine.show?m.tickLine.length:0)-S;Ge.paddingRight=it-Ye}(K=this.createFigure({name:"text",attrs:{x:Fe,y:ye,text:Me,align:Ze,baseline:"middle"},styles:{...Ge,backgroundColor:re.color}}))==null||K.draw(e)}})}})}}}class px extends ax{coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(e,t,o){this.drawFigures(e,t,this.getDefaultFigures(t,o))}getDefaultFigures(e,t){var c;const o=this.getWidget(),i=o.getPane(),r=i.getChart().getChartStore(),a=r.getClickOverlayInfo(),l=[];if(e.needDefaultYAxisFigure&&e.id===((c=a.overlay)==null?void 0:c.id)&&a.paneId===i.getId()){const d=i.getAxisComponent(),p=o.getBounding();let m=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;const _=d.isFromZero();let w="left",S=0;_?(w="left",S=0):(w="right",S=p.width);const P=r.getDecimalFold(),I=r.getThousandsSeparator();t.forEach((C,M)=>{var V;const F=e.points[M];if(fl(F.value)){m=Math.min(m,C.y),h=Math.max(h,C.y);const j=P.format(I.format(Mv(F.value,((V=r.getSymbol())==null?void 0:V.pricePrecision)??Tv.PRICE)));l.push({type:"text",attrs:{x:S,y:C.y,text:j,align:w,baseline:"middle"},ignoreEvent:!0})}}),t.length>1&&l.unshift({type:"rect",attrs:{x:0,y:m,width:p.width,height:h-m},ignoreEvent:!0})}return l}getFigures(e,t){var d;const o=this.getWidget(),i=o.getPane(),r=i.getChart(),a=i.getAxisComponent(),l=r.getXAxisPane().getAxisComponent(),c=o.getBounding();return((d=e.createYAxisFigures)==null?void 0:d.call(e,{chart:r,overlay:e,coordinates:t,bounding:c,xAxis:l,yAxis:a}))??[]}}class vx extends Wf{drawImp(e){var a;const t=this.getWidget(),o=t.getPane(),i=t.getPane().getChart().getChartStore(),r=i.getCrosshair();if(au(r.paneId)&&this.compare(r,o.getId())){const l=i.getStyles().crosshair;if(l.show){const c=this.getDirectionStyles(l),d=c.text;if(c.show&&d.show){const p=t.getBounding(),m=o.getAxisComponent(),h=this.getText(r,i,m),_=i.getStyles().yAxis,w=_.axisLine.show?_.axisLine.size:0,S=_.tickLine.show?_.tickLine.length:0,P=_.tickText.marginStart,I=_.tickText.marginEnd,C=1,M=m,F={...d};if(M.isFromZero())F.paddingLeft=S+P-C;else{const V=p.width-w-C,j=p.width-(_.axisLine.show?_.axisLine.size:0)-(_.tickLine.show?_.tickLine.length:0)-I;F.paddingRight=V-j}e.font=sg(F.size,F.weight,F.family),(a=this.createFigure({name:"text",attrs:this.getTextAttrs(h,e.measureText(h).width,r,p,m,F),styles:F}))==null||a.draw(e)}}}}compare(e,t){return e.paneId===t}getDirectionStyles(e){return e.horizontal}getText(e,t,o){var p;const i=o,r=o.convertFromPixel(e.y);let a=0,l=!1;i.isInCandle()?a=((p=t.getSymbol())==null?void 0:p.pricePrecision)??Tv.PRICE:t.getIndicatorsByPaneId(e.paneId).forEach(h=>{a=Math.max(h.precision,a),l||(l=h.shouldFormatBigNumber)});const c=i.getRange();let d=i.displayValueToText(i.realValueToDisplayValue(i.valueToRealValue(r,{range:c}),{range:c}),a);return l&&(d=t.getInnerFormatter().formatBigNumber(d)),t.getDecimalFold().format(t.getThousandsSeparator().format(d))}getTextAttrs(e,t,o,i,r,a){const l=r,c=this.getWidget().getPane().getChart().getStyles(),d=c.yAxis.axisLine.show?c.yAxis.axisLine.size:0,p=1;let m=0,h="left";return l.isFromZero()?(m=d+p,h="left"):(m=i.width-d-p,h="right"),{x:m,y:o.y,text:e,align:h,baseline:"middle"}}}class $6 extends sy{constructor(t,o){super(t,o);Ce(this,"_yAxisView",new T6(this));Ce(this,"_candleLastPriceLabelView",new L6(this));Ce(this,"_indicatorLastValueView",new F6(this));Ce(this,"_overlayYAxisView",new px(this));Ce(this,"_crosshairHorizontalLabelView",new vx(this));this.setCursor("ns-resize"),this.addChild(this._overlayYAxisView)}getName(){return fd.Y_AXIS}updateMain(t){const o=this.getPane().getOptions().state==="minimize";this._yAxisView.draw(t,o),o||(this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t))}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t))}}function Yy(){return{from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0,displayFrom:0,displayTo:0,displayRange:0}}class fx{constructor(e){Ce(this,"name");Ce(this,"scrollZoomEnabled",!0);Ce(this,"createTicks");Ce(this,"_parent");Ce(this,"_range",Yy());Ce(this,"_prevRange",Yy());Ce(this,"_ticks",[]);Ce(this,"_autoCalcTickFlag",!0);this._parent=e}getParent(){return this._parent}buildTicks(e){if(this._autoCalcTickFlag&&(this._range=this.createRangeImp()),this._prevRange.from!==this._range.from||this._prevRange.to!==this._range.to||e){this._prevRange=this._range;const t=typeof performance<"u"?performance.now():Date.now();this._ticks=this.createTicksImp();const i=(typeof performance<"u"?performance.now():Date.now())-t;return i>20&&console.warn("⚠️ klinecharts: axis createTicks slow",{name:this.name,durationMs:Math.round(i)}),!0}return!1}getTicks(){return this._ticks}setRange(e){this._autoCalcTickFlag=!1,this._range=e}getRange(){return this._range}setAutoCalcTickFlag(e){this._autoCalcTickFlag=e}getAutoCalcTickFlag(){return this._autoCalcTickFlag}}const Z_=8;class Jg extends fx{constructor(t,o){super(t);Ce(this,"reverse",!1);Ce(this,"inside",!1);Ce(this,"position","right");Ce(this,"gap",{top:.2,bottom:.1});Ce(this,"createRange",t=>t.defaultRange);Ce(this,"minSpan",t=>Ag(-t));Ce(this,"valueToRealValue",t=>t);Ce(this,"realValueToDisplayValue",t=>t);Ce(this,"displayValueToRealValue",t=>t);Ce(this,"realValueToValue",t=>t);Ce(this,"displayValueToText",(t,o)=>Mv(t,o));this.override(o)}override(t){const{name:o,gap:i,...r}=t;au(this.name)||(this.name=o),Op(this.gap,i),Op(this,r)}createRangeImp(){var ye;const t=this.getParent(),o=t.getChart(),i=o.getChartStore(),r=t.getId();let a=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,c=!1,d=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,m=Number.MAX_SAFE_INTEGER;const h=i.getIndicatorsByPaneId(r);h.forEach(Me=>{c||(c=Me.shouldOhlc),m=Math.min(m,Me.precision),fl(Me.minValue)&&(d=Math.min(d,Me.minValue)),fl(Me.maxValue)&&(p=Math.max(p,Me.maxValue))});let _=4;const w=this.isInCandle();if(w){const Me=((ye=i.getSymbol())==null?void 0:ye.pricePrecision)??Tv.PRICE;m!==Number.MAX_SAFE_INTEGER?_=Math.min(m,Me):_=Me}else m!==Number.MAX_SAFE_INTEGER&&(_=m);const S=i.getVisibleRangeDataList(),P=o.getStyles().candle,I=P.type==="area",C=P.area.value,M=w&&!I||!w&&c;S.forEach(Me=>{const Fe=Me.data.current;if(_o(Fe)){if(M&&(a=Math.min(a,Fe.low),l=Math.max(l,Fe.high)),w&&I){const Ze=Fe[C];fl(Ze)&&(a=Math.min(a,Ze),l=Math.max(l,Ze))}h.forEach(({result:Ze,figures:Ge})=>{const it=Ze[Fe.timestamp]??{};Ge.forEach(Ye=>{const ct=it[Ye.key];fl(ct)&&(a=Math.min(a,ct),l=Math.max(l,ct))})})}}),a!==Number.MAX_SAFE_INTEGER&&l!==Number.MIN_SAFE_INTEGER?(a=Math.min(d,a),l=Math.max(p,l)):(a=0,l=10);const F=l-a,V={from:a,to:l,range:F,realFrom:a,realTo:l,realRange:F,displayFrom:a,displayTo:l,displayRange:F},j=this.createRange({chart:o,paneId:r,defaultRange:V});let D=j.realFrom,R=j.realTo,W=j.realRange;const J=this.minSpan(_);if(D===R||W<J){const Me=d===D,Fe=p===R,Ze=Z_/2;D=Me?D:Fe?D-Z_*J:D-Ze*J,R=Fe?R:Me?R+Z_*J:R+Ze*J}const Z=this.getBounding().height,{top:G,bottom:se}=this.gap;let Y=G;Y>=1&&(Y=Y/Z);let oe=se;oe>=1&&(oe=oe/Z),W=R-D,D=D-W*oe,R=R+W*Y;const ee=this.realValueToValue(D,{range:j}),re=this.realValueToValue(R,{range:j}),me=this.realValueToDisplayValue(D,{range:j}),K=this.realValueToDisplayValue(R,{range:j});return{from:ee,to:re,range:re-ee,realFrom:D,realTo:R,realRange:R-D,displayFrom:me,displayTo:K,displayRange:K-me}}isInCandle(){return this.getParent().getId()===nd.CANDLE}isFromZero(){return this.position==="left"&&this.inside||this.position==="right"&&!this.inside}createTicksImp(){var Y,oe;const t=this.getRange(),{displayFrom:o,displayTo:i}=t,r=this.getParent(),a=((Y=r.getYAxisWidget())==null?void 0:Y.getBounding().height)??0,l=40,c=80,d=60,p=a/Math.max(1e-12,t.realRange),m=d/Math.max(1e-12,p),h=[1,2,5];let _=m,w=Number.MAX_VALUE,S=0;for(let ee=-12;ee<=12;ee++){const re=Math.pow(10,ee);for(const me of h){const K=me*re,ye=K*p,Me=ye>=l&&ye<=c,Fe=Math.abs(ye-d);Me&&Fe<w&&(w=Fe,_=K,S=ye),!Me&&Fe<w&&_===m&&(w=Fe,_=K,S=ye)}}let P=_;S<l?P=Ry(l/Math.max(1e-12,p)):S>c&&(P=Ry(c/Math.max(1e-12,p)));const I=Pk(P),C=[];if(P>0){let ee=By(Math.ceil(o/P)*P,I);const re=By(Math.floor(i/P)*P,I),me=Math.ceil(a/l)+2;let K=0;for(;ee<=re&&K<me;){const ye=ee.toFixed(I);C.push({text:ye,coord:0,value:ye}),ee+=P,K+=1}}const M=r.getChart().getChartStore(),F=[],V=M.getIndicatorsByPaneId(r.getId()),j=M.getStyles();let D=0,R=!1;this.isInCandle()?D=((oe=M.getSymbol())==null?void 0:oe.pricePrecision)??Tv.PRICE:V.forEach(ee=>{D=Math.max(D,ee.precision),R||(R=ee.shouldFormatBigNumber)});const W=M.getInnerFormatter(),J=M.getThousandsSeparator(),Z=M.getDecimalFold(),G=j.xAxis.tickText.size;let se=NaN;return C.forEach(({value:ee})=>{let re=this.displayValueToText(+ee,D);const me=this.convertToPixel(this.realValueToValue(this.displayValueToRealValue(+ee,{range:t}),{range:t}));R&&(re=W.formatBigNumber(ee)),re=Z.format(J.format(re));const K=fl(se);me>G&&me<a-G&&(K&&Math.abs(se-me)>G*2||!K)&&(F.push({text:re,coord:me,value:ee}),se=me)}),pf(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:F}):F}getAutoSize(){var S;const t=this.getParent(),i=t.getChart().getChartStore(),r=i.getStyles(),a=r.yAxis,l=a.size;if(l!=="auto")return l;let c=0;if(a.show&&(a.axisLine.show&&(c+=a.axisLine.size),a.tickLine.show&&(c+=a.tickLine.length),a.tickText.show)){let P=0;this.getTicks().forEach(I=>{P=Math.max(P,Av(I.text,a.tickText.size,a.tickText.weight,a.tickText.family))}),c+=a.tickText.marginStart+a.tickText.marginEnd+P}const d=r.candle.priceMark,p=d.show&&d.last.show&&d.last.text.show;let m=0;const h=r.crosshair,_=h.show&&h.horizontal.show&&h.horizontal.text.show;let w=0;if(p||_){const P=((S=i.getSymbol())==null?void 0:S.pricePrecision)??Tv.PRICE,I=this.getRange().displayTo;if(p){const C=i.getDataList(),M=C[C.length-1];if(_o(M)){const{paddingLeft:F,paddingRight:V,size:j,family:D,weight:R}=d.last.text;m=F+Av(Mv(M.close,P),j,R,D)+V;const W=i.getInnerFormatter().formatExtendText;d.last.extendTexts.forEach((J,Z)=>{const G=W({type:"last_price",data:M,index:Z});G.length>0&&J.show&&(m=Math.max(m,J.paddingLeft+Av(G,J.size,J.weight,J.family)+J.paddingRight))})}}if(_){const C=i.getIndicatorsByPaneId(t.getId());let M=0,F=!1;C.forEach(D=>{M=Math.max(D.precision,M),F||(F=D.shouldFormatBigNumber)});let V=2;if(this.isInCandle()){const D=r.indicator.lastValueMark;D.show&&D.text.show?V=Math.max(M,P):V=P}else V=M;let j=Mv(I,V);F&&(j=i.getInnerFormatter().formatBigNumber(j)),j=i.getDecimalFold().format(j),w+=h.horizontal.text.paddingLeft+h.horizontal.text.paddingRight+h.horizontal.text.borderSize*2+Av(j,h.horizontal.text.size,h.horizontal.text.weight,h.horizontal.text.family)}}return Math.max(c,m,w)}getBounding(){return this.getParent().getYAxisWidget().getBounding()}convertFromPixel(t){const o=this.getBounding().height,i=this.getRange(),{realFrom:r,realRange:a}=i,c=(this.reverse?t/o:1-t/o)*a+r;return this.realValueToValue(c,{range:i})}convertToPixel(t){var d;const o=this.getRange(),i=this.valueToRealValue(t,{range:o}),r=((d=this.getParent().getYAxisWidget())==null?void 0:d.getBounding().height)??0,{realFrom:a,realRange:l}=o,c=(i-a)/l;return this.reverse?Math.round(c*r):Math.round((1-c)*r)}convertToNicePixel(t){var r;const o=((r=this.getParent().getYAxisWidget())==null?void 0:r.getBounding().height)??0,i=this.convertToPixel(t);return Math.round(Math.max(o*.05,Math.min(i,o*.98)))}static extend(t){class o extends Jg{constructor(r){super(r,t)}}return o}}const E6={name:"normal"},N6={name:"percentage",minSpan:()=>Math.pow(10,-2),displayValueToText:n=>`${Mv(n,2)}%`,valueToRealValue:(n,{range:e})=>(n-e.from)/e.range*e.realRange+e.realFrom,realValueToValue:(n,{range:e})=>(n-e.realFrom)/e.realRange*e.range+e.from,createRange:({chart:n,defaultRange:e})=>{const t=n.getDataList(),o=n.getVisibleRange(),i=t[o.from];if(_o(i)){const{from:r,to:a,range:l}=e,c=(e.from-i.close)/i.close*100,d=(e.to-i.close)/i.close*100,p=d-c;return{from:r,to:a,range:l,realFrom:c,realTo:d,realRange:p,displayFrom:c,displayTo:d,displayRange:p}}return e}},D6={name:"logarithm",minSpan:n=>.05*Ag(-n),valueToRealValue:n=>n<0?-Qm(Math.abs(n)):Qm(n),realValueToDisplayValue:n=>n<0?-Ag(Math.abs(n)):Ag(n),displayValueToRealValue:n=>n<0?-Qm(Math.abs(n)):Qm(n),realValueToValue:n=>n<0?-Ag(Math.abs(n)):Ag(n),createRange:({defaultRange:n})=>{const{from:e,to:t,range:o}=n,i=e<0?-Qm(Math.abs(e)):Qm(e),r=t<0?-Qm(Math.abs(t)):Qm(t);return{from:e,to:t,range:o,realFrom:i,realTo:r,realRange:r-i,displayFrom:e,displayTo:t,displayRange:o}}},Ky={normal:Jg.extend(E6),percentage:Jg.extend(N6),logarithm:Jg.extend(D6)};function j6(n){return Ky[n]??Ky.normal}class mx{constructor(e,t){Ce(this,"_container");Ce(this,"_id");Ce(this,"_chart");Ce(this,"_bounding",l_());Ce(this,"_originalBounding",l_());Ce(this,"_visible",!0);this._chart=e,this._id=t,this._container=rg("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"})}getContainer(){return this._container}setVisible(e){this._visible!==e&&(this._container.style.display=e?"block":"none",this._visible=e)}getVisible(){return this._visible}getId(){return this._id}getChart(){return this._chart}getBounding(){return this._bounding}setOriginalBounding(e){Op(this._originalBounding,e)}getOriginalBounding(){return this._originalBounding}update(e){this._bounding.height!==this._container.clientHeight&&(this._container.style.height=`${this._bounding.height}px`),this.updateImp(e??fu.Drawer,this._container,this._bounding)}}class gx extends mx{constructor(t,o,i){super(t,o);Ce(this,"_mainWidget");Ce(this,"_yAxisWidget",null);Ce(this,"_axis");Ce(this,"_options",{id:"",minHeight:Z0,dragEnabled:!0,order:0,height:K2,state:"normal",axis:{name:"normal",scrollZoomEnabled:!0}});const r=this.getContainer();this._mainWidget=this.createMainWidget(r),this._yAxisWidget=this.createYAxisWidget(r),this.setOptions(i)}setOptions(t){var a,l,c;const o=this.getId();if(o===nd.CANDLE||o===nd.X_AXIS){const d=(a=t.axis)==null?void 0:a.name;(!_o(this._axis)||_o(d)&&this._options.axis.name!==d)&&(this._axis=this.createAxisComponent(d??"normal"))}else _o(this._axis)||(this._axis=this.createAxisComponent("normal"));this._axis instanceof Jg&&this._axis.setAutoCalcTickFlag(!0),Op(this._options,t),this._axis.override({...this._options.axis,name:((l=t.axis)==null?void 0:l.name)??"normal"});let i=null,r="default";return this.getId()===nd.X_AXIS?(i=this.getMainWidget().getContainer(),r="ew-resize"):(i=this.getYAxisWidget().getContainer(),r="ns-resize"),((c=t.axis)==null?void 0:c.scrollZoomEnabled)??!0?i.style.cursor=r:i.style.cursor="default",this}getOptions(){return this._options}getAxisComponent(){return this._axis}setBounding(t,o,i,r){Op(this.getBounding(),t);const a={};_o(t.height)&&(a.height=t.height),_o(t.top)&&(a.top=t.top),this._mainWidget.setBounding(a);const l=_o(o);return l&&this._mainWidget.setBounding(o),_o(this._yAxisWidget)&&(this._yAxisWidget.setBounding(a),this._axis.position==="left"?_o(i)&&this._yAxisWidget.setBounding({...i,left:0}):_o(r)&&(this._yAxisWidget.setBounding(r),l&&this._yAxisWidget.setBounding({left:(o.left??0)+(o.width??0)+(o.right??0)-(r.width??0)}))),this}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}updateImp(t){var o;this._mainWidget.update(t),(o=this._yAxisWidget)==null||o.update(t)}destroy(){var t;this._mainWidget.destroy(),(t=this._yAxisWidget)==null||t.destroy()}getImage(t){const{width:o,height:i}=this.getBounding(),r=rg("canvas",{width:`${o}px`,height:`${i}px`,boxSizing:"border-box"}),a=r.getContext("2d"),l=yg(r);r.width=o*l,r.height=i*l,a.scale(l,l);const c=this._mainWidget.getBounding();if(a.drawImage(this._mainWidget.getImage(t),c.left,0,c.width,c.height),this._yAxisWidget!==null){const d=this._yAxisWidget.getBounding();a.drawImage(this._yAxisWidget.getImage(t),d.left,0,d.width,d.height)}return r}createYAxisWidget(t){return null}}class hx extends gx{createAxisComponent(e){const t=j6(e??"default");return new t(this)}createMainWidget(e){return new lx(e,this)}createYAxisWidget(e){return new $6(e,this)}}class R6 extends hx{createMainWidget(e){return new A6(e,this)}}class B6 extends ux{getAxisStyles(e){return e.xAxis}createAxisLine(e){return{coordinates:[{x:0,y:0},{x:e.width,y:0}]}}createTickLines(e,t,o){const i=o.tickLine,r=o.axisLine.size;return e.map(a=>({coordinates:[{x:a.coord,y:0},{x:a.coord,y:r+i.length}]}))}createTickTexts(e,t,o){const i=o.tickText,r=o.axisLine.size,a=o.tickLine.length;return e.map(l=>({x:l.coord,y:r+a+i.marginStart,text:l.text,align:"center",baseline:"top"}))}}class O6 extends px{coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(){return this.getWidget().getPane().getChart().getChartStore().getOverlaysByPaneId()}getProgressOverlay(){var e;return((e=this.getWidget().getPane().getChart().getChartStore().getProgressOverlayInfo())==null?void 0:e.overlay)??null}getDefaultFigures(e,t){var c;const o=[],i=this.getWidget(),a=i.getPane().getChart().getChartStore(),l=a.getClickOverlayInfo();if(e.needDefaultXAxisFigure&&e.id===((c=l.overlay)==null?void 0:c.id)){let d=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER;t.forEach((m,h)=>{d=Math.min(d,m.x),p=Math.max(p,m.x);const _=e.points[h];if(fl(_.timestamp)){const w=a.getInnerFormatter().formatDate(_.timestamp,"YYYY-MM-DD HH:mm","crosshair");o.push({type:"text",attrs:{x:m.x,y:0,text:w,align:"center"},ignoreEvent:!0})}}),t.length>1&&o.unshift({type:"rect",attrs:{x:d,y:0,width:p-d,height:i.getBounding().height},ignoreEvent:!0})}return o}getFigures(e,t){var d;const o=this.getWidget(),i=o.getPane(),r=i.getChart(),a=i.getAxisComponent(),l=r.getXAxisPane().getAxisComponent(),c=o.getBounding();return((d=e.createXAxisFigures)==null?void 0:d.call(e,{chart:r,overlay:e,coordinates:t,bounding:c,xAxis:l,yAxis:a}))??[]}}class z6 extends vx{drawImp(e){var a;const t=this.getWidget(),o=t.getPane().getChart().getChartStore(),i=o.getCrosshair(),r=o.getStyles().crosshair;if(r.show){const l=this.getDirectionStyles(r),c=l.text;if(l.show&&c.show&&this.compare(i)){const d=t.getBounding(),p=t.getPane().getAxisComponent(),m=this.getText(i,o),h=o.getStyles().xAxis.tickText,_={...c,size:h.size,family:h.family,weight:h.weight};e.font=sg(_.size,_.weight,_.family),(a=this.createFigure({name:"text",attrs:this.getTextAttrs(m,e.measureText(m).width,i,d,p,_),styles:_}))==null||a.draw(e)}}}compare(e){return _o(e.timestamp)}getDirectionStyles(e){return e.vertical}getText(e,t){var i;const o=e.timestamp;return t.getInnerFormatter().formatDate(o,cx[((i=t.getPeriod())==null?void 0:i.type)??"day"],"crosshair")}getTextAttrs(e,t,o,i,r,a){const c=this.getWidget().getPane().getChart().getStyles().xAxis,d=c.axisLine.size,p=c.tickLine.length,m=d+p+c.tickText.marginStart-(a.paddingTop??0),h=o.realX;let _=0,w="center";return h-t/2-a.paddingLeft<0?(_=0,w="left"):h+t/2+a.paddingRight>i.width?(_=i.width,w="right"):_=h,{x:_,y:m,text:e,align:w,baseline:"top"}}}class V6 extends sy{constructor(t,o){super(t,o);Ce(this,"_xAxisView",new B6(this));Ce(this,"_overlayXAxisView",new O6(this));Ce(this,"_crosshairVerticalLabelView",new z6(this));this.setCursor("ew-resize"),this.addChild(this._overlayXAxisView)}getName(){return fd.X_AXIS}updateMain(t){this._xAxisView.draw(t)}updateOverlay(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)}}class ay extends fx{constructor(e,t){super(e),this.override(t)}override(e){const{name:t,scrollZoomEnabled:o,createTicks:i}=e;au(this.name)||(this.name=t),this.scrollZoomEnabled=o??this.scrollZoomEnabled,this.createTicks=i??this.createTicks}createRangeImp(){const t=this.getParent().getChart().getChartStore().getVisibleRange(),{realFrom:o,realTo:i}=t,r=o,a=i,l=i-o+1;return{from:r,to:a,range:l,realFrom:r,realTo:a,realRange:l,displayFrom:r,displayTo:a,displayRange:l}}createTicksImp(){const{realFrom:e,realTo:t,from:o}=this.getRange(),i=this.getParent().getChart().getChartStore(),r=i.getInnerFormatter().formatDate,a=i.getPeriod(),l=[],c=i.getBarSpace().bar,d=i.getStyles().xAxis.tickText,p=60,m=120,h=90,_=[1,2,3,5,10,15,20,30,45,60,90,120],w=Math.max(1,Math.round(h/Math.max(1,c)));let S=_.reduce((j,D)=>{const R=j*c,W=D*c,J=R>=p&&R<=m,Z=W>=p&&W<=m;if(J&&Z)return Math.abs(W-h)<Math.abs(R-h)?D:j;if(Z&&!J)return D;if(!J&&!Z){const G=Math.abs(R-h);return Math.abs(W-h)<G?D:j}return j},w);S=Math.max(1,S);const P=Math.max(0,Math.floor(e/S)*S),I=_6[(a==null?void 0:a.type)??"day"],C=Av(I,d.size,d.weight,d.family),M=Math.max(C,p);let F=NaN;const V=this.getBounding().width;for(let j=P;;j+=S){const D=this.convertToPixel(j);if(D>V)break;if(j>=o){if(!isNaN(F)&&Math.abs(D-F)<M)continue;const R=i.dataIndexToTimestamp(j);if(fl(R)){const W=r(R,I,"xAxis");F=D,l.push({coord:D,value:R,text:W})}}}return pf(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:l}):l}getAutoSize(){const e=this.getParent().getChart().getStyles(),t=e.xAxis,o=t.size;if(o!=="auto")return o;const i=e.crosshair;let r=0;t.show&&(t.axisLine.show&&(r+=t.axisLine.size),t.tickLine.show&&(r+=t.tickLine.length),t.tickText.show&&(r+=t.tickText.marginStart+t.tickText.marginEnd+t.tickText.size));let a=0;return i.show&&i.vertical.show&&i.vertical.text.show&&(a+=i.vertical.text.paddingTop+i.vertical.text.paddingBottom+i.vertical.text.borderSize*2+i.vertical.text.size),Math.max(r,a)}getBounding(){return this.getParent().getMainWidget().getBounding()}convertTimestampFromPixel(e){const t=this.getParent().getChart().getChartStore(),o=t.coordinateToDataIndex(e);return t.dataIndexToTimestamp(o)}convertTimestampToPixel(e){const t=this.getParent().getChart().getChartStore(),o=t.timestampToDataIndex(e);return t.dataIndexToCoordinate(o)}convertFromPixel(e){return this.getParent().getChart().getChartStore().coordinateToDataIndex(e)}convertToPixel(e){return this.getParent().getChart().getChartStore().dataIndexToCoordinate(e)}static extend(e){class t extends ay{constructor(i){super(i,e)}}return t}}const W6={name:"normal"},Zy={normal:ay.extend(W6)};function q6(n){return Zy[n]??Zy.normal}class H6 extends gx{createAxisComponent(e){const t=q6(e);return new t(this)}createMainWidget(e){return new V6(e,this)}}function U6(n,e){let t=0;return function(){const o=Date.now();o-t>e&&(n.apply(this,arguments),t=o)}}class G6 extends X2{constructor(t,o){super(t,o);Ce(this,"_dragFlag",!1);Ce(this,"_dragStartY",0);Ce(this,"_topPaneHeight",0);Ce(this,"_bottomPaneHeight",0);Ce(this,"_topPane",null);Ce(this,"_bottomPane",null);Ce(this,"_pressedMouseMoveEvent",U6(this._pressedTouchMouseMoveEvent,20));this.registerEvent("touchStartEvent",this._mouseDownEvent.bind(this)).registerEvent("touchMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("touchEndEvent",this._mouseUpEvent.bind(this)).registerEvent("mouseDownEvent",this._mouseDownEvent.bind(this)).registerEvent("mouseUpEvent",this._mouseUpEvent.bind(this)).registerEvent("pressedMouseMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("mouseEnterEvent",this._mouseEnterEvent.bind(this)).registerEvent("mouseLeaveEvent",this._mouseLeaveEvent.bind(this))}getName(){return fd.SEPARATOR}_mouseDownEvent(t){this._dragFlag=!0,this._dragStartY=t.pageY;const o=this.getPane(),i=o.getChart();this._topPane=o.getTopPane(),this._bottomPane=o.getBottomPane();const r=i.getDrawPanes();if(this._topPane.getOptions().state==="minimize"){const a=r.findIndex(l=>{var c;return l.getId()===((c=this._topPane)==null?void 0:c.getId())});for(let l=a-1;l>-1;l--){const c=r[l];if(c.getOptions().state!=="minimize"){this._topPane=c;break}}}if(this._bottomPane.getOptions().state==="minimize"){const a=r.findIndex(l=>{var c;return l.getId()===((c=this._bottomPane)==null?void 0:c.getId())});for(let l=a+1;l<r.length;l++){const c=r[l];if(c.getOptions().state!=="minimize"){this._bottomPane=c;break}}}return this._topPaneHeight=this._topPane.getBounding().height,this._bottomPaneHeight=this._bottomPane.getBounding().height,!0}_mouseUpEvent(){return this._dragFlag=!1,this._topPane=null,this._bottomPane=null,this._topPaneHeight=0,this._bottomPaneHeight=0,this._mouseLeaveEvent()}_pressedTouchMouseMoveEvent(t){const o=t.pageY-this._dragStartY,i=o<0;if(_o(this._topPane)&&_o(this._bottomPane)){const r=this._bottomPane.getOptions();if(this._topPane.getOptions().state!=="minimize"&&r.state!=="minimize"&&r.dragEnabled){let a=null,l=null,c=0,d=0;i?(a=this._topPane,l=this._bottomPane,c=this._topPaneHeight,d=this._bottomPaneHeight):(a=this._bottomPane,l=this._topPane,c=this._bottomPaneHeight,d=this._topPaneHeight);const p=a.getOptions().minHeight;if(c>p){const m=Math.max(c-Math.abs(o),p),h=c-m;a.setBounding({height:m}),l.setBounding({height:d+h});const _=this.getPane(),w=_.getChart();w.getChartStore().executeAction("onPaneDrag",{paneId:_.getId()}),w.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}}}return!0}_mouseEnterEvent(){const t=this.getPane();if(t.getBottomPane().getOptions().dragEnabled){const r=t.getChart().getStyles().separator;return this.getContainer().style.background=r.activeBackgroundColor,!0}return!1}_mouseLeaveEvent(){return this._dragFlag?!1:(this.getContainer().style.background="transparent",!0)}createContainer(){return rg("div",{width:"100%",height:`${Hh}px`,margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"})}updateImp(t,o,i){if(i===fu.All||i===fu.Separator){const r=this.getPane().getChart().getStyles().separator;t.style.top=`${-Math.floor((Hh-r.size)/2)}px`,t.style.height=`${Hh}px`}}}class Y6 extends mx{constructor(t,o,i,r){super(t,o);Ce(this,"_topPane");Ce(this,"_bottomPane");Ce(this,"_separatorWidget");this.getContainer().style.overflow="",this._topPane=i,this._bottomPane=r,this._separatorWidget=new G6(this.getContainer(),this)}setBounding(t){return Op(this.getBounding(),t),this}getTopPane(){return this._topPane}setTopPane(t){return this._topPane=t,this}getBottomPane(){return this._bottomPane}setBottomPane(t){return this._bottomPane=t,this}getWidget(){return this._separatorWidget}getImage(t){const{width:o,height:i}=this.getBounding(),r=this.getChart().getStyles().separator,a=rg("canvas",{width:`${o}px`,height:`${i}px`,boxSizing:"border-box"}),l=a.getContext("2d"),c=yg(a);return a.width=o*c,a.height=i*c,l.scale(c,c),l.fillStyle=r.color,l.fillRect(0,0,o,i),a}updateImp(t,o,i){if(t===fu.All||t===fu.Separator){const r=this.getChart().getStyles().separator;o.style.backgroundColor=r.color,o.style.height=`${i.height}px`,o.style.marginLeft=`${i.left}px`,o.style.width=`${i.width}px`,this._separatorWidget.update(t)}}}function Xy(){return typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes("firefox")}function X_(){return typeof window>"u"?!1:/iPhone|iPad|iPod|iOS/.test(window.navigator.userAgent)}const A0={ResetClick:500,LongTap:500,PreventFiresTouchEvents:500},qg={CancelClick:5,CancelTap:5,DoubleClick:5,DoubleTap:30},Ph={Left:0,Middle:1,Right:2},K6=10;class Z6{constructor(e,t,o){Ce(this,"_target");Ce(this,"_handler");Ce(this,"_options");Ce(this,"_clickCount",0);Ce(this,"_clickTimeoutId",null);Ce(this,"_clickCoordinate",{x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY});Ce(this,"_tapCount",0);Ce(this,"_tapTimeoutId",null);Ce(this,"_tapCoordinate",{x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY});Ce(this,"_longTapTimeoutId",null);Ce(this,"_longTapActive",!1);Ce(this,"_mouseMoveStartCoordinate",null);Ce(this,"_touchMoveStartCoordinate",null);Ce(this,"_touchMoveExceededManhattanDistance",!1);Ce(this,"_cancelClick",!1);Ce(this,"_cancelTap",!1);Ce(this,"_unsubscribeOutsideMouseEvents",null);Ce(this,"_unsubscribeOutsideTouchEvents",null);Ce(this,"_unsubscribeMobileSafariEvents",null);Ce(this,"_unsubscribeMousemove",null);Ce(this,"_unsubscribeMouseWheel",null);Ce(this,"_unsubscribeContextMenu",null);Ce(this,"_unsubscribeRootMouseEvents",null);Ce(this,"_unsubscribeRootTouchEvents",null);Ce(this,"_startPinchMiddleCoordinate",null);Ce(this,"_startPinchDistance",0);Ce(this,"_pinchPrevented",!1);Ce(this,"_preventTouchDragProcess",!1);Ce(this,"_mousePressed",!1);Ce(this,"_lastTouchEventTimeStamp",0);Ce(this,"_activeTouchId",null);Ce(this,"_acceptMouseLeave",!X_());Ce(this,"_onFirefoxOutsideMouseUp",e=>{this._mouseUpHandler(e)});Ce(this,"_onMobileSafariDoubleClick",e=>{if(this._firesTouchEvents(e)){if(++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._tapCoordinate);t<qg.DoubleTap&&!this._cancelTap&&this._processEvent(this._makeCompatEvent(e),this._handler.doubleTapEvent),this._resetTapTimeout()}}else if(++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate);t<qg.DoubleClick&&!this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}});this._target=e,this._handler=t,this._options=o,this._init()}destroy(){this._unsubscribeOutsideMouseEvents!==null&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),this._unsubscribeOutsideTouchEvents!==null&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),this._unsubscribeMousemove!==null&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),this._unsubscribeMouseWheel!==null&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),this._unsubscribeContextMenu!==null&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),this._unsubscribeMobileSafariEvents!==null&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(e){var r,a,l;(r=this._unsubscribeMousemove)==null||r.call(this),(a=this._unsubscribeMouseWheel)==null||a.call(this),(l=this._unsubscribeContextMenu)==null||l.call(this);const t=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",t)},this._target.addEventListener("mousemove",t);const o=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",o)},this._target.addEventListener("wheel",o,{passive:!1});const i=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",i)},this._target.addEventListener("contextmenu",i,{passive:!1}),!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)}_resetClickTimeout(){this._clickTimeoutId!==null&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){this._tapTimeoutId!==null&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(e){this._mousePressed||this._touchMoveStartCoordinate!==null||this._firesTouchEvents(e)||(this._processEvent(this._makeCompatEvent(e),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)}_mouseWheelHandler(e){if(Math.abs(e.deltaX)>Math.abs(e.deltaY)){if(!_o(this._handler.mouseWheelHortEvent)||(this._preventDefault(e),Math.abs(e.deltaX)===0))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(e),-e.deltaX)}else{if(!_o(this._handler.mouseWheelVertEvent))return;let t=-(e.deltaY/100);if(t===0)return;switch(this._preventDefault(e),e.deltaMode){case e.DOM_DELTA_PAGE:{t*=120;break}case e.DOM_DELTA_LINE:{t*=32;break}}if(t!==0){const o=Math.sign(t)*Math.min(1,Math.abs(t));this._handler.mouseWheelVertEvent(this._makeCompatEvent(e),o)}}}_contextMenuHandler(e){this._preventDefault(e)}_touchMoveHandler(e){const t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null||(this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._startPinchMiddleCoordinate!==null)||this._preventTouchDragProcess)return;this._pinchPrevented=!0;const o=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._touchMoveStartCoordinate),{xOffset:i,yOffset:r,manhattanDistance:a}=o;if(!(!this._touchMoveExceededManhattanDistance&&a<qg.CancelTap)){if(!this._touchMoveExceededManhattanDistance){const l=i*.5,c=r>=l&&!this._options.treatVertDragAsPageScroll(),d=l>r&&!this._options.treatHorzDragAsPageScroll();!c&&!d&&(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(e,t),this._handler.touchMoveEvent)}}_mouseMoveWithDownHandler(e){if(e.button!==Ph.Left)return;const t=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._mouseMoveStartCoordinate),{manhattanDistance:o}=t;o>=qg.CancelClick&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.pressedMouseMoveEvent)}_mouseTouchMoveWithDownInfo(e,t){const o=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y),r=o+i;return{xOffset:o,yOffset:i,manhattanDistance:r}}_touchEndHandler(e){let t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null&&e.touches.length===0&&(t=e.changedTouches[0]),t===null)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const o=this._makeCompatEvent(e,t);if(this._processEvent(o,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:i}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._tapCoordinate);i<qg.DoubleTap&&!this._cancelTap&&this._processEvent(o,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(o,this._handler.tapEvent),_o(this._handler.tapEvent)&&this._preventDefault(e));this._tapCount===0&&this._preventDefault(e),e.touches.length===0&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(e))}_mouseUpHandler(e){if(e.button!==Ph.Left)return;const t=this._makeCompatEvent(e);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),Xy()&&this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp),!this._firesTouchEvents(e))if(this._processEvent(t,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:o}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate);o<qg.DoubleClick&&!this._cancelClick&&this._processEvent(t,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(t,this._handler.mouseClickEvent)}_clearLongTapTimeout(){this._longTapTimeoutId!==null&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(e){if(this._activeTouchId!==null)return;const t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(e);const o=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(t),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const i=this._touchMoveHandler.bind(this),r=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{o.removeEventListener("touchmove",i),o.removeEventListener("touchend",r)},o.addEventListener("touchmove",i,{passive:!1}),o.addEventListener("touchend",r,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),A0.LongTap)}this._processEvent(this._makeCompatEvent(e,t),this._handler.touchStartEvent),this._tapTimeoutId===null&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),A0.ResetClick),this._tapCoordinate=this._getCoordinate(t))}_mouseDownHandler(e){if(e.button===Ph.Right){this._preventDefault(e),this._processEvent(this._makeCompatEvent(e),this._handler.mouseRightClickEvent);return}if(e.button!==Ph.Left)return;const t=this._target.ownerDocument.documentElement;Xy()&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(e),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const o=this._mouseMoveWithDownHandler.bind(this),i=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{t.removeEventListener("mousemove",o),t.removeEventListener("mouseup",i)},t.addEventListener("mousemove",o),t.addEventListener("mouseup",i)}this._mousePressed=!0,!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseDownEvent),this._clickTimeoutId===null&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),A0.ResetClick),this._clickCoordinate=this._getCoordinate(e)))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const e=this._target.ownerDocument,t=o=>{this._handler.mouseDownOutsideEvent!=null&&(o.composed&&this._target.contains(o.composedPath()[0])||o.target!==null&&this._target.contains(o.target)||this._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=()=>{e.removeEventListener("touchstart",t)},this._unsubscribeOutsideMouseEvents=()=>{e.removeEventListener("mousedown",t)},e.addEventListener("mousedown",t),e.addEventListener("touchstart",t,{passive:!0})}X_()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),this._target.addEventListener("mousedown",e=>{if(e.button===Ph.Middle)return e.preventDefault(),!1}),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",()=>{},{passive:!1})}_initPinch(){!_o(this._handler.pinchStartEvent)&&!_o(this._handler.pinchEvent)&&!_o(this._handler.pinchEndEvent)||(this._target.addEventListener("touchstart",e=>{this._checkPinchState(e.touches)},{passive:!0}),this._target.addEventListener("touchmove",e=>{if(!(e.touches.length!==2||this._startPinchMiddleCoordinate===null)&&_o(this._handler.pinchEvent)){const o=this._getTouchDistance(e.touches[0],e.touches[1])/this._startPinchDistance;this._handler.pinchEvent({...this._startPinchMiddleCoordinate,pageX:0,pageY:0},o),this._preventDefault(e)}},{passive:!1}),this._target.addEventListener("touchend",e=>{this._checkPinchState(e.touches)}))}_checkPinchState(e){e.length===1&&(this._pinchPrevented=!1),e.length!==2||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)}_startPinch(e){const t=this._target.getBoundingClientRect();this._startPinchMiddleCoordinate={x:(e[0].clientX-t.left+(e[1].clientX-t.left))/2,y:(e[0].clientY-t.top+(e[1].clientY-t.top))/2},this._startPinchDistance=this._getTouchDistance(e[0],e[1]),_o(this._handler.pinchStartEvent)&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()}_stopPinch(){this._startPinchMiddleCoordinate!==null&&(this._startPinchMiddleCoordinate=null,_o(this._handler.pinchEndEvent)&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))}_mouseLeaveHandler(e){var t,o,i;(t=this._unsubscribeMousemove)==null||t.call(this),(o=this._unsubscribeMouseWheel)==null||o.call(this),(i=this._unsubscribeContextMenu)==null||i.call(this),!this._firesTouchEvents(e)&&this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!X_())}_longTapHandler(e){const t=this._touchWithId(e.touches,this._activeTouchId);t!==null&&(this._processEvent(this._makeCompatEvent(e,t),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)}_firesTouchEvents(e){var t;return _o((t=e.sourceCapabilities)==null?void 0:t.firesTouchEvents)?e.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(e)<this._lastTouchEventTimeStamp+A0.PreventFiresTouchEvents}_processEvent(e,t){t==null||t.call(this._handler,e)}_makeCompatEvent(e,t){const o=t??e,i=this._target.getBoundingClientRect();return{x:o.clientX-i.left,y:o.clientY-i.top,pageX:o.pageX,pageY:o.pageY,isTouch:!e.type.startsWith("mouse")&&e.type!=="contextmenu"&&e.type!=="click"&&e.type!=="wheel",preventDefault:()=>{e.type!=="touchstart"&&this._preventDefault(e)}}}_getTouchDistance(e,t){const o=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(o*o+i*i)}_preventDefault(e){e.cancelable&&e.preventDefault()}_getCoordinate(e){return{x:e.pageX,y:e.pageY}}_eventTimeStamp(e){return e.timeStamp??performance.now()}_touchWithId(e,t){for(let o=0;o<e.length;++o)if(e[o].identifier===t)return e[o];return null}}class X6{constructor(e,t){Ce(this,"_container");Ce(this,"_chart");Ce(this,"_event");Ce(this,"_flingStartTime",new Date().getTime());Ce(this,"_flingScrollRequestId",null);Ce(this,"_startScrollCoordinate",null);Ce(this,"_touchCoordinate",null);Ce(this,"_touchCancelCrosshair",!1);Ce(this,"_touchZoomed",!1);Ce(this,"_pinchScale",1);Ce(this,"_mouseDownWidget",null);Ce(this,"_prevYAxisRange",null);Ce(this,"_xAxisStartScaleCoordinate",null);Ce(this,"_xAxisStartScaleDistance",0);Ce(this,"_xAxisScale",1);Ce(this,"_yAxisStartScaleDistance",0);Ce(this,"_mouseMoveTriggerWidgetInfo",{pane:null,widget:null});Ce(this,"_wheelScrollAccum",0);Ce(this,"_wheelScrollRafId",null);Ce(this,"_wheelZoomAccum",0);Ce(this,"_wheelZoomRafId",null);Ce(this,"_wheelZoomLastCoord",null);Ce(this,"_overlayUpdateRafId",null);Ce(this,"_yAxisScaleRafId",null);Ce(this,"_boundKeyBoardDownEvent",e=>{if(e.shiftKey)switch(e.code){case"Equal":{this._chart.getChartStore().zoom(.5);break}case"Minus":{this._chart.getChartStore().zoom(-.5);break}case"ArrowLeft":{const t=this._chart.getChartStore();t.startScroll(),t.scroll(-3*t.getBarSpace().bar);break}case"ArrowRight":{const t=this._chart.getChartStore();t.startScroll(),t.scroll(3*t.getBarSpace().bar);break}}});this._container=e,this._chart=t,this._event=new Z6(e,this,{treatVertDragAsPageScroll:()=>!1,treatHorzDragAsPageScroll:()=>!1}),e.addEventListener("keydown",this._boundKeyBoardDownEvent)}pinchStartEvent(){return this._touchZoomed=!0,this._pinchScale=1,!0}pinchEvent(e,t){const{pane:o,widget:i}=this._findWidgetByEvent(e);if((o==null?void 0:o.getId())!==nd.X_AXIS&&(i==null?void 0:i.getName())===fd.MAIN){const r=this._makeWidgetEvent(e,i),a=(t-this._pinchScale)*5;return this._pinchScale=t,this._chart.getChartStore().zoom(a,{x:r.x,y:r.y}),!0}return!1}mouseWheelHortEvent(e,t){if(this._wheelScrollAccum+=t,this._wheelScrollRafId===null){const o=this._chart.getChartStore();this._wheelScrollRafId=og(()=>{const i=this._wheelScrollAccum;this._wheelScrollAccum=0,this._wheelScrollRafId=null,o.startScroll(),o.scroll(i)})}return!0}mouseWheelVertEvent(e,t){const{widget:o}=this._findWidgetByEvent(e),i=this._makeWidgetEvent(e,o);return(o==null?void 0:o.getName())===fd.MAIN?(this._wheelZoomAccum+=t,this._wheelZoomLastCoord={x:i.x,y:i.y},this._wheelZoomRafId===null&&(this._wheelZoomRafId=og(()=>{const a=this._wheelZoomAccum,l=this._wheelZoomLastCoord??{x:i.x,y:i.y};this._wheelZoomAccum=0,this._wheelZoomLastCoord=null,this._wheelZoomRafId=null,this._chart.getChartStore().zoom(a,l)})),!0):!1}mouseDownEvent(e){const{pane:t,widget:o}=this._findWidgetByEvent(e);if(this._mouseDownWidget=o,o!==null){const i=this._makeWidgetEvent(e,o);switch(o.getName()){case fd.SEPARATOR:return o.dispatchEvent("mouseDownEvent",i);case fd.MAIN:{const a=t.getAxisComponent();if(!a.getAutoCalcTickFlag()){const l=a.getRange();this._prevYAxisRange={...l}}return this._startScrollCoordinate={x:i.x,y:i.y},this._chart.getChartStore().startScroll(),o.dispatchEvent("mouseDownEvent",i)}case fd.X_AXIS:return this._processXAxisScrollStartEvent(o,i);case fd.Y_AXIS:return this._processYAxisScaleStartEvent(o,i)}}return!1}mouseMoveEvent(e){var r,a,l;const{pane:t,widget:o}=this._findWidgetByEvent(e),i=this._makeWidgetEvent(e,o);if((((r=this._mouseMoveTriggerWidgetInfo.pane)==null?void 0:r.getId())!==(t==null?void 0:t.getId())||((a=this._mouseMoveTriggerWidgetInfo.widget)==null?void 0:a.getName())!==(o==null?void 0:o.getName()))&&(o==null||o.dispatchEvent("mouseEnterEvent",i),(l=this._mouseMoveTriggerWidgetInfo.widget)==null||l.dispatchEvent("mouseLeaveEvent",i),this._mouseMoveTriggerWidgetInfo={pane:t,widget:o}),o!==null){const c=o.getName();switch(c){case fd.MAIN:{const d=o.dispatchEvent("mouseMoveEvent",i);let p={x:i.x,y:i.y,paneId:t==null?void 0:t.getId()};return d?(o.getForceCursor()!=="pointer"&&(p=void 0),o.setCursor("pointer")):o.setCursor("crosshair"),this._chart.getChartStore().setCrosshair(p),d}case fd.SEPARATOR:case fd.X_AXIS:case fd.Y_AXIS:{const d=o.dispatchEvent("mouseMoveEvent",i);return c===fd.X_AXIS?this._chart.getChartStore().setCrosshair({x:i.x,paneId:t==null?void 0:t.getId()}):this._chart.getChartStore().setCrosshair(),d}}}return!1}pressedMouseMoveEvent(e){var i,r;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===fd.SEPARATOR)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",e);const{pane:t,widget:o}=this._findWidgetByEvent(e);if(o!==null&&((i=this._mouseDownWidget)==null?void 0:i.getPane().getId())===(t==null?void 0:t.getId())&&((r=this._mouseDownWidget)==null?void 0:r.getName())===o.getName()){const a=this._makeWidgetEvent(e,o);switch(o.getName()){case fd.MAIN:{let c;const d=o.dispatchEvent("pressedMouseMoveEvent",a);return d||this._processMainScrollingEvent(o,a),(!d||o.getForceCursor()==="pointer")&&(c={x:a.x,y:a.y,paneId:t==null?void 0:t.getId()}),this._chart.getChartStore().setCrosshair(c,{forceInvalidate:!0}),d}case fd.X_AXIS:return this._processXAxisScrollingEvent(o,a);case fd.Y_AXIS:return this._processYAxisScalingEvent(o,a)}}return!1}mouseUpEvent(e){const{widget:t}=this._findWidgetByEvent(e);let o=!1;if(t!==null){const i=this._makeWidgetEvent(e,t);switch(t.getName()){case fd.MAIN:case fd.SEPARATOR:case fd.X_AXIS:case fd.Y_AXIS:{o=t.dispatchEvent("mouseUpEvent",i);break}}o&&this._scheduleOverlayUpdate()}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._yAxisScaleRafId=null,o}mouseClickEvent(e){const{widget:t}=this._findWidgetByEvent(e);if(t!==null){const o=this._makeWidgetEvent(e,t);return t.dispatchEvent("mouseClickEvent",o)}return!1}mouseRightClickEvent(e){const{widget:t}=this._findWidgetByEvent(e);let o=!1;if(t!==null){const i=this._makeWidgetEvent(e,t);switch(t.getName()){case fd.MAIN:case fd.X_AXIS:case fd.Y_AXIS:{o=t.dispatchEvent("mouseRightClickEvent",i);break}}o&&this._scheduleOverlayUpdate()}return!1}mouseDoubleClickEvent(e){const{pane:t,widget:o}=this._findWidgetByEvent(e);if(o!==null)switch(o.getName()){case fd.MAIN:{const r=this._makeWidgetEvent(e,o);return o.dispatchEvent("mouseDoubleClickEvent",r)}case fd.Y_AXIS:{const r=t.getAxisComponent();if(!r.getAutoCalcTickFlag())return r.setAutoCalcTickFlag(!0),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}),!0;break}}return!1}mouseLeaveEvent(){return this._chart.getChartStore().setCrosshair(),!0}touchStartEvent(e){var i;const{pane:t,widget:o}=this._findWidgetByEvent(e);if(o!==null){const r=this._makeWidgetEvent(e,o);switch((i=r.preventDefault)==null||i.call(r),o.getName()){case fd.MAIN:{const l=this._chart.getChartStore();if(o.dispatchEvent("mouseDownEvent",r))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,l.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(fu.Overlay),!0;this._flingScrollRequestId!==null&&(Dy(this._flingScrollRequestId),this._flingScrollRequestId=null),this._flingStartTime=new Date().getTime();const c=t.getAxisComponent();if(!c.getAutoCalcTickFlag()){const d=c.getRange();this._prevYAxisRange={...d}}if(this._startScrollCoordinate={x:r.x,y:r.y},l.startScroll(),this._touchZoomed=!1,this._touchCoordinate!==null){const d=r.x-this._touchCoordinate.x,p=r.y-this._touchCoordinate.y;Math.sqrt(d*d+p*p)<K6?(this._touchCoordinate={x:r.x,y:r.y},l.setCrosshair({x:r.x,y:r.y,paneId:t==null?void 0:t.getId()})):(this._touchCoordinate=null,this._touchCancelCrosshair=!0,l.setCrosshair())}return!0}case fd.X_AXIS:return this._processXAxisScrollStartEvent(o,r);case fd.Y_AXIS:return this._processYAxisScaleStartEvent(o,r)}}return!1}touchMoveEvent(e){var i;const{pane:t,widget:o}=this._findWidgetByEvent(e);if(o!==null){const r=this._makeWidgetEvent(e,o);(i=r.preventDefault)==null||i.call(r);const a=o.getName(),l=this._chart.getChartStore();switch(a){case fd.MAIN:return o.dispatchEvent("pressedMouseMoveEvent",r)?(l.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(fu.Overlay),!0):(this._touchCoordinate!==null?l.setCrosshair({x:r.x,y:r.y,paneId:t==null?void 0:t.getId()}):this._processMainScrollingEvent(o,r),!0);case fd.X_AXIS:return this._processXAxisScrollingEvent(o,r);case fd.Y_AXIS:return this._processYAxisScalingEvent(o,r)}}return!1}touchEndEvent(e){const{widget:t}=this._findWidgetByEvent(e);if(t!==null){const o=this._makeWidgetEvent(e,t);switch(t.getName()){case fd.MAIN:{if(t.dispatchEvent("mouseUpEvent",o),this._startScrollCoordinate!==null){const r=new Date().getTime()-this._flingStartTime;let l=(o.x-this._startScrollCoordinate.x)/(r>0?r:1)*20;if(r<200&&Math.abs(l)>0){const c=this._chart.getChartStore(),d=()=>{this._flingScrollRequestId=og(()=>{c.startScroll(),c.scroll(l),l=l*(1-.025),Math.abs(l)<1?this._flingScrollRequestId!==null&&(Dy(this._flingScrollRequestId),this._flingScrollRequestId=null):d()})};d()}}return!0}case fd.X_AXIS:case fd.Y_AXIS:t.dispatchEvent("mouseUpEvent",o)&&this._chart.updatePane(fu.Overlay)}this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._yAxisScaleRafId=null}return!1}tapEvent(e){const{pane:t,widget:o}=this._findWidgetByEvent(e);let i=!1;if(o!==null){const r=this._makeWidgetEvent(e,o),a=o.dispatchEvent("mouseClickEvent",r);if(o.getName()===fd.MAIN){const l=this._makeWidgetEvent(e,o),c=this._chart.getChartStore();a?(this._touchCancelCrosshair=!0,this._touchCoordinate=null,c.setCrosshair(void 0,{notInvalidate:!0}),i=!0):(!this._touchCancelCrosshair&&!this._touchZoomed&&(this._touchCoordinate={x:l.x,y:l.y},c.setCrosshair({x:l.x,y:l.y,paneId:t==null?void 0:t.getId()},{notInvalidate:!0}),i=!0),this._touchCancelCrosshair=!1)}(i||a)&&this._scheduleOverlayUpdate()}return i}doubleTapEvent(e){return this.mouseDoubleClickEvent(e)}longTapEvent(e){const{pane:t,widget:o}=this._findWidgetByEvent(e);if(o!==null&&o.getName()===fd.MAIN){const i=this._makeWidgetEvent(e,o);return this._touchCoordinate={x:i.x,y:i.y},this._chart.getChartStore().setCrosshair({x:i.x,y:i.y,paneId:t==null?void 0:t.getId()}),!0}return!1}_processMainScrollingEvent(e,t){if(this._startScrollCoordinate!==null){const o=e.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&!o.getAutoCalcTickFlag()&&o.scrollZoomEnabled){const{from:r,to:a,range:l}=this._prevYAxisRange;let c=0;o.reverse?c=this._startScrollCoordinate.y-t.y:c=t.y-this._startScrollCoordinate.y;const d=e.getBounding(),p=c/d.height,m=l*p,h=r+m,_=a+m,w=o.valueToRealValue(h,{range:this._prevYAxisRange}),S=o.valueToRealValue(_,{range:this._prevYAxisRange}),P=o.realValueToDisplayValue(w,{range:this._prevYAxisRange}),I=o.realValueToDisplayValue(S,{range:this._prevYAxisRange});o.setRange({from:h,to:_,range:_-h,realFrom:w,realTo:S,realRange:S-w,displayFrom:P,displayTo:I,displayRange:I-P})}const i=t.x-this._startScrollCoordinate.x;this._chart.getChartStore().scroll(i)}}_processXAxisScrollStartEvent(e,t){const o=e.dispatchEvent("mouseDownEvent",t);return o&&this._scheduleOverlayUpdate(),this._xAxisStartScaleCoordinate={x:t.x,y:t.y},this._xAxisStartScaleDistance=t.pageX,o}_processXAxisScrollingEvent(e,t){const o=e.dispatchEvent("pressedMouseMoveEvent",t);if(o)this._scheduleOverlayUpdate();else if(e.getPane().getAxisComponent().scrollZoomEnabled&&this._xAxisStartScaleDistance!==0){const r=this._xAxisStartScaleDistance/t.pageX;if(Number.isFinite(r)){const a=(r-this._xAxisScale)*10;this._xAxisScale=r,this._chart.getChartStore().zoom(a,this._xAxisStartScaleCoordinate??void 0)}}return o}_processYAxisScaleStartEvent(e,t){const o=e.dispatchEvent("mouseDownEvent",t);o&&this._scheduleOverlayUpdate();const i=e.getPane().getAxisComponent().getRange();return this._prevYAxisRange={...i},this._yAxisStartScaleDistance=t.pageY,o}_processYAxisScalingEvent(e,t){const o=e.dispatchEvent("pressedMouseMoveEvent",t);if(o)this._chart.updatePane(fu.Overlay);else{const i=e.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&i.scrollZoomEnabled&&this._yAxisStartScaleDistance!==0){const{from:r,to:a,range:l}=this._prevYAxisRange,c=t.pageY/this._yAxisStartScaleDistance,d=Number.isFinite(c)?Math.min(5,Math.max(.2,c)):1,p=l*d,m=(p-l)/2,h=r-m,_=a+m,w=i.valueToRealValue(h,{range:this._prevYAxisRange}),S=i.valueToRealValue(_,{range:this._prevYAxisRange}),P=i.realValueToDisplayValue(w,{range:this._prevYAxisRange}),I=i.realValueToDisplayValue(S,{range:this._prevYAxisRange});i.setRange({from:h,to:_,range:p,realFrom:w,realTo:S,realRange:S-w,displayFrom:P,displayTo:I,displayRange:I-P}),this._yAxisScaleRafId===null&&(this._yAxisScaleRafId=og(()=>{this._yAxisScaleRafId=null,this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0})}))}}return o}_findWidgetByEvent(e){const{x:t,y:o}=e,i=this._chart.getSeparatorPanes(),r=this._chart.getStyles().separator.size;for(const d of i){const p=d[1],m=p.getBounding(),h=m.top-Math.round((Hh-r)/2);if(t>=m.left&&t<=m.left+m.width&&o>=h&&o<=h+Hh)return{pane:p,widget:p.getWidget()}}const a=this._chart.getDrawPanes();let l=null;for(const d of a){const p=d.getBounding();if(t>=p.left&&t<=p.left+p.width&&o>=p.top&&o<=p.top+p.height){l=d;break}}let c=null;if(l!==null){if(!_o(c)){const d=l.getMainWidget(),p=d.getBounding();t>=p.left&&t<=p.left+p.width&&o>=p.top&&o<=p.top+p.height&&(c=d)}if(!_o(c)){const d=l.getYAxisWidget();if(d!==null){const p=d.getBounding();t>=p.left&&t<=p.left+p.width&&o>=p.top&&o<=p.top+p.height&&(c=d)}}}return{pane:l,widget:c}}_makeWidgetEvent(e,t){const o=(t==null?void 0:t.getBounding())??null;return{...e,x:e.x-((o==null?void 0:o.left)??0),y:e.y-((o==null?void 0:o.top)??0)}}destroy(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._event.destroy()}}class J6{constructor(e,t){Ce(this,"id");Ce(this,"_container");Ce(this,"_chartContainer");Ce(this,"_chartBounding",l_());Ce(this,"_chartEvent");Ce(this,"_chartStore");Ce(this,"_drawPanes",[]);Ce(this,"_candlePane");Ce(this,"_xAxisPane");Ce(this,"_separatorPanes",new Map);Ce(this,"_layoutOptions",{sort:!0,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1});Ce(this,"_layoutPending",!1);Ce(this,"_cacheYAxisWidth",{left:0,right:0});this.id=Nh("chart"),this._initContainer(e),this._chartEvent=new X6(this._chartContainer,this),this._chartStore=new H3(this,t),this._initPanes(t),this._layout()}_initContainer(e){this._container=e,this._chartContainer=rg("div",{position:"relative",width:"100%",height:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",overflow:"hidden",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,e.appendChild(this._chartContainer),this._cacheChartBounding()}_cacheChartBounding(){this._chartBounding.width=Math.floor(this._chartContainer.clientWidth),this._chartBounding.height=Math.floor(this._chartContainer.clientHeight)}_initPanes(e){const t=(e==null?void 0:e.layout)??[{type:"candle"}],o=r=>{if(!_o(this._candlePane)){const a=r.options??{};Op(a,{id:nd.CANDLE}),this._candlePane=this._createPane(R6,nd.CANDLE,a),(r.content??[]).forEach(c=>{this.createIndicator(c,!0,a)})}},i=r=>{if(!_o(this._xAxisPane)){const a=this._createPane(H6,nd.X_AXIS,r??{});this._xAxisPane=a}};t.forEach(r=>{var a;switch(r.type){case"candle":{o(r);break}case"indicator":{const l=r.content??[];if(l.length>0){let c=((a=r.options)==null?void 0:a.id)??null;_o(c)&&(c=Nh(nd.INDICATOR));const d={...r.options,id:c};l.forEach(p=>{this.createIndicator(p,!0,d)})}break}case"xAxis":{i(r.options);break}}}),o({type:"candle"}),i({order:Number.MAX_SAFE_INTEGER})}_createPane(e,t,o){const i=new e(this,t,o??{});return this._drawPanes.push(i),i}_recalculatePaneHeight(e,t,o){if(o===0)return!1;const i=this._drawPanes.filter(a=>{const l=a.getId();return a.getOptions().state==="normal"&&l!==e.getId()&&l!==nd.X_AXIS}),r=i.length;if(r===0)return!1;if(e.getId()!==nd.CANDLE&&_o(this._candlePane)&&this._candlePane.getOptions().state==="normal"){const a=this._candlePane.getBounding().height;if(a>0){const l=this._candlePane.getOptions().minHeight;let c=a+o;c<l&&(c=l,t-=a+o-c),this._candlePane.setBounding({height:c})}}else{let a=o;const l=Math.floor(o/r);i.forEach((c,d)=>{const p=c.getBounding().height;let m=0;d===r-1?m=p+a:m=p+l,m<c.getOptions().minHeight&&(m=c.getOptions().minHeight),c.setBounding({height:m}),a-=m-p}),Math.abs(a)>0&&(t-=a)}return e.setBounding({height:t}),!0}getDrawPaneById(e){return e===nd.CANDLE?this._candlePane:e===nd.X_AXIS?this._xAxisPane:this._drawPanes.find(o=>o.getId()===e)??null}getContainer(){return this._container}getChartStore(){return this._chartStore}getXAxisPane(){return this._xAxisPane}getDrawPanes(){return this._drawPanes}getSeparatorPanes(){return this._separatorPanes}layout(e){(e.sort??!1)&&(this._layoutOptions.sort=e.sort),(e.measureHeight??!1)&&(this._layoutOptions.measureHeight=e.measureHeight),(e.measureWidth??!1)&&(this._layoutOptions.measureWidth=e.measureWidth),(e.update??!1)&&(this._layoutOptions.update=e.update),(e.buildYAxisTick??!1)&&(this._layoutOptions.buildYAxisTick=e.buildYAxisTick),(e.cacheYAxisWidth??!1)&&(this._layoutOptions.cacheYAxisWidth=e.cacheYAxisWidth),(e.buildYAxisTick??!1)&&(this._layoutOptions.forceBuildYAxisTick=e.forceBuildYAxisTick),this._layoutPending||(this._layoutPending=!0,Promise.resolve().then(t=>{this._layout(),this._layoutPending=!1}).catch(t=>{}))}_layout(){const{sort:e,measureHeight:t,measureWidth:o,update:i,buildYAxisTick:r,cacheYAxisWidth:a,forceBuildYAxisTick:l}=this._layoutOptions,c=typeof performance<"u"?performance.now():Date.now();if(e){for(;_o(this._chartContainer.firstChild);)this._chartContainer.removeChild(this._chartContainer.firstChild);this._separatorPanes.clear(),this._drawPanes.sort((_,w)=>_.getOptions().order-w.getOptions().order);let h=null;this._drawPanes.forEach(_=>{if(_.getId()!==nd.X_AXIS){if(_o(h)){const w=new Y6(this,"",h,_);this._chartContainer.appendChild(w.getContainer()),this._separatorPanes.set(_,w)}h=_}this._chartContainer.appendChild(_.getContainer())})}if(t){const h=this._chartBounding.height,_=this.getStyles().separator.size,w=this._xAxisPane.getAxisComponent().getAutoSize();let S=h-w;S<0&&(S=0),this._drawPanes.forEach(I=>{const C=I.getId();if(_o(this._separatorPanes.get(I))&&(S-=_),C!==nd.X_AXIS&&C!==nd.CANDLE&&I.getVisible()){let M=I.getBounding().height;M>S?(M=S,S=0):S-=M,I.setBounding({height:M})}}),this._candlePane.setBounding({height:Math.max(S,0)}),this._xAxisPane.setBounding({height:w});let P=0;this._drawPanes.forEach(I=>{const C=this._separatorPanes.get(I);_o(C)&&(C.setBounding({height:_,top:P}),P+=_),I.setBounding({top:P}),P+=I.getBounding().height})}let d=o;if((r||l)&&this._drawPanes.forEach(h=>{const _=h.getAxisComponent().buildTicks(l);d||(d=_)}),d){const h=this._chartBounding.width,_=this.getStyles();let w=0,S=!0,P=0,I=!0;this._drawPanes.forEach(Z=>{if(Z.getId()!==nd.X_AXIS){const G=Z.getAxisComponent(),se=G.inside,Y=G.getAutoSize();G.position==="left"?(w=Math.max(w,Y),se&&(S=!1)):(P=Math.max(P,Y),se&&(I=!1))}}),a&&(w=Math.max(this._cacheYAxisWidth.left,w),P=Math.max(this._cacheYAxisWidth.right,P)),this._cacheYAxisWidth.left=w,this._cacheYAxisWidth.right=P;let C=h,M=0,F=0;S&&(C-=w,M=w),I&&(C-=P,F=P),this._chartStore.setTotalBarSpace(C);const V={width:h},j={width:C,left:M,right:F},D={width:w},R={width:P},W=_.separator.fill;let J={};W?J=V:J=j,this._drawPanes.forEach(Z=>{var G;(G=this._separatorPanes.get(Z))==null||G.setBounding(J),Z.setBounding(V,j,D,R)})}i&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(fu.All)),this._layoutOptions={sort:!1,measureHeight:!1,measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1};const m=(typeof performance<"u"?performance.now():Date.now())-c;if(m>50){const h=this._chartStore.getDataList().length,_=this._chartStore.getBarSpace().bar,w=this._chartStore.getVisibleRange();console.warn("⚠️ klinecharts: layout slow",{durationMs:Math.round(m),dataLen:h,barSpace:_,visibleFrom:w.from,visibleTo:w.to,update:i})}}updatePane(e,t){if(_o(t)){const o=this.getDrawPaneById(t);o==null||o.update(e)}else this._drawPanes.forEach(o=>{var i;o.update(e),(i=this._separatorPanes.get(o))==null||i.update(e)})}getDom(e,t){var o;if(_o(e)){const i=this.getDrawPaneById(e);if(_o(i))switch(t??"root"){case"root":return i.getContainer();case"main":return i.getMainWidget().getContainer();case"yAxis":return((o=i.getYAxisWidget())==null?void 0:o.getContainer())??null}}else return this._chartContainer;return null}getSize(e,t){var o;if(_o(e)){const i=this.getDrawPaneById(e);if(_o(i))switch(t??"root"){case"root":return i.getBounding();case"main":return i.getMainWidget().getBounding();case"yAxis":return((o=i.getYAxisWidget())==null?void 0:o.getBounding())??null}}else return this._chartBounding;return null}_resetYAxisAutoCalcTickFlag(){this._drawPanes.forEach(e=>{e.getAxisComponent().setAutoCalcTickFlag(!0)})}setSymbol(e){e!==this.getSymbol()&&(this._resetYAxisAutoCalcTickFlag(),this._chartStore.setSymbol(e))}getSymbol(){return this._chartStore.getSymbol()}setPeriod(e){e!==this.getPeriod()&&(this._resetYAxisAutoCalcTickFlag(),this._chartStore.setPeriod(e))}getPeriod(){return this._chartStore.getPeriod()}setStyles(e){this._setOptions(()=>{this._chartStore.setStyles(e)})}getStyles(){return this._chartStore.getStyles()}setFormatter(e){this._setOptions(()=>{this._chartStore.setFormatter(e)})}getFormatter(){return this._chartStore.getFormatter()}setLocale(e){this._setOptions(()=>{this._chartStore.setLocale(e)})}getLocale(){return this._chartStore.getLocale()}setTimezone(e){this._setOptions(()=>{this._chartStore.setTimezone(e)})}getTimezone(){return this._chartStore.getTimezone()}setThousandsSeparator(e){this._setOptions(()=>{this._chartStore.setThousandsSeparator(e)})}getThousandsSeparator(){return this._chartStore.getThousandsSeparator()}setDecimalFold(e){this._setOptions(()=>{this._chartStore.setDecimalFold(e)})}getDecimalFold(){return this._chartStore.getDecimalFold()}_setOptions(e){e(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}setOffsetRightDistance(e){this._chartStore.setOffsetRightDistance(e,!0)}getOffsetRightDistance(){return this._chartStore.getOffsetRightDistance()}setMaxOffsetLeftDistance(e){e<0||this._chartStore.setMaxOffsetLeftDistance(e)}setMaxOffsetRightDistance(e){e<0||this._chartStore.setMaxOffsetRightDistance(e)}setLeftMinVisibleBarCount(e){e<0||this._chartStore.setLeftMinVisibleBarCount(Math.ceil(e))}setRightMinVisibleBarCount(e){e<0||this._chartStore.setRightMinVisibleBarCount(Math.ceil(e))}setBarSpace(e){this._chartStore.setBarSpace(e)}getBarSpace(){return this._chartStore.getBarSpace()}getVisibleRange(){return this._chartStore.getVisibleRange()}resetData(){this._chartStore.resetData()}applyNewData(e,t){this._chartStore.applyNewData(e,t)}addData(e,t,o){this._chartStore.addData(e,t,o)}getDataList(){return this._chartStore.getDataList()}setDataLoader(e){this._resetYAxisAutoCalcTickFlag(),this._chartStore.setDataLoader(e)}createIndicator(e,t,o){const i=au(e)?{name:e}:e;if(q2(i.name)===null)return null;const r=o??{};if(au(r.id)||(r.id=Nh(nd.INDICATOR)),au(i.id)||(i.id=Nh(i.name)),this._chartStore.addIndicator(i,r.id,t??!1)){let l=!1;return _o(this.getDrawPaneById(r.id))||(this._createPane(hx,r.id,r),r.height??(r.height=K2),l=!0),this.setPaneOptions(r),this.layout({sort:l,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0}),i.id}return null}overrideIndicator(e){return this._chartStore.overrideIndicator(e)}getIndicators(e){return this._chartStore.getIndicatorsByFilter(e??{})}removeIndicator(e){let t=this._chartStore.removeIndicator(e??{});if(!t&&e){const{name:o,id:i}=e,r=typeof o=="string"?o.split("(")[0].trim():void 0;if(i||r){const a={};i&&(a.id=i),r&&(a.name=r),t=this._chartStore.removeIndicator(a),!t&&r&&(t=this._chartStore.removeIndicator({name:r}))}}if(t){let o=!1;const i=[];this._drawPanes.forEach(r=>{const a=r.getId();a!==nd.CANDLE&&a!==nd.X_AXIS&&i.push(a)}),i.forEach(r=>{if(!this._chartStore.hasIndicators(r)){const a=this._drawPanes.findIndex(c=>c.getId()===r),l=this._drawPanes[a];_o(l)&&(o=!0,this._recalculatePaneHeight(l,0,l.getBounding().height),this._drawPanes.splice(a,1),l.destroy())}}),this._drawPanes.length===2&&(this._candlePane.setVisible(!0),this._candlePane.setBounding({height:this._chartBounding.height-this._xAxisPane.getBounding().height})),this.layout({sort:o,measureHeight:o,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}return t}createOverlay(e){const t=[],o=[],i=a=>{!_o(a.paneId)||this.getDrawPaneById(a.paneId)===null?(a.paneId=nd.CANDLE,o.push(!1)):o.push(!0),t.push(a)};au(e)?i({name:e}):pm(e)?e.forEach(a=>{let l=null;au(a)?l={name:a}:l=a,i(l)}):i(e);const r=this._chartStore.addOverlays(t,o);return pm(e)?r:r[0]}getOverlays(e){return this._chartStore.getOverlaysByFilter(e??{})}overrideOverlay(e){return this._chartStore.overrideOverlay(e)}removeOverlay(e){return this._chartStore.removeOverlay(e??{})}setPaneOptions(e){let t=!1,o=!1;const i=_o(e.id);for(const r of this._drawPanes){const a=r.getId();if(i&&e.id===a||!i){if(a!==nd.X_AXIS){if(fl(e.height)&&e.height>0){const c=Math.max(e.minHeight??r.getOptions().minHeight,0),d=Math.max(c,e.height);o=!0,t=!0,r.setOriginalBounding({height:d}),this._recalculatePaneHeight(r,d,-d)}if(_o(e.state)&&r.getOptions().state!==e.state){t=!0,o=!0;const c=e.state;switch(c){case"maximize":{const d=this._drawPanes.find(p=>{const m=p.getId();return p.getOptions().state==="maximize"&&m!==nd.X_AXIS});if(!_o(d)){r.getOptions().state==="normal"&&r.setOriginalBounding({height:r.getBounding().height}),r.setOptions({state:c});const p=this._chartBounding.height;r.setBounding({height:p-this._xAxisPane.getBounding().height}),this._drawPanes.forEach(m=>{var h;m.getId()!==nd.X_AXIS&&m.getId()!==a&&(m.setBounding({height:m.getOriginalBounding().height}),m.setVisible(!1),(h=this._separatorPanes.get(m))==null||h.setVisible(!1))})}break}case"minimize":{const d=r.getBounding().height,p=r.getOptions().state;let m=d-Z0;p==="maximize"&&(m=r.getOriginalBounding().height-Z0),this._recalculatePaneHeight(r,Z0,m)&&(p==="normal"&&r.setOriginalBounding({height:d}),r.setOptions({state:c})),this._drawPanes.forEach(h=>{var _;h.getId()!==nd.X_AXIS&&(h.setVisible(!0),(_=this._separatorPanes.get(h))==null||_.setVisible(!0))});break}default:{const d=r.getOriginalBounding().height;this._recalculatePaneHeight(r,d,r.getBounding().height-d)&&r.setOptions({state:c}),this._drawPanes.forEach(p=>{var m;p.getId()!==nd.X_AXIS&&(p.setVisible(!0),(m=this._separatorPanes.get(p))==null||m.setVisible(!0))});break}}}}_o(e.axis)&&(o=!0);const l={...e};if(delete l.state,r.setOptions(l),a===e.id)break}}o&&this.layout({measureHeight:t,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}getPaneOptions(e){if(_o(e)){const t=this.getDrawPaneById(e);return(t==null?void 0:t.getOptions())??null}return this._drawPanes.map(t=>t.getOptions())}setZoomEnabled(e){this._chartStore.setZoomEnabled(e)}isZoomEnabled(){return this._chartStore.isZoomEnabled()}setScrollEnabled(e){this._chartStore.setScrollEnabled(e)}isScrollEnabled(){return this._chartStore.isScrollEnabled()}scrollByDistance(e,t){const o=fl(t)&&t>0?t:0;if(this._chartStore.startScroll(),o>0){const i=new F1({duration:o});i.doFrame(r=>{const a=e*(r/o);this._chartStore.scroll(a)}),i.start()}else this._chartStore.scroll(e)}scrollToRealTime(e){const{bar:t}=this._chartStore.getBarSpace(),i=(this._chartStore.getLastBarRightSideDiffBarCount()-this._chartStore.getInitialOffsetRightDistance()/t)*t;this.scrollByDistance(i,e)}scrollToDataIndex(e,t){const o=(this._chartStore.getLastBarRightSideDiffBarCount()+(this.getDataList().length-1-e))*this._chartStore.getBarSpace().bar;this.scrollByDistance(o,t)}scrollToTimestamp(e,t){const o=$1(this.getDataList(),"timestamp",e);this.scrollToDataIndex(o,t)}zoomAtCoordinate(e,t,o){const i=fl(o)&&o>0?o:0,{bar:r}=this._chartStore.getBarSpace(),l=r*e-r;if(i>0){let c=0;const d=new F1({duration:i});d.doFrame(p=>{const m=l*(p/i),h=(m-c)/this._chartStore.getBarSpace().bar*E1;this._chartStore.zoom(h,t),c=m}),d.start()}else this._chartStore.zoom(l/r*E1,t)}zoomAtDataIndex(e,t,o){const i=this._chartStore.dataIndexToCoordinate(t);this.zoomAtCoordinate(e,{x:i,y:0},o)}zoomAtTimestamp(e,t,o){const i=$1(this.getDataList(),"timestamp",t);this.zoomAtDataIndex(e,i,o)}convertToPixel(e,t){const{paneId:o=nd.CANDLE,absolute:i=!1}=t??{};let r=[];if(o!==nd.X_AXIS){const a=this.getDrawPaneById(o);if(a!==null){const l=a.getBounding(),c=[].concat(e),d=this._xAxisPane.getAxisComponent(),p=a.getAxisComponent();r=c.map(m=>{const h={};let _=m.dataIndex;if(fl(m.timestamp)&&(_=this._chartStore.timestampToDataIndex(m.timestamp)),fl(_)&&(h.x=d.convertToPixel(_)),fl(m.value)){const w=p.convertToPixel(m.value);h.y=i?l.top+w:w}return h})}}return pm(e)?r:r[0]??{}}convertFromPixel(e,t){const{paneId:o=nd.CANDLE,absolute:i=!1}=t??{};let r=[];if(o!==nd.X_AXIS){const a=this.getDrawPaneById(o);if(a!==null){const l=a.getBounding(),c=[].concat(e),d=this._xAxisPane.getAxisComponent(),p=a.getAxisComponent();r=c.map(m=>{const h={};if(fl(m.x)){const _=d.convertFromPixel(m.x);h.dataIndex=_,h.timestamp=this._chartStore.dataIndexToTimestamp(_)??void 0}if(fl(m.y)){const _=i?m.y-l.top:m.y;h.value=p.convertFromPixel(_)}return h})}}return pm(e)?r:r[0]??{}}executeAction(e,t){switch(e){case"onCrosshairChange":{const o={...t};o.paneId??(o.paneId=nd.CANDLE),this._chartStore.setCrosshair(o,{notExecuteAction:!0});break}}}subscribeAction(e,t){this._chartStore.subscribeAction(e,t)}unsubscribeAction(e,t){this._chartStore.unsubscribeAction(e,t)}getConvertPictureUrl(e,t,o){const{width:i,height:r}=this._chartBounding,a=rg("canvas",{width:`${i}px`,height:`${r}px`,boxSizing:"border-box"}),l=a.getContext("2d"),c=yg(a);a.width=i*c,a.height=r*c,l.scale(c,c),l.fillStyle=o??"#FFFFFF",l.fillRect(0,0,i,r);const d=e??!1;return this._drawPanes.forEach(p=>{const m=this._separatorPanes.get(p);if(_o(m)){const _=m.getBounding();l.drawImage(m.getImage(d),_.left,_.top,_.width,_.height)}const h=p.getBounding();l.drawImage(p.getImage(d),0,h.top,i,h.height)}),a.toDataURL(`image/${t??"jpeg"}`)}resize(){this._cacheChartBounding(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}destroy(){this._chartEvent.destroy(),this._drawPanes.forEach(e=>{e.destroy()}),this._drawPanes=[],this._separatorPanes.clear(),this._chartStore.destroy(),this._container.removeChild(this._chartContainer)}}const Jy=new Map;let Q6=1;function e8(n,e){let t=null;if(au(n)?t=document.getElementById(n):t=n,t===null)return null;let o=Jy.get(t.id);if(_o(o))return o;const i=`k_line_chart_${Q6++}`;return o=new J6(t,e),o.id=i,t.setAttribute("k-line-chart-id",i),Jy.set(i,o),o}const ag={clone:th,merge:Op,isString:au,isNumber:fl,isValid:_o,isObject:Af,isArray:pm,isFunction:pf,isBoolean:Yh,formatValue:nv,formatPrecision:Mv,formatBigNumber:O2,formatDate:B2,formatThousands:z2,formatFoldDecimal:V2,calcTextWidth:Av,getLinearSlopeIntercept:k_,getLinearYFromSlopeIntercept:ny,getLinearYFromCoordinates:Kh,checkCoordinateOnArc:ox,checkCoordinateOnCircle:J2,checkCoordinateOnLine:H2,checkCoordinateOnPolygon:Q2,checkCoordinateOnRect:iy,checkCoordinateOnText:nx},Ke={Solid:"solid",Dashed:"dashed"},Yg={Fill:"fill",Stroke:"stroke",StrokeFill:"stroke_fill"},am={OnZoom:"onZoom",OnScroll:"onScroll",OnVisibleRangeChange:"onVisibleRangeChange",OnCandleTooltipFeatureClick:"onCandleTooltipFeatureClick",OnIndicatorTooltipFeatureClick:"onIndicatorTooltipFeatureClick",OnCrosshairFeatureClick:"onCrosshairFeatureClick",OnCrosshairChange:"onCrosshairChange",OnCandleBarClick:"onCandleBarClick",OnPaneDrag:"onPaneDrag"},t8={Normal:"normal",WeakMagnet:"weak_magnet",StrongMagnet:"strong_magnet"},n8={Left:"left",Middle:"middle",Right:"right"},Qy={Always:"always",FollowCross:"follow_cross",None:"none"},o8={CandleSolid:"candle_solid",CandleStroke:"candle_stroke",CandleUpStroke:"candle_up_stroke",CandleDownStroke:"candle_down_stroke",Ohlc:"ohlc",Area:"area"},s8={Tooltip:"tooltip",Crosshair:"crosshair",XAxis:"xAxis"};var J_={local:{},session:{}};function i8(n){return n==="local"?localStorage:sessionStorage}function ly(n,e,t){var o,i,r,a,l,c,d,p;const m=(o=void 0)!=null?o:JSON,h=(i=void 0)!=null?i:"local",_=(r=void 0)!=null?r:!0,w=(l=(a=void 0)!=null?a:void 0)!=null?l:j=>console.error(`Error when writing value from persisted store "${n}" to ${h}`,j),S=(c=void 0)!=null?c:(j,D)=>console.error(`Error when parsing ${j?'"'+j+'"':"value"} from persisted store "${n}"`,D),P=(d=void 0)!=null?d:j=>j,I=(p=void 0)!=null?p:j=>j,C=typeof window<"u"&&typeof document<"u",M=C?i8(h):null;function F(j,D){const R=I(D);try{M==null||M.setItem(j,m.stringify(R))}catch(W){w(W)}}function V(){function j(J){try{return m.parse(J)}catch(Z){S(J,Z)}}const D=M==null?void 0:M.getItem(n);if(D==null)return e;const R=j(D);return R==null?e:P(R)}if(!J_[h][n]){const j=V(),D=zp(j,J=>{if(C&&h=="local"&&_){const Z=G=>{if(G.key===n&&G.newValue){let se;try{se=m.parse(G.newValue)}catch(oe){S(G.newValue,oe);return}const Y=P(se);J(Y)}};return window.addEventListener("storage",Z),()=>window.removeEventListener("storage",Z)}}),{subscribe:R,set:W}=D;J_[h][n]={set(J){W(J),F(n,J)},update(J){return D.update(Z=>{const G=J(Z);return F(n,G),G})},reset(){this.set(e)},subscribe:R}}return J_[h][n]}var ng=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function t0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var _x={exports:{}};(function(n,e){(function(t,o){n.exports=o()})(ng,function(){var t=1e3,o=6e4,i=36e5,r="millisecond",a="second",l="minute",c="hour",d="day",p="week",m="month",h="quarter",_="year",w="date",S="Invalid Date",P=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,I=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,C={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(Y){var oe=["th","st","nd","rd"],ee=Y%100;return"["+Y+(oe[(ee-20)%10]||oe[ee]||oe[0])+"]"}},M=function(Y,oe,ee){var re=String(Y);return!re||re.length>=oe?Y:""+Array(oe+1-re.length).join(ee)+Y},F={s:M,z:function(Y){var oe=-Y.utcOffset(),ee=Math.abs(oe),re=Math.floor(ee/60),me=ee%60;return(oe<=0?"+":"-")+M(re,2,"0")+":"+M(me,2,"0")},m:function Y(oe,ee){if(oe.date()<ee.date())return-Y(ee,oe);var re=12*(ee.year()-oe.year())+(ee.month()-oe.month()),me=oe.clone().add(re,m),K=ee-me<0,ye=oe.clone().add(re+(K?-1:1),m);return+(-(re+(ee-me)/(K?me-ye:ye-me))||0)},a:function(Y){return Y<0?Math.ceil(Y)||0:Math.floor(Y)},p:function(Y){return{M:m,y:_,w:p,d,D:w,h:c,m:l,s:a,ms:r,Q:h}[Y]||String(Y||"").toLowerCase().replace(/s$/,"")},u:function(Y){return Y===void 0}},V="en",j={};j[V]=C;var D="$isDayjsObject",R=function(Y){return Y instanceof G||!(!Y||!Y[D])},W=function Y(oe,ee,re){var me;if(!oe)return V;if(typeof oe=="string"){var K=oe.toLowerCase();j[K]&&(me=K),ee&&(j[K]=ee,me=K);var ye=oe.split("-");if(!me&&ye.length>1)return Y(ye[0])}else{var Me=oe.name;j[Me]=oe,me=Me}return!re&&me&&(V=me),me||!re&&V},J=function(Y,oe){if(R(Y))return Y.clone();var ee=typeof oe=="object"?oe:{};return ee.date=Y,ee.args=arguments,new G(ee)},Z=F;Z.l=W,Z.i=R,Z.w=function(Y,oe){return J(Y,{locale:oe.$L,utc:oe.$u,x:oe.$x,$offset:oe.$offset})};var G=function(){function Y(ee){this.$L=W(ee.locale,null,!0),this.parse(ee),this.$x=this.$x||ee.x||{},this[D]=!0}var oe=Y.prototype;return oe.parse=function(ee){this.$d=function(re){var me=re.date,K=re.utc;if(me===null)return new Date(NaN);if(Z.u(me))return new Date;if(me instanceof Date)return new Date(me);if(typeof me=="string"&&!/Z$/i.test(me)){var ye=me.match(P);if(ye){var Me=ye[2]-1||0,Fe=(ye[7]||"0").substring(0,3);return K?new Date(Date.UTC(ye[1],Me,ye[3]||1,ye[4]||0,ye[5]||0,ye[6]||0,Fe)):new Date(ye[1],Me,ye[3]||1,ye[4]||0,ye[5]||0,ye[6]||0,Fe)}}return new Date(me)}(ee),this.init()},oe.init=function(){var ee=this.$d;this.$y=ee.getFullYear(),this.$M=ee.getMonth(),this.$D=ee.getDate(),this.$W=ee.getDay(),this.$H=ee.getHours(),this.$m=ee.getMinutes(),this.$s=ee.getSeconds(),this.$ms=ee.getMilliseconds()},oe.$utils=function(){return Z},oe.isValid=function(){return this.$d.toString()!==S},oe.isSame=function(ee,re){var me=J(ee);return this.startOf(re)<=me&&me<=this.endOf(re)},oe.isAfter=function(ee,re){return J(ee)<this.startOf(re)},oe.isBefore=function(ee,re){return this.endOf(re)<J(ee)},oe.$g=function(ee,re,me){return Z.u(ee)?this[re]:this.set(me,ee)},oe.unix=function(){return Math.floor(this.valueOf()/1e3)},oe.valueOf=function(){return this.$d.getTime()},oe.startOf=function(ee,re){var me=this,K=!!Z.u(re)||re,ye=Z.p(ee),Me=function(ft,bt){var nt=Z.w(me.$u?Date.UTC(me.$y,bt,ft):new Date(me.$y,bt,ft),me);return K?nt:nt.endOf(d)},Fe=function(ft,bt){return Z.w(me.toDate()[ft].apply(me.toDate("s"),(K?[0,0,0,0]:[23,59,59,999]).slice(bt)),me)},Ze=this.$W,Ge=this.$M,it=this.$D,Ye="set"+(this.$u?"UTC":"");switch(ye){case _:return K?Me(1,0):Me(31,11);case m:return K?Me(1,Ge):Me(0,Ge+1);case p:var ct=this.$locale().weekStart||0,kt=(Ze<ct?Ze+7:Ze)-ct;return Me(K?it-kt:it+(6-kt),Ge);case d:case w:return Fe(Ye+"Hours",0);case c:return Fe(Ye+"Minutes",1);case l:return Fe(Ye+"Seconds",2);case a:return Fe(Ye+"Milliseconds",3);default:return this.clone()}},oe.endOf=function(ee){return this.startOf(ee,!1)},oe.$set=function(ee,re){var me,K=Z.p(ee),ye="set"+(this.$u?"UTC":""),Me=(me={},me[d]=ye+"Date",me[w]=ye+"Date",me[m]=ye+"Month",me[_]=ye+"FullYear",me[c]=ye+"Hours",me[l]=ye+"Minutes",me[a]=ye+"Seconds",me[r]=ye+"Milliseconds",me)[K],Fe=K===d?this.$D+(re-this.$W):re;if(K===m||K===_){var Ze=this.clone().set(w,1);Ze.$d[Me](Fe),Ze.init(),this.$d=Ze.set(w,Math.min(this.$D,Ze.daysInMonth())).$d}else Me&&this.$d[Me](Fe);return this.init(),this},oe.set=function(ee,re){return this.clone().$set(ee,re)},oe.get=function(ee){return this[Z.p(ee)]()},oe.add=function(ee,re){var me,K=this;ee=Number(ee);var ye=Z.p(re),Me=function(Ge){var it=J(K);return Z.w(it.date(it.date()+Math.round(Ge*ee)),K)};if(ye===m)return this.set(m,this.$M+ee);if(ye===_)return this.set(_,this.$y+ee);if(ye===d)return Me(1);if(ye===p)return Me(7);var Fe=(me={},me[l]=o,me[c]=i,me[a]=t,me)[ye]||1,Ze=this.$d.getTime()+ee*Fe;return Z.w(Ze,this)},oe.subtract=function(ee,re){return this.add(-1*ee,re)},oe.format=function(ee){var re=this,me=this.$locale();if(!this.isValid())return me.invalidDate||S;var K=ee||"YYYY-MM-DDTHH:mm:ssZ",ye=Z.z(this),Me=this.$H,Fe=this.$m,Ze=this.$M,Ge=me.weekdays,it=me.months,Ye=me.meridiem,ct=function(bt,nt,Pt,Qe){return bt&&(bt[nt]||bt(re,K))||Pt[nt].slice(0,Qe)},kt=function(bt){return Z.s(Me%12||12,bt,"0")},ft=Ye||function(bt,nt,Pt){var Qe=bt<12?"AM":"PM";return Pt?Qe.toLowerCase():Qe};return K.replace(I,function(bt,nt){return nt||function(Pt){switch(Pt){case"YY":return String(re.$y).slice(-2);case"YYYY":return Z.s(re.$y,4,"0");case"M":return Ze+1;case"MM":return Z.s(Ze+1,2,"0");case"MMM":return ct(me.monthsShort,Ze,it,3);case"MMMM":return ct(it,Ze);case"D":return re.$D;case"DD":return Z.s(re.$D,2,"0");case"d":return String(re.$W);case"dd":return ct(me.weekdaysMin,re.$W,Ge,2);case"ddd":return ct(me.weekdaysShort,re.$W,Ge,3);case"dddd":return Ge[re.$W];case"H":return String(Me);case"HH":return Z.s(Me,2,"0");case"h":return kt(1);case"hh":return kt(2);case"a":return ft(Me,Fe,!0);case"A":return ft(Me,Fe,!1);case"m":return String(Fe);case"mm":return Z.s(Fe,2,"0");case"s":return String(re.$s);case"ss":return Z.s(re.$s,2,"0");case"SSS":return Z.s(re.$ms,3,"0");case"Z":return ye}return null}(bt)||ye.replace(":","")})},oe.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},oe.diff=function(ee,re,me){var K,ye=this,Me=Z.p(re),Fe=J(ee),Ze=(Fe.utcOffset()-this.utcOffset())*o,Ge=this-Fe,it=function(){return Z.m(ye,Fe)};switch(Me){case _:K=it()/12;break;case m:K=it();break;case h:K=it()/3;break;case p:K=(Ge-Ze)/6048e5;break;case d:K=(Ge-Ze)/864e5;break;case c:K=Ge/i;break;case l:K=Ge/o;break;case a:K=Ge/t;break;default:K=Ge}return me?K:Z.a(K)},oe.daysInMonth=function(){return this.endOf(m).$D},oe.$locale=function(){return j[this.$L]},oe.locale=function(ee,re){if(!ee)return this.$L;var me=this.clone(),K=W(ee,re,!0);return K&&(me.$L=K),me},oe.clone=function(){return Z.w(this.$d,this)},oe.toDate=function(){return new Date(this.valueOf())},oe.toJSON=function(){return this.isValid()?this.toISOString():null},oe.toISOString=function(){return this.$d.toISOString()},oe.toString=function(){return this.$d.toUTCString()},Y}(),se=G.prototype;return J.prototype=se,[["$ms",r],["$s",a],["$m",l],["$H",c],["$W",d],["$M",m],["$y",_],["$D",w]].forEach(function(Y){se[Y[1]]=function(oe){return this.$g(oe,Y[0],Y[1])}}),J.extend=function(Y,oe){return Y.$i||(Y(oe,G,J),Y.$i=!0),J},J.locale=W,J.isDayjs=R,J.unix=function(Y){return J(1e3*Y)},J.en=j[V],J.Ls=j,J.p={},J})})(_x);var r8=_x.exports;const Xv=t0(r8);var yx={exports:{}};(function(n,e){(function(t,o){n.exports=o()})(ng,function(){var t={year:0,month:1,day:2,hour:3,minute:4,second:5},o={};return function(i,r,a){var l,c=function(h,_,w){w===void 0&&(w={});var S=new Date(h),P=function(I,C){C===void 0&&(C={});var M=C.timeZoneName||"short",F=I+"|"+M,V=o[F];return V||(V=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:I,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:M}),o[F]=V),V}(_,w);return P.formatToParts(S)},d=function(h,_){for(var w=c(h,_),S=[],P=0;P<w.length;P+=1){var I=w[P],C=I.type,M=I.value,F=t[C];F>=0&&(S[F]=parseInt(M,10))}var V=S[3],j=V===24?0:V,D=S[0]+"-"+S[1]+"-"+S[2]+" "+j+":"+S[4]+":"+S[5]+":000",R=+h;return(a.utc(D).valueOf()-(R-=R%1e3))/6e4},p=r.prototype;p.tz=function(h,_){h===void 0&&(h=l);var w,S=this.utcOffset(),P=this.toDate(),I=P.toLocaleString("en-US",{timeZone:h}),C=Math.round((P-new Date(I))/1e3/60),M=15*-Math.round(P.getTimezoneOffset()/15)-C;if(!Number(M))w=this.utcOffset(0,_);else if(w=a(I,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(M,!0),_){var F=w.utcOffset();w=w.add(S-F,"minute")}return w.$x.$timezone=h,w},p.offsetName=function(h){var _=this.$x.$timezone||a.tz.guess(),w=c(this.valueOf(),_,{timeZoneName:h}).find(function(S){return S.type.toLowerCase()==="timezonename"});return w&&w.value};var m=p.startOf;p.startOf=function(h,_){if(!this.$x||!this.$x.$timezone)return m.call(this,h,_);var w=a(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return m.call(w,h,_).tz(this.$x.$timezone,!0)},a.tz=function(h,_,w){var S=w&&_,P=w||_||l,I=d(+a(),P);if(typeof h!="string")return a(h).tz(P);var C=function(j,D,R){var W=j-60*D*1e3,J=d(W,R);if(D===J)return[W,D];var Z=d(W-=60*(J-D)*1e3,R);return J===Z?[W,J]:[j-60*Math.min(J,Z)*1e3,Math.max(J,Z)]}(a.utc(h,S).valueOf(),I,P),M=C[0],F=C[1],V=a(M).utcOffset(F);return V.$x.$timezone=P,V},a.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},a.tz.setDefault=function(h){l=h}}})})(yx);var a8=yx.exports;const l8=t0(a8);var bx={exports:{}};(function(n,e){(function(t,o){n.exports=o()})(ng,function(){var t="minute",o=/[+-]\d\d(?::?\d\d)?/g,i=/([+-]|\d\d)/g;return function(r,a,l){var c=a.prototype;l.utc=function(S){var P={date:S,utc:!0,args:arguments};return new a(P)},c.utc=function(S){var P=l(this.toDate(),{locale:this.$L,utc:!0});return S?P.add(this.utcOffset(),t):P},c.local=function(){return l(this.toDate(),{locale:this.$L,utc:!1})};var d=c.parse;c.parse=function(S){S.utc&&(this.$u=!0),this.$utils().u(S.$offset)||(this.$offset=S.$offset),d.call(this,S)};var p=c.init;c.init=function(){if(this.$u){var S=this.$d;this.$y=S.getUTCFullYear(),this.$M=S.getUTCMonth(),this.$D=S.getUTCDate(),this.$W=S.getUTCDay(),this.$H=S.getUTCHours(),this.$m=S.getUTCMinutes(),this.$s=S.getUTCSeconds(),this.$ms=S.getUTCMilliseconds()}else p.call(this)};var m=c.utcOffset;c.utcOffset=function(S,P){var I=this.$utils().u;if(I(S))return this.$u?0:I(this.$offset)?m.call(this):this.$offset;if(typeof S=="string"&&(S=function(V){V===void 0&&(V="");var j=V.match(o);if(!j)return null;var D=(""+j[0]).match(i)||["-",0,0],R=D[0],W=60*+D[1]+ +D[2];return W===0?0:R==="+"?W:-W}(S),S===null))return this;var C=Math.abs(S)<=16?60*S:S,M=this;if(P)return M.$offset=C,M.$u=S===0,M;if(S!==0){var F=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(M=this.local().add(C+F,t)).$offset=C,M.$x.$localOffset=F}else M=this.utc();return M};var h=c.format;c.format=function(S){var P=S||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return h.call(this,P)},c.valueOf=function(){var S=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*S},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var _=c.toDate;c.toDate=function(S){return S==="s"&&this.$offset?l(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():_.call(this)};var w=c.diff;c.diff=function(S,P,I){if(S&&this.$u===S.$u)return w.call(this,S,P,I);var C=this.local(),M=l(S).local();return w.call(C,M,P,I)}}})})(bx);var c8=bx.exports;const d8=t0(c8),Ih=s8,Bf=ag.formatDate;let cy=!0,dy="UTC";Xv.extend(l8);Xv.extend(d8);Xv.tz.setDefault("UTC");const D1=60,j1=D1*60,Zh=j1*24,eb=Zh*7,tb=Zh*30,nb=Zh*365,u8={"Africa/Abidjan":"utc","Pacific/Honolulu":"honolulu","America/Juneau":"juneau","America/Los_Angeles":"los_angeles","America/Chicago":"chicago","America/Toronto":"toronto","America/Sao_Paulo":"sao_paulo","Europe/London":"london","Europe/Berlin":"berlin","Asia/Bahrain":"bahrain","Asia/Dubai":"dubai","Asia/Ashkhabad":"ashkhabad","Asia/Almaty":"almaty","Asia/Bangkok":"bangkok","Asia/Shanghai":"shanghai","Asia/Tokyo":"tokyo","Australia/Sydney":"sydney","Pacific/Guadalcanal":"guadalcanal","Pacific/Auckland":"auckland"};function p8(){return Xv().valueOf()}function ob(n){if(!n)return 0;n=n.trim();const e=/^\d+$/.test(n);let t=null;if(e){const o=n.length;if(o==4){const i=new Date().getFullYear();t=Xv(`${i}${n}`,"YYYYMMDD")}else if(o==6){const i=parseInt(n.substring(0,2)),r=i>50?1900+i:2e3+i,a=n.substring(2);t=Xv(`${r}${a}`,"YYYYMMDD")}else if(o==8)t=Xv(n,"YYYYMMDD");else if(o==10)t=Xv.unix(parseInt(n));else if(o==12)t=Xv(n,"YYYYMMDDHHmm");else if(o==13)t=Xv(parseInt(n));else if(o==14)t=Xv(n,"YYYYMMDDHHmmss");else return console.error("invalid date format:",n),0}else t=Xv(n,["YYYY/MM/DD","YYYY/MM/DD HH:mm","YYYY/MM/DD HH:mm:ss","YYYY-MM-DD","YYYY-MM-DD HH:mm","YYYY-MM-DD HH:mm:ss"],!0);return!t||!t.isValid()?(console.error("Invalid date format or value:",n),0):(cy||console.error("local timezone not applied"),t=t.tz(dy,!0),t.valueOf())}function sb(n,e="YYYY-MM-DD HH:mm:ss",t=void 0){if(!n)return"--";let o=null;return n>1e12?o=Xv(n):o=Xv.unix(n),o=o.tz(t||dy,!0),cy||console.error("local timezone not applied"),o.format(e)}function v8(n,e,t){let o=e,i=o;switch(n.timespan){case"minute":{o=o-o%(60*1e3),i=o-t*n.multiplier*60*1e3;break}case"hour":{o=o-o%(60*60*1e3),i=o-t*n.multiplier*60*60*1e3;break}case"day":{o=o-o%(60*60*1e3),i=o-t*n.multiplier*24*60*60*1e3;break}case"week":{const a=new Date(o).getDay(),l=a===0?6:a-1;o=o-l*60*60*24;const c=new Date(o);o=new Date(`${c.getFullYear()}-${c.getMonth()+1}-${c.getDate()}`).getTime(),i=t*n.multiplier*7*24*60*60*1e3;break}case"month":{const r=new Date(o),a=r.getFullYear(),l=r.getMonth()+1;o=new Date(`${a}-${l}-01`).getTime(),i=t*n.multiplier*30*24*60*60*1e3;const c=new Date(i);i=new Date(`${c.getFullYear()}-${c.getMonth()+1}-01`).getTime();break}}return[i,o]}function Pv(n){if(!n)return 0;const e=n.substring(n.length-1),t=parseInt(n.substring(0,n.length-1));let o=0;if(e=="y")o=31536e3;else if(e=="M")o=2592e3;else if(e=="w")o=604800;else if(e=="d")o=86400;else if(e=="h")o=3600;else if(e=="m")o=60;else if(e=="s")o=1;else throw Error(`unsupport timeframe: ${n}`);return o*t}function f8(n){return n>nb?`${Math.floor(n/nb)}y`:n>tb?`${Math.floor(n/tb)}M`:n>eb?`${Math.floor(n/eb)}w`:n>Zh?`${Math.floor(n/Zh)}d`:n>j1?`${Math.floor(n/j1)}h`:n>D1?`${Math.floor(n/D1)}m`:`${Math.floor(n)}s`}function m8(n){const e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};let t=null;try{t=new Intl.DateTimeFormat("en",e)}catch{console.error("","","Timezone is error!!!")}return t}const Of=m8();function ib(n){function e(t,o,i){if(!t||isNaN(t)||t<=0)return new Date().toISOString().slice(0,19).replace("T"," ");switch(n){case"second":return i===Ih.XAxis?Bf(Of,t,"HH:mm:ss"):Bf(Of,t,"YYYY-MM-DD HH:mm:ss");case"minute":return i===Ih.XAxis?Bf(Of,t,"HH:mm"):Bf(Of,t,"YYYY-MM-DD HH:mm");case"hour":return i===Ih.XAxis?Bf(Of,t,"MM-DD HH:mm"):Bf(Of,t,"YYYY-MM-DD HH:mm");case"day":case"week":return Bf(Of,t,"YYYY-MM-DD");case"month":return i===Ih.XAxis?Bf(Of,t,"YYYY-MM"):Bf(Of,t,"YYYY-MM-DD");case"year":return i===Ih.XAxis?Bf(Of,t,"YYYY"):Bf(Of,t,"YYYY-MM-DD")}return Bf(Of,t,"YYYY-MM-DD HH:mm")}return e}async function rb(n){n&&(n=="Africa/Abidjan"||n.toLowerCase().indexOf("utc")>=0)&&(n="UTC"),Xv.tz.setDefault(n),dy=n,cy=!0}function g8(){return Object.entries(u8).map(([n,e])=>({key:n,text:e}))}const h8=()=>"Time",_8=()=>"时间",y8=(n={},e={})=>({en:h8,"zh-CN":_8})[e.languageTag??Do()](),b8=()=>"O",x8=()=>"开",w8=(n={},e={})=>({en:b8,"zh-CN":x8})[e.languageTag??Do()](),k8=()=>"H",S8=()=>"高",C8=(n={},e={})=>({en:k8,"zh-CN":S8})[e.languageTag??Do()](),P8=()=>"L",I8=()=>"低",M8=(n={},e={})=>({en:P8,"zh-CN":I8})[e.languageTag??Do()](),A8=()=>"C",T8=()=>"收",L8=(n={},e={})=>({en:A8,"zh-CN":T8})[e.languageTag??Do()](),F8=()=>"vol",$8=()=>"量",E8=(n={},e={})=>({en:F8,"zh-CN":$8})[e.languageTag??Do()](),N8=()=>"Chg",D8=()=>"涨跌",j8=(n={},e={})=>({en:N8,"zh-CN":D8})[e.languageTag??Do()](),R8=()=>"Timeframe",B8=()=>"周期",xx=(n={},e={})=>({en:R8,"zh-CN":B8})[e.languageTag??Do()](),O8=()=>"No Data",z8=()=>"数据为空",V8=(n={},e={})=>({en:O8,"zh-CN":z8})[e.languageTag??Do()](),W8=()=>"Indicator",q8=()=>"指标",uy=(n={},e={})=>({en:W8,"zh-CN":q8})[e.languageTag??Do()](),H8=()=>"Timezone",U8=()=>"时区",wx=(n={},e={})=>({en:H8,"zh-CN":U8})[e.languageTag??Do()](),G8=()=>"Setting",Y8=()=>"设置",K8=(n={},e={})=>({en:G8,"zh-CN":Y8})[e.languageTag??Do()](),Z8=()=>"Confirm",X8=()=>"确认",J8=(n={},e={})=>({en:Z8,"zh-CN":X8})[e.languageTag??Do()](),Q8=()=>"Cancel",e4=()=>"取消",t4=(n={},e={})=>({en:Q8,"zh-CN":e4})[e.languageTag??Do()](),n4=()=>"Search Symbol",o4=()=>"搜索品种",kx=(n={},e={})=>({en:n4,"zh-CN":o4})[e.languageTag??Do()](),s4=()=>"This indicator has no parameters",i4=()=>"该指标没有参数",Sx=(n={},e={})=>({en:s4,"zh-CN":i4})[e.languageTag??Do()](),r4=()=>"Search",a4=()=>"搜索",Cx=(n={},e={})=>({en:r4,"zh-CN":a4})[e.languageTag??Do()](),l4=()=>"Settings",c4=()=>"设置",Px=(n={},e={})=>({en:l4,"zh-CN":c4})[e.languageTag??Do()](),d4=()=>"Screenshot",u4=()=>"截图",p4=(n={},e={})=>({en:d4,"zh-CN":u4})[e.languageTag??Do()](),v4=()=>"Grid Show",f4=()=>"显示网格",m4=(n={},e={})=>({en:v4,"zh-CN":f4})[e.languageTag??Do()](),g4=()=>"Restore",h4=()=>"恢复",_4=(n={},e={})=>({en:g4,"zh-CN":h4})[e.languageTag??Do()](),y4=()=>"Reset",b4=()=>"重置",x4=(n={},e={})=>({en:y4,"zh-CN":b4})[e.languageTag??Do()](),w4=()=>"Candlestick Type",k4=()=>"蜡烛图类型",S4=(n={},e={})=>({en:w4,"zh-CN":k4})[e.languageTag??Do()](),C4=()=>"Candlestick",P4=()=>"全实心",I4=(n={},e={})=>({en:C4,"zh-CN":P4})[e.languageTag??Do()](),M4=()=>"Hollow",A4=()=>"全空心",T4=(n={},e={})=>({en:M4,"zh-CN":A4})[e.languageTag??Do()](),L4=()=>"Up Hollow",F4=()=>"涨空心",$4=(n={},e={})=>({en:L4,"zh-CN":F4})[e.languageTag??Do()](),E4=()=>"Down Hollow",N4=()=>"跌空心",D4=(n={},e={})=>({en:E4,"zh-CN":N4})[e.languageTag??Do()](),j4=()=>"OHLC",R4=()=>"OHLC",B4=(n={},e={})=>({en:j4,"zh-CN":R4})[e.languageTag??Do()](),O4=()=>"Area",z4=()=>"面积图",V4=(n={},e={})=>({en:O4,"zh-CN":z4})[e.languageTag??Do()](),W4=()=>"Price Axis Type",q4=()=>"价格轴类型",H4=(n={},e={})=>({en:W4,"zh-CN":q4})[e.languageTag??Do()](),U4=()=>"Reverse Coordinate",G4=()=>"反转坐标",Y4=(n={},e={})=>({en:U4,"zh-CN":G4})[e.languageTag??Do()](),K4=()=>"Show Last Price",Z4=()=>"显示最新价",X4=(n={},e={})=>({en:K4,"zh-CN":Z4})[e.languageTag??Do()](),J4=()=>"Show High Price",Q4=()=>"显示最高价",eS=(n={},e={})=>({en:J4,"zh-CN":Q4})[e.languageTag??Do()](),tS=()=>"Show Low Price",nS=()=>"显示最低价",oS=(n={},e={})=>({en:tS,"zh-CN":nS})[e.languageTag??Do()](),sS=()=>"Show Indicator Last Value",iS=()=>"显示指标最新值",rS=(n={},e={})=>({en:sS,"zh-CN":iS})[e.languageTag??Do()](),aS=()=>"Param ",lS=()=>"参数",Ix=(n={},e={})=>({en:aS,"zh-CN":lS})[e.languageTag??Do()](),cS=()=>"Period",dS=()=>"周期",R1=(n={},e={})=>({en:cS,"zh-CN":dS})[e.languageTag??Do()](),uS=()=>"StdDev",pS=()=>"标准差",Mx=(n={},e={})=>({en:uS,"zh-CN":pS})[e.languageTag??Do()](),vS=()=>"Normal",fS=()=>"正常",mS=(n={},e={})=>({en:vS,"zh-CN":fS})[e.languageTag??Do()](),gS=()=>"Percentage",hS=()=>"百分比",_S=(n={},e={})=>({en:gS,"zh-CN":hS})[e.languageTag??Do()](),yS=()=>"Log",bS=()=>"对数",xS=(n={},e={})=>({en:yS,"zh-CN":bS})[e.languageTag??Do()](),wS=()=>" Bars",kS=()=>"根",Ax=(n={},e={})=>({en:wS,"zh-CN":kS})[e.languageTag??Do()](),SS=()=>"days",CS=()=>"天",Tx=(n={},e={})=>({en:SS,"zh-CN":CS})[e.languageTag??Do()](),PS=()=>"hours",IS=()=>"时",Lx=(n={},e={})=>({en:PS,"zh-CN":IS})[e.languageTag??Do()](),MS=()=>"mins",AS=()=>"分",B1=(n={},e={})=>({en:MS,"zh-CN":AS})[e.languageTag??Do()](),TS=()=>"Minutes",LS=()=>"分钟",Fx=(n={},e={})=>({en:TS,"zh-CN":LS})[e.languageTag??Do()](),FS=()=>"Hours",$S=()=>"小时",$x=(n={},e={})=>({en:FS,"zh-CN":$S})[e.languageTag??Do()](),ES=()=>"Days",NS=()=>"日",Ex=(n={},e={})=>({en:ES,"zh-CN":NS})[e.languageTag??Do()](),DS=()=>"Weeks",jS=()=>"周",Nx=(n={},e={})=>({en:DS,"zh-CN":jS})[e.languageTag??Do()](),RS=()=>"Months",BS=()=>"月",Dx=(n={},e={})=>({en:RS,"zh-CN":BS})[e.languageTag??Do()](),OS=()=>"Horizontal Straight Line",zS=()=>"水平直线",VS=(n={},e={})=>({en:OS,"zh-CN":zS})[e.languageTag??Do()](),WS=()=>"Horizontal Ray Line",qS=()=>"水平射线",HS=(n={},e={})=>({en:WS,"zh-CN":qS})[e.languageTag??Do()](),US=()=>"Horizontal Segment",GS=()=>"水平线段",YS=(n={},e={})=>({en:US,"zh-CN":GS})[e.languageTag??Do()](),KS=()=>"Vertical Straight Line",ZS=()=>"垂直直线",XS=(n={},e={})=>({en:KS,"zh-CN":ZS})[e.languageTag??Do()](),JS=()=>"Vertical Ray Line",QS=()=>"垂直射线",eC=(n={},e={})=>({en:JS,"zh-CN":QS})[e.languageTag??Do()](),tC=()=>"Vertical Segment",nC=()=>"垂直线段",oC=(n={},e={})=>({en:tC,"zh-CN":nC})[e.languageTag??Do()](),sC=()=>"Straight Line",iC=()=>"直线",rC=(n={},e={})=>({en:sC,"zh-CN":iC})[e.languageTag??Do()](),aC=()=>"Ray Line",lC=()=>"射线",cC=(n={},e={})=>({en:aC,"zh-CN":lC})[e.languageTag??Do()](),dC=()=>"Segment",uC=()=>"线段",pC=(n={},e={})=>({en:dC,"zh-CN":uC})[e.languageTag??Do()](),vC=()=>"Arrow",fC=()=>"箭头",mC=(n={},e={})=>({en:vC,"zh-CN":fC})[e.languageTag??Do()](),gC=()=>"Price Line",hC=()=>"价格线",_C=(n={},e={})=>({en:gC,"zh-CN":hC})[e.languageTag??Do()](),yC=()=>"Price Channel Line",bC=()=>"价格通道线",xC=(n={},e={})=>({en:yC,"zh-CN":bC})[e.languageTag??Do()](),wC=()=>"Parallel Straight Line",kC=()=>"平行直线",SC=(n={},e={})=>({en:wC,"zh-CN":kC})[e.languageTag??Do()](),CC=()=>"Fibonacci Retracement Segment",PC=()=>"斐波那契回调线段",IC=(n={},e={})=>({en:CC,"zh-CN":PC})[e.languageTag??Do()](),MC=()=>"Fibonacci Circle",AC=()=>"斐波那契圆环",TC=(n={},e={})=>({en:MC,"zh-CN":AC})[e.languageTag??Do()](),LC=()=>"Fibonacci Spiral",FC=()=>"斐波那契螺旋",$C=(n={},e={})=>({en:LC,"zh-CN":FC})[e.languageTag??Do()](),EC=()=>"Fibonacci Speed Resistance Fan",NC=()=>"斐波那契速度阻力扇",DC=(n={},e={})=>({en:EC,"zh-CN":NC})[e.languageTag??Do()](),jC=()=>"Fibonacci Extension",RC=()=>"斐波那契趋势扩展",BC=(n={},e={})=>({en:jC,"zh-CN":RC})[e.languageTag??Do()](),OC=()=>"Gann Box",zC=()=>"江恩箱",VC=(n={},e={})=>({en:OC,"zh-CN":zC})[e.languageTag??Do()](),WC=()=>"Rectangle",qC=()=>"矩形",HC=(n={},e={})=>({en:WC,"zh-CN":qC})[e.languageTag??Do()](),UC=()=>"Parallelogram",GC=()=>"平行四边形",YC=(n={},e={})=>({en:UC,"zh-CN":GC})[e.languageTag??Do()](),KC=()=>"Circle",ZC=()=>"圆",XC=(n={},e={})=>({en:KC,"zh-CN":ZC})[e.languageTag??Do()](),JC=()=>"Triangle",QC=()=>"三角形",e9=(n={},e={})=>({en:JC,"zh-CN":QC})[e.languageTag??Do()](),t9=()=>"Three Waves",n9=()=>"三浪",o9=(n={},e={})=>({en:t9,"zh-CN":n9})[e.languageTag??Do()](),s9=()=>"Five Waves",i9=()=>"五浪",r9=(n={},e={})=>({en:s9,"zh-CN":i9})[e.languageTag??Do()](),a9=()=>"Eight Waves",l9=()=>"八浪",c9=(n={},e={})=>({en:a9,"zh-CN":l9})[e.languageTag??Do()](),d9=()=>"Any Waves",u9=()=>"任意浪",p9=(n={},e={})=>({en:d9,"zh-CN":u9})[e.languageTag??Do()](),v9=()=>"ABCD Pattern",f9=()=>"ABCD形态",m9=(n={},e={})=>({en:v9,"zh-CN":f9})[e.languageTag??Do()](),g9=()=>"XABCD Pattern",h9=()=>"XABCD形态",_9=(n={},e={})=>({en:g9,"zh-CN":h9})[e.languageTag??Do()](),y9=()=>"Weak Magnet Mode",b9=()=>"弱磁模式",x9=(n={},e={})=>({en:y9,"zh-CN":b9})[e.languageTag??Do()](),w9=()=>"Strong Magnet Mode",k9=()=>"强磁模式",S9=(n={},e={})=>({en:w9,"zh-CN":k9})[e.languageTag??Do()](),C9=()=>"Moving Average",P9=()=>"移动平均",I9=(n={},e={})=>({en:C9,"zh-CN":P9})[e.languageTag??Do()](),M9=()=>"Exponential Moving Average",A9=()=>"指数移动平均",T9=(n={},e={})=>({en:M9,"zh-CN":A9})[e.languageTag??Do()](),L9=()=>"Simple Moving Average",F9=()=>"简单移动平均",$9=(n={},e={})=>({en:L9,"zh-CN":F9})[e.languageTag??Do()](),E9=()=>"Bollinger Bands",N9=()=>"布林线",D9=(n={},e={})=>({en:E9,"zh-CN":N9})[e.languageTag??Do()](),j9=()=>"Parabolic SAR",R9=()=>"抛物线转向",B9=(n={},e={})=>({en:j9,"zh-CN":R9})[e.languageTag??Do()](),O9=()=>"Bull and Bear Index",z9=()=>"多空指标",V9=(n={},e={})=>({en:O9,"zh-CN":z9})[e.languageTag??Do()](),W9=()=>"Volume",q9=()=>"成交量",H9=(n={},e={})=>({en:W9,"zh-CN":q9})[e.languageTag??Do()](),U9=()=>"Moving Average Convergence Divergence",G9=()=>"平滑异同移动平均线",Y9=(n={},e={})=>({en:U9,"zh-CN":G9})[e.languageTag??Do()](),K9=()=>"KDJ Index",Z9=()=>"随机指标",X9=(n={},e={})=>({en:K9,"zh-CN":Z9})[e.languageTag??Do()](),J9=()=>"Relative Strength Index",Q9=()=>"相对强弱指数",e7=(n={},e={})=>({en:J9,"zh-CN":Q9})[e.languageTag??Do()](),t7=()=>"Bias",n7=()=>"乖离率",o7=(n={},e={})=>({en:t7,"zh-CN":n7})[e.languageTag??Do()](),s7=()=>"Bull and Bear Ratio",i7=()=>"人气意愿指标",r7=(n={},e={})=>({en:s7,"zh-CN":i7})[e.languageTag??Do()](),a7=()=>"Commodity Channel Index",l7=()=>"顺势指标",c7=(n={},e={})=>({en:a7,"zh-CN":l7})[e.languageTag??Do()](),d7=()=>"Energy",u7=()=>"能量指标",p7=(n={},e={})=>({en:d7,"zh-CN":u7})[e.languageTag??Do()](),v7=()=>"Psychological Line",f7=()=>"心理线",m7=(n={},e={})=>({en:v7,"zh-CN":f7})[e.languageTag??Do()](),g7=()=>"Parallel Line Difference",h7=()=>"平行线差指标",_7=(n={},e={})=>({en:g7,"zh-CN":h7})[e.languageTag??Do()](),y7=()=>"Triple Exponential Moving Average",b7=()=>"三重指数平滑移动平均线",x7=(n={},e={})=>({en:y7,"zh-CN":b7})[e.languageTag??Do()](),w7=()=>"On Balance Volume",k7=()=>"能量潮",S7=(n={},e={})=>({en:w7,"zh-CN":k7})[e.languageTag??Do()](),C7=()=>"Volume Variation Rate",P7=()=>"成交量变异率",I7=(n={},e={})=>({en:C7,"zh-CN":P7})[e.languageTag??Do()](),M7=()=>"Williams Percentage Range",A7=()=>"威廉指标",T7=(n={},e={})=>({en:M7,"zh-CN":A7})[e.languageTag??Do()](),L7=()=>"Momentum",F7=()=>"动量指标",$7=(n={},e={})=>({en:L7,"zh-CN":F7})[e.languageTag??Do()](),E7=()=>"Ease of Movement",N7=()=>"简易波动指标",D7=(n={},e={})=>({en:E7,"zh-CN":N7})[e.languageTag??Do()](),j7=()=>"Rate of Change",R7=()=>"变动率指标",B7=(n={},e={})=>({en:j7,"zh-CN":R7})[e.languageTag??Do()](),O7=()=>"Price Volume Trend",z7=()=>"量价趋势",V7=(n={},e={})=>({en:O7,"zh-CN":z7})[e.languageTag??Do()](),W7=()=>"Awesome Oscillator",q7=()=>"震荡指标",H7=(n={},e={})=>({en:W7,"zh-CN":q7})[e.languageTag??Do()](),U7=()=>"Directional Movement Index",G7=()=>"趋向指标",Y7=(n={},e={})=>({en:U7,"zh-CN":G7})[e.languageTag??Do()](),K7=()=>"Coordinated Universal Time (UTC)",Z7=()=>"世界统一时间",X7=(n={},e={})=>({en:K7,"zh-CN":Z7})[e.languageTag??Do()](),J7=()=>"(UTC-10) Honolulu",Q7=()=>"(UTC-10) 檀香山",eP=(n={},e={})=>({en:J7,"zh-CN":Q7})[e.languageTag??Do()](),tP=()=>"(UTC-8) Juneau",nP=()=>"(UTC-8) 朱诺",oP=(n={},e={})=>({en:tP,"zh-CN":nP})[e.languageTag??Do()](),sP=()=>"(UTC-7) Los Angeles",iP=()=>"(UTC-7) 洛杉矶",rP=(n={},e={})=>({en:sP,"zh-CN":iP})[e.languageTag??Do()](),aP=()=>"(UTC-5) Chicago",lP=()=>"(UTC-5) 芝加哥",cP=(n={},e={})=>({en:aP,"zh-CN":lP})[e.languageTag??Do()](),dP=()=>"(UTC-4) Toronto",uP=()=>"(UTC-4) 多伦多",pP=(n={},e={})=>({en:dP,"zh-CN":uP})[e.languageTag??Do()](),vP=()=>"(UTC-3) São Paulo",fP=()=>"(UTC-3) 圣保罗",mP=(n={},e={})=>({en:vP,"zh-CN":fP})[e.languageTag??Do()](),gP=()=>"(UTC+1) London",hP=()=>"(UTC+1) 伦敦",_P=(n={},e={})=>({en:gP,"zh-CN":hP})[e.languageTag??Do()](),yP=()=>"(UTC+2) Berlin",bP=()=>"(UTC+2) 柏林",xP=(n={},e={})=>({en:yP,"zh-CN":bP})[e.languageTag??Do()](),wP=()=>"(UTC+3) Bahrain",kP=()=>"(UTC+3) 巴林",SP=(n={},e={})=>({en:wP,"zh-CN":kP})[e.languageTag??Do()](),CP=()=>"(UTC+4) Dubai",PP=()=>"(UTC+4) 迪拜",IP=(n={},e={})=>({en:CP,"zh-CN":PP})[e.languageTag??Do()](),MP=()=>"(UTC+5) Ashkhabad",AP=()=>"(UTC+5) 阿什哈巴德",TP=(n={},e={})=>({en:MP,"zh-CN":AP})[e.languageTag??Do()](),LP=()=>"(UTC+6) Almaty",FP=()=>"(UTC+6) 阿拉木图",$P=(n={},e={})=>({en:LP,"zh-CN":FP})[e.languageTag??Do()](),EP=()=>"(UTC+7) Bangkok",NP=()=>"(UTC+7) 曼谷",DP=(n={},e={})=>({en:EP,"zh-CN":NP})[e.languageTag??Do()](),jP=()=>"(UTC+8) Shanghai",RP=()=>"(UTC+8) 上海",BP=(n={},e={})=>({en:jP,"zh-CN":RP})[e.languageTag??Do()](),OP=()=>"(UTC+9) Tokyo",zP=()=>"(UTC+9) 东京",VP=(n={},e={})=>({en:OP,"zh-CN":zP})[e.languageTag??Do()](),WP=()=>"(UTC+10) Sydney",qP=()=>"(UTC+10) 悉尼",HP=(n={},e={})=>({en:WP,"zh-CN":qP})[e.languageTag??Do()](),UP=()=>"(UTC+11) Solomon Islands",GP=()=>"(UTC+11) 所罗门群岛",YP=(n={},e={})=>({en:UP,"zh-CN":GP})[e.languageTag??Do()](),KP=()=>"(UTC+12) Auckland",ZP=()=>"(UTC+12) 奥克兰",XP=(n={},e={})=>({en:KP,"zh-CN":ZP})[e.languageTag??Do()](),Vf=Object.freeze(Object.defineProperty({__proto__:null,AO:H7,BBI:V9,BIAS:o7,BOLL:D9,BRAR:r7,CCI:c7,CR:p7,DMA:_7,DMI:Y7,EMA:T9,EMV:D7,KDJ:X9,MA:I9,MACD:Y9,MTM:$7,OBV:S7,PSY:m7,PVT:V7,ROC:B7,RSI:e7,SAR:B9,SMA:$9,TRIX:x7,VOL:H9,VR:I7,WR:T7,abcd:m9,almaty:$P,any_waves:p9,area:V4,arrow:mC,ashkhabad:TP,auckland:XP,bahrain:SP,bangkok:DP,berlin:xP,cancel:t4,candle_down_stroke:D4,candle_solid:I4,candle_stroke:T4,candle_type:S4,candle_up_stroke:$4,change_:j8,chicago:cP,circle:XC,close_:L8,confirm:J8,day:Ex,days:Tx,dubai:IP,eight_waves:c9,fibonacci_circle:TC,fibonacci_extension:BC,fibonacci_segment:IC,fibonacci_speed_resistance_fan:DC,fibonacci_spiral:$C,five_waves:r9,gann_box:VC,grid_show:m4,guadalcanal:YP,high_:C8,high_price_show:eS,honolulu:eP,horizontal_ray_line:HS,horizontal_segment:YS,horizontal_straight_line:VS,hour:$x,hours:Lx,indicator:uy,indicator_last_value_show:rS,juneau:oP,last_price_show:X4,log:xS,london:_P,los_angeles:rP,low_:M8,low_price_show:oS,mins:B1,minute:Fx,month:Dx,no_data:V8,no_ind_params:Sx,normal:mS,num_bar:Ax,ohlc:B4,open_:w8,parallel_straight_line:SC,parallelogram:YC,param:Ix,percentage:_S,period:R1,price_axis_type:H4,price_channel_line:xC,price_line:_C,ray_line:cC,rect:HC,reset:x4,restore:_4,reverse_coordinate:Y4,sao_paulo:mP,screenshot:p4,search:Cx,segment:pC,setting:K8,settings:Px,shanghai:BP,standard_deviation:Mx,straight_line:rC,strongMagnet:S9,sydney:HP,symbol_search:kx,three_waves:o9,time_:y8,timeframe:xx,timezone:wx,tokyo:VP,toronto:pP,triangle:e9,utc:X7,vertical_ray_line:eC,vertical_segment:oC,vertical_straight_line:XS,volume_:E8,weakMagnet:x9,week:Nx,xabcd:_9},Symbol.toStringTag,{value:"Module"})),JP=["MA","EMA","SMA","BOLL","SAR","BBI"],QP=["VOL","MACD","KDJ","RSI","BIAS","BRAR","CCI","DMI","CR","PSY","TRIX","OBV","VR","WR","MTM","EMV","ROC","PVT","AO"];class jx{constructor(){Ce(this,"editPaneId");Ce(this,"editIndName");Ce(this,"modalIndCfg");Ce(this,"fireOhlcv");Ce(this,"klineLoaded");Ce(this,"cloudIndLoaded");Ce(this,"initDone");Ce(this,"clickChart");Ce(this,"loadingKLine");Ce(this,"loadingPairs");Ce(this,"timeStart");Ce(this,"timeEnd");Ce(this,"allInds");Ce(this,"isApplyingManualStyles");Ce(this,"applyCanvasColors");Ce(this,"clearCciGroups");Ce(this,"clearEmvGroups");Ce(this,"clearMtmGroups");Ce(this,"clearObvGroups");Ce(this,"clearPsyGroups");Ce(this,"clearPvtGroups");Ce(this,"clearRocGroups");Ce(this,"clearVolGroups");Ce(this,"clearWrGroups");this.editPaneId="",this.editIndName="",this.modalIndCfg=!1,this.fireOhlcv=0,this.klineLoaded=0,this.cloudIndLoaded=0,this.initDone=0,this.clickChart=0,this.loadingKLine=!1,this.loadingPairs=!1,this.timeStart=0,this.timeEnd=0,this.allInds=[],this.isApplyingManualStyles=!1,this.clearCciGroups=0,this.clearEmvGroups=0,this.clearMtmGroups=0,this.clearObvGroups=0,this.clearPsyGroups=0,this.clearPvtGroups=0,this.clearRocGroups=0,this.clearVolGroups=0,this.clearWrGroups=0;for(let e of JP){const t=`${e} (${Vf[e]()})`;this.allInds.push({name:e,title:t,cloud:!1,is_main:!0})}for(let e of QP){const t=`${e} (${Vf[e]()})`;this.allInds.push({name:e,title:t,cloud:!1,is_main:!1})}}}class Q0{constructor(){Ce(this,"showDrawBar");Ce(this,"showSidebar");Ce(this,"period");Ce(this,"symbol");Ce(this,"dateStart");Ce(this,"dateEnd");Ce(this,"timezone");Ce(this,"curSymbols");Ce(this,"allSymbols");Ce(this,"allExgs");Ce(this,"colorLong");Ce(this,"colorShort");Ce(this,"saveInds");Ce(this,"key");Ce(this,"theme");Ce(this,"styles");Ce(this,"options");this.showDrawBar=!0,this.showSidebar=!0,this.symbol={name:"Grameen Phone Limited",ticker:"GP",market:"stock",exchange:"DSEBD",type:"stock",priceCurrency:"BDT"},this.period={multiplier:1,timespan:"day",timeframe:"1d",secs:86400};const e=p8();this.dateEnd=sb(e,"YYYYMMDD");const t=e-this.period.secs*1e3*500;this.dateStart=sb(t,"YYYYMMDD"),this.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,this.curSymbols=[],this.allSymbols=[],this.allExgs=new Set,this.colorLong="#0000FF",this.colorShort="#FF0000",this.saveInds={},this.key="",this.theme="dark",this.styles={pane:{backgroundColor:"#070211"},candle:{pane:{backgroundColor:"#070211"},type:"renko_atr",renko:{method:"ATR",atrLength:14,source:"close",wick:!1},pnf:{boxSizeMode:"absolute",boxSize:1,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"}},grid:{horizontal:{color:"#081115"},vertical:{color:"#081115"}}},this.options={enableRealtime:!1}}}function O1(n,e){const t=e.x>n.x?0:1,o=ag.getLinearSlopeIntercept(n,e);let i;o?i=Math.atan(o[0])+Math.PI*t:e.y>n.y?i=Math.PI/2:i=Math.PI/2*3;const r=Uh({x:e.x-8,y:e.y+4},e,i),a=Uh({x:e.x-8,y:e.y-4},e,i);return[{type:"line",attrs:{coordinates:[n,e]}},{type:"line",ignoreEvent:!0,attrs:{coordinates:[r,e,a]}}]}function Uh(n,e,t){const o=(n.x-e.x)*Math.cos(t)-(n.y-e.y)*Math.sin(t)+e.x,i=(n.x-e.x)*Math.sin(t)+(n.y-e.y)*Math.cos(t)+e.y;return{x:o,y:i}}function z1(n,e){if(n.length>1){let t;const o=n[0],i=n[1];return o.x===i.x&&o.y!==i.y?o.y<i.y?t={x:o.x,y:e.height}:t={x:o.x,y:0}:o.x>i.x?t={x:0,y:ag.getLinearYFromCoordinates(o,i,{x:0,y:o.y})}:t={x:e.width,y:ag.getLinearYFromCoordinates(o,i,{x:e.width,y:o.y})},{coordinates:[o,t]}}return[]}function Rx(n,e){const t=Math.abs(n.x-e.x),o=Math.abs(n.y-e.y);return Math.sqrt(t*t+o*o)}function py(n,e,t){let o=2;try{(t==null?void 0:t.isInCandle())??!0?o=2:o=4}catch{o=2}return o}const Bx={name:"arrow",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length>1?O1(n[0],n[1]):[]},Ox={name:"circle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{circle:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:n})=>{if(n.length>1){const e=Rx(n[0],n[1]),t=[];return t.push({type:"circle",attrs:{...n[0],r:e+30},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),t.push({type:"circle",attrs:{...n[0],r:e},styles:{style:"stroke_fill"}}),t}return[]}},zx={name:"rect",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:n})=>{if(n.length>1){const e=[],o=[{x:n[0].x-30,y:n[0].y-30},{x:n[1].x+30,y:n[0].y-30},{x:n[1].x+30,y:n[1].y+30},{x:n[0].x-30,y:n[1].y+30}];return e.push({type:"polygon",attrs:{coordinates:o},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),e.push({type:"polygon",attrs:{coordinates:[n[0],{x:n[1].x,y:n[0].y},n[1],{x:n[0].x,y:n[1].y}]},styles:{style:"stroke_fill"}}),e}return[]}},Vx={name:"parallelogram",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:n})=>{if(n.length===2)return[{type:"line",ignoreEvent:!0,attrs:{coordinates:n}}];if(n.length===3){const e={x:n[0].x+(n[2].x-n[1].x),y:n[2].y};return[{type:"polygon",attrs:{coordinates:[n[0],n[1],n[2],e]},styles:{style:"stroke_fill"}}]}return[]},performEventPressedMove:({points:n,performPointIndex:e,performPoint:t})=>{e<2&&(n[0].price=t.price,n[1].price=t.price)},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].price=t.price)}},Wx={name:"triangle",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:n})=>[{type:"polygon",attrs:{coordinates:n},styles:{style:"stroke_fill"}}]},qx={name:"fibonacciCircle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,overlay:e})=>{var t,o,i,r;if(n.length>1){const a=Math.abs(n[0].x-n[1].x),l=Math.abs(n[0].y-n[1].y),c=Math.sqrt(a*a+l*l),d=[.236,.382,.5,.618,.786,1],p=[],m=[];return d.forEach(h=>{const _=c*h;p.push({...n[0],r:_}),m.push({x:n[0].x,y:n[0].y+_+6,text:`${(h*100).toFixed(1)}%`})}),[{type:"circle",attrs:p,styles:{style:"stroke",borderSize:((o=(t=e.styles)==null?void 0:t.line)==null?void 0:o.size)??2}},{type:"text",ignoreEvent:!0,attrs:m,styles:{color:((r=(i=e.styles)==null?void 0:i.line)==null?void 0:r.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}return[]}},eI=[{value:0,color:"#FF6B6B",visible:!0},{value:.236,color:"#4ECDC4",visible:!0},{value:.382,color:"#45B7D1",visible:!0},{value:.5,color:"#96CEB4",visible:!0},{value:.618,color:"#FFEAA7",visible:!0},{value:1,color:"#98D8C8",visible:!0},{value:1.618,color:"#85C1E9",visible:!0}],Hx={name:"fibonacciSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{line:{size:1,color:"#1e88e5"},polygon:{color:"rgba(30, 136, 229, 0.1)"}},createPointFigures:({chart:n,coordinates:e,overlay:t,yAxis:o})=>{var a,l,c,d,p,m,h,_,w,S,P,I,C;const i=py(n,t,o),r=[];if(e.length>1){const M=t.points,F=(a=M[0])==null?void 0:a.value,V=(l=M[1])==null?void 0:l.value;if(F===void 0||V===void 0)return r;const j=V-F,D=e[0].y,R=e[1].y,W=R-D,Z=(((c=t.extendData)==null?void 0:c.fibonacciLevels)||t.fibonacciLevels||eI).filter(Y=>Y.visible);for(let Y=0;Y<Z.length-1;Y++){const oe=Z[Y],ee=Z[Y+1],re=R-W*oe.value,me=R-W*ee.value;r.push({type:"polygon",attrs:{coordinates:[{x:e[0].x,y:re},{x:e[1].x,y:re},{x:e[1].x,y:me},{x:e[0].x,y:me}]},styles:{style:"fill",color:oe.color+"40"}})}const G=[],se=[];Z.forEach(Y=>{const oe=R-W*Y.value,ee=(V-j*Y.value).toFixed(i);G.push({coordinates:[{x:e[0].x,y:oe},{x:e[1].x,y:oe}]}),se.push({x:e[0].x-8,y:oe,text:`${(Y.value*100).toFixed(1)}% (${ee})`,baseline:"middle",align:"right"})}),r.push({type:"line",attrs:G,styles:{size:((p=(d=t.styles)==null?void 0:d.line)==null?void 0:p.size)||1,color:((h=(m=t.styles)==null?void 0:m.line)==null?void 0:h.color)||"#1e88e5"}}),r.push({type:"text",ignoreEvent:!0,attrs:se,styles:{color:((w=(_=t.styles)==null?void 0:_.text)==null?void 0:w.color)||"#666666",backgroundColor:"transparent"}}),r.push({type:"line",attrs:{coordinates:[e[0],e[1]]},styles:{style:"dashed",size:((P=(S=t.styles)==null?void 0:S.line)==null?void 0:P.size)||1,color:((C=(I=t.styles)==null?void 0:I.line)==null?void 0:C.color)||"#1e88e5"}})}return r}},Ux={name:"fibonacciSpiral",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{if(n.length>1){const t=Rx(n[0],n[1])/Math.sqrt(24),o=n[1].x>n[0].x?0:1,i=ag.getLinearSlopeIntercept(n[0],n[1]);let r;i?r=Math.atan(i[0])+Math.PI*o:n[1].y>n[0].y?r=Math.PI/2:r=Math.PI/2*3;const a=Uh({x:n[0].x-t,y:n[0].y},n[0],r),l=Uh({x:n[0].x-t,y:n[0].y-t},n[0],r),c=[{...a,r:t,startAngle:r,endAngle:r+Math.PI/2},{...l,r:t*2,startAngle:r+Math.PI/2,endAngle:r+Math.PI}];let d=n[0].x-t,p=n[0].y-t;for(let m=2;m<9;m++){const h=c[m-2].r+c[m-1].r;let _=0;switch(m%4){case 0:{_=r,d-=c[m-2].r;break}case 1:{_=r+Math.PI/2,p-=c[m-2].r;break}case 2:{_=r+Math.PI,d+=c[m-2].r;break}case 3:{_=r+Math.PI/2*3,p+=c[m-2].r;break}}const w=_+Math.PI/2,S=Uh({x:d,y:p},n[0],r);c.push({...S,r:h,startAngle:_,endAngle:w})}return[{type:"arc",attrs:c,styles:{size:2}},{type:"line",attrs:z1(n,e),styles:{size:2}}]}return[]}},Gx={name:"fibonacciSpeedResistanceFan",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e,overlay:t})=>{var a,l,c,d,p,m;const o=[];let i=[];const r=[];if(n.length>1){const h=n[1].x>n[0].x?-38:4,_=n[1].y>n[0].y?-2:20,w=n[1].x-n[0].x,S=n[1].y-n[0].y;[1,.75,.618,.5,.382,.25,0].forEach(I=>{const C=n[1].x-w*I,M=n[1].y-S*I;o.push({coordinates:[{x:C,y:n[0].y},{x:C,y:n[1].y}]}),o.push({coordinates:[{x:n[0].x,y:M},{x:n[1].x,y:M}]}),i=i.concat(z1([n[0],{x:C,y:n[1].y}],e)),i=i.concat(z1([n[0],{x:n[1].x,y:M}],e)),r.unshift({x:n[0].x+h,y:M+10,text:`${I.toFixed(3)}`}),r.unshift({x:C-18,y:n[0].y+_,text:`${I.toFixed(3)}`})})}return[{type:"line",attrs:o,styles:{size:((l=(a=t.styles)==null?void 0:a.line)==null?void 0:l.size)??2}},{type:"line",attrs:i,styles:{size:((d=(c=t.styles)==null?void 0:c.line)==null?void 0:d.size)??2}},{type:"text",ignoreEvent:!0,attrs:r,styles:{color:((m=(p=t.styles)==null?void 0:p.line)==null?void 0:m.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}},Yx={name:"fibonacciExtension",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:n,coordinates:e,overlay:t,yAxis:o})=>{var l,c,d,p,m,h;const i=py(n,t,o),r=[],a=[];if(e.length>2){const _=t.points,w=_[1].value-_[0].value,S=e[1].y-e[0].y,P=[0,.236,.382,.5,.618,.786,1,1.618,2.618],C=Math.min(e[1].x,e[2].x)-16;P.forEach(M=>{const F=e[2].y+S*M,V=(_[2].value+w*M).toFixed(i);r.push({coordinates:[{x:e[1].x,y:F},{x:e[2].x,y:F}]}),a.push({x:C,y:F,text:`${V} (${(M*100).toFixed(1)}%)`,baseline:"middle",align:"right"})})}return[{type:"line",attrs:{coordinates:e},styles:{style:"dashed",size:((c=(l=t.styles)==null?void 0:l.line)==null?void 0:c.size)??2}},{type:"line",attrs:r,styles:{size:((p=(d=t.styles)==null?void 0:d.line)==null?void 0:p.size)??2}},{type:"text",ignoreEvent:!0,attrs:a,styles:{color:((h=(m=t.styles)==null?void 0:m.line)==null?void 0:h.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}},Kx={name:"gannBox",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:n,overlay:e})=>{var t,o,i,r;if(n.length>1){const a=(n[1].y-n[0].y)/4,l=n[1].x-n[0].x,c=[{coordinates:[n[0],{x:n[1].x,y:n[1].y-a}]},{coordinates:[n[0],{x:n[1].x,y:n[1].y-a*2}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[1].x,y:n[0].y+a}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[1].x,y:n[0].y+a*2}]},{coordinates:[{...n[0]},{x:n[0].x+l*.236,y:n[1].y}]},{coordinates:[{...n[0]},{x:n[0].x+l*.5,y:n[1].y}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[0].x+l*.236,y:n[0].y}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[0].x+l*.5,y:n[0].y}]}],d=[{coordinates:[n[0],n[1]]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[1].x,y:n[0].y}]}];return[{type:"line",attrs:[{coordinates:[n[0],{x:n[1].x,y:n[0].y}]},{coordinates:[{x:n[1].x,y:n[0].y},n[1]]},{coordinates:[n[1],{x:n[0].x,y:n[1].y}]},{coordinates:[{x:n[0].x,y:n[1].y},n[0]]}]},{type:"polygon",ignoreEvent:!0,attrs:{coordinates:[n[0],{x:n[1].x,y:n[0].y},n[1],{x:n[0].x,y:n[1].y}]},styles:{style:"fill"}},{type:"line",attrs:c,styles:{style:"dashed",size:((o=(t=e.styles)==null?void 0:t.line)==null?void 0:o.size)??1}},{type:"line",attrs:d,styles:{size:((r=(i=e.styles)==null?void 0:i.line)==null?void 0:r.size)??1}}]}return[]}},Zx={name:"threeWaves",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const e=n.map((t,o)=>({...t,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:e}]}},Xx={name:"fiveWaves",totalStep:7,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const e=n.map((t,o)=>({...t,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:e}]}},Jx={name:"eightWaves",totalStep:10,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const e=n.map((t,o)=>({...t,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:e}]}},Qx={name:"anyWaves",totalStep:Number.MAX_SAFE_INTEGER,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const e=n.map((t,o)=>({...t,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:e}]}},ew={name:"abcd",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{let e=[],t=[];const o=["A","B","C","D"],i=n.map((r,a)=>({...r,baseline:"bottom",text:`(${o[a]})`}));return n.length>2&&(e=[n[0],n[2]],n.length>3&&(t=[n[1],n[3]])),[{type:"line",attrs:{coordinates:n}},{type:"line",attrs:[{coordinates:e},{coordinates:t}],styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:i}]}},tw={name:"xabcd",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:n,overlay:e})=>{const t=[],o=[],i=["X","A","B","C","D"],r=n.map((a,l)=>({...a,baseline:"bottom",text:`(${i[l]})`}));return n.length>2&&(t.push({coordinates:[n[0],n[2]]}),o.push({coordinates:[n[0],n[1],n[2]]}),n.length>3&&(t.push({coordinates:[n[1],n[3]]}),n.length>4&&(t.push({coordinates:[n[2],n[4]]}),o.push({coordinates:[n[2],n[3],n[4]]})))),[{type:"line",attrs:{coordinates:n}},{type:"line",attrs:t,styles:{style:"dashed"}},{type:"polygon",ignoreEvent:!0,attrs:o},{type:"text",ignoreEvent:!0,attrs:r}]}};function tI(n,e,t,o){const i=e==="bottom"?1:-1,r=n.x,a=r+200,l=n.y+3*i,c=l+50*i,d=c+5*i,p=o?{color:o}:{},m=o?{backgroundColor:o,borderColor:o}:{};return[{type:"line",attrs:{coordinates:[{x:r,y:l},{x:r,y:c}]},ignoreEvent:!0},{type:"line",attrs:{coordinates:[{x:r,y:n.y},{x:a,y:n.y}]},ignoreEvent:!0,styles:{...p}},{type:"polygon",attrs:{coordinates:[{x:r,y:c},{x:r-4,y:d},{x:r+4,y:d}]},ignoreEvent:!0,styles:p},{type:"rectText",attrs:{x:r,y:d,text:t??"",align:"center",baseline:"bottom"},ignoreEvent:!0,styles:m}]}const nw={name:"barSignal",totalStep:2,createPointFigures:({overlay:n,coordinates:e})=>{let{postion:t,text:o,bgColor:i}=n.extendData,r=[];return e.forEach(a=>{r.push(...tI(a,t,o,i))}),r}};function nI(n){let i=[];if(n>86400){const r=Math.floor(n/86400);i.push(r.toString(),Tx()),n=n%86400}if(n>3600){const r=Math.floor(n/3600);i.push(r.toString(),Lx()),n=n%3600}if(n>60){const r=Math.floor(n/60);i.push(r.toString(),B1()),n=n%60}return n>0&&i.push("1",B1()),i.join("")}const ow={name:"ruler",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},onDeselected:n=>{var e;return(e=n.chart)==null||e.removeOverlay({id:n.overlay.id}),!0},createPointFigures:({chart:n,coordinates:e,overlay:t,yAxis:o})=>{const i=py(n,t,o);if(e.length>1){const r=e[0],a=e[1],l=(r.x+a.x)/2,c=(r.y+a.y)/2,d=O1({x:l,y:r.y},{x:l,y:a.y}),p=O1({x:r.x,y:c},{x:a.x,y:c}),m=r.y>a.y?"#F7525F":"#2962FF",h={color:"#ffffff",backgroundColor:m,borderColor:m,paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},_=t.points,w=_[0].value-_[1].value,S=w.toFixed(i),P=(w/_[0].value*100).toFixed(2),I=_[1].dataIndex-_[0].dataIndex,C=(_[1].timestamp-_[0].timestamp)/1e3,M=`${S} (${P}%)
${I}${Ax()}, ${nI(C)}`;let F=a.y+10,V="top";r.y>a.y&&(F=a.y-10,V="bottom");const j=[],D=30,R=[{x:r.x-D,y:r.y-D},{x:a.x+D,y:r.y-D},{x:a.x+D,y:a.y+D},{x:r.x-D,y:a.y+D}];return j.push({type:"polygon",attrs:{coordinates:R},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),j.push({type:"polygon",attrs:{coordinates:[r,{x:a.x,y:r.y},a,{x:r.x,y:a.y}]},styles:{style:"stroke_fill"}}),j.push({type:"textBox",attrs:{x:l,y:F,text:M,align:"center",baseline:V},ignoreEvent:!0,styles:h}),j.push(...d),j.push(...p),j}return[]}},ab={color:"#ffffff",paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},sw={name:"trade",lock:!0,totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,overlay:e})=>{if(n.length<=1)return[];const t=e.extendData,o=n[0],i=n[1],r={size:.5};t&&t.line_color&&(r.color=t.line_color);const a=[],l={type:"line",attrs:{coordinates:[o,i]},styles:{color:"transparent",size:40},ignoreEvent:!1};a.push(l);const c={type:"line",attrs:{coordinates:[o,i]},styles:r};if(a.push(c),!t.active&&!t.selected)return a;const d=t.distance??15;let p="bottom",m=o.y-d,h="top",_=i.y+d;o.y>i.y&&(p="top",m=o.y+d,h="bottom",_=i.y-d);const w={type:"textBox",attrs:{x:o.x,y:m,text:t.in_text,align:"center",baseline:p},ignoreEvent:!0,styles:{...ab,backgroundColor:t.in_color,borderColor:t.in_color}},S={type:"textBox",attrs:{x:i.x,y:_,text:t.out_text,align:"center",baseline:h},ignoreEvent:!0,styles:{...ab,backgroundColor:t.out_color,borderColor:t.out_color}},P={type:"line",attrs:{coordinates:[o,{x:o.x,y:m}]},ignoreEvent:!0,styles:r},I={type:"line",attrs:{coordinates:[i,{x:i.x,y:_}]},ignoreEvent:!0,styles:r};return[l,c,w,S,P,I]},onSelected:n=>{const e=n.overlay.extendData;return e.selected=!0,!1},onDeselected:n=>{const e=n.overlay.extendData;return e.selected=!1,!1},onMouseEnter:n=>{const e=n.overlay.extendData;return e.active=!0,!1},onMouseLeave:n=>{const e=n.overlay.extendData;return e.active=!1,!1}},oI={color:"#ffffff",paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},iw={name:"note",lock:!0,totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,overlay:e})=>{if(n.length==0)return[];const t=e.extendData,o=n[0],i={size:.5};t&&t.line_color&&(i.color=t.line_color);const r=t.distance??15;let a="bottom",l=o.y-r;const c={type:"textBox",attrs:{x:o.x,y:l,text:t.in_text,align:"center",baseline:a},ignoreEvent:!0,styles:{...oI,backgroundColor:t.in_color,borderColor:t.in_color}},d={type:"line",attrs:{coordinates:[o,{x:o.x,y:l}]},ignoreEvent:!0,styles:i};return[c,d]}},rw={name:"emoji",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,styles:{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}},createPointFigures:({coordinates:n,overlay:e})=>{if(n.length===0)return[];const t=e.extendData;if(!t||!t.emoji)return[];const o=n[0],i=t.size||24;t.rotation;const r=t.selected||!1;t.active;const a=[],l=e.styles||{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}},c={type:"text",attrs:{x:o.x,y:o.y,text:t.emoji,align:"center",baseline:"middle"},styles:{size:i,family:"Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, sans-serif",weight:"normal",backgroundColor:"transparent"}};if(a.push(c),r){const d=i/2,p=4,m={type:"rect",attrs:{x:o.x-d-p,y:o.y-d-p,width:i+p*2,height:i+p*2},styles:{stroke:l.box.stroke,strokeWidth:l.box.width,fill:"transparent",backgroundColor:"transparent"}};a.push(m);const h=l.handles.size,_=d+p;[{x:o.x-_-h/2,y:o.y-_-h/2},{x:o.x+_-h/2,y:o.y-_-h/2},{x:o.x-_-h/2,y:o.y+_-h/2},{x:o.x+_-h/2,y:o.y+_-h/2}].forEach(S=>{const P={type:"rect",attrs:{x:S.x,y:S.y,width:h,height:h},styles:{fill:l.handles.fill,stroke:l.handles.stroke,strokeWidth:1,backgroundColor:"transparent"}};a.push(P)})}return a},onDrawStart:n=>!0,onDrawing:n=>!0,onDrawEnd:n=>!0,onPressedMoveStart:n=>!0,onPressedMoving:n=>!0,onPressedMoveEnd:n=>!0,onSelected:n=>{const e=n.overlay.extendData;return e&&(e.selected=!0),!1},onDeselected:n=>{const e=n.overlay.extendData;return e&&(e.selected=!1),!1},onMouseEnter:n=>{const e=n.overlay.extendData;return e&&(e.active=!0),!1},onMouseLeave:n=>{const e=n.overlay.extendData;return e&&(e.active=!1),!1}},Pg="Add text";class sI{constructor(){Ce(this,"editor",null);Ce(this,"chart",null);Ce(this,"overlay",null);Ce(this,"pos",{x:0,y:0});Ce(this,"raf",null);Ce(this,"lastCommitted","");Ce(this,"boundPointerHandler",null);Ce(this,"boundKeydownShield",null);Ce(this,"placeholderCssInjected",!1)}startEditing(e,t){var o;this.chart=e,this.overlay=t,this.lastCommitted=((o=t.extendData)==null?void 0:o.text)??"",this.ensureEditor(),this.updateOverlayEditing(!0),this.syncPosition(),this.addOutsideListeners(),this.addKeydownShield(),setTimeout(()=>{var a,l;(a=this.editor)==null||a.focus();const i=((l=t.extendData)==null?void 0:l.text)??"",r=!i||i===Pg;this.editor&&(this.editor.innerText=r?"":i,this.editor.setAttribute("data-placeholder",Pg),this.editor.classList.add("kc-inline-text-editor"),this.injectPlaceholderCss());try{const c=window.getSelection();if(c&&this.editor){const d=this.editor.innerText.length;this.editor.firstChild&&c.collapse(this.editor.firstChild,Math.min(d,(this.editor.firstChild.textContent||"").length))}}catch{}},0),this.loop()}reEdit(e,t){this.startEditing(e,t)}updateEditorStyle(e){e&&(this.overlay=e),this.applyStylesFromOverlay()}ensureEditor(){if(this.editor)return;const e=document.createElement("div");e.contentEditable="true",e.style.position="fixed",e.style.zIndex="10000",e.style.outline="none",e.style.padding="8px",e.style.whiteSpace="pre-wrap",e.style.wordBreak="break-word",e.style.userSelect="text",e.style.transform="translate(0, -50%)",e.style.boxSizing="border-box",e.addEventListener("keydown",t=>this.onKeyDown(t)),e.addEventListener("input",()=>this.onInput()),e.addEventListener("blur",()=>this.commit()),document.body.appendChild(e),this.editor=e,this.applyStylesFromOverlay()}applyStylesFromOverlay(){var c;if(!this.editor||!this.overlay)return;const e=this.overlay.extendData||{},t=((c=this.overlay.styles)==null?void 0:c.text)||{},o=e.fontSize??t.size??32,i=e.fontWeight??t.weight??"bold",r=e.textColor??t.color??"#FFFFFF",a=e.backgroundColor??t.backgroundColor??"#00000033",l=e.fontFamily??t.family??'system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif';this.editor.style.fontSize=`${o}px`,this.editor.style.lineHeight=`${Math.round(o*1.4)}px`,this.editor.style.fontWeight=i,this.editor.style.color=r,this.editor.style.background=a,this.editor.style.border="none",this.editor.style.fontFamily=l,this.editor.style.minWidth="0px",this.editor.style.minHeight=`${Math.round(o*1.4)}px`}loop(){this.raf&&cancelAnimationFrame(this.raf);const e=()=>{this.syncPosition(),this.raf=requestAnimationFrame(e)};this.raf=requestAnimationFrame(e)}syncPosition(){var o;if(!this.chart||!this.overlay||!((o=this.overlay.points)!=null&&o.length))return;const e=this.overlay.paneId||"candle_pane",t=this.chart.convertToPixel(this.overlay.points[0],{paneId:e});t&&typeof t.x=="number"&&typeof t.y=="number"&&(this.pos={x:t.x,y:t.y},this.editor&&(this.editor.style.left=`${this.pos.x}px`,this.editor.style.top=`${this.pos.y}px`))}addOutsideListeners(){if(this.boundPointerHandler)return;const e=t=>{const o=t.target;if(!this.editor||o&&this.editor.contains(o))return;const i=o;i&&(i.closest(".context-menu-container")||i.closest(".premium-submenu"))||this.finishFromOutside()};this.boundPointerHandler=e,document.addEventListener("pointerdown",e,{capture:!0}),document.addEventListener("touchstart",e,{capture:!0}),document.addEventListener("mousedown",e,{capture:!0})}removeOutsideListeners(){this.boundPointerHandler&&(document.removeEventListener("pointerdown",this.boundPointerHandler,{capture:!0}),document.removeEventListener("touchstart",this.boundPointerHandler,{capture:!0}),document.removeEventListener("mousedown",this.boundPointerHandler,{capture:!0}),this.boundPointerHandler=null)}addKeydownShield(){if(this.boundKeydownShield)return;const e=t=>{if(!this.editor)return;const o=t.target;o&&(o===this.editor||this.editor.contains(o))&&t.stopPropagation()};this.boundKeydownShield=e,document.addEventListener("keydown",e,{capture:!0})}removeKeydownShield(){this.boundKeydownShield&&(document.removeEventListener("keydown",this.boundKeydownShield,{capture:!0}),this.boundKeydownShield=null)}finishFromOutside(){if(!this.editor)return;const e=this.editor.innerText||"";try{this.editor.blur()}catch{}!e||e===Pg?this.deleteOverlay():this.commit()}onKeyDown(e){var t;if(e.stopPropagation(),e.key==="Escape"){e.preventDefault();const o=(((t=this.editor)==null?void 0:t.innerText)||"").trim();!o||o===Pg?this.deleteOverlay():this.revert()}e.key==="Backspace"||e.key==="Delete"||e.key}onInput(){if(!this.editor||!this.chart||!this.overlay)return;this.editor.innerText.length>0?this.editor.setAttribute("data-placeholder",Pg):this.editor.setAttribute("data-placeholder",Pg);const e=Math.max(12,this.editor.scrollWidth),t=Math.max(this.editor.scrollHeight,Math.round(parseInt(this.editor.style.lineHeight)||32)),o=getComputedStyle(this.editor),i=parseFloat(o.paddingLeft||"0")+parseFloat(o.paddingRight||"0"),r=parseFloat(o.paddingTop||"0")+parseFloat(o.paddingBottom||"0"),a=Math.max(0,e-i),l=Math.max(0,t-r),c={...this.overlay.extendData||{},text:this.editor.innerText,boxWidth:e,boxHeight:t,contentWidth:a,contentHeight:l};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:c})}catch{}}updateOverlayEditing(e){if(!this.chart||!this.overlay)return;const t={...this.overlay.extendData||{},editing:e};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:t})}catch{}}commit(){var c;if(!this.chart||!this.overlay){this.cleanup();return}const e=((c=this.editor)==null?void 0:c.innerText)||"";if(!e||e===Pg){this.deleteOverlay();return}this.lastCommitted=e;const t=this.editor?Math.max(12,this.editor.scrollWidth):void 0,o=this.editor?Math.max(this.editor.scrollHeight,Math.round(parseInt(this.editor.style.lineHeight)||32)):void 0,i=this.editor?getComputedStyle(this.editor):null,r=i?parseFloat(i.paddingLeft||"0")+parseFloat(i.paddingRight||"0"):0,a=i?parseFloat(i.paddingTop||"0")+parseFloat(i.paddingBottom||"0"):0,l={...this.overlay.extendData||{},text:e,editing:!1,...t?{boxWidth:t}:{},...o?{boxHeight:o}:{},...t?{contentWidth:Math.max(0,t-r)}:{},...o?{contentHeight:Math.max(0,o-a)}:{}};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:l})}catch{}this.cleanup()}revert(){if(!this.chart||!this.overlay){this.cleanup();return}const e={...this.overlay.extendData||{},text:this.lastCommitted,editing:!1};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:e})}catch{}this.cleanup()}deleteOverlay(){var e;if(!this.chart||!this.overlay){this.cleanup();return}try{(e=this.editor)==null||e.blur()}catch{}try{this.chart.removeOverlay({id:this.overlay.id})}catch{}this.cleanup()}cleanup(){if(this.raf&&cancelAnimationFrame(this.raf),this.raf=null,this.overlay=null,this.removeOutsideListeners(),this.removeKeydownShield(),this.editor)try{this.editor.remove()}catch{}this.editor=null}getEditorRect(){try{return this.editor?this.editor.getBoundingClientRect():null}catch{return null}}injectPlaceholderCss(){if(!this.placeholderCssInjected)try{const e="kc-inline-text-editor-placeholder-style";if(document.getElementById(e)){this.placeholderCssInjected=!0;return}const t=document.createElement("style");t.id=e,t.textContent=`
        .kc-inline-text-editor:empty::before {
          content: attr(data-placeholder);
          color: rgba(255,255,255,0.6);
        }
      `,document.head.appendChild(t),this.placeholderCssInjected=!0}catch{}}}const Kg=new sI,lb="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif",aw={name:"text",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,zLevel:100,styles:{text:{color:"#FFFFFF",backgroundColor:"#00000033",borderColor:"#1677FF",size:32,weight:"bold",family:lb,paddingLeft:8,paddingRight:8,paddingTop:8,paddingBottom:8,borderSize:1},box:{stroke:"#1677FF",width:1,fill:"transparent"},handles:{size:6,fill:"#1677FF",stroke:"#1677FF"}},createPointFigures:({coordinates:n,overlay:e})=>{var oe,ee,re,me,K,ye,Me,Fe,Ze,Ge,it,Ye,ct,kt,ft,bt,nt,Pt;if(n.length===0)return[];const t=n[0],o=e.extendData||{},i=!!o.editing,r=o.text??"",a=o.fontSize??((ee=(oe=e.styles)==null?void 0:oe.text)==null?void 0:ee.size)??32,l=o.fontWeight??((me=(re=e.styles)==null?void 0:re.text)==null?void 0:me.weight)??"bold",c=o.fontFamily??((ye=(K=e.styles)==null?void 0:K.text)==null?void 0:ye.family)??lb,d=o.textColor??((Fe=(Me=e.styles)==null?void 0:Me.text)==null?void 0:Fe.color)??"#FFFFFF",p=o.backgroundColor??((Ge=(Ze=e.styles)==null?void 0:Ze.text)==null?void 0:Ge.backgroundColor)??"#00000033",m=((Ye=(it=e.styles)==null?void 0:it.text)==null?void 0:Ye.paddingLeft)??8,h=((kt=(ct=e.styles)==null?void 0:ct.text)==null?void 0:kt.paddingRight)??8,_=((bt=(ft=e.styles)==null?void 0:ft.text)==null?void 0:bt.paddingTop)??4,w=((Pt=(nt=e.styles)==null?void 0:nt.text)==null?void 0:Pt.paddingBottom)??4;if(i)return[];if(!(r&&r.length>0&&r!=="Add text"))return[];const P=Math.round(a*1.4),I=String(r).split(/\r?\n/),C=I.map(Qe=>ag.calcTextWidth(Qe,a,l,c)),F=C.length?Math.max(...C):ag.calcTextWidth(r,a,l,c),V=(I.length||1)*P,j=F+m+h,D=V+_+w,R=j,W=D,J=t.x,Z=t.y-Math.round(W/2),G=[];G.push({type:"rect",attrs:{x:J,y:Z,width:R,height:W},styles:{style:Yg.Fill,color:p,borderColor:"transparent",borderSize:0}});const se=J+Math.round(R/2),Y=Z+_+Math.round(P/2);return I.forEach((Qe,yt)=>{const xe=Y+yt*P;G.push({type:"text",attrs:{x:se,y:xe,text:Qe,align:"center",baseline:"middle"},styles:{size:a,family:c,weight:l,color:d,backgroundColor:"transparent"}})}),G},onSelected:n=>{var t;const e=n.overlay.extendData||{};e.selected=!0,(t=n.chart)==null||t.overrideOverlay({id:n.overlay.id,extendData:e});try{typeof navigator<"u"&&(navigator.maxTouchPoints||0)>0&&n.chart&&Kg.startEditing(n.chart,n.overlay)}catch{}return!0},onDeselected:n=>{var t;const e=n.overlay.extendData||{};return e.selected=!1,(t=n.chart)==null||t.overrideOverlay({id:n.overlay.id,extendData:e}),!0},onPressedMoveStart:n=>{const e=n.overlay.extendData||{};if(e.editing||n.overlay.lock)return!1;const t=n.overlay.paneId;try{const o=n.chart.convertToPixel(n.overlay.points[0],{paneId:t});o&&typeof n.x=="number"&&typeof n.y=="number"&&(e.__dragOffX=n.x-(o.x||0),e.__dragOffY=n.y-(o.y||0),n.chart.overrideOverlay({id:n.overlay.id,extendData:e}))}catch{}return!0},onPressedMoving:n=>{const e=n.overlay.extendData||{};if(e.editing||n.overlay.lock)return!1;const t=e.__dragOffX||0,o=e.__dragOffY||0,i=n.overlay.paneId;if(typeof n.x!="number"||typeof n.y!="number")return!0;const r=n.x-t,a=n.y-o;try{const l=n.chart.convertFromPixel([{x:r,y:a}],{paneId:i}),c=Array.isArray(l)?l[0]:l;c&&n.chart.overrideOverlay({id:n.overlay.id,points:[{timestamp:c.timestamp,value:c.value}]})}catch{}return!0},onPressedMoveEnd:n=>{const e=n.overlay.extendData||{};if(e.editing||n.overlay.lock)return!1;if("__dragOffX"in e||"__dragOffY"in e){delete e.__dragOffX,delete e.__dragOffY;try{n.chart.overrideOverlay({id:n.overlay.id,extendData:e})}catch{}}return!0}};function iI(n,e){if(n.length>0){const t=n[0].y;return{coordinates:[{x:0,y:t},{x:e.width,y:t}]}}return{coordinates:[]}}function rI(n,e){if(n.length>1){const t=n[0].y,o=n[0],i=n[1];return o.x>i.x?{coordinates:[{x:0,y:t},o]}:{coordinates:[o,{x:e.width,y:t}]}}return{coordinates:[]}}const lw={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:({coordinates:n,overlay:e,bounding:t})=>{var a,l,c;if(n.length<1)return[];console.log("horizontalStraightLine createPointFigures called",{overlayId:e.id,hasExtendData:!!e.extendData,extendData:e.extendData,selected:e.selected===!0}),!e.extendData||typeof e.extendData!="object"?e.extendData={showDot:!1}:"showDot"in e.extendData||(e.extendData.showDot=!1);const o=e.extendData,i=[],r=iI(n,t);if(r.coordinates.length>0){i.push({type:"line",attrs:r,styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),i.push({type:"line",attrs:r});const d=e.selected===!0;if(o.showDot||d){const p=t.width/2,m=n[0].y,h=((l=(a=e.styles)==null?void 0:a.line)==null?void 0:l.color)||((c=e.styles)==null?void 0:c.color)||"#1677FF";console.log("Drawing dot for horizontalStraightLine:",{x:p,y:m,showDot:o.showDot,selected:d,color:h}),i.push({type:"circle",attrs:{x:p,y:m,r:6},styles:{style:"fill",color:h}}),i.push({type:"circle",attrs:{x:p,y:m,r:7},styles:{style:"stroke",color:"#ffffff",borderSize:2}})}}return i},createYAxisFigures:({chart:n,overlay:e,coordinates:t,yAxis:o,bounding:i})=>{var F,V,j,D,R,W;if(t.length<1||!e.points||e.points.length<1)return[];const r=(F=e.points[0])==null?void 0:F.value;if(r===void 0)return[];const a=n.getStyles(),l=a.yAxis,c=l.axisLine.show?l.axisLine.size:0,d=l.tickLine.show?l.tickLine.length:0,p=l.tickText.marginStart,m=l.tickText.marginEnd,h=1,w={...a.crosshair.horizontal.text};let S=0,P="left";if((V=o==null?void 0:o.isFromZero)!=null&&V.call(o))S=c+h,P="left",w.paddingLeft=d+p-h;else{S=((i==null?void 0:i.width)??0)-c-h,P="right";const J=((i==null?void 0:i.width)??0)-c-h,Z=((i==null?void 0:i.width)??0)-(l.axisLine.show?l.axisLine.size:0)-(l.tickLine.show?l.tickLine.length:0)-m;w.paddingRight=J-Z}const I=o.getRange();let C=o.displayValueToText(o.realValueToDisplayValue(o.valueToRealValue(r,{range:I}),{range:I}),((j=n.getSymbol())==null?void 0:j.pricePrecision)??2);C=n.getDecimalFold().format(n.getThousandsSeparator().format(C));const M=((R=(D=e.styles)==null?void 0:D.line)==null?void 0:R.color)||((W=e.styles)==null?void 0:W.color)||"#1677FF";return[{type:"text",attrs:{x:S,y:t[0].y,text:C,align:P,baseline:"middle"},styles:{...w,backgroundColor:M},ignoreEvent:!0}]},onClick:n=>{console.log("🟢 horizontalStraightLine onClick called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!e.showDot,console.log("✅ Toggled showDot to:",e.showDot,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onSelected:n=>{console.log("🟢 horizontalStraightLine onSelected called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!0,console.log("✅ Set showDot to true:",e,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onDeselected:n=>{console.log("🔴 horizontalStraightLine onDeselected called"),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!1,n.chart&&n.chart.overrideOverlay({id:n.overlay.id,extendData:e}),!0}},cw={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:({coordinates:n,overlay:e,bounding:t})=>{var a,l,c;if(n.length<2)return[];console.log("horizontalRayLine createPointFigures called",{overlayId:e.id,hasExtendData:!!e.extendData,extendData:e.extendData,selected:e.selected===!0}),!e.extendData||typeof e.extendData!="object"?e.extendData={showDot:!1}:"showDot"in e.extendData||(e.extendData.showDot=!1);const o=e.extendData,i=[],r=rI(n,t);if(r.coordinates.length>0){i.push({type:"line",attrs:r,styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),i.push({type:"line",attrs:r});const d=e.selected===!0;if(o.showDot||d){const p=n[0].x,m=n[0].y,h=((l=(a=e.styles)==null?void 0:a.line)==null?void 0:l.color)||((c=e.styles)==null?void 0:c.color)||"#1677FF";console.log("Drawing dot for horizontalRayLine:",{x:p,y:m,showDot:o.showDot,selected:d,color:h}),i.push({type:"circle",attrs:{x:p,y:m,r:6},styles:{style:"fill",color:h}}),i.push({type:"circle",attrs:{x:p,y:m,r:7},styles:{style:"stroke",color:"#ffffff",borderSize:2}})}}return i},createYAxisFigures:({chart:n,overlay:e,coordinates:t,yAxis:o,bounding:i})=>{var F,V,j,D,R,W;if(t.length<1||!e.points||e.points.length<1)return[];const r=(F=e.points[0])==null?void 0:F.value;if(r===void 0)return[];const a=n.getStyles(),l=a.yAxis,c=l.axisLine.show?l.axisLine.size:0,d=l.tickLine.show?l.tickLine.length:0,p=l.tickText.marginStart,m=l.tickText.marginEnd,h=1,w={...a.crosshair.horizontal.text};let S=0,P="left";if((V=o==null?void 0:o.isFromZero)!=null&&V.call(o))S=c+h,P="left",w.paddingLeft=d+p-h;else{S=((i==null?void 0:i.width)??0)-c-h,P="right";const J=((i==null?void 0:i.width)??0)-c-h,Z=((i==null?void 0:i.width)??0)-(l.axisLine.show?l.axisLine.size:0)-(l.tickLine.show?l.tickLine.length:0)-m;w.paddingRight=J-Z}const I=o.getRange();let C=o.displayValueToText(o.realValueToDisplayValue(o.valueToRealValue(r,{range:I}),{range:I}),((j=n.getSymbol())==null?void 0:j.pricePrecision)??2);C=n.getDecimalFold().format(n.getThousandsSeparator().format(C));const M=((R=(D=e.styles)==null?void 0:D.line)==null?void 0:R.color)||((W=e.styles)==null?void 0:W.color)||"#1677FF";return[{type:"text",attrs:{x:S,y:t[0].y,text:C,align:P,baseline:"middle"},styles:{...w,backgroundColor:M},ignoreEvent:!0}]},onClick:n=>{console.log("🟢 horizontalRayLine onClick called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!e.showDot,console.log("✅ Toggled showDot to:",e.showDot,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onSelected:n=>{console.log("🟢 horizontalRayLine onSelected called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!0,console.log("✅ Set showDot to true:",e,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onDeselected:n=>{console.log("🔴 horizontalRayLine onDeselected called"),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!1,n.chart&&n.chart.overrideOverlay({id:n.overlay.id,extendData:e}),!0}};function aI(n,e,t,o,i,r,a){const l=o*.4,c=i*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.lineJoin="round",n.beginPath(),n.moveTo(e-l,t-c),n.lineTo(e+l,t+c),n.moveTo(e+l,t-c),n.lineTo(e-l,t+c),n.stroke(),n.restore()}function lI(n,e,t,o,i,r,a){const l=o*.4,c=i*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.beginPath(),n.ellipse(e,t,l,c,0,0,Math.PI*2),n.stroke(),n.restore()}const dw={name:"pointAndFigure",totalStep:0,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:()=>[],draw:n=>{var I,C,M;const{ctx:e,chart:t,bounding:o,xAxis:i,yAxis:r,overlay:a}=n;if(!t||!e||!(i!=null&&i.convertToPixel)||!(r!=null&&r.convertToPixel))return[];const l=(I=t.getVisibleRange)==null?void 0:I.call(t);if(!l)return[];const c=((C=t.getDataList)==null?void 0:C.call(t))||[];if(c.length===0)return[];const d=i.convertToPixel(0),p=i.convertToPixel(1),m=Math.max(1,Math.abs(p-d));let h=m;for(let F=l.from;F<=l.to&&F<c.length;F++){const V=(M=c[F])==null?void 0:M._pnf;if(V!=null&&V.boxes&&V.boxes.length>=2){const j=r.convertToPixel(V.boxes[0].price),D=r.convertToPixel(V.boxes[1].price);if(j!==void 0&&D!==void 0&&!isNaN(j)&&!isNaN(D)){const R=Math.abs(j-D);if(R>0){h=R;break}}}}const _=m*.85,w=h*.85,S=(_+w)/2,P=Math.max(.8,S*.08);for(let F=l.from;F<=l.to&&F<c.length;F++){const V=c[F];if(!V)continue;const j=V==null?void 0:V._pnf;if(!j||!j.boxes)continue;const{direction:D,boxes:R,upColor:W="#00E6D8",downColor:J="#FF4D4D"}=j,Z=i.convertToPixel(F);if(!(Z==null||isNaN(Z)))for(const G of R){const se=r.convertToPixel(G.price);se==null||isNaN(se)||(D==="up"?aI(e,Z,se,_,w,W,P):lI(e,Z,se,_,w,J,P))}}return[]}},uw={name:"script-layer",totalStep:0,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,styles:{},createPointFigures:()=>[]},cI=[Bx,Ox,zx,Wx,Vx,qx,Hx,Ux,Gx,Yx,Kx,Zx,Xx,Jx,Qx,ew,tw,nw,ow,sw,iw,rw,aw,lw,cw,dw,uw],dI={arrow:Bx,circle:Ox,rect:zx,triangle:Wx,parallelogram:Vx,fibonacciCircle:qx,fibonacciSegment:Hx,fibonacciSpiral:Ux,fibonacciSpeedResistanceFan:Gx,fibonacciExtension:Yx,gannBox:Kx,threeWaves:Zx,fiveWaves:Xx,eightWaves:Jx,anyWaves:Qx,abcd:ew,xabcd:tw,barSignal:nw,ruler:ow,trade:sw,note:iw,emoji:rw,text:aw,horizontalStraightLine:lw,horizontalRayLine:cw,pointAndFigure:dw,scriptLayer:uw};function pw(n,e,t){const{size:o=12,paddingLeft:i=0,paddingTop:r=0,paddingRight:a=0,paddingBottom:l=0}=e,{x:c,y:d,text:p,align:m="left",baseline:h="top"}=n;t=t??o*p.length;let _;switch(m){case"left":case"start":{_=c;break}case"right":case"end":{_=c-a-t-i;break}default:{_=c-t/2-i;break}}return _}function vw(n,e,t,o,i){const{size:r=12,paddingLeft:a=0,paddingTop:l=0,paddingRight:c=0,paddingBottom:d=0}=e,{x:p,y:m,text:h,align:_="left",baseline:w="top"}=n,S=h.length;t=t??r*S,o=o??1,i=i??1.5;const P=r*o*i-(i-1)*r,I=pw(n,e,t);let C;switch(w){case"top":case"hanging":{C=m;break}case"bottom":case"ideographic":case"alphabetic":{C=m-P-l-d;break}default:{C=m-P/2-l;break}}return{x:I,y:C,width:a+t+c,height:l+P+d}}const fw=ag.calcTextWidth;function uI(n,e,t){return`${e??"normal"} ${n??12}px ${t??"Helvetica Neue"}`}function pI(n){return typeof n=="string"}function cb(n){return n==="transparent"||n==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(n)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(n)}function vI(n,e,t){let o=[];o=o.concat(e);const{style:i=Yg.Fill,color:r="transparent",borderSize:a=1,borderColor:l="transparent",borderStyle:c=Ke.Solid,borderRadius:d=0,borderDashedValue:p=[2,2]}=t,m=n.roundRect??n.rect,h=(i===Yg.Fill||t.style===Yg.StrokeFill)&&(!pI(r)||!cb(r));if(h&&(n.fillStyle=r,o.forEach(({x:_,y:w,width:S,height:P})=>{n.beginPath(),m.call(n,_,w,S,P,d),n.closePath(),n.fill()})),(i===Yg.Stroke||t.style===Yg.StrokeFill)&&a>0&&!cb(l)){n.strokeStyle=l,n.fillStyle=l,n.lineWidth=a,c===Ke.Dashed?n.setLineDash(p):n.setLineDash([]);const _=a%2===1?.5:0,w=Math.round(_*2);o.forEach(({x:S,y:P,width:I,height:C})=>{I>a*2&&C>a*2?(n.beginPath(),m.call(n,S+_,P+_,I-w,C-w,d),n.closePath(),n.stroke()):h||n.fillRect(S,P,I,C)})}}function fI(n,e,t){const{text:o}=e,{size:i=12,family:r,weight:a,paddingLeft:l=0,paddingTop:c=0,paddingRight:d=0}=t,p=o.split(`
`),m=p.map(I=>fw(I,i,a,r)),h=1.5,_=i*h,w=Math.max(...m),S=vw(e,t,w,p.length,h);vI(n,S,{...t,color:t.backgroundColor});let P=S.y+c;p.forEach((I,C)=>{const M=pw(e,t,m[C])+l;n.textAlign="left",n.textBaseline="top",n.font=uI(i,a,r),n.fillStyle=t.color||"currentColor",n.fillText(I,M,P,S.width-l-d),P+=_})}function mI(n,e,t){const{size:o=12,family:i,weight:r,paddingLeft:a=0,paddingTop:l=0}=t,c=e.text.split(`
`),d=c.map(P=>fw(P,o,r,i)),p=1.5,m=Math.max(...d),{x:h,y:_,width:w,height:S}=vw(e,t,m,c.length,p);return n.x>=h&&n.x<=h+w&&n.y>=_&&n.y<=_+S}const gI={name:"textBox",checkEventOn:(n,e,t)=>mI(n,e,t),draw:(n,e,t)=>{fI(n,e,t)}},hI=[gI],_I={name:"BIAS",shortName:"BIAS",precision:2,calcParams:[6],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"bias",title:"BIAS: ",type:"line"}],styles:{lines:[{color:"#2196F3",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||6;return n.reduce((o,i,r)=>{if(r>=t-1){let a=0;for(let c=r-t+1;c<=r;c++)a+=n[c].close;const l=a/t;o[i.timestamp]={bias:(i.close-l)/l*100}}else o[i.timestamp]={};return o},{})}},yI={name:"CCI",shortName:"CCI",precision:2,calcParams:[20],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"cci",title:"CCI: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#2563eb",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[o]=t;return n.reduce((i,r,a)=>(i[r.timestamp]={cci:bI(n,a,o)},i),{})}};function bI(n,e,t){if(e<t-1)return null;const o=[];for(let d=e-t+1;d<=e;d++){const p=n[d],m=(p.high+p.low+p.close)/3;o.push(m)}const i=o.reduce((d,p)=>d+p,0)/t,r=o.reduce((d,p)=>d+Math.abs(p-i),0)/t;if(r===0)return 0;const a=n[e];return((a.high+a.low+a.close)/3-i)/(.015*r)}const xI={name:"ICHIMOKU",shortName:"ICHIMOKU",precision:4,calcParams:[9,26,52],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"tenkan",title:"Tenkan: ",type:"line"},{key:"kijun",title:"Kijun: ",type:"line"},{key:"senkouA",title:"Senkou A: ",type:"line"},{key:"senkouB",title:"Senkou B: ",type:"line"},{key:"chikou",title:"Chikou: ",type:"line"}],styles:{lines:[{color:"#FF6B6B",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]},{color:"#4ECDC4",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]},{color:"#45B7D1",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]},{color:"#FFA07A",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]},{color:"#9B59B6",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||9,o=e.calcParams[1]||26,i=e.calcParams[2]||52,r=o,a=[],l=(d,p)=>{let m=-1/0,h=1/0;for(let _=d;_<d+p&&_<n.length;_++)n[_].high>m&&(m=n[_].high),n[_].low<h&&(h=n[_].low);return{high:m,low:h}};for(let d=0;d<n.length;d++){const p={};if(d>=t-1){const{high:m,low:h}=l(d-t+1,t);p.tenkan=(m+h)/2}if(d>=o-1){const{high:m,low:h}=l(d-o+1,o);p.kijun=(m+h)/2}if(d>=o-1){const m=d,h=d;if(m>=t-1&&h>=o-1){const{high:_,low:w}=l(m-t+1,t),{high:S,low:P}=l(h-o+1,o),I=(_+w)/2,C=(S+P)/2;p.senkouA=(I+C)/2}}if(d>=i-1){const{high:m,low:h}=l(d-i+1,i);p.senkouB=(m+h)/2}p.chikou=n[d].close,a.push(p)}const c=a.map((d,p)=>{var h,_,w;const m={...d};return p>=r?(m.senkouA=(h=a[p-r])==null?void 0:h.senkouA,m.senkouB=(_=a[p-r])==null?void 0:_.senkouB):(m.senkouA=void 0,m.senkouB=void 0),p+r<a.length?m.chikou=(w=n[p+r])==null?void 0:w.close:m.chikou=void 0,m});return n.reduce((d,p,m)=>(d[p.timestamp]=c[m],d),{})},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{var h;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:d}=l,p=t.result;n.save();const m=[];for(let _=c;_<d;_++){const w=(h=a[_])==null?void 0:h.timestamp,S=p[w];if(S&&S.senkouA!==void 0&&S.senkouB!==void 0){const P=i.convertToPixel(_),I=r.convertToPixel(S.senkouA),C=r.convertToPixel(S.senkouB);m.push({x:P,yA:I,yB:C})}}if(m.length>1){n.globalAlpha=.2;const _=m[0].yA<m[0].yB;n.fillStyle=_?"#4CAF50":"#F44336",n.beginPath(),n.moveTo(m[0].x,Math.min(m[0].yA,m[0].yB));for(let w=1;w<m.length;w++)n.lineTo(m[w].x,Math.min(m[w].yA,m[w].yB));for(let w=m.length-1;w>=0;w--)n.lineTo(m[w].x,Math.max(m[w].yA,m[w].yB));n.closePath(),n.fill()}return n.restore(),!1}},wI={name:"PVT",shortName:"PVT",precision:2,calcParams:[],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"pvt",title:"PVT: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t={};if(n.length===0)return t;let o=0;for(let i=0;i<n.length;i++){const r=n[i];if(i===0){t[r.timestamp]={pvt:0};continue}const a=n[i-1];if(r.close==null||a.close==null||r.volume==null||r.close<=0||a.close<=0){t[r.timestamp]={};continue}const l=(r.close-a.close)/a.close,c=o+(r.volume||0)*l;t[r.timestamp]={pvt:c},o=c}return t}},Iv=new Map,e_=n=>({id:n,period:14,lineColor:"#8B5CF6",lineThickness:2,lineStyle:"solid",overboughtLevel:70,oversoldLevel:30,middleLevel:50,overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",overboughtFillColor:"#EF4444",oversoldFillColor:"#22C55E",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed",fillOpacity:.15,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:70,color:"#EF4444",lineStyle:"dashed",thickness:1,label:"70",visible:!0},{id:"middle",value:50,color:"#6B7280",lineStyle:"dashed",thickness:1,label:"50",visible:!0},{id:"oversold",value:30,color:"#22C55E",lineStyle:"dashed",thickness:1,label:"30",visible:!0}]}),kI=(n,e)=>{const t=[];if(n.length<e+1)return n.map(()=>NaN);let o=[],i=[];for(let d=1;d<=e;d++){const p=n[d].close-n[d-1].close;o.push(p>0?p:0),i.push(p<0?Math.abs(p):0)}let r=o.reduce((d,p)=>d+p,0)/e,a=i.reduce((d,p)=>d+p,0)/e;for(let d=0;d<e;d++)t.push(NaN);let l=r/(a||1e-4),c=100-100/(1+l);t.push(c);for(let d=e+1;d<n.length;d++){const p=n[d].close-n[d-1].close,m=p>0?p:0,h=p<0?Math.abs(p):0;r=(r*(e-1)+m)/e,a=(a*(e-1)+h)/e,l=r/(a||1e-4),c=100-100/(1+l),t.push(c)}return t};function SI(n){if(!n)return null;const e=n.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i);if(e)return{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)};const t=n.match(/^#?([a-f\d])([a-f\d])([a-f\d])$/i);if(t)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16)};const o=n.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*[\d.]+\s*)?\)/i);return o?{r:parseInt(o[1],10),g:parseInt(o[2],10),b:parseInt(o[3],10)}:null}function T0(n,e,t,o,i){if(e<=i&&o>=i||e>=i&&o<=i){if(e===o)return null;const r=(i-e)/(o-e);return{x:n+r*(t-n),y:i}}return null}const mw={name:"RSI",shortName:"RSI",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:0,maxValue:100,figures:[{key:"rsi",title:"RSI: ",type:"line"}],styles:{lines:[{color:"#8B5CF6",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||14,o=kI(n,t);return n.reduce((i,r,a)=>{const l=o[a];return i[r.timestamp]={rsi:isNaN(l)?null:l},i},{})},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{var w,S,P,I;const a=t.paneId||"default";let l=Iv.get(a);l||(l=e_(a),Iv.set(a,l));const{left:c,width:d}=o,p=e.getVisibleRange(),m=e.getDataList();n.save();const h=r.convertToPixel(l.overboughtLevel),_=r.convertToPixel(l.oversoldLevel);if(l.showFill){const C=[],M=[];let F=!1,V=!1;for(let j=p.from;j<=p.to;j++){const D=(w=m[j])==null?void 0:w.timestamp,R=t.result[D];if(!R||R.rsi===null||R.rsi===void 0)continue;const W=i.convertToPixel(j),J=r.convertToPixel(R.rsi);if(W===null||J===null)continue;const Z=(S=m[j-1])==null?void 0:S.timestamp,G=j>0?t.result[Z]:null,se=G==null?void 0:G.rsi,Y=j>0?i.convertToPixel(j-1):null,oe=se!=null?r.convertToPixel(se):null;if(R.rsi>l.overboughtLevel){if(!F&&(F=!0,Y!==null&&oe!==null&&se!==null&&se!==void 0&&se<=l.overboughtLevel)){const ee=T0(Y,oe,W,J,h);ee&&(C.push({x:ee.x,y:h}),ee.x)}C.push({x:W,y:J})}else if(F){if(Y!==null&&oe!==null&&se!==null&&se!==void 0){const ee=T0(Y,oe,W,J,h);ee&&C.push({x:ee.x,y:h})}C.length>=2&&L0(n,C,h,l.overboughtFillColor,l.fillOpacity,"above"),C.length=0,F=!1}if(R.rsi<l.oversoldLevel){if(!V&&(V=!0,Y!==null&&oe!==null&&se!==null&&se!==void 0&&se>=l.oversoldLevel)){const ee=T0(Y,oe,W,J,_);ee&&(M.push({x:ee.x,y:_}),ee.x)}M.push({x:W,y:J})}else if(V){if(Y!==null&&oe!==null&&se!==null&&se!==void 0){const ee=T0(Y,oe,W,J,_);ee&&M.push({x:ee.x,y:_})}M.length>=2&&L0(n,M,_,l.oversoldFillColor,l.fillOpacity,"below"),M.length=0,V=!1}}F&&C.length>=2&&L0(n,C,h,l.overboughtFillColor,l.fillOpacity,"above"),V&&M.length>=2&&L0(n,M,_,l.oversoldFillColor,l.fillOpacity,"below")}l.showLevels&&l.levels.forEach(C=>{if(!C.visible)return;const M=r.convertToPixel(C.value);if(M===null)return;n.save(),n.strokeStyle=C.color;let F=1,V="dashed";C.id==="overbought"?(F=l.overboughtThickness??1,V=l.overboughtLineStyle??"dashed"):C.id==="oversold"?(F=l.oversoldThickness??1,V=l.oversoldLineStyle??"dashed"):C.id==="middle"&&(F=l.middleLineThickness??1,V=l.middleLineStyle??"dashed"),F=Math.max(1,Math.round(F)),n.lineWidth=F;const j=F%2===1?Math.floor(M)+.5:Math.round(M);V==="dashed"?n.setLineDash([6*F,4*F]):V==="dotted"?n.setLineDash([F,F*2]):n.setLineDash([]),n.beginPath(),n.moveTo(Math.floor(c),j),n.lineTo(Math.floor(c+d),j),n.stroke(),n.restore()}),n.lineCap="round",n.lineJoin="round";for(let C=p.from;C<p.to;C++){const M=(P=m[C])==null?void 0:P.timestamp,F=(I=m[C+1])==null?void 0:I.timestamp,V=t.result[M],j=t.result[F];if(!V||!j||V.rsi===null||V.rsi===void 0||j.rsi===null||j.rsi===void 0)continue;const D=i.convertToPixel(C),R=i.convertToPixel(C+1),W=r.convertToPixel(V.rsi),J=r.convertToPixel(j.rsi);if(D===null||R===null||W===null||J===null)continue;let Z=l.lineColor;V.rsi>l.overboughtLevel?Z=l.overboughtColor:V.rsi<l.oversoldLevel&&(Z=l.oversoldColor),n.strokeStyle=Z,n.lineWidth=l.lineThickness,l.lineStyle==="dashed"?n.setLineDash([6,4]):l.lineStyle==="dotted"?n.setLineDash([2,2]):n.setLineDash([]),n.beginPath(),n.moveTo(D,W),n.lineTo(R,J),n.stroke()}return n.restore(),!0}};function L0(n,e,t,o,i,r){if(e.length<2)return;n.save();let a=SI(o);a||(a=r==="above"?{r:239,g:68,b:68}:{r:34,g:197,b:94});const l=Math.min(...e.map(p=>p.y)),c=Math.max(...e.map(p=>p.y));let d;r==="above"?(d=n.createLinearGradient(0,t,0,l),d.addColorStop(0,`rgba(${a.r}, ${a.g}, ${a.b}, 0.02)`),d.addColorStop(.5,`rgba(${a.r}, ${a.g}, ${a.b}, ${i*.5})`),d.addColorStop(1,`rgba(${a.r}, ${a.g}, ${a.b}, ${i})`)):(d=n.createLinearGradient(0,t,0,c),d.addColorStop(0,`rgba(${a.r}, ${a.g}, ${a.b}, 0.02)`),d.addColorStop(.5,`rgba(${a.r}, ${a.g}, ${a.b}, ${i*.5})`),d.addColorStop(1,`rgba(${a.r}, ${a.g}, ${a.b}, ${i})`)),n.fillStyle=d,n.beginPath(),n.moveTo(e[0].x,e[0].y);for(let p=1;p<e.length;p++)n.lineTo(e[p].x,e[p].y);n.lineTo(e[e.length-1].x,t),n.lineTo(e[0].x,t),n.closePath(),n.fill(),n.restore()}const Pm={createInstance:(n,e)=>{const t=e_(n);return e&&(e.levels&&(t.levels=e.levels),Object.keys(e).forEach(o=>{o!=="levels"&&e[o]!==void 0&&(t[o]=e[o])})),Iv.set(n,t),t},getInstance:n=>Iv.get(n),getInstanceConfig:n=>Iv.get(n)||null,updateInstance:(n,e)=>{const t=Iv.get(n);if(!t){const o=e_(n);return Object.assign(o,e),Iv.set(n,o),!0}return e.levels&&(t.levels=e.levels),Object.keys(e).forEach(o=>{o!=="levels"&&e[o]!==void 0&&(t[o]=e[o])}),Iv.set(n,t),!0},deleteInstance:n=>Iv.delete(n),getAllInstances:()=>new Map(Iv),clearAllInstances:()=>{Iv.clear()},resetInstance:n=>{const e=e_(n);Iv.set(n,e)},exportInstanceConfig:n=>Iv.get(n)||null,importInstanceConfig:n=>{try{if(!n||!n.id)return!1;const e={id:n.id,period:n.period??14,lineColor:n.lineColor??"#8B5CF6",lineThickness:n.lineThickness??2,lineStyle:n.lineStyle??"solid",overboughtLevel:n.overboughtLevel??70,oversoldLevel:n.oversoldLevel??30,middleLevel:n.middleLevel??50,overboughtColor:n.overboughtColor??"#EF4444",overboughtThickness:n.overboughtThickness??1,overboughtLineStyle:n.overboughtLineStyle??"dashed",oversoldColor:n.oversoldColor??"#22C55E",oversoldThickness:n.oversoldThickness??1,oversoldLineStyle:n.oversoldLineStyle??"dashed",overboughtFillColor:n.overboughtFillColor??n.overboughtColor??"#EF4444",oversoldFillColor:n.oversoldFillColor??n.oversoldColor??"#22C55E",middleLineColor:n.middleLineColor??"#6B7280",middleLineThickness:n.middleLineThickness??1,middleLineStyle:n.middleLineStyle??"dashed",fillOpacity:n.fillOpacity??.15,showLevels:n.showLevels??!0,showFill:n.showFill??!0,levels:n.levels??[{id:"overbought",value:n.overboughtLevel??70,color:n.overboughtColor??"#EF4444",lineStyle:n.overboughtLineStyle??"dashed",thickness:n.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:n.middleLevel??50,color:n.middleLineColor??"#6B7280",lineStyle:n.middleLineStyle??"dashed",thickness:n.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:n.oversoldLevel??30,color:n.oversoldColor??"#22C55E",lineStyle:n.oversoldLineStyle??"dashed",thickness:n.oversoldThickness??1,label:"30",visible:!0}]};return Iv.set(n.id,e),!0}catch(e){return console.error("Failed to import RSI instance config:",e),!1}},updateLevel:(n,e,t)=>{const o=Iv.get(n);if(!o)return!1;const i=o.levels.find(r=>r.id===e);return i?(Object.assign(i,t),e==="overbought"&&t.value!==void 0?o.overboughtLevel=t.value:e==="oversold"&&t.value!==void 0?o.oversoldLevel=t.value:e==="middle"&&t.value!==void 0&&(o.middleLevel=t.value),!0):!1},addLevel:(n,e)=>{const t=Iv.get(n);if(!t)throw new Error(`RSI instance ${n} not found`);const o=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={...e,id:o,value:Math.max(0,Math.min(100,e.value))};return t.levels.push(i),o},removeLevel:(n,e)=>{const t=Iv.get(n);if(!t)return!1;const o=t.levels.findIndex(i=>i.id===e);return o===-1?!1:(t.levels.splice(o,1),!0)}},db=Object.freeze(Object.defineProperty({__proto__:null,RSIManager:Pm,rsi:mw},Symbol.toStringTag,{value:"Module"})),CI={name:"SAR",shortName:"SAR",precision:4,calcParams:[.02,.02,.2],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"sar",title:"SAR: ",type:"line"}],styles:{lines:[{color:"#2563eb",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||.02,o=e.calcParams[1]||.02,i=e.calcParams[2]||.2,r={};if(n.length<2)return n.map(()=>({}));let a=!0,l=t,c=n[0].high,d=n[0].low;r[n[0].timestamp]={sar:d};for(let p=1;p<n.length;p++){const m=n[p],h=n[p-1];a?(d=d+l*(c-d),d=Math.min(d,m.low,h.low),m.low<=d?(a=!1,d=c,c=m.low,l=t):m.high>c&&(c=m.high,l=Math.min(l+o,i))):(d=d-l*(d-c),d=Math.max(d,m.high,h.high),m.high>=d?(a=!0,d=c,c=m.high,l=t):m.low<c&&(c=m.low,l=Math.min(l+o,i))),r[n[p].timestamp]={sar:d}}return r},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{var h,_,w;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:d}=l;n.save();const p=((_=(h=t.styles)==null?void 0:h.lines)==null?void 0:_[0])||{color:"#2563eb",size:1},m=p.size||1;for(let S=c;S<=d;S++){const P=(w=a[S])==null?void 0:w.timestamp,I=t.result[P];if(!I||typeof I.sar!="number")continue;const C=i.convertToPixel(S),M=r.convertToPixel(I.sar);C>=o.left&&C<=o.left+o.width&&M>=o.top&&M<=o.top+o.height&&(n.beginPath(),n.arc(C,M,m,0,2*Math.PI),n.fillStyle=p.color,n.fill(),n.strokeStyle=p.color,n.lineWidth=1,n.stroke())}return n.restore(),!0}},ev=new Map,V1=n=>({id:n,period:14,lineColor:"#2563eb",lineThickness:1,lineStyle:"solid",showLevels:!0,showZones:!0,yAxisSync:!0,enableDynamicColoring:!0,overboughtColor:"#EF4444",oversoldColor:"#10B981",overboughtThreshold:-20,oversoldThreshold:-80,levels:[{id:"overbought",value:-20,color:"#EF4444",lineStyle:"solid",thickness:1,label:"Overbought",visible:!0},{id:"middle",value:-50,color:"#6B7280",lineStyle:"dashed",thickness:1,label:"Middle",visible:!0},{id:"oversold",value:-80,color:"#10B981",lineStyle:"solid",thickness:1,label:"Oversold",visible:!0}],zones:[{id:"overbought_zone",topLevel:0,bottomLevel:-20,fillColor:"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold_zone",topLevel:-80,bottomLevel:-100,fillColor:"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}]}),PI=(n,e)=>{const t=[];if(n.length<e)return n.map(()=>NaN);for(let o=0;o<n.length;o++){if(o<e-1){t.push(NaN);continue}let i=n[o-e+1].high,r=n[o-e+1].low;for(let c=o-e+2;c<=o;c++)n[c].high>i&&(i=n[c].high),n[c].low<r&&(r=n[c].low);const a=n[o].close,l=(i-a)/(i-r)*-100;t.push(isNaN(l)?0:l)}return t},II={name:"WR",shortName:"WR",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:-100,maxValue:0,figures:[{key:"wr",title:"WR: ",type:"line"}],styles:{lines:[{color:"#2563eb",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||14,o=PI(n,t);return n.reduce((i,r,a)=>{const l=o[a];return i[r.timestamp]={wr:isNaN(l)?null:l},i},{})},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{var _,w;const a=t.paneId||"default";let l=ev.get(a);l||(l=V1(a),ev.set(a,l));const{left:c,top:d,width:p,height:m}=o,h=e.getVisibleRange();if(n.save(),l.showZones&&l.zones.forEach(S=>{if(!S.visible)return;const P=r.convertToPixel(S.topLevel),I=r.convertToPixel(S.bottomLevel);if(P!==null&&I!==null){n.save();const C=Math.abs(P-I),M=Math.min(P,I),F=n.createLinearGradient(c,M,c,M+C),j=S.fillColor.match(/\w\w/g);if(j){const D=parseInt(j[0],16),R=parseInt(j[1],16),W=parseInt(j[2],16);F.addColorStop(0,`rgba(${D}, ${R}, ${W}, ${S.fillOpacity*.8})`),F.addColorStop(.3,`rgba(${D}, ${R}, ${W}, ${S.fillOpacity*.6})`),F.addColorStop(.7,`rgba(${D}, ${R}, ${W}, ${S.fillOpacity*.3})`),F.addColorStop(1,`rgba(${D}, ${R}, ${W}, ${S.fillOpacity*.1})`)}else F.addColorStop(0,S.fillColor+Math.floor(S.fillOpacity*255).toString(16).padStart(2,"0")),F.addColorStop(.5,S.fillColor+Math.floor(S.fillOpacity*128).toString(16).padStart(2,"0")),F.addColorStop(1,S.fillColor+Math.floor(S.fillOpacity*32).toString(16).padStart(2,"0"));n.fillStyle=F,n.fillRect(c,M,p,C),n.strokeStyle=S.fillColor+"40",n.lineWidth=.5,n.strokeRect(c,M,p,C),n.restore()}}),l.showLevels&&l.levels.forEach(S=>{if(!S.visible)return;const P=r.convertToPixel(S.value);P!==null&&(n.save(),n.strokeStyle=S.color,n.lineWidth=S.thickness,S.lineStyle==="dashed"?n.setLineDash([4,4]):S.lineStyle==="dotted"?n.setLineDash([2,2]):n.setLineDash([]),n.beginPath(),n.moveTo(c,P),n.lineTo(c+p,P),n.stroke(),l.yAxisSync&&(n.font="11px Arial",n.textAlign="left",n.fillStyle=S.color,n.fillText(`WR ${S.value}`,c+p+5,P+4)),n.restore())}),l.enableDynamicColoring&&t.result){const{from:S,to:P}=h,I=e.getDataList();for(let C=S;C<P;C++){const M=(_=I[C])==null?void 0:_.timestamp,F=(w=t.result[M])==null?void 0:w.wr;if(F!=null){const V=i.convertToPixel(C),j=r.convertToPixel(F);if(V!==null&&j!==null){n.save();let D=l.lineColor;F>l.overboughtThreshold?D=l.overboughtColor:F<l.oversoldThreshold&&(D=l.oversoldColor),n.fillStyle=D,n.beginPath(),n.arc(V,j,1,0,2*Math.PI),n.fill(),n.restore()}}}}return n.restore(),!1}},Q_={createInstance:(n,e)=>{const t=V1(n);return e&&Object.assign(t,e),ev.set(n,t),t},getInstance:n=>ev.get(n),updateInstance:(n,e)=>{const t=ev.get(n);return t?(Object.assign(t,e),ev.set(n,t),!0):!1},deleteInstance:n=>ev.delete(n),addLevel:(n,e)=>{const t=ev.get(n);if(!t)throw new Error(`WR instance ${n} not found`);const o=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={...e,id:o,value:Math.max(-100,Math.min(0,e.value))};return t.levels.push(i),o},removeLevel:(n,e)=>{const t=ev.get(n);if(!t)return!1;const o=t.levels.findIndex(i=>i.id===e);return o===-1?!1:(t.levels.splice(o,1),!0)},updateLevel:(n,e,t)=>{const o=ev.get(n);if(!o)return!1;const i=o.levels.find(r=>r.id===e);return i?(t.value!==void 0&&(t.value=Math.max(-100,Math.min(0,t.value))),t.thickness!==void 0&&(t.thickness=Math.max(1,Math.min(5,t.thickness))),Object.assign(i,t),!0):!1},addZone:(n,e)=>{const t=ev.get(n);if(!t)throw new Error(`WR instance ${n} not found`);const o=Math.max(-100,Math.min(0,Math.max(e.topLevel,e.bottomLevel))),i=Math.max(-100,Math.min(0,Math.min(e.topLevel,e.bottomLevel))),r=`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={...e,id:r,topLevel:o,bottomLevel:i,fillOpacity:Math.max(0,Math.min(1,e.fillOpacity||.15))};return t.zones.push(a),r},removeZone:(n,e)=>{const t=ev.get(n);if(!t)return!1;const o=t.zones.findIndex(i=>i.id===e);return o===-1?!1:(t.zones.splice(o,1),!0)},updateZone:(n,e,t)=>{const o=ev.get(n);if(!o)return!1;const i=o.zones.find(r=>r.id===e);if(!i)return!1;if(t.topLevel!==void 0&&(t.topLevel=Math.max(-100,Math.min(0,t.topLevel))),t.bottomLevel!==void 0&&(t.bottomLevel=Math.max(-100,Math.min(0,t.bottomLevel))),t.fillOpacity!==void 0&&(t.fillOpacity=Math.max(0,Math.min(1,t.fillOpacity))),Object.assign(i,t),i.topLevel<i.bottomLevel){const r=i.topLevel;i.topLevel=i.bottomLevel,i.bottomLevel=r}return!0},getInstanceConfig:n=>ev.get(n)||null,resetInstance:n=>{const e=V1(n);ev.set(n,e)},exportInstanceConfig:n=>{const e=ev.get(n);return e?{id:n,period:e.period,lineColor:e.lineColor,lineThickness:e.lineThickness,lineStyle:e.lineStyle,showLevels:e.showLevels,showZones:e.showZones,yAxisSync:e.yAxisSync,levels:e.levels.map(t=>({...t})),zones:e.zones.map(t=>({...t}))}:null},importInstanceConfig:n=>{try{const e={id:n.id,period:n.period||14,lineColor:n.lineColor||"#FF6B35",lineThickness:n.lineThickness||2,lineStyle:n.lineStyle||"solid",showLevels:n.showLevels??!0,showZones:n.showZones??!0,yAxisSync:n.yAxisSync??!0,enableDynamicColoring:n.enableDynamicColoring??!0,overboughtColor:n.overboughtColor||"#EF4444",oversoldColor:n.oversoldColor||"#10B981",overboughtThreshold:n.overboughtThreshold||-20,oversoldThreshold:n.oversoldThreshold||-80,levels:n.levels||[],zones:n.zones||[]};return ev.set(n.id,e),!0}catch(e){return console.error("Failed to import WR instance config:",e),!1}},getAllInstances:()=>new Map(ev),clearAllInstances:()=>{ev.clear()}},MI={name:"VR",shortName:"VR",precision:2,calcParams:[26,6,12],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:100-1e-9,maxValue:100+1e-9,figures:[{key:"vr",title:"VR: ",type:"line"},{key:"vrShort",title:"VR Short: ",type:"line"},{key:"vrLong",title:"VR Long: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]},{color:"#4CAF50",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||26,o=e.calcParams[1]||6,i=e.calcParams[2]||12,r={};if(n.length<Math.max(t,o,i)+1)return n.reduce((l,c)=>(l[c.timestamp]={},l),{});const a=(l,c)=>{if(l<c)return 100;let d=0,p=0,m=0;for(let w=l-c+1;w<=l;w++){if(w===0)continue;const S=n[w],P=n[w-1];S.close>P.close?d+=S.volume||0:S.close<P.close?p+=S.volume||0:m+=S.volume||0}const h=d+m/2,_=p+m/2;return _===0?100:h/_*100};for(let l=0;l<n.length;l++){const c=a(l,t),d=a(l,o),p=a(l,i);r[n[l].timestamp]={vr:c,vrShort:d,vrLong:p}}return r},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{e.getVisibleRange(),n.save(),n.lineWidth=1,n.setLineDash([2,2]),n.strokeStyle="rgba(107, 114, 128, 0.6)",n.beginPath();const a=r.convertToPixel(100);n.moveTo(o.left,a),n.lineTo(o.left+o.width,a),n.stroke(),n.strokeStyle="rgba(239, 68, 68, 0.6)",n.beginPath();const l=r.convertToPixel(150);n.moveTo(o.left,l),n.lineTo(o.left+o.width,l),n.stroke(),n.strokeStyle="rgba(34, 197, 94, 0.6)",n.beginPath();const c=r.convertToPixel(70);return n.moveTo(o.left,c),n.lineTo(o.left+o.width,c),n.stroke(),n.restore(),!1}},AI={name:"ROC",shortName:"ROC",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"roc",title:"ROC: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#FF6B6B",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[o]=t;return n.reduce((i,r,a)=>(i[r.timestamp]={roc:TI(n,a,o)},i),{})}};function TI(n,e,t){if(e<t)return null;const o=n[e].close,i=n[e-t].close;return i===0?null:(o-i)/i*100}const LI={name:"PSY",shortName:"PSY",precision:2,calcParams:[12,6],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"mapsy",title:"MAPSY: ",type:"line"}],minValue:0,maxValue:100,styles:{lines:[{color:"#2563eb",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]},{color:"#dc2626",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[o,i]=t;return n.reduce((r,a,l)=>(r[a.timestamp]={psy:gw(n,l,o),mapsy:FI(n,l,o,i)},r),{})}};function gw(n,e,t){if(e<t)return null;let o=0;for(let i=e-t+1;i<=e;i++)i>0&&n[i].close>n[i-1].close&&o++;return o/t*100}function FI(n,e,t,o){if(e<t+o-1)return null;let i=0,r=0;for(let a=e-o+1;a<=e;a++){const l=gw(n,a,t);l!==null&&(i+=l,r++)}return r>0?i/r:null}const $I={name:"OBV",shortName:"OBV",precision:0,calcParams:[30,10],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maobv",title:"MAOBV: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[1]||10,o={};if(n.length===0)return o;let i=0;const r=[];for(let a=0;a<n.length;a++){const l=n[a];if(a===0)i=0;else{const d=n[a-1],p=l.volume||0;l.close>d.close?i+=p:l.close<d.close&&(i-=p)}r.push(i);let c;if(a>=t-1){let d=0;for(let p=a-t+1;p<=a;p++)d+=r[p];c=d/t}o[l.timestamp]={obv:i,maobv:c}}return o}},EI={name:"ZIGZAG",shortName:"ZIGZAG",precision:2,calcParams:[5,5],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:1,extendData:void 0,figures:[],styles:{lines:[{color:"#2962FF",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}],circles:[{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888"}]},calc:(n,e)=>{const t=(e.calcParams[0]||5)/100,o=e.calcParams[1]||5,i=[];if(n.length<o*2)return n.map(()=>({}));let r=0,a=n[0].high,l="high",c=!1;for(let d=0;d<n.length;d++)i.push({});i[0]={zigzag:n[0].close};for(let d=o;d<n.length;d++){const p=n[d].high,m=n[d].low,h=Math.abs(p-a)/a,_=Math.abs(m-a)/a;if(h>=t){r=d,a=p,l="high",c=!1,i[d]={zigzag:p,isHigh:!0};break}else if(_>=t){r=d,a=m,l="low",c=!0,i[d]={zigzag:m,isLow:!0};break}}for(let d=r+o;d<n.length;d++){const p=n[d].high,m=n[d].low;c?(p-a)/a>=t?(r=d,a=p,l="high",c=!1,i[d]={zigzag:p,isHigh:!0}):l==="low"&&m<a&&(i[r]={},r=d,a=m,i[d]={zigzag:m,isLow:!0}):(a-m)/a>=t?(r=d,a=m,l="low",c=!0,i[d]={zigzag:m,isLow:!0}):l==="high"&&p>a&&(i[r]={},r=d,a=p,i[d]={zigzag:p,isHigh:!0})}return i},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{var _,w,S,P;if(!t.result||t.result.length===0)return!1;const a=e.getVisibleRange(),{from:l,to:c}=a,d=t.result;n.save();const p=((w=(_=t.styles)==null?void 0:_.lines)==null?void 0:w[0])||{color:"#2962FF",size:2,style:Ke.Solid,dashedValue:[2,2]},m=((P=(S=t.styles)==null?void 0:S.circles)==null?void 0:P[0])||{upColor:"#26A69A",downColor:"#EF5350"},h=[];for(let I=Math.max(0,l-50);I<Math.min(c+1,d.length);I++){const C=d[I];C&&typeof C.zigzag=="number"&&h.push({index:I,price:C.zigzag,isHigh:C.isHigh||!1,isLow:C.isLow||!1})}if(n.strokeStyle=p.color||"#2962FF",n.lineWidth=p.size||2,p.style===Ke.Dashed){const I=Array.isArray(p.dashedValue)?p.dashedValue:[4,4];n.setLineDash(I)}else n.setLineDash([]);for(let I=0;I<h.length-1;I++){const C=h[I],M=h[I+1],F=i.convertToPixel(C.index),V=r.convertToPixel(C.price),j=i.convertToPixel(M.index),D=r.convertToPixel(M.price);n.beginPath(),n.moveTo(F,V),n.lineTo(j,D),n.stroke()}return h.forEach(I=>{if(I.index<l||I.index>=c)return;const C=i.convertToPixel(I.index),M=r.convertToPixel(I.price);C>=o.left&&C<=o.left+o.width&&M>=o.top&&M<=o.top+o.height&&(n.beginPath(),n.arc(C,M,4,0,2*Math.PI),I.isHigh?n.fillStyle=m.downColor:I.isLow?n.fillStyle=m.upColor:n.fillStyle=p.color,n.fill(),n.strokeStyle="#FFFFFF",n.lineWidth=1.5,n.stroke())}),n.restore(),!0}},NI={name:"Custom Momentum",shortName:"CM",calcParams:[12,26],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:5,styles:{lines:[{color:"#26a69a",size:2,style:"solid"}],bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575",size:3,borderColor:"#26a69a",borderSize:0,borderStyle:"solid"}]},figures:[{key:"momentum",title:"Momentum: ",type:"line",baseValue:0},{key:"histogram",title:"Histogram: ",type:"bar",baseValue:0,styles:{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575"}}],calc:(n,e)=>{const t=e.calcParams[0]||12,o=e.calcParams[1]||26,i=[];for(let r=0;r<n.length;r++){const l=n[r].close;if(r>=o-1){let c=0;if(r===o-1){let h=0;for(let _=r-t+1;_<=r;_++)h+=n[_].close;c=h/t}else{const h=2/(t+1);c=l*h+(i[r-1].momentum||0)*(1-h)}let d=0;if(r===o-1){let h=0;for(let _=r-o+1;_<=r;_++)h+=n[_].close;d=h/o}else{const h=2/(o+1);d=l*h+(i[r-1].momentum||0)*(1-h)}const p=c-d,m=p;i.push({momentum:p,histogram:m})}else i.push({})}return i}},DI={name:"Custom AO",shortName:"CAO",calcParams:[5,34],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:5,styles:{bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575",size:3,borderColor:"#26a69a",borderSize:0,borderStyle:"solid",fillColor:"#26a69a",strokeColor:"#26a69a"}]},figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575"}}],calc:(n,e)=>{const t=e.calcParams[0]||5,o=e.calcParams[1]||34,i=[];for(let r=0;r<n.length;r++)if(r>=o-1){const a=[],l=[];for(let m=r-t+1;m<=r;m++){const h=(n[m].high+n[m].low)/2;a.push(h)}for(let m=r-o+1;m<=r;m++){const h=(n[m].high+n[m].low)/2;l.push(h)}const c=a.reduce((m,h)=>m+h,0)/t,d=l.reduce((m,h)=>m+h,0)/o,p=c-d;i.push({ao:p})}else i.push({});return i},draw:(n,e,t,o,i)=>{t.calcParams[0];const r=t.calcParams[1]||34;n.save();for(let a=r-1;a<e.length;a++){const c=e[a].ao;if(c!==void 0){const d=o.convertToPixel(a),p=i.convertToPixel(0),m=i.convertToPixel(c);let h="#757575";c>0?h="#26a69a":c<0&&(h="#ef5350"),n.fillStyle=h,n.strokeStyle=h,n.lineWidth=1;const _=Math.max(2,o.getPixelDistance(1)*.8),w=Math.abs(p-m),S=d-_/2,P=Math.min(p,m);n.fillRect(S,P,_,w),n.strokeRect(S,P,_,w)}}n.restore()}},jI={name:"BOLL",shortName:"BOLL",precision:2,calcParams:[20,2],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"upper",title:"Upper: ",type:"line"},{key:"middle",title:"Middle: ",type:"line"},{key:"lower",title:"Lower: ",type:"line"}],styles:{lines:[{color:"#f23645",size:1,style:Ke.Solid,smooth:!1,dashedValue:[0,0]},{color:"#2962ff",size:1,style:Ke.Solid,smooth:!1,dashedValue:[0,0]},{color:"#089981",size:1,style:Ke.Solid,smooth:!1,dashedValue:[0,0]}],fill:{color:"#2196F3",opacity:.05}},calc:(n,e)=>{const t=e.calcParams[0]||20,o=e.calcParams[1]||2,i={};for(let r=0;r<n.length;r++){const a=n[r].timestamp;if(r<t-1){i[a]={};continue}let l=0;for(let _=r-t+1;_<=r;_++)l+=n[_].close;const c=l/t;let d=0;for(let _=r-t+1;_<=r;_++)d+=Math.pow(n[_].close-c,2);const p=Math.sqrt(d/t),m=c+o*p,h=c-o*p;i[a]={upper:m,middle:c,lower:h}}return i},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{var S,P,I,C,M,F,V,j,D,R,W,J,Z,G,se,Y,oe,ee,re,me,K,ye,Me,Fe,Ze,Ge,it,Ye,ct,kt,ft,bt,nt,Pt,Qe,yt;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),c=Math.max(l.from,0),d=Math.min(l.to,a.length-1);n.save();const p={color:((I=(P=(S=t.styles)==null?void 0:S.lines)==null?void 0:P[0])==null?void 0:I.color)||"#2196F3",size:((F=(M=(C=t.styles)==null?void 0:C.lines)==null?void 0:M[0])==null?void 0:F.size)||1,style:((D=(j=(V=t.styles)==null?void 0:V.lines)==null?void 0:j[0])==null?void 0:D.style)||Ke.Solid},m={color:((J=(W=(R=t.styles)==null?void 0:R.lines)==null?void 0:W[1])==null?void 0:J.color)||"#FF9800",size:((se=(G=(Z=t.styles)==null?void 0:Z.lines)==null?void 0:G[1])==null?void 0:se.size)||1,style:((ee=(oe=(Y=t.styles)==null?void 0:Y.lines)==null?void 0:oe[1])==null?void 0:ee.style)||Ke.Solid},h={color:((K=(me=(re=t.styles)==null?void 0:re.lines)==null?void 0:me[2])==null?void 0:K.color)||"#2196F3",size:((Fe=(Me=(ye=t.styles)==null?void 0:ye.lines)==null?void 0:Me[2])==null?void 0:Fe.size)||1,style:((it=(Ge=(Ze=t.styles)==null?void 0:Ze.lines)==null?void 0:Ge[2])==null?void 0:it.style)||Ke.Solid},_={color:((ct=(Ye=t.styles)==null?void 0:Ye.fill)==null?void 0:ct.color)||"rgba(33, 150, 243, 0.1)",opacity:((ft=(kt=t.styles)==null?void 0:kt.fill)==null?void 0:ft.opacity)||.1};n.beginPath();let w=!0;for(let xe=c;xe<=d;xe++){const Ve=(bt=a[xe])==null?void 0:bt.timestamp,Je=t.result[Ve];if(!Je||typeof Je.upper!="number")continue;const St=i.convertToPixel(xe),Ne=r.convertToPixel(Je.upper);w?(n.moveTo(St,Ne),w=!1):n.lineTo(St,Ne)}for(let xe=d;xe>=c;xe--){const Ve=(nt=a[xe])==null?void 0:nt.timestamp,Je=t.result[Ve];if(!Je||typeof Je.lower!="number")continue;const St=i.convertToPixel(xe),Ne=r.convertToPixel(Je.lower);n.lineTo(St,Ne)}n.closePath(),n.globalAlpha=_.opacity,n.fillStyle=_.color,n.fill(),n.globalAlpha=1,n.beginPath(),w=!0;for(let xe=c;xe<=d;xe++){const Ve=(Pt=a[xe])==null?void 0:Pt.timestamp,Je=t.result[Ve];if(!Je||typeof Je.upper!="number")continue;const St=i.convertToPixel(xe),Ne=r.convertToPixel(Je.upper);w?(n.moveTo(St,Ne),w=!1):n.lineTo(St,Ne)}n.strokeStyle=p.color,n.lineWidth=p.size,n.setLineDash(p.style===Ke.Dashed?[4,4]:[]),n.stroke(),n.beginPath(),w=!0;for(let xe=c;xe<=d;xe++){const Ve=(Qe=a[xe])==null?void 0:Qe.timestamp,Je=t.result[Ve];if(!Je||typeof Je.lower!="number")continue;const St=i.convertToPixel(xe),Ne=r.convertToPixel(Je.lower);w?(n.moveTo(St,Ne),w=!1):n.lineTo(St,Ne)}n.strokeStyle=h.color,n.lineWidth=h.size,n.setLineDash(h.style===Ke.Dashed?[4,4]:[]),n.stroke(),n.beginPath(),w=!0;for(let xe=c;xe<=d;xe++){const Ve=(yt=a[xe])==null?void 0:yt.timestamp,Je=t.result[Ve];if(!Je||typeof Je.middle!="number")continue;const St=i.convertToPixel(xe),Ne=r.convertToPixel(Je.middle);w?(n.moveTo(St,Ne),w=!1):n.lineTo(St,Ne)}return n.strokeStyle=m.color,n.lineWidth=m.size,n.setLineDash(m.style===Ke.Dashed?[4,4]:[]),n.stroke(),n.restore(),!0}};function RI(n,e){const t=e.calcParams||[26,10,20,40,60],[o,i,r,a,l]=t,c={};if(n.length<o+1)return n.reduce((p,m,h)=>(p[m.timestamp]={},p),{});const d=[];for(let p=1;p<n.length;p++){n[p];const m=n[p-1];(m.high+m.low+m.close)/3;let h=0,_=0;const w=Math.max(0,p-o+1);for(let F=w;F<=p;F++){const V=n[F],j=F>0?n[F-1]:V,D=(j.high+j.low+j.close)/3,R=V.high-D,W=D-V.low;R>0&&(h+=R),W>0&&(_+=W)}const S=_!==0?h/_*100:100;d.push(S);const P=F0(d,i),I=F0(d,r),C=F0(d,a),M=F0(d,l);c[n[p].timestamp]={cr:S,ma1:P!==null?P:void 0,ma2:I!==null?I:void 0,ma3:C!==null?C:void 0,ma4:M!==null?M:void 0}}return c}function F0(n,e){return n.length<e?null:n.slice(-e).reduce((o,i)=>o+i,0)/e}const BI={name:"CR",shortName:"CR",precision:2,calcParams:[26,10,20,40,60],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:RI,regenerateFigures:n=>{const[,e,t,o,i]=n;return[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:`MA${e}: `,type:"line"},{key:"ma2",title:`MA${t}: `,type:"line"},{key:"ma3",title:`MA${o}: `,type:"line"},{key:"ma4",title:`MA${i}: `,type:"line"}]},styles:{lines:[{color:"#FF6B35",size:2,style:Ke.Solid},{color:"#2196F3",size:1,style:Ke.Solid},{color:"#4CAF50",size:1,style:Ke.Solid},{color:"#FF9800",size:1,style:Ke.Solid},{color:"#9C27B0",size:1,style:Ke.Solid}]}},OI={name:"EMV",shortName:"EMV",precision:4,calcParams:[14,9],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{e.calcParams[0];const t=e.calcParams[1]||9,o={};if(n.length<2)return n.reduce((r,a)=>(r[a.timestamp]={},r),{});const i=[];for(let r=0;r<n.length;r++){const a=n[r];if(r===0){o[a.timestamp]={};continue}const l=n[r-1],c=(a.high+a.low)/2,d=(l.high+l.low)/2,p=c-d,m=a.high-a.low,h=a.volume||0;let _=0;if(m>0&&h>0){const S=h/m;_=p/S}i.push(_);let w;if(i.length>=t){let S=0;for(let P=i.length-t;P<i.length;P++)S+=i[P];w=S/t}o[a.timestamp]={emv:_,maEmv:w}}return o},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{e.getVisibleRange(),n.save(),n.lineWidth=1,n.setLineDash([2,2]),n.strokeStyle="rgba(107, 114, 128, 0.6)",n.beginPath();const a=r.convertToPixel(0);return n.moveTo(o.left,a),n.lineTo(o.left+o.width,a),n.stroke(),n.restore(),!1}},zI={name:"MTM",shortName:"MTM",precision:4,calcParams:[12],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"mtm",title:"MTM: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||12;return n.reduce((o,i,r)=>{if(r>=t){const a=i.close,l=n[r-t].close;o[i.timestamp]={mtm:a-l}}else o[i.timestamp]={};return o},{})}},VI={name:"TRIX",shortName:"TRIX",precision:4,calcParams:[14,9],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"signal",title:"Signal: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#2563eb",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]},{color:"#dc2626",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[o,i]=t,r=WI(n,o),a=t_(r,i);return n.reduce((l,c,d)=>(l[c.timestamp]={trix:r[d],signal:a[d]},l),{})}};function WI(n,e){const t=n.map(l=>l.close),o=t_(t,e),i=t_(o,e),r=t_(i,e),a=[];for(let l=0;l<r.length;l++)if(l===0||r[l]===null||r[l-1]===null||r[l-1]===0)a.push(null);else{const c=(r[l]-r[l-1])/r[l-1]*1e4;a.push(c)}return a}function t_(n,e){const t=[],o=2/(e+1);let i=null;for(let r=0;r<n.length;r++){if(n[r]===null){t.push(null);continue}if(i===null){if(r>=e-1){let a=0,l=0;for(let c=r-e+1;c<=r;c++)n[c]!==null&&(a+=n[c],l++);i=l>0?a/l:null}}else i=n[r]*o+i*(1-o);t.push(i)}return t}const qI={name:"VOL",shortName:"VOL",precision:0,calcParams:[20],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:-1,extendData:void 0,figures:[],styles:{bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#26a69a"}],lines:[{color:"#8B5CF6",size:1,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{var r,a;const o=e.calcParams[0]||20,i={};for(let l=0;l<n.length;l++){const c=n[l],d=c.volume||0;let p=0;if(l===0)p=d;else{const m=2/(o+1),h=(r=n[l-1])==null?void 0:r.timestamp,_=(h!=null?(a=i[h])==null?void 0:a.ema:void 0)??d;p=d*m+_*(1-m)}i[c.timestamp]={volume:d,ema:p}}return i},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i})=>{var F,V,j,D,R,W,J,Z,G,se,Y,oe,ee,re,me,K,ye,Me,Fe,Ze,Ge,it,Ye,ct,kt,ft,bt,nt,Pt,Qe;if(!t.result||Object.keys(t.result).length===0)return!1;const r=e.getVisibleRange();if(!r)return!1;const{from:a,to:l}=r,c=e.getDataList();if(!c||c.length===0)return!1;const d=((j=(V=(F=t.styles)==null?void 0:F.bars)==null?void 0:V[0])==null?void 0:j.upColor)||"#26a69a",p=((W=(R=(D=t.styles)==null?void 0:D.bars)==null?void 0:R[0])==null?void 0:W.downColor)||"#ef5350",m=((G=(Z=(J=t.styles)==null?void 0:J.bars)==null?void 0:Z[0])==null?void 0:G.noChangeColor)||"#26a69a",h=((oe=(Y=(se=t.styles)==null?void 0:se.lines)==null?void 0:Y[0])==null?void 0:oe.color)||"#8B5CF6";n.save();let _=0;for(let yt=a;yt<=l&&yt<c.length;yt++){const xe=(ee=c[yt])==null?void 0:ee.timestamp,Ve=xe!=null?t.result[xe]:void 0;Ve&&(Ve.volume!=null&&Ve.volume>_&&(_=Ve.volume),Ve.ema!=null&&Ve.ema>_&&(_=Math.max(_,Ve.ema)))}if(_<=0)return n.restore(),!0;const S=Math.max(10,Math.floor(o.height*.22)),P=o.top+o.height-1,C=Math.max(1,Math.floor(S*.56));for(let yt=a;yt<=l&&yt<c.length;yt++){const xe=(re=c[yt])==null?void 0:re.timestamp,Ve=xe!=null?t.result[xe]:void 0;if(!Ve||Ve.volume==null)continue;const Je=c[yt],St=yt>0&&yt-1<c.length?c[yt-1]:null;let Ne=m;St&&Je&&typeof Je.close=="number"&&typeof St.close=="number"&&(Je.close>St.close?Ne=d:Je.close<St.close&&(Ne=p));const ue=i.convertToPixel(yt),he=Math.min(1,Ve.volume/_),_t=Math.max(1,Math.floor(he*C)),Wt=P-_t,jt=Math.max(1,(i.convertToPixel(1)-i.convertToPixel(0))*.8),Zt=(ye=(K=(me=t==null?void 0:t.styles)==null?void 0:me.bars)==null?void 0:K[0])==null?void 0:ye.opacity;let dn=typeof Zt=="number"?Zt:void 0;if(dn==null){const zn=(Ne||"").toString().match(/^rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+(?:\s*,\s*([0-9]*\.?[0-9]+))?\s*\)$/i);if(zn){const un=zn[1]!=null?parseFloat(zn[1]):1;dn=isNaN(un)?.7:un}else dn=.7}n.globalAlpha=Math.max(0,Math.min(1,dn)),n.fillStyle=Ne,n.fillRect(ue-jt/2,Wt,jt,_t)}if(n.globalAlpha=1,((Ze=(Fe=(Me=t==null?void 0:t.styles)==null?void 0:Me.lines)==null?void 0:Fe[0])==null?void 0:Ze.visible)===!0){const yt=((Ye=(it=(Ge=t.styles)==null?void 0:Ge.lines)==null?void 0:it[0])==null?void 0:Ye.style)||Ke.Solid,xe=((ft=(kt=(ct=t.styles)==null?void 0:ct.lines)==null?void 0:kt[0])==null?void 0:ft.size)||1,Ve=((Pt=(nt=(bt=t.styles)==null?void 0:bt.lines)==null?void 0:nt[0])==null?void 0:Pt.dashedValue)||[2,2];n.lineWidth=xe,n.strokeStyle=h,yt===Ke.Dashed?n.setLineDash(Ve):n.setLineDash([]);const Je=[];for(let St=a;St<=l&&St<c.length;St++){const Ne=(Qe=c[St])==null?void 0:Qe.timestamp,ue=Ne!=null?t.result[Ne]:void 0;if(!ue||ue.ema==null)continue;const he=i.convertToPixel(St),_t=Math.min(1,ue.ema/_),Wt=P-Math.floor(_t*C);Je.push({x:he,y:Wt})}if(Je.length>1){n.save(),n.beginPath(),n.moveTo(Je[0].x,P);for(const St of Je)n.lineTo(St.x,St.y);n.lineTo(Je[Je.length-1].x,P),n.closePath(),n.globalAlpha=.25,n.fillStyle=h,n.fill(),n.globalAlpha=1,n.restore(),n.beginPath(),n.moveTo(Je[0].x,Je[0].y);for(let St=1;St<Je.length;St++)n.lineTo(Je[St].x,Je[St].y);n.stroke()}}return n.restore(),!0}},HI={name:"SMA",shortName:"SMA",precision:2,calcParams:[20],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"sma",title:"SMA: ",type:"line"}],styles:{lines:[{color:"#FF6C37",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||20,o={};for(let i=0;i<n.length;i++){const r=n[i].timestamp;if(i<t-1){o[r]={};continue}let a=0;for(let c=i-t+1;c<=i;c++)a+=n[c].close;const l=a/t;o[r]={sma:l}}return o},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{var h,_,w,S,P,I,C,M,F,V;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:d}=l;n.save();const p={color:((w=(_=(h=t.styles)==null?void 0:h.lines)==null?void 0:_[0])==null?void 0:w.color)??"#FF6C37",size:((I=(P=(S=t.styles)==null?void 0:S.lines)==null?void 0:P[0])==null?void 0:I.size)??2,style:((F=(M=(C=t.styles)==null?void 0:C.lines)==null?void 0:M[0])==null?void 0:F.style)??Ke.Solid};n.beginPath();let m=!0;for(let j=c;j<=d;j++){const D=(V=a[j])==null?void 0:V.timestamp,R=t.result[D];if(!R||typeof R.sma!="number")continue;const W=i.convertToPixel(j),J=r.convertToPixel(R.sma);m?(n.moveTo(W,J),m=!1):n.lineTo(W,J)}return n.strokeStyle=p.color,n.lineWidth=p.size,p.style===Ke.Dashed?n.setLineDash([8,4]):n.setLineDash([]),n.stroke(),n.restore(),!0}},pv=new Map,Dh=n=>({id:n,kPeriod:14,dPeriod:3,kLineColor:"#1E90FF",kLineThickness:2,kLineStyle:"solid",dLineColor:"#FF1493",dLineThickness:2,dLineStyle:"dashed",showLevels:!0,showZones:!0,overboughtLevel:80,oversoldLevel:20,midlineLevel:50,showOverbought:!0,showOversold:!0,showMidline:!1,levels:[{id:"overbought",value:80,color:"#EF4444",lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:20,color:"#10B981",lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"midline",value:50,color:"#6B7280",lineStyle:"dotted",thickness:1,label:"Midline",visible:!1}],zones:[{id:"overbought_zone",topLevel:100,bottomLevel:80,fillColor:"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold_zone",topLevel:20,bottomLevel:0,fillColor:"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}]}),UI=(n,e,t)=>{const o=[],i=[];if(n.length<e)return{k:n.map(()=>NaN),d:n.map(()=>NaN)};for(let r=0;r<n.length;r++){if(r<e-1){o.push(NaN);continue}let a=n[r-e+1].high,l=n[r-e+1].low;for(let p=r-e+2;p<=r;p++)n[p].high>a&&(a=n[p].high),n[p].low<l&&(l=n[p].low);const c=n[r].close,d=a-l;if(d===0)o.push(50);else{const p=100*((c-l)/d);o.push(p)}}for(let r=0;r<o.length;r++){if(r<e-1+t-1){i.push(NaN);continue}let a=0,l=0;for(let c=r-t+1;c<=r;c++)isNaN(o[c])||(a+=o[c],l++);l===0?i.push(NaN):i.push(a/l)}return{k:o,d:i}},GI={name:"STOCH",shortName:"Stoch",precision:2,calcParams:[14,3],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:0,maxValue:100,figures:[{key:"k",title:"%K: ",type:"line"},{key:"d",title:"%D: ",type:"line"}],styles:{lines:[{color:"#1E90FF",size:2,style:Ke.Solid,smooth:!1,dashedValue:[0,0]},{color:"#FF1493",size:2,style:Ke.Dashed,smooth:!1,dashedValue:[4,4]}]},calc:(n,e)=>{const t=e.calcParams[0]||14,o=e.calcParams[1]||3,{k:i,d:r}=UI(n,t,o);return n.reduce((a,l,c)=>{const d=i[c],p=r[c];return a[l.timestamp]={k:isNaN(d)?null:d,d:isNaN(p)?null:p},a},{})},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{const a=t.paneId||"default";let l=pv.get(a);l||(l=Dh(a),pv.set(a,l));const{left:c,top:d,width:p,height:m}=o;return e.getVisibleRange(),n.save(),l.showZones&&l.zones.forEach(h=>{if(!h.visible)return;const _=r.convertToPixel(h.topLevel),w=r.convertToPixel(h.bottomLevel);if(_!==null&&w!==null&&isFinite(_)&&isFinite(w)&&isFinite(c)&&isFinite(p)){n.save();const S=Math.abs(_-w),P=Math.min(_,w);if(!isFinite(S)||!isFinite(P)||S===0){n.restore();return}const I=n.createLinearGradient(c,P,c,P+S),M=h.fillColor.match(/\w\w/g);if(M){const F=parseInt(M[0],16),V=parseInt(M[1],16),j=parseInt(M[2],16);I.addColorStop(0,`rgba(${F}, ${V}, ${j}, ${h.fillOpacity*.8})`),I.addColorStop(.3,`rgba(${F}, ${V}, ${j}, ${h.fillOpacity*.6})`),I.addColorStop(.7,`rgba(${F}, ${V}, ${j}, ${h.fillOpacity*.3})`),I.addColorStop(1,`rgba(${F}, ${V}, ${j}, ${h.fillOpacity*.1})`)}else I.addColorStop(0,h.fillColor+Math.floor(h.fillOpacity*255).toString(16).padStart(2,"0")),I.addColorStop(.5,h.fillColor+Math.floor(h.fillOpacity*128).toString(16).padStart(2,"0")),I.addColorStop(1,h.fillColor+Math.floor(h.fillOpacity*32).toString(16).padStart(2,"0"));n.fillStyle=I,n.fillRect(c,P,p,S),n.strokeStyle=h.fillColor+"40",n.lineWidth=.5,n.strokeRect(c,P,p,S),n.restore()}}),l.showLevels&&l.levels.forEach(h=>{if(!h.visible)return;const _=r.convertToPixel(h.value);_!==null&&isFinite(_)&&_>=d&&_<=d+m&&isFinite(c)&&isFinite(p)&&(n.save(),n.strokeStyle=h.color,n.lineWidth=h.thickness,h.lineStyle==="dashed"?n.setLineDash([4,4]):h.lineStyle==="dotted"?n.setLineDash([2,6]):n.setLineDash([]),n.beginPath(),n.moveTo(c,_),n.lineTo(c+p,_),n.stroke(),n.fillStyle=h.color,n.font="10px Arial",n.textAlign="left",n.fillText(`${h.value}`,c+5,_-3),n.restore())}),n.restore(),!1}},$0={createInstance:(n,e)=>{const t={...Dh(n),...e};return pv.set(n,t),t},getInstance:n=>pv.get(n),updateInstance:(n,e)=>{const t=pv.get(n);return t?(Object.assign(t,e),!0):!1},deleteInstance:n=>pv.delete(n),addLevel:(n,e)=>{const t=pv.get(n);if(t){const o=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={id:o,...e};return t.levels.push(i),o}throw new Error(`Stochastic instance ${n} not found`)},removeLevel:(n,e)=>{const t=pv.get(n);if(t){const o=t.levels.findIndex(i=>i.id===e);if(o!==-1)return t.levels.splice(o,1),!0}return!1},updateLevel:(n,e,t)=>{const o=pv.get(n);if(o){const i=o.levels.find(r=>r.id===e);if(i)return Object.assign(i,t),e==="overbought"?o.overboughtLevel=i.value:e==="oversold"?o.oversoldLevel=i.value:e==="midline"&&(o.midlineLevel=i.value),!0}return!1},addZone:(n,e)=>{const t=pv.get(n);if(t){const o=`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={id:o,...e};return t.zones.push(i),o}throw new Error(`Stochastic instance ${n} not found`)},removeZone:(n,e)=>{const t=pv.get(n);if(t){const o=t.zones.findIndex(i=>i.id===e);if(o!==-1)return t.zones.splice(o,1),!0}return!1},updateZone:(n,e,t)=>{const o=pv.get(n);if(o){const i=o.zones.find(r=>r.id===e);if(i)return Object.assign(i,t),!0}return!1},getInstanceConfig:n=>pv.get(n)||null,resetInstance:n=>{const e=Dh(n);pv.set(n,e)},exportInstanceConfig:n=>{const e=pv.get(n);return e?{id:e.id,kPeriod:e.kPeriod,dPeriod:e.dPeriod,kLineColor:e.kLineColor,kLineThickness:e.kLineThickness,kLineStyle:e.kLineStyle,dLineColor:e.dLineColor,dLineThickness:e.dLineThickness,dLineStyle:e.dLineStyle,showLevels:e.showLevels,showZones:e.showZones,overboughtLevel:e.overboughtLevel,oversoldLevel:e.oversoldLevel,midlineLevel:e.midlineLevel,showOverbought:e.showOverbought,showOversold:e.showOversold,showMidline:e.showMidline,levels:e.levels.map(t=>({...t})),zones:e.zones.map(t=>({...t}))}:null},importInstanceConfig:n=>{try{const e={id:n.id,kPeriod:n.kPeriod||14,dPeriod:n.dPeriod||3,kLineColor:n.kLineColor||"#1E90FF",kLineThickness:n.kLineThickness||2,kLineStyle:n.kLineStyle||"solid",dLineColor:n.dLineColor||"#FF1493",dLineThickness:n.dLineThickness||2,dLineStyle:n.dLineStyle||"dashed",showLevels:n.showLevels!==!1,showZones:n.showZones!==!1,overboughtLevel:n.overboughtLevel||80,oversoldLevel:n.oversoldLevel||20,midlineLevel:n.midlineLevel||50,showOverbought:n.showOverbought!==!1,showOversold:n.showOversold!==!1,showMidline:n.showMidline||!1,levels:n.levels||Dh(n.id).levels,zones:n.zones||Dh(n.id).zones};return pv.set(n.id,e),!0}catch(e){return console.error("Failed to import Stochastic instance config:",e),!1}},getAllInstances:()=>new Map(pv),clearAllInstances:()=>{pv.clear()}},YI={name:"SMARTTREND",shortName:"Smart Trend",precision:2,calcParams:[10,3],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:{showLabels:!0},figures:[{key:"superTrend",title:"Smart Trend: ",type:"line"}],styles:{lines:[{color:"#00FF00",size:2,style:Ke.Solid,smooth:!1,dashedValue:[0,0]}]},calc:(n,e)=>{var w;const t=e.calcParams[0]||10,o=e.calcParams[1]||3,i={},r=(S,P)=>{if(!P)return S.high-S.low;const I=S.high-S.low,C=Math.abs(S.high-P.close),M=Math.abs(S.low-P.close);return Math.max(I,C,M)},a=S=>{if(S<t-1)return 0;let P=0;for(let I=S-t+1;I<=S;I++){const C=n[I],M=I>0?n[I-1]:void 0;P+=r(C,M)}return P/t};let l=1,c=0,d=0,p=-1,m,h=-1,_;for(let S=0;S<n.length;S++){const P=n[S].timestamp;if(S<t-1){i[P]={};continue}const I=n[S],C=S>0?n[S-1]:I,M=a(S),F=(I.high+I.low)/2,V=F+o*M,j=F-o*M;if(S===t-1)c=V,d=j;else{i[S-1];const re=C.close;(V<c||re>c)&&(c=V),(j>d||re<d)&&(d=j)}let D=l,R=0,W,J,Z,G,se,Y,oe,ee;if(S>t-1){const re=n[S-1].timestamp;if((w=i[re])!=null&&w.superTrend,l===1&&I.close<=d?D=-1:l===-1&&I.close>=c&&(D=1),D!==l){if(D===1){if(W=d,Z=I.close,p=S,m=I.close,_!==void 0&&h>=0){Y=I.close,ee=_-Y;const me=n[h].timestamp,K=i[me];K.sellExit=Y,K.sellProfit=ee,_=void 0,h=-1}}else if(J=c,G=I.close,h=S,_=I.close,m!==void 0&&p>=0){se=I.close,oe=se-m;const me=n[p].timestamp,K=i[me];K.buyExit=se,K.buyProfit=oe,m=void 0,p=-1}}}D===1?R=d:R=c,i[P]={superTrend:R,trend:D,buySignal:W,sellSignal:J,buyEntry:Z,sellEntry:G,buyExit:se,sellExit:Y,buyProfit:oe,sellProfit:ee},l=D}return i},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{var R,W,J,Z,G,se,Y;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:d}=l;n.save();const p=(oe,ee,re,me,K,ye)=>{const Me=Math.min(ye,me/2,K/2);oe.beginPath(),oe.moveTo(ee+Me,re),oe.arcTo(ee+me,re,ee+me,re+K,Me),oe.arcTo(ee+me,re+K,ee,re+K,Me),oe.arcTo(ee,re+K,ee,re,Me),oe.arcTo(ee,re,ee+me,re,Me),oe.closePath()},m=(oe,ee)=>{if(!oe)return`rgba(0,0,0,${ee})`;if(oe.startsWith("rgb"))return oe.startsWith("rgba")?oe.replace(/rgba\(([^)]+)\)/,(Me,Fe)=>{const Ze=Fe.split(",").map(Ge=>Ge.trim());return`rgba(${Ze[0]}, ${Ze[1]}, ${Ze[2]}, ${ee})`}):oe.replace(/rgb\(([^)]+)\)/,(Me,Fe)=>`rgba(${Fe}, ${ee})`);const re=oe.replace("#",""),me=parseInt(re.substring(0,2),16),K=parseInt(re.substring(2,4),16),ye=parseInt(re.substring(4,6),16);return`rgba(${me}, ${K}, ${ye}, ${ee})`},h=(oe,ee,re,me)=>{const K="bold 10px Arial";n.font=K;const ye=n.measureText(re),Me=ye.actualBoundingBoxAscent&&ye.actualBoundingBoxDescent?ye.actualBoundingBoxAscent+ye.actualBoundingBoxDescent:10,Fe=6,Ze=4,Ge=Math.ceil(ye.width)+Fe*2,it=Math.ceil(Me)+Ze*2,Ye=Math.round(oe-Ge/2),ct=Math.round(ee-it/2),kt=typeof performance<"u"?performance.now():Date.now(),ft=.35+.25*Math.sin(kt/450);n.save(),n.shadowColor=m(me,Math.max(0,ft)),n.shadowBlur=12,n.fillStyle=m(me,.14),p(n,Ye,ct,Ge,it,6),n.fill(),n.restore(),n.lineWidth=1,n.strokeStyle=m(me,.9),p(n,Ye,ct,Ge,it,6),n.stroke(),n.fillStyle=m(me,.95),n.textAlign="center",n.textBaseline="middle",n.font=K,n.fillText(re,oe,ee+.5)},_=t.extendData,w=(_==null?void 0:_.showLabels)!==!1,S=(_==null?void 0:_.uptrendColor)||"#00FF00",P=(_==null?void 0:_.downtrendColor)||"#FF0000",I=(_==null?void 0:_.uptrendThickness)??2,C=(_==null?void 0:_.downtrendThickness)??2,M=(_==null?void 0:_.uptrendLineStyle)||"solid",F=(_==null?void 0:_.downtrendLineStyle)||"solid";let V=[],j=c,D=((W=t.result[(R=a[c])==null?void 0:R.timestamp])==null?void 0:W.trend)||1;for(let oe=c+1;oe<=d;oe++){const ee=(J=a[oe])==null?void 0:J.timestamp,re=t.result[ee],me=(re==null?void 0:re.trend)??D,K=oe===d;if(me!==D||K){const ye=K&&me===D?oe:oe-1;V.push({start:j,end:ye,trend:D}),j=oe,D=me}}if(V.forEach(oe=>{var Me,Fe;const ee=oe.trend===1,re=ee?S:P,me=ee?I:C,K=ee?M:F;n.strokeStyle=re,n.lineWidth=Number(me)||2,n.lineCap="round",n.lineJoin="round",K==="dashed"?n.setLineDash([4,4]):K==="dotted"?n.setLineDash([2,6]):n.setLineDash([]),n.beginPath();let ye=!0;for(let Ze=oe.start;Ze<=oe.end;Ze++){const Ge=(Me=a[Ze])==null?void 0:Me.timestamp,it=t.result[Ge];if(it&&typeof it.superTrend=="number"){const Ye=i.convertToPixel(Ze),ct=r.convertToPixel(it.superTrend);ye?(n.moveTo(Ye,ct),ye=!1):n.lineTo(Ye,ct)}}if(n.stroke(),w){const Ze=(Fe=a[oe.end])==null?void 0:Fe.timestamp,Ge=t.result[Ze];if(Ge&&typeof Ge.superTrend=="number"){const Ye=oe===V[V.length-1]?"HOLD":"EXIT",ct=i.convertToPixel(oe.end),kt=r.convertToPixel(Ge.superTrend);h(ct,kt+(ee?22:-22),Ye,re)}}}),w){let oe=0;try{const re=(Z=e==null?void 0:e.getDataList)==null?void 0:Z.call(e);if(re&&re.length>0)oe=((G=re[re.length-1])==null?void 0:G.close)??0;else{const me=(se=a[d])==null?void 0:se.timestamp,K=t.result[me];oe=(K==null?void 0:K.superTrend)??0}}catch{}const ee=(t==null?void 0:t.precision)??2;for(let re=c;re<=d;re++){const me=(Y=a[re])==null?void 0:Y.timestamp,K=t.result[me];if(!K)continue;const ye=i.convertToPixel(re);if(K.buySignal!==void 0){const Me=r.convertToPixel(K.buySignal);n.fillStyle="#00FF00",n.beginPath(),n.arc(ye,Me-10,4,0,2*Math.PI),n.fill();const Fe=K.buyEntry??K.buySignal,Ze=K.buyExit!==void 0?K.buyExit-Fe:oe?oe-Fe:0,Ge=`${Ze>=0?"+":""}${Number(Ze).toFixed(ee)}`;h(ye,Me+22,`BUY ${Ge}`,"#10B981")}if(K.sellSignal!==void 0){const Me=r.convertToPixel(K.sellSignal);n.fillStyle="#FF0000",n.beginPath(),n.arc(ye,Me+10,4,0,2*Math.PI),n.fill();const Fe=K.sellEntry??K.sellSignal,Ze=K.sellExit!==void 0?Fe-K.sellExit:oe?Fe-oe:0,Ge=`${Ze>=0?"+":""}${Number(Ze).toFixed(ee)}`;h(ye,Me-22,`SELL ${Ge}`,"#EF4444")}}}return n.restore(),!0}},KI={name:"MACD",shortName:"MACD",calcParams:[12,26,9],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:4,minValue:-1e-9,maxValue:1e-9,styles:{lines:[{color:"#2563eb",size:1,style:Ke.Solid,dashedValue:[2,2]},{color:"#dc2626",size:1,style:Ke.Solid,dashedValue:[2,2]}],bars:[{upColor:"#2563eb",downColor:"#ef4444",noChangeColor:"#2563eb"}]},figures:[{key:"macd",title:"MACD: ",type:"line",baseValue:0},{key:"signal",title:"Signal: ",type:"line",baseValue:0},{key:"hist",title:"Hist: ",type:"bar",baseValue:0}],calc:(n,e)=>{var h,_,w;const t=((h=e.calcParams)==null?void 0:h[0])||12,o=((_=e.calcParams)==null?void 0:_[1])||26,i=((w=e.calcParams)==null?void 0:w[2])||9,r=(S,P)=>{const I=2/(S+1),C=[];let M;for(let F=0;F<P.length;F++){const V=P[F];M===void 0?M=V:M=V*I+M*(1-I),C.push(M)}return C},a=n.map(S=>S.close),l=r(t,a),c=r(o,a),d=a.map((S,P)=>(l[P]??NaN)-(c[P]??NaN)),p=r(i,d.map(S=>Number.isFinite(S)?S:0)),m={};for(let S=0;S<n.length;S++){const P=n[S].timestamp;if(!Number.isFinite(d[S])||!Number.isFinite(p[S])){m[P]={};continue}const I=d[S],C=p[S],M=I-C;m[P]={macd:I,signal:C,hist:M}}return m},draw:({ctx:n,chart:e,indicator:t,xAxis:o,yAxis:i})=>{var S,P,I,C,M,F,V;const r=e.getDataList();if(!t.result||r.length===0)return!1;const a=t.styles||{},l=((P=(S=a==null?void 0:a.bars)==null?void 0:S[0])==null?void 0:P.upColor)||"#2563eb",c=((C=(I=a==null?void 0:a.bars)==null?void 0:I[0])==null?void 0:C.downColor)||"#ef4444",d=((F=(M=a==null?void 0:a.bars)==null?void 0:M[0])==null?void 0:F.noChangeColor)||l,p=(a==null?void 0:a.lines)||[],m=e.getVisibleRange(),h=Math.max(m.from,0),_=Math.min(m.to,r.length-1);n.save();for(let j=h;j<=_;j++){const D=(V=r[j])==null?void 0:V.timestamp,R=t.result[D];if(!R||typeof R.hist!="number")continue;const W=o.convertToPixel(j),J=i.convertToPixel(0),Z=i.convertToPixel(R.hist),G=o.convertToPixel(1)-o.convertToPixel(0),se=Math.max(1,Math.floor(G*.8)),Y=Math.min(J,Z),oe=Math.abs(J-Z);let ee=d;R.hist>0?ee=l:R.hist<0&&(ee=c),n.fillStyle=ee;const re=Math.round(W-se/2),me=Math.round(Y),K=Math.max(1,Math.round(oe));n.fillRect(re,me,se,K)}n.restore();const w=(j,D)=>{var Z;n.save(),n.beginPath(),n.lineWidth=(D==null?void 0:D.size)??1,(D==null?void 0:D.style)===Ke.Dashed?n.setLineDash((D==null?void 0:D.dashedValue)??[4,4]):n.setLineDash([]),n.strokeStyle=(D==null?void 0:D.color)||"#ffffff";const W=n.lineWidth%2?.5:0;n.lineCap="butt",n.lineJoin="miter";let J=!0;for(let G=h;G<=_;G++){const se=(Z=r[G])==null?void 0:Z.timestamp,Y=t.result[se];if(!Y||typeof Y[j]!="number")continue;const oe=Math.round(o.convertToPixel(G))+W,ee=Math.round(i.convertToPixel(Y[j]))+W;J?(n.moveTo(oe,ee),J=!1):n.lineTo(oe,ee)}n.stroke(),n.restore()};return w("macd",p[0]),w("signal",p[1]),!0}};function km(n,e,t){return Math.max(e,Math.min(t,n))}function ZI(n,e){const t=new Array(n.length).fill(0);if(e<=1){for(let i=0;i<n.length;i++)t[i]=n[i]??0;return t}let o=0;for(let i=0;i<n.length;i++)o+=n[i]??0,i>=e&&(o-=n[i-e]??0),t[i]=i>=e-1?o/e:0;return t}function XI(n,e,t){const o=Math.max(0,e-t);let i=-1/0;for(let r=o;r<e;r++)n[r]&&n[r].high>i&&(i=n[r].high);return i===-1/0?0:i}function JI(n,e,t){const o=Math.max(0,e-t);let i=1/0;for(let r=o;r<e;r++)n[r]&&n[r].low<i&&(i=n[r].low);return i===1/0?0:i}function E0(n){const e=Math.max(0,(n.high??0)-(n.low??0)),t=Math.abs((n.close??0)-(n.open??0)),o=Math.max(0,(n.high??0)-Math.max(n.open??0,n.close??0)),i=Math.max(0,Math.min(n.open??0,n.close??0)-(n.low??0)),r=e>0?o/e:0,a=e>0?i/e:0;return{range:e,body:t,upperWick:o,lowerWick:i,upperWickRatio:r,lowerWickRatio:a}}const QI={name:"TRAP_HUNTER",shortName:"TRAP",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,figures:[],styles:{texts:[{color:"#ffffff",size:10}]},calc:(n,e)=>{var V,j;const t=e.calcParams||[],o=t[0]??20,i=t[1]??20,r=Math.max(1,t[2]??3),a=Math.max(1,t[3]??5),l=Math.max(1,t[4]??20),c=t[5]??1.3,d=t[6]??7e-4,p=t[7]??.35,m=t[8]??.5,h=(t[9]??1)>0?1:0,_=Math.max(1,t[10]??5),w=n.map(D=>(D==null?void 0:D.volume)??0),S=ZI(w,l),P=new Array(n.length).fill(null).map(()=>({}));let I=-1e3,C=-1e3,M=-1e3,F=-1e3;for(let D=0;D<n.length;D++){const R=n[D];if(!R||D===0)continue;const W=XI(n,D,o),J=JI(n,D,i);if(W===0||J===0)continue;const Z=S[D]||0,G=Z>0?(R.volume??0)/Z:0,{range:se,upperWickRatio:Y,lowerWickRatio:oe}=E0(R),ee=se>0?(R.high-R.close)/se<.4:!1,re=se>0?(R.close-R.low)/se<.4:!1,me=(R.high??0)>=W*(1+d),K=(R.close??0)>(R.open??0)||ee,ye=G>=c;if(me&&K&&ye){let Ye=-1;(R.close??0)<W&&(Ye=D);const ct=Math.min(n.length-1,D+r);if(Ye===-1){for(let kt=D+1;kt<=ct;kt++)if((((V=n[kt])==null?void 0:V.close)??0)<W){Ye=kt;break}}if(Ye!==-1){const kt=Math.min(Ye,D+a);let ft=Y,bt=!1;for(let Je=D;Je<=kt;Je++){const St=E0(n[Je]);St.upperWickRatio>ft&&(ft=St.upperWickRatio),(n[Je].close??0)<(n[Je].open??0)&&(St.range>0&&St.body/St.range>=.45)&&(bt=!0)}const nt=km((R.high-W)/Math.max(1e-8,W)/(d*3),0,1),Pt=km(G/(c*2),0,1),Qe=km(ft,0,1),yt=km((R.high-(n[Ye].close??0))/Math.max(1e-8,R.high),0,1),xe=km(.3*nt+.3*Pt+.2*Qe+.2*yt,0,1);(ft>=p||bt)&&xe>=m&&Ye-I>=2&&(I=Ye,M=Ye,P[Ye]={...P[Ye],bullTrap:!0,type:"bull",score:xe,breakoutLevel:W,reversalClose:n[Ye].close,time:n[Ye].timestamp})}}const Me=d*.85,Fe=c*.9,Ze=(R.low??0)<=J*(1-Me),Ge=(R.close??0)<(R.open??0)||re||oe>=p,it=G>=Fe;if(Ze&&Ge&&it){const Ye=Math.min(n.length-1,D+r);let ct=-1;if((R.close??0)>J&&(ct=D),ct===-1){for(let kt=D+1;kt<=Ye;kt++)if((((j=n[kt])==null?void 0:j.close)??0)>J){ct=kt;break}}if(ct!==-1){const kt=Math.min(ct,D+a);let ft=oe,bt=!1;for(let Je=D;Je<=kt;Je++){const St=E0(n[Je]);St.lowerWickRatio>ft&&(ft=St.lowerWickRatio),(n[Je].close??0)>(n[Je].open??0)&&(St.range>0&&St.body/St.range>=.45)&&(bt=!0)}const nt=km((J-R.low)/Math.max(1e-8,J)/(Me*3),0,1),Pt=km(G/(Fe*2),0,1),Qe=km(ft,0,1),yt=km(((n[ct].close??0)-R.low)/Math.max(1e-8,n[ct].close??0),0,1),xe=km(.3*nt+.3*Pt+.2*Qe+.2*yt,0,1);(ft>=p||bt)&&xe>=m&&ct-C>=2&&(C=ct,M=ct,P[ct]={...P[ct],bearTrap:!0,type:"bear",score:xe,breakoutLevel:J,reversalClose:n[ct].close,time:n[ct].timestamp})}}if(h){const Ye=S[D]>0?(R.volume??0)/S[D]:0,{upperWickRatio:ct,lowerWickRatio:kt}=E0(R),ft=Math.max(.1,p*.8),bt=Math.max(1,c*.85),nt=(R.close??0)<=W*(1+d*.5)&&(R.close??0)>=J*(1-d*.5),Pt=Ye<=bt&&ct<=ft&&kt<=ft&&nt,Qe=D-M,yt=D-F,xe=Math.max(8,_);Pt&&Qe>=_&&yt>=xe&&(F=D,P[D]={...P[D],normal:!0,time:n[D].timestamp})}}return P},draw:({ctx:n,chart:e,indicator:t,xAxis:o,yAxis:i})=>{const r=t.result;if(!r||r.length===0)return!1;const a=e.getDataList(),l=e.getVisibleRange(),c=Math.max(0,l.from),d=Math.min(r.length-1,l.to);function p(_,w,S,P){n.save(),n.fillStyle=S,n.strokeStyle=S,n.lineWidth=1,P==="normal"?(n.beginPath(),n.arc(_,w,3.5,0,2*Math.PI),n.fill()):(n.beginPath(),P==="bull"?(n.moveTo(_,w-6),n.lineTo(_-5,w+4),n.lineTo(_+5,w+4)):(n.moveTo(_,w+6),n.lineTo(_-5,w-4),n.lineTo(_+5,w-4)),n.closePath(),n.fill()),n.restore()}function m(_,w,S,P){n.save(),n.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillStyle=P,n.strokeStyle="rgba(0,0,0,0.2)";const I=6,C=n.measureText(S),M=Math.ceil(C.width)+I*2,F=16,V=4,j=_-M/2,D=w-F/2;n.beginPath(),n.moveTo(j+V,D),n.lineTo(j+M-V,D),n.quadraticCurveTo(j+M,D,j+M,D+V),n.lineTo(j+M,D+F-V),n.quadraticCurveTo(j+M,D+F,j+M-V,D+F),n.lineTo(j+V,D+F),n.quadraticCurveTo(j,D+F,j,D+F-V),n.lineTo(j,D+V),n.quadraticCurveTo(j,D,j+V,D),n.closePath(),n.fillStyle="rgba(0,0,0,0.6)",n.fill(),n.fillStyle=P,n.fillText(S,_,w+.5),n.restore()}function h(_,w,S){n.save(),n.strokeStyle=S,n.lineWidth=1,n.setLineDash([4,3]),n.beginPath(),n.moveTo(_-10,w),n.lineTo(_+10,w),n.stroke(),n.setLineDash([]),n.restore()}for(let _=c;_<=d;_++){const w=r[_];if(!w||!w.bullTrap&&!w.bearTrap&&!w.normal)continue;const S=o.convertToPixel(_),P=a[_];if(P){if(w.bullTrap){const I=i.convertToPixel(P.high)-12;p(S,I,"#EF4444","bull");const M=I-16,F=`Bull Trap ${((w.score??0)*100).toFixed(0)}%`;if(m(S,M,F,"#F59E0B"),w.breakoutLevel){const V=i.convertToPixel(w.breakoutLevel);h(S,V,"#F59E0B")}}if(w.bearTrap){const I=i.convertToPixel(P.low)+12;p(S,I,"#10B981","bear");const M=I+16,F=`Bear Trap ${((w.score??0)*100).toFixed(0)}%`;if(m(S,M,F,"#34D399"),w.breakoutLevel){const V=i.convertToPixel(w.breakoutLevel);h(S,V,"#34D399")}}if(w.normal){const I=(P.high+P.low)/2,C=i.convertToPixel(I);p(S,C,"#3B82F6","normal"),m(S,C-16,"Stable","#60A5FA")}}}return!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{var c;const o=(c=e.result)==null?void 0:c[n];if(!o||!o.bullTrap&&!o.bearTrap&&!o.normal)return{values:[]};const i=o.normal?"Stable":o.bullTrap?"Bull Trap":"Bear Trap",r=o.score!==void 0?Number(o.score).toFixed(2):"—",a=o.breakoutLevel!==void 0?Number(o.breakoutLevel).toFixed(e.precision??2):"—",l=o.reversalClose!==void 0?Number(o.reversalClose).toFixed(e.precision??2):"—";return{styles:t,values:[{title:"Trap",value:i},...o.normal?[]:[{title:"Score",value:r},{title:"Level",value:a},{title:"Reversal",value:l}]]}}};function eg(n,e,t){return Math.max(e,Math.min(t,n))}function hw(n,e){const t=n.length,o=new Array(t).fill(0);if(e<=1){for(let r=0;r<t;r++)o[r]=n[r]??0;return o}let i=0;for(let r=0;r<t;r++)i+=n[r]??0,r>=e&&(i-=n[r-e]??0),o[r]=r>=e-1?i/e:0;return o}function eM(n,e){var i,r,a;const t=n.length,o=new Array(t).fill(0);for(let l=0;l<t;l++){const c=((i=n[l])==null?void 0:i.high)??0,d=((r=n[l])==null?void 0:r.low)??0;if(l===0)o[l]=Math.max(0,c-d);else{const p=((a=n[l-1])==null?void 0:a.close)??0;o[l]=Math.max(c-d,Math.abs(c-p),Math.abs(d-p))}}return hw(o,Math.max(1,e))}function tM(n){var i,r,a;const e=n.length,t=new Array(e).fill(0);let o=0;for(let l=0;l<e;l++){if(l===0)o=0;else{const c=((i=n[l])==null?void 0:i.close)??0,d=((r=n[l-1])==null?void 0:r.close)??0,p=((a=n[l])==null?void 0:a.volume)??0;c>d?o+=p:c<d&&(o-=p)}t[l]=o}return t}function e1(n,e,t){let o=0,i=0;for(let r=e;r<=t;r++)o+=n[r]??0,i++;return i>0?o/i:0}function nM(n,e,t,o){if(t<=e)return 0;const i=(n[t]-n[e])/(t-e),r=o>0?i/(o*5):0;return eg(r,-1,1)}function oM(n,e,t){var l,c;const o=Math.max(0,e-t),i=Math.max(0,e-1),r=((l=n[o])==null?void 0:l.close)??0,a=((c=n[i])==null?void 0:c.close)??0;return r<=0?0:(a-r)/r}function ub(n,e,t,o,i,r,a){var Fe,Ze,Ge,it,Ye,ct,kt,ft,bt;const l=[],c=[],d=[];for(let nt=i;nt<=r;nt++)l.push(((Fe=n[nt])==null?void 0:Fe.high)??0),c.push(((Ze=n[nt])==null?void 0:Ze.low)??0),d.push(((Ge=n[nt])==null?void 0:Ge.close)??0);const p=Math.max(...l),m=Math.min(...c),h=(p+m)/2,_=p-m;if(h<=0)return null;const w=_/h;if(!isFinite(w)||w<=0||w>a.maxZoneWidthPct)return null;const S=e1(o,i,r);if(!(S>=a.minVolumeFactor))return null;const P=[];for(let nt=i;nt<=r;nt++)P.push((((it=n[nt])==null?void 0:it.high)??0)-(((Ye=n[nt])==null?void 0:Ye.low)??0));const I=P.length?P.reduce((nt,Pt)=>nt+Pt,0)/P.length:0,C=e1(t,i,r);if(C>0&&I/C>1.8)return null;let M=0;for(let nt=i;nt<=r;nt++){const Pt=((ct=n[nt])==null?void 0:ct.close)??0;(kt=n[nt])==null||kt.open;const Qe=_>0?eg((Pt-m)/_,0,1):.5;M+=Qe}const F=M/Math.max(1,r-i+1)||.5,V=oM(n,i,a.priorTrendLookback),j=V<=-.05,D=V>=.05,R=j?eg(Math.abs(V)/.15,0,1):0,W=D?eg(Math.abs(V)/.15,0,1):0,J=e1(n.map(nt=>(nt==null?void 0:nt.volume)??0),i,r),Z=nM(e,i,r,J),G=eg((F-.5)/.3+.5,0,1),se=eg((S-a.minVolumeFactor)/Math.max(1e-6,a.minVolumeFactor),0,1),Y=.3,oe=.3,ee=.2,re=.2,me=Y*R+oe*eg((Z-a.minOBVTrendStrength)/(1-a.minOBVTrendStrength),0,1)+ee*G+re*se,K=Y*W+oe*eg((-Z-a.minOBVTrendStrength)/(1-a.minOBVTrendStrength),0,1)+ee*(1-G)+re*se,ye=eg(Math.max(me,K),0,1);if(ye<a.minZoneScore)return null;const Me=me>K?"accumulation":"distribution";return{startIndex:i,endIndex:r,startTime:((ft=n[i])==null?void 0:ft.timestamp)??0,endTime:((bt=n[r])==null?void 0:bt.timestamp)??0,low:m,high:p,type:Me,score:ye,priorReturn:V,avgVolumeFactor:S,obvTrendScore:Z}}function pb(n,e){if(!e.mergeNearbyZones||n.length<=1)return n.slice(0,e.maxZonesDisplayed);const t=n.slice().sort((l,c)=>l.startIndex-c.startIndex),o=[],i=Math.max(2,Math.floor(e.minZoneBars/2)),r=Math.max(.01,e.maxZoneWidthPct*1.5);function a(l,c){const d=(l.low+l.high)/2,p=(c.low+c.high)/2;return d<=0||p<=0?!1:Math.abs(d-p)/((d+p)/2)<=r}for(const l of t){if(o.length===0){o.push(l);continue}const c=o[o.length-1];if(l.startIndex<=c.endIndex+i&&l.type===c.type&&a(c,l)){const p=Math.min(c.low,l.low),m=Math.max(c.high,l.high);o[o.length-1]={startIndex:Math.min(c.startIndex,l.startIndex),endIndex:Math.max(c.endIndex,l.endIndex),startTime:Math.min(c.startTime,l.startTime),endTime:Math.max(c.endTime,l.endTime),low:p,high:m,type:c.type,score:Math.max(c.score,l.score),priorReturn:Math.abs(l.score)>=Math.abs(c.score)?l.priorReturn:c.priorReturn,avgVolumeFactor:(c.avgVolumeFactor+l.avgVolumeFactor)/2,obvTrendScore:(c.obvTrendScore+l.obvTrendScore)/2}}else o.push(l)}return o.sort((l,c)=>c.score-l.score).slice(0,e.maxZonesDisplayed).sort((l,c)=>l.startIndex-c.startIndex)}const sM={name:"SMART_MONEY",shortName:"SMF",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,figures:[],styles:{},calc:(n,e)=>{const t=e.calcParams||[],o={zoneLookbackBars:Math.max(10,t[0]??40),minZoneBars:Math.max(3,t[1]??5),maxZoneBars:Math.max(5,t[2]??25),atrPeriod:Math.max(1,t[3]??14),volumeMAPeriod:Math.max(1,t[4]??20),minVolumeFactor:t[5]??1.2,maxZoneWidthPct:t[6]??.03,priorTrendLookback:Math.max(1,t[7]??20),minOBVTrendStrength:t[8]??.2,minZoneScore:t[9]??.6,mergeNearbyZones:(t[10]??1)>0,maxZonesDisplayed:Math.max(1,t[11]??20),showLabels:(t[12]??1)>0},i=n.length,r=new Array(i).fill({});if(i===0)return e.zones=[],e.cfg=o,r;const a=eM(n,o.atrPeriod),l=n.map(_=>(_==null?void 0:_.volume)??0),c=hw(l,o.volumeMAPeriod),d=l.map((_,w)=>{const S=c[w]||0;return S>0?_/S:0}),p=tM(n);let m=[];for(let _=0;_<i;_++){const w=_,S=Math.min(o.zoneLookbackBars,w+1),P=[],I=o.minZoneBars,C=Math.min(o.maxZoneBars,S);if(C>=I){const M=Math.floor((I+C)/2);P.push(I),M!==I&&M!==C&&P.push(M),C!==I&&P.push(C)}for(const M of P){const F=w-M+1;if(F<0)continue;const V=ub(n,p,a,d,F,w,o);V&&m.push(V)}}let h=pb(m,o);if(h.length===0&&i>=Math.max(60,o.minZoneBars*4)){const _={...o,maxZoneWidthPct:o.maxZoneWidthPct*2,minVolumeFactor:Math.min(o.minVolumeFactor,.9),minOBVTrendStrength:Math.max(.05,o.minOBVTrendStrength*.5),minZoneScore:Math.max(.4,o.minZoneScore-.15)};m=[];for(let w=0;w<i;w++){const S=w,P=Math.min(_.zoneLookbackBars,S+1),I=[],C=_.minZoneBars,M=Math.min(_.maxZoneBars,P);if(M>=C){const F=Math.floor((C+M)/2);I.push(C),F!==C&&F!==M&&I.push(F),M!==C&&I.push(M)}for(const F of I){const V=S-F+1;if(V<0)continue;const j=ub(n,p,a,d,V,S,_);j&&m.push(j)}}h=pb(m,_)}return e.zones=h,e.cfg=o,r},draw:({ctx:n,chart:e,indicator:t,xAxis:o,yAxis:i})=>{const r=t.zones||[];if(!r.length)return!1;const a=t.cfg||{},l=e.getVisibleRange(),c=Math.max(0,l.from),d=l.to,p="rgba(16, 185, 129, 0.28)",m="rgba(16, 185, 129, 0.7)",h="rgba(239, 68, 68, 0.28)",_="rgba(239, 68, 68, 0.7)";n.save();for(const w of r){if(w.endIndex<c||w.startIndex>d)continue;const S=o.convertToPixel(w.startIndex),P=o.convertToPixel(w.endIndex),I=i.convertToPixel(w.high),C=i.convertToPixel(w.low);if(!isFinite(S)||!isFinite(P)||I==null||C==null)continue;const M=Math.min(S,P),F=Math.max(1,Math.abs(P-S)),V=Math.min(I,C),j=Math.abs(I-C);n.fillStyle=w.type==="accumulation"?p:h;const D=n.roundRect??n.rect;n.beginPath();try{D.call(n,M,V,F,j,4)}catch{n.rect(M,V,F,j)}if(n.closePath(),n.fill(),n.strokeStyle=w.type==="accumulation"?m:_,n.lineWidth=1.5,n.setLineDash([]),n.stroke(),a.showLabels){const R=`${w.type==="accumulation"?"Accumulation":"Distribution"} (${w.score.toFixed(2)})`,W=M+F+6,J=V+j/2;n.save(),n.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",n.textAlign="left",n.textBaseline="middle";const Z=w.type==="accumulation"?"#10B981":"#EF4444",G="rgba(0,0,0,0.55)",se=6,Y=n.measureText(R),oe=Math.ceil(Y.width)+se*2,ee=16,re=4,me=W,K=J-ee/2;n.beginPath(),n.moveTo(me+re,K),n.lineTo(me+oe-re,K),n.quadraticCurveTo(me+oe,K,me+oe,K+re),n.lineTo(me+oe,K+ee-re),n.quadraticCurveTo(me+oe,K+ee,me+oe-re,K+ee),n.lineTo(me+re,K+ee),n.quadraticCurveTo(me,K+ee,me,K+ee-re),n.lineTo(me,K+re),n.quadraticCurveTo(me,K,me+re,K),n.closePath(),n.fillStyle=G,n.fill(),n.fillStyle=Z,n.fillText(R,me+se,J+.5),n.restore()}}return n.restore(),!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{const i=(e.zones||[]).find(l=>n>=l.startIndex&&n<=l.endIndex);if(!i)return{values:[]};const r=i.type==="accumulation"?"Accumulation":"Distribution",a=i.endIndex-i.startIndex+1;return{styles:t,values:[{title:"Footprint",value:r},{title:"Score",value:i.score.toFixed(2)},{title:"Price",value:`${i.low.toFixed(e.precision??2)}–${i.high.toFixed(e.precision??2)}`},{title:"Duration",value:`${a} bars`},{title:"Prior Trend",value:`${(i.priorReturn*100).toFixed(1)}%`},{title:"Avg Volume x",value:i.avgVolumeFactor.toFixed(2)},{title:"OBV Trend",value:i.obvTrendScore>.05?"Up":i.obvTrendScore<-.05?"Down":"Flat"}]}}},md={bbPeriod:16,bbStdDev:2,atrPeriod:14,volMAPeriod:20,lookbackForNorm:60,pressureSMA:2,minPressureForAlert:.55,eruptionConfirmBars:1,minVolExpansion:1,minRangeExpansion:1,minBreakoutBodyPct:.5,breakoutLookback:10,w1:.5,w2:.3,w3:.2,minBarsBetweenEruptions:1,trendEMAPeriod:30,requireTrendAlign:0,breakoutBufferPct:7e-4,requireBBBandBreak:0,retestWindow:1};function n_(n,e,t){return Math.max(e,Math.min(t,n))}function t1(n,e){const t=new Array(n.length).fill(0);if(e<=1){for(let i=0;i<n.length;i++)t[i]=n[i]??0;return t}let o=0;for(let i=0;i<n.length;i++)o+=n[i]??0,i>=e&&(o-=n[i-e]??0),t[i]=i>=e-1?o/e:NaN;return t}function iM(n,e){const t=new Array(n.length).fill(NaN);if(e<=1)return n.map(()=>0);for(let o=0;o<n.length;o++){if(o<e-1)continue;let i=0;for(let l=o-e+1;l<=o;l++)i+=n[l]??0;const r=i/e;let a=0;for(let l=o-e+1;l<=o;l++){const c=(n[l]??0)-r;a+=c*c}t[o]=Math.sqrt(a/e)}return t}function rM(n,e){const t=new Array(n.length).fill(NaN);if(e<=1)return n.slice();const o=2/(e+1);let i=NaN;for(let r=0;r<n.length;r++){const a=n[r]??0;if(Number.isFinite(i))i=a*o+i*(1-o),t[r]=i;else if(r>=e-1){let l=0;for(let c=r-e+1;c<=r;c++)l+=n[c]??0;i=l/e,t[r]=i}}return t}function _w(n,e){if(!n)return 0;const t=n.high??0,o=n.low??0,i=(e==null?void 0:e.close)??n.close??0;return Math.max(t-o,Math.abs(t-i),Math.abs(o-i))}function aM(n,e){const t=n.map((r,a)=>_w(r,a>0?n[a-1]:void 0)),o=new Array(n.length).fill(NaN);if(e<=1)return t;let i=0;for(let r=0;r<t.length;r++)i+=t[r]??0,r===e-1?o[r]=i/e:r>=e&&(o[r]=((o[r-1]??0)*(e-1)+(t[r]??0))/e);return o}function vb(n,e){const t=new Array(n.length).fill(NaN);for(let o=0;o<n.length;o++){const i=Math.max(0,o-e+1);let r=1/0;for(let a=i;a<=o;a++)Number.isFinite(n[a])&&n[a]<r&&(r=n[a]);t[o]=r===1/0?NaN:r}return t}function fb(n,e){const t=new Array(n.length).fill(NaN);for(let o=0;o<n.length;o++){const i=Math.max(0,o-e+1);let r=-1/0;for(let a=i;a<=o;a++)Number.isFinite(n[a])&&n[a]>r&&(r=n[a]);t[o]=r===-1/0?NaN:r}return t}function mb(n,e,t){return!Number.isFinite(e)||!Number.isFinite(t)||t===e?.5:n_((n-e)/(t-e),0,1)}function lM(n,e,t){const o=Math.max(0,e-t);let i=-1/0;for(let r=o;r<e;r++)n[r]&&(n[r].high??-1/0)>i&&(i=n[r].high);return i===-1/0?NaN:i}function cM(n,e,t){const o=Math.max(0,e-t);let i=1/0;for(let r=o;r<e;r++)n[r]&&(n[r].low??1/0)<i&&(i=n[r].low);return i===1/0?NaN:i}function yw(n,e){const t={...md,...e},o=n.length,i=n.map(K=>(K==null?void 0:K.close)??0),r=n.map(K=>(K==null?void 0:K.volume)??0);if(o===0)return{pressure:[],pressureSmoothed:[],eruptions:[]};const a=t1(i,t.bbPeriod),l=iM(i,t.bbPeriod),c=new Array(o).fill(NaN),d=new Array(o).fill(NaN),p=new Array(o).fill(NaN);for(let K=0;K<o;K++)if(Number.isFinite(a[K])&&Number.isFinite(l[K])){c[K]=a[K]+t.bbStdDev*l[K],d[K]=a[K]-t.bbStdDev*l[K];const ye=c[K]-d[K],Me=i[K]||1;p[K]=Me!==0?ye/Math.abs(Me):0}const m=Math.max(2,t.trendEMAPeriod??50),h=rM(i,m),_=aM(n,t.atrPeriod),w=_.map((K,ye)=>{const Me=i[ye]||1;return Me!==0?(K??0)/Math.abs(Me):0}),S=t1(r,t.volMAPeriod),P=r.map((K,ye)=>{const Me=S[ye]??0;return Me>0?K/Me:0}),I=Math.max(10,t.lookbackForNorm),C=vb(p,I),M=fb(p,I),F=vb(w,I),V=fb(w,I),j=new Array(o).fill(0),D=new Array(o).fill(0),R=new Array(o).fill(0);for(let K=0;K<o;K++){const ye=mb(p[K]??0,C[K],M[K]),Me=mb(w[K]??0,F[K],V[K]);j[K]=1-ye,D[K]=1-Me;const Fe=Math.max(P[K]??0,1e-8),Ze=n_(1/Fe,0,2);R[K]=n_(Ze/2,0,1)}const W=t.w1??.5,J=t.w2??.3,Z=t.w3??.2,G=new Array(o).fill(0);for(let K=0;K<o;K++){const ye=W*j[K]+J*D[K]+Z*R[K];G[K]=n_(ye,0,1)}const se=t1(G,Math.max(1,t.pressureSMA)).map(K=>Number.isFinite(K)?K:0),Y=[],oe=Math.max(1,t.minBarsBetweenEruptions??8);let ee=-1e4,re=!1,me=-1;for(let K=0;K<o;K++){const ye=se[K]??0;if(ye>=t.minPressureForAlert?re||(re=!0,me=K):re=!1,!(re||me>=0&&K-me<=t.eruptionConfirmBars+2)||K-ee<oe)continue;const Fe=_w(n[K],K>0?n[K-1]:void 0),Ze=_[K]??Fe,Ge=Ze>0?Fe/Ze:0;if(Ge<t.minRangeExpansion)continue;const it=P[K]??0;if(it<t.minVolExpansion)continue;const Ye=n[K],ct=Math.max(0,(Ye.high??0)-(Ye.low??0)),kt=Math.abs((Ye.close??0)-(Ye.open??0));if((ct>0?kt/ct:0)<t.minBreakoutBodyPct)continue;const bt=lM(n,K,t.breakoutLookback),nt=cM(n,K,t.breakoutLookback),Pt=Math.max(0,t.breakoutBufferPct??.001),Qe=(t.requireBBBandBreak??1)>0,yt=(t.requireTrendAlign??1)>0,xe=h[K],Ve=K>0?h[K-1]:xe,Je=Number.isFinite(xe)&&Number.isFinite(Ve)&&(Ye.close??0)>xe&&xe>=Ve,St=Number.isFinite(xe)&&Number.isFinite(Ve)&&(Ye.close??0)<xe&&xe<=Ve,Ne=c[K],ue=d[K];let he=Number.isFinite(bt)&&(Ye.close??0)>bt*(1+Pt),_t=Number.isFinite(nt)&&(Ye.close??0)<nt*(1-Pt);if(Qe&&(he=he&&Number.isFinite(Ne)&&(Ye.close??0)>Ne,_t=_t&&Number.isFinite(ue)&&(Ye.close??0)<ue),yt&&(he=he&&Je,_t=_t&&St),!he&&!_t)continue;const Wt=K,jt=Math.min(o-1,Wt+Math.max(1,t.eruptionConfirmBars));let Zt=0,dn=!0;const zn=Math.max(1,t.retestWindow??2);if(he)for(let On=Wt;On<=jt;On++){const no=n[On];(no.close??0)>=(Ye.high??0)&&Zt++,On<=Wt+zn&&Number.isFinite(bt)&&(no.close??0)<bt&&(dn=!1)}else if(_t)for(let On=Wt;On<=jt;On++){const no=n[On];(no.close??0)<=(Ye.low??0)&&Zt++,On<=Wt+zn&&Number.isFinite(nt)&&(no.close??0)>nt&&(dn=!1)}const un=Math.ceil((jt-Wt+1)/2);if(dn&&Zt>=un){const On=he?"bullish":"bearish",no=he?bt:nt;Y.push({index:Wt,time:Ye.timestamp??0,direction:On,pressureAtSignal:ye,rangeExpansion:Ge,volumeFactor:it,breakoutLevel:no}),ee=Wt}}return{pressure:G,pressureSmoothed:se,eruptions:Y}}const dM={name:"VOLCANIC",shortName:"VOLC",precision:2,shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,minValue:0,maxValue:1,figures:[{key:"pressure",title:"Pressure: ",type:"line"}],styles:{lines:[{color:"#60A5FA",size:2,style:Ke.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams,o={bbPeriod:(t==null?void 0:t[0])??md.bbPeriod,bbStdDev:(t==null?void 0:t[1])??md.bbStdDev,atrPeriod:(t==null?void 0:t[2])??md.atrPeriod,volMAPeriod:(t==null?void 0:t[3])??md.volMAPeriod,lookbackForNorm:(t==null?void 0:t[4])??md.lookbackForNorm,pressureSMA:(t==null?void 0:t[5])??md.pressureSMA,minPressureForAlert:(t==null?void 0:t[6])??md.minPressureForAlert,eruptionConfirmBars:(t==null?void 0:t[7])??md.eruptionConfirmBars,minVolExpansion:(t==null?void 0:t[8])??md.minVolExpansion,minRangeExpansion:(t==null?void 0:t[9])??md.minRangeExpansion,minBreakoutBodyPct:(t==null?void 0:t[10])??md.minBreakoutBodyPct,breakoutLookback:(t==null?void 0:t[11])??md.breakoutLookback,minBarsBetweenEruptions:(t==null?void 0:t[12])??md.minBarsBetweenEruptions,trendEMAPeriod:(t==null?void 0:t[13])??md.trendEMAPeriod??30,requireTrendAlign:(t==null?void 0:t[14])??md.requireTrendAlign??0,breakoutBufferPct:(t==null?void 0:t[15])??md.breakoutBufferPct??7e-4,requireBBBandBreak:(t==null?void 0:t[16])??md.requireBBBandBreak??0,retestWindow:(t==null?void 0:t[17])??md.retestWindow??1},{pressureSmoothed:i}=yw(n,o);return i.map(r=>({pressure:Number.isFinite(r)?r:null}))},draw:({ctx:n,chart:e,indicator:t,bounding:o,xAxis:i,yAxis:r})=>{var M,F,V,j,D,R,W;const a=t.result;if(!a||a.length===0)return!1;const l=e.getVisibleRange(),c=Math.max(0,l.from),d=Math.min(a.length-1,l.to),p=t.calcParams,m=(p==null?void 0:p[6])??md.minPressureForAlert,h=((V=(F=(M=t.styles)==null?void 0:M.lines)==null?void 0:F[0])==null?void 0:V.color)||"#60A5FA",_="#F59E0B",w=((R=(D=(j=t.styles)==null?void 0:j.lines)==null?void 0:D[0])==null?void 0:R.size)||2;n.save(),n.lineCap="round",n.lineJoin="round";const S=r.convertToPixel(m);S!==null&&(n.strokeStyle="#9CA3AF",n.lineWidth=1,n.setLineDash([4,4]),n.beginPath(),n.moveTo(o.left,S),n.lineTo(o.left+o.width,S),n.stroke(),n.setLineDash([]));let P=null,I=null,C=null;for(let J=c;J<=d;J++){const Z=((W=a[J])==null?void 0:W.pressure)??null;if(Z==null){P=I=C=null;continue}const G=i.convertToPixel(J),se=r.convertToPixel(Z);if(G===null||se===null){P=I=C=null;continue}if(P!==null&&I!==null&&C!==null){const Y=(C+Z)/2;n.strokeStyle=Y>=m?_:h,n.lineWidth=w,n.beginPath(),n.moveTo(P,I),n.lineTo(G,se),n.stroke()}P=G,I=se,C=Z}return n.restore(),!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{const o=e.result[n];if(!o)return{values:[]};const i=e.calcParams,r=(i==null?void 0:i[6])??md.minPressureForAlert,a=o.pressure!==null&&o.pressure!==void 0?Number(o.pressure).toFixed(2):"—";return{styles:t,values:[{title:"Pressure",value:a},{title:"Alert ≥",value:Number(r).toFixed(2)}]}}},uM={name:"VOLCANIC_SIG",shortName:"VOLCSIG",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,figures:[],styles:{texts:[{color:"#ffffff",size:10}]},calc:(n,e)=>{const t=e.calcParams,o={bbPeriod:(t==null?void 0:t[0])??md.bbPeriod,bbStdDev:(t==null?void 0:t[1])??md.bbStdDev,atrPeriod:(t==null?void 0:t[2])??md.atrPeriod,volMAPeriod:(t==null?void 0:t[3])??md.volMAPeriod,lookbackForNorm:(t==null?void 0:t[4])??md.lookbackForNorm,pressureSMA:(t==null?void 0:t[5])??md.pressureSMA,minPressureForAlert:(t==null?void 0:t[6])??md.minPressureForAlert,eruptionConfirmBars:(t==null?void 0:t[7])??md.eruptionConfirmBars,minVolExpansion:(t==null?void 0:t[8])??md.minVolExpansion,minRangeExpansion:(t==null?void 0:t[9])??md.minRangeExpansion,minBreakoutBodyPct:(t==null?void 0:t[10])??md.minBreakoutBodyPct,breakoutLookback:(t==null?void 0:t[11])??md.breakoutLookback,minBarsBetweenEruptions:(t==null?void 0:t[12])??md.minBarsBetweenEruptions,trendEMAPeriod:(t==null?void 0:t[13])??md.trendEMAPeriod??30,requireTrendAlign:(t==null?void 0:t[14])??md.requireTrendAlign??0,breakoutBufferPct:(t==null?void 0:t[15])??md.breakoutBufferPct??7e-4,requireBBBandBreak:(t==null?void 0:t[16])??md.requireBBBandBreak??0,retestWindow:(t==null?void 0:t[17])??md.retestWindow??1},{eruptions:i}=yw(n,o),r=new Array(n.length).fill(null).map(()=>({}));return i.forEach(a=>{const l=r[a.index]||{};a.direction==="bullish"&&(l.bull=!0),a.direction==="bearish"&&(l.bear=!0),l.pressure=a.pressureAtSignal,l.rangeExpansion=a.rangeExpansion,l.volumeFactor=a.volumeFactor,l.breakoutLevel=a.breakoutLevel,r[a.index]=l}),r},draw:({ctx:n,chart:e,indicator:t,xAxis:o,yAxis:i})=>{const r=t.result;if(!r||r.length===0)return!1;const a=e.getDataList(),l=e.getVisibleRange(),c=Math.max(0,l.from),d=Math.min(r.length-1,l.to);function p(h,_,w,S){n.save(),n.fillStyle=w,n.beginPath(),S?(n.moveTo(h,_+6),n.lineTo(h-5,_-4),n.lineTo(h+5,_-4)):(n.moveTo(h,_-6),n.lineTo(h-5,_+4),n.lineTo(h+5,_+4)),n.closePath(),n.fill(),n.restore()}function m(h,_,w,S){n.save(),n.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",n.textAlign="center",n.textBaseline="middle";const P=6,I=16,C=n.measureText(w),M=Math.ceil(C.width)+P*2,F=4,V=h-M/2,j=_-I/2;n.fillStyle="rgba(0,0,0,0.6)",n.beginPath(),n.moveTo(V+F,j),n.lineTo(V+M-F,j),n.quadraticCurveTo(V+M,j,V+M,j+F),n.lineTo(V+M,j+I-F),n.quadraticCurveTo(V+M,j+I,V+M-F,j+I),n.lineTo(V+F,j+I),n.quadraticCurveTo(V,j+I,V,j+I-F),n.lineTo(V,j+F),n.quadraticCurveTo(V,j,V+F,j),n.closePath(),n.fill(),n.fillStyle=S,n.fillText(w,h,_+.5),n.restore()}for(let h=c;h<=d;h++){const _=r[h];if(!_||!_.bull&&!_.bear)continue;const w=o.convertToPixel(h),S=a[h];if(S){if(_.bull){const P=i.convertToPixel(S.low)+12;p(w,P,"#F59E0B",!0),m(w,P+16,"Volcanic Move (Bullish)","#F59E0B")}if(_.bear){const P=i.convertToPixel(S.high)-12;p(w,P,"#EF4444",!1),m(w,P-16,"Volcanic Move (Bearish)","#EF4444")}}}return!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{var c;const o=(c=e.result)==null?void 0:c[n];if(!o||!o.bull&&!o.bear)return{values:[]};const i=o.bull?"Bullish":"Bearish",r=o.pressure!==void 0?Number(o.pressure).toFixed(2):"—",a=o.rangeExpansion!==void 0?Number(o.rangeExpansion).toFixed(2):"—",l=o.volumeFactor!==void 0?Number(o.volumeFactor).toFixed(2):"—";return{styles:t,values:[{title:"Eruption",value:i},{title:"Pressure",value:r},{title:"Range x",value:a},{title:"Volume x",value:l}]}}};function pM(n,e,t,o,i,r,a){const l=o*.4,c=i*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.lineJoin="round",n.beginPath(),n.moveTo(e-l,t-c),n.lineTo(e+l,t+c),n.moveTo(e+l,t-c),n.lineTo(e-l,t+c),n.stroke(),n.restore()}function vM(n,e,t,o,i,r,a){const l=o*.4,c=i*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.beginPath(),n.ellipse(e,t,l,c,0,0,Math.PI*2),n.stroke(),n.restore()}const fM={name:"PNF",shortName:"P&F",calcParams:[],figures:[],calc:(n,e)=>n.map(t=>{const o=t==null?void 0:t._pnf;return o?{direction:o.direction,boxes:o.boxes,upColor:o.upColor,downColor:o.downColor,boxSize:o.boxSize}:{}}),draw:n=>{var I,C;const{ctx:e,visibleRange:t,indicator:o,xAxis:i,yAxis:r}=n,a=o.result||[];if(!(i!=null&&i.convertToPixel)||!(r!=null&&r.convertToPixel))return!1;const l=i.convertToPixel(0),c=i.convertToPixel(1),d=Math.max(1,Math.abs(c-l));let p=d;for(const M of a)if(M!=null&&M.boxes&&M.boxes.length>=2&&(r!=null&&r.convertToPixel)){const F=M.boxes[0],V=M.boxes[1],j=r.convertToPixel(F.price),D=r.convertToPixel(V.price);if(j!==void 0&&D!==void 0&&!isNaN(j)&&!isNaN(D)){const R=Math.abs(j-D);if(R>0){p=R;break}}}if(p===d){const M=a.find(F=>(F==null?void 0:F.boxSize)&&F.boxSize>0);if(M!=null&&M.boxSize){const F=((C=(I=M.boxes)==null?void 0:I[0])==null?void 0:C.price)||100,V=r.convertToPixel(F),j=r.convertToPixel(F+M.boxSize);if(V!==void 0&&j!==void 0&&!isNaN(V)&&!isNaN(j)){const D=Math.abs(V-j);D>0&&(p=D)}}}const m=d*.85,h=p*.85,_=(m+h)/2,w=Math.max(.8,_*.08),S=(t==null?void 0:t.from)||0,P=(t==null?void 0:t.to)||a.length;for(let M=S;M<P;M++){const F=a[M];if(!F||!F.boxes||!Array.isArray(F.boxes))continue;const{direction:V,boxes:j,upColor:D="#00E6D8",downColor:R="#FF4D4D"}=F,W=i.convertToPixel(M);if(!(W===void 0||isNaN(W)))for(const J of j){const Z=r.convertToPixel(J.price);Z===void 0||isNaN(Z)||(V==="up"?pM(e,W,Z,m,h,D,w):vM(e,W,Z,m,h,R,w))}}return!1}},mM=[_I,yI,xI,wI,mw,CI,II,MI,AI,LI,$I,EI,NI,DI,jI,BI,OI,zI,VI,qI,HI,GI,YI,KI,QI,sM,dM,uM,fM];function gM(n,e){e?console.log(n,e):console.log(n)}function Mh(){return Date.now()}function N0(n,e){const t=n.country||"__";return`${n.ticker}_${t}_${e}`}function D0(n){return{key:n.key,symbol:n.symbol.ticker,timeframe:n.timeframe,candles:n.candles,oldestTimestampLoaded:n.oldest,newestTimestampLoaded:n.newest,isComplete:n.isComplete,isRunning:n.isRunning,pipelineStarts:n.starts,apiCalls:n.apiCalls,lastUpdatedAt:n.lastUpdatedAt,error:n.error}}function hM(n,e){var i;let t=0,o=n.length;for(;t<o;){const r=t+o>>>1;(((i=n[r])==null?void 0:i.timestamp)??0)>=e?o=r:t=r+1}return t}function gb(n,e){return n<=0?Promise.resolve():new Promise((t,o)=>{const i=setTimeout(t,n);if(!e)return;const r=()=>{clearTimeout(i),o(new DOMException("Aborted","AbortError"))};if(e.aborted)return r();e.addEventListener("abort",r,{once:!0})})}class _M{constructor(e,t={}){Ce(this,"entries",new Map);Ce(this,"fetchPage");Ce(this,"opt");this.fetchPage=e,this.opt={maxKeys:t.maxKeys??16,ttlMs:t.ttlMs??20*6e4,initialLimit:t.initialLimit??600,pageLimit:t.pageLimit??800,pageDelayMs:t.pageDelayMs??75,maxRetries:t.maxRetries??2,retryBaseDelayMs:t.retryBaseDelayMs??400,log:t.log??gM}}start(e,t){const o=N0(e,t),i=this.getOrCreate(e,t);return this.touch(i),this.ensureRunning(i),{key:o,getSnapshot:()=>this.getSnapshot(e,t),subscribe:r=>this.subscribe(e,t,r)}}getSnapshot(e,t){const o=N0(e,t),i=this.entries.get(o);return i?(this.touch(i),D0(i)):{key:o,symbol:e.ticker,timeframe:t,candles:[],oldestTimestampLoaded:null,newestTimestampLoaded:null,isComplete:!1,isRunning:!1,pipelineStarts:0,apiCalls:0,lastUpdatedAt:0,error:null}}async waitForInitial(e,t){const o=this.getOrCreate(e,t);return this.touch(o),this.ensureRunning(o),await this.ensureInitialLoaded(o,o.generation),D0(o)}requestVisibleRange(e){const t=this.entries.get(N0(e.symbol,e.timeframe));if(!t||t.candles.length===0)return[];this.touch(t);const o=hM(t.candles,e.beforeTimestamp),i=Math.max(0,o-Math.max(1,e.limit));return t.candles.slice(i,o)}stopSymbol(e){for(const t of this.entries.values())t.symbol.ticker===e&&this.stopEntry(t)}stopAll(){for(const e of this.entries.values())this.stopEntry(e)}clear(){this.stopAll(),this.entries.clear()}subscribe(e,t,o){const i=this.getOrCreate(e,t);this.touch(i),i.subs.add(o);try{o(D0(i))}catch{}return()=>{i.subs.delete(o)}}getMetrics(){const e=[];for(const t of this.entries.values())e.push({key:t.key,pipelineStarts:t.starts,apiCalls:t.apiCalls,isRunning:t.isRunning,isComplete:t.isComplete,error:t.error});return e}emit(e){const t=D0(e);for(const o of e.subs)try{o(t)}catch{}}touch(e){e.lastAccessAt=Mh(),this.entries.get(e.key)===e&&(this.entries.delete(e.key),this.entries.set(e.key,e)),this.evictIfNeeded()}evictIfNeeded(){const e=Mh()-this.opt.ttlMs;for(;;){const t=this.entries.keys().next().value;if(!t)break;const o=this.entries.get(t);if(!o){this.entries.delete(t);continue}if(o.lastAccessAt>=e)break;this.stopEntry(o),this.entries.delete(t)}for(;this.entries.size>this.opt.maxKeys;){const t=this.entries.keys().next().value;if(!t)break;const o=this.entries.get(t);if(!o){this.entries.delete(t);continue}this.stopEntry(o),this.entries.delete(t)}}getOrCreate(e,t){const o=N0(e,t),i=this.entries.get(o);if(i)return i;const r={key:o,symbol:e,timeframe:t,candles:[],ts:new Set,oldest:null,newest:null,isComplete:!1,isRunning:!1,starts:0,apiCalls:0,lastUpdatedAt:0,lastAccessAt:Mh(),error:null,nextSkip:0,generation:0,initialPromise:null,runPromise:null,abort:null,subs:new Set};return this.entries.set(o,r),r}ensureRunning(e){if(e.isComplete||e.runPromise)return;e.isRunning=!0,e.error=null,e.generation+=1,e.starts+=1,e.abort||(e.abort=new AbortController);const t=e.generation;this.opt.log("📡 [pipeline:start]",{key:e.key,gen:t});const o=this.runLoop(e,t).finally(()=>{e.runPromise===o&&(e.runPromise=null),e.isRunning=!1,e.abort=null,this.emit(e),this.opt.log("⏹️ [pipeline:stop]",{key:e.key,gen:t,complete:e.isComplete})});e.runPromise=o}stopEntry(e){var t;e.generation+=1,e.isRunning=!1,e.initialPromise=null;try{(t=e.abort)==null||t.abort()}catch{}e.abort=null}async ensureInitialLoaded(e,t){e.candles.length>0||e.isComplete||(e.initialPromise||(e.initialPromise=(async()=>{const o=e.abort??new AbortController;e.abort=o;const i=e.nextSkip,r=this.opt.initialLimit;try{const a=await this.fetchPageWithRetry(e,{skip:i,limit:r,gen:t,signal:o.signal});if(e.generation!==t)return;this.mergePage(e,a),e.nextSkip=i+a.length,this.emit(e)}finally{e.initialPromise=null}})()),await e.initialPromise.catch(()=>{}))}async runLoop(e,t){for(await this.ensureInitialLoaded(e,t);e.isRunning&&!e.isComplete&&e.generation===t;){const o=e.abort??new AbortController;e.abort=o;const i=e.nextSkip,r=this.opt.pageLimit;let a=[];try{a=await this.fetchPageWithRetry(e,{skip:i,limit:r,gen:t,signal:o.signal})}catch(l){if(e.generation!==t||l instanceof DOMException&&l.name==="AbortError")return;e.error=l instanceof Error?l.message:"Fetch failed",this.emit(e);return}if(e.generation!==t)return;if(!a||a.length===0){e.isComplete=!0,this.emit(e);return}this.mergePage(e,a),e.nextSkip=i+a.length,this.emit(e),await gb(this.opt.pageDelayMs,o.signal).catch(()=>{})}}async fetchPageWithRetry(e,t){let o=0;for(;;)try{e.apiCalls+=1,this.opt.log("🌐 [pipeline:page]",{key:e.key,skip:t.skip,limit:t.limit,calls:e.apiCalls});const i=await this.fetchPage({symbol:e.symbol,timeframe:e.timeframe,skip:t.skip,limit:t.limit,signal:t.signal});return e.lastUpdatedAt=Mh(),e.error=null,Array.isArray(i)?i:[]}catch(i){if(i instanceof DOMException&&i.name==="AbortError"||e.generation!==t.gen||o>=this.opt.maxRetries)throw i;const r=this.opt.retryBaseDelayMs*Math.pow(2,o);o+=1,await gb(r,t.signal)}}mergePage(e,t){if(!Array.isArray(t)||t.length===0)return;const o=[];for(const i of t){const r=i==null?void 0:i.timestamp;typeof r=="number"&&(e.ts.has(r)||(e.ts.add(r),o.push(i),(e.oldest==null||r<e.oldest)&&(e.oldest=r),(e.newest==null||r>e.newest)&&(e.newest=r)))}if(o.length>0){if(o.sort((i,r)=>i.timestamp-r.timestamp),e.candles.length===0)e.candles=o;else{const i=new Array(e.candles.length+o.length);let r=0,a=0,l=0;for(;r<e.candles.length&&a<o.length;)e.candles[r].timestamp<=o[a].timestamp?i[l++]=e.candles[r++]:i[l++]=o[a++];for(;r<e.candles.length;)i[l++]=e.candles[r++];for(;a<o.length;)i[l++]=o[a++];i.length=l,e.candles=i}e.lastUpdatedAt=Mh()}}}class yM{constructor(){Ce(this,"_prevSymbol");Ce(this,"_ws");Ce(this,"listens",{});Ce(this,"polygonApiKey","k2hPDhLy8gIpP4lMCU0gwo92xNRxE2XI");Ce(this,"currentPriceCache",new Map);Ce(this,"pipeline");this.pipeline=new _M(this.fetchHistoryPage.bind(this),{initialLimit:800,pageLimit:1e3,pageDelayMs:60,maxKeys:24,ttlMs:25*6e4})}async getHistoryKLineData({symbol:e,period:t,from:o,to:i,strategy:r}){const a=(t==null?void 0:t.timeframe)||"1m",c=(await this.pipeline.waitForInitial(e,a)).candles;if(c.length>0){const d=c[c.length-1].close;this.currentPriceCache.set(e.ticker,d)}return{data:c.slice(),lays:[]}}startBackgroundPrefetch(e,t){this.pipeline.start(e,t.timeframe)}hasMoreServerHistory(e,t){return!this.pipeline.getSnapshot(e,t.timeframe).isComplete}async loadMoreHistoricalData(e,t,o,i=2){return{data:this.pipeline.requestVisibleRange({symbol:e,timeframe:t.timeframe,beforeTimestamp:o,limit:350}),lays:[]}}removeDuplicateData(e){const t=new Set;return e.filter(o=>t.has(o[0])?!1:(t.add(o[0]),!0))}getTimeframeInMs(e){return e.endsWith("m")?parseInt(e.slice(0,-1))*60*1e3:e.endsWith("h")?parseInt(e.slice(0,-1))*60*60*1e3:e.endsWith("d")?parseInt(e.slice(0,-1))*24*60*60*1e3:e.endsWith("w")?parseInt(e.slice(0,-1))*7*24*60*60*1e3:60*1e3}canLoadMoreData(e,t){const o=this.pipeline.getSnapshot(e,t.timeframe);return o.candles.length>0&&!o.isComplete}convertResolutionForStockNow(e){return e==="1d"?"1D":e==="1w"?"1W":e==="1M"?"1M":e.endsWith("m")?e.slice(0,-1):e.endsWith("h")?(parseInt(e.slice(0,-1))*60).toString():e.endsWith("d")?(parseInt(e.slice(0,-1))*24*60).toString():e.endsWith("w")?(parseInt(e.slice(0,-1))*7*24*60).toString():e}async fetchHistoryPage(e){const t=this.convertResolutionForStockNow(e.timeframe),o=encodeURIComponent(e.symbol.ticker),i=e.symbol.country||"BD",l=`https://noti.dutyai.app${`/finance/get/chart/${o}/${t}?skip=${e.skip}&limit=${e.limit}&country=${i}`}`,c=await fetch(l,{signal:e.signal});if(!c.ok)return[];const d=await c.text();if(!d||d.trim()==="")return[];try{const p=JSON.parse(d);return Array.isArray(p)?p:[]}catch{return[]}}async getSymbols(){console.log("🚀 getSymbols() method called");try{console.log("🌐 Fetching symbols from API...");const o=await fetch("https://noti.dutyai.app"+"/finance/get/stock/list/latest");if(!o.ok)return console.warn(`⚠️ API request failed with status: ${o.status}`),[];let i=await o.json();if(!Array.isArray(i))return console.warn("⚠️ API response is not an array, using fallback symbols"),[];i.push({ticker:"DSEX",name:"Dhaka Stock Exchange",shortName:"DSEX",market:"stock",exchange:"DSEBD",priceCurrency:"BDT",type:"stock",logo:"",country:"BD"}),console.log(`📊 Received ${i.length} symbols from API`);const a=i.map(l=>({ticker:l.symbol||l.ticker||"",name:l.description||l.fullName||l.name||l.symbol||l.ticker||"",shortName:l.name||l.symbol||l.ticker||"",market:"stock",country:l.country||"BD",exchange:l.exchange||"UNKNOWN",priceCurrency:l.currency||(l.country==="US"?"USD":"BDT"),type:l.type||"stock",logo:l.logo?l.logo.trim():l.symbol||l.ticker?`https://s3-api.bayah.app/cdn/symbol/logo/${l.symbol||l.ticker}.svg`:"",logo2:l.logo2})).filter(l=>l.ticker&&l.ticker.trim()!=="");return console.log(`✅ Successfully processed ${a.length} valid symbols`),console.log("📋 Sample symbols:",a.slice(0,5)),a.length>0?a:[]}catch(e){return console.error("❌ Error fetching symbols from API:",e),console.log("🔄 Falling back to hardcoded symbols"),[]}}watch(e,t){var o;this._ws&&((o=this._ws)==null||o.send(JSON.stringify({action:"watch",key:e})),this.listens[e]=t)}subscribe(e,t){var i;if(((i=this._prevSymbol)==null?void 0:i.ticker)===e.ticker)return;this._prevSymbol=e,this.unsubscribe(),console.log(`Subscribing to real-time updates for ${e.ticker}`);const o=setInterval(()=>{const r=this.currentPriceCache.get(e.ticker)||Math.random()*100+10,a=(Math.random()-.5)*2,l=r+a;this.currentPriceCache.set(e.ticker,l);const d=[Date.now(),r,Math.max(r,l)+Math.random()*.5,Math.min(r,l)-Math.random()*.5,l,Math.random()*1e3];t({bars:[d],secs:1})},2e3);this.listens[e.ticker]=o}unsubscribe(e){this._ws&&(this._ws.close(),this._ws=void 0),Object.values(this.listens).forEach(o=>{typeof o=="number"&&clearInterval(o)}),this.listens={};const t=e==null?void 0:e.ticker;t&&this.pipeline.stopSymbol(t)}getCurrentPrice(e){return this.currentPriceCache.get(e)||null}clearCache(){this.pipeline.clear(),this.currentPriceCache.clear()}getPipelineMetrics(){return this.pipeline.getMetrics()}stopSymbolPipelines(e){this.pipeline.stopSymbol(e)}stopAllPipelines(){this.pipeline.stopAll()}getHistorySnapshot(e,t){return this.pipeline.getSnapshot(e,t)}async ensureHistoryBefore(e,t,o,i=2500){if(!(e!=null&&e.ticker))return this.pipeline.getSnapshot(e,t);this.pipeline.start(e,t);const r=l=>{const c=l.oldestTimestampLoaded;return typeof o!="number"||!Number.isFinite(o)||o<=0?l.candles.length>0:c!=null&&c<=o},a=this.pipeline.getSnapshot(e,t);return r(a)||a.isComplete?a:await new Promise(l=>{let c=!1,d=null,p=null;const m=h=>{if(!c){c=!0;try{d&&clearTimeout(d)}catch{}try{p==null||p()}catch{}l(h)}};p=this.pipeline.subscribe(e,t,h=>{(r(h)||h.isComplete||h.error)&&m(h)}),d=setTimeout(()=>{m(this.pipeline.getSnapshot(e,t))},Math.max(100,i))})}async ensureHistoryCovers(e,t,o,i,r=3500){if(!(e!=null&&e.ticker))return this.pipeline.getSnapshot(e,t);this.pipeline.start(e,t);const a=c=>{const d=c.oldestTimestampLoaded,p=c.newestTimestampLoaded;return typeof o!="number"||!Number.isFinite(o)||o<=0||typeof i!="number"||!Number.isFinite(i)||i<=0?c.candles.length>0:d!=null&&p!=null&&d<=o&&p>=i},l=this.pipeline.getSnapshot(e,t);return a(l)||l.isComplete?l:await new Promise(c=>{let d=!1,p=null,m=null;const h=_=>{if(!d){d=!0;try{p&&clearTimeout(p)}catch{}try{m==null||m()}catch{}c(_)}};m=this.pipeline.subscribe(e,t,_=>{(a(_)||_.isComplete||_.error)&&h(_)}),p=setTimeout(()=>{h(this.pipeline.getSnapshot(e,t))},Math.max(100,r))})}}function bM(n){const{xVal:e,xloc:t,len:o,timeSeriesMs:i,tsIndex:r,config:a,warn:l,meta:c}=n;if(!Number.isFinite(e))return null;const d=Math.max(0,Number((a==null?void 0:a.futureBars)||0));if(t!=="time"){const G=Math.round(e);return!Number.isFinite(G)||G<0?null:G>o-1&&G<=o-1+d||G>=0&&G<o?G:null}const p=e<1e12?Math.floor(e*1e3):Math.floor(e),m=i.length;if(!m)return null;const h=Math.max(0,Number((a==null?void 0:a.toleranceBars)||0)),_=Math.max(0,Number((a==null?void 0:a.toleranceMs)||0)),w=Math.max(0,Number((a==null?void 0:a.avgIntervalMs)||0)),S=w>0?h*w:0,P=Math.max(_,S),I=i[m-1];i[0];const C=G=>{if(!l)return;const se=["[ScriptStudio] time anchor miss",c!=null&&c.kind?`kind=${c.kind}`:"",(c==null?void 0:c.id)!=null?`id=${c.id}`:"",`ts=${p}`,`mode=${(a==null?void 0:a.mode)||"nearest"}`,`tolBars=${h}`,`tolMs=${_}`,`reason=${G}`].filter(Boolean);l(se.join(" "))};if(p>I&&d>0){const G=p-I,se=w>0?Math.max(1,Math.round(G/w)):1;return se<=d?o-1+se:(C("future_out_of_range"),null)}let M=0,F=m;for(;M<F;){const G=M+F>>1;i[G]<p?M=G+1:F=G}const V=M<m?M:null,j=M-1>=0?M-1:null;let D=null;const R=(a==null?void 0:a.mode)||"nearest";if(R==="prev")D=j??V;else if(R==="next")D=V??j;else{const G=j!=null?Math.abs(i[j]-p):Number.POSITIVE_INFINITY,se=V!=null?Math.abs(i[V]-p):Number.POSITIVE_INFINITY;G<=se?D=j:D=V}if(D==null)return C("no_match"),null;const W=i[D],J=Math.abs(W-p),Z=w>0?J/w:Math.abs(D-(M<m?M:m-1));return P>0&&J>P?(C("beyond_tolerance_ms"),null):h>0&&Z>h?(C("beyond_tolerance_bars"),null):D}function hb(n,e,t){if(!Array.isArray(n)||n.length<=2)return n||[];const o=Math.max(1,Math.floor(t||1)),i=[];let r=null,a=null;for(let l=0;l<n.length;l++){const c=n[l];if(!c)continue;const{x:d,y:p}=e(c)||{};if(!Number.isFinite(d)||!Number.isFinite(p))continue;if(i.length===0){i.push(c),r={x:d,y:p};continue}const m=d-r.x,h=p-r.y,_=m!==0?h/m:null,w=Math.abs(m)>=o||Math.abs(h)>=o,S=_!=null&&a!=null?_*a<0:!1;(w||S||l===n.length-1)&&(i.push(c),r={x:d,y:p},a=_??a)}return i[i.length-1]!==n[n.length-1]&&i.push(n[n.length-1]),i}const _b=new Map,n1=typeof document<"u"?document.createElement("canvas").getContext("2d"):null;function j0(n,e){return n1?(n1.font=e,n1.measureText(n).width):n.length*8}function xM(n){const e=n.text??"",t=n.font||'12px "Inter", system-ui, sans-serif',o=Number.isFinite(n.maxWidth)?Math.max(0,Number(n.maxWidth)):0,i=n.wrap===!0,r=(()=>{const S=t.match(/(\d+(?:\.\d+)?)px/),P=S?Number(S[1]):12;return Math.max(P+2,P*1.2)})(),a=Number.isFinite(n.lineHeight)?Number(n.lineHeight):r,l=`${t}|${o}|${i?"w":"n"}|${a}|${e}`,c=_b.get(l);if(c)return c;const d=String(e).split(/\n/),p=[],m=S=>{if(!i||o<=0){p.push(S);return}const P=S.split(/\s+/).filter(Boolean);let I="";const C=()=>{I&&(p.push(I),I="")},M=F=>{if(!F)return;if(j0(F,t)>o&&o>4){C();let D="";for(const R of F){const W=D+R;j0(W,t)>o&&D?(p.push(D),D=R):D=W}D&&p.push(D);return}const j=I?`${I} ${F}`:F;j0(j,t)>o&&I?(C(),I=F):I=j};for(const F of P)M(F);C()};d.forEach(S=>m(S)),p.length||p.push("");let h=0;for(const S of p)h=Math.max(h,j0(S,t));const _=p.length*a,w={lines:p,width:h,height:_,lineHeight:a};return _b.set(l,w),w}var wM=gr('<path d="M12.41465,11L18.5,11C18.7761,11,19,11.22386,19,11.5C19,11.77614,18.7761,12,18.5,12L12.41465,12C12.20873,12.5826,11.65311,13,11,13C10.34689,13,9.79127,12.5826,9.58535,12L3.5,12C3.223857,12,3,11.77614,3,11.5C3,11.22386,3.223857,11,3.5,11L9.58535,11C9.79127,10.417404,10.34689,10,11,10C11.65311,10,12.20873,10.417404,12.41465,11Z" stroke-opacity="0" stroke="none"></path>'),kM=gr('<g transform="scale(0.7857142857)"><path fill="currentColor" stroke="currentColor" stroke-width="1" d="M2 9.75a1.5 1.5 0 0 0-1.5 1.5v5.5a1.5 1.5 0 0 0 1.5 1.5h24a1.5 1.5 0 0 0 1.5-1.5v-5.5a1.5 1.5 0 0 0-1.5-1.5zm0 1h3v2.5h1v-2.5h3.25v3.9h1v-3.9h3.25v2.5h1v-2.5h3.25v3.9h1v-3.9H22v2.5h1v-2.5h3a.5.5 0 0 1 .5.5v5.5a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-5.5a.5.5 0 0 1 .5-.5z" transform="rotate(-45 14 14)"></path></g>'),SM=gr('<path d="M21,5.5C21,6.32843,20.3284,7,19.5,7C19.4136,7,19.3289,6.99269,19.2465,6.97866L15.6257,15.5086C15.8587,15.7729,16,16.119999999999997,16,16.5C16,17.328400000000002,15.3284,18,14.5,18C13.8469,18,13.2913,17.5826,13.0854,17L3.91465,17C3.70873,17.5826,3.15311,18,2.5,18C1.671573,18,1,17.328400000000002,1,16.5C1,15.6716,1.671573,15,2.5,15C2.5840199999999998,15,2.66643,15.0069,2.74668,15.0202L6.36934,6.48574C6.13933,6.22213,6,5.87733,6,5.5C6,4.671573,6.67157,4,7.5,4C8.15311,4,8.70873,4.417404,8.91465,5L18.0854,5C18.2913,4.417404,18.8469,4,19.5,4C20.3284,4,21,4.671573,21,5.5ZM18.0854,6L8.91465,6C8.892579999999999,6.06243,8.8665,6.12296,8.83672,6.18128L13.9814,15.0921C14.143,15.0325,14.3177,15,14.5,15C14.584,15,14.6664,15.0069,14.7467,15.0202L18.3693,6.48574C18.2462,6.3446,18.149,6.1802,18.0854,6ZM13.2036,15.745L8.0861,6.8811800000000005C7.90605,6.95768,7.70797,7,7.5,7C7.41359,7,7.32888,6.99269,7.24647,6.97866L3.62571,15.5086C3.7512,15.651,3.8501,15.8174,3.91465,16L13.0854,16C13.1169,15.9108,13.1566,15.8255,13.2036,15.745Z" stroke-opacity="0" stroke="none"></path>'),CM=gr('<path d="M9.474616630859375,7.494615087890625L8.844736630859375,7.494615087890625L8.844736630859375,4.149892087890625L8.000006630859374,4.634915087890625L8.004896630859374,4.005035087890625L9.020516630859376,3.414215087890625L9.474616630859375,3.414215087890625L9.474616630859375,7.494615087890625ZM18.529296630859378,4.8318550878906255Q18.307996630859375,5.028795087890625,18.122396630859377,5.385245087890625Q17.868496630859376,5.019035087890625,17.629196630859376,4.8269750878906255Q17.389996630859375,4.634915087890625,17.168596630859376,4.634915087890625Q16.794296630859375,4.634915087890625,16.522496630859376,4.976715087890625Q16.252296630859377,5.3168850878906255,16.252296630859377,5.7856350878906255Q16.252296630859377,6.218575087890625,16.502896630859375,6.521315087890625Q16.755196630859373,6.822415087890625,17.114896630859377,6.822415087890625Q17.368796630859375,6.822415087890625,17.588596630859374,6.625475087890624Q17.809896630859377,6.428535087890625,17.998696630859374,6.0688350878906245Q18.249396630859373,6.439935087890625,18.488596630859377,6.631985087890625Q18.727896630859377,6.822415087890625,18.952496630859375,6.822415087890625Q19.326796630859373,6.822415087890625,19.596996630859376,6.482245087890625Q19.868796630859375,6.140455087890626,19.868796630859375,5.671705087890626Q19.868796630859375,5.238755087890625,19.618196630859376,4.937655087890625Q19.367496630859375,4.634915087890625,19.006196630859375,4.634915087890625Q18.750696630859377,4.634915087890625,18.529296630859378,4.8318550878906255ZM18.337296630859377,5.674955087890625L18.278696630859375,5.596835087890625Q18.449596630859375,5.272935087890625,18.622096630859374,5.1101750878906245Q18.794596630859374,4.947415087890625,18.967096630859373,4.947415087890625Q19.194996630859375,4.947415087890625,19.346396630859374,5.1345950878906255Q19.497696630859377,5.320135087890625,19.497696630859377,5.598455087890625Q19.497696630859377,5.8914250878906245,19.360996630859376,6.096505087890625Q19.224296630859374,6.301585087890626,19.027396630859375,6.301585087890626Q18.915096630859374,6.301585087890626,18.742496630859375,6.146965087890624Q18.569996630859375,5.992335087890625,18.337296630859377,5.674955087890625ZM17.785496630859377,5.779125087890625L17.842496630859372,5.857245087890625Q17.668296630859373,6.186025087890625,17.495796630859374,6.348785087890625Q17.324896630859374,6.509915087890625,17.153996630859375,6.509915087890625Q16.926096630859377,6.509915087890625,16.774796630859377,6.324375087890624Q16.623396630859375,6.137195087890625,16.623396630859375,5.858875087890625Q16.623396630859375,5.565905087890625,16.761696630859376,5.360825087890625Q16.900096630859373,5.1557550878906255,17.095396630859376,5.1557550878906255Q17.228896630859374,5.1557550878906255,17.365596630859375,5.2778250878906245Q17.502296630859377,5.399895087890625,17.785496630859377,5.779125087890625ZM10.710296630859375,10.634915087890626C10.710296630859375,11.024655087890626,10.561656630859375,11.379685087890625,10.317976630859375,11.646395087890625L12.879196630859376,15.171615087890626C12.985696630859374,15.147615087890625,13.096496630859376,15.134915087890626,13.210296630859375,15.134915087890626C13.306796630859376,15.134915087890626,13.401096630859374,15.144015087890624,13.492596630859374,15.161415087890624L16.819096630859377,11.196955087890625C16.748996630859374,11.023375087890624,16.710296630859375,10.833655087890625,16.710296630859375,10.634915087890626C16.710296630859375,9.806495087890625,17.381896630859373,9.134915087890626,18.210296630859375,9.134915087890626C19.038696630859373,9.134915087890626,19.710296630859375,9.806495087890625,19.710296630859375,10.634915087890626C19.710296630859375,11.463345087890625,19.038696630859373,12.134915087890626,18.210296630859375,12.134915087890626C17.949796630859375,12.134915087890626,17.704796630859377,12.068505087890625,17.491296630859374,11.951675087890624L14.364996630859375,15.677415087890624C14.580596630859375,15.937215087890625,14.710296630859375,16.270915087890625,14.710296630859375,16.634915087890626C14.710296630859375,17.463315087890624,14.038696630859375,18.134915087890626,13.210296630859375,18.134915087890626C12.381866630859374,18.134915087890626,11.710296630859375,17.463315087890624,11.710296630859375,16.634915087890626C11.710296630859375,16.284415087890626,11.830486630859374,15.962015087890626,12.031896630859375,15.706715087890625L9.425686630859374,12.119565087890624C9.355346630859376,12.129685087890625,9.283436630859375,12.134915087890626,9.210296630859375,12.134915087890626C8.872396630859374,12.134915087890626,8.560596630859376,12.023195087890626,8.309816630859375,11.834665087890626L5.215876630859375,15.521915087890624C5.519506630859375,15.796415087890624,5.710296630859375,16.193415087890624,5.710296630859375,16.634915087890626C5.710296630859375,17.463315087890624,5.038726630859375,18.134915087890626,4.210296630859375,18.134915087890626C3.381869630859375,18.134915087890626,2.710296630859375,17.463315087890624,2.710296630859375,16.634915087890626C2.710296630859375,15.806515087890626,3.381869630859375,15.134915087890626,4.210296630859375,15.134915087890626C4.218546630859375,15.134915087890626,4.226776630859375,15.135015087890626,4.234996630859375,15.135115087890625L7.744116630859375,10.953115087890625C7.721966630859375,10.850565087890626,7.710296630859375,10.744105087890624,7.710296630859375,10.634915087890626C7.710296630859375,9.806495087890625,8.381866630859374,9.134915087890626,9.210296630859375,9.134915087890626C10.038726630859376,9.134915087890626,10.710296630859375,9.806495087890625,10.710296630859375,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),PM=gr('<path d="M17.0643,7.033864912109375L18,3.585784912109375L14.5078,4.509695912109375L15.3537,5.344934912109375L6.02026,14.560584912109375C5.87635,14.517484912109374,5.72366,14.494284912109375,5.5655,14.494284912109375C4.7009,14.494284912109375,4,15.186384912109375,4,16.040084912109375C4,16.893784912109375,4.7009,17.585784912109375,5.5655,17.585784912109375C6.43011,17.585784912109375,7.13101,16.893784912109375,7.13101,16.040084912109375C7.13101,15.722284912109375,7.03392,15.426984912109376,6.86744,15.181384912109374L16.0917,6.073604912109375L17.0643,7.033864912109375Z" stroke-opacity="0" stroke="none"></path>'),IM=gr('<g transform="scale(0.7857142857)" fill="none"><path stroke="currentColor" d="M16 14a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4.5 14a9.5 9.5 0 0 1 18.7-2.37 2.5 2.5 0 0 0 0 4.74A9.5 9.5 0 0 1 4.5 14Zm19.7 2.5a10.5 10.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"></path><path fill="currentColor" d="M22.5 14a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></g>'),MM=gr('<path d="M18.8532,7.020985087890625Q19.0257,6.734525087890625,19.0257,6.369945087890625Q19.0257,6.020005087890625,18.8499,5.754705087890625Q18.6758,5.489415087890626,18.3649,5.339675087890625Q18.5944,5.209465087890625,18.7214,4.994615087890625Q18.8499,4.779775087890625,18.8499,4.5193550878906255Q18.8499,4.2003480878906245,18.7002,3.951324087890625Q18.5505,3.700673087890625,18.277,3.557444087890625Q18.0052,3.414215087890625,17.6455,3.414215087890625Q17.285800000000002,3.414215087890625,17.0107,3.557444087890625Q16.7357,3.700673087890625,16.5843,3.951324087890625Q16.4346,4.2003480878906245,16.4346,4.5193550878906255Q16.4346,4.779775087890625,16.561500000000002,4.994615087890625Q16.6901,5.209465087890625,16.919600000000003,5.339675087890625Q16.6055,5.489415087890626,16.4297,5.757965087890625Q16.255499999999998,6.024895087890625,16.255499999999998,6.369945087890625Q16.255499999999998,6.734525087890625,16.4297,7.020985087890625Q16.6055,7.305815087890625,16.919600000000003,7.465325087890625Q17.2354,7.624825087890625,17.6455,7.624825087890625Q18.0557,7.624825087890625,18.3682,7.465325087890625Q18.6807,7.305815087890625,18.8532,7.020985087890625ZM8.76432,7.559725087890625L8.13444,7.559725087890625L8.13444,4.214996087890625L7.28971,4.700025087890625L7.2946,4.070139087890625L8.310220000000001,3.479319087890625L8.76432,3.479319087890625L8.76432,7.559725087890625ZM17.1816,4.955555087890625Q17.0042,4.784655087890625,17.0042,4.5095950878906255Q17.0042,4.229645087890625,17.18,4.057119087890625Q17.355800000000002,3.884592087890625,17.6455,3.884592087890625Q17.935200000000002,3.884592087890625,18.1077,4.057119087890625Q18.2803,4.229645087890625,18.2803,4.5095950878906255Q18.2803,4.784655087890625,18.1045,4.955555087890625Q17.930300000000003,5.124825087890625,17.6455,5.124825087890625Q17.3607,5.124825087890625,17.1816,4.955555087890625ZM18.2217,5.7953950878906255Q18.4398,6.005365087890625,18.4398,6.3552950878906245Q18.4398,6.705235087890625,18.2217,6.915195087890625Q18.0052,7.125155087890625,17.6455,7.125155087890625Q17.285800000000002,7.125155087890625,17.067700000000002,6.915195087890625Q16.849600000000002,6.705235087890625,16.849600000000002,6.3552950878906245Q16.849600000000002,6.005365087890625,17.064500000000002,5.7953950878906255Q17.2793,5.585435087890625,17.6455,5.585435087890625Q18.0052,5.585435087890625,18.2217,5.7953950878906255ZM9.60768,11.711495087890626C9.85136,11.444785087890626,10,11.089765087890626,10,10.700025087890625C10,9.871595087890626,9.32843,9.200025087890625,8.5,9.200025087890625C7.67157,9.200025087890625,7,9.871595087890626,7,10.700025087890625C7,10.809205087890625,7.01167,10.915665087890625,7.03382,11.018215087890624L3.5247,15.200215087890625C3.51648,15.200115087890625,3.5082500000000003,15.200015087890625,3.5,15.200015087890625C2.671573,15.200015087890625,2,15.871615087890625,2,16.700015087890627C2,17.528415087890625,2.671573,18.200015087890627,3.5,18.200015087890627C4.32843,18.200015087890627,5,17.528415087890625,5,16.700015087890627C5,16.258515087890625,4.80921,15.861515087890625,4.50558,15.587015087890626L7.59952,11.899765087890625C7.8503,12.088295087890625,8.162099999999999,12.200025087890625,8.5,12.200025087890625C8.57314,12.200025087890625,8.645050000000001,12.194785087890626,8.71539,12.184675087890625L11.3216,15.771815087890625C11.12019,16.027215087890625,11,16.349515087890623,11,16.700015087890627C11,17.528415087890625,11.67157,18.200015087890627,12.5,18.200015087890627C13.3284,18.200015087890627,14,17.528415087890625,14,16.700015087890627C14,16.336015087890623,13.8703,16.002315087890626,13.6547,15.742515087890625L16.781,12.016775087890625C16.994500000000002,12.133605087890626,17.2395,12.200025087890625,17.5,12.200025087890625C18.3284,12.200025087890625,19,11.528445087890624,19,10.700025087890625C19,9.871595087890626,18.3284,9.200025087890625,17.5,9.200025087890625C16.671599999999998,9.200025087890625,16,9.871595087890626,16,10.700025087890625C16,10.898765087890624,16.0387,11.088475087890625,16.108800000000002,11.262055087890625L12.7823,15.226515087890625C12.6908,15.209115087890625,12.5965,15.200015087890625,12.5,15.200015087890625C12.3862,15.200015087890625,12.2754,15.212715087890626,12.1689,15.236715087890625L9.60768,11.711495087890626Z" stroke-opacity="0" stroke="none"></path>'),AM=gr('<ellipse cx="10.5" cy="11.5" rx="1.5" ry="1.5" stroke-opacity="0" stroke="none"></ellipse><ellipse cx="17.5" cy="11.5" rx="1.5" ry="1.5" stroke-opacity="0" stroke="none"></ellipse><ellipse cx="10.5" cy="11.5" rx="7" ry="7" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse><ellipse cx="10.5" cy="11.5" rx="5" ry="5" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse><ellipse cx="10.5" cy="11.5" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse>',1),TM=gr('<path d="M17,4.5C17,5.32843,16.328400000000002,6,15.5,6C15.0931,6,14.7241,5.83802,14.4539,5.57503L5.98992,8.32515C5.99658,8.38251,6,8.440850000000001,6,8.5C6,9.15311,5.582599999999999,9.70873,5,9.91465L5,11.08535C5.42621,11.236,5.763999999999999,11.57379,5.91465,12L19.5,12C19.7761,12,20,12.22386,20,12.5C20,12.77614,19.7761,13,19.5,13L5.91465,13C5.70873,13.5826,5.15311,14,4.5,14C3.671573,14,3,13.3284,3,12.5C3,11.84689,3.417404,11.29127,4,11.08535L4,9.91465C3.417404,9.70873,3,9.15311,3,8.5C3,7.67157,3.671573,7,4.5,7C4.90411,7,5.2709,7.15981,5.5406200000000005,7.41967L14.0093,4.66802C14.0032,4.6128599999999995,14,4.5568,14,4.5C14,3.671573,14.6716,3,15.5,3C16.328400000000002,3,17,3.671573,17,4.5ZM4,15.5C4,15.2239,4.22386,15,4.5,15L19.5,15C19.7761,15,20,15.2239,20,15.5C20,15.7761,19.7761,16,19.5,16L4.5,16C4.22386,16,4,15.7761,4,15.5ZM4,18.5C4,18.2239,4.22386,18,4.5,18L19.5,18C19.7761,18,20,18.2239,20,18.5C20,18.7761,19.7761,19,19.5,19L4.5,19C4.22386,19,4,18.7761,4,18.5Z" stroke-opacity="0" stroke="none"></path>'),LM=gr('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M21 15H3a1 1 0 0 1 0-2h18a1 1 0 0 1 0 2Zm-2-3a2.99 2.99 0 0 1-2.816-2H3a1 1 0 0 1 0-2h13.184A2.995 2.995 0 1 1 19 12Zm0-4a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm2-3H3a1 1 0 0 1 0-2h18a1 1 0 1 1 0 2ZM5 16a2.99 2.99 0 0 1 2.816 2H21a1 1 0 0 1 0 2H7.816A2.995 2.995 0 1 1 5 16Zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"></path></g>'),FM=gr('<path d="M4,17.0854L4,3.5C4,3.223858,4.22386,3,4.5,3C4.77614,3,5,3.223858,5,3.5L5,10L7.57584,10L9.8127,4.46359C9.91614,4.20756,10.20756,4.08386,10.46359,4.1873000000000005C10.71963,4.29075,10.84333,4.58216,10.73988,4.8382000000000005L8.65438,10L11.08535,10C11.29127,9.4174,11.84689,9,12.5,9C12.65154,9,12.79784,9.02247,12.93573,9.06427L16.6464,5.35355C16.8417,5.15829,17.1583,5.15829,17.3536,5.35355C17.5488,5.54882,17.5488,5.8654,17.3536,6.06066L13.7475,9.66675C13.907,9.90508,14,10.19168,14,10.5C14,11.15311,13.5826,11.70873,13,11.91465L13,14.3638L18.3714,12.1936C18.6274,12.09015,18.918799999999997,12.21385,19.0222,12.46989C19.1257,12.72592,19.002,13.0173,18.746000000000002,13.1208L13,15.4423L13,18L19.5,18C19.7761,18,20,18.2239,20,18.5C20,18.7761,19.7761,19,19.5,19L5.91465,19C5.70873,19.5826,5.15311,20,4.5,20C3.671573,20,3,19.3284,3,18.5C3,17.846899999999998,3.417404,17.2913,4,17.0854ZM6.3729499999999994,17.0413L12,14.7678L12,11.91465C11.88136,11.87271,11.76956,11.81627,11.66675,11.74746L6.3729499999999994,17.0413ZM12,15.8463L6.6694700000000005,18L12,18L12,15.8463ZM6.38629,15.6137L8.250350000000001,11L11,11L6.38629,15.6137ZM5,11L7.17182,11L5,16.3754L5,11Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),$M=gr('<path d="M3,7.32468C5.90649,3.3893050000000002,11.49833,2.81306,14.6674,6.31944C14.9056,6.1554199999999994,15.192,6.05979,15.5,6.05979C15.845,6.05979,16.1628,6.17974,16.4162,6.381349999999999L18.4509,4.23827L19,4.816615L16.8945,7.03429C16.962600000000002,7.21075,17,7.40319,17,7.60463C17,8.45782,16.328400000000002,9.14947,15.5,9.14947C14.6716,9.14947,14,8.45782,14,7.60463C14,7.36402,14.0534,7.13625,14.1487,6.93322C11.32695,3.748365,6.25159,4.253956,3.612785,7.82695L3,7.32468ZM14.09,15.4717C15.7427,13.78985,16.244500000000002,11.524740000000001,15.5633,9.30134L15.5618,9.30134L16.3012,9.0502C17.072400000000002,11.56646,16.497700000000002,14.158,14.6282,16.0599C12.28737,18.442,8.62386,18.6988,6.41348,16.4501C4.5526,14.5572,4.52076,11.19671,6.36766,9.3177C7.89069,7.76754,10.07544,7.706189999999999,11.56741,9.22363C11.95453,9.61742,12.24817,10.08363,12.43369,10.57677L14.1451,8.77421L14.6942,9.35256L12.64982,11.50582C12.65827,11.59712,12.66295,11.68839,12.66378,11.77936C12.87398,12.04523,13,12.38451,13,12.7541C13,13.60729,12.32843,14.2989,11.5,14.2989C10.67157,14.2989,10,13.60729,10,12.7541C10,11.90091,10.67157,11.20926,11.5,11.20926C11.60387,11.20926,11.70528,11.220130000000001,11.8032,11.240829999999999L11.81763,11.22564C11.69858,10.71874,11.42858,10.21929,11.0284,9.81179C9.844000000000001,8.60765,8.136890000000001,8.65592,6.90822,9.90586C5.37975,11.460930000000001,5.40693,14.288,6.95404,15.8619C8.84598,17.7867,12.03496,17.5626,14.09,15.4717Z" stroke-opacity="0" stroke="none"></path>'),EM=gr('<path d="M8.13444,7.494615087890625L8.76432,7.494615087890625L8.76432,3.414215087890625L8.310220000000001,3.414215087890625L7.2946,4.005035087890625L7.28971,4.634915087890625L8.13444,4.149892087890625L8.13444,7.494615087890625ZM18.832,6.929835087890625Q19.0046,6.635245087890625,19.0046,6.2543850878906255Q19.0046,5.889805087890625,18.8451,5.5952050878906245Q18.6855,5.3006050878906255,18.3975,5.132965087890625Q18.1094,4.9653250878906245,17.7399,4.9653250878906245Q17.435499999999998,4.9653250878906245,17.1556,5.149245087890625L17.2793,3.939931087890625L18.8304,3.939931087890625L18.8304,3.414215087890625L16.7406,3.414215087890625L16.5094,5.665195087890625L17.0156,5.795405087890625Q17.095399999999998,5.655425087890626,17.2516,5.570795087890625Q17.4095,5.484525087890625,17.6357,5.484525087890625Q17.9694,5.484525087890625,18.1842,5.697745087890625Q18.4007,5.909335087890625,18.4007,6.2543850878906255Q18.4007,6.604315087890625,18.1842,6.822415087890625Q17.9694,7.0405150878906255,17.6292,7.0405150878906255Q17.3298,7.0405150878906255,17.119799999999998,6.890775087890625Q16.9098,6.739415087890626,16.825200000000002,6.474115087890625L16.3597,6.749175087890626Q16.470399999999998,7.110505087890624,16.807299999999998,7.335115087890625Q17.144199999999998,7.559725087890625,17.6292,7.559725087890625Q18.0296,7.559725087890625,18.3438,7.392075087890625Q18.6595,7.224435087890625,18.832,6.929835087890625ZM10,10.634915087890626C10,11.024655087890626,9.85136,11.379685087890625,9.60768,11.646395087890625L12.1689,15.171615087890626C12.2754,15.147615087890625,12.3862,15.134915087890626,12.5,15.134915087890626C12.5965,15.134915087890626,12.6908,15.144015087890624,12.7823,15.161415087890624L16.108800000000002,11.196955087890625C16.0387,11.023375087890624,16,10.833655087890625,16,10.634915087890626C16,9.806495087890625,16.671599999999998,9.134915087890626,17.5,9.134915087890626C18.3284,9.134915087890626,19,9.806495087890625,19,10.634915087890626C19,11.463345087890625,18.3284,12.134915087890626,17.5,12.134915087890626C17.2395,12.134915087890626,16.994500000000002,12.068505087890625,16.781,11.951675087890624L13.6547,15.677415087890624C13.8703,15.937215087890625,14,16.270915087890625,14,16.634915087890626C14,17.463315087890624,13.3284,18.134915087890626,12.5,18.134915087890626C11.67157,18.134915087890626,11,17.463315087890624,11,16.634915087890626C11,16.284415087890626,11.12019,15.962015087890626,11.3216,15.706715087890625L8.71539,12.119565087890624C8.645050000000001,12.129685087890625,8.57314,12.134915087890626,8.5,12.134915087890626C8.162099999999999,12.134915087890626,7.8503,12.023195087890626,7.59952,11.834665087890626L4.50558,15.521915087890624C4.80921,15.796415087890624,5,16.193415087890624,5,16.634915087890626C5,17.463315087890624,4.32843,18.134915087890626,3.5,18.134915087890626C2.671573,18.134915087890626,2,17.463315087890624,2,16.634915087890626C2,15.806515087890626,2.671573,15.134915087890626,3.5,15.134915087890626C3.5082500000000003,15.134915087890626,3.51648,15.135015087890626,3.5247,15.135115087890625L7.03382,10.953115087890625C7.01167,10.850565087890626,7,10.744105087890624,7,10.634915087890626C7,9.806495087890625,7.67157,9.134915087890626,8.5,9.134915087890626C9.32843,9.134915087890626,10,9.806495087890625,10,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),NM=gr('<path d="M20,3.5C20,4.15311,19.5826,4.70873,19,4.91465L19,18.5C19,18.7761,18.7761,19,18.5,19L4.91465,19C4.70873,19.5826,4.15311,20,3.5,20C2.671573,20,2,19.3284,2,18.5C2,17.846899999999998,2.417404,17.2913,3,17.0854L3,3.5C3,3.22386,3.22386,3,3.5,3L17.0854,3C17.2913,2.417404,17.846899999999998,2,18.5,2C19.3284,2,20,2.671573,20,3.5ZM17.0854,4C17.236,4.42621,17.5738,4.763999999999999,18,4.91465L18,8L14,8L14,4L17.0854,4ZM13,4L13,8L9,8L9,4L13,4ZM13,9L9,9L9,13L13,13L13,9ZM13,14L9,14L9,18L13,18L13,14ZM14,18L14,14L18,14L18,18L14,18ZM18,13L14,13L14,9L18,9L18,13ZM4.91465,18C4.763999999999999,17.5738,4.42621,17.236,4,17.0854L4,14L8,14L8,18L4.91465,18ZM4,8L4,4L8,4L8,8L4,8ZM8,9L8,13L4,13L4,9L8,9Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),DM=gr('<path d="M6.91465,11L11.08535,11C11.29127,10.417404,11.84689,10,12.5,10C13.15311,10,13.70873,10.417404,13.91465,11L18.5,11C18.7761,11,19,11.22386,19,11.5C19,11.77614,18.7761,12,18.5,12L13.91465,12C13.70873,12.5826,13.15311,13,12.5,13C11.84689,13,11.29127,12.5826,11.08535,12L6.91465,12C6.70873,12.5826,6.15311,13,5.5,13C4.671573,13,4,12.32843,4,11.5C4,10.671573,4.671573,10,5.5,10C6.15311,10,6.70873,10.417404,6.91465,11Z" stroke-opacity="0" stroke="none"></path>'),jM=gr('<path d="M6.91465,12.5C6.70873,13.0826,6.15311,13.5,5.5,13.5C4.671573,13.5,4,12.82843,4,12C4,11.171573,4.671573,10.5,5.5,10.5C6.15311,10.5,6.70873,10.917404,6.91465,11.5L16.0853,11.5C16.2913,10.917404,16.846899999999998,10.5,17.5,10.5C18.328400000000002,10.5,19,11.171573,19,12C19,12.82843,18.328400000000002,13.5,17.5,13.5C16.846899999999998,13.5,16.2913,13.0826,16.0853,12.5L6.91465,12.5Z" stroke-opacity="0" stroke="none"></path>'),RM=gr('<path d="M5.80417,14.9887L4.62563,16.167299999999997C4.43037,16.3625,4.43037,16.6791,4.62563,16.8744C4.82089,17.0696,5.13748,17.0696,5.332739999999999,16.8744L6.62638,15.5807C7.75595,16.290100000000002,9.19328,16.7929,11,16.7929C16.165399999999998,16.7929,18.3323,12.64289,18.8866,11.36789C19.0378,10.99289,19.0378,10.59289,18.8866,10.21789C18.5549,9.45486,17.6456,7.66212,15.8617,6.34545L17.3536,4.853553C17.5488,4.658291,17.5488,4.341709,17.3536,4.146447C17.1583,3.9511845,16.8417,3.9511845,16.6464,4.146447L15.0014,5.7915399999999995C13.9314,5.1969,12.61166,4.792893,11,4.792893C5.80945,4.792893,3.667717,8.94289,3.113386,10.21789C2.9622049,10.59289,2.9622049,10.99289,3.113386,11.36789C3.424435,12.08333,4.2353000000000005,13.70399,5.80417,14.9887ZM7.36012,14.847C8.32327,15.4074,9.52286,15.7929,11,15.7929C15.5606,15.7929,17.4756,12.11789,17.9543,10.99289C18.0047,10.86789,18.0047,10.74289,17.9543,10.61789C17.659,9.90846,16.8171,8.23812,15.1447,7.06241L12.96929,9.23782C13.3134,9.66543,13.5197,10.20642,13.5197,10.79289C13.5197,12.16789,12.38583,13.29289,11,13.29289C10.41596,13.29289,9.87667,13.09308,9.44815,12.75896L7.36012,14.847ZM8.794609999999999,11.99829L6.520099999999999,14.2728C5.06905,13.12119,4.32057,11.628250000000001,4.04567,10.96789C3.995275,10.84289,3.995275,10.71789,4.04567,10.59289C4.52441,9.46789,6.43937,5.79289,11,5.79289C12.28868,5.79289,13.3661,6.086320000000001,14.2596,6.53329L12.19759,8.5953C11.84086,8.40257,11.43271,8.29289,11,8.29289C9.61417,8.29289,8.480319999999999,9.41789,8.480319999999999,10.79289C8.480319999999999,11.22918,8.594470000000001,11.64029,8.794609999999999,11.99829ZM10.16528,12.04183C10.404869999999999,12.20032,10.692070000000001,12.29289,11,12.29289C11.8315,12.29289,12.51181,11.61789,12.51181,10.79289C12.51181,10.48318,12.41593,10.194600000000001,12.25216,9.95494L10.16528,12.04183ZM11.43602,9.35687L9.55616,11.236740000000001C9.512,11.09633,9.48819,10.94724,9.48819,10.79289C9.48819,9.96789,10.1685,9.29289,11,9.29289C11.15142,9.29289,11.29782,9.31528,11.43602,9.35687Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),BM=gr('<path d="M11,17C5.80945,17,3.667717,12.85,3.113386,11.575C2.9622047,11.2,2.9622047,10.8,3.113386,10.425C3.667717,9.15,5.80945,5,11,5C16.165399999999998,5,18.3323,9.15,18.8866,10.425C19.0378,10.8,19.0378,11.2,18.8866,11.575C18.3323,12.85,16.165399999999998,17,11,17ZM4.04567,10.8C3.995276,10.925,3.995276,11.05,4.04567,11.175C4.52441,12.325,6.43937,16,11,16C15.5606,16,17.4756,12.325,17.9543,11.2C18.0047,11.075,18.0047,10.95,17.9543,10.825C17.4756,9.675,15.5606,6,11,6C6.43937,6,4.52441,9.675,4.04567,10.8ZM11,13.5C9.61417,13.5,8.480319999999999,12.375,8.480319999999999,11C8.480319999999999,9.625,9.61417,8.5,11,8.5C12.38583,8.5,13.5197,9.625,13.5197,11C13.5197,12.375,12.38583,13.5,11,13.5ZM11,9.5C10.1685,9.5,9.48819,10.175,9.48819,11C9.48819,11.825,10.1685,12.5,11,12.5C11.8315,12.5,12.51181,11.825,12.51181,11C12.51181,10.175,11.8315,9.5,11,9.5Z" fill-opacity="1" stroke="currentColor" stroke-width="1"></path>'),OM=gr('<defs><clipPath id="master_svg0_151_625"><rect x="0" y="0" width="22" height="22" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_151_625)"><path d="M14.5385,9.76923L15.6538,9.76923C16.6538,9.76923,17.4615,10.576920000000001,17.4615,11.576920000000001L17.4615,17.1923C17.4615,18.1923,16.6538,19,15.6538,19L5.80769,19C4.807692,19,4,18.1923,4,17.1923L4,11.576920000000001C4,10.576920000000001,4.807692,9.76923,5.80769,9.76923L7.23077,9.76923L7.23077,7.576919999999999C7.23077,5.61538,8.88462,4,10.88462,4C12.88462,4,14.5385,5.61538,14.5385,7.576919999999999L14.5385,9.76923ZM10.88461,5.15385C9.5,5.15385,8.38461,6.23077,8.38461,7.576919999999999L8.38461,9.76923L13.38462,9.76923L13.38462,7.576919999999999C13.38462,6.23077,12.26923,5.15385,10.88461,5.15385ZM15.6538,17.8462C16,17.8462,16.3077,17.5385,16.3077,17.1923L16.3077,11.576920000000001C16.3077,11.23077,16,10.923079999999999,15.6538,10.923079999999999L5.80769,10.923079999999999C5.46154,10.923079999999999,5.15385,11.23077,5.15385,11.576920000000001L5.15385,17.1923C5.15385,17.5385,5.46154,17.8462,5.80769,17.8462L15.6538,17.8462ZM10.153839999999999,12.65385C10.153839999999999,12.34615,10.42307,12.07692,10.73076,12.07692C11.038450000000001,12.07692,11.307680000000001,12.34615,11.307680000000001,12.65385L11.307680000000001,14.5769C11.307680000000001,14.8846,11.038450000000001,15.1538,10.73076,15.1538C10.42307,15.1538,10.153839999999999,14.8846,10.153839999999999,14.5769L10.153839999999999,12.65385Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path></g>',1),zM=gr('<path d="M19.6401,7.99355C20.4028,7.92291,21,7.2811900000000005,21,6.5C21,5.671573,20.3284,5,19.5,5C18.8469,5,18.2913,5.417404,18.0854,6L7.62067,6C7.34453,6,7.12067,6.22386,7.12067,6.5C7.12067,6.5479,7.12741,6.59423,7.13999,6.63809L3.2294099999999997,15.0243C2.530138,15.1517,2,15.764,2,16.5C2,17.328400000000002,2.671573,18,3.5,18C4.15311,18,4.70873,17.5826,4.91465,17L14.5963,17C14.6456,17.076,14.7162,17.1396,14.8044,17.1807C15.0546,17.2974,15.3521,17.1891,15.4688,16.9388L19.6401,7.99355ZM14.7896,16.0293L18.6551,7.739599999999999C18.3942,7.56144,18.1925,7.30307,18.0854,7L8.0746,7L4.25044,15.2009C4.55701,15.3784,4.79493,15.6613,4.91465,16L14.6207,16C14.68,16,14.7368,16.0103,14.7896,16.0293Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),VM=gr('<path d="M3.3367688759765626,12.63173C3.5320318759765623,12.82699,3.8486138759765627,12.82699,4.043876875976562,12.63173L11.822052875976562,4.853553C12.017312875976563,4.658291,12.017312875976563,4.341708,11.822052875976562,4.146446C11.626792875976562,3.9511843,11.310202875976563,3.9511843,11.114942875976563,4.146446L3.3367688759765626,11.92462C3.1415071759765625,12.11988,3.1415071759765625,12.43647,3.3367688759765626,12.63173ZM5.001492875976562,17.0351C4.806232875976562,16.8399,4.806232875976562,16.5233,5.001492875976562,16.328L7.304532875976562,14.025C7.210822875976563,13.82916,7.158352875976563,13.60984,7.158352875976563,13.37827C7.158352875976563,12.54984,7.829922875976562,11.87827,8.658352875976561,11.87827C8.889922875976563,11.87827,9.109232875976563,11.93075,9.305052875976562,12.02446L11.304532875976562,10.02498C11.210822875976563,9.82916,11.158352875976561,9.60984,11.158352875976561,9.37827C11.158352875976561,8.54984,11.829922875976562,7.8782700000000006,12.658352875976563,7.8782700000000006C12.889922875976563,7.8782700000000006,13.109232875976563,7.93075,13.305022875976562,8.024460000000001L15.608122875976562,5.72142C15.803322875976562,5.5261499999999995,16.119922875976563,5.5261499999999995,16.315222875976563,5.72142C16.510422875976563,5.9166799999999995,16.510422875976563,6.23326,16.315222875976563,6.42852L14.012122875976562,8.73156C14.105822875976562,8.92738,14.158322875976562,9.1467,14.158322875976562,9.37827C14.158322875976562,10.2067,13.486822875976562,10.87827,12.658352875976563,10.87827C12.426772875976562,10.87827,12.207452875976562,10.82579,12.011642875976563,10.73209L10.012162875976562,12.73156C10.105872875976562,12.92738,10.158352875976561,13.1467,10.158352875976561,13.37827C10.158352875976561,14.2067,9.486772875976563,14.8783,8.658352875976561,14.8783C8.426772875976562,14.8783,8.207452875976562,14.8258,8.011642875976563,14.7321L5.708602875976562,17.0351C5.513342875976562,17.2304,5.196752875976562,17.2304,5.001492875976562,17.0351ZM10.415712875976563,18.328C10.220452875976562,18.5233,9.903862875976563,18.5233,9.708602875976563,18.328C9.513342875976562,18.1328,9.513342875976562,17.816200000000002,9.708602875976563,17.6209L12.304532875976562,15.025C12.210822875976563,14.8292,12.158352875976563,14.6098,12.158352875976563,14.3783C12.158352875976563,13.54984,12.829922875976562,12.87827,13.658322875976562,12.87827C13.889922875976563,12.87827,14.109222875976563,12.93075,14.305022875976562,13.02446L17.486822875976564,9.84274C17.682022875976564,9.64747,17.99862287597656,9.64747,18.19392287597656,9.84274C18.38912287597656,10.038,18.38912287597656,10.35458,18.19392287597656,10.54984L15.012122875976562,13.73156C15.105822875976562,13.92738,15.158322875976562,14.1467,15.158322875976562,14.3783C15.158322875976562,15.2067,14.486822875976562,15.8783,13.658322875976562,15.8783C13.426822875976562,15.8783,13.207422875976562,15.8258,13.011642875976563,15.7321L10.415712875976563,18.328Z" stroke-opacity="0" stroke="none"></path>'),WM=gr('<path d="M3.146447,14.178126025390625C2.9511847,13.982826025390626,2.9511847,13.666226025390625,3.146447,13.470926025390625L7.39146,9.225966025390626C7.35417,9.095106025390624,7.33421,8.956946025390625,7.33421,8.814116025390625C7.33421,7.985696025390625,8.00578,7.314116025390625,8.834209999999999,7.314116025390625C8.97703,7.314116025390625,9.11519,7.334086025390625,9.24605,7.371366025390625L13.753,2.864373025390625C13.9483,2.669110325390625,14.2649,2.669110325390625,14.4602,2.864373025390625C14.6554,3.059635025390625,14.6554,3.376217025390625,14.4602,3.571479025390625L10.06916,7.962476025390625C10.23631,8.204386025390626,10.334209999999999,8.497826025390625,10.334209999999999,8.814116025390625C10.334209999999999,9.642546025390626,9.66264,10.314116025390625,8.834209999999999,10.314116025390625C8.51791,10.314116025390625,8.22448,10.216226025390625,7.98256,10.049076025390626L3.853554,14.178126025390625C3.658291,14.373326025390625,3.341709,14.373326025390625,3.146447,14.178126025390625ZM7.67736,19.188526025390626C7.4821,18.993226025390626,7.4821,18.676626025390625,7.67736,18.481426025390626L9.9804,16.178326025390625C9.88669,15.982526025390625,9.834209999999999,15.763226025390624,9.834209999999999,15.531626025390626C9.834209999999999,14.703226025390626,10.50578,14.031626025390626,11.33421,14.031626025390626C11.56579,14.031626025390626,11.78511,14.084126025390624,11.98093,14.177826025390624L13.9804,12.178356025390626C13.8867,11.982536025390624,13.8342,11.763216025390625,13.8342,11.531636025390625C13.8342,10.703206025390624,14.5058,10.031636025390625,15.3342,10.031636025390625C15.5658,10.031636025390625,15.7851,10.084116025390625,15.9809,10.177826025390626L18.284,7.874796025390625C18.4792,7.679536025390625,18.7958,7.679536025390625,18.9911,7.874796025390625C19.1863,8.070056025390624,19.1863,8.386636025390626,18.9911,8.581906025390625L16.688000000000002,10.884936025390624C16.7817,11.080756025390626,16.8342,11.300066025390626,16.8342,11.531636025390625C16.8342,12.360066025390624,16.162599999999998,13.031626025390626,15.3342,13.031626025390626C15.1026,13.031626025390626,14.8833,12.979126025390626,14.6875,12.885426025390625L12.68803,14.884926025390625C12.78174,15.080726025390625,12.83421,15.300026025390626,12.83421,15.531626025390626C12.83421,16.360026025390624,12.16264,17.031626025390626,11.33421,17.031626025390626C11.10264,17.031626025390626,10.88333,16.979126025390627,10.68751,16.885426025390625L8.38446,19.188526025390626C8.1892,19.383726025390626,7.87262,19.383726025390626,7.67736,19.188526025390626Z" stroke-opacity="0" stroke="none"></path>'),qM=gr('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="m2.285 10.333 8.048-8.048a.977.977 0 1 1 1.381 1.381l-8.048 8.049a.977.977 0 0 1-1.381-1.382Zm10 10 8.048-8.048a.977.977 0 1 1 1.381 1.381l-8.048 8.049a.977.977 0 0 1-1.381-1.382ZM19 8a2.966 2.966 0 0 1-1.308-.312l-10 10c.202.408.307.857.308 1.312a3.03 3.03 0 1 1-1.693-2.689l10-10A2.993 2.993 0 1 1 19 8ZM5 18a1 1 0 1 0 0 2 1 1 0 0 0 0-2ZM19 4a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"></path></g>'),HM=gr('<path d="M6.91465,13.00505L18.5,13.00505C18.7761,13.00505,19,13.228909999999999,19,13.50505C19,13.781189999999999,18.7761,14.00505,18.5,14.00505L6.91465,14.00505C6.70873,14.58765,6.15311,15.00505,5.5,15.00505C4.671573,15.00505,4,14.33348,4,13.50505C4,12.67662,4.671573,12.00505,5.5,12.00505C6.15311,12.00505,6.70873,12.422450000000001,6.91465,13.00505ZM7.81404,11.625L10.48591,11.625L10.48591,10.90625L9.65193,10.90625L9.65193,7.125L8.997630000000001,7.125C8.71443,7.306641,8.415600000000001,7.419922,7.96443,7.498047L7.96443,8.05078L8.77497,8.05078L8.77497,10.90625L7.81404,10.90625L7.81404,11.625ZM11.081620000000001,11.625L14.0562,11.625L14.0562,10.88281L13.09724,10.88281C12.8863,10.88281,12.59333,10.90625,12.36482,10.93555C13.17537,10.11328,13.84724,9.2207,13.84724,8.39062C13.84724,7.541016,13.28865,7,12.4488,7C11.84333,7,11.446850000000001,7.234375,11.03279,7.679688L11.52497,8.16797C11.747630000000001,7.914062,12.0113,7.697266,12.33552,7.697266C12.7613,7.697266,13.00154,7.982422,13.00154,8.43359C13.00154,9.14648,12.29255,10.00781,11.081620000000001,11.11523L11.081620000000001,11.625ZM15.9605,11.75C16.8121,11.75,17.526899999999998,11.2832,17.526899999999998,10.4375C17.526899999999998,9.82031,17.142200000000003,9.43945,16.6441,9.30078L16.6441,9.27148C17.1129,9.08594,17.3824,8.7207,17.3824,8.21289C17.3824,7.421875,16.8004,7,15.9429,7C15.4215,7,14.9957,7.210938,14.6109,7.541016L15.066,8.11133C15.3258,7.849609,15.5836,7.697266,15.9019,7.697266C16.2789,7.697266,16.4957,7.914062,16.4957,8.28125C16.4957,8.70898,16.2301,9,15.4215,9L15.4215,9.63672C16.3804,9.63672,16.6383,9.91992,16.6383,10.38086C16.6383,10.79688,16.3336,11.03125,15.8824,11.03125C15.4742,11.03125,15.1578,10.82227,14.8922,10.55078L14.4781,11.13281C14.7906,11.486329999999999,15.2652,11.75,15.9605,11.75Z" stroke-opacity="0" stroke="none"></path>'),UM=gr('<g transform="scale(0.7857142857)" fill="currentColor" fill-rule="nonzero"><path d="M8.354 20.354l5-5-.707-.707-5 5z"></path><path d="M16.354 12.354l8-8-.707-.707-8 8z"></path><path d="M14.5 15c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM6.5 23c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g>'),GM=gr('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M3 6C3 7.30622 3.83481 8.41746 5 8.82929V15.1707C3.83481 15.5825 3 16.6938 3 18C3 19.6569 4.34315 21 6 21C7.30622 21 8.41746 20.1652 8.82929 19H15.1707C15.5825 20.1652 16.6938 21 18 21C19.6569 21 21 19.6569 21 18C21 16.6938 20.1652 15.5825 19 15.1707V8.82929C20.1652 8.41746 21 7.30622 21 6C21 4.34315 19.6569 3 18 3C16.6938 3 15.5825 3.83481 15.1707 5H8.82929C8.41746 3.83481 7.30622 3 6 3C4.34315 3 3 4.34315 3 6ZM6 7C6.55228 7 7 6.55228 7 6C7 5.44772 6.55228 5 6 5C5.44772 5 5 5.44772 5 6C5 6.55228 5.44772 7 6 7ZM17 15.1707V8.82929C16.1476 8.52801 15.472 7.85242 15.1707 7H8.82929C8.52801 7.85241 7.85241 8.52801 7 8.82929V15.1707C7.85241 15.472 8.52801 16.1476 8.82929 17H15.1707C15.472 16.1476 16.1476 15.472 17 15.1707ZM18 7C18.5523 7 19 6.55228 19 6C19 5.44772 18.5523 5 18 5C17.4477 5 17 5.44772 17 6C17 6.55228 17.4477 7 18 7ZM7 18C7 18.5523 6.55228 19 6 19C5.44772 19 5 18.5523 5 18C5 17.4477 5.44772 17 6 17C6.55228 17 7 17.4477 7 18ZM19 18C19 18.5523 18.5523 19 18 19C17.4477 19 17 18.5523 17 18C17 17.4477 17.4477 17 18 17C18.5523 17 19 17.4477 19 18Z"></path></g>'),YM=gr('<path d="M16.966900000000003,8.67144C16.6669,8.67144,16.4247,8.91558,16.4247,9.21802L16.4247,16.631500000000003C16.4247,17.322,16.007199999999997,17.9068,15.5139,17.9068L13.93072,17.9068L13.93072,9.2162C13.93072,8.91741,13.68675,8.67144,13.38855,8.67144C13.09036,8.67144,12.84639,8.91741,12.84639,9.21802L12.84639,17.9068L10.151810000000001,17.9068L10.151810000000001,9.21802C10.151810000000001,8.91741,9.90783,8.67144,9.609639999999999,8.67144C9.31145,8.67144,9.06747,8.91741,9.06747,9.219850000000001L9.06747,17.9068L7.48614,17.9068C6.99277,17.9068,6.5753,17.322,6.5753,16.631500000000003L6.5753,9.21802C6.5753,8.91558,6.333130000000001,8.67144,6.03313,8.67144C5.73313,8.67144,5.49096,8.91558,5.49096,9.21802L5.49096,16.631500000000003C5.49096,17.9378,6.385540000000001,19,7.48614,19L15.512,19C16.6127,19,17.509,17.9378,17.509,16.631500000000003L17.509,9.21802C17.509,8.91558,17.2669,8.67144,16.966900000000003,8.67144ZM18.4578,6.21183L4.542169,6.21183C4.243976,6.21183,4,6.45779,4,6.75841C4,7.05903,4.243976,7.30499,4.542169,7.30499L18.4578,7.30499C18.756,7.30499,19,7.05903,19,6.75841C19,6.45779,18.756,6.21183,18.4578,6.21183ZM8.68072,5.10045L14.3193,5.10045C14.6175,5.10045,14.8614,4.852666,14.8614,4.550225C14.8614,4.247783,14.6175,4,14.3193,4L8.68072,4C8.38253,4,8.13855,4.247783,8.13855,4.550225C8.13855,4.852666,8.38253,5.10045,8.68072,5.10045Z" fill-opacity="1" stroke="currentColor" stroke-width="1"></path>'),KM=gr('<circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="1.5"></circle><circle cx="8.5" cy="8.5" r="1" fill="currentColor"></circle><circle cx="13.5" cy="8.5" r="1" fill="currentColor"></circle><path d="M7.5 13.5 Q11 16.5 14.5 13.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>',1),ZM=gr('<g fill="currentColor"><path d="M5 5h12v2h-5v10h-2V7H5z"></path></g>'),XM=gr('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M19.054 7.988a2.988 2.988 0 0 1-1.31-.312l-10 10a3.027 3.027 0 1 1-1.38-1.381l10-10a2.994 2.994 0 1 1 2.69 1.693Zm-14 10a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm14-14a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"></path></g>'),JM=gr('<path d="M6,4L6,8L4,8L4,16L6,16L6,20L8,20L8,16L10,16L10,8L8,8L8,4L6,4ZM14,2L14,6L12,6L12,14L14,14L14,18L16,18L16,14L18,14L18,6L16,6L16,2L14,2Z" stroke-opacity="0" stroke="none"></path>'),QM=gr('<path d="M3,18L4.5,16.5L8,13L12,17L16,13L19,16L21,14L19,12L16,15L12,11L8,15L4.5,18.5L3,20Z" stroke-opacity="0" stroke="none"></path>'),eA=gr('<path d="M3,18L4.5,16.5L8,13L12,17L16,13L19,16L21,14L21,20L3,20Z" stroke-opacity="0" stroke="none"></path>'),tA=gr('<path d="M6,4L6,8L4,8L4,16L6,16L6,20L8,20L8,16L10,16L10,8L8,8L8,4L6,4ZM14,2L14,6L12,6L12,14L14,14L14,18L16,18L16,14L18,14L18,6L16,6L16,2L14,2Z" stroke-opacity="0" stroke="none" fill="currentColor"></path>'),nA=gr('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect>',1),oA=gr('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="currentColor" fill-opacity="0.3"></rect>',1),sA=gr('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="currentColor" fill-opacity="0.3"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect>',1),iA=gr('<path d="M6,4L6,20M12,2L12,22M18,3L18,21" stroke="currentColor" stroke-width="0.5"></path><path d="M4,8L6,8M6,16L8,16M10,6L12,6M12,16L14,16M16,7L18,7M18,13L20,13" stroke="currentColor" stroke-width="0.5"></path>',1),rA=gr('<g stroke-width="1.2" fill="none"><g stroke="#00E6D8"><line x1="3" y1="13" x2="6" y2="16"></line><line x1="6" y1="13" x2="3" y2="16"></line><line x1="3" y1="9" x2="6" y2="12"></line><line x1="6" y1="9" x2="3" y2="12"></line><line x1="3" y1="5" x2="6" y2="8"></line><line x1="6" y1="5" x2="3" y2="8"></line></g><g stroke="#FF4D4D"><circle cx="10.5" cy="10.5" r="1.8"></circle><circle cx="10.5" cy="14.5" r="1.8"></circle><circle cx="10.5" cy="18.5" r="1.8"></circle></g><g stroke="#00E6D8"><line x1="15" y1="9" x2="18" y2="12"></line><line x1="18" y1="9" x2="15" y2="12"></line><line x1="15" y1="5" x2="18" y2="8"></line><line x1="18" y1="5" x2="15" y2="8"></line></g></g>'),aA=gr('<path d="M5.146447,15.753C4.9511845,15.9483,4.9511845,16.2649,5.146447,16.4602C5.341709,16.6554,5.658291,16.6554,5.853554,16.4602L8.156600000000001,14.15711C8.352409999999999,14.25082,8.57173,14.3033,8.8033,14.3033C9.631730000000001,14.3033,10.3033,13.63172,10.3033,12.80329C10.3033,12.57172,10.250820000000001,12.352409999999999,10.157119999999999,12.15659L12.156600000000001,10.15711C12.352409999999999,10.250820000000001,12.571729999999999,10.30329,12.8033,10.30329C13.63173,10.30329,14.3033,9.63172,14.3033,8.80329C14.3033,8.57172,14.25082,8.352409999999999,14.15712,8.15659L16.4602,5.853553C16.6554,5.658291,16.6554,5.341709,16.4602,5.146447C16.2649,4.9511843,15.9483,4.9511843,15.753,5.146447L13.45001,7.449479999999999C13.25419,7.35577,13.03487,7.3032900000000005,12.8033,7.3032900000000005C11.97487,7.3032900000000005,11.3033,7.97487,11.3033,8.80329C11.3033,9.03487,11.35578,9.254190000000001,11.44949,9.450009999999999L9.450009999999999,11.449480000000001C9.254190000000001,11.35577,9.03487,11.30329,8.8033,11.30329C7.97487,11.30329,7.3033,11.97487,7.3033,12.80329C7.3033,13.03487,7.35578,13.25419,7.44949,13.45001L5.146447,15.753Z" stroke-opacity="0" stroke="none"></path>'),lA=gr('<defs><clipPath id="master_svg0_151_615"><rect x="0" y="0" width="22" height="22" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_151_615)"><path d="M19.672,3.0673368C19.4417,2.9354008,19.1463,3.00292252,18.9994,3.2210900000000002L17.4588,5.50622L16.743299999999998,3.781253L13.9915,7.4662L13.9618,7.51108C13.8339,7.72862,13.8936,8.005659999999999,14.1004,8.15391L14.1462,8.183430000000001C14.3683,8.308720000000001,14.6511,8.25001,14.8022,8.047229999999999L16.4907,5.78571L17.246299999999998,7.60713L19.8374,3.7635389999999997L19.8651,3.717088C19.9871,3.484615,19.9023,3.199273,19.672,3.0673368ZM4.79974,8.462530000000001L10.117740000000001,3.252975C10.31381,3.0610145,10.63152,3.0610145,10.82759,3.252975L13.4115,5.78453C13.6076,5.976710000000001,13.6076,6.28833,13.4115,6.4805L8.093869999999999,11.69045C7.48847,12.28368,7.51659,13.3308,8.151309999999999,13.9528C8.786439999999999,14.5755,9.85421,14.6027,10.45961,14.0087L15.7768,8.79831C15.9729,8.60609,16.2909,8.60609,16.487099999999998,8.79831L19.0705,11.33026C19.2667,11.52244,19.2667,11.83406,19.0705,12.02623L13.7533,17.2366C11.32572,19.6158,7.30328,19.578,4.85679,17.1807C2.410298,14.7834,2.371331,10.84174,4.79974,8.462530000000001ZM12.3461,6.1325199999999995L10.47246,4.29654L5.51079,9.15889C3.477674,11.15076,3.510214,14.4688,5.56784,16.4847C7.62506,18.500999999999998,11.01117,18.5325,13.0439,16.540599999999998L15.6842,13.9529L14.2908,12.58718L15.0011,11.89161L16.394399999999997,13.2569L18.0056,11.67786L16.1323,9.84188L11.16985,14.7046C10.18764,15.6679,8.540980000000001,15.6494,7.51498,14.7184L7.44107,14.6487C6.4219,13.65,6.37771,11.98096,7.38362,10.994869999999999L10.02485,8.40693L8.624939999999999,7.03516L9.335180000000001,6.33919L10.73512,7.71099L12.3461,6.1325199999999995Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path></g>',1),cA=gr('<path d="M8.134443814697265,7.494615087890625L8.764323814697265,7.494615087890625L8.764323814697265,3.414215087890625L8.310223814697267,3.414215087890625L7.294603814697266,4.005035087890625L7.289713814697266,4.634915087890625L8.134443814697265,4.149892087890625L8.134443814697265,7.494615087890625ZM18.832003814697266,6.933095087890624Q19.004603814697266,6.635245087890625,19.004603814697266,6.2543850878906255Q19.004603814697266,5.884915087890625,18.845103814697264,5.593575087890625Q18.685503814697267,5.3006050878906255,18.399103814697266,5.136225087890625Q18.114303814697266,4.9702050878906245,17.754603814697266,4.9653250878906245L18.820603814697265,3.840647087890625L18.820603814697265,3.414215087890625L16.519203814697264,3.414215087890625L16.519203814697264,3.939931087890625L18.050803814697264,3.939931087890625L16.719403814697266,5.334785087890625L17.074203814697263,5.7205350878906245Q17.254903814697265,5.484525087890625,17.619503814697268,5.484525087890625Q17.980803814697268,5.484525087890625,18.187503814697266,5.689605087890625Q18.394203814697267,5.894685087890625,18.394203814697267,6.2543850878906255Q18.394203814697267,6.604315087890625,18.187503814697266,6.822415087890625Q17.980803814697268,7.0405150878906255,17.640603814697265,7.0405150878906255Q17.334603814697267,7.0405150878906255,17.124703814697266,6.890775087890625Q16.914703814697265,6.739415087890626,16.820303814697265,6.469225087890624L16.354803814697263,6.744295087890626Q16.480103814697266,7.125155087890625,16.821903814697265,7.341625087890625Q17.165403814697264,7.559725087890625,17.640603814697265,7.559725087890625Q18.039403814697266,7.559725087890625,18.348603814697267,7.393705087890625Q18.659503814697267,7.229315087890625,18.832003814697266,6.933095087890624ZM10.000003814697266,10.634915087890626C10.000003814697266,11.024655087890626,9.851363814697265,11.379685087890625,9.607683814697266,11.646395087890625L12.168903814697266,15.171615087890626C12.275403814697265,15.147615087890625,12.386203814697266,15.134915087890626,12.500003814697266,15.134915087890626C12.596503814697266,15.134915087890626,12.690803814697265,15.144015087890624,12.782303814697265,15.161415087890624L16.108803814697268,11.196955087890625C16.038703814697264,11.023375087890624,16.000003814697266,10.833655087890625,16.000003814697266,10.634915087890626C16.000003814697266,9.806495087890625,16.671603814697264,9.134915087890626,17.500003814697266,9.134915087890626C18.328403814697264,9.134915087890626,19.000003814697266,9.806495087890625,19.000003814697266,10.634915087890626C19.000003814697266,11.463345087890625,18.328403814697264,12.134915087890626,17.500003814697266,12.134915087890626C17.239503814697265,12.134915087890626,16.994503814697268,12.068495087890625,16.781003814697264,11.951675087890624L13.654703814697266,15.677415087890624C13.870303814697266,15.937215087890625,14.000003814697266,16.270915087890625,14.000003814697266,16.634915087890626C14.000003814697266,17.463315087890624,13.328403814697266,18.134915087890626,12.500003814697266,18.134915087890626C11.671573814697265,18.134915087890626,11.000003814697266,17.463315087890624,11.000003814697266,16.634915087890626C11.000003814697266,16.284415087890626,11.120193814697265,15.962015087890626,11.321603814697266,15.706715087890625L8.715393814697265,12.119565087890624C8.645053814697267,12.129685087890625,8.573143814697266,12.134915087890626,8.500003814697266,12.134915087890626C8.162103814697264,12.134915087890626,7.8503038146972655,12.023195087890626,7.599523814697266,11.834665087890626L4.505583814697266,15.521915087890624C4.809213814697266,15.796415087890624,5.000003814697266,16.193415087890624,5.000003814697266,16.634915087890626C5.000003814697266,17.463315087890624,4.328433814697266,18.134915087890626,3.5000038146972656,18.134915087890626C2.6715768146972656,18.134915087890626,2.0000038146972656,17.463315087890624,2.0000038146972656,16.634915087890626C2.0000038146972656,15.806515087890626,2.6715768146972656,15.134915087890626,3.5000038146972656,15.134915087890626C3.508253814697266,15.134915087890626,3.5164838146972657,15.135015087890626,3.524703814697266,15.135115087890625L7.033823814697266,10.953115087890625C7.011673814697265,10.850565087890626,7.000003814697266,10.744105087890624,7.000003814697266,10.634915087890626C7.000003814697266,9.806495087890625,7.671573814697266,9.134915087890626,8.500003814697266,9.134915087890626C9.328433814697267,9.134915087890626,10.000003814697266,9.806495087890625,10.000003814697266,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),dA=gr('<path d="M11.57625,6.9981C11.55099,6.999359999999999,11.52557,7,11.5,7C11.34,7,11.18584,6.97495,11.04125,6.9285499999999995L5.55401,16.4327C5.713760000000001,16.5905,5.83826,16.7839,5.91465,17L16.0854,17C16.2187,16.622700000000002,16.4987,16.314700000000002,16.8569,16.1445L11.57625,6.9981ZM12.50759,6.611219999999999C12.81005,6.336790000000001,13,5.94058,13,5.5C13,4.671573,12.32843,4,11.5,4C10.67157,4,10,4.671573,10,5.5C10,5.80059,10.08841,6.08052,10.24066,6.31522L4.64514,16.0069C4.59738,16.002299999999998,4.54896,16,4.5,16C3.671573,16,3,16.671599999999998,3,17.5C3,18.328400000000002,3.671573,19,4.5,19C5.15311,19,5.70873,18.5826,5.91465,18L16.0854,18C16.2913,18.5826,16.846899999999998,19,17.5,19C18.328400000000002,19,19,18.328400000000002,19,17.5C19,16.8365,18.5691,16.2735,17.971899999999998,16.075699999999998L12.50759,6.611219999999999Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),uA=gr('<g transform="scale(0.7857142857)"><path fill="currentColor" stroke="currentColor" stroke-width="1" fill-rule="evenodd" d="M14 6a3 3 0 0 0-3 3v3h8.5a2.5 2.5 0 0 1 2.5 2.5v7a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 6 21.5v-7A2.5 2.5 0 0 1 8.5 12H10V9a4 4 0 0 1 8 0h-1a3 3 0 0 0-3-3zm-1 11a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6-2.5c0-.83.67-1.5 1.5-1.5h11c.83 0 1.5.67 1.5 1.5v7c0 .83-.67 1.5-1.5 1.5h-11A1.5 1.5 0 0 1 7 21.5v-7z"></path></g>'),pA=gr('<path d="M11.66558837890625,19C10.83716137890625,19,10.16558837890625,18.328400000000002,10.16558837890625,17.5C10.16558837890625,16.846899999999998,10.58298437890625,16.2913,11.16557337890625,16.0854L11.16557337890625,11.91464C10.58298437890625,11.70872,10.16558837890625,11.1531,10.16558837890625,10.5C10.16558837890625,9.8469,10.58298437890625,9.29128,11.16557337890625,9.08536L11.16557337890625,4.5C11.16557337890625,4.223857,11.38942837890625,4,11.66556837890625,4C11.94171837890625,4,12.16556837890625,4.223857,12.16556837890625,4.5L12.16556837890625,9.08535C12.74817837890625,9.291260000000001,13.16558837890625,9.846879999999999,13.16558837890625,10.5C13.16558837890625,11.153120000000001,12.74817837890625,11.708739999999999,12.16556837890625,11.91465L12.16556837890625,16.0854C12.74817837890625,16.2913,13.16558837890625,16.846899999999998,13.16558837890625,17.5C13.16558837890625,18.328400000000002,12.49401837890625,19,11.66558837890625,19Z" stroke-opacity="0" stroke="none"></path>'),vA=gr('<path d="M11.165603637695312,6.91465C11.748203637695312,6.70873,12.165603637695312,6.15311,12.165603637695312,5.5C12.165603637695312,4.671573,11.494033637695313,4,10.665603637695312,4C9.837176637695313,4,9.165603637695312,4.671573,9.165603637695312,5.5C9.165603637695312,6.15311,9.583007637695312,6.70873,10.165603637695312,6.91465L10.165603637695312,16.0854C9.583007637695312,16.2913,9.165603637695312,16.846899999999998,9.165603637695312,17.5C9.165603637695312,18.328400000000002,9.837176637695313,19,10.665603637695312,19C11.494033637695313,19,12.165603637695312,18.328400000000002,12.165603637695312,17.5C12.165603637695312,16.846899999999998,11.748203637695312,16.2913,11.165603637695312,16.0854L11.165603637695312,6.91465Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),fA=gr('<path d="M11,12.41465L11,18.5C11,18.7761,11.22386,19,11.5,19C11.77614,19,12,18.7761,12,18.5L12,12.41465C12.5826,12.20873,13,11.65311,13,11C13,10.34689,12.5826,9.79127,12,9.58535L12,3.5C12,3.223857,11.77614,3,11.5,3C11.22386,3,11,3.223857,11,3.5L11,9.58535C10.417404,9.79127,10,10.34689,10,11C10,11.65311,10.417404,12.20873,11,12.41465Z" stroke-opacity="0" stroke="none"></path>'),mA=gr('<path d="M11,17C5.80945,17,3.667717,12.85,3.113386,11.575C2.9622047,11.2,2.9622047,10.8,3.113386,10.425C3.667717,9.15,5.80945,5,11,5C16.165399999999998,5,18.3323,9.15,18.8866,10.425C19.0378,10.8,19.0378,11.2,18.8866,11.575C18.3323,12.85,16.165399999999998,17,11,17ZM4.04567,10.8C3.995276,10.925,3.995276,11.05,4.04567,11.175C4.52441,12.325,6.43937,16,11,16C15.5606,16,17.4756,12.325,17.9543,11.2C18.0047,11.075,18.0047,10.95,17.9543,10.825C17.4756,9.675,15.5606,6,11,6C6.43937,6,4.52441,9.675,4.04567,10.8ZM11,13.5C9.61417,13.5,8.480319999999999,12.375,8.480319999999999,11C8.480319999999999,9.625,9.61417,8.5,11,8.5C12.38583,8.5,13.5197,9.625,13.5197,11C13.5197,12.375,12.38583,13.5,11,13.5ZM11,9.5C10.1685,9.5,9.48819,10.175,9.48819,11C9.48819,11.825,10.1685,12.5,11,12.5C11.8315,12.5,12.51181,11.825,12.51181,11C12.51181,10.175,11.8315,9.5,11,9.5Z" stroke-opacity="0" fill-opacity="1"></path>'),gA=gr('<path d="M4.727219638671875,8.007996215820313L9.973849638671876,2.7629472158203123C10.167279638671875,2.5696791158203123,10.480729638671875,2.5696791158203123,10.674169638671875,2.7629472158203123L13.223329638671874,5.311756215820313C13.416929638671874,5.505236215820313,13.416929638671874,5.8189862158203125,13.223329638671874,6.012466215820313L7.977129638671875,11.257906215820313C7.379859638671875,11.855176215820313,7.407609638671875,12.909396215820312,8.033809638671876,13.535596215820313C8.660409638671876,14.162596215820313,9.713849638671874,14.189996215820312,10.311129638671876,13.591896215820313L15.556929638671875,8.346066215820311C15.750429638671875,8.152526215820313,16.064229638671875,8.152526215820313,16.257629638671872,8.346066215820311L18.806529638671876,10.895266215820312C19.000029638671876,11.088746215820313,19.000029638671876,11.402496215820312,18.806529638671876,11.595976215820313L13.560629638671875,16.841796215820313C11.165619638671876,19.237196215820312,7.197149638671875,19.19919621582031,4.783499638671875,16.785496215820313C2.3698426386718747,14.371896215820312,2.331397638671875,10.403416215820313,4.727219638671875,8.007996215820313ZM12.172299638671875,5.662106215820312L10.323809638671875,3.8136162158203124L5.4287196386718755,8.709096215820313C3.422893638671875,10.714536215820312,3.4549956386718748,14.055196215820313,5.484999638671875,16.08479621582031C7.514609638671875,18.114796215820313,10.855289638671875,18.146496215820314,12.860719638671876,16.141096215820312L15.465629638671874,13.535796215820312L14.090929638671875,12.160756215820312L14.791629638671875,11.460436215820312L16.166229638671876,12.834996215820313L17.755829638671877,11.245226215820313L15.907729638671874,9.396736215820312L11.011839638671875,14.292596215820312C10.042809638671875,15.262396215820312,8.418249638671874,15.243796215820312,7.406019638671875,14.306496215820312L7.333099638671875,14.236296215820312C6.327599638671876,13.230796215820313,6.284009638671876,11.550396215820312,7.276419638671875,10.557586215820312L9.882199638671874,7.952026215820313L8.501079638671875,6.570906215820313L9.201789638671876,5.870186215820313L10.582939638671874,7.251336215820312L12.172299638671875,5.662106215820312Z" fill-rule="evenodd" fill-opacity="1" stroke="currentColor" stroke-width="0.5"></path>'),hA=gr('<g transform="scale(0.7857142857)" fill="currentColor" fill-rule="nonzero" stroke="currentColor" stroke-width="1"><path d="M20.449 8.505l2.103 9.112.974-.225-2.103-9.112zM13.943 14.011l7.631 4.856.537-.844-7.631-4.856zM14.379 11.716l4.812-3.609-.6-.8-4.812 3.609zM10.96 13.828l-4.721 6.744.819.573 4.721-6.744zM6.331 20.67l2.31-13.088-.985-.174-2.31 13.088zM9.041 7.454l1.995 3.492.868-.496-1.995-3.492z"></path><path d="M8.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM12.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM20.5 8c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM23.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g>'),_A=gr('<path d="m19.45,17.57l-3.78,-9.16a0.92,0.92 0 0 0 -1.71,0l-3.78,9.16a0.92,0.92 0 1 0 1.71,0.71l0.77,-1.86l4.31,0l0.77,1.86a0.92,0.92 0 0 0 0.85,0.57a0.92,0.92 0 0 0 0.85,-1.28l0,0zm-6.03,-3.01l1.39,-3.37l1.39,3.37l-2.79,0zm-2.81,-0.8a0.92,0.92 0 0 0 -0.21,-1.29c-0.01,-0.01 -0.63,-0.47 -1.53,-1.46c1.67,-2.25 2.61,-4.82 2.99,-6.03l1.36,0a0.92,0.92 0 0 0 0,-1.85l-4.87,0l0,-0.84a0.92,0.92 0 0 0 -1.85,0l0,0.84l-4.87,0a0.92,0.92 0 0 0 0,1.85l8.28,0c-0.4,1.13 -1.14,2.92 -2.26,4.55c-1.32,-1.75 -1.81,-2.88 -1.81,-2.89a0.92,0.92 0 0 0 -1.7,0.71c0.02,0.06 0.61,1.44 2.22,3.53c0.04,0.05 0.08,0.1 0.12,0.15c-1.65,1.86 -3.27,3.02 -3.94,3.39a0.92,0.92 0 1 0 0.88,1.62c0.09,-0.05 2.04,-1.13 4.27,-3.59c0.95,1.01 1.6,1.49 1.64,1.52a0.92,0.92 0 0 0 1.29,-0.21l0,0z" id="svg_1"></path>'),yA=gr('<g id="svg_7"><path d="m10.02,1.07c-4.98,0 -9.28,4.05 -9.02,9.02c0.35,6.79 8.26,2.87 8.97,8.2a0.9,0.9 0 0 0 0.99,0.77a9.02,9.02 0 0 0 -0.94,-18zm1.77,16.4a0.51,0.51 0 0 1 -0.62,-0.35a4.51,4.51 0 0 0 -1.61,-2.3c-1.03,-0.78 -2.27,-1.08 -3.46,-1.38c-2.39,-0.59 -3.55,-0.99 -3.67,-3.43c-0.1,-1.87 0.58,-3.67 1.93,-5.08a7.84,7.84 0 0 1 5.66,-2.43a7.59,7.59 0 0 1 1.77,14.97z" id="svg_1"></path><path d="m13.04,14.42m-1.38,0a1.38,1.38 0 1 0 2.77,0a1.38,1.38 0 1 0 -2.77,0z" id="svg_2"></path><path d="m15.28,9.07m-1.13,0a1.13,1.13 0 1 0 2.26,0a1.13,1.13 0 1 0 -2.26,0z" id="svg_3"></path><path d="m14.23,6.93a1.13,1.13 0 1 0 -1.58,-0.19a1.13,1.13 0 0 0 1.58,0.19z" id="svg_4"></path><path d="m10.29,4.73m-0.97,0.58a1.13,1.13 0 1 0 1.93,-1.16a1.13,1.13 0 1 0 -1.93,1.16z" id="svg_5"></path><path d="m6.47,4.66a1.13,1.13 0 1 0 1.49,0.58a1.13,1.13 0 0 0 -1.49,-0.58z" id="svg_6"></path></g>'),bA=gr('<path d="m15.1,6.75c0,-2.31 -1.89,-4.18 -4.21,-4.18c-2.33,0 -4.21,1.87 -4.21,4.18c0,2.31 1.89,4.18 4.21,4.18c2.33,0 4.21,-1.87 4.21,-4.18m5.9,13.26c0.03,0.09 0.05,0.18 0.05,0.28c0,0.54 -0.44,0.98 -0.99,0.98a0.99,0.99 0 0 1 -0.99,-0.98l0,0l-0.03,0c-0.26,-4.12 -3.69,-7.39 -7.9,-7.39c-4.21,0 -7.65,3.27 -7.91,7.39l-0.02,0l0,0c0,0.54 -0.44,0.98 -0.99,0.98a0.99,0.99 0 0 1 -0.99,-0.98c0,-0.09 0.02,-0.18 0.04,-0.27c0.29,-3.74 2.66,-6.9 5.98,-8.3c-1.54,-1.12 -2.55,-2.92 -2.55,-4.97c0,-3.4 2.77,-6.15 6.19,-6.15c3.42,0 6.19,2.75 6.19,6.15a6.12,6.12 0 0 1 -2.39,4.85c3.48,1.33 6,4.56 6.31,8.41" fill="#515151" id="svg_1"></path>'),xA=gr('<g transform="scale(0.047 0.047)"><path d="M387.6 2.6C385.5 4.7 385 6.2 385 10C385 13.8 385.5 15.3 387.6 17.4L390.3 20H410.9H431.5L382.5 69L333.5 118L314.5 99C304.1 88.6 294.2 79.6 292.6 79C291 78.4 288.3 78.2 286.6 78.6C284.2 79 263.1 99.5 192.7 169.8C142.7 219.7 101.2 261.7 100.4 263.2C98.1 267.5 98.7 271.6 101.9 275.2C104.4 278 105.5 278.5 109.4 278.5H114L201.5 191L289 103.5L308.8 123.3L328.6 143H333.5H338.5L392.2 89.3L446 35.5V52.8C446 71.1 446.7 74.7 450.9 77C453.9 78.6 460.3 78.2 462.6 76.2C466.8 72.8 467 71.3 467 39C467 6.7 466.8 5.2 462.6 1.8C460.7 0.199996 457.1 -4.14997e-06 425.4 -4.14997e-06H390.3L387.6 2.6Z" fill="currentColor"></path><path d="M382.8 147.4C373.9 149.8 366 158.1 364.1 167.1C363.3 170.5 363 222 363 332V492H335.5H308L307.8 400.1L307.5 308.2L303.8 302.9C295.9 291.6 290.4 290.1 256.9 290C244 290 230.7 290.5 227.5 291.1C218.2 292.8 211 298.4 207.1 307C205.1 311.4 205 313.1 205 401.7V492H177.5H150V444.7C150 391.6 150 391.7 143 383.7C140.7 381.2 136.8 378.3 133.8 376.9C128.6 374.5 128 374.5 98 374.5H67.5L61.8 377.3C55.4 380.4 51.7 384.3 48.6 391C46.6 395.3 46.5 397.2 46.2 443.8L45.9 492H32.9C18.2 492 15.9 492.8 14 498.6C12.5 502.9 14.1 508.2 17.5 510.4C19.7 511.8 42.4 512 256 512C469.6 512 492.3 511.8 494.5 510.4C497.9 508.2 499.5 502.9 498 498.6C496.1 492.9 493.7 492 479.5 492H467V331.2C467 150.8 467.5 163.8 459.7 155.3C451.9 146.8 450.7 146.5 417 146.3C395.4 146.1 386.3 146.4 382.8 147.4ZM443.4 169.1L446 171.1V331.6V492H415H384V332V171.9L386.5 169.5L388.9 167H414.8C439.5 167 440.9 167.1 443.4 169.1ZM282.8 312.1C284.8 312.8 286.2 314.2 286.9 316.2C287.7 318.3 288 346.8 288 405.6V492H257H226V403.7C226 320.8 226.1 315.2 227.8 313.8C228.7 312.9 230.2 312 231 311.7C233.9 310.7 279.6 311 282.8 312.1ZM127.1 397.9C128.9 400.1 129 402.4 129 446.1V492H98H67L67.1 446.7C67.1 421.9 67.5 400.7 67.9 399.6C69.6 395.4 72.1 395 99.3 395.3C125.2 395.5 125.2 395.5 127.1 397.9Z" fill="currentColor"></path><path d="M69.2 295.5C65.3 298.7 64.4 302.7 66.4 307.4C69.3 314.4 78.6 315.6 83.5 309.8C91.5 300.3 78.6 287.5 69.2 295.5Z" fill="currentColor"></path><circle cx="2" cy="18" r="1" fill="currentColor"></circle></g>'),wA=gr('<g id="svg_4" transform="translate(-0.1 -0.1) scale(1.00914 1.00914) translate(0.1 0.1) scale(1.09 1.09) matrix(0.995 0 0 0.995 0 0)"><path d="m18.54,9.09c-0.21,-2.47 -1.25,-4.77 -2.96,-6.45c-1.73,-1.69 -3.96,-2.64 -6.3,-2.64c-1.25,0 -2.46,0.27 -3.61,0.78c-0.01,0 -0.01,0.02 -0.02,0.02c-0.02,0 -0.02,0.01 -0.03,0.01c-1.09,0.5 -2.06,1.21 -2.91,2.12c-0.86,0.92 -1.52,1.98 -1.99,3.18c-0.47,1.23 -0.72,2.54 -0.72,3.89c0,0.87 0.11,1.72 0.31,2.54c0,0.02 0.01,0.05 0.02,0.07c0.41,1.62 1.18,3.11 2.3,4.35c1.44,1.59 3.3,2.6 5.3,2.91c0.03,0 0.04,0.02 0.06,0.02c0.33,0.05 0.67,0.08 1.01,0.08l0.21,0c0.4,0 1.17,-0.03 1.8,-0.27c0.16,-0.07 0.29,-0.19 0.36,-0.36c0.07,-0.16 0.09,-0.35 0.03,-0.53c-0.1,-0.27 -0.34,-0.46 -0.61,-0.46c-0.07,0 -0.16,0.01 -0.23,0.03c-0.47,0.18 -1.1,0.21 -1.36,0.21l-0.1,0c0.1,-0.32 0.14,-0.67 0.05,-1.04c-0.15,-0.66 -0.64,-1.21 -1.57,-1.75l-0.39,-0.23c-0.62,-0.36 -0.96,-0.54 -1.16,-0.84c-0.2,-0.29 -0.34,-0.74 -0.51,-1.75c-0.13,-0.68 -0.47,-1.21 -1.01,-1.52c-0.37,-0.2 -0.8,-0.31 -1.32,-0.31c-0.36,0 -0.76,0.05 -1.18,0.15c-0.21,0.05 -0.41,0.11 -0.59,0.16c-0.08,-0.48 -0.12,-0.98 -0.12,-1.49c0,-3.04 1.47,-5.7 3.69,-7.24c0.01,0.28 0.07,0.57 0.19,0.84c0.3,0.7 0.92,1.14 1.84,1.33c0.05,0.01 0.08,0.01 0.12,0.01l0.04,0c0.09,0 0.39,0.01 0.71,0.14c0.43,0.19 0.68,0.51 0.76,1c0.2,1.56 0.42,4.38 0.14,5.29c-0.02,0.07 -0.03,0.15 -0.03,0.23c0,0.37 0.29,0.69 0.64,0.69c0.18,0 0.34,-0.08 0.46,-0.2c0.12,-0.13 2.76,-3.01 3.46,-3.97c0.08,-0.11 0.17,-0.21 0.26,-0.32c0.34,-0.43 0.69,-0.86 0.82,-1.51c0.15,-0.69 0,-1.46 -0.46,-2.41c-0.32,-0.68 -0.38,-0.98 -0.4,-1.1c0.02,-0.01 0.04,-0.02 0.06,-0.04c2.02,1.39 3.42,3.73 3.65,6.48c0.04,0.37 0.31,0.63 0.65,0.63l0.06,0c0.35,-0.01 0.61,-0.34 0.58,-0.73zm-15.35,3.47c0.3,0 0.53,0.05 0.71,0.15c0.18,0.12 0.29,0.28 0.34,0.56c0.2,1.07 0.37,1.79 0.76,2.34c0.38,0.53 0.86,0.79 1.58,1.21l0.03,0.01c0.1,0.06 0.23,0.13 0.35,0.2c0.74,0.43 0.9,0.72 0.94,0.86c0.03,0.14 -0.05,0.34 -0.15,0.54c-2.83,-0.58 -5.1,-2.74 -6.01,-5.6c0.42,-0.13 0.97,-0.27 1.45,-0.27zm9.6,-8.04c0.64,1.31 0.36,1.67 -0.21,2.37c-0.09,0.12 -0.19,0.23 -0.28,0.36c-0.35,0.48 -1.28,1.53 -2.09,2.43c0,-0.44 -0.02,-0.94 -0.06,-1.49c-0.08,-1.23 -0.22,-2.28 -0.22,-2.32l0,-0.04c-0.18,-0.99 -0.73,-1.71 -1.61,-2.07c-0.49,-0.2 -0.95,-0.22 -1.13,-0.22c-0.45,-0.11 -0.73,-0.3 -0.85,-0.55c-0.14,-0.3 -0.05,-0.74 0.04,-1.02c0.91,-0.38 1.88,-0.59 2.9,-0.59c1.11,0 2.16,0.24 3.13,0.67c-0.07,0.13 -0.13,0.3 -0.16,0.5c-0.04,0.49 0.12,1.1 0.54,1.97z" id="svg_1"></path><path d="m15.22,9.72c-2.63,0 -4.77,2.3 -4.77,5.14c0,2.84 2.13,5.14 4.77,5.14c2.64,0 4.78,-2.3 4.78,-5.14c0,-2.84 -2.15,-5.14 -4.78,-5.14zm0,8.88c-1.91,0 -3.48,-1.68 -3.48,-3.75c0,-2.07 1.56,-3.75 3.48,-3.75c1.93,0 3.49,1.68 3.49,3.75c0,2.07 -1.57,3.75 -3.49,3.75z" id="svg_2"></path><path d="m15.69,15.05l0,-2.37c0,-0.38 -0.29,-0.7 -0.64,-0.7c-0.36,0 -0.65,0.32 -0.65,0.7l0,2.66c0,0.19 0.07,0.35 0.19,0.49l1.16,1.27c0.12,0.12 0.28,0.2 0.46,0.2c0.17,0 0.33,-0.08 0.46,-0.2c0.11,-0.13 0.18,-0.31 0.18,-0.5c0,-0.19 -0.07,-0.36 -0.18,-0.49l-0.98,-1.06z" id="svg_3"></path></g>'),kA=gr('<path d="M8 5v14l11-7z" fill="currentColor"></path>'),SA=gr('<rect x="6" y="6" width="10" height="10" fill="currentColor"></rect>'),CA=gr('<path d="m21.62,13.73l-1.7,-1.37c0.08,-0.46 0.12,-0.94 0.12,-1.41c0,-0.47 -0.04,-0.94 -0.12,-1.41l1.7,-1.37c0.25,-0.21 0.35,-0.55 0.24,-0.85l-0.03,-0.07c-0.46,-1.24 -1.15,-2.38 -2.06,-3.37l-0.04,-0.05c-0.22,-0.24 -0.58,-0.34 -0.91,-0.23l-2.09,0.71c-0.78,-0.6 -1.64,-1.08 -2.57,-1.41l-0.41,-2.08c-0.07,-0.32 -0.33,-0.57 -0.67,-0.62l-0.08,-0.01c-1.34,-0.23 -2.76,-0.23 -4.1,0l-0.08,0.01c-0.34,0.05 -0.6,0.31 -0.67,0.62l-0.41,2.09c-0.93,0.33 -1.78,0.8 -2.55,1.4l-2.11,-0.71c-0.33,-0.11 -0.69,-0.02 -0.91,0.23l-0.04,0.05c-0.91,1.01 -1.6,2.14 -2.06,3.37l-0.03,0.07c-0.11,0.3 -0.01,0.65 0.24,0.85l1.72,1.38c-0.09,0.46 -0.12,0.93 -0.12,1.4c0,0.47 0.03,0.94 0.12,1.39l-1.72,1.39c-0.25,0.21 -0.35,0.55 -0.24,0.85l0.03,0.07c0.46,1.24 1.15,2.37 2.06,3.37l0.04,0.05c0.22,0.24 0.58,0.34 0.91,0.23l2.11,-0.71c0.77,0.6 1.62,1.07 2.55,1.4l0.41,2.09c0.07,0.32 0.33,0.57 0.67,0.62l0.08,0.01c0.67,0.12 1.36,0.18 2.05,0.18c0.69,0 1.38,-0.05 2.05,-0.18l0.08,-0.01c0.34,-0.05 0.6,-0.31 0.67,-0.62l0.41,-2.08c0.93,-0.33 1.8,-0.81 2.57,-1.41l2.09,0.71c0.33,0.11 0.69,0.01 0.91,-0.23l0.04,-0.05c0.91,-1.01 1.6,-2.14 2.06,-3.37l0.03,-0.07c0.11,-0.3 0.01,-0.64 -0.24,-0.85zm-3.53,-3.91c0.07,0.37 0.1,0.76 0.1,1.13c0,0.38 -0.03,0.77 -0.1,1.13l-0.18,0.99l1.93,1.55c-0.28,0.65 -0.66,1.25 -1.09,1.81l-2.4,-0.81l-0.81,0.64c-0.61,0.48 -1.3,0.85 -2.05,1.12l-0.99,0.35l-0.46,2.38c-0.72,0.08 -1.47,0.08 -2.19,0l-0.47,-2.38l-0.97,-0.36c-0.73,-0.26 -1.41,-0.64 -2.03,-1.12l-0.81,-0.64l-2.42,0.82c-0.44,-0.57 -0.8,-1.17 -1.09,-1.81l1.95,-1.58l-0.16,-0.97c-0.07,-0.36 -0.1,-0.74 -0.1,-1.12c0,-0.37 0.03,-0.74 0.1,-1.11l0.16,-0.97l-1.95,-1.58c0.3,-0.65 0.66,-1.25 1.09,-1.81l2.42,0.81l0.81,-0.62c0.61,-0.48 1.29,-0.85 2.03,-1.12l0.99,-0.35l0.46,-2.38c0.72,-0.09 1.47,-0.09 2.19,0l0.46,2.37l0.99,0.35c0.74,0.26 1.43,0.65 2.05,1.12l0.81,0.64l2.4,-0.81c0.44,0.57 0.81,1.17 1.11,1.81l-1.94,1.55l0.18,0.97zm-7.14,-3.42c-2.51,0 -4.54,1.93 -4.54,4.3c0,2.38 2.04,4.3 4.54,4.3c2.51,0 4.54,-1.93 4.54,-4.3c0,-2.38 -2.04,-4.3 -4.54,-4.3zm2.05,6.24c-0.55,0.51 -1.27,0.8 -2.05,0.8c-0.77,0 -1.5,-0.28 -2.05,-0.8c-0.54,-0.51 -0.84,-1.2 -0.84,-1.94c0,-0.73 0.31,-1.41 0.84,-1.94c0.55,-0.51 1.28,-0.8 2.05,-0.8c0.78,0 1.5,0.28 2.05,0.8c0.55,0.53 0.84,1.2 0.84,1.94c0,0.73 -0.3,1.42 -0.84,1.94z" id="svg_1"></path>'),PA=gr('<path d="m7.13,1l7.64,0c0.16,0 0.31,0.12 0.34,0.28l0.25,1.38c0.12,0.67 0.68,1.15 1.35,1.15l2.45,0c1.51,0 2.74,1.26 2.74,2.81l0,11.27c0,1.55 -1.23,2.81 -2.74,2.81l-16.43,0c-1.51,0 -2.74,-1.26 -2.74,-2.81l0,-11.27c0,-1.55 1.23,-2.81 2.74,-2.81l2.45,0c0.67,0 1.23,-0.48 1.35,-1.15l0.25,-1.38c0.03,-0.16 0.18,-0.28 0.34,-0.28zm9.58,4.23c-1.32,0 -2.45,-0.96 -2.69,-2.3l-0.1,-0.51l-5.93,0l-0.1,0.51c-0.24,1.34 -1.37,2.3 -2.69,2.3l-2.45,0c-0.76,0 -1.37,0.62 -1.37,1.4l0,11.27c0,0.78 0.61,1.4 1.37,1.4l16.43,0c0.76,0 1.37,-0.62 1.37,-1.4l0,-11.27c0,-0.78 -0.61,-1.4 -1.37,-1.4l-2.45,0zm-11.91,2.11l-1.37,0c-0.38,0 -0.69,-0.32 -0.69,-0.71c0,-0.38 0.31,-0.7 0.69,-0.7l1.37,0c0.37,0 0.68,0.32 0.68,0.7c0,0.39 -0.31,0.71 -0.68,0.71zm6.15,-0.71c-3.21,0 -5.81,2.68 -5.81,5.99c0,3.3 2.61,5.98 5.81,5.98c3.21,0 5.81,-2.68 5.81,-5.98c0,-3.31 -2.61,-5.99 -5.81,-5.99zm0,1.41c1.19,0 2.31,0.47 3.14,1.34c0.84,0.87 1.3,2.01 1.3,3.24c0,1.22 -0.46,2.37 -1.3,3.23c-0.83,0.87 -1.95,1.35 -3.14,1.35c-1.19,0 -2.31,-0.48 -3.14,-1.35c-0.84,-0.87 -1.3,-2.01 -1.3,-3.23c0,-1.23 0.46,-2.38 1.3,-3.24c0.83,-0.87 1.95,-1.34 3.14,-1.34zm0,2.46c-1.14,0 -2.05,0.94 -2.05,2.11c0,1.16 0.91,2.11 2.05,2.11c1.14,0 2.06,-0.95 2.06,-2.11c0,-1.17 -0.92,-2.11 -2.06,-2.11zm0,1.4c0.37,0 0.69,0.32 0.69,0.71c0,0.38 -0.32,0.7 -0.69,0.7c-0.37,0 -0.68,-0.32 -0.68,-0.7c0,-0.39 0.31,-0.71 0.68,-0.71z" id="svg_1"></path>'),IA=gr('<path d="m1.08,0l-1.08,1.08l4.19,4.2l-1.64,1.64l4.36,0l0,-4.36l-1.62,1.62l-4.21,-4.18zm14.73,5.28l4.19,-4.2l-1.08,-1.08l-4.21,4.18l-1.62,-1.62l0,4.36l4.36,0l-1.64,-1.64zm-11.64,9.42l-4.09,4.11l1.08,1.19l4.11,-4.2l1.64,1.64l0,-4.36l-4.36,0l1.62,1.62zm13.28,-1.62l-4.36,0l0,4.36l1.64,-1.64l4.11,4.2l1.08,-1.19l-4.09,-4.11l1.62,-1.62z" id="svg_1" transform="scale(1.09 1.09)"></path>'),MA=gr('<path d="m2.93,1.77l4.65,4.64l-1.19,1.19l-4.62,-4.67l-1.77,1.77l0,-4.7l4.7,0l-1.77,1.77zm3.48,10.63l-4.64,4.64l-1.77,-1.76l0,4.7l4.7,0l-1.77,-1.77l4.65,-4.64l-1.17,-1.17zm8.87,-12.4l1.76,1.77l-4.64,4.64l1.19,1.19l4.64,-4.64l1.77,1.76l0,-4.72l-4.72,0zm-1.71,12.4l-1.19,1.19l4.64,4.64l-1.77,1.77l4.73,0l0,-4.72l-1.77,1.76l-4.64,-4.64z" id="svg_1" transform="scale(1.095 1.095)"></path>'),AA=gr('<path d="m12.24,4.81c2.72,0 4.93,2.2 4.93,4.92c0,0.01 0,0.03 0,0.05c-0.01,0.03 -0.01,0.07 -0.01,0.11l-0.02,0.75l0.75,0c1.81,0.01 3.27,1.48 3.27,3.28c0,1.8 -1.46,3.27 -3.26,3.28l-0.16,0l-13.36,0c-2.01,0 -3.65,-1.64 -3.65,-3.64c0,-1.56 0.99,-2.94 2.47,-3.45l0.41,-0.14l0.07,-0.42c0.18,-1.06 1.09,-1.83 2.16,-1.83c0.34,0 0.67,0.08 0.98,0.24l0.67,0.34l0.31,-0.68c0.82,-1.7 2.56,-2.81 4.44,-2.81l0,0.01zm0,-0.73c-2.24,0 -4.19,1.31 -5.1,3.22c-0.39,-0.2 -0.83,-0.31 -1.31,-0.31c-1.44,0 -2.64,1.05 -2.87,2.43c-1.72,0.59 -2.96,2.22 -2.96,4.14c0,2.42 1.96,4.37 4.37,4.37l13.52,0c2.2,-0.01 3.99,-1.8 3.99,-4.01c0,-2.21 -1.79,-4.01 -4,-4.01c0.01,-0.06 0.01,-0.12 0.01,-0.18c0,-3.12 -2.53,-5.65 -5.66,-5.65l0,0z" fill="#000000" id="svg_1"></path>'),TA=gr('<path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" fill="currentColor"></path>'),LA=gr('<g transform="scale(-1,1) translate(-24,0)"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" fill="currentColor"></path></g>'),FA=gr('<g transform="scale(0.9166666667)"><path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M20 13H15.874C15.5122 14.4056 14.4056 15.5122 13 15.874V20C13 20.2652 12.8946 20.5196 12.7071 20.7071C12.5196 20.8946 12.2652 21 12 21C11.7348 21 11.4804 20.8946 11.2929 20.7071C11.1054 20.5196 11 20.2652 11 20V15.874C9.59439 15.5122 8.4878 14.4056 8.12602 13H4C3.73478 13 3.48043 12.8946 3.29289 12.7071C3.10536 12.5196 3 12.2652 3 12C3 11.7348 3.10536 11.4804 3.29289 11.2929C3.48043 11.1054 3.73478 11 4 11H8.12602C8.4878 9.59439 9.59439 8.4878 11 8.12602V4C11 3.73478 11.1054 3.48043 11.2929 3.29289C11.4804 3.10536 11.7348 3 12 3C12.2652 3 12.5196 3.10536 12.7071 3.29289C12.8946 3.48043 13 3.73478 13 4V8.12602C14.4056 8.4878 15.5122 9.59439 15.874 11H20C20.2652 11 20.5196 11.1054 20.7071 11.2929C20.8946 11.4804 21 11.7348 21 12C21 12.2652 20.8946 12.5196 20.7071 12.7071C20.5196 12.8946 20.2652 13 20 13ZM12 10C10.8954 10 10 10.8954 10 12C10 13.1046 10.8954 14 12 14C13.1046 14 14 13.1046 14 12C14 10.8954 13.1046 10 12 10Z"></path></g>'),$A=gr('<rect x="3" y="4" width="16" height="14" rx="1" fill="none" stroke="currentColor" stroke-width="0.5"></rect><rect x="13" y="4" width="6" height="14" rx="1" fill="currentColor" fill-opacity="0.3"></rect><line x1="13" y1="4" x2="13" y2="18" stroke="currentColor" stroke-width="0.5"></line>',1),EA=gr('<div class="icon-fallback"> </div>'),NA=gr('<svg class="icon-overlay fill-current svelte-19kzeyz" viewBox="0 0 22 22"><!></svg>');function If(n,e){let t=Ws(e,"name",3,"none"),o=Ws(e,"active",3,!1),i=Ws(e,"size",3,32);var r=NA(),a=g(r);Te(a,()=>t()=="horizontalStraightLine",l=>{var c=wM();z(l,c)},l=>{var c=Ln(),d=Dt(c);Te(d,()=>t()=="ruler",p=>{var m=kM();z(p,m)},p=>{var m=Ln(),h=Dt(m);Te(h,()=>t()=="abcd",_=>{var w=SM();z(_,w)},_=>{var w=Ln(),S=Dt(w);Te(S,()=>t()=="anyWaves",P=>{var I=CM();z(P,I)},P=>{var I=Ln(),C=Dt(I);Te(C,()=>t()=="arrow",M=>{var F=PM();z(M,F)},M=>{var F=Ln(),V=Dt(F);Te(V,()=>t()=="circle",j=>{var D=IM();z(j,D)},j=>{var D=Ln(),R=Dt(D);Te(R,()=>t()=="eightWaves",W=>{var J=MM();z(W,J)},W=>{var J=Ln(),Z=Dt(J);Te(Z,()=>t()=="fibonacciCircle",G=>{var se=AM();ai(4),z(G,se)},G=>{var se=Ln(),Y=Dt(se);Te(Y,()=>t()=="fibonacciExtension",oe=>{var ee=TM();z(oe,ee)},oe=>{var ee=Ln(),re=Dt(ee);Te(re,()=>t()=="fibonacciSegment",me=>{var K=LM();z(me,K)},me=>{var K=Ln(),ye=Dt(K);Te(ye,()=>t()=="fibonacciSpeedResistanceFan",Me=>{var Fe=FM();z(Me,Fe)},Me=>{var Fe=Ln(),Ze=Dt(Fe);Te(Ze,()=>t()=="fibonacciSpiral",Ge=>{var it=$M();z(Ge,it)},Ge=>{var it=Ln(),Ye=Dt(it);Te(Ye,()=>t()=="fiveWaves",ct=>{var kt=EM();z(ct,kt)},ct=>{var kt=Ln(),ft=Dt(kt);Te(ft,()=>t()=="gannBox",bt=>{var nt=NM();z(bt,nt)},bt=>{var nt=Ln(),Pt=Dt(nt);Te(Pt,()=>t()=="horizontalRayLine",Qe=>{var yt=DM();z(Qe,yt)},Qe=>{var yt=Ln(),xe=Dt(yt);Te(xe,()=>t()=="horizontalSegment",Ve=>{var Je=jM();z(Ve,Je)},Ve=>{var Je=Ln(),St=Dt(Je);Te(St,()=>t()=="invisible",Ne=>{var ue=RM();z(Ne,ue)},Ne=>{var ue=Ln(),he=Dt(ue);Te(he,()=>t()=="visible",_t=>{var Wt=BM();z(_t,Wt)},_t=>{var Wt=Ln(),jt=Dt(Wt);Te(jt,()=>t()=="lock",Zt=>{var dn=OM();ai(),z(Zt,dn)},Zt=>{var dn=Ln(),zn=Dt(dn);Te(zn,()=>t()=="parallelogram",un=>{var On=zM();z(un,On)},un=>{var On=Ln(),no=Dt(On);Te(no,()=>t()=="parallelStraightLine",fs=>{var ps=VM();z(fs,ps)},fs=>{var ps=Ln(),So=Dt(ps);Te(So,()=>t()=="priceChannelLine",Es=>{var Qo=WM();z(Es,Qo)},Es=>{var Qo=Ln(),Ko=Dt(Qo);Te(Ko,()=>t()=="priceChannelLineNew",oo=>{var Gs=qM();z(oo,Gs)},oo=>{var Gs=Ln(),jo=Dt(Gs);Te(jo,()=>t()=="priceLine",fi=>{var ba=HM();z(fi,ba)},fi=>{var ba=Ln(),xa=Dt(ba);Te(xa,()=>t()=="rayLine",Al=>{var Qs=UM();z(Al,Qs)},Al=>{var Qs=Ln(),Fs=Dt(Qs);Te(Fs,()=>t()=="rect",Va=>{var $r=GM();z(Va,$r)},Va=>{var $r=Ln(),cd=Dt($r);Te(cd,()=>t()=="remove",Sd=>{var Nl=YM();z(Sd,Nl)},Sd=>{var Nl=Ln(),dd=Dt(Nl);Te(dd,()=>t()=="emoji",Cd=>{var fa=KM();ai(3),z(Cd,fa)},Cd=>{var fa=Ln(),Dl=Dt(fa);Te(Dl,()=>t()=="text",ml=>{var gl=ZM();z(ml,gl)},ml=>{var gl=Ln(),_d=Dt(gl);Te(_d,()=>t()=="segment",Kl=>{var ic=XM();z(Kl,ic)},Kl=>{var ic=Ln(),od=Dt(ic);Te(od,()=>t()=="candle",zd=>{var Ec=JM();z(zd,Ec)},zd=>{var Ec=Ln(),al=Dt(Ec);Te(al,()=>t()=="line",kc=>{var Vd=QM();z(kc,Vd)},kc=>{var Vd=Ln(),sd=Dt(Vd);Te(sd,()=>t()=="area",id=>{var Pd=eA();z(id,Pd)},id=>{var Pd=Ln(),Ed=Dt(Pd);Te(Ed,()=>t()=="candle_solid",zl=>{var Gd=tA();z(zl,Gd)},zl=>{var Gd=Ln(),lu=Dt(Gd);Te(lu,()=>t()=="candle_stroke",Yd=>{var eu=nA();ai(2),z(Yd,eu)},Yd=>{var eu=Ln(),Ju=Dt(eu);Te(Ju,()=>t()=="candle_up_stroke",mu=>{var yd=oA();ai(2),z(mu,yd)},mu=>{var yd=Ln(),tn=Dt(yd);Te(tn,()=>t()=="candle_down_stroke",En=>{var go=sA();ai(2),z(En,go)},En=>{var go=Ln(),hn=Dt(go);Te(hn,()=>t()=="ohlc",Ho=>{var Eo=iA();ai(),z(Ho,Eo)},Ho=>{var Eo=Ln(),di=Dt(Eo);Te(di,()=>t()=="point_and_figure",ns=>{var $i=rA();z(ns,$i)},ns=>{var $i=Ln(),hi=Dt($i);Te(hi,()=>t()=="straightLine",li=>{var ks=aA();z(li,ks)},li=>{var ks=Ln(),Vi=Dt(ks);Te(Vi,()=>t()=="strongMagnet",gs=>{var ll=lA();ai(),z(gs,ll)},gs=>{var ll=Ln(),mi=Dt(ll);Te(mi,()=>t()=="threeWaves",Na=>{var le=cA();z(Na,le)},Na=>{var le=Ln(),we=Dt(le);Te(we,()=>t()=="triangle",H=>{var ne=dA();z(H,ne)},H=>{var ne=Ln(),_e=Dt(ne);Te(_e,()=>t()=="unlock",q=>{var De=uA();z(q,De)},q=>{var De=Ln(),ot=Dt(De);Te(ot,()=>t()=="verticalRayLine",je=>{var Ft=pA();z(je,Ft)},je=>{var Ft=Ln(),Be=Dt(Ft);Te(Be,()=>t()=="verticalSegment",xt=>{var an=vA();z(xt,an)},xt=>{var an=Ln(),Yn=Dt(an);Te(Yn,()=>t()=="verticalStraightLine",bn=>{var be=fA();z(bn,be)},bn=>{var be=Ln(),tt=Dt(be);Te(tt,()=>t()=="visiable",wt=>{var Lt=mA();z(wt,Lt)},wt=>{var Lt=Ln(),qt=Dt(Lt);Te(qt,()=>t()=="weakMagnet",qn=>{var Xt=gA();z(qn,Xt)},qn=>{var Xt=Ln(),vo=Dt(Xt);Te(vo,()=>t()=="xabcd",To=>{var co=hA();z(To,co)},To=>{var co=Ln(),so=Dt(co);Te(so,()=>t()=="lang",Jo=>{var Os=_A();z(Jo,Os)},Jo=>{var Os=Ln(),wr=Dt(Os);Te(wr,()=>t()=="theme",ra=>{var Qr=yA();z(ra,Qr)},ra=>{var Qr=Ln(),hl=Dt(Qr);Te(hl,()=>t()=="user",lc=>{var qr=bA();z(lc,qr)},lc=>{var qr=Ln(),Ga=Dt(qr);Te(Ga,()=>t()=="indicator",Ki=>{var Zl=xA();z(Ki,Zl)},Ki=>{var Zl=Ln(),Tl=Dt(Zl);Te(Tl,()=>t()=="timezone",Ya=>{var ur=wA();z(Ya,ur)},Ya=>{var ur=Ln(),rc=Dt(ur);Te(rc,()=>t()=="play",zr=>{var rd=kA();z(zr,rd)},zr=>{var rd=Ln(),cc=Dt(rd);Te(cc,()=>t()=="stop",dc=>{var Er=SA();z(dc,Er)},dc=>{var Er=Ln(),Sc=Dt(Er);Te(Sc,()=>t()=="setting",ea=>{var Cc=CA();z(ea,Cc)},ea=>{var Cc=Ln(),Ac=Dt(Cc);Te(Ac,()=>t()=="screenShot",cu=>{var Id=PA();z(cu,Id)},cu=>{var Id=Ln(),Zc=Dt(Id);Te(Zc,()=>t()=="exitFullScreen",ce=>{var st=IA();z(ce,st)},ce=>{var st=Ln(),ge=Dt(st);Te(ge,()=>t()=="fullScreen",Le=>{var dt=MA();z(Le,dt)},Le=>{var dt=Ln(),At=Dt(dt);Te(At,()=>t()=="cloud",pt=>{var at=AA();z(pt,at)},pt=>{var at=Ln(),Ct=Dt(at);Te(Ct,()=>t()=="undo",Re=>{var kn=TA();z(Re,kn)},Re=>{var kn=Ln(),ro=Dt(kn);Te(ro,()=>t()=="redo",uo=>{var hs=LA();z(uo,hs)},uo=>{var hs=Ln(),Ei=Dt(hs);Te(Ei,()=>t()=="crosshair",ei=>{var Ys=FA();z(ei,Ys)},ei=>{var Ys=Ln(),Ht=Dt(Ys);Te(Ht,()=>t()=="sidebar",qe=>{var fn=$A();ai(2),z(qe,fn)},qe=>{var fn=EA(),Fn=g(fn,!0);f(fn),Se(()=>ze(Fn,t())),z(qe,fn)},!0),z(ei,Ys)},!0),z(uo,hs)},!0),z(Re,kn)},!0),z(pt,at)},!0),z(Le,dt)},!0),z(ce,st)},!0),z(cu,Id)},!0),z(ea,Cc)},!0),z(dc,Er)},!0),z(zr,rd)},!0),z(Ya,ur)},!0),z(Ki,Zl)},!0),z(lc,qr)},!0),z(ra,Qr)},!0),z(Jo,Os)},!0),z(To,co)},!0),z(qn,Xt)},!0),z(wt,Lt)},!0),z(bn,be)},!0),z(xt,an)},!0),z(je,Ft)},!0),z(q,De)},!0),z(H,ne)},!0),z(Na,le)},!0),z(gs,ll)},!0),z(li,ks)},!0),z(ns,$i)},!0),z(Ho,Eo)},!0),z(En,go)},!0),z(mu,yd)},!0),z(Yd,eu)},!0),z(zl,Gd)},!0),z(id,Pd)},!0),z(kc,Vd)},!0),z(zd,Ec)},!0),z(Kl,ic)},!0),z(ml,gl)},!0),z(Cd,fa)},!0),z(Sd,Nl)},!0),z(Va,$r)},!0),z(Al,Qs)},!0),z(fi,ba)},!0),z(oo,Gs)},!0),z(Es,Qo)},!0),z(fs,ps)},!0),z(un,On)},!0),z(Zt,dn)},!0),z(_t,Wt)},!0),z(Ne,ue)},!0),z(Ve,Je)},!0),z(Qe,yt)},!0),z(bt,nt)},!0),z(ct,kt)},!0),z(Ge,it)},!0),z(Me,Fe)},!0),z(me,K)},!0),z(oe,ee)},!0),z(G,se)},!0),z(W,J)},!0),z(j,D)},!0),z(M,F)},!0),z(P,I)},!0),z(_,w)},!0),z(p,m)},!0),z(l,c)}),f(r),Se(()=>{zt(r,"style",`width: ${i()??""}px; height: ${i()??""}px;`),Fi(r,"active",o())}),z(n,r)}var c_={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */c_.exports;(function(n,e){(function(){var t,o="4.17.21",i=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",d=500,p="__lodash_placeholder__",m=1,h=2,_=4,w=1,S=2,P=1,I=2,C=4,M=8,F=16,V=32,j=64,D=128,R=256,W=512,J=30,Z="...",G=800,se=16,Y=1,oe=2,ee=3,re=1/0,me=9007199254740991,K=17976931348623157e292,ye=NaN,Me=4294967295,Fe=Me-1,Ze=Me>>>1,Ge=[["ary",D],["bind",P],["bindKey",I],["curry",M],["curryRight",F],["flip",W],["partial",V],["partialRight",j],["rearg",R]],it="[object Arguments]",Ye="[object Array]",ct="[object AsyncFunction]",kt="[object Boolean]",ft="[object Date]",bt="[object DOMException]",nt="[object Error]",Pt="[object Function]",Qe="[object GeneratorFunction]",yt="[object Map]",xe="[object Number]",Ve="[object Null]",Je="[object Object]",St="[object Promise]",Ne="[object Proxy]",ue="[object RegExp]",he="[object Set]",_t="[object String]",Wt="[object Symbol]",jt="[object Undefined]",Zt="[object WeakMap]",dn="[object WeakSet]",zn="[object ArrayBuffer]",un="[object DataView]",On="[object Float32Array]",no="[object Float64Array]",fs="[object Int8Array]",ps="[object Int16Array]",So="[object Int32Array]",Es="[object Uint8Array]",Qo="[object Uint8ClampedArray]",Ko="[object Uint16Array]",oo="[object Uint32Array]",Gs=/\b__p \+= '';/g,jo=/\b(__p \+=) '' \+/g,fi=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ba=/&(?:amp|lt|gt|quot|#39);/g,xa=/[&<>"']/g,Al=RegExp(ba.source),Qs=RegExp(xa.source),Fs=/<%-([\s\S]+?)%>/g,Va=/<%([\s\S]+?)%>/g,$r=/<%=([\s\S]+?)%>/g,cd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Sd=/^\w*$/,Nl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dd=/[\\^$.*+?()[\]{}|]/g,Cd=RegExp(dd.source),fa=/^\s+/,Dl=/\s/,ml=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,gl=/\{\n\/\* \[wrapped with (.+)\] \*/,_d=/,? & /,Kl=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ic=/[()=,{}\[\]\/\s]/,od=/\\(\\)?/g,zd=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ec=/\w*$/,al=/^[-+]0x[0-9a-f]+$/i,kc=/^0b[01]+$/i,Vd=/^\[object .+?Constructor\]$/,sd=/^0o[0-7]+$/i,id=/^(?:0|[1-9]\d*)$/,Pd=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ed=/($^)/,zl=/['\n\r\u2028\u2029\\]/g,Gd="\\ud800-\\udfff",lu="\\u0300-\\u036f",Yd="\\ufe20-\\ufe2f",eu="\\u20d0-\\u20ff",Ju=lu+Yd+eu,mu="\\u2700-\\u27bf",yd="a-z\\xdf-\\xf6\\xf8-\\xff",tn="\\xac\\xb1\\xd7\\xf7",En="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",go="\\u2000-\\u206f",hn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ho="A-Z\\xc0-\\xd6\\xd8-\\xde",Eo="\\ufe0e\\ufe0f",di=tn+En+go+hn,ns="['’]",$i="["+Gd+"]",hi="["+di+"]",li="["+Ju+"]",ks="\\d+",Vi="["+mu+"]",gs="["+yd+"]",ll="[^"+Gd+di+ks+mu+yd+Ho+"]",mi="\\ud83c[\\udffb-\\udfff]",Na="(?:"+li+"|"+mi+")",le="[^"+Gd+"]",we="(?:\\ud83c[\\udde6-\\uddff]){2}",H="[\\ud800-\\udbff][\\udc00-\\udfff]",ne="["+Ho+"]",_e="\\u200d",q="(?:"+gs+"|"+ll+")",De="(?:"+ne+"|"+ll+")",ot="(?:"+ns+"(?:d|ll|m|re|s|t|ve))?",je="(?:"+ns+"(?:D|LL|M|RE|S|T|VE))?",Ft=Na+"?",Be="["+Eo+"]?",xt="(?:"+_e+"(?:"+[le,we,H].join("|")+")"+Be+Ft+")*",an="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Yn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",bn=Be+Ft+xt,be="(?:"+[Vi,we,H].join("|")+")"+bn,tt="(?:"+[le+li+"?",li,we,H,$i].join("|")+")",wt=RegExp(ns,"g"),Lt=RegExp(li,"g"),qt=RegExp(mi+"(?="+mi+")|"+tt+bn,"g"),qn=RegExp([ne+"?"+gs+"+"+ot+"(?="+[hi,ne,"$"].join("|")+")",De+"+"+je+"(?="+[hi,ne+q,"$"].join("|")+")",ne+"?"+q+"+"+ot,ne+"+"+je,Yn,an,ks,be].join("|"),"g"),Xt=RegExp("["+_e+Gd+Ju+Eo+"]"),vo=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,To=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],co=-1,so={};so[On]=so[no]=so[fs]=so[ps]=so[So]=so[Es]=so[Qo]=so[Ko]=so[oo]=!0,so[it]=so[Ye]=so[zn]=so[kt]=so[un]=so[ft]=so[nt]=so[Pt]=so[yt]=so[xe]=so[Je]=so[ue]=so[he]=so[_t]=so[Zt]=!1;var Jo={};Jo[it]=Jo[Ye]=Jo[zn]=Jo[un]=Jo[kt]=Jo[ft]=Jo[On]=Jo[no]=Jo[fs]=Jo[ps]=Jo[So]=Jo[yt]=Jo[xe]=Jo[Je]=Jo[ue]=Jo[he]=Jo[_t]=Jo[Wt]=Jo[Es]=Jo[Qo]=Jo[Ko]=Jo[oo]=!0,Jo[nt]=Jo[Pt]=Jo[Zt]=!1;var Os={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},wr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ra={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Qr={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},hl=parseFloat,lc=parseInt,qr=typeof ng=="object"&&ng&&ng.Object===Object&&ng,Ga=typeof self=="object"&&self&&self.Object===Object&&self,Ki=qr||Ga||Function("return this")(),Zl=e&&!e.nodeType&&e,Tl=Zl&&!0&&n&&!n.nodeType&&n,Ya=Tl&&Tl.exports===Zl,ur=Ya&&qr.process,rc=function(){try{var Et=Tl&&Tl.require&&Tl.require("util").types;return Et||ur&&ur.binding&&ur.binding("util")}catch{}}(),zr=rc&&rc.isArrayBuffer,rd=rc&&rc.isDate,cc=rc&&rc.isMap,dc=rc&&rc.isRegExp,Er=rc&&rc.isSet,Sc=rc&&rc.isTypedArray;function ea(Et,Nn,pn){switch(pn.length){case 0:return Et.call(Nn);case 1:return Et.call(Nn,pn[0]);case 2:return Et.call(Nn,pn[0],pn[1]);case 3:return Et.call(Nn,pn[0],pn[1],pn[2])}return Et.apply(Nn,pn)}function Cc(Et,Nn,pn,os){for(var Ps=-1,sr=Et==null?0:Et.length;++Ps<sr;){var Cl=Et[Ps];Nn(os,Cl,pn(Cl),Et)}return os}function Ac(Et,Nn){for(var pn=-1,os=Et==null?0:Et.length;++pn<os&&Nn(Et[pn],pn,Et)!==!1;);return Et}function cu(Et,Nn){for(var pn=Et==null?0:Et.length;pn--&&Nn(Et[pn],pn,Et)!==!1;);return Et}function Id(Et,Nn){for(var pn=-1,os=Et==null?0:Et.length;++pn<os;)if(!Nn(Et[pn],pn,Et))return!1;return!0}function Zc(Et,Nn){for(var pn=-1,os=Et==null?0:Et.length,Ps=0,sr=[];++pn<os;){var Cl=Et[pn];Nn(Cl,pn,Et)&&(sr[Ps++]=Cl)}return sr}function ce(Et,Nn){var pn=Et==null?0:Et.length;return!!pn&&uo(Et,Nn,0)>-1}function st(Et,Nn,pn){for(var os=-1,Ps=Et==null?0:Et.length;++os<Ps;)if(pn(Nn,Et[os]))return!0;return!1}function ge(Et,Nn){for(var pn=-1,os=Et==null?0:Et.length,Ps=Array(os);++pn<os;)Ps[pn]=Nn(Et[pn],pn,Et);return Ps}function Le(Et,Nn){for(var pn=-1,os=Nn.length,Ps=Et.length;++pn<os;)Et[Ps+pn]=Nn[pn];return Et}function dt(Et,Nn,pn,os){var Ps=-1,sr=Et==null?0:Et.length;for(os&&sr&&(pn=Et[++Ps]);++Ps<sr;)pn=Nn(pn,Et[Ps],Ps,Et);return pn}function At(Et,Nn,pn,os){var Ps=Et==null?0:Et.length;for(os&&Ps&&(pn=Et[--Ps]);Ps--;)pn=Nn(pn,Et[Ps],Ps,Et);return pn}function pt(Et,Nn){for(var pn=-1,os=Et==null?0:Et.length;++pn<os;)if(Nn(Et[pn],pn,Et))return!0;return!1}var at=Ys("length");function Ct(Et){return Et.split("")}function Re(Et){return Et.match(Kl)||[]}function kn(Et,Nn,pn){var os;return pn(Et,function(Ps,sr,Cl){if(Nn(Ps,sr,Cl))return os=sr,!1}),os}function ro(Et,Nn,pn,os){for(var Ps=Et.length,sr=pn+(os?1:-1);os?sr--:++sr<Ps;)if(Nn(Et[sr],sr,Et))return sr;return-1}function uo(Et,Nn,pn){return Nn===Nn?as(Et,Nn,pn):ro(Et,Ei,pn)}function hs(Et,Nn,pn,os){for(var Ps=pn-1,sr=Et.length;++Ps<sr;)if(os(Et[Ps],Nn))return Ps;return-1}function Ei(Et){return Et!==Et}function ei(Et,Nn){var pn=Et==null?0:Et.length;return pn?Fn(Et,Nn)/pn:ye}function Ys(Et){return function(Nn){return Nn==null?t:Nn[Et]}}function Ht(Et){return function(Nn){return Et==null?t:Et[Nn]}}function qe(Et,Nn,pn,os,Ps){return Ps(Et,function(sr,Cl,Lc){pn=os?(os=!1,sr):Nn(pn,sr,Cl,Lc)}),pn}function fn(Et,Nn){var pn=Et.length;for(Et.sort(Nn);pn--;)Et[pn]=Et[pn].value;return Et}function Fn(Et,Nn){for(var pn,os=-1,Ps=Et.length;++os<Ps;){var sr=Nn(Et[os]);sr!==t&&(pn=pn===t?sr:pn+sr)}return pn}function Vt(Et,Nn){for(var pn=-1,os=Array(Et);++pn<Et;)os[pn]=Nn(pn);return os}function mn(Et,Nn){return ge(Nn,function(pn){return[pn,Et[pn]]})}function Kn(Et){return Et&&Et.slice(0,Hr(Et)+1).replace(fa,"")}function Pn(Et){return function(Nn){return Et(Nn)}}function Hn(Et,Nn){return ge(Nn,function(pn){return Et[pn]})}function No(Et,Nn){return Et.has(Nn)}function Mo(Et,Nn){for(var pn=-1,os=Et.length;++pn<os&&uo(Nn,Et[pn],0)>-1;);return pn}function qs(Et,Nn){for(var pn=Et.length;pn--&&uo(Nn,Et[pn],0)>-1;);return pn}function ta(Et,Nn){for(var pn=Et.length,os=0;pn--;)Et[pn]===Nn&&++os;return os}var Nc=Ht(Os),Tc=Ht(wr);function Sl(Et){return"\\"+Qr[Et]}function Ks(Et,Nn){return Et==null?t:Et[Nn]}function ci(Et){return Xt.test(Et)}function Lo(Et){return vo.test(Et)}function ln(Et){for(var Nn,pn=[];!(Nn=Et.next()).done;)pn.push(Nn.value);return pn}function or(Et){var Nn=-1,pn=Array(Et.size);return Et.forEach(function(os,Ps){pn[++Nn]=[Ps,os]}),pn}function tr(Et,Nn){return function(pn){return Et(Nn(pn))}}function Zi(Et,Nn){for(var pn=-1,os=Et.length,Ps=0,sr=[];++pn<os;){var Cl=Et[pn];(Cl===Nn||Cl===p)&&(Et[pn]=p,sr[Ps++]=pn)}return sr}function Yt(Et){var Nn=-1,pn=Array(Et.size);return Et.forEach(function(os){pn[++Nn]=os}),pn}function Xo(Et){var Nn=-1,pn=Array(Et.size);return Et.forEach(function(os){pn[++Nn]=[os,os]}),pn}function as(Et,Nn,pn){for(var os=pn-1,Ps=Et.length;++os<Ps;)if(Et[os]===Nn)return os;return-1}function Pi(Et,Nn,pn){for(var os=pn+1;os--;)if(Et[os]===Nn)return os;return os}function As(Et){return ci(Et)?Nd(Et):at(Et)}function Xs(Et){return ci(Et)?Ru(Et):Ct(Et)}function Hr(Et){for(var Nn=Et.length;Nn--&&Dl.test(Et.charAt(Nn)););return Nn}var Xl=Ht(ra);function Nd(Et){for(var Nn=qt.lastIndex=0;qt.test(Et);)++Nn;return Nn}function Ru(Et){return Et.match(qt)||[]}function Xc(Et){return Et.match(qn)||[]}var Vl=function Et(Nn){Nn=Nn==null?Ki:_l.defaults(Ki.Object(),Nn,_l.pick(Ki,To));var pn=Nn.Array,os=Nn.Date,Ps=Nn.Error,sr=Nn.Function,Cl=Nn.Math,Lc=Nn.Object,cp=Nn.RegExp,qp=Nn.String,Wd=Nn.TypeError,kp=pn.prototype,Ov=sr.prototype,Lv=Lc.prototype,zv=Nn["__core-js_shared__"],Vv=Ov.toString,ud=Lv.hasOwnProperty,Rc=0,Bc=function(){var v=/[^.]+$/.exec(zv&&zv.keys&&zv.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),qd=Lv.toString,Oc=Vv.call(Lc),B=Ki._,de=cp("^"+Vv.call(ud).replace(dd,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Oe=Ya?Nn.Buffer:t,Ue=Nn.Symbol,mt=Nn.Uint8Array,_n=Oe?Oe.allocUnsafe:t,en=tr(Lc.getPrototypeOf,Lc),Vn=Lc.create,Rn=Lv.propertyIsEnumerable,xo=kp.splice,Dn=Ue?Ue.isConcatSpreadable:t,ys=Ue?Ue.iterator:t,jn=Ue?Ue.toStringTag:t,Sn=function(){try{var v=Ev(Lc,"defineProperty");return v({},"",{}),v}catch{}}(),Un=Nn.clearTimeout!==Ki.clearTimeout&&Nn.clearTimeout,$n=os&&os.now!==Ki.Date.now&&os.now,ms=Nn.setTimeout!==Ki.setTimeout&&Nn.setTimeout,Wo=Cl.ceil,Yo=Cl.floor,Po=Lc.getOwnPropertySymbols,Is=Oe?Oe.isBuffer:t,An=Nn.isFinite,Ro=kp.join,vn=tr(Lc.keys,Lc),on=Cl.max,rn=Cl.min,fo=os.now,Bn=Nn.parseInt,Io=Cl.random,Gn=kp.reverse,ti=Ev(Nn,"DataView"),Ds=Ev(Nn,"Map"),bi=Ev(Nn,"Promise"),yl=Ev(Nn,"Set"),uc=Ev(Nn,"WeakMap"),kr=Ev(Lc,"create"),Ka=uc&&new uc,ni={},Ca=af(ti),wa=af(Ds),Pa=af(bi),Jl=af(yl),bd=af(uc),Fo=Ue?Ue.prototype:t,Ql=Fo?Fo.valueOf:t,Dc=Fo?Fo.toString:t;function Ee(v){if(vi(v)&&!xs(v)&&!(v instanceof Xi)){if(v instanceof Pc)return v;if(ud.call(v,"__wrapped__"))return Kf(v)}return new Pc(v)}var ac=function(){function v(){}return function(y){if(!Vo(y))return{};if(Vn)return Vn(y);v.prototype=y;var L=new v;return v.prototype=t,L}}();function Ia(){}function Pc(v,y){this.__wrapped__=v,this.__actions__=[],this.__chain__=!!y,this.__index__=0,this.__values__=t}Ee.templateSettings={escape:Fs,evaluate:Va,interpolate:$r,variable:"",imports:{_:Ee}},Ee.prototype=Ia.prototype,Ee.prototype.constructor=Ee,Pc.prototype=ac(Ia.prototype),Pc.prototype.constructor=Pc;function Xi(v){this.__wrapped__=v,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Me,this.__views__=[]}function aa(){var v=new Xi(this.__wrapped__);return v.__actions__=Ll(this.__actions__),v.__dir__=this.__dir__,v.__filtered__=this.__filtered__,v.__iteratees__=Ll(this.__iteratees__),v.__takeCount__=this.__takeCount__,v.__views__=Ll(this.__views__),v}function Fp(){if(this.__filtered__){var v=new Xi(this);v.__dir__=-1,v.__filtered__=!0}else v=this.clone(),v.__dir__*=-1;return v}function ov(){var v=this.__wrapped__.value(),y=this.__dir__,L=xs(v),X=y<0,Ie=L?v.length:0,Xe=Hf(0,Ie,this.__views__),Tt=Xe.start,Ut=Xe.end,In=Ut-Tt,ts=X?Ut:Tt-1,is=this.__iteratees__,Cs=is.length,dr=0,za=rn(In,this.__takeCount__);if(!L||!X&&Ie==In&&za==In)return Uo(v,this.__actions__);var nc=[];e:for(;In--&&dr<za;){ts+=y;for(var ld=-1,oc=v[ts];++ld<Cs;){var Fd=is[ld],Ud=Fd.iteratee,xf=Fd.type,Zv=Ud(oc);if(xf==oe)oc=Zv;else if(!Zv){if(xf==Y)continue e;break e}}nc[dr++]=oc}return nc}Xi.prototype=ac(Ia.prototype),Xi.prototype.constructor=Xi;function U(v){var y=-1,L=v==null?0:v.length;for(this.clear();++y<L;){var X=v[y];this.set(X[0],X[1])}}function te(){this.__data__=kr?kr(null):{},this.size=0}function $e(v){var y=this.has(v)&&delete this.__data__[v];return this.size-=y?1:0,y}function ut(v){var y=this.__data__;if(kr){var L=y[v];return L===c?t:L}return ud.call(y,v)?y[v]:t}function Kt(v){var y=this.__data__;return kr?y[v]!==t:ud.call(y,v)}function $t(v,y){var L=this.__data__;return this.size+=this.has(v)?0:1,L[v]=kr&&y===t?c:y,this}U.prototype.clear=te,U.prototype.delete=$e,U.prototype.get=ut,U.prototype.has=Kt,U.prototype.set=$t;function wn(v){var y=-1,L=v==null?0:v.length;for(this.clear();++y<L;){var X=v[y];this.set(X[0],X[1])}}function Zn(){this.__data__=[],this.size=0}function yo(v){var y=this.__data__,L=el(y,v);if(L<0)return!1;var X=y.length-1;return L==X?y.pop():xo.call(y,L,1),--this.size,!0}function es(v){var y=this.__data__,L=el(y,v);return L<0?t:y[L][1]}function $s(v){return el(this.__data__,v)>-1}function oi(v,y){var L=this.__data__,X=el(L,v);return X<0?(++this.size,L.push([v,y])):L[X][1]=y,this}wn.prototype.clear=Zn,wn.prototype.delete=yo,wn.prototype.get=es,wn.prototype.has=$s,wn.prototype.set=oi;function Ts(v){var y=-1,L=v==null?0:v.length;for(this.clear();++y<L;){var X=v[y];this.set(X[0],X[1])}}function hr(){this.size=0,this.__data__={hash:new U,map:new(Ds||wn),string:new U}}function Vr(v){var y=Hv(this,v).delete(v);return this.size-=y?1:0,y}function Nt(v){return Hv(this,v).get(v)}function Wn(v){return Hv(this,v).has(v)}function Co(v,y){var L=Hv(this,v),X=L.size;return L.set(v,y),this.size+=L.size==X?0:1,this}Ts.prototype.clear=hr,Ts.prototype.delete=Vr,Ts.prototype.get=Nt,Ts.prototype.has=Wn,Ts.prototype.set=Co;function mo(v){var y=-1,L=v==null?0:v.length;for(this.__data__=new Ts;++y<L;)this.add(v[y])}function Bo(v){return this.__data__.set(v,c),this}function ws(v){return this.__data__.has(v)}mo.prototype.add=mo.prototype.push=Bo,mo.prototype.has=ws;function $o(v){var y=this.__data__=new wn(v);this.size=y.size}function _i(){this.__data__=new wn,this.size=0}function Ar(v){var y=this.__data__,L=y.delete(v);return this.size=y.size,L}function Da(v){return this.__data__.get(v)}function Oo(v){return this.__data__.has(v)}function ss(v,y){var L=this.__data__;if(L instanceof wn){var X=L.__data__;if(!Ds||X.length<i-1)return X.push([v,y]),this.size=++L.size,this;L=this.__data__=new Ts(X)}return L.set(v,y),this.size=L.size,this}$o.prototype.clear=_i,$o.prototype.delete=Ar,$o.prototype.get=Da,$o.prototype.has=Oo,$o.prototype.set=ss;function ds(v,y){var L=xs(v),X=!L&&Fa(v),Ie=!L&&!X&&zs(v),Xe=!L&&!X&&!Ie&&Oa(v),Tt=L||X||Ie||Xe,Ut=Tt?Vt(v.length,qp):[],In=Ut.length;for(var ts in v)(y||ud.call(v,ts))&&!(Tt&&(ts=="length"||Ie&&(ts=="offset"||ts=="parent")||Xe&&(ts=="buffer"||ts=="byteLength"||ts=="byteOffset")||kv(ts,In)))&&Ut.push(ts);return Ut}function yn(v){var y=v.length;return y?v[dl(0,y-1)]:t}function wo(v,y){return rf(Ll(v),Kd(y,0,v.length))}function si(v){return rf(Ll(v))}function ir(v,y,L){(L!==t&&!lr(v[y],L)||L===t&&!(y in v))&&gc(v,y,L)}function Ji(v,y,L){var X=v[y];(!(ud.call(v,y)&&lr(X,L))||L===t&&!(y in v))&&gc(v,y,L)}function el(v,y){for(var L=v.length;L--;)if(lr(v[L][0],y))return L;return-1}function Dd(v,y,L,X){return ku(v,function(Ie,Xe,Tt){y(X,Ie,L(Ie),Tt)}),X}function Ma(v,y){return v&&ao(y,Au(y),v)}function jl(v,y){return v&&ao(y,Rd(y),v)}function gc(v,y,L){y=="__proto__"&&Sn?Sn(v,y,{configurable:!0,enumerable:!0,value:L,writable:!0}):v[y]=L}function Qi(v,y){for(var L=-1,X=y.length,Ie=pn(X),Xe=v==null;++L<X;)Ie[L]=Xe?t:Cv(v,y[L]);return Ie}function Kd(v,y,L){return v===v&&(L!==t&&(v=v<=L?v:L),y!==t&&(v=v>=y?v:y)),v}function Gc(v,y,L,X,Ie,Xe){var Tt,Ut=y&m,In=y&h,ts=y&_;if(L&&(Tt=Ie?L(v,X,Ie,Xe):L(v)),Tt!==t)return Tt;if(!Vo(v))return v;var is=xs(v);if(is){if(Tt=Uf(v),!Ut)return Ll(v,Tt)}else{var Cs=ap(v),dr=Cs==Pt||Cs==Qe;if(zs(v))return Ai(v,Ut);if(Cs==Je||Cs==it||dr&&!Ie){if(Tt=In||dr?{}:Ff(v),!Ut)return In?Ic(v,jl(Tt,v)):ul(v,Ma(Tt,v))}else{if(!Jo[Cs])return Ie?v:{};Tt=cg(v,Cs,Ut)}}Xe||(Xe=new $o);var za=Xe.get(v);if(za)return za;Xe.set(v,Tt),jc(v)?v.forEach(function(oc){Tt.add(Gc(oc,y,L,oc,v,Xe))}):ha(v)&&v.forEach(function(oc,Fd){Tt.set(Fd,Gc(oc,y,L,Fd,v,Xe))});var nc=ts?In?rp:Pp:In?Rd:Au,ld=is?t:nc(v);return Ac(ld||v,function(oc,Fd){ld&&(Fd=oc,oc=v[Fd]),Ji(Tt,Fd,Gc(oc,y,L,Fd,v,Xe))}),Tt}function Wl(v){var y=Au(v);return function(L){return Fc(L,v,y)}}function Fc(v,y,L){var X=L.length;if(v==null)return!X;for(v=Lc(v);X--;){var Ie=L[X],Xe=y[Ie],Tt=v[Ie];if(Tt===t&&!(Ie in v)||!Xe(Tt))return!1}return!0}function zc(v,y,L){if(typeof v!="function")throw new Wd(a);return hf(function(){v.apply(t,L)},y)}function gu(v,y,L,X){var Ie=-1,Xe=ce,Tt=!0,Ut=v.length,In=[],ts=y.length;if(!Ut)return In;L&&(y=ge(y,Pn(L))),X?(Xe=st,Tt=!1):y.length>=i&&(Xe=No,Tt=!1,y=new mo(y));e:for(;++Ie<Ut;){var is=v[Ie],Cs=L==null?is:L(is);if(is=X||is!==0?is:0,Tt&&Cs===Cs){for(var dr=ts;dr--;)if(y[dr]===Cs)continue e;In.push(is)}else Xe(y,Cs,X)||In.push(is)}return In}var ku=Yc(Bu),Md=Yc(bv,!0);function gp(v,y){var L=!0;return ku(v,function(X,Ie,Xe){return L=!!y(X,Ie,Xe),L}),L}function $p(v,y,L){for(var X=-1,Ie=v.length;++X<Ie;){var Xe=v[X],Tt=y(Xe);if(Tt!=null&&(Ut===t?Tt===Tt&&!xc(Tt):L(Tt,Ut)))var Ut=Tt,In=Xe}return In}function hp(v,y,L,X){var Ie=v.length;for(L=va(L),L<0&&(L=-L>Ie?0:Ie+L),X=X===t||X>Ie?Ie:va(X),X<0&&(X+=Ie),X=L>X?0:Ku(X);L<X;)v[L++]=y;return v}function hv(v,y){var L=[];return ku(v,function(X,Ie,Xe){y(X,Ie,Xe)&&L.push(X)}),L}function tu(v,y,L,X,Ie){var Xe=-1,Tt=v.length;for(L||(L=Nm),Ie||(Ie=[]);++Xe<Tt;){var Ut=v[Xe];y>0&&L(Ut)?y>1?tu(Ut,y-1,L,X,Ie):Le(Ie,Ut):X||(Ie[Ie.length]=Ut)}return Ie}var _v=xi(),yv=xi(!0);function Bu(v,y){return v&&_v(v,y,Au)}function bv(v,y){return v&&yv(v,y,Au)}function Hp(v,y){return Zc(y,function(L){return Mr(v[L])})}function Ou(v,y){y=Nr(y,v);for(var L=0,X=y.length;v!=null&&L<X;)v=v[Dp(y[L++])];return L&&L==X?v:t}function _p(v,y,L){var X=y(v);return xs(v)?X:Le(X,L(v))}function du(v){return v==null?v===t?jt:Ve:jn&&jn in Lc(v)?vm(v):Gf(v)}function ve(v,y){return v>y}function Bt(v,y){return v!=null&&ud.call(v,y)}function Wi(v,y){return v!=null&&y in Lc(v)}function js(v,y,L){return v>=rn(y,L)&&v<on(y,L)}function er(v,y,L){for(var X=L?st:ce,Ie=v[0].length,Xe=v.length,Tt=Xe,Ut=pn(Xe),In=1/0,ts=[];Tt--;){var is=v[Tt];Tt&&y&&(is=ge(is,Pn(y))),In=rn(is.length,In),Ut[Tt]=!L&&(y||Ie>=120&&is.length>=120)?new mo(Tt&&is):t}is=v[0];var Cs=-1,dr=Ut[0];e:for(;++Cs<Ie&&ts.length<In;){var za=is[Cs],nc=y?y(za):za;if(za=L||za!==0?za:0,!(dr?No(dr,nc):X(ts,nc,L))){for(Tt=Xe;--Tt;){var ld=Ut[Tt];if(!(ld?No(ld,nc):X(v[Tt],nc,L)))continue e}dr&&dr.push(nc),ts.push(za)}}return ts}function na(v,y,L,X){return Bu(v,function(Ie,Xe,Tt){y(X,L(Ie),Xe,Tt)}),X}function cl(v,y,L){y=Nr(y,v),v=Yf(v,y);var X=v==null?v:v[Dp(et(y))];return X==null?t:ea(X,v,L)}function zu(v){return vi(v)&&du(v)==it}function sp(v){return vi(v)&&du(v)==zn}function Hu(v){return vi(v)&&du(v)==ft}function hu(v,y,L,X,Ie){return v===y?!0:v==null||y==null||!vi(v)&&!vi(y)?v!==v&&y!==y:Sp(v,y,L,X,hu,Ie)}function Sp(v,y,L,X,Ie,Xe){var Tt=xs(v),Ut=xs(y),In=Tt?Ye:ap(v),ts=Ut?Ye:ap(y);In=In==it?Je:In,ts=ts==it?Je:ts;var is=In==Je,Cs=ts==Je,dr=In==ts;if(dr&&zs(v)){if(!zs(y))return!1;Tt=!0,is=!1}if(dr&&!is)return Xe||(Xe=new $o),Tt||Oa(v)?$m(v,y,L,X,Ie,Xe):Cp(v,y,In,L,X,Ie,Xe);if(!(L&w)){var za=is&&ud.call(v,"__wrapped__"),nc=Cs&&ud.call(y,"__wrapped__");if(za||nc){var ld=za?v.value():v,oc=nc?y.value():y;return Xe||(Xe=new $o),Ie(ld,oc,L,X,Xe)}}return dr?(Xe||(Xe=new $o),qf(v,y,L,X,Ie,Xe)):!1}function dp(v){return vi(v)&&ap(v)==yt}function Pl(v,y,L,X){var Ie=L.length,Xe=Ie,Tt=!X;if(v==null)return!Xe;for(v=Lc(v);Ie--;){var Ut=L[Ie];if(Tt&&Ut[2]?Ut[1]!==v[Ut[0]]:!(Ut[0]in v))return!1}for(;++Ie<Xe;){Ut=L[Ie];var In=Ut[0],ts=v[In],is=Ut[1];if(Tt&&Ut[2]){if(ts===t&&!(In in v))return!1}else{var Cs=new $o;if(X)var dr=X(ts,is,In,v,y,Cs);if(!(dr===t?hu(is,ts,w|S,X,Cs):dr))return!1}}return!0}function pd(v){if(!Vo(v)||Dm(v))return!1;var y=Mr(v)?de:Vd;return y.test(af(v))}function pr(v){return vi(v)&&du(v)==ue}function Wa(v){return vi(v)&&ap(v)==he}function rr(v){return vi(v)&&ri(v.length)&&!!so[du(v)]}function Up(v){return typeof v=="function"?v:v==null?cf:typeof v=="object"?xs(v)?Gu(v[0],v[1]):up(v):by(v)}function Qu(v){if(!gf(v))return vn(v);var y=[];for(var L in Lc(v))ud.call(v,L)&&L!="constructor"&&y.push(L);return y}function nu(v){if(!Vo(v))return dg(v);var y=gf(v),L=[];for(var X in v)X=="constructor"&&(y||!ud.call(v,X))||L.push(X);return L}function hc(v,y){return v<y}function Uu(v,y){var L=-1,X=Ir(v)?pn(v.length):[];return ku(v,function(Ie,Xe,Tt){X[++L]=y(Ie,Xe,Tt)}),X}function up(v){var y=ff(v);return y.length==1&&y[0][2]?$f(y[0][0],y[0][1]):function(L){return L===v||Pl(L,v,y)}}function Gu(v,y){return cv(v)&&fm(y)?$f(Dp(v),y):function(L){var X=Cv(L,v);return X===t&&X===y?jf(L,v):hu(y,X,w|S)}}function Vu(v,y,L,X,Ie){v!==y&&_v(y,function(Xe,Tt){if(Ie||(Ie=new $o),Vo(Xe))Ep(v,y,Tt,L,Vu,X,Ie);else{var Ut=X?X(Ef(v,Tt),Xe,Tt+"",v,y,Ie):t;Ut===t&&(Ut=Xe),ir(v,Tt,Ut)}},Rd)}function Ep(v,y,L,X,Ie,Xe,Tt){var Ut=Ef(v,L),In=Ef(y,L),ts=Tt.get(In);if(ts){ir(v,L,ts);return}var is=Xe?Xe(Ut,In,L+"",v,y,Tt):t,Cs=is===t;if(Cs){var dr=xs(In),za=!dr&&zs(In),nc=!dr&&!za&&Oa(In);is=In,dr||za||nc?xs(Ut)?is=Ut:Ci(Ut)?is=Ll(Ut):za?(Cs=!1,is=Ai(In,!0)):nc?(Cs=!1,is=ka(In,!0)):is=[]:Yl(In)||Fa(In)?(is=Ut,Fa(Ut)?is=ep(Ut):(!Vo(Ut)||Mr(Ut))&&(is=Ff(In))):Cs=!1}Cs&&(Tt.set(In,is),Ie(is,In,X,Xe,Tt),Tt.delete(In)),ir(v,L,is)}function vr(v,y){var L=v.length;if(L)return y+=y<0?L:0,kv(y,L)?v[y]:t}function Sr(v,y,L){y.length?y=ge(y,function(Xe){return xs(Xe)?function(Tt){return Ou(Tt,Xe.length===1?Xe[0]:Xe)}:Xe}):y=[cf];var X=-1;y=ge(y,Pn(Aa()));var Ie=Uu(v,function(Xe,Tt,Ut){var In=ge(y,function(ts){return ts(Xe)});return{criteria:In,index:++X,value:Xe}});return fn(Ie,function(Xe,Tt){return yc(Xe,Tt,L)})}function ji(v,y){return Jc(v,y,function(L,X){return jf(v,X)})}function Jc(v,y,L){for(var X=-1,Ie=y.length,Xe={};++X<Ie;){var Tt=y[X],Ut=Ou(v,Tt);L(Ut,Tt)&&Wu(Xe,Nr(Tt,v),Ut)}return Xe}function Wv(v){return function(y){return Ou(y,v)}}function su(v,y,L,X){var Ie=X?hs:uo,Xe=-1,Tt=y.length,Ut=v;for(v===y&&(y=Ll(y)),L&&(Ut=ge(v,Pn(L)));++Xe<Tt;)for(var In=0,ts=y[Xe],is=L?L(ts):ts;(In=Ie(Ut,is,In,X))>-1;)Ut!==v&&xo.call(Ut,In,1),xo.call(v,In,1);return v}function Vc(v,y){for(var L=v?y.length:0,X=L-1;L--;){var Ie=y[L];if(L==X||Ie!==Xe){var Xe=Ie;kv(Ie)?xo.call(v,Ie,1):av(v,Ie)}}return v}function dl(v,y){return v+Yo(Io()*(y-v+1))}function Su(v,y,L,X){for(var Ie=-1,Xe=on(Wo((y-v)/(L||1)),0),Tt=pn(Xe);Xe--;)Tt[X?Xe:++Ie]=v,v+=L;return Tt}function Zd(v,y){var L="";if(!v||y<1||y>me)return L;do y%2&&(L+=v),y=Yo(y/2),y&&(v+=v);while(y);return L}function qa(v,y){return Nf(gm(v,y,cf),v+"")}function Gp(v){return yn(wm(v))}function xv(v,y){var L=wm(v);return rf(L,Kd(y,0,L.length))}function Wu(v,y,L,X){if(!Vo(v))return v;y=Nr(y,v);for(var Ie=-1,Xe=y.length,Tt=Xe-1,Ut=v;Ut!=null&&++Ie<Xe;){var In=Dp(y[Ie]),ts=L;if(In==="__proto__"||In==="constructor"||In==="prototype")return v;if(Ie!=Tt){var is=Ut[In];ts=X?X(is,In,Ut):t,ts===t&&(ts=Vo(is)?is:kv(y[Ie+1])?[]:{})}Ji(Ut,In,ts),Ut=Ut[In]}return v}var tf=Ka?function(v,y){return Ka.set(v,y),v}:cf,sv=Sn?function(v,y){return Sn(v,"toString",{configurable:!0,enumerable:!1,value:Cg(y),writable:!0})}:cf;function Yp(v){return rf(wm(v))}function _u(v,y,L){var X=-1,Ie=v.length;y<0&&(y=-y>Ie?0:Ie+y),L=L>Ie?Ie:L,L<0&&(L+=Ie),Ie=y>L?0:L-y>>>0,y>>>=0;for(var Xe=pn(Ie);++X<Ie;)Xe[X]=v[X+y];return Xe}function wv(v,y){var L;return ku(v,function(X,Ie,Xe){return L=y(X,Ie,Xe),!L}),!!L}function ip(v,y,L){var X=0,Ie=v==null?X:v.length;if(typeof y=="number"&&y===y&&Ie<=Ze){for(;X<Ie;){var Xe=X+Ie>>>1,Tt=v[Xe];Tt!==null&&!xc(Tt)&&(L?Tt<=y:Tt<y)?X=Xe+1:Ie=Xe}return Ie}return Np(v,y,cf,L)}function Np(v,y,L,X){var Ie=0,Xe=v==null?0:v.length;if(Xe===0)return 0;y=L(y);for(var Tt=y!==y,Ut=y===null,In=xc(y),ts=y===t;Ie<Xe;){var is=Yo((Ie+Xe)/2),Cs=L(v[is]),dr=Cs!==t,za=Cs===null,nc=Cs===Cs,ld=xc(Cs);if(Tt)var oc=X||nc;else ts?oc=nc&&(X||dr):Ut?oc=nc&&dr&&(X||!za):In?oc=nc&&dr&&!za&&(X||!ld):za||ld?oc=!1:oc=X?Cs<=y:Cs<y;oc?Ie=is+1:Xe=is}return rn(Xe,Fe)}function iv(v,y){for(var L=-1,X=v.length,Ie=0,Xe=[];++L<X;){var Tt=v[L],Ut=y?y(Tt):Tt;if(!L||!lr(Ut,In)){var In=Ut;Xe[Ie++]=Tt===0?0:Tt}}return Xe}function rv(v){return typeof v=="number"?v:xc(v)?ye:+v}function Cu(v){if(typeof v=="string")return v;if(xs(v))return ge(v,Cu)+"";if(xc(v))return Dc?Dc.call(v):"";var y=v+"";return y=="0"&&1/v==-re?"-0":y}function Pu(v,y,L){var X=-1,Ie=ce,Xe=v.length,Tt=!0,Ut=[],In=Ut;if(L)Tt=!1,Ie=st;else if(Xe>=i){var ts=y?null:qv(v);if(ts)return Yt(ts);Tt=!1,Ie=No,In=new mo}else In=y?[]:Ut;e:for(;++X<Xe;){var is=v[X],Cs=y?y(is):is;if(is=L||is!==0?is:0,Tt&&Cs===Cs){for(var dr=In.length;dr--;)if(In[dr]===Cs)continue e;y&&In.push(Cs),Ut.push(is)}else Ie(In,Cs,L)||(In!==Ut&&In.push(Cs),Ut.push(is))}return Ut}function av(v,y){return y=Nr(y,v),v=Yf(v,y),v==null||delete v[Dp(et(y))]}function Fv(v,y,L,X){return Wu(v,y,L(Ou(v,y)),X)}function We(v,y,L,X){for(var Ie=v.length,Xe=X?Ie:-1;(X?Xe--:++Xe<Ie)&&y(v[Xe],Xe,v););return L?_u(v,X?0:Xe,X?Xe+1:Ie):_u(v,X?Xe+1:0,X?Ie:Xe)}function Uo(v,y){var L=v;return L instanceof Xi&&(L=L.value()),dt(y,function(X,Ie){return Ie.func.apply(Ie.thisArg,Le([X],Ie.args))},L)}function ls(v,y,L){var X=v.length;if(X<2)return X?Pu(v[0]):[];for(var Ie=-1,Xe=pn(X);++Ie<X;)for(var Tt=v[Ie],Ut=-1;++Ut<X;)Ut!=Ie&&(Xe[Ie]=gu(Xe[Ie]||Tt,v[Ut],y,L));return Pu(tu(Xe,1),y,L)}function Si(v,y,L){for(var X=-1,Ie=v.length,Xe=y.length,Tt={};++X<Ie;){var Ut=X<Xe?y[X]:t;L(Tt,v[X],Ut)}return Tt}function bs(v){return Ci(v)?v:[]}function Go(v){return typeof v=="function"?v:cf}function Nr(v,y){return xs(v)?v:cv(v,y)?[v]:zm($l(v))}var Xn=qa;function tl(v,y,L){var X=v.length;return L=L===t?X:L,!y&&L>=X?v:_u(v,y,L)}var _c=Un||function(v){return Ki.clearTimeout(v)};function Ai(v,y){if(y)return v.slice();var L=v.length,X=_n?_n(L):new v.constructor(L);return v.copy(X),X}function ql(v){var y=new v.constructor(v.byteLength);return new mt(y).set(new mt(v)),y}function Hl(v,y){var L=y?ql(v.buffer):v.buffer;return new v.constructor(L,v.byteOffset,v.byteLength)}function ja(v){var y=new v.constructor(v.source,Ec.exec(v));return y.lastIndex=v.lastIndex,y}function Wr(v){return Ql?Lc(Ql.call(v)):{}}function ka(v,y){var L=y?ql(v.buffer):v.buffer;return new v.constructor(L,v.byteOffset,v.length)}function bl(v,y){if(v!==y){var L=v!==t,X=v===null,Ie=v===v,Xe=xc(v),Tt=y!==t,Ut=y===null,In=y===y,ts=xc(y);if(!Ut&&!ts&&!Xe&&v>y||Xe&&Tt&&In&&!Ut&&!ts||X&&Tt&&In||!L&&In||!Ie)return 1;if(!X&&!Xe&&!ts&&v<y||ts&&L&&Ie&&!X&&!Xe||Ut&&L&&Ie||!Tt&&Ie||!In)return-1}return 0}function yc(v,y,L){for(var X=-1,Ie=v.criteria,Xe=y.criteria,Tt=Ie.length,Ut=L.length;++X<Tt;){var In=bl(Ie[X],Xe[X]);if(In){if(X>=Ut)return In;var ts=L[X];return In*(ts=="desc"?-1:1)}}return v.index-y.index}function la(v,y,L,X){for(var Ie=-1,Xe=v.length,Tt=L.length,Ut=-1,In=y.length,ts=on(Xe-Tt,0),is=pn(In+ts),Cs=!X;++Ut<In;)is[Ut]=y[Ut];for(;++Ie<Tt;)(Cs||Ie<Xe)&&(is[L[Ie]]=v[Ie]);for(;ts--;)is[Ut++]=v[Ie++];return is}function fr(v,y,L,X){for(var Ie=-1,Xe=v.length,Tt=-1,Ut=L.length,In=-1,ts=y.length,is=on(Xe-Ut,0),Cs=pn(is+ts),dr=!X;++Ie<is;)Cs[Ie]=v[Ie];for(var za=Ie;++In<ts;)Cs[za+In]=y[In];for(;++Tt<Ut;)(dr||Ie<Xe)&&(Cs[za+L[Tt]]=v[Ie++]);return Cs}function Ll(v,y){var L=-1,X=v.length;for(y||(y=pn(X));++L<X;)y[L]=v[L];return y}function ao(v,y,L,X){var Ie=!L;L||(L={});for(var Xe=-1,Tt=y.length;++Xe<Tt;){var Ut=y[Xe],In=X?X(L[Ut],v[Ut],Ut,L,v):t;In===t&&(In=v[Ut]),Ie?gc(L,Ut,In):Ji(L,Ut,In)}return L}function ul(v,y){return ao(v,Uv(v),y)}function Ic(v,y){return ao(v,Gv(v),y)}function Ra(v,y){return function(L,X){var Ie=xs(L)?Cc:Dd,Xe=y?y():{};return Ie(L,v,Aa(X,2),Xe)}}function gi(v){return qa(function(y,L){var X=-1,Ie=L.length,Xe=Ie>1?L[Ie-1]:t,Tt=Ie>2?L[2]:t;for(Xe=v.length>3&&typeof Xe=="function"?(Ie--,Xe):t,Tt&&vp(L[0],L[1],Tt)&&(Xe=Ie<3?t:Xe,Ie=1),y=Lc(y);++X<Ie;){var Ut=L[X];Ut&&v(y,Ut,X,Xe)}return y})}function Yc(v,y){return function(L,X){if(L==null)return L;if(!Ir(L))return v(L,X);for(var Ie=L.length,Xe=y?Ie:-1,Tt=Lc(L);(y?Xe--:++Xe<Ie)&&X(Tt[Xe],Xe,Tt)!==!1;);return L}}function xi(v){return function(y,L,X){for(var Ie=-1,Xe=Lc(y),Tt=X(y),Ut=Tt.length;Ut--;){var In=Tt[v?Ut:++Ie];if(L(Xe[In],In,Xe)===!1)break}return y}}function nr(v,y,L){var X=y&P,Ie=ar(v);function Xe(){var Tt=this&&this!==Ki&&this instanceof Xe?Ie:v;return Tt.apply(X?L:this,arguments)}return Xe}function wi(v){return function(y){y=$l(y);var L=ci(y)?Xs(y):t,X=L?L[0]:y.charAt(0),Ie=L?tl(L,1).join(""):y.slice(1);return X[v]()+Ie}}function pl(v){return function(y){return dt(Og(ch(y).replace(wt,"")),v,"")}}function ar(v){return function(){var y=arguments;switch(y.length){case 0:return new v;case 1:return new v(y[0]);case 2:return new v(y[0],y[1]);case 3:return new v(y[0],y[1],y[2]);case 4:return new v(y[0],y[1],y[2],y[3]);case 5:return new v(y[0],y[1],y[2],y[3],y[4]);case 6:return new v(y[0],y[1],y[2],y[3],y[4],y[5]);case 7:return new v(y[0],y[1],y[2],y[3],y[4],y[5],y[6])}var L=ac(v.prototype),X=v.apply(L,y);return Vo(X)?X:L}}function vl(v,y,L){var X=ar(v);function Ie(){for(var Xe=arguments.length,Tt=pn(Xe),Ut=Xe,In=sf(Ie);Ut--;)Tt[Ut]=arguments[Ut];var ts=Xe<3&&Tt[0]!==In&&Tt[Xe-1]!==In?[]:Zi(Tt,In);if(Xe-=ts.length,Xe<L)return Jp(v,y,Fu,Ie.placeholder,t,Tt,ts,t,t,L-Xe);var is=this&&this!==Ki&&this instanceof Ie?X:v;return ea(is,this,Tt)}return Ie}function Qc(v){return function(y,L,X){var Ie=Lc(y);if(!Ir(y)){var Xe=Aa(L,3);y=Au(y),L=function(Ut){return Xe(Ie[Ut],Ut,Ie)}}var Tt=v(y,L,X);return Tt>-1?Ie[Xe?y[Tt]:Tt]:t}}function ou(v){return $u(function(y){var L=y.length,X=L,Ie=Pc.prototype.thru;for(v&&y.reverse();X--;){var Xe=y[X];if(typeof Xe!="function")throw new Wd(a);if(Ie&&!Tt&&of(Xe)=="wrapper")var Tt=new Pc([],!0)}for(X=Tt?X:L;++X<L;){Xe=y[X];var Ut=of(Xe),In=Ut=="wrapper"?nf(Xe):t;In&&Nv(In[0])&&In[1]==(D|M|V|R)&&!In[4].length&&In[9]==1?Tt=Tt[of(In[0])].apply(Tt,In[3]):Tt=Xe.length==1&&Nv(Xe)?Tt[Ut]():Tt.thru(Xe)}return function(){var ts=arguments,is=ts[0];if(Tt&&ts.length==1&&xs(is))return Tt.plant(is).value();for(var Cs=0,dr=L?y[Cs].apply(this,ts):is;++Cs<L;)dr=y[Cs].call(this,dr);return dr}})}function Fu(v,y,L,X,Ie,Xe,Tt,Ut,In,ts){var is=y&D,Cs=y&P,dr=y&I,za=y&(M|F),nc=y&W,ld=dr?t:ar(v);function oc(){for(var Fd=arguments.length,Ud=pn(Fd),xf=Fd;xf--;)Ud[xf]=arguments[xf];if(za)var Zv=sf(oc),wf=ta(Ud,Zv);if(X&&(Ud=la(Ud,X,Ie,za)),Xe&&(Ud=fr(Ud,Xe,Tt,za)),Fd-=wf,za&&Fd<ts){var Mp=Zi(Ud,Zv);return Jp(v,y,Fu,oc.placeholder,L,Ud,Mp,Ut,In,ts-Fd)}var Xf=Cs?L:this,Km=dr?Xf[v]:v;return Fd=Ud.length,Ut?Ud=Bm(Ud,Ut):nc&&Fd>1&&Ud.reverse(),is&&In<Fd&&(Ud.length=In),this&&this!==Ki&&this instanceof oc&&(Km=ld||ar(Km)),Km.apply(Xf,Ud)}return oc}function Ad(v,y){return function(L,X){return na(L,v,y(X),{})}}function Xd(v,y){return function(L,X){var Ie;if(L===t&&X===t)return y;if(L!==t&&(Ie=L),X!==t){if(Ie===t)return X;typeof L=="string"||typeof X=="string"?(L=Cu(L),X=Cu(X)):(L=rv(L),X=rv(X)),Ie=v(L,X)}return Ie}}function Kp(v){return $u(function(y){return y=ge(y,Pn(Aa())),qa(function(L){var X=this;return v(y,function(Ie){return ea(Ie,X,L)})})})}function yp(v,y){y=y===t?" ":Cu(y);var L=y.length;if(L<2)return L?Zd(y,v):y;var X=Zd(y,Wo(v/As(y)));return ci(y)?tl(Xs(X),0,v).join(""):X.slice(0,v)}function $v(v,y,L,X){var Ie=y&P,Xe=ar(v);function Tt(){for(var Ut=-1,In=arguments.length,ts=-1,is=X.length,Cs=pn(is+In),dr=this&&this!==Ki&&this instanceof Tt?Xe:v;++ts<is;)Cs[ts]=X[ts];for(;In--;)Cs[ts++]=arguments[++Ut];return ea(dr,Ie?L:this,Cs)}return Tt}function Zp(v){return function(y,L,X){return X&&typeof X!="number"&&vp(y,L,X)&&(L=X=t),y=wd(y),L===t?(L=y,y=0):L=wd(L),X=X===t?y<L?1:-1:wd(X),Su(y,L,X,v)}}function Xp(v){return function(y,L){return typeof y=="string"&&typeof L=="string"||(y=kd(y),L=kd(L)),v(y,L)}}function Jp(v,y,L,X,Ie,Xe,Tt,Ut,In,ts){var is=y&M,Cs=is?Tt:t,dr=is?t:Tt,za=is?Xe:t,nc=is?t:Xe;y|=is?V:j,y&=~(is?j:V),y&C||(y&=~(P|I));var ld=[v,y,Ie,za,Cs,nc,dr,Ut,In,ts],oc=L.apply(t,ld);return Nv(v)&&hm(oc,ld),oc.placeholder=X,Df(oc,v,y)}function lv(v){var y=Cl[v];return function(L,X){if(L=kd(L),X=X==null?0:rn(va(X),292),X&&An(L)){var Ie=($l(L)+"e").split("e"),Xe=y(Ie[0]+"e"+(+Ie[1]+X));return Ie=($l(Xe)+"e").split("e"),+(Ie[0]+"e"+(+Ie[1]-X))}return y(L)}}var qv=yl&&1/Yt(new yl([,-0]))[1]==re?function(v){return new yl(v)}:D_;function pp(v){return function(y){var L=ap(y);return L==yt?or(y):L==he?Xo(y):mn(y,v(y))}}function Iu(v,y,L,X,Ie,Xe,Tt,Ut){var In=y&I;if(!In&&typeof v!="function")throw new Wd(a);var ts=X?X.length:0;if(ts||(y&=~(V|j),X=Ie=t),Tt=Tt===t?Tt:on(va(Tt),0),Ut=Ut===t?Ut:va(Ut),ts-=Ie?Ie.length:0,y&j){var is=X,Cs=Ie;X=Ie=t}var dr=In?t:nf(v),za=[v,y,L,X,Ie,is,Cs,Xe,Tt,Ut];if(dr&&mm(za,dr),v=za[0],y=za[1],L=za[2],X=za[3],Ie=za[4],Ut=za[9]=za[9]===t?In?0:v.length:on(za[9]-ts,0),!Ut&&y&(M|F)&&(y&=~(M|F)),!y||y==P)var nc=nr(v,y,L);else y==M||y==F?nc=vl(v,y,Ut):(y==V||y==(P|V))&&!Ie.length?nc=$v(v,y,L,X):nc=Fu.apply(t,za);var ld=dr?tf:hm;return Df(ld(nc,za),v,y)}function Qp(v,y,L,X){return v===t||lr(v,Lv[L])&&!ud.call(X,L)?y:v}function Lf(v,y,L,X,Ie,Xe){return Vo(v)&&Vo(y)&&(Xe.set(y,v),Vu(v,y,t,Lf,Xe),Xe.delete(y)),v}function lg(v){return Yl(v)?t:v}function $m(v,y,L,X,Ie,Xe){var Tt=L&w,Ut=v.length,In=y.length;if(Ut!=In&&!(Tt&&In>Ut))return!1;var ts=Xe.get(v),is=Xe.get(y);if(ts&&is)return ts==y&&is==v;var Cs=-1,dr=!0,za=L&S?new mo:t;for(Xe.set(v,y),Xe.set(y,v);++Cs<Ut;){var nc=v[Cs],ld=y[Cs];if(X)var oc=Tt?X(ld,nc,Cs,y,v,Xe):X(nc,ld,Cs,v,y,Xe);if(oc!==t){if(oc)continue;dr=!1;break}if(za){if(!pt(y,function(Fd,Ud){if(!No(za,Ud)&&(nc===Fd||Ie(nc,Fd,L,X,Xe)))return za.push(Ud)})){dr=!1;break}}else if(!(nc===ld||Ie(nc,ld,L,X,Xe))){dr=!1;break}}return Xe.delete(v),Xe.delete(y),dr}function Cp(v,y,L,X,Ie,Xe,Tt){switch(L){case un:if(v.byteLength!=y.byteLength||v.byteOffset!=y.byteOffset)return!1;v=v.buffer,y=y.buffer;case zn:return!(v.byteLength!=y.byteLength||!Xe(new mt(v),new mt(y)));case kt:case ft:case xe:return lr(+v,+y);case nt:return v.name==y.name&&v.message==y.message;case ue:case _t:return v==y+"";case yt:var Ut=or;case he:var In=X&w;if(Ut||(Ut=Yt),v.size!=y.size&&!In)return!1;var ts=Tt.get(v);if(ts)return ts==y;X|=S,Tt.set(v,y);var is=$m(Ut(v),Ut(y),X,Ie,Xe,Tt);return Tt.delete(v),is;case Wt:if(Ql)return Ql.call(v)==Ql.call(y)}return!1}function qf(v,y,L,X,Ie,Xe){var Tt=L&w,Ut=Pp(v),In=Ut.length,ts=Pp(y),is=ts.length;if(In!=is&&!Tt)return!1;for(var Cs=In;Cs--;){var dr=Ut[Cs];if(!(Tt?dr in y:ud.call(y,dr)))return!1}var za=Xe.get(v),nc=Xe.get(y);if(za&&nc)return za==y&&nc==v;var ld=!0;Xe.set(v,y),Xe.set(y,v);for(var oc=Tt;++Cs<In;){dr=Ut[Cs];var Fd=v[dr],Ud=y[dr];if(X)var xf=Tt?X(Ud,Fd,dr,y,v,Xe):X(Fd,Ud,dr,v,y,Xe);if(!(xf===t?Fd===Ud||Ie(Fd,Ud,L,X,Xe):xf)){ld=!1;break}oc||(oc=dr=="constructor")}if(ld&&!oc){var Zv=v.constructor,wf=y.constructor;Zv!=wf&&"constructor"in v&&"constructor"in y&&!(typeof Zv=="function"&&Zv instanceof Zv&&typeof wf=="function"&&wf instanceof wf)&&(ld=!1)}return Xe.delete(v),Xe.delete(y),ld}function $u(v){return Nf(gm(v,t,sa),v+"")}function Pp(v){return _p(v,Au,Uv)}function rp(v){return _p(v,Rd,Gv)}var nf=Ka?function(v){return Ka.get(v)}:D_;function of(v){for(var y=v.name+"",L=ni[y],X=ud.call(ni,y)?L.length:0;X--;){var Ie=L[X],Xe=Ie.func;if(Xe==null||Xe==v)return Ie.name}return y}function sf(v){var y=ud.call(Ee,"placeholder")?Ee:v;return y.placeholder}function Aa(){var v=Ee.iteratee||E_;return v=v===E_?Up:v,arguments.length?v(arguments[0],arguments[1]):v}function Hv(v,y){var L=v.__data__;return wg(y)?L[typeof y=="string"?"string":"hash"]:L.map}function ff(v){for(var y=Au(v),L=y.length;L--;){var X=y[L],Ie=v[X];y[L]=[X,Ie,fm(Ie)]}return y}function Ev(v,y){var L=Ks(v,y);return pd(L)?L:t}function vm(v){var y=ud.call(v,jn),L=v[jn];try{v[jn]=t;var X=!0}catch{}var Ie=qd.call(v);return X&&(y?v[jn]=L:delete v[jn]),Ie}var Uv=Po?function(v){return v==null?[]:(v=Lc(v),Zc(Po(v),function(y){return Rn.call(v,y)}))}:j_,Gv=Po?function(v){for(var y=[];v;)Le(y,Uv(v)),v=en(v);return y}:j_,ap=du;(ti&&ap(new ti(new ArrayBuffer(1)))!=un||Ds&&ap(new Ds)!=yt||bi&&ap(bi.resolve())!=St||yl&&ap(new yl)!=he||uc&&ap(new uc)!=Zt)&&(ap=function(v){var y=du(v),L=y==Je?v.constructor:t,X=L?af(L):"";if(X)switch(X){case Ca:return un;case wa:return yt;case Pa:return St;case Jl:return he;case bd:return Zt}return y});function Hf(v,y,L){for(var X=-1,Ie=L.length;++X<Ie;){var Xe=L[X],Tt=Xe.size;switch(Xe.type){case"drop":v+=Tt;break;case"dropRight":y-=Tt;break;case"take":y=rn(y,v+Tt);break;case"takeRight":v=on(v,y-Tt);break}}return{start:v,end:y}}function Em(v){var y=v.match(gl);return y?y[1].split(_d):[]}function mf(v,y,L){y=Nr(y,v);for(var X=-1,Ie=y.length,Xe=!1;++X<Ie;){var Tt=Dp(y[X]);if(!(Xe=v!=null&&L(v,Tt)))break;v=v[Tt]}return Xe||++X!=Ie?Xe:(Ie=v==null?0:v.length,!!Ie&&ri(Ie)&&kv(Tt,Ie)&&(xs(v)||Fa(v)))}function Uf(v){var y=v.length,L=new v.constructor(y);return y&&typeof v[0]=="string"&&ud.call(v,"index")&&(L.index=v.index,L.input=v.input),L}function Ff(v){return typeof v.constructor=="function"&&!gf(v)?ac(en(v)):{}}function cg(v,y,L){var X=v.constructor;switch(y){case zn:return ql(v);case kt:case ft:return new X(+v);case un:return Hl(v,L);case On:case no:case fs:case ps:case So:case Es:case Qo:case Ko:case oo:return ka(v,L);case yt:return new X;case xe:case _t:return new X(v);case ue:return ja(v);case he:return new X;case Wt:return Wr(v)}}function xg(v,y){var L=y.length;if(!L)return v;var X=L-1;return y[X]=(L>1?"& ":"")+y[X],y=y.join(L>2?", ":" "),v.replace(ml,`{
/* [wrapped with `+y+`] */
`)}function Nm(v){return xs(v)||Fa(v)||!!(Dn&&v&&v[Dn])}function kv(v,y){var L=typeof v;return y=y??me,!!y&&(L=="number"||L!="symbol"&&id.test(v))&&v>-1&&v%1==0&&v<y}function vp(v,y,L){if(!Vo(L))return!1;var X=typeof y;return(X=="number"?Ir(L)&&kv(y,L.length):X=="string"&&y in L)?lr(L[y],v):!1}function cv(v,y){if(xs(v))return!1;var L=typeof v;return L=="number"||L=="symbol"||L=="boolean"||v==null||xc(v)?!0:Sd.test(v)||!cd.test(v)||y!=null&&v in Lc(y)}function wg(v){var y=typeof v;return y=="string"||y=="number"||y=="symbol"||y=="boolean"?v!=="__proto__":v===null}function Nv(v){var y=of(v),L=Ee[y];if(typeof L!="function"||!(y in Xi.prototype))return!1;if(v===L)return!0;var X=nf(L);return!!X&&v===X[0]}function Dm(v){return!!Bc&&Bc in v}var jm=zv?Mr:R_;function gf(v){var y=v&&v.constructor,L=typeof y=="function"&&y.prototype||Lv;return v===L}function fm(v){return v===v&&!Vo(v)}function $f(v,y){return function(L){return L==null?!1:L[v]===y&&(y!==t||v in Lc(L))}}function Rm(v){var y=Fr(v,function(X){return L.size===d&&L.clear(),X}),L=y.cache;return y}function mm(v,y){var L=v[1],X=y[1],Ie=L|X,Xe=Ie<(P|I|D),Tt=X==D&&L==M||X==D&&L==R&&v[7].length<=y[8]||X==(D|R)&&y[7].length<=y[8]&&L==M;if(!(Xe||Tt))return v;X&P&&(v[2]=y[2],Ie|=L&P?0:C);var Ut=y[3];if(Ut){var In=v[3];v[3]=In?la(In,Ut,y[4]):Ut,v[4]=In?Zi(v[3],p):y[4]}return Ut=y[5],Ut&&(In=v[5],v[5]=In?fr(In,Ut,y[6]):Ut,v[6]=In?Zi(v[5],p):y[6]),Ut=y[7],Ut&&(v[7]=Ut),X&D&&(v[8]=v[8]==null?y[8]:rn(v[8],y[8])),v[9]==null&&(v[9]=y[9]),v[0]=y[0],v[1]=Ie,v}function dg(v){var y=[];if(v!=null)for(var L in Lc(v))y.push(L);return y}function Gf(v){return qd.call(v)}function gm(v,y,L){return y=on(y===t?v.length-1:y,0),function(){for(var X=arguments,Ie=-1,Xe=on(X.length-y,0),Tt=pn(Xe);++Ie<Xe;)Tt[Ie]=X[y+Ie];Ie=-1;for(var Ut=pn(y+1);++Ie<y;)Ut[Ie]=X[Ie];return Ut[y]=L(Tt),ea(v,this,Ut)}}function Yf(v,y){return y.length<2?v:Ou(v,_u(y,0,-1))}function Bm(v,y){for(var L=v.length,X=rn(y.length,L),Ie=Ll(v);X--;){var Xe=y[X];v[X]=kv(Xe,L)?Ie[Xe]:t}return v}function Ef(v,y){if(!(y==="constructor"&&typeof v[y]=="function")&&y!="__proto__")return v[y]}var hm=Om(tf),hf=ms||function(v,y){return Ki.setTimeout(v,y)},Nf=Om(sv);function Df(v,y,L){var X=y+"";return Nf(v,xg(X,_m(Em(X),L)))}function Om(v){var y=0,L=0;return function(){var X=fo(),Ie=se-(X-L);if(L=X,Ie>0){if(++y>=G)return arguments[0]}else y=0;return v.apply(t,arguments)}}function rf(v,y){var L=-1,X=v.length,Ie=X-1;for(y=y===t?X:y;++L<y;){var Xe=dl(L,Ie),Tt=v[Xe];v[Xe]=v[L],v[L]=Tt}return v.length=y,v}var zm=Rm(function(v){var y=[];return v.charCodeAt(0)===46&&y.push(""),v.replace(Nl,function(L,X,Ie,Xe){y.push(Ie?Xe.replace(od,"$1"):X||L)}),y});function Dp(v){if(typeof v=="string"||xc(v))return v;var y=v+"";return y=="0"&&1/v==-re?"-0":y}function af(v){if(v!=null){try{return Vv.call(v)}catch{}try{return v+""}catch{}}return""}function _m(v,y){return Ac(Ge,function(L){var X="_."+L[0];y&L[1]&&!ce(v,X)&&v.push(X)}),v.sort()}function Kf(v){if(v instanceof Xi)return v.clone();var y=new Pc(v.__wrapped__,v.__chain__);return y.__actions__=Ll(v.__actions__),y.__index__=v.__index__,y.__values__=v.__values__,y}function Vm(v,y,L){(L?vp(v,y,L):y===t)?y=1:y=on(va(y),0);var X=v==null?0:v.length;if(!X||y<1)return[];for(var Ie=0,Xe=0,Tt=pn(Wo(X/y));Ie<X;)Tt[Xe++]=_u(v,Ie,Ie+=y);return Tt}function ym(v){for(var y=-1,L=v==null?0:v.length,X=0,Ie=[];++y<L;){var Xe=v[y];Xe&&(Ie[X++]=Xe)}return Ie}function Wm(){var v=arguments.length;if(!v)return[];for(var y=pn(v-1),L=arguments[0],X=v;X--;)y[X-1]=arguments[X];return Le(xs(L)?Ll(L):[L],tu(y,1))}var qm=qa(function(v,y){return Ci(v)?gu(v,tu(y,1,Ci,!0)):[]}),Hm=qa(function(v,y){var L=et(y);return Ci(L)&&(L=t),Ci(v)?gu(v,tu(y,1,Ci,!0),Aa(L,2)):[]}),Ti=qa(function(v,y){var L=et(y);return Ci(L)&&(L=t),Ci(v)?gu(v,tu(y,1,Ci,!0),t,L):[]});function zo(v,y,L){var X=v==null?0:v.length;return X?(y=L||y===t?1:va(y),_u(v,y<0?0:y,X)):[]}function ca(v,y,L){var X=v==null?0:v.length;return X?(y=L||y===t?1:va(y),y=X-y,_u(v,0,y<0?0:y)):[]}function oa(v,y){return v&&v.length?We(v,Aa(y,3),!0,!0):[]}function _s(v,y){return v&&v.length?We(v,Aa(y,3),!0):[]}function Gi(v,y,L,X){var Ie=v==null?0:v.length;return Ie?(L&&typeof L!="number"&&vp(v,y,L)&&(L=0,X=Ie),hp(v,y,L,X)):[]}function Fl(v,y,L){var X=v==null?0:v.length;if(!X)return-1;var Ie=L==null?0:va(L);return Ie<0&&(Ie=on(X+Ie,0)),ro(v,Aa(y,3),Ie)}function Ta(v,y,L){var X=v==null?0:v.length;if(!X)return-1;var Ie=X-1;return L!==t&&(Ie=va(L),Ie=L<0?on(X+Ie,0):rn(Ie,X-1)),ro(v,Aa(y,3),Ie,!0)}function sa(v){var y=v==null?0:v.length;return y?tu(v,1):[]}function ec(v){var y=v==null?0:v.length;return y?tu(v,re):[]}function Dr(v,y){var L=v==null?0:v.length;return L?(y=y===t?1:va(y),tu(v,y)):[]}function Ul(v){for(var y=-1,L=v==null?0:v.length,X={};++y<L;){var Ie=v[y];X[Ie[0]]=Ie[1]}return X}function Wc(v){return v&&v.length?v[0]:t}function uu(v,y,L){var X=v==null?0:v.length;if(!X)return-1;var Ie=L==null?0:va(L);return Ie<0&&(Ie=on(X+Ie,0)),uo(v,y,Ie)}function Yu(v){var y=v==null?0:v.length;return y?_u(v,0,-1):[]}var pu=qa(function(v){var y=ge(v,bs);return y.length&&y[0]===v[0]?er(y):[]}),Yv=qa(function(v){var y=et(v),L=ge(v,bs);return y===et(L)?y=t:L.pop(),L.length&&L[0]===v[0]?er(L,Aa(y,2)):[]}),Ip=qa(function(v){var y=et(v),L=ge(v,bs);return y=typeof y=="function"?y:t,y&&L.pop(),L.length&&L[0]===v[0]?er(L,t,y):[]});function lf(v,y){return v==null?"":Ro.call(v,y)}function et(v){var y=v==null?0:v.length;return y?v[y-1]:t}function Ae(v,y,L){var X=v==null?0:v.length;if(!X)return-1;var Ie=X;return L!==t&&(Ie=va(L),Ie=Ie<0?on(X+Ie,0):rn(Ie,X-1)),y===y?Pi(v,y,Ie):ro(v,Ei,Ie,!0)}function gt(v,y){return v&&v.length?vr(v,va(y)):t}var He=qa(ht);function ht(v,y){return v&&v.length&&y&&y.length?su(v,y):v}function It(v,y,L){return v&&v.length&&y&&y.length?su(v,y,Aa(L,2)):v}function Ot(v,y,L){return v&&v.length&&y&&y.length?su(v,y,t,L):v}var lo=$u(function(v,y){var L=v==null?0:v.length,X=Qi(v,y);return Vc(v,ge(y,function(Ie){return kv(Ie,L)?+Ie:Ie}).sort(bl)),X});function sn(v,y){var L=[];if(!(v&&v.length))return L;var X=-1,Ie=[],Xe=v.length;for(y=Aa(y,3);++X<Xe;){var Tt=v[X];y(Tt,X,v)&&(L.push(Tt),Ie.push(X))}return Vc(v,Ie),L}function Ao(v){return v==null?v:Gn.call(v)}function Cn(v,y,L){var X=v==null?0:v.length;return X?(L&&typeof L!="number"&&vp(v,y,L)?(y=0,L=X):(y=y==null?0:va(y),L=L===t?X:va(L)),_u(v,y,L)):[]}function Jn(v,y){return ip(v,y)}function nn(v,y,L){return Np(v,y,Aa(L,2))}function us(v,y){var L=v==null?0:v.length;if(L){var X=ip(v,y);if(X<L&&lr(v[X],y))return X}return-1}function Tn(v,y){return ip(v,y,!0)}function ui(v,y,L){return Np(v,y,Aa(L,2),!0)}function Hs(v,y){var L=v==null?0:v.length;if(L){var X=ip(v,y,!0)-1;if(lr(v[X],y))return X}return-1}function da(v){return v&&v.length?iv(v):[]}function Yi(v,y){return v&&v.length?iv(v,Aa(y,2)):[]}function Bi(v){var y=v==null?0:v.length;return y?_u(v,1,y):[]}function bo(v,y,L){return v&&v.length?(y=L||y===t?1:va(y),_u(v,0,y<0?0:y)):[]}function cs(v,y,L){var X=v==null?0:v.length;return X?(y=L||y===t?1:va(y),y=X-y,_u(v,y<0?0:y,X)):[]}function b(v,y){return v&&v.length?We(v,Aa(y,3),!1,!0):[]}function k(v,y){return v&&v.length?We(v,Aa(y,3)):[]}var T=qa(function(v){return Pu(tu(v,1,Ci,!0))}),A=qa(function(v){var y=et(v);return Ci(y)&&(y=t),Pu(tu(v,1,Ci,!0),Aa(y,2))}),$=qa(function(v){var y=et(v);return y=typeof y=="function"?y:t,Pu(tu(v,1,Ci,!0),t,y)});function E(v){return v&&v.length?Pu(v):[]}function Q(v,y){return v&&v.length?Pu(v,Aa(y,2)):[]}function ie(v,y){return y=typeof y=="function"?y:t,v&&v.length?Pu(v,t,y):[]}function Pe(v){if(!(v&&v.length))return[];var y=0;return v=Zc(v,function(L){if(Ci(L))return y=on(L.length,y),!0}),Vt(y,function(L){return ge(v,Ys(L))})}function rt(v,y){if(!(v&&v.length))return[];var L=Pe(v);return y==null?L:ge(L,function(X){return ea(y,t,X)})}var gn=qa(function(v,y){return Ci(v)?gu(v,y):[]}),cn=qa(function(v){return ls(Zc(v,Ci))}),Gt=qa(function(v){var y=et(v);return Ci(y)&&(y=t),ls(Zc(v,Ci),Aa(y,2))}),eo=qa(function(v){var y=et(v);return y=typeof y=="function"?y:t,ls(Zc(v,Ci),t,y)}),Ss=qa(Pe);function La(v,y){return Si(v||[],y||[],Ji)}function Rl(v,y){return Si(v||[],y||[],Wu)}var pc=qa(function(v){var y=v.length,L=y>1?v[y-1]:t;return L=typeof L=="function"?(v.pop(),L):t,rt(v,L)});function nl(v){var y=Ee(v);return y.__chain__=!0,y}function vc(v,y){return y(v),v}function qc(v,y){return y(v)}var Td=$u(function(v){var y=v.length,L=y?v[0]:0,X=this.__wrapped__,Ie=function(Xe){return Qi(Xe,v)};return y>1||this.__actions__.length||!(X instanceof Xi)||!kv(L)?this.thru(Ie):(X=X.slice(L,+L+(y?1:0)),X.__actions__.push({func:qc,args:[Ie],thisArg:t}),new Pc(X,this.__chain__).thru(function(Xe){return y&&!Xe.length&&Xe.push(t),Xe}))});function xd(){return nl(this)}function jd(){return new Pc(this.value(),this.__chain__)}function vd(){this.__values__===t&&(this.__values__=Nu(this.value()));var v=this.__index__>=this.__values__.length,y=v?t:this.__values__[this.__index__++];return{done:v,value:y}}function Hd(){return this}function Tr(v){for(var y,L=this;L instanceof Ia;){var X=Kf(L);X.__index__=0,X.__values__=t,y?Ie.__wrapped__=X:y=X;var Ie=X;L=L.__wrapped__}return Ie.__wrapped__=v,y}function xl(){var v=this.__wrapped__;if(v instanceof Xi){var y=v;return this.__actions__.length&&(y=new Xi(this)),y=y.reverse(),y.__actions__.push({func:qc,args:[Ao],thisArg:t}),new Pc(y,this.__chain__)}return this.thru(Ao)}function Za(){return Uo(this.__wrapped__,this.__actions__)}var jr=Ra(function(v,y,L){ud.call(v,L)?++v[L]:gc(v,L,1)});function ol(v,y,L){var X=xs(v)?Id:gp;return L&&vp(v,y,L)&&(y=t),X(v,Aa(y,3))}function Lr(v,y){var L=xs(v)?Zc:hv;return L(v,Aa(y,3))}var ii=Qc(Fl),Di=Qc(Ta);function Ha(v,y){return tu(bc(v,y),1)}function Ns(v,y){return tu(bc(v,y),re)}function Cr(v,y,L){return L=L===t?1:va(L),tu(bc(v,y),L)}function Xa(v,y){var L=xs(v)?Ac:ku;return L(v,Aa(y,3))}function Ur(v,y){var L=xs(v)?cu:Md;return L(v,Aa(y,3))}var Ja=Ra(function(v,y,L){ud.call(v,L)?v[L].push(y):gc(v,L,[y])});function Gl(v,y,L,X){v=Ir(v)?v:wm(v),L=L&&!X?va(L):0;var Ie=v.length;return L<0&&(L=on(Ie+L,0)),Mc(v)?L<=Ie&&v.indexOf(y,L)>-1:!!Ie&&uo(v,y,L)>-1}var Gr=qa(function(v,y,L){var X=-1,Ie=typeof y=="function",Xe=Ir(v)?pn(v.length):[];return ku(v,function(Tt){Xe[++X]=Ie?ea(y,Tt,L):cl(Tt,y,L)}),Xe}),Il=Ra(function(v,y,L){gc(v,L,y)});function bc(v,y){var L=xs(v)?ge:Uu;return L(v,Aa(y,3))}function Zr(v,y,L,X){return v==null?[]:(xs(y)||(y=y==null?[]:[y]),L=X?t:L,xs(L)||(L=L==null?[]:[L]),Sr(v,y,L))}var Ua=Ra(function(v,y,L){v[L?0:1].push(y)},function(){return[[],[]]});function Rr(v,y,L){var X=xs(v)?dt:qe,Ie=arguments.length<3;return X(v,Aa(y,4),L,Ie,ku)}function Xr(v,y,L){var X=xs(v)?At:qe,Ie=arguments.length<3;return X(v,Aa(y,4),L,Ie,Md)}function lt(v,y){var L=xs(v)?Zc:hv;return L(v,Ni(Aa(y,3)))}function O(v){var y=xs(v)?yn:Gp;return y(v)}function pe(v,y,L){(L?vp(v,y,L):y===t)?y=1:y=va(y);var X=xs(v)?wo:xv;return X(v,y)}function ke(v){var y=xs(v)?si:Yp;return y(v)}function Mt(v){if(v==null)return 0;if(Ir(v))return Mc(v)?As(v):v.length;var y=ap(v);return y==yt||y==he?v.size:Qu(v).length}function Rt(v,y,L){var X=xs(v)?pt:wv;return L&&vp(v,y,L)&&(y=t),X(v,Aa(y,3))}var xn=qa(function(v,y){if(v==null)return[];var L=y.length;return L>1&&vp(v,y[0],y[1])?y=[]:L>2&&vp(y[0],y[1],y[2])&&(y=[y[0]]),Sr(v,tu(y,1),[])}),Jt=$n||function(){return Ki.Date.now()};function Qn(v,y){if(typeof y!="function")throw new Wd(a);return v=va(v),function(){if(--v<1)return y.apply(this,arguments)}}function io(v,y,L){return y=L?t:y,y=v&&y==null?v.length:y,Iu(v,D,t,t,t,t,y)}function to(v,y){var L;if(typeof y!="function")throw new Wd(a);return v=va(v),function(){return--v>0&&(L=y.apply(this,arguments)),v<=1&&(y=t),L}}var ho=qa(function(v,y,L){var X=P;if(L.length){var Ie=Zi(L,sf(ho));X|=V}return Iu(v,X,y,L,Ie)}),Li=qa(function(v,y,L){var X=P|I;if(L.length){var Ie=Zi(L,sf(Li));X|=V}return Iu(y,X,v,L,Ie)});function Ms(v,y,L){y=L?t:y;var X=Iu(v,M,t,t,t,t,t,y);return X.placeholder=Ms.placeholder,X}function Zo(v,y,L){y=L?t:y;var X=Iu(v,F,t,t,t,t,t,y);return X.placeholder=Zo.placeholder,X}function ko(v,y,L){var X,Ie,Xe,Tt,Ut,In,ts=0,is=!1,Cs=!1,dr=!0;if(typeof v!="function")throw new Wd(a);y=kd(y)||0,Vo(L)&&(is=!!L.leading,Cs="maxWait"in L,Xe=Cs?on(kd(L.maxWait)||0,y):Xe,dr="trailing"in L?!!L.trailing:dr);function za(Mp){var Xf=X,Km=Ie;return X=Ie=t,ts=Mp,Tt=v.apply(Km,Xf),Tt}function nc(Mp){return ts=Mp,Ut=hf(Fd,y),is?za(Mp):Tt}function ld(Mp){var Xf=Mp-In,Km=Mp-ts,xy=y-Xf;return Cs?rn(xy,Xe-Km):xy}function oc(Mp){var Xf=Mp-In,Km=Mp-ts;return In===t||Xf>=y||Xf<0||Cs&&Km>=Xe}function Fd(){var Mp=Jt();if(oc(Mp))return Ud(Mp);Ut=hf(Fd,ld(Mp))}function Ud(Mp){return Ut=t,dr&&X?za(Mp):(X=Ie=t,Tt)}function xf(){Ut!==t&&_c(Ut),ts=0,X=In=Ie=Ut=t}function Zv(){return Ut===t?Tt:Ud(Jt())}function wf(){var Mp=Jt(),Xf=oc(Mp);if(X=arguments,Ie=this,In=Mp,Xf){if(Ut===t)return nc(In);if(Cs)return _c(Ut),Ut=hf(Fd,y),za(In)}return Ut===t&&(Ut=hf(Fd,y)),Tt}return wf.cancel=xf,wf.flush=Zv,wf}var ki=qa(function(v,y){return zc(v,1,y)}),Rs=qa(function(v,y,L){return zc(v,kd(y)||0,L)});function pi(v){return Iu(v,W)}function Fr(v,y){if(typeof v!="function"||y!=null&&typeof y!="function")throw new Wd(a);var L=function(){var X=arguments,Ie=y?y.apply(this,X):X[0],Xe=L.cache;if(Xe.has(Ie))return Xe.get(Ie);var Tt=v.apply(this,X);return L.cache=Xe.set(Ie,Tt)||Xe,Tt};return L.cache=new(Fr.Cache||Ts),L}Fr.Cache=Ts;function Ni(v){if(typeof v!="function")throw new Wd(a);return function(){var y=arguments;switch(y.length){case 0:return!v.call(this);case 1:return!v.call(this,y[0]);case 2:return!v.call(this,y[0],y[1]);case 3:return!v.call(this,y[0],y[1],y[2])}return!v.apply(this,y)}}function Sa(v){return to(2,v)}var $a=Xn(function(v,y){y=y.length==1&&xs(y[0])?ge(y[0],Pn(Aa())):ge(tu(y,1),Pn(Aa()));var L=y.length;return qa(function(X){for(var Ie=-1,Xe=rn(X.length,L);++Ie<Xe;)X[Ie]=y[Ie].call(this,X[Ie]);return ea(v,this,X)})}),Js=qa(function(v,y){var L=Zi(y,sf(Js));return Iu(v,V,t,y,L)}),qi=qa(function(v,y){var L=Zi(y,sf(qi));return Iu(v,j,t,y,L)}),_r=$u(function(v,y){return Iu(v,R,t,t,t,y)});function Pr(v,y){if(typeof v!="function")throw new Wd(a);return y=y===t?y:va(y),qa(v,y)}function Br(v,y){if(typeof v!="function")throw new Wd(a);return y=y==null?0:on(va(y),0),qa(function(L){var X=L[y],Ie=tl(L,0,y);return X&&Le(Ie,X),ea(v,this,Ie)})}function ma(v,y,L){var X=!0,Ie=!0;if(typeof v!="function")throw new Wd(a);return Vo(L)&&(X="leading"in L?!!L.leading:X,Ie="trailing"in L?!!L.trailing:Ie),ko(v,y,{leading:X,maxWait:y,trailing:Ie})}function Hi(v){return io(v,1)}function yr(v,y){return Js(Go(y),v)}function Qa(){if(!arguments.length)return[];var v=arguments[0];return xs(v)?v:[v]}function Yr(v){return Gc(v,_)}function Kr(v,y){return y=typeof y=="function"?y:t,Gc(v,_,y)}function Ii(v){return Gc(v,m|_)}function Bs(v,y){return y=typeof y=="function"?y:t,Gc(v,m|_,y)}function Or(v,y){return y==null||Fc(v,y,Au(y))}function lr(v,y){return v===y||v!==v&&y!==y}var Ui=Xp(ve),Mi=Xp(function(v,y){return v>=y}),Fa=zu(function(){return arguments}())?zu:function(v){return vi(v)&&ud.call(v,"callee")&&!Rn.call(v,"callee")},xs=pn.isArray,Ba=zr?Pn(zr):sp;function Ir(v){return v!=null&&ri(v.length)&&!Mr(v)}function Ci(v){return vi(v)&&Ir(v)}function sl(v){return v===!0||v===!1||vi(v)&&du(v)==kt}var zs=Is||R_,yi=rd?Pn(rd):Hu;function Jr(v){return vi(v)&&v.nodeType===1&&!Yl(v)}function ga(v){if(v==null)return!0;if(Ir(v)&&(xs(v)||typeof v=="string"||typeof v.splice=="function"||zs(v)||Oa(v)||Fa(v)))return!v.length;var y=ap(v);if(y==yt||y==he)return!v.size;if(gf(v))return!Qu(v).length;for(var L in v)if(ud.call(v,L))return!1;return!0}function cr(v,y){return hu(v,y)}function ua(v,y,L){L=typeof L=="function"?L:t;var X=L?L(v,y):t;return X===t?hu(v,y,t,L):!!X}function il(v){if(!vi(v))return!1;var y=du(v);return y==nt||y==bt||typeof v.message=="string"&&typeof v.name=="string"&&!Yl(v)}function br(v){return typeof v=="number"&&An(v)}function Mr(v){if(!Vo(v))return!1;var y=du(v);return y==Pt||y==Qe||y==ct||y==Ne}function ia(v){return typeof v=="number"&&v==va(v)}function ri(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=me}function Vo(v){var y=typeof v;return v!=null&&(y=="object"||y=="function")}function vi(v){return v!=null&&typeof v=="object"}var ha=cc?Pn(cc):dp;function Zs(v,y){return v===y||Pl(v,y,ff(y))}function pa(v,y,L){return L=typeof L=="function"?L:t,Pl(v,y,ff(y),L)}function Oi(v){return Ml(v)&&v!=+v}function Ea(v){if(jm(v))throw new Ps(r);return pd(v)}function fc(v){return v===null}function wl(v){return v==null}function Ml(v){return typeof v=="number"||vi(v)&&du(v)==xe}function Yl(v){if(!vi(v)||du(v)!=Je)return!1;var y=en(v);if(y===null)return!0;var L=ud.call(y,"constructor")&&y.constructor;return typeof L=="function"&&L instanceof L&&Vv.call(L)==Oc}var Hc=dc?Pn(dc):pr;function $c(v){return ia(v)&&v>=-me&&v<=me}var jc=Er?Pn(Er):Wa;function Mc(v){return typeof v=="string"||!xs(v)&&vi(v)&&du(v)==_t}function xc(v){return typeof v=="symbol"||vi(v)&&du(v)==Wt}var Oa=Sc?Pn(Sc):rr;function ad(v){return v===t}function iu(v){return vi(v)&&ap(v)==Zt}function Mu(v){return vi(v)&&du(v)==dn}var Uc=Xp(hc),Eu=Xp(function(v,y){return v<=y});function Nu(v){if(!v)return[];if(Ir(v))return Mc(v)?Xs(v):Ll(v);if(ys&&v[ys])return ln(v[ys]());var y=ap(v),L=y==yt?or:y==he?Yt:wm;return L(v)}function wd(v){if(!v)return v===0?v:0;if(v=kd(v),v===re||v===-re){var y=v<0?-1:1;return y*K}return v===v?v:0}function va(v){var y=wd(v),L=y%1;return y===y?L?y-L:y:0}function Ku(v){return v?Kd(va(v),0,Me):0}function kd(v){if(typeof v=="number")return v;if(xc(v))return ye;if(Vo(v)){var y=typeof v.valueOf=="function"?v.valueOf():v;v=Vo(y)?y+"":y}if(typeof v!="string")return v===0?v:+v;v=Kn(v);var L=kc.test(v);return L||sd.test(v)?lc(v.slice(2),L?2:8):al.test(v)?ye:+v}function ep(v){return ao(v,Rd(v))}function Du(v){return v?Kd(va(v),-me,me):v===0?v:0}function $l(v){return v==null?"":Cu(v)}var tp=gi(function(v,y){if(gf(y)||Ir(y)){ao(y,Au(y),v);return}for(var L in y)ud.call(y,L)&&Ji(v,L,y[L])}),yu=gi(function(v,y){ao(y,Rd(y),v)}),vu=gi(function(v,y,L,X){ao(y,Rd(y),v,X)}),Ld=gi(function(v,y,L,X){ao(y,Au(y),v,X)}),ru=$u(Qi);function np(v,y){var L=ac(v);return y==null?L:Ma(L,y)}var _a=qa(function(v,y){v=Lc(v);var L=-1,X=y.length,Ie=X>2?y[2]:t;for(Ie&&vp(y[0],y[1],Ie)&&(X=1);++L<X;)for(var Xe=y[L],Tt=Rd(Xe),Ut=-1,In=Tt.length;++Ut<In;){var ts=Tt[Ut],is=v[ts];(is===t||lr(is,Lv[ts])&&!ud.call(v,ts))&&(v[ts]=Xe[ts])}return v}),ed=qa(function(v){return v.push(t,Lf),ea(td,t,v)});function jp(v,y){return kn(v,Aa(y,3),Bu)}function Rp(v,y){return kn(v,Aa(y,3),bv)}function dv(v,y){return v==null?v:_v(v,Aa(y,3),Rd)}function fp(v,y){return v==null?v:yv(v,Aa(y,3),Rd)}function Sv(v,y){return v&&Bu(v,Aa(y,3))}function tc(v,y){return v&&bv(v,Aa(y,3))}function ju(v){return v==null?[]:Hp(v,Au(v))}function bm(v){return v==null?[]:Hp(v,Rd(v))}function Cv(v,y,L){var X=v==null?t:Ou(v,y);return X===t?L:X}function _f(v,y){return v!=null&&mf(v,y,Bt)}function jf(v,y){return v!=null&&mf(v,y,Wi)}var yf=Ad(function(v,y,L){y!=null&&typeof y.toString!="function"&&(y=qd.call(y)),v[y]=L},Cg(cf)),bf=Ad(function(v,y,L){y!=null&&typeof y.toString!="function"&&(y=qd.call(y)),ud.call(v,y)?v[y].push(L):v[y]=[L]},Aa),xm=qa(cl);function Au(v){return Ir(v)?ds(v):Qu(v)}function Rd(v){return Ir(v)?ds(v,!0):nu(v)}function Kv(v,y){var L={};return y=Aa(y,3),Bu(v,function(X,Ie,Xe){gc(L,y(X,Ie,Xe),X)}),L}function Um(v,y){var L={};return y=Aa(y,3),Bu(v,function(X,Ie,Xe){gc(L,Ie,y(X,Ie,Xe))}),L}var Bd=gi(function(v,y,L){Vu(v,y,L)}),td=gi(function(v,y,L,X){Vu(v,y,L,X)}),kg=$u(function(v,y){var L={};if(v==null)return L;var X=!1;y=ge(y,function(Xe){return Xe=Nr(Xe,v),X||(X=Xe.length>1),Xe}),ao(v,rp(v),L),X&&(L=Gc(L,m|h|_,lg));for(var Ie=y.length;Ie--;)av(L,y[Ie]);return L});function ug(v,y){return Gm(v,Ni(Aa(y)))}var Rf=$u(function(v,y){return v==null?{}:ji(v,y)});function Gm(v,y){if(v==null)return{};var L=ge(rp(v),function(X){return[X]});return y=Aa(y),Jc(v,L,function(X,Ie){return y(X,Ie[0])})}function Ym(v,y,L){y=Nr(y,v);var X=-1,Ie=y.length;for(Ie||(Ie=1,v=t);++X<Ie;){var Xe=v==null?t:v[Dp(y[X])];Xe===t&&(X=Ie,Xe=L),v=Mr(Xe)?Xe.call(v):Xe}return v}function mp(v,y,L){return v==null?v:Wu(v,y,L)}function l0(v,y,L,X){return X=typeof X=="function"?X:t,v==null?v:Wu(v,y,L,X)}var Dg=pp(Au),jg=pp(Rd);function ih(v,y,L){var X=xs(v),Ie=X||zs(v)||Oa(v);if(y=Aa(y,4),L==null){var Xe=v&&v.constructor;Ie?L=X?new Xe:[]:Vo(v)?L=Mr(Xe)?ac(en(v)):{}:L={}}return(Ie?Ac:Bu)(v,function(Tt,Ut,In){return y(L,Tt,Ut,In)}),L}function c0(v,y){return v==null?!0:av(v,y)}function rh(v,y,L){return v==null?v:Fv(v,y,Go(L))}function ah(v,y,L,X){return X=typeof X=="function"?X:t,v==null?v:Fv(v,y,Go(L),X)}function wm(v){return v==null?[]:Hn(v,Au(v))}function d0(v){return v==null?[]:Hn(v,Rd(v))}function u0(v,y,L){return L===t&&(L=y,y=t),L!==t&&(L=kd(L),L=L===L?L:0),y!==t&&(y=kd(y),y=y===y?y:0),Kd(kd(v),y,L)}function lh(v,y,L){return y=wd(y),L===t?(L=y,y=0):L=wd(L),v=kd(v),js(v,y,L)}function A_(v,y,L){if(L&&typeof L!="boolean"&&vp(v,y,L)&&(y=L=t),L===t&&(typeof y=="boolean"?(L=y,y=t):typeof v=="boolean"&&(L=v,v=t)),v===t&&y===t?(v=0,y=1):(v=wd(v),y===t?(y=v,v=0):y=wd(y)),v>y){var X=v;v=y,y=X}if(L||v%1||y%1){var Ie=Io();return rn(v+Ie*(y-v+hl("1e-"+((Ie+"").length-1))),y)}return dl(v,y)}var p0=pl(function(v,y,L){return y=y.toLowerCase(),v+(L?Rg(y):y)});function Rg(v){return Sg($l(v).toLowerCase())}function ch(v){return v=$l(v),v&&v.replace(Pd,Nc).replace(Lt,"")}function T_(v,y,L){v=$l(v),y=Cu(y);var X=v.length;L=L===t?X:Kd(va(L),0,X);var Ie=L;return L-=y.length,L>=0&&v.slice(L,Ie)==y}function dh(v){return v=$l(v),v&&Qs.test(v)?v.replace(xa,Tc):v}function uh(v){return v=$l(v),v&&Cd.test(v)?v.replace(dd,"\\$&"):v}var v0=pl(function(v,y,L){return v+(L?"-":"")+y.toLowerCase()}),ph=pl(function(v,y,L){return v+(L?" ":"")+y.toLowerCase()}),f0=wi("toLowerCase");function m0(v,y,L){v=$l(v),y=va(y);var X=y?As(v):0;if(!y||X>=y)return v;var Ie=(y-X)/2;return yp(Yo(Ie),L)+v+yp(Wo(Ie),L)}function vh(v,y,L){v=$l(v),y=va(y);var X=y?As(v):0;return y&&X<y?v+yp(y-X,L):v}function L_(v,y,L){v=$l(v),y=va(y);var X=y?As(v):0;return y&&X<y?yp(y-X,L)+v:v}function fh(v,y,L){return L||y==null?y=0:y&&(y=+y),Bn($l(v).replace(fa,""),y||0)}function g0(v,y,L){return(L?vp(v,y,L):y===t)?y=1:y=va(y),Zd($l(v),y)}function h0(){var v=arguments,y=$l(v[0]);return v.length<3?y:y.replace(v[1],v[2])}var mh=pl(function(v,y,L){return v+(L?"_":"")+y.toLowerCase()});function F_(v,y,L){return L&&typeof L!="number"&&vp(v,y,L)&&(y=L=t),L=L===t?Me:L>>>0,L?(v=$l(v),v&&(typeof y=="string"||y!=null&&!Hc(y))&&(y=Cu(y),!y&&ci(v))?tl(Xs(v),0,L):v.split(y,L)):[]}var _0=pl(function(v,y,L){return v+(L?" ":"")+Sg(y)});function y0(v,y,L){return v=$l(v),L=L==null?0:Kd(va(L),0,v.length),y=Cu(y),v.slice(L,L+y.length)==y}function b0(v,y,L){var X=Ee.templateSettings;L&&vp(v,y,L)&&(y=t),v=$l(v),y=vu({},y,X,Qp);var Ie=vu({},y.imports,X.imports,Qp),Xe=Au(Ie),Tt=Hn(Ie,Xe),Ut,In,ts=0,is=y.interpolate||Ed,Cs="__p += '",dr=cp((y.escape||Ed).source+"|"+is.source+"|"+(is===$r?zd:Ed).source+"|"+(y.evaluate||Ed).source+"|$","g"),za="//# sourceURL="+(ud.call(y,"sourceURL")?(y.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++co+"]")+`
`;v.replace(dr,function(oc,Fd,Ud,xf,Zv,wf){return Ud||(Ud=xf),Cs+=v.slice(ts,wf).replace(zl,Sl),Fd&&(Ut=!0,Cs+=`' +
__e(`+Fd+`) +
'`),Zv&&(In=!0,Cs+=`';
`+Zv+`;
__p += '`),Ud&&(Cs+=`' +
((__t = (`+Ud+`)) == null ? '' : __t) +
'`),ts=wf+oc.length,oc}),Cs+=`';
`;var nc=ud.call(y,"variable")&&y.variable;if(!nc)Cs=`with (obj) {
`+Cs+`
}
`;else if(ic.test(nc))throw new Ps(l);Cs=(In?Cs.replace(Gs,""):Cs).replace(jo,"$1").replace(fi,"$1;"),Cs="function("+(nc||"obj")+`) {
`+(nc?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ut?", __e = _.escape":"")+(In?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Cs+`return __p
}`;var ld=bh(function(){return sr(Xe,za+"return "+Cs).apply(t,Tt)});if(ld.source=Cs,il(ld))throw ld;return ld}function gh(v){return $l(v).toLowerCase()}function $_(v){return $l(v).toUpperCase()}function x0(v,y,L){if(v=$l(v),v&&(L||y===t))return Kn(v);if(!v||!(y=Cu(y)))return v;var X=Xs(v),Ie=Xs(y),Xe=Mo(X,Ie),Tt=qs(X,Ie)+1;return tl(X,Xe,Tt).join("")}function w0(v,y,L){if(v=$l(v),v&&(L||y===t))return v.slice(0,Hr(v)+1);if(!v||!(y=Cu(y)))return v;var X=Xs(v),Ie=qs(X,Xs(y))+1;return tl(X,0,Ie).join("")}function hh(v,y,L){if(v=$l(v),v&&(L||y===t))return v.replace(fa,"");if(!v||!(y=Cu(y)))return v;var X=Xs(v),Ie=Mo(X,Xs(y));return tl(X,Ie).join("")}function Bg(v,y){var L=J,X=Z;if(Vo(y)){var Ie="separator"in y?y.separator:Ie;L="length"in y?va(y.length):L,X="omission"in y?Cu(y.omission):X}v=$l(v);var Xe=v.length;if(ci(v)){var Tt=Xs(v);Xe=Tt.length}if(L>=Xe)return v;var Ut=L-As(X);if(Ut<1)return X;var In=Tt?tl(Tt,0,Ut).join(""):v.slice(0,Ut);if(Ie===t)return In+X;if(Tt&&(Ut+=In.length-Ut),Hc(Ie)){if(v.slice(Ut).search(Ie)){var ts,is=In;for(Ie.global||(Ie=cp(Ie.source,$l(Ec.exec(Ie))+"g")),Ie.lastIndex=0;ts=Ie.exec(is);)var Cs=ts.index;In=In.slice(0,Cs===t?Ut:Cs)}}else if(v.indexOf(Cu(Ie),Ut)!=Ut){var dr=In.lastIndexOf(Ie);dr>-1&&(In=In.slice(0,dr))}return In+X}function _h(v){return v=$l(v),v&&Al.test(v)?v.replace(ba,Xl):v}var yh=pl(function(v,y,L){return v+(L?" ":"")+y.toUpperCase()}),Sg=wi("toUpperCase");function Og(v,y,L){return v=$l(v),y=L?t:y,y===t?Lo(v)?Xc(v):Re(v):v.match(y)||[]}var bh=qa(function(v,y){try{return ea(v,t,y)}catch(L){return il(L)?L:new Ps(L)}}),k0=$u(function(v,y){return Ac(y,function(L){L=Dp(L),gc(v,L,ho(v[L],v))}),v});function zg(v){var y=v==null?0:v.length,L=Aa();return v=y?ge(v,function(X){if(typeof X[1]!="function")throw new Wd(a);return[L(X[0]),X[1]]}):[],qa(function(X){for(var Ie=-1;++Ie<y;){var Xe=v[Ie];if(ea(Xe[0],this,X))return ea(Xe[1],this,X)}})}function xh(v){return Wl(Gc(v,m))}function Cg(v){return function(){return v}}function S0(v,y){return v==null||v!==v?y:v}var Zf=ou(),o5=ou(!0);function cf(v){return v}function E_(v){return Up(typeof v=="function"?v:Gc(v,m))}function s5(v){return up(Gc(v,m))}function i5(v,y){return Gu(v,Gc(y,m))}var r5=qa(function(v,y){return function(L){return cl(L,v,y)}}),a5=qa(function(v,y){return function(L){return cl(v,L,y)}});function N_(v,y,L){var X=Au(y),Ie=Hp(y,X);L==null&&!(Vo(y)&&(Ie.length||!X.length))&&(L=y,y=v,v=this,Ie=Hp(y,Au(y)));var Xe=!(Vo(L)&&"chain"in L)||!!L.chain,Tt=Mr(v);return Ac(Ie,function(Ut){var In=y[Ut];v[Ut]=In,Tt&&(v.prototype[Ut]=function(){var ts=this.__chain__;if(Xe||ts){var is=v(this.__wrapped__),Cs=is.__actions__=Ll(this.__actions__);return Cs.push({func:In,args:arguments,thisArg:v}),is.__chain__=ts,is}return In.apply(v,Le([this.value()],arguments))})}),v}function l5(){return Ki._===this&&(Ki._=B),this}function D_(){}function c5(v){return v=va(v),qa(function(y){return vr(y,v)})}var d5=Kp(ge),u5=Kp(Id),p5=Kp(pt);function by(v){return cv(v)?Ys(Dp(v)):Wv(v)}function v5(v){return function(y){return v==null?t:Ou(v,y)}}var f5=Zp(),m5=Zp(!0);function j_(){return[]}function R_(){return!1}function g5(){return{}}function h5(){return""}function _5(){return!0}function y5(v,y){if(v=va(v),v<1||v>me)return[];var L=Me,X=rn(v,Me);y=Aa(y),v-=Me;for(var Ie=Vt(X,y);++L<v;)y(L);return Ie}function b5(v){return xs(v)?ge(v,Dp):xc(v)?[v]:Ll(zm($l(v)))}function x5(v){var y=++Rc;return $l(v)+y}var w5=Xd(function(v,y){return v+y},0),k5=lv("ceil"),S5=Xd(function(v,y){return v/y},1),C5=lv("floor");function P5(v){return v&&v.length?$p(v,cf,ve):t}function I5(v,y){return v&&v.length?$p(v,Aa(y,2),ve):t}function M5(v){return ei(v,cf)}function A5(v,y){return ei(v,Aa(y,2))}function T5(v){return v&&v.length?$p(v,cf,hc):t}function L5(v,y){return v&&v.length?$p(v,Aa(y,2),hc):t}var F5=Xd(function(v,y){return v*y},1),$5=lv("round"),E5=Xd(function(v,y){return v-y},0);function N5(v){return v&&v.length?Fn(v,cf):0}function D5(v,y){return v&&v.length?Fn(v,Aa(y,2)):0}return Ee.after=Qn,Ee.ary=io,Ee.assign=tp,Ee.assignIn=yu,Ee.assignInWith=vu,Ee.assignWith=Ld,Ee.at=ru,Ee.before=to,Ee.bind=ho,Ee.bindAll=k0,Ee.bindKey=Li,Ee.castArray=Qa,Ee.chain=nl,Ee.chunk=Vm,Ee.compact=ym,Ee.concat=Wm,Ee.cond=zg,Ee.conforms=xh,Ee.constant=Cg,Ee.countBy=jr,Ee.create=np,Ee.curry=Ms,Ee.curryRight=Zo,Ee.debounce=ko,Ee.defaults=_a,Ee.defaultsDeep=ed,Ee.defer=ki,Ee.delay=Rs,Ee.difference=qm,Ee.differenceBy=Hm,Ee.differenceWith=Ti,Ee.drop=zo,Ee.dropRight=ca,Ee.dropRightWhile=oa,Ee.dropWhile=_s,Ee.fill=Gi,Ee.filter=Lr,Ee.flatMap=Ha,Ee.flatMapDeep=Ns,Ee.flatMapDepth=Cr,Ee.flatten=sa,Ee.flattenDeep=ec,Ee.flattenDepth=Dr,Ee.flip=pi,Ee.flow=Zf,Ee.flowRight=o5,Ee.fromPairs=Ul,Ee.functions=ju,Ee.functionsIn=bm,Ee.groupBy=Ja,Ee.initial=Yu,Ee.intersection=pu,Ee.intersectionBy=Yv,Ee.intersectionWith=Ip,Ee.invert=yf,Ee.invertBy=bf,Ee.invokeMap=Gr,Ee.iteratee=E_,Ee.keyBy=Il,Ee.keys=Au,Ee.keysIn=Rd,Ee.map=bc,Ee.mapKeys=Kv,Ee.mapValues=Um,Ee.matches=s5,Ee.matchesProperty=i5,Ee.memoize=Fr,Ee.merge=Bd,Ee.mergeWith=td,Ee.method=r5,Ee.methodOf=a5,Ee.mixin=N_,Ee.negate=Ni,Ee.nthArg=c5,Ee.omit=kg,Ee.omitBy=ug,Ee.once=Sa,Ee.orderBy=Zr,Ee.over=d5,Ee.overArgs=$a,Ee.overEvery=u5,Ee.overSome=p5,Ee.partial=Js,Ee.partialRight=qi,Ee.partition=Ua,Ee.pick=Rf,Ee.pickBy=Gm,Ee.property=by,Ee.propertyOf=v5,Ee.pull=He,Ee.pullAll=ht,Ee.pullAllBy=It,Ee.pullAllWith=Ot,Ee.pullAt=lo,Ee.range=f5,Ee.rangeRight=m5,Ee.rearg=_r,Ee.reject=lt,Ee.remove=sn,Ee.rest=Pr,Ee.reverse=Ao,Ee.sampleSize=pe,Ee.set=mp,Ee.setWith=l0,Ee.shuffle=ke,Ee.slice=Cn,Ee.sortBy=xn,Ee.sortedUniq=da,Ee.sortedUniqBy=Yi,Ee.split=F_,Ee.spread=Br,Ee.tail=Bi,Ee.take=bo,Ee.takeRight=cs,Ee.takeRightWhile=b,Ee.takeWhile=k,Ee.tap=vc,Ee.throttle=ma,Ee.thru=qc,Ee.toArray=Nu,Ee.toPairs=Dg,Ee.toPairsIn=jg,Ee.toPath=b5,Ee.toPlainObject=ep,Ee.transform=ih,Ee.unary=Hi,Ee.union=T,Ee.unionBy=A,Ee.unionWith=$,Ee.uniq=E,Ee.uniqBy=Q,Ee.uniqWith=ie,Ee.unset=c0,Ee.unzip=Pe,Ee.unzipWith=rt,Ee.update=rh,Ee.updateWith=ah,Ee.values=wm,Ee.valuesIn=d0,Ee.without=gn,Ee.words=Og,Ee.wrap=yr,Ee.xor=cn,Ee.xorBy=Gt,Ee.xorWith=eo,Ee.zip=Ss,Ee.zipObject=La,Ee.zipObjectDeep=Rl,Ee.zipWith=pc,Ee.entries=Dg,Ee.entriesIn=jg,Ee.extend=yu,Ee.extendWith=vu,N_(Ee,Ee),Ee.add=w5,Ee.attempt=bh,Ee.camelCase=p0,Ee.capitalize=Rg,Ee.ceil=k5,Ee.clamp=u0,Ee.clone=Yr,Ee.cloneDeep=Ii,Ee.cloneDeepWith=Bs,Ee.cloneWith=Kr,Ee.conformsTo=Or,Ee.deburr=ch,Ee.defaultTo=S0,Ee.divide=S5,Ee.endsWith=T_,Ee.eq=lr,Ee.escape=dh,Ee.escapeRegExp=uh,Ee.every=ol,Ee.find=ii,Ee.findIndex=Fl,Ee.findKey=jp,Ee.findLast=Di,Ee.findLastIndex=Ta,Ee.findLastKey=Rp,Ee.floor=C5,Ee.forEach=Xa,Ee.forEachRight=Ur,Ee.forIn=dv,Ee.forInRight=fp,Ee.forOwn=Sv,Ee.forOwnRight=tc,Ee.get=Cv,Ee.gt=Ui,Ee.gte=Mi,Ee.has=_f,Ee.hasIn=jf,Ee.head=Wc,Ee.identity=cf,Ee.includes=Gl,Ee.indexOf=uu,Ee.inRange=lh,Ee.invoke=xm,Ee.isArguments=Fa,Ee.isArray=xs,Ee.isArrayBuffer=Ba,Ee.isArrayLike=Ir,Ee.isArrayLikeObject=Ci,Ee.isBoolean=sl,Ee.isBuffer=zs,Ee.isDate=yi,Ee.isElement=Jr,Ee.isEmpty=ga,Ee.isEqual=cr,Ee.isEqualWith=ua,Ee.isError=il,Ee.isFinite=br,Ee.isFunction=Mr,Ee.isInteger=ia,Ee.isLength=ri,Ee.isMap=ha,Ee.isMatch=Zs,Ee.isMatchWith=pa,Ee.isNaN=Oi,Ee.isNative=Ea,Ee.isNil=wl,Ee.isNull=fc,Ee.isNumber=Ml,Ee.isObject=Vo,Ee.isObjectLike=vi,Ee.isPlainObject=Yl,Ee.isRegExp=Hc,Ee.isSafeInteger=$c,Ee.isSet=jc,Ee.isString=Mc,Ee.isSymbol=xc,Ee.isTypedArray=Oa,Ee.isUndefined=ad,Ee.isWeakMap=iu,Ee.isWeakSet=Mu,Ee.join=lf,Ee.kebabCase=v0,Ee.last=et,Ee.lastIndexOf=Ae,Ee.lowerCase=ph,Ee.lowerFirst=f0,Ee.lt=Uc,Ee.lte=Eu,Ee.max=P5,Ee.maxBy=I5,Ee.mean=M5,Ee.meanBy=A5,Ee.min=T5,Ee.minBy=L5,Ee.stubArray=j_,Ee.stubFalse=R_,Ee.stubObject=g5,Ee.stubString=h5,Ee.stubTrue=_5,Ee.multiply=F5,Ee.nth=gt,Ee.noConflict=l5,Ee.noop=D_,Ee.now=Jt,Ee.pad=m0,Ee.padEnd=vh,Ee.padStart=L_,Ee.parseInt=fh,Ee.random=A_,Ee.reduce=Rr,Ee.reduceRight=Xr,Ee.repeat=g0,Ee.replace=h0,Ee.result=Ym,Ee.round=$5,Ee.runInContext=Et,Ee.sample=O,Ee.size=Mt,Ee.snakeCase=mh,Ee.some=Rt,Ee.sortedIndex=Jn,Ee.sortedIndexBy=nn,Ee.sortedIndexOf=us,Ee.sortedLastIndex=Tn,Ee.sortedLastIndexBy=ui,Ee.sortedLastIndexOf=Hs,Ee.startCase=_0,Ee.startsWith=y0,Ee.subtract=E5,Ee.sum=N5,Ee.sumBy=D5,Ee.template=b0,Ee.times=y5,Ee.toFinite=wd,Ee.toInteger=va,Ee.toLength=Ku,Ee.toLower=gh,Ee.toNumber=kd,Ee.toSafeInteger=Du,Ee.toString=$l,Ee.toUpper=$_,Ee.trim=x0,Ee.trimEnd=w0,Ee.trimStart=hh,Ee.truncate=Bg,Ee.unescape=_h,Ee.uniqueId=x5,Ee.upperCase=yh,Ee.upperFirst=Sg,Ee.each=Xa,Ee.eachRight=Ur,Ee.first=Wc,N_(Ee,function(){var v={};return Bu(Ee,function(y,L){ud.call(Ee.prototype,L)||(v[L]=y)}),v}(),{chain:!1}),Ee.VERSION=o,Ac(["bind","bindKey","curry","curryRight","partial","partialRight"],function(v){Ee[v].placeholder=Ee}),Ac(["drop","take"],function(v,y){Xi.prototype[v]=function(L){L=L===t?1:on(va(L),0);var X=this.__filtered__&&!y?new Xi(this):this.clone();return X.__filtered__?X.__takeCount__=rn(L,X.__takeCount__):X.__views__.push({size:rn(L,Me),type:v+(X.__dir__<0?"Right":"")}),X},Xi.prototype[v+"Right"]=function(L){return this.reverse()[v](L).reverse()}}),Ac(["filter","map","takeWhile"],function(v,y){var L=y+1,X=L==Y||L==ee;Xi.prototype[v]=function(Ie){var Xe=this.clone();return Xe.__iteratees__.push({iteratee:Aa(Ie,3),type:L}),Xe.__filtered__=Xe.__filtered__||X,Xe}}),Ac(["head","last"],function(v,y){var L="take"+(y?"Right":"");Xi.prototype[v]=function(){return this[L](1).value()[0]}}),Ac(["initial","tail"],function(v,y){var L="drop"+(y?"":"Right");Xi.prototype[v]=function(){return this.__filtered__?new Xi(this):this[L](1)}}),Xi.prototype.compact=function(){return this.filter(cf)},Xi.prototype.find=function(v){return this.filter(v).head()},Xi.prototype.findLast=function(v){return this.reverse().find(v)},Xi.prototype.invokeMap=qa(function(v,y){return typeof v=="function"?new Xi(this):this.map(function(L){return cl(L,v,y)})}),Xi.prototype.reject=function(v){return this.filter(Ni(Aa(v)))},Xi.prototype.slice=function(v,y){v=va(v);var L=this;return L.__filtered__&&(v>0||y<0)?new Xi(L):(v<0?L=L.takeRight(-v):v&&(L=L.drop(v)),y!==t&&(y=va(y),L=y<0?L.dropRight(-y):L.take(y-v)),L)},Xi.prototype.takeRightWhile=function(v){return this.reverse().takeWhile(v).reverse()},Xi.prototype.toArray=function(){return this.take(Me)},Bu(Xi.prototype,function(v,y){var L=/^(?:filter|find|map|reject)|While$/.test(y),X=/^(?:head|last)$/.test(y),Ie=Ee[X?"take"+(y=="last"?"Right":""):y],Xe=X||/^find/.test(y);Ie&&(Ee.prototype[y]=function(){var Tt=this.__wrapped__,Ut=X?[1]:arguments,In=Tt instanceof Xi,ts=Ut[0],is=In||xs(Tt),Cs=function(Fd){var Ud=Ie.apply(Ee,Le([Fd],Ut));return X&&dr?Ud[0]:Ud};is&&L&&typeof ts=="function"&&ts.length!=1&&(In=is=!1);var dr=this.__chain__,za=!!this.__actions__.length,nc=Xe&&!dr,ld=In&&!za;if(!Xe&&is){Tt=ld?Tt:new Xi(this);var oc=v.apply(Tt,Ut);return oc.__actions__.push({func:qc,args:[Cs],thisArg:t}),new Pc(oc,dr)}return nc&&ld?v.apply(this,Ut):(oc=this.thru(Cs),nc?X?oc.value()[0]:oc.value():oc)})}),Ac(["pop","push","shift","sort","splice","unshift"],function(v){var y=kp[v],L=/^(?:push|sort|unshift)$/.test(v)?"tap":"thru",X=/^(?:pop|shift)$/.test(v);Ee.prototype[v]=function(){var Ie=arguments;if(X&&!this.__chain__){var Xe=this.value();return y.apply(xs(Xe)?Xe:[],Ie)}return this[L](function(Tt){return y.apply(xs(Tt)?Tt:[],Ie)})}}),Bu(Xi.prototype,function(v,y){var L=Ee[y];if(L){var X=L.name+"";ud.call(ni,X)||(ni[X]=[]),ni[X].push({name:y,func:L})}}),ni[Fu(t,I).name]=[{name:"wrapper",func:t}],Xi.prototype.clone=aa,Xi.prototype.reverse=Fp,Xi.prototype.value=ov,Ee.prototype.at=Td,Ee.prototype.chain=xd,Ee.prototype.commit=jd,Ee.prototype.next=vd,Ee.prototype.plant=Tr,Ee.prototype.reverse=xl,Ee.prototype.toJSON=Ee.prototype.valueOf=Ee.prototype.value=Za,Ee.prototype.first=Ee.prototype.head,ys&&(Ee.prototype[ys]=Hd),Ee},_l=Vl();Tl?((Tl.exports=_l)._=_l,Zl._=_l):Ki._=_l}).call(ng)})(c_,c_.exports);var DA=c_.exports;const Mn=t0(DA);function jA(n,e,t){const o=n.target;e(parseInt(o.value)),t("opacityChange",e())}function RA(n,e){n.stopPropagation(),x(e,!0)}function BA(n,e,t,o,i,r,a,l){if(/^#[0-9A-F]{6}$/i.test(s(e))){const c=t(s(e));x(o,c.h),x(i,c.s),x(r,c.l),a(s(e)),l("colorChange",s(e))}}function OA(n,e,t,o,i,r){s(e)&&/^#[0-9A-Fa-f]{6}$/.test(s(e))&&(t(s(e)),o("colorChange",s(e)),s(i).includes(s(e))||x(i,[...s(i),s(e)]),x(r,!1))}var zA=n=>n.stopPropagation(),VA=(n,e)=>e(!1),WA=(n,e,t)=>e(s(t)),qA=fe("<button></button>"),HA=fe('<div class="flex gap-0.5 mb-0.5"></div>'),UA=(n,e,t)=>e(s(t)),GA=fe("<button></button>"),YA=fe(`<div class="flex items-center justify-between mb-3"><span class="text-sm text-gray-900 dark:text-gray-300 font-medium">Color Picker</span> <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors">OK</button></div> <div class="mb-3"></div> <div class="mb-3"><div class="flex items-center gap-2 mb-2"><!> <button class="w-5 h-5 rounded border-2 border-dashed border-gray-400 dark:border-gray-500 hover:border-gray-500 dark:hover:border-gray-300 
                   flex items-center justify-center text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4"></path></svg></button></div></div> <div><div class="flex items-center justify-between mb-2"><span class="text-xs text-gray-900 dark:text-gray-300">Opacity</span> <span class="text-xs text-gray-900 dark:text-gray-300"> </span></div> <div class="relative"><div class="absolute inset-0 h-2 rounded opacity-30" style="background-image: repeating-conic-gradient(#808080 0% 25%, transparent 0% 50%) 50% / 6px 6px;"></div> <input type="range" min="0" max="100" class="relative w-full h-2 rounded appearance-none cursor-pointer opacity-slider svelte-16cejrx"> <div class="absolute top-1/2 w-4 h-4 bg-white border-2 border-gray-800 rounded-full transform -translate-y-1/2 pointer-events-none shadow-sm"></div></div></div>`,1),KA=(n,e)=>e(!1),ZA=(n,e)=>x(e,!1),XA=fe('<div class="mb-3 flex items-center justify-between"><span class="text-sm text-gray-900 dark:text-gray-300 font-medium">Custom Color Picker</span> <div class="flex items-center gap-2"><button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors">OK</button> <button class="text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button></div></div> <div class="mb-3"><label class="block text-xs text-gray-600 dark:text-gray-400 mb-2">Hex Color</label> <input type="text" class="w-full px-3 py-2 bg-white dark:bg-[#1A1A1A] border border-gray-300 dark:border-[#404040] rounded text-gray-900 dark:text-white text-sm focus:border-blue-500 focus:outline-none" placeholder="#000000"></div> <div class="mb-3"><div class="w-full h-6 rounded border border-gray-300 dark:border-[#404040]"></div></div> <div class="mb-3"><label class="block text-xs text-gray-600 dark:text-gray-400 mb-2">Color Picker</label> <div class="relative w-full h-24 rounded border border-gray-300 dark:border-[#404040] cursor-crosshair"><div class="absolute w-3 h-3 border-2 border-white rounded-full transform -translate-x-1/2 -translate-y-1/2 pointer-events-none"></div></div></div> <div class="mb-3"><label class="block text-xs text-gray-600 dark:text-gray-400 mb-2">Hue</label> <div class="relative"><input type="range" min="0" max="360" class="w-full h-4 rounded appearance-none cursor-pointer" style="background: linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000);"> <div class="absolute top-1/2 w-4 h-4 bg-white border-2 border-gray-800 rounded-full transform -translate-y-1/2 pointer-events-none shadow-sm"></div></div></div> <button class="w-full py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded transition-colors">Add Color</button>',1),JA=fe(`<div class="color-picker-container fixed z-[360000] bg-white dark:bg-[#2A2A2A] border border-gray-200 dark:border-[#404040] rounded-lg shadow-xl p-3 transition-all duration-200" style="
      left: 50%; 
      top: 50%; 
      transform: translate(-50%, -50%); 
      max-height: 90vh; 
      max-width: 90vw;
      overflow-y: auto;
    "><!></div>`);function Pf(n,e){gd(e,!1);const t=mv();let o=Ws(e,"selectedColor",12,"#1677FF"),i=Ws(e,"show",12,!1),r=Ws(e,"opacity",12,100),a=Qd(),l=Qd(),c=!1,d=Qd(["#FF4D4F","#1890FF","#52C41A","#FA8C16","#722ED1"]),p=Qd(!1),m=Qd("#000000"),h=Qd(0),_=Qd(100),w=Qd(50);const S=[["#000000","#1C1C1C","#383838","#545454","#707070","#8C8C8C","#A8A8A8","#C4C4C4","#E0E0E0","#FFFFFF"],["#FF0000","#FF4D4F","#FF7875","#FFA39E","#FFCCC7","#FFF1F0","#FFEDED","#FFF5F5","#FFFAFA","#FFFFFF"],["#FF8C00","#FA541C","#FF7A45","#FF9C6E","#FFBB96","#FFD8BF","#FFE7BA","#FFF2E8","#FFF7E6","#FFFBE6"],["#FFD700","#FADB14","#FFEC3D","#FFF566","#FFFF8F","#FFFFB8","#FFFBE6","#FFFBF0","#FFFBF0","#FFFBF0"],["#32CD32","#52C41A","#73D13D","#95DE64","#B7EB8F","#D9F7BE","#F6FFED","#F6FFED","#F6FFED","#F6FFED"],["#00CED1","#13C2C2","#36CFC9","#5CDBD3","#87E8DE","#B5F5EC","#E6FFFB","#E6FFFB","#E6FFFB","#E6FFFB"],["#1E90FF","#1890FF","#40A9FF","#69C0FF","#91D5FF","#BAE7FF","#E6F7FF","#E6F7FF","#E6F7FF","#E6F7FF"],["#9370DB","#722ED1","#9254DE","#B37FEB","#D3ADF7","#EFDBFF","#F9F0FF","#F9F0FF","#F9F0FF","#F9F0FF"]];function P(Z){o(Z),t("colorChange",Z)}function I(Z,G,se){se/=100;const Y=G*Math.min(se,1-se)/100,oe=ee=>{const re=(ee+Z/30)%12,me=se-Y*Math.max(Math.min(re-3,9-re,1),-1);return Math.round(255*me).toString(16).padStart(2,"0")};return`#${oe(0)}${oe(8)}${oe(4)}`}function C(Z){const G=parseInt(Z.slice(1,3),16)/255,se=parseInt(Z.slice(3,5),16)/255,Y=parseInt(Z.slice(5,7),16)/255,oe=Math.max(G,se,Y),ee=Math.min(G,se,Y);let re=0,me=0,K=(oe+ee)/2;if(oe!==ee){const ye=oe-ee;switch(me=K>.5?ye/(2-oe-ee):ye/(oe+ee),oe){case G:re=(se-Y)/ye+(se<Y?6:0);break;case se:re=(Y-G)/ye+2;break;case Y:re=(G-se)/ye+4;break}re/=6}return{h:re*360,s:me*100,l:K*100}}function M(){x(m,I(s(h),s(_),s(w))),o(s(m)),t("colorChange",s(m))}function F(Z){c=!0,D(Z),document.addEventListener("mousemove",V),document.addEventListener("mouseup",j),Z.preventDefault()}function V(Z){c&&s(l)&&D(Z)}function j(){c=!1,document.removeEventListener("mousemove",V),document.removeEventListener("mouseup",j)}function D(Z){if(!s(l))return;const G=s(l).getBoundingClientRect(),se=Math.max(0,Math.min(1,(Z.clientX-G.left)/G.width)),Y=Math.max(0,Math.min(1,(Z.clientY-G.top)/G.height));x(_,se*100),x(w,(1-Y)*100),M()}function R(Z){const G=Z.target;s(a)&&!s(a).contains(G)&&(i(!1),x(p,!1),t("close"))}Lm(()=>{typeof document<"u"&&document.removeEventListener("click",R,!0)}),Jv(()=>jv(i()),()=>{i()&&typeof document<"u"&&setTimeout(()=>{document.addEventListener("click",R,!0)},0)}),Jv(()=>jv(i()),()=>{!i()&&typeof document<"u"&&document.removeEventListener("click",R,!0)}),Eg(),Bv();var W=Ln(),J=Dt(W);Te(J,i,Z=>{var G=JA();G.__click=[zA];var se=g(G);Te(se,()=>!s(p),Y=>{var oe=YA(),ee=Dt(oe),re=u(g(ee),2);re.__click=[VA,i],f(ee);var me=u(ee,2);vs(me,5,()=>S,Vs,(bt,nt)=>{var Pt=HA();vs(Pt,5,()=>s(nt),Vs,(Qe,yt)=>{var xe=qA();xe.__click=[WA,P,yt],Se(()=>{Us(xe,`w-4 h-4 border hover:scale-110 transition-transform cursor-pointer
                       ${(o()===s(yt)?"border-white dark:border-white border-2":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-400")??""}`),zt(xe,"style",`background-color: ${s(yt)??""};`)}),z(Qe,xe)}),f(Pt),z(bt,Pt)}),f(me);var K=u(me,2),ye=g(K),Me=g(ye);vs(Me,1,()=>s(d),Vs,(bt,nt)=>{var Pt=GA();Pt.__click=[UA,P,nt],Se(()=>{Us(Pt,`w-5 h-5 rounded border hover:scale-110 transition-transform cursor-pointer
                     ${(o()===s(nt)?"border-white dark:border-white border-2":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-400")??""}`),zt(Pt,"style",`background-color: ${s(nt)??""};`)}),z(bt,Pt)});var Fe=u(Me,2);Fe.__click=[RA,p],f(ye),f(K);var Ze=u(K,2),Ge=g(Ze),it=u(g(Ge),2),Ye=g(it);f(it),f(Ge);var ct=u(Ge,2),kt=u(g(ct),2);Qt(kt),kt.__input=[jA,r,t];var ft=u(kt,2);f(ct),f(Ze),Se(()=>{ze(Ye,`${r()??""}%`),zt(kt,"style",`background: linear-gradient(to right, transparent, ${o()??""});`),zt(ft,"style",`left: calc(${r()??""}% - 8px);`)}),po(kt,r),z(Y,oe)},Y=>{var oe=XA(),ee=Dt(oe),re=u(g(ee),2),me=g(re);me.__click=[KA,i];var K=u(me,2);K.__click=[ZA,p],f(re),f(ee);var ye=u(ee,2),Me=u(g(ye),2);Qt(Me),Me.__input=[BA,m,C,h,_,w,o,t],f(ye);var Fe=u(ye,2),Ze=g(Fe);f(Fe);var Ge=u(Fe,2),it=u(g(Ge),2);it.__mousedown=F;var Ye=g(it);f(it),Xu(it,Pt=>x(l,Pt),()=>s(l)),f(Ge);var ct=u(Ge,2),kt=u(g(ct),2),ft=g(kt);Qt(ft),ft.__input=M;var bt=u(ft,2);f(kt),f(ct);var nt=u(ct,2);nt.__click=[OA,m,o,t,d,p],Se(()=>{zt(Ze,"style",`background-color: ${s(m)??""};`),zt(it,"style",`background: linear-gradient(to bottom, transparent, black), linear-gradient(to right, white, hsl(${s(h)??""}, 100%, 50%));`),zt(Ye,"style",`left: ${s(_)??""}%; top: ${100-s(w)}%;`),zt(bt,"style",`left: calc(${s(h)/360*100}% - 8px);`)}),po(Me,()=>s(m),Pt=>x(m,Pt)),po(ft,()=>s(h),Pt=>x(h,Pt)),z(Y,oe)}),f(G),Xu(G,Y=>x(a,Y),()=>s(a)),Se(()=>{Fi(G,"w-64",!s(p)),Fi(G,"w-80",s(p))}),z(Z,G)}),z(n,W),hd()}qu(["click","input","mousedown"]);const QA={data:null,loading:!1,error:null},Fm=zp(QA);async function eT(n,e){const o=`${tT()}/auth/user/preference/${n}${e?"?isFree=true":""}`,i=await nT(o,{},8e3);if(!i.ok)throw i.status===404?new Error("User not found"):new Error(`Failed to fetch user preferences: ${i.statusText}`);return await i.json()}function tT(){var e,t;const n=(t=(e=import.meta)==null?void 0:e.env)==null?void 0:t.VITE_USER_PREFS_BASE_URL;return typeof n=="string"&&n.trim()?n.trim():"https://noti.dutyai.app"}async function nT(n,e={},t=8e3){const o=new AbortController,i=setTimeout(()=>o.abort(),t);try{return await fetch(n,{...e,signal:o.signal})}finally{clearTimeout(i)}}function oT(n){Fm.set({data:n,loading:!1,error:null})}function sT(n){Fm.update(e=>({...e,loading:n}))}function iT(n){Fm.set({data:null,loading:!1,error:n})}async function rT(n,e){const t="https://noti.dutyai.app/auth/user/preference";try{const o=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clerkId:n,theme:e})});if(!o.ok)throw new Error(`Failed to save theme preference: ${o.statusText}`);console.log("✅ Theme preference saved successfully:",{clerkId:n,theme:e})}catch(o){console.error("❌ Failed to save theme preference:",o)}}const yb=zp(null),W1=zp(null),aT=n8,R0={},lT=[{tfsecs:604800,origin:345600,date:"1970-01-05"}];function cT(n){if(n=Math.abs(n),n>=1)return 0;let e=0;for(;n<1;)n=n*10,e+=1;return e}function Cf(n){if(R0[n])return R0[n];const e=n.length-1,t=n.substring(e),o=n.substring(0,e),i=parseInt(o);let r="minute";if(t=="w")r="week";else if(t=="d")r="day";else if(t=="h")r="hour";else if(t=="m")r="minute";else if(t=="s")r="second";else throw new Error(`unsupport period: ${n}`);const a=Pv(n);return R0[n]={multiplier:i,timespan:r,timeframe:n,secs:a},R0[n]}Cf("1m"),Cf("5m"),Cf("15m"),Cf("30m"),Cf("1h"),Cf("2h"),Cf("4h"),Cf("8h"),Cf("12h"),Cf("1d"),Cf("3d"),Cf("1w");function B0(n,e,t){return{id:n,position:aT.Middle,marginLeft:8,marginTop:2,marginRight:0,marginBottom:0,paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,icon:e,fontFamily:"icomoon",size:14,color:t,activeColor:t,backgroundColor:"transparent",activeBackgroundColor:"rgba(22, 119, 255, 0.15)"}}function wu(n){let e=n==="dark"?"#929AA5":"#76808F",t=n==="dark"?"#555555":"#dddddd";const o=n==="dark"?"#081115":"#F3F3F3",i=n==="dark"?"#070211":"#ffffff",r=n==="dark"?"#FFFFFF":"#333333";try{if(typeof window<"u"){const h=document.querySelector(".menu-container")||document.documentElement,_=window.getComputedStyle(h),w=I=>(_.getPropertyValue(I)||"").trim(),S=w("--menu-text"),P=w("--menu-btn-border")||w("--menu-border");S&&(e=S),P&&(t=P)}}catch{}const a=typeof window<"u"&&window.innerWidth<=768,l=typeof window<"u"&&window.innerWidth<=480,c=l?10:a?11:12,d=l?10:a?11:12,p=l?2:a?3:4,m=l?2:a?3:4;return{pane:{backgroundColor:i},candle:{pane:{backgroundColor:i},type:o8.CandleSolid,priceMark:{last:{show:!0},high:{show:!0},low:{show:!0}},tooltip:{showRule:Qy.Always,text:{style:{fontSize:32,fontWeight:"bold",color:"#FFFFFF"}},title:{show:!0,size:18,family:"Helvetica Neue",weight:"normal",color:r,template:"{name} · {period} · {exchange} · {segment}"},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:e,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a",template:({current:h})=>{const _="#32CD32",w="#FF0000",S=((h==null?void 0:h.close)??0)>((h==null?void 0:h.open)??0),P=((h==null?void 0:h.close)??0)<((h==null?void 0:h.open)??0),I=S?_:P?w:e,C=F=>({text:F,color:I});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:C("{open}")},{title:"H",value:C("{high}")},{title:"L",value:C("{low}")},{title:"C",value:C("{close}")},{title:"V",value:C("{volume}")}]:[{title:"O",value:C("{open}")},{title:"H",value:C("{high}")},{title:"L",value:C("{low}")},{title:"C",value:C("{close}")},{title:"V",value:C("{volume}")}]}}}},indicator:{lastValueMark:{show:!0},tooltip:{showRule:Qy.Always,icons:[B0("visible","",e),B0("invisible","",e),B0("setting","",e),B0("close","",e)]}},grid:{show:!0,horizontal:{show:!0,color:o,style:Ke.Solid,size:1},vertical:{show:!0,color:o,style:Ke.Solid,size:1}},xAxis:{show:!0,axisLine:{show:!0,color:t,size:5},tickLine:{show:!0,color:t},tickText:{show:!0,style:{fontSize:c,color:e,fontFamily:"Arial, sans-serif"},margin:p}},yAxis:{type:"normal",reverse:!1,show:!0,axisLine:{show:!0,color:t,size:4},tickLine:{show:!0,color:t},tickText:{show:!0,style:{fontSize:d,color:e,fontFamily:"Arial, sans-serif"},margin:m}},separator:{size:1,color:n==="dark"?"rgba(85, 85, 85, 0.3)":"rgba(221, 221, 221, 0.3)",fill:!0,activeBackgroundColor:n==="dark"?"rgba(85, 85, 85, 0.1)":"rgba(221, 221, 221, 0.1)"}}}const bu=Ix(),d_={AO:[{title:"Short Period",precision:0,min:1,default:5},{title:"Long Period",precision:0,min:1,default:34},{title:"Increasing Color",type:"color",styleKey:"bars[0].upColor",default:"#26A69A"},{title:"Decreasing Color",type:"color",styleKey:"bars[0].downColor",default:"#EF5350"}],BIAS:[{title:R1(),precision:0,min:1,default:6}],BOLL:[{title:R1(),precision:0,min:1,default:20},{title:Mx(),precision:2,min:1,default:2}],BBI:[{title:bu+"1",precision:0,min:1,default:3},{title:bu+"2",precision:0,min:1,default:6},{title:bu+"3",precision:0,min:1,default:12},{title:bu+"4",precision:0,min:1,default:24}],CCI:[{title:bu+"1",precision:0,min:1,default:20}],CR:[{title:bu+"1",precision:0,min:1,default:26},{title:bu+"2",precision:0,min:1,default:10},{title:bu+"3",precision:0,min:1,default:20},{title:bu+"4",precision:0,min:1,default:40},{title:bu+"5",precision:0,min:1,default:60}],DMI:[{title:"DI Period",precision:0,min:1,default:14},{title:"ADX Period",precision:0,min:1,default:6}],EMV:[{title:bu+"1",precision:0,min:1,default:14},{title:bu+"2",precision:0,min:1,default:9}],EMA:[{title:"Period",precision:0,min:1,default:20},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#2563eb"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:2}],ICHIMOKU:[{title:"Tenkan Period",precision:0,min:1,default:9},{title:"Kijun Period",precision:0,min:1,default:26},{title:"Senkou B Period",precision:0,min:1,default:52}],MTM:[{title:bu+"1",precision:0,min:1,default:12},{title:bu+"2",precision:0,min:1,default:6}],MA:[{title:"MA1",precision:0,min:1,styleKey:"lines[0].color",default:5},{title:"MA2",precision:0,min:1,styleKey:"lines[1].color",default:10},{title:"MA3",precision:0,min:1,styleKey:"lines[2].color",default:30}],MACD:[{title:"Fast Period",precision:0,min:1,default:12},{title:"Slow Period",precision:0,min:1,default:26},{title:"Signal Period",precision:0,min:1,default:9}],OBV:[{title:bu+"1",precision:0,min:1,default:30},{title:bu+"2",precision:0,min:1,default:10}],PVT:[],PSY:[{title:bu+"1",precision:0,min:1,default:12},{title:bu+"2",precision:0,min:1,default:6}],ROC:[{title:bu+"1",precision:0,min:1,default:12},{title:bu+"2",precision:0,min:1,default:6}],RSI:[{title:"Period",precision:0,min:1,default:14},{title:"Overbought",precision:0,min:50,max:100,default:70},{title:"Middle",precision:0,min:30,max:70,default:50},{title:"Oversold",precision:0,min:0,max:50,default:30},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#FF6B35"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:1}],SMA:[{title:bu+"1",precision:0,min:1,default:12},{title:bu+"2",precision:0,min:1,default:2}],SMARTTREND:[{title:"Period",precision:0,min:1,default:10},{title:"Multiplier",precision:1,min:.1,max:10,default:3},{title:"Uptrend Color",type:"color",styleKey:"lines[0].color",default:"#10B981"},{title:"Downtrend Color",type:"color",styleKey:"lines[1].color",default:"#EF4444"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:2}],KDJ:[{title:bu+"1",precision:0,min:1,default:9},{title:bu+"2",precision:0,min:1,default:3},{title:bu+"3",precision:0,min:1,default:3}],SAR:[{title:"Start",precision:3,min:.001,max:.1,default:.02},{title:"Increment",precision:3,min:.001,max:.1,default:.02},{title:"Max value",precision:2,min:.1,max:1,default:.2}],TRIX:[{title:bu+"1",precision:0,min:1,default:12},{title:bu+"2",precision:0,min:1,default:9}],VOL:[{title:"MA1",precision:0,min:1,default:5},{title:"MA2",precision:0,min:1,default:10},{title:"MA3",precision:0,min:1,default:20}],VR:[{title:bu+"1",precision:0,min:1,default:26},{title:bu+"2",precision:0,min:1,default:6},{title:bu+"3",precision:0,min:1,default:12}],WR:[{title:"Period",precision:0,min:1,default:14},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#2563eb"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:1}],TRAP_HUNTER:[{title:"Resistance Lookback",precision:0,min:1,default:20},{title:"Support Lookback",precision:0,min:1,default:20},{title:"Confirmation Bars",precision:0,min:1,default:4},{title:"Max Trap Bars",precision:0,min:1,default:6},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Min Volume Spike",precision:2,min:.1,default:1.2},{title:"Min Breakout Factor",precision:4,min:0,default:5e-4},{title:"Min Wick Ratio",precision:2,min:0,max:1,default:.35},{title:"Min Trap Score",precision:2,min:0,max:1,default:.5},{title:"Enable Normal Signal (0/1)",precision:0,min:0,max:1,default:1},{title:"Normal Quiet Bars",precision:0,min:1,default:5}],SMART_MONEY:[{title:"Zone Lookback Bars",precision:0,min:10,default:40},{title:"Min Zone Bars",precision:0,min:3,default:5},{title:"Max Zone Bars",precision:0,min:5,default:25},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Min Volume Factor",precision:2,min:.1,default:1.2},{title:"Max Zone Width %",precision:3,min:.001,default:.03},{title:"Prior Trend Lookback",precision:0,min:1,default:20},{title:"Min OBV Trend Strength",precision:2,min:0,default:.2},{title:"Min Zone Score",precision:2,min:0,max:1,default:.6},{title:"Merge Nearby Zones (0/1)",precision:0,min:0,max:1,default:1},{title:"Max Zones Displayed",precision:0,min:1,default:20},{title:"Show Labels (0/1)",precision:0,min:0,max:1,default:1}],VOLCANIC:[{title:"BB Period",precision:0,min:1,default:16},{title:"BB StdDev",precision:2,min:.1,default:2},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Normalize Lookback",precision:0,min:10,default:60},{title:"Pressure SMA",precision:0,min:1,default:2},{title:"Min Pressure Alert",precision:2,min:0,max:1,default:.55},{title:"Confirm Bars",precision:0,min:1,default:1},{title:"Min Volume x",precision:2,min:.5,default:1},{title:"Min Range x",precision:2,min:.5,default:1},{title:"Min Body % of Range",precision:2,min:0,max:1,default:.5},{title:"Breakout Lookback",precision:0,min:5,default:10},{title:"Min Bars Between Signals",precision:0,min:1,default:1},{title:"Trend EMA Period",precision:0,min:2,default:30},{title:"Require Trend Align (0/1)",precision:0,min:0,max:1,default:0},{title:"Breakout Buffer %",precision:4,min:0,default:7e-4},{title:"Require BB Band Break (0/1)",precision:0,min:0,max:1,default:0},{title:"Retest Window (bars)",precision:0,min:1,default:1}],VOLCANIC_SIG:[{title:"BB Period",precision:0,min:1,default:16},{title:"BB StdDev",precision:2,min:.1,default:2},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Normalize Lookback",precision:0,min:10,default:60},{title:"Pressure SMA",precision:0,min:1,default:2},{title:"Min Pressure Alert",precision:2,min:0,max:1,default:.55},{title:"Confirm Bars",precision:0,min:1,default:1},{title:"Min Volume x",precision:2,min:.5,default:1},{title:"Min Range x",precision:2,min:.5,default:1},{title:"Min Body % of Range",precision:2,min:0,max:1,default:.5},{title:"Breakout Lookback",precision:0,min:5,default:10},{title:"Min Bars Between Signals",precision:0,min:1,default:1},{title:"Trend EMA Period",precision:0,min:2,default:30},{title:"Require Trend Align (0/1)",precision:0,min:0,max:1,default:0},{title:"Breakout Buffer %",precision:4,min:0,default:7e-4},{title:"Require BB Band Break (0/1)",precision:0,min:0,max:1,default:0},{title:"Retest Window (bars)",precision:0,min:1,default:1}],ZIGZAG:[{title:"Deviation %",precision:1,min:1,max:50,default:5},{title:"Depth",precision:0,min:1,max:50,default:5}]};function dT(n,e){if(n>1e12)throw Error("10 digit timestamp is require for align_tfsecs");let t=0;for(const o of lT){if(e<o.tfsecs)break;if(e%o.tfsecs==0){t=o.origin;break}}return t?Math.floor((n-t)/e)*e+t:Math.floor(n/e)*e}function bb(n,e){if((!n||isNaN(n)||n<=0)&&(console.warn("Invalid timestamp in align_tfmsecs:",n),n=Date.now()),n<1e12&&(console.warn("13 digit timestamp is require for align_tfmsecs, got:",n),n<1e9?n=n*1e3:n=Date.now()),e<1e3)throw Error("milliseconds tf_msecs is require for align_tfmsecs");const t=Math.floor(n/1e3),o=Math.floor(e/1e3);return dT(t,o)*1e3}function uT(n,e,t,o=null){if(n=n.map((a,l)=>{const c=a[0];return(!c||isNaN(c)||c<=0)&&(console.warn(`Invalid timestamp in build_ohlcvs at index ${l}:`,c),a[0]=Date.now()),a}),o&&((!o[0]||isNaN(o[0])||o[0]<=0)&&(console.warn("Invalid timestamp in last_bar:",o[0]),o[0]=Date.now()),o[0]=bb(o[0],t)),e==t)return o&&n.length>0&&n[0][0]>o[0]&&n.splice(0,0,o),n;const i=o?[o]:[];let r=i.length-1;return n.forEach((a,l)=>{if((!a[0]||isNaN(a[0])||a[0]<=0)&&(console.warn(`Invalid timestamp in build_ohlcvs forEach at index ${l}:`,a[0]),a[0]=Date.now()),a[0]=bb(a[0],t),r<0||a[0]>i[r][0])i.push(a),r+=1;else{const c=i[r];c[2]=Math.max(c[2],a[2]),c[3]=Math.min(c[3],a[3]),c[4]=a[4],c[5]+=a[5]}}),i}function $d(n){var o,i,r,a,l,c,d,p;const e=Mn.cloneDeep(n),t=(o=e.candle)==null?void 0:o.type;if(t&&(e._originalChartType=t),e.candle&&e.candle.type==="area"&&!e.candle._isLineChart){e.candle.area||(e.candle.area={});const m=((i=e.candle.bar)==null?void 0:i.upColor)||((r=e.candle.bar)==null?void 0:r.downColor)||((c=(l=(a=e.candle.priceMark)==null?void 0:a.last)==null?void 0:l.text)==null?void 0:c.color)||((p=(d=e.candle.tooltip)==null?void 0:d.text)==null?void 0:p.color)||"#2196F3";e.candle.area={...e.candle.area,backgroundColor:[{offset:0,color:m+"60"},{offset:1,color:m+"10"}]}}if(n.yAxis&&(e.yAxis={...e.yAxis,...n.yAxis}),n.xAxis&&(e.xAxis={...e.xAxis,...n.xAxis}),n.grid&&(e.grid={...e.grid,...n.grid}),n.indicator&&(e.indicator={...e.indicator,...n.indicator}),e.candle&&e.candle.type==="heikin_ashi"&&(e.candle.type="candle_solid"),e.candle&&e.candle.type==="renko_atr"&&(e.candle.type="candle_solid"),e.candle&&e.candle.type==="point_and_figure"){e.candle.type="candle_solid";const m="rgba(0,0,0,0)";e.candle.bar={...e.candle.bar,upColor:m,downColor:m,noChangeColor:m,upBorderColor:m,downBorderColor:m,noChangeBorderColor:m,upWickColor:m,downWickColor:m,noChangeWickColor:m},e.candle.priceMark||(e.candle.priceMark={}),e.candle.priceMark.high={show:!1},e.candle.priceMark.low={show:!1}}else if(e.candle&&e.candle.bar){const m=e.candle.bar,h=P=>!P||P==="transparent"||P==="rgba(0,0,0,0)",_="#26A69A",w="#EF5350",S="#888888";h(m.upColor)&&(m.upColor=_),h(m.downColor)&&(m.downColor=w),h(m.noChangeColor)&&(m.noChangeColor=S),h(m.upBorderColor)&&(m.upBorderColor=_),h(m.downBorderColor)&&(m.downBorderColor=w),h(m.noChangeBorderColor)&&(m.noChangeBorderColor=S),h(m.upWickColor)&&(m.upWickColor=_),h(m.downWickColor)&&(m.downWickColor=w),h(m.noChangeWickColor)&&(m.noChangeWickColor=S),e.candle.bar=m}return e}function pT(n,e){var t,o;return(t=e==null?void 0:e.candle)!=null&&t.type?(console.log("✅ Using chart type from $save.styles:",e.candle.type),e.candle.type):n!=null&&n._originalChartType?(console.log("✅ Using original chart type from marker:",n._originalChartType),n._originalChartType):(o=n==null?void 0:n.candle)!=null&&o.type?(console.log("⚠️ Using chart type from chart.getStyles() (might be converted):",n.candle.type),n.candle.type):(console.log("⚠️ No chart type found, defaulting to candle_solid"),"candle_solid")}function xb(n){if(!n||n.length===0)return n;const e=[];let t=0,o=0;for(let i=0;i<n.length;i++){const r=n[i],a=(r.open+r.high+r.low+r.close)/4;let l;i===0?l=(r.open+r.close)/2:l=(t+o)/2;const c=Math.max(r.high,l,a),d=Math.min(r.low,l,a),p={...r,open:l,high:c,low:d,close:a};e.push(p),t=l,o=a}return e}function wb(n,e){if(!Array.isArray(n)||n.length===0)return n;const t=(e==null?void 0:e.method)||"ATR",o=Math.max(1,((e==null?void 0:e.atrLength)??14)|0),i=(e==null?void 0:e.source)||"close",r=!!(e!=null&&e.wick),a=se=>{const Y=Number(se==null?void 0:se.open),oe=Number(se==null?void 0:se.high),ee=Number(se==null?void 0:se.low),re=Number(se==null?void 0:se.close);return!Number.isFinite(Y)||!Number.isFinite(oe)||!Number.isFinite(ee)||!Number.isFinite(re)?null:{...se,open:Y,high:oe,low:ee,close:re,volume:Number.isFinite(Number(se==null?void 0:se.volume))?Number(se.volume):se==null?void 0:se.volume}},l=n.map(a).filter(Boolean);if(l.length===0)return[];const c=se=>{switch(i){case"open":return se.open;case"high":return se.high;case"low":return se.low;default:return se.close}},d=[];let p=null,m=1/0,h=-1/0,_=0;for(let se=0;se<l.length;se++){const Y=l[se];m=Math.min(m,Y.low),h=Math.max(h,Y.high),_+=Y.close;const oe=p==null?Math.max(0,Y.high-Y.low):Math.max(Y.high-Y.low,Math.abs(Y.high-p),Math.abs(Y.low-p));d.push(Math.max(0,oe)),p=Y.close}const w=new Array(d.length).fill(0);let S=0;for(let se=0;se<d.length;se++)S+=d[se],se===o-1?w[se]=S/o:se>=o?w[se]=(w[se-1]*(o-1)+d[se])/o:w[se]=d[se];const P=_/Math.max(1,l.length),I=Number.isFinite(h-m)?Math.max(0,h-m):0,C=w[Math.min(w.length-1,Math.max(0,o-1))]||d.reduce((se,Y)=>se+Y,0)/Math.max(1,d.length);let M=t==="ATR"&&w[w.length-1]||C;if(!Number.isFinite(M)||M<=0){const se=I>0?I/Math.max(50,l.length):Math.abs(P)*.001;M=se>0?se:1}const F=I>0?I/5e3:0,V=Number.isFinite(P)&&P!==0?Math.abs(P)*1e-6:0;M=Math.max(1e-12,M,F,V);const j=200,D=2e4,R=se=>{if(!Number.isFinite(se)||se<=0)return 0;let Y=0,oe=c(l[0]);for(let ee=1;ee<l.length;ee++){const re=c(l[ee]);if(!Number.isFinite(re))continue;const me=re-oe,K=Math.floor(Math.abs(me)/se);if(K<=0)continue;const ye=Math.min(K,j);if(Y+=ye,oe+=Math.sign(me)*ye*se,Y>D*4)return Y}return Y};let W=R(M);for(let se=0;se<3&&W>D;se++){const Y=Math.max(1.2,W/D);M*=Y,W=R(M)}const J=[];let Z=c(l[0]),G=l[0]&&typeof l[0].timestamp=="number"&&Number.isFinite(l[0].timestamp)?l[0].timestamp:Date.now();for(let se=1;se<l.length;se++){const Y=l[se],oe=c(Y);if(!Number.isFinite(oe))continue;const ee=oe-Z,re=ee>0?1:ee<0?-1:0;if(re===0)continue;let me=Math.floor(Math.abs(ee)/M);if(!(me<=0)){me=Math.min(me,j);for(let K=0;K<me;K++){const ye=Z,Me=Z+re*M,Fe=Math.max(ye,Me),Ze=Math.min(ye,Me),Ge=K===me-1,it=r&&Ge&&re>0?Math.max(Fe,Y.high):Fe,Ye=r&&Ge&&re<0?Math.min(Ze,Y.low):Ze,ct=typeof Y.timestamp=="number"&&Number.isFinite(Y.timestamp)?Y.timestamp:G;G=Math.max(ct,G+1),J.push({timestamp:G,open:ye,high:it,low:Ye,close:Me,volume:Y.volume??0}),Z=Me}}}if(J.length===0){const se=l[l.length-1],Y=se.open,oe=se.close,ee=r?se.high:Math.max(Y,oe),re=r?se.low:Math.min(Y,oe);J.push({timestamp:typeof se.timestamp=="number"&&Number.isFinite(se.timestamp)?se.timestamp:G||Date.now(),open:Y,high:ee,low:re,close:oe,volume:se.volume??0})}return J}const vT={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};function kb(n,e){if(!Array.isArray(n)||n.length===0)return n;const t={...vT,...e};let o;if(t.boxSizeMode==="ATR"){const I=Math.max(1,t.atrLength||14),C=[];let M=null;for(let D=0;D<n.length;D++){const R=n[D],W=M==null?Math.max(0,R.high-R.low):Math.max(R.high-R.low,Math.abs(R.high-M),Math.abs(R.low-M));C.push(Math.max(0,W)),M=R.close}const F=new Array(C.length).fill(0);let V=0;for(let D=0;D<C.length;D++)V+=C[D],D===I-1?F[D]=V/I:D>=I?F[D]=(F[D-1]*(I-1)+C[D])/I:F[D]=C[D];const j=F[F.length-1]||C.reduce((D,R)=>D+R,0)/Math.max(1,C.length);o=Math.max(1e-4,j)}else if(t.boxSizeMode==="percent"){const I=n.reduce((C,M)=>C+M.close,0)/n.length;o=Math.max(1e-4,I*t.boxSize/100)}else o=Math.max(1e-4,t.boxSize);const i=o*t.reversalBoxes,r=n[0];let a=r.close>=r.open?"up":"down",l=Math.floor(r.high/o)*o,c=Math.ceil(r.low/o)*o;const d=[];let p=0,m={columnIndex:0,direction:a,boxes:[],highPrice:l,lowPrice:c,startTime:r.timestamp||Date.now(),endTime:r.timestamp||Date.now()};const h=Math.max(1,Math.round((l-c)/o));for(let I=0;I<=h;I++){const C=c+I*o;m.boxes.push({columnIndex:0,direction:a,boxIndex:I,price:C,startTime:m.startTime,endTime:m.endTime})}const _=500;for(let I=1;I<n.length;I++){const C=n[I],M=C.timestamp||Date.now();if(m.endTime=M,a==="up"){const F=Math.floor(C.high/o)*o;if(F>l){let V=Math.round((F-l)/o);V=Math.min(V,_-m.boxes.length);for(let j=1;j<=V;j++){const D=l+j*o;m.boxes.push({columnIndex:p,direction:"up",boxIndex:m.boxes.length,price:D,startTime:M,endTime:M})}l=F,m.highPrice=l}if(l-C.low>=i){const V=Math.ceil(C.low/o)*o;d.push(m),p++,a="down",c=V,m={columnIndex:p,direction:"down",boxes:[],highPrice:l-o,lowPrice:c,startTime:M,endTime:M};let j=Math.round((m.highPrice-c)/o);j=Math.min(j,_);for(let D=0;D<=j;D++){const R=m.highPrice-D*o;m.boxes.push({columnIndex:p,direction:"down",boxIndex:D,price:R,startTime:M,endTime:M})}l=m.highPrice}}else{const F=Math.ceil(C.low/o)*o;if(F<c){let V=Math.round((c-F)/o);V=Math.min(V,_-m.boxes.length);for(let j=1;j<=V;j++){const D=c-j*o;m.boxes.push({columnIndex:p,direction:"down",boxIndex:m.boxes.length,price:D,startTime:M,endTime:M})}c=F,m.lowPrice=c}if(C.high-c>=i){const V=Math.floor(C.high/o)*o;d.push(m),p++,a="up",l=V,m={columnIndex:p,direction:"up",boxes:[],highPrice:l,lowPrice:c+o,startTime:M,endTime:M};let j=Math.round((l-m.lowPrice)/o);j=Math.min(j,_);for(let D=0;D<=j;D++){const R=m.lowPrice+D*o;m.boxes.push({columnIndex:p,direction:"up",boxIndex:D,price:R,startTime:M,endTime:M})}c=m.lowPrice}}}if(m.boxes.length>0&&d.push(m),d.length===0)return n;const w=[],S=Date.now(),P=6e4;for(const I of d){const C=I.startTime||S+I.columnIndex*P;w.push({timestamp:C,open:I.direction==="up"?I.lowPrice:I.highPrice,high:I.highPrice,low:I.lowPrice,close:I.direction==="up"?I.highPrice:I.lowPrice,volume:I.boxes.length,_pnf:{columnIndex:I.columnIndex,direction:I.direction,boxes:I.boxes,boxCount:I.boxes.length,boxSize:o,upColor:t.upColor,downColor:t.downColor}})}return w}function ig(n){return n.exchange&&n.ticker?`${n.exchange.toUpperCase()}:${n.ticker.toUpperCase()}`:(n.ticker||n.name||"UNKNOWN").toUpperCase()}function fT(n,e){var r,a,l,c;const t=[];if(e)try{const d=((r=e.getChartStore)==null?void 0:r.call(e))||e;d&&typeof d.getPanes=="function"?d.getPanes().forEach((m,h)=>{t.push({id:m.id||`pane_${h}`,height:m.height,minHeight:m.minHeight,position:h,visible:m.visible!==!1})}):t.push({id:"candle_pane",height:400,position:0,visible:!0})}catch(d){console.warn("Error collecting pane configurations:",d),t.push({id:"candle_pane",height:400,position:0,visible:!0})}const o=[],i=new Map;if(Object.entries(n.saveInds).forEach(([d,p])=>{var S,P,I,C,M,F,V,j,D,R,W,J;const m={};p.params&&Array.isArray(p.params)&&p.params.forEach((Z,G)=>{m[`param_${G}`]=Z});const h={};p.styles&&Array.isArray(p.styles)?p.styles.forEach((Z,G)=>{h[`style_${G}`]=Z}):p.styles&&typeof p.styles=="object"&&Object.assign(h,p.styles);const _={id:d,type:p.name,params:m,styles:h,paneId:p.pane_id,visible:!0,...Object.fromEntries(Object.entries(p).filter(([Z])=>!["name","pane_id","params","styles"].includes(Z)))};if(_.type==="RSI"){const Z=_;if(!Z.rsiGroups||Z.rsiGroups.length===0){const G=_.paneId||"pane_RSI",se=Pm.getInstance(G)||Pm.getInstanceConfig(G);if(se){const Y=se.overboughtThreshold??((I=(P=(S=se.levels)==null?void 0:S.find)==null?void 0:P.call(S,re=>re.id==="overbought"))==null?void 0:I.value)??70,oe=((F=(M=(C=se.levels)==null?void 0:C.find)==null?void 0:M.call(C,re=>re.id==="middle"))==null?void 0:F.value)??50,ee=se.oversoldThreshold??((D=(j=(V=se.levels)==null?void 0:V.find)==null?void 0:j.call(V,re=>re.id==="oversold"))==null?void 0:D.value)??30;Z.rsiGroups=[{period:se.period??14,overboughtLevel:Y,middleLevel:oe,oversoldLevel:ee,styles:{rsi:{color:se.lineColor??"#8B5CF6",thickness:se.lineThickness??2,lineStyle:se.lineStyle??"solid"},overboughtColor:se.overboughtColor??"#EF4444",oversoldColor:se.oversoldColor??"#10B981",middleLineColor:((J=(W=(R=se.levels)==null?void 0:R.find)==null?void 0:W.call(R,re=>re.id==="middle"))==null?void 0:J.color)??"#6B7280"}}]}}}const w=`${p.name}_${p.pane_id||"candle_pane"}`;i.set(w,_)}),e)try{const d=((a=e.getIndicators)==null?void 0:a.call(e))??[];console.log("📊 Collecting indicators from chart:",d.length,"found"),d.forEach(p=>{if(!p.name)return;const m=p.paneId||"candle_pane",h=`${p.name}_${m}`;if(i.has(h)){console.log(`✅ Indicator ${p.name} (${m}) already in saveInds`);return}console.log(`⚠️ Indicator ${p.name} (${m}) on chart but not in saveInds`);let _=null,w=null;for(const[S,P]of Object.entries(n.saveInds))if(P.name===p.name&&(P.pane_id===m||!P.pane_id&&m==="candle_pane")){_=P,w=S;break}if(_&&w){console.log(`✅ Found matching saveInd for ${p.name} with key: ${w}`);const S={};_.params&&Array.isArray(_.params)&&_.params.forEach((C,M)=>{S[`param_${M}`]=C});const P={};_.styles&&Array.isArray(_.styles)?_.styles.forEach((C,M)=>{P[`style_${M}`]=C}):_.styles&&typeof _.styles=="object"&&Object.assign(P,_.styles);const I={id:w,type:_.name,params:S,styles:P,paneId:_.pane_id||m,visible:!0,...Object.fromEntries(Object.entries(_).filter(([C])=>!["name","pane_id","params","styles"].includes(C)))};i.set(h,I)}else{if(p.name==="RSI"){console.log(`♻️ Skipping fallback SavedIndicator creation for RSI on pane ${m} (no matching saveInd)`);return}console.log(`⚠️ No matching saveInd found for ${p.name}, creating basic entry`);const P={id:`${m}_${p.name}`,type:p.name,params:{},styles:{},paneId:m,visible:!0};i.set(h,P)}})}catch(d){console.warn("⚠️ Failed to get indicators from chart, using saveInds only:",d)}return o.push(...Array.from(i.values())),console.log(`✅ Collected ${o.length} indicators for saving (${Object.keys(n.saveInds).length} from saveInds, ${o.length-Object.keys(n.saveInds).length} from chart)`),{timezone:n.timezone,interval:n.period.timeframe,chartType:((c=(l=n.styles)==null?void 0:l.candle)==null?void 0:c.type)||"candle_solid",theme:n.theme,panes:t,indicators:o,styles:n.styles||{},options:n.options||{}}}async function mT(n,e,t){var o,i,r,a,l,c,d,p,m,h,_,w,S,P,I,C,M,F,V,j,D,R,W,J,Z,G,se,Y,oe,ee,re,me,K,ye;try{if(console.log("🔄 Applying global state:",n),t){try{t.removeIndicator({}),console.log("🧹 Removed all existing indicators before applying new layout")}catch(ct){console.warn("Failed to clear existing indicators before applying layout:",ct)}try{const{RSIManager:ct}=await im(async()=>{const{RSIManager:kt}=await Promise.resolve().then(()=>db);return{RSIManager:kt}},void 0,import.meta.url);ct.clearAllInstances()}catch{}}const Me={},Fe=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"],Ze=(o=tv(Fm))==null?void 0:o.data,Ge=Ze&&(Ze.isPremium===!0||Ze.isTrial===!0),it=[],Ye=new Set;if(n.indicators.forEach(ct=>{if(ct.type==="RSI"){const kt=ct.rsiGroups,ft=Array.isArray(kt)&&kt.length>0&&(kt[0].actualPaneId||kt[0].paneId)||ct.paneId;if(ft){if(Ye.has(ft)){console.log("♻️ Skipping duplicate RSI indicator for pane:",ft);return}Ye.add(ft),ct.paneId=ft,ct.id=`${ft}_RSI`,Array.isArray(kt)&&kt.length>0&&(kt[0].paneId=ft,kt[0].actualPaneId=ft)}}it.push(ct)}),it.forEach(ct=>{if(!Ge&&ct.type&&Fe.includes(ct.type)){console.log(`🔒 Skipping AI indicator ${ct.type} - user does not have premium access`);return}const kt=[];ct.params&&typeof ct.params=="object"&&Object.entries(ct.params).forEach(([nt,Pt])=>{if(nt.startsWith("param_")){const Qe=parseInt(nt.replace("param_",""));kt[Qe]=Pt}});const ft=[];ct.styles&&typeof ct.styles=="object"&&Object.entries(ct.styles).forEach(([nt,Pt])=>{if(nt.startsWith("style_")&&typeof Pt=="object"){const Qe=parseInt(nt.replace("style_",""));ft[Qe]=Pt}});const bt={name:ct.type,pane_id:ct.paneId,params:kt.length>0?kt:void 0,styles:ft.length>0?ft:void 0,...Object.fromEntries(Object.entries(ct).filter(([nt])=>!["id","type","paneId","params","styles","visible"].includes(nt)))};Me[ct.id]=bt}),e.update(ct=>{ct.timezone=n.timezone,ct.period={...ct.period,timeframe:n.interval};const kt=n.styles&&typeof n.styles=="object"?{...n.styles}:{},ft=ct.theme||n.theme||"dark";if((n.theme||ft)!==ft)try{const nt=wu(ft),Pt=Mn.merge({},nt,kt);delete Pt.backgroundColor,delete Pt.backgroundOpacity,delete Pt.backgroundType,delete Pt.backgroundGradient,delete Pt.gridColor,delete Pt.gridOpacity,delete Pt.gridType,delete Pt.gridGradient,ct.styles=Pt}catch{ct.styles=kt}else ct.styles=kt;return ct.styles.candle||(ct.styles.candle={}),ct.styles.candle.type=n.chartType,ct.options=n.options&&typeof n.options=="object"?{...n.options}:{},ct.saveInds=Me,ct}),t)try{const ct=tv(e);t.setStyles&&ct.styles&&(t.setStyles(ct.styles),console.log("🎨 Applied saved styles to chart"))}catch(ct){console.warn("Failed to apply saved styles to chart:",ct)}if(t&&it.length>0){console.log("Creating indicators on chart:",it.length);for(const ct of it)try{const kt=[];ct.params&&typeof ct.params=="object"&&Object.entries(ct.params).forEach(([Qe,yt])=>{if(Qe.startsWith("param_")){const xe=parseInt(Qe.replace("param_",""));kt[xe]=yt}});const ft=[];ct.styles&&typeof ct.styles=="object"&&Object.entries(ct.styles).forEach(([Qe,yt])=>{if(Qe.startsWith("style_")&&typeof yt=="object"){const xe=parseInt(Qe.replace("style_",""));ft[xe]=yt}});const bt={name:ct.type,calcParams:kt.length>0?kt:void 0,visible:ct.visible!==!1};if(ft.length>0&&(bt.styles={lines:ft.map(Qe=>{const yt=Qe.lineStyle==="dashed"||Qe.lineStyle==="dotted",xe=Qe.lineStyle==="dotted"?[2,2]:[4,4];return{color:Qe.color,size:Qe.thickness??1,style:yt?Ke.Dashed:Ke.Solid,dashedValue:yt?xe:[2,2]}})}),ct.type==="SMARTTREND"){const Qe=ct.superTrendGroup,yt=Qe?{showLabels:!!Qe.showLabels,uptrendColor:((r=(i=Qe.styles)==null?void 0:i.uptrend)==null?void 0:r.color)??"#00FF00",downtrendColor:((l=(a=Qe.styles)==null?void 0:a.downtrend)==null?void 0:l.color)??"#FF0000",uptrendThickness:((d=(c=Qe.styles)==null?void 0:c.uptrend)==null?void 0:d.thickness)??1,downtrendThickness:((m=(p=Qe.styles)==null?void 0:p.downtrend)==null?void 0:m.thickness)??1,uptrendLineStyle:((_=(h=Qe.styles)==null?void 0:h.uptrend)==null?void 0:_.lineStyle)??"dashed",downtrendLineStyle:((S=(w=Qe.styles)==null?void 0:w.downtrend)==null?void 0:S.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"};if(bt.extendData=yt,!bt.styles){const xe=yt.uptrendLineStyle==="dotted"||yt.uptrendLineStyle==="dashed";bt.styles={lines:[{color:yt.uptrendColor,size:yt.uptrendThickness,style:xe?Ke.Dashed:Ke.Solid,dashedValue:yt.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}if(ct.type==="RSI"){const Qe=ct.rsiGroups||[],yt=ct.paneId;if(Array.isArray(Qe)&&Qe.length>0){const xe=Qe[0],Ve=((P=xe.styles)==null?void 0:P.overboughtColor)??"#EF4444",Je=((I=xe.styles)==null?void 0:I.oversoldColor)??"#22C55E",St=((C=xe.styles)==null?void 0:C.middleLineColor)??"#6B7280",Ne=xe.fillOpacity??.15,ue=((M=xe.styles)==null?void 0:M.overboughtThickness)??1,he=((F=xe.styles)==null?void 0:F.oversoldThickness)??1,_t=((V=xe.styles)==null?void 0:V.middleLineThickness)??1,Wt=((j=xe.styles)==null?void 0:j.overboughtLineStyle)??"dashed",jt=((D=xe.styles)==null?void 0:D.oversoldLineStyle)??"dashed",Zt=((R=xe.styles)==null?void 0:R.middleLineStyle)??"dashed",dn={id:yt,period:xe.period??14,lineColor:((J=(W=xe.styles)==null?void 0:W.rsi)==null?void 0:J.color)??"#8B5CF6",lineThickness:((G=(Z=xe.styles)==null?void 0:Z.rsi)==null?void 0:G.thickness)??2,lineStyle:((Y=(se=xe.styles)==null?void 0:se.rsi)==null?void 0:Y.lineStyle)??"solid",overboughtLevel:xe.overboughtLevel??70,oversoldLevel:xe.oversoldLevel??30,middleLevel:xe.middleLevel??50,overboughtColor:Ve,overboughtThickness:ue,overboughtLineStyle:Wt,oversoldColor:Je,oversoldThickness:he,oversoldLineStyle:jt,overboughtFillColor:Ve,oversoldFillColor:Je,middleLineColor:St,middleLineThickness:_t,middleLineStyle:Zt,fillOpacity:Ne,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:xe.overboughtLevel??70,color:Ve,lineStyle:Wt,thickness:ue,label:String(xe.overboughtLevel??70),visible:!0},{id:"middle",value:xe.middleLevel??50,color:St,lineStyle:Zt,thickness:_t,label:String(xe.middleLevel??50),visible:!0},{id:"oversold",value:xe.oversoldLevel??30,color:Je,lineStyle:jt,thickness:he,label:String(xe.oversoldLevel??30),visible:!0}]};try{const{RSIManager:On}=await im(async()=>{const{RSIManager:no}=await Promise.resolve().then(()=>db);return{RSIManager:no}},void 0,import.meta.url);On.importInstanceConfig(dn)}catch{}bt.calcParams=[xe.period??14];const zn={color:((ee=(oe=xe.styles)==null?void 0:oe.rsi)==null?void 0:ee.color)??"#8B5CF6",size:((me=(re=xe.styles)==null?void 0:re.rsi)==null?void 0:me.thickness)??2,style:Ke.Solid,dashedValue:[2,2]},un=(ye=(K=xe.styles)==null?void 0:K.rsi)==null?void 0:ye.lineStyle;un==="dashed"?(zn.style=Ke.Dashed,zn.dashedValue=[6,4]):un==="dotted"&&(zn.style=Ke.Dashed,zn.dashedValue=[2,2]),bt.styles={lines:[zn]}}}const nt=ct.paneId==="candle_pane",Pt=t.createIndicator(bt,nt,{id:ct.paneId});console.log(`Created indicator ${ct.type} with ID:`,Pt)}catch(kt){console.error(`Failed to create indicator ${ct.type}:`,kt)}}console.log("Applied global state:",{timezone:n.timezone,interval:n.interval,chartType:n.chartType,theme:n.theme,indicatorCount:it.length,indicatorsCreated:t?it.length:0})}catch(Me){throw console.error("Error applying global state:",Me),Me}}function Sb(n){return ig(n.symbol)}class gT{constructor(e){Ce(this,"chart");Ce(this,"persistenceKey");Ce(this,"currentSymbol",null);Ce(this,"ephemeralMode",!0);Ce(this,"drawingsBySymbol",new Map);Ce(this,"renderedDrawingIds",new Set);Ce(this,"onDrawingCreated");Ce(this,"onDrawingRemoved");Ce(this,"onSymbolChanged");Ce(this,"symbolChangeCallbacks",new Set);this.chart=e.chart,this.persistenceKey=e.persistenceKey,this.onDrawingCreated=e.onDrawingCreated,this.onDrawingRemoved=e.onDrawingRemoved,this.onSymbolChanged=e.onSymbolChanged,this.ephemeralMode||this.loadFromStorage(),console.log("✅ DrawingManager initialized with key:",this.persistenceKey)}setCurrentSymbol(e){var i;const t=typeof e=="string"?e:ig(e);if(this.currentSymbol===t){console.log("🔄 Symbol unchanged, skipping reload:",t);return}const o=this.currentSymbol;this.currentSymbol=t,console.log(`🔄 Symbol changed: ${o} → ${t}`),this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol(),o&&((i=this.onSymbolChanged)==null||i.call(this,o,t),this.symbolChangeCallbacks.forEach(r=>r(t)))}getCurrentSymbol(){return this.currentSymbol}addDrawing(e){var i;if(!e.symbolKey)throw console.error("❌ Cannot add drawing without symbolKey:",e),new Error("Drawing must have a symbolKey");let t=this.drawingsBySymbol.get(e.symbolKey);t||(t=[],this.drawingsBySymbol.set(e.symbolKey,t));const o=t.findIndex(r=>r.id===e.id);o>=0?(t[o]=e,console.log("🔄 Updated drawing:",e.id,"for symbol:",e.symbolKey)):(t.push(e),console.log("➕ Added drawing:",e.id,"for symbol:",e.symbolKey)),this.saveToStorage(),e.symbolKey===this.currentSymbol&&e.visible!==!1&&this.renderDrawing(e),(i=this.onDrawingCreated)==null||i.call(this,e)}removeDrawing(e){var i,r;let t=!1,o=null;for(const[a,l]of this.drawingsBySymbol.entries()){const c=l.findIndex(d=>d.id===e);if(c>=0){l.splice(c,1),t=!0,o=a,console.log("🗑️ Removed drawing:",e,"from symbol:",a);break}}return t&&(o&&((i=this.drawingsBySymbol.get(o))==null?void 0:i.length)===0&&this.drawingsBySymbol.delete(o),this.saveToStorage(),this.renderedDrawingIds.has(e)&&(this.chart.removeOverlay({id:e}),this.renderedDrawingIds.delete(e)),o&&((r=this.onDrawingRemoved)==null||r.call(this,e,o))),t}removeDrawingForSymbol(e,t){var r;const o=this.drawingsBySymbol.get(t);if(!o)return!1;const i=o.findIndex(a=>a.id===e);return i<0?!1:(o.splice(i,1),o.length===0&&this.drawingsBySymbol.delete(t),this.saveToStorage(),this.renderedDrawingIds.has(e)&&(this.chart.removeOverlay({id:e}),this.renderedDrawingIds.delete(e)),(r=this.onDrawingRemoved)==null||r.call(this,e,t),!0)}getDrawingsForSymbol(e){return this.drawingsBySymbol.get(e)||[]}getCurrentSymbolDrawings(){return this.currentSymbol?this.getDrawingsForSymbol(this.currentSymbol):[]}getAllDrawings(){return new Map(this.drawingsBySymbol)}clearDrawingsForSymbol(e){const t=this.drawingsBySymbol.get(e);t&&(e===this.currentSymbol&&t.forEach(o=>{this.renderedDrawingIds.has(o.id)&&(this.chart.removeOverlay({id:o.id}),this.renderedDrawingIds.delete(o.id))}),this.drawingsBySymbol.delete(e),this.saveToStorage(),console.log("🗑️ Cleared all drawings for symbol:",e))}clearCurrentSymbolDrawings(){this.currentSymbol&&this.clearDrawingsForSymbol(this.currentSymbol)}clearRenderedDrawings(){this.renderedDrawingIds.forEach(e=>{try{this.chart.removeOverlay({id:e})}catch(t){console.warn("Failed to remove overlay:",e,t)}}),this.renderedDrawingIds.clear(),console.log("🧹 Cleared rendered drawings from chart")}hideRenderedDrawings(){this.clearRenderedDrawings()}renderDrawingsForCurrentSymbol(){if(!this.currentSymbol){console.log("⚠️ No current symbol, skipping render");return}const e=this.getDrawingsForSymbol(this.currentSymbol);console.log(`🎨 Rendering ${e.length} drawings for symbol:`,this.currentSymbol),e.forEach(t=>{t.visible!==!1&&this.renderDrawing(t)})}renderCurrentSymbolDrawings(){this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()}renderDrawing(e){if(e.symbolKey!==this.currentSymbol){console.warn("⛔ Drawing symbolKey mismatch, skipping render:",{drawingSymbol:e.symbolKey,currentSymbol:this.currentSymbol});return}try{const t={id:e.id,groupId:"drawing_tools",name:e.type,points:e.points.map(i=>({timestamp:i.time,value:i.price,t:i.time,p:i.price})),styles:e.styles,lock:e.locked,visible:e.visible,onSelected:i=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalSelectOverlay&&r.externalSelectOverlay(i.overlay)}catch{}return!0},onDeselected:i=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalDeselectOverlay&&r.externalDeselectOverlay(i.overlay)}catch{}return!0},onPressedMoveEnd:i=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalSyncOverlay&&r.externalSyncOverlay(i.overlay)}catch{}return!0},onRemoved:i=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalRemoved&&r.externalRemoved(i.overlay.id)}catch{}return!0},...Object.fromEntries(Object.entries(e).filter(([i])=>!["id","symbolKey","type","points","styles","locked","visible","seriesId"].includes(i)))};this.chart.createOverlay(t)&&(this.renderedDrawingIds.add(e.id),console.log("✅ Rendered drawing:",e.id,"for symbol:",e.symbolKey))}catch(t){console.error("❌ Failed to render drawing:",e.id,t)}}updateDrawing(e,t){for(const[o,i]of this.drawingsBySymbol.entries()){const r=i.findIndex(a=>a.id===e);if(r>=0){const a=i[r];return i[r]={...a,...t,symbolKey:a.symbolKey},this.saveToStorage(),console.log("🔄 Updated drawing:",e),!0}}return!1}loadDrawingsForSymbol(e,t){const o=t.filter(i=>i.symbolKey!==e?(console.warn("⚠️ Drawing symbolKey mismatch during bulk load:",{expected:e,actual:i.symbolKey,drawingId:i.id}),!1):!0);this.drawingsBySymbol.set(e,o),this.saveToStorage(),e===this.currentSymbol&&(this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()),console.log(`📥 Loaded ${o.length} drawings for symbol:`,e)}loadAllDrawings(e){this.drawingsBySymbol.clear(),Object.entries(e).forEach(([t,o])=>{const i=o.filter(r=>(r.symbolKey||(console.warn("⚠️ Drawing missing symbolKey, assigning:",t),r.symbolKey=t),!0));this.drawingsBySymbol.set(t,i)}),this.saveToStorage(),this.currentSymbol&&(this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()),console.log("📥 Loaded drawings for",this.drawingsBySymbol.size,"symbols")}saveToStorage(){if(!this.ephemeralMode)try{const e={drawingsBySymbol:Object.fromEntries(this.drawingsBySymbol),version:1};localStorage.setItem(this.persistenceKey,JSON.stringify(e))}catch(e){console.error("❌ Failed to save drawings to storage:",e)}}clearPersistedStorage(){try{localStorage.removeItem(this.persistenceKey),console.log("🧹 Cleared persisted drawing storage for key:",this.persistenceKey)}catch(e){console.warn("Failed to clear persisted drawing storage:",e)}}loadFromStorage(){if(!this.ephemeralMode)try{const e=localStorage.getItem(this.persistenceKey);if(!e){console.log("📭 No stored drawings found");return}const t=JSON.parse(e);if(!t.version){console.log("🔄 Migrating legacy drawing storage..."),this.migrateLegacyStorage(t);return}Object.entries(t.drawingsBySymbol||{}).forEach(([o,i])=>{const r=i.map(a=>(a.symbolKey||(a.symbolKey=o),a));this.drawingsBySymbol.set(o,r)}),console.log("📂 Loaded drawings from storage:",this.drawingsBySymbol.size,"symbols")}catch(e){console.error("❌ Failed to load drawings from storage:",e),this.drawingsBySymbol.clear()}}migrateLegacyStorage(e){if(console.log("🔄 Starting migration of legacy overlay format..."),typeof e=="object"&&!e.drawingsBySymbol){const t={};Object.entries(e).forEach(([o,i])=>{try{const r=o.split("_");if(r.length<3){console.warn("⚠️ Invalid legacy key format:",o);return}const a=r[r.length-1],l=r[r.length-2],d=r.slice(0,-2).join("_").toUpperCase(),p=this.convertLegacyOverlayToDrawing(a,i,d);p&&(t[d]||(t[d]=[]),t[d].push(p))}catch(r){console.warn("⚠️ Failed to migrate legacy overlay:",o,r)}}),Object.entries(t).forEach(([o,i])=>{this.drawingsBySymbol.set(o,i)}),this.saveToStorage(),console.log("✅ Migration complete:",this.drawingsBySymbol.size,"symbols migrated")}}convertLegacyOverlayToDrawing(e,t,o){try{const i=[];return t.points&&Array.isArray(t.points)&&t.points.forEach(r=>{r&&typeof r=="object"&&(r.timestamp&&r.value!==void 0?i.push({time:r.timestamp,price:r.value}):r.time&&r.price!==void 0?i.push({time:r.time,price:r.price}):r.t&&r.p!==void 0&&i.push({time:r.t,price:r.p}))}),i.length===0?(console.warn("Legacy overlay has no valid data coordinates:",e),null):{id:e,symbolKey:o,type:t.name||"unknown",points:i,styles:t.styles||{},locked:!!t.lock,visible:t.visible!==!1,...Object.fromEntries(Object.entries(t).filter(([r])=>!["name","points","styles","lock","visible"].includes(r)))}}catch(i){return console.warn("Error converting legacy overlay to drawing:",e,i),null}}onSymbolChange(e){this.symbolChangeCallbacks.add(e)}offSymbolChange(e){this.symbolChangeCallbacks.delete(e)}exportDrawings(){return Object.fromEntries(this.drawingsBySymbol)}getStats(){let e=0;return this.drawingsBySymbol.forEach(t=>{e+=t.length}),{totalSymbols:this.drawingsBySymbol.size,totalDrawings:e,currentSymbolDrawings:this.getCurrentSymbolDrawings().length,renderedDrawings:this.renderedDrawingIds.size}}destroy(){this.clearRenderedDrawings(),this.symbolChangeCallbacks.clear(),this.drawingsBySymbol.clear(),console.log("🗑️ DrawingManager destroyed")}}let jh=null;function hT(n){return jh&&(console.warn("⚠️ DrawingManager already initialized, destroying old instance"),jh.destroy()),jh=new gT(n),jh}function cm(){return jh}class _T{constructor(){Ce(this,"state",zp({undoStack:[],redoStack:[],maxHistorySize:50}));Ce(this,"chart",null);Ce(this,"saveStore",null);Ce(this,"overlaysStore",null)}init({chart:e,saveStore:t,overlaysStore:o}){this.chart=e,this.saveStore=t,this.overlaysStore=o}addAction(e){this.state.update(t=>(t.redoStack=[],t.undoStack.push(e),t.undoStack.length>t.maxHistorySize&&t.undoStack.shift(),t))}recordAddIndicator(e,t,o,i){const r={type:"ADD_INDICATOR",data:{name:e,paneId:t,params:o,saveKey:i},timestamp:Date.now(),id:`indicator_${e}_${t}_${Date.now()}`};this.addAction(r)}recordRemoveIndicator(e,t,o,i){const r={type:"REMOVE_INDICATOR",data:{name:e,paneId:t,params:o,saveKey:i},timestamp:Date.now(),id:`indicator_${e}_${t}_${Date.now()}`};this.addAction(r)}recordAddOverlay(e,t,o){const i={type:"ADD_OVERLAY",data:{overlayId:e,overlayData:t,overlayKey:o},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(i)}recordRemoveOverlay(e,t,o){const i={type:"REMOVE_OVERLAY",data:{overlayId:e,overlayData:t,overlayKey:o},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(i)}recordModifyOverlay(e,t,o,i){const r={type:"MODIFY_OVERLAY",data:{overlayId:e,prevData:t,nextData:o,overlayKey:i},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(r)}undo(){const e=tv(this.state);if(e.undoStack.length===0)return!1;const t=e.undoStack[e.undoStack.length-1],o=this.executeUndo(t);return o&&this.state.update(i=>{const r=i.undoStack.pop();return r&&i.redoStack.push(r),i}),o}redo(){const e=tv(this.state);if(e.redoStack.length===0)return!1;const t=e.redoStack[e.redoStack.length-1],o=this.executeRedo(t);return o&&this.state.update(i=>{const r=i.redoStack.pop();return r&&i.undoStack.push(r),i}),o}executeUndo(e){var t,o,i,r,a;if(!this.chart)return!1;try{switch(e.type){case"ADD_INDICATOR":this.chart.removeIndicator({paneId:e.data.paneId,name:e.data.name}),this.saveStore&&this.saveStore.update(d=>(delete d.saveInds[e.data.saveKey],d));break;case"REMOVE_INDICATOR":const l=this.chart.createIndicator({name:e.data.name,calcParams:e.data.params},!1,{id:e.data.paneId});this.saveStore&&l&&this.saveStore.update(d=>(d.saveInds[e.data.saveKey]={name:e.data.name,pane_id:e.data.paneId,params:e.data.params},d));break;case"ADD_OVERLAY":this.chart.removeOverlay({id:e.data.overlayId}),this.overlaysStore&&this.overlaysStore.update(d=>(delete d[e.data.overlayKey],d));try{const d=cm();d&&d.removeDrawing(e.data.overlayId)}catch{}break;case"REMOVE_OVERLAY":const c=this.chart.createOverlay(e.data.overlayData);this.overlaysStore&&c&&this.overlaysStore.update(d=>(d[e.data.overlayKey]=e.data.overlayData,d));try{const d=cm();if(d){const p=tv(this.saveStore),m=ig(p.symbol),h=e.data.overlayData,_=Array.isArray(h==null?void 0:h.points)?h.points.map(w=>({time:(w==null?void 0:w.timestamp)??(w==null?void 0:w.t)??0,price:(w==null?void 0:w.value)??(w==null?void 0:w.p)??0})):[];if(_.length>0){const w={id:e.data.overlayId,symbolKey:m,type:(h==null?void 0:h.name)||"unknown",points:_,styles:(h==null?void 0:h.styles)||{},...h!=null&&h.extendData?{extendData:h.extendData}:{},locked:!!(h!=null&&h.lock),visible:(h==null?void 0:h.visible)!==!1};d.addDrawing(w)}}}catch{}break;case"MODIFY_OVERLAY":this.chart.overrideOverlay({id:e.data.overlayId,styles:(t=e.data.prevData)==null?void 0:t.styles,extendData:(o=e.data.prevData)==null?void 0:o.extendData,points:(i=e.data.prevData)==null?void 0:i.points,lock:(r=e.data.prevData)==null?void 0:r.lock,visible:(a=e.data.prevData)==null?void 0:a.visible}),this.overlaysStore&&this.overlaysStore.update(d=>(d[e.data.overlayKey]=e.data.prevData,d));try{const d=cm();if(d){const p=e.data.prevData,m=Array.isArray(p==null?void 0:p.points)?p.points.map(h=>({time:(h==null?void 0:h.timestamp)??(h==null?void 0:h.t)??0,price:(h==null?void 0:h.value)??(h==null?void 0:h.p)??0})):[];d.updateDrawing(e.data.overlayId,{points:m,styles:(p==null?void 0:p.styles)||{},extendData:p==null?void 0:p.extendData,locked:!!(p!=null&&p.lock),visible:(p==null?void 0:p.visible)!==!1})}}catch{}break;default:return!1}return!0}catch(l){return console.error("Error executing undo:",l),!1}}executeRedo(e){var t,o,i,r,a;if(!this.chart)return!1;try{switch(e.type){case"ADD_INDICATOR":const l=this.chart.createIndicator({name:e.data.name,calcParams:e.data.params},!1,{id:e.data.paneId});this.saveStore&&l&&this.saveStore.update(d=>(d.saveInds[e.data.saveKey]={name:e.data.name,pane_id:e.data.paneId,params:e.data.params},d));break;case"REMOVE_INDICATOR":this.chart.removeIndicator({paneId:e.data.paneId,name:e.data.name}),this.saveStore&&this.saveStore.update(d=>(delete d.saveInds[e.data.saveKey],d));break;case"ADD_OVERLAY":const c=this.chart.createOverlay(e.data.overlayData);this.overlaysStore&&c&&this.overlaysStore.update(d=>(d[e.data.overlayKey]=e.data.overlayData,d));try{const d=cm();if(d){const p=tv(this.saveStore),m=ig(p.symbol),h=e.data.overlayData,_=Array.isArray(h==null?void 0:h.points)?h.points.map(w=>({time:(w==null?void 0:w.timestamp)??(w==null?void 0:w.t)??0,price:(w==null?void 0:w.value)??(w==null?void 0:w.p)??0})):[];if(_.length>0){const w={id:e.data.overlayId,symbolKey:m,type:(h==null?void 0:h.name)||"unknown",points:_,styles:(h==null?void 0:h.styles)||{},...h!=null&&h.extendData?{extendData:h.extendData}:{},locked:!!(h!=null&&h.lock),visible:(h==null?void 0:h.visible)!==!1};d.addDrawing(w)}}}catch{}break;case"REMOVE_OVERLAY":this.chart.removeOverlay({id:e.data.overlayId}),this.overlaysStore&&this.overlaysStore.update(d=>(delete d[e.data.overlayKey],d));try{const d=cm();d&&d.removeDrawing(e.data.overlayId)}catch{}break;case"MODIFY_OVERLAY":this.chart.overrideOverlay({id:e.data.overlayId,styles:(t=e.data.nextData)==null?void 0:t.styles,extendData:(o=e.data.nextData)==null?void 0:o.extendData,points:(i=e.data.nextData)==null?void 0:i.points,lock:(r=e.data.nextData)==null?void 0:r.lock,visible:(a=e.data.nextData)==null?void 0:a.visible}),this.overlaysStore&&this.overlaysStore.update(d=>(d[e.data.overlayKey]=e.data.nextData,d));try{const d=cm();if(d){const p=e.data.nextData,m=Array.isArray(p==null?void 0:p.points)?p.points.map(h=>({time:(h==null?void 0:h.timestamp)??(h==null?void 0:h.t)??0,price:(h==null?void 0:h.value)??(h==null?void 0:h.p)??0})):[];d.updateDrawing(e.data.overlayId,{points:m,styles:(p==null?void 0:p.styles)||{},extendData:p==null?void 0:p.extendData,locked:!!(p!=null&&p.lock),visible:(p==null?void 0:p.visible)!==!1})}}catch{}break;default:return!1}return!0}catch(l){return console.error("Error executing redo:",l),!1}}canUndo(){return tv(this.state).undoStack.length>0}canRedo(){return tv(this.state).redoStack.length>0}getState(){return this.state}clearHistory(){this.state.update(e=>({...e,undoStack:[],redoStack:[]}))}}const op=new _T,yT={"😀":{name:"grinning face",slug:"grinning_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😃":{name:"grinning face with big eyes",slug:"grinning_face_with_big_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😄":{name:"grinning face with smiling eyes",slug:"grinning_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😁":{name:"beaming face with smiling eyes",slug:"beaming_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😆":{name:"grinning squinting face",slug:"grinning_squinting_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😅":{name:"grinning face with sweat",slug:"grinning_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤣":{name:"rolling on the floor laughing",slug:"rolling_on_the_floor_laughing",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"😂":{name:"face with tears of joy",slug:"face_with_tears_of_joy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙂":{name:"slightly smiling face",slug:"slightly_smiling_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🙃":{name:"upside-down face",slug:"upside_down_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫠":{name:"melting face",slug:"melting_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😉":{name:"winking face",slug:"winking_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😊":{name:"smiling face with smiling eyes",slug:"smiling_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😇":{name:"smiling face with halo",slug:"smiling_face_with_halo",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥰":{name:"smiling face with hearts",slug:"smiling_face_with_hearts",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"😍":{name:"smiling face with heart-eyes",slug:"smiling_face_with_heart_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤩":{name:"star-struck",slug:"star_struck",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😘":{name:"face blowing a kiss",slug:"face_blowing_a_kiss",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😗":{name:"kissing face",slug:"kissing_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☺️":{name:"smiling face",slug:"smiling_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😚":{name:"kissing face with closed eyes",slug:"kissing_face_with_closed_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😙":{name:"kissing face with smiling eyes",slug:"kissing_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥲":{name:"smiling face with tear",slug:"smiling_face_with_tear",group:"Smileys & Emotion",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"😋":{name:"face savoring food",slug:"face_savoring_food",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😛":{name:"face with tongue",slug:"face_with_tongue",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😜":{name:"winking face with tongue",slug:"winking_face_with_tongue",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤪":{name:"zany face",slug:"zany_face",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😝":{name:"squinting face with tongue",slug:"squinting_face_with_tongue",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤑":{name:"money-mouth face",slug:"money_mouth_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤗":{name:"smiling face with open hands",slug:"smiling_face_with_open_hands",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤭":{name:"face with hand over mouth",slug:"face_with_hand_over_mouth",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🫢":{name:"face with open eyes and hand over mouth",slug:"face_with_open_eyes_and_hand_over_mouth",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🫣":{name:"face with peeking eye",slug:"face_with_peeking_eye",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🤫":{name:"shushing face",slug:"shushing_face",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤔":{name:"thinking face",slug:"thinking_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫡":{name:"saluting face",slug:"saluting_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🤐":{name:"zipper-mouth face",slug:"zipper_mouth_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤨":{name:"face with raised eyebrow",slug:"face_with_raised_eyebrow",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😐":{name:"neutral face",slug:"neutral_face",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"😑":{name:"expressionless face",slug:"expressionless_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😶":{name:"face without mouth",slug:"face_without_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫥":{name:"dotted line face",slug:"dotted_line_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😶‍🌫️":{name:"face in clouds",slug:"face_in_clouds",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"😏":{name:"smirking face",slug:"smirking_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😒":{name:"unamused face",slug:"unamused_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙄":{name:"face with rolling eyes",slug:"face_with_rolling_eyes",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😬":{name:"grimacing face",slug:"grimacing_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😮‍💨":{name:"face exhaling",slug:"face_exhaling",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"🤥":{name:"lying face",slug:"lying_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫨":{name:"shaking face",slug:"shaking_face",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🙂‍↔️":{name:"head shaking horizontally",slug:"head_shaking_horizontally",group:"Smileys & Emotion",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🙂‍↕️":{name:"head shaking vertically",slug:"head_shaking_vertically",group:"Smileys & Emotion",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"😌":{name:"relieved face",slug:"relieved_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😔":{name:"pensive face",slug:"pensive_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😪":{name:"sleepy face",slug:"sleepy_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤤":{name:"drooling face",slug:"drooling_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"😴":{name:"sleeping face",slug:"sleeping_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫩":{name:"face with bags under eyes",slug:"face_with_bags_under_eyes",group:"Smileys & Emotion",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"😷":{name:"face with medical mask",slug:"face_with_medical_mask",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤒":{name:"face with thermometer",slug:"face_with_thermometer",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤕":{name:"face with head-bandage",slug:"face_with_head_bandage",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤢":{name:"nauseated face",slug:"nauseated_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🤮":{name:"face vomiting",slug:"face_vomiting",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤧":{name:"sneezing face",slug:"sneezing_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥵":{name:"hot face",slug:"hot_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥶":{name:"cold face",slug:"cold_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥴":{name:"woozy face",slug:"woozy_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"😵":{name:"face with crossed-out eyes",slug:"face_with_crossed_out_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😵‍💫":{name:"face with spiral eyes",slug:"face_with_spiral_eyes",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"🤯":{name:"exploding head",slug:"exploding_head",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤠":{name:"cowboy hat face",slug:"cowboy_hat_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥳":{name:"partying face",slug:"partying_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥸":{name:"disguised face",slug:"disguised_face",group:"Smileys & Emotion",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"😎":{name:"smiling face with sunglasses",slug:"smiling_face_with_sunglasses",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤓":{name:"nerd face",slug:"nerd_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧐":{name:"face with monocle",slug:"face_with_monocle",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😕":{name:"confused face",slug:"confused_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫤":{name:"face with diagonal mouth",slug:"face_with_diagonal_mouth",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😟":{name:"worried face",slug:"worried_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🙁":{name:"slightly frowning face",slug:"slightly_frowning_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☹️":{name:"frowning face",slug:"frowning_face",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"😮":{name:"face with open mouth",slug:"face_with_open_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😯":{name:"hushed face",slug:"hushed_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😲":{name:"astonished face",slug:"astonished_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😳":{name:"flushed face",slug:"flushed_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥺":{name:"pleading face",slug:"pleading_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥹":{name:"face holding back tears",slug:"face_holding_back_tears",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😦":{name:"frowning face with open mouth",slug:"frowning_face_with_open_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😧":{name:"anguished face",slug:"anguished_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😨":{name:"fearful face",slug:"fearful_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😰":{name:"anxious face with sweat",slug:"anxious_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😥":{name:"sad but relieved face",slug:"sad_but_relieved_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😢":{name:"crying face",slug:"crying_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😭":{name:"loudly crying face",slug:"loudly_crying_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😱":{name:"face screaming in fear",slug:"face_screaming_in_fear",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😖":{name:"confounded face",slug:"confounded_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😣":{name:"persevering face",slug:"persevering_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😞":{name:"disappointed face",slug:"disappointed_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😓":{name:"downcast face with sweat",slug:"downcast_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😩":{name:"weary face",slug:"weary_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😫":{name:"tired face",slug:"tired_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥱":{name:"yawning face",slug:"yawning_face",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"😤":{name:"face with steam from nose",slug:"face_with_steam_from_nose",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😡":{name:"enraged face",slug:"enraged_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😠":{name:"angry face",slug:"angry_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤬":{name:"face with symbols on mouth",slug:"face_with_symbols_on_mouth",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😈":{name:"smiling face with horns",slug:"smiling_face_with_horns",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"👿":{name:"angry face with horns",slug:"angry_face_with_horns",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💀":{name:"skull",slug:"skull",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☠️":{name:"skull and crossbones",slug:"skull_and_crossbones",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💩":{name:"pile of poo",slug:"pile_of_poo",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤡":{name:"clown face",slug:"clown_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"👹":{name:"ogre",slug:"ogre",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👺":{name:"goblin",slug:"goblin",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👻":{name:"ghost",slug:"ghost",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👽":{name:"alien",slug:"alien",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👾":{name:"alien monster",slug:"alien_monster",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤖":{name:"robot",slug:"robot",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😺":{name:"grinning cat",slug:"grinning_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😸":{name:"grinning cat with smiling eyes",slug:"grinning_cat_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😹":{name:"cat with tears of joy",slug:"cat_with_tears_of_joy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😻":{name:"smiling cat with heart-eyes",slug:"smiling_cat_with_heart_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😼":{name:"cat with wry smile",slug:"cat_with_wry_smile",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😽":{name:"kissing cat",slug:"kissing_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙀":{name:"weary cat",slug:"weary_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😿":{name:"crying cat",slug:"crying_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😾":{name:"pouting cat",slug:"pouting_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙈":{name:"see-no-evil monkey",slug:"see_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙉":{name:"hear-no-evil monkey",slug:"hear_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙊":{name:"speak-no-evil monkey",slug:"speak_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💌":{name:"love letter",slug:"love_letter",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💘":{name:"heart with arrow",slug:"heart_with_arrow",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💝":{name:"heart with ribbon",slug:"heart_with_ribbon",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💖":{name:"sparkling heart",slug:"sparkling_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💗":{name:"growing heart",slug:"growing_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💓":{name:"beating heart",slug:"beating_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💞":{name:"revolving hearts",slug:"revolving_hearts",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💕":{name:"two hearts",slug:"two_hearts",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💟":{name:"heart decoration",slug:"heart_decoration",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❣️":{name:"heart exclamation",slug:"heart_exclamation",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💔":{name:"broken heart",slug:"broken_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❤️‍🔥":{name:"heart on fire",slug:"heart_on_fire",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"❤️‍🩹":{name:"mending heart",slug:"mending_heart",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"❤️":{name:"red heart",slug:"red_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩷":{name:"pink heart",slug:"pink_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🧡":{name:"orange heart",slug:"orange_heart",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"💛":{name:"yellow heart",slug:"yellow_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💚":{name:"green heart",slug:"green_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💙":{name:"blue heart",slug:"blue_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩵":{name:"light blue heart",slug:"light_blue_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"💜":{name:"purple heart",slug:"purple_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤎":{name:"brown heart",slug:"brown_heart",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🖤":{name:"black heart",slug:"black_heart",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🩶":{name:"grey heart",slug:"grey_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🤍":{name:"white heart",slug:"white_heart",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💋":{name:"kiss mark",slug:"kiss_mark",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💯":{name:"hundred points",slug:"hundred_points",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💢":{name:"anger symbol",slug:"anger_symbol",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💥":{name:"collision",slug:"collision",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💫":{name:"dizzy",slug:"dizzy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💦":{name:"sweat droplets",slug:"sweat_droplets",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💨":{name:"dashing away",slug:"dashing_away",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕳️":{name:"hole",slug:"hole",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💬":{name:"speech balloon",slug:"speech_balloon",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👁️‍🗨️":{name:"eye in speech bubble",slug:"eye_in_speech_bubble",group:"Smileys & Emotion",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🗨️":{name:"left speech bubble",slug:"left_speech_bubble",group:"Smileys & Emotion",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🗯️":{name:"right anger bubble",slug:"right_anger_bubble",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💭":{name:"thought balloon",slug:"thought_balloon",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💤":{name:"ZZZ",slug:"zzz",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👋":{name:"waving hand",slug:"waving_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤚":{name:"raised back of hand",slug:"raised_back_of_hand",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🖐️":{name:"hand with fingers splayed",slug:"hand_with_fingers_splayed",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✋":{name:"raised hand",slug:"raised_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🖖":{name:"vulcan salute",slug:"vulcan_salute",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫱":{name:"rightwards hand",slug:"rightwards_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫲":{name:"leftwards hand",slug:"leftwards_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫳":{name:"palm down hand",slug:"palm_down_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫴":{name:"palm up hand",slug:"palm_up_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫷":{name:"leftwards pushing hand",slug:"leftwards_pushing_hand",group:"People & Body",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!0,skin_tone_support_unicode_version:"15.0"},"🫸":{name:"rightwards pushing hand",slug:"rightwards_pushing_hand",group:"People & Body",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!0,skin_tone_support_unicode_version:"15.0"},"👌":{name:"OK hand",slug:"ok_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤌":{name:"pinched fingers",slug:"pinched_fingers",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤏":{name:"pinching hand",slug:"pinching_hand",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"✌️":{name:"victory hand",slug:"victory_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤞":{name:"crossed fingers",slug:"crossed_fingers",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🫰":{name:"hand with index finger and thumb crossed",slug:"hand_with_index_finger_and_thumb_crossed",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤟":{name:"love-you gesture",slug:"love_you_gesture",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤘":{name:"sign of the horns",slug:"sign_of_the_horns",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤙":{name:"call me hand",slug:"call_me_hand",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👈":{name:"backhand index pointing left",slug:"backhand_index_pointing_left",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👉":{name:"backhand index pointing right",slug:"backhand_index_pointing_right",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👆":{name:"backhand index pointing up",slug:"backhand_index_pointing_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🖕":{name:"middle finger",slug:"middle_finger",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👇":{name:"backhand index pointing down",slug:"backhand_index_pointing_down",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"☝️":{name:"index pointing up",slug:"index_pointing_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫵":{name:"index pointing at the viewer",slug:"index_pointing_at_the_viewer",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"👍":{name:"thumbs up",slug:"thumbs_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👎":{name:"thumbs down",slug:"thumbs_down",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✊":{name:"raised fist",slug:"raised_fist",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👊":{name:"oncoming fist",slug:"oncoming_fist",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤛":{name:"left-facing fist",slug:"left_facing_fist",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤜":{name:"right-facing fist",slug:"right_facing_fist",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👏":{name:"clapping hands",slug:"clapping_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙌":{name:"raising hands",slug:"raising_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫶":{name:"heart hands",slug:"heart_hands",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"👐":{name:"open hands",slug:"open_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤲":{name:"palms up together",slug:"palms_up_together",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤝":{name:"handshake",slug:"handshake",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🙏":{name:"folded hands",slug:"folded_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✍️":{name:"writing hand",slug:"writing_hand",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💅":{name:"nail polish",slug:"nail_polish",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤳":{name:"selfie",slug:"selfie",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"💪":{name:"flexed biceps",slug:"flexed_biceps",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🦾":{name:"mechanical arm",slug:"mechanical_arm",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦿":{name:"mechanical leg",slug:"mechanical_leg",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦵":{name:"leg",slug:"leg",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦶":{name:"foot",slug:"foot",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👂":{name:"ear",slug:"ear",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🦻":{name:"ear with hearing aid",slug:"ear_with_hearing_aid",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👃":{name:"nose",slug:"nose",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧠":{name:"brain",slug:"brain",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🫀":{name:"anatomical heart",slug:"anatomical_heart",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🫁":{name:"lungs",slug:"lungs",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦷":{name:"tooth",slug:"tooth",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦴":{name:"bone",slug:"bone",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"👀":{name:"eyes",slug:"eyes",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👁️":{name:"eye",slug:"eye",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"👅":{name:"tongue",slug:"tongue",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👄":{name:"mouth",slug:"mouth",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫦":{name:"biting lip",slug:"biting_lip",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"👶":{name:"baby",slug:"baby",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧒":{name:"child",slug:"child",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👦":{name:"boy",slug:"boy",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👧":{name:"girl",slug:"girl",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧑":{name:"person",slug:"person",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👱":{name:"person blond hair",slug:"person_blond_hair",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👨":{name:"man",slug:"man",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧔":{name:"person beard",slug:"person_beard",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧔‍♂️":{name:"man beard",slug:"man_beard",group:"People & Body",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"🧔‍♀️":{name:"woman beard",slug:"woman_beard",group:"People & Body",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍🦰":{name:"man red hair",slug:"man_red_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦱":{name:"man curly hair",slug:"man_curly_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦳":{name:"man white hair",slug:"man_white_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦲":{name:"man bald",slug:"man_bald",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👩":{name:"woman",slug:"woman",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👩‍🦰":{name:"woman red hair",slug:"woman_red_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦰":{name:"person red hair",slug:"person_red_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦱":{name:"woman curly hair",slug:"woman_curly_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦱":{name:"person curly hair",slug:"person_curly_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦳":{name:"woman white hair",slug:"woman_white_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦳":{name:"person white hair",slug:"person_white_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦲":{name:"woman bald",slug:"woman_bald",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦲":{name:"person bald",slug:"person_bald",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👱‍♀️":{name:"woman blond hair",slug:"woman_blond_hair",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👱‍♂️":{name:"man blond hair",slug:"man_blond_hair",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧓":{name:"older person",slug:"older_person",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👴":{name:"old man",slug:"old_man",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👵":{name:"old woman",slug:"old_woman",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙍":{name:"person frowning",slug:"person_frowning",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙍‍♂️":{name:"man frowning",slug:"man_frowning",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙍‍♀️":{name:"woman frowning",slug:"woman_frowning",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙎":{name:"person pouting",slug:"person_pouting",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙎‍♂️":{name:"man pouting",slug:"man_pouting",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙎‍♀️":{name:"woman pouting",slug:"woman_pouting",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙅":{name:"person gesturing NO",slug:"person_gesturing_no",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙅‍♂️":{name:"man gesturing NO",slug:"man_gesturing_no",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙅‍♀️":{name:"woman gesturing NO",slug:"woman_gesturing_no",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙆":{name:"person gesturing OK",slug:"person_gesturing_ok",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙆‍♂️":{name:"man gesturing OK",slug:"man_gesturing_ok",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙆‍♀️":{name:"woman gesturing OK",slug:"woman_gesturing_ok",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💁":{name:"person tipping hand",slug:"person_tipping_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💁‍♂️":{name:"man tipping hand",slug:"man_tipping_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💁‍♀️":{name:"woman tipping hand",slug:"woman_tipping_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙋":{name:"person raising hand",slug:"person_raising_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙋‍♂️":{name:"man raising hand",slug:"man_raising_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙋‍♀️":{name:"woman raising hand",slug:"woman_raising_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧏":{name:"deaf person",slug:"deaf_person",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧏‍♂️":{name:"deaf man",slug:"deaf_man",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧏‍♀️":{name:"deaf woman",slug:"deaf_woman",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🙇":{name:"person bowing",slug:"person_bowing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙇‍♂️":{name:"man bowing",slug:"man_bowing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙇‍♀️":{name:"woman bowing",slug:"woman_bowing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤦":{name:"person facepalming",slug:"person_facepalming",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤦‍♂️":{name:"man facepalming",slug:"man_facepalming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤦‍♀️":{name:"woman facepalming",slug:"woman_facepalming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤷":{name:"person shrugging",slug:"person_shrugging",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤷‍♂️":{name:"man shrugging",slug:"man_shrugging",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤷‍♀️":{name:"woman shrugging",slug:"woman_shrugging",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍⚕️":{name:"health worker",slug:"health_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍⚕️":{name:"man health worker",slug:"man_health_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍⚕️":{name:"woman health worker",slug:"woman_health_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎓":{name:"student",slug:"student",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎓":{name:"man student",slug:"man_student",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎓":{name:"woman student",slug:"woman_student",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🏫":{name:"teacher",slug:"teacher",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🏫":{name:"man teacher",slug:"man_teacher",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🏫":{name:"woman teacher",slug:"woman_teacher",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍⚖️":{name:"judge",slug:"judge",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍⚖️":{name:"man judge",slug:"man_judge",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍⚖️":{name:"woman judge",slug:"woman_judge",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🌾":{name:"farmer",slug:"farmer",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🌾":{name:"man farmer",slug:"man_farmer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🌾":{name:"woman farmer",slug:"woman_farmer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🍳":{name:"cook",slug:"cook",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🍳":{name:"man cook",slug:"man_cook",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🍳":{name:"woman cook",slug:"woman_cook",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🔧":{name:"mechanic",slug:"mechanic",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🔧":{name:"man mechanic",slug:"man_mechanic",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🔧":{name:"woman mechanic",slug:"woman_mechanic",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🏭":{name:"factory worker",slug:"factory_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🏭":{name:"man factory worker",slug:"man_factory_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🏭":{name:"woman factory worker",slug:"woman_factory_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍💼":{name:"office worker",slug:"office_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍💼":{name:"man office worker",slug:"man_office_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍💼":{name:"woman office worker",slug:"woman_office_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🔬":{name:"scientist",slug:"scientist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🔬":{name:"man scientist",slug:"man_scientist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🔬":{name:"woman scientist",slug:"woman_scientist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍💻":{name:"technologist",slug:"technologist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍💻":{name:"man technologist",slug:"man_technologist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍💻":{name:"woman technologist",slug:"woman_technologist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎤":{name:"singer",slug:"singer",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎤":{name:"man singer",slug:"man_singer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎤":{name:"woman singer",slug:"woman_singer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎨":{name:"artist",slug:"artist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎨":{name:"man artist",slug:"man_artist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎨":{name:"woman artist",slug:"woman_artist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍✈️":{name:"pilot",slug:"pilot",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍✈️":{name:"man pilot",slug:"man_pilot",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍✈️":{name:"woman pilot",slug:"woman_pilot",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🚀":{name:"astronaut",slug:"astronaut",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🚀":{name:"man astronaut",slug:"man_astronaut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🚀":{name:"woman astronaut",slug:"woman_astronaut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🚒":{name:"firefighter",slug:"firefighter",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🚒":{name:"man firefighter",slug:"man_firefighter",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🚒":{name:"woman firefighter",slug:"woman_firefighter",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👮":{name:"police officer",slug:"police_officer",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👮‍♂️":{name:"man police officer",slug:"man_police_officer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👮‍♀️":{name:"woman police officer",slug:"woman_police_officer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🕵️":{name:"detective",slug:"detective",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"🕵️‍♂️":{name:"man detective",slug:"man_detective",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🕵️‍♀️":{name:"woman detective",slug:"woman_detective",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💂":{name:"guard",slug:"guard",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💂‍♂️":{name:"man guard",slug:"man_guard",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💂‍♀️":{name:"woman guard",slug:"woman_guard",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🥷":{name:"ninja",slug:"ninja",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👷":{name:"construction worker",slug:"construction_worker",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👷‍♂️":{name:"man construction worker",slug:"man_construction_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👷‍♀️":{name:"woman construction worker",slug:"woman_construction_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🫅":{name:"person with crown",slug:"person_with_crown",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤴":{name:"prince",slug:"prince",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👸":{name:"princess",slug:"princess",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👳":{name:"person wearing turban",slug:"person_wearing_turban",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👳‍♂️":{name:"man wearing turban",slug:"man_wearing_turban",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👳‍♀️":{name:"woman wearing turban",slug:"woman_wearing_turban",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👲":{name:"person with skullcap",slug:"person_with_skullcap",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧕":{name:"woman with headscarf",slug:"woman_with_headscarf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤵":{name:"person in tuxedo",slug:"person_in_tuxedo",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤵‍♂️":{name:"man in tuxedo",slug:"man_in_tuxedo",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤵‍♀️":{name:"woman in tuxedo",slug:"woman_in_tuxedo",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👰":{name:"person with veil",slug:"person_with_veil",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👰‍♂️":{name:"man with veil",slug:"man_with_veil",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👰‍♀️":{name:"woman with veil",slug:"woman_with_veil",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤰":{name:"pregnant woman",slug:"pregnant_woman",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🫃":{name:"pregnant man",slug:"pregnant_man",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫄":{name:"pregnant person",slug:"pregnant_person",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤱":{name:"breast-feeding",slug:"breast_feeding",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👩‍🍼":{name:"woman feeding baby",slug:"woman_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👨‍🍼":{name:"man feeding baby",slug:"man_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🧑‍🍼":{name:"person feeding baby",slug:"person_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👼":{name:"baby angel",slug:"baby_angel",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🎅":{name:"Santa Claus",slug:"santa_claus",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤶":{name:"Mrs. Claus",slug:"mrs_claus",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🧑‍🎄":{name:"Mx Claus",slug:"mx_claus",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🦸":{name:"superhero",slug:"superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦸‍♂️":{name:"man superhero",slug:"man_superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦸‍♀️":{name:"woman superhero",slug:"woman_superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹":{name:"supervillain",slug:"supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹‍♂️":{name:"man supervillain",slug:"man_supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹‍♀️":{name:"woman supervillain",slug:"woman_supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧙":{name:"mage",slug:"mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧙‍♂️":{name:"man mage",slug:"man_mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧙‍♀️":{name:"woman mage",slug:"woman_mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚":{name:"fairy",slug:"fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚‍♂️":{name:"man fairy",slug:"man_fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚‍♀️":{name:"woman fairy",slug:"woman_fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛":{name:"vampire",slug:"vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛‍♂️":{name:"man vampire",slug:"man_vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛‍♀️":{name:"woman vampire",slug:"woman_vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜":{name:"merperson",slug:"merperson",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜‍♂️":{name:"merman",slug:"merman",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜‍♀️":{name:"mermaid",slug:"mermaid",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝":{name:"elf",slug:"elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝‍♂️":{name:"man elf",slug:"man_elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝‍♀️":{name:"woman elf",slug:"woman_elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧞":{name:"genie",slug:"genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧞‍♂️":{name:"man genie",slug:"man_genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧞‍♀️":{name:"woman genie",slug:"woman_genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟":{name:"zombie",slug:"zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟‍♂️":{name:"man zombie",slug:"man_zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟‍♀️":{name:"woman zombie",slug:"woman_zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧌":{name:"troll",slug:"troll",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"💆":{name:"person getting massage",slug:"person_getting_massage",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💆‍♂️":{name:"man getting massage",slug:"man_getting_massage",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💆‍♀️":{name:"woman getting massage",slug:"woman_getting_massage",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💇":{name:"person getting haircut",slug:"person_getting_haircut",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💇‍♂️":{name:"man getting haircut",slug:"man_getting_haircut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💇‍♀️":{name:"woman getting haircut",slug:"woman_getting_haircut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶":{name:"person walking",slug:"person_walking",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚶‍♂️":{name:"man walking",slug:"man_walking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶‍♀️":{name:"woman walking",slug:"woman_walking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶‍➡️":{name:"person walking facing right",slug:"person_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🚶‍♀️‍➡️":{name:"woman walking facing right",slug:"woman_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🚶‍♂️‍➡️":{name:"man walking facing right",slug:"man_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧍":{name:"person standing",slug:"person_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧍‍♂️":{name:"man standing",slug:"man_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧍‍♀️":{name:"woman standing",slug:"woman_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎":{name:"person kneeling",slug:"person_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍♂️":{name:"man kneeling",slug:"man_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍♀️":{name:"woman kneeling",slug:"woman_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍➡️":{name:"person kneeling facing right",slug:"person_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧎‍♀️‍➡️":{name:"woman kneeling facing right",slug:"woman_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧎‍♂️‍➡️":{name:"man kneeling facing right",slug:"man_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦯":{name:"person with white cane",slug:"person_with_white_cane",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦯‍➡️":{name:"person with white cane facing right",slug:"person_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦯":{name:"man with white cane",slug:"man_with_white_cane",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦯‍➡️":{name:"man with white cane facing right",slug:"man_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦯":{name:"woman with white cane",slug:"woman_with_white_cane",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦯‍➡️":{name:"woman with white cane facing right",slug:"woman_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦼":{name:"person in motorized wheelchair",slug:"person_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦼‍➡️":{name:"person in motorized wheelchair facing right",slug:"person_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦼":{name:"man in motorized wheelchair",slug:"man_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦼‍➡️":{name:"man in motorized wheelchair facing right",slug:"man_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦼":{name:"woman in motorized wheelchair",slug:"woman_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦼‍➡️":{name:"woman in motorized wheelchair facing right",slug:"woman_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦽":{name:"person in manual wheelchair",slug:"person_in_manual_wheelchair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦽‍➡️":{name:"person in manual wheelchair facing right",slug:"person_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦽":{name:"man in manual wheelchair",slug:"man_in_manual_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦽‍➡️":{name:"man in manual wheelchair facing right",slug:"man_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦽":{name:"woman in manual wheelchair",slug:"woman_in_manual_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦽‍➡️":{name:"woman in manual wheelchair facing right",slug:"woman_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃":{name:"person running",slug:"person_running",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏃‍♂️":{name:"man running",slug:"man_running",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏃‍♀️":{name:"woman running",slug:"woman_running",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏃‍➡️":{name:"person running facing right",slug:"person_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃‍♀️‍➡️":{name:"woman running facing right",slug:"woman_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃‍♂️‍➡️":{name:"man running facing right",slug:"man_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"💃":{name:"woman dancing",slug:"woman_dancing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🕺":{name:"man dancing",slug:"man_dancing",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🕴️":{name:"person in suit levitating",slug:"person_in_suit_levitating",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👯":{name:"people with bunny ears",slug:"people_with_bunny_ears",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👯‍♂️":{name:"men with bunny ears",slug:"men_with_bunny_ears",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👯‍♀️":{name:"women with bunny ears",slug:"women_with_bunny_ears",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🧖":{name:"person in steamy room",slug:"person_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧖‍♂️":{name:"man in steamy room",slug:"man_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧖‍♀️":{name:"woman in steamy room",slug:"woman_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗":{name:"person climbing",slug:"person_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗‍♂️":{name:"man climbing",slug:"man_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗‍♀️":{name:"woman climbing",slug:"woman_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤺":{name:"person fencing",slug:"person_fencing",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🏇":{name:"horse racing",slug:"horse_racing",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"⛷️":{name:"skier",slug:"skier",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏂":{name:"snowboarder",slug:"snowboarder",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏌️":{name:"person golfing",slug:"person_golfing",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏌️‍♂️":{name:"man golfing",slug:"man_golfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏌️‍♀️":{name:"woman golfing",slug:"woman_golfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏄":{name:"person surfing",slug:"person_surfing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏄‍♂️":{name:"man surfing",slug:"man_surfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏄‍♀️":{name:"woman surfing",slug:"woman_surfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚣":{name:"person rowing boat",slug:"person_rowing_boat",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚣‍♂️":{name:"man rowing boat",slug:"man_rowing_boat",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚣‍♀️":{name:"woman rowing boat",slug:"woman_rowing_boat",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏊":{name:"person swimming",slug:"person_swimming",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏊‍♂️":{name:"man swimming",slug:"man_swimming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏊‍♀️":{name:"woman swimming",slug:"woman_swimming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"⛹️":{name:"person bouncing ball",slug:"person_bouncing_ball",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"⛹️‍♂️":{name:"man bouncing ball",slug:"man_bouncing_ball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"⛹️‍♀️":{name:"woman bouncing ball",slug:"woman_bouncing_ball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏋️":{name:"person lifting weights",slug:"person_lifting_weights",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"🏋️‍♂️":{name:"man lifting weights",slug:"man_lifting_weights",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏋️‍♀️":{name:"woman lifting weights",slug:"woman_lifting_weights",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚴":{name:"person biking",slug:"person_biking",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚴‍♂️":{name:"man biking",slug:"man_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚴‍♀️":{name:"woman biking",slug:"woman_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚵":{name:"person mountain biking",slug:"person_mountain_biking",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚵‍♂️":{name:"man mountain biking",slug:"man_mountain_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚵‍♀️":{name:"woman mountain biking",slug:"woman_mountain_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤸":{name:"person cartwheeling",slug:"person_cartwheeling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤸‍♂️":{name:"man cartwheeling",slug:"man_cartwheeling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤸‍♀️":{name:"woman cartwheeling",slug:"woman_cartwheeling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤼":{name:"people wrestling",slug:"people_wrestling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🤼‍♂️":{name:"men wrestling",slug:"men_wrestling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🤼‍♀️":{name:"women wrestling",slug:"women_wrestling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🤽":{name:"person playing water polo",slug:"person_playing_water_polo",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤽‍♂️":{name:"man playing water polo",slug:"man_playing_water_polo",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤽‍♀️":{name:"woman playing water polo",slug:"woman_playing_water_polo",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤾":{name:"person playing handball",slug:"person_playing_handball",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤾‍♂️":{name:"man playing handball",slug:"man_playing_handball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤾‍♀️":{name:"woman playing handball",slug:"woman_playing_handball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤹":{name:"person juggling",slug:"person_juggling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤹‍♂️":{name:"man juggling",slug:"man_juggling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤹‍♀️":{name:"woman juggling",slug:"woman_juggling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧘":{name:"person in lotus position",slug:"person_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧘‍♂️":{name:"man in lotus position",slug:"man_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧘‍♀️":{name:"woman in lotus position",slug:"woman_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🛀":{name:"person taking bath",slug:"person_taking_bath",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🛌":{name:"person in bed",slug:"person_in_bed",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🤝‍🧑":{name:"people holding hands",slug:"people_holding_hands",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👭":{name:"women holding hands",slug:"women_holding_hands",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👫":{name:"woman and man holding hands",slug:"woman_and_man_holding_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👬":{name:"men holding hands",slug:"men_holding_hands",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"💏":{name:"kiss",slug:"kiss",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍💋‍👨":{name:"kiss woman, man",slug:"kiss_woman_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍❤️‍💋‍👨":{name:"kiss man, man",slug:"kiss_man_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍💋‍👩":{name:"kiss woman, woman",slug:"kiss_woman_woman",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"💑":{name:"couple with heart",slug:"couple_with_heart",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍👨":{name:"couple with heart woman, man",slug:"couple_with_heart_woman_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍❤️‍👨":{name:"couple with heart man, man",slug:"couple_with_heart_man_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍👩":{name:"couple with heart woman, woman",slug:"couple_with_heart_woman_woman",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍👩‍👦":{name:"family man, woman, boy",slug:"family_man_woman_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧":{name:"family man, woman, girl",slug:"family_man_woman_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧‍👦":{name:"family man, woman, girl, boy",slug:"family_man_woman_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👦‍👦":{name:"family man, woman, boy, boy",slug:"family_man_woman_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧‍👧":{name:"family man, woman, girl, girl",slug:"family_man_woman_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👦":{name:"family man, man, boy",slug:"family_man_man_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧":{name:"family man, man, girl",slug:"family_man_man_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧‍👦":{name:"family man, man, girl, boy",slug:"family_man_man_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👦‍👦":{name:"family man, man, boy, boy",slug:"family_man_man_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧‍👧":{name:"family man, man, girl, girl",slug:"family_man_man_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👦":{name:"family woman, woman, boy",slug:"family_woman_woman_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧":{name:"family woman, woman, girl",slug:"family_woman_woman_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧‍👦":{name:"family woman, woman, girl, boy",slug:"family_woman_woman_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👦‍👦":{name:"family woman, woman, boy, boy",slug:"family_woman_woman_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧‍👧":{name:"family woman, woman, girl, girl",slug:"family_woman_woman_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👦":{name:"family man, boy",slug:"family_man_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👦‍👦":{name:"family man, boy, boy",slug:"family_man_boy_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧":{name:"family man, girl",slug:"family_man_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧‍👦":{name:"family man, girl, boy",slug:"family_man_girl_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧‍👧":{name:"family man, girl, girl",slug:"family_man_girl_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👦":{name:"family woman, boy",slug:"family_woman_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👦‍👦":{name:"family woman, boy, boy",slug:"family_woman_boy_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧":{name:"family woman, girl",slug:"family_woman_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧‍👦":{name:"family woman, girl, boy",slug:"family_woman_girl_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧‍👧":{name:"family woman, girl, girl",slug:"family_woman_girl_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🗣️":{name:"speaking head",slug:"speaking_head",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"👤":{name:"bust in silhouette",slug:"bust_in_silhouette",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👥":{name:"busts in silhouette",slug:"busts_in_silhouette",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫂":{name:"people hugging",slug:"people_hugging",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👪":{name:"family",slug:"family",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧑‍🧑‍🧒":{name:"family adult, adult, child",slug:"family_adult_adult_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧑‍🧒‍🧒":{name:"family adult, adult, child, child",slug:"family_adult_adult_child_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧒":{name:"family adult, child",slug:"family_adult_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧒‍🧒":{name:"family adult, child, child",slug:"family_adult_child_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"👣":{name:"footprints",slug:"footprints",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫆":{name:"fingerprint",slug:"fingerprint",group:"People & Body",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🐵":{name:"monkey face",slug:"monkey_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐒":{name:"monkey",slug:"monkey",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦍":{name:"gorilla",slug:"gorilla",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦧":{name:"orangutan",slug:"orangutan",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐶":{name:"dog face",slug:"dog_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐕":{name:"dog",slug:"dog",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦮":{name:"guide dog",slug:"guide_dog",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐕‍🦺":{name:"service dog",slug:"service_dog",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐩":{name:"poodle",slug:"poodle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐺":{name:"wolf",slug:"wolf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦊":{name:"fox",slug:"fox",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦝":{name:"raccoon",slug:"raccoon",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐱":{name:"cat face",slug:"cat_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐈":{name:"cat",slug:"cat",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🐈‍⬛":{name:"black cat",slug:"black_cat",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦁":{name:"lion",slug:"lion",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐯":{name:"tiger face",slug:"tiger_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐅":{name:"tiger",slug:"tiger",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐆":{name:"leopard",slug:"leopard",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐴":{name:"horse face",slug:"horse_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫎":{name:"moose",slug:"moose",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🫏":{name:"donkey",slug:"donkey",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐎":{name:"horse",slug:"horse",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦄":{name:"unicorn",slug:"unicorn",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦓":{name:"zebra",slug:"zebra",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦌":{name:"deer",slug:"deer",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦬":{name:"bison",slug:"bison",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐮":{name:"cow face",slug:"cow_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐂":{name:"ox",slug:"ox",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐃":{name:"water buffalo",slug:"water_buffalo",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐄":{name:"cow",slug:"cow",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐷":{name:"pig face",slug:"pig_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐖":{name:"pig",slug:"pig",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐗":{name:"boar",slug:"boar",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐽":{name:"pig nose",slug:"pig_nose",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐏":{name:"ram",slug:"ram",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐑":{name:"ewe",slug:"ewe",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐐":{name:"goat",slug:"goat",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐪":{name:"camel",slug:"camel",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐫":{name:"two-hump camel",slug:"two_hump_camel",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦙":{name:"llama",slug:"llama",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦒":{name:"giraffe",slug:"giraffe",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🐘":{name:"elephant",slug:"elephant",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦣":{name:"mammoth",slug:"mammoth",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦏":{name:"rhinoceros",slug:"rhinoceros",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦛":{name:"hippopotamus",slug:"hippopotamus",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐭":{name:"mouse face",slug:"mouse_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐁":{name:"mouse",slug:"mouse",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐀":{name:"rat",slug:"rat",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐹":{name:"hamster",slug:"hamster",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐰":{name:"rabbit face",slug:"rabbit_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐇":{name:"rabbit",slug:"rabbit",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐿️":{name:"chipmunk",slug:"chipmunk",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦫":{name:"beaver",slug:"beaver",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦔":{name:"hedgehog",slug:"hedgehog",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦇":{name:"bat",slug:"bat",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐻":{name:"bear",slug:"bear",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐻‍❄️":{name:"polar bear",slug:"polar_bear",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐨":{name:"koala",slug:"koala",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐼":{name:"panda",slug:"panda",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦥":{name:"sloth",slug:"sloth",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦦":{name:"otter",slug:"otter",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦨":{name:"skunk",slug:"skunk",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦘":{name:"kangaroo",slug:"kangaroo",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦡":{name:"badger",slug:"badger",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐾":{name:"paw prints",slug:"paw_prints",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦃":{name:"turkey",slug:"turkey",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐔":{name:"chicken",slug:"chicken",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐓":{name:"rooster",slug:"rooster",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐣":{name:"hatching chick",slug:"hatching_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐤":{name:"baby chick",slug:"baby_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐥":{name:"front-facing baby chick",slug:"front_facing_baby_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐦":{name:"bird",slug:"bird",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐧":{name:"penguin",slug:"penguin",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕊️":{name:"dove",slug:"dove",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦅":{name:"eagle",slug:"eagle",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦆":{name:"duck",slug:"duck",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦢":{name:"swan",slug:"swan",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦉":{name:"owl",slug:"owl",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦤":{name:"dodo",slug:"dodo",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪶":{name:"feather",slug:"feather",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦩":{name:"flamingo",slug:"flamingo",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦚":{name:"peacock",slug:"peacock",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦜":{name:"parrot",slug:"parrot",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪽":{name:"wing",slug:"wing",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐦‍⬛":{name:"black bird",slug:"black_bird",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪿":{name:"goose",slug:"goose",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐦‍🔥":{name:"phoenix",slug:"phoenix",group:"Animals & Nature",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🐸":{name:"frog",slug:"frog",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐊":{name:"crocodile",slug:"crocodile",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐢":{name:"turtle",slug:"turtle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦎":{name:"lizard",slug:"lizard",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐍":{name:"snake",slug:"snake",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐲":{name:"dragon face",slug:"dragon_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐉":{name:"dragon",slug:"dragon",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦕":{name:"sauropod",slug:"sauropod",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦖":{name:"T-Rex",slug:"t_rex",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🐳":{name:"spouting whale",slug:"spouting_whale",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐋":{name:"whale",slug:"whale",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐬":{name:"dolphin",slug:"dolphin",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦭":{name:"seal",slug:"seal",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐟":{name:"fish",slug:"fish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐠":{name:"tropical fish",slug:"tropical_fish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐡":{name:"blowfish",slug:"blowfish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦈":{name:"shark",slug:"shark",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐙":{name:"octopus",slug:"octopus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐚":{name:"spiral shell",slug:"spiral_shell",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪸":{name:"coral",slug:"coral",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪼":{name:"jellyfish",slug:"jellyfish",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🦀":{name:"crab",slug:"crab",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦞":{name:"lobster",slug:"lobster",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦐":{name:"shrimp",slug:"shrimp",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦑":{name:"squid",slug:"squid",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦪":{name:"oyster",slug:"oyster",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐌":{name:"snail",slug:"snail",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦋":{name:"butterfly",slug:"butterfly",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐛":{name:"bug",slug:"bug",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐜":{name:"ant",slug:"ant",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐝":{name:"honeybee",slug:"honeybee",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪲":{name:"beetle",slug:"beetle",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐞":{name:"lady beetle",slug:"lady_beetle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦗":{name:"cricket",slug:"cricket",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🪳":{name:"cockroach",slug:"cockroach",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🕷️":{name:"spider",slug:"spider",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕸️":{name:"spider web",slug:"spider_web",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦂":{name:"scorpion",slug:"scorpion",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦟":{name:"mosquito",slug:"mosquito",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪰":{name:"fly",slug:"fly",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪱":{name:"worm",slug:"worm",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦠":{name:"microbe",slug:"microbe",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"💐":{name:"bouquet",slug:"bouquet",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌸":{name:"cherry blossom",slug:"cherry_blossom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💮":{name:"white flower",slug:"white_flower",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪷":{name:"lotus",slug:"lotus",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏵️":{name:"rosette",slug:"rosette",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌹":{name:"rose",slug:"rose",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥀":{name:"wilted flower",slug:"wilted_flower",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🌺":{name:"hibiscus",slug:"hibiscus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌻":{name:"sunflower",slug:"sunflower",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌼":{name:"blossom",slug:"blossom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌷":{name:"tulip",slug:"tulip",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪻":{name:"hyacinth",slug:"hyacinth",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🌱":{name:"seedling",slug:"seedling",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪴":{name:"potted plant",slug:"potted_plant",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🌲":{name:"evergreen tree",slug:"evergreen_tree",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌳":{name:"deciduous tree",slug:"deciduous_tree",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌴":{name:"palm tree",slug:"palm_tree",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌵":{name:"cactus",slug:"cactus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌾":{name:"sheaf of rice",slug:"sheaf_of_rice",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌿":{name:"herb",slug:"herb",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☘️":{name:"shamrock",slug:"shamrock",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍀":{name:"four leaf clover",slug:"four_leaf_clover",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍁":{name:"maple leaf",slug:"maple_leaf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍂":{name:"fallen leaf",slug:"fallen_leaf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍃":{name:"leaf fluttering in wind",slug:"leaf_fluttering_in_wind",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪹":{name:"empty nest",slug:"empty_nest",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪺":{name:"nest with eggs",slug:"nest_with_eggs",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🍄":{name:"mushroom",slug:"mushroom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪾":{name:"leafless tree",slug:"leafless_tree",group:"Animals & Nature",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🍇":{name:"grapes",slug:"grapes",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍈":{name:"melon",slug:"melon",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍉":{name:"watermelon",slug:"watermelon",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍊":{name:"tangerine",slug:"tangerine",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍋":{name:"lemon",slug:"lemon",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍋‍🟩":{name:"lime",slug:"lime",group:"Food & Drink",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🍌":{name:"banana",slug:"banana",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍍":{name:"pineapple",slug:"pineapple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥭":{name:"mango",slug:"mango",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🍎":{name:"red apple",slug:"red_apple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍏":{name:"green apple",slug:"green_apple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍐":{name:"pear",slug:"pear",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍑":{name:"peach",slug:"peach",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍒":{name:"cherries",slug:"cherries",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍓":{name:"strawberry",slug:"strawberry",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫐":{name:"blueberries",slug:"blueberries",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥝":{name:"kiwi fruit",slug:"kiwi_fruit",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍅":{name:"tomato",slug:"tomato",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫒":{name:"olive",slug:"olive",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥥":{name:"coconut",slug:"coconut",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥑":{name:"avocado",slug:"avocado",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍆":{name:"eggplant",slug:"eggplant",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥔":{name:"potato",slug:"potato",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥕":{name:"carrot",slug:"carrot",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🌽":{name:"ear of corn",slug:"ear_of_corn",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌶️":{name:"hot pepper",slug:"hot_pepper",group:"Food & Drink",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🫑":{name:"bell pepper",slug:"bell_pepper",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥒":{name:"cucumber",slug:"cucumber",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥬":{name:"leafy green",slug:"leafy_green",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥦":{name:"broccoli",slug:"broccoli",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧄":{name:"garlic",slug:"garlic",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧅":{name:"onion",slug:"onion",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥜":{name:"peanuts",slug:"peanuts",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫘":{name:"beans",slug:"beans",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🌰":{name:"chestnut",slug:"chestnut",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫚":{name:"ginger root",slug:"ginger_root",group:"Food & Drink",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🫛":{name:"pea pod",slug:"pea_pod",group:"Food & Drink",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🍄‍🟫":{name:"brown mushroom",slug:"brown_mushroom",group:"Food & Drink",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🫜":{name:"root vegetable",slug:"root_vegetable",group:"Food & Drink",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🍞":{name:"bread",slug:"bread",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥐":{name:"croissant",slug:"croissant",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥖":{name:"baguette bread",slug:"baguette_bread",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫓":{name:"flatbread",slug:"flatbread",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥨":{name:"pretzel",slug:"pretzel",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥯":{name:"bagel",slug:"bagel",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥞":{name:"pancakes",slug:"pancakes",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🧇":{name:"waffle",slug:"waffle",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧀":{name:"cheese wedge",slug:"cheese_wedge",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍖":{name:"meat on bone",slug:"meat_on_bone",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍗":{name:"poultry leg",slug:"poultry_leg",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥩":{name:"cut of meat",slug:"cut_of_meat",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥓":{name:"bacon",slug:"bacon",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍔":{name:"hamburger",slug:"hamburger",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍟":{name:"french fries",slug:"french_fries",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍕":{name:"pizza",slug:"pizza",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌭":{name:"hot dog",slug:"hot_dog",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥪":{name:"sandwich",slug:"sandwich",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🌮":{name:"taco",slug:"taco",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌯":{name:"burrito",slug:"burrito",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫔":{name:"tamale",slug:"tamale",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥙":{name:"stuffed flatbread",slug:"stuffed_flatbread",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🧆":{name:"falafel",slug:"falafel",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥚":{name:"egg",slug:"egg",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍳":{name:"cooking",slug:"cooking",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥘":{name:"shallow pan of food",slug:"shallow_pan_of_food",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍲":{name:"pot of food",slug:"pot_of_food",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫕":{name:"fondue",slug:"fondue",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥣":{name:"bowl with spoon",slug:"bowl_with_spoon",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥗":{name:"green salad",slug:"green_salad",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍿":{name:"popcorn",slug:"popcorn",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧈":{name:"butter",slug:"butter",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧂":{name:"salt",slug:"salt",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥫":{name:"canned food",slug:"canned_food",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍱":{name:"bento box",slug:"bento_box",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍘":{name:"rice cracker",slug:"rice_cracker",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍙":{name:"rice ball",slug:"rice_ball",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍚":{name:"cooked rice",slug:"cooked_rice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍛":{name:"curry rice",slug:"curry_rice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍜":{name:"steaming bowl",slug:"steaming_bowl",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍝":{name:"spaghetti",slug:"spaghetti",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍠":{name:"roasted sweet potato",slug:"roasted_sweet_potato",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍢":{name:"oden",slug:"oden",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍣":{name:"sushi",slug:"sushi",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍤":{name:"fried shrimp",slug:"fried_shrimp",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍥":{name:"fish cake with swirl",slug:"fish_cake_with_swirl",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥮":{name:"moon cake",slug:"moon_cake",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🍡":{name:"dango",slug:"dango",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥟":{name:"dumpling",slug:"dumpling",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥠":{name:"fortune cookie",slug:"fortune_cookie",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥡":{name:"takeout box",slug:"takeout_box",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍦":{name:"soft ice cream",slug:"soft_ice_cream",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍧":{name:"shaved ice",slug:"shaved_ice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍨":{name:"ice cream",slug:"ice_cream",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍩":{name:"doughnut",slug:"doughnut",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍪":{name:"cookie",slug:"cookie",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎂":{name:"birthday cake",slug:"birthday_cake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍰":{name:"shortcake",slug:"shortcake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧁":{name:"cupcake",slug:"cupcake",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥧":{name:"pie",slug:"pie",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍫":{name:"chocolate bar",slug:"chocolate_bar",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍬":{name:"candy",slug:"candy",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍭":{name:"lollipop",slug:"lollipop",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍮":{name:"custard",slug:"custard",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍯":{name:"honey pot",slug:"honey_pot",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍼":{name:"baby bottle",slug:"baby_bottle",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥛":{name:"glass of milk",slug:"glass_of_milk",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"☕":{name:"hot beverage",slug:"hot_beverage",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫖":{name:"teapot",slug:"teapot",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🍵":{name:"teacup without handle",slug:"teacup_without_handle",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍶":{name:"sake",slug:"sake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍾":{name:"bottle with popping cork",slug:"bottle_with_popping_cork",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍷":{name:"wine glass",slug:"wine_glass",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍸":{name:"cocktail glass",slug:"cocktail_glass",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍹":{name:"tropical drink",slug:"tropical_drink",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍺":{name:"beer mug",slug:"beer_mug",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍻":{name:"clinking beer mugs",slug:"clinking_beer_mugs",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥂":{name:"clinking glasses",slug:"clinking_glasses",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥃":{name:"tumbler glass",slug:"tumbler_glass",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫗":{name:"pouring liquid",slug:"pouring_liquid",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🥤":{name:"cup with straw",slug:"cup_with_straw",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧋":{name:"bubble tea",slug:"bubble_tea",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧃":{name:"beverage box",slug:"beverage_box",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧉":{name:"mate",slug:"mate",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧊":{name:"ice",slug:"ice",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥢":{name:"chopsticks",slug:"chopsticks",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍽️":{name:"fork and knife with plate",slug:"fork_and_knife_with_plate",group:"Food & Drink",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🍴":{name:"fork and knife",slug:"fork_and_knife",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥄":{name:"spoon",slug:"spoon",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🔪":{name:"kitchen knife",slug:"kitchen_knife",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫙":{name:"jar",slug:"jar",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏺":{name:"amphora",slug:"amphora",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌍":{name:"globe showing Europe-Africa",slug:"globe_showing_europe_africa",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌎":{name:"globe showing Americas",slug:"globe_showing_americas",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌏":{name:"globe showing Asia-Australia",slug:"globe_showing_asia_australia",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌐":{name:"globe with meridians",slug:"globe_with_meridians",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🗺️":{name:"world map",slug:"world_map",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗾":{name:"map of Japan",slug:"map_of_japan",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧭":{name:"compass",slug:"compass",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏔️":{name:"snow-capped mountain",slug:"snow_capped_mountain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛰️":{name:"mountain",slug:"mountain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌋":{name:"volcano",slug:"volcano",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗻":{name:"mount fuji",slug:"mount_fuji",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏕️":{name:"camping",slug:"camping",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏖️":{name:"beach with umbrella",slug:"beach_with_umbrella",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏜️":{name:"desert",slug:"desert",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏝️":{name:"desert island",slug:"desert_island",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏞️":{name:"national park",slug:"national_park",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏟️":{name:"stadium",slug:"stadium",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏛️":{name:"classical building",slug:"classical_building",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏗️":{name:"building construction",slug:"building_construction",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🧱":{name:"brick",slug:"brick",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪨":{name:"rock",slug:"rock",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪵":{name:"wood",slug:"wood",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🛖":{name:"hut",slug:"hut",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏘️":{name:"houses",slug:"houses",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏚️":{name:"derelict house",slug:"derelict_house",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏠":{name:"house",slug:"house",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏡":{name:"house with garden",slug:"house_with_garden",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏢":{name:"office building",slug:"office_building",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏣":{name:"Japanese post office",slug:"japanese_post_office",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏤":{name:"post office",slug:"post_office",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏥":{name:"hospital",slug:"hospital",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏦":{name:"bank",slug:"bank",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏨":{name:"hotel",slug:"hotel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏩":{name:"love hotel",slug:"love_hotel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏪":{name:"convenience store",slug:"convenience_store",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏫":{name:"school",slug:"school",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏬":{name:"department store",slug:"department_store",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏭":{name:"factory",slug:"factory",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏯":{name:"Japanese castle",slug:"japanese_castle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏰":{name:"castle",slug:"castle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💒":{name:"wedding",slug:"wedding",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗼":{name:"Tokyo tower",slug:"tokyo_tower",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗽":{name:"Statue of Liberty",slug:"statue_of_liberty",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛪":{name:"church",slug:"church",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕌":{name:"mosque",slug:"mosque",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛕":{name:"hindu temple",slug:"hindu_temple",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🕍":{name:"synagogue",slug:"synagogue",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛩️":{name:"shinto shrine",slug:"shinto_shrine",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕋":{name:"kaaba",slug:"kaaba",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛲":{name:"fountain",slug:"fountain",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛺":{name:"tent",slug:"tent",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌁":{name:"foggy",slug:"foggy",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌃":{name:"night with stars",slug:"night_with_stars",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏙️":{name:"cityscape",slug:"cityscape",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌄":{name:"sunrise over mountains",slug:"sunrise_over_mountains",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌅":{name:"sunrise",slug:"sunrise",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌆":{name:"cityscape at dusk",slug:"cityscape_at_dusk",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌇":{name:"sunset",slug:"sunset",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌉":{name:"bridge at night",slug:"bridge_at_night",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♨️":{name:"hot springs",slug:"hot_springs",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎠":{name:"carousel horse",slug:"carousel_horse",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛝":{name:"playground slide",slug:"playground_slide",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🎡":{name:"ferris wheel",slug:"ferris_wheel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎢":{name:"roller coaster",slug:"roller_coaster",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💈":{name:"barber pole",slug:"barber_pole",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎪":{name:"circus tent",slug:"circus_tent",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚂":{name:"locomotive",slug:"locomotive",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚃":{name:"railway car",slug:"railway_car",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚄":{name:"high-speed train",slug:"high_speed_train",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚅":{name:"bullet train",slug:"bullet_train",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚆":{name:"train",slug:"train",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚇":{name:"metro",slug:"metro",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚈":{name:"light rail",slug:"light_rail",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚉":{name:"station",slug:"station",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚊":{name:"tram",slug:"tram",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚝":{name:"monorail",slug:"monorail",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚞":{name:"mountain railway",slug:"mountain_railway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚋":{name:"tram car",slug:"tram_car",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚌":{name:"bus",slug:"bus",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚍":{name:"oncoming bus",slug:"oncoming_bus",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚎":{name:"trolleybus",slug:"trolleybus",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚐":{name:"minibus",slug:"minibus",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚑":{name:"ambulance",slug:"ambulance",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚒":{name:"fire engine",slug:"fire_engine",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚓":{name:"police car",slug:"police_car",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚔":{name:"oncoming police car",slug:"oncoming_police_car",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚕":{name:"taxi",slug:"taxi",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚖":{name:"oncoming taxi",slug:"oncoming_taxi",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚗":{name:"automobile",slug:"automobile",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚘":{name:"oncoming automobile",slug:"oncoming_automobile",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚙":{name:"sport utility vehicle",slug:"sport_utility_vehicle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛻":{name:"pickup truck",slug:"pickup_truck",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚚":{name:"delivery truck",slug:"delivery_truck",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚛":{name:"articulated lorry",slug:"articulated_lorry",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚜":{name:"tractor",slug:"tractor",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏎️":{name:"racing car",slug:"racing_car",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏍️":{name:"motorcycle",slug:"motorcycle",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛵":{name:"motor scooter",slug:"motor_scooter",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦽":{name:"manual wheelchair",slug:"manual_wheelchair",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦼":{name:"motorized wheelchair",slug:"motorized_wheelchair",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🛺":{name:"auto rickshaw",slug:"auto_rickshaw",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🚲":{name:"bicycle",slug:"bicycle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛴":{name:"kick scooter",slug:"kick_scooter",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🛹":{name:"skateboard",slug:"skateboard",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🛼":{name:"roller skate",slug:"roller_skate",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚏":{name:"bus stop",slug:"bus_stop",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛣️":{name:"motorway",slug:"motorway",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛤️":{name:"railway track",slug:"railway_track",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛢️":{name:"oil drum",slug:"oil_drum",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛽":{name:"fuel pump",slug:"fuel_pump",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛞":{name:"wheel",slug:"wheel",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🚨":{name:"police car light",slug:"police_car_light",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚥":{name:"horizontal traffic light",slug:"horizontal_traffic_light",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚦":{name:"vertical traffic light",slug:"vertical_traffic_light",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛑":{name:"stop sign",slug:"stop_sign",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚧":{name:"construction",slug:"construction",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚓":{name:"anchor",slug:"anchor",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛟":{name:"ring buoy",slug:"ring_buoy",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"⛵":{name:"sailboat",slug:"sailboat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛶":{name:"canoe",slug:"canoe",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚤":{name:"speedboat",slug:"speedboat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛳️":{name:"passenger ship",slug:"passenger_ship",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛴️":{name:"ferry",slug:"ferry",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛥️":{name:"motor boat",slug:"motor_boat",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚢":{name:"ship",slug:"ship",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✈️":{name:"airplane",slug:"airplane",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛩️":{name:"small airplane",slug:"small_airplane",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛫":{name:"airplane departure",slug:"airplane_departure",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛬":{name:"airplane arrival",slug:"airplane_arrival",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪂":{name:"parachute",slug:"parachute",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💺":{name:"seat",slug:"seat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚁":{name:"helicopter",slug:"helicopter",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚟":{name:"suspension railway",slug:"suspension_railway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚠":{name:"mountain cableway",slug:"mountain_cableway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚡":{name:"aerial tramway",slug:"aerial_tramway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛰️":{name:"satellite",slug:"satellite",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚀":{name:"rocket",slug:"rocket",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛸":{name:"flying saucer",slug:"flying_saucer",group:"Travel & Places",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🛎️":{name:"bellhop bell",slug:"bellhop_bell",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🧳":{name:"luggage",slug:"luggage",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"⌛":{name:"hourglass done",slug:"hourglass_done",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏳":{name:"hourglass not done",slug:"hourglass_not_done",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⌚":{name:"watch",slug:"watch",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏰":{name:"alarm clock",slug:"alarm_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏱️":{name:"stopwatch",slug:"stopwatch",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⏲️":{name:"timer clock",slug:"timer_clock",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕰️":{name:"mantelpiece clock",slug:"mantelpiece_clock",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕛":{name:"twelve o’clock",slug:"twelve_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕧":{name:"twelve-thirty",slug:"twelve_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕐":{name:"one o’clock",slug:"one_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕜":{name:"one-thirty",slug:"one_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕑":{name:"two o’clock",slug:"two_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕝":{name:"two-thirty",slug:"two_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕒":{name:"three o’clock",slug:"three_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕞":{name:"three-thirty",slug:"three_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕓":{name:"four o’clock",slug:"four_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕟":{name:"four-thirty",slug:"four_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕔":{name:"five o’clock",slug:"five_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕠":{name:"five-thirty",slug:"five_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕕":{name:"six o’clock",slug:"six_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕡":{name:"six-thirty",slug:"six_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕖":{name:"seven o’clock",slug:"seven_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕢":{name:"seven-thirty",slug:"seven_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕗":{name:"eight o’clock",slug:"eight_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕣":{name:"eight-thirty",slug:"eight_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕘":{name:"nine o’clock",slug:"nine_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕤":{name:"nine-thirty",slug:"nine_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕙":{name:"ten o’clock",slug:"ten_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕥":{name:"ten-thirty",slug:"ten_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕚":{name:"eleven o’clock",slug:"eleven_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕦":{name:"eleven-thirty",slug:"eleven_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌑":{name:"new moon",slug:"new_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌒":{name:"waxing crescent moon",slug:"waxing_crescent_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌓":{name:"first quarter moon",slug:"first_quarter_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌔":{name:"waxing gibbous moon",slug:"waxing_gibbous_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌕":{name:"full moon",slug:"full_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌖":{name:"waning gibbous moon",slug:"waning_gibbous_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌗":{name:"last quarter moon",slug:"last_quarter_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌘":{name:"waning crescent moon",slug:"waning_crescent_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌙":{name:"crescent moon",slug:"crescent_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌚":{name:"new moon face",slug:"new_moon_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌛":{name:"first quarter moon face",slug:"first_quarter_moon_face",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌜":{name:"last quarter moon face",slug:"last_quarter_moon_face",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌡️":{name:"thermometer",slug:"thermometer",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☀️":{name:"sun",slug:"sun",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌝":{name:"full moon face",slug:"full_moon_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌞":{name:"sun with face",slug:"sun_with_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪐":{name:"ringed planet",slug:"ringed_planet",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⭐":{name:"star",slug:"star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌟":{name:"glowing star",slug:"glowing_star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌠":{name:"shooting star",slug:"shooting_star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌌":{name:"milky way",slug:"milky_way",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☁️":{name:"cloud",slug:"cloud",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛅":{name:"sun behind cloud",slug:"sun_behind_cloud",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛈️":{name:"cloud with lightning and rain",slug:"cloud_with_lightning_and_rain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌤️":{name:"sun behind small cloud",slug:"sun_behind_small_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌥️":{name:"sun behind large cloud",slug:"sun_behind_large_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌦️":{name:"sun behind rain cloud",slug:"sun_behind_rain_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌧️":{name:"cloud with rain",slug:"cloud_with_rain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌨️":{name:"cloud with snow",slug:"cloud_with_snow",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌩️":{name:"cloud with lightning",slug:"cloud_with_lightning",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌪️":{name:"tornado",slug:"tornado",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌫️":{name:"fog",slug:"fog",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌬️":{name:"wind face",slug:"wind_face",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌀":{name:"cyclone",slug:"cyclone",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌈":{name:"rainbow",slug:"rainbow",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌂":{name:"closed umbrella",slug:"closed_umbrella",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☂️":{name:"umbrella",slug:"umbrella",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☔":{name:"umbrella with rain drops",slug:"umbrella_with_rain_drops",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛱️":{name:"umbrella on ground",slug:"umbrella_on_ground",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚡":{name:"high voltage",slug:"high_voltage",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❄️":{name:"snowflake",slug:"snowflake",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☃️":{name:"snowman",slug:"snowman",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛄":{name:"snowman without snow",slug:"snowman_without_snow",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☄️":{name:"comet",slug:"comet",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔥":{name:"fire",slug:"fire",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💧":{name:"droplet",slug:"droplet",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌊":{name:"water wave",slug:"water_wave",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎃":{name:"jack-o-lantern",slug:"jack_o_lantern",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎄":{name:"Christmas tree",slug:"christmas_tree",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎆":{name:"fireworks",slug:"fireworks",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎇":{name:"sparkler",slug:"sparkler",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧨":{name:"firecracker",slug:"firecracker",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"✨":{name:"sparkles",slug:"sparkles",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎈":{name:"balloon",slug:"balloon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎉":{name:"party popper",slug:"party_popper",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎊":{name:"confetti ball",slug:"confetti_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎋":{name:"tanabata tree",slug:"tanabata_tree",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎍":{name:"pine decoration",slug:"pine_decoration",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎎":{name:"Japanese dolls",slug:"japanese_dolls",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎏":{name:"carp streamer",slug:"carp_streamer",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎐":{name:"wind chime",slug:"wind_chime",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎑":{name:"moon viewing ceremony",slug:"moon_viewing_ceremony",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧧":{name:"red envelope",slug:"red_envelope",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎀":{name:"ribbon",slug:"ribbon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎁":{name:"wrapped gift",slug:"wrapped_gift",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎗️":{name:"reminder ribbon",slug:"reminder_ribbon",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎟️":{name:"admission tickets",slug:"admission_tickets",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎫":{name:"ticket",slug:"ticket",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎖️":{name:"military medal",slug:"military_medal",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏆":{name:"trophy",slug:"trophy",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏅":{name:"sports medal",slug:"sports_medal",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥇":{name:"1st place medal",slug:"1st_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥈":{name:"2nd place medal",slug:"2nd_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥉":{name:"3rd place medal",slug:"3rd_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"⚽":{name:"soccer ball",slug:"soccer_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚾":{name:"baseball",slug:"baseball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥎":{name:"softball",slug:"softball",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏀":{name:"basketball",slug:"basketball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏐":{name:"volleyball",slug:"volleyball",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏈":{name:"american football",slug:"american_football",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏉":{name:"rugby football",slug:"rugby_football",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎾":{name:"tennis",slug:"tennis",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥏":{name:"flying disc",slug:"flying_disc",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎳":{name:"bowling",slug:"bowling",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏏":{name:"cricket game",slug:"cricket_game",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏑":{name:"field hockey",slug:"field_hockey",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏒":{name:"ice hockey",slug:"ice_hockey",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥍":{name:"lacrosse",slug:"lacrosse",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏓":{name:"ping pong",slug:"ping_pong",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏸":{name:"badminton",slug:"badminton",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥊":{name:"boxing glove",slug:"boxing_glove",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥋":{name:"martial arts uniform",slug:"martial_arts_uniform",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥅":{name:"goal net",slug:"goal_net",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"⛳":{name:"flag in hole",slug:"flag_in_hole",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛸️":{name:"ice skate",slug:"ice_skate",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎣":{name:"fishing pole",slug:"fishing_pole",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤿":{name:"diving mask",slug:"diving_mask",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🎽":{name:"running shirt",slug:"running_shirt",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎿":{name:"skis",slug:"skis",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛷":{name:"sled",slug:"sled",group:"Activities",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥌":{name:"curling stone",slug:"curling_stone",group:"Activities",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🎯":{name:"bullseye",slug:"bullseye",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪀":{name:"yo-yo",slug:"yo_yo",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🪁":{name:"kite",slug:"kite",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔫":{name:"water pistol",slug:"water_pistol",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎱":{name:"pool 8 ball",slug:"pool_8_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔮":{name:"crystal ball",slug:"crystal_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪄":{name:"magic wand",slug:"magic_wand",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🎮":{name:"video game",slug:"video_game",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕹️":{name:"joystick",slug:"joystick",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎰":{name:"slot machine",slug:"slot_machine",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎲":{name:"game die",slug:"game_die",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧩":{name:"puzzle piece",slug:"puzzle_piece",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧸":{name:"teddy bear",slug:"teddy_bear",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪅":{name:"piñata",slug:"pinata",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪩":{name:"mirror ball",slug:"mirror_ball",group:"Activities",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪆":{name:"nesting dolls",slug:"nesting_dolls",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"♠️":{name:"spade suit",slug:"spade_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♥️":{name:"heart suit",slug:"heart_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♦️":{name:"diamond suit",slug:"diamond_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♣️":{name:"club suit",slug:"club_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♟️":{name:"chess pawn",slug:"chess_pawn",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🃏":{name:"joker",slug:"joker",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🀄":{name:"mahjong red dragon",slug:"mahjong_red_dragon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎴":{name:"flower playing cards",slug:"flower_playing_cards",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎭":{name:"performing arts",slug:"performing_arts",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖼️":{name:"framed picture",slug:"framed_picture",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎨":{name:"artist palette",slug:"artist_palette",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧵":{name:"thread",slug:"thread",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪡":{name:"sewing needle",slug:"sewing_needle",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧶":{name:"yarn",slug:"yarn",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪢":{name:"knot",slug:"knot",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👓":{name:"glasses",slug:"glasses",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕶️":{name:"sunglasses",slug:"sunglasses",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🥽":{name:"goggles",slug:"goggles",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥼":{name:"lab coat",slug:"lab_coat",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦺":{name:"safety vest",slug:"safety_vest",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👔":{name:"necktie",slug:"necktie",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👕":{name:"t-shirt",slug:"t_shirt",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👖":{name:"jeans",slug:"jeans",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧣":{name:"scarf",slug:"scarf",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧤":{name:"gloves",slug:"gloves",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧥":{name:"coat",slug:"coat",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧦":{name:"socks",slug:"socks",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"👗":{name:"dress",slug:"dress",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👘":{name:"kimono",slug:"kimono",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥻":{name:"sari",slug:"sari",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩱":{name:"one-piece swimsuit",slug:"one_piece_swimsuit",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩲":{name:"briefs",slug:"briefs",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩳":{name:"shorts",slug:"shorts",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👙":{name:"bikini",slug:"bikini",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👚":{name:"woman’s clothes",slug:"woman_s_clothes",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪭":{name:"folding hand fan",slug:"folding_hand_fan",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"👛":{name:"purse",slug:"purse",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👜":{name:"handbag",slug:"handbag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👝":{name:"clutch bag",slug:"clutch_bag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛍️":{name:"shopping bags",slug:"shopping_bags",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎒":{name:"backpack",slug:"backpack",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩴":{name:"thong sandal",slug:"thong_sandal",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👞":{name:"man’s shoe",slug:"man_s_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👟":{name:"running shoe",slug:"running_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥾":{name:"hiking boot",slug:"hiking_boot",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥿":{name:"flat shoe",slug:"flat_shoe",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"👠":{name:"high-heeled shoe",slug:"high_heeled_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👡":{name:"woman’s sandal",slug:"woman_s_sandal",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩰":{name:"ballet shoes",slug:"ballet_shoes",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👢":{name:"woman’s boot",slug:"woman_s_boot",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪮":{name:"hair pick",slug:"hair_pick",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"👑":{name:"crown",slug:"crown",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👒":{name:"woman’s hat",slug:"woman_s_hat",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎩":{name:"top hat",slug:"top_hat",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎓":{name:"graduation cap",slug:"graduation_cap",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧢":{name:"billed cap",slug:"billed_cap",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🪖":{name:"military helmet",slug:"military_helmet",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"⛑️":{name:"rescue worker’s helmet",slug:"rescue_worker_s_helmet",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📿":{name:"prayer beads",slug:"prayer_beads",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💄":{name:"lipstick",slug:"lipstick",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💍":{name:"ring",slug:"ring",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💎":{name:"gem stone",slug:"gem_stone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔇":{name:"muted speaker",slug:"muted_speaker",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔈":{name:"speaker low volume",slug:"speaker_low_volume",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔉":{name:"speaker medium volume",slug:"speaker_medium_volume",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔊":{name:"speaker high volume",slug:"speaker_high_volume",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📢":{name:"loudspeaker",slug:"loudspeaker",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📣":{name:"megaphone",slug:"megaphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📯":{name:"postal horn",slug:"postal_horn",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔔":{name:"bell",slug:"bell",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔕":{name:"bell with slash",slug:"bell_with_slash",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎼":{name:"musical score",slug:"musical_score",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎵":{name:"musical note",slug:"musical_note",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎶":{name:"musical notes",slug:"musical_notes",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎙️":{name:"studio microphone",slug:"studio_microphone",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎚️":{name:"level slider",slug:"level_slider",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎛️":{name:"control knobs",slug:"control_knobs",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎤":{name:"microphone",slug:"microphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎧":{name:"headphone",slug:"headphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📻":{name:"radio",slug:"radio",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎷":{name:"saxophone",slug:"saxophone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪗":{name:"accordion",slug:"accordion",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🎸":{name:"guitar",slug:"guitar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎹":{name:"musical keyboard",slug:"musical_keyboard",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎺":{name:"trumpet",slug:"trumpet",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎻":{name:"violin",slug:"violin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪕":{name:"banjo",slug:"banjo",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥁":{name:"drum",slug:"drum",group:"Objects",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🪘":{name:"long drum",slug:"long_drum",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪇":{name:"maracas",slug:"maracas",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪈":{name:"flute",slug:"flute",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪉":{name:"harp",slug:"harp",group:"Objects",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"📱":{name:"mobile phone",slug:"mobile_phone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📲":{name:"mobile phone with arrow",slug:"mobile_phone_with_arrow",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☎️":{name:"telephone",slug:"telephone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📞":{name:"telephone receiver",slug:"telephone_receiver",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📟":{name:"pager",slug:"pager",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📠":{name:"fax machine",slug:"fax_machine",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔋":{name:"battery",slug:"battery",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪫":{name:"low battery",slug:"low_battery",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🔌":{name:"electric plug",slug:"electric_plug",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💻":{name:"laptop",slug:"laptop",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖥️":{name:"desktop computer",slug:"desktop_computer",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖨️":{name:"printer",slug:"printer",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⌨️":{name:"keyboard",slug:"keyboard",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🖱️":{name:"computer mouse",slug:"computer_mouse",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖲️":{name:"trackball",slug:"trackball",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💽":{name:"computer disk",slug:"computer_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💾":{name:"floppy disk",slug:"floppy_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💿":{name:"optical disk",slug:"optical_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📀":{name:"dvd",slug:"dvd",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧮":{name:"abacus",slug:"abacus",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎥":{name:"movie camera",slug:"movie_camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎞️":{name:"film frames",slug:"film_frames",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📽️":{name:"film projector",slug:"film_projector",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎬":{name:"clapper board",slug:"clapper_board",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📺":{name:"television",slug:"television",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📷":{name:"camera",slug:"camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📸":{name:"camera with flash",slug:"camera_with_flash",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📹":{name:"video camera",slug:"video_camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📼":{name:"videocassette",slug:"videocassette",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔍":{name:"magnifying glass tilted left",slug:"magnifying_glass_tilted_left",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔎":{name:"magnifying glass tilted right",slug:"magnifying_glass_tilted_right",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕯️":{name:"candle",slug:"candle",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💡":{name:"light bulb",slug:"light_bulb",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔦":{name:"flashlight",slug:"flashlight",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏮":{name:"red paper lantern",slug:"red_paper_lantern",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪔":{name:"diya lamp",slug:"diya_lamp",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"📔":{name:"notebook with decorative cover",slug:"notebook_with_decorative_cover",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📕":{name:"closed book",slug:"closed_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📖":{name:"open book",slug:"open_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📗":{name:"green book",slug:"green_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📘":{name:"blue book",slug:"blue_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📙":{name:"orange book",slug:"orange_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📚":{name:"books",slug:"books",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📓":{name:"notebook",slug:"notebook",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📒":{name:"ledger",slug:"ledger",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📃":{name:"page with curl",slug:"page_with_curl",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📜":{name:"scroll",slug:"scroll",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📄":{name:"page facing up",slug:"page_facing_up",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📰":{name:"newspaper",slug:"newspaper",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗞️":{name:"rolled-up newspaper",slug:"rolled_up_newspaper",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📑":{name:"bookmark tabs",slug:"bookmark_tabs",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔖":{name:"bookmark",slug:"bookmark",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏷️":{name:"label",slug:"label",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💰":{name:"money bag",slug:"money_bag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪙":{name:"coin",slug:"coin",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"💴":{name:"yen banknote",slug:"yen_banknote",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💵":{name:"dollar banknote",slug:"dollar_banknote",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💶":{name:"euro banknote",slug:"euro_banknote",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💷":{name:"pound banknote",slug:"pound_banknote",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💸":{name:"money with wings",slug:"money_with_wings",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💳":{name:"credit card",slug:"credit_card",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧾":{name:"receipt",slug:"receipt",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"💹":{name:"chart increasing with yen",slug:"chart_increasing_with_yen",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✉️":{name:"envelope",slug:"envelope",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📧":{name:"e-mail",slug:"e_mail",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📨":{name:"incoming envelope",slug:"incoming_envelope",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📩":{name:"envelope with arrow",slug:"envelope_with_arrow",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📤":{name:"outbox tray",slug:"outbox_tray",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📥":{name:"inbox tray",slug:"inbox_tray",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📦":{name:"package",slug:"package",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📫":{name:"closed mailbox with raised flag",slug:"closed_mailbox_with_raised_flag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📪":{name:"closed mailbox with lowered flag",slug:"closed_mailbox_with_lowered_flag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📬":{name:"open mailbox with raised flag",slug:"open_mailbox_with_raised_flag",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📭":{name:"open mailbox with lowered flag",slug:"open_mailbox_with_lowered_flag",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📮":{name:"postbox",slug:"postbox",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗳️":{name:"ballot box with ballot",slug:"ballot_box_with_ballot",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✏️":{name:"pencil",slug:"pencil",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✒️":{name:"black nib",slug:"black_nib",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖋️":{name:"fountain pen",slug:"fountain_pen",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖊️":{name:"pen",slug:"pen",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖌️":{name:"paintbrush",slug:"paintbrush",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖍️":{name:"crayon",slug:"crayon",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📝":{name:"memo",slug:"memo",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💼":{name:"briefcase",slug:"briefcase",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📁":{name:"file folder",slug:"file_folder",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📂":{name:"open file folder",slug:"open_file_folder",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗂️":{name:"card index dividers",slug:"card_index_dividers",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📅":{name:"calendar",slug:"calendar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📆":{name:"tear-off calendar",slug:"tear_off_calendar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗒️":{name:"spiral notepad",slug:"spiral_notepad",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗓️":{name:"spiral calendar",slug:"spiral_calendar",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📇":{name:"card index",slug:"card_index",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📈":{name:"chart increasing",slug:"chart_increasing",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📉":{name:"chart decreasing",slug:"chart_decreasing",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📊":{name:"bar chart",slug:"bar_chart",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📋":{name:"clipboard",slug:"clipboard",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📌":{name:"pushpin",slug:"pushpin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📍":{name:"round pushpin",slug:"round_pushpin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📎":{name:"paperclip",slug:"paperclip",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖇️":{name:"linked paperclips",slug:"linked_paperclips",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📏":{name:"straight ruler",slug:"straight_ruler",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📐":{name:"triangular ruler",slug:"triangular_ruler",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✂️":{name:"scissors",slug:"scissors",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗃️":{name:"card file box",slug:"card_file_box",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗄️":{name:"file cabinet",slug:"file_cabinet",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗑️":{name:"wastebasket",slug:"wastebasket",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔒":{name:"locked",slug:"locked",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔓":{name:"unlocked",slug:"unlocked",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔏":{name:"locked with pen",slug:"locked_with_pen",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔐":{name:"locked with key",slug:"locked_with_key",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔑":{name:"key",slug:"key",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗝️":{name:"old key",slug:"old_key",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔨":{name:"hammer",slug:"hammer",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪓":{name:"axe",slug:"axe",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⛏️":{name:"pick",slug:"pick",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚒️":{name:"hammer and pick",slug:"hammer_and_pick",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛠️":{name:"hammer and wrench",slug:"hammer_and_wrench",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗡️":{name:"dagger",slug:"dagger",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚔️":{name:"crossed swords",slug:"crossed_swords",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💣":{name:"bomb",slug:"bomb",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪃":{name:"boomerang",slug:"boomerang",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏹":{name:"bow and arrow",slug:"bow_and_arrow",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛡️":{name:"shield",slug:"shield",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪚":{name:"carpentry saw",slug:"carpentry_saw",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🔧":{name:"wrench",slug:"wrench",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪛":{name:"screwdriver",slug:"screwdriver",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🔩":{name:"nut and bolt",slug:"nut_and_bolt",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚙️":{name:"gear",slug:"gear",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🗜️":{name:"clamp",slug:"clamp",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚖️":{name:"balance scale",slug:"balance_scale",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦯":{name:"white cane",slug:"white_cane",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔗":{name:"link",slug:"link",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛓️‍💥":{name:"broken chain",slug:"broken_chain",group:"Objects",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"⛓️":{name:"chains",slug:"chains",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪝":{name:"hook",slug:"hook",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧰":{name:"toolbox",slug:"toolbox",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧲":{name:"magnet",slug:"magnet",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪜":{name:"ladder",slug:"ladder",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪏":{name:"shovel",slug:"shovel",group:"Objects",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"⚗️":{name:"alembic",slug:"alembic",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧪":{name:"test tube",slug:"test_tube",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧫":{name:"petri dish",slug:"petri_dish",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧬":{name:"dna",slug:"dna",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🔬":{name:"microscope",slug:"microscope",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔭":{name:"telescope",slug:"telescope",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📡":{name:"satellite antenna",slug:"satellite_antenna",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💉":{name:"syringe",slug:"syringe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩸":{name:"drop of blood",slug:"drop_of_blood",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💊":{name:"pill",slug:"pill",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩹":{name:"adhesive bandage",slug:"adhesive_bandage",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩼":{name:"crutch",slug:"crutch",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🩺":{name:"stethoscope",slug:"stethoscope",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩻":{name:"x-ray",slug:"x_ray",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🚪":{name:"door",slug:"door",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛗":{name:"elevator",slug:"elevator",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪞":{name:"mirror",slug:"mirror",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪟":{name:"window",slug:"window",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🛏️":{name:"bed",slug:"bed",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛋️":{name:"couch and lamp",slug:"couch_and_lamp",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪑":{name:"chair",slug:"chair",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🚽":{name:"toilet",slug:"toilet",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪠":{name:"plunger",slug:"plunger",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚿":{name:"shower",slug:"shower",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛁":{name:"bathtub",slug:"bathtub",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪤":{name:"mouse trap",slug:"mouse_trap",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪒":{name:"razor",slug:"razor",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧴":{name:"lotion bottle",slug:"lotion_bottle",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧷":{name:"safety pin",slug:"safety_pin",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧹":{name:"broom",slug:"broom",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧺":{name:"basket",slug:"basket",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧻":{name:"roll of paper",slug:"roll_of_paper",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪣":{name:"bucket",slug:"bucket",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧼":{name:"soap",slug:"soap",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🫧":{name:"bubbles",slug:"bubbles",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪥":{name:"toothbrush",slug:"toothbrush",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧽":{name:"sponge",slug:"sponge",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧯":{name:"fire extinguisher",slug:"fire_extinguisher",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🛒":{name:"shopping cart",slug:"shopping_cart",group:"Objects",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚬":{name:"cigarette",slug:"cigarette",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚰️":{name:"coffin",slug:"coffin",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪦":{name:"headstone",slug:"headstone",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"⚱️":{name:"funeral urn",slug:"funeral_urn",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧿":{name:"nazar amulet",slug:"nazar_amulet",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪬":{name:"hamsa",slug:"hamsa",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🗿":{name:"moai",slug:"moai",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪧":{name:"placard",slug:"placard",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪪":{name:"identification card",slug:"identification_card",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏧":{name:"ATM sign",slug:"atm_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚮":{name:"litter in bin sign",slug:"litter_in_bin_sign",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚰":{name:"potable water",slug:"potable_water",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"♿":{name:"wheelchair symbol",slug:"wheelchair_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚹":{name:"men’s room",slug:"men_s_room",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚺":{name:"women’s room",slug:"women_s_room",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚻":{name:"restroom",slug:"restroom",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚼":{name:"baby symbol",slug:"baby_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚾":{name:"water closet",slug:"water_closet",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛂":{name:"passport control",slug:"passport_control",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛃":{name:"customs",slug:"customs",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛄":{name:"baggage claim",slug:"baggage_claim",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛅":{name:"left luggage",slug:"left_luggage",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⚠️":{name:"warning",slug:"warning",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚸":{name:"children crossing",slug:"children_crossing",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛔":{name:"no entry",slug:"no_entry",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚫":{name:"prohibited",slug:"prohibited",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚳":{name:"no bicycles",slug:"no_bicycles",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚭":{name:"no smoking",slug:"no_smoking",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚯":{name:"no littering",slug:"no_littering",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚱":{name:"non-potable water",slug:"non_potable_water",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚷":{name:"no pedestrians",slug:"no_pedestrians",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📵":{name:"no mobile phones",slug:"no_mobile_phones",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔞":{name:"no one under eighteen",slug:"no_one_under_eighteen",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☢️":{name:"radioactive",slug:"radioactive",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☣️":{name:"biohazard",slug:"biohazard",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⬆️":{name:"up arrow",slug:"up_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↗️":{name:"up-right arrow",slug:"up_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➡️":{name:"right arrow",slug:"right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↘️":{name:"down-right arrow",slug:"down_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬇️":{name:"down arrow",slug:"down_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↙️":{name:"down-left arrow",slug:"down_left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬅️":{name:"left arrow",slug:"left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↖️":{name:"up-left arrow",slug:"up_left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↕️":{name:"up-down arrow",slug:"up_down_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↔️":{name:"left-right arrow",slug:"left_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↩️":{name:"right arrow curving left",slug:"right_arrow_curving_left",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↪️":{name:"left arrow curving right",slug:"left_arrow_curving_right",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⤴️":{name:"right arrow curving up",slug:"right_arrow_curving_up",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⤵️":{name:"right arrow curving down",slug:"right_arrow_curving_down",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔃":{name:"clockwise vertical arrows",slug:"clockwise_vertical_arrows",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔄":{name:"counterclockwise arrows button",slug:"counterclockwise_arrows_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔙":{name:"BACK arrow",slug:"back_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔚":{name:"END arrow",slug:"end_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔛":{name:"ON! arrow",slug:"on_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔜":{name:"SOON arrow",slug:"soon_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔝":{name:"TOP arrow",slug:"top_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛐":{name:"place of worship",slug:"place_of_worship",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⚛️":{name:"atom symbol",slug:"atom_symbol",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕉️":{name:"om",slug:"om",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✡️":{name:"star of David",slug:"star_of_david",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☸️":{name:"wheel of dharma",slug:"wheel_of_dharma",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☯️":{name:"yin yang",slug:"yin_yang",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✝️":{name:"latin cross",slug:"latin_cross",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☦️":{name:"orthodox cross",slug:"orthodox_cross",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☪️":{name:"star and crescent",slug:"star_and_crescent",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☮️":{name:"peace symbol",slug:"peace_symbol",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕎":{name:"menorah",slug:"menorah",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔯":{name:"dotted six-pointed star",slug:"dotted_six_pointed_star",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪯":{name:"khanda",slug:"khanda",group:"Symbols",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"♈":{name:"Aries",slug:"aries",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♉":{name:"Taurus",slug:"taurus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♊":{name:"Gemini",slug:"gemini",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♋":{name:"Cancer",slug:"cancer",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♌":{name:"Leo",slug:"leo",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♍":{name:"Virgo",slug:"virgo",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♎":{name:"Libra",slug:"libra",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♏":{name:"Scorpio",slug:"scorpio",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♐":{name:"Sagittarius",slug:"sagittarius",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♑":{name:"Capricorn",slug:"capricorn",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♒":{name:"Aquarius",slug:"aquarius",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♓":{name:"Pisces",slug:"pisces",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛎":{name:"Ophiuchus",slug:"ophiuchus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔀":{name:"shuffle tracks button",slug:"shuffle_tracks_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔁":{name:"repeat button",slug:"repeat_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔂":{name:"repeat single button",slug:"repeat_single_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"▶️":{name:"play button",slug:"play_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏩":{name:"fast-forward button",slug:"fast_forward_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏭️":{name:"next track button",slug:"next_track_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏯️":{name:"play or pause button",slug:"play_or_pause_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"◀️":{name:"reverse button",slug:"reverse_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏪":{name:"fast reverse button",slug:"fast_reverse_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏮️":{name:"last track button",slug:"last_track_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔼":{name:"upwards button",slug:"upwards_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏫":{name:"fast up button",slug:"fast_up_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔽":{name:"downwards button",slug:"downwards_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏬":{name:"fast down button",slug:"fast_down_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏸️":{name:"pause button",slug:"pause_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏹️":{name:"stop button",slug:"stop_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏺️":{name:"record button",slug:"record_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏏️":{name:"eject button",slug:"eject_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎦":{name:"cinema",slug:"cinema",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔅":{name:"dim button",slug:"dim_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔆":{name:"bright button",slug:"bright_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📶":{name:"antenna bars",slug:"antenna_bars",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛜":{name:"wireless",slug:"wireless",group:"Symbols",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"📳":{name:"vibration mode",slug:"vibration_mode",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📴":{name:"mobile phone off",slug:"mobile_phone_off",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♀️":{name:"female sign",slug:"female_sign",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"♂️":{name:"male sign",slug:"male_sign",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"⚧️":{name:"transgender symbol",slug:"transgender_symbol",group:"Symbols",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"✖️":{name:"multiply",slug:"multiply",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➕":{name:"plus",slug:"plus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➖":{name:"minus",slug:"minus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➗":{name:"divide",slug:"divide",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟰":{name:"heavy equals sign",slug:"heavy_equals_sign",group:"Symbols",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"♾️":{name:"infinity",slug:"infinity",group:"Symbols",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"‼️":{name:"double exclamation mark",slug:"double_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⁉️":{name:"exclamation question mark",slug:"exclamation_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❓":{name:"red question mark",slug:"red_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❔":{name:"white question mark",slug:"white_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❕":{name:"white exclamation mark",slug:"white_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❗":{name:"red exclamation mark",slug:"red_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"〰️":{name:"wavy dash",slug:"wavy_dash",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💱":{name:"currency exchange",slug:"currency_exchange",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💲":{name:"heavy dollar sign",slug:"heavy_dollar_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚕️":{name:"medical symbol",slug:"medical_symbol",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"♻️":{name:"recycling symbol",slug:"recycling_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚜️":{name:"fleur-de-lis",slug:"fleur_de_lis",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔱":{name:"trident emblem",slug:"trident_emblem",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📛":{name:"name badge",slug:"name_badge",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔰":{name:"Japanese symbol for beginner",slug:"japanese_symbol_for_beginner",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⭕":{name:"hollow red circle",slug:"hollow_red_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✅":{name:"check mark button",slug:"check_mark_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☑️":{name:"check box with check",slug:"check_box_with_check",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✔️":{name:"check mark",slug:"check_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❌":{name:"cross mark",slug:"cross_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❎":{name:"cross mark button",slug:"cross_mark_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➰":{name:"curly loop",slug:"curly_loop",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➿":{name:"double curly loop",slug:"double_curly_loop",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"〽️":{name:"part alternation mark",slug:"part_alternation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✳️":{name:"eight-spoked asterisk",slug:"eight_spoked_asterisk",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✴️":{name:"eight-pointed star",slug:"eight_pointed_star",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❇️":{name:"sparkle",slug:"sparkle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"©️":{name:"copyright",slug:"copyright",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"®️":{name:"registered",slug:"registered",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"™️":{name:"trade mark",slug:"trade_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫟":{name:"splatter",slug:"splatter",group:"Symbols",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"#️⃣":{name:"keycap #",slug:"keycap_number_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"*️⃣":{name:"keycap *",slug:"keycap_asterisk",group:"Symbols",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"0️⃣":{name:"keycap 0",slug:"keycap_0",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"1️⃣":{name:"keycap 1",slug:"keycap_1",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"2️⃣":{name:"keycap 2",slug:"keycap_2",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"3️⃣":{name:"keycap 3",slug:"keycap_3",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"4️⃣":{name:"keycap 4",slug:"keycap_4",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"5️⃣":{name:"keycap 5",slug:"keycap_5",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"6️⃣":{name:"keycap 6",slug:"keycap_6",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"7️⃣":{name:"keycap 7",slug:"keycap_7",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"8️⃣":{name:"keycap 8",slug:"keycap_8",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"9️⃣":{name:"keycap 9",slug:"keycap_9",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔟":{name:"keycap 10",slug:"keycap_10",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔠":{name:"input latin uppercase",slug:"input_latin_uppercase",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔡":{name:"input latin lowercase",slug:"input_latin_lowercase",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔢":{name:"input numbers",slug:"input_numbers",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔣":{name:"input symbols",slug:"input_symbols",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔤":{name:"input latin letters",slug:"input_latin_letters",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅰️":{name:"A button (blood type)",slug:"a_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆎":{name:"AB button (blood type)",slug:"ab_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅱️":{name:"B button (blood type)",slug:"b_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆑":{name:"CL button",slug:"cl_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆒":{name:"COOL button",slug:"cool_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆓":{name:"FREE button",slug:"free_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"ℹ️":{name:"information",slug:"information",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆔":{name:"ID button",slug:"id_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"Ⓜ️":{name:"circled M",slug:"circled_m",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆕":{name:"NEW button",slug:"new_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆖":{name:"NG button",slug:"ng_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅾️":{name:"O button (blood type)",slug:"o_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆗":{name:"OK button",slug:"ok_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅿️":{name:"P button",slug:"p_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆘":{name:"SOS button",slug:"sos_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆙":{name:"UP! button",slug:"up_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆚":{name:"VS button",slug:"vs_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈁":{name:"Japanese “here” button",slug:"japanese_here_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈂️":{name:"Japanese “service charge” button",slug:"japanese_service_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈷️":{name:"Japanese “monthly amount” button",slug:"japanese_monthly_amount_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈶":{name:"Japanese “not free of charge” button",slug:"japanese_not_free_of_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈯":{name:"Japanese “reserved” button",slug:"japanese_reserved_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🉐":{name:"Japanese “bargain” button",slug:"japanese_bargain_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈹":{name:"Japanese “discount” button",slug:"japanese_discount_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈚":{name:"Japanese “free of charge” button",slug:"japanese_free_of_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈲":{name:"Japanese “prohibited” button",slug:"japanese_prohibited_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🉑":{name:"Japanese “acceptable” button",slug:"japanese_acceptable_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈸":{name:"Japanese “application” button",slug:"japanese_application_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈴":{name:"Japanese “passing grade” button",slug:"japanese_passing_grade_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈳":{name:"Japanese “vacancy” button",slug:"japanese_vacancy_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"㊗️":{name:"Japanese “congratulations” button",slug:"japanese_congratulations_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"㊙️":{name:"Japanese “secret” button",slug:"japanese_secret_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈺":{name:"Japanese “open for business” button",slug:"japanese_open_for_business_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈵":{name:"Japanese “no vacancy” button",slug:"japanese_no_vacancy_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔴":{name:"red circle",slug:"red_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟠":{name:"orange circle",slug:"orange_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟡":{name:"yellow circle",slug:"yellow_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟢":{name:"green circle",slug:"green_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔵":{name:"blue circle",slug:"blue_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟣":{name:"purple circle",slug:"purple_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟤":{name:"brown circle",slug:"brown_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⚫":{name:"black circle",slug:"black_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚪":{name:"white circle",slug:"white_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟥":{name:"red square",slug:"red_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟧":{name:"orange square",slug:"orange_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟨":{name:"yellow square",slug:"yellow_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟩":{name:"green square",slug:"green_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟦":{name:"blue square",slug:"blue_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟪":{name:"purple square",slug:"purple_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟫":{name:"brown square",slug:"brown_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⬛":{name:"black large square",slug:"black_large_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬜":{name:"white large square",slug:"white_large_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◼️":{name:"black medium square",slug:"black_medium_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◻️":{name:"white medium square",slug:"white_medium_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◾":{name:"black medium-small square",slug:"black_medium_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◽":{name:"white medium-small square",slug:"white_medium_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"▪️":{name:"black small square",slug:"black_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"▫️":{name:"white small square",slug:"white_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔶":{name:"large orange diamond",slug:"large_orange_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔷":{name:"large blue diamond",slug:"large_blue_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔸":{name:"small orange diamond",slug:"small_orange_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔹":{name:"small blue diamond",slug:"small_blue_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔺":{name:"red triangle pointed up",slug:"red_triangle_pointed_up",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔻":{name:"red triangle pointed down",slug:"red_triangle_pointed_down",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💠":{name:"diamond with a dot",slug:"diamond_with_a_dot",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔘":{name:"radio button",slug:"radio_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔳":{name:"white square button",slug:"white_square_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔲":{name:"black square button",slug:"black_square_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏁":{name:"chequered flag",slug:"chequered_flag",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚩":{name:"triangular flag",slug:"triangular_flag",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎌":{name:"crossed flags",slug:"crossed_flags",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏴":{name:"black flag",slug:"black_flag",group:"Flags",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏳️":{name:"white flag",slug:"white_flag",group:"Flags",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏳️‍🌈":{name:"rainbow flag",slug:"rainbow_flag",group:"Flags",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🏳️‍⚧️":{name:"transgender flag",slug:"transgender_flag",group:"Flags",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏴‍☠️":{name:"pirate flag",slug:"pirate_flag",group:"Flags",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🇦🇨":{name:"flag Ascension Island",slug:"flag_ascension_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇩":{name:"flag Andorra",slug:"flag_andorra",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇪":{name:"flag United Arab Emirates",slug:"flag_united_arab_emirates",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇫":{name:"flag Afghanistan",slug:"flag_afghanistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇬":{name:"flag Antigua & Barbuda",slug:"flag_antigua_barbuda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇮":{name:"flag Anguilla",slug:"flag_anguilla",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇱":{name:"flag Albania",slug:"flag_albania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇲":{name:"flag Armenia",slug:"flag_armenia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇴":{name:"flag Angola",slug:"flag_angola",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇶":{name:"flag Antarctica",slug:"flag_antarctica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇷":{name:"flag Argentina",slug:"flag_argentina",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇸":{name:"flag American Samoa",slug:"flag_american_samoa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇹":{name:"flag Austria",slug:"flag_austria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇺":{name:"flag Australia",slug:"flag_australia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇼":{name:"flag Aruba",slug:"flag_aruba",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇽":{name:"flag Åland Islands",slug:"flag_aland_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇿":{name:"flag Azerbaijan",slug:"flag_azerbaijan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇦":{name:"flag Bosnia & Herzegovina",slug:"flag_bosnia_herzegovina",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇧":{name:"flag Barbados",slug:"flag_barbados",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇩":{name:"flag Bangladesh",slug:"flag_bangladesh",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇪":{name:"flag Belgium",slug:"flag_belgium",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇫":{name:"flag Burkina Faso",slug:"flag_burkina_faso",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇬":{name:"flag Bulgaria",slug:"flag_bulgaria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇭":{name:"flag Bahrain",slug:"flag_bahrain",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇮":{name:"flag Burundi",slug:"flag_burundi",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇯":{name:"flag Benin",slug:"flag_benin",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇱":{name:"flag St. Barthélemy",slug:"flag_st_barthelemy",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇲":{name:"flag Bermuda",slug:"flag_bermuda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇳":{name:"flag Brunei",slug:"flag_brunei",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇴":{name:"flag Bolivia",slug:"flag_bolivia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇶":{name:"flag Caribbean Netherlands",slug:"flag_caribbean_netherlands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇷":{name:"flag Brazil",slug:"flag_brazil",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇸":{name:"flag Bahamas",slug:"flag_bahamas",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇹":{name:"flag Bhutan",slug:"flag_bhutan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇻":{name:"flag Bouvet Island",slug:"flag_bouvet_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇼":{name:"flag Botswana",slug:"flag_botswana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇾":{name:"flag Belarus",slug:"flag_belarus",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇿":{name:"flag Belize",slug:"flag_belize",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇦":{name:"flag Canada",slug:"flag_canada",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇨":{name:"flag Cocos (Keeling) Islands",slug:"flag_cocos_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇩":{name:"flag Congo - Kinshasa",slug:"flag_congo_kinshasa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇫":{name:"flag Central African Republic",slug:"flag_central_african_republic",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇬":{name:"flag Congo - Brazzaville",slug:"flag_congo_brazzaville",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇭":{name:"flag Switzerland",slug:"flag_switzerland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇮":{name:"flag Côte d’Ivoire",slug:"flag_cote_d_ivoire",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇰":{name:"flag Cook Islands",slug:"flag_cook_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇱":{name:"flag Chile",slug:"flag_chile",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇲":{name:"flag Cameroon",slug:"flag_cameroon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇳":{name:"flag China",slug:"flag_china",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇨🇴":{name:"flag Colombia",slug:"flag_colombia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇵":{name:"flag Clipperton Island",slug:"flag_clipperton_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇶":{name:"flag Sark",slug:"flag_sark",group:"Flags",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🇨🇷":{name:"flag Costa Rica",slug:"flag_costa_rica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇺":{name:"flag Cuba",slug:"flag_cuba",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇻":{name:"flag Cape Verde",slug:"flag_cape_verde",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇼":{name:"flag Curaçao",slug:"flag_curacao",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇽":{name:"flag Christmas Island",slug:"flag_christmas_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇾":{name:"flag Cyprus",slug:"flag_cyprus",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇿":{name:"flag Czechia",slug:"flag_czechia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇪":{name:"flag Germany",slug:"flag_germany",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇩🇬":{name:"flag Diego Garcia",slug:"flag_diego_garcia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇯":{name:"flag Djibouti",slug:"flag_djibouti",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇰":{name:"flag Denmark",slug:"flag_denmark",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇲":{name:"flag Dominica",slug:"flag_dominica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇴":{name:"flag Dominican Republic",slug:"flag_dominican_republic",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇿":{name:"flag Algeria",slug:"flag_algeria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇦":{name:"flag Ceuta & Melilla",slug:"flag_ceuta_melilla",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇨":{name:"flag Ecuador",slug:"flag_ecuador",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇪":{name:"flag Estonia",slug:"flag_estonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇬":{name:"flag Egypt",slug:"flag_egypt",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇭":{name:"flag Western Sahara",slug:"flag_western_sahara",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇷":{name:"flag Eritrea",slug:"flag_eritrea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇸":{name:"flag Spain",slug:"flag_spain",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇪🇹":{name:"flag Ethiopia",slug:"flag_ethiopia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇺":{name:"flag European Union",slug:"flag_european_union",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇮":{name:"flag Finland",slug:"flag_finland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇯":{name:"flag Fiji",slug:"flag_fiji",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇰":{name:"flag Falkland Islands",slug:"flag_falkland_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇲":{name:"flag Micronesia",slug:"flag_micronesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇴":{name:"flag Faroe Islands",slug:"flag_faroe_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇷":{name:"flag France",slug:"flag_france",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇬🇦":{name:"flag Gabon",slug:"flag_gabon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇧":{name:"flag United Kingdom",slug:"flag_united_kingdom",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇬🇩":{name:"flag Grenada",slug:"flag_grenada",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇪":{name:"flag Georgia",slug:"flag_georgia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇫":{name:"flag French Guiana",slug:"flag_french_guiana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇬":{name:"flag Guernsey",slug:"flag_guernsey",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇭":{name:"flag Ghana",slug:"flag_ghana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇮":{name:"flag Gibraltar",slug:"flag_gibraltar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇱":{name:"flag Greenland",slug:"flag_greenland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇲":{name:"flag Gambia",slug:"flag_gambia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇳":{name:"flag Guinea",slug:"flag_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇵":{name:"flag Guadeloupe",slug:"flag_guadeloupe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇶":{name:"flag Equatorial Guinea",slug:"flag_equatorial_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇷":{name:"flag Greece",slug:"flag_greece",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇸":{name:"flag South Georgia & South Sandwich Islands",slug:"flag_south_georgia_south_sandwich_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇹":{name:"flag Guatemala",slug:"flag_guatemala",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇺":{name:"flag Guam",slug:"flag_guam",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇼":{name:"flag Guinea-Bissau",slug:"flag_guinea_bissau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇾":{name:"flag Guyana",slug:"flag_guyana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇰":{name:"flag Hong Kong SAR China",slug:"flag_hong_kong_sar_china",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇲":{name:"flag Heard & McDonald Islands",slug:"flag_heard_mcdonald_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇳":{name:"flag Honduras",slug:"flag_honduras",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇷":{name:"flag Croatia",slug:"flag_croatia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇹":{name:"flag Haiti",slug:"flag_haiti",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇺":{name:"flag Hungary",slug:"flag_hungary",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇨":{name:"flag Canary Islands",slug:"flag_canary_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇩":{name:"flag Indonesia",slug:"flag_indonesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇪":{name:"flag Ireland",slug:"flag_ireland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇱":{name:"flag Israel",slug:"flag_israel",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇲":{name:"flag Isle of Man",slug:"flag_isle_of_man",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇳":{name:"flag India",slug:"flag_india",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇴":{name:"flag British Indian Ocean Territory",slug:"flag_british_indian_ocean_territory",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇶":{name:"flag Iraq",slug:"flag_iraq",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇷":{name:"flag Iran",slug:"flag_iran",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇸":{name:"flag Iceland",slug:"flag_iceland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇹":{name:"flag Italy",slug:"flag_italy",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇯🇪":{name:"flag Jersey",slug:"flag_jersey",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇲":{name:"flag Jamaica",slug:"flag_jamaica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇴":{name:"flag Jordan",slug:"flag_jordan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇵":{name:"flag Japan",slug:"flag_japan",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇰🇪":{name:"flag Kenya",slug:"flag_kenya",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇬":{name:"flag Kyrgyzstan",slug:"flag_kyrgyzstan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇭":{name:"flag Cambodia",slug:"flag_cambodia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇮":{name:"flag Kiribati",slug:"flag_kiribati",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇲":{name:"flag Comoros",slug:"flag_comoros",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇳":{name:"flag St. Kitts & Nevis",slug:"flag_st_kitts_nevis",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇵":{name:"flag North Korea",slug:"flag_north_korea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇷":{name:"flag South Korea",slug:"flag_south_korea",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇰🇼":{name:"flag Kuwait",slug:"flag_kuwait",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇾":{name:"flag Cayman Islands",slug:"flag_cayman_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇿":{name:"flag Kazakhstan",slug:"flag_kazakhstan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇦":{name:"flag Laos",slug:"flag_laos",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇧":{name:"flag Lebanon",slug:"flag_lebanon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇨":{name:"flag St. Lucia",slug:"flag_st_lucia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇮":{name:"flag Liechtenstein",slug:"flag_liechtenstein",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇰":{name:"flag Sri Lanka",slug:"flag_sri_lanka",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇷":{name:"flag Liberia",slug:"flag_liberia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇸":{name:"flag Lesotho",slug:"flag_lesotho",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇹":{name:"flag Lithuania",slug:"flag_lithuania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇺":{name:"flag Luxembourg",slug:"flag_luxembourg",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇻":{name:"flag Latvia",slug:"flag_latvia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇾":{name:"flag Libya",slug:"flag_libya",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇦":{name:"flag Morocco",slug:"flag_morocco",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇨":{name:"flag Monaco",slug:"flag_monaco",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇩":{name:"flag Moldova",slug:"flag_moldova",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇪":{name:"flag Montenegro",slug:"flag_montenegro",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇫":{name:"flag St. Martin",slug:"flag_st_martin",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇬":{name:"flag Madagascar",slug:"flag_madagascar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇭":{name:"flag Marshall Islands",slug:"flag_marshall_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇰":{name:"flag North Macedonia",slug:"flag_north_macedonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇱":{name:"flag Mali",slug:"flag_mali",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇲":{name:"flag Myanmar (Burma)",slug:"flag_myanmar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇳":{name:"flag Mongolia",slug:"flag_mongolia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇴":{name:"flag Macao SAR China",slug:"flag_macao_sar_china",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇵":{name:"flag Northern Mariana Islands",slug:"flag_northern_mariana_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇶":{name:"flag Martinique",slug:"flag_martinique",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇷":{name:"flag Mauritania",slug:"flag_mauritania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇸":{name:"flag Montserrat",slug:"flag_montserrat",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇹":{name:"flag Malta",slug:"flag_malta",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇺":{name:"flag Mauritius",slug:"flag_mauritius",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇻":{name:"flag Maldives",slug:"flag_maldives",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇼":{name:"flag Malawi",slug:"flag_malawi",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇽":{name:"flag Mexico",slug:"flag_mexico",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇾":{name:"flag Malaysia",slug:"flag_malaysia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇿":{name:"flag Mozambique",slug:"flag_mozambique",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇦":{name:"flag Namibia",slug:"flag_namibia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇨":{name:"flag New Caledonia",slug:"flag_new_caledonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇪":{name:"flag Niger",slug:"flag_niger",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇫":{name:"flag Norfolk Island",slug:"flag_norfolk_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇬":{name:"flag Nigeria",slug:"flag_nigeria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇮":{name:"flag Nicaragua",slug:"flag_nicaragua",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇱":{name:"flag Netherlands",slug:"flag_netherlands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇴":{name:"flag Norway",slug:"flag_norway",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇵":{name:"flag Nepal",slug:"flag_nepal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇷":{name:"flag Nauru",slug:"flag_nauru",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇺":{name:"flag Niue",slug:"flag_niue",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇿":{name:"flag New Zealand",slug:"flag_new_zealand",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇴🇲":{name:"flag Oman",slug:"flag_oman",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇦":{name:"flag Panama",slug:"flag_panama",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇪":{name:"flag Peru",slug:"flag_peru",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇫":{name:"flag French Polynesia",slug:"flag_french_polynesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇬":{name:"flag Papua New Guinea",slug:"flag_papua_new_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇭":{name:"flag Philippines",slug:"flag_philippines",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇰":{name:"flag Pakistan",slug:"flag_pakistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇱":{name:"flag Poland",slug:"flag_poland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇲":{name:"flag St. Pierre & Miquelon",slug:"flag_st_pierre_miquelon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇳":{name:"flag Pitcairn Islands",slug:"flag_pitcairn_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇷":{name:"flag Puerto Rico",slug:"flag_puerto_rico",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇸":{name:"flag Palestinian Territories",slug:"flag_palestinian_territories",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇹":{name:"flag Portugal",slug:"flag_portugal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇼":{name:"flag Palau",slug:"flag_palau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇾":{name:"flag Paraguay",slug:"flag_paraguay",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇶🇦":{name:"flag Qatar",slug:"flag_qatar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇪":{name:"flag Réunion",slug:"flag_reunion",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇴":{name:"flag Romania",slug:"flag_romania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇸":{name:"flag Serbia",slug:"flag_serbia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇺":{name:"flag Russia",slug:"flag_russia",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇷🇼":{name:"flag Rwanda",slug:"flag_rwanda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇦":{name:"flag Saudi Arabia",slug:"flag_saudi_arabia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇧":{name:"flag Solomon Islands",slug:"flag_solomon_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇨":{name:"flag Seychelles",slug:"flag_seychelles",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇩":{name:"flag Sudan",slug:"flag_sudan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇪":{name:"flag Sweden",slug:"flag_sweden",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇬":{name:"flag Singapore",slug:"flag_singapore",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇭":{name:"flag St. Helena",slug:"flag_st_helena",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇮":{name:"flag Slovenia",slug:"flag_slovenia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇯":{name:"flag Svalbard & Jan Mayen",slug:"flag_svalbard_jan_mayen",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇰":{name:"flag Slovakia",slug:"flag_slovakia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇱":{name:"flag Sierra Leone",slug:"flag_sierra_leone",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇲":{name:"flag San Marino",slug:"flag_san_marino",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇳":{name:"flag Senegal",slug:"flag_senegal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇴":{name:"flag Somalia",slug:"flag_somalia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇷":{name:"flag Suriname",slug:"flag_suriname",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇸":{name:"flag South Sudan",slug:"flag_south_sudan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇹":{name:"flag São Tomé & Príncipe",slug:"flag_sao_tome_principe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇻":{name:"flag El Salvador",slug:"flag_el_salvador",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇽":{name:"flag Sint Maarten",slug:"flag_sint_maarten",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇾":{name:"flag Syria",slug:"flag_syria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇿":{name:"flag Eswatini",slug:"flag_eswatini",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇦":{name:"flag Tristan da Cunha",slug:"flag_tristan_da_cunha",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇨":{name:"flag Turks & Caicos Islands",slug:"flag_turks_caicos_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇩":{name:"flag Chad",slug:"flag_chad",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇫":{name:"flag French Southern Territories",slug:"flag_french_southern_territories",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇬":{name:"flag Togo",slug:"flag_togo",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇭":{name:"flag Thailand",slug:"flag_thailand",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇯":{name:"flag Tajikistan",slug:"flag_tajikistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇰":{name:"flag Tokelau",slug:"flag_tokelau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇱":{name:"flag Timor-Leste",slug:"flag_timor_leste",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇲":{name:"flag Turkmenistan",slug:"flag_turkmenistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇳":{name:"flag Tunisia",slug:"flag_tunisia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇴":{name:"flag Tonga",slug:"flag_tonga",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇷":{name:"flag Türkiye",slug:"flag_turkiye",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇹":{name:"flag Trinidad & Tobago",slug:"flag_trinidad_tobago",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇻":{name:"flag Tuvalu",slug:"flag_tuvalu",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇼":{name:"flag Taiwan",slug:"flag_taiwan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇿":{name:"flag Tanzania",slug:"flag_tanzania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇦":{name:"flag Ukraine",slug:"flag_ukraine",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇬":{name:"flag Uganda",slug:"flag_uganda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇲":{name:"flag U.S. Outlying Islands",slug:"flag_u_s_outlying_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇳":{name:"flag United Nations",slug:"flag_united_nations",group:"Flags",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🇺🇸":{name:"flag United States",slug:"flag_united_states",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇺🇾":{name:"flag Uruguay",slug:"flag_uruguay",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇿":{name:"flag Uzbekistan",slug:"flag_uzbekistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇦":{name:"flag Vatican City",slug:"flag_vatican_city",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇨":{name:"flag St. Vincent & Grenadines",slug:"flag_st_vincent_grenadines",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇪":{name:"flag Venezuela",slug:"flag_venezuela",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇬":{name:"flag British Virgin Islands",slug:"flag_british_virgin_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇮":{name:"flag U.S. Virgin Islands",slug:"flag_u_s_virgin_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇳":{name:"flag Vietnam",slug:"flag_vietnam",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇺":{name:"flag Vanuatu",slug:"flag_vanuatu",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇼🇫":{name:"flag Wallis & Futuna",slug:"flag_wallis_futuna",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇼🇸":{name:"flag Samoa",slug:"flag_samoa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇽🇰":{name:"flag Kosovo",slug:"flag_kosovo",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇾🇪":{name:"flag Yemen",slug:"flag_yemen",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇾🇹":{name:"flag Mayotte",slug:"flag_mayotte",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇦":{name:"flag South Africa",slug:"flag_south_africa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇲":{name:"flag Zambia",slug:"flag_zambia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇼":{name:"flag Zimbabwe",slug:"flag_zimbabwe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🏴󠁧󠁢󠁥󠁮󠁧󠁿":{name:"flag England",slug:"flag_england",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🏴󠁧󠁢󠁳󠁣󠁴󠁿":{name:"flag Scotland",slug:"flag_scotland",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🏴󠁧󠁢󠁷󠁬󠁳󠁿":{name:"flag Wales",slug:"flag_wales",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1}};function bT(n,e){const t=n.target;x(e,N(t.value))}var xT=(n,e)=>e("recent"),wT=fe("<button>Recent</button>"),kT=(n,e,t)=>e(t()),ST=fe("<button> </button>"),CT=fe('<div class="flex border-b border-base-content/20 overflow-x-auto"><!> <!></div>'),PT=(n,e,t)=>e(s(t).emoji),IT=fe('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),MT=(n,e,t)=>e(s(t)),AT=fe('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),TT=(n,e,t)=>e(s(t).emoji),LT=fe('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),FT=fe('<div class="text-center text-base-content/60 py-8">No emojis found</div>'),$T=fe('<div class="emoji-picker fixed z-50 bg-base-100 border border-base-content/20 rounded-lg shadow-lg svelte-hsh18a"><div class="p-3 border-b border-base-content/20"><input type="text" placeholder="Search emojis..." class="input input-sm w-full bg-base-200"></div> <!> <div class="p-2 overflow-y-auto" style="height: calc(100% - 120px);"><div class="grid grid-cols-8 gap-1"><!></div> <!></div></div>');function ET(n,e){gd(e,!0);const t=wp(),o=()=>ya(l,"$recentlyUsed",t),i=mv();let r=Ws(e,"show",15,!1),a=Ws(e,"position",27,()=>N({x:0,y:0}));const l=ly("emoji-recently-used",[]);let c=ae(""),d=ae("smileys");const m=(()=>{const C={smileys:{name:"Smileys & Emotion",emojis:[]},people:{name:"People & Body",emojis:[]},animals:{name:"Animals & Nature",emojis:[]},food:{name:"Food & Drink",emojis:[]},activities:{name:"Activities",emojis:[]},travel:{name:"Travel & Places",emojis:[]},objects:{name:"Objects",emojis:[]},symbols:{name:"Symbols",emojis:[]},flags:{name:"Flags",emojis:[]}};return Object.entries(yT).forEach(([M,F])=>{var R;if(!M||!F.name)return;const V={emoji:M,name:F.name,keywords:F.keywords||[]},j=((R=F.group)==null?void 0:R.toLowerCase())||"",D=F.name.toLowerCase();j.includes("smileys")||j.includes("emotion")||D.includes("face")||D.includes("smile")||D.includes("laugh")||D.includes("cry")?C.smileys.emojis.push(V):j.includes("people")||j.includes("body")||D.includes("hand")||D.includes("body")||D.includes("person")||D.includes("man")||D.includes("woman")?C.people.emojis.push(V):j.includes("animals")||j.includes("nature")||D.includes("animal")||D.includes("cat")||D.includes("dog")||D.includes("bird")||D.includes("plant")||D.includes("tree")?C.animals.emojis.push(V):j.includes("food")||j.includes("drink")||D.includes("food")||D.includes("fruit")||D.includes("drink")||D.includes("coffee")||D.includes("pizza")?C.food.emojis.push(V):j.includes("activities")||j.includes("sport")||D.includes("sport")||D.includes("ball")||D.includes("game")?C.activities.emojis.push(V):j.includes("travel")||j.includes("places")||D.includes("car")||D.includes("plane")||D.includes("train")||D.includes("building")?C.travel.emojis.push(V):j.includes("objects")||D.includes("phone")||D.includes("computer")||D.includes("book")||D.includes("tool")?C.objects.emojis.push(V):j.includes("flags")||D.includes("flag")?C.flags.emojis.push(V):C.symbols.emojis.push(V)}),C})(),h=vt(()=>{var C;return s(c)?Object.values(m).flatMap(M=>M.emojis).filter(M=>M.emoji.includes(s(c))||M.name.toLowerCase().includes(s(c).toLowerCase())||M.keywords.some(F=>F.toLowerCase().includes(s(c).toLowerCase()))):((C=m[s(d)])==null?void 0:C.emojis)||[]});function _(C){l.update(M=>{const F=M.filter(V=>V!==C);return[C,...F].slice(0,20)}),i("select",{emoji:C}),r(!1)}function w(C){x(d,N(C)),x(c,"")}function S(C){C.target.closest(".emoji-picker")||r(!1)}fv(()=>{if(typeof document<"u")return document.addEventListener("click",S),()=>{document.removeEventListener("click",S)}});var P=Ln(),I=Dt(P);Te(I,r,C=>{var M=$T(),F=g(M),V=g(F);Qt(V),V.__input=[bT,c],f(F);var j=u(F,2);Te(j,()=>!s(c),Z=>{var G=CT(),se=g(G);Te(se,()=>o().length>0,oe=>{var ee=wT();ee.__click=[xT,w],Se(()=>Us(ee,`px-3 py-2 text-xs whitespace-nowrap border-b-2 transition-colors ${(s(d)==="recent"?"border-primary text-primary":"border-transparent hover:text-primary")??""}`)),z(oe,ee)});var Y=u(se,2);vs(Y,17,()=>Object.entries(m),Vs,(oe,ee)=>{let re=()=>s(ee)[0],me=()=>s(ee)[1];var K=ST();K.__click=[kT,w,re];var ye=g(K,!0);f(K),Se(()=>{Us(K,`px-3 py-2 text-xs whitespace-nowrap border-b-2 transition-colors ${(s(d)===re()?"border-primary text-primary":"border-transparent hover:text-primary")??""}`),ze(ye,me().name)}),z(oe,K)}),f(G),z(Z,G)});var D=u(j,2),R=g(D),W=g(R);Te(W,()=>s(c),Z=>{var G=Ln(),se=Dt(G);vs(se,17,()=>s(h),Vs,(Y,oe)=>{var ee=IT();ee.__click=[PT,_,oe];var re=g(ee,!0);f(ee),Se(()=>{zt(ee,"title",s(oe).name),ze(re,s(oe).emoji)}),z(Y,ee)}),z(Z,G)},Z=>{var G=Ln(),se=Dt(G);Te(se,()=>s(d)==="recent"&&o().length>0,Y=>{var oe=Ln(),ee=Dt(oe);vs(ee,1,o,Vs,(re,me)=>{var K=AT();K.__click=[MT,_,me];var ye=g(K,!0);f(K),Se(()=>{zt(K,"title",s(me)),ze(ye,s(me))}),z(re,K)}),z(Y,oe)},Y=>{var oe=Ln(),ee=Dt(oe);vs(ee,17,()=>s(h),Vs,(re,me)=>{var K=LT();K.__click=[TT,_,me];var ye=g(K,!0);f(K),Se(()=>{zt(K,"title",s(me).name),ze(ye,s(me).emoji)}),z(re,K)}),z(Y,oe)},!0),z(Z,G)}),f(R);var J=u(R,2);Te(J,()=>s(c)&&s(h).length===0,Z=>{var G=FT();z(Z,G)}),f(D),f(M),Se(()=>{zt(M,"style",`left: ${a().x??""}px; top: ${a().y??""}px; width: 320px; height: 400px;`),Jd(V,s(c))}),z(C,M)}),z(n,P),hd()}qu(["input","click"]);function NT(n,e){e("reset")}function DT(n,e){e("confirm")}function jT(n,e){n.target.classList.contains("modal-backdrop")&&e()}var RT=n=>n.stopPropagation(),BT=fe(`<div><input type="checkbox" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 focus:ring-2
                       sm:w-4 sm:h-4 touch-manipulation"> <input type="number" step="0.001" min="0" max="10"> <button class="w-10 h-10 rounded border-2 border-gray-300 hover:border-gray-400 transition-colors
                       sm:w-8 sm:h-8 touch-manipulation" title="Change color"></button> <span> </span></div>`),OT=fe(`<div class="fixed inset-0 bg-transparent flex items-center justify-center z-[9999] modal-backdrop"><div><div><h3>Fibonacci Settings</h3> <button title="Close"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-4 max-h-[60vh] overflow-y-auto svelte-ah2kky"><div class="space-y-3"></div></div> <div><button>🔁 Reset</button> <div class="flex gap-3 w-full sm:w-auto sm:gap-2"><button>❌ Cancel</button> <button class="px-6 py-3 text-sm rounded bg-blue-600 hover:bg-blue-700 text-white transition-colors
                   touch-manipulation min-h-[44px] flex-1 sm:flex-none
                   sm:px-4 sm:py-2 sm:min-h-[36px]">✅ Confirm</button></div></div></div></div>`),zT=fe('<div class="fixed z-[10000]"><!></div>'),VT=fe("<!> <!>",1);function WT(n,e){gd(e,!1);let t=Ws(e,"visible",8,!1),o=Ws(e,"levels",24,()=>[]),i=Ws(e,"theme",8,"dark");const r=mv();let a=Qd(!1),l=Qd(-1),c=Qd({x:0,y:0});function d(I,C,M){r("levelChange",{index:I,field:C,value:M})}function p(I,C){x(l,C),x(c,{x:I.clientX,y:I.clientY}),x(a,!0)}function m(I){s(l)>=0&&d(s(l),"color",I.detail),x(a,!1)}function h(){x(a,!1),x(l,-1)}function _(){r("cancel")}Bv();var w=VT(),S=Dt(w);Te(S,t,I=>{var C=OT();C.__click=[jT,_];var M=g(C);M.__click=[RT];var F=g(M),V=g(F),j=u(V,2);j.__click=_;var D=g(j);f(j),f(F);var R=u(F,2),W=g(R);vs(W,5,o,Vs,(oe,ee,re)=>{var me=BT(),K=g(me);Qt(K),K.__change=()=>d(re,"visible",s(ee).visible);var ye=u(K,2);Qt(ye),ye.__change=()=>d(re,"value",s(ee).value);var Me=u(ye,2);Me.__click=Ge=>p(Ge,re);var Fe=u(Me,2),Ze=g(Fe,!0);Se(()=>ze(Ze,s(ee).value===0?"Start":s(ee).value===1?"End":`${(s(ee).value*100).toFixed(1)}%`)),f(Fe),f(me),Se(()=>{Us(me,`flex items-center gap-3 p-3 rounded-lg ${(i()==="dark"?"bg-[#2a2a2a]":"bg-gray-50")??""}
                        sm:gap-4 sm:p-4`),Us(ye,`w-24 px-3 py-2 text-sm rounded border touch-manipulation
                       sm:w-20 sm:px-2 sm:py-1
                       ${(i()==="dark"?"bg-[#3a3a3a] border-[#555] text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500")??""} 
                       focus:outline-none focus:ring-1 focus:ring-blue-500`),zt(Me,"style",`background-color: ${s(ee).color??""}`),Us(Fe,`text-sm ${(i()==="dark"?"text-gray-300":"text-gray-700")??""} flex-1
                           sm:text-sm`)}),zf(K,()=>s(ee).visible,Ge=>(s(ee).visible=Ge,Ay(()=>o()))),po(ye,()=>s(ee).value,Ge=>(s(ee).value=Ge,Ay(()=>o()))),z(oe,me)}),f(W),f(R);var J=u(R,2),Z=g(J);Z.__click=[NT,r];var G=u(Z,2),se=g(G);se.__click=_;var Y=u(se,2);Y.__click=[DT,r],f(G),f(J),f(M),f(C),Se(()=>{Us(M,`relative ${(i()==="dark"?"bg-[#1a1a1a] border-[#404040]":"bg-white border-gray-200")??""} 
             rounded-lg shadow-xl border max-w-md w-full mx-4 max-h-[80vh] overflow-hidden
             sm:max-w-lg md:max-w-xl lg:max-w-2xl svelte-ah2kky`),Us(F,`flex items-center justify-between p-4 border-b ${(i()==="dark"?"border-[#404040]":"border-gray-200")??""}`),Us(V,`text-lg font-semibold ${(i()==="dark"?"text-white":"text-gray-900")??""}`),Us(j,`w-8 h-8 rounded-full ${(i()==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} 
                 flex items-center justify-center transition-colors`),zh(D,`w-5 h-5 ${(i()==="dark"?"text-gray-400":"text-gray-600")??""}`),Us(J,`flex items-center justify-between p-4 border-t ${(i()==="dark"?"border-[#404040]":"border-gray-200")??""}
                  sm:flex-row flex-col gap-3 sm:gap-0`),Us(Z,`px-6 py-3 text-sm rounded ${(i()==="dark"?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700")??""} 
                 transition-colors touch-manipulation min-h-[44px] w-full sm:w-auto
                 sm:px-4 sm:py-2 sm:min-h-[36px]`),Us(se,`px-6 py-3 text-sm rounded ${(i()==="dark"?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700")??""} 
                   transition-colors touch-manipulation min-h-[44px] flex-1 sm:flex-none
                   sm:px-4 sm:py-2 sm:min-h-[36px]`)}),z(I,C)});var P=u(S,2);Te(P,()=>s(a),I=>{var C=zT(),M=g(C),F=Rv(()=>{var V;return((V=o()[s(l)])==null?void 0:V.color)||"#FF6B6B"});Pf(M,{get selectedColor(){return s(F)},get show(){return s(a)},$$events:{colorChange:m,close:h}}),f(C),Se(()=>zt(C,"style",`left: ${s(c).x??""}px; top: ${s(c).y??""}px;`)),z(I,C)}),z(n,w),hd()}qu(["click","change"]);const vy=zp(!1);function dm(){vy.set(!0)}function o1(){vy.set(!1)}function s1(){return tv(vy)===!0}function qT(n,e,t){e.fontWeight=e.fontWeight==="bold"?"normal":"bold",t()}function HT(n,e){e(n)}function UT(n,e,t,o,i,r,a){n.stopPropagation();const l=n.target.getBoundingClientRect();x(e,"line"),x(t,N(o.color)),x(i,N(o.opacity)),x(r,N({x:Math.max(10,Math.min(l.left,window.innerWidth-320)),y:Math.max(10,Math.min(l.bottom+5,window.innerHeight-400))})),x(a,!0)}function GT(n,e,t,o,i,r,a){x(e,"textColor"),x(t,N(o.textColor)),x(i,N(s(r))),x(a,!0)}function YT(n,e,t,o,i,r,a){x(e,"textBg"),x(t,N(o.backgroundColor)),x(i,N(s(r))),x(a,!0)}function KT(n,e){n.preventDefault(),n.stopPropagation(),e()}var ZT=fe('<div class="pro-active-indicator absolute bottom-[3px] left-1/2 transform -translate-x-1/2 w-[4px] h-[4px] rounded-full svelte-t6isn6" style="background: var(--menu-accent);"></div>'),XT=(n,e,t)=>e(s(t)),JT=fe('<div class="submenu-portal svelte-t6isn6"></div>'),QT=fe(`<div class="pro-submenu-arrow flex items-center justify-center absolute top-1/2 right-0 transform -translate-y-1/2
               w-5 h-5 opacity-0 group-hover:opacity-100 hover:opacity-100 transition-all duration-150 cubic-bezier(0.4, 0, 0.2, 1)
               bg-[var(--menu-btn-bg)] border border-[var(--menu-btn-border)] rounded-full
               hover:bg-[var(--menu-hover-bg)] hover:border-[var(--menu-btn-hover-border)] cursor-pointer z-20 backdrop-blur-[8px] svelte-t6isn6" style="backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); box-shadow: 0 1px 3px rgba(0,0,0,0.1);"><svg class="w-2.5 h-2.5 transition-all duration-150 cubic-bezier(0.4, 0, 0.2, 1) text-[var(--menu-text)] svelte-t6isn6" viewBox="0 0 8 12" fill="currentColor"><path d="M1.705 0.295C1.315 -0.095 0.685 -0.095 0.295 0.295C-0.095 0.685 -0.095 1.315 0.295 1.705L5.59 7L0.295 12.295C-0.095 12.685 -0.095 13.315 0.295 13.705C0.685 14.095 1.315 14.095 1.705 13.705L7.705 7.705C8.095 7.315 8.095 6.685 7.705 6.295L1.705 0.295Z" class="svelte-t6isn6"></path></svg></div> <!>`,1),eL=fe(`<div class="group flex flex-row items-center justify-center relative w-full mt-2 cursor-pointer transition-all duration-200 ease-out svelte-t6isn6"><div class="pro-draw-button w-[36px] h-[36px] rounded-[8px] flex items-center justify-center relative overflow-hidden transition-all duration-200 cubic-bezier(0.4, 0, 0.2, 1)
             isolation-isolate svelte-t6isn6" style="background: var(--menu-btn-bg); border: 1px solid var(--menu-btn-border); backdrop-filter: blur(16px) saturate(160%); -webkit-backdrop-filter: blur(16px) saturate(160%);"><div class="button-hover-overlay absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-[8px] svelte-t6isn6" style="background: var(--menu-hover-bg);"></div> <!> <!></div> <!></div>`),tL=fe('<div class="w-full h-[2px] mt-3 mb-2 opacity-90 svelte-t6isn6" style="background: linear-gradient(to right, transparent, var(--menu-accent), transparent); box-shadow: 0 0 10px var(--menu-glow);"></div>'),nL=n=>n.stopPropagation(),oL=fe("<!> <!>",1),sL=n=>n.preventDefault(),iL=fe('<button class="drawbar-scroll-arrow svelte-t6isn6" title="Scroll to see more tools" aria-label="Scroll down" type="button"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-t6isn6"><polyline points="6 9 12 15 18 9"></polyline></svg></button>'),rL=(n,e,t,o,i,r)=>s(e)==="mode"?t(s(o).key):i(r.findIndex(a=>a.key===s(e)),s(o).key),aL=fe(`<li class="px-4 py-3 flex flex-row items-center gap-3 transition-all duration-200 ease-in-out
                   text-[var(--menu-text)] hover:bg-[var(--menu-hover-bg)] hover:text-[var(--menu-glow)] cursor-pointer svelte-t6isn6"><!> <span class="text-sm font-medium"> </span></li>`),lL=fe(`<ul class="premium-submenu fixed min-w-[140px] max-h-[70vh] z-[9999] rounded-lg shadow-2xl border border-[var(--menu-btn-border)] overflow-y-auto
                bg-[var(--menu-bg)] backdrop-blur-sm transition-all duration-300 ease-in-out svelte-t6isn6"></ul>`),cL=(n,e,t)=>e(s(t).key),dL=fe(`<li class="px-4 py-3 flex flex-row items-center gap-3 transition-all duration-200 ease-in-out
                 text-[var(--menu-text)] hover:bg-[var(--menu-hover-bg)] hover:text-[var(--menu-glow)] cursor-pointer svelte-t6isn6"><!> <span class="text-sm font-medium"> </span></li>`),uL=fe(`<ul class="premium-submenu fixed min-w-[140px] max-h-[70vh] z-[9999] rounded-lg shadow-2xl border border-[var(--menu-btn-border)] overflow-y-auto
              bg-[var(--menu-bg)] backdrop-blur-sm transition-all duration-300 ease-in-out svelte-t6isn6"></ul>`),pL=fe("<!> <!>",1),vL=n=>n.stopPropagation(),fL=fe("<option> </option>"),mL=fe(`<select title="Font size"><option>8</option><option>10</option><option>11</option><option>12</option><option>14</option><option>16</option><option>18</option><option>20</option><option>22</option><option>24</option><option>32</option><option>40</option><option>52</option></select> <button title="Bold"><span class="text-xs font-bold">B</span></button> <div class="flex items-center gap-1 svelte-t6isn6"><div class="flex items-center gap-1"><button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                       cursor-pointer hover:scale-105 transition-transform touch-manipulation flex items-center justify-center svelte-t6isn6" title="Text color"><!></button> <button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                       cursor-pointer hover:scale-105 transition-transform touch-manipulation flex items-center justify-center svelte-t6isn6" title="Background color"><!></button></div> <select title="Font family"></select></div>`,1),gL=fe(`<button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                 cursor-pointer hover:scale-105 transition-transform touch-manipulation svelte-t6isn6" title="Choose color"></button> <select title="Line thickness"><option>1px</option><option>2px</option><option>3px</option><option>4px</option><option>5px</option><option>6px</option><option>7px</option><option>8px</option></select> <select title="Line style"><option>Line</option><option>Dash</option><option>Dot</option></select>`,1),hL=fe('<div title="Drag to move"><div class="flex flex-col gap-0.5"><div class="flex gap-0.5"><div></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div> <div class="flex gap-0.5"><div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div> <div class="flex gap-0.5"><div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div></div></div> <!>',1),_L=(n,e)=>{var t;return e(((t=n.target)==null?void 0:t.value)||"24")},yL=fe('<div class="flex items-center gap-3 svelte-t6isn6"><div class="flex items-center justify-center w-8 h-8 text-lg"> </div> <div class="flex items-center gap-1 sm:gap-2 min-w-[100px] sm:min-w-[120px]"><span class="text-xs text-gray-500 dark:text-gray-400 hidden sm:inline">Size:</span> <input type="range" min="16" max="64" class="flex-1 h-2 sm:h-1 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer slider touch-manipulation svelte-t6isn6"> <span class="text-xs text-gray-500 dark:text-gray-400 w-6 text-right"> </span></div></div>'),bL=(n,e)=>{e()},xL=fe('<button title="Fibonacci Settings"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button>'),wL=(n,e)=>x(e,!s(e)),kL=n=>n.stopPropagation(),SL=(n,e,t)=>{e(),x(t,!1)},CL=(n,e,t)=>{e(),x(t,!1)},PL=(n,e,t)=>{e(),x(t,!1)},IL=fe("<button>Paste</button>"),ML=fe("<div><button>Clone</button> <button>Copy</button> <!></div>"),AL=(n,e,t,o)=>{e(),x(t,!1),x(o,null)},TL=fe('<div><!> <!> <div class="relative svelte-t6isn6"><button title="More" aria-haspopup="true"><svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="12" cy="19" r="2"></circle></svg></button> <!></div> <button title="Delete"><svg fill="none" stroke="currentColor" vector-effect="non-scaling-stroke" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),LL=fe('<div class="fixed z-[200001] bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer shadow-lg transition-all duration-200" title="Delete selected drawing"><svg class="w-4 h-4" fill="none" stroke="currentColor" vector-effect="non-scaling-stroke" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></div>'),FL=fe('<div class="drawbar-wrapper svelte-t6isn6"><div class="drawbar-container h-full box-border border-r border-l-0 transition-all duration-200 ease-in-out overflow-y-auto scrollbar-hidden svelte-t6isn6" style="background: var(--menu-bg); box-shadow: var(--menu-shadow); backdrop-filter: blur(18px) saturate(170%); -webkit-backdrop-filter: blur(18px) saturate(170%); border-left: none;"><!> <!> <!> <!> <!> <!> <!> <!></div> <!></div> <!> <!> <!> <!>  <!> <!>',1);function $L(n,e){gd(e,!0);const t=wp(),o=()=>ya(jt,"$chart",t),i=()=>ya(zn,"$undoRedoState",t),r=()=>ya(_t,"$save",t),a=(be,tt=Mg,wt=Mg,Lt,qt,qn,Xt)=>{let vo=Rv(()=>P0(Lt==null?void 0:Lt(),"")),To=Rv(()=>P0(qt==null?void 0:qt(),()=>[],!0)),co=Rv(()=>P0(qn==null?void 0:qn(),!1)),so=Rv(()=>P0(Xt==null?void 0:Xt(),!1));var Jo=eL(),Os=g(Jo);Os.__click=function(...qr){var Ga;(Ga=tt())==null||Ga.apply(this,qr)};var wr=u(g(Os),2),ra=vt(()=>Al(wt())),Qr=vt(()=>s(vo)==="mode"&&s(p)===s(d));If(wr,{get name(){return s(ra)},get active(){return s(Qr)},size:24,class:"relative z-10 transition-all duration-200 group-hover:scale-[1.05]"});var hl=u(wr,2);Te(hl,()=>s(vo)==="mode"&&s(p)===s(d)||s(vo)&&s(vo)===s(c),qr=>{var Ga=ZT();z(qr,Ga)}),f(Os);var lc=u(Os,2);Te(lc,()=>s(To).length>0,qr=>{var Ga=QT(),Ki=Dt(Ga);Ki.__click=[XT,jo,vo];var Zl=g(Ki);f(Ki);var Tl=u(Ki,2);Te(Tl,()=>s(vo)===s(c),Ya=>{var ur=JT();z(Ya,ur)}),Se(()=>Fi(Zl,"rotate-180",s(c)===s(vo))),z(qr,Ga)}),f(Jo),Se(()=>{zt(Jo,"style",`margin-top: ${(s(co)||s(so)?"12px":"")??""}`),zt(Os,"title",s(vo)||wt()),zt(Os,"aria-label",s(vo)||wt()),Fi(Os,"active-btn",s(vo)==="mode"&&s(p)===s(d)||s(vo)&&s(vo)===s(c))}),z(be,Jo)},l=be=>{var tt=tL();z(be,tt)};let c=ae(""),d=ae("weakMagnet"),p=ae("normal"),m=ae(!1),h=ae(!0),_=N([]),w=ae(""),S=ae(null),P=ae(null),I=ae(!1),C=ae(!1),M=ae(null),F=N({thickness:"1",style:"solid",color:"#1677FF",opacity:100}),V=ae(!1),j=N({x:0,y:0}),D=ae(null),R=ae(0),W=ae(null),J=ae(!1),Z=ae(!1),G=ae(null),se=0,Y=ae(!1),oe=ae("line"),ee=ae("#1677FF"),re=ae(100),me=ae(!1),K=ae(N({x:0,y:0})),ye=ae(N({x:0,y:0}));const Me="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif";let Fe=N({fontSize:"32",fontWeight:"bold",textColor:"#FFFFFF",backgroundColor:"#A00000",fontFamily:Me}),Ze=ae(100),Ge=ae(20),it=ae(!1),Ye=ae(void 0);function ct(be){const tt=be.replace("#",""),wt=parseInt(tt.slice(0,2),16),Lt=parseInt(tt.slice(2,4),16),qt=parseInt(tt.slice(4,6),16);return{r:wt,g:Lt,b:qt}}function kt(be){if(!be||typeof be!="string"||!be.startsWith("#"))return"#000000";const tt=be.length===9?be.slice(0,7):be,{r:wt,g:Lt,b:qt}=ct(tt);return .2126*wt+.7152*Lt+.0722*qt>128?"#000000":"#FFFFFF"}const ft=[{label:"System",value:Me},{label:"Arial",value:"Arial, Helvetica, sans-serif"},{label:"Helvetica",value:"'Helvetica Neue', Arial, sans-serif"},{label:"Segoe UI",value:"'Segoe UI', Tahoma, Geneva, sans-serif"},{label:"Roboto",value:"Roboto, system-ui, -apple-system, 'Segoe UI', Arial, sans-serif"},{label:"Times New Roman",value:"'Times New Roman', Times, serif"},{label:"Georgia",value:"Georgia, 'Times New Roman', serif"},{label:"Garamond",value:"Garamond, 'Times New Roman', serif"},{label:"Palatino",value:"'Palatino Linotype', 'Book Antiqua', Palatino, serif"},{label:"Verdana",value:"Verdana, Geneva, sans-serif"},{label:"Tahoma",value:"Tahoma, Geneva, sans-serif"},{label:"Trebuchet MS",value:"'Trebuchet MS', 'Lucida Grande', sans-serif"},{label:"Impact",value:"Impact, Charcoal, sans-serif"},{label:"Lucida Sans",value:"'Lucida Sans Unicode', 'Lucida Grande', sans-serif"},{label:"Century Gothic",value:"'Century Gothic', AppleGothic, sans-serif"},{label:"Optima",value:"Optima, 'Segoe', 'Segoe UI', sans-serif"},{label:"Comic Sans MS",value:"'Comic Sans MS', 'Comic Sans', cursive, sans-serif"},{label:"Avenir",value:"'Avenir Next', Avenir, sans-serif"},{label:"Futura",value:"Futura, 'Trebuchet MS', Arial, sans-serif"},{label:"Menlo",value:"Menlo, Monaco, Consolas, 'Courier New', monospace"},{label:"Consolas",value:"Consolas, 'Liberation Mono', Menlo, Monaco, monospace"},{label:"Courier New",value:"'Courier New', Courier, monospace"}];let bt=ae(!1),nt=ae(N([{value:0,visible:!0,color:"#FF6B6B"},{value:.236,visible:!0,color:"#4ECDC4"},{value:.382,visible:!0,color:"#45B7D1"},{value:.5,visible:!0,color:"#96CEB4"},{value:.618,visible:!0,color:"#FFEAA7"},{value:1,visible:!0,color:"#98D8C8"},{value:1.618,visible:!0,color:"#85C1E9"},{value:.786,visible:!1,color:"#DDA0DD"},{value:1.272,visible:!1,color:"#F7DC6F"},{value:1.414,visible:!1,color:"#BB8FCE"},{value:2,visible:!1,color:"#FFB6C1"},{value:2.272,visible:!1,color:"#98FB98"},{value:2.414,visible:!1,color:"#F0E68C"},{value:2.618,visible:!1,color:"#F8C471"},{value:3,visible:!1,color:"#DEB887"},{value:3.618,visible:!1,color:"#CD853F"},{value:4,visible:!1,color:"#D2691E"},{value:4.236,visible:!1,color:"#A0522D"},{value:4.272,visible:!1,color:"#8B4513"},{value:4.618,visible:!1,color:"#654321"}])),Pt=ae(N([{value:0,visible:!0,color:"#FF6B6B"},{value:.236,visible:!0,color:"#4ECDC4"},{value:.382,visible:!0,color:"#45B7D1"},{value:.5,visible:!0,color:"#96CEB4"},{value:.618,visible:!0,color:"#FFEAA7"},{value:1,visible:!0,color:"#98D8C8"},{value:1.618,visible:!0,color:"#85C1E9"},{value:.786,visible:!1,color:"#DDA0DD"},{value:1.272,visible:!1,color:"#F7DC6F"},{value:1.414,visible:!1,color:"#BB8FCE"},{value:2,visible:!1,color:"#FFB6C1"},{value:2.272,visible:!1,color:"#98FB98"},{value:2.414,visible:!1,color:"#F0E68C"},{value:2.618,visible:!1,color:"#F8C471"},{value:3,visible:!1,color:"#DEB887"},{value:3.618,visible:!1,color:"#CD853F"},{value:4,visible:!1,color:"#D2691E"},{value:4.236,visible:!1,color:"#A0522D"},{value:4.272,visible:!1,color:"#8B4513"},{value:4.618,visible:!1,color:"#654321"}])),Qe=null;function yt(){var wt;Qe||(Qe=document.querySelector(".chart-container")||document.querySelector("[data-chart-container]")||document.querySelector(".kline-chart")||document.querySelector("#chart")||((wt=document.querySelector("canvas"))==null?void 0:wt.parentElement)||document.body);const be=Qe==null?void 0:Qe.getBoundingClientRect();if(!be)return{left:0,top:0,width:window.innerWidth,height:window.innerHeight};const tt=10;return{left:be.left+tt,top:be.top+tt,width:be.width-tt*2,height:be.height-tt*2}}function xe(be){try{const tt=yt();Qe&&(Qe.style.cursor=be??"default")}catch{}}function Ve(be){var rc,zr,rd,cc,dc;if(!be||!be.points||be.points.length===0||!o())return null;const tt=be.points[0],wt=be.paneId||"candle_pane",Lt=(rc=o())==null?void 0:rc.convertToPixel(tt,{paneId:wt}),qt=(Qe||document.body).getBoundingClientRect();if(!Lt||typeof Lt.x!="number"||typeof Lt.y!="number"||!qt)return null;const qn=yt(),Xt=window.innerWidth<=768,vo=Xt?Math.min(300,window.innerWidth-40):300,To=Xt?48:60,co=Xt?32:24,so=(zr=be.extendData)!=null&&zr.editing?Kg.getEditorRect():null,Jo=so?so.width:((rd=be.extendData)==null?void 0:rd.boxWidth)??160,Os=so?so.height:((cc=be.extendData)==null?void 0:cc.boxHeight)??Math.round((((dc=be.extendData)==null?void 0:dc.fontSize)??32)*1.4)+8,wr=Lt.x-Jo/2,ra=Lt.x+Jo/2,Qr=Lt.y-Math.round(Os/2),hl=so?so.left:qt.left+wr,lc=so?so.right:qt.left+ra,qr=so?so.top:qt.top+Qr,Ga=so?so.bottom:qr+Os;let Ki=[{x:lc+co,y:qr},{x:hl,y:Ga+co},{x:hl-vo-co,y:qr},{x:hl,y:qr-To-co}];Xt&&(Ki=[{x:hl,y:Ga+co},{x:hl,y:qr-To-co},{x:lc+co,y:qr},{x:hl-vo-co,y:qr}]);const Zl=qt.left+(Xt?4:8),Tl=qt.top+(Xt?4:8),Ya=qt.left+qn.width-vo-(Xt?4:8),ur=qt.top+qn.height-To-(Xt?4:8);for(const Er of Ki){let Sc=Math.max(Zl,Math.min(Er.x,Ya)),ea=Math.max(Tl,Math.min(Er.y,ur));const Cc=ea<Ga&&ea+To>qr,Ac=Sc<lc&&Sc+vo>hl;if(!(Cc&&Ac))return{x:Sc,y:ea}}if(Xt){let Er=Math.max(Zl,Math.min(hl,Ya)),Sc=Math.max(Tl,Math.min(Ga+co,ur));return{x:Er,y:Sc}}else{let Er=Math.max(Zl,Math.min(lc+co,Ya)),Sc=Math.max(Tl,Math.min(qr,ur));return{x:Er,y:Sc}}}function Je(be){function tt(Lt){const qt=be.scrollTop>0,qn=be.scrollTop<be.scrollHeight-be.clientHeight;(Lt.deltaY<0&&!qt||Lt.deltaY>0&&!qn)&&Lt.preventDefault(),Lt.stopPropagation()}function wt(Lt){Lt.preventDefault(),Lt.stopPropagation()}return be.addEventListener("wheel",tt,{passive:!1,capture:!0}),be.addEventListener("touchmove",wt,{passive:!1,capture:!0}),{destroy(){be.removeEventListener("wheel",tt,{capture:!0}),be.removeEventListener("touchmove",wt,{capture:!0})}}}function St(){var be,tt;if(s(C)&&s(M)&&s(D)&&!(s(M).name==="text"&&((be=s(M).extendData)!=null&&be.editing))&&s(M).points&&s(M).points.length>0){const wt=s(M).points[0],Lt=(tt=o())==null?void 0:tt.convertToPixel(wt,{paneId:"candle_pane"});if(Lt&&typeof Lt=="object"&&"x"in Lt&&"y"in Lt&&Lt.x!==void 0&&Lt.y!==void 0){const Xt=Math.max(10,Math.min(Lt.x-80,window.innerWidth-300)),vo=Math.max(10,Math.min(Lt.y-30,window.innerHeight-200));x(D,N({x:Xt,y:vo}))}}s(Y)&&x(ye,N({x:Math.max(10,Math.min(s(ye).x,window.innerWidth-320)),y:Math.max(10,Math.min(s(ye).y,window.innerHeight-400))}))}function Ne(){if(typeof localStorage<"u"){const be=localStorage.getItem("contextMenuPosition");if(be)try{x(G,N(JSON.parse(be)))}catch(tt){console.log("Error loading saved position:",tt)}}}function ue(be){typeof localStorage<"u"&&(localStorage.setItem("contextMenuPosition",JSON.stringify(be)),x(G,N(be)))}const he="drawing_tools",_t=Kc("save"),Wt=Kc("ctx"),jt=Kc("chart"),Zt=zp({}),dn=Kc("drawingManager"),zn=op.getState();let un=ae(!1),On=ae(!1);mr(()=>{const be=i();x(un,be.undoStack.length>0),x(On,be.redoStack.length>0)}),mr(()=>{o()&&op.init({chart:o(),saveStore:_t,overlaysStore:Zt})});function no(be){const tt=r().symbol;return`${tt.shortName??tt.name??tt.ticker}_${r().period.timeframe}_${be}`}let fs={};const oo=N([{key:"single-line",icon:"segment",list:[{key:"segment",text:"segment"},{key:"arrow",text:"arrow"},{key:"rayLine",text:"ray_line"},{key:"straightLine",text:"straight_line"},{key:"priceLine",text:"price_line"},{key:"horizontalStraightLine",text:"horizontal_straight_line"},{key:"horizontalRayLine",text:"horizontal_ray_line"},{key:"horizontalSegment",text:"horizontal_segment"},{key:"verticalStraightLine",text:"vertical_straight_line"},{key:"verticalRayLine",text:"vertical_ray_line"},{key:"verticalSegment",text:"vertical_segment"}]},{key:"more-line",icon:"priceChannelLine",list:[{key:"priceChannelLine",text:"price_channel_line"},{key:"parallelStraightLine",text:"parallel_straight_line"}]},{key:"polygon",icon:"rect",list:[{key:"circle",text:"circle"},{key:"rect",text:"rect"},{key:"parallelogram",text:"parallelogram"},{key:"triangle",text:"triangle"}]},{key:"fibonacci",icon:"fibonacciSegment",list:[{key:"fibonacciSegment",text:"fibonacci_segment"},{key:"fibonacciCircle",text:"fibonacci_circle"},{key:"fibonacciSpiral",text:"fibonacci_spiral"},{key:"fibonacciSpeedResistanceFan",text:"fibonacci_speed_resistance_fan"},{key:"fibonacciExtension",text:"fibonacci_extension"},{key:"gannBox",text:"gann_box"}]},{key:"wave",icon:"xabcd",list:[{key:"xabcd",text:"xabcd"},{key:"abcd",text:"abcd"},{key:"threeWaves",text:"three_waves"},{key:"fiveWaves",text:"five_waves"},{key:"eightWaves",text:"eight_waves"},{key:"anyWaves",text:"any_waves"}]},{key:"emoji",icon:"emoji",list:[]},{key:"text",icon:"text",list:[]}]),Gs=N([{key:"weakMagnet",text:"weakMagnet"},{key:"strongMagnet",text:"strongMagnet"}]);function jo(be){s(c)==be?x(c,""):x(c,N(be))}function fi(be){var qn;let tt=!1;const wt=dI[be.name]??{},Lt={groupId:he,onDrawEnd:Xt=>{wt.onDrawEnd&&wt.onDrawEnd(Xt),Pd(Xt.overlay);const vo=no(Xt.overlay.id);if(op.recordAddOverlay(Xt.overlay.id,Xt.overlay,vo),s(S)===Xt.overlay.id&&x(S,null),Xt.overlay.name==="text")try{x(M,N(Xt.overlay)),x(w,N(Xt.overlay.id));const To=Ve(Xt.overlay),co=s(G)||To;co&&(x(D,N({...co})),x(P,N({x:co.x,y:co.y})),x(C,!0),x(I,!1)),o()&&Kg.startEditing(o(),Xt.overlay)}catch{}return!0},onPressedMoving:Xt=>{var vo;wt.onPressedMoving&&wt.onPressedMoving(Xt),tt=!0;try{if(o()&&((vo=Xt.overlay)!=null&&vo.id)&&!fs[Xt.overlay.id]){const To=o().getOverlays({id:Xt.overlay.id});To&&To[0]&&(fs[Xt.overlay.id]=JSON.parse(JSON.stringify(To[0])))}}catch{}return!1},onPressedMoveEnd:Xt=>{var vo;if(!tt)return!0;tt=!1,Pd(Xt.overlay);try{const To=fs[Xt.overlay.id],co=Xt.overlay;if(To&&co){const so=no(Xt.overlay.id);op.recordModifyOverlay(Xt.overlay.id,To,co,so)}}catch{}if(delete fs[Xt.overlay.id],s(w)===Xt.overlay.id&&Xt.overlay.points&&Xt.overlay.points.length>0){const To=Xt.overlay.points[0],co=Xt.overlay.paneId||"candle_pane",so=(vo=o())==null?void 0:vo.convertToPixel(To,{paneId:co});so&&typeof so=="object"&&"x"in so&&"y"in so&&so.x!==void 0&&so.y!==void 0&&x(P,N({x:so.x-80,y:so.y-30}))}return!0},onSelected:Xt=>{var vo;if(wt.onSelected&&wt.onSelected(Xt),se=Date.now(),x(w,N(Xt.overlay.id)),x(M,N(Xt.overlay)),(vo=Xt.overlay.styles)!=null&&vo.line){const To=Xt.overlay.styles.line;F.thickness=String(To.size||2),F.color=To.color||"#1677FF",F.style=To.style===Ke.Dashed?"dashed":"solid"}if(Xt.overlay.points&&Xt.overlay.points.length>0){const To=Ve(Xt.overlay),co=s(G)||To;if(co&&(x(D,N({...co})),x(P,N({x:co.x,y:co.y})),x(C,!0),x(I,!1),Xt.overlay.styles&&Xt.overlay.styles.line))if(F.thickness=String(Xt.overlay.styles.line.size||1),F.color=Xt.overlay.styles.line.color||"#1677FF",Xt.overlay.styles.line.style===Ke.Dashed){const so=Xt.overlay.styles.line.dashedValue;so&&so[0]===2&&so[1]===8?F.style="dotted":F.style="dashed"}else F.style="solid"}return!0},onDeselected:Xt=>(wt.onDeselected&&wt.onDeselected(Xt),x(w,""),x(I,!1),x(C,!1),x(Z,!1),x(P,null),x(M,null),!0),onRemoved:Xt=>{wt.onRemoved&&wt.onRemoved(Xt),Zt.update(To=>(delete To[no(Xt.overlay.id)],To));const vo=dn.get();if(vo)try{vo.removeDrawing(Xt.overlay.id),console.log("🗑️ Removed drawing from DrawingManager:",Xt.overlay.id),dm()}catch(To){console.error("Error removing drawing from DrawingManager:",To)}return!0}},qt=(qn=o())==null?void 0:qn.createOverlay(Mn.mergeWith({},Lt,be,(Xt,vo,To)=>{if(To.startsWith("on")&&Xt&&vo)return co=>(vo(co),Xt(co))}));return qt&&(Array.isArray(qt)?(_.push(...qt),qt.length>0&&x(S,N(qt[0]))):(_.push(qt),x(S,N(qt)))),qt}function ba(be){be==="text"&&xe("text");let tt=Ke.Solid,wt=[8,4];F.style==="dashed"?(tt=Ke.Dashed,wt=[8,4]):F.style==="dotted"&&(tt=Ke.Dashed,wt=[2,6]);const qt={line:{size:Number(F.thickness)||1,color:F.color,style:tt,dashedValue:wt},text:{color:"#FFFFFF",backgroundColor:"#A0000020",borderColor:"#1677FF"},polygon:{color:F.color+"20"}},qn={origin:"user"};be==="text"&&(qn.text=Cd,qn.fontSize=32,qn.fontWeight="bold",qn.textColor="#FFFFFF",qn.backgroundColor="#A0000020",qn.fontFamily=Me),fi({name:be,visible:s(h),lock:s(m),mode:s(p),styles:qt,extendData:qn})}function xa(be,tt){oo[be].icon=tt,ba(tt),x(c,"")}function Al(be){return be==="priceChannelLine"?"priceChannelLineNew":be}function Qs(){var tt;let be=s(d);s(p)!=="normal"&&(be="normal"),x(p,N(be)),(tt=o())==null||tt.overrideOverlay({mode:be})}function Fs(be){var tt;x(d,N(be)),x(p,N(be)),x(c,""),(tt=o())==null||tt.overrideOverlay({mode:be})}function Va(be){let wt=0;return be==="crosshair"?wt=0:oo.find(Lt=>Lt.key===be)?wt=1+oo.findIndex(Lt=>Lt.key===be):be==="ruler"?wt=1+oo.length+1:be==="mode"?wt=1+oo.length+2:be==="lock"?wt=1+oo.length+3:be==="visible"?wt=1+oo.length+4:be==="remove"&&(wt=1+oo.length+5),wt*52}function $r(){var be;x(m,!s(m)),(be=o())==null||be.overrideOverlay({lock:s(m)})}function cd(){var be;x(h,!s(h)),(be=o())==null||be.overrideOverlay({visible:s(h)})}function Sd(){var be,tt;if(x(p,"normal"),x(d,"weakMagnet"),xe(null),s(S)){(be=o())==null||be.removeOverlay({id:s(S)});const wt=_.indexOf(s(S));wt>-1&&_.splice(wt,1),x(S,null)}(tt=o())==null||tt.overrideOverlay({mode:t8.Normal}),x(c,""),x(C,!1),x(I,!1),x(Z,!1),x(P,null),x(M,null),x(w,"")}function Nl(){var wt;let be={groupId:he},tt=null;if(s(w))be.id=s(w),tt=s(M);else if(_.length>0){const Lt=_.pop();if(be.id=Lt,Lt&&o()){const qt=o().getOverlays({id:Lt});qt&&qt.length>0&&(tt=qt[0])}}if(tt){const Lt=no(tt.id);op.recordRemoveOverlay(tt.id,tt,Lt)}(wt=o())==null||wt.removeOverlay(be),x(C,!1),x(I,!1),x(Z,!1),x(P,null),x(M,null)}function dd(){if(!s(M)||!o())return;const be=no(s(M).id),tt=JSON.parse(JSON.stringify(s(M))),wt=Number(F.thickness)||1;let Lt=Ke.Solid,qt=[8,4];F.style==="dashed"?(Lt=Ke.Dashed,qt=[8,4]):F.style==="dotted"&&(Lt=Ke.Dashed,qt=[2,6]);const qn=Math.round(F.opacity/100*255).toString(16).padStart(2,"0"),Xt=F.color+qn,vo={line:{size:wt,color:Xt,style:Lt,dashedValue:qt},text:{color:"#FFFFFF",backgroundColor:"rgba(0, 100, 255, 0.7)",borderColor:"#FFFFFF"},polygon:{color:Xt}};try{o().overrideOverlay({id:s(M).id,styles:vo})}catch(To){console.log("Error updating overlay styles:",To)}Pd({...s(M),styles:{...s(M).styles,...vo}});try{const To={...s(M),styles:{...s(M).styles,...vo}};op.recordModifyOverlay(s(M).id,tt,To,be)}catch{}}const Cd="Add text";function fa(){var hl,lc,qr,Ga,Ki,Zl,Tl;if(!s(M)||!o()||s(M).name!=="text")return;const be=no(s(M).id),tt=JSON.parse(JSON.stringify(s(M))),wt=Number(Fe.fontSize)||12,Lt=Fe.backgroundColor||"#A00000",qt=Fe.textColor||"#FFFFFF",qn=Math.round(s(Ge)/100*255).toString(16).padStart(2,"0"),Xt=Math.round(s(Ze)/100*255).toString(16).padStart(2,"0"),vo=typeof Lt=="string"&&Lt.startsWith("#")&&Lt.length===7?`${Lt}${qn}`:Lt,To=typeof qt=="string"&&qt.startsWith("#")&&qt.length===7?`${qt}${Xt}`:qt,co=((hl=s(M).styles)==null?void 0:hl.text)||{},so=co.size??((lc=s(M).extendData)==null?void 0:lc.fontSize),Jo=co.weight??((qr=s(M).extendData)==null?void 0:qr.fontWeight),Os=co.family??((Ga=s(M).extendData)==null?void 0:Ga.fontFamily),wr=so!==wt||Jo!==Fe.fontWeight||Os!==Fe.fontFamily,ra={...s(M).extendData||{},fontSize:wt,fontWeight:Fe.fontWeight,textColor:Fe.textColor,backgroundColor:vo,fontFamily:Fe.fontFamily,...wr?{boxWidth:0,boxHeight:0}:{}},Qr={...s(M).styles||{},text:{...((Ki=s(M).styles)==null?void 0:Ki.text)||{},size:wt,color:To,backgroundColor:vo,family:Fe.fontFamily,weight:Fe.fontWeight,paddingLeft:8,paddingRight:8,paddingTop:4,paddingBottom:4,borderSize:0,borderColor:"transparent"},box:{...((Zl=s(M).styles)==null?void 0:Zl.box)||{},stroke:"#3b82f6",width:1,fill:"transparent"},handles:{...((Tl=s(M).styles)==null?void 0:Tl.handles)||{},size:6,fill:"#3b82f6",stroke:"#3b82f6"}};try{if(o().overrideOverlay({id:s(M).id,styles:Qr,extendData:{...ra,textColor:qt,backgroundColor:vo,textOpacity:s(Ze),textBgOpacity:s(Ge)}}),(s(M).extendData||{}).editing)try{Kg.updateEditorStyle(s(M))}catch{}}catch(Ya){console.log("Error updating text overlay styles:",Ya)}x(M,N({...s(M),styles:Qr,extendData:ra})),Pd(s(M));try{const Ya=JSON.parse(JSON.stringify(s(M)));op.recordModifyOverlay(s(M).id,tt,Ya,be)}catch{}}function Dl(be){var qn;x(V,!0),x(R,N(Date.now()));const tt=be instanceof MouseEvent?be.clientX:be.touches[0].clientX,wt=be instanceof MouseEvent?be.clientY:be.touches[0].clientY,Lt=(qn=be.target.closest(".context-menu-container"))==null?void 0:qn.getBoundingClientRect();Lt?(j.x=tt-Lt.left,j.y=wt-Lt.top):s(D)&&(j.x=tt-s(D).x,j.y=wt-s(D).y);const qt=be;typeof qt.preventDefault=="function"&&qt.preventDefault(),typeof qt.stopPropagation=="function"&&qt.stopPropagation()}function ml(be){if(s(V)&&s(D)){x(R,N(Date.now()));const tt=be instanceof MouseEvent?be.clientX:be.touches[0].clientX,wt=be instanceof MouseEvent?be.clientY:be.touches[0].clientY,Lt=window.innerWidth<=768,qt=Lt?Math.min(250,window.innerWidth-40):300,qn=Lt?40:60,Xt=Lt?5:10,vo=Qe==null?void 0:Qe.getBoundingClientRect();let To=tt-j.x,co=wt-j.y;const so=((vo==null?void 0:vo.left)||0)+Xt,Jo=(vo?vo.right:window.innerWidth)-qt-Xt,Os=((vo==null?void 0:vo.top)||0)+Xt,wr=(vo?vo.bottom:window.innerHeight)-qn-Xt;s(D).x=Math.max(so,Math.min(To,Jo)),s(D).y=Math.max(Os,Math.min(co,wr))}}function gl(){s(V)&&s(D)&&ue(s(D)),x(V,!1),x(R,N(Date.now()))}function _d(be){ml(be)}function Kl(){gl()}function ic(be){const tt=be.detail;s(oe)==="line"?(F.color=tt,dd()):s(oe)==="textColor"?(Fe.textColor=tt,fa()):s(oe)==="textBg"&&(Fe.backgroundColor=tt,fa())}function od(be){const tt=be.detail;s(oe)==="line"?(F.opacity=tt,x(re,N(tt)),dd()):s(oe)==="textColor"?(x(Ze,N(tt)),x(re,N(tt)),fa()):s(oe)==="textBg"&&(x(Ge,N(tt)),x(re,N(tt)),fa())}function zd(){x(Y,!1)}function Ec(){const be=op.undo();console.log(be?"Undo successful":"Nothing to undo")}function al(){const be=op.redo();console.log(be?"Redo successful":"Nothing to redo")}function kc(be){(be.ctrlKey||be.metaKey)&&be.key==="z"&&!be.shiftKey?(be.preventDefault(),Ec()):(be.ctrlKey||be.metaKey)&&be.key==="y"||(be.ctrlKey||be.metaKey)&&be.shiftKey&&be.key==="z"?(be.preventDefault(),al()):(be.key==="Delete"||be.key==="Backspace")&&s(w)?(be.preventDefault(),Nl()):(be.ctrlKey||be.metaKey)&&be.key==="c"&&s(M)?(be.preventDefault(),sd()):(be.ctrlKey||be.metaKey)&&be.key==="v"&&s(W)&&(be.preventDefault(),id(be))}function Vd(){if(!(!s(M)||!o())){x(J,!0);try{const be=JSON.parse(JSON.stringify(s(M))),tt=Date.now();be.id=`${s(M).name}_clone_${tt}`,be.points&&Array.isArray(be.points)&&(be.points=be.points.map(Lt=>Lt&&typeof Lt=="object"?{...Lt,timestamp:Lt.timestamp?Lt.timestamp+1e3*60*5:Lt.timestamp,value:Lt.value?Lt.value*1.002:Lt.value}:Lt));const wt=fi(be);if(wt){const Lt=Array.isArray(wt)?wt[0]:wt;if(Lt){const qt=no(Lt);op.recordAddOverlay(Lt,be,qt),setTimeout(()=>{var Xt,vo;const qn=o().getOverlays({id:Lt})[0];if(qn){if(x(w,N(Lt)),x(M,N(qn)),(Xt=qn.styles)!=null&&Xt.line){const To=qn.styles.line;F.thickness=String(To.size||2),F.color=To.color||"#1677FF",F.style=To.style===Ke.Dashed?"dashed":"solid"}if(qn.points&&qn.points.length>0){const To=qn.points[0],co=(vo=o())==null?void 0:vo.convertToPixel(To,{paneId:"candle_pane"});co&&typeof co=="object"&&"x"in co&&"y"in co&&co.x!==void 0&&co.y!==void 0&&(x(P,N({x:co.x-80,y:co.y-30})),s(G)?x(D,N({...s(G)})):x(D,N({x:co.x-80,y:co.y-30})),x(C,!0),x(I,!1),x(Z,!1))}}},100)}console.log("Overlay cloned successfully")}}catch(be){console.error("Error cloning overlay:",be)}finally{x(J,!1)}}}function sd(){if(s(M))try{x(W,N(JSON.parse(JSON.stringify(s(M))))),console.log("Overlay copied to clipboard"),x(C,!1),setTimeout(()=>{console.log("Copy operation completed")},100)}catch(be){console.error("Error copying overlay:",be)}}function id(be){if(!(!s(W)||!o()))try{const tt=JSON.parse(JSON.stringify(s(W))),wt=Date.now();tt.id=`${s(W).name}_paste_${wt}`,be&&tt.points&&Array.isArray(tt.points)&&(tt.points=tt.points.map(qt=>qt&&typeof qt=="object"?{...qt,timestamp:qt.timestamp?qt.timestamp+1e3*60*10:qt.timestamp,value:qt.value?qt.value*1.005:qt.value}:qt));const Lt=fi(tt);if(Lt){const qt=Array.isArray(Lt)?Lt[0]:Lt;if(qt){const qn=no(qt);op.recordAddOverlay(qt,tt,qn),setTimeout(()=>{var vo,To;const Xt=o().getOverlays({id:qt})[0];if(Xt){if(x(w,N(qt)),x(M,N(Xt)),(vo=Xt.styles)!=null&&vo.line){const co=Xt.styles.line;F.thickness=String(co.size||2),F.color=co.color||"#1677FF",F.style=co.style===Ke.Dashed?"dashed":"solid"}if(Xt.points&&Xt.points.length>0){const co=Xt.points[0],so=(To=o())==null?void 0:To.convertToPixel(co,{paneId:"candle_pane"});so&&typeof so=="object"&&"x"in so&&"y"in so&&so.x!==void 0&&so.y!==void 0&&(x(P,N({x:so.x-80,y:so.y-30})),s(G)?x(D,N({...s(G)})):x(D,N({x:so.x-80,y:so.y-30})),x(C,!0),x(I,!1),x(Z,!1))}}},100)}console.log("Overlay pasted successfully")}}catch(tt){console.error("Error pasting overlay:",tt)}}function Pd(be){if(be.groupId!==he)return;const tt=["extendData","groupId","id","lock","mode","name","paneId","points","styles","totalStep","visible","zLevel"],wt=no(be.id);Zt.update(qt=>(qt[wt]=Object.fromEntries(tt.map(qn=>[qn,be[qn]])),qt));const Lt=dn.get();if(Lt&&be.points&&be.points.length>0)try{const qt=ig(r().symbol),qn={id:be.id,symbolKey:qt,type:be.name||"unknown",points:be.points.map(Xt=>({time:Xt.timestamp||Xt.t||0,price:Xt.value||Xt.p||0})),styles:be.styles||{},...be.extendData?{extendData:be.extendData}:{},locked:!!be.lock,visible:be.visible!==!1};Lt.addDrawing(qn),dm()}catch(qt){console.error("Error syncing overlay to DrawingManager:",qt)}}function Ed(){if(x(me,!s(me)),s(me)){const be=yt();x(K,N({x:be.left+60,y:be.top+100}))}}function zl(be){const{emoji:tt}=be.detail;console.log("Selected emoji:",tt),x(me,!1),fi({name:"emoji",visible:s(h),lock:s(m),mode:s(p),extendData:{emoji:tt,size:24},styles:{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}}})}function Gd(be){if(!s(M)||s(M).name!=="emoji")return;const tt=no(s(M).id),wt=JSON.parse(JSON.stringify(s(M))),Lt=parseInt(be);if(!(isNaN(Lt)||Lt<16||Lt>64)&&(s(M).extendData&&(s(M).extendData.size=Lt),o()&&s(M).id)){o().overrideOverlay({id:s(M).id,extendData:s(M).extendData}),Pd(s(M));try{const qt=JSON.parse(JSON.stringify(s(M)));op.recordModifyOverlay(s(M).id,wt,qt,tt)}catch{}}}function lu(){var be,tt;if(((be=s(M))==null?void 0:be.name)==="fibonacciSegment"){const wt=((tt=s(M).extendData)==null?void 0:tt.fibonacciLevels)||s(M).fibonacciLevels;wt&&x(nt,N([...wt])),x(Pt,N([...s(nt)])),x(bt,!0)}}function Yd(){x(nt,N([{value:0,visible:!0,color:"#FF6B6B"},{value:.236,visible:!0,color:"#4ECDC4"},{value:.382,visible:!0,color:"#45B7D1"},{value:.5,visible:!0,color:"#96CEB4"},{value:.618,visible:!0,color:"#FFEAA7"},{value:.786,visible:!0,color:"#DDA0DD"},{value:1,visible:!0,color:"#98D8C8"},{value:1.272,visible:!0,color:"#F7DC6F"},{value:1.414,visible:!0,color:"#BB8FCE"},{value:1.618,visible:!0,color:"#85C1E9"},{value:2.618,visible:!0,color:"#F8C471"}])),mu()}function eu(){mu(),x(bt,!1)}function Ju(){x(nt,N([...s(Pt)])),x(bt,!1)}function mu(){if(!s(M)||s(M).name!=="fibonacciSegment"||!o())return;const be=no(s(M).id),tt=JSON.parse(JSON.stringify(s(M)));o().overrideOverlay({id:s(M).id,extendData:{...s(M).extendData,fibonacciLevels:[...s(nt)]}}),s(M).fibonacciLevels=[...s(nt)],Pd(s(M));try{const wt=JSON.parse(JSON.stringify(s(M)));op.recordModifyOverlay(s(M).id,tt,wt,be)}catch{}}function yd(be,tt,wt){be>=0&&be<s(nt).length&&(s(nt)[be]={...s(nt)[be],[tt]:wt},mu())}Lu(Wt,be=>be.clickChart).subscribe(()=>{x(c,""),Date.now()-se>150&&!s(V)&&!s(w)&&!s(M)&&(x(C,!1),x(I,!1),x(Z,!1),x(P,null))}),fv(()=>{if(Ne(),typeof document<"u"&&(document.addEventListener("mousemove",ml),document.addEventListener("mouseup",gl),document.addEventListener("touchmove",_d,{passive:!1}),document.addEventListener("touchend",Kl),document.addEventListener("touchcancel",Kl)),typeof window<"u"){window.addEventListener("resize",St);const be=tt=>{if(o()&&s(M)&&s(M).name==="text"){const wt=Ve(s(M)),Lt=s(G)||wt;Lt&&(x(D,N({...Lt})),x(P,N({x:Lt.x,y:Lt.y})),x(C,!0),x(I,!1)),Kg.startEditing(o(),s(M))}};window.addEventListener("dblclick",be)}}),fv(()=>{typeof document<"u"&&document.addEventListener("keydown",kc)});function En(){if(!s(Ye))return;const{scrollHeight:be,clientHeight:tt,scrollTop:wt}=s(Ye),Lt=be>tt,qt=wt+tt>=be-5;x(it,N(Lt&&!qt))}function go(be){if(be&&(be.preventDefault(),be.stopPropagation()),!s(Ye))return;const{scrollTop:tt,clientHeight:wt,scrollHeight:Lt}=s(Ye),qt=wt*.7,qn=Math.min(tt+qt,Lt-wt);s(Ye).scrollTo({top:qn,behavior:"smooth"})}fv(()=>{En();const be=()=>{En()},tt=()=>{En()};return s(Ye)&&s(Ye).addEventListener("scroll",be),typeof window<"u"&&window.addEventListener("resize",tt),setTimeout(En,500),()=>{s(Ye)&&s(Ye).removeEventListener("scroll",be),typeof window<"u"&&window.removeEventListener("resize",tt)}}),Lm(()=>{typeof document<"u"&&(document.removeEventListener("mousemove",ml),document.removeEventListener("mouseup",gl),document.removeEventListener("keydown",kc),document.removeEventListener("touchmove",_d),document.removeEventListener("touchend",Kl),document.removeEventListener("touchcancel",Kl)),typeof window<"u"&&window.removeEventListener("resize",St)});function hn(be){var tt;try{if(se=Date.now(),x(w,N(be.id)),x(M,N(be)),(tt=be.styles)!=null&&tt.line){const wt=be.styles.line;F.thickness=String(wt.size||2),F.color=wt.color||"#1677FF",F.style=wt.style===Ke.Dashed?"dashed":"solid"}if(be.points&&be.points.length>0){const wt=Ve(be),Lt=s(G)||wt;Lt&&(x(D,N({...Lt})),x(P,N({x:Lt.x,y:Lt.y})),x(C,!0),x(I,!1))}}catch(wt){console.warn("externalSelectOverlay failed:",wt)}}function Ho(be){var tt;try{(s(w)===be.id||((tt=s(M))==null?void 0:tt.id)===be.id)&&(x(w,""),x(I,!1),x(C,!1),x(Z,!1),x(P,null),x(M,null))}catch(wt){console.warn("externalDeselectOverlay failed:",wt)}}function Eo(be){try{Pd(be)}catch(tt){console.warn("externalSyncOverlay failed:",tt)}}function di(be){try{s(w)===be&&(x(w,""),x(I,!1),x(C,!1),x(Z,!1),x(P,null),x(M,null))}catch(tt){console.warn("externalRemoved failed:",tt)}}function ns(be={}){ba("text"),fi({name:"text",visible:s(h),lock:s(m),mode:s(p),styles:{text:{color:"#FFFFFF",backgroundColor:"#A0000020",borderColor:"#1677FF",size:be.fontSize??32,weight:be.fontWeight??"bold",family:be.fontFamily??Me}},extendData:{text:be.text??Cd,fontSize:be.fontSize??32,fontWeight:be.fontWeight??"bold",textColor:be.textColor??"#FFFFFF",backgroundColor:be.backgroundColor??"#A0000020",fontFamily:be.fontFamily??Me}})}function $i(be,tt){o()&&o().overrideOverlay({id:be,...tt})}function hi(be){o()&&o().removeOverlay({id:be})}function li(be){x(w,N(be||""))}function ks(be){var wt;if(!o())return;const tt=(wt=o().getOverlays({id:be}))==null?void 0:wt[0];tt&&tt.name==="text"&&Kg.startEditing(o(),tt)}function Vi(be){}var gs=FL(),ll=Dt(gs),mi=g(ll);mi.__click=[nL];var Na=g(mi);a(Na,()=>Sd,()=>"crosshair",()=>"",()=>[],()=>!0);var le=u(Na,2);vs(le,17,()=>oo,Vs,(be,tt)=>{var wt=oL(),Lt=Dt(wt),qt=Rv(()=>()=>s(tt).key==="emoji"?Ed():ba(s(tt).icon));a(Lt,()=>s(qt),()=>s(tt).icon,()=>s(tt).key,()=>s(tt).list,()=>!0);var qn=u(Lt,2);Te(qn,()=>s(tt).key==="emoji",Xt=>{l(Xt)}),z(be,wt)});var we=u(le,2),H=Rv(()=>()=>ba("ruler"));a(we,()=>s(H),()=>"ruler");var ne=u(we,2);a(ne,()=>Qs,()=>s(d),()=>"mode",()=>Gs,()=>!1,()=>!0);var _e=u(ne,2);a(_e,()=>$r,()=>s(m)?"lock":"unlock",()=>"",()=>[],()=>!1,()=>!0);var q=u(_e,2);a(q,()=>cd,()=>s(h)?"visible":"invisible",()=>"",()=>[],()=>!1,()=>!0);var De=u(q,2);l(De);var ot=u(De,2);a(ot,()=>Nl,()=>"remove"),f(mi),Xu(mi,be=>x(Ye,be),()=>s(Ye));var je=u(mi,2);Te(je,()=>s(it),be=>{var tt=iL();tt.__click=go,tt.__touchstart=[KT,go],tt.__touchend=[sL],z(be,tt)}),f(ll);var Ft=u(ll,2);Te(Ft,()=>s(c),be=>{var tt=pL(),wt=Dt(tt);vs(wt,17,()=>oo,Vs,(qt,qn)=>{var Xt=Ln(),vo=Dt(Xt);Te(vo,()=>s(qn).key===s(c)&&s(qn).list.length>0,To=>{var co=lL();const so=vt(()=>`left: 60px; top: ${Va(s(c))??""}px;`);vs(co,21,()=>s(qn).list,Vs,(Jo,Os)=>{var wr=aL();wr.__click=[rL,c,Fs,Os,xa,oo];var ra=g(wr),Qr=vt(()=>Al(s(Os).key));If(ra,{get name(){return s(Qr)},class:"w-4 h-4"});var hl=u(ra,2),lc=g(hl,!0);Se(()=>ze(lc,Vf[s(Os).text]())),f(hl),f(wr),sc("mouseenter",wr,qr=>qr.currentTarget.style.backgroundColor="var(--menu-hover-bg)"),sc("mouseleave",wr,qr=>qr.currentTarget.style.backgroundColor="transparent"),z(Jo,wr)}),f(co),Ly(co,Jo=>Je(Jo)),Se(()=>zt(co,"style",s(so))),z(To,co)}),z(qt,Xt)});var Lt=u(wt,2);Te(Lt,()=>s(c)==="mode",qt=>{var qn=uL();const Xt=vt(()=>`left: 60px; top: ${Va("mode")??""}px;`);vs(qn,21,()=>Gs,Vs,(vo,To)=>{var co=dL();co.__click=[cL,Fs,To];var so=g(co),Jo=vt(()=>Al(s(To).key));If(so,{get name(){return s(Jo)},class:"w-4 h-4"});var Os=u(so,2),wr=g(Os,!0);Se(()=>ze(wr,Vf[s(To).text]())),f(Os),f(co),sc("mouseenter",co,ra=>ra.currentTarget.style.backgroundColor="var(--menu-hover-bg)"),sc("mouseleave",co,ra=>ra.currentTarget.style.backgroundColor="transparent"),z(vo,co)}),f(qn),Ly(qn,vo=>Je(vo)),Se(()=>zt(qn,"style",s(Xt))),z(qt,qn)}),z(be,tt)});var Be=u(Ft,2);Te(Be,()=>s(C)&&s(D),be=>{var tt=TL();tt.__click=[vL];var wt=g(tt);Te(wt,()=>{var so;return((so=s(M))==null?void 0:so.name)!=="emoji"},so=>{var Jo=hL(),Os=Dt(Jo);Os.__mousedown=Dl,Os.__touchstart=[HT,Dl];var wr=g(Os),ra=g(wr),Qr=g(ra);ai(2),f(ra),ai(4),f(wr),f(Os);var hl=u(Os,2);Te(hl,()=>{var lc;return((lc=s(M))==null?void 0:lc.name)==="text"},lc=>{var qr=mL(),Ga=Dt(qr);Ga.__change=fa;var Ki=g(Ga);Ki.value=(Ki.__value="8")==null?"":"8";var Zl=u(Ki);Zl.value=(Zl.__value="10")==null?"":"10";var Tl=u(Zl);Tl.value=(Tl.__value="11")==null?"":"11";var Ya=u(Tl);Ya.value=(Ya.__value="12")==null?"":"12";var ur=u(Ya);ur.value=(ur.__value="14")==null?"":"14";var rc=u(ur);rc.value=(rc.__value="16")==null?"":"16";var zr=u(rc);zr.value=(zr.__value="18")==null?"":"18";var rd=u(zr);rd.value=(rd.__value="20")==null?"":"20";var cc=u(rd);cc.value=(cc.__value="22")==null?"":"22";var dc=u(cc);dc.value=(dc.__value="24")==null?"":"24";var Er=u(dc);Er.value=(Er.__value="32")==null?"":"32";var Sc=u(Er);Sc.value=(Sc.__value="40")==null?"":"40";var ea=u(Sc);ea.value=(ea.__value="52")==null?"":"52",f(Ga);var Cc=u(Ga,2);Cc.__click=[qT,Fe,fa];var Ac=u(Cc,2),cu=g(Ac),Id=g(cu);const Zc=vt(()=>`background-color: ${Fe.textColor??""}; color: ${kt(Fe.textColor)??""};`);Id.__click=[GT,oe,ee,Fe,re,Ze,Y];var ce=g(Id);If(ce,{name:"text",size:12}),f(Id);var st=u(Id,2);const ge=vt(()=>`background-color: ${Fe.backgroundColor??""}; color: ${kt(Fe.backgroundColor)??""};`);st.__click=[YT,oe,ee,Fe,re,Ge,Y];var Le=g(st);If(Le,{name:"rect",size:12}),f(st),f(cu);var dt=u(cu,2);dt.__change=fa,vs(dt,21,()=>ft,Vs,(At,pt)=>{var at=fL(),Ct={},Re=g(at,!0);f(at),Se(()=>{Ct!==(Ct=s(pt).value)&&(at.value=(at.__value=s(pt).value)==null?"":s(pt).value),ze(Re,s(pt).label)}),z(At,at)}),f(dt),f(Ac),Se(()=>{Us(Ga,`px-1 py-1 text-xs border rounded cursor-pointer\\n ${(r().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[72px] h-[28px] svelte-t6isn6`),Us(Cc,`w-8 h-8 rounded flex items-center justify-center ${(r().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors svelte-t6isn6`),zt(Id,"style",s(Zc)),zt(st,"style",s(ge)),Us(dt,`px-1 py-1 text-xs border rounded cursor-pointer\\n ${(r().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n max-w-[120px] svelte-t6isn6`)}),qo(Ga,()=>Fe.fontSize,At=>Fe.fontSize=At),qo(dt,()=>Fe.fontFamily,At=>Fe.fontFamily=At),z(lc,qr)},lc=>{var qr=gL(),Ga=Dt(qr);Ga.__click=[UT,oe,ee,F,re,ye,Y];var Ki=u(Ga,2);Ki.__change=dd;var Zl=g(Ki);Zl.value=(Zl.__value="1")==null?"":"1";var Tl=u(Zl);Tl.value=(Tl.__value="2")==null?"":"2";var Ya=u(Tl);Ya.value=(Ya.__value="3")==null?"":"3";var ur=u(Ya);ur.value=(ur.__value="4")==null?"":"4";var rc=u(ur);rc.value=(rc.__value="5")==null?"":"5";var zr=u(rc);zr.value=(zr.__value="6")==null?"":"6";var rd=u(zr);rd.value=(rd.__value="7")==null?"":"7";var cc=u(rd);cc.value=(cc.__value="8")==null?"":"8",f(Ki);var dc=u(Ki,2);dc.__change=dd;var Er=g(dc);Er.value=(Er.__value="solid")==null?"":"solid";var Sc=u(Er);Sc.value=(Sc.__value="dashed")==null?"":"dashed";var ea=u(Sc);ea.value=(ea.__value="dotted")==null?"":"dotted",f(dc),Se(()=>{zt(Ga,"style",`background-color: ${F.color??""};`),Us(Ki,`px-1 py-1 text-xs border rounded-md cursor-pointer\\n ${(r().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[64px] h-[28px] svelte-t6isn6`),Us(dc,`px-1 py-1 text-xs border rounded-md cursor-pointer\\n ${(r().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[72px] h-[28px] svelte-t6isn6`)}),qo(Ki,()=>F.thickness,Cc=>F.thickness=Cc),qo(dc,()=>F.style,Cc=>F.style=Cc),z(lc,qr)}),Se(()=>{Us(Os,`drag-handle cursor-grab hover:cursor-grabbing flex items-center justify-center
                 w-6 h-6 rounded ${(r().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors
                 touch-manipulation svelte-t6isn6`),Us(Qr,`w-0.5 h-0.5 ${(r().theme==="dark"?"bg-gray-500":"bg-gray-400")??""} rounded-full`)}),z(so,Jo)},so=>{var Jo=yL(),Os=g(Jo),wr=g(Os,!0);f(Os);var ra=u(Os,2),Qr=u(g(ra),2);Qt(Qr),Qr.__input=[_L,Gd];var hl=u(Qr,2),lc=g(hl,!0);f(hl),f(ra),f(Jo),Se(()=>{var qr,Ga,Ki,Zl,Tl,Ya,ur,rc;ze(wr,((Ga=(qr=s(M))==null?void 0:qr.extendData)==null?void 0:Ga.emoji)||"😀"),Jd(Qr,((Zl=(Ki=s(M))==null?void 0:Ki.extendData)==null?void 0:Zl.size)||24),zt(Qr,"title",`Emoji size: ${(((Ya=(Tl=s(M))==null?void 0:Tl.extendData)==null?void 0:Ya.size)||24)??""}px`),ze(lc,((rc=(ur=s(M))==null?void 0:ur.extendData)==null?void 0:rc.size)||24)}),z(so,Jo)});var Lt=u(wt,2);Te(Lt,()=>{var so;return((so=s(M))==null?void 0:so.name)==="fibonacciSegment"},so=>{var Jo=xL();Jo.__click=[bL,lu];var Os=g(Jo);f(Jo),Se(()=>{Us(Jo,`w-8 h-8 rounded ${(r().theme==="dark"?"hover:bg-blue-900":"hover:bg-blue-100")??""} transition-colors duration-200
                 flex items-center justify-center svelte-t6isn6`),zh(Os,`w-4 h-4 ${(r().theme==="dark"?"text-gray-300":"text-gray-600")??""} hover:text-blue-500`)}),z(so,Jo)});var qt=u(Lt,2),qn=g(qt);qn.__click=[wL,Z];var Xt=g(qn);f(qn);var vo=u(qn,2);Te(vo,()=>s(Z),so=>{var Jo=ML();Jo.__click=[kL];var Os=g(Jo);Os.__click=[SL,Vd,Z];var wr=u(Os,2);wr.__click=[CL,sd,Z];var ra=u(wr,2);Te(ra,()=>s(W),Qr=>{var hl=IL();hl.__click=[PL,id,Z],Se(()=>Us(hl,`w-full text-left px-3 py-2 text-sm ${(r().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-t6isn6`)),z(Qr,hl)}),f(Jo),Se(()=>{Us(Jo,`absolute right-0 top-full mt-1 min-w-[140px] rounded-md shadow-lg border ${(r().theme==="dark"?"bg-[#2B2B2B] border-[#3F3F3F]":"bg-white border-gray-200")??""} z-[200002]`),Us(Os,`w-full text-left px-3 py-2 text-sm ${(r().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-t6isn6`),Us(wr,`w-full text-left px-3 py-2 text-sm ${(r().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-t6isn6`)}),z(so,Jo)}),f(qt);var To=u(qt,2);To.__click=[AL,Nl,C,P];var co=g(To);f(To),f(tt),Se(()=>{Us(tt,`context-menu-container fixed z-[200001] rounded-md shadow-lg flex items-center gap-1 space-x-1\\n ${(r().theme==="dark"?"bg-[#2B2B2B] border border-[#3F3F3F]":"bg-white border border-gray-200")??""} ${(s(V)?"cursor-grabbing":"")??""}\\n px-2 py-1 sm:px-3 sm:py-1\\n max-w-[85vw] sm:max-w-none svelte-t6isn6`),zt(tt,"data-theme",r().theme),zt(tt,"style",`left: ${s(D).x??""}px; 
           top: ${s(D).y??""}px;`),Us(qn,`w-8 h-8 rounded ${(r().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors duration-200 flex items-center justify-center svelte-t6isn6`),zt(qn,"aria-expanded",s(Z)),zh(Xt,`w-4 h-4 ${(r().theme==="dark"?"text-gray-300":"text-gray-600")??""}`),Us(To,`w-8 h-8 rounded ${(r().theme==="dark"?"hover:bg-red-900":"hover:bg-red-100")??""} transition-colors duration-200
               flex items-center justify-center svelte-t6isn6`),zh(co,`w-4 h-4 ${(r().theme==="dark"?"text-gray-300":"text-gray-600")??""} hover:text-red-500`)}),z(be,tt)});var xt=u(Be,2);Te(xt,()=>s(I)&&s(P),be=>{var tt=LL();tt.__click=Nl,Se(()=>zt(tt,"style",`left: ${s(P).x??""}px; top: ${s(P).y??""}px;`)),z(be,tt)});var an=u(xt,2);Pf(an,{get selectedColor(){return s(ee)},set selectedColor(be){x(ee,N(be))},get opacity(){return s(re)},set opacity(be){x(re,N(be))},get show(){return s(Y)},set show(be){x(Y,N(be))},$$events:{colorChange:ic,opacityChange:od,close:zd}});var Yn=u(an,2);ET(Yn,{get show(){return s(me)},set show(be){x(me,N(be))},get position(){return s(K)},set position(be){x(K,N(be))},$$events:{select:zl}});var bn=u(Yn,2);return WT(bn,{get visible(){return s(bt)},set visible(be){x(bt,N(be))},get levels(){return s(nt)},set levels(be){x(nt,N(be))},get theme(){return r().theme},$$events:{levelChange:be=>yd(be.detail.index,be.detail.field,be.detail.value),reset:Yd,confirm:eu,cancel:Ju}}),z(n,gs),hd({addOverlay:fi,clickRemove:Nl,externalSelectOverlay:hn,externalDeselectOverlay:Ho,externalSyncOverlay:Eo,externalRemoved:di,createTextDrawing:ns,updateTextDrawing:$i,deleteTextDrawing:hi,setSelectedDrawing:li,enterEditMode:ks,exitEditMode:Vi})}qu(["click","touchstart","touchend","mousedown","change","input"]);const bw={mode:"none",playing:!1,speed:1,depositAmount:1e5,leverage:null,currency:"USD",balance:1e5,positions:[],history:[],sidebarOpen:!1,pendingOrders:[],onboardingDone:!1},gv=zp(bw);function xw(){gv.set(bw)}function ww(n){var t;const e=n.priceCurrency||((t=n.exchange)!=null&&t.toUpperCase().includes("DSE")?"BDT":"USD");gv.update(o=>({...o,currency:e}))}function kw(n){gv.update(e=>({...e,currency:n}))}function Sw(n){gv.update(e=>({...e,depositAmount:n,balance:n}))}function Cw(n){gv.update(e=>({...e,leverage:n}))}function Pw(n){gv.update(e=>({...e,onboardingDone:n}))}function Iw(n){gv.update(e=>({...e,mode:n}))}function n0(n){gv.update(e=>({...e,playing:n}))}function fy(n){if(gv.update(e=>({...e,speed:n})),typeof window<"u"&&window.setPlaybackSpeed)try{window.setPlaybackSpeed(n)}catch{}}function Mw(n){gv.update(e=>({...e,positions:[...e.positions,n],balance:e.balance-n.avgCost*n.quantity}))}function EL(n,e,t){gv.update(o=>{const i=o.positions.findIndex(m=>m.id===n);if(i===-1)return o;const r=o.positions[i],a=Math.min(e,r.quantity),l=(t-r.avgCost)*a*(r.leverage||1),c=r.quantity-a,d=[...o.positions];c>0?d[i]={...r,quantity:c}:d.splice(i,1);const p={id:n,symbol:r.symbol,quantity:a,avgCost:r.avgCost,closedAvg:t,pnl:l,closedAt:Date.now()};return{...o,positions:d,history:[p,...o.history],balance:o.balance+t*a+l}})}function NL(n){gv.update(e=>({...e,pendingOrders:[...e.pendingOrders||[],n]}))}function i1(n){gv.update(e=>({...e,pendingOrders:(e.pendingOrders||[]).filter(t=>t.id!==n)}))}function Cb(n,e,t){e(!1),n.stopPropagation(),t.click&&t.click("close")}var DL=n=>n.stopPropagation(),jL=(n,e,t)=>e(s(t)),RL=fe("<button> </button>"),BL=fe('<div class="modal-action px-4 sm:px-6 py-4 sm:py-5 border-t modal-footer svelte-1a6y34w"><div class="flex flex-col sm:flex-row gap-2 sm:gap-3 justify-end w-full"></div></div>'),OL=fe('<div class="fixed inset-0 z-[350000] flex items-center justify-center px-3 sm:px-4 md:px-6 animate-in fade-in duration-200 modal-overlay svelte-1a6y34w"><div><div class="relative px-4 sm:px-6 py-4 sm:py-5 border-b modal-header svelte-1a6y34w"><div class="flex justify-between items-center gap-4"><div class="flex items-center gap-3 min-w-0 flex-1"><div class="icon-badge svelte-1a6y34w"><svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div> <h3 class="font-bold text-lg sm:text-xl md:text-2xl tracking-tight text-base-content truncate"> </h3></div> <button class="close-btn flex-shrink-0 svelte-1a6y34w" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 sm:w-6 sm:h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div><!></div> <!></div></div>');function vf(n,e){gd(e,!0);let t=Ws(e,"width",3,600),o=Ws(e,"maxWidth",3,"min(600px, 95vw)"),i=Ws(e,"maxHeight",3,"90vh"),r=Ws(e,"title",3,""),a=Ws(e,"buttons",19,()=>["confirm"]),l=Ws(e,"show",15,!1),c=Ws(e,"center",3,!1),d=Ws(e,"class",3,""),p=Ws(e,"theme",3,"dark");function m(S){S==="close"&&l(!1),e.click&&e.click(S)}function h(S){switch(S){case"confirm":return"btn-primary";case"cancel":return"btn-ghost";default:return"btn-secondary"}}var _=Ln(),w=Dt(_);Te(w,l,S=>{var P=OL();P.__click=[Cb,l,e];var I=g(P);I.__click=[DL];var C=g(I),M=g(C),F=g(M),V=u(g(F),2),j=g(V,!0);f(V),f(F);var D=u(F,2);D.__click=[Cb,l,e],f(M),f(C);var R=u(C,2),W=g(R);Te(W,()=>e.children,Z=>{var G=Ln(),se=Dt(G);dk(se,()=>e.children),z(Z,G)}),f(R);var J=u(R,2);Te(J,()=>a().length>0,Z=>{var G=BL(),se=g(G);vs(se,21,a,Vs,(Y,oe)=>{var ee=RL();const re=vt(()=>`btn-premium ${h(s(oe))??""} w-full sm:w-auto sm:min-w-[120px] svelte-1a6y34w`);ee.__click=[jL,m,oe];var me=g(ee,!0);Se(()=>ze(me,Vf[s(oe)]())),f(ee),Se(()=>Us(ee,s(re))),z(Y,ee)}),f(se),f(G),z(Z,G)}),f(I),f(P),Se(()=>{Us(I,`relative rounded-3xl shadow-luxury animate-in zoom-in-95 duration-300 overflow-hidden flex flex-col modal-container ${d()??""} svelte-1a6y34w`),zt(I,"data-theme",p()),zt(I,"style",`width: ${(typeof t()=="string"?t():t()+"px")??""}; max-width: ${o()??""}; max-height: ${i()??""};`),ze(j,r()),Us(R,`flex-1 overflow-y-auto premium-scrollbar ${(c()?"flex justify-center items-center":"")??""} px-4 sm:px-6 py-4 sm:py-5 svelte-1a6y34w`)}),z(S,P)}),z(n,_),hd()}qu(["click"]);const zL="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Aw=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=zL[t[n]&63];return e};/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const VL={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var WL=gr("<svg><!><!></svg>");function Wp(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]),o=xp(t,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);gd(e,!1);let i=Ws(e,"name",8,void 0),r=Ws(e,"color",8,"currentColor"),a=Ws(e,"size",8,24),l=Ws(e,"strokeWidth",8,2),c=Ws(e,"absoluteStrokeWidth",8,!1),d=Ws(e,"iconNode",24,()=>[]);const p=(...C)=>C.filter((M,F,V)=>!!M&&V.indexOf(M)===F).join(" "),m=Ng(),[h,_]=m;Bv();var w=WL();let S;var P=g(w);vs(P,1,d,Vs,(C,M)=>{let F=()=>s(M)[0],V=()=>s(M)[1];var j=Ln(),D=Dt(j);const R=Rv(()=>`${F()}`=="button"?_({...V()},[{attribute_name:"formaction"}]):`${F()}`=="form"?_({...V()},[{attribute_name:"action"}]):`${F()}`=="a"?_({...V()},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{...V()});gk(D,F,!0,(W,J)=>{let Z;Se(()=>Z=Ty(W,Z,{...s(R)},void 0,W.namespaceURI===N2,W.nodeName.includes("-")))}),z(C,j)});var I=u(P);Lp(I,e,"default",{}),f(w),Se(()=>S=Ty(w,S,{...VL,...o,width:a(),height:a(),stroke:r(),"stroke-width":c()?Number(l())*24/Number(a()):l(),class:p("lucide-icon","lucide",i()?`lucide-${i()}`:"",t.class)},void 0,!0)),z(n,w),hd()}function qL(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"activity"},()=>t,{iconNode:[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function HL(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"banknote"},()=>t,{iconNode:[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2"}],["circle",{cx:"12",cy:"12",r:"2"}],["path",{d:"M6 12h.01M18 12h.01"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function UL(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"camera"},()=>t,{iconNode:[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z"}],["circle",{cx:"12",cy:"13",r:"3"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function GL(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"clock"},()=>t,{iconNode:[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function YL(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"code-xml"},()=>t,{iconNode:[["path",{d:"m18 16 4-4-4-4"}],["path",{d:"m6 8-4 4 4 4"}],["path",{d:"m14.5 4-5 16"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function KL(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"download"},()=>t,{iconNode:[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function ZL(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"flask-conical"},()=>t,{iconNode:[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2"}],["path",{d:"M6.453 15h11.094"}],["path",{d:"M8.5 2h7"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function XL(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"gauge"},()=>t,{iconNode:[["path",{d:"m12 14 4-4"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function JL(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"log-out"},()=>t,{iconNode:[["path",{d:"m16 17 5-5-5-5"}],["path",{d:"M21 12H9"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function QL(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"maximize"},()=>t,{iconNode:[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function eF(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"minimize"},()=>t,{iconNode:[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function tF(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"moon"},()=>t,{iconNode:[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function nF(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"pause"},()=>t,{iconNode:[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function oF(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"play"},()=>t,{iconNode:[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function sF(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"save"},()=>t,{iconNode:[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function iF(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"search"},()=>t,{iconNode:[["path",{d:"m21 21-4.34-4.34"}],["circle",{cx:"11",cy:"11",r:"8"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function rF(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"settings"},()=>t,{iconNode:[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function aF(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"sun"},()=>t,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function lF(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"trending-up"},()=>t,{iconNode:[["path",{d:"M16 7h6v6"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}function cF(n,e){const t=xp(e,["children","$$slots","$$events","$$legacy"]);Wp(n,Vp({name:"wallet"},()=>t,{iconNode:[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"}]],children:(i,r)=>{var a=Ln(),l=Dt(a);Lp(l,e,"default",{}),z(i,a)},$$slots:{default:!0}}))}const Tw=["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHF","CLP","CNY","COP","CRC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRU","MUR","MVR","MWK","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","SSP","STN","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VES","VND","VUV","WST","XAF","XCD","XOF","XPF","YER","ZAR","ZMW","ZWL"],Lw="smartchart.alerts.v1",Hg={rules:{},logs:[],delivery:{},options:{backfill:!1,maxLogs:500},lastFired:{},firedOnce:{}},dF=()=>{if(typeof window>"u"||!window.localStorage)return{...Hg};try{const n=localStorage.getItem(Lw);if(!n)return{...Hg};const e=JSON.parse(n);return{...Hg,...e,options:{...Hg.options,...e.options||{}},delivery:{...Hg.delivery,...e.delivery||{}},rules:e.rules||{},logs:Array.isArray(e.logs)?e.logs:[],lastFired:e.lastFired||{},firedOnce:e.firedOnce||{}}}catch(n){return console.warn("Failed to load alerts state:",n),{...Hg}}},uF=n=>{if(!(typeof window>"u"||!window.localStorage))try{localStorage.setItem(Lw,JSON.stringify(n))}catch(e){console.warn("Failed to persist alerts state:",e)}},uf=zp(dF());uf.subscribe(n=>uF(n));const Xh=zp(!1),u_=n=>({id:n,enabled:!0,frequency:"once_per_bar",channels:{app:!0,webhook:!1,email:!1,push:!1}}),pF=n=>{uf.update(e=>{const t={...e.rules};for(const o of n){const i=t[o.id];t[o.id]={...i||u_(o.id),...o,channels:{...(i==null?void 0:i.channels)||u_(o.id).channels,...o.channels||{}},enabled:o.enabled??(i==null?void 0:i.enabled)??!0,frequency:o.frequency||(i==null?void 0:i.frequency)||"once_per_bar"}}return e.rules=t,e})},O0=(n,e)=>{uf.update(t=>{const o=t.rules[n]||u_(n);return t.rules={...t.rules,[n]:{...o,...e,channels:{...o.channels,...e.channels||{}}}},t})},Ah=n=>{uf.update(e=>(e.delivery={...e.delivery,...n},e))},Pb=n=>{uf.update(e=>(e.options={...e.options,...n},e))},r1=()=>{uf.update(n=>(n.logs=[],n.lastFired={},n.firedOnce={},n))},vF=()=>{uf.update(n=>(n.lastFired={},n.firedOnce={},n))},fF=(n,e,t,o)=>{if(!e.enabled||!n.options.backfill&&t<o)return!1;if(e.frequency==="once")return!n.firedOnce[e.id];const i=n.lastFired[e.id];return!(i&&i.index===t)},mF=(n,e,t,o)=>{n.lastFired[e.id]={index:t,timestamp:o},e.frequency==="once"&&(n.firedOnce[e.id]=!0)},gF=(n,e,t)=>`${n}_${t}_${e}_${Math.random().toString(36).slice(2,8)}`,Fw=n=>{uf.update(e=>{const t=[...n,...e.logs],o=e.options.maxLogs;return e.logs=o>0?t.slice(0,o):t,e})},hF=async n=>{const e=tv(uf),{events:t,context:o}=n;if(!t.length)return[];const i=[];for(const r of t){const a=String(r.signalId||r.title||r.message||"alert"),l=e.rules[a]||u_(a),c={...l,id:a,title:l.title??r.title,message:l.message??r.message,frequency:r.frequency||l.frequency};if(!fF(e,c,r.index,o.latestIndex))continue;mF(e,c,r.index,r.timestamp);const d=[];Object.keys(c.channels).forEach(p=>{const m=c.channels[p];d.push({channel:p,status:m?"pending":"skipped"})}),i.push({id:gF(a,r.timestamp,r.index),ruleId:a,timestamp:r.timestamp,barIndex:r.index,symbol:o.symbol,timeframe:o.timeframe,title:c.title,message:c.message,price:o.price,deliveries:d})}return i.length?(uf.set(e),Fw(i),i):(uf.set(e),[])},$w=async n=>{var o;const e=tv(uf),t=Object.keys(((o=e.rules[n.ruleId])==null?void 0:o.channels)||{}).filter(i=>{var r,a;return(a=(r=e.rules[n.ruleId])==null?void 0:r.channels)==null?void 0:a[i]});if(!t.length)return[];try{const i=await fetch("/api/alerts/deliver",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:n,delivery:e.delivery,channels:t})});if(!i.ok)return t.map(a=>({channel:a,status:"failed",detail:`HTTP ${i.status}`}));const r=await i.json();return Array.isArray(r==null?void 0:r.deliveries)?r.deliveries:[]}catch(i){return t.map(r=>({channel:r,status:"failed",detail:(i==null?void 0:i.message)||"Delivery failed"}))}},Ew=(n,e)=>{uf.update(t=>(t.logs=t.logs.map(o=>o.id!==n?o:{...o,deliveries:e.length?e:o.deliveries}),t))};function _F(){Xh.set(!0)}function yF(n,e,t,o){kw(s(e)),Sw(Math.max(0,Number(s(t))||0)),x(o,2)}function bF(){var n;try{(n=window.predictNextCandle)==null||n.call(window)}catch{}n0(!0)}function xF(n){fy(parseFloat(n.target.value))}function wF(n,e,t,o,i){var c,d;if(!(typeof window<"u"?window.confirm("Exit simulator?"):!0))return;e();const a=t().positions;for(const p of a){try{p.lineOverlayId&&((c=o())==null||c.removeOverlay({id:p.lineOverlayId}))}catch{}try{p.noteOverlayId&&((d=o())==null||d.removeOverlay({id:p.noteOverlayId}))}catch{}}xw();const l=window.sidebarHostRef;l&&l.closeSidebar&&l.closeSidebar()}function kF(n,e,t,o,i,r,a,l){x(e,!0),x(t,"instant"),x(o,1),x(i,null),x(r,1),x(a,null),x(l,null)}function SF(n,e,t,o,i,r,a,l,c,d,p,m,h){var V,j;x(e,null);const _=s(t),w=Math.max(0,Number(s(o))||0);if(w<=0||_<=0){x(e,"Invalid quantity");return}if(!i(w,_)){x(e,"Quantity exceeds balance");return}r();const S=Aw(),P=a(),I=(V=l())==null?void 0:V.createOverlay({name:"horizontalStraightLine",points:[{value:_}],styles:{line:{style:Ke.Dashed,size:1}}}),C=(j=l())==null?void 0:j.createOverlay({name:"note",points:[{timestamp:P,value:_}],extendData:{in_text:"BUY",in_color:"#10b981",line_color:"#10b981"}}),M=Array.isArray(I)?I[0]??void 0:I??void 0,F=Array.isArray(C)?C[0]??void 0:C??void 0;Mw({id:S,symbol:d().symbol,quantity:w,avgCost:_,leverage:m().leverage,openedAt:Date.now(),lineOverlayId:M,noteOverlayId:F}),x(h,!1)}function CF(n,e,t,o,i,r,a,l,c,d,p,m,h){var V,j;x(e,null);const _=Math.max(0,Number(s(t))||0),w=Math.max(0,Number(s(o))||0);if(w<=0||_<=0){x(e,"Quantity exceeds balance or invalid price");return}if(!i(w,_)){x(e,"Quantity exceeds balance or invalid price");return}const S=Aw(),P=_>=s(r),I=(V=a())==null?void 0:V.createOverlay({name:"horizontalStraightLine",points:[{value:_}],styles:{line:{style:Ke.Dashed,size:1}}}),C=(j=a())==null?void 0:j.createOverlay({name:"note",points:[{timestamp:c(),value:_}],extendData:{in_text:"PENDING",in_color:"#f59e0b",line_color:"#f59e0b"}}),M=Array.isArray(I)?I[0]??void 0:I??void 0,F=Array.isArray(C)?C[0]??void 0:C??void 0;NL({id:S,symbol:d().symbol,quantity:w,price:_,leverage:m().leverage,createdAt:Date.now(),triggerUp:P,lineOverlayId:M,noteOverlayId:F}),x(h,!1)}var PF=fe("<option> </option>"),IF=fe('<div class="grid grid-cols-1 sm:grid-cols-3 gap-2 items-end w-full"><div class="flex flex-col gap-1"><div class="text-xs opacity-80">Currency</div> <select class="select select-bordered select-sm"></select></div> <input class="input input-bordered input-sm" type="number" min="0" placeholder="Deposit"> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Confirm Deposit</button></div>'),MF=(n,e)=>x(e,!0),AF=(n,e)=>x(e,!1),TF=fe('<div class="flex items-center gap-2 w-full"><select class="select select-bordered select-sm"><option>1:50</option><option>1:100</option><option>1:200</option><option>1:400</option><option>1:500</option></select> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Confirm</button></div>'),LF=(n,e,t)=>{x(e,null),t()},FF=fe('<button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Confirm</button>'),$F=fe('<div class="space-y-2 w-full"><div class="text-sm">Take leverage?</div> <div class="flex items-center gap-2 w-full"><label class="label cursor-pointer"><input type="radio" name="lev" class="radio radio-sm"> <span class="label-text ml-2">Yes</span></label> <label class="label cursor-pointer"><input type="radio" name="lev" class="radio radio-sm"> <span class="label-text ml-2">No</span></label></div> <!></div>'),EF=fe('<span class="text-success"> </span>'),NF=fe('<span class="text-error"> </span>'),DF=fe("<span>No trades</span>"),jF=fe('<button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button"><!></button>'),RF=fe('<button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button"><!></button>'),BF=(n,e)=>fy(e),OF=fe('<button type="button"> </button>'),zF=(n,e)=>x(e,"portfolio"),VF=(n,e)=>x(e,"history"),WF=(n,e,t)=>e(s(t)),qF=fe('<div class="flex items-center justify-between text-sm mt-2 gap-2"><div class="flex items-center gap-2 min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div></div> <div class="flex items-center gap-2"><button class="btn btn-sm btn-premium-ghost svelte-112gz12" type="button">Cancel</button></div></div>'),HF=fe('<div class="card lux-card shadow w-full mb-3 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="text-sm font-semibold">Pending Orders</div> <!></div></div>'),UF=(n,e,t)=>{x(e,""),x(t,0)},GF=fe('<button class="btn btn-xs btn-premium-ghost svelte-112gz12" type="button">Cancel</button>'),YF=(n,e,t)=>e(s(t).id),KF=fe('<button class="btn btn-xs btn-premium-outline svelte-112gz12" type="button">Sell</button>'),ZF=(n,e)=>e(!0),XF=(n,e)=>e(!1),JF=fe('<div class="sell-panel w-full mt-2 space-y-3 svelte-112gz12"><div class="sell-section svelte-112gz12"><div class="flex items-center justify-between"><div class="text-xs opacity-70"> </div> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Close All</button></div></div> <div class="sell-section svelte-112gz12"><div class="text-xs opacity-70 mb-2">Close partial position</div> <div class="flex items-center gap-2"><input class="input input-bordered input-sm flex-1" type="number" min="0" placeholder="Partial qty"> <button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Confirm Partial</button></div> <div class="mt-2 text-xs opacity-70 flex items-center justify-between"><span> </span> <span> </span></div></div></div>'),QF=fe('<div class="card lux-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="flex items-center justify-between"><div class="flex items-center gap-2 text-sm min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div></div> <div class="flex items-center gap-2"><div> </div> <!></div></div> <!></div></div>'),e$=fe("<!> <!>",1),t$=fe('<div class="card trade-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 text-sm min-w-0"><div class="flex items-center justify-between"><div class="flex items-center gap-2 min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div></div> <div> </div></div> <div class="mt-1 truncate"> </div></div></div>'),n$=fe('<div class="card history-summary-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="grid grid-cols-3 gap-2 items-stretch"><div class="summary-tile win svelte-112gz12"><div class="summary-title svelte-112gz12">Winning</div> <div class="summary-values svelte-112gz12"><div class="badge badge-success text-[10px]"> </div> <div class="summary-amount svelte-112gz12"> </div></div></div> <div class="summary-tile loss svelte-112gz12"><div class="summary-title svelte-112gz12">Losing</div> <div class="summary-values svelte-112gz12"><div class="badge badge-error text-[10px]"> </div> <div class="summary-amount svelte-112gz12"> </div></div></div> <div><div class="summary-title svelte-112gz12">Net</div> <div class="summary-values svelte-112gz12"><div class="summary-amount svelte-112gz12"> </div></div></div></div></div></div> <!>',1),o$=fe('<div class="exit-bar svelte-112gz12"><div class="exit-copy svelte-112gz12">Practice live trading. Check your predictions and improve.</div> <button class="btn btn-sm btn-premium-danger exit-cta svelte-112gz12" type="button"><!> Exit</button></div> <div class="mini-stack grid grid-cols-1 gap-2 w-full svelte-112gz12"><div class="card glass lux-card shadow overflow-hidden mini-tile deposit-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Deposit</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"> </div></div></div></div></div> <div class="card glass lux-card shadow overflow-hidden mini-tile investment-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Investment <span class="badge badge-outline text-[9px] ml-1"> </span></div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"><!></div></div></div></div></div> <div class="card glass lux-card shadow overflow-hidden mini-tile available-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Available</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"> </div></div></div></div></div></div> <div class="card speed-card w-full svelte-112gz12"><div class="card-body p-4"><div class="speed-header flex items-center justify-between svelte-112gz12"><div class="flex items-center gap-2"><div class="speed-icon svelte-112gz12"><!></div> <div class="speed-title svelte-112gz12">Playback Speed</div></div> <div class="speed-badge svelte-112gz12"> </div></div> <div class="mt-3 flex items-center gap-3"><input type="range" min="0.5" max="10" step="0.5" class="speed-range flex-1 svelte-112gz12"> <!></div> <div class="mt-2 speed-chips svelte-112gz12"></div></div></div> <div class="card trade-action-card w-full overflow-hidden svelte-112gz12"><div class="card-body p-4 min-w-0"><div class="flex items-center justify-between"><div><div class="text-xs opacity-70">Current Price</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div></div> <div class="badge badge-success badge-outline">LIVE</div></div> <div class="mt-3"><button class="btn btn-premium-primary w-full svelte-112gz12" type="button">Buy Stock</button></div></div></div> <div class="card lux-card shadow w-full svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="flex items-center justify-between"><div><div class="text-xs opacity-70">Alerts</div> <div class="text-sm font-semibold">Script Alerts Center</div></div> <button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Open</button></div></div></div> <div class="tabs tabs-boxed w-full mt-3 gap-3 svelte-112gz12"><button type="button">Portfolio</button> <button type="button">History</button></div> <!>',1),s$=(n,e)=>x(e,"instant"),i$=(n,e)=>x(e,"pending"),r$=fe('<div class="text-error text-xs mt-1"> </div>'),a$=fe('<div class="space-y-2"><div class="card buy-card svelte-112gz12"><div class="card-body p-3"><div class="flex items-center justify-between"><div class="text-xs opacity-70">Current Price</div> <div class="metric-value font-bold truncate whitespace-nowrap svelte-112gz12"> </div></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 items-end mt-2"><input class="input input-bordered input-sm" type="number" min="0" placeholder="Quantity"> <button class="btn btn-sm btn-premium-primary w-full svelte-112gz12" type="button">Confirm Buy</button></div> <!></div></div></div>'),l$=fe('<div class="text-error text-xs"> </div>'),c$=fe('<div class="space-y-2"><div class="grid grid-cols-2 gap-2 items-end"><input class="input input-bordered input-sm" type="number" min="0" placeholder="Custom Price"> <input class="input input-bordered input-sm" type="number" min="0" placeholder="Quantity"></div> <button class="btn btn-sm btn-premium-primary w-full svelte-112gz12" type="button">Place Pending Buy</button> <!></div>'),d$=fe('<div class="space-y-3"><div class="flex items-center gap-2"><div class="badge badge-outline">Mode</div> <label class="label cursor-pointer"><input type="radio" name="buyMode" class="radio radio-sm"> <span class="label-text ml-2">Instant</span></label> <label class="label cursor-pointer"><input type="radio" name="buyMode" class="radio radio-sm"> <span class="label-text ml-2">Pending</span></label></div> <!></div>'),u$=fe('<div class="p-4 space-y-4 w-full box-border"><!></div> <!>',1);function p$(n,e){gd(e,!0);const t=wp(),o=()=>ya(gv,"$simulator",t),i=()=>ya(l,"$save",t),r=()=>ya(a,"$chart",t),a=Kc("chart"),l=Kc("save");let c=ae(N(o().depositAmount)),d=ae(N(o().currency||i().symbol.priceCurrency||"USD")),p=ae(!1),m=ae(null),h=ae(N(o().onboardingDone?3:1)),_=ae(0),w=null,S=ae(0),P=ae(""),I=ae("portfolio"),C=ae(!1),M=ae("instant"),F=ae(null),V=ae(1),j=ae(1),D=ae(null),R=ae(null);const W=vt(()=>(o().positions||[]).length>0),J=vt(()=>(o().positions||[]).reduce((Qe,yt)=>Qe+(s(_)-yt.avgCost)*yt.quantity*(yt.leverage||1),0)),Z=vt(()=>o().history||[]),G=vt(()=>s(Z).filter(Qe=>(Qe.pnl??0)>0).length),se=vt(()=>s(Z).filter(Qe=>(Qe.pnl??0)<0).length),Y=vt(()=>s(Z).reduce((Qe,yt)=>Qe+((yt.pnl??0)>0?yt.pnl??0:0),0)),oe=vt(()=>s(Z).reduce((Qe,yt)=>Qe+((yt.pnl??0)<0?Math.abs(yt.pnl??0):0),0)),ee=vt(()=>s(Y)-s(oe)),re=vt(()=>((o().speed||.5)-.5)/9.5*100);function me(){var yt;const Qe=((yt=r())==null?void 0:yt.getDataList())||[];return Qe.length===0?0:Qe[Qe.length-1].close}function K(){var yt;const Qe=((yt=r())==null?void 0:yt.getDataList())||[];return Qe.length===0?Date.now():Qe[Qe.length-1].timestamp}function ye(){Cw(s(p)?s(m)||100:null),x(h,3),Pw(!0)}function Me(){var Qe;try{(Qe=window.stopPrediction)==null||Qe.call(window)}catch{}n0(!1)}function Fe(){w||(w=setInterval(()=>{var Ne,ue,he,_t,Wt;const Qe=((Ne=r())==null?void 0:Ne.getDataList())||[],yt=Qe.length>0?Qe[Qe.length-1]:null,xe=yt?yt.close??0:0,Ve=yt?yt.high??xe:xe,Je=yt?yt.low??xe:xe;x(_,N(xe));const St=[...o().pendingOrders||[]];for(const jt of St)if(jt.triggerUp?Ve>=jt.price:Je<=jt.price){const dn=o().leverage||1;if(jt.price*jt.quantity/dn<=o().balance){if(jt.lineOverlayId)try{(ue=r())==null||ue.removeOverlay({id:jt.lineOverlayId})}catch{}if(jt.noteOverlayId)try{(he=r())==null||he.removeOverlay({id:jt.noteOverlayId})}catch{}i1(jt.id);const un=K(),On=(_t=r())==null?void 0:_t.createOverlay({name:"horizontalStraightLine",points:[{value:jt.price}],styles:{line:{style:Ke.Dashed,size:1}}}),no=(Wt=r())==null?void 0:Wt.createOverlay({name:"note",points:[{timestamp:un,value:jt.price}],extendData:{in_text:"BUY",in_color:"#10b981",line_color:"#10b981"}}),fs=Array.isArray(On)?On[0]??void 0:On??void 0,ps=Array.isArray(no)?no[0]??void 0:no??void 0;Mw({id:jt.id,symbol:jt.symbol,quantity:jt.quantity,avgCost:jt.price,leverage:jt.leverage,openedAt:Date.now(),lineOverlayId:fs,noteOverlayId:ps})}else i1(jt.id)}},300))}function Ze(){w&&(clearInterval(w),w=null)}fv(()=>{x(_,N(me()))}),mr(()=>{o().playing?Fe():Ze()});function Ge(Qe,yt){const xe=o().leverage||1;return yt*Qe/xe<=o().balance}function it(Qe){var yt,xe;try{Qe.lineOverlayId&&((yt=r())==null||yt.removeOverlay({id:Qe.lineOverlayId}))}catch{}try{Qe.noteOverlayId&&((xe=r())==null||xe.removeOverlay({id:Qe.noteOverlayId}))}catch{}i1(Qe.id)}function Ye(Qe){x(P,N(Qe)),x(S,0),x(I,"portfolio")}function ct(Qe){var Je,St;const yt=o().positions.find(Ne=>Ne.id===s(P));if(!yt)return;const xe=me(),Ve=Qe?yt.quantity:Math.min(yt.quantity,Math.max(0,Number(s(S))||0));if(!(Ve<=0)){if(EL(yt.id,Ve,xe),Ve===yt.quantity){try{yt.lineOverlayId&&((Je=r())==null||Je.removeOverlay({id:yt.lineOverlayId}))}catch{}try{yt.noteOverlayId&&((St=r())==null||St.removeOverlay({id:yt.noteOverlayId}))}catch{}}x(P,""),x(S,0)}}function kt(Qe){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:o().currency||"USD",maximumFractionDigits:2}).format(Qe)}catch{return`${Qe.toFixed(2)} ${o().currency||""}`}}var ft=u$(),bt=Dt(ft),nt=g(bt);Te(nt,()=>s(h)===1,Qe=>{var yt=IF(),xe=g(yt),Ve=u(g(xe),2);vs(Ve,21,()=>Tw,Vs,(Ne,ue)=>{var he=PF(),_t={},Wt=g(he,!0);f(he),Se(()=>{_t!==(_t=s(ue))&&(he.value=(he.__value=s(ue))==null?"":s(ue)),ze(Wt,s(ue))}),z(Ne,he)}),f(Ve),f(xe);var Je=u(xe,2);Qt(Je);var St=u(Je,2);St.__click=[yF,d,c,h],f(yt),qo(Ve,()=>s(d),Ne=>x(d,Ne)),po(Je,()=>s(c),Ne=>x(c,Ne)),z(Qe,yt)},Qe=>{var yt=Ln(),xe=Dt(yt);Te(xe,()=>s(h)===2,Ve=>{var Je=$F(),St=u(g(Je),2),Ne=g(St),ue=g(Ne);Qt(ue),ue.__click=[MF,p],ai(2),f(Ne);var he=u(Ne,2),_t=g(he);Qt(_t),_t.__click=[AF,p],ai(2),f(he),f(St);var Wt=u(St,2);Te(Wt,()=>s(p),jt=>{var Zt=TF(),dn=g(Zt),zn=g(dn);zn.value=(zn.__value=50)==null?"":50;var un=u(zn);un.value=(un.__value=100)==null?"":100;var On=u(un);On.value=(On.__value=200)==null?"":200;var no=u(On);no.value=(no.__value=400)==null?"":400;var fs=u(no);fs.value=(fs.__value=500)==null?"":500,f(dn);var ps=u(dn,2);ps.__click=ye,f(Zt),qo(dn,()=>s(m),So=>x(m,So)),z(jt,Zt)},jt=>{var Zt=FF();Zt.__click=[LF,m,ye],z(jt,Zt)}),f(Je),Se(()=>{Qv(ue,s(p)),Qv(_t,!s(p))}),z(Ve,Je)},Ve=>{var Je=o$(),St=Dt(Je),Ne=u(g(St),2);Ne.__click=[wF,Me,o,r,a];var ue=g(Ne);JL(ue,{size:16}),ai(),f(Ne),f(St);var he=u(St,2),_t=g(he),Wt=g(_t),jt=g(Wt),Zt=g(jt),dn=g(Zt),zn=g(dn);cF(zn,{size:14}),f(dn),f(Zt);var un=u(Zt,2),On=u(g(un),2);Se(()=>zt(On,"title",kt(o().depositAmount)));var no=g(On,!0);Se(()=>ze(no,kt(o().depositAmount))),f(On);var fs=u(On,2),ps=g(fs);Se(()=>ze(ps,`${kt(o().depositAmount)??""} • ${o().currency??""}`)),f(fs),f(un),f(jt),f(Wt),f(_t);var So=u(_t,2),Es=g(So),Qo=g(Es),Ko=g(Qo),oo=g(Ko),Gs=g(oo);lF(Gs,{size:14}),f(oo),f(Ko);var jo=u(Ko,2),fi=g(jo),ba=u(g(fi)),xa=g(ba);f(ba),f(fi);var Al=u(fi,2);Se(()=>zt(Al,"title",kt((o().positions||[]).reduce(($i,hi)=>$i+hi.avgCost*hi.quantity,0))));var Qs=g(Al,!0);Se(()=>ze(Qs,kt((o().positions||[]).reduce(($i,hi)=>$i+hi.avgCost*hi.quantity,0)))),f(Al);var Fs=u(Al,2),Va=g(Fs);Te(Va,()=>(o().positions||[]).length>0,$i=>{var hi=Ln(),li=Dt(hi);Te(li,()=>(o().positions||[]).reduce((ks,Vi)=>ks+(s(_)-Vi.avgCost)*Vi.quantity*(Vi.leverage||1),0)>=0,ks=>{var Vi=EF(),gs=g(Vi);Se(()=>ze(gs,`+${kt((o().positions||[]).reduce((ll,mi)=>ll+(s(_)-mi.avgCost)*mi.quantity*(mi.leverage||1),0))??""}`)),f(Vi),z(ks,Vi)},ks=>{var Vi=NF(),gs=g(Vi);Se(()=>ze(gs,`-${kt(Math.abs((o().positions||[]).reduce((ll,mi)=>ll+(s(_)-mi.avgCost)*mi.quantity*(mi.leverage||1),0)))??""}`)),f(Vi),z(ks,Vi)}),z($i,hi)},$i=>{var hi=DF();z($i,hi)}),f(Fs),f(jo),f(Qo),f(Es),f(So);var $r=u(So,2),cd=g($r),Sd=g(cd),Nl=g(Sd),dd=g(Nl),Cd=g(dd);HL(Cd,{size:14}),f(dd),f(Nl);var fa=u(Nl,2),Dl=u(g(fa),2);Se(()=>zt(Dl,"title",kt(o().balance*(o().leverage||1))));var ml=g(Dl,!0);Se(()=>ze(ml,kt(o().balance*(o().leverage||1)))),f(Dl);var gl=u(Dl,2),_d=g(gl);f(gl),f(fa),f(Sd),f(cd),f($r),f(he);var Kl=u(he,2),ic=g(Kl),od=g(ic),zd=g(od),Ec=g(zd),al=g(Ec);XL(al,{size:16}),f(Ec),ai(2),f(zd);var kc=u(zd,2),Vd=g(kc);f(kc),f(od);var sd=u(od,2),id=g(sd);Qt(id),id.__input=[xF];var Pd=u(id,2);Te(Pd,()=>o().playing,$i=>{var hi=jF();hi.__click=Me;var li=g(hi);nF(li,{size:16}),f(hi),z($i,hi)},$i=>{var hi=RF();hi.__click=[bF];var li=g(hi);oF(li,{size:16}),f(hi),z($i,hi)}),f(sd);var Ed=u(sd,2);vs(Ed,20,()=>[.5,1,2,5,10],Vs,($i,hi)=>{var li=OF();li.__click=[BF,hi];var ks=g(li);f(li),Se(()=>{Us(li,`speed-chip ${(o().speed===hi?"active":"")??""} svelte-112gz12`),ze(ks,`${hi??""}x`)}),z($i,li)}),f(Ed),f(ic),f(Kl);var zl=u(Kl,2),Gd=g(zl),lu=g(Gd),Yd=g(lu),eu=u(g(Yd),2);Se(()=>zt(eu,"title",s(_).toFixed(2)));var Ju=g(eu,!0);Se(()=>ze(Ju,s(_).toFixed(2))),f(eu),f(Yd),ai(2),f(lu);var mu=u(lu,2),yd=g(mu);yd.__click=[kF,C,M,V,F,j,D,R],f(mu),f(Gd),f(zl);var tn=u(zl,2),En=g(tn),go=g(En),hn=u(g(go),2);hn.__click=[_F],f(go),f(En),f(tn);var Ho=u(tn,2),Eo=g(Ho);Eo.__click=[zF,I];var di=u(Eo,2);di.__click=[VF,I],f(Ho);var ns=u(Ho,2);Te(ns,()=>s(I)==="portfolio",$i=>{var hi=e$(),li=Dt(hi);Te(li,()=>(o().pendingOrders||[]).length>0,Vi=>{var gs=HF(),ll=g(gs),mi=u(g(ll),2);vs(mi,1,()=>o().pendingOrders,Vs,(Na,le)=>{var we=qF(),H=g(we),ne=g(H),_e=g(ne,!0);f(ne);var q=u(ne,2),De=g(q);f(q);var ot=u(q,2),je=g(ot);Se(()=>ze(je,`Price ${s(le).price.toFixed(2)??""}`)),f(ot),f(H);var Ft=u(H,2),Be=g(Ft);Be.__click=[WF,it,le],f(Ft),f(we),Se(()=>{ze(_e,s(le).symbol.ticker),ze(De,`Qty ${s(le).quantity??""}`)}),z(Na,we)}),f(ll),f(gs),z(Vi,gs)});var ks=u(li,2);vs(ks,1,()=>o().positions,Vs,(Vi,gs)=>{var ll=QF(),mi=g(ll),Na=g(mi),le=g(Na),we=g(le),H=g(we,!0);f(we);var ne=u(we,2),_e=g(ne);f(ne);var q=u(ne,2),De=g(q);Se(()=>ze(De,`Avg ${s(gs).avgCost.toFixed(2)??""}`)),f(q);var ot=u(q,2),je=g(ot);f(ot),f(le);var Ft=u(le,2),Be=g(Ft),xt=g(Be);Se(()=>ze(xt,`${((s(_)-s(gs).avgCost)*s(gs).quantity*(s(gs).leverage||1)>=0?"+":"")??""}${((s(_)-s(gs).avgCost)*s(gs).quantity*(s(gs).leverage||1)).toFixed(2)??""}`)),f(Be);var an=u(Be,2);Te(an,()=>s(P)===s(gs).id,bn=>{var be=GF();be.__click=[UF,P,S],z(bn,be)},bn=>{var be=KF();be.__click=[YF,Ye,gs],z(bn,be)}),f(Ft),f(Na);var Yn=u(Na,2);Te(Yn,()=>s(P)===s(gs).id,bn=>{var be=JF(),tt=g(be),wt=g(tt),Lt=g(wt),qt=g(Lt);f(Lt);var qn=u(Lt,2);qn.__click=[ZF,ct],f(wt),f(tt);var Xt=u(tt,2),vo=u(g(Xt),2),To=g(vo);Qt(To);var co=u(To,2);co.__click=[XF,ct],Se(()=>co.disabled=!s(S)||Number(s(S))<=0||Number(s(S))>s(gs).quantity),f(vo);var so=u(vo,2),Jo=g(so),Os=g(Jo);f(Jo);var wr=u(Jo,2),ra=g(wr);Se(()=>ze(ra,`Est. PnL: ${((s(_)-s(gs).avgCost)*(Number(s(S))||0)*(s(gs).leverage||1)).toFixed(2)??""}`)),f(wr),f(so),f(Xt),f(be),Se(()=>{ze(qt,`Close entire position (${s(gs).quantity??""})`),zt(To,"max",s(gs).quantity),ze(Os,`Available: ${s(gs).quantity??""}`)}),po(To,()=>s(S),Qr=>x(S,Qr)),z(bn,be)}),f(mi),f(ll),Se(()=>{ze(H,s(gs).symbol.ticker),ze(_e,`Qty ${s(gs).quantity??""}`),ze(je,`Lev ${(s(gs).leverage||1)??""}x`),Us(Be,`badge ${((s(_)-s(gs).avgCost)*s(gs).quantity*(s(gs).leverage||1)>=0?"badge-success":"badge-error")??""}`)}),z(Vi,ll)}),z($i,hi)},$i=>{var hi=n$(),li=Dt(hi),ks=g(li),Vi=g(ks),gs=g(Vi),ll=u(g(gs),2),mi=g(ll),Na=g(mi,!0);f(mi);var le=u(mi,2);Se(()=>zt(le,"title",kt(s(Y))));var we=g(le,!0);Se(()=>ze(we,kt(s(Y)))),f(le),f(ll),f(gs);var H=u(gs,2),ne=u(g(H),2),_e=g(ne),q=g(_e,!0);f(_e);var De=u(_e,2);Se(()=>zt(De,"title",kt(s(oe))));var ot=g(De,!0);Se(()=>ze(ot,kt(s(oe)))),f(De),f(ne),f(H);var je=u(H,2),Ft=u(g(je),2),Be=g(Ft);Se(()=>zt(Be,"title",kt(s(ee))));var xt=g(Be);Se(()=>ze(xt,`${(s(ee)>=0?"+":"")??""}${kt(s(ee))??""}`)),f(Be),f(Ft),f(je),f(Vi),f(ks),f(li);var an=u(li,2);vs(an,1,()=>o().history,Vs,(Yn,bn)=>{var be=t$(),tt=g(be),wt=g(tt),Lt=g(wt),qt=g(Lt),qn=g(qt,!0);f(qt);var Xt=u(qt,2),vo=g(Xt);f(Xt),f(Lt);var To=u(Lt,2),co=g(To);Se(()=>ze(co,`${(s(bn).pnl>=0?"+":"")??""}${s(bn).pnl.toFixed(2)??""}`)),f(To),f(wt);var so=u(wt,2);const Jo=vt(()=>s(bn).avgCost.toFixed(2)??""),Os=vt(()=>s(bn).closedAvg.toFixed(2)??"");var wr=g(so);Se(()=>ze(wr,`Buy ${s(Jo)} • Sell ${s(Os)}`)),f(so),f(tt),f(be),Se(()=>{ze(qn,s(bn).symbol.ticker),ze(vo,`Qty ${s(bn).quantity??""}`),Us(To,`badge ${(s(bn).pnl>=0?"badge-success":"badge-error")??""}`)}),z(Yn,be)}),Se(()=>{ze(Na,s(G)),ze(q,s(se)),Us(je,`summary-tile net ${(s(ee)>=0?"pos":"neg")??""} svelte-112gz12`)}),z($i,hi)}),Se(()=>{Fi(So,"pos",s(W)&&s(J)>=0),Fi(So,"neg",s(W)&&s(J)<0),ze(xa,`Open ${(o().positions||[]).length??""}`),ze(_d,`Leverage ${(o().leverage||1)??""}x`),ze(Vd,`${o().speed??""}x`),Jd(id,o().speed),zt(id,"style",`background: linear-gradient(to right, var(--menu-active-bg) ${s(re)}%, var(--menu-btn-bg) ${s(re)}%);`),Us(Eo,`tab ${(s(I)==="portfolio"?"tab-active":"")??""} svelte-112gz12`),Us(di,`tab ${(s(I)==="history"?"tab-active":"")??""} svelte-112gz12`)}),z(Ve,Je)},!0),z(Qe,yt)}),f(bt);var Pt=u(bt,2);Te(Pt,()=>s(C),Qe=>{vf(Qe,{title:"Place Buy Order",buttons:[],get show(){return s(C)},set show(yt){x(C,N(yt))},get theme(){return i().theme},children:(yt,xe)=>{var Ve=d$(),Je=g(Ve),St=u(g(Je),2),Ne=g(St);Qt(Ne),Ne.__click=[s$,M],ai(2),f(St);var ue=u(St,2),he=g(ue);Qt(he),he.__click=[i$,M],ai(2),f(ue),f(Je);var _t=u(Je,2);Te(_t,()=>s(M)==="instant",Wt=>{var jt=a$(),Zt=g(jt),dn=g(Zt),zn=g(dn),un=u(g(zn),2);Se(()=>zt(un,"title",s(_).toFixed(2)));var On=g(un,!0);Se(()=>ze(On,s(_).toFixed(2))),f(un),f(zn);var no=u(zn,2),fs=g(no);Qt(fs);var ps=u(fs,2);ps.__click=[SF,D,_,V,Ge,Me,K,r,a,i,l,o,C],f(no);var So=u(no,2);Te(So,()=>s(D),Es=>{var Qo=r$(),Ko=g(Qo,!0);f(Qo),Se(()=>ze(Ko,s(D))),z(Es,Qo)}),f(dn),f(Zt),f(jt),po(fs,()=>s(V),Es=>x(V,Es)),z(Wt,jt)},Wt=>{var jt=c$(),Zt=g(jt),dn=g(Zt);Qt(dn);var zn=u(dn,2);Qt(zn),f(Zt);var un=u(Zt,2);un.__click=[CF,R,F,j,Ge,_,r,a,K,i,l,o,C];var On=u(un,2);Te(On,()=>s(R),no=>{var fs=l$(),ps=g(fs,!0);f(fs),Se(()=>ze(ps,s(R))),z(no,fs)}),f(jt),po(dn,()=>s(F),no=>x(F,no)),po(zn,()=>s(j),no=>x(j,no)),z(Wt,jt)}),f(Ve),Se(()=>{Qv(Ne,s(M)==="instant"),Qv(he,s(M)==="pending")}),z(yt,Ve)},$$slots:{default:!0}})}),z(n,ft),hd()}qu(["click","input"]);var v$=fe('<div class="top-section svelte-3gnxyq"><div class="section-card svelte-3gnxyq"><button class="sidebar-icon svelte-3gnxyq" title="Watch List"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M8 6H21M8 12H21M8 18H21M3 6H3.01M3 12H3.01M3 18H3.01" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Watch</span></button> <button class="sidebar-icon svelte-3gnxyq" title="Alerts"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M18 8A6 6 0 0 0 6 8C6 15 3 17 3 17H21S18 15 18 8Z" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path><path d="M13.73 21A2 2 0 0 1 10.27 21" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Alerts</span></button> <button class="sidebar-icon ask-ai-btn svelte-3gnxyq" title="Ask AI"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path><path d="M12 12C13.1046 12 14 11.1046 14 10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10C10 11.1046 10.8954 12 12 12Z" fill="currentColor" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Ask AI</span></button></div></div> <div class="bottom-section svelte-3gnxyq"><div class="section-card svelte-3gnxyq"><button class="sidebar-icon svelte-3gnxyq" title="Calendar"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></rect><line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" class="svelte-3gnxyq"></line><line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" class="svelte-3gnxyq"></line><line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></line></svg> <span class="sidebar-label svelte-3gnxyq">Calendar</span></button> <button class="sidebar-icon svelte-3gnxyq" title="Portfolio"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><rect x="2" y="7" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></rect><path d="M16 21V5A2 2 0 0 0 14 3H10A2 2 0 0 0 8 5V21" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Portfolio</span></button></div></div>',1),f$=fe("<div><!></div>");function m$(n,e){gd(e,!1);const t=wp(),o=()=>ya(a,"$save",t),i=()=>ya(gv,"$simulator",t);let r=Ws(e,"className",8,"");const a=Kc("save");Bv();var l=f$(),c=g(l);Te(c,()=>i().mode==="strategy",d=>{p$(d,{})},d=>{var p=v$(),m=Dt(p),h=g(m),_=u(g(h),2);ai(2),f(h),f(m),ai(2),sc("click",_,()=>Xh.set(!0)),z(d,p)}),f(l),Se(()=>{Us(l,`right-sidebar hidden md:flex ${r()??""} svelte-3gnxyq`),zt(l,"data-theme",o().theme)}),z(n,l),hd()}function g$(n,e){n.preventDefault(),n.stopPropagation(),e("double-click")}var h$=fe('<div role="separator" aria-orientation="vertical" aria-label="Resize sidebar" tabindex="0"><div class="resize-indicator svelte-uwsrre"><div class="resize-dots svelte-uwsrre"><div class="dot svelte-uwsrre"></div> <div class="dot svelte-uwsrre"></div> <div class="dot svelte-uwsrre"></div></div></div></div>');function _$(n,e){gd(e,!0);let t=Ws(e,"className",3,"");const o=mv();let i=ae(!1),r=0,a=0,l;const c=180,d=480,p=12;function m(M){if(M.button!==0)return;M.preventDefault(),M.stopPropagation(),x(i,!0),r=M.clientX;const F=l.closest(".sidebar-container");F&&(a=F.offsetWidth),l.setPointerCapture(M.pointerId),document.body.style.userSelect="none",document.body.style.pointerEvents="none",l.style.pointerEvents="auto",o("resize:start",{widthPx:a})}function h(M){if(!s(i))return;M.preventDefault(),M.stopPropagation();const F=M.clientX-r,V=Math.max(c,Math.min(d,a-F));requestAnimationFrame(()=>{o("resize:move",{widthPx:V})})}function _(M){if(!s(i))return;M.preventDefault(),M.stopPropagation(),x(i,!1),l.releasePointerCapture(M.pointerId),document.body.style.userSelect="",document.body.style.pointerEvents="",l.style.pointerEvents="";const F=M.clientX-r,V=Math.max(c,Math.min(d,a-F));o("resize:end",{widthPx:V})}function w(M){s(i)&&(x(i,!1),l.releasePointerCapture(M.pointerId),document.body.style.userSelect="",document.body.style.pointerEvents="",l.style.pointerEvents="",o("resize:end",{widthPx:a}))}function S(M){if(!["ArrowLeft","ArrowRight"].includes(M.key))return;M.preventDefault(),M.stopPropagation();const F=l.closest(".sidebar-container");if(!F)return;const V=F.offsetWidth;let j=V;M.key==="ArrowLeft"?j=Math.min(d,V+p):M.key==="ArrowRight"&&(j=Math.max(c,V-p)),j!==V&&(o("resize:start",{widthPx:V}),o("resize:move",{widthPx:j}),o("resize:end",{widthPx:j}))}function P(){}function I(){}var C=h$();C.__pointerdown=m,C.__pointermove=h,C.__pointerup=_,C.__dblclick=[g$,o],C.__keydown=S,Xu(C,M=>l=M,()=>l),Se(()=>{Us(C,`sidebar-resize-handle ${t()??""} svelte-uwsrre`),Fi(C,"dragging",s(i))}),sc("pointercancel",C,w),sc("focus",C,P),sc("blur",C,I),z(n,C),hd()}qu(["pointerdown","pointermove","pointerup","dblclick","keydown"]);const o0=180,S_=480,Jh=280;function Nw(n,e=o0,t=S_,o=Jh){return isNaN(n)||n<e||n>t?o:n}function o_(){return typeof window<"u"&&window.__sidebarBootstrap?window.__sidebarBootstrap:{visible:!1,widthPx:0,transitionsEnabled:!1}}function my(n){if(typeof window<"u"){window.__sidebarBootstrap||(window.__sidebarBootstrap=o_()),window.__sidebarBootstrap={...window.__sidebarBootstrap,...n};const e=document.documentElement,t=window.__sidebarBootstrap,o=t.visible?t.widthPx+"px":"0px",i=t.visible?"1":"0";e.style.setProperty("--sidebar-width",o),e.style.setProperty("--sidebar-visible",i),e.style.setProperty("--chart-sidebar-width",o),e.style.setProperty("--chart-sidebar-visible",i)}}function y$(n,e){if(typeof window<"u"&&window.localStorage)try{if(localStorage.setItem("dutyai.chart.sidebar.visible","false"),n){const t=Nw(e,o0,S_,Jh);localStorage.setItem("dutyai.chart.sidebar.widthPx",String(t))}}catch(t){console.warn("Failed to persist sidebar state:",t)}}function b$(){if(typeof window>"u")return!0;const n=window.innerWidth,o=o0+80+300;return n>=o}function Ib(){my({transitionsEnabled:!0})}function x$(){my({transitionsEnabled:!1})}function a1(n,e){const t=e!==void 0?e:n?Jh:0;my({visible:n,widthPx:n?Nw(t,o0,S_,Jh):0}),y$(n,t)}const w$={MIN_WIDTH:o0,MAX_WIDTH:S_,DEFAULT_WIDTH:Jh,PRICE_SCALE_WIDTH:80};class k${constructor(){Ce(this,"pending",!1);Ce(this,"callbacks",[]);Ce(this,"rafId",null)}request(e){this.callbacks.push(e),!this.pending&&(this.pending=!0,this.rafId=requestAnimationFrame(async()=>{this.pending=!1,this.rafId=null;const t=[...this.callbacks];this.callbacks=[];for(const o of t)try{await o()}catch(i){console.error("RenderScheduler: Error executing callback",i)}}))}cancel(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pending=!1,this.callbacks=[]}isPending(){return this.pending}immediate(e){requestAnimationFrame(async()=>{try{await e()}catch(t){console.error("RenderScheduler: Error executing immediate callback",t)}})}}let l1=null;function C_(){return l1||(l1=new k$),l1}class S${constructor(){Ce(this,"scheduler",C_());Ce(this,"inProgress",!1);Ce(this,"queue",[])}async run(e){if(this.inProgress){this.queue.push(e);return}this.inProgress=!0;try{await this.executeTransaction(e)}finally{if(this.inProgress=!1,this.queue.length>0){const t=this.queue.shift();this.run(t)}}}async executeTransaction(e){const{reason:t,chart:o,mutateState:i,measure:r,compute:a,draw:l,commit:c,cleanup:d,skipTransitions:p}=e;console.log(`🔄 RenderTransaction [${t}] starting...`);const m=performance.now();this.scheduler.request(async()=>{try{i&&await i(),r&&await r(),a&&await a(),l&&o&&await l(o),c&&await c();const h=performance.now()-m;console.log(`✅ RenderTransaction [${t}] completed in ${h.toFixed(2)}ms`)}catch(h){console.error(`❌ RenderTransaction [${t}] failed:`,h)}finally{d&&d()}})}async batch(e){if(e.length===0)return;const t={reason:e[0].reason,chart:e[0].chart,mutateState:async()=>{for(const o of e)o.mutateState&&await o.mutateState()},measure:async()=>{for(const o of e)o.measure&&await o.measure()},compute:async()=>{for(const o of e)o.compute&&await o.compute()},draw:async o=>{for(const i of e)i.draw&&await i.draw(o)},commit:async()=>{for(const o of e)o.commit&&await o.commit()},cleanup:()=>{for(const o of e)o.cleanup&&o.cleanup()}};await this.run(t)}isInProgress(){return this.inProgress}getQueueLength(){return this.queue.length}}let c1=null;function C$(){return c1||(c1=new S$),c1}class P${constructor(){Ce(this,"states",new Map);Ce(this,"transitionProperty","transition")}register(e,t){this.states.set(e,{enabled:!1,element:t})}disable(e){const t=this.states.get(e);t&&(t.enabled=!1,t.element&&this.applyTransitionStyle(t.element,"none"))}enable(e){const t=this.states.get(e);t&&(t.enabled=!0,t.element&&this.applyTransitionStyle(t.element,""))}withoutTransitions(e,t){this.disable(e);const o=t();return requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.enable(e)})}),o}applyLayout(e,t,o=!0){this.disable(e),t(),o&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.enable(e)})})}isEnabled(e){var t;return((t=this.states.get(e))==null?void 0:t.enabled)??!1}updateElement(e,t){const o=this.states.get(e);o?(o.element=t,o.enabled?this.applyTransitionStyle(t,""):this.applyTransitionStyle(t,"none")):this.register(e,t)}applyTransitionStyle(e,t){e.style.setProperty(this.transitionProperty,t)}clear(){this.states.clear()}getKeys(){return Array.from(this.states.keys())}}let d1=null;function Dw(){return d1||(d1=new P$),d1}class I${constructor(){Ce(this,"rafId",null);Ce(this,"pending",!1);Ce(this,"lastArgs",null)}throttle(e,...t){this.lastArgs=t,!this.pending&&(this.pending=!0,this.rafId=requestAnimationFrame(async()=>{this.pending=!1,this.rafId=null;const o=this.lastArgs;this.lastArgs=null;try{await e(...o)}catch(i){console.error("Throttler: Error executing function",i)}}))}cancel(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pending=!1,this.lastArgs=null}isPending(){return this.pending}}class M${constructor(){Ce(this,"transaction",C$());Ce(this,"layoutManager",Dw());Ce(this,"scheduler",C_());Ce(this,"applyCanvasColorsFn",null)}async waitIndicatorReady(e,t,o,i=800){var a;const r=Date.now();for(;Date.now()-r<i;){try{const l=((a=e.getIndicators)==null?void 0:a.call(e,{name:t,paneId:o}))??[];if(l.length>0&&l.some(d=>d&&d.result&&Object.keys(d.result).length>0))return}catch{}await new Promise(l=>setTimeout(l,16))}}setApplyCanvasColorsFunction(e){this.applyCanvasColorsFn=e}reapplyCanvasColors(){this.applyCanvasColorsFn&&this.applyCanvasColorsFn()}async addIndicator(e){let t=null;return await this.transaction.run({reason:"indicator",chart:e.chart,mutateState:()=>{t=e.chart.createIndicator({name:e.name,calcParams:e.params},e.isMain??!1,e.paneId?{id:e.paneId}:void 0)},compute:async()=>{await this.waitIndicatorReady(e.chart,e.name,e.paneId)},commit:()=>{console.log(`✅ Indicator added: ${e.name} (${t})`),this.scheduler.request(()=>{this.reapplyCanvasColors()})}}),t}async removeIndicator(e){await this.transaction.run({reason:"indicator",chart:e.chart,mutateState:()=>{e.chart.removeIndicator({paneId:e.paneId,name:e.name})},commit:()=>{console.log(`✅ Indicator removed: ${e.name}`)}})}async changeTimeframe(e){await this.transaction.run({reason:"timeframe",chart:e.chart,compute:async()=>{await e.loadDataFn()},commit:()=>{console.log("✅ Timeframe changed"),e.skipCanvasReapply||this.scheduler.request(()=>{this.reapplyCanvasColors()})}})}async switchChartType(e){await this.transaction.run({reason:"type",chart:e.chart,mutateState:()=>{},compute:async()=>{await e.reloadDataFn()},commit:()=>{console.log(`✅ Chart type switched to: ${e.newType}`),this.scheduler.request(()=>{this.reapplyCanvasColors()})}})}async sidebarOperation(e){const t="sidebar";this.layoutManager.register(t),await this.transaction.run({reason:"sidebar",chart:e.chart,skipTransitions:!0,mutateState:()=>{this.layoutManager.disable(t)},measure:()=>{},commit:()=>{this.scheduler.request(()=>{e.chart.resize(),this.reapplyCanvasColors(),requestAnimationFrame(()=>{this.layoutManager.enable(t)})})}})}async changeTheme(e,t){await this.transaction.run({reason:"theme",chart:e,mutateState:()=>{t()},commit:()=>{console.log("✅ Theme changed")}})}resizeChart(e){this.scheduler.request(()=>{e.resize()})}async batchIndicatorOperations(e){const t=e.map(o=>({reason:"indicator",chart:o.operation.chart,mutateState:()=>{o.type==="add"?o.operation.chart.createIndicator({name:o.operation.name,calcParams:o.operation.params},o.operation.isMain??!1,o.operation.paneId?{id:o.operation.paneId}:void 0):o.operation.chart.removeIndicator({paneId:o.operation.paneId,name:o.operation.name})}}));await this.transaction.batch(t)}}let u1=null;function gy(){return u1||(u1=new M$),u1}var A$=fe('<div class="sidebar-container svelte-1chwdug"><!> <!></div>'),T$=fe("<div><!></div>");function L$(n,e){gd(e,!0);const t=wp(),o=()=>ya(c,"$chart",t),i=()=>ya(S,"$sidebarWidth",t),r=()=>ya(d,"$save",t),a=()=>ya(P,"$sidebarState",t);let l=Ws(e,"className",3,"");const c=Kc("chart"),d=Kc("save"),{MIN_WIDTH:p,MAX_WIDTH:m,DEFAULT_WIDTH:h,PRICE_SCALE_WIDTH:_}=w$,w=o_(),S=zp(w.widthPx);d.update(Ze=>(Ze.showSidebar=w.visible,Ze));const P=Lu([d,S],([Ze,Ge])=>({visible:Ze.showSidebar,widthPx:Ge})),I=mv();let C=ae(!1);gy();const M=C_(),F=Dw(),V=new I$;F.register("sidebar");function j(){o()&&M.request(()=>{var Ze;(Ze=o())==null||Ze.resize()})}function D(){o()&&V.throttle(()=>{M.request(()=>{var Ze;(Ze=o())==null||Ze.resize()})})}function R(){if(!o())return;const Ze=i()||h;F.enable("sidebar"),d.update(Ge=>(Ge.showSidebar=!0,Ge)),S.set(Ze),a1(!0,Ze),I("sidebar:toggle",{visible:!0}),requestAnimationFrame(()=>{j(),setTimeout(()=>{j()},100),setTimeout(()=>{j()},250)})}function W(){o()&&(F.enable("sidebar"),d.update(Ze=>(Ze.showSidebar=!1,Ze)),a1(!1,0),I("sidebar:toggle",{visible:!1}),requestAnimationFrame(()=>{j(),setTimeout(()=>{j()},100),setTimeout(()=>{j()},250)}))}function J(){o_().visible?W():R()}function Z(Ze){const Ge=Math.max(p,Math.min(m,Ze));S.set(Ge),r().showSidebar&&a1(!0,Ge),I("sidebar:resize:move",{widthPx:Ge}),D()}function G(){return a()}function se(Ze){F.disable("sidebar"),x$(),I("sidebar:resize:start",{widthPx:i()})}function Y(Ze){const Ge=Ze.detail.widthPx;Z(Ge)}function oe(Ze){s(C)&&(F.enable("sidebar"),Ib()),I("sidebar:resize:end",{widthPx:i()})}function ee(){Z(h)}function re(){!b$()&&r().showSidebar&&W()}function me(Ze){if(Ze.key==="S"&&!Ze.ctrlKey&&!Ze.metaKey&&!Ze.altKey){const Ge=Ze.target;Ge.tagName!=="INPUT"&&Ge.tagName!=="TEXTAREA"&&!Ge.isContentEditable&&(Ze.preventDefault(),J())}}fv(()=>{(async()=>(F.disable("sidebar"),await A1(),re(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{x(C,!0),F.enable("sidebar"),Ib(),console.log("✨ Sidebar transitions enabled"),o()&&j()})})))();const Ze=()=>{re()};return window.addEventListener("resize",Ze),window.addEventListener("keydown",me),()=>{window.removeEventListener("resize",Ze),window.removeEventListener("keydown",me),V.cancel()}});const K=vt(()=>()=>{const Ze=o_(),Ge=Ze.visible?`${Ze.widthPx}px`:"0px";return{"--sidebar-width":Ge,"--sidebar-visible":Ze.visible?"1":"0","--sidebar-transitions":Ze.transitionsEnabled?"width 200ms cubic-bezier(0.4, 0, 0.2, 1)":"none",width:Ge}});var ye=T$();const Me=vt(()=>Object.entries(s(K)).map(([Ze,Ge])=>`${Ze}: ${Ge}`).join("; "));var Fe=g(ye);return Te(Fe,()=>a().visible,Ze=>{var Ge=A$(),it=g(Ge);m$(it,{});var Ye=u(it,2);_$(Ye,{$$events:{"resize:start":se,"resize:move":Y,"resize:end":oe,"double-click":ee}}),f(Ge),Se(()=>zt(Ge,"style",`width: ${i()??""}px;`)),z(Ze,Ge)}),f(ye),Se(()=>{Us(ye,`sidebar-host ${l()??""} svelte-1chwdug`),zt(ye,"style",s(Me))}),z(n,ye),hd({openSidebar:R,closeSidebar:W,toggleSidebar:J,setSidebarWidth:Z,getSidebarState:G})}var F$=fe('<div class="empty-state svelte-kd3mpt"><div class="title svelte-kd3mpt">No alert rules found</div> <div class="desc svelte-kd3mpt">Add alertcondition() in Pine to populate rules.</div></div>'),$$=fe("<option> </option>"),E$=fe('<label class="channel svelte-kd3mpt"><input type="checkbox"> <span> </span></label>'),N$=fe('<div class="rule-card svelte-kd3mpt"><div class="rule-head svelte-kd3mpt"><div><div class="rule-title svelte-kd3mpt"> </div> <div class="rule-message svelte-kd3mpt"> </div></div> <label class="switch svelte-kd3mpt"><input type="checkbox" class="svelte-kd3mpt"> <span class="slider svelte-kd3mpt"></span></label></div> <div class="rule-row svelte-kd3mpt"><label>Frequency</label> <select class="svelte-kd3mpt"></select></div> <div class="rule-row svelte-kd3mpt"><label>Message</label> <input type="text" placeholder="Alert message" class="svelte-kd3mpt"></div> <div class="channels svelte-kd3mpt"></div> <button class="btn-test svelte-kd3mpt">Test alert</button></div>'),D$=fe('<div class="rules-grid svelte-kd3mpt"></div>'),j$=fe('<div class="alerts-panel svelte-kd3mpt"><!></div>'),R$=fe('<div class="alerts-panel svelte-kd3mpt"><div class="delivery-grid svelte-kd3mpt"><div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Webhook</div> <input type="text" placeholder="https://your-webhook-url" class="svelte-kd3mpt"></div> <div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Email (HTTP endpoint)</div> <input type="text" placeholder="https://email-gateway/send" class="svelte-kd3mpt"> <input type="text" placeholder="to@example.com" class="svelte-kd3mpt"></div> <div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Push (HTTP endpoint)</div> <input type="text" placeholder="https://push-gateway/send" class="svelte-kd3mpt"> <input type="text" placeholder="push target / token" class="svelte-kd3mpt"></div></div> <div class="options-row svelte-kd3mpt"><label class="option svelte-kd3mpt"><input type="checkbox"> <span>Backfill historical alerts</span></label> <label class="option svelte-kd3mpt"><span>Max logs</span> <input type="number" min="50" max="2000" class="svelte-kd3mpt"></label></div></div>'),B$=fe('<div class="empty-state svelte-kd3mpt"><div class="title svelte-kd3mpt">No alerts yet</div> <div class="desc svelte-kd3mpt">Triggered alerts will appear here.</div></div>'),O$=fe("<span> </span>"),z$=fe('<div class="log-item svelte-kd3mpt"><div class="log-main"><div class="log-title svelte-kd3mpt"> </div> <div class="log-meta svelte-kd3mpt"> </div> <div class="log-message svelte-kd3mpt"> </div></div> <div class="log-deliveries svelte-kd3mpt"></div></div>'),V$=fe('<div class="logs-list svelte-kd3mpt"></div>'),W$=fe('<div class="alerts-panel logs-panel svelte-kd3mpt"><div class="logs-header svelte-kd3mpt"><div class="logs-title svelte-kd3mpt">Alert Logs</div> <button class="btn-clear svelte-kd3mpt">Clear</button></div> <!></div>'),q$=fe('<div class="alerts-shell svelte-kd3mpt"><div class="alerts-tabs svelte-kd3mpt"><button class="svelte-kd3mpt">Rules</button> <button class="svelte-kd3mpt">Delivery</button> <button class="svelte-kd3mpt">Logs</button></div> <!></div>');function H$(n,e){gd(e,!0);const t=wp(),o=()=>ya(Xh,"$alertCenterUi",t),i=()=>ya(a,"$save",t),r=()=>ya(uf,"$alertCenter",t),a=Kc("save");let l=ae(!1),c=ae("rules");mr(()=>{x(l,N(o()))}),mr(()=>{o()!==s(l)&&Xh.set(s(l))});const d={once_per_bar:"Once per bar",once_per_bar_close:"Once per bar close",once:"Once only"},p={app:"App",webhook:"Webhook",email:"Email",push:"Push"},m=w=>!w||!Number.isFinite(w)?"-":new Date(w).toLocaleString(),h=w=>w.title||w.id,_=async w=>{var C,M,F,V,j,D;const S=Date.now(),P={id:`${w.id}_${S}`,ruleId:w.id,timestamp:S,barIndex:void 0,symbol:((M=(C=i())==null?void 0:C.symbol)==null?void 0:M.ticker)||((V=(F=i())==null?void 0:F.symbol)==null?void 0:V.name),timeframe:(D=(j=i())==null?void 0:j.period)==null?void 0:D.timeframe,title:w.title||w.id,message:w.message||"Test alert",price:void 0,deliveries:Object.keys(w.channels||{}).map(R=>({channel:R,status:w.channels[R]?"pending":"skipped"}))};Fw([P]);const I=await $w(P);Ew(P.id,I)};vf(n,{title:"Alerts Center",width:"min(980px, 96vw)",maxHeight:"90vh",get show(){return s(l)},set show(w){x(l,N(w))},get theme(){return i().theme},buttons:[],class:"alerts-center",children:(w,S)=>{var P=q$(),I=g(P),C=g(I),M=u(C,2),F=u(M,2);f(I);var V=u(I,2);Te(V,()=>s(c)==="rules",j=>{var D=j$(),R=g(D);Te(R,()=>Object.keys(r().rules).length===0,W=>{var J=F$();z(W,J)},W=>{var J=D$();vs(J,5,()=>Object.values(r().rules),Z=>Z.id,(Z,G)=>{var se=N$(),Y=g(se),oe=g(Y),ee=g(oe),re=g(ee,!0);Se(()=>ze(re,h(s(G)))),f(ee);var me=u(ee,2),K=g(me,!0);f(me),f(oe);var ye=u(oe,2),Me=g(ye);Qt(Me),ai(2),f(ye),f(Y);var Fe=u(Y,2),Ze=u(g(Fe),2);_g(Ze,()=>s(G).frequency);var Ge;vs(Ze,21,()=>Object.entries(d),Vs,(ft,bt)=>{let nt=()=>s(bt)[0],Pt=()=>s(bt)[1];var Qe=$$(),yt={},xe=g(Qe,!0);f(Qe),Se(()=>{yt!==(yt=nt())&&(Qe.value=(Qe.__value=nt())==null?"":nt()),ze(xe,Pt())}),z(ft,Qe)}),f(Ze),f(Fe);var it=u(Fe,2),Ye=u(g(it),2);Qt(Ye),f(it);var ct=u(it,2);vs(ct,21,()=>Object.keys(p),Vs,(ft,bt)=>{var nt=E$(),Pt=g(nt);Qt(Pt);var Qe=u(Pt,2),yt=g(Qe,!0);f(Qe),f(nt),Se(()=>{var xe;Qv(Pt,(xe=s(G).channels)==null?void 0:xe[s(bt)]),ze(yt,p[s(bt)])}),sc("change",Pt,xe=>O0(s(G).id,{channels:{[s(bt)]:xe.target.checked}})),z(ft,nt)}),f(ct);var kt=u(ct,2);f(se),Se(()=>{ze(K,s(G).message||"No message"),Qv(Me,s(G).enabled),Ge!==(Ge=s(G).frequency)&&(Ze.value=(Ze.__value=s(G).frequency)==null?"":s(G).frequency,Am(Ze,s(G).frequency)),Jd(Ye,s(G).message||"")}),sc("change",Me,ft=>O0(s(G).id,{enabled:ft.target.checked})),sc("change",Ze,ft=>O0(s(G).id,{frequency:ft.target.value})),sc("change",Ye,ft=>O0(s(G).id,{message:ft.target.value})),sc("click",kt,()=>_(s(G))),z(Z,se)}),f(J),z(W,J)}),f(D),z(j,D)},j=>{var D=Ln(),R=Dt(D);Te(R,()=>s(c)==="delivery",W=>{var J=R$(),Z=g(J),G=g(Z),se=u(g(G),2);Qt(se),f(G);var Y=u(G,2),oe=u(g(Y),2);Qt(oe);var ee=u(oe,2);Qt(ee),f(Y);var re=u(Y,2),me=u(g(re),2);Qt(me);var K=u(me,2);Qt(K),f(re),f(Z);var ye=u(Z,2),Me=g(ye),Fe=g(Me);Qt(Fe),ai(2),f(Me);var Ze=u(Me,2),Ge=u(g(Ze),2);Qt(Ge),f(Ze),f(ye),f(J),Se(()=>{Jd(se,r().delivery.webhookUrl||""),Jd(oe,r().delivery.emailEndpoint||""),Jd(ee,r().delivery.emailTo||""),Jd(me,r().delivery.pushEndpoint||""),Jd(K,r().delivery.pushTarget||""),Qv(Fe,r().options.backfill),Jd(Ge,r().options.maxLogs)}),sc("change",se,it=>Ah({webhookUrl:it.target.value})),sc("change",oe,it=>Ah({emailEndpoint:it.target.value})),sc("change",ee,it=>Ah({emailTo:it.target.value})),sc("change",me,it=>Ah({pushEndpoint:it.target.value})),sc("change",K,it=>Ah({pushTarget:it.target.value})),sc("change",Fe,it=>Pb({backfill:it.target.checked})),sc("change",Ge,it=>Pb({maxLogs:Number(it.target.value)||500})),z(W,J)},W=>{var J=W$(),Z=g(J),G=u(g(Z),2);f(Z);var se=u(Z,2);Te(se,()=>r().logs.length===0,Y=>{var oe=B$();z(Y,oe)},Y=>{var oe=V$();vs(oe,5,()=>r().logs,ee=>ee.id,(ee,re)=>{var me=z$(),K=g(me),ye=g(K),Me=g(ye,!0);f(ye);var Fe=u(ye,2),Ze=g(Fe);Se(()=>ze(Ze,`${m(s(re).timestamp)??""} · ${(s(re).symbol||"-")??""} · ${(s(re).timeframe||"-")??""}`)),f(Fe);var Ge=u(Fe,2),it=g(Ge,!0);f(Ge),f(K);var Ye=u(K,2);vs(Ye,21,()=>s(re).deliveries,Vs,(ct,kt)=>{var ft=O$(),bt=g(ft);f(ft),Se(()=>{Us(ft,`${`chip chip-${s(kt).status}`??""} svelte-kd3mpt`),ze(bt,`${s(kt).channel??""}:${s(kt).status??""}`)}),z(ct,ft)}),f(Ye),f(me),Se(()=>{ze(Me,s(re).title||s(re).ruleId),ze(it,s(re).message||"-")}),z(ee,me)}),f(oe),z(Y,oe)}),f(J),sc("click",G,function(...Y){r1==null||r1.apply(this,Y)}),z(W,J)},!0),z(j,D)}),f(P),Se(()=>{Fi(C,"active",s(c)==="rules"),Fi(M,"active",s(c)==="delivery"),Fi(F,"active",s(c)==="logs")}),sc("click",C,()=>x(c,"rules")),sc("click",M,()=>x(c,"delivery")),sc("click",F,()=>x(c,"logs")),z(w,P)},$$slots:{default:!0}}),hd()}const U$=["XAU","XAG","XPT","XPD","CNH"],Mb=new Set(["USD","EUR","GBP","JPY","CHF","CAD","AUD","NZD","SEK","NOK","DKK","SGD","HKD","CNY","INR","KRW","THB","MYR","IDR","PHP","MXN","BRL","ZAR","TRY","PLN","CZK","HUF","RON","ILS","RUB","AED","SAR","QAR","KWD",...U$]),G$=["USDT","USDC","BUSD","DAI","TUSD","FDUSD","USD","BTC","ETH","BNB","SOL","XBT"],Y$=["BINANCE","COINBASE","KRAKEN","BYBIT","OKX","BITFINEX","KUCOIN","GATE","MEXC","BITGET"],K$=["OANDA","FXCM","FOREX","FX","DUKASCOPY","PEPPERSTONE","ICMARKETS","IG"];function p_(n){if(typeof n=="number"&&Number.isFinite(n))return n;if(typeof n=="string"){const e=Number(n.trim());if(Number.isFinite(e))return e}}function p1(n){return typeof n=="number"&&Number.isFinite(n)}function Jm(n,e,t){return Math.min(t,Math.max(e,Math.trunc(n)))}function jw(n){const e=typeof n.exchange=="string"?n.exchange.trim():"",t=typeof n.ticker=="string"?n.ticker.trim():"";if(!e&&t.includes(":")){const o=t.indexOf(":"),i=t.slice(0,o).trim(),r=t.slice(o+1).trim();return{exchange:i?i.toUpperCase():void 0,ticker:r.toUpperCase()}}return{exchange:e?e.toUpperCase():void 0,ticker:t.toUpperCase()}}function Rw(n){return(n||"").replace(/[^A-Z]/gi,"").toUpperCase()}function Bw(n){const e=(n.market??n.type??"").toString().toLowerCase();if(e.includes("forex")||e==="fx")return"forex";if(e.includes("crypto")||e.includes("coin"))return"crypto";const{exchange:t,ticker:o}=jw(n),i=(t||"").toUpperCase();if(Y$.some(a=>i.includes(a)))return"crypto";if(K$.some(a=>i.includes(a)))return"forex";const r=Rw(o);if(r.length>=6){const a=r.slice(0,3),l=r.slice(3,6);if(Mb.has(a)&&Mb.has(l))return"forex"}return G$.some(a=>r.endsWith(a))?"crypto":e.includes("stock")||e.includes("equity")||e.includes("index")?"stock":"unknown"}function z0(n){return Bw(n)}function Z$(n){const{ticker:e}=jw(n),t=Rw(e),o=t.slice(0,3),i=t.slice(3,6);return o==="XAU"||o==="XAG"||o==="XPT"||o==="XPD"||i==="JPY"?3:5}function X$(n,e){if(!Number.isFinite(n))return 0;try{const t=n.toFixed(e).replace(/\.?0+$/,""),o=t.indexOf(".");return o===-1?0:t.length-o-1}catch{return 0}}function v1(n){if(!Array.isArray(n)||n.length===0)return;const e=n.slice(Math.max(0,n.length-200));let t=0;for(const o of e){const i=[o.open,o.high,o.low,o.close];for(const r of i){const a=p_(r);if(a!=null&&(t=Math.max(t,X$(a,12)),t>=12))return 12}}return t}function J$(n){var e;if(!(!Array.isArray(n)||n.length===0))for(let t=n.length-1;t>=0;t--){const o=(e=n[t])==null?void 0:e.close,i=p_(o);if(i!=null)return i}}function V0(n,e){const t=Bw(n);if(t==="forex"){const a=Z$(n),l=p_(n==null?void 0:n.pricePrecision),c=e?v1(e):void 0,d=Math.max(a,l??0,p1(c)?c:0);return Jm(d,0,12)}const o=n==null?void 0:n.pricePrecision,i=p_(o);if(t==="stock")return i!=null?Jm(i,0,12):2;const r=e?v1(e):void 0;if(p1(r))return Jm(r,2,12);if(t==="crypto"){const a=e?v1(e):void 0,l=p1(a)?a:i??6,c=Math.abs(J$(e)??NaN);return Number.isFinite(c)?c>=1e3?Jm(l,2,2):c>=1?Jm(l,2,4):c>=.01?Jm(l,4,8):Jm(l,6,12):Jm(l,2,12)}return i!=null?Jm(i,0,12):2}var Ow={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/(function(n,e){(function(t,o){n.exports=o()})(ng,function t(){var o=typeof self<"u"?self:typeof window<"u"?window:o!==void 0?o:{},i=!o.document&&!!o.postMessage,r=o.IS_PAPA_WORKER||!1,a={},l=0,c={parse:function(R,W){var J=(W=W||{}).dynamicTyping||!1;if(D(J)&&(W.dynamicTypingFunction=J,J={}),W.dynamicTyping=J,W.transform=!!D(W.transform)&&W.transform,W.worker&&c.WORKERS_SUPPORTED){var Z=function(){if(!c.WORKERS_SUPPORTED)return!1;var se=(oe=o.URL||o.webkitURL||null,ee=t.toString(),c.BLOB_URL||(c.BLOB_URL=oe.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",ee,")();"],{type:"text/javascript"})))),Y=new o.Worker(se),oe,ee;return Y.onmessage=C,Y.id=l++,a[Y.id]=Y}();return Z.userStep=W.step,Z.userChunk=W.chunk,Z.userComplete=W.complete,Z.userError=W.error,W.step=D(W.step),W.chunk=D(W.chunk),W.complete=D(W.complete),W.error=D(W.error),delete W.worker,void Z.postMessage({input:R,config:W,workerId:Z.id})}var G=null;return c.NODE_STREAM_INPUT,typeof R=="string"?(R=function(se){return se.charCodeAt(0)===65279?se.slice(1):se}(R),G=W.download?new m(W):new _(W)):R.readable===!0&&D(R.read)&&D(R.on)?G=new w(W):(o.File&&R instanceof File||R instanceof Object)&&(G=new h(W)),G.stream(R)},unparse:function(R,W){var J=!1,Z=!0,G=",",se=`\r
`,Y='"',oe=Y+Y,ee=!1,re=null,me=!1;(function(){if(typeof W=="object"){if(typeof W.delimiter!="string"||c.BAD_DELIMITERS.filter(function(Fe){return W.delimiter.indexOf(Fe)!==-1}).length||(G=W.delimiter),(typeof W.quotes=="boolean"||typeof W.quotes=="function"||Array.isArray(W.quotes))&&(J=W.quotes),typeof W.skipEmptyLines!="boolean"&&typeof W.skipEmptyLines!="string"||(ee=W.skipEmptyLines),typeof W.newline=="string"&&(se=W.newline),typeof W.quoteChar=="string"&&(Y=W.quoteChar),typeof W.header=="boolean"&&(Z=W.header),Array.isArray(W.columns)){if(W.columns.length===0)throw new Error("Option columns is empty");re=W.columns}W.escapeChar!==void 0&&(oe=W.escapeChar+Y),(typeof W.escapeFormulae=="boolean"||W.escapeFormulae instanceof RegExp)&&(me=W.escapeFormulae instanceof RegExp?W.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var K=new RegExp(P(Y),"g");if(typeof R=="string"&&(R=JSON.parse(R)),Array.isArray(R)){if(!R.length||Array.isArray(R[0]))return ye(null,R,ee);if(typeof R[0]=="object")return ye(re||Object.keys(R[0]),R,ee)}else if(typeof R=="object")return typeof R.data=="string"&&(R.data=JSON.parse(R.data)),Array.isArray(R.data)&&(R.fields||(R.fields=R.meta&&R.meta.fields||re),R.fields||(R.fields=Array.isArray(R.data[0])?R.fields:typeof R.data[0]=="object"?Object.keys(R.data[0]):[]),Array.isArray(R.data[0])||typeof R.data[0]=="object"||(R.data=[R.data])),ye(R.fields||[],R.data||[],ee);throw new Error("Unable to serialize unrecognized input");function ye(Fe,Ze,Ge){var it="";typeof Fe=="string"&&(Fe=JSON.parse(Fe)),typeof Ze=="string"&&(Ze=JSON.parse(Ze));var Ye=Array.isArray(Fe)&&0<Fe.length,ct=!Array.isArray(Ze[0]);if(Ye&&Z){for(var kt=0;kt<Fe.length;kt++)0<kt&&(it+=G),it+=Me(Fe[kt],kt);0<Ze.length&&(it+=se)}for(var ft=0;ft<Ze.length;ft++){var bt=Ye?Fe.length:Ze[ft].length,nt=!1,Pt=Ye?Object.keys(Ze[ft]).length===0:Ze[ft].length===0;if(Ge&&!Ye&&(nt=Ge==="greedy"?Ze[ft].join("").trim()==="":Ze[ft].length===1&&Ze[ft][0].length===0),Ge==="greedy"&&Ye){for(var Qe=[],yt=0;yt<bt;yt++){var xe=ct?Fe[yt]:yt;Qe.push(Ze[ft][xe])}nt=Qe.join("").trim()===""}if(!nt){for(var Ve=0;Ve<bt;Ve++){0<Ve&&!Pt&&(it+=G);var Je=Ye&&ct?Fe[Ve]:Ve;it+=Me(Ze[ft][Je],Ve)}ft<Ze.length-1&&(!Ge||0<bt&&!Pt)&&(it+=se)}}return it}function Me(Fe,Ze){if(Fe==null)return"";if(Fe.constructor===Date)return JSON.stringify(Fe).slice(1,25);var Ge=!1;me&&typeof Fe=="string"&&me.test(Fe)&&(Fe="'"+Fe,Ge=!0);var it=Fe.toString().replace(K,oe);return(Ge=Ge||J===!0||typeof J=="function"&&J(Fe,Ze)||Array.isArray(J)&&J[Ze]||function(Ye,ct){for(var kt=0;kt<ct.length;kt++)if(-1<Ye.indexOf(ct[kt]))return!0;return!1}(it,c.BAD_DELIMITERS)||-1<it.indexOf(G)||it.charAt(0)===" "||it.charAt(it.length-1)===" ")?Y+it+Y:it}}};if(c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!i&&!!o.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=I,c.ParserHandle=S,c.NetworkStreamer=m,c.FileStreamer=h,c.StringStreamer=_,c.ReadableStreamStreamer=w,o.jQuery){var d=o.jQuery;d.fn.parse=function(R){var W=R.config||{},J=[];return this.each(function(se){if(!(d(this).prop("tagName").toUpperCase()==="INPUT"&&d(this).attr("type").toLowerCase()==="file"&&o.FileReader)||!this.files||this.files.length===0)return!0;for(var Y=0;Y<this.files.length;Y++)J.push({file:this.files[Y],inputElem:this,instanceConfig:d.extend({},W)})}),Z(),this;function Z(){if(J.length!==0){var se,Y,oe,ee,re=J[0];if(D(R.before)){var me=R.before(re.file,re.inputElem);if(typeof me=="object"){if(me.action==="abort")return se="AbortError",Y=re.file,oe=re.inputElem,ee=me.reason,void(D(R.error)&&R.error({name:se},Y,oe,ee));if(me.action==="skip")return void G();typeof me.config=="object"&&(re.instanceConfig=d.extend(re.instanceConfig,me.config))}else if(me==="skip")return void G()}var K=re.instanceConfig.complete;re.instanceConfig.complete=function(ye){D(K)&&K(ye,re.file,re.inputElem),G()},c.parse(re.file,re.instanceConfig)}else D(R.complete)&&R.complete()}function G(){J.splice(0,1),Z()}}}function p(R){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(W){var J=V(W);J.chunkSize=parseInt(J.chunkSize),W.step||W.chunk||(J.chunkSize=null),this._handle=new S(J),(this._handle.streamer=this)._config=J}).call(this,R),this.parseChunk=function(W,J){if(this.isFirstChunk&&D(this._config.beforeFirstChunk)){var Z=this._config.beforeFirstChunk(W);Z!==void 0&&(W=Z)}this.isFirstChunk=!1,this._halted=!1;var G=this._partialLine+W;this._partialLine="";var se=this._handle.parse(G,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var Y=se.meta.cursor;this._finished||(this._partialLine=G.substring(Y-this._baseIndex),this._baseIndex=Y),se&&se.data&&(this._rowCount+=se.data.length);var oe=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(r)o.postMessage({results:se,workerId:c.WORKER_ID,finished:oe});else if(D(this._config.chunk)&&!J){if(this._config.chunk(se,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);se=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(se.data),this._completeResults.errors=this._completeResults.errors.concat(se.errors),this._completeResults.meta=se.meta),this._completed||!oe||!D(this._config.complete)||se&&se.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),oe||se&&se.meta.paused||this._nextChunk(),se}this._halted=!0},this._sendError=function(W){D(this._config.error)?this._config.error(W):r&&this._config.error&&o.postMessage({workerId:c.WORKER_ID,error:W,finished:!1})}}function m(R){var W;(R=R||{}).chunkSize||(R.chunkSize=c.RemoteChunkSize),p.call(this,R),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(J){this._input=J,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(W=new XMLHttpRequest,this._config.withCredentials&&(W.withCredentials=this._config.withCredentials),i||(W.onload=j(this._chunkLoaded,this),W.onerror=j(this._chunkError,this)),W.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var J=this._config.downloadRequestHeaders;for(var Z in J)W.setRequestHeader(Z,J[Z])}if(this._config.chunkSize){var G=this._start+this._config.chunkSize-1;W.setRequestHeader("Range","bytes="+this._start+"-"+G)}try{W.send(this._config.downloadRequestBody)}catch(se){this._chunkError(se.message)}i&&W.status===0&&this._chunkError()}},this._chunkLoaded=function(){W.readyState===4&&(W.status<200||400<=W.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:W.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(J){var Z=J.getResponseHeader("Content-Range");return Z===null?-1:parseInt(Z.substring(Z.lastIndexOf("/")+1))}(W),this.parseChunk(W.responseText)))},this._chunkError=function(J){var Z=W.statusText||J;this._sendError(new Error(Z))}}function h(R){var W,J;(R=R||{}).chunkSize||(R.chunkSize=c.LocalChunkSize),p.call(this,R);var Z=typeof FileReader<"u";this.stream=function(G){this._input=G,J=G.slice||G.webkitSlice||G.mozSlice,Z?((W=new FileReader).onload=j(this._chunkLoaded,this),W.onerror=j(this._chunkError,this)):W=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var G=this._input;if(this._config.chunkSize){var se=Math.min(this._start+this._config.chunkSize,this._input.size);G=J.call(G,this._start,se)}var Y=W.readAsText(G,this._config.encoding);Z||this._chunkLoaded({target:{result:Y}})},this._chunkLoaded=function(G){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(G.target.result)},this._chunkError=function(){this._sendError(W.error)}}function _(R){var W;p.call(this,R=R||{}),this.stream=function(J){return W=J,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var J,Z=this._config.chunkSize;return Z?(J=W.substring(0,Z),W=W.substring(Z)):(J=W,W=""),this._finished=!W,this.parseChunk(J)}}}function w(R){p.call(this,R=R||{});var W=[],J=!0,Z=!1;this.pause=function(){p.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){p.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(G){this._input=G,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){Z&&W.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),W.length?this.parseChunk(W.shift()):J=!0},this._streamData=j(function(G){try{W.push(typeof G=="string"?G:G.toString(this._config.encoding)),J&&(J=!1,this._checkIsFinished(),this.parseChunk(W.shift()))}catch(se){this._streamError(se)}},this),this._streamError=j(function(G){this._streamCleanUp(),this._sendError(G)},this),this._streamEnd=j(function(){this._streamCleanUp(),Z=!0,this._streamData("")},this),this._streamCleanUp=j(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function S(R){var W,J,Z,G=Math.pow(2,53),se=-G,Y=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,oe=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,ee=this,re=0,me=0,K=!1,ye=!1,Me=[],Fe={data:[],errors:[],meta:{}};if(D(R.step)){var Ze=R.step;R.step=function(ft){if(Fe=ft,Ye())it();else{if(it(),Fe.data.length===0)return;re+=ft.data.length,R.preview&&re>R.preview?J.abort():(Fe.data=Fe.data[0],Ze(Fe,ee))}}}function Ge(ft){return R.skipEmptyLines==="greedy"?ft.join("").trim()==="":ft.length===1&&ft[0].length===0}function it(){return Fe&&Z&&(kt("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),Z=!1),R.skipEmptyLines&&(Fe.data=Fe.data.filter(function(ft){return!Ge(ft)})),Ye()&&function(){if(!Fe)return;function ft(nt,Pt){D(R.transformHeader)&&(nt=R.transformHeader(nt,Pt)),Me.push(nt)}if(Array.isArray(Fe.data[0])){for(var bt=0;Ye()&&bt<Fe.data.length;bt++)Fe.data[bt].forEach(ft);Fe.data.splice(0,1)}else Fe.data.forEach(ft)}(),function(){if(!Fe||!R.header&&!R.dynamicTyping&&!R.transform)return Fe;function ft(nt,Pt){var Qe,yt=R.header?{}:[];for(Qe=0;Qe<nt.length;Qe++){var xe=Qe,Ve=nt[Qe];R.header&&(xe=Qe>=Me.length?"__parsed_extra":Me[Qe]),R.transform&&(Ve=R.transform(Ve,xe)),Ve=ct(xe,Ve),xe==="__parsed_extra"?(yt[xe]=yt[xe]||[],yt[xe].push(Ve)):yt[xe]=Ve}return R.header&&(Qe>Me.length?kt("FieldMismatch","TooManyFields","Too many fields: expected "+Me.length+" fields but parsed "+Qe,me+Pt):Qe<Me.length&&kt("FieldMismatch","TooFewFields","Too few fields: expected "+Me.length+" fields but parsed "+Qe,me+Pt)),yt}var bt=1;return!Fe.data.length||Array.isArray(Fe.data[0])?(Fe.data=Fe.data.map(ft),bt=Fe.data.length):Fe.data=ft(Fe.data,0),R.header&&Fe.meta&&(Fe.meta.fields=Me),me+=bt,Fe}()}function Ye(){return R.header&&Me.length===0}function ct(ft,bt){return nt=ft,R.dynamicTypingFunction&&R.dynamicTyping[nt]===void 0&&(R.dynamicTyping[nt]=R.dynamicTypingFunction(nt)),(R.dynamicTyping[nt]||R.dynamicTyping)===!0?bt==="true"||bt==="TRUE"||bt!=="false"&&bt!=="FALSE"&&(function(Pt){if(Y.test(Pt)){var Qe=parseFloat(Pt);if(se<Qe&&Qe<G)return!0}return!1}(bt)?parseFloat(bt):oe.test(bt)?new Date(bt):bt===""?null:bt):bt;var nt}function kt(ft,bt,nt,Pt){var Qe={type:ft,code:bt,message:nt};Pt!==void 0&&(Qe.row=Pt),Fe.errors.push(Qe)}this.parse=function(ft,bt,nt){var Pt=R.quoteChar||'"';if(R.newline||(R.newline=function(xe,Ve){xe=xe.substring(0,1048576);var Je=new RegExp(P(Ve)+"([^]*?)"+P(Ve),"gm"),St=(xe=xe.replace(Je,"")).split("\r"),Ne=xe.split(`
`),ue=1<Ne.length&&Ne[0].length<St[0].length;if(St.length===1||ue)return`
`;for(var he=0,_t=0;_t<St.length;_t++)St[_t][0]===`
`&&he++;return he>=St.length/2?`\r
`:"\r"}(ft,Pt)),Z=!1,R.delimiter)D(R.delimiter)&&(R.delimiter=R.delimiter(ft),Fe.meta.delimiter=R.delimiter);else{var Qe=function(xe,Ve,Je,St,Ne){var ue,he,_t,Wt;Ne=Ne||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var jt=0;jt<Ne.length;jt++){var Zt=Ne[jt],dn=0,zn=0,un=0;_t=void 0;for(var On=new I({comments:St,delimiter:Zt,newline:Ve,preview:10}).parse(xe),no=0;no<On.data.length;no++)if(Je&&Ge(On.data[no]))un++;else{var fs=On.data[no].length;zn+=fs,_t!==void 0?0<fs&&(dn+=Math.abs(fs-_t),_t=fs):_t=fs}0<On.data.length&&(zn/=On.data.length-un),(he===void 0||dn<=he)&&(Wt===void 0||Wt<zn)&&1.99<zn&&(he=dn,ue=Zt,Wt=zn)}return{successful:!!(R.delimiter=ue),bestDelimiter:ue}}(ft,R.newline,R.skipEmptyLines,R.comments,R.delimitersToGuess);Qe.successful?R.delimiter=Qe.bestDelimiter:(Z=!0,R.delimiter=c.DefaultDelimiter),Fe.meta.delimiter=R.delimiter}var yt=V(R);return R.preview&&R.header&&yt.preview++,W=ft,J=new I(yt),Fe=J.parse(W,bt,nt),it(),K?{meta:{paused:!0}}:Fe||{meta:{paused:!1}}},this.paused=function(){return K},this.pause=function(){K=!0,J.abort(),W=D(R.chunk)?"":W.substring(J.getCharIndex())},this.resume=function(){ee.streamer._halted?(K=!1,ee.streamer.parseChunk(W,!0)):setTimeout(ee.resume,3)},this.aborted=function(){return ye},this.abort=function(){ye=!0,J.abort(),Fe.meta.aborted=!0,D(R.complete)&&R.complete(Fe),W=""}}function P(R){return R.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function I(R){var W,J=(R=R||{}).delimiter,Z=R.newline,G=R.comments,se=R.step,Y=R.preview,oe=R.fastMode,ee=W=R.quoteChar===void 0||R.quoteChar===null?'"':R.quoteChar;if(R.escapeChar!==void 0&&(ee=R.escapeChar),(typeof J!="string"||-1<c.BAD_DELIMITERS.indexOf(J))&&(J=","),G===J)throw new Error("Comment character same as delimiter");G===!0?G="#":(typeof G!="string"||-1<c.BAD_DELIMITERS.indexOf(G))&&(G=!1),Z!==`
`&&Z!=="\r"&&Z!==`\r
`&&(Z=`
`);var re=0,me=!1;this.parse=function(K,ye,Me){if(typeof K!="string")throw new Error("Input must be a string");var Fe=K.length,Ze=J.length,Ge=Z.length,it=G.length,Ye=D(se),ct=[],kt=[],ft=[],bt=re=0;if(!K)return ps();if(R.header&&!ye){var nt=K.split(Z)[0].split(J),Pt=[],Qe={},yt=!1;for(var xe in nt){var Ve=nt[xe];D(R.transformHeader)&&(Ve=R.transformHeader(Ve,xe));var Je=Ve,St=Qe[Ve]||0;for(0<St&&(yt=!0,Je=Ve+"_"+St),Qe[Ve]=St+1;Pt.includes(Je);)Je=Je+"_"+St;Pt.push(Je)}if(yt){var Ne=K.split(Z);Ne[0]=Pt.join(J),K=Ne.join(Z)}}if(oe||oe!==!1&&K.indexOf(W)===-1){for(var ue=K.split(Z),he=0;he<ue.length;he++){if(ft=ue[he],re+=ft.length,he!==ue.length-1)re+=Z.length;else if(Me)return ps();if(!G||ft.substring(0,it)!==G){if(Ye){if(ct=[],un(ft.split(J)),So(),me)return ps()}else un(ft.split(J));if(Y&&Y<=he)return ct=ct.slice(0,Y),ps(!0)}}return ps()}for(var _t=K.indexOf(J,re),Wt=K.indexOf(Z,re),jt=new RegExp(P(ee)+P(W),"g"),Zt=K.indexOf(W,re);;)if(K[re]!==W)if(G&&ft.length===0&&K.substring(re,re+it)===G){if(Wt===-1)return ps();re=Wt+Ge,Wt=K.indexOf(Z,re),_t=K.indexOf(J,re)}else if(_t!==-1&&(_t<Wt||Wt===-1))ft.push(K.substring(re,_t)),re=_t+Ze,_t=K.indexOf(J,re);else{if(Wt===-1)break;if(ft.push(K.substring(re,Wt)),fs(Wt+Ge),Ye&&(So(),me))return ps();if(Y&&ct.length>=Y)return ps(!0)}else for(Zt=re,re++;;){if((Zt=K.indexOf(W,Zt+1))===-1)return Me||kt.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ct.length,index:re}),no();if(Zt===Fe-1)return no(K.substring(re,Zt).replace(jt,W));if(W!==ee||K[Zt+1]!==ee){if(W===ee||Zt===0||K[Zt-1]!==ee){_t!==-1&&_t<Zt+1&&(_t=K.indexOf(J,Zt+1)),Wt!==-1&&Wt<Zt+1&&(Wt=K.indexOf(Z,Zt+1));var dn=On(Wt===-1?_t:Math.min(_t,Wt));if(K.substr(Zt+1+dn,Ze)===J){ft.push(K.substring(re,Zt).replace(jt,W)),K[re=Zt+1+dn+Ze]!==W&&(Zt=K.indexOf(W,re)),_t=K.indexOf(J,re),Wt=K.indexOf(Z,re);break}var zn=On(Wt);if(K.substring(Zt+1+zn,Zt+1+zn+Ge)===Z){if(ft.push(K.substring(re,Zt).replace(jt,W)),fs(Zt+1+zn+Ge),_t=K.indexOf(J,re),Zt=K.indexOf(W,re),Ye&&(So(),me))return ps();if(Y&&ct.length>=Y)return ps(!0);break}kt.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ct.length,index:re}),Zt++}}else Zt++}return no();function un(Es){ct.push(Es),bt=re}function On(Es){var Qo=0;if(Es!==-1){var Ko=K.substring(Zt+1,Es);Ko&&Ko.trim()===""&&(Qo=Ko.length)}return Qo}function no(Es){return Me||(Es===void 0&&(Es=K.substring(re)),ft.push(Es),re=Fe,un(ft),Ye&&So()),ps()}function fs(Es){re=Es,un(ft),ft=[],Wt=K.indexOf(Z,re)}function ps(Es){return{data:ct,errors:kt,meta:{delimiter:J,linebreak:Z,aborted:me,truncated:!!Es,cursor:bt+(ye||0)}}}function So(){se(ps()),ct=[],kt=[]}},this.abort=function(){me=!0},this.getCharIndex=function(){return re}}function C(R){var W=R.data,J=a[W.workerId],Z=!1;if(W.error)J.userError(W.error,W.file);else if(W.results&&W.results.data){var G={abort:function(){Z=!0,M(W.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:F,resume:F};if(D(J.userStep)){for(var se=0;se<W.results.data.length&&(J.userStep({data:W.results.data[se],errors:W.results.errors,meta:W.results.meta},G),!Z);se++);delete W.results}else D(J.userChunk)&&(J.userChunk(W.results,G,W.file),delete W.results)}W.finished&&!Z&&M(W.workerId,W.results)}function M(R,W){var J=a[R];D(J.userComplete)&&J.userComplete(W),J.terminate(),delete a[R]}function F(){throw new Error("Not implemented.")}function V(R){if(typeof R!="object"||R===null)return R;var W=Array.isArray(R)?[]:{};for(var J in R)W[J]=V(R[J]);return W}function j(R,W){return function(){R.apply(W,arguments)}}function D(R){return typeof R=="function"}return r&&(o.onmessage=function(R){var W=R.data;if(c.WORKER_ID===void 0&&W&&(c.WORKER_ID=W.workerId),typeof W.input=="string")o.postMessage({workerId:c.WORKER_ID,results:c.parse(W.input,W.config),finished:!0});else if(o.File&&W.input instanceof File||W.input instanceof Object){var J=c.parse(W.input,W.config);J&&o.postMessage({workerId:c.WORKER_ID,results:J,finished:!0})}}),(m.prototype=Object.create(p.prototype)).constructor=m,(h.prototype=Object.create(p.prototype)).constructor=h,(_.prototype=Object.create(_.prototype)).constructor=_,(w.prototype=Object.create(p.prototype)).constructor=w,c})})(Ow);var Q$=Ow.exports;const eE=t0(Q$);function tE(n,e,t,o,i){if(!(!e()||s(t).length===0))switch(n.key){case"ArrowDown":n.preventDefault(),x(o,N(Math.min(s(o)+1,s(t).length-1)));break;case"ArrowUp":n.preventDefault(),x(o,N(Math.max(s(o)-1,-1)));break;case"Enter":n.preventDefault(),s(o)>=0&&s(o)<s(t).length&&i(s(t)[s(o)]);break;case"Escape":n.preventDefault(),e(!1);break}}var nE=fe('<div class="flex justify-center py-16"><div class="relative"><div class="w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin"></div> <div class="absolute inset-0 w-12 h-12 border-4 border-transparent border-t-primary/60 rounded-full animate-spin" style="animation-delay: -0.15s;"></div></div></div>'),oE=fe('<div class="flex flex-col items-center justify-center py-16 text-center"><div class="w-16 h-16 rounded-full bg-base-200/50 flex items-center justify-center mb-4"><svg class="w-8 h-8 text-base-content/40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <p class="text-lg font-semibold text-base-content/60 mb-2">No symbols found</p> <p class="text-sm text-base-content/40">Try a different search term</p></div>'),sE=(n,e,t)=>e(s(t)),iE=fe('<div class="absolute top-0 left-0 w-5 h-5 rounded-full overflow-hidden bg-base-200 ring-2 ring-base-100 z-10"><img class="w-full h-full object-cover"></div> <div class="absolute bottom-0 right-0 w-5 h-5 rounded-full overflow-hidden bg-base-200"><img class="w-full h-full object-cover"></div>',1),rE=fe('<div class="relative w-full h-full rounded-lg overflow-hidden bg-base-200/50"><img class="w-full h-full object-cover"> <div class="absolute inset-0 bg-base-200 flex items-center justify-center hidden"><span class="text-xs font-medium text-base-content/60"> </span></div></div>'),aE=fe('<span class="text-xs px-1.5 py-0.5 rounded bg-base-200/60 border border-base-300/40 text-base-content/60"> </span>'),lE=fe('<p class="text-sm text-base-content/60 truncate mt-0.5"> </p>'),cE=fe('<div class="flex-shrink-0"><svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg></div>'),dE=fe('<div><div class="relative w-8 h-8 flex-shrink-0"><!></div> <div class="flex-1 min-w-0"><div class="flex items-center gap-2"><h3 class="font-medium text-base"> </h3> <span class="text-xs text-base-content/50"> </span> <!></div> <!></div> <!></div>'),uE=fe('<div class="flex items-center justify-center py-4"><div class="flex items-center gap-3 text-base-content/60"><div class="relative"><div class="w-6 h-6 border-2 border-primary/20 border-t-primary rounded-full animate-spin"></div> <div class="absolute inset-0 w-6 h-6 border-2 border-transparent border-t-primary/60 rounded-full animate-spin" style="animation-delay: -0.15s;"></div></div> <span class="text-sm">Loading more symbols…</span></div></div>'),pE=fe('<div class="divide-y divide-base-300/20"><!> <!></div>'),vE=fe('<div class="flex flex-col gap-6"><div class="relative"><div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-base-content/50 pointer-events-none"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <input type="text" class="w-full pl-12 pr-4 py-3 text-sm bg-base-100 border border-base-300/50 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200 placeholder:text-base-content/50" placeholder="Search symbols..."></div> <div class="relative rounded-lg overflow-hidden bg-base-100 border border-base-300/30"><div class="h-96 overflow-y-auto luxury-scrollbar svelte-1r1pdks"><!></div></div> <div class="flex justify-center items-center py-2 mt-1"><div class="group relative cursor-pointer"><div class="absolute inset-0 bg-gradient-to-r from-transparent via-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-700 ease-out blur-xl"></div> <div class="relative flex items-center gap-2 px-4 py-1.5 rounded-full bg-gradient-to-r from-base-100/80 to-base-200/60 backdrop-blur-sm border border-base-300/30 shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-500 ease-out"><div class="w-2 h-2 rounded-full bg-gradient-to-r from-primary to-secondary animate-pulse"></div> <span class="text-sm font-medium text-base-content/70 group-hover:text-primary transition-colors duration-300">Powered by</span> <span class="text-sm font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent group-hover:from-secondary group-hover:to-primary transition-all duration-500">Duty AI</span> <div class="w-2 h-2 rounded-full bg-gradient-to-r from-secondary to-primary animate-pulse" style="animation-delay: 0.5s;"></div></div></div></div></div>'),fE=fe("<div><!></div>");function mE(n,e){gd(e,!0);const t=wp(),o=()=>ya(I,"$save",t),i=()=>ya(c,"$keyword",t),r=()=>ya(P,"$ctx",t);let a=Ws(e,"show",15);const l=kx();let c=zp(""),d=ae(N([]));const p=50;let m=ae(p),h=ae(!1),_,w=ae(N([])),S=ae(-1);const P=Kc("ctx"),I=Kc("save");mr(()=>{a()&&(console.log("🔍 Modal opened! Available symbols:",o().allSymbols.length),console.log("🔍 Current symbol:",o().symbol),x(d,N(o().allSymbols)),x(m,p),x(S,-1))}),mr(()=>{x(w,N(s(d).slice(0,s(m))))}),typeof window<"u"&&(window.testSymbolChange=()=>{if(o().allSymbols.length>0){const se=o().allSymbols[1];console.log("🧪 Testing symbol change to:",se),R(se)}else console.log("🧪 No symbols available for testing")});function C(se){return se.toLowerCase().replace(/[^\p{L}\p{N}]+/gu," ").trim()}function M(se){return C(se).split(/\s+/).filter(Boolean).map(oe=>oe[0]).join("")}function F(se,Y){const oe=se.length,ee=Y.length;if(oe===0)return ee;if(ee===0)return oe;const re=new Array(ee+1);for(let me=0;me<=ee;(me+=1)-1)re[me]=me;for(let me=1;me<=oe;(me+=1)-1){let K=me-1;re[0]=me;for(let ye=1;ye<=ee;(ye+=1)-1){const Me=re[ye],Fe=se[me-1]===Y[ye-1]?0:1;re[ye]=Math.min(re[ye]+1,re[ye-1]+1,K+Fe),K=Me}}return re[ee]}function V(se,Y){const oe=Math.max(se.length,Y.length);return oe===0?1:1-F(se,Y)/oe}function j(se,Y){if(!Y||!Y.trim())return se;const ee=C(Y).split(/\s+/).filter(Boolean);return se.map(me=>{const K=me.ticker.toLowerCase(),ye=me.shortName||"";ye.toLowerCase();const Me=C(ye),Fe=Me.split(/\s+/).filter(Boolean),Ze=(me.exchange||"").toLowerCase(),Ge=M(ye);let it=0,Ye=0;for(const ct of ee){let kt=0;K===ct?kt+=1200:K.startsWith(ct)?kt+=800:K.includes(ct)?kt+=600:Ge===ct||Ge.startsWith(ct)?kt+=450:Me.startsWith(ct)?kt+=500:Me.includes(ct)?kt+=300:Ze.includes(ct)?kt+=80:D(K,ct)?kt+=60:D(Me,ct)&&(kt+=40);const ft=V(K,ct);ft>.5&&(kt+=Math.floor(ft*300));let bt=0;for(const nt of Fe){const Pt=V(nt,ct);if(Pt>bt&&(bt=Pt),bt>=.92)break}bt>.5&&(kt+=Math.floor(bt*200)),kt>0&&(Ye+=1),it+=kt}return Ye===ee.length?it+=100:it+=Ye*50,it>0&&K.length<=5&&(it+=20),{symbol:me,score:it}}).filter(me=>me.score>0).sort((me,K)=>K.score!==me.score?K.score-me.score:me.symbol.ticker.localeCompare(K.symbol.ticker)).map(me=>me.symbol)}function D(se,Y){let oe=0;for(let ee=0;ee<se.length&&oe<Y.length;(ee+=1)-1)se[ee]===Y[oe]&&(oe+=1);return oe===Y.length}c.subscribe(se=>{if(!se||!se.trim()){x(d,N(o().allSymbols)),x(m,p),x(S,-1);return}x(d,N(j(o().allSymbols,se))),x(m,p),x(S,-1)});function R(se){try{dx({logo:se.logo,logo2:se.logo2})}catch{}kl(I,rs(o).symbol=se,rs(o)),a(!1)}async function W(){s(h)||s(m)>=s(d).length||(x(h,!0),await new Promise(se=>setTimeout(se,250)),x(m,N(Math.min(s(m)+p,s(d).length))),x(h,!1))}function J(se){const Y=se.currentTarget;Y.scrollTop+Y.clientHeight>=Y.scrollHeight-24&&W()}var Z=fE();Z.__keydown=[tE,a,w,S,R];var G=g(Z);vf(G,{title:l,width:650,maxHeight:"85vh",get show(){return a()},set show(se){a(se)},get theme(){return o().theme},buttons:[],children:(se,Y)=>{var oe=vE(),ee=g(oe),re=u(g(ee),2);Qt(re),I2(re,!0),f(ee);var me=u(ee,2),K=g(me),ye=g(K);Te(ye,()=>r().loadingPairs,Me=>{var Fe=nE();z(Me,Fe)},Me=>{var Fe=Ln(),Ze=Dt(Fe);Te(Ze,()=>s(d).length===0,Ge=>{var it=oE();z(Ge,it)},Ge=>{var it=pE(),Ye=g(it);vs(Ye,17,()=>s(w),Vs,(kt,ft,bt)=>{var nt=dE();nt.__click=[sE,R,ft];var Pt=g(nt),Qe=g(Pt);Te(Qe,()=>s(ft).logo2,Wt=>{var jt=iE(),Zt=Dt(jt),dn=g(Zt);f(Zt);var zn=u(Zt,2),un=g(zn);f(zn),Se(()=>{zt(dn,"src",`${s(ft).logo}`),zt(dn,"alt",s(ft).ticker),zt(un,"src",`${s(ft).logo2}`),zt(un,"alt",s(ft).ticker)}),sc("error",dn,On=>{On.target.style.display="none"}),B_(dn),sc("error",un,On=>{On.target.style.display="none"}),B_(un),z(Wt,jt)},Wt=>{var jt=rE(),Zt=g(jt),dn=u(Zt,2),zn=g(dn),un=g(zn,!0);Se(()=>ze(un,s(ft).ticker.charAt(0))),f(zn),f(dn),f(jt),Se(()=>{zt(Zt,"src",`${s(ft).logo}`),zt(Zt,"alt",s(ft).ticker)}),sc("error",Zt,On=>{const no=On.target;if(no){no.style.display="none";const fs=no.nextElementSibling;fs&&(fs.style.display="flex")}}),B_(Zt),z(Wt,jt)}),f(Pt);var yt=u(Pt,2),xe=g(yt),Ve=g(xe),Je=g(Ve,!0);f(Ve);var St=u(Ve,2),Ne=g(St,!0);f(St);var ue=u(St,2);Te(ue,()=>s(ft).type,Wt=>{var jt=aE(),Zt=g(jt,!0);f(jt),Se(()=>ze(Zt,s(ft).type)),z(Wt,jt)}),f(xe);var he=u(xe,2);Te(he,()=>s(ft).shortName&&s(ft).shortName!==s(ft).ticker,Wt=>{var jt=lE(),Zt=g(jt,!0);f(jt),Se(()=>ze(Zt,s(ft).shortName)),z(Wt,jt)}),f(yt);var _t=u(yt,2);Te(_t,()=>s(S)===bt,Wt=>{var jt=cE();z(Wt,jt)}),f(nt),Se(()=>{Us(nt,`group flex items-center gap-3 px-4 py-3 cursor-pointer transition-all duration-200
                         ${(s(S)===bt?"bg-primary/10 text-primary border-l-2 border-primary":"hover:bg-base-200/50 text-base-content")??""}`),ze(Je,s(ft).ticker),ze(Ne,s(ft).exchange)}),z(kt,nt)});var ct=u(Ye,2);Te(ct,()=>s(h),kt=>{var ft=uE();z(kt,ft)}),f(it),z(Ge,it)},!0),z(Me,Fe)}),f(K),Xu(K,Me=>_=Me,()=>_),f(me),ai(2),f(oe),po(re,i,Me=>M2(c,Me)),sc("scroll",K,J),z(se,oe)},$$slots:{default:!0}}),f(Z),z(n,Z),hd()}qu(["keydown","click"]);var gE=(n,e,t)=>e(s(t)),hE=fe('<li class="w-[140px] h-[85px] flex items-center justify-center cursor-pointer rounded-lg svelte-18wwyns"><span> </span></li>'),_E=fe('<div class="p-2"><ul class="flex flex-wrap justify-center gap-2"></ul></div>');function yE(n,e){gd(e,!0);const t=wp(),o=()=>ya(l,"$save",t),i=()=>ya(c,"$isRenkoActive",t);let r=Ws(e,"show",15);const a=xx(),l=Kc("save"),c=Lu(l,h=>{var _,w;return((w=(_=h.styles)==null?void 0:_.candle)==null?void 0:w.type)==="renko_atr"}),d=[{timeframe:"1m",multiplier:1,timespan:"minute",secs:60},{timeframe:"5m",multiplier:5,timespan:"minute",secs:300},{timeframe:"15m",multiplier:15,timespan:"minute",secs:900},{timeframe:"30m",multiplier:30,timespan:"minute",secs:1800},{timeframe:"1h",multiplier:1,timespan:"hour",secs:3600},{timeframe:"4h",multiplier:4,timespan:"hour",secs:14400},{timeframe:"1d",multiplier:1,timespan:"day",secs:86400},{timeframe:"1w",multiplier:1,timespan:"week",secs:604800},{timeframe:"1M",multiplier:1,timespan:"month",secs:2592e3}];function p(h){var _;kl(l,rs(o).period=h,rs(o));try{const w=(_=o())!=null&&_.key&&typeof o().key=="string"?o().key:"chart";typeof localStorage<"u"&&localStorage.setItem(`${w}.lastTimeframe`,(h==null?void 0:h.timeframe)||"")}catch{}try{W1.set(h)}catch{}r(!1)}function m(h){switch(h){case"minute":return Fx();case"hour":return $x();case"day":return Ex();case"week":return Nx();case"month":return Dx();default:return h}}vf(n,{title:a,width:500,get show(){return r()},set show(h){r(h)},get theme(){return o().theme},buttons:[],children:(h,_)=>{var w=_E(),S=g(w);vs(S,21,()=>d,Vs,(P,I)=>{var C=Ln(),M=Dt(C);Te(M,()=>!(i()&&s(I).timeframe==="4h"),F=>{var V=hE();V.__click=[gE,p,I];var j=g(V),D=g(j);Se(()=>ze(D,`${s(I).multiplier??""} ${m(s(I).timespan)??""}`)),f(j),f(V),Se(()=>{var R,W,J;Fi(V,"hover:bg-base-200",s(I).timeframe!==((R=o().period)==null?void 0:R.timeframe)),Fi(V,"bg-primary",s(I).timeframe===((W=o().period)==null?void 0:W.timeframe)),Fi(V,"text-primary-content",s(I).timeframe===((J=o().period)==null?void 0:J.timeframe))}),z(F,V)}),z(P,C)}),f(S),f(w),z(h,w)},$$slots:{default:!0}}),hd()}qu(["click"]);const bE=n=>n;function zw(n){const e=n-1;return e*e*e+1}function Ab(n){const e=typeof n=="string"&&n.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[n,"px"]}function Fg(n,{delay:e=0,duration:t=400,easing:o=bE}={}){const i=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:o,css:r=>`opacity: ${r*i}`}}function Qh(n,{delay:e=0,duration:t=400,easing:o=zw,x:i=0,y:r=0,opacity:a=0}={}){const l=getComputedStyle(n),c=+l.opacity,d=l.transform==="none"?"":l.transform,p=c*(1-a),[m,h]=Ab(i),[_,w]=Ab(r);return{delay:e,duration:t,easing:o,css:(S,P)=>`
			transform: ${d} translate(${(1-S)*m}${h}, ${(1-S)*_}${w});
			opacity: ${c-p*P}`}}function xE(n,{delay:e=0,duration:t=400,easing:o=zw,axis:i="y"}={}){const r=getComputedStyle(n),a=+r.opacity,l=i==="y"?"height":"width",c=parseFloat(r[l]),d=i==="y"?["top","bottom"]:["left","right"],p=d.map(I=>`${I[0].toUpperCase()}${I.slice(1)}`),m=parseFloat(r[`padding${p[0]}`]),h=parseFloat(r[`padding${p[1]}`]),_=parseFloat(r[`margin${p[0]}`]),w=parseFloat(r[`margin${p[1]}`]),S=parseFloat(r[`border${p[0]}Width`]),P=parseFloat(r[`border${p[1]}Width`]);return{delay:e,duration:t,easing:o,css:I=>`overflow: hidden;opacity: ${Math.min(I*20,1)*a};${l}: ${I*c}px;padding-${d[0]}: ${I*m}px;padding-${d[1]}: ${I*h}px;margin-${d[0]}: ${I*_}px;margin-${d[1]}: ${I*w}px;border-${d[0]}-width: ${I*S}px;border-${d[1]}-width: ${I*P}px;`}}function q1(n){const e=n-1;return e*e*e+1}const f1={CURRENT_VERSION:1,DEFAULT_FUTURE_MARGIN_MS:30*60*1e3,MAX_FUTURE_MARGIN_MS:24*60*60*1e3,MIN_FUTURE_MARGIN_MS:5*60*1e3,DEFAULT_FUTURE_MARGIN_PERCENT:.2,TIMESTAMP_PRECISION:1,PRICE_PRECISION:1e-6};function v_(n,e){try{const{chart:t,paneId:o="candle_pane"}=e,i={timestamp:n.t,value:n.p},r=t.convertToPixel(i,{paneId:o,absolute:!0});if(!r||typeof r!="object")return null;const a=Array.isArray(r)?r[0]:r;return!a||typeof a!="object"||typeof a.x!="number"||typeof a.y!="number"||!isFinite(a.x)||!isFinite(a.y)?null:{x:a.x,y:a.y}}catch(t){return console.error("Error converting data-space to screen-space:",t),null}}function wE(n,e,t){try{const{chart:o,paneId:i="candle_pane"}=e,r=o.convertFromPixel([n],{paneId:i});if(!r||!Array.isArray(r)||r.length===0||!r[0])return null;const a=r[0];return typeof a.timestamp!="number"||typeof a.value!="number"||!isFinite(a.timestamp)||!isFinite(a.value)?null:{id:t||kE(),t:Math.round(a.timestamp),p:a.value}}catch(o){return console.error("Error converting screen-space to data-space:",o),null}}function Vw(n,e){const t=[];let o=!0,i=!0;for(const r of n){const a=v_(r,e);if(!a){i=!1,t.push({x:0,y:0});continue}t.push(a),(a.x<-100||a.x>1e4||a.y<-100||a.y>1e4)&&(o=!1)}return{screenPoints:t,isVisible:o,isValid:i}}function Tb(n,e,t={}){var o,i,r,a,l;try{const c={minMarginMs:f1.MIN_FUTURE_MARGIN_MS,maxMarginMs:f1.MAX_FUTURE_MARGIN_MS,defaultMarginPercent:f1.DEFAULT_FUTURE_MARGIN_PERCENT,...t},d=e.getDataList();if(!d||d.length===0)return;const p=d[d.length-1],m=typeof(p==null?void 0:p.timestamp)=="number"?p.timestamp:null;if(!m||!isFinite(m))return;let h=Number.NEGATIVE_INFINITY;for(const Y of n)typeof Y.t=="number"&&isFinite(Y.t)&&Y.t>h&&(h=Y.t);if(!Number.isFinite(h)||h<=m)return;const _=Math.max(0,h-m);if(_<=0)return;const w=e.getVisibleRange();let S=0;if(w&&d.length>1){const Y=(o=d[Math.max(0,Math.min(d.length-1,w.from))])==null?void 0:o.timestamp,oe=(i=d[Math.max(0,Math.min(d.length-1,w.to))])==null?void 0:i.timestamp;typeof Y=="number"&&typeof oe=="number"&&isFinite(Y)&&isFinite(oe)&&(S=Math.max(0,oe-Y))}const P=S>0?Math.floor(S*c.defaultMarginPercent):Math.floor(_*c.defaultMarginPercent),I=Math.min(Math.max(c.minMarginMs,P),c.maxMarginMs),C=Math.min(_+I,c.maxMarginMs),M=m+C,F=p.timestamp;if(F>=M)return;const V=[];for(let Y=Math.max(0,d.length-10);Y<d.length-1;Y++){const oe=(r=d[Y])==null?void 0:r.timestamp,ee=(a=d[Y+1])==null?void 0:a.timestamp;if(typeof oe=="number"&&typeof ee=="number"){const re=ee-oe;isFinite(re)&&re>0&&V.push(re)}}const j=V.length?V.sort((Y,oe)=>Y-oe)[Math.floor(V.length/2)]:6e4;if(!j||!isFinite(j)||j<=0)return;const D=Math.max(0,Math.ceil((M-F)/j));if(D<=0)return;const R=typeof(p==null?void 0:p.close)=="number"?p.close:typeof(p==null?void 0:p.open)=="number"?p.open:0,W=[];for(let Y=1;Y<=D;Y++){const oe=F+Y*j;W.push({timestamp:oe,open:R,high:R,low:R,close:R,volume:0})}const J=e.getVisibleRange(),Z=J?J.to>=d.length-2:!0,G=[...d,...W];e.applyNewData(G,!1);try{(G??[]).length>0&&(window.hasFirstDataLoaded=!0)}catch{}const se=Z?G.length-1:J?J.to:G.length-1;try{e.scrollToDataIndex(se)}catch{const Y=(l=G[se])==null?void 0:l.timestamp;if(typeof Y=="number")try{e.scrollToTimestamp(Y)}catch{}}}catch{}}function kE(){return`point_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}class SE{constructor(e){Ce(this,"chart");Ce(this,"context");this.chart=e,this.context={chart:e}}enhanceTemplate(e){const t={...e,originalTemplate:e,createPointFigures:o=>{var a,l;const{overlay:i,coordinates:r}=o;if(this.isDataSpaceOverlay(i)){const c=i,d=Vw(c.points,this.context);return d.isValid?t.createDataSpaceFigures?t.createDataSpaceFigures({overlay:c,chart:this.chart,projectionResult:d,screenCoordinates:d.screenPoints}):((a=e.createPointFigures)==null?void 0:a.call(e,{...o,coordinates:d.screenPoints}))||[]:[]}if(t.createDataSpaceFigures){const c={screenPoints:r||[],isVisible:!0,isValid:Array.isArray(r)&&r.length>0};return t.createDataSpaceFigures({overlay:i,chart:this.chart,projectionResult:c,screenCoordinates:c.screenPoints})}return((l=e.createPointFigures)==null?void 0:l.call(e,o))||[]}};return t}createDataSpaceTemplate(e,t){const o={name:e,totalStep:t.totalStep,needDefaultPointFigure:t.needDefaultPointFigure??!0,needDefaultXAxisFigure:t.needDefaultXAxisFigure??!0,needDefaultYAxisFigure:t.needDefaultYAxisFigure??!0,styles:t.styles,onDrawStart:t.onDrawStart,onDrawing:t.onDrawing,onDrawEnd:t.onDrawEnd,onClick:t.onClick,onDoubleClick:t.onDoubleClick,onRightClick:t.onRightClick,onPressedMoveStart:t.onPressedMoveStart,onPressedMoving:t.onPressedMoving,onPressedMoveEnd:t.onPressedMoveEnd,onMouseEnter:t.onMouseEnter,onMouseLeave:t.onMouseLeave,onSelected:t.onSelected,onDeselected:t.onDeselected};return this.enhanceTemplate({...o,createDataSpaceFigures:t.createDataSpaceFigures})}isDataSpaceOverlay(e){return e&&typeof e=="object"&&"points"in e&&Array.isArray(e.points)&&e.points.length>0&&e.points.every(t=>t&&typeof t=="object"&&"t"in t&&"p"in t&&"id"in t&&typeof t.t=="number"&&typeof t.p=="number"&&typeof t.id=="string")}screenToDataSpace(e){return[]}updateChart(e){this.chart=e,this.context={chart:e}}}let Lb=null;function Ww(n){return Lb=new SE(n),Lb}const Gh={windowBars:120,horizons:[5,10,20],topK:200,stride:1,distance:"cosine",halfLifeBars:500,atrLen:14,rsiLen:14,adxLen:14,avwapAnchors:["sessionOpen","prevHigh","prevLow","swingHi","swingLo"],candidateSL:[.6,.8,1,1.25,1.5],useSwingStop:!1,minMatches:100,winsor:.98,bandAlpha:.22,showTable:!0,showBothDirections:!0},qw="npo_mae_settings_v1";function CE(){try{const n=localStorage.getItem(qw);if(!n)return{...Gh};const e=JSON.parse(n);return{...Gh,...e}}catch{return{...Gh}}}function Fb(n){try{localStorage.setItem(qw,JSON.stringify(n))}catch{}}function PE(n,e){const t=e.windowBars;if(n.length<t)return new Float32Array;const o=n.length-t,i=n.slice(o),r=M=>{const F=[];for(let V=M;V<i.length;V++){const j=(i[V].close-i[V-M].close)/Math.max(1e-8,i[V-M].close);F.push(j)}return F},a=r(1),l=r(2),c=r(3),d=r(5),p=[];for(let M=0;M<i.length;M++){const F=e.atrLen,V=Math.max(0,M-F+1);let j=0,D=0;for(let R=V;R<=M;R++){const W=i[R].high,J=i[R].low;j+=Math.max(0,W-J),D++}p.push(j/Math.max(1,D))}const h=((M,F)=>{const V=[];for(let j=0;j<M.length;j++){const D=Math.max(0,j-F+1),R=M[D],W=M[j];V.push(W-R)}return V})(p,5),_=[];for(let M=0;M<i.length;M++){const F=i[M],V=Math.max(1e-8,F.high-F.low),j=Math.abs(F.close-F.open);_.push(j/V)}const w=[...a,...l,...c,...d,...p,...h,..._],S=w.reduce((M,F)=>M+F,0)/Math.max(1,w.length),P=Math.sqrt(w.reduce((M,F)=>M+Math.pow(F-S,2),0)/Math.max(1,w.length)),C=w.map(M=>(M-S)/(P>1e-8?P:1)).map(M=>Math.max(-5,Math.min(5,M)));return new Float32Array(C)}function H1(n){const e=n.getDataList();if(!e||e.length===0)return null;const t=e[e.length-1];return{timestamp:t.timestamp,price:t.close}}function IE(n,e,t,o="candle_pane"){try{const i=n.convertToPixel({timestamp:e,value:t},{paneId:o}),r=Array.isArray(i)?i[0]:i;return(r==null?void 0:r.y)??null}catch{return null}}function ME(n){try{const e=n.getSize(),t=n.getVisibleRange();if(!e||!t)return 4;const o=Math.max(1,t.to-t.from+1);return e.width/o}catch{return 4}}function AE(n){try{const e=n.getDataList();if(!e||e.length<2)return 0;const t=Math.min(10,e.length-1);let o=0;for(let r=e.length-t;r<e.length-1;r++){const a=e[r],l=e[r+1],c=Math.max(0,((l==null?void 0:l.timestamp)??0)-((a==null?void 0:a.timestamp)??0));o+=c}const i=o/Math.max(1,t);return isFinite(i)&&i>0?i:0}catch{return 0}}function TE(n){return Ww(n).createDataSpaceTemplate("NearestPatternOutcomeMaeStop",{totalStep:1,needDefaultPointFigure:!0,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createDataSpaceFigures:({overlay:o,screenCoordinates:i,chart:r})=>{var Z,G,se,Y,oe,ee;const a=[];if(i.length<1)return a;const l=i[0],c=o.extendData;if(!c)return a;const d=ME(r),p=H1(r);if(!p)return a;const m=p.timestamp,h=p.price,_=c.forwardPathMedianR||[],w=c.forwardPathP10R||[],S=c.forwardPathP90R||[],P=_.map(re=>h+re),I=w.map(re=>h+re),C=S.map(re=>h+re),M=c.bandAlpha??Gh.bandAlpha,F=re=>IE(r,m,re),V=AE(r),j=(re,me)=>{const K=m+(V>0?re*V:0);try{const ye=r.convertToPixel({timestamp:K,value:me},{paneId:"candle_pane"}),Me=Array.isArray(ye)?ye[0]:ye,Fe=(Me==null?void 0:Me.y)??F(me);return{x:(Me==null?void 0:Me.x)??l.x+re*d,y:Fe??l.y}}catch{const ye=F(me);return{x:l.x+re*d,y:ye??l.y}}};if(P.length>0){const re=c.styles&&c.styles.median||{},me=typeof re.size=="number"?re.size:1,K=typeof re.style=="string"?re.style:"solid";for(let ye=0;ye<P.length-1;ye++){const Me=j(ye,P[ye]),Fe=j(ye+1,P[ye+1]);a.push({type:"line",attrs:{coordinates:[Me,Fe]},styles:{color:((Z=c.colors)==null?void 0:Z.median)||"#66c2a5",size:me,style:K}})}}if(I.length>0&&C.length>0&&c.showOutcomeBand!==!1){const re=[];for(let K=0;K<C.length;K++)re.push(j(K,C[K]));for(let K=I.length-1;K>=0;K--)re.push(j(K,I[K]));const me=c.colors&&c.colors.band||`rgba(102, 194, 165, ${M})`;a.push({type:"polygon",attrs:{coordinates:re},styles:{color:me}})}const D=c.selectedSL,R=c.lastAtr,W=D&&typeof R=="number"?h-D*R:void 0;if(c.showStopLines!==!1&&typeof W=="number"){const re=F(W);if(re!=null){const me=r.getSize(),K=(me==null?void 0:me.width)??0,ye=c.styles&&c.styles.slLong||{},Me=typeof ye.size=="number"?ye.size:1,Fe=typeof ye.style=="string"?ye.style:"dashed";a.push({type:"line",attrs:{coordinates:[{x:0,y:re},{x:K,y:re}]},styles:{color:((G=c.colors)==null?void 0:G.slLong)||"#e67e22",style:Fe,size:Me}});const Ze=(W??0).toFixed(2);a.push({type:"text",attrs:{x:K-4,y:re,text:`SL L ${Ze}`},styles:{color:((se=c.colors)==null?void 0:se.slLong)||"#e67e22",backgroundColor:"transparent",align:"right",size:11}})}}const J=D&&typeof R=="number"?h+D*R:void 0;if(c.showStopLines!==!1&&typeof J=="number"){const re=F(J);if(re!=null){const me=r.getSize(),K=(me==null?void 0:me.width)??0,ye=c.styles&&c.styles.slShort||{},Me=typeof ye.size=="number"?ye.size:1,Fe=typeof ye.style=="string"?ye.style:"dashed";a.push({type:"line",attrs:{coordinates:[{x:0,y:re},{x:K,y:re}]},styles:{color:((Y=c.colors)==null?void 0:Y.slShort)||"#c0392b",style:Fe,size:Me}});const Ze=(J??0).toFixed(2);a.push({type:"text",attrs:{x:K-4,y:re,text:`SL S ${Ze}`},styles:{color:((oe=c.colors)==null?void 0:oe.slShort)||"#c0392b",backgroundColor:"transparent",align:"right",size:11}})}}if(c.showTable&&Array.isArray(c.evTable)){const re=r.getSize(),me=(re==null?void 0:re.width)??0,K=240,ye=10,Me=10,Fe=18,Ze=Math.min(c.evTable.length,6),Ge=20,it=Me*2+Ge+Ze*Fe,Ye=12,kt=Math.max(Ye,me-K-Ye-80),ft=10,bt=typeof document<"u"&&((ee=document==null?void 0:document.documentElement)==null?void 0:ee.getAttribute("data-theme"))||"",nt=String(bt).toLowerCase().includes("dark"),Pt=nt?"rgba(16,20,30,0.85)":"rgba(245,247,255,0.95)",Qe=nt?"rgba(140,160,220,0.35)":"rgba(80,100,160,0.35)",yt=nt?"rgba(28,34,50,0.90)":"rgba(232,236,250,0.90)",xe=nt?"#a7b3d8":"#415277",Ve=nt?"#cfd6ee":"#1f2937";a.push({type:"rect",attrs:{x:kt,y:ft,width:K,height:it},styles:{style:"fill",color:Pt}}),a.push({type:"rect",attrs:{x:kt,y:ft,width:K,height:it},styles:{style:"stroke",color:Qe,borderSize:1,borderStyle:"solid"}});const Je=K-ye*2,St=_t=>Math.min(kt+K-ye-4,_t),Ne={mark:St(kt+ye),side:St(kt+ye+12),mult:St(kt+ye+Je*.1),ev:St(kt+ye+Je*.35),pwin:St(kt+ye+Je*.55),winr:St(kt+ye+Je*.72),lossr:St(kt+ye+Je*.88)};let ue=ft+Me+2;a.push({type:"rect",attrs:{x:kt+1,y:ft+1,width:K-2,height:Ge},styles:{style:"fill",color:yt}}),a.push({type:"text",attrs:{x:Ne.mult,y:ue,text:"SL"},styles:{color:xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ne.ev,y:ue,text:"EV"},styles:{color:xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ne.pwin,y:ue,text:"pWin"},styles:{color:xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ne.winr,y:ue,text:"winR"},styles:{color:xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ne.lossr,y:ue,text:"lossR"},styles:{color:xe,size:12,backgroundColor:"transparent"}}),ue+=Ge-6;for(let _t=0;_t<Ze;_t++){const Wt=c.evTable[_t],jt=c.selectedSL===Wt.mult;a.push({type:"text",attrs:{x:Ne.mark,y:ue,text:jt?"▶":"•"},styles:{color:Ve,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ne.side,y:ue,text:Wt.side==="long"?"L":"S"},styles:{color:Ve,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ne.mult,y:ue,text:`${Wt.mult.toFixed(2)}×`},styles:{color:Ve,size:12,backgroundColor:"transparent"}});const Zt=`${Wt.ev>=0?"+":""}${Wt.ev.toFixed(2)}`;a.push({type:"text",attrs:{x:Ne.ev,y:ue,text:Zt},styles:{color:Ve,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ne.pwin,y:ue,text:`${Math.round(Wt.pWin*100)}%`},styles:{color:Ve,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ne.winr,y:ue,text:Wt.avgWinR.toFixed(2)},styles:{color:Ve,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Ne.lossr,y:ue,text:Wt.avgLossR.toFixed(2)},styles:{color:Ve,size:12,backgroundColor:"transparent"}}),ue+=Fe}const he=(()=>{const _t=c.selectedSide;return c.evTable.find(jt=>jt.mult===c.selectedSL&&(!_t||jt.side===_t))||c.evTable.find(jt=>jt.mult===c.selectedSL)||null})();if(he){const Wt=ft+it+6,jt=86,Zt=he.side==="long"?"Long":"Short",dn=`${he.mult.toFixed(2)}× ATR`,zn=h.toFixed(2),un=(he.side==="long"?h-he.mult*(R??0):h+he.mult*(R??0)).toFixed(2),On=Math.round((he.pWin??0)*100);a.push({type:"rect",attrs:{x:kt,y:Wt,width:K,height:jt},styles:{style:"fill",color:nt?"rgba(16,20,30,0.85)":"rgba(245,247,255,0.95)"}}),a.push({type:"rect",attrs:{x:kt,y:Wt,width:K,height:jt},styles:{style:"stroke",color:Qe,borderSize:1,borderStyle:"solid"}});let no=Wt+8+2;a.push({type:"text",attrs:{x:kt+8,y:no,text:`Active: ${Zt}`},styles:{color:xe,size:12,backgroundColor:"transparent"}}),no+=18,a.push({type:"text",attrs:{x:kt+8,y:no,text:`Anchor: ${zn}`},styles:{color:Ve,size:12,backgroundColor:"transparent"}}),no+=18,a.push({type:"text",attrs:{x:kt+8,y:no,text:`Stop: ${un} (${dn})`},styles:{color:Ve,size:12,backgroundColor:"transparent"}}),no+=18,a.push({type:"text",attrs:{x:kt+8,y:no,text:`pWin ${On}% • winR ${he.avgWinR.toFixed(2)} • lossR ${he.avgLossR.toFixed(2)}`},styles:{color:Ve,size:12,backgroundColor:"transparent"}});const fs=Math.abs(h-(he.side==="long"?h-he.mult*(R??0):h+he.mult*(R??0))),ps=S.length&&w.length?Math.max(0,(S[0]??0)-(w[0]??0)):0,So=ps<=1,Es=ps>=2,Qo=he.side==="long"&&(he.ev??0)>=.15&&(he.pWin??0)>=.52&&!Es,Ko=he.side==="short"&&(he.ev??0)>=.1&&(he.pWin??0)>=.5&&!Es,oo=Qo?"BUY":Ko?"SELL":"WAIT",Gs=Qo?"#10b981":Ko?"#ef4444":nt?"#f59e0b":"#b45309",jo=Wt+jt+6,fi=74,ba=nt?"rgba(20,24,32,0.85)":"rgba(240,244,255,0.95)";a.push({type:"rect",attrs:{x:kt,y:jo,width:K,height:fi},styles:{style:"fill",color:ba}}),a.push({type:"rect",attrs:{x:kt,y:jo,width:K,height:fi},styles:{style:"stroke",color:Qe,borderSize:1,borderStyle:"solid"}});let xa=jo+8+2;a.push({type:"text",attrs:{x:kt+8,y:xa,text:`Action: ${oo}`},styles:{color:Gs,size:13,backgroundColor:"transparent"}}),xa+=18;const Al=So?"Band: Narrow":Es?"Band: Wide":"Band: Normal",Qs=`1R: ${fs.toFixed(2)}`,Fs=Qo?"EV≥0.30, pWin≥55%":Ko?"EV≥0.20, pWin≥50%":"Low EV / Wide band / Low pWin";a.push({type:"text",attrs:{x:kt+8,y:xa,text:`${Al} • ${Qs}`},styles:{color:Ve,size:12,backgroundColor:"transparent"}}),xa+=18,a.push({type:"text",attrs:{x:kt+8,y:xa,text:Fs},styles:{color:xe,size:12,backgroundColor:"transparent"}})}}return a},onClick:o=>{var c;const i=o.overlay.extendData;if(!i||!Array.isArray(i.evTable))return!0;const a=(i.evTable.findIndex(d=>d.mult===i.selectedSL)+1)%i.evTable.length,l=i.evTable[a];return l&&(i.selectedSL=l.mult,i.selectedSide=l.side,(c=o.chart)==null||c.overrideOverlay({id:o.overlay.id,extendData:i})),!0}})}function LE(){return new Worker(new URL(""+new URL("../workers/npoMae.worker-DaGdsbjp.js",import.meta.url).href,import.meta.url),{type:"module"})}function FE(n,e){const t=TE(n);Y2(t);let o={...CE()},i=null,r=!0,a=LE(),l=0,c=-1,d=0,p=!0,m=!0;function h(){var F;if(!i){const V=H1(n),j=V?[{timestamp:V.timestamp,value:V.price}]:[],D=n.createOverlay({name:"NearestPatternOutcomeMaeStop",points:j});i=Array.isArray(D)?(D==null?void 0:D[0])??null:D,_();try{const R=cm(),W=((F=R==null?void 0:R.getCurrentSymbol)==null?void 0:F.call(R))||null;R&&W&&i&&R.addDrawing({id:i,symbolKey:W,type:"NearestPatternOutcomeMaeStop",points:V?[{time:V.timestamp,price:V.price}]:[],styles:{},visible:!0})}catch{}}}function _(){var V,j;if(!i)return;const F=H1(n);if(F)try{const D=(V=n.getOverlays)==null?void 0:V.call(n,{id:i}),R=Array.isArray(D)&&D.length>0?D[0]:null,W=(j=R==null?void 0:R.points)==null?void 0:j[0],J=(W==null?void 0:W.timestamp)??(W==null?void 0:W.time)??(W==null?void 0:W.t),Z=(W==null?void 0:W.value)??(W==null?void 0:W.price)??(W==null?void 0:W.p);if(typeof J!="number"||typeof Z!="number"||J!==F.timestamp||Math.abs(Z-F.price)>1e-6){n.overrideOverlay({id:i,points:[{timestamp:F.timestamp,value:F.price}]});try{const se=cm();se&&i&&se.updateDrawing(i,{points:[{time:F.timestamp,price:F.price}]})}catch{}}}catch{}}function w(F){if(!i)return;const V={...F,bandAlpha:o.bandAlpha,showTable:o.showTable,showStopLines:m,showOutcomeBand:p};d&&cancelAnimationFrame(d),d=requestAnimationFrame(()=>{n.overrideOverlay({id:i,extendData:V});try{const j=cm();j&&i&&j.updateDrawing(i,{extendData:V})}catch{}})}function S(){if(!r||!a)return;_();const F=n.getDataList();if(!F||F.length<Math.max(o.windowBars+Math.max(...o.horizons),10)){w({forwardPathMedian:[],forwardPathP10:[],forwardPathP90:[],evTable:[],suggestedSL:null});return}const V=F.map(W=>({time:W.timestamp,open:W.open,high:W.high,low:W.low,close:W.close,volume:W.volume})),j=PE(V,o),D=++l;c=D;const R={id:D,settings:o,features:j,bars:V};a.postMessage(R,[j.buffer])}function P(F){var J,Z;const V=F.data;if(!V||V.id!==c)return;const j=Math.max(...o.horizons),D=V.byHorizon[j];if(!D)return;const R=V.slSuggest||{},W=$E(n,o.atrLen);w({forwardPathMedianR:D.forwardPathMedian,forwardPathP10R:D.forwardPathP10,forwardPathP90R:D.forwardPathP90,evTable:R.evTable||[],selectedSL:((J=R.long)==null?void 0:J.mult)??((Z=R.short)==null?void 0:Z.mult),selectedSide:R.long?"long":R.short?"short":void 0,lastAtr:W})}a&&(a.onmessage=P),h(),S();const I=window.setInterval(()=>{h(),S()},500),C=F=>{F.key==="O"||F.key==="o"?(p=!p,w({})):(F.key==="S"||F.key==="s")&&(m=!m,w({}))};return window.addEventListener("keydown",C,{capture:!0}),{setEnabled(F){r=F,r&&S()},updateSettings(F){o={...o,...F},Fb(o),S()},setShowOutcomeBand(F){p=F,w({})},setShowStopLines(F){m=F,w({})},setColors(F){w({colors:F})},setStyles(F){w({styles:F})},resetSettings(){o={...Gh},Fb(o),S()},getOverlayId(){return i},dispose(){if(window.removeEventListener("keydown",C,{capture:!0}),window.clearInterval(I),a&&(a.terminate(),a=null),i)try{n.removeOverlay({id:i})}catch{}}}}function $E(n,e){const t=n.getDataList();if(!t||t.length===0)return 1;const o=Math.min(e,t.length);let i=0;for(let r=t.length-o;r<t.length;r++){const a=t[r].high,l=t[r].low;i+=Math.max(0,a-l)}return i/Math.max(1,o)}var EE=(n,e)=>x(e,""),NE=fe('<button class="absolute right-4 top-1/2 transform -translate-y-1/2 hover:scale-110 transition-all duration-300 z-10 clear-search-btn svelte-e5btcs" title="Clear search"><svg class="w-4 h-4 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-e5btcs"></path></svg></button>'),DE=(n,e,t,o)=>!s(e)&&t(s(o).is_main,s(o).name),jE=(n,e)=>{n.stopPropagation(),x(e,!0)},RE=fe('<button class="w-8 h-8 rounded-full ml-2 opacity-0 group-hover:opacity-100 hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm info-btn svelte-e5btcs" title="How it works"><svg class="w-4 h-4 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" class="svelte-e5btcs"></circle><line x1="12" y1="16" x2="12" y2="12" class="svelte-e5btcs"></line><line x1="12" y1="8" x2="12.01" y2="8" class="svelte-e5btcs"></line></svg></button>'),BE=(n,e,t)=>{n.stopPropagation(),e(s(t).name)},OE=(n,e,t)=>{n.stopPropagation(),e(s(t).name)},zE=fe('<div class="flex items-center gap-2 ml-4 opacity-100 transition-all duration-300 svelte-e5btcs"><button class="w-8 h-8 rounded-full hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm edit-btn svelte-e5btcs" title="Edit Parameters"><svg class="w-3.5 h-3.5 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" class="svelte-e5btcs"></path></svg></button> <button class="w-8 h-8 rounded-full hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm delete-btn svelte-e5btcs" title="Remove Indicator"><svg class="w-3.5 h-3.5 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-e5btcs"></path></svg></button></div>'),VE=fe('<div><div></div> <div class="flex-1 min-w-0 svelte-e5btcs"><span> </span></div> <!> <!></div>'),WE=fe('<div class="flex flex-col items-center justify-center py-16 text-center svelte-e5btcs"><div class="w-16 h-16 rounded-full bg-base-200/50 flex items-center justify-center mb-4 svelte-e5btcs"><svg class="w-8 h-8 text-base-content/40 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-e5btcs"></path></svg></div> <p class="text-lg font-semibold text-base-content/60 mb-2 svelte-e5btcs">No indicators found</p> <p class="text-sm text-base-content/40 svelte-e5btcs">Try a different search term</p></div>'),qE=fe(`<div class="flex flex-col gap-6 svelte-e5btcs"><div><div class="absolute left-4 top-1/2 transform -translate-y-1/2 pointer-events-none z-10 transition-all duration-300 search-icon svelte-e5btcs"><svg class="w-4 h-4 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-e5btcs"></path></svg></div> <input type="text" class="w-full pl-12 pr-12 py-3.5 text-[15px] font-medium tracking-wide backdrop-blur-sm rounded-2xl
               focus:outline-none transition-all duration-500 ease-out
               placeholder:font-normal search-input svelte-e5btcs"> <!></div> <div class="relative rounded-2xl overflow-hidden backdrop-blur-sm indicator-list-container svelte-e5btcs"><div class="indicator-scroll ultra-minimal-scrollbar svelte-e5btcs"><!> <!></div></div> <div class="flex justify-center items-center py-2 mt-1 svelte-e5btcs"><div class="group relative cursor-pointer svelte-e5btcs"><div class="absolute inset-0 bg-gradient-to-r from-transparent via-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-700 ease-out blur-xl svelte-e5btcs"></div> <div class="relative flex items-center gap-2 px-4 py-1.5 rounded-full bg-gradient-to-r from-base-100/80 to-base-200/60 backdrop-blur-sm border border-base-300/30 shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-500 ease-out svelte-e5btcs"><div class="w-2 h-2 rounded-full bg-gradient-to-r from-primary to-secondary animate-pulse svelte-e5btcs"></div> <span class="text-sm font-medium text-base-content/70 group-hover:text-primary transition-colors duration-300 svelte-e5btcs">Powered by</span> <span class="text-sm font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent group-hover:from-secondary group-hover:to-primary transition-all duration-500 svelte-e5btcs">Duty AI</span> <div class="w-2 h-2 rounded-full bg-gradient-to-r from-secondary to-primary animate-pulse svelte-e5btcs" style="animation-delay: 0.5s;"></div></div></div></div></div>`),HE=(n,e)=>x(e,!1),UE=(n,e)=>x(e,"bn"),GE=(n,e)=>x(e,"en"),YE=(n,e)=>x(e,!1),KE=fe(`<div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">খুব সহজ ব্যাখ্যা</div> <p class="text-sm text-base-content/70 svelte-e5btcs">মনে করুন আপনি আগের দিনের ছবি দেখে আজকের দিনের কথা অনুমান করছেন।
                এই ইন্ডিকেটরটি ঠিক তেমনই করে—এখনকার দামের সঙ্গে খুব মিল‑থাকা
                আগের প্যাটার্ন খুঁজে নেয়, তাদের পথ ধরে সামনে কী হতে পারে তা
                অনুমান করে, আর অতীতে কতটা উল্টো দিকে গেছে সেটাকে ধরে নিরাপদ
                থামার জায়গা (স্টপ‑লস) বলে দেয়।</p> <p class="text-sm text-base-content/70 svelte-e5btcs">উদাহরণ: ধরুন আজকের দামের গতি অনেকটা গত মাসের ১৫ তারিখের মতো।
                ইন্ডিকেটরটি তখন গত মাসের ১৫ তারিখের পরের দিনগুলো কী হয়েছিল সেটা
                দেখে আজকের পরের দিনগুলোর জন্য অনুমান করে।</p> <p class="text-sm text-base-content/70 svelte-e5btcs">চার্টে রঙের ব্যান্ডটি P10–P90 প্রত্যাশিত রেঞ্জ বোঝায়—মানে ১০০‑এর
                মধ্যে ৮০ বার দাম এই সীমার মধ্যে থাকতে পারে। মাঝের রেখাটি মাঝের
                রাস্তা (মিডিয়ান পথ)—দাম সাধারণত এই পথ ধরে চলতে পারে। আর ড্যাশড
                লাইনগুলো লং/শর্টের স্টপ—এগুলোতে পৌঁছালে থামার সংকেত।</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">চার্ট উপাদান</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">মাঝের রাস্তা: দাম সাধারণত কোন পথে যেতে পারে তার মাঝের লাইন।</li> <li class="svelte-e5btcs">রঙের ব্যান্ড: সম্ভাব্য ওঠা‑নামার এলাকা (P10–P90)। সরু মানে
                  পরিষ্কার পথ, প্রশস্ত মানে বেশি অনিশ্চয়তা।</li> <li class="svelte-e5btcs">স্টপের দাগ: লং/শর্টের প্রস্তাবিত স্টপ‑লসের ড্যাশড লাইন।</li> <li class="svelte-e5btcs">ইভি টেবিল: কোন স্টপ নিলে মোটের উপর লাভ‑ক্ষতি কেমন হতে পারে তা
                  দেখায়।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ওভারলে প্যানেলগুলো</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">তথ্য প্যানেল</span>: <span class="font-medium svelte-e5btcs">Active</span> (Long/Short), <span class="font-medium svelte-e5btcs">Anchor</span> (বর্তমান
                  দাম), <span class="font-medium svelte-e5btcs">Stop</span> (SL মূল্য ও ×ATR), <span class="font-medium svelte-e5btcs">pWin</span>, <span class="font-medium svelte-e5btcs">winR</span>, <span class="font-medium svelte-e5btcs">lossR</span> দেখায়—সিদ্ধান্তের জন্য দ্রুত
                  প্রেক্ষাপট দেয়।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">সিদ্ধান্ত প্যানেল</span>: বড় অক্ষরে <span class="font-medium svelte-e5btcs">Action: BUY/SELL/WAIT</span> দেখায়। সঙ্গে <span class="font-medium svelte-e5btcs">Band</span> (Narrow/Normal/Wide), <span class="font-medium svelte-e5btcs">1R</span> দূরত্ব ও <span class="font-medium svelte-e5btcs">শর্তের সারাংশ</span> দেখায়। <br class="svelte-e5btcs">BUY (লং): EV ≥ 0.30 ও pWin ≥ 55%, ব্যান্ড Wide না হলে। <br class="svelte-e5btcs">SELL (শর্ট): EV ≥ 0.20 ও pWin ≥ 50%, ব্যান্ড Wide না
                  হলে। <br class="svelte-e5btcs">অন্যথা: WAIT।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ইভি টেবিল (উদাহরণ)</div> <div class="overflow-x-auto svelte-e5btcs"><table class="table table-xs svelte-e5btcs"><thead class="svelte-e5btcs"><tr class="svelte-e5btcs"><th class="svelte-e5btcs">পজিশন</th><th class="svelte-e5btcs">এসএল (×এটিআর)</th><th class="svelte-e5btcs">ইভি (আর)</th><th class="svelte-e5btcs">জেতার সম্ভাবনা (%)</th><th class="svelte-e5btcs">উইন R</th><th class="svelte-e5btcs">লস R</th></tr></thead><tbody class="svelte-e5btcs"><tr class="svelte-e5btcs"><td class="svelte-e5btcs">লং</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">+0.45</td><td class="svelte-e5btcs">62</td><td class="svelte-e5btcs">1.60</td><td class="svelte-e5btcs">0.95</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">লং</td><td class="svelte-e5btcs">1.25×</td><td class="svelte-e5btcs">+0.30</td><td class="svelte-e5btcs">68</td><td class="svelte-e5btcs">1.35</td><td class="svelte-e5btcs">0.80</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">শর্ট</td><td class="svelte-e5btcs">0.80×</td><td class="svelte-e5btcs">+0.20</td><td class="svelte-e5btcs">54</td><td class="svelte-e5btcs">1.10</td><td class="svelte-e5btcs">0.85</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">শর্ট</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">−0.05</td><td class="svelte-e5btcs">48</td><td class="svelte-e5btcs">1.20</td><td class="svelte-e5btcs">1.10</td></tr></tbody></table></div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ইভি: মোটের উপর গড় প্রত্যাশা। জেতা‑হারা দুটো মিলিয়ে ফল কেমন
                  হবে।</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা (%): ১০০‑এর মধ্যে সংখ্যা। যত বেশি, জেতার
                  সম্ভাবনা তত বেশি।</li> <li class="svelte-e5btcs">উইন R ও লস R: জিতলে আনুমানিক কত, হারলে আনুমানিক কত। ভারসাম্য
                  দেখুন।</li> <li class="svelte-e5btcs">ইভি ≥ 0 হলে সারি বিবেচনা করুন; ইভি যত বেশি, মোট প্রত্যাশা তত
                  ভালো।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">টেবিলের ▶ চিহ্ন (অ্যারো) কীভাবে কাজ করে</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">টেবিলের সারিতে ▶ দেখায় কোন এসএল মাল্টিপ্লায়ার এখন সক্রিয়।
                  ভেতরে ক্লিক করলে ▶ পরের সারিতে যায়।</li> <li class="svelte-e5btcs">▶ যে সারিতে থাকে, সেই সারির <span class="font-medium svelte-e5btcs">SL (×ATR)</span> অনুযায়ী চার্টের ড্যাশড স্টপ‑লাইন আপডেট হয়।</li> <li class="svelte-e5btcs">▶ যদি লং সারিতে থাকে: সিদ্ধান্ত লং বায়াসে ভাবুন; স্টপ সাধারণত
                  বর্তমান দামের নিচে (<span class="font-medium svelte-e5btcs">anchor − mult × ATR</span>).</li> <li class="svelte-e5btcs">▶ যদি শর্ট সারিতে থাকে: সিদ্ধান্ত শর্ট বায়াসে ভাবুন; স্টপ
                  সাধারণত বর্তমান দামের উপরে (<span class="font-medium svelte-e5btcs">anchor + mult × ATR</span>).</li> <li class="svelte-e5btcs">সেরা নির্বাচন: ▶ কে এমন সারিতে রাখুন যেখানে <span class="font-medium svelte-e5btcs">EV পজিটিভ</span>, <span class="font-medium svelte-e5btcs">pWin বেশি</span>, আর <span class="font-medium svelte-e5btcs">lossR নিয়ন্ত্রণে</span> থাকে।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">অ্যারো উদাহরণ (শর্ট)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">ধরুন ▶ শর্ট সারিতে আছে এবং <span class="font-medium svelte-e5btcs">SL = 1.50×</span>, <span class="font-medium svelte-e5btcs">winR = 1.71</span>, <span class="font-medium svelte-e5btcs">lossR = 1.46</span>।</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.50×</span> মানে স্টপ দূরত্ব <span class="font-medium svelte-e5btcs">1.5 × ATR</span> উপরে। দূর স্টপ → কম
                    স্টপ‑হিট; কিন্তু রিস্ক ইউনিট বড় হয়।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.71</span> মানে জিতলে গড় লাভ <span class="font-medium svelte-e5btcs">1.71R</span>। যদি 1R = 100 টাকা
                    রিস্ক ধরেন, জিতলে গড়ে 171 টাকা।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 1.46</span> মানে হারলে গড়
                    ক্ষতি <span class="font-medium svelte-e5btcs">1.46R</span> ≈ 146 টাকা।</li> <li class="svelte-e5btcs">সিদ্ধান্ত: pWin যদি ~55% হয়, তাহলে <span class="font-medium svelte-e5btcs">EV = pWin × winR − (1−pWin) × lossR</span> = 0.55×1.71 − 0.45×1.46 ≈ <span class="font-medium svelte-e5btcs">+0.28R</span> → গ্রহণযোগ্য।</li> <li class="svelte-e5btcs">যদি pWin 45%‑এর নিচে নামে বা lossR বেশি হয়, ▶ অন্য সারিতে
                    সরান (কম SL বা ভালো EV)।</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">অ্যারো উদাহরণ (লং)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">ধরুন ▶ লং সারিতে আছে এবং <span class="font-medium svelte-e5btcs">SL = 1.00×</span>, <span class="font-medium svelte-e5btcs">winR = 1.40</span>, <span class="font-medium svelte-e5btcs">lossR = 0.90</span>।</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.00×</span> মানে স্টপ দূরত্ব <span class="font-medium svelte-e5btcs">1 × ATR</span> নিচে। কাছের স্টপ → ঝুঁকি
                    ছোট; কিন্তু স্টপ‑হিট হতে পারে বেশি।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.40</span> মানে জিতলে গড় লাভ
                    1.40R।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 0.90</span> মানে হারলে গড় ক্ষতি
                    0.90R।</li> <li class="svelte-e5btcs">pWin যদি ~60% হয়, <span class="font-medium svelte-e5btcs">EV ≈ 0.60×1.40 − 0.40×0.90 = +0.54R</span> → শক্ত সিদ্ধান্ত।</li> <li class="svelte-e5btcs">যদি ব্যান্ড খুব প্রশস্ত বা pWin কম হয়, ▶ কে এমন সারিতে নিন
                    যেখানে EV পজিটিভ ও lossR নিয়ন্ত্রিত।</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ব্যান্ড ভিত্তিক সিদ্ধান্ত</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ব্যান্ড সরু: পথ পরিষ্কার—আত্মবিশ্বাস একটু বাড়ানো যেতে পারে।</li> <li class="svelte-e5btcs">ব্যান্ড প্রশস্ত: অনিশ্চয়তা বেশি—সাইজ কমান বা একটু অপেক্ষা
                  করুন।</li> <li class="svelte-e5btcs">ব্যান্ড যদি বড় সাপোর্ট/রেজিস্ট্যান্সের সঙ্গে মিলে যায়: সতর্ক
                  থাকুন, স্টপ দূরে রাখুন।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">উদাহরণ</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">লং বায়াস</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">মাঝের রাস্তা উপরে দিকে। ইভি +0.30→+0.60, জেতার সম্ভাবনা
                    55–65%। এসএল 1.0×–1.25× নিলে সাধারণত জেতার সম্ভাবনা ও লস
                    R‑এর মধ্যে ভালো ভারসাম্য থাকে।</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">শর্ট বায়াস</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">মাঝের রাস্তা নিচের দিকে। শর্ট ইভি +0.20→+0.45। ব্যান্ড যদি
                    আগের নিচু জায়গার সঙ্গে মিলে যায়, এসএল 0.8×–1.0× নিলে সতর্ক
                    এন্ট্রির জন্য ভালো হয়।</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">কখন কিনবেন/বিক্রি করবেন</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">কিনবেন কখন (লং)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">ইভি +0.30 বা তার বেশি হলে</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 55% বা তার বেশি হলে</li> <li class="svelte-e5btcs">ব্যান্ড সরু হলে (পরিষ্কার পথ)</li> <li class="svelte-e5btcs">মাঝের রাস্তা উপরের দিকে হলে</li> <li class="svelte-e5btcs">স্টপ-লস 1.0×–1.25× ATR হলে</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">উদাহরণ: ইভি +0.45, pWin 62%, ব্যান্ড সরু → কিনুন</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">বিক্রি করবেন কখন (শর্ট)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">শর্ট ইভি +0.20 বা তার বেশি হলে</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 50% বা তার বেশি হলে</li> <li class="svelte-e5btcs">ব্যান্ড সরু হলে</li> <li class="svelte-e5btcs">মাঝের রাস্তা নিচের দিকে হলে</li> <li class="svelte-e5btcs">স্টপ-লস 0.8×–1.0× ATR হলে</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">উদাহরণ: ইভি +0.25, pWin 54%, ব্যান্ড সরু → বিক্রি করুন</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">কখন অপেক্ষা করবেন</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ইভি নেগেটিভ হলে (−0.10 বা তার কম)</li> <li class="svelte-e5btcs">ব্যান্ড খুব প্রশস্ত হলে (অনিশ্চয়তা বেশি)</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 45% এর কম হলে</li> <li class="svelte-e5btcs">ব্যান্ড বড় সাপোর্ট/রেজিস্ট্যান্সের সঙ্গে মিলে গেলে</li> <li class="svelte-e5btcs">winR/lossR ভারসাম্য খারাপ হলে (winR ≤ 1.0 বা lossR ≥ 1.2)</li></ul> <p class="text-sm text-base-content/70 mt-2 svelte-e5btcs">উদাহরণ: ইভি −0.15, pWin 42%, ব্যান্ড প্রশস্ত → অপেক্ষা করুন</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">টিপস</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">এডিট পপআপে গিয়ে ব্যান্ডের রং, অপাসিটি ও লাইনের স্টাইল বদলাতে
                  পারেন।</li> <li class="svelte-e5btcs">ইভি টেবিলে ক্লিক করলে স্টপ পাল্টায়; চার্টের ড্যাশড লাইনও সাথে
                  সাথে বদলে যায়।</li> <li class="svelte-e5btcs">ট্রেন্ড ফিল্টার বা ভলিউমের সঙ্গে জোড়া দিলে সিদ্ধান্ত আরও শক্ত
                  হয়।</li> <li class="svelte-e5btcs">রিস্ক ম্যানেজমেন্ট: এক ট্রেডে 1–2% এর বেশি রিস্ক নেবেন না</li> <li class="svelte-e5btcs">কনফার্মেশন: ক্যান্ডেলস্টিক প্যাটার্ন বা ইন্ডিকেটর কনফার্মেশন
                  নিন</li></ul></div>`,1),ZE=fe(`<div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Simple Explanation</div> <p class="text-sm text-base-content/70 svelte-e5btcs">Think of it like looking at old pictures to guess today’s story.
                The indicator finds past patterns that look very similar to now,
                follows their path to estimate what might happen next, and uses
                historical MAE to suggest a safe place to stop (stop‑loss). The
                colored band is the expected range (P10–P90), the middle line is
                the median path, and the dashed lines are suggested long/short
                stops.</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Chart Elements</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Middle road: the central line showing the likely path.</li> <li class="svelte-e5btcs">Colored band: the area where price may move (P10–P90). Narrow
                  means clearer path; wide means more uncertainty.</li> <li class="svelte-e5btcs">Stop marks: dashed lines for suggested long/short stops.</li> <li class="svelte-e5btcs">EV table: shows overall gain‑loss balance for different stops.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Overlay Panels</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">Info Panel</span>: shows <span class="font-medium svelte-e5btcs">Active</span> (Long/Short), <span class="font-medium svelte-e5btcs">Anchor</span> (current
                  price), <span class="font-medium svelte-e5btcs">Stop</span> (SL price and
                  ×ATR), <span class="font-medium svelte-e5btcs">pWin</span>, <span class="font-medium svelte-e5btcs">winR</span>, <span class="font-medium svelte-e5btcs">lossR</span>—quick context for
                  decisions.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">Decision Panel</span>: prominently
                  displays <span class="font-medium svelte-e5btcs">Action: BUY/SELL/WAIT</span> with <span class="font-medium svelte-e5btcs">Band</span> (Narrow/Normal/Wide), <span class="font-medium svelte-e5btcs">1R</span> distance, and <span class="font-medium svelte-e5btcs">criteria summary</span>. <br class="svelte-e5btcs">BUY (Long): EV ≥ 0.30 and pWin ≥ 55%, band not Wide. <br class="svelte-e5btcs">SELL (Short): EV ≥ 0.20 and pWin ≥ 50%, band not Wide. <br class="svelte-e5btcs">Otherwise: WAIT.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">EV Table (Example)</div> <div class="overflow-x-auto svelte-e5btcs"><table class="table table-xs svelte-e5btcs"><thead class="svelte-e5btcs"><tr class="svelte-e5btcs"><th class="svelte-e5btcs">Side</th><th class="svelte-e5btcs">SL (×ATR)</th><th class="svelte-e5btcs">EV (R)</th><th class="svelte-e5btcs">pWin (%)</th><th class="svelte-e5btcs">winR</th><th class="svelte-e5btcs">lossR</th></tr></thead><tbody class="svelte-e5btcs"><tr class="svelte-e5btcs"><td class="svelte-e5btcs">L</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">+0.45</td><td class="svelte-e5btcs">62</td><td class="svelte-e5btcs">1.60</td><td class="svelte-e5btcs">0.95</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">L</td><td class="svelte-e5btcs">1.25×</td><td class="svelte-e5btcs">+0.30</td><td class="svelte-e5btcs">68</td><td class="svelte-e5btcs">1.35</td><td class="svelte-e5btcs">0.80</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">S</td><td class="svelte-e5btcs">0.80×</td><td class="svelte-e5btcs">+0.20</td><td class="svelte-e5btcs">54</td><td class="svelte-e5btcs">1.10</td><td class="svelte-e5btcs">0.85</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">S</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">−0.05</td><td class="svelte-e5btcs">48</td><td class="svelte-e5btcs">1.20</td><td class="svelte-e5btcs">1.10</td></tr></tbody></table></div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">EV: the overall expectancy—combines win and loss outcomes.</li> <li class="svelte-e5btcs">pWin (%): out of 100. Higher means better chance to win.</li> <li class="svelte-e5btcs">winR and lossR: how much you might win or lose. Balance them.</li> <li class="svelte-e5btcs">If EV ≥ 0, consider the row; higher EV means better overall
                  expectancy.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">How the ▶ arrow works</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">The ▶ in the table marks the <span class="font-medium svelte-e5btcs">active SL multiplier</span>. Click inside the table to move it to the next row.</li> <li class="svelte-e5btcs">Where ▶ sits, the chart’s dashed stop‑lines update using that
                  row’s <span class="font-medium svelte-e5btcs">SL (×ATR)</span>.</li> <li class="svelte-e5btcs">If ▶ is on a Long row: think with a long bias; the stop is
                  usually below current price (<span class="font-medium svelte-e5btcs">anchor − mult × ATR</span>).</li> <li class="svelte-e5btcs">If ▶ is on a Short row: think with a short bias; the stop is
                  usually above current price (<span class="font-medium svelte-e5btcs">anchor + mult × ATR</span>).</li> <li class="svelte-e5btcs">Best practice: place ▶ on rows with <span class="font-medium svelte-e5btcs">positive EV</span>, <span class="font-medium svelte-e5btcs">higher pWin</span>, and <span class="font-medium svelte-e5btcs">controlled lossR</span>.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Arrow Example (Short)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">Suppose ▶ is on a Short row with <span class="font-medium svelte-e5btcs">SL = 1.50×</span>, <span class="font-medium svelte-e5btcs">winR = 1.71</span>, <span class="font-medium svelte-e5btcs">lossR = 1.46</span>.</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.50×</span> means stop
                    distance is <span class="font-medium svelte-e5btcs">1.5 × ATR</span> above
                    anchor. Far stop → fewer stop‑hits; risk unit is larger.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.71</span> means average win
                    is <span class="font-medium svelte-e5btcs">1.71R</span>. If 1R = 100 units
                    risk, average win ≈ 171.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 1.46</span> means average
                    loss is <span class="font-medium svelte-e5btcs">1.46R</span>.</li> <li class="svelte-e5btcs">Decision: if pWin ≈ 55%, <span class="font-medium svelte-e5btcs">EV = pWin × winR − (1−pWin) × lossR</span> = 0.55×1.71 − 0.45×1.46 ≈ <span class="font-medium svelte-e5btcs">+0.28R</span> → acceptable.</li> <li class="svelte-e5btcs">If pWin drops below ~45% or lossR rises, move ▶ to a better
                    row (smaller SL or higher EV).</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Arrow Example (Long)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">Suppose ▶ is on a Long row with <span class="font-medium svelte-e5btcs">SL = 1.00×</span>, <span class="font-medium svelte-e5btcs">winR = 1.40</span>, <span class="font-medium svelte-e5btcs">lossR = 0.90</span>.</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.00×</span> means stop
                    distance is <span class="font-medium svelte-e5btcs">1 × ATR</span> below anchor.
                    Closer stop → smaller risk; may get hit more often.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.40</span> means average win
                    is 1.40R.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 0.90</span> means average loss
                    is 0.90R.</li> <li class="svelte-e5btcs">If pWin ≈ 60%, <span class="font-medium svelte-e5btcs">EV ≈ 0.60×1.40 − 0.40×0.90 = +0.54R</span> → strong setup.</li> <li class="svelte-e5btcs">If band is very wide or pWin is low, move ▶ to rows with
                    positive EV and controlled lossR.</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Band‑Based Decisions</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Narrow band: clearer path—slightly increase conviction if
                  suitable.</li> <li class="svelte-e5btcs">Wide band: more uncertainty—reduce size or wait for clarity.</li> <li class="svelte-e5btcs">If band overlaps major support/resistance: be cautious; use a
                  safer stop.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Examples</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Long Bias</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">Middle road is upward. EV +0.30→+0.60, pWin 55–65%. SL
                    1.0×–1.25× often gives a good balance between win chance and
                    lossR.</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Short Bias</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">Middle road is downward. Short EV +0.20→+0.45. If the band
                    overlaps prior lows, SL 0.8×–1.0× is a careful choice.</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">When to Buy/Sell</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Buy When (Long)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">EV +0.30 or higher</li> <li class="svelte-e5btcs">pWin 55% or higher</li> <li class="svelte-e5btcs">Band is narrow (clear path)</li> <li class="svelte-e5btcs">Middle road is upward</li> <li class="svelte-e5btcs">Stop-loss 1.0×–1.25× ATR</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">Example: EV +0.45, pWin 62%, narrow band → Buy</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Sell When (Short)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">Short EV +0.20 or higher</li> <li class="svelte-e5btcs">pWin 50% or higher</li> <li class="svelte-e5btcs">Band is narrow</li> <li class="svelte-e5btcs">Middle road is downward</li> <li class="svelte-e5btcs">Stop-loss 0.8×–1.0× ATR</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">Example: EV +0.25, pWin 54%, narrow band → Sell</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">When to Wait</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">EV is negative (−0.10 or worse)</li> <li class="svelte-e5btcs">Band is very wide (high uncertainty)</li> <li class="svelte-e5btcs">pWin below 45%</li> <li class="svelte-e5btcs">Band overlaps major support/resistance</li> <li class="svelte-e5btcs">Poor winR/lossR balance (winR ≤ 1.0 or lossR ≥ 1.2)</li></ul> <p class="text-sm text-base-content/70 mt-2 svelte-e5btcs">Example: EV −0.15, pWin 42%, wide band → Wait</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Tips</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Use the edit popup to change band opacity, colors, and line
                  styles.</li> <li class="svelte-e5btcs">Click inside the EV table to change stops; dashed lines update
                  instantly.</li> <li class="svelte-e5btcs">Pair with trend filters or volume to make decisions more
                  robust.</li> <li class="svelte-e5btcs">Risk management: Don't risk more than 1–2% per trade</li> <li class="svelte-e5btcs">Confirmation: Wait for candlestick pattern or indicator
                  confirmation</li></ul></div>`,1),XE=fe('<div class="fixed inset-0 z-[60] svelte-e5btcs"><div class="absolute inset-0 bg-base-200/20 svelte-e5btcs"></div> <div class="absolute inset-0 flex items-center justify-center p-4 svelte-e5btcs"><div class="w-full max-w-3xl rounded-xl shadow-2xl border border-base-300 bg-base-100 overflow-hidden svelte-e5btcs"><div class="flex items-center justify-between px-5 py-4 border-b border-base-300 bg-base-50 svelte-e5btcs"><div class="flex items-center gap-3 svelte-e5btcs"><div class="w-8 h-8 rounded-lg flex items-center justify-center bg-primary/10 text-primary svelte-e5btcs"><svg class="w-5 h-5 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" class="svelte-e5btcs"></circle><line x1="12" y1="16" x2="12" y2="12" class="svelte-e5btcs"></line><line x1="12" y1="8" x2="12.01" y2="8" class="svelte-e5btcs"></line></svg></div> <div class="svelte-e5btcs"><div class="text-base font-semibold text-base-content svelte-e5btcs"> </div> <div class="text-xs text-base-content/60 svelte-e5btcs"> </div></div></div> <div class="flex items-center gap-2 svelte-e5btcs"><button>বাংলা</button> <button>English</button></div> <button class="btn btn-xs btn-ghost svelte-e5btcs" aria-label="Close"><svg class="w-4 h-4 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18" class="svelte-e5btcs"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-e5btcs"></line></svg></button></div> <div class="px-5 py-4 space-y-5 max-h-[70vh] overflow-y-auto svelte-e5btcs"><!></div></div></div></div>'),JE=(n,e)=>x(e,!1),QE=(n,e)=>x(e,!1),eN=fe(`<div class="premium-modal-backdrop svelte-e5btcs" role="presentation"></div> <div class="premium-modal-container svelte-e5btcs" role="dialog" aria-modal="true" aria-labelledby="premium-modal-title"><div class="premium-background svelte-e5btcs"><div class="premium-orb premium-orb-1 svelte-e5btcs"></div> <div class="premium-orb premium-orb-2 svelte-e5btcs"></div></div> <div class="premium-content svelte-e5btcs"><button class="premium-close-btn svelte-e5btcs" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><line x1="18" y1="6" x2="6" y2="18" class="svelte-e5btcs"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-e5btcs"></line></svg></button> <div class="premium-icon-wrapper svelte-e5btcs"><div class="premium-icon svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-e5btcs"></path><path d="M2 17l10 5 10-5" class="svelte-e5btcs"></path><path d="M2 12l10 5 10-5" class="svelte-e5btcs"></path></svg> <div class="premium-icon-glow svelte-e5btcs"></div></div></div> <h2 id="premium-modal-title" class="premium-title svelte-e5btcs">Premium Feature</h2> <p class="premium-message svelte-e5btcs">Smart Trend is an exclusive premium indicator. Upgrade to Premium to
        unlock this advanced trend-following tool and enhance your trading
        strategy.</p> <div class="premium-features svelte-e5btcs"><div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">Smart Trend Indicator</span></div> <div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">AI Indicators (Smart Money, Trap Hunter, Volcanic)</span></div> <div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">More premium features coming soon</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-e5btcs"><span class="svelte-e5btcs">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><line x1="5" y1="12" x2="19" y2="12" class="svelte-e5btcs"></line><polyline points="12 5 19 12 12 19" class="svelte-e5btcs"></polyline></svg></a></div></div>`,1),tN=fe("<!> <!> <!>",1);function nN(n,e){gd(e,!0);const t=wp(),o=()=>ya(p,"$chart",t),i=()=>ya(d,"$save",t),r=()=>ya(c,"$ctx",t),a=()=>ya(Fm,"$userPreferences",t);let l=Ws(e,"show",15);const c=Kc("ctx"),d=Kc("save"),p=Kc("chart"),m=gy(),h=[{name:"BBI",title:"BBI (Bull and Bear Index)",is_main:!1},{name:"BOLL",title:"BOLL (Bollinger Bands)",is_main:!0},{name:"EMA",title:"EMA (Exponential Moving Average)",is_main:!0},{name:"ICHIMOKU",title:"ICHIMOKU (Ichimoku Kinko Hyo)",is_main:!0},{name:"MA",title:"MA (Moving Average)",is_main:!0},{name:"SAR",title:"SAR (Parabolic SAR)",is_main:!0},{name:"SMA",title:"SMA (Simple Moving Average)",is_main:!0},{name:"SMARTTREND",title:"Smart Trend",is_main:!0},{name:"ZIGZAG",title:"ZigZag (Trend Reversal Indicator)",is_main:!0},{name:"AO",title:"Awesome Oscillator",is_main:!1},{name:"BIAS",title:"BIAS (Bias)",is_main:!1},{name:"CCI",title:"CCI (Commodity Channel Index)",is_main:!1},{name:"CR",title:"CR (Energy)",is_main:!1},{name:"DMI",title:"DMI (Directional Movement Index)",is_main:!1},{name:"EMV",title:"EMV (Ease of Movement)",is_main:!1},{name:"KDJ",title:"KDJ (KDJ Index)",is_main:!1},{name:"MACD",title:"MACD (Moving Average Convergence Divergence)",is_main:!1},{name:"MTM",title:"MTM (Momentum)",is_main:!1},{name:"OBV",title:"OBV (On Balance Volume)",is_main:!1},{name:"PSY",title:"PSY (Psychological Line)",is_main:!1},{name:"PVT",title:"PVT (Price Volume Trend)",is_main:!1},{name:"ROC",title:"ROC (Rate of Change)",is_main:!1},{name:"RSI",title:"RSI (Relative Strength Index)",is_main:!1},{name:"STOCH",title:"STOCH (Stochastic Oscillator)",is_main:!1},{name:"TRIX",title:"TRIX (Triple Exponential Moving Average)",is_main:!1},{name:"VOL",title:"VOL (Volume)",is_main:!0},{name:"VR",title:"VR (Volume Variation Rate)",is_main:!1},{name:"WR",title:"WR (Williams Percentage Range)",is_main:!1}];h.push({name:"NPO_MAE",title:"Nearest‑Pattern Outcome + MAE‑Stop",is_main:!0});const _=h.slice().sort((xe,Ve)=>xe.name.localeCompare(Ve.name));function w(xe){const Ve=h.find(Je=>Je.name===xe);return Ve?Ve.title:xe}function S(xe,Ve){const Je=new Set;if(!(xe!=null&&xe.getIndicators))return Je;try{xe.getIndicators().forEach(Ne=>{(Ne==null?void 0:Ne.name)===Ve&&(Ne!=null&&Ne.paneId)&&Je.add(Ne.paneId)})}catch(St){console.warn(`⚠️ Failed to read ${Ve} pane IDs from chart:`,St)}return Je}function P(xe,Ve){if(!Ve.has(xe))return xe;let Je=2;for(;Ve.has(`${xe}_${Je}`)&&Je<1e3;)Je+=1;if(!Ve.has(`${xe}_${Je}`))return`${xe}_${Je}`;let St=`${xe}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;for(;Ve.has(St);)St=`${xe}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;return St}function I(xe,Ve,Je,St){const Ne=S(xe,Ve);for(const ue of Ne)if(!Je.has(ue))return ue;return St}let C=ae(N(new Set));function M(){var Je,St,Ne,ue,he,_t;const xe=new Set;if(o())try{const Wt=((St=(Je=o()).getIndicators)==null?void 0:St.call(Je))??[];Wt.forEach(dn=>{dn&&dn.name&&xe.add(dn.name)}),console.log("📊 Indicator list - from chart.getIndicators:",Wt.map(dn=>dn.name));const jt=((ue=(Ne=o()).getOverlays)==null?void 0:ue.call(Ne))??[];(jt==null?void 0:jt.some(dn=>(dn==null?void 0:dn.name)==="NearestPatternOutcomeMaeStop"))&&xe.add("NPO_MAE")}catch(Wt){console.warn("⚠️ Indicator list - getIndicators failed, falling back to saveInds",Wt)}if(xe.size===0&&i()&&i().saveInds){Object.values(i().saveInds).forEach(Wt=>{Wt&&Wt.name&&xe.add(Wt.name)}),console.log("📊 Indicator list - from saveInds (fallback):",Array.from(xe));try{(((_t=(he=o())==null?void 0:he.getOverlays)==null?void 0:_t.call(he))??[]).some(jt=>(jt==null?void 0:jt.name)==="NearestPatternOutcomeMaeStop")||xe.delete("NPO_MAE")}catch{}}const Ve=Array.from(xe).map(Wt=>w(Wt));console.log("🔄 selectedIndicators updated:",Ve),x(C,N(xe))}mr(()=>{var xe;l(),o(),(xe=i())==null||xe.saveInds,M()}),fv(()=>{console.log("modalIndSearch mounted"),console.log("Available ActionTypes:",Object.keys(am)),console.log("ActionType values:",Object.values(am)),console.log("🔍 localStorage content:");for(let xe=0;xe<localStorage.length;(xe+=1)-1){const Ve=localStorage.key(xe);Ve&&console.log(`🔍 ${Ve}:`,localStorage.getItem(Ve))}window.debugChart=()=>{const xe=JSON.parse(localStorage.getItem("chart")||"{}");return console.log("🔍 localStorage chart data:",xe),console.log("🔍 saveInds keys:",Object.keys(xe.saveInds||{})),console.log("🔍 Current $save.saveInds keys:",Object.keys(i().saveInds)),console.log("🔍 Chart available:",o()?"Yes":"No chart"),{localStorage:xe,currentSave:i().saveInds}},setTimeout(()=>{console.log("🚀 Auto-debug on page load:"),window.debugChart()},2e3),console.log("🔍 Debug function added: window.debugChart()")});let F=ae(""),V=ae(!1),j=ae(N(new Set)),D=ae(!1),R=ae(!1),W=ae(!0),J=ae(0),Z,G=ae(!1),se=ae("bn"),Y=ae(!1);mr(()=>{s(G)&&l()?(x(Y,!0),l(!1)):!s(G)&&!l()&&s(Y)&&(x(Y,!1),l(!0))}),mr(()=>{!r().modalIndCfg&&s(V)&&(x(V,!1),setTimeout(()=>{l(!0)},100))});let oe=vt(()=>{let xe=_;if(s(F)){const Ve=s(F).toLowerCase();xe=xe.filter(Je=>Je.name.toLowerCase().includes(Ve)||Je.title.toLowerCase().includes(Ve)).sort((Je,St)=>Je.name.localeCompare(St.name))}if(l()&&s(j).size>0){const Ve=xe.filter(St=>s(j).has(St.name)),Je=xe.filter(St=>!s(j).has(St.name));return[...Ve,...Je]}return xe});mr(()=>{var xe,Ve;if(l()!==s(D)){if(l()){const Je=new Set;if((Ve=(xe=s(C)).forEach)==null||Ve.call(xe,St=>Je.add(St)),Je.size===0&&s(C)&&s(C).size>0)for(const St of s(C).values())Je.add(St);x(j,N(Je))}else x(j,N(new Set));x(D,N(l()))}});function ee(){var Ve;const xe=(Ve=a())==null?void 0:Ve.data;return xe?xe.isPremium===!0||xe.isTrial===!0:!1}async function re(xe,Ve,Je,St=800){var ue;const Ne=Date.now();for(;Date.now()-Ne<St;){try{const he=((ue=xe.getIndicators)==null?void 0:ue.call(xe,{name:Ve,paneId:Je}))??[];if(he.length>0&&he.some(Wt=>(Wt==null?void 0:Wt.result)&&Object.keys(Wt.result).length>0))return}catch{}await new Promise(he=>setTimeout(he,16))}}async function me(xe,Ve){var Je,St,Ne,ue,he,_t,Wt,jt,Zt,dn,zn,un,On,no,fs,ps,So,Es;if(Ve==="SMARTTREND"&&!ee()){console.log("🔒 Premium access required for Smart Trend indicator"),x(R,!0);return}if(Ve==="BBI")Me(Ve,[3,6,12,24],!0,{id:"pane_BBI"});else if(Ve==="EMA")Me(Ve,[20],!0,{id:"candle_pane"});else if(Ve==="MA"){const Qo="candle_pane",Ko=o();if(Ko){const oo=Ko.createIndicator({name:"MA",calcParams:[20],styles:{lines:[{color:"#2563eb",size:1,style:Ke.Solid}]},createTooltipDataSource:({indicator:Gs})=>{const jo=[Gs.visible?1:0,2,3],fi=Ko.getStyles().indicator.tooltip;return{icons:jo.map(xa=>fi.features[xa])}}},!0,{id:Qo});if(await re(Ko,"MA",Qo),oo){const Gs={name:"MA",pane_id:Qo,params:[20],styles:[{color:"#2563eb",thickness:1,lineStyle:"solid"}]},jo=`${Qo}_MA`;d.update(fi=>(fi.saveInds[jo]=Gs,fi))}}}else if(Ve==="SMARTTREND"){const Qo="candle_pane",Ko=o();if(Ko){const oo=Ko.createIndicator({name:"SMARTTREND",calcParams:[10,3],styles:{lines:[{color:"#00FF00",size:1,style:Ke.Dashed,dashedValue:[4,4]}]},extendData:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},createTooltipDataSource:({indicator:Gs})=>{const jo=[Gs.visible?1:0,2,3],fi=Ko.getStyles().indicator.tooltip;return{icons:jo.map(xa=>fi.features[xa])}}},!0,{id:Qo});if(await re(Ko,"SMARTTREND",Qo),oo){const Gs={name:"SMARTTREND",pane_id:Qo,params:[10,3],superTrendGroups:[{id:"st_default",period:10,multiplier:3,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]},jo=`${Qo}_SMARTTREND`;d.update(fi=>(fi.saveInds[jo]=Gs,fi))}}}else if(Ve==="SMA"){const Qo="candle_pane",Ko=o();if(Ko){const oo=Ko.createIndicator({name:"SMA",calcParams:[20],styles:{lines:[{color:"#FF6C37",size:2,style:Ke.Solid}]},createTooltipDataSource:({indicator:Gs})=>{const jo=[Gs.visible?1:0,2,3],fi=Ko.getStyles().indicator.tooltip;return{icons:jo.map(xa=>fi.features[xa])}}},!0,{id:Qo});if(await re(Ko,"SMA",Qo),oo){const Gs={name:"SMA",pane_id:Qo,params:[20],styles:[{color:"#FF6C37",thickness:2,lineStyle:"solid"}]},jo=`${Qo}_SMA`;d.update(fi=>(fi.saveInds[jo]=Gs,fi))}}}else if(Ve==="RSI"){const Qo=o();if(!Qo)return;let Ko=[];try{const Fs=localStorage.getItem("rsiGroups");Fs&&(Ko=JSON.parse(Fs))}catch(Fs){console.warn("Failed to load saved RSI groups:",Fs)}Ko.length===0&&(Ko=[{id:"rsi_default",period:14,overbought:70,middle:50,oversold:30,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",oversoldColor:"#10B981",middleLineColor:"#6B7280"}}]);const oo=Ko[0],Gs=oo.overboughtLevel??oo.overbought??70,jo=oo.middleLevel??oo.middle??50,fi=oo.oversoldLevel??oo.oversold??30,ba=S(Qo,"RSI"),xa=new Set(ba);Object.values(i().saveInds).forEach(Fs=>{(Fs==null?void 0:Fs.name)==="RSI"&&(Fs!=null&&Fs.pane_id)&&xa.add(Fs.pane_id)});const Al=P("pane_RSI",xa),Qs=Qo.createIndicator({name:"RSI",calcParams:[oo.period],styles:{lines:[{color:((St=(Je=oo.styles)==null?void 0:Je.rsi)==null?void 0:St.color)||"#8B5CF6",size:((ue=(Ne=oo.styles)==null?void 0:Ne.rsi)==null?void 0:ue.thickness)??2,style:((_t=(he=oo.styles)==null?void 0:he.rsi)==null?void 0:_t.lineStyle)==="dashed"||((jt=(Wt=oo.styles)==null?void 0:Wt.rsi)==null?void 0:jt.lineStyle)==="dotted"?Ke.Dashed:Ke.Solid}]}},!1,{id:Al,axis:{gap:{bottom:2}}});if(await re(Qo,"RSI",Al),Qs){const Fs=I(Qo,"RSI",ba,Al),Va={id:oo.id||`rsi_${Date.now()}`,period:oo.period,overboughtLevel:Gs,middleLevel:jo,oversoldLevel:fi,paneId:Fs,actualPaneId:Fs,styles:{rsi:{color:((dn=(Zt=oo.styles)==null?void 0:Zt.rsi)==null?void 0:dn.color)||"#8B5CF6",thickness:((un=(zn=oo.styles)==null?void 0:zn.rsi)==null?void 0:un.thickness)??2,lineStyle:((no=(On=oo.styles)==null?void 0:On.rsi)==null?void 0:no.lineStyle)||"solid"},overboughtColor:((fs=oo.styles)==null?void 0:fs.overboughtColor)||"#EF4444",oversoldColor:((ps=oo.styles)==null?void 0:ps.oversoldColor)||"#10B981",middleLineColor:((So=oo.styles)==null?void 0:So.middleLineColor)||"#6B7280"}},$r={name:"RSI",pane_id:Fs,params:[oo.period],rsiGroups:[Va]},cd=`${Fs}_RSI`;d.update(Sd=>(Sd.saveInds[cd]=$r,Sd))}}else if(Ve==="STOCH"){const Qo="pane_STOCH";let Ko=[];try{const jo=localStorage.getItem("stochasticGroups");jo&&(Ko=JSON.parse(jo))}catch(jo){console.warn("Failed to load saved Stochastic groups:",jo)}Ko.length===0&&(Ko=[{id:"stochastic_default",kPeriod:14,dPeriod:3,overbought:80,mid:50,oversold:20,styles:{k:{color:"#3B82F6",thickness:2,lineStyle:"solid"},d:{color:"#EF4444",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midColor:"#6B7280"}}]);const oo=Ko[0],Gs=o();if(Gs&&Gs.createIndicator({name:"STOCH",calcParams:[oo.kPeriod,oo.dPeriod],styles:{lines:[{color:oo.styles.k.color,size:oo.styles.k.thickness,style:oo.styles.k.lineStyle==="dashed"||oo.styles.k.lineStyle==="dotted"?Ke.Dashed:Ke.Solid},{color:oo.styles.d.color,size:oo.styles.d.thickness,style:oo.styles.d.lineStyle==="dashed"||oo.styles.d.lineStyle==="dotted"?Ke.Dashed:Ke.Solid}]}},!0,{id:Qo})){const fi={name:"STOCH",pane_id:Qo,params:[oo.kPeriod,oo.dPeriod]},ba=`${Qo}_STOCH`;d.update(xa=>(xa.saveInds[ba]=fi,xa))}}else if(Ve==="NPO_MAE"){const Qo=o();if(!Qo)return;if(!(((Es=Qo.getOverlays)==null?void 0:Es.call(Qo))??[]).some(oo=>(oo==null?void 0:oo.name)==="NearestPatternOutcomeMaeStop")){const oo=FE(Qo);window.__npoMaeApi=oo,d.update(Gs=>{const jo="candle_pane_NPO_MAE";return Gs.saveInds[jo]={name:"NPO_MAE",pane_id:"candle_pane"},Gs})}}else{const Qo=xe?"candle_pane":"pane_"+Ve;Me(Ve,void 0,!0,{id:Qo})}}function K(xe){var Je,St;let Ve=Object.entries(i().saveInds).find(([Ne,ue])=>ue.name===xe);if(!Ve&&o())try{const ue=(((St=(Je=o()).getIndicators)==null?void 0:St.call(Je))??[]).find(he=>he&&he.name===xe);if(ue){kl(c,rs(r).editIndName=xe,rs(r)),kl(c,rs(r).editPaneId=ue.paneId||r().editPaneId||"candle_pane",rs(r)),kl(c,rs(r).modalIndCfg=!0,rs(r)),x(V,!0),l(!1);return}}catch(Ne){console.warn("⚠️ Failed to locate indicator on chart for edit:",Ne)}if(Ve){const[,Ne]=Ve;kl(c,rs(r).editIndName=xe,rs(r)),kl(c,rs(r).editPaneId=Ne.pane_id,rs(r)),kl(c,rs(r).modalIndCfg=!0,rs(r)),x(V,!0),l(!1)}}function ye(xe){var Ve,Je,St;if(xe==="NPO_MAE"){const Ne=o();if(Ne)try{(((Ve=Ne.getOverlays)==null?void 0:Ve.call(Ne))??[]).forEach(he=>{if((he==null?void 0:he.name)==="NearestPatternOutcomeMaeStop")try{Ne.removeOverlay({id:he.id})}catch{}})}catch{}try{(St=(Je=window.__npoMaeApi)==null?void 0:Je.dispose)==null||St.call(Je),window.__npoMaeApi=null}catch{}d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{var _t;((_t=ue.saveInds[he])==null?void 0:_t.name)==="NPO_MAE"&&delete ue.saveInds[he]}),ue));return}if(xe==="MACD")Object.entries(i().saveInds).filter(([ue,he])=>he.name==="MACD").forEach(([ue,he])=>{Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="MACD"&&delete ue.saveInds[he]}),ue));else if(xe==="RSI")Object.entries(i().saveInds).filter(([ue,he])=>he.name==="RSI").forEach(([ue,he])=>{Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="RSI"&&delete ue.saveInds[he]}),ue));else if(xe==="STOCH")Object.entries(i().saveInds).filter(([ue,he])=>he.name==="STOCH").forEach(([ue,he])=>{Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="STOCH"&&delete ue.saveInds[he]}),ue));else if(xe==="BBI")Object.entries(i().saveInds).filter(([ue,he])=>he.name==="BBI").forEach(([ue,he])=>{Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="BBI"&&delete ue.saveInds[he]}),ue));else if(xe==="AO"){if(console.log("🗑️ Starting bulk AO deletion..."),o())try{const he=o().getIndicators().filter(_t=>_t.name==="AO");console.log("📊 Found AO indicators on chart:",he.length),he.forEach(_t=>{console.log("🗑️ Removing AO indicator from pane:",_t.paneId),o().removeIndicator({paneId:_t.paneId,name:"AO"})}),console.log("✅ All AO indicators removed from chart")}catch(ue){console.error("❌ Error removing AO indicators from chart:",ue)}const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="AO");console.log("🗑️ Deleting AO saved entries:",Ne.length),Ne.forEach(([ue,he])=>{console.log("🗑️ Cleaning saved entry:",ue,"pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="AO"&&(console.log("🗑️ Clearing AO saved data:",he),delete ue.saveInds[he])}),ue)),console.log("✅ Bulk AO deletion completed")}else if(xe==="DMI"){if(console.log("🗑️ Starting bulk DMI deletion..."),o())try{const he=o().getIndicators().filter(_t=>_t.name==="DMI");console.log("📊 Found DMI indicators on chart:",he.length),he.forEach(_t=>{console.log("🗑️ Removing DMI indicator from pane:",_t.paneId),o().removeIndicator({paneId:_t.paneId,name:"DMI"})}),console.log("✅ All DMI indicators removed from chart")}catch(ue){console.error("❌ Error removing DMI indicators from chart:",ue)}const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="DMI");console.log("🗑️ Deleting DMI saved entries:",Ne.length),Ne.forEach(([ue,he])=>{console.log("🗑️ Cleaning saved entry:",ue,"pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="DMI"&&(console.log("🗑️ Clearing DMI saved data:",he),delete ue.saveInds[he])}),ue)),console.log("✅ Bulk DMI deletion completed")}else if(xe==="SAR"){if(console.log("🗑️ Starting bulk SAR deletion..."),o())try{const ue=o().getIndicators().filter(he=>he.name==="SAR");console.log("📊 Found SAR indicators on chart:",ue.length),ue.forEach(he=>{console.log("🗑️ Removing SAR from pane:",he.paneId),o().removeIndicator({paneId:he.paneId,name:"SAR"})})}catch(Ne){console.error("❌ Error removing SAR indicators from chart:",Ne);try{o().removeIndicator({paneId:"candle_pane",name:"SAR"})}catch{}try{o().removeIndicator({paneId:r().editPaneId,name:"SAR"})}catch{}}d.update(Ne=>(Object.keys(Ne.saveInds).forEach(ue=>{Ne.saveInds[ue].name==="SAR"&&delete Ne.saveInds[ue]}),Ne)),c.update(Ne=>(Ne.editIndName==="SAR"&&(Ne.editIndName="",Ne.editPaneId="",Ne.modalIndCfg=!1),Ne)),console.log("✅ Bulk SAR deletion completed")}else if(xe==="SMARTTREND"){if(console.log("🗑️ Starting bulk Smart Trend deletion..."),o())try{const ue=o().getIndicators().filter(he=>he.name==="SMARTTREND");console.log("📊 Found Smart Trend indicators on chart:",ue.length),ue.forEach(he=>{console.log("🗑️ Removing Smart Trend from pane:",he.paneId),o().removeIndicator({paneId:he.paneId,name:"SMARTTREND"})})}catch(Ne){console.error("❌ Error removing Smart Trend indicators from chart:",Ne);try{o().removeIndicator({paneId:"candle_pane",name:"SMARTTREND"})}catch{}try{o().removeIndicator({paneId:r().editPaneId,name:"SMARTTREND"})}catch{}}d.update(Ne=>(Object.keys(Ne.saveInds).forEach(ue=>{Ne.saveInds[ue].name==="SMARTTREND"&&delete Ne.saveInds[ue]}),Ne)),console.log("✅ Bulk Smart Trend deletion completed")}else if(xe==="CR"){if(console.log("🗑️ Starting bulk CR deletion..."),o())try{const he=o().getIndicators().filter(_t=>_t.name==="CR");console.log("📊 Found CR indicators on chart:",he.length),he.forEach(_t=>{console.log("🗑️ Removing CR indicator from pane:",_t.paneId),o().removeIndicator({paneId:_t.paneId,name:"CR"})}),console.log("✅ All CR indicators removed from chart")}catch(ue){console.error("❌ Error removing CR indicators from chart:",ue)}const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="CR");console.log("🗑️ Deleting CR saved entries:",Ne.length),Ne.forEach(([ue,he])=>{console.log("🗑️ Cleaning saved entry:",ue,"pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="CR"&&(console.log("🗑️ Clearing CR saved data:",he),delete ue.saveInds[he])}),ue)),console.log("✅ Bulk CR deletion completed")}else if(xe==="WR"){if(console.log("🗑️ Starting bulk WR deletion..."),o())try{const he=o().getIndicators().filter(_t=>_t.name==="WR");console.log("📊 Found WR indicators on chart:",he.length),he.forEach(_t=>{console.log("🗑️ Removing WR indicator from pane:",_t.paneId),o().removeIndicator({paneId:_t.paneId,name:"WR"})}),console.log("✅ All WR indicators removed from chart")}catch(ue){console.error("❌ Error removing WR indicators from chart:",ue)}const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="WR");console.log("🗑️ Deleting WR saved entries:",Ne.length),Ne.forEach(([ue,he])=>{console.log("🗑️ Cleaning saved entry:",ue,"pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="WR"&&(console.log("🗑️ Clearing WR saved data:",he),delete ue.saveInds[he])}),ue)),c.update(ue=>(ue.clearWrGroups+=1,ue)),console.log("✅ Bulk WR deletion completed")}else if(xe==="KDJ"){const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="KDJ");console.log("🗑️ Deleting KDJ entries:",Ne),Ne.forEach(([ue,he])=>{console.log("🗑️ Deleting KDJ from pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="KDJ"&&(console.log("🗑️ Clearing KDJ saved data:",he),delete ue.saveInds[he])}),ue))}else if(xe==="OBV"){const Ne=Object.entries(i().saveInds).filter(([he,_t])=>_t.name==="OBV");console.log("🗑️ Deleting OBV entries from saveInds:",Ne),Ne.forEach(([he,_t])=>{console.log("🗑️ Deleting OBV from pane (saveInds):",_t.pane_id),_t.pane_id&&Fe(_t.pane_id,xe)});const ue=[r().editPaneId,"pane_OBV_1","pane_OBV_2","pane_OBV_3","pane_OBV_4","pane_OBV_5","main","sub1","sub2","sub3","sub4"];console.log("🗑️ Attempting to remove OBV from common pane locations..."),ue.forEach(he=>{var _t;if(he)try{console.log("🗑️ Trying to remove OBV from pane:",he),(_t=o())==null||_t.removeIndicator({paneId:he,name:"OBV"})}catch{}}),d.update(he=>(Object.keys(he.saveInds).forEach(_t=>{he.saveInds[_t].name==="OBV"&&(console.log("🗑️ Clearing OBV saved data:",_t),delete he.saveInds[_t])}),he)),c.update(he=>(he.clearObvGroups+=1,he))}else if(xe==="CCI"){if(console.log("🗑️ Starting bulk CCI deletion..."),o())try{const he=o().getIndicators().filter(_t=>_t.name==="CCI");console.log("📊 Found CCI indicators on chart:",he.length),he.forEach(_t=>{console.log("🗑️ Removing CCI indicator from pane:",_t.paneId),o().removeIndicator({paneId:_t.paneId,name:"CCI"})}),console.log("✅ All CCI indicators removed from chart")}catch(ue){console.error("❌ Error removing CCI indicators from chart:",ue)}const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="CCI");console.log("🗑️ Deleting CCI saved entries:",Ne.length),Ne.forEach(([ue,he])=>{console.log("🗑️ Cleaning saved entry:",ue,"pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="CCI"&&(console.log("🗑️ Clearing CCI saved data:",he),delete ue.saveInds[he])}),ue)),c.update(ue=>(ue.clearCciGroups+=1,ue)),console.log("✅ Bulk CCI deletion completed")}else if(xe==="EMV"){const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="EMV");console.log("🗑️ Deleting EMV entries:",Ne),Ne.forEach(([ue,he])=>{console.log("🗑️ Deleting EMV from pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="EMV"&&(console.log("🗑️ Clearing EMV saved data:",he),delete ue.saveInds[he])}),ue)),c.update(ue=>(ue.clearEmvGroups+=1,ue))}else if(xe==="MTM"){const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="MTM");console.log("🗑️ Deleting MTM entries:",Ne),Ne.forEach(([ue,he])=>{console.log("🗑️ Deleting MTM from pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="MTM"&&(console.log("🗑️ Clearing MTM saved data:",he),delete ue.saveInds[he])}),ue)),c.update(ue=>(ue.clearMtmGroups+=1,ue))}else if(xe==="PSY"){const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="PSY");console.log("🗑️ Deleting PSY entries:",Ne),Ne.forEach(([ue,he])=>{console.log("🗑️ Deleting PSY from pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="PSY"&&(console.log("🗑️ Clearing PSY saved data:",he),delete ue.saveInds[he])}),ue)),c.update(ue=>(ue.clearPsyGroups+=1,ue))}else if(xe==="PVT"){if(console.log("🗑️ Starting bulk PVT deletion..."),o())try{const he=o().getIndicators().filter(_t=>_t.name==="PVT");console.log("📊 Found PVT indicators on chart:",he.length),he.forEach(_t=>{console.log("🗑️ Removing PVT indicator from pane:",_t.paneId),o().removeIndicator({paneId:_t.paneId,name:"PVT"})}),console.log("✅ All PVT indicators removed from chart")}catch(ue){console.error("❌ Error removing PVT indicators from chart:",ue)}const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="PVT");console.log("🗑️ Deleting PVT saved entries:",Ne.length),Ne.forEach(([ue,he])=>{console.log("🗑️ Cleaning saved entry:",ue,"pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="PVT"&&(console.log("🗑️ Clearing PVT saved data:",he),delete ue.saveInds[he])}),ue)),c.update(ue=>(ue.clearPvtGroups+=1,ue)),console.log("✅ Bulk PVT deletion completed")}else if(xe==="ROC"){if(console.log("🗑️ Starting bulk ROC deletion..."),o())try{const he=o().getIndicators().filter(_t=>_t.name==="ROC");console.log("📊 Found ROC indicators on chart:",he.length),he.forEach(_t=>{console.log("🗑️ Removing ROC indicator from pane:",_t.paneId),o().removeIndicator({paneId:_t.paneId,name:"ROC"})}),console.log("✅ All ROC indicators removed from chart")}catch(ue){console.error("❌ Error removing ROC indicators from chart:",ue)}const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="ROC");console.log("🗑️ Deleting ROC saved entries:",Ne.length),Ne.forEach(([ue,he])=>{console.log("🗑️ Cleaning saved entry:",ue,"pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="ROC"&&(console.log("🗑️ Clearing ROC saved data:",he),delete ue.saveInds[he])}),ue)),c.update(ue=>(ue.clearRocGroups+=1,ue)),console.log("✅ Bulk ROC deletion completed")}else if(xe==="VR"){if(console.log("🗑️ Starting bulk VR deletion..."),o())try{const he=o().getIndicators().filter(_t=>_t.name==="VR");console.log("📊 Found VR indicators on chart:",he.length),he.forEach(_t=>{console.log("🗑️ Removing VR indicator from pane:",_t.paneId),o().removeIndicator({paneId:_t.paneId,name:"VR"})}),console.log("✅ All VR indicators removed from chart")}catch(ue){console.error("❌ Error removing VR indicators from chart:",ue)}const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="VR");console.log("🗑️ Deleting VR saved entries:",Ne.length),Ne.forEach(([ue,he])=>{console.log("🗑️ Cleaning saved entry:",ue,"pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="VR"&&(console.log("🗑️ Clearing VR saved data:",he),delete ue.saveInds[he])}),ue)),console.log("✅ Bulk VR deletion completed")}else if(xe==="VOL"){if(console.log("🗑️ Starting bulk VOL deletion..."),o())try{const he=o().getIndicators().filter(_t=>_t.name==="VOL");console.log("📊 Found VOL indicators on chart:",he.length),he.forEach(_t=>{console.log("🗑️ Removing VOL indicator from pane:",_t.paneId),o().removeIndicator({paneId:_t.paneId,name:"VOL"})}),console.log("✅ All VOL indicators removed from chart")}catch(ue){console.error("❌ Error removing VOL indicators from chart:",ue)}const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="VOL");console.log("🗑️ Deleting VOL saved entries:",Ne.length),Ne.forEach(([ue,he])=>{console.log("🗑️ Cleaning saved entry:",ue,"pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="VOL"&&(console.log("🗑️ Clearing VOL saved data:",he),delete ue.saveInds[he])}),ue)),c.update(ue=>(ue.clearVolGroups+=1,ue)),console.log("✅ Bulk VOL deletion completed")}else if(xe==="BIAS"){if(console.log("🗑️ Starting bulk BIAS deletion..."),o())try{const he=o().getIndicators().filter(_t=>_t.name==="BIAS");console.log("📊 Found BIAS indicators on chart:",he.length),he.forEach(_t=>{console.log("🗑️ Removing BIAS indicator from pane:",_t.paneId),o().removeIndicator({paneId:_t.paneId,name:"BIAS"})}),console.log("✅ All BIAS indicators removed from chart")}catch(ue){console.error("❌ Error removing BIAS indicators from chart:",ue)}const Ne=Object.entries(i().saveInds).filter(([ue,he])=>he.name==="BIAS");console.log("🗑️ Deleting BIAS saved entries:",Ne.length),Ne.forEach(([ue,he])=>{console.log("🗑️ Cleaning saved entry:",ue,"pane:",he.pane_id),he.pane_id&&Fe(he.pane_id,xe)}),d.update(ue=>(Object.keys(ue.saveInds).forEach(he=>{ue.saveInds[he].name==="BIAS"&&(console.log("🗑️ Clearing BIAS saved data:",he),delete ue.saveInds[he])}),ue)),console.log("✅ Bulk BIAS deletion completed")}else{const Ne=Object.entries(i().saveInds).find(([ue,he])=>he.name===xe);if(Ne){const[,ue]=Ne;Fe(ue.pane_id,xe)}}}async function Me(xe,Ve,Je,St){const Ne=o();if(!Ne)return null;let ue=Ve,he={};if(xe==="VOL"){if((!(St!=null&&St.id)||St.id!=="candle_pane")&&(St={axis:{gap:{bottom:2}},...St}),!Ve||Ve.length===0){ue=[20];const zn=(un=>{switch(un){case"dashed":return{style:Ke.Dashed,dashedValue:[4,4]};case"dotted":return{style:Ke.Dashed,dashedValue:[2,2]};default:return{style:Ke.Solid,dashedValue:[2,2]}}})("dotted");he={bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#26a69a"}],lines:[{color:"#8B5CF6",size:1,style:zn.style,dashedValue:zn.dashedValue,smooth:!1}]}}}else xe==="EMV"&&((!(St!=null&&St.id)||St.id!=="candle_pane")&&(St={axis:{gap:{bottom:2}},...St}),(!Ve||Ve.length===0)&&(ue=(d_[xe]||[]).filter(zn=>zn.type!=="color").map(zn=>zn.default)));if(!ue||ue.length===0){const dn=d_[xe]||[];dn.length>0&&xe!=="VOL"&&(ue=dn.filter(un=>un.type!=="color").map(un=>un.default),dn.filter(un=>un.styleKey&&un.type==="color").forEach(un=>{const On=un.styleKey,no=un.default,fs=On.match(/^(\w+)\[(\d+)\]\.(\w+)$/);if(fs){const[,ps,So,Es]=fs;he[ps]||(he[ps]=[]),he[ps][parseInt(So)]||(he[ps][parseInt(So)]={}),he[ps][parseInt(So)][Es]=no}}))}const _t=(St==null?void 0:St.id)??"",Wt=`${_t}_${xe}`,jt=Ne.createIndicator({name:xe,calcParams:ue,styles:Object.keys(he).length>0?he:void 0,createTooltipDataSource:({indicator:dn})=>{const zn=[dn.visible?1:0,2,3],un=Ne.getStyles().indicator.tooltip;return{icons:zn.map(no=>un.features[no])}}},Je,St);if(await re(Ne,xe,St==null?void 0:St.id),!jt)return null;const Zt={name:xe,pane_id:_t,params:ue};return d.update(dn=>(dn.saveInds[Wt]=Zt,dn)),dm(),op.recordAddIndicator(xe,_t,ue||[],Wt),Zt}async function Fe(xe,Ve){if(console.log("🗑️ delInd called:",{paneId:xe,name:Ve,chart:!!o()}),!o()){console.log("❌ No chart available");return}const Je=o(),St=`${xe}_${Ve}`,Ne=i().saveInds[St];Ne&&op.recordRemoveIndicator(Ve,xe,Ne.params||[],St),console.log("🔥 Attempting to remove indicator with correct API: removeIndicator(paneId, name)");try{Je.removeIndicator({paneId:xe,name:Ve}),console.log("✅ removeIndicator successful")}catch(he){console.log("❌ removeIndicator failed:",he);try{console.log("🔄 Trying fallback: remove indicator by name directly"),console.log("Attempting to remove indicator:",Ve,"from pane:",xe),console.log("Direct removal attempt for:",Ve),[].forEach(Wt=>{console.log("Removing indicator instance:",Wt);try{Je.removeIndicator({paneId:xe,name:Wt.name})}catch(jt){console.log("Failed to remove indicator instance:",jt)}}),console.log("✅ Fallback method successful")}catch(_t){console.log("❌ Fallback method also failed:",_t)}}console.log("🧹 Cleaning saved state for:",Ve);const ue=JSON.parse(localStorage.getItem("indicators")||"{}");console.log("🧹 Current localStorage indicators:",ue),ue[xe]&&(ue[xe]=ue[xe].filter(he=>he.name!==Ve),ue[xe].length===0&&delete ue[xe],localStorage.setItem("indicators",JSON.stringify(ue)),console.log("🧹 Updated localStorage indicators:",ue)),d.update(he=>{if(console.log("🧹 Before cleanup saveInds keys:",Object.keys(he.saveInds)),Ve==="ZIGZAG"){const _t=`${xe}_ZIGZAG`;Object.keys(he.saveInds).forEach(Wt=>{const jt=he.saveInds[Wt];Wt.startsWith(_t)&&(jt==null?void 0:jt.name)==="ZIGZAG"&&(console.log("🧹 Removing ZigZag save key:",Wt),delete he.saveInds[Wt])})}else{const _t=`${xe}_${Ve}`;console.log("🧹 Cleaning saved state key:",_t,"existed:",!!he.saveInds[_t]),delete he.saveInds[_t]}return console.log("🧹 After cleanup saveInds keys:",Object.keys(he.saveInds)),he}),dm(),m.removeIndicator({chart:Je,name:Ve,paneId:xe}).catch(he=>{console.warn("Background color preservation failed:",he)}),console.log("✅ delInd completed")}Lu(c,xe=>xe.cloudIndLoaded).subscribe(xe=>{console.log("🔄 cloudIndLoaded triggered, saveInds:",Object.keys(i().saveInds)),console.log("🚫 Automatic indicator restoration disabled to prevent deleted indicators from reappearing")});function Ge(xe){const Je=xe.target.scrollTop;Je<s(J)||Je<=10?x(W,!0):Je>s(J)&&Je>50&&x(W,!1),x(J,N(Je))}const it=Lu(c,xe=>xe.initDone);let Ye=!1;it.subscribe(xe=>{if(console.log("initDone changed:",xe,"chart:",!!o(),"subscribed:",Ye),xe>0&&!Ye&&o()){console.log("Subscribing to OnTooltipIconClick with chart:",o()),console.log("Chart methods available:",Object.getOwnPropertyNames(o())),console.log("subscribeAction method:",typeof o().subscribeAction),Ye=!0;try{o().subscribeAction(am.OnCandleTooltipFeatureClick,Ve=>{var St,Ne;console.log("🔥 OnTooltipIconClick fired!",Ve);const Je=Ve;if(Je.indicatorName)switch(console.log("Processing icon click:",Je.iconId,"for indicator:",Je.indicatorName),Je.iconId){case"visible":{console.log("Making indicator visible"),(St=o())==null||St.overrideIndicator({name:Je.indicatorName,paneId:Je.paneId,visible:!0});break}case"invisible":{console.log("Making indicator invisible"),(Ne=o())==null||Ne.overrideIndicator({name:Je.indicatorName,paneId:Je.paneId,visible:!1});break}case"setting":{console.log("Opening settings"),kl(c,rs(r).editIndName=Je.indicatorName,rs(r)),kl(c,rs(r).editPaneId=Je.paneId,rs(r)),kl(c,rs(r).modalIndCfg=!0,rs(r)),l()&&l(!1);break}case"close":console.log("Deleting indicator:",Je.indicatorName,"from pane:",Je.paneId),Fe(Je.paneId,Je.indicatorName)}}),console.log("✅ Successfully subscribed to OnTooltipIconClick")}catch(Ve){console.error("❌ Error subscribing to OnTooltipIconClick:",Ve)}}});const ct=Ng(),[kt,ft]=ct;var bt=tN(),nt=Dt(bt),Pt=vt(()=>uy());vf(nt,{get title(){return s(Pt)},width:700,maxWidth:"95vw",maxHeight:"min(92svh, 90vh)",get show(){return l()},set show(xe){l(xe)},get theme(){return i().theme},buttons:[],class:"ind-modal",children:(xe,Ve)=>{var Je=qE(),St=g(Je),Ne=u(g(St),2);Qt(Ne),Se(()=>zt(Ne,"placeholder",Cx()));var ue=u(Ne,2);Te(ue,()=>s(F),Zt=>{var dn=NE();dn.__click=[EE,F],z(Zt,dn)}),f(St);var he=u(St,2),_t=g(he),Wt=g(_t);vs(Wt,17,()=>s(oe),Vs,(Zt,dn,zn)=>{var un=VE();const On=vt(()=>s(C).has(s(dn).name));un.__click=[DE,On,me,dn];var no=g(un),fs=u(no,2),ps=g(fs),So=g(ps,!0);f(ps),f(fs);var Es=u(fs,2);Te(Es,()=>s(dn).name==="NPO_MAE",Ko=>{var oo=RE();oo.__click=[jE,G],z(Ko,oo)});var Qo=u(Es,2);Te(Qo,()=>s(On),Ko=>{var oo=zE(),Gs=g(oo);Gs.__click=[BE,K,dn];var jo=u(Gs,2);jo.__click=[OE,ye,dn],f(oo),z(Ko,oo)}),f(un),Se(()=>{Us(un,`group indicator-row relative flex items-center min-h-[56px] px-5 py-3 cursor-pointer transition-all duration-500 ease-out
                   ${(zn<s(oe).length-1?"border-b":"")??""} 
                   ${(s(On)?"indicator-item-selected":"indicator-item-unselected")??""} svelte-e5btcs`),Us(no,`flex items-center justify-center w-2 h-2 rounded-full mr-4 transition-all duration-500
                        ${(s(On)?"indicator-dot-selected":"indicator-dot-unselected")??""} svelte-e5btcs`),Us(ps,`indicator-title text-[15px] font-medium tracking-wide leading-relaxed
                           ${(s(On)?"indicator-text-selected":"indicator-text-unselected")??""} svelte-e5btcs`),ze(So,s(dn).title)}),z(Zt,un)});var jt=u(Wt,2);Te(jt,()=>s(oe).length===0,Zt=>{var dn=WE();z(Zt,dn)}),f(_t),Xu(_t,Zt=>Z=Zt,()=>Z),f(he),ai(2),f(Je),Se(()=>Us(St,`relative group transition-all duration-300 ease-out ${(s(W)?"opacity-100 translate-y-0":"opacity-0 -translate-y-4 pointer-events-none")??""} svelte-e5btcs`)),po(Ne,()=>s(F),Zt=>x(F,Zt)),sc("scroll",_t,Ge),z(xe,Je)},$$slots:{default:!0}});var Qe=u(nt,2);Te(Qe,()=>s(G),xe=>{var Ve=XE(),Je=g(Ve);Je.__click=[HE,G];var St=u(Je,2),Ne=g(St),ue=g(Ne),he=g(ue),_t=u(g(he),2),Wt=g(_t),jt=g(Wt,!0);f(Wt);var Zt=u(Wt,2),dn=g(Zt,!0);f(Zt),f(_t),f(he);var zn=u(he,2),un=g(zn);un.__click=[UE,se];var On=u(un,2);On.__click=[GE,se],f(zn);var no=u(zn,2);no.__click=[YE,G],f(ue);var fs=u(ue,2),ps=g(fs);Te(ps,()=>s(se)==="bn",So=>{var Es=KE();ai(22),z(So,Es)},So=>{var Es=ZE();ai(22),z(So,Es)}),f(fs),f(Ne),f(St),f(Ve),Se(()=>{ze(jt,s(se)==="bn"?"নিকটতম‑প্যাটার্ন আউটকাম + এমএই‑স্টপ":"Nearest‑Pattern Outcome + MAE‑Stop"),ze(dn,s(se)==="bn"?"কিভাবে কাজ করে এবং কিভাবে ব্যবহার করবেন":"How it works and how to use"),Us(un,`btn btn-xs ${(s(se)==="bn"?"btn-primary":"btn-outline")??""} svelte-e5btcs`),Us(On,`btn btn-xs ${(s(se)==="en"?"btn-primary":"btn-outline")??""} svelte-e5btcs`)}),z(xe,Ve)});var yt=u(Qe,2);return Te(yt,()=>s(R),xe=>{var Ve=eN(),Je=Dt(Ve);Je.__click=[JE,R];var St=u(Je,2),Ne=u(g(St),2),ue=g(Ne);ue.__click=[QE,R];var he=u(ue,10);Se(()=>zt(he,"href",kt("https://dutyai.app/settings/investor?device=1",void 0))),f(Ne),f(St),Mf(3,Je,()=>Fg,()=>({duration:200})),Mf(3,St,()=>Qh,()=>({y:20,duration:300,easing:q1})),z(xe,Ve)}),z(n,bt),hd({createIndicator:Me,delInd:Fe})}qu(["click"]);function oN(n,e){n.target===n.currentTarget&&e(!1)}function sN(n,e,t,o,i){const r=n.target,a=parseInt(r.value);e(isNaN(a)?100:Math.max(0,Math.min(100,a)));const l=t(o(),e());i("opacityChange",{opacity:e(),rgba:l,color:o()}),i("colorChange",{color:o(),opacity:e(),rgba:l})}var iN=(n,e)=>e(!1),rN=(n,e,t)=>e(s(t)),aN=fe("<button></button>"),lN=fe('<div class="flex gap-1 flex-wrap"></div>'),cN=(n,e,t)=>e(s(t)),dN=fe("<button></button>"),uN=(n,e)=>{const t=n.target;t&&e(t.value)},pN=(n,e)=>{const t=n.target;t&&e(t.value)},vN=fe('<div class="fixed inset-0 z-[80] flex items-center justify-center bg-black/50 p-4"><div class="bg-base-100 rounded-lg shadow-xl p-4 w-full max-w-md max-h-[80vh] overflow-y-auto"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-base-content">Color Picker</h3> <button class="btn btn-sm btn-primary">OK</button></div> <div class="space-y-1 mb-4 max-h-60 overflow-y-auto"></div> <div class="mb-4"><div class="flex items-center justify-between mb-2"><div class="text-sm text-base-content/70">Opacity</div> <div class="text-sm text-base-content/80"> </div></div> <div class="relative"><div class="absolute inset-0 h-2 rounded opacity-30" style="background-image: repeating-conic-gradient(#808080 0% 25%, transparent 0% 50%) 50% / 8px 8px;"></div> <input type="range" min="0" max="100" class="relative w-full h-2 rounded appearance-none cursor-pointer"> <div class="absolute top-1/2 w-4 h-4 bg-base-100 border-2 border-base-content rounded-full transform -translate-y-1/2 pointer-events-none shadow-sm"></div></div></div> <div class="mb-4"><div class="text-sm text-base-content/70 mb-2">Quick Colors</div> <div class="flex gap-2 flex-wrap"></div></div> <div class="mt-3 pt-3 border-t border-base-300"><div class="text-xs text-base-content/60 mb-2">Custom Color</div> <div class="flex items-center gap-2 flex-wrap"><input type="color" class="w-8 h-8 rounded border border-base-300 cursor-pointer flex-shrink-0"> <input type="text" class="input input-xs flex-1 min-w-0 text-xs" placeholder="#000000"></div></div></div></div>');function rl(n,e){gd(e,!0);let t=Ws(e,"show",15),o=Ws(e,"selectedColor",7,"#000000");Ws(e,"position",19,()=>({x:0,y:0}));let i=Ws(e,"opacity",7,100);const r=mv();function a(_){const w=(_||"").trim();if(!w)return null;if(/^#?[0-9A-Fa-f]{6}$/.test(w)){const P=w.startsWith("#")?w.slice(1):w;return{r:parseInt(P.slice(0,2),16),g:parseInt(P.slice(2,4),16),b:parseInt(P.slice(4,6),16)}}const S=w.match(/^rgba?\(([^)]+)\)$/i);if(S){const P=S[1].split(",").map(I=>parseFloat(I.trim()));if(P.length>=3&&P.every(I=>!isNaN(I)))return{r:Math.round(P[0]),g:Math.round(P[1]),b:Math.round(P[2])}}return null}function l(_,w){const S=a(_);if(!S)return null;const P=Math.max(0,Math.min(100,w))/100;return`rgba(${S.r}, ${S.g}, ${S.b}, ${P})`}const c=[["#000000","#1C1C1C","#383838","#545454","#707070","#8C8C8C","#A8A8A8","#C4C4C4","#E0E0E0","#FFFFFF"],["#FF0000","#FF4D4F","#FF7875","#FFA39E","#FFCCC7","#FFF1F0","#FFEDED","#FFF5F5","#FFFAFA","#FFFFFF"],["#FF8C00","#FA541C","#FF7A45","#FF9C6E","#FFBB96","#FFD8BF","#FFE7BA","#FFF2E8","#FFF7E6","#FFFBE6"],["#FFD700","#FADB14","#FFEC3D","#FFF566","#FFFF8F","#FFFFB8","#FFFBE6","#FFFBF0","#FFFBF0","#FFFBF0"],["#32CD32","#52C41A","#73D13D","#95DE64","#B7EB8F","#D9F7BE","#F6FFED","#F6FFED","#F6FFED","#F6FFED"],["#00CED1","#13C2C2","#36CFC9","#5CDBD3","#87E8DE","#B5F5EC","#E6FFFB","#E6FFFB","#E6FFFB","#E6FFFB"],["#1E90FF","#1890FF","#40A9FF","#69C0FF","#91D5FF","#BAE7FF","#E6F7FF","#E6F7FF","#E6F7FF","#E6F7FF"],["#9370DB","#722ED1","#9254DE","#B37FEB","#D3ADF7","#EFDBFF","#F9F0FF","#F9F0FF","#F9F0FF","#F9F0FF"]],d=["#FF4D4F","#1890FF","#52C41A","#FA8C16","#722ED1","#000000"];function p(_){o(_);const w=l(_,i());r("colorChange",{color:_,opacity:i(),rgba:w}),t(!1)}var m=Ln(),h=Dt(m);Te(h,t,_=>{var w=vN();w.__click=[oN,t];var S=g(w),P=g(S),I=u(g(P),2);I.__click=[iN,t],f(P);var C=u(P,2);vs(C,21,()=>c,Vs,(re,me)=>{var K=lN();vs(K,21,()=>s(me),Vs,(ye,Me)=>{var Fe=aN();Fe.__click=[rN,p,Me],Se(()=>{Us(Fe,`w-6 h-6 rounded border-2 transition-all hover:scale-110 ${(o()===s(Me)?"border-white shadow-lg":"border-base-300")??""}`),zt(Fe,"style",`background-color: ${s(Me)??""}`),zt(Fe,"title",s(Me))}),z(ye,Fe)}),f(K),z(re,K)}),f(C);var M=u(C,2),F=g(M),V=u(g(F),2),j=g(V);f(V),f(F);var D=u(F,2),R=u(g(D),2);Qt(R),R.__input=[sN,i,l,o,r];const W=vt(()=>`background: linear-gradient(to right, rgba(0,0,0,0), ${(l(o(),100)||o())??""});`);var J=u(R,2);f(D),f(M);var Z=u(M,2),G=u(g(Z),2);vs(G,21,()=>d,Vs,(re,me)=>{var K=dN();K.__click=[cN,p,me],Se(()=>{Us(K,`w-8 h-8 rounded border-2 transition-all hover:scale-110 ${(o()===s(me)?"border-white shadow-lg":"border-base-300")??""}`),zt(K,"style",`background-color: ${s(me)??""}`),zt(K,"title",s(me))}),z(re,K)}),f(G),f(Z);var se=u(Z,2),Y=u(g(se),2),oe=g(Y);Qt(oe),oe.__change=[uN,p];var ee=u(oe,2);Qt(ee),ee.__change=[pN,p],f(Y),f(se),f(S),f(w),Se(()=>{ze(j,`${i()??""}%`),zt(R,"style",s(W)),zt(J,"style",`left: calc(${i()??""}% - 8px);`),Jd(oe,o()),Jd(ee,o())}),po(R,i),z(_,w)}),z(n,m),hd()}qu(["click","input","change"]);const uv={LAYOUTS:"chart.saves.v1",ACTIVE_SAVE_ID:"chart.activeSaveId",LEGACY_LAYOUTS:"chart.saves.v0"};function zi(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}function m1(n){return n.toUpperCase().trim()}function g1(n){return n&&typeof n.id=="string"&&typeof n.name=="string"&&typeof n.createdAt=="string"&&typeof n.updatedAt=="string"&&typeof n.timezone=="string"&&typeof n.interval=="string"&&typeof n.chartType=="string"&&typeof n.theme=="string"&&Array.isArray(n.panes)&&Array.isArray(n.indicators)&&typeof n.drawingsBySymbol=="object"}class Hw{constructor(){Ce(this,"initialized",!1);this.initialize()}async initialize(){if(!(this.initialized||!T1))try{await this.migrate(),this.initialized=!0}catch(e){console.error("Failed to initialize storage provider:",e)}}async migrate(){try{const e=localStorage.getItem(uv.LEGACY_LAYOUTS);if(!e)return;console.log("🔄 Migrating chart saves from v0 to v1...");const t=JSON.parse(e);if(!Array.isArray(t))return;if(localStorage.getItem(uv.LAYOUTS)){localStorage.removeItem(uv.LEGACY_LAYOUTS);return}const i=t.map(r=>({id:r.id||zi(),name:r.name||"Migrated Layout",createdAt:r.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),timezone:r.timezone||"UTC",interval:r.interval||"1h",chartType:r.chartType||"candles",theme:r.theme||"dark",panes:r.panes||[],indicators:r.indicators||[],styles:r.styles||{},options:r.options||{},drawingsBySymbol:r.drawings?{[m1(r.symbol||"DEFAULT")]:r.drawings}:{}}));localStorage.setItem(uv.LAYOUTS,JSON.stringify(i)),localStorage.removeItem(uv.LEGACY_LAYOUTS),console.log(`✅ Migrated ${i.length} layouts to v1 format`)}catch(e){console.error("Migration failed:",e)}}async listSavedLayouts(){await this.initialize();try{const e=localStorage.getItem(uv.LAYOUTS);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(g1).map(o=>({id:o.id,name:o.name,createdAt:o.createdAt,updatedAt:o.updatedAt})).sort((o,i)=>new Date(i.updatedAt).getTime()-new Date(o.updatedAt).getTime()):[]}catch(e){return console.error("Failed to list saved layouts:",e),[]}}async getSavedLayout(e){await this.initialize();try{const t=localStorage.getItem(uv.LAYOUTS);if(!t)return null;const o=JSON.parse(t);if(!Array.isArray(o))return null;const i=o.find(r=>r.id===e);return i&&g1(i)?i:null}catch(t){return console.error("Failed to get saved layout:",t),null}}async createSavedLayout(e){await this.initialize();try{const t=new Date().toISOString(),o={...e,id:zi(),createdAt:t,updatedAt:t,drawingsBySymbol:Object.fromEntries(Object.entries(e.drawingsBySymbol).map(([a,l])=>[m1(a),l]))},i=localStorage.getItem(uv.LAYOUTS),r=i?JSON.parse(i):[];return r.push(o),localStorage.setItem(uv.LAYOUTS,JSON.stringify(r)),o}catch(t){throw console.error("Failed to create saved layout:",t),new Error("Failed to save layout")}}async updateSavedLayout(e,t){await this.initialize();try{const o=localStorage.getItem(uv.LAYOUTS);if(!o)throw new Error("Layout not found");const i=JSON.parse(o),r=i.findIndex(l=>l.id===e);if(r===-1)throw new Error("Layout not found");const a={...i[r],...t,id:e,updatedAt:new Date().toISOString(),drawingsBySymbol:t.drawingsBySymbol?Object.fromEntries(Object.entries(t.drawingsBySymbol).map(([l,c])=>[m1(l),c])):i[r].drawingsBySymbol};return i[r]=a,localStorage.setItem(uv.LAYOUTS,JSON.stringify(i)),a}catch(o){throw console.error("Failed to update saved layout:",o),new Error("Failed to update layout")}}async deleteSavedLayout(e){await this.initialize();try{const t=localStorage.getItem(uv.LAYOUTS);if(!t)return;const i=JSON.parse(t).filter(a=>a.id!==e);localStorage.setItem(uv.LAYOUTS,JSON.stringify(i)),await this.getActiveSaveId()===e&&await this.setActiveSaveId(null)}catch(t){throw console.error("Failed to delete saved layout:",t),new Error("Failed to delete layout")}}async setActiveSaveId(e){try{e===null?localStorage.removeItem(uv.ACTIVE_SAVE_ID):localStorage.setItem(uv.ACTIVE_SAVE_ID,e)}catch(t){console.error("Failed to set active save ID:",t)}}async getActiveSaveId(){try{return localStorage.getItem(uv.ACTIVE_SAVE_ID)}catch(e){return console.error("Failed to get active save ID:",e),null}}async layoutNameExists(e,t){return(await this.listSavedLayouts()).some(i=>i.name===e&&i.id!==t)}async cleanup(){try{const e=localStorage.getItem(uv.LAYOUTS);if(!e)return;const t=JSON.parse(e),o=t.filter(g1);o.length!==t.length&&(localStorage.setItem(uv.LAYOUTS,JSON.stringify(o)),console.log(`🧹 Cleaned up ${t.length-o.length} invalid layouts`))}catch(e){console.error("Failed to cleanup storage:",e)}}}const fN=new Hw;function kf(n,e,t,o,i,r,a){if(!s(e)||!t()||!i().editPaneId)return;const l=[a.zoneLookbackBars,a.minZoneBars,a.maxZoneBars,a.atrPeriod,a.volumeMAPeriod,a.minVolumeFactor,a.maxZoneWidthPct,a.priorTrendLookback,a.minOBVTrendStrength,a.minZoneScore,a.mergeNearbyZones?1:0,a.maxZonesDisplayed,a.showLabels?1:0];try{t().overrideIndicator({name:"SMART_MONEY",calcParams:l,paneId:i().editPaneId})}catch(c){console.error("SMART_MONEY realtime update failed:",c)}}function mN(n,e,t){const o={id:zi(),deviation:5,depth:5,styles:{color:"#2962FF",thickness:2,lineStyle:"solid"}};x(e,N([...s(e),o])),t()}function $b(n,e,t,o){const i=e();i&&i.setStyles({median:{size:s(t),style:s(o)}})}function Eb(n,e,t,o){const i=e();i&&i.setStyles({slLong:{size:s(t),style:s(o)}})}function Nb(n,e,t,o){const i=e();i&&i.setStyles({slShort:{size:s(t),style:s(o)}})}function gN(n,e,t){const o=e();o&&o.setShowOutcomeBand(!!s(t))}function hN(n,e,t){const o=e();o&&o.setShowStopLines(!!s(t))}function _N(n,e,t){const o=e();o&&o.updateSettings({showTable:!!s(t)})}function yN(n,e,t){if(s(e))try{if(s(t).length>=10){console.warn("⚠️ Maximum number of EMV groups (10) reached");return}const i=s(t).length+1,r={id:zi(),name:`EMV #${i}`,period:14,period2:9,color:"#2563eb",thickness:2,lineStyle:"solid"};s(t).push(r),console.log("✅ Added new EMV group:",r.name)}catch(o){console.error("❌ Error adding EMV group:",o)}}function bN(n,e,t,o){if(s(e))try{if(s(t).length>=10){console.warn("⚠️ Maximum number of MTM groups (10) reached");return}const r=s(t).length+1,a=["#2563eb","#8B5CF6","#F59E0B","#10B981","#EF4444","#EC4899","#06B6D4","#F97316"],l=s(t).length%a.length,c={id:zi(),name:`MTM #${r}`,period:14,color:a[l],thickness:2,lineStyle:"solid"};s(t).push(c),console.log("✅ Added new MTM group:",c.name),o()}catch(i){console.error("❌ Error adding MTM group:",i)}}function xN(n,e,t,o){if(!s(e))return;const i=s(t).length+1;s(t).push({id:zi(),name:`BIAS${i}`,period:6,color:"#2196F3",thickness:1,lineStyle:"solid"}),o()}function wN(n,e,t,o){if(!s(e))return;const i=s(t).length+1,r=i===1?"CCI":`CCI${i}`;s(t).push({id:zi(),name:r,period:14,color:"#FF9800",thickness:1,lineStyle:"solid"}),console.log("➕ Added new CCI group:",r),o()}function kN(n,e,t,o){if(!s(e))return;const i=s(t)[s(t).length-1]||s(t)[0],r={id:zi(),start:(i==null?void 0:i.start)??.02,increment:(i==null?void 0:i.increment)??.02,maxValue:(i==null?void 0:i.maxValue)??.2,color:"#2563eb",dotSize:1};x(t,N([...s(t),r])),o()}function SN(n,e,t,o){if(!s(e))return;const i=["#00FF00","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8"],r=s(t).map(p=>p.styles.uptrend.color),a=i.filter(p=>!r.includes(p)),l=a.length>0?a[0]:i[s(t).length%i.length],c=s(t)[s(t).length-1]||s(t)[0],d={id:zi(),period:((c==null?void 0:c.period)||10)+2,multiplier:(c==null?void 0:c.multiplier)||3,showLabels:!0,styles:{uptrend:{color:l,thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}};x(t,N([...s(t),d])),console.log("✅ Added new Smart Trend group:",d),o()}function CN(n,e,t,o){if(!s(e))return;const i=s(t).length+1;s(t).push({id:zi(),name:`DMI${i}`,diPeriod:14,adxPeriod:6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}),console.log("➕ Added new DMI group"),o()}function PN(n,e,t,o){if(!s(e))return;const i=s(t).length+1;s(t).push({id:zi(),name:`CR${i}`,crPeriod:26,crMa1Period:10,crMa2Period:20,crMa3Period:40,crMa4Period:60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}),console.log("➕ Added new CR group"),o()}function IN(n,e,t,o){if(!s(e))return;const i=["#26A69A","#EF5350","#8B5CF6","#F59E0B","#10B981","#F97316","#06B6D4","#84CC16"],r=s(t).length%i.length;s(t).push({id:zi(),shortPeriod:5,longPeriod:34,styles:{increasing:{color:i[r]},decreasing:{color:i[(r+1)%i.length]}}}),o()}function MN(n,e,t){x(e,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(t,!0)}function W0(n,e,t,o,i,r,a,l,c,d,p,m,h,_,w,S,P){if(s(e))return;if(s(t)){o();return}if(s(i)){r();return}if(s(a)){l();return}if(s(c)){d();return}if(p.length>=10)return;const I=p[p.length-1],C={...I,title:`${I.title.replace(/\d+$/,"")}${p.length+1}`};p.push(C),m.push(C.default||0),h.push({color:"#2563eb",thickness:1,lineStyle:"solid"}),s(_)?w():s(S)&&P()}function AN(n,e,t,o,i,r,a,l,c,d,p,m,h,_,w){if(!s(e))return;const S=t().editPaneId||"candle_pane";s(i).push({id:zi(),paneId:S,period:s(r),stdDev:s(a),styles:{fillColor:s(l),fillOpacity:s(c),upperColor:s(d),middleColor:s(p),lowerColor:s(m),thickness:s(h),lineStyle:s(_)}}),w()}var TN=(n,e,t)=>e(s(t).id),LN=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove MACD"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),FN=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Fast</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Slow</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Signal</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">MACD Line:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Signal Line:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Positive Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Negative Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div></div></div>'),$N=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More MACD"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add MACD</span></button></div></div>'),EN=fe('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Zone Lookback Bars</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Prior Trend Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Zone Bars</label> <input type="number" min="3" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zone Bars</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zone Width %</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.005" max="0.10" step="0.005" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Factor</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.5" max="2.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min OBV Trend</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="0.6" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Zone Score</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.3" max="0.9" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Merge Nearby Zones</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Overlap/adjacent similar zones merge</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div> <div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Show Labels</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Type + score label</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zones Displayed</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"></div></div>'),NN=(n,e,t)=>{e[9]=n.currentTarget.checked?1:0,t()},DN=fe('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Resistance Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Support Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Trap Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Spike (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="1.0" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Breakout Factor (%)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="number" step="0.0001" min="0.0000" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">e.g. 0.0005 = 0.05%</span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Wick Ratio</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Trap Score</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Stable Signal</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Show blue “Stable” dots</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normal Quiet Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"></div></div></div>'),jN=fe('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Compression Inputs</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB StdDev</label> <input type="number" step="0.1" min="0.1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normalize Lookback</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Pressure SMA</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Alert & Breakout Behavior</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Pressure for Alert</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Range Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Body % of Range</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Breakout Lookback</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Bars Between Signals</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div></div>'),RN=fe('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Detection Parameters</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB StdDev</label> <input type="number" step="0.1" min="0.1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normalize Lookback</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Pressure SMA</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Alert & Breakout Filters</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Pressure for Alert</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Range Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Body % of Range</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Breakout Lookback</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Bars Between Signals</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div></div>'),BN=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove RSI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),ON=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="50" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Middle</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="50"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">RSI Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change RSI Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 border-t border-base-200 pt-2 svelte-fy2ox8"><span class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Level Lines</span> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Overbought Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Oversold Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Middle Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Middle Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between mt-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Fill Opacity</span> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.05" max="0.5" step="0.05" class="range range-xs w-20 svelte-fy2ox8"> <span class="text-xs text-base-content/60 w-8 svelte-fy2ox8"> </span></div></div></div></div>'),zN=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 sm:gap-2 svelte-fy2ox8" title="Add More RSI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add RSI</span></button></div></div>'),VN=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Stochastic"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),WN=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">%K Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">%D Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="50"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="50" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="50"></div></div> <div class="grid grid-cols-1 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Mid Level</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="100"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">%K Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change %K Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">%D Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change %D Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 border-t border-base-200 pt-2 svelte-fy2ox8"><span class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Level Colors</span> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Overbought Color"></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Oversold Color"></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Mid Line</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Mid Line Color"></button></div></div></div>'),qN=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 sm:gap-2 svelte-fy2ox8" title="Add More Stochastic"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Stochastic</span></button></div></div>'),HN=(n,e,t)=>e(s(t).id),UN=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove DMI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),GN=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">DI Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ADX Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">DI+:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">DI-:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">ADX:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),YN=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More DMI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add DMI</span></button></div></div>'),KN=(n,e,t)=>e(s(t).id),ZN=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Williams %R"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),XN=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-50" max="0"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Middle Level</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-70" max="-30"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-100" max="-50"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">WR Line:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 border-b border-base-200 pb-1 svelte-fy2ox8">Level Lines</div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Overbought:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Middle:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Oversold:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),JN=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More Williams %R"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Williams %R</span></button></div></div>'),QN=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove VR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),eD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Short Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 sm:col-span-1 col-span-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Long Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Main Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Short Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Long Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),tD=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More VR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add More VR</span></button></div></div>'),nD=(n,e,t)=>e(s(t).id),oD=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove BBI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),sD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 1</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 2</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 3</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 4</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),iD=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More BBI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add BBI</span></button></div></div>'),rD=(n,e,t)=>e(s(t).id),aD=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove EMV"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),lD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 1</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 2</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),cD=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More EMV"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add EMV</span></button></div></div>'),dD=(n,e,t)=>e(s(t).id),uD=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove MTM"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),pD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-1 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),vD=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More MTM"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add MTM</span></button></div></div>'),fD=(n,e,t)=>e(s(t).id),mD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove this AO"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Short Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Long Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="border-t border-base-300 pt-2 mt-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 mb-2 block svelte-fy2ox8">Histogram Colors</label> <div class="grid grid-cols-1 gap-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Increasing Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Decreasing Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div></div>'),gD=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More Awesome Oscillator"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add More AO</span></button></div></div>'),hD=(n,e,t)=>e(s(t).id),_D=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove CR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),yD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">CR Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA1 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA2 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA3 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA4 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">CR:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA1:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA2:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA3:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA4:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),bD=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More CR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add CR</span></button></div></div>'),xD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Deviation %</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="50" step="0.1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Depth</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="50"></div></div> <div class="border-t border-base-300 pt-2 mt-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 mb-2 block svelte-fy2ox8">ZigZag Line Style</label> <div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Thickness</span> <select class="select select-bordered select-xs w-20 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Style</span> <select class="select select-bordered select-xs w-24 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),wD=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more ZigZag"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More ZigZag</button></div></div>'),kD=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Delete this PVT instance">✕</button>'),SD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),CD=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-primary svelte-fy2ox8">➕ Add More PVT</button></div></div>'),PD=(n,e,t)=>e(s(t).id),ID=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove SAR Group"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),MD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Start</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.001" max="0.1" step="0.001"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Increment</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.001" max="0.1" step="0.001"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max value</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="1.0" step="0.01"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Dot size:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div></div></div>'),AD=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-primary svelte-fy2ox8">➕ Add More SAR</button></div></div>'),TD=(n,e,t)=>e(s(t).id),LD=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Smart Trend Group"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),FD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="100" step="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Multiplier</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-sm svelte-fy2ox8"> <label class="text-xs text-base-content/60 svelte-fy2ox8">Show Labels</label></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 svelte-fy2ox8">Uptrend Line</div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 svelte-fy2ox8">Downtrend Line</div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div></div>'),$D=fe('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary svelte-fy2ox8" title="Add more Smart Trend"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add Smart Trend</button></div></div>'),ED=(n,e)=>e(),ND=fe('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete EMA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),DD=fe('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),jD=(n,e)=>e(),RD=(n,e)=>e(),BD=fe('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),OD=fe('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <!></div>'),zD=fe('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more EMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add EMA</button></div>'),VD=fe('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),WD=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Delete this SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),qD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-sm svelte-fy2ox8" min="1" max="500"></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Color</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Line Thickness</label> <select class="select select-bordered select-xs w-20 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Line Style</label> <select class="select select-bordered select-xs w-24 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),HD=fe('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add SMA</button></div></div>'),UD=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Volume"><span class="text-xs svelte-fy2ox8">×</span></button>'),GD=fe('<div class="w-6 svelte-fy2ox8"></div>'),YD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs svelte-fy2ox8" min="1" max="200"></div></div> <div class="space-y-2 svelte-fy2ox8"><h4 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Volume Histogram</h4> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Up Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Down Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div> <div class="space-y-2 svelte-fy2ox8"><h4 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">EMA Line</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-sm svelte-fy2ox8"> <label class="text-xs text-base-content/60 svelte-fy2ox8">Show EMA with Volume</label></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),KD=fe('<div class="space-y-3 mt-3 svelte-fy2ox8"></div>'),ZD=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove TRIX"><span class="text-xs svelte-fy2ox8">×</span></button>'),XD=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">TRIX:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Signal:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">TRIX Line:</span> <div class="w-3 h-2 rounded svelte-fy2ox8"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <input type="color" class="w-8 h-6 rounded border border-base-300 cursor-pointer svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-12 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Signal Line:</span> <div class="w-3 h-2 rounded svelte-fy2ox8"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <input type="color" class="w-8 h-6 rounded border border-base-300 cursor-pointer svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-12 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),JD=(n,e)=>e(),QD=fe('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add More TRIX"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More TRIX</button></div></div>'),ej=(n,e,t)=>e(s(t).id),tj=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove BIAS"><span class="text-xs svelte-fy2ox8">×</span></button>'),nj=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Period:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Color:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Width:</span> <select class="select select-bordered select-xs w-12 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option></select></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-14 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div></div>'),oj=fe('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More BIAS"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add BIAS</span></button></div></div>'),sj=(n,e,t)=>e(s(t).id),ij=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove CCI"><span class="text-xs svelte-fy2ox8">×</span></button>'),rj=fe('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Period:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Color:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Width:</span> <select class="select select-bordered select-xs w-12 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option></select></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-14 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div></div>'),aj=fe('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More CCI"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add CCI</span></button></div></div>'),lj=fe('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Ichimoku"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),cj=fe('<div class="grid grid-cols-1 sm:grid-cols-[1.4fr_0.8fr_0.8fr_0.8fr_0.9fr] gap-3 items-center px-1 py-2 border-b border-base-200 last:border-b-0 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><div class="w-4 h-4 rounded-full border border-base-300 svelte-fy2ox8"></div> <span class="text-sm font-medium text-base-content svelte-fy2ox8"> </span></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Period</span> <input type="number" class="input input-bordered input-sm w-24 text-center svelte-fy2ox8" min="1" max="200"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Color</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-5 h-5 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Thickness</span> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Style</span> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),dj=fe('<div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-sm sm:text-base font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="hidden sm:grid grid-cols-[1.4fr_0.8fr_0.8fr_0.8fr_0.9fr] gap-3 text-xs text-base-content/60 px-1 svelte-fy2ox8"><div class="svelte-fy2ox8">Component</div> <div class="svelte-fy2ox8">Period</div> <div class="svelte-fy2ox8">Color</div> <div class="svelte-fy2ox8">Thickness</div> <div class="svelte-fy2ox8">Style</div></div> <!></div>'),uj=fe('<div class="mt-3 sm:mt-5 svelte-fy2ox8"><div class="border border-base-300 rounded-lg p-4 bg-base-50/50 svelte-fy2ox8"><div class="flex items-center gap-3 mb-6 pb-4 border-b border-base-200 svelte-fy2ox8"><div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center svelte-fy2ox8"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" class="svelte-fy2ox8"></path></svg></div> <div class="svelte-fy2ox8"><h3 class="text-lg font-semibold text-base-content svelte-fy2ox8">Ichimoku Kinko Hyo</h3> <p class="text-sm text-base-content/60 svelte-fy2ox8">Complete cloud indicator with all components</p></div></div> <div class="space-y-6 svelte-fy2ox8"></div> <div class="flex justify-center pt-4 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add Ichimoku"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Ichimoku</span></button></div> <div class="mt-6 pt-4 border-t border-base-200 svelte-fy2ox8"><div class="text-xs text-base-content/60 space-y-1 svelte-fy2ox8"><p class="svelte-fy2ox8"><strong class="svelte-fy2ox8">Components:</strong> Tenkan Sen (Conversion), Kijun Sen (Base), Senkou Span A & B (Cloud)</p> <p class="svelte-fy2ox8"><strong class="svelte-fy2ox8">Usage:</strong> Trend direction, support/resistance levels, and momentum analysis</p></div></div></div></div>'),pj=fe('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete SMA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),vj=fe('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),fj=fe('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),mj=fe('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add SMA</button></div>'),gj=fe('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),hj=(n,e)=>e(),_j=fe('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete MA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),yj=fe('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),bj=(n,e)=>e(),xj=(n,e)=>e(),wj=fe('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),kj=fe('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <!></div>'),Sj=fe('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more MA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add MA</button></div>'),Cj=fe('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),Pj=(n,e,t)=>e(s(t).id),Ij=fe('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove ROC"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Mj=fe('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Period</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),Aj=fe('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more ROC"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More ROC</button></div></div>'),Tj=(n,e,t)=>e(s(t).id),Lj=fe('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove PSY"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Fj=fe('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 1 (PSY Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">PSY Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 2 (MAPSY Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAPSY Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex items-center gap-2 pt-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm svelte-fy2ox8"> <label class="text-sm text-base-content/80 cursor-pointer svelte-fy2ox8">Show MAPSY</label></div></div></div>'),$j=fe('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more PSY"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More PSY</button></div></div>'),Ej=(n,e,t)=>e(s(t).id),Nj=fe('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove OBV"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Dj=fe('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8" style="display: none;"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 1 (OBV Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">OBV Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAOBV Period</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"> <span class="text-xs text-base-content/50 svelte-fy2ox8">Moving average period for OBV smoothing</span></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAOBV Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div></div>'),jj=fe('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more OBV"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More OBV</button></div></div>'),Rj=(n,e,t)=>e(s(t).id),Bj=fe('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove KDJ"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Oj=fe('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">K Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">D Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">K Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">K:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">D Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">D:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">J Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">J:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),zj=fe('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more KDJ"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More KDJ</button></div></div>'),Vj=(n,e)=>e("band"),Wj=(n,e)=>e("slLong"),qj=(n,e)=>e("slShort"),Hj=(n,e)=>e("median"),Uj=fe('<div class="space-y-4 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Outcome Band</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Band:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Fill Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Stop Lines</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Stops:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long SL Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short SL Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Median Path</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">EV Table</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Table:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div></div></div>'),Gj=(n,e)=>e("fill",0),Yj=(n,e)=>e("upper",0),Kj=(n,e)=>e("middle",0),Zj=(n,e)=>e("lower",0),Xj=(n,e)=>e(0),Jj=fe('<button class="btn btn-xs btn-outline btn-error gap-1 text-xs svelte-fy2ox8" title="Remove BOLL 1"><svg class="w-3 h-3 svelte-fy2ox8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg> Remove BOLL 1</button>'),Qj=(n,e,t)=>e(s(t)),eR=(n,e,t)=>e("fill",s(t)),tR=(n,e,t)=>e("upper",s(t)),nR=(n,e,t)=>e("middle",s(t)),oR=(n,e,t)=>e("lower",s(t)),sR=fe('<div class="bg-base-50 border border-primary/20 rounded-md p-3 space-y-3 mt-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-semibold text-primary svelte-fy2ox8"> </h4> <button class="btn btn-xs btn-ghost text-error svelte-fy2ox8"><svg class="w-3.5 h-3.5 svelte-fy2ox8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="200"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Standard Deviation</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Fill Area</h5> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Fill Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Line Colors</h5> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Upper Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Middle Line (SMA)</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Lower Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Line Style</h5> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),iR=fe('<div class="space-y-4 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Parameters</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="200"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Standard Deviation</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Fill Area Settings</h4> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Fill Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"> <div class="flex justify-between text-xs text-base-content/50 svelte-fy2ox8"><span class="svelte-fy2ox8">0%</span> <span class="svelte-fy2ox8">50%</span> <span class="svelte-fy2ox8">100%</span></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Line Colors</h4> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Upper Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Middle Line (SMA)</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Lower Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Line Style</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex justify-center gap-2 pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more BOLL"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More BOLL</button> <!></div> <!></div>'),rR=fe('<div class="flex justify-center items-center min-h-[120px] svelte-fy2ox8"><div class="text-base-content/70 svelte-fy2ox8"> </div></div>'),aR=fe('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),lR=fe('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),cR=fe('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-16 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),dR=fe('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg></button></div>'),uR=fe('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),pR=fe('<div class="ai-branding-container svelte-fy2ox8"><div class="ai-branding-badge svelte-fy2ox8"><svg class="ai-branding-icon svelte-fy2ox8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-fy2ox8"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-fy2ox8"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-fy2ox8"></line></svg> <div class="ai-branding-text svelte-fy2ox8"><div class="ai-branding-main svelte-fy2ox8">Duty AI Algorithm Included</div> <div class="ai-branding-sub svelte-fy2ox8">Powered by Duty AI</div></div> <div class="ai-branding-glow svelte-fy2ox8"></div></div></div>'),vR=fe('<div class="responsive-modal-content svelte-fy2ox8"><!> <!></div>'),fR=fe("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function mR(n,e){gd(e,!0);const t=wp(),o=()=>ya(d,"$chart",t),i=()=>ya(l,"$ctx",t),r=()=>ya(c,"$save",t);let a=Ws(e,"show",15);const l=Kc("ctx"),c=Kc("save"),d=Kc("chart");let p=N([]),m=N([]),h=N([]);function _(b){const k=(b||"").trim();if(!k)return null;if(/^#?[0-9A-Fa-f]{6}$/.test(k)){const A=k.startsWith("#")?k.slice(1):k;return{r:parseInt(A.slice(0,2),16),g:parseInt(A.slice(2,4),16),b:parseInt(A.slice(4,6),16)}}const T=k.match(/^rgba?\(([^)]+)\)$/i);if(T){const A=T[1].split(",").map($=>parseFloat($.trim()));if(A.length>=3&&A.every($=>!isNaN($)))return{r:Math.round(A[0]),g:Math.round(A[1]),b:Math.round(A[2])}}return null}function w(b,k){const T=_(b);if(!T)return b;const A=Math.max(0,Math.min(100,k))/100;return`rgba(${T.r}, ${T.g}, ${T.b}, ${A})`}let S=ae("#2196F3"),P=ae(5),I=ae("#f23645"),C=ae("#2962ff"),M=ae("#089981"),F=ae(1),V=ae("solid"),j=ae(20),D=ae(2),R=ae(!1),W=ae(N({x:0,y:0})),J=ae(0),Z=ae("macdLine"),G=ae(!1),se=ae(N({x:0,y:0})),Y=ae(0),oe=ae(!1),ee=ae(N({x:0,y:0})),re=ae(0),me=ae("diPlus"),K=ae(!1),ye=ae(N({x:0,y:0})),Me=ae(!1),Fe=ae(N({x:0,y:0})),Ze=ae(!1),Ge=ae(N({x:0,y:0})),it=ae(0),Ye=ae(!1),ct=ae(N({x:0,y:0})),kt=ae(0),ft=ae(!1),bt=ae(N({x:0,y:0})),nt=ae(N([])),Pt=ae(!1),Qe=ae(N({x:0,y:0})),yt=ae(0),xe=ae("histogram"),Ve=ae(!1),Je=ae(N({x:0,y:0})),St=ae(!1),Ne=ae(N({x:0,y:0})),ue=ae(!1),he=ae(N({x:0,y:0})),_t=ae(!1),Wt=ae(N({x:0,y:0})),jt=ae(0),Zt=ae(!1),dn=ae(N({x:0,y:0})),zn=ae(0),un=ae("vr"),On=ae(!1),no=ae(N({x:0,y:0})),fs=ae(0),ps=ae(!1),So=ae(N({x:0,y:0})),Es=ae(0),Qo=ae(!1),Ko=ae(N({x:0,y:0})),oo=ae(0),Gs=ae(!1),jo=ae(N({x:0,y:0})),fi=ae(!1),ba=ae(N({x:0,y:0})),xa=ae(0),Al=ae(!1),Qs=ae(N({x:0,y:0})),Fs=ae(0),Va=ae(!1),$r=N({x:0,y:0}),cd=ae(0),Sd=ae("uptrend"),Nl=ae(!1),dd=ae(N({x:0,y:0})),Cd=ae(0),fa=ae(!1),Dl=ae(N({x:0,y:0})),ml=ae(!1),gl=ae(N({x:0,y:0})),_d=ae(!1),Kl=ae(N({x:0,y:0})),ic=ae(0),od=ae(!1),zd=ae(N({x:0,y:0})),Ec=ae(0),al=ae("cr"),kc=ae(!1),Vd=ae(N({x:0,y:0})),sd=ae(!1),id=ae(N({x:0,y:0})),Pd=ae(!1),Ed=ae(N({x:0,y:0})),zl=ae(0),Gd=ae(!1),lu=ae(N({x:0,y:0})),Yd=ae(!1),eu=ae(N({x:0,y:0})),Ju=ae(!1),mu=N({x:0,y:0}),yd=ae(!1),tn=N({x:0,y:0}),En=ae(!1),go=ae(N({x:0,y:0})),hn=ae(!1),Ho=ae(N({x:0,y:0})),Eo=ae(!1),di=ae(N({x:0,y:0})),ns=ae(!1),$i=ae(N({x:0,y:0})),hi=ae(!1),li=ae(N({x:0,y:0})),ks=ae(!1),Vi=ae(N({x:0,y:0})),gs=ae(!1),ll=ae(N({x:0,y:0})),mi=ae(!1),Na=ae(N({x:0,y:0})),le=ae(!1),we=ae(N({x:0,y:0})),H=ae(1),ne=ae("solid"),_e=ae(1),q=ae("dashed"),De=ae(1),ot=ae("dashed"),je=ae(22),Ft=ae("#66c2a5"),Be=ae("#66c2a5"),xt=ae("#e67e22"),an=ae("#c0392b"),Yn=ae(!0),bn=ae(!0),be=ae(!0),tt=ae(!1),wt=ae(N({x:0,y:0})),Lt=ae(0),qt=ae(!1),qn=ae(N({x:0,y:0})),Xt=ae(0),vo=ae(0),To=ae(0),co=ae(!1),so=ae(N({x:0,y:0})),Jo=ae(0),Os=ae(!1),wr=ae(N({x:0,y:0})),ra=ae(0),Qr=ae(!1),hl=ae(N({x:0,y:0})),lc=ae(0),qr=ae(!1),Ga=ae(!1),Ki=ae(!1),Zl=ae(!1),Tl=ae(!1),Ya=ae(N({x:0,y:0})),ur=ae(0);function rc(b,k){if(o()){try{o().removeIndicator({paneId:b,name:k})}catch(T){console.log("Error removing indicator:",T)}c.update(T=>{const A=`${b}_${k}`;return delete T.saveInds[A],T})}}const zr=vt(()=>i().editIndName==="BOLL"),rd=vt(()=>i().editIndName==="MACD"),cc=vt(()=>i().editIndName==="BIAS"),dc=vt(()=>i().editIndName==="AO"),Er=vt(()=>i().editIndName==="WR"),Sc=vt(()=>i().editIndName==="VR"),ea=vt(()=>i().editIndName==="BBI"),Cc=vt(()=>i().editIndName==="EMA"),Ac=vt(()=>i().editIndName==="SMA"),cu=vt(()=>i().editIndName==="MA"),Id=vt(()=>i().editIndName==="ICHIMOKU"),Zc=vt(()=>i().editIndName==="PVT"),ce=vt(()=>i().editIndName==="VOL"),st=vt(()=>i().editIndName==="SAR"),ge=vt(()=>i().editIndName==="DMI"),Le=vt(()=>i().editIndName==="TRIX"),dt=vt(()=>i().editIndName==="ROC"),At=vt(()=>i().editIndName==="ZIGZAG"),pt=vt(()=>i().editIndName==="PSY"),at=vt(()=>i().editIndName==="OBV"),Ct=vt(()=>i().editIndName==="CR"),Re=vt(()=>i().editIndName==="NPO_MAE"),kn=vt(()=>i().editIndName==="KDJ"),ro=vt(()=>i().editIndName==="CCI"),uo=vt(()=>i().editIndName==="EMV"),hs=vt(()=>i().editIndName==="MTM"),Ei=vt(()=>i().editIndName==="RSI"),ei=vt(()=>i().editIndName==="STOCH"),Ys=vt(()=>i().editIndName==="SMARTTREND"),Ht=vt(()=>i().editIndName==="SMART_MONEY"),qe=vt(()=>i().editIndName==="TRAP_HUNTER"),fn=vt(()=>i().editIndName==="VOLCANIC"),Fn=vt(()=>i().editIndName==="VOLCANIC_SIG"),Vt=vt(()=>s(Ht)||s(qe)||s(fn)||s(Fn));function mn(){if(!(i().editIndName!=="TRAP_HUNTER"||!o()))try{const b=(p||[]).map(k=>Number(k));o().overrideIndicator({name:"TRAP_HUNTER",calcParams:b,paneId:i().editPaneId})}catch(b){console.error("❌ Error updating Trap Hunter:",b)}}function Kn(){if(!(i().editIndName!=="VOLCANIC"||!o()))try{const b=(p||[]).map(k=>Number(k));o().overrideIndicator({name:"VOLCANIC",calcParams:b,paneId:i().editPaneId})}catch(b){console.error("❌ Error updating VOLCANIC:",b)}}function Pn(){if(!(i().editIndName!=="VOLCANIC_SIG"||!o()))try{const b=(p||[]).map(k=>Number(k));o().overrideIndicator({name:"VOLCANIC_SIG",calcParams:b,paneId:i().editPaneId})}catch(b){console.error("❌ Error updating VOLCANIC_SIG:",b)}}let Hn=ae("");mr(()=>{if(!s(fn))return;const b=JSON.stringify(p??[]);b!==s(Hn)&&(x(Hn,N(b)),Kn())});let No=ae("");mr(()=>{if(!s(Fn))return;const b=JSON.stringify(p??[]);b!==s(No)&&(x(No,N(b)),Pn())});const Mo=vt(()=>i().editIndName==="SMARTTREND"?"Smart Trend":i().editIndName);let qs=ae("#2962FF"),ta=ae(2),Nc=ae("solid"),Tc=ae(26),Sl=ae(10),Ks=ae(20),ci=ae(40),Lo=ae(60),ln=N({zoneLookbackBars:40,minZoneBars:5,maxZoneBars:25,atrPeriod:14,volumeMAPeriod:20,minVolumeFactor:1.2,maxZoneWidthPct:.03,priorTrendLookback:20,minOBVTrendStrength:.2,minZoneScore:.6,mergeNearbyZones:!0,maxZonesDisplayed:20,showLabels:!0});function or(){if(!s(Ht)||!Array.isArray(p))return;const b=p;ln.zoneLookbackBars=Number(b[0]??ln.zoneLookbackBars),ln.minZoneBars=Number(b[1]??ln.minZoneBars),ln.maxZoneBars=Number(b[2]??ln.maxZoneBars),ln.atrPeriod=Number(b[3]??ln.atrPeriod),ln.volumeMAPeriod=Number(b[4]??ln.volumeMAPeriod),ln.minVolumeFactor=Number(b[5]??ln.minVolumeFactor),ln.maxZoneWidthPct=Number(b[6]??ln.maxZoneWidthPct),ln.priorTrendLookback=Number(b[7]??ln.priorTrendLookback),ln.minOBVTrendStrength=Number(b[8]??ln.minOBVTrendStrength),ln.minZoneScore=Number(b[9]??ln.minZoneScore),ln.mergeNearbyZones=Number(b[10]??(ln.mergeNearbyZones?1:0))>0,ln.maxZonesDisplayed=Number(b[11]??ln.maxZonesDisplayed),ln.showLabels=Number(b[12]??(ln.showLabels?1:0))>0}mr(()=>{s(Ht)&&or()});function tr(){var k;const b=[ln.zoneLookbackBars,ln.minZoneBars,ln.maxZoneBars,ln.atrPeriod,ln.volumeMAPeriod,ln.minVolumeFactor,ln.maxZoneWidthPct,ln.priorTrendLookback,ln.minOBVTrendStrength,ln.minZoneScore,ln.mergeNearbyZones?1:0,ln.maxZonesDisplayed,ln.showLabels?1:0];(k=o())==null||k.overrideIndicator({name:"SMART_MONEY",calcParams:b,paneId:i().editPaneId}),c.update(T=>(T.saveInds[`${i().editPaneId}_SMART_MONEY`]={name:"SMART_MONEY",params:b,pane_id:i().editPaneId},T))}let Zi=ae("#FF6B35"),Yt=ae("#2196F3"),Xo=ae("#4CAF50"),as=ae("#FF9800"),Pi=ae("#9C27B0"),As=ae(2),Xs=ae(1),Hr=ae(1),Xl=ae(1),Nd=ae(1),Ru=ae("solid"),Xc=ae("solid"),Vl=ae("solid"),_l=ae("solid"),Et=ae("solid");mr(()=>{s(dt)&&!s(Ro)?(console.log("🎯 ROC modal opened, initializing..."),x(Ro,!0),na(),setTimeout(()=>{cl()},100)):!s(dt)&&s(Ro)&&x(Ro,!1)});let Nn=ae(!1),pn=ae(!1);mr(()=>{s(Ei)&&!s(Nn)?(console.log("🎯 RSI modal opened, initializing..."),x(Nn,!0),Fp()):!s(Ei)&&s(Nn)&&x(Nn,!1)}),mr(()=>{s(ei)&&!s(pn)?(console.log("🎯 Stochastic modal opened, initializing..."),x(pn,!0),Kt()):!s(ei)&&s(pn)&&x(pn,!1)}),mr(()=>{s(Le)&&!s(vn)?(console.log("🎯 TRIX modal opened, initializing..."),x(vn,!0),Fc()):!s(Le)&&s(vn)&&x(vn,!1)});let os=ae(!1);mr(()=>{s(Ac)&&!s(os)?(console.log("🎯 SMA modal opened, initializing..."),x(os,!0),Dd()):!s(Ac)&&s(os)&&x(os,!1)});let Ps=ae(!1);mr(()=>{s(Sc)&&!s(Ps)?(console.log("🎯 VR modal opened, initializing..."),x(Ps,!0),Da()):!s(Sc)&&s(Ps)&&x(Ps,!1)});let sr=ae(!1);mr(()=>{s(ce)&&!s(sr)?(console.log("🎯 Volume modal opened, initializing..."),x(sr,!0),Oo()):!s(ce)&&s(sr)&&x(sr,!1)});let Cl=ae(!1);mr(()=>{s(ea)&&!s(Cl)?(console.log("🎯 BBI modal opened, initializing..."),x(Cl,!0),Kd()):!s(ea)&&s(Cl)&&x(Cl,!1)}),mr(()=>{s(ea)&&s(Cl)&&o()&&s(B).forEach((b,k)=>{const{period1:T,period2:A,period3:$,period4:E,color:Q,thickness:ie,lineStyle:Pe}=b;if(T&&A&&$&&E&&Q&&ie&&Pe){const rt=setTimeout(()=>{ir(k)},100);return()=>clearTimeout(rt)}})});let Lc=ae(!1);mr(()=>{s(zr)&&!s(Lc)?(console.log("🎯 Bollinger Bands modal opened, initializing..."),x(Lc,!0),ji()):!s(zr)&&s(Lc)&&x(Lc,!1)}),mr(()=>{if(s(zr)&&s(Lc)&&o()){const b=s(j),k=s(D),T=s(S),A=s(P),$=s(I),E=s(C),Q=s(M),ie=s(F),Pe=s(V);if(b&&k&&T&&$&&E&&Q&&ie&&Pe){const rt=setTimeout(()=>{s(de).length===0?x(de,N([{id:zi(),paneId:i().editPaneId||"candle_pane",period:b,stdDev:k,styles:{fillColor:T,fillOpacity:A,upperColor:$,middleColor:E,lowerColor:Q,thickness:ie,lineStyle:Pe}}])):(s(de)[0].period=b,s(de)[0].stdDev=k,s(de)[0].styles.fillColor=T,s(de)[0].styles.fillOpacity=A,s(de)[0].styles.upperColor=$,s(de)[0].styles.middleColor=E,s(de)[0].styles.lowerColor=Q,s(de)[0].styles.thickness=ie,s(de)[0].styles.lineStyle=Pe),jn()},100);return()=>clearTimeout(rt)}}});let cp=ae(!1);mr(()=>{s(st)&&!s(cp)?(console.log("🎯 SAR modal opened, initializing..."),x(cp,!0),tu()):!s(st)&&s(cp)&&x(cp,!1)}),mr(()=>{s(st)&&s(cp)&&o()&&s(ms).forEach((b,k)=>{const{start:T,increment:A,maxValue:$,color:E,dotSize:Q}=b;if(T!==void 0&&A!==void 0&&$!==void 0&&E&&Q){const ie=setTimeout(()=>{yv(k)},100);return()=>clearTimeout(ie)}})});let qp=ae(!1);mr(()=>{s(dc)&&!s(qp)?(console.log("🎯 AO modal opened, initializing..."),x(qp,!0),Sr()):!s(dc)&&s(qp)&&x(qp,!1)}),mr(()=>{s(dc)&&s(qp)&&o()&&s(Oc).forEach((b,k)=>{const{shortPeriod:T,longPeriod:A,styles:$}=b;if(T&&A&&$){const E=setTimeout(()=>{Jc()},100);return()=>clearTimeout(E)}})});let Wd=ae(!1);mr(()=>{s(cc)&&!s(Wd)?(console.log("🎯 BIAS modal opened, initializing..."),x(Wd,!0),ku()):!s(cc)&&s(Wd)&&x(Wd,!1)}),mr(()=>{s(cc)&&s(Wd)&&o()&&s(Un).forEach((b,k)=>{const{period:T,color:A,thickness:$,lineStyle:E}=b;if(T&&A&&$&&E){const Q=setTimeout(()=>{Md()},100);return()=>clearTimeout(Q)}})});let kp=ae(!1);mr(()=>{s(hs)&&!s(kp)?(console.log("🎯 MTM modal opened, initializing..."),x(kp,!0),Wn()):!s(hs)&&s(kp)&&x(kp,!1)}),mr(()=>{s(hs)&&s(kp)&&o()&&s(Ds).forEach((b,k)=>{const{period:T,color:A,thickness:$,lineStyle:E}=b;if(T&&A&&$&&E){const Q=setTimeout(()=>{Bo()},100);return()=>clearTimeout(Q)}})});let Ov=ae(!1),Lv=ae(!1);mr(()=>{s(at)&&!s(Ov)?(console.log("🎯 OBV modal opened, initializing..."),x(Ov,!0),pd()):!s(at)&&s(Ov)&&x(Ov,!1)}),mr(()=>{if(s(Lv)){console.log("⏸️ Skipping OBV effect - removal in progress");return}s(at)&&s(Ov)&&o()&&s(rn).forEach((b,k)=>{const{obvPeriod:T,maobvPeriod:A,showMaobv:$,styles:E}=b;if(T&&A&&E){const Q=setTimeout(()=>{rr()},100);return()=>clearTimeout(Q)}})});let zv=ae(!1);mr(()=>{s(ro)&&!s(zv)?(console.log("🎯 CCI modal opened, initializing..."),x(zv,!0),$p()):!s(ro)&&s(zv)&&x(zv,!1)}),mr(()=>{s(ro)&&s(zv)&&o()&&s(Bn).forEach((b,k)=>{const{period:T,color:A,thickness:$,lineStyle:E}=b;if(T&&A&&$&&E){const Q=setTimeout(()=>{hp()},100);return()=>clearTimeout(Q)}})});let Vv=ae(!1);mr(()=>{s(Ct)&&!s(Vv)?(console.log("🎯 CR modal opened, initializing..."),x(Vv,!0),ve()):!s(Ct)&&s(Vv)&&x(Vv,!1)}),mr(()=>{s(Ct)&&s(Vv)&&o()&&s(Is).forEach((b,k)=>{const{crPeriod:T,crMa1Period:A,crMa2Period:$,crMa3Period:E,crMa4Period:Q,styles:ie}=b;if(T&&A&&$&&E&&Q&&ie){const Pe=setTimeout(()=>{js()},100);return()=>clearTimeout(Pe)}})});let ud=ae(!1);mr(()=>{s(ge)&&!s(ud)?(console.log("🎯 DMI modal opened, initializing..."),x(ud,!0),du()):!s(ge)&&s(ud)&&x(ud,!1)}),mr(()=>{s(ge)&&s(ud)&&o()&&s(Yo).forEach((b,k)=>{const{diPeriod:T,adxPeriod:A,styles:$}=b;if(T&&A&&$){const E=setTimeout(()=>{Bt()},100);return()=>clearTimeout(E)}})}),mr(()=>{s(Sc)&&s(Ps)&&o()&&s(qd).forEach((b,k)=>{const{period:T,shortPeriod:A,longPeriod:$,styles:E}=b;if(T&&A&&$&&E){const Q=setTimeout(()=>{wo(k)},100);return()=>clearTimeout(Q)}})}),mr(()=>{s(rd)&&o()&&s(Rc).length>0&&s(Rc).forEach((b,k)=>{const{fastPeriod:T,slowPeriod:A,signalPeriod:$,styles:E}=b;if(T&&A&&$&&E){const Q=setTimeout(()=>{oi(k)},100);return()=>clearTimeout(Q)}})});let Rc=ae(N([])),Bc=ae(N([])),qd=ae(N([])),Oc=ae(N([])),B=ae(N([])),de=ae(N([])),Oe=ae(0),Ue=ae(N([])),mt=ae(0);function _n(b){x(mt,N(b)),x(jo,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(Gs,!0)}function en(){if(!o())return;const b=i().editPaneId||"candle_pane";for(let k=0;k<6;(k+=1)-1)try{o().removeIndicator({paneId:b,name:"ZIGZAG"})}catch{}s(Ue).forEach((k,T)=>{const A=k.styles.lineStyle==="solid"?Ke.Solid:Ke.Dashed,$=k.styles.lineStyle==="dashed"?[4,4]:k.styles.lineStyle==="dotted"?[2,6]:[2,2],E={lines:[{color:k.styles.color,size:k.styles.thickness,style:A,dashedValue:$,smooth:!1}]};o().createIndicator({name:"ZIGZAG",calcParams:[k.deviation,k.depth],styles:E},!0,{id:b});const Q=T===0?`${b}_ZIGZAG`:`${b}_ZIGZAG_${T+1}`;c.update(ie=>(ie.saveInds[Q]={name:"ZIGZAG",pane_id:b,params:[k.deviation,k.depth],styles:E},ie))}),c.update(k=>{const T=`${b}_ZIGZAG`;return Object.keys(k.saveInds).filter($=>$.startsWith(T)).forEach($=>{const E=$.match(/_ZIGZAG(?:_(\d+))?$/);(E&&E[1]?parseInt(E[1],10):1)>s(Ue).length&&delete k.saveInds[$]}),k})}function Vn(b,k){x(Oe,N(k));const T={x:window.innerWidth/2,y:window.innerHeight/2};b==="fill"&&(x(Ho,N(T)),x(hn,!0)),b==="upper"&&(x(di,N(T)),x(Eo,!0)),b==="middle"&&(x($i,N(T)),x(ns,!0)),b==="lower"&&(x(li,N(T)),x(hi,!0))}function Rn(){return window.__npoMaeApi}function xo(b){const k={x:window.innerWidth/2,y:window.innerHeight/2};b==="median"&&(x(Vi,N(k)),x(ks,!0)),b==="band"&&(x(ll,N(k)),x(gs,!0)),b==="slLong"&&(x(Na,N(k)),x(mi,!0)),b==="slShort"&&(x(we,N(k)),x(le,!0))}function Dn(){const b=Rn();if(!b)return;b.updateSettings({bandAlpha:Math.max(0,Math.min(100,s(je)))/100});const k=w(s(Ft),s(je));b.setColors({band:k})}let ys=ae(!1);mr(()=>{var b,k;if(!(!s(Re)||s(ys)||!o()))try{const A=(((k=(b=o()).getOverlays)==null?void 0:k.call(b))??[]).find(ie=>(ie==null?void 0:ie.name)==="NearestPatternOutcomeMaeStop"),$=(A==null?void 0:A.extendData)||{},E=$.colors||{};E.median&&x(Be,N(E.median)),E.band&&x(Ft,N(E.band)),E.slLong&&x(xt,N(E.slLong)),E.slShort&&x(an,N(E.slShort)),typeof $.showOutcomeBand=="boolean"&&x(Yn,N($.showOutcomeBand)),typeof $.showStopLines=="boolean"&&x(bn,N($.showStopLines)),typeof $.showTable=="boolean"&&x(be,N($.showTable));const Q=$.styles||{};Q.median&&(typeof Q.median.size=="number"&&x(H,N(Q.median.size)),typeof Q.median.style=="string"&&x(ne,N(Q.median.style))),Q.slLong&&(typeof Q.slLong.size=="number"&&x(_e,N(Q.slLong.size)),typeof Q.slLong.style=="string"&&x(q,N(Q.slLong.style))),Q.slShort&&(typeof Q.slShort.size=="number"&&x(De,N(Q.slShort.size)),typeof Q.slShort.style=="string"&&x(ot,N(Q.slShort.style))),typeof $.bandAlpha=="number"&&x(je,N(Math.round(($.bandAlpha||0)*100))),x(ys,!0)}catch{}});function jn(){if(!o())return;const b=i().editPaneId||"candle_pane";for(let k=0;k<6;(k+=1)-1)try{o().removeIndicator({paneId:b,name:"BOLL"})}catch{}s(de).forEach((k,T)=>{const A=k.styles.lineStyle==="solid"?Ke.Solid:Ke.Dashed,$=k.styles.lineStyle==="dashed"?[4,4]:[0,0],E={lines:[{color:k.styles.upperColor,size:k.styles.thickness,style:A,dashedValue:$},{color:k.styles.middleColor,size:k.styles.thickness,style:A,dashedValue:$},{color:k.styles.lowerColor,size:k.styles.thickness,style:A,dashedValue:$}],fill:{color:k.styles.fillColor,opacity:(k.styles.fillOpacity||0)/100}};o().createIndicator({name:"BOLL",calcParams:[k.period,k.stdDev],styles:E},!0,{id:b});const Q=T===0?`${b}_BOLL`:`${b}_BOLL_${T+1}`;c.update(ie=>(ie.saveInds[Q]={name:"BOLL",pane_id:b,params:[k.period,k.stdDev],bollingerStyles:{fillColor:k.styles.fillColor,fillOpacity:k.styles.fillOpacity,upperColor:k.styles.upperColor,middleColor:k.styles.middleColor,lowerColor:k.styles.lowerColor,thickness:k.styles.thickness,lineStyle:k.styles.lineStyle}},ie))}),c.update(k=>{const T=`${b}_BOLL`;return Object.keys(k.saveInds).filter($=>$.startsWith(T)).forEach($=>{const E=$.match(/_BOLL(?:_(\d+))?$/);(E&&E[1]?parseInt(E[1],10):1)>s(de).length&&delete k.saveInds[$]}),k})}function Sn(b){if(s(de).length<=1)return;x(de,N(s(de).filter((T,A)=>A!==b)));const k=s(de)[0];k&&(x(j,N(k.period)),x(D,N(k.stdDev)),x(S,N(k.styles.fillColor)),x(P,N(k.styles.fillOpacity)),x(I,N(k.styles.upperColor)),x(C,N(k.styles.middleColor)),x(M,N(k.styles.lowerColor)),x(F,N(k.styles.thickness)),x(V,N(k.styles.lineStyle))),jn()}let Un=ae(N([])),$n=ae(N([])),ms=ae(N([])),Wo=ae(N([])),Yo=ae(N([])),Po=ae(N([])),Is=ae(N([])),An=ae(N([])),Ro=ae(!1),vn=ae(!1),on=ae(N([])),rn=ae(N([])),fo=ae(N([])),Bn=ae(N([]));function Io(){x(Bn,N([])),console.log("✅ CCI groups cleared from modal state")}let Gn=ae(N([]));function ti(){x(Gn,N([])),console.log("✅ EMV groups cleared from modal state")}let Ds=ae(N([]));function bi(){x(Ds,N([])),console.log("✅ MTM groups cleared from modal state")}function yl(){x(rn,N([])),console.log("✅ OBV groups cleared from modal state")}function uc(){x(on,N([])),console.log("✅ PSY groups cleared from modal state")}let kr=ae(N([]));function Ka(){x(kr,N([])),console.log("✅ PVT groups cleared from modal state")}function ni(){x(nt,N([])),console.log("✅ VOL groups cleared from modal state")}function Ca(){x(Bc,N([])),console.log("✅ WR groups cleared from modal state")}function wa(){if(!s(Zc))return;const b=`${i().editPaneId}_PVT`,k=r().saveInds[b];k&&k.pvtGroups&&k.pvtGroups.length>0?x(kr,N([...k.pvtGroups])):s(kr).length===0&&x(kr,N([{id:zi(),name:"PVT #1",color:"#2563eb",thickness:1,lineStyle:"solid"}]))}function Pa(){var k;if(!s(Zc))return;const b={id:zi(),name:`PVT #${s(kr).length+1}`,color:"#2563eb",thickness:1,lineStyle:"solid"};if(s(kr).push(b),o()){let T=Ke.Solid,A=[2,2];b.lineStyle==="dashed"?(T=Ke.Dashed,A=[4,4]):b.lineStyle==="dotted"&&(T=Ke.Dashed,A=[2,2]);const $={lines:[{color:b.color,size:b.thickness,style:T,dashedValue:A}]},E=(k=o())==null?void 0:k.createIndicator({name:"PVT",styles:$,figures:[{key:"pvt",title:"PVT: ",type:"line"}]},!1);console.log("✅ Created PVT indicator on pane:",E),E&&c.update(Q=>{const ie=`${E}_PVT`;return Q.saveInds[ie]||(Q.saveInds[ie]={name:"PVT",pane_id:E,pvtGroups:[]}),Q.saveInds[ie].pvtGroups||(Q.saveInds[ie].pvtGroups=[]),Q.saveInds[ie].pvtGroups.push({...b}),console.log("💾 Saved new PVT group to storage:",ie,b),Q})}console.log("➕ Added new PVT group:",b.name,"ID:",b.id)}function Jl(b){var T,A;if(!s(Zc)||s(kr).length<=1||b<0||b>=s(kr).length)return;console.log("🗑️ Removing PVT group at index:",b);const k=s(kr).length;if(s(kr)[b],s(kr).splice(b,1),console.log(`📝 Removed group: ${k} -> ${s(kr).length}`),s(kr).forEach(($,E)=>{$.name=`PVT #${E+1}`}),o())try{const E=((T=o())==null?void 0:T.getIndicators()).filter(Q=>Q.name==="PVT");console.log("📈 PVT indicators found:",E.length);for(const Q of E)console.log("🗑️ Removing PVT from pane:",Q.paneId),(A=o())==null||A.removeIndicator({paneId:Q.paneId,name:"PVT"});s(kr).forEach((Q,ie)=>{var Gt;let Pe=Ke.Solid,rt=[2,2];Q.lineStyle==="dashed"?(Pe=Ke.Dashed,rt=[4,4]):Q.lineStyle==="dotted"&&(Pe=Ke.Dashed,rt=[2,2]);const gn={lines:[{color:Q.color,size:Q.thickness,style:Pe,dashedValue:rt}]};console.log("➕ Re-adding PVT group:",Q.name,"at index:",ie);const cn=(Gt=o())==null?void 0:Gt.createIndicator({name:"PVT",styles:gn,figures:[{key:"pvt",title:"PVT: ",type:"line"}]},!1);cn&&c.update(eo=>{const Ss=`${cn}_PVT`;return eo.saveInds[Ss]||(eo.saveInds[Ss]={name:"PVT",pane_id:cn,pvtGroups:[]}),eo.saveInds[Ss].pvtGroups||(eo.saveInds[Ss].pvtGroups=[]),eo.saveInds[Ss].pvtGroups[ie]={...Q},eo})}),console.log("✅ Successfully updated PVT indicators on chart")}catch($){console.error("❌ Error updating PVT indicators:",$)}console.log("✅ PVT group removed. Remaining groups:",s(kr).length)}function bd(){x(An,N([])),console.log("✅ ROC groups cleared from modal state")}let Fo=ae(N([]));function Ql(){x(Fo,N([])),console.log("✅ RSI groups cleared from modal state")}function Dc(){const b=new Set,k=o();if(!(k!=null&&k.getIndicators))return b;try{k.getIndicators().forEach(A=>{(A==null?void 0:A.name)==="RSI"&&(A!=null&&A.paneId)&&b.add(A.paneId)})}catch(T){console.warn("⚠️ Failed to read RSI pane IDs from chart:",T)}return b}function Ee(b,k){const T=Dc();for(const A of T)if(!b.has(A))return A;return k}function ac(b){const k="pane_RSI";if(!b.has(k))return k;let T=2;for(;b.has(`${k}_${T}`)&&T<1e3;)T+=1;if(!b.has(`${k}_${T}`))return`${k}_${T}`;let A=`${k}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;for(;b.has(A);)A=`${k}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;return A}function Ia(b,k={}){return{...b,...k,styles:{...b.styles,rsi:{...b.styles.rsi}}}}function Pc(b){var $,E,Q;if(!b||b.name!=="RSI")return null;const k=Array.isArray(b.rsiGroups)&&b.rsiGroups.length>0?b.rsiGroups[0]:null;if(!k)return null;const T=k.actualPaneId||k.paneId||b.pane_id,A=k.styles||{};return{id:k.id||zi(),period:k.period??(Array.isArray(b.params)?b.params[0]:14),overboughtLevel:k.overboughtLevel??70,middleLevel:k.middleLevel??50,oversoldLevel:k.oversoldLevel??30,fillOpacity:k.fillOpacity??.15,paneId:T||b.pane_id,actualPaneId:T||b.pane_id,styles:{rsi:{color:(($=A.rsi)==null?void 0:$.color)??"#8B5CF6",thickness:((E=A.rsi)==null?void 0:E.thickness)??2,lineStyle:((Q=A.rsi)==null?void 0:Q.lineStyle)??"solid"},overboughtColor:A.overboughtColor??"#EF4444",overboughtThickness:A.overboughtThickness??1,overboughtLineStyle:A.overboughtLineStyle??"dashed",oversoldColor:A.oversoldColor??"#22C55E",oversoldThickness:A.oversoldThickness??1,oversoldLineStyle:A.oversoldLineStyle??"dashed",middleLineColor:A.middleLineColor??"#6B7280",middleLineThickness:A.middleLineThickness??1,middleLineStyle:A.middleLineStyle??"dashed"}}}function Xi(){const b=new Map;Object.values(r().saveInds||{}).forEach(T=>{if(!T||T.name!=="RSI")return;const A=Pc(T);A!=null&&A.actualPaneId&&!b.has(A.actualPaneId)&&b.set(A.actualPaneId,A)});const k=Array.from(b.values());return i().editPaneId&&k.sort((T,A)=>T.actualPaneId===i().editPaneId?-1:A.actualPaneId===i().editPaneId?1:(T.actualPaneId||"").localeCompare(A.actualPaneId||"")),k}function aa(){if(!s(Ei))return;const b=s(Fo).map(k=>{const T=k.actualPaneId||k.paneId||i().editPaneId;return Ia(k,{paneId:T,actualPaneId:T})});c.update(k=>(Object.keys(k.saveInds||{}).forEach(T=>{var A;((A=k.saveInds[T])==null?void 0:A.name)==="RSI"&&delete k.saveInds[T]}),b.forEach(T=>{const A=T.actualPaneId;if(!A)return;const $=`${A}_RSI`;k.saveInds[$]={name:"RSI",pane_id:A,params:[T.period],rsiGroups:[Ia(T)]}}),k))}function Fp(){if(!s(Ei))return;const b=Xi(),k=Dc();if(k.size>0&&b.length<k.size){const T=[];if(k.forEach(A=>{try{const $=Pm.getInstance(A)||Pm.getInstanceConfig(A);if(!$)return;const E={id:zi(),period:$.period??14,overboughtLevel:$.overboughtLevel??70,middleLevel:$.middleLevel??50,oversoldLevel:$.oversoldLevel??30,fillOpacity:$.fillOpacity??.15,paneId:A,actualPaneId:A,styles:{rsi:{color:$.lineColor??"#8B5CF6",thickness:$.lineThickness??2,lineStyle:$.lineStyle??"solid"},overboughtColor:$.overboughtColor??"#EF4444",overboughtThickness:$.overboughtThickness??1,overboughtLineStyle:$.overboughtLineStyle??"dashed",oversoldColor:$.oversoldColor??"#22C55E",oversoldThickness:$.oversoldThickness??1,oversoldLineStyle:$.oversoldLineStyle??"dashed",middleLineColor:$.middleLineColor??"#6B7280",middleLineThickness:$.middleLineThickness??1,middleLineStyle:$.middleLineStyle??"dashed"}};T.push(E)}catch($){console.warn("⚠️ Failed to reconstruct RSI group from instance:",$)}}),T.length>0){x(Fo,N(T)),aa();return}}if(b.length>0){x(Fo,N(b)),aa();return}if(s(Fo).length===0){const T={id:zi(),period:14,overboughtLevel:70,middleLevel:50,oversoldLevel:30,fillOpacity:.15,paneId:i().editPaneId,actualPaneId:i().editPaneId,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed"}};x(Fo,N([T])),Pm.createInstance(T.actualPaneId,{period:T.period,lineColor:T.styles.rsi.color,lineThickness:T.styles.rsi.thickness,lineStyle:T.styles.rsi.lineStyle,overboughtLevel:T.overboughtLevel,oversoldLevel:T.oversoldLevel,middleLevel:T.middleLevel,overboughtColor:T.styles.overboughtColor,overboughtThickness:T.styles.overboughtThickness??1,overboughtLineStyle:T.styles.overboughtLineStyle||"dashed",oversoldColor:T.styles.oversoldColor,oversoldThickness:T.styles.oversoldThickness??1,oversoldLineStyle:T.styles.oversoldLineStyle||"dashed",overboughtFillColor:T.styles.overboughtColor,oversoldFillColor:T.styles.oversoldColor,middleLineColor:T.styles.middleLineColor,middleLineThickness:T.styles.middleLineThickness??1,middleLineStyle:T.styles.middleLineStyle||"dashed",fillOpacity:T.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:T.overboughtLevel,color:T.styles.overboughtColor,lineStyle:T.styles.overboughtLineStyle||"dashed",thickness:T.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:T.middleLevel,color:T.styles.middleLineColor,lineStyle:T.styles.middleLineStyle||"dashed",thickness:T.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:T.oversoldLevel,color:T.styles.oversoldColor,lineStyle:T.styles.oversoldLineStyle||"dashed",thickness:T.styles.oversoldThickness??1,label:"30",visible:!0}]}),aa()}}function ov(){if(!s(Ei))return;const b=Dc(),k=new Set(b);s(Fo).forEach(E=>{const Q=E.actualPaneId||E.paneId;Q&&k.add(Q)});const T=ac(k),A={id:zi(),period:14,overboughtLevel:70,middleLevel:50,oversoldLevel:30,fillOpacity:.15,paneId:T,actualPaneId:T,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed"}};s(Fo).push(A);let $=T;if(o()){const E=o(),Q=new Set(b);let ie=Ke.Solid,Pe=[2,2];A.styles.rsi.lineStyle==="dashed"?(ie=Ke.Dashed,Pe=[6,4]):A.styles.rsi.lineStyle==="dotted"&&(ie=Ke.Dashed,Pe=[2,2]);const rt=E.createIndicator({name:"RSI",calcParams:[A.period],styles:{lines:[{color:A.styles.rsi.color,size:A.styles.rsi.thickness,style:ie,dashedValue:Pe}]}},!1,{id:T,axis:{gap:{bottom:2}}});if($=Ee(Q,T),A.paneId=$,A.actualPaneId=$,Pm.createInstance($,{period:A.period,lineColor:A.styles.rsi.color,lineThickness:A.styles.rsi.thickness,lineStyle:A.styles.rsi.lineStyle,overboughtLevel:A.overboughtLevel,oversoldLevel:A.oversoldLevel,middleLevel:A.middleLevel,overboughtColor:A.styles.overboughtColor,overboughtThickness:A.styles.overboughtThickness??1,overboughtLineStyle:A.styles.overboughtLineStyle||"dashed",oversoldColor:A.styles.oversoldColor,oversoldThickness:A.styles.oversoldThickness??1,oversoldLineStyle:A.styles.oversoldLineStyle||"dashed",overboughtFillColor:A.styles.overboughtColor,oversoldFillColor:A.styles.oversoldColor,middleLineColor:A.styles.middleLineColor,middleLineThickness:A.styles.middleLineThickness??1,middleLineStyle:A.styles.middleLineStyle||"dashed",fillOpacity:A.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:A.overboughtLevel,color:A.styles.overboughtColor,lineStyle:A.styles.overboughtLineStyle||"dashed",thickness:A.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:A.middleLevel,color:A.styles.middleLineColor,lineStyle:A.styles.middleLineStyle||"dashed",thickness:A.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:A.oversoldLevel,color:A.styles.oversoldColor,lineStyle:A.styles.oversoldLineStyle||"dashed",thickness:A.styles.oversoldThickness??1,label:"30",visible:!0}]}),rt){const gn=`${$}_RSI`;c.update(cn=>(cn.saveInds[gn]={name:"RSI",pane_id:$,params:[A.period],rsiGroups:[{id:A.id,period:A.period,overboughtLevel:A.overboughtLevel,middleLevel:A.middleLevel,oversoldLevel:A.oversoldLevel,paneId:$,actualPaneId:$,styles:A.styles}]},cn))}}else Pm.createInstance($,{period:A.period,lineColor:A.styles.rsi.color,lineThickness:A.styles.rsi.thickness,lineStyle:A.styles.rsi.lineStyle,overboughtLevel:A.overboughtLevel,oversoldLevel:A.oversoldLevel,middleLevel:A.middleLevel,overboughtColor:A.styles.overboughtColor,overboughtThickness:A.styles.overboughtThickness??1,overboughtLineStyle:A.styles.overboughtLineStyle||"dashed",oversoldColor:A.styles.oversoldColor,oversoldThickness:A.styles.oversoldThickness??1,oversoldLineStyle:A.styles.oversoldLineStyle||"dashed",overboughtFillColor:A.styles.overboughtColor,oversoldFillColor:A.styles.oversoldColor,middleLineColor:A.styles.middleLineColor,middleLineThickness:A.styles.middleLineThickness??1,middleLineStyle:A.styles.middleLineStyle||"dashed",fillOpacity:A.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:A.overboughtLevel,color:A.styles.overboughtColor,lineStyle:A.styles.overboughtLineStyle||"dashed",thickness:A.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:A.middleLevel,color:A.styles.middleLineColor,lineStyle:A.styles.middleLineStyle||"dashed",thickness:A.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:A.oversoldLevel,color:A.styles.oversoldColor,lineStyle:A.styles.oversoldLineStyle||"dashed",thickness:A.styles.oversoldThickness??1,label:"30",visible:!0}]});aa()}function U(b){var $;if(!s(Ei)||s(Fo).length<=1||b<0||b>=s(Fo).length)return;console.log("🗑️ Removing RSI group at index:",b);const k=s(Fo)[b];let T=k.actualPaneId||k.paneId||i().editPaneId;if(!T&&(($=o())!=null&&$.getIndicators))try{const E=new Set(s(Fo).filter((Pe,rt)=>rt!==b).map(Pe=>Pe.actualPaneId||Pe.paneId).filter(Pe=>!!Pe)),ie=o().getIndicators().find(Pe=>(Pe==null?void 0:Pe.name)==="RSI"&&(Pe==null?void 0:Pe.paneId)&&!E.has(Pe.paneId));ie!=null&&ie.paneId&&(T=ie.paneId)}catch(E){console.warn("⚠️ Failed to resolve RSI pane ID for removal:",E)}const A=s(Fo).length;if(s(Fo).splice(b,1),console.log(`📝 Removed group: ${A} -> ${s(Fo).length}`),o()&&T)try{console.log("🗑️ Removing RSI from pane:",T),Pm.deleteInstance(T),rc(T,"RSI")}catch(E){console.error("❌ Error removing RSI indicator:",E)}aa(),console.log("✅ RSI group removed. Remaining groups:",s(Fo).length)}function te(b){if(!s(Ei)||!o()||b<0||b>=s(Fo).length)return;const k=s(Fo)[b],T=k.actualPaneId||k.paneId||i().editPaneId;if(!T){console.warn("⚠️ Unable to resolve pane ID for RSI update");return}try{Pm.updateInstance(T,{period:k.period,lineColor:k.styles.rsi.color,lineThickness:k.styles.rsi.thickness,lineStyle:k.styles.rsi.lineStyle,overboughtLevel:k.overboughtLevel,oversoldLevel:k.oversoldLevel,middleLevel:k.middleLevel,overboughtColor:k.styles.overboughtColor||"#EF4444",overboughtThickness:k.styles.overboughtThickness??1,overboughtLineStyle:k.styles.overboughtLineStyle||"dashed",oversoldColor:k.styles.oversoldColor||"#22C55E",oversoldThickness:k.styles.oversoldThickness??1,oversoldLineStyle:k.styles.oversoldLineStyle||"dashed",overboughtFillColor:k.styles.overboughtColor||"#EF4444",oversoldFillColor:k.styles.oversoldColor||"#22C55E",middleLineColor:k.styles.middleLineColor||"#6B7280",middleLineThickness:k.styles.middleLineThickness??1,middleLineStyle:k.styles.middleLineStyle||"dashed",fillOpacity:k.fillOpacity??.15,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:k.overboughtLevel,color:k.styles.overboughtColor||"#EF4444",lineStyle:k.styles.overboughtLineStyle||"dashed",thickness:k.styles.overboughtThickness??1,label:String(k.overboughtLevel),visible:!0},{id:"middle",value:k.middleLevel,color:k.styles.middleLineColor||"#6B7280",lineStyle:k.styles.middleLineStyle||"dashed",thickness:k.styles.middleLineThickness??1,label:String(k.middleLevel),visible:!0},{id:"oversold",value:k.oversoldLevel,color:k.styles.oversoldColor||"#22C55E",lineStyle:k.styles.oversoldLineStyle||"dashed",thickness:k.styles.oversoldThickness??1,label:String(k.oversoldLevel),visible:!0}]}),o().removeIndicator({paneId:T,name:"RSI"});let A=Ke.Solid,$=[2,2];k.styles.rsi.lineStyle==="dashed"?(A=Ke.Dashed,$=[6,4]):k.styles.rsi.lineStyle==="dotted"&&(A=Ke.Dashed,$=[2,2]);const E=o().createIndicator({name:"RSI",calcParams:[k.period],styles:{lines:[{color:k.styles.rsi.color,size:k.styles.rsi.thickness,style:A,dashedValue:$}]}},!1,{id:T,axis:{gap:{bottom:2}}});try{typeof o().resize=="function"&&o().resize()}catch{}if(k.actualPaneId=T,k.paneId=T,E){const Q=`${T}_RSI`;c.update(ie=>{const Pe=(s(Fo)||[]).filter(rt=>(rt.actualPaneId||rt.paneId)===T);return ie.saveInds[Q]={name:"RSI",pane_id:T,params:[k.period],rsiGroups:Pe},ie})}aa()}catch(A){console.error("❌ Error updating RSI indicator:",A)}}let $e=ae(N([]));function ut(){x($e,N([])),console.log("✅ Stochastic groups cleared from modal state")}function Kt(){if(!s(ei))return;const b=`${i().editPaneId}_STOCH`,k=r().saveInds[b];if(k&&k.stochasticGroups&&k.stochasticGroups.length>0)x($e,N([...k.stochasticGroups]));else if(s($e).length===0){const T={id:zi(),kPeriod:14,dPeriod:3,overboughtLevel:80,oversoldLevel:20,midLevel:50,paneId:i().editPaneId,styles:{kLine:{color:"#1E90FF",thickness:2,lineStyle:"solid"},dLine:{color:"#FF1493",thickness:2,lineStyle:"dashed"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midLineColor:"#6B7280"}};x($e,N([T])),$0.createInstance(i().editPaneId,{kPeriod:T.kPeriod,dPeriod:T.dPeriod,kLineColor:T.styles.kLine.color,kLineThickness:T.styles.kLine.thickness,kLineStyle:T.styles.kLine.lineStyle,dLineColor:T.styles.dLine.color,dLineThickness:T.styles.dLine.thickness,dLineStyle:T.styles.dLine.lineStyle,levels:[{id:"overbought",value:T.overboughtLevel,color:T.styles.overboughtColor,lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:T.oversoldLevel,color:T.styles.oversoldColor,lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"mid",value:T.midLevel,color:T.styles.midLineColor,lineStyle:"dashed",thickness:1,label:"Mid",visible:!0}]})}}function $t(){var k;if(!s(ei))return;const b={id:zi(),kPeriod:14,dPeriod:3,overboughtLevel:80,oversoldLevel:20,midLevel:50,paneId:void 0,styles:{kLine:{color:"#1E90FF",thickness:2,lineStyle:"solid"},dLine:{color:"#FF1493",thickness:2,lineStyle:"dashed"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midLineColor:"#6B7280"}};if(x($e,N([...s($e),b])),s($e).length>1){const T=Object.values(r().saveInds).filter(rt=>rt.name==="STOCH"&&rt.pane_id).map(rt=>rt.pane_id);let A=2;for(;T.includes(`pane_STOCH_${A}`);)A+=1;const $=s($e).length-1,E=[b.kPeriod,b.dPeriod,1],Q={lines:[{color:b.styles.kLine.color,size:b.styles.kLine.thickness,style:b.styles.kLine.lineStyle==="dashed"||b.styles.kLine.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:b.styles.kLine.lineStyle==="dashed"?[4,4]:b.styles.kLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:b.styles.dLine.color,size:b.styles.dLine.thickness,style:b.styles.dLine.lineStyle==="dashed"||b.styles.dLine.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:b.styles.dLine.lineStyle==="dashed"?[4,4]:b.styles.dLine.lineStyle==="dotted"?[2,2]:[2,2]}]},ie=`pane_STOCH_${A}`;console.log(`🆕 Immediately creating Stochastic ${A} with pane ID:`,ie),((k=o())==null?void 0:k.createIndicator({name:"STOCH",calcParams:E,styles:Q},!1,{id:ie,axis:{gap:{bottom:2}}}))&&(console.log(`✅ Stochastic ${A} created with pane ID:`,ie),b.paneId=ie,$0.updateInstance(ie,{kPeriod:b.kPeriod,dPeriod:b.dPeriod,levels:[{id:"overbought",value:b.overboughtLevel,color:b.styles.overboughtColor,lineStyle:"solid",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:b.oversoldLevel,color:b.styles.oversoldColor,lineStyle:"solid",thickness:1,label:"Oversold",visible:!0},{id:"midline",value:b.midLevel,color:b.styles.midLineColor,lineStyle:"solid",thickness:1,label:"Midline",visible:!0}],zones:[{id:"overbought_zone",type:"overbought",topLevel:100,bottomLevel:b.overboughtLevel,fillColor:b.styles.overboughtColor,fillOpacity:.1,visible:!0},{id:"oversold_zone",type:"oversold",topLevel:b.oversoldLevel,bottomLevel:0,fillColor:b.styles.oversoldColor,fillOpacity:.1,visible:!0}],kLineColor:b.styles.kLine.color,dLineColor:b.styles.dLine.color,showLevels:!0,showZones:!0,overboughtLevel:b.overboughtLevel,oversoldLevel:b.oversoldLevel,midlineLevel:b.midLevel}),c.update(rt=>{const gn=`pane_STOCH_${A}_STOCH`;return rt.saveInds[gn]={name:"STOCH",stochasticGroup:b,pane_id:ie,groupIndex:$,params:[b.kPeriod,b.dPeriod,1]},rt}))}console.log("✅ New Stochastic group added:",b)}function wn(b){if(!s(ei)||b<0||b>=s($e).length)return;const T=s($e)[b].paneId||i().editPaneId;try{$0.deleteInstance(T),o()&&o().removeIndicator({paneId:T,name:"STOCH"}),c.update(A=>(Object.keys(A.saveInds).filter(E=>A.saveInds[E].name==="STOCH"&&A.saveInds[E].pane_id===T).forEach(E=>{delete A.saveInds[E]}),A)),x($e,N(s($e).filter((A,$)=>$!==b))),console.log("✅ Stochastic group removed successfully")}catch(A){console.error("❌ Error removing Stochastic group:",A)}}function Zn(b){if(!s(ei)||b<0||b>=s($e).length)return;const k=s($e)[b],T=k.paneId||i().editPaneId;try{$0.updateInstance(T,{kPeriod:k.kPeriod,dPeriod:k.dPeriod,kLineColor:k.styles.kLine.color,kLineThickness:k.styles.kLine.thickness,kLineStyle:k.styles.kLine.lineStyle,dLineColor:k.styles.dLine.color,dLineThickness:k.styles.dLine.thickness,dLineStyle:k.styles.dLine.lineStyle,overboughtLevel:k.overboughtLevel,oversoldLevel:k.oversoldLevel,midlineLevel:k.midLevel,showZones:!0,zones:[{id:"overbought-zone",topLevel:100,bottomLevel:k.overboughtLevel,fillColor:k.styles.overboughtColor||"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold-zone",topLevel:k.oversoldLevel,bottomLevel:0,fillColor:k.styles.oversoldColor||"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}],levels:[{id:"overbought",value:k.overboughtLevel,color:k.styles.overboughtColor||"#EF4444",lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:k.oversoldLevel,color:k.styles.oversoldColor||"#10B981",lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"mid",value:k.midLevel,color:k.styles.midLineColor||"#6B7280",lineStyle:"dashed",thickness:1,label:"Mid",visible:!0}]}),o()&&o().removeIndicator({paneId:T,name:"STOCH"});let A=Ke.Solid,$=[2,2],E=Ke.Solid,Q=[2,2];if(k.styles.kLine.lineStyle==="dashed"?(A=Ke.Dashed,$=[4,4]):k.styles.kLine.lineStyle==="dotted"&&(A=Ke.Dashed,$=[2,2]),k.styles.dLine.lineStyle==="dashed"?(E=Ke.Dashed,Q=[4,4]):k.styles.dLine.lineStyle==="dotted"&&(E=Ke.Dashed,Q=[2,2]),o()?o().createIndicator({name:"STOCH",calcParams:[k.kPeriod,k.dPeriod],styles:{lines:[{color:k.styles.kLine.color,size:k.styles.kLine.thickness,style:A,dashedValue:$},{color:k.styles.dLine.color,size:k.styles.dLine.thickness,style:E,dashedValue:Q}]}},T===i().editPaneId,{id:T}):null){const Pe=`${T}_STOCH`;c.update(rt=>(rt.saveInds[Pe]={name:"STOCH",pane_id:T,params:[k.kPeriod,k.dPeriod],stochasticGroups:s($e)},rt))}console.log("✅ Stochastic indicator and levels updated successfully")}catch(A){console.error("❌ Error updating Stochastic indicator:",A)}}function yo(){if(!s(rd))return;const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k].name==="MACD").sort();console.log("🔍 Found existing MACD keys:",b),b.length>0?(x(Rc,N([])),b.forEach((k,T)=>{const A=r().saveInds[k];if(A){if(A.macdGroup){const $={...A.macdGroup};T>0&&A.pane_id&&($.actualPaneId=A.pane_id),s(Rc).push($)}else if(A.params&&A.params.length>=3){const $={id:zi(),fastPeriod:A.params[0]||12,slowPeriod:A.params[1]||26,signalPeriod:A.params[2]||9,actualPaneId:void 0,styles:{macdLine:{color:"#2563eb",thickness:1,lineStyle:"solid"},signalLine:{color:"#dc2626",thickness:1,lineStyle:"solid"},positiveHistogram:{color:"#22c55e"},negativeHistogram:{color:"#ef4444"}}};T>0&&A.pane_id&&($.actualPaneId=A.pane_id),s(Rc).push($)}}}),console.log("✅ Loaded",s(Rc).length,"existing MACD groups")):s(Rc).length===0&&(x(Rc,N([{id:zi(),fastPeriod:12,slowPeriod:26,signalPeriod:9,styles:{macdLine:{color:"#2563eb",thickness:1,lineStyle:"solid"},signalLine:{color:"#dc2626",thickness:1,lineStyle:"solid"},positiveHistogram:{color:"#22c55e"},negativeHistogram:{color:"#ef4444"}}}])),console.log("🆕 Created default MACD group"))}function es(){var A;if(!s(rd))return;const b=[{macdLine:"#2563eb",signalLine:"#dc2626",positiveHistogram:"#22c55e",negativeHistogram:"#ef4444"},{macdLine:"#9333ea",signalLine:"#ea580c",positiveHistogram:"#059669",negativeHistogram:"#dc2626"},{macdLine:"#ec4899",signalLine:"#f59e0b",positiveHistogram:"#0891b2",negativeHistogram:"#f97316"}],k=s(Rc).length%b.length,T={id:zi(),fastPeriod:12,slowPeriod:26,signalPeriod:9,actualPaneId:void 0,styles:{macdLine:{color:b[k].macdLine,thickness:1,lineStyle:"solid"},signalLine:{color:b[k].signalLine,thickness:1,lineStyle:"solid"},positiveHistogram:{color:b[k].positiveHistogram},negativeHistogram:{color:b[k].negativeHistogram}}};if(s(Rc).push(T),s(Rc).length>1){const $=Object.values(r().saveInds).filter(cn=>cn.name==="MACD"&&cn.pane_id).map(cn=>cn.pane_id);let E=2;for(;$.includes(`pane_MACD_${E}`);)E+=1;const Q=s(Rc).length-1,ie=[T.fastPeriod,T.slowPeriod,T.signalPeriod],Pe={lines:[{color:T.styles.macdLine.color,size:T.styles.macdLine.thickness,style:T.styles.macdLine.lineStyle==="dashed"||T.styles.macdLine.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:T.styles.macdLine.lineStyle==="dashed"?[4,4]:T.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:T.styles.signalLine.color,size:T.styles.signalLine.thickness,style:T.styles.signalLine.lineStyle==="dashed"||T.styles.signalLine.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:T.styles.signalLine.lineStyle==="dashed"?[4,4]:T.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:T.styles.positiveHistogram.color,downColor:T.styles.negativeHistogram.color,noChangeColor:T.styles.positiveHistogram.color,borderSize:0,borderColor:T.styles.positiveHistogram.color}]},rt=`pane_MACD_${E}`;console.log(`🆕 Immediately creating MACD ${E} with pane ID:`,rt),((A=o())==null?void 0:A.createIndicator({name:"MACD",calcParams:ie,styles:Pe},!1,{id:rt,axis:{gap:{bottom:2}}}))&&(console.log(`✅ MACD ${E} created with pane ID:`,rt),T.actualPaneId=rt,c.update(cn=>{const Gt=`pane_MACD_${E}_MACD`;return cn.saveInds[Gt]={name:"MACD",macdGroup:T,pane_id:rt,groupIndex:Q,params:[T.fastPeriod,T.slowPeriod,T.signalPeriod]},cn}))}}function $s(b){var T,A;if(!s(rd)||s(Rc).length<=1)return;const k=s(Rc).findIndex($=>$.id===b);if(k!==-1){console.log("🗑️ Removing MACD group at index:",k,"ID:",b);try{if(k===0&&s(Rc).length>1){console.log("🔄 Special handling: First MACD removed, promoting second MACD to first position"),x(Rc,N(s(Rc).filter(E=>E.id!==b))),console.log("✅ MACD group removed from array. Remaining groups:",s(Rc).length);const $=s(Rc)[0];$.actualPaneId&&(console.log("🗑️ Removing old second MACD from sub-pane:",$.actualPaneId),(T=o())==null||T.removeIndicator({paneId:$.actualPaneId,name:"MACD"})),$.actualPaneId=void 0,console.log("📊 Updating MACD in edit pane with new first group settings"),oi(0)}else{const $=s(Rc)[k];$.actualPaneId&&(console.log("🗑️ Removing MACD from actual pane:",$.actualPaneId),(A=o())==null||A.removeIndicator({paneId:$.actualPaneId,name:"MACD"}),console.log("✅ Successfully removed MACD from actual pane:",$.actualPaneId)),x(Rc,N(s(Rc).filter(E=>E.id!==b))),console.log("✅ MACD group removed from array. Remaining groups:",s(Rc).length)}c.update($=>(Object.keys($.saveInds).forEach(E=>{$.saveInds[E].name==="MACD"&&(console.log("🧹 Cleaning saved state for key:",E),delete $.saveInds[E])}),s(Rc).forEach((E,Q)=>{const ie=Q===0?`${i().editPaneId}_MACD`:`pane_MACD_${Q+1}_MACD`,Pe=Q===0?i().editPaneId:E.actualPaneId||`pane_MACD_${Q+1}`;console.log(`💾 Re-saving MACD group ${Q+1} with key:`,ie,"pane ID:",Pe),$.saveInds[ie]={name:"MACD",macdGroup:E,pane_id:Pe,groupIndex:Q,macdGroups:Q===0?[...s(Rc)]:void 0,params:[E.fastPeriod,E.slowPeriod,E.signalPeriod]}}),$)),console.log("🔄 MACD groups reindexed successfully")}catch($){console.log("❌ Error removing MACD indicator:",$)}}}function oi(b){var E;const k=s(Rc)[b];if(!k||!o())return;const T=b===0?i().editPaneId:k.actualPaneId||`pane_MACD_${b+1}`,A={lines:[{color:k.styles.macdLine.color,size:k.styles.macdLine.thickness,style:k.styles.macdLine.lineStyle==="dashed"||k.styles.macdLine.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:k.styles.macdLine.lineStyle==="dashed"?[4,4]:k.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:k.styles.signalLine.color,size:k.styles.signalLine.thickness,style:k.styles.signalLine.lineStyle==="dashed"||k.styles.signalLine.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:k.styles.signalLine.lineStyle==="dashed"?[4,4]:k.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:k.styles.positiveHistogram.color,downColor:k.styles.negativeHistogram.color,noChangeColor:k.styles.positiveHistogram.color,borderSize:0,borderColor:k.styles.positiveHistogram.color}]};(E=o())==null||E.overrideIndicator({name:"MACD",paneId:T,styles:A,calcParams:[k.fastPeriod,k.slowPeriod,k.signalPeriod]});const $=b===0?`${i().editPaneId}_MACD`:`pane_MACD_${b+1}_MACD`;c.update(Q=>(Q.saveInds[$]&&(Q.saveInds[$].params=[k.fastPeriod,k.slowPeriod,k.signalPeriod],Q.saveInds[$].macdGroup={...k},console.log("💾 Persisted MACD changes to save data:",$,k)),Q)),console.log("🔄 Updated MACD indicator:",b,k)}function Ts(b,k){var E;const T=s(Rc)[b];if(!T||!o())return;const A=b===0?i().editPaneId:T.actualPaneId||`pane_MACD_${b+1}`,$={lines:[{color:T.styles.macdLine.color,size:T.styles.macdLine.thickness,style:T.styles.macdLine.lineStyle==="dashed"||T.styles.macdLine.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:T.styles.macdLine.lineStyle==="dashed"?[4,4]:T.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:T.styles.signalLine.color,size:T.styles.signalLine.thickness,style:T.styles.signalLine.lineStyle==="dashed"||T.styles.signalLine.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:T.styles.signalLine.lineStyle==="dashed"?[4,4]:T.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:T.styles.positiveHistogram.color,downColor:T.styles.negativeHistogram.color,noChangeColor:T.styles.positiveHistogram.color,borderSize:0,borderColor:T.styles.positiveHistogram.color}]};(E=o())==null||E.overrideIndicator({name:"MACD",paneId:A,styles:$}),console.log("🎨 Updated MACD color:",k,T.styles[k].color)}function hr(){if(s(uo))try{const b=`${i().editPaneId}_EMV`,k=r().saveInds[b];if(k&&k.emvGroups&&Array.isArray(k.emvGroups)&&k.emvGroups.length>0){const T=k.emvGroups.filter(A=>A&&typeof A.id=="string"&&typeof A.name=="string"&&typeof A.period=="number"&&A.period>0&&typeof A.period2=="number"&&A.period2>0&&typeof A.color=="string"&&typeof A.thickness=="number"&&A.thickness>0&&typeof A.lineStyle=="string");T.length>0?(x(Gn,N([...T])),console.log("✅ Loaded",T.length,"valid EMV groups")):(console.warn("⚠️ No valid EMV groups found in saved data, creating default"),Vr())}else s(Gn).length===0&&Vr()}catch(b){console.error("❌ Error initializing EMV groups:",b),Vr()}}function Vr(){x(Gn,N([{id:zi(),name:"EMV #1",period:14,period2:9,color:"#2563eb",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default EMV group")}function Nt(b){if(!s(uo)||s(Gn).length<=1){console.warn("⚠️ Cannot remove EMV group: minimum one group required");return}try{if(!b||typeof b!="string"){console.error("❌ Invalid group ID provided for EMV group removal");return}const k=s(Gn).length;x(Gn,N(s(Gn).filter(T=>T.id!==b))),s(Gn).length<k?console.log("✅ Removed EMV group with ID:",b):console.warn("⚠️ EMV group not found for removal:",b)}catch(k){console.error("❌ Error removing EMV group:",k)}}function Wn(){if(s(hs))try{const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k]&&r().saveInds[k].name==="MTM").sort((k,T)=>k===`${i().editPaneId}_MTM`?-1:T===`${i().editPaneId}_MTM`?1:k.localeCompare(T));b.length>0?(x(Ds,N([])),b.forEach((k,T)=>{const A=r().saveInds[k];if(A){if(A.mtmGroup){const $={...A.mtmGroup};T>0&&A.pane_id&&($.actualPaneId=A.pane_id),s(Ds).push($)}else if(A.mtmGroups&&Array.isArray(A.mtmGroups)&&T===0){const $=A.mtmGroups.filter(E=>E&&typeof E.id=="string"&&typeof E.name=="string"&&typeof E.period=="number"&&E.period>0&&typeof E.color=="string"&&typeof E.thickness=="number"&&E.thickness>0&&typeof E.lineStyle=="string");x(Ds,N([...$]))}}}),s(Ds).length>0?console.log("✅ Loaded",s(Ds).length,"MTM groups from saved data"):(console.warn("⚠️ No valid MTM groups found, creating default"),Co())):s(Ds).length===0&&Co()}catch(b){console.error("❌ Error initializing MTM groups:",b),Co()}}function Co(){x(Ds,N([{id:zi(),name:"MTM #1",period:14,color:"#2563eb",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default MTM group")}function mo(b){if(!s(hs)||s(Ds).length<=1){console.warn("⚠️ Cannot remove MTM group: minimum one group required");return}try{if(!b||typeof b!="string"){console.error("❌ Invalid group ID provided for MTM group removal");return}const k=s(Ds).length;x(Ds,N(s(Ds).filter(T=>T.id!==b))),s(Ds).length<k?(console.log("✅ Removed MTM group with ID:",b),Bo()):console.warn("⚠️ MTM group not found for removal:",b)}catch(k){console.error("❌ Error removing MTM group:",k)}}function Bo(){var b;if(!(!s(hs)||!o()))try{console.log("🔄 Applying MTM changes to chart...");const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A]&&r().saveInds[A].name==="MTM").sort((A,$)=>A===`${i().editPaneId}_MTM`?-1:$===`${i().editPaneId}_MTM`?1:A.localeCompare($));console.log("🔧 Applying MTM changes. Existing keys:",k),console.log("🔧 Current MTM groups:",s(Ds).length);const T=s(Ds).length;if(k.length>T)for(let A=T;A<k.length;(A+=1)-1){const $=k[A],E=r().saveInds[$];if(E&&E.pane_id)try{console.log("🗑️ Removing excess MTM indicator from pane:",E.pane_id),(b=o())==null||b.removeIndicator({paneId:E.pane_id,name:"MTM"})}catch(Q){console.log("❌ Error removing excess MTM indicator:",Q)}}s(Ds).forEach((A,$)=>{var ie,Pe,rt;const E=[A.period],Q={lines:[{color:A.color,size:A.thickness,style:A.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:A.lineStyle==="dashed"?[4,4]:A.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if($===0)console.log("🔄 Updating first MTM in pane:",i().editPaneId),(ie=o())==null||ie.overrideIndicator({name:"MTM",calcParams:E,styles:Q,paneId:i().editPaneId});else{const gn=`pane_MTM_${$+1}_MTM`,cn=k.find(Gt=>Gt===gn);if(cn){const Gt=r().saveInds[cn];Gt&&Gt.pane_id&&(console.log("🔄 Updating existing MTM in pane:",Gt.pane_id),(Pe=o())==null||Pe.overrideIndicator({name:"MTM",calcParams:E,styles:Q,paneId:Gt.pane_id}),A.actualPaneId=Gt.pane_id)}else{const Gt=`pane_MTM_${$+1}`;console.log("🆕 Creating new MTM in pane:",Gt);const eo=(rt=o())==null?void 0:rt.createIndicator({name:"MTM",calcParams:E,styles:Q},!0,{id:Gt,axis:{gap:{bottom:2}}});eo&&(A.actualPaneId=Gt,console.log("✅ Created new MTM indicator with ID:",eo,"in pane:",Gt))}}}),c.update(A=>{try{Object.keys(A.saveInds).forEach($=>{A.saveInds[$]&&A.saveInds[$].name==="MTM"&&delete A.saveInds[$]}),s(Ds).forEach(($,E)=>{try{const Q=E===0?`${i().editPaneId}_MTM`:`pane_MTM_${E+1}_MTM`,ie=E===0?i().editPaneId:$.actualPaneId||`pane_MTM_${E+1}`;if(!Q||!ie){console.error(`❌ Invalid save key or pane ID for MTM group ${E}`);return}const Pe={name:"MTM",mtmGroup:$,pane_id:ie,groupIndex:E,mtmGroups:E===0?[...s(Ds)]:void 0,params:[$.period]};A.saveInds[Q]=Pe,console.log("💾 Saved MTM group",E,"with key:",Q,"and pane ID:",ie)}catch(Q){console.error(`❌ Error saving MTM group ${E}:`,Q)}})}catch($){console.error("❌ Error in MTM save operation:",$)}return A}),console.log("✅ MTM changes applied successfully")}catch(k){console.error("❌ Critical error in applyMtm:",k)}}function ws(){if(!s(Er))return;const b=`${i().editPaneId}_WR`,k=r().saveInds[b];if(k&&k.wrGroups&&k.wrGroups.length>0){x(Bc,N([...k.wrGroups]));return}const T=[];Object.keys(r().saveInds).forEach(A=>{if((A.includes("_WR")||A.startsWith("WR_"))&&A!==b){const $=r().saveInds[A];$&&$.wrGroup&&T.push($.wrGroup)}}),k&&k.wrGroup&&T.unshift(k.wrGroup),T.length>0?x(Bc,N([...T])):s(Bc).length===0&&x(Bc,N([{id:zi(),period:14,overboughtLevel:-20,middleLevel:-50,oversoldLevel:-80,paneId:i().editPaneId,styles:{wr:{color:"#2563eb",thickness:1,lineStyle:"solid"},overbought:{color:"#EF4444",thickness:1,lineStyle:"solid"},oversold:{color:"#10B981",thickness:1,lineStyle:"solid"},middleLine:{color:"#6B7280",thickness:1,lineStyle:"solid"}}}]))}function $o(){if(!s(Er))return;const b=`pane_WR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,k={id:zi(),period:14,overboughtLevel:-20,middleLevel:-50,oversoldLevel:-80,paneId:b,styles:{wr:{color:"#2563eb",thickness:1,lineStyle:"solid"},overbought:{color:"#EF4444",thickness:1,lineStyle:"solid"},oversold:{color:"#10B981",thickness:1,lineStyle:"solid"},middleLine:{color:"#6B7280",thickness:1,lineStyle:"solid"}}};if(s(Bc).push(k),Q_.createInstance(b,{period:k.period,lineColor:k.styles.wr.color,lineThickness:k.styles.wr.thickness,lineStyle:k.styles.wr.lineStyle,levels:[{id:"overbought",value:k.overboughtLevel,color:k.styles.overbought.color,lineStyle:k.styles.overbought.lineStyle,thickness:k.styles.overbought.thickness,label:"Overbought",visible:!0},{id:"middle",value:k.middleLevel,color:k.styles.middleLine.color,lineStyle:k.styles.middleLine.lineStyle,thickness:k.styles.middleLine.thickness,label:"Middle",visible:!0},{id:"oversold",value:k.oversoldLevel,color:k.styles.oversold.color,lineStyle:k.styles.oversold.lineStyle,thickness:k.styles.oversold.thickness,label:"Oversold",visible:!0}]}),o()){let T=Ke.Solid,A=[2,2];if(k.styles.wr.lineStyle==="dashed"?(T=Ke.Dashed,A=[4,4]):k.styles.wr.lineStyle==="dotted"&&(T=Ke.Dashed,A=[2,2]),o().createIndicator({name:"WR",calcParams:[k.period],styles:{lines:[{color:k.styles.wr.color,size:k.styles.wr.thickness,style:T,dashedValue:A}]}},!1,{id:b})){const E=`${b}_WR`;c.update(Q=>(Q.saveInds[E]={name:"WR",pane_id:b,params:[k.period]},Q))}}console.log("➕ Added new WR group in new pane:",k.id,b)}function _i(b){if(!s(Er)||s(Bc).length<=1)return;const k=s(Bc).find(A=>A.id===b);if(!k)return;s(Bc).findIndex(A=>A.id===b);const T=k.paneId;x(Bc,N(s(Bc).filter(A=>A.id!==b))),T&&Q_.deleteInstance(T),T&&rc(T,"WR"),console.log("🗑️ Removed WR group from pane:",T)}function Ar(b){if(!s(Er)||!o()||b<0||b>=s(Bc).length)return;const k=s(Bc)[b],T=k.paneId||i().editPaneId;console.log("🔄 Updating WR indicator:",b,T);try{Q_.updateInstance(T,{period:k.period,lineColor:k.styles.wr.color,lineThickness:k.styles.wr.thickness,lineStyle:k.styles.wr.lineStyle,enableDynamicColoring:!0,overboughtColor:k.styles.overbought.color||"#EF4444",oversoldColor:k.styles.oversold.color||"#10B981",overboughtThreshold:k.overboughtLevel,oversoldThreshold:k.oversoldLevel,levels:[{id:"overbought",value:k.overboughtLevel,color:k.styles.overbought.color||"#EF4444",lineStyle:k.styles.overbought.lineStyle,thickness:k.styles.overbought.thickness,label:"Overbought",visible:!0},{id:"middle",value:k.middleLevel,color:k.styles.middleLine.color||"#6B7280",lineStyle:k.styles.middleLine.lineStyle,thickness:k.styles.middleLine.thickness,label:"Middle",visible:!0},{id:"oversold",value:k.oversoldLevel,color:k.styles.oversold.color||"#10B981",lineStyle:k.styles.oversold.lineStyle,thickness:k.styles.oversold.thickness,label:"Oversold",visible:!0}]}),o().removeIndicator({paneId:T,name:"WR"});let A=Ke.Solid,$=[2,2];if(k.styles.wr.lineStyle==="dashed"?(A=Ke.Dashed,$=[4,4]):k.styles.wr.lineStyle==="dotted"&&(A=Ke.Dashed,$=[2,2]),o().createIndicator({name:"WR",calcParams:[k.period],styles:{lines:[{color:k.styles.wr.color,size:k.styles.wr.thickness,style:A,dashedValue:$}]}},T===i().editPaneId,{id:T})){const Q=`${T}_WR`;c.update(ie=>(ie.saveInds[Q]={name:"WR",pane_id:T,params:[k.period]},ie))}console.log("✅ WR indicator and levels updated successfully")}catch(A){console.error("❌ Error updating WR indicator:",A)}}function Da(){if(!s(Sc))return;const b=Object.entries(r().saveInds).filter(([k,T])=>T.name==="VR");if(b.length>0)x(qd,N(b.map(([k,T])=>{var A,$,E;return T.vrGroups&&T.vrGroups.length>0?T.vrGroups[0]:T.vrGroup?T.vrGroup:{id:zi(),paneId:T.pane_id,period:((A=T.params)==null?void 0:A[0])||26,shortPeriod:(($=T.params)==null?void 0:$[1])||6,longPeriod:((E=T.params)==null?void 0:E[2])||12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}}}))),console.log("✅ Loaded VR groups from save system:",s(qd).length);else if(s(qd).length===0){const k={id:zi(),paneId:i().editPaneId,period:26,shortPeriod:6,longPeriod:12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}};x(qd,N([k])),console.log("✅ Created default VR group with pane ID:",i().editPaneId)}}function Oo(){if(!s(ce))return;const b=Object.entries(r().saveInds).filter(([k,T])=>T.name==="VOL");if(b.length>0)x(nt,N(b.map(([k,T])=>{var A,$,E,Q,ie;if(T.volGroups&&T.volGroups.length>0){const Pe=T.volGroups[0];return{...Pe,paneId:"candle_pane",styles:{...Pe.styles,ema:{visible:(($=(A=Pe.styles)==null?void 0:A.ema)==null?void 0:$.visible)??!1,...Pe.styles.ema}}}}else if(T.volGroup){const Pe=T.volGroup;return{...Pe,paneId:"candle_pane",styles:{...Pe.styles,ema:{visible:((Q=(E=Pe.styles)==null?void 0:E.ema)==null?void 0:Q.visible)??!1,...Pe.styles.ema}}}}else return{id:zi(),paneId:"candle_pane",period:((ie=T.params)==null?void 0:ie[0])||20,styles:{histogram:{upColor:"#26a69a",downColor:"#ef5350",thickness:1,lineStyle:"solid"},ema:{color:"#8B5CF6",thickness:1,lineStyle:"dotted",visible:!1}}}}))),console.log("✅ Loaded Volume groups from save system:",s(nt).length);else if(s(nt).length===0){const k={id:zi(),paneId:"candle_pane",period:20,styles:{histogram:{upColor:"#26a69a",downColor:"#ef5350",thickness:1,lineStyle:"solid"},ema:{color:"#8B5CF6",thickness:1,lineStyle:"dotted",visible:!1}}};x(nt,N([k])),console.log("✅ Created default Volume group:",k)}}function ss(){if(!s(Sc))return;const b=`pane_VR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,k={id:zi(),paneId:b,period:26,shortPeriod:6,longPeriod:12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}};if(s(qd).push(k),o()){let T=Ke.Solid,A=[2,2];if(k.styles.vr.lineStyle==="dashed"?(T=Ke.Dashed,A=[4,4]):k.styles.vr.lineStyle==="dotted"&&(T=Ke.Dashed,A=[2,2]),o().createIndicator({name:"VR",calcParams:[k.period,k.shortPeriod,k.longPeriod],styles:{lines:[{color:k.styles.vr.color,size:k.styles.vr.thickness,style:T,dashedValue:A}]}},!1,{id:b})){const E=`${b}_VR`;c.update(Q=>(Q.saveInds[E]={name:"VR",pane_id:b,params:[k.period,k.shortPeriod,k.longPeriod]},Q))}}console.log("➕ Added new VR group in new pane:",k.id,b)}function ds(b){if(!s(Sc)||s(qd).length<=1||b<0||b>=s(qd).length)return;console.log("🗑️ Removing VR group at index:",b);const T=s(qd)[b].paneId,A=s(qd).length;if(s(qd).splice(b,1),console.log(`📝 Removed group: ${A} -> ${s(qd).length}`),o()&&T)try{console.log("🗑️ Removing VR from pane:",T),rc(T,"VR")}catch($){console.error("❌ Error removing VR indicator:",$)}console.log("✅ VR group removed. Remaining groups:",s(qd).length),console.log("🗑️ Removed VR group from list (will be applied on confirm)")}function yn(b){if(!s(ce)||s(nt).length<=1||b<0||b>=s(nt).length)return;console.log("🗑️ Removing Volume group at index:",b),s(nt)[b];const k="candle_pane",T=s(nt).length;if(s(nt).splice(b,1),console.log(`📝 Removed group: ${T} -> ${s(nt).length}`),o()&&k)try{console.log("🗑️ Removing Volume from pane:",k),rc(k,"VOL")}catch(A){console.error("❌ Error removing Volume indicator:",A)}console.log("✅ Volume group removed. Remaining groups:",s(nt).length),console.log("🗑️ Removed Volume group from list (will be applied on confirm)")}function wo(b){if(i().editIndName!=="VR"||!o()||b<0||b>=s(qd).length)return;const k=s(qd)[b],T=k.paneId||i().editPaneId;console.log("🔄 Updating VR indicator:",b,T);try{o().removeIndicator({paneId:T,name:"VR"});const A=Pe=>{switch(Pe){case"dashed":return{style:Ke.Dashed,dashedValue:[4,4]};case"dotted":return{style:Ke.Dashed,dashedValue:[2,2]};default:return{style:Ke.Solid,dashedValue:[2,2]}}},$=A(k.styles.vr.lineStyle),E=A(k.styles.vrShort.lineStyle),Q=A(k.styles.vrLong.lineStyle);if(o().createIndicator({name:"VR",calcParams:[k.period,k.shortPeriod,k.longPeriod],styles:{lines:[{color:k.styles.vr.color,size:k.styles.vr.thickness,style:$.style,dashedValue:$.dashedValue},{color:k.styles.vrShort.color,size:k.styles.vrShort.thickness,style:E.style,dashedValue:E.dashedValue},{color:k.styles.vrLong.color,size:k.styles.vrLong.thickness,style:Q.style,dashedValue:Q.dashedValue}]}},T===i().editPaneId,{id:T})){const Pe=`${T}_VR`;c.update(rt=>(rt.saveInds[Pe]={name:"VR",pane_id:T,params:[k.period,k.shortPeriod,k.longPeriod]},rt))}console.log("✅ VR indicator updated successfully")}catch(A){console.error("❌ Error updating VR indicator:",A)}}function si(b){if(i().editIndName!=="VOL"||!o()||b<0||b>=s(nt).length)return;const k=s(nt)[b],T="candle_pane";try{console.log("🔄 Updating Volume indicator for group:",b,"paneId:",T),o().removeIndicator({paneId:T,name:"VOL"});let A=Ke.Solid,$=[2,2];if(k.styles.ema.lineStyle==="dashed"?(A=Ke.Dashed,$=[4,4]):k.styles.ema.lineStyle==="dotted"&&(A=Ke.Dashed,$=[2,2]),console.log("updateVolIndicator - Colors being applied:",{upColor:k.styles.histogram.upColor,downColor:k.styles.histogram.downColor,noChangeColor:k.styles.histogram.upColor,emaColor:k.styles.ema.color}),o().createIndicator({name:"VOL",calcParams:[k.period],styles:{bars:[{upColor:k.styles.histogram.upColor,downColor:k.styles.histogram.downColor,noChangeColor:k.styles.histogram.upColor}],lines:[{color:k.styles.ema.color,size:k.styles.ema.thickness,style:A,dashedValue:$}]}},!0,{id:T})){const Q=`${T}_VOL`;c.update(ie=>(ie.saveInds[Q]={name:"VOL",pane_id:T,params:[k.period],volGroup:k},ie))}console.log("✅ Volume indicator updated successfully")}catch(A){console.error("❌ Error updating Volume indicator:",A)}}function ir(b){if(i().editIndName!=="BBI"||!o()||b<0||b>=s(B).length)return;const k=s(B)[b],T=k.paneId||i().editPaneId;console.log("🔄 Updating BBI indicator:",b,T);try{o().removeIndicator({paneId:T,name:"BBI"});const $=(Q=>{switch(Q){case"dashed":return{style:Ke.Dashed,dashedValue:[4,4]};case"dotted":return{style:Ke.Dashed,dashedValue:[2,2]};default:return{style:Ke.Solid,dashedValue:[2,2]}}})(k.lineStyle);if(o().createIndicator({name:"BBI",calcParams:[k.period1,k.period2,k.period3,k.period4],styles:{lines:[{color:k.color,size:k.thickness,style:$.style,dashedValue:$.dashedValue}]}},T===i().editPaneId,{id:T})){const Q=`${T}_BBI`;c.update(ie=>(ie.saveInds[Q]={name:"BBI",pane_id:T,params:[k.period1,k.period2,k.period3,k.period4],bbiGroup:k},ie))}console.log("✅ BBI indicator updated successfully")}catch(A){console.error("❌ Error updating BBI indicator:",A)}}function Ji(){if(!(i().editIndName!=="EMA"||!o()))try{console.log("🔄 Updating EMA indicator"),o().removeIndicator({paneId:i().editPaneId,name:"EMA"});const b=o().createIndicator({name:"EMA",calcParams:p,styles:{lines:p.map((k,T)=>{const A=h[T];let $=Ke.Solid,E=[2,2];return(A==null?void 0:A.lineStyle)==="dashed"?($=Ke.Dashed,E=[4,4]):(A==null?void 0:A.lineStyle)==="dotted"&&($=Ke.Dashed,E=[2,2]),{color:(A==null?void 0:A.color)||"#FF6B6B",size:(A==null?void 0:A.thickness)||1,style:$,dashedValue:E}})}},!0,{id:i().editPaneId});console.log("✅ EMA indicator updated successfully")}catch(b){console.error("❌ Error updating EMA indicator:",b)}}function el(){if(!(i().editIndName!=="MA"||!o()))try{console.log("🔄 Updating MA indicator"),o().removeIndicator({paneId:i().editPaneId,name:"MA"});const b=o().createIndicator({name:"MA",calcParams:p,styles:{lines:p.map((T,A)=>{const $=h[A];let E=Ke.Solid,Q=[2,2];return($==null?void 0:$.lineStyle)==="dashed"?(E=Ke.Dashed,Q=[4,4]):($==null?void 0:$.lineStyle)==="dotted"&&(E=Ke.Dashed,Q=[2,2]),{color:($==null?void 0:$.color)||"#2563eb",size:($==null?void 0:$.thickness)||1,style:E,dashedValue:Q}})}},!0,{id:i().editPaneId}),k=`${i().editPaneId}_MA`;c.update(T=>(T.saveInds[k]&&(T.saveInds[k].params=[...p],T.saveInds[k].styles=h.map(A=>({...A}))),T)),console.log("✅ MA indicator updated successfully")}catch(b){console.error("❌ Error updating MA indicator:",b)}}function Dd(){var T,A,$;if(!s(Ac))return;const b=`${i().editPaneId}_SMA`,k=r().saveInds[b];k&&k.smaGroups&&k.smaGroups.length>0?(x($n,N([...k.smaGroups])),console.log("✅ Loaded",s($n).length,"SMA groups from saved data")):k&&k.params&&k.params.length>0&&k.styles?(x($n,N([{id:zi(),name:"SMA",period:k.params[0]||20,color:((T=k.styles[0])==null?void 0:T.color)||"#FF6C37",thickness:((A=k.styles[0])==null?void 0:A.thickness)||2,lineStyle:(($=k.styles[0])==null?void 0:$.lineStyle)||"solid"}])),console.log("✅ Loaded SMA from saved data (old format)")):s($n).length===0&&(x($n,N([{id:zi(),name:"SMA",period:20,color:"#FF6C37",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default SMA group"))}function Ma(b){var k,T;if(!(i().editIndName!=="SMA"||!o()||s($n).length===0||b>=s($n).length))try{console.log("🔄 Updating SMA indicator at index:",b);const A=s($n)[b],E=((k=o())==null?void 0:k.getIndicators()).filter(ie=>ie.name==="SMA");for(const ie of E)(T=o())==null||T.removeIndicator({paneId:ie.paneId,name:"SMA"});s($n).forEach((ie,Pe)=>{var cn;let rt=Ke.Solid,gn=[2,2];ie.lineStyle==="dashed"?(rt=Ke.Dashed,gn=[8,4]):ie.lineStyle==="dotted"&&(rt=Ke.Dashed,gn=[2,2]),(cn=o())==null||cn.createIndicator({name:"SMA",calcParams:[ie.period],styles:{lines:[{color:ie.color,size:ie.thickness,style:rt,dashedValue:gn}]}},!0,{id:i().editPaneId})});const Q=`${i().editPaneId}_SMA`;c.update(ie=>(ie.saveInds[Q]={name:"SMA",pane_id:i().editPaneId,smaGroups:s($n).map(Pe=>({...Pe}))},ie)),console.log("✅ SMA indicators updated successfully")}catch(A){console.error("❌ Error updating SMA indicator:",A)}}function jl(){if(!s(Ac))return;const b=s($n).length>0?s($n)[s($n).length-1].period+10:20,k=["#FF6C37","#2563eb","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],T=k[s($n).length%k.length],A={id:zi(),name:"SMA",period:b,color:T,thickness:2,lineStyle:"solid"};if(s($n).push(A),o()){o().createIndicator({name:"SMA",calcParams:[A.period],styles:{lines:[{color:A.color,size:A.thickness,style:Ke.Solid,dashedValue:[2,2]}]}},!0,{id:i().editPaneId});const $=`${i().editPaneId}_SMA`;c.update(E=>(E.saveInds[$]={name:"SMA",pane_id:i().editPaneId,smaGroups:s($n).map(Q=>({...Q}))},E))}console.log("➕ Added new SMA group:",A)}function gc(b){var k,T;if(!(!s(Ac)||s($n).length<=1||b<0||b>=s($n).length)&&(console.log("🗑️ Removing SMA group at index:",b),s($n).splice(b,1),o()))try{const $=((k=o())==null?void 0:k.getIndicators()).filter(Q=>Q.name==="SMA");for(const Q of $)(T=o())==null||T.removeIndicator({paneId:Q.paneId,name:"SMA"});s($n).forEach(Q=>{var rt;let ie=Ke.Solid,Pe=[2,2];Q.lineStyle==="dashed"?(ie=Ke.Dashed,Pe=[8,4]):Q.lineStyle==="dotted"&&(ie=Ke.Dashed,Pe=[2,2]),(rt=o())==null||rt.createIndicator({name:"SMA",calcParams:[Q.period],styles:{lines:[{color:Q.color,size:Q.thickness,style:ie,dashedValue:Pe}]}},!0,{id:i().editPaneId})});const E=`${i().editPaneId}_SMA`;c.update(Q=>(s($n).length>0?Q.saveInds[E]={name:"SMA",pane_id:i().editPaneId,smaGroups:s($n).map(ie=>({...ie}))}:delete Q.saveInds[E],Q)),console.log("✅ SMA group removed and chart updated")}catch(A){console.error("❌ Error removing SMA group:",A)}}function Qi(){var b,k;if(s(Ac)){console.log("🔧 SMA Confirm: Saving",s($n).length,"SMA groups");try{const T=(b=o())==null?void 0:b.getIndicators(),A=(T==null?void 0:T.filter(E=>E.name==="SMA"))||[];for(const E of A)(k=o())==null||k.removeIndicator({paneId:E.paneId,name:"SMA"});s($n).forEach(E=>{var Pe;let Q=Ke.Solid,ie=[2,2];E.lineStyle==="dashed"?(Q=Ke.Dashed,ie=[8,4]):E.lineStyle==="dotted"&&(Q=Ke.Dashed,ie=[2,2]),(Pe=o())==null||Pe.createIndicator({name:"SMA",calcParams:[E.period],styles:{lines:[{color:E.color,size:E.thickness,style:Q,dashedValue:ie}]}},!0,{id:i().editPaneId}),console.log("✅ Created SMA with period:",E.period)});const $=`${i().editPaneId}_SMA`;c.update(E=>(E.saveInds[$]={name:"SMA",pane_id:i().editPaneId,smaGroups:s($n).map(Q=>({...Q}))},console.log("💾 Saved",s($n).length,"SMA groups to:",$),E)),console.log("✅ SMA confirm completed successfully"),l.update(E=>(E.editIndName="",E.editPaneId="",E.modalIndCfg=!1,E))}catch(T){console.error("❌ Error in SMA confirm:",T)}}}function Kd(){if(!s(ea))return;const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k].name==="BBI").sort((k,T)=>k===`${i().editPaneId}_BBI`?-1:T===`${i().editPaneId}_BBI`?1:k.localeCompare(T));console.log("🔍 Found existing BBI keys:",b),b.length>0?(x(B,N([])),b.forEach((k,T)=>{const A=r().saveInds[k];if(A){const $=A.pane_id||k.replace("_BBI","");if(A.bbiGroup){const E={...A.bbiGroup};E.paneId||(E.paneId=$),s(B).push(E)}else A.params&&A.params.length===4&&s(B).push({id:zi(),name:`BBI${T+1}`,paneId:$,period1:A.params[0]||3,period2:A.params[1]||6,period3:A.params[2]||12,period4:A.params[3]||24,color:"#8B5CF6",thickness:1,lineStyle:"solid"})}}),console.log("✅ Loaded",s(B).length,"existing BBI groups")):s(B).length===0&&(x(B,N([{id:zi(),name:"BBI",paneId:i().editPaneId,period1:3,period2:6,period3:12,period4:24,color:"#8B5CF6",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default BBI group"))}function Gc(){if(!s(ea))return;const b=`pane_BBI_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,k=s(B).length+1,T={id:zi(),name:`BBI${k}`,paneId:b,period1:3,period2:6,period3:12,period4:24,color:"#8B5CF6",thickness:1,lineStyle:"solid"};if(s(B).push(T),o()){const $=(Q=>{switch(Q){case"dashed":return{style:Ke.Dashed,dashedValue:[4,4]};case"dotted":return{style:Ke.Dashed,dashedValue:[2,2]};default:return{style:Ke.Solid,dashedValue:[2,2]}}})(T.lineStyle);if(o().createIndicator({name:"BBI",calcParams:[T.period1,T.period2,T.period3,T.period4],styles:{lines:[{color:T.color,size:T.thickness,style:$.style,dashedValue:$.dashedValue}]}},!1,{id:b})){const Q=`${b}_BBI`;c.update(ie=>(ie.saveInds[Q]={name:"BBI",pane_id:b,params:[T.period1,T.period2,T.period3,T.period4],bbiGroup:T},ie))}}console.log("➕ Added new BBI group in new pane:",T.id,b)}function Wl(b){var $;if(!s(ea)||s(B).length<=1)return;const k=s(B).findIndex(E=>E.id===b);if(k===-1)return;const T=s(B)[k];console.log("🗑️ Removing BBI group at index:",k,"ID:",b,"paneId:",T.paneId);const A=T.paneId||(k===0?i().editPaneId:null);if(o()&&A){try{console.log("🗑️ Removing BBI from pane:",A),($=o())==null||$.removeIndicator({paneId:A,name:"BBI"}),console.log("✅ Successfully removed BBI from pane:",A)}catch(E){console.log("❌ Error removing BBI indicator from pane:",A,E)}c.update(E=>{const Q=`${A}_BBI`;return console.log("🧹 Cleaning saved state key:",Q),delete E.saveInds[Q],E})}else console.log("❌ Cannot remove BBI: no valid paneId found for group:",T);x(B,N(s(B).filter(E=>E.id!==b))),console.log("✅ BBI group removed from array. Remaining groups:",s(B).length)}function Fc(){if(!s(Le))return;const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k].name==="TRIX").sort((k,T)=>k===`${i().editPaneId}_TRIX`?-1:T===`${i().editPaneId}_TRIX`?1:k.localeCompare(T));console.log("🔍 Found existing TRIX keys:",b),b.length>0?(x(Po,N([])),b.forEach((k,T)=>{const A=r().saveInds[k];if(A)if(A.trixGroup){const $={...A.trixGroup};$.paneId||($.paneId=A.pane_id||i().editPaneId),s(Po).push($)}else A.params&&A.params.length>=2&&s(Po).push({id:zi(),name:`TRIX${T+1}`,trixPeriod:A.params[0]||15,signalPeriod:A.params[1]||9,paneId:A.pane_id||i().editPaneId,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}})}),console.log("✅ Loaded",s(Po).length,"existing TRIX groups")):s(Po).length===0&&(x(Po,N([{id:zi(),name:"TRIX",trixPeriod:15,signalPeriod:9,paneId:i().editPaneId,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default TRIX group"))}function zc(){if(!s(Le))return;const b=`pane_TRIX_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,k={id:zi(),name:`TRIX${s(Po).length+1}`,trixPeriod:15,signalPeriod:9,paneId:b,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}};if(s(Po).push(k),o()){let T=Ke.Solid,A=[2,2],$=Ke.Solid,E=[2,2];if(k.styles.trix.lineStyle==="dashed"?(T=Ke.Dashed,A=[4,4]):k.styles.trix.lineStyle==="dotted"&&(T=Ke.Dashed,A=[2,2]),k.styles.signal.lineStyle==="dashed"?($=Ke.Dashed,E=[4,4]):k.styles.signal.lineStyle==="dotted"&&($=Ke.Dashed,E=[2,2]),o().createIndicator({name:"TRIX",calcParams:[k.trixPeriod,k.signalPeriod],styles:{lines:[{color:k.styles.trix.color,size:k.styles.trix.thickness,style:T,dashedValue:A},{color:k.styles.signal.color,size:k.styles.signal.thickness,style:$,dashedValue:E}]}},!1,{id:b})){const ie=`${b}_TRIX`;c.update(Pe=>(Pe.saveInds[ie]={name:"TRIX",pane_id:b,params:[k.trixPeriod,k.signalPeriod]},Pe))}}console.log("➕ Added new TRIX group in new pane:",k.id,b)}function gu(b){if(!s(Le)||s(Po).length<=1||b<0||b>=s(Po).length)return;console.log("🗑️ Removing TRIX group at index:",b);const T=s(Po)[b].paneId||i().editPaneId,A=s(Po).length;if(s(Po).splice(b,1),console.log(`📝 Removed group: ${A} -> ${s(Po).length}`),o()&&T)try{console.log("🗑️ Removing TRIX from pane:",T),rc(T,"TRIX")}catch($){console.error("❌ Error removing TRIX indicator:",$)}console.log("✅ TRIX group removed. Remaining groups:",s(Po).length)}function ku(){if(!s(cc))return;const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k].name==="BIAS").sort((k,T)=>k===`${i().editPaneId}_BIAS`?-1:T===`${i().editPaneId}_BIAS`?1:k.localeCompare(T));console.log("🔍 Found existing BIAS keys:",b),b.length>0?(x(Un,N([])),b.forEach((k,T)=>{const A=r().saveInds[k];A&&(A.biasGroup?s(Un).push({...A.biasGroup}):A.params&&A.params.length>=1&&s(Un).push({id:zi(),name:`BIAS${T+1}`,period:A.params[0]||6,color:"#2196F3",thickness:1,lineStyle:"solid"}))}),console.log("✅ Loaded",s(Un).length,"existing BIAS groups")):s(Un).length===0&&(x(Un,N([{id:zi(),name:"BIAS",period:6,color:"#2196F3",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default BIAS group"))}function Md(){var T;if(!s(cc)||!o())return;console.log("🔄 Applying BIAS changes in real-time, groups:",s(Un).length);const b=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="BIAS").sort((A,$)=>A===`${i().editPaneId}_BIAS`?-1:$===`${i().editPaneId}_BIAS`?1:A.localeCompare($));console.log("🔍 Existing BIAS keys:",b);const k=s(Un).length;if(b.length>k){console.log(`🗑️ Removing ${b.length-k} excess BIAS indicators`);for(let A=k;A<b.length;(A+=1)-1){const $=b[A],E=r().saveInds[$];if(E&&E.pane_id){console.log("🗑️ Removing BIAS indicator from pane:",E.pane_id);try{(T=o())==null||T.removeIndicator({paneId:E.pane_id,name:"BIAS"})}catch(Q){console.log("Error removing excess BIAS indicator:",Q)}}}}s(Un).forEach((A,$)=>{var ie,Pe,rt;const E=[A.period],Q={lines:[{color:A.color,size:A.thickness,style:A.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:A.lineStyle==="dashed"?[4,4]:A.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if($===0)console.log("🔄 Updating first BIAS indicator in pane:",i().editPaneId),(ie=o())==null||ie.overrideIndicator({name:"BIAS",calcParams:E,styles:Q,paneId:i().editPaneId});else{const gn=`pane_BIAS_${$+1}_BIAS`,cn=b.find(Gt=>Gt===gn);if(cn){const Gt=r().saveInds[cn];Gt&&Gt.pane_id&&(console.log(`🔄 Updating existing BIAS ${$+1} in pane:`,Gt.pane_id),(Pe=o())==null||Pe.overrideIndicator({name:"BIAS",calcParams:E,styles:Q,paneId:Gt.pane_id}))}else{const Gt=`pane_BIAS_${$+1}`;console.log(`🆕 Creating new BIAS ${$+1} with pane ID:`,Gt),(rt=o())==null||rt.createIndicator({name:"BIAS",calcParams:E,styles:Q},!0,{id:Gt})}}}),c.update(A=>(Object.keys(A.saveInds).forEach($=>{A.saveInds[$].name==="BIAS"&&delete A.saveInds[$]}),s(Un).forEach(($,E)=>{const Q=E===0?`${i().editPaneId}_BIAS`:`pane_BIAS_${E+1}_BIAS`,ie=E===0?i().editPaneId:`pane_BIAS_${E+1}`;console.log(`💾 Saving BIAS group ${E+1} with key:`,Q),A.saveInds[Q]={name:"BIAS",biasGroup:$,pane_id:ie,groupIndex:E,biasGroups:E===0?[...s(Un)]:void 0,params:[$.period]}}),A))}function gp(b){if(!s(cc)||s(Un).length<=1)return;const k=s(Un).findIndex(T=>T.id===b);k!==-1&&(console.log("🗑️ Removing BIAS group at index:",k,"ID:",b),x(Un,N(s(Un).filter(T=>T.id!==b))),Md(),console.log("✅ BIAS group removed. Remaining groups:",s(Un).length))}function $p(){if(!s(ro))return;const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k].name==="CCI").sort((k,T)=>k===`${i().editPaneId}_CCI`?-1:T===`${i().editPaneId}_CCI`?1:k.localeCompare(T));if(console.log("🔍 Found existing CCI keys:",b),b.length>0){x(Bn,N([]));let k=1;b.forEach((T,A)=>{const $=r().saveInds[T];if($)if($.cciGroup){const E={...$.cciGroup};E.name=k===1?"CCI":`CCI${k}`,s(Bn).push(E),k+=1}else $.params&&$.params.length>=1&&(s(Bn).push({id:zi(),name:k===1?"CCI":`CCI${k}`,period:$.params[0]||14,color:"#FF9800",thickness:1,lineStyle:"solid"}),k+=1)}),console.log("✅ Loaded",s(Bn).length,"existing CCI groups with proper naming")}else s(Bn).length===0&&(x(Bn,N([{id:zi(),name:"CCI",period:14,color:"#FF9800",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default CCI group"))}function hp(){if(!s(ro)||!o())return;console.log("🔄 Applying CCI changes in real-time, groups:",s(Bn).length);const b=Object.keys(r().saveInds).filter(E=>r().saveInds[E].name==="CCI").sort((E,Q)=>E===`${i().editPaneId}_CCI`?-1:Q===`${i().editPaneId}_CCI`?1:E.localeCompare(Q));console.log("🔍 Existing CCI keys:",b);const k=new Map,T=new Set;s(Bn).forEach((E,Q)=>{let ie=null;for(const Pe of b){if(T.has(Pe))continue;const rt=r().saveInds[Pe];if(rt&&rt.cciGroup&&rt.cciGroup.id===E.id){ie=Pe,T.add(Pe);break}}if(!ie){if(Q===0&&!T.has(`${i().editPaneId}_CCI`))ie=`${i().editPaneId}_CCI`;else{let Pe=2;for(;T.has(`pane_CCI_${Pe}_CCI`)||b.includes(`pane_CCI_${Pe}_CCI`);)Pe+=1;ie=`pane_CCI_${Pe}_CCI`}T.add(ie)}k.set(E.id,ie)});const A=Array.from(k.values()),$=b.filter(E=>!A.includes(E));$.forEach(E=>{var ie;const Q=r().saveInds[E];if(Q&&Q.pane_id){console.log("🗑️ Removing CCI indicator from pane:",Q.pane_id,"key:",E);try{(ie=o())==null||ie.removeIndicator({paneId:Q.pane_id,name:"CCI"})}catch(Pe){console.log("Error removing excess CCI indicator:",Pe)}}}),s(Bn).forEach((E,Q)=>{var cn,Gt;const ie=[E.period],Pe=k.get(E.id),rt={lines:[{color:E.color,size:E.thickness,style:E.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:E.lineStyle==="dashed"?[4,4]:E.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},gn=b.includes(Pe)?r().saveInds[Pe]:null;if(gn&&gn.pane_id)console.log("🔄 Updating existing CCI in pane:",gn.pane_id),(cn=o())==null||cn.overrideIndicator({name:"CCI",calcParams:ie,styles:rt,paneId:gn.pane_id});else{const eo=Pe===`${i().editPaneId}_CCI`?i().editPaneId:Pe.replace("_CCI","");console.log("🆕 Creating new CCI with pane ID:",eo,"key:",Pe),(Gt=o())==null||Gt.createIndicator({name:"CCI",calcParams:ie,styles:rt},!0,{id:eo})}}),c.update(E=>($.forEach(Q=>{delete E.saveInds[Q],console.log("🗑️ Deleted save data for key:",Q)}),s(Bn).forEach((Q,ie)=>{const Pe=k.get(Q.id),rt=Pe===`${i().editPaneId}_CCI`?i().editPaneId:Pe.replace("_CCI","");console.log(`💾 Saving CCI group ${ie+1} with key:`,Pe),E.saveInds[Pe]={name:"CCI",cciGroup:Q,pane_id:rt,groupIndex:ie,cciGroups:ie===0?[...s(Bn)]:void 0,params:[Q.period]}}),E))}function hv(b){if(!s(ro)||s(Bn).length<=1)return;const k=s(Bn).findIndex(T=>T.id===b);k!==-1&&(console.log("🗑️ Removing CCI group at index:",k,"ID:",b),x(Bn,N(s(Bn).filter(T=>T.id!==b))),hp(),console.log("✅ CCI group removed. Remaining groups:",s(Bn).length))}function tu(){if(!s(st))return;const k=Object.values(r().saveInds||{}).filter(T=>(T==null?void 0:T.name)==="SAR").filter(T=>(T==null?void 0:T.pane_id)==="candle_pane");if(k.length>0){const T=k[0];T.sarGroups&&Array.isArray(T.sarGroups)&&T.sarGroups.length>0?x(ms,N([...T.sarGroups])):x(ms,N(k.map(A=>{const[$=.02,E=.02,Q=.2]=A.params||[];return{id:zi(),start:$,increment:E,maxValue:Q,color:"#2563eb",dotSize:1}})))}else x(ms,N([{id:zi(),start:.02,increment:.02,maxValue:.2,color:"#2563eb",dotSize:1}]));o()&&s(ms).length>0&&Bu()}function _v(b){!s(st)||s(ms).length<=1||(x(ms,N(s(ms).filter(k=>k.id!==b))),Bu())}function yv(b){!s(st)||!o()||b>=s(ms).length||Bu()}function Bu(){if(!o()||!s(st))return;const b="candle_pane";for(let k=0;k<6;(k+=1)-1)try{o().removeIndicator({paneId:b,name:"SAR"})}catch{}s(ms).forEach(k=>{var $;const T=[k.start,k.increment,k.maxValue],A={lines:[{color:k.color,size:k.dotSize,style:Ke.Solid}]};($=o())==null||$.createIndicator({name:"SAR",calcParams:T,styles:A},!0,{id:b})})}function bv(){if(!s(Ys))return;const b=`${i().editPaneId}_SMARTTREND`,k=r().saveInds[b];if(k&&k.superTrendGroups&&k.superTrendGroups.length>0)x(Wo,N([...k.superTrendGroups]));else if(k&&Array.isArray(k.params)){const T=Number(k.params[0]??10),A=Number(k.params[1]??3);x(Wo,N([{id:zi(),period:T,multiplier:A,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]))}else s(Wo).length===0&&x(Wo,N([{id:zi(),period:10,multiplier:3,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]));_p()}function Hp(b){!s(Ys)||s(Wo).length<=1||(x(Wo,N(s(Wo).filter(k=>k.id!==b))),_p())}function Ou(b){!s(Ys)||!o()||b>=s(Wo).length||(s(Wo)[b],_p())}function _p(){if(!o()||!s(Ys))return;const b="candle_pane";for(let k=0;k<6;(k+=1)-1)try{o().removeIndicator({paneId:b,name:"SMARTTREND"})}catch{}s(Wo).forEach((k,T)=>{var E;const A=[k.period,k.multiplier],$={lines:[{color:k.styles.uptrend.color,size:k.styles.uptrend.thickness,style:k.styles.uptrend.lineStyle==="dashed"?Ke.Dashed:Ke.Solid}]};(E=o())==null||E.createIndicator({name:"SMARTTREND",calcParams:A,styles:$,extendData:{showLabels:k.showLabels,uptrendColor:k.styles.uptrend.color,downtrendColor:k.styles.downtrend.color,uptrendThickness:k.styles.uptrend.thickness,downtrendThickness:k.styles.downtrend.thickness,uptrendLineStyle:k.styles.uptrend.lineStyle,downtrendLineStyle:k.styles.downtrend.lineStyle}},!0,{id:b})}),c.update(k=>(Object.keys(k.saveInds).forEach(T=>{k.saveInds[T].name==="SMARTTREND"&&delete k.saveInds[T]}),s(Wo).forEach((T,A)=>{const $=A===0?`${b}_SMARTTREND`:`${b}_SMARTTREND_${A+1}`;k.saveInds[$]={name:"SMARTTREND",pane_id:b,params:[T.period,T.multiplier],superTrendGroup:T,groupIndex:A}}),k))}function du(){if(!s(ge))return;const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k].name==="DMI").sort((k,T)=>k===`${i().editPaneId}_DMI`?-1:T===`${i().editPaneId}_DMI`?1:k.localeCompare(T));if(console.log("🔍 Found existing DMI keys:",b),b.length>0){x(Yo,N([]));let k=1;b.forEach((T,A)=>{const $=r().saveInds[T];if($.dmiGroup){const E={...$.dmiGroup};E.name=k===1?"DMI":`DMI${k}`,s(Yo).push(E),k+=1}else $.params&&$.params.length>=2&&(s(Yo).push({id:zi(),name:k===1?"DMI":`DMI${k}`,diPeriod:$.params[0]||14,adxPeriod:$.params[1]||6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}),k+=1)}),console.log("✅ Loaded",s(Yo).length,"existing DMI groups with proper naming")}else s(Yo).length===0&&(x(Yo,N([{id:zi(),name:"DMI",diPeriod:14,adxPeriod:6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default DMI group"))}function ve(){if(!s(Ct))return;const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k].name==="CR").sort((k,T)=>k===`${i().editPaneId}_CR`?-1:T===`${i().editPaneId}_CR`?1:k.localeCompare(T));console.log("🔍 Found existing CR keys:",b),b.length>0?(x(Is,N([])),b.forEach((k,T)=>{var $,E,Q,ie,Pe;const A=r().saveInds[k];A.crGroup?s(Is).push({...A.crGroup}):s(Is).push({id:zi(),name:`CR${T+1}`,crPeriod:(($=A.params)==null?void 0:$[0])||26,crMa1Period:((E=A.params)==null?void 0:E[1])||10,crMa2Period:((Q=A.params)==null?void 0:Q[2])||20,crMa3Period:((ie=A.params)==null?void 0:ie[3])||40,crMa4Period:((Pe=A.params)==null?void 0:Pe[4])||60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}})}),console.log("✅ Loaded",s(Is).length,"existing CR groups")):s(Is).length===0&&(x(Is,N([{id:zi(),name:"CR",crPeriod:26,crMa1Period:10,crMa2Period:20,crMa3Period:40,crMa4Period:60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default CR group"))}function Bt(){if(!s(ge)||!o())return;console.log("🔄 Applying DMI changes in real-time, groups:",s(Yo).length);const b=Object.keys(r().saveInds).filter(E=>r().saveInds[E].name==="DMI").sort((E,Q)=>E===`${i().editPaneId}_DMI`?-1:Q===`${i().editPaneId}_DMI`?1:E.localeCompare(Q));console.log("🔍 Existing DMI keys:",b);const k=new Map,T=new Set;s(Yo).forEach((E,Q)=>{for(const ie of b){if(T.has(ie))continue;const Pe=r().saveInds[ie];if(Pe&&Pe.dmiGroup&&Pe.dmiGroup.id===E.id){k.set(E.id,ie),T.add(ie),console.log(`✅ Matched group ${Q+1} (ID: ${E.id}) to existing key: ${ie}`);break}}}),s(Yo).forEach((E,Q)=>{if(k.has(E.id))return;let ie=null;if(Q===0&&!T.has(`${i().editPaneId}_DMI`)&&!b.includes(`${i().editPaneId}_DMI`))ie=`${i().editPaneId}_DMI`;else{let Pe=2;for(;T.has(`pane_DMI_${Pe}_DMI`)||b.includes(`pane_DMI_${Pe}_DMI`);)Pe+=1;ie=`pane_DMI_${Pe}_DMI`}k.set(E.id,ie),T.add(ie),console.log(`🆕 Assigned new key for group ${Q+1} (ID: ${E.id}): ${ie}`)});const A=Array.from(k.values()),$=b.filter(E=>!A.includes(E));$.forEach(E=>{var ie;const Q=r().saveInds[E];if(Q&&Q.pane_id){console.log("🗑️ Removing DMI indicator from pane:",Q.pane_id,"key:",E);try{(ie=o())==null||ie.removeIndicator({paneId:Q.pane_id,name:"DMI"})}catch(Pe){console.log("Error removing excess DMI indicator:",Pe)}}}),s(Yo).forEach((E,Q)=>{var eo,Ss,La,Rl;const ie=[E.diPeriod,E.adxPeriod],Pe=k.get(E.id),rt=Q===0?i().editPaneId:`pane_DMI_${Q+1}`;console.log(`📍 Group ${Q+1} (ID: ${E.id}) -> Target pane: ${rt}, Save key: ${Pe}`);const gn={lines:[{color:E.styles.diPlus.color,size:E.styles.diPlus.thickness,style:E.styles.diPlus.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:E.styles.diPlus.lineStyle==="dashed"?[4,4]:E.styles.diPlus.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:E.styles.diMinus.color,size:E.styles.diMinus.thickness,style:E.styles.diMinus.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:E.styles.diMinus.lineStyle==="dashed"?[4,4]:E.styles.diMinus.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:E.styles.adx.color,size:E.styles.adx.thickness,style:E.styles.adx.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:E.styles.adx.lineStyle==="dashed"?[4,4]:E.styles.adx.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},cn=b.includes(Pe)?r().saveInds[Pe]:null,Gt=cn==null?void 0:cn.pane_id;if(Gt&&Gt!==rt){console.log(`🔀 Moving DMI from pane ${Gt} to ${rt}`);try{(eo=o())==null||eo.removeIndicator({paneId:Gt,name:"DMI"})}catch(pc){console.log("Note: Indicator may not exist in old pane:",pc)}(Ss=o())==null||Ss.createIndicator({name:"DMI",calcParams:ie,styles:gn},!0,{id:rt})}else Gt?(console.log(`🔄 Updating existing DMI in pane: ${rt}`),(La=o())==null||La.overrideIndicator({name:"DMI",calcParams:ie,styles:gn,paneId:rt})):(console.log(`🆕 Creating new DMI in pane: ${rt}`),(Rl=o())==null||Rl.createIndicator({name:"DMI",calcParams:ie,styles:gn},!0,{id:rt}))}),c.update(E=>($.forEach(Q=>{delete E.saveInds[Q],console.log("🗑️ Deleted save data for key:",Q)}),s(Yo).forEach((Q,ie)=>{const Pe=k.get(Q.id),rt=ie===0?i().editPaneId:`pane_DMI_${ie+1}`;console.log(`💾 Saving DMI group ${ie+1} with key: ${Pe}, pane: ${rt}`),E.saveInds[Pe]={name:"DMI",dmiGroup:Q,pane_id:rt,groupIndex:ie,dmiGroups:ie===0?[...s(Yo)]:void 0,params:[Q.diPeriod,Q.adxPeriod]}}),E))}function Wi(b){if(!s(ge)||s(Yo).length<=1)return;const k=s(Yo).findIndex(T=>T.id===b);k!==-1&&(console.log("🗑️ Removing DMI group at index:",k,"ID:",b),x(Yo,N(s(Yo).filter(T=>T.id!==b))),Bt(),console.log("✅ DMI group removed. Remaining groups:",s(Yo).length))}function js(){if(!s(Ct)||!o())return;console.log("🔄 Applying CR changes in real-time, groups:",s(Is).length);const b=Object.keys(r().saveInds).filter(E=>r().saveInds[E].name==="CR").sort((E,Q)=>E===`${i().editPaneId}_CR`?-1:Q===`${i().editPaneId}_CR`?1:E.localeCompare(Q));console.log("🔍 Existing CR keys:",b);const k=new Map,T=new Set;s(Is).forEach((E,Q)=>{let ie=null;for(const Pe of b){if(T.has(Pe))continue;const rt=r().saveInds[Pe];if(rt&&rt.crGroup&&rt.crGroup.id===E.id){ie=Pe,T.add(Pe);break}}if(!ie){if(Q===0&&!T.has(`${i().editPaneId}_CR`))ie=`${i().editPaneId}_CR`;else{let Pe=2;for(;T.has(`pane_CR_${Pe}_CR`)||b.includes(`pane_CR_${Pe}_CR`);)Pe+=1;ie=`pane_CR_${Pe}_CR`}T.add(ie)}k.set(E.id,ie)});const A=Array.from(k.values()),$=b.filter(E=>!A.includes(E));$.forEach(E=>{var ie;const Q=r().saveInds[E];if(Q&&Q.pane_id){console.log("🗑️ Removing CR indicator from pane:",Q.pane_id,"key:",E);try{(ie=o())==null||ie.removeIndicator({paneId:Q.pane_id,name:"CR"})}catch(Pe){console.log("Error removing excess CR indicator:",Pe)}}}),s(Is).forEach((E,Q)=>{var cn,Gt;const ie=[E.crPeriod,E.crMa1Period,E.crMa2Period,E.crMa3Period,E.crMa4Period],Pe=k.get(E.id),rt={lines:[{color:E.styles.cr.color,size:E.styles.cr.thickness,style:E.styles.cr.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:E.styles.cr.lineStyle==="dashed"?[4,4]:E.styles.cr.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:E.styles.ma1.color,size:E.styles.ma1.thickness,style:E.styles.ma1.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:E.styles.ma1.lineStyle==="dashed"?[4,4]:E.styles.ma1.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:E.styles.ma2.color,size:E.styles.ma2.thickness,style:E.styles.ma2.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:E.styles.ma2.lineStyle==="dashed"?[4,4]:E.styles.ma2.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:E.styles.ma3.color,size:E.styles.ma3.thickness,style:E.styles.ma3.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:E.styles.ma3.lineStyle==="dashed"?[4,4]:E.styles.ma3.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:E.styles.ma4.color,size:E.styles.ma4.thickness,style:E.styles.ma4.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:E.styles.ma4.lineStyle==="dashed"?[4,4]:E.styles.ma4.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},gn=b.includes(Pe)?r().saveInds[Pe]:null;if(gn&&gn.pane_id)console.log("🔄 Updating existing CR in pane:",gn.pane_id),(cn=o())==null||cn.overrideIndicator({name:"CR",calcParams:ie,styles:rt,paneId:gn.pane_id});else{const eo=Pe===`${i().editPaneId}_CR`?i().editPaneId:Pe.replace("_CR","");console.log("🆕 Creating new CR with pane ID:",eo,"key:",Pe),(Gt=o())==null||Gt.createIndicator({name:"CR",calcParams:ie,styles:rt},!0,{id:eo})}}),c.update(E=>($.forEach(Q=>{delete E.saveInds[Q],console.log("🗑️ Deleted save data for key:",Q)}),s(Is).forEach((Q,ie)=>{const Pe=k.get(Q.id),rt=Pe===`${i().editPaneId}_CR`?i().editPaneId:Pe.replace("_CR","");console.log(`💾 Saving CR group ${ie+1} with key:`,Pe),E.saveInds[Pe]={name:"CR",crGroup:Q,pane_id:rt,groupIndex:ie,crGroups:ie===0?[...s(Is)]:void 0,params:[Q.crPeriod,Q.crMa1Period,Q.crMa2Period,Q.crMa3Period,Q.crMa4Period]}}),E))}function er(b){if(!s(Ct)||s(Is).length<=1)return;const k=s(Is).findIndex(T=>T.id===b);k!==-1&&(console.log("🗑️ Removing CR group at index:",k,"ID:",b),x(Is,N(s(Is).filter(T=>T.id!==b))),js(),console.log("✅ CR group removed. Remaining groups:",s(Is).length))}function na(){if(!s(dt))return;const b=`${i().editPaneId}_ROC`,k=r().saveInds[b];k&&k.rocGroups&&k.rocGroups.length>0?(x(An,N([...k.rocGroups])),s(An).forEach((T,A)=>{T.paneId||(T.paneId=A===0?i().editPaneId:void 0)})):k&&k.rocGroup?(x(An,N([k.rocGroup])),s(An)[0]&&!s(An)[0].paneId&&(s(An)[0].paneId=i().editPaneId)):s(An).length===0&&x(An,N([{id:zi(),period:14,period2:21,paneId:i().editPaneId,styles:{roc:{color:"#2563eb",thickness:1,lineStyle:"solid"},roc2:{color:"#dc2626",thickness:1,lineStyle:"solid",visible:!1}}}]))}function cl(){var b;if(!(!o()||!s(dt)))try{const T=((b=o())==null?void 0:b.getIndicators()).filter(A=>A.name==="ROC");console.log("🔍 Detecting paneIds for ROC indicators:",T.length),T.forEach((A,$)=>{$<s(An).length&&!s(An)[$].paneId&&(s(An)[$].paneId=A.paneId,console.log(`📍 Set paneId ${A.paneId} for ROC group ${$}`))})}catch(k){console.error("❌ Error detecting ROC paneIds:",k)}}function zu(){var rt,gn;if(!s(dt)||!o())return;const b=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"],k=s(An).length%b.length,T={id:zi(),period:14,period2:21,paneId:void 0,styles:{roc:{color:b[k],thickness:1,lineStyle:"solid"},roc2:{color:b[(k+1)%b.length],thickness:1,lineStyle:"solid",visible:!1}}};s(An).push(T);const A=[T.period];let $=Ke.Solid,E=[2,2];T.styles.roc.lineStyle==="dashed"?($=Ke.Dashed,E=[4,4]):T.styles.roc.lineStyle==="dotted"&&($=Ke.Dashed,E=[2,2]);const Q={lines:[{color:T.styles.roc.color,size:T.styles.roc.thickness,style:$,dashedValue:E,smooth:!1}]},ie={name:"ROC",calcParams:A,styles:Q,figures:[{key:"roc",title:"ROC: ",type:"line"}]};let Pe;s(An).length===1?((rt=o())==null||rt.overrideIndicator({...ie,paneId:i().editPaneId}),Pe=i().editPaneId):Pe=(gn=o())==null?void 0:gn.createIndicator(ie,!1,{axis:{gap:{bottom:2}}}),T.paneId=Pe??void 0,c.update(cn=>{const Gt=`${i().editPaneId}_ROC`;return cn.saveInds[Gt]||(cn.saveInds[Gt]={name:"ROC",pane_id:i().editPaneId,params:[T.period],rocGroups:[]}),cn.saveInds[Gt].rocGroups||(cn.saveInds[Gt].rocGroups=[]),cn.saveInds[Gt].rocGroups=[...s(An)],cn})}function sp(b){var A,$;if(!s(dt)||s(An).length<=1)return;const k=s(An).findIndex(E=>E.id===b);if(k===-1)return;console.log("🗑️ Removing ROC group at index:",k,"with ID:",b);const T=s(An).length;if(s(An).splice(k,1),console.log(`📝 Removed ROC group: ${T} -> ${s(An).length}`),s(An).forEach((E,Q)=>{E.name=`ROC #${Q+1}`}),o())try{const Q=((A=o())==null?void 0:A.getIndicators()).filter(ie=>ie.name==="ROC");console.log("📈 ROC indicators found:",Q.length);for(const ie of Q)console.log("🗑️ Removing ROC from pane:",ie.paneId),($=o())==null||$.removeIndicator({paneId:ie.paneId,name:"ROC"});s(An).forEach((ie,Pe)=>{var eo;let rt=Ke.Solid,gn=[2,2];ie.styles.roc.lineStyle==="dashed"?(rt=Ke.Dashed,gn=[4,4]):ie.styles.roc.lineStyle==="dotted"&&(rt=Ke.Dashed,gn=[2,2]);const cn={lines:[{color:ie.styles.roc.color,size:ie.styles.roc.thickness,style:rt,dashedValue:gn}]};console.log("➕ Re-adding ROC group:",`ROC_${Pe+1}`,"at index:",Pe);const Gt=(eo=o())==null?void 0:eo.createIndicator({name:"ROC",calcParams:[ie.period],styles:cn,figures:[{key:"roc",title:"ROC: ",type:"line"}]},!1);Gt&&(ie.paneId=Gt,c.update(Ss=>{const La=`${Gt}_ROC`;return Ss.saveInds[La]||(Ss.saveInds[La]={name:"ROC",pane_id:Gt,rocGroups:[]}),Ss.saveInds[La].rocGroups||(Ss.saveInds[La].rocGroups=[]),Ss.saveInds[La].rocGroups[Pe]={...ie},Ss}))}),console.log("✅ Successfully updated ROC indicators on chart")}catch(E){console.error("❌ Error updating ROC indicators:",E)}console.log("✅ ROC group removed. Remaining groups:",s(An).length)}function Hu(b){var Q,ie;const k=s(An)[b];if(!k||!o()){console.warn("❌ updateRocIndicator: Missing group or chart",{group:k,chart:!!o()});return}console.log("🔄 updateRocIndicator called:",{groupIndex:b,group:k});let T=Ke.Solid,A=[2,2];k.styles.roc.lineStyle==="dashed"?(T=Ke.Dashed,A=[4,4]):k.styles.roc.lineStyle==="dotted"&&(T=Ke.Dashed,A=[2,2]);const E=((Q=o())==null?void 0:Q.getIndicators()).filter(Pe=>Pe.name==="ROC");if(console.log("📊 Found ROC indicators on chart:",E.length),console.log("📊 Looking for group index:",b),E.length>b){const Pe=E[b];console.log("✅ Found matching ROC indicator by index, updating styles...");const rt=(ie=o())==null?void 0:ie.overrideIndicator({name:"ROC",paneId:Pe.paneId,calcParams:[k.period],styles:{lines:[{color:k.styles.roc.color,size:k.styles.roc.thickness,style:T,dashedValue:A,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]});console.log("🎨 overrideIndicator result:",rt),console.log("🎨 Applied styles:",{color:k.styles.roc.color,size:k.styles.roc.thickness,style:T,dashedValue:A});const gn=`${Pe.paneId}_ROC`;console.log("💾 Using save key:",gn),c.update(cn=>{cn.saveInds[gn]||(cn.saveInds[gn]={name:"ROC",pane_id:Pe.paneId,params:[k.period],rocGroups:[]}),cn.saveInds[gn].rocGroups||(cn.saveInds[gn].rocGroups=[]);const Gt=cn.saveInds[gn].rocGroups||[];for(;Gt.length<=b;)Gt.push({});return Gt[b]={...k},cn.saveInds[gn].rocGroups=Gt,cn.saveInds[gn].params=[k.period],console.log("💾 Persisted ROC changes to save data:",gn,k),cn}),console.log("✅ ROC indicator updated successfully:",b,k)}else console.error("❌ ROC indicator not found on chart for group index:",b),console.log("📊 Available ROC indicators:",E.length),console.log("📊 Requested group index:",b)}function hu(){if(!s(pt))return;x(on,N([]));const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k].name==="PSY").sort((k,T)=>k===`${i().editPaneId}_PSY`?-1:T===`${i().editPaneId}_PSY`?1:k.localeCompare(T));b.length>0?x(on,N(b.map((k,T)=>{const A=r().saveInds[k];if(A.psyGroup)return{...A.psyGroup,id:A.psyGroup.id||zi(),actualPaneId:A.pane_id};if(A.psyGroups){const $=A.psyGroups[T]||A.psyGroups[0];return{...$,id:$.id||zi(),actualPaneId:A.pane_id}}else{const[$=12,E=6]=A.params||[12,6],Q=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"];return{id:zi(),psyPeriod:$,mapsyPeriod:E,showMapsy:!0,actualPaneId:A.pane_id,styles:{psy:{color:Q[T%Q.length],thickness:1,lineStyle:"solid"},mapsy:{color:Q[(T+1)%Q.length],thickness:1,lineStyle:"solid"}}}}}))):s(on).push({id:zi(),psyPeriod:12,mapsyPeriod:6,showMapsy:!0,styles:{psy:{color:"#2563eb",thickness:1,lineStyle:"solid"},mapsy:{color:"#dc2626",thickness:1,lineStyle:"solid"}}}),x(on,N(s(on).map(k=>({...k,id:k.id||zi()}))))}function Sp(){var $;if(!s(pt))return;const b=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"],k=s(on).length%b.length,T={id:zi(),psyPeriod:12,mapsyPeriod:6,showMapsy:!0,actualPaneId:void 0,styles:{psy:{color:b[k],thickness:1,lineStyle:"solid"},mapsy:{color:b[(k+1)%b.length],thickness:1,lineStyle:"solid"}}};if(s(on).push(T),s(on).length>1){let E=2;for(;Object.keys(r().saveInds).some(Ss=>Ss===`psy_${String(E).padStart(3,"0")}_PSY`);)E+=1;const Q=s(on).length-1,ie=[T.psyPeriod,T.mapsyPeriod],Pe=[{key:"psy",title:"PSY: ",type:"line"}];T.showMapsy&&Pe.push({key:"mapsy",title:"MAPSY: ",type:"line"});const rt={lines:[]};let gn=Ke.Solid,cn=[2,2];if(T.styles.psy.lineStyle==="dashed"?(gn=Ke.Dashed,cn=[4,4]):T.styles.psy.lineStyle==="dotted"&&(gn=Ke.Dashed,cn=[2,2]),rt.lines.push({color:T.styles.psy.color,size:T.styles.psy.thickness,style:gn,dashedValue:cn,smooth:!1}),T.showMapsy){let Ss=Ke.Solid,La=[2,2];T.styles.mapsy.lineStyle==="dashed"?(Ss=Ke.Dashed,La=[4,4]):T.styles.mapsy.lineStyle==="dotted"&&(Ss=Ke.Dashed,La=[2,2]),rt.lines.push({color:T.styles.mapsy.color,size:T.styles.mapsy.thickness,style:Ss,dashedValue:La,smooth:!1})}const Gt=`psy_${String(E).padStart(3,"0")}`;console.log(`🆕 Immediately creating PSY ${E} with pane ID:`,Gt),(($=o())==null?void 0:$.createIndicator({name:"PSY",calcParams:ie,styles:rt,figures:Pe},!1,{id:Gt,axis:{gap:{bottom:2}}}))&&(console.log(`✅ PSY ${E} created with pane ID:`,Gt),T.actualPaneId=Gt,c.update(Ss=>{const La=`psy_${String(E).padStart(3,"0")}_PSY`;return Ss.saveInds[La]={name:"PSY",psyGroup:T,pane_id:Gt,groupIndex:Q,params:[T.psyPeriod,T.mapsyPeriod]},Ss}))}else console.log("📝 New PSY group will be added to edit pane on confirm")}function dp(b){var T,A,$;if(!s(pt)||s(on).length<=1)return;const k=s(on).findIndex(E=>E.id===b);if(k!==-1){console.log("🗑️ Removing PSY group at index:",k,"ID:",b);try{if(k===0&&s(on).length>1){console.log("🔄 Special handling: First PSY removed, promoting second PSY to first position"),x(on,N(s(on).filter(Q=>Q.id!==b))),console.log("✅ PSY group removed from array. Remaining groups:",s(on).length);const E=s(on)[0];E.actualPaneId&&(console.log("🗑️ Removing old second PSY from sub-pane:",E.actualPaneId),(T=o())==null||T.removeIndicator({paneId:E.actualPaneId,name:"PSY"})),E.actualPaneId=void 0,console.log("📊 Updating PSY in edit pane with new first group settings"),Pl(0)}else{const E=`pane_PSY_${k+1}_PSY`;if(r().saveInds[E]){const Q=r().saveInds[E];console.log("🗑️ Removing PSY from pane:",Q.pane_id),(A=o())==null||A.removeIndicator({paneId:Q.pane_id,name:"PSY"}),console.log("✅ Successfully removed PSY from pane:",Q.pane_id)}else{const Q=s(on)[k];Q.actualPaneId&&(console.log("🗑️ Removing PSY from actual pane:",Q.actualPaneId),($=o())==null||$.removeIndicator({paneId:Q.actualPaneId,name:"PSY"}),console.log("✅ Successfully removed PSY from actual pane:",Q.actualPaneId))}x(on,N(s(on).filter(Q=>Q.id!==b))),console.log("✅ PSY group removed from array. Remaining groups:",s(on).length)}c.update(E=>(Object.keys(E.saveInds).forEach(Q=>{E.saveInds[Q].name==="PSY"&&(console.log("🧹 Cleaning saved state for key:",Q),delete E.saveInds[Q])}),s(on).forEach((Q,ie)=>{const Pe=ie===0?`${i().editPaneId}_PSY`:`pane_PSY_${ie+1}_PSY`,rt=ie===0?i().editPaneId:Q.actualPaneId||`pane_PSY_${ie+1}`;E.saveInds[Pe]={name:"PSY",psyGroup:Q,pane_id:rt,groupIndex:ie,psyGroups:ie===0?[...s(on)]:void 0,params:[Q.psyPeriod,Q.mapsyPeriod]},console.log("💾 Re-saved PSY group",ie,"with key:",Pe,"and pane ID:",rt)}),E))}catch(E){console.error("❌ Error removing PSY group:",E)}}}function Pl(b){var Pe;const k=s(on)[b];if(!k||!o())return;const T=b===0?i().editPaneId:k.actualPaneId||`psy_${String(b+1).padStart(3,"0")}`,A=[{key:"psy",title:"PSY: ",type:"line"}];k.showMapsy&&A.push({key:"mapsy",title:"MAPSY: ",type:"line"});const $={lines:[]};let E=Ke.Solid,Q=[2,2];if(k.styles.psy.lineStyle==="dashed"?(E=Ke.Dashed,Q=[4,4]):k.styles.psy.lineStyle==="dotted"&&(E=Ke.Dashed,Q=[2,2]),$.lines.push({color:k.styles.psy.color,size:k.styles.psy.thickness,style:E,dashedValue:Q,smooth:!1}),k.showMapsy){let rt=Ke.Solid,gn=[2,2];k.styles.mapsy.lineStyle==="dashed"?(rt=Ke.Dashed,gn=[4,4]):k.styles.mapsy.lineStyle==="dotted"&&(rt=Ke.Dashed,gn=[2,2]),$.lines.push({color:k.styles.mapsy.color,size:k.styles.mapsy.thickness,style:rt,dashedValue:gn,smooth:!1})}(Pe=o())==null||Pe.overrideIndicator({name:"PSY",paneId:T,styles:$,calcParams:[k.psyPeriod,k.mapsyPeriod],figures:A});const ie=b===0?`${i().editPaneId}_PSY`:`psy_${String(b+1).padStart(3,"0")}_PSY`;c.update(rt=>(rt.saveInds[ie]&&(rt.saveInds[ie].params=[k.psyPeriod,k.mapsyPeriod],rt.saveInds[ie].psyGroup={...k},console.log("💾 Persisted PSY changes to save data:",ie,k)),rt)),console.log("🔄 Updated PSY indicator:",b,k)}function pd(){if(!s(at))return;x(rn,N([]));const b=Object.entries(r().saveInds).filter(([k,T])=>T.name==="OBV");b.length>0?(b.sort(([k,T],[A,$])=>{const E=T.groupIndex||0,Q=$.groupIndex||0;return E-Q}),b.forEach(([k,T])=>{var $,E;const A=T;if(A.obvGroup){const Q=A.obvGroup;A.pane_id&&(Q.actualPaneId=A.pane_id),s(rn).push(Q)}else if(A.obvGroups&&A.obvGroups.length>0)x(rn,N([...A.obvGroups])),s(rn).forEach((Q,ie)=>{Q.actualPaneId||(ie===0?Q.actualPaneId=i().editPaneId:A.pane_id&&(Q.actualPaneId=A.pane_id))});else{const Q={id:zi(),obvPeriod:(($=A.params)==null?void 0:$[0])||30,maobvPeriod:((E=A.params)==null?void 0:E[1])||10,showMaobv:!0,actualPaneId:void 0,styles:{obv:{color:"#FF6B35",thickness:2,lineStyle:"solid"},maobv:{color:"#2196F3",thickness:1,lineStyle:"solid"}}};A.pane_id&&(Q.actualPaneId=A.pane_id),s(rn).push(Q)}})):s(rn).push({id:zi(),obvPeriod:30,maobvPeriod:10,showMaobv:!0,actualPaneId:i().editPaneId,styles:{obv:{color:"#FF6B35",thickness:2,lineStyle:"solid"},maobv:{color:"#2196F3",thickness:1,lineStyle:"solid"}}})}function pr(){if(!s(at))return;const b=["#FF6B35","#2196F3","#16a34a","#ca8a04","#9333ea","#c2410c"],k=s(rn).length%b.length,T={id:zi(),obvPeriod:30,maobvPeriod:10,showMaobv:!0,actualPaneId:void 0,styles:{obv:{color:b[k],thickness:2,lineStyle:"solid"},maobv:{color:b[(k+1)%b.length],thickness:1,lineStyle:"solid"}}},A=new Set;s(rn).forEach(Q=>{Q.actualPaneId&&A.add(Q.actualPaneId)}),Object.keys(r().saveInds).forEach(Q=>{r().saveInds[Q]&&r().saveInds[Q].name==="OBV"&&r().saveInds[Q].pane_id&&A.add(r().saveInds[Q].pane_id)}),console.log("🔍 Existing OBV pane IDs:",Array.from(A));let $=2;for(;A.has(`pane_OBV_${$}`);)$+=1;const E=`pane_OBV_${$}`;T.actualPaneId=E,console.log("✅ Adding new OBV group with pane ID:",E),s(rn).push(T),rr()}function Wa(b){var A;if(!s(at)||s(rn).length<=1)return;x(Lv,!0),console.log("🚫 Set obvRemovalInProgress = true");const k=s(rn).findIndex($=>$.id===b);if(k===-1){x(Lv,!1);return}const T=s(rn)[k];console.log("🗑️ Removing OBV group at index:",k,"ID:",b),console.log("🗑️ Group to remove:",T);try{let $;$=T.actualPaneId,$||Object.keys(r().saveInds).forEach(E=>{const Q=r().saveInds[E];Q&&Q.name==="OBV"&&Q.groupIndex===k&&($=Q.pane_id)}),!$&&k===0&&($=i().editPaneId),console.log("🗑️ Removing OBV at index",k,"from pane:",$),$&&(console.log("🗑️ Removing OBV indicator from pane:",$),(A=o())==null||A.removeIndicator({paneId:$,name:"OBV"}),console.log("✅ Successfully removed OBV from pane:",$)),x(rn,N(s(rn).filter(E=>E.id!==b))),console.log("✅ OBV group removed from array. Remaining groups:",s(rn).length),c.update(E=>{const Q=[];return Object.keys(E.saveInds).forEach(ie=>{E.saveInds[ie]&&E.saveInds[ie].name==="OBV"&&Q.push(ie)}),console.log("🧹 Clearing all OBV save data:",Q),Q.forEach(ie=>delete E.saveInds[ie]),s(rn).forEach((ie,Pe)=>{const rt=ie.actualPaneId||i().editPaneId;if(!rt){console.error(`❌ No pane ID for OBV group ${Pe} during removal cleanup`);return}const gn=`${rt}_OBV`;E.saveInds[gn]={name:"OBV",obvGroup:ie,pane_id:rt,groupIndex:Pe,obvGroups:Pe===0?[...s(rn)]:void 0,params:[ie.obvPeriod,ie.maobvPeriod]},console.log("💾 Re-saved OBV group",Pe,"with key:",gn,"pane:",rt)}),E}),console.log("✅ OBV removal and reindexing completed"),setTimeout(()=>{x(Lv,!1),console.log("✅ Reset obvRemovalInProgress = false")},200)}catch($){console.error("❌ Error removing OBV group:",$)}}function rr(){if(!(!s(at)||!o()))try{console.log("🔄 Applying OBV changes to chart..."),console.log("🔧 Current OBV groups:",s(rn).length);const b=Object.keys(r().saveInds).filter(T=>r().saveInds[T]&&r().saveInds[T].name==="OBV");console.log("🔧 Existing OBV keys in save data:",b);const k=new Set;s(rn).forEach((T,A)=>{const $=T.actualPaneId||i().editPaneId;k.add($)}),console.log("🔧 Pane IDs that should exist:",Array.from(k)),b.forEach(T=>{var $;const A=r().saveInds[T];if(A&&A.pane_id&&!k.has(A.pane_id))try{console.log("🗑️ Removing stale OBV indicator from pane:",A.pane_id),($=o())==null||$.removeIndicator({paneId:A.pane_id,name:"OBV"})}catch(E){console.log("❌ Error removing stale OBV indicator:",E)}}),s(rn).forEach((T,A)=>{var Q,ie,Pe;const $=[T.obvPeriod,T.maobvPeriod],E={lines:[{color:T.styles.obv.color,size:T.styles.obv.thickness,style:T.styles.obv.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:T.styles.obv.lineStyle==="dashed"?[4,4]:T.styles.obv.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:T.styles.maobv.color,size:T.styles.maobv.thickness,style:T.styles.maobv.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:T.styles.maobv.lineStyle==="dashed"?[4,4]:T.styles.maobv.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(A===0){const rt=T.actualPaneId||i().editPaneId;T.actualPaneId||(T.actualPaneId=i().editPaneId),console.log("🔄 Updating first OBV in pane:",rt),(Q=o())==null||Q.overrideIndicator({name:"OBV",calcParams:$,styles:E,paneId:rt})}else{const rt=T.actualPaneId||`pane_OBV_${A+1}`;if(b.find(cn=>{const Gt=r().saveInds[cn];return Gt&&Gt.pane_id===rt}))console.log("🔄 Updating existing OBV in pane:",rt),(ie=o())==null||ie.overrideIndicator({name:"OBV",calcParams:$,styles:E,paneId:rt}),T.actualPaneId=rt;else{const cn=T.actualPaneId||`pane_OBV_${A+1}`;console.log("🆕 Creating new OBV in pane:",cn);const Gt=(Pe=o())==null?void 0:Pe.createIndicator({name:"OBV",calcParams:$,styles:E},!0,{id:cn,axis:{gap:{bottom:2}}});Gt&&(T.actualPaneId=cn,console.log("✅ Created new OBV indicator with ID:",Gt,"in pane:",cn))}}}),c.update(T=>{try{Object.keys(T.saveInds).forEach(A=>{T.saveInds[A]&&T.saveInds[A].name==="OBV"&&delete T.saveInds[A]}),s(rn).forEach((A,$)=>{try{const E=A.actualPaneId||i().editPaneId;if(!E){console.error(`❌ No pane ID for OBV group ${$}`);return}const Q=`${E}_OBV`,ie={name:"OBV",obvGroup:A,pane_id:E,groupIndex:$,obvGroups:$===0?[...s(rn)]:void 0,params:[A.obvPeriod,A.maobvPeriod]};T.saveInds[Q]=ie,console.log("💾 Saved OBV group",$,"with key:",Q,"and pane ID:",E)}catch(E){console.error(`❌ Error saving OBV group ${$}:`,E)}})}catch(A){console.error("❌ Error in OBV save operation:",A)}return T}),console.log("✅ OBV changes applied successfully")}catch(b){console.error("❌ Critical error in applyObv:",b)}}function Up(){if(!s(kn))return;console.log("🔄 Initializing KDJ groups for edit pane:",i().editPaneId);const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k].name==="KDJ").sort((k,T)=>k===`${i().editPaneId}_KDJ`?-1:T===`${i().editPaneId}_KDJ`?1:k.localeCompare(T));console.log("🔍 Found KDJ keys:",b),b.length>0?(x(fo,N([])),b.forEach((k,T)=>{const A=r().saveInds[k];if(console.log(`🔄 Loading KDJ group ${T+1} from key:`,k,A),A){if(A.kdjGroup){const $={...A.kdjGroup};T>0&&A.pane_id&&($.actualPaneId=A.pane_id),s(fo).push($)}else if(A.params&&A.params.length>=2){const $={id:zi(),kPeriod:A.params[0]||9,dPeriod:A.params[1]||3,actualPaneId:void 0,styles:{k:{color:"#FF6B35",thickness:1,lineStyle:"solid"},d:{color:"#2196F3",thickness:1,lineStyle:"solid"},j:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}};T>0&&A.pane_id&&($.actualPaneId=A.pane_id),s(fo).push($)}}}),console.log("✅ Loaded",s(fo).length,"existing KDJ groups")):s(fo).length===0&&(x(fo,N([{id:zi(),kPeriod:9,dPeriod:3,styles:{k:{color:"#FF6B35",thickness:1,lineStyle:"solid"},d:{color:"#2196F3",thickness:1,lineStyle:"solid"},j:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default KDJ group"))}function Qu(){var A;if(!s(kn))return;const b=["#FF6B35","#2196F3","#9C27B0","#16a34a","#ca8a04","#dc2626"],k=s(fo).length%b.length,T={id:zi(),kPeriod:9,dPeriod:3,actualPaneId:void 0,styles:{k:{color:b[k],thickness:1,lineStyle:"solid"},d:{color:b[(k+1)%b.length],thickness:1,lineStyle:"solid"},j:{color:b[(k+2)%b.length],thickness:1,lineStyle:"solid"}}};if(s(fo).push(T),s(fo).length>1){const $=Object.values(r().saveInds).filter(cn=>cn.name==="KDJ"&&cn.pane_id).map(cn=>cn.pane_id);let E=2;for(;$.includes(`pane_KDJ_${E}`);)E+=1;const Q=s(fo).length-1,ie=[T.kPeriod,T.dPeriod,3],Pe={lines:[{color:T.styles.k.color,size:T.styles.k.thickness,style:T.styles.k.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:T.styles.k.lineStyle==="dashed"?[4,4]:[2,2]},{color:T.styles.d.color,size:T.styles.d.thickness,style:T.styles.d.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:T.styles.d.lineStyle==="dashed"?[4,4]:[2,2]},{color:T.styles.j.color,size:T.styles.j.thickness,style:T.styles.j.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:T.styles.j.lineStyle==="dashed"?[4,4]:[2,2]}]},rt=`pane_KDJ_${E}`;console.log(`🆕 Immediately creating KDJ ${E} with pane ID:`,rt),((A=o())==null?void 0:A.createIndicator({name:"KDJ",calcParams:ie,styles:Pe},!1,{id:rt,axis:{gap:{bottom:2}}}))&&(console.log(`✅ KDJ ${E} created with pane ID:`,rt),T.actualPaneId=rt,c.update(cn=>{const Gt=`pane_KDJ_${E}_KDJ`;return cn.saveInds[Gt]={name:"KDJ",kdjGroup:T,pane_id:rt,groupIndex:Q,params:[T.kPeriod,T.dPeriod,3]},cn}))}}function nu(b){var E;const k=s(fo)[b];if(!k||!o())return;const T=b===0?i().editPaneId:k.actualPaneId||`pane_KDJ_${b+1}`,A={lines:[{color:k.styles.k.color,size:k.styles.k.thickness,style:k.styles.k.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:k.styles.k.lineStyle==="dashed"?[4,4]:[2,2]},{color:k.styles.d.color,size:k.styles.d.thickness,style:k.styles.d.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:k.styles.d.lineStyle==="dashed"?[4,4]:[2,2]},{color:k.styles.j.color,size:k.styles.j.thickness,style:k.styles.j.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:k.styles.j.lineStyle==="dashed"?[4,4]:[2,2]}]};(E=o())==null||E.overrideIndicator({name:"KDJ",paneId:T,styles:A,calcParams:[k.kPeriod,k.dPeriod,3]});const $=b===0?`${i().editPaneId}_KDJ`:`pane_KDJ_${b+1}_KDJ`;c.update(Q=>(Q.saveInds[$]&&(Q.saveInds[$].params=[k.kPeriod,k.dPeriod,3],Q.saveInds[$].kdjGroup={...k},console.log("💾 Persisted KDJ changes to save data:",$,k)),Q)),console.log("🔄 Updated KDJ indicator:",b,k)}let hc=ae(N([]));function Uu(){if(!s(Id)||s(hc).length>0)return;const b=`${i().editPaneId}_ICHIMOKU`,k=r().saveInds[b];if(k&&Array.isArray(k.ichimokuGroups)&&k.ichimokuGroups.length>0)x(hc,N(k.ichimokuGroups.map((T,A)=>{var $;return{id:T.id||zi(),name:T.name||`Ichimoku #${A+1}`,params:T.params||[9,26,52],styles:(($=T.styles)==null?void 0:$.map(E=>({color:E.color||"#2563eb",thickness:E.thickness??1,lineStyle:E.lineStyle||"solid"})))||[{color:"#ef4444",thickness:1,lineStyle:"solid"},{color:"#3b82f6",thickness:1,lineStyle:"solid"},{color:"#10b981",thickness:1,lineStyle:"solid"}]}})));else{const T=[p[0]||9,p[1]||26,p[2]||52],A=[0,1,2].map($=>{var E,Q,ie;return{color:((E=h[$])==null?void 0:E.color)||["#ef4444","#3b82f6","#10b981"][$]||"#2563eb",thickness:((Q=h[$])==null?void 0:Q.thickness)??1,lineStyle:((ie=h[$])==null?void 0:ie.lineStyle)||"solid"}});x(hc,N([{id:zi(),name:"Ichimoku #1",params:T,styles:A}]))}}function up(){var $;if(!s(Id))return;const b=s(hc).length+1,k=[["#ef4444","#3b82f6","#10b981"],["#f59e0b","#8b5cf6","#06b6d4"],["#22c55e","#e11d48","#0ea5e9"]],T=k[(b-1)%k.length],A={id:zi(),name:`Ichimoku #${b}`,params:[9,26,52],styles:[{color:T[0],thickness:1,lineStyle:"solid"},{color:T[1],thickness:1,lineStyle:"solid"},{color:T[2],thickness:1,lineStyle:"solid"}]};x(hc,N([...s(hc),A]));try{const E={lines:A.styles.map(ie=>({color:ie.color,size:ie.thickness,style:ie.lineStyle==="dashed"||ie.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:ie.lineStyle==="dashed"?[4,4]:ie.lineStyle==="dotted"?[2,2]:[2,2]}))};($=o())==null||$.createIndicator({name:"ICHIMOKU",calcParams:A.params,styles:E},!0,{id:i().editPaneId});const Q=`${i().editPaneId}_ICHIMOKU`;c.update(ie=>{var Pe;return ie.saveInds[Q]={name:"ICHIMOKU",pane_id:i().editPaneId,params:((Pe=s(hc)[0])==null?void 0:Pe.params)||[9,26,52],ichimokuGroups:s(hc).map(rt=>({...rt}))},ie})}catch(E){console.error("❌ Error adding Ichimoku group:",E)}}function Gu(b){var k,T,A;if(!(!s(Id)||!o()))try{const E=(((T=(k=o())==null?void 0:k.getIndicators)==null?void 0:T.call(k))||[]).filter(ie=>ie.name==="ICHIMOKU"&&ie.paneId===i().editPaneId);for(const ie of E)(A=o())==null||A.removeIndicator({paneId:ie.paneId,name:"ICHIMOKU"});s(hc).forEach(ie=>{var rt;const Pe={lines:ie.styles.map(gn=>({color:gn.color,size:gn.thickness,style:gn.lineStyle==="dashed"||gn.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:gn.lineStyle==="dashed"?[4,4]:gn.lineStyle==="dotted"?[2,2]:[2,2]}))};(rt=o())==null||rt.createIndicator({name:"ICHIMOKU",calcParams:ie.params,styles:Pe},!0,{id:i().editPaneId})});const Q=`${i().editPaneId}_ICHIMOKU`;c.update(ie=>{var Pe;return ie.saveInds[Q]={name:"ICHIMOKU",pane_id:i().editPaneId,params:((Pe=s(hc)[0])==null?void 0:Pe.params)||[9,26,52],ichimokuGroups:s(hc).map(rt=>({...rt}))},ie}),console.log("🔄 Updated Ichimoku groups")}catch($){console.error("❌ Error updating Ichimoku groups:",$)}}function Vu(b){if(s(Id)&&!(s(hc).length<=1)&&!(b<0||b>=s(hc).length))try{x(hc,N(s(hc).filter((k,T)=>T!==b))),Gu(0),console.log("🗑️ Removed Ichimoku group at index:",b)}catch(k){console.error("❌ Error removing Ichimoku group:",k)}}function Ep(){var b,k,T;if(!(!s(Id)||!o()))try{const $=(((k=(b=o())==null?void 0:b.getIndicators)==null?void 0:k.call(b))||[]).filter(Q=>Q.name==="ICHIMOKU"&&Q.paneId===i().editPaneId);for(const Q of $)(T=o())==null||T.removeIndicator({paneId:Q.paneId,name:"ICHIMOKU"});s(hc).forEach(Q=>{var Pe;const ie={lines:Q.styles.map(rt=>({color:rt.color,size:rt.thickness,style:rt.lineStyle==="dashed"||rt.lineStyle==="dotted"?Ke.Dashed:Ke.Solid,dashedValue:rt.lineStyle==="dashed"?[4,4]:rt.lineStyle==="dotted"?[2,2]:[2,2]}))};(Pe=o())==null||Pe.createIndicator({name:"ICHIMOKU",calcParams:Q.params,styles:ie},!0,{id:i().editPaneId})});const E=`${i().editPaneId}_ICHIMOKU`;c.update(Q=>{var ie;return Q.saveInds[E]={name:"ICHIMOKU",pane_id:i().editPaneId,params:((ie=s(hc)[0])==null?void 0:ie.params)||[9,26,52],ichimokuGroups:s(hc).map(Pe=>({...Pe}))},Q}),l.update(Q=>(Q.editIndName="",Q.editPaneId="",Q.modalIndCfg=!1,Q)),a(!1),console.log("✅ Ichimoku confirm applied")}catch(A){console.error("❌ Error confirming Ichimoku groups:",A)}}function vr(b){var T,A;if(!s(kn)||s(fo).length<=1)return;const k=s(fo).findIndex($=>$.id===b);if(k!==-1){console.log("🗑️ Removing KDJ group at index:",k,"ID:",b);try{if(k===0&&s(fo).length>1){console.log("🔄 Special handling: First KDJ removed, promoting second KDJ to first position"),x(fo,N(s(fo).filter(E=>E.id!==b))),console.log("✅ KDJ group removed from array. Remaining groups:",s(fo).length);const $=s(fo)[0];$.actualPaneId&&(console.log("🗑️ Removing old second KDJ from sub-pane:",$.actualPaneId),(T=o())==null||T.removeIndicator({paneId:$.actualPaneId,name:"KDJ"})),$.actualPaneId=void 0,console.log("📊 Updating KDJ in edit pane with new first group settings"),nu(0)}else{const $=s(fo)[k];$.actualPaneId&&(console.log("🗑️ Removing KDJ from actual pane:",$.actualPaneId),(A=o())==null||A.removeIndicator({paneId:$.actualPaneId,name:"KDJ"}),console.log("✅ Successfully removed KDJ from actual pane:",$.actualPaneId)),x(fo,N(s(fo).filter(E=>E.id!==b))),console.log("✅ KDJ group removed from array. Remaining groups:",s(fo).length)}c.update($=>(Object.keys($.saveInds).forEach(E=>{$.saveInds[E].name==="KDJ"&&(console.log("🧹 Cleaning saved state for key:",E),delete $.saveInds[E])}),s(fo).forEach((E,Q)=>{const ie=Q===0?`${i().editPaneId}_KDJ`:`pane_KDJ_${Q+1}_KDJ`,Pe=Q===0?i().editPaneId:E.actualPaneId||`pane_KDJ_${Q+1}`;console.log(`💾 Re-saving KDJ group ${Q+1} with key:`,ie,"pane ID:",Pe),$.saveInds[ie]={name:"KDJ",kdjGroup:E,pane_id:Pe,groupIndex:Q,kdjGroups:Q===0?[...s(fo)]:void 0,params:[E.kPeriod,E.dPeriod,3]}}),$)),console.log("🔄 KDJ groups reindexed successfully")}catch($){console.log("❌ Error removing KDJ indicator:",$)}}}function Sr(){var k,T;if(!s(dc))return;console.log("🔄 Initializing AO groups for edit pane:",i().editPaneId);const b=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="AO").sort((A,$)=>A===`${i().editPaneId}_AO`?-1:$===`${i().editPaneId}_AO`?1:A.localeCompare($));if(console.log("🔍 Found AO keys:",b),b.length>0)x(Oc,N([])),b.forEach((A,$)=>{const E=r().saveInds[A];console.log(`🔄 Loading AO group ${$+1} from key:`,A,E),E&&(E.aoGroup?s(Oc).push({...E.aoGroup}):E.params&&E.params.length===2&&s(Oc).push({id:zi(),shortPeriod:E.params[0]||5,longPeriod:E.params[1]||34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"}}}))}),console.log("✅ Loaded AO groups:",s(Oc).length);else{const A=Object.entries(r().saveInds).find(([$,E])=>E.name==="AO"&&$.includes(i().editPaneId||""));if(A){const[,$]=A;console.log("🔄 Found existing AO indicator, creating group from it"),x(Oc,N([{id:zi(),shortPeriod:((k=$.params)==null?void 0:k[0])||5,longPeriod:((T=$.params)==null?void 0:T[1])||34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"}}}]))}else console.log("🔄 Creating default AO group"),x(Oc,N([{id:zi(),shortPeriod:5,longPeriod:34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"}}}]))}}function ji(){if(!s(zr))return;const b=i().editPaneId||"candle_pane",k=Object.entries(r().saveInds).filter(([A,$])=>$&&$.name==="BOLL"&&$.pane_id===b);if(k.length>0){const A=k.sort(([$],[E])=>{var Pe,rt;const Q=(Pe=$.match(/_BOLL_(\d+)$/))!=null&&Pe[1]?parseInt($.match(/_BOLL_(\d+)$/)[1],10):1,ie=(rt=E.match(/_BOLL_(\d+)$/))!=null&&rt[1]?parseInt(E.match(/_BOLL_(\d+)$/)[1],10):1;return Q-ie});x(de,N(A.map(([$,E])=>{var Q,ie,Pe,rt,gn,cn,Gt;return{id:zi(),paneId:b,period:E.params&&E.params[0]||20,stdDev:E.params&&E.params[1]||2,styles:{fillColor:((Q=E.bollingerStyles)==null?void 0:Q.fillColor)||"#2196F3",fillOpacity:((ie=E.bollingerStyles)==null?void 0:ie.fillOpacity)??5,upperColor:((Pe=E.bollingerStyles)==null?void 0:Pe.upperColor)||"#f23645",middleColor:((rt=E.bollingerStyles)==null?void 0:rt.middleColor)||"#2962ff",lowerColor:((gn=E.bollingerStyles)==null?void 0:gn.lowerColor)||"#089981",thickness:((cn=E.bollingerStyles)==null?void 0:cn.thickness)||1,lineStyle:((Gt=E.bollingerStyles)==null?void 0:Gt.lineStyle)||"solid"}}})))}else x(de,N([{id:zi(),paneId:b,period:s(j)||20,stdDev:s(D)||2,styles:{fillColor:s(S)||"#2196F3",fillOpacity:s(P)??5,upperColor:s(I)||"#f23645",middleColor:s(C)||"#2962ff",lowerColor:s(M)||"#089981",thickness:s(F)||1,lineStyle:s(V)||"solid"}}]));const T=s(de)[0];T&&(x(j,N(T.period)),x(D,N(T.stdDev)),x(S,N(T.styles.fillColor)),x(P,N(T.styles.fillOpacity)),x(I,N(T.styles.upperColor)),x(C,N(T.styles.middleColor)),x(M,N(T.styles.lowerColor)),x(F,N(T.styles.thickness)),x(V,N(T.styles.lineStyle))),jn()}function Jc(){var T;if(!s(dc)||!o())return;console.log("🔄 Applying AO changes in real-time, groups:",s(Oc).length);const b=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="AO").sort((A,$)=>A===`${i().editPaneId}_AO`?-1:$===`${i().editPaneId}_AO`?1:A.localeCompare($));console.log("🔍 Existing AO keys:",b);const k=s(Oc).length;if(b.length>k){console.log(`🗑️ Removing ${b.length-k} excess AO indicators`);for(let A=k;A<b.length;(A+=1)-1){const $=b[A],E=r().saveInds[$];if(E&&E.pane_id){console.log("🗑️ Removing AO indicator from pane:",E.pane_id);try{(T=o())==null||T.removeIndicator({paneId:E.pane_id,name:"AO"})}catch(Q){console.log("Error removing excess AO indicator:",Q)}}}}s(Oc).forEach((A,$)=>{var ie,Pe,rt;const E=[A.shortPeriod,A.longPeriod],Q={bars:[{upColor:A.styles.increasing.color,downColor:A.styles.decreasing.color,noChangeColor:"#888888"}]};if($===0)console.log("🔄 Updating first AO indicator in pane:",i().editPaneId),(ie=o())==null||ie.overrideIndicator({name:"AO",calcParams:E,styles:Q,paneId:i().editPaneId});else{const gn=`pane_AO_${$+1}_AO`,cn=b.find(Gt=>Gt===gn);if(cn){const Gt=r().saveInds[cn];Gt&&Gt.pane_id&&(console.log(`🔄 Updating existing AO ${$+1} in pane:`,Gt.pane_id),(Pe=o())==null||Pe.overrideIndicator({name:"AO",calcParams:E,styles:Q,paneId:Gt.pane_id}))}else{const Gt=`pane_AO_${$+1}`;console.log(`🆕 Creating new AO ${$+1} with pane ID:`,Gt),(rt=o())==null||rt.createIndicator({name:"AO",calcParams:E,styles:Q},!0,{id:Gt})}}}),c.update(A=>(Object.keys(A.saveInds).forEach($=>{A.saveInds[$].name==="AO"&&delete A.saveInds[$]}),s(Oc).forEach(($,E)=>{const Q=E===0?`${i().editPaneId}_AO`:`pane_AO_${E+1}_AO`,ie=E===0?i().editPaneId:`pane_AO_${E+1}`;console.log(`💾 Saving AO group ${E+1} with key:`,Q),A.saveInds[Q]={name:"AO",aoGroup:$,pane_id:ie,groupIndex:E,aoGroups:E===0?[...s(Oc)]:void 0,params:[$.shortPeriod,$.longPeriod]}}),A))}function Wv(b){!s(dc)||s(Oc).length<=1||!s(Oc).find(T=>T.id===b)||(s(Oc).findIndex(T=>T.id===b),x(Oc,N(s(Oc).filter(T=>T.id!==b))),Jc())}function su(){const b=`${i().editPaneId}_CR`,k=r().saveInds[b];k&&(x(Tc,N(k.crPeriod||26)),x(Sl,N(k.crMa1Period||10)),x(Ks,N(k.crMa2Period||20)),x(ci,N(k.crMa3Period||40)),x(Lo,N(k.crMa4Period||60)),x(Zi,N(k.crColor||"#FF6B35")),x(Yt,N(k.crMa1Color||"#2196F3")),x(Xo,N(k.crMa2Color||"#4CAF50")),x(as,N(k.crMa3Color||"#FF9800")),x(Pi,N(k.crMa4Color||"#9C27B0")),x(As,N(k.crThickness||2)),x(Xs,N(k.crMa1Thickness||1)),x(Hr,N(k.crMa2Thickness||1)),x(Xl,N(k.crMa3Thickness||1)),x(Nd,N(k.crMa4Thickness||1)),x(Ru,N(k.crLineStyle||"solid")),x(Xc,N(k.crMa1LineStyle||"solid")),x(Vl,N(k.crMa2LineStyle||"solid")),x(_l,N(k.crMa3LineStyle||"solid")),x(Et,N(k.crMa4LineStyle||"solid")))}function Vc(b,k){return T=>{x(J,N(b)),x(Z,N(k)),x(W,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(R,!0)}}function dl(b){return k=>{x(Y,N(b)),x(se,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(G,!0)}}function Su(b,k){return T=>{x(re,N(b)),x(me,N(k)),x(ee,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(oe,!0)}}function Zd(b){return k=>{x(kt,N(b)),x(ct,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(Ye,!0)}}function qa(b,k){return T=>{x(Ec,N(b)),x(al,N(k)),x(zd,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(od,!0)}}function Gp(b,k){return T=>{x(it,b*3+k),x(Ge,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(Ze,!0)}}function xv(b,k){return T=>{if(x(yt,N(b)),x(xe,N(k)),x(Qe,N({x:T.clientX,y:T.clientY})),x(Pt,!0),s(nt).length>b&&(k==="histogram"||k==="histogram-down")){const A=s(nt)[b];k==="histogram"?A.styles.histogram.upColor=w(A.styles.histogram.upColor||"#26a69a",70):A.styles.histogram.downColor=w(A.styles.histogram.downColor||"#ef5350",70),si(b)}}}function Wu(b){return k=>{if(x(jt,N(b)),k.currentTarget&&k.currentTarget instanceof Element){const T=k.currentTarget.getBoundingClientRect();x(Je,N({x:T.left+T.width/2,y:T.bottom+5}))}else x(Je,N({x:window.innerWidth/2,y:window.innerHeight/2}));x(Ve,!0)}}function tf(b){return k=>{if(x(jt,N(b)),k.currentTarget&&k.currentTarget instanceof Element){const T=k.currentTarget.getBoundingClientRect();x(Ne,N({x:T.left+T.width/2,y:T.bottom+5}))}else x(Ne,N({x:window.innerWidth/2,y:window.innerHeight/2}));x(St,!0)}}function sv(b){return k=>{if(x(jt,N(b)),k.currentTarget&&k.currentTarget instanceof Element){const T=k.currentTarget.getBoundingClientRect();x(he,N({x:T.left+T.width/2,y:T.bottom+5}))}else x(he,N({x:window.innerWidth/2,y:window.innerHeight/2}));x(ue,!0)}}function Yp(b){return k=>{if(x(jt,N(b)),k.currentTarget&&k.currentTarget instanceof Element){const T=k.currentTarget.getBoundingClientRect();x(Wt,N({x:T.left+T.width/2,y:T.bottom+5}))}else x(Wt,N({x:window.innerWidth/2,y:window.innerHeight/2}));x(_t,!0)}}function _u(b,k){return T=>{x(zn,N(b)),x(un,N(k)),x(dn,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(Zt,!0)}}function wv(b){return k=>{x(fs,N(b)),x(no,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(On,!0)}}function ip(b){return k=>{x(Es,N(b)),x(So,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(ps,!0)}}function Np(b){return k=>{x(oo,N(b)),x(Ko,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(Qo,!0)}}function iv(b){return k=>{x(xa,N(b)),x(ba,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(fi,!0)}}function rv(b){return k=>{x(Fs,N(b)),x(Qs,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(Al,!0)}}function Cu(b){return k=>{x(ic,N(b)),x(Kl,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(_d,!0)}}function Pu(b){return k=>{x(Cd,N(b)),x(dd,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(Nl,!0)}}function av(b){return k=>{x(Lt,N(b)),x(wt,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(tt,!0)}}function Fv(b){return k=>{x(Xt,N(b)),x(qn,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(qt,!0)}}function We(b,k=0){return T=>{x(To,N(k)),x(vo,N(b)),x(Dl,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(fa,!0)}}function Uo(b){return k=>{x(Jo,N(b)),x(so,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(co,!0)}}function ls(b){return k=>{x(ra,N(b)),x(wr,N({x:window.innerWidth/2,y:window.innerHeight/2})),x(Os,!0)}}Lu(l,b=>b.modalIndCfg).subscribe(()=>{if(!i().editIndName)return;if(s(Id)){Uu();const T=d_.ICHIMOKU||[];m.splice(0,m.length,...T);return}if(s(At)){const A=`${i().editPaneId||"candle_pane"}_ZIGZAG`,$=Object.keys(r().saveInds).filter(Q=>{var ie;return Q.startsWith(A)&&((ie=r().saveInds[Q])==null?void 0:ie.name)==="ZIGZAG"}).sort((Q,ie)=>{const Pe=rt=>{const gn=rt.match(/_ZIGZAG(?:_(\d+))?$/);return gn&&gn[1]?parseInt(gn[1],10):1};return Pe(Q)-Pe(ie)});x(Ue,N([])),$.length>0?$.forEach(Q=>{var cn,Gt,eo,Ss;const ie=r().saveInds[Q],Pe=((Gt=(cn=ie==null?void 0:ie.styles)==null?void 0:cn.lines)==null?void 0:Gt[0])||{},rt=Array.isArray(Pe.dashedValue)?Pe.dashedValue.join(","):"",gn=Pe.style===Ke.Solid?"solid":rt==="2,6"?"dotted":"dashed";s(Ue).push({id:zi(),deviation:Number(((eo=ie==null?void 0:ie.params)==null?void 0:eo[0])??5),depth:Number(((Ss=ie==null?void 0:ie.params)==null?void 0:Ss[1])??5),styles:{color:Pe.color??"#2962FF",thickness:Number(Pe.size??2),lineStyle:gn}})}):x(Ue,N([{id:zi(),deviation:5,depth:5,styles:{color:"#2962FF",thickness:2,lineStyle:"solid"}}]));const E=s(Ue)[0];p.splice(0,p.length,E.deviation,E.depth),x(qs,N(E.styles.color)),x(ta,N(E.styles.thickness)),x(Nc,N(E.styles.lineStyle));return}if(s(rd)){yo();return}if(s(Zc)){wa();return}if(s(uo)){hr();return}if(s(hs)){Wn();return}if(s(Er)){ws();return}if(s(Sc)){Da();return}if(s(ea)){Kd();return}if(s(Le)){Fc();return}if(s(cc)){ku();return}if(s(ro)){$p();return}if(s(st)){tu();return}if(s(Ys)){bv();return}if(s(ge)){du();return}if(s(Ct)){ve();return}if(s(dt)){na();return}if(s(pt)){hu();return}if(s(at)){pd();return}if(s(kn)){Up();return}if(s(dc)){Sr();return}if(s(Ct)){su();return}if(s(zr)){ji();return}const b=`${i().editPaneId}_${i().editIndName}`,k=r().saveInds[b];if(k&&k.fields&&!s(zr))m.splice(0,m.length,...k.fields),p.splice(0,p.length,...k.params||[]),h.splice(0,h.length,...k.styles||[]);else{const T=d_[i().editIndName]||[];if(s(zr)){m.splice(0,m.length,...T);const A=T.map($=>$.default);p.splice(0,p.length,...A),k&&k.params&&k.params.length>=2&&(p[0]=k.params[0],p[1]=k.params[1])}else if(m.splice(0,m.length,...T),k&&k.params)p.splice(0,p.length,...k.params),h.splice(0,h.length,...k.styles||[]),(s(cu)||s(Cc))&&m.length>p.length&&m.splice(p.length,m.length-p.length);else{const A=T.filter($=>$.type!=="color").map($=>$.default);p.splice(0,p.length,...A)}}if(s(Le)){for(;h.length<2;)h.length===0?h.push({color:"#2563eb",thickness:1,lineStyle:"solid"}):h.push({color:"#dc2626",thickness:1,lineStyle:"solid"});for(;h.length>2;)h.pop()}else{for(;h.length<p.length;)h.push({color:"#2563eb",thickness:1,lineStyle:"solid"});for(;h.length>p.length;)h.pop()}}),Lu(l,b=>b.clearCciGroups).subscribe(b=>{b>0&&Io()}),Lu(l,b=>b.clearEmvGroups).subscribe(b=>{b>0&&ti()}),Lu(l,b=>b.clearMtmGroups).subscribe(b=>{b>0&&bi()}),Lu(l,b=>b.clearObvGroups).subscribe(b=>{b>0&&yl()}),Lu(l,b=>b.clearPsyGroups).subscribe(b=>{b>0&&uc()}),Lu(l,b=>b.clearPvtGroups).subscribe(b=>{b>0&&Ka()}),Lu(l,b=>b.clearRocGroups).subscribe(b=>{b>0&&bd()}),Lu(l,b=>b.clearVolGroups).subscribe(b=>{b>0&&ni()}),Lu(l,b=>b.clearWrGroups).subscribe(b=>{b>0&&Ca()});function ja(b){s(zr)||p.length<=1||(p.splice(b,1),m.splice(b,1),h.splice(b,1),s(cu)?el():s(Cc)&&Ji())}function Wr(){const b=o();if(!b)return;const k=[6],T=b.createIndicator({name:"BIAS",calcParams:k,createTooltipDataSource:({indicator:Q})=>{const ie=[Q.visible?1:0,2,3],Pe=b.getStyles().indicator.tooltip;return{icons:ie.map(gn=>Pe.features[gn])}}},!1,{axis:{gap:{bottom:2}}});if(!T)return;const A=T,$={name:"BIAS",pane_id:A,params:k},E=`${A}_BIAS`;c.update(Q=>(Q.saveInds[E]=$,Q)),a(!1)}function ka(){const b=o();if(!b)return;const k=[5,34],T=b.createIndicator({name:"AO",calcParams:k,createTooltipDataSource:({indicator:Q})=>{const ie=[Q.visible?1:0,2,3],Pe=b.getStyles().indicator.tooltip;return{icons:ie.map(gn=>Pe.features[gn])}}},!1,{axis:{gap:{bottom:2}}});if(T){const Q=b.getStyles();b.setStyles({...Q,indicator:{...Q.indicator,bars:[{upColor:"#8B5CF6",downColor:"#EF4444",noChangeColor:"#8B5CF6"}]}})}if(!T)return;const A=T,$={name:"AO",pane_id:A,params:k},E=`${A}_AO`;c.update(Q=>(Q.saveInds[E]=$,Q)),a(!1)}function bl(){const b=o();if(!b)return;const k=[14],T=b.createIndicator({name:"WR",calcParams:k,createTooltipDataSource:({indicator:Q})=>{const ie=[Q.visible?1:0,2,3],Pe=b.getStyles().indicator.tooltip;return{icons:ie.map(gn=>Pe.features[gn])}}},!1,{axis:{gap:{bottom:2}}});if(!T)return;const A=T,$={name:"WR",pane_id:A,params:k},E=`${A}_WR`;c.update(Q=>(Q.saveInds[E]=$,Q)),a(!1)}function yc(){const b=o();if(!b)return;const k=[15,9],T=b.createIndicator({name:"TRIX",calcParams:k,createTooltipDataSource:({indicator:Q})=>{const ie=[Q.visible?1:0,2,3],Pe=b.getStyles().indicator.tooltip;return{icons:ie.map(gn=>Pe.features[gn])}}},!1,{axis:{gap:{bottom:2}}});if(!T)return;const A=T,$={name:"TRIX",pane_id:A,params:k},E=`${A}_TRIX`;c.update(Q=>(Q.saveInds[E]=$,Q)),a(!1)}function la(){var T;if(!s(Ct))return;const b=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="CR").sort((A,$)=>A===`${i().editPaneId}_CR`?-1:$===`${i().editPaneId}_CR`?1:A.localeCompare($));console.log("🔧 Applying CR changes. Existing keys:",b),console.log("🔧 Current CR groups:",s(Is).length);const k=s(Is).length;if(b.length>k)for(let A=k;A<b.length;(A+=1)-1){const $=b[A],E=r().saveInds[$];try{console.log("🗑️ Removing excess CR indicator from pane:",E.pane_id),(T=o())==null||T.removeIndicator({paneId:E.pane_id,name:"CR"})}catch(Q){console.log("❌ Error removing excess CR indicator:",Q)}delete r().saveInds[$]}s(Is).forEach((A,$)=>{var ie,Pe,rt;const E=[A.crPeriod,A.crMa1Period,A.crMa2Period,A.crMa3Period,A.crMa4Period],Q={lines:[{color:A.styles.cr.color,size:A.styles.cr.thickness,style:A.styles.cr.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:A.styles.cr.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:A.styles.ma1.color,size:A.styles.ma1.thickness,style:A.styles.ma1.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:A.styles.ma1.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:A.styles.ma2.color,size:A.styles.ma2.thickness,style:A.styles.ma2.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:A.styles.ma2.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:A.styles.ma3.color,size:A.styles.ma3.thickness,style:A.styles.ma3.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:A.styles.ma3.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:A.styles.ma4.color,size:A.styles.ma4.thickness,style:A.styles.ma4.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:A.styles.ma4.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};if($===0)console.log("🔄 Updating first CR in pane:",i().editPaneId),(ie=o())==null||ie.overrideIndicator({name:"CR",calcParams:E,styles:Q,paneId:i().editPaneId});else{const gn=`pane_CR_${$+1}_CR`,cn=b.find(Gt=>Gt===gn);if(cn){const Gt=r().saveInds[cn];console.log("🔄 Updating existing CR in pane:",Gt.pane_id),(Pe=o())==null||Pe.overrideIndicator({name:"CR",calcParams:E,styles:Q,paneId:Gt.pane_id})}else{const Gt=`pane_CR_${$+1}`;console.log("🆕 Creating new CR in pane:",Gt);const eo=(rt=o())==null?void 0:rt.createIndicator({name:"CR",calcParams:E,styles:Q},!0,{id:Gt});console.log("✅ Created new CR indicator with ID:",eo,"in pane:",Gt)}}}),c.update(A=>(Object.keys(A.saveInds).forEach($=>{A.saveInds[$].name==="CR"&&delete A.saveInds[$]}),s(Is).forEach(($,E)=>{const Q=E===0?`${i().editPaneId}_CR`:`pane_CR_${E+1}_CR`,ie=E===0?i().editPaneId:`pane_CR_${E+1}`,Pe={name:"CR",crGroup:$,pane_id:ie,groupIndex:E,crGroups:E===0?[...s(Is)]:void 0,params:[$.crPeriod,$.crMa1Period,$.crMa2Period,$.crMa3Period,$.crMa4Period]};A.saveInds[Q]=Pe,console.log("💾 Saved CR group",E,"with key:",Q,"and pane ID:",ie)}),A)),l.update(A=>(A.editIndName="",A.editPaneId="",A.modalIndCfg=!1,A)),a(!1)}function fr(){s(Rc).forEach((b,k)=>{oi(k)}),c.update(b=>(Object.keys(b.saveInds).forEach(k=>{b.saveInds[k].name==="MACD"&&delete b.saveInds[k]}),s(Rc).forEach((k,T)=>{const A=T===0?`${i().editPaneId}_MACD`:`pane_MACD_${T+1}_MACD`,$=T===0?i().editPaneId:k.actualPaneId||`pane_MACD_${T+1}`;b.saveInds[A]={name:"MACD",macdGroup:k,pane_id:$,groupIndex:T,params:[k.fastPeriod,k.slowPeriod,k.signalPeriod]}}),b)),console.log("🔄 Clearing edit state and closing popup..."),l.update(b=>(b.editIndName="",b.editPaneId="",b.modalIndCfg=!1,console.log("✅ Context updated - modalIndCfg set to false"),b)),a(!1)}function Ll(){if(s(Er)){s(Bc).forEach((b,k)=>{b.paneId&&Ar(k)}),c.update(b=>{const k=`${i().editPaneId}_WR`,T={name:"WR",wrGroups:s(Bc),pane_id:i().editPaneId};return b.saveInds[k]=T,s(Bc).forEach((A,$)=>{const E=$===0?`${i().editPaneId}_WR_single`:`WR_${$+1}`,Q={name:"WR",wrGroup:A,pane_id:$===0?i().editPaneId:`new_pane_${$}`,groupIndex:$};b.saveInds[E]=Q}),b});try{console.log("🔄 Clearing edit state and closing popup..."),l.update(b=>(b.editIndName="",b.editPaneId="",b.modalIndCfg=!1,console.log("✅ Context updated - modalIndCfg set to false"),b)),a(!1),console.log("✅ Popup show flag set to false - handleKdjConfirm completed successfully")}catch(b){console.error("❌ Error in handleKdjConfirm:",b),console.log("🔄 Forcing popup close due to error..."),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1),console.log("✅ Popup forcefully closed after error")}}}function ao(){s(Sc)&&(s(qd).forEach((b,k)=>{var $;const T=[b.period,b.shortPeriod,b.longPeriod],A={lines:[{color:b.styles.vr.color,size:b.styles.vr.thickness,style:b.styles.vr.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:b.styles.vr.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:b.styles.vrShort.color,size:b.styles.vrShort.thickness,style:b.styles.vrShort.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:b.styles.vrShort.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:b.styles.vrLong.color,size:b.styles.vrLong.thickness,style:b.styles.vrLong.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:b.styles.vrLong.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};b.paneId&&(($=o())==null||$.overrideIndicator({name:"VR",calcParams:T,styles:A,paneId:b.paneId}),console.log(`✅ Updated VR indicator in pane: ${b.paneId}`))}),c.update(b=>(s(qd).forEach((k,T)=>{const A=`${k.paneId}_VR`,$={name:"VR",vrGroup:k,pane_id:k.paneId,params:[k.period,k.shortPeriod,k.longPeriod],groupIndex:T};b.saveInds[A]=$,console.log(`💾 Saved VR group to: ${A}`)}),b)),l.update(b=>(b.editIndName="",b.editPaneId="",b.modalIndCfg=!1,b)),a(!1))}function ul(){s(ce)&&(s(nt).forEach((b,k)=>{var $;const T=[b.period],A={bars:[{upColor:b.styles.histogram.upColor,downColor:b.styles.histogram.downColor,noChangeColor:b.styles.histogram.upColor}],lines:[{color:b.styles.ema.color,size:b.styles.ema.thickness,style:b.styles.ema.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:b.styles.ema.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1,visible:b.styles.ema.visible===!0}]};b.paneId&&(($=o())==null||$.overrideIndicator({name:"VOL",calcParams:T,styles:A,paneId:b.paneId}),console.log(`✅ Updated Volume indicator in pane: ${b.paneId}`))}),c.update(b=>(s(nt).forEach((k,T)=>{const A=`${k.paneId}_VOL`,$={name:"VOL",volGroup:k,pane_id:k.paneId,params:[k.period],groupIndex:T};b.saveInds[A]=$,console.log(`💾 Saved Volume group to: ${A}`)}),b)),l.update(b=>(b.editIndName="",b.editPaneId="",b.modalIndCfg=!1,b)),a(!1))}function Ic(){s(ea)&&(console.log("🔧 Applying BBI changes. Current BBI groups:",s(B).length),s(B).forEach((b,k)=>{var ie;const T=[b.period1,b.period2,b.period3,b.period4],$=(Pe=>{switch(Pe){case"dashed":return{style:Ke.Dashed,dashedValue:[4,4]};case"dotted":return{style:Ke.Dashed,dashedValue:[2,2]};default:return{style:Ke.Solid,dashedValue:[2,2]}}})(b.lineStyle),E={lines:[{color:b.color,size:b.thickness,style:$.style,dashedValue:$.dashedValue,smooth:!1}]},Q=b.paneId||(k===0?i().editPaneId:`pane_BBI_${k+1}`);console.log("🔄 Updating BBI group",k,"in pane:",Q),(ie=o())==null||ie.overrideIndicator({name:"BBI",calcParams:T,styles:E,paneId:Q}),b.paneId||(b.paneId=Q)}),c.update(b=>(Object.keys(b.saveInds).forEach(k=>{b.saveInds[k].name==="BBI"&&delete b.saveInds[k]}),s(B).forEach((k,T)=>{const A=`${k.paneId}_BBI`,$={name:"BBI",bbiGroup:k,pane_id:k.paneId,groupIndex:T,bbiGroups:T===0?[...s(B)]:void 0,params:[k.period1,k.period2,k.period3,k.period4]};b.saveInds[A]=$,console.log("💾 Saved BBI group",T,"with key:",A,"and pane ID:",k.paneId)}),b)),l.update(b=>(b.editIndName="",b.editPaneId="",b.modalIndCfg=!1,b)),a(!1))}function Ra(){var b;if(!s(uo)){console.warn("⚠️ handleEmvConfirm called but not in EMV mode");return}try{if(!s(Gn)||s(Gn).length===0){console.error("❌ No EMV groups to process");return}const k=s(Gn).filter($=>!(!$||typeof $!="object"||typeof $.period!="number"||$.period<=0||typeof $.period2!="number"||$.period2<=0||typeof $.color!="string"||!$.color||typeof $.thickness!="number"||$.thickness<=0||typeof $.lineStyle!="string"||!$.lineStyle));if(k.length===0){console.error("❌ No valid EMV groups found");return}k.length!==s(Gn).length&&(console.warn(`⚠️ ${s(Gn).length-k.length} invalid EMV groups filtered out`),x(Gn,N(k)));const T=Object.keys(r().saveInds).filter($=>r().saveInds[$]&&r().saveInds[$].name==="EMV").sort(($,E)=>$===`${i().editPaneId}_EMV`?-1:E===`${i().editPaneId}_EMV`?1:$.localeCompare(E));console.log("🔧 Applying EMV changes. Existing keys:",T),console.log("🔧 Current EMV groups:",s(Gn).length);const A=s(Gn).length;if(T.length>A)for(let $=A;$<T.length;($+=1)-1){const E=T[$],Q=r().saveInds[E];if(Q&&Q.pane_id)try{console.log("🗑️ Removing excess EMV indicator from pane:",Q.pane_id),(b=o())==null||b.removeIndicator({paneId:Q.pane_id,name:"EMV"})}catch(ie){console.log("❌ Error removing excess EMV indicator:",ie)}}s(Gn).forEach(($,E)=>{var Pe,rt,gn;const Q=[$.period,$.period2],ie={lines:[{color:$.color,size:$.thickness,style:$.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:$.lineStyle==="dashed"?[4,4]:$.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(E===0)console.log("🔄 Updating first EMV in pane:",i().editPaneId),(Pe=o())==null||Pe.overrideIndicator({name:"EMV",calcParams:Q,styles:ie,paneId:i().editPaneId});else{const cn=`pane_EMV_${E+1}_EMV`,Gt=T.find(eo=>eo===cn);if(Gt){const eo=r().saveInds[Gt];eo&&eo.pane_id&&(console.log("🔄 Updating existing EMV in pane:",eo.pane_id),(rt=o())==null||rt.overrideIndicator({name:"EMV",calcParams:Q,styles:ie,paneId:eo.pane_id}))}else{const eo=`pane_EMV_${E+1}`;console.log("🆕 Creating new EMV in pane:",eo);const Ss=(gn=o())==null?void 0:gn.createIndicator({name:"EMV",calcParams:Q,styles:ie},!0,{id:eo});Ss&&console.log("✅ Created new EMV indicator with ID:",Ss,"in pane:",eo)}}}),c.update($=>{try{Object.keys($.saveInds).forEach(E=>{$.saveInds[E]&&$.saveInds[E].name==="EMV"&&delete $.saveInds[E]}),s(Gn).forEach((E,Q)=>{try{const ie=Q===0?`${i().editPaneId}_EMV`:`pane_EMV_${Q+1}_EMV`,Pe=Q===0?i().editPaneId:`pane_EMV_${Q+1}`;if(!ie||!Pe){console.error(`❌ Invalid save key or pane ID for EMV group ${Q}`);return}const rt={name:"EMV",emvGroup:E,pane_id:Pe,groupIndex:Q,emvGroups:Q===0?[...s(Gn)]:void 0,params:[E.period,E.period2]};$.saveInds[ie]=rt,console.log("💾 Saved EMV group",Q,"with key:",ie,"and pane ID:",Pe)}catch(ie){console.error(`❌ Error saving EMV group ${Q}:`,ie)}})}catch(E){console.error("❌ Error in EMV save operation:",E)}return $}),l.update($=>($.editIndName="",$.editPaneId="",$.modalIndCfg=!1,$)),a(!1),console.log("✅ EMV configuration completed successfully")}catch(k){console.error("❌ Critical error in handleEmvConfirm:",k)}}function gi(){var b;if(!s(hs)){console.warn("⚠️ handleMtmConfirm called but not in MTM mode");return}try{if(!s(Ds)||s(Ds).length===0){console.error("❌ No MTM groups to process");return}const k=s(Ds).filter($=>!(!$||typeof $!="object"||typeof $.period!="number"||$.period<=0||typeof $.color!="string"||!$.color||typeof $.thickness!="number"||$.thickness<=0||typeof $.lineStyle!="string"||!$.lineStyle));if(k.length===0){console.error("❌ No valid MTM groups found");return}k.length!==s(Ds).length&&(console.warn(`⚠️ ${s(Ds).length-k.length} invalid MTM groups filtered out`),x(Ds,N(k)));const T=Object.keys(r().saveInds).filter($=>r().saveInds[$]&&r().saveInds[$].name==="MTM").sort(($,E)=>$===`${i().editPaneId}_MTM`?-1:E===`${i().editPaneId}_MTM`?1:$.localeCompare(E));console.log("🔧 Applying MTM changes. Existing keys:",T),console.log("🔧 Current MTM groups:",s(Ds).length);const A=s(Ds).length;if(T.length>A)for(let $=A;$<T.length;($+=1)-1){const E=T[$],Q=r().saveInds[E];if(Q&&Q.pane_id)try{console.log("🗑️ Removing excess MTM indicator from pane:",Q.pane_id),(b=o())==null||b.removeIndicator({paneId:Q.pane_id,name:"MTM"})}catch(ie){console.log("❌ Error removing excess MTM indicator:",ie)}}s(Ds).forEach(($,E)=>{var Pe,rt,gn;const Q=[$.period],ie={lines:[{color:$.color,size:$.thickness,style:$.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:$.lineStyle==="dashed"?[4,4]:$.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(E===0)console.log("🔄 Updating first MTM in pane:",i().editPaneId),(Pe=o())==null||Pe.overrideIndicator({name:"MTM",calcParams:Q,styles:ie,paneId:i().editPaneId});else{const cn=`pane_MTM_${E+1}_MTM`,Gt=T.find(eo=>eo===cn);if(Gt){const eo=r().saveInds[Gt];eo&&eo.pane_id&&(console.log("🔄 Updating existing MTM in pane:",eo.pane_id),(rt=o())==null||rt.overrideIndicator({name:"MTM",calcParams:Q,styles:ie,paneId:eo.pane_id}))}else{const eo=`pane_MTM_${E+1}`;console.log("🆕 Creating new MTM in pane:",eo);const Ss=(gn=o())==null?void 0:gn.createIndicator({name:"MTM",calcParams:Q,styles:ie},!0,{id:eo});Ss&&console.log("✅ Created new MTM indicator with ID:",Ss,"in pane:",eo)}}}),c.update($=>{try{Object.keys($.saveInds).forEach(E=>{$.saveInds[E]&&$.saveInds[E].name==="MTM"&&delete $.saveInds[E]}),s(Ds).forEach((E,Q)=>{try{const ie=Q===0?`${i().editPaneId}_MTM`:`pane_MTM_${Q+1}_MTM`,Pe=Q===0?i().editPaneId:`pane_MTM_${Q+1}`;if(!ie||!Pe){console.error(`❌ Invalid save key or pane ID for MTM group ${Q}`);return}const rt={name:"MTM",mtmGroup:E,pane_id:Pe,groupIndex:Q,mtmGroups:Q===0?[...s(Ds)]:void 0,params:[E.period]};$.saveInds[ie]=rt,console.log("💾 Saved MTM group",Q,"with key:",ie,"and pane ID:",Pe)}catch(ie){console.error(`❌ Error saving MTM group ${Q}:`,ie)}})}catch(E){console.error("❌ Error in MTM save operation:",E)}return $}),l.update($=>($.editIndName="",$.editPaneId="",$.modalIndCfg=!1,$)),a(!1),console.log("✅ MTM configuration completed successfully")}catch(k){console.error("❌ Critical error in handleMtmConfirm:",k)}}function Yc(){var T;if(!s(cc))return;const b=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="BIAS").sort((A,$)=>A===`${i().editPaneId}_BIAS`?-1:$===`${i().editPaneId}_BIAS`?1:A.localeCompare($));console.log("🔧 Applying BIAS changes. Existing keys:",b),console.log("🔧 Current BIAS groups:",s(Un).length);const k=s(Un).length;if(b.length>k)for(let A=k;A<b.length;(A+=1)-1){const $=b[A],E=r().saveInds[$];if(E&&E.pane_id)try{console.log("🗑️ Removing excess BIAS indicator from pane:",E.pane_id),(T=o())==null||T.removeIndicator({paneId:E.pane_id,name:"BIAS"})}catch(Q){console.log("❌ Error removing excess BIAS indicator:",Q)}}s(Un).forEach((A,$)=>{var ie,Pe,rt;const E=[A.period],Q={lines:[{color:A.color,size:A.thickness,style:A.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:A.lineStyle==="dashed"?[4,4]:A.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if($===0)console.log("🔄 Updating first BIAS in pane:",i().editPaneId),(ie=o())==null||ie.overrideIndicator({name:"BIAS",calcParams:E,styles:Q,paneId:i().editPaneId});else{const gn=`pane_BIAS_${$+1}_BIAS`,cn=b.find(Gt=>Gt===gn);if(cn){const Gt=r().saveInds[cn];Gt&&Gt.pane_id&&(console.log("🔄 Updating existing BIAS in pane:",Gt.pane_id),(Pe=o())==null||Pe.overrideIndicator({name:"BIAS",calcParams:E,styles:Q,paneId:Gt.pane_id}))}else{const Gt=`pane_BIAS_${$+1}`;console.log("🆕 Creating new BIAS in pane:",Gt);const eo=(rt=o())==null?void 0:rt.createIndicator({name:"BIAS",calcParams:E,styles:Q},!0,{id:Gt});eo&&console.log("✅ Created new BIAS indicator with ID:",eo,"in pane:",Gt)}}}),c.update(A=>(Object.keys(A.saveInds).forEach($=>{A.saveInds[$].name==="BIAS"&&delete A.saveInds[$]}),s(Un).forEach(($,E)=>{const Q=E===0?`${i().editPaneId}_BIAS`:`pane_BIAS_${E+1}_BIAS`,ie=E===0?i().editPaneId:`pane_BIAS_${E+1}`,Pe={name:"BIAS",biasGroup:$,pane_id:ie,groupIndex:E,biasGroups:E===0?[...s(Un)]:void 0,params:[$.period]};A.saveInds[Q]=Pe,console.log("💾 Saved BIAS group",E,"with key:",Q,"and pane ID:",ie)}),A)),l.update(A=>(A.editIndName="",A.editPaneId="",A.modalIndCfg=!1,A)),a(!1),console.log("✅ BIAS configuration saved successfully")}function xi(){if(!s(ro))return;const b=Object.keys(r().saveInds).filter(E=>r().saveInds[E].name==="CCI").sort((E,Q)=>E===`${i().editPaneId}_CCI`?-1:Q===`${i().editPaneId}_CCI`?1:E.localeCompare(Q));console.log("🔧 Applying CCI changes. Existing keys:",b),console.log("🔧 Current CCI groups:",s(Bn).length);const k=new Map,T=[],A=new Set;s(Bn).forEach((E,Q)=>{let ie=null;for(const Pe of b){if(A.has(Pe))continue;const rt=r().saveInds[Pe];if(rt&&rt.cciGroup&&(rt.cciGroup.id===E.id||rt.cciGroup.period===E.period&&rt.cciGroup.color===E.color&&rt.cciGroup.thickness===E.thickness&&rt.cciGroup.lineStyle===E.lineStyle)){ie=Pe,A.add(Pe);break}}if(!ie){let Pe=Q+1,rt;do rt=Pe===1?`${i().editPaneId}_CCI`:`pane_CCI_${Pe}_CCI`,Pe+=1;while(A.has(rt)||b.includes(rt));ie=rt,A.add(ie)}k.set(E.id,ie),T.push(ie)});const $=b.filter(E=>!T.includes(E));$.forEach(E=>{var ie;const Q=r().saveInds[E];if(Q&&Q.pane_id)try{console.log("🗑️ Removing CCI indicator from pane:",Q.pane_id,"key:",E),(ie=o())==null||ie.removeIndicator({paneId:Q.pane_id,name:"CCI"})}catch(Pe){console.log("❌ Error removing CCI indicator:",Pe)}}),s(Bn).forEach((E,Q)=>{var cn,Gt;const ie=[E.period],Pe={lines:[{color:E.color,size:E.thickness,style:E.lineStyle==="solid"?Ke.Solid:Ke.Dashed,dashedValue:E.lineStyle==="dashed"?[4,4]:E.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},rt=k.get(E.id),gn=r().saveInds[rt];if(gn&&gn.pane_id)console.log("🔄 Updating existing CCI in pane:",gn.pane_id,"with key:",rt),(cn=o())==null||cn.overrideIndicator({name:"CCI",calcParams:ie,styles:Pe,paneId:gn.pane_id});else{const eo=rt===`${i().editPaneId}_CCI`?i().editPaneId:rt.replace("_CCI","");console.log("🆕 Creating new CCI in pane:",eo,"with key:",rt);const Ss=(Gt=o())==null?void 0:Gt.createIndicator({name:"CCI",calcParams:ie,styles:Pe},!0,{id:eo});Ss&&console.log("✅ Created new CCI indicator with ID:",Ss,"in pane:",eo)}}),c.update(E=>($.forEach(Q=>{delete E.saveInds[Q],console.log("🗑️ Deleted save data for key:",Q)}),s(Bn).forEach((Q,ie)=>{const Pe=k.get(Q.id),rt=Pe===`${i().editPaneId}_CCI`?i().editPaneId:Pe.replace("_CCI",""),gn={name:"CCI",cciGroup:Q,pane_id:rt,groupIndex:ie,cciGroups:ie===0?[...s(Bn)]:void 0,params:[Q.period]};E.saveInds[Pe]=gn,console.log("💾 Saved CCI group",ie,"with key:",Pe,"and pane ID:",rt)}),E)),l.update(E=>(E.editIndName="",E.editPaneId="",E.modalIndCfg=!1,E)),a(!1),console.log("✅ CCI configuration saved successfully")}function nr(){s(st)&&(Bu(),c.update(b=>(Object.keys(b.saveInds).forEach(k=>{b.saveInds[k].name==="SAR"&&delete b.saveInds[k]}),s(ms).forEach((k,T)=>{const A=T===0?"candle_pane_SAR":`SAR_${T+1}`,$={name:"SAR",sarGroup:k,pane_id:"candle_pane",groupIndex:T,sarGroups:T===0?[...s(ms)]:void 0,params:[k.start,k.increment,k.maxValue]};b.saveInds[A]=$}),b)),l.update(b=>(b.editIndName="",b.editPaneId="",b.modalIndCfg=!1,b)),a(!1))}function wi(){s(Ys)&&(_p(),l.update(b=>(b.editIndName="",b.editPaneId="",b.modalIndCfg=!1,b)),a(!1))}function pl(){var T;if(!s(ge))return;const b=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="DMI").sort((A,$)=>A===`${i().editPaneId}_DMI`?-1:$===`${i().editPaneId}_DMI`?1:A.localeCompare($));console.log("🔧 Applying DMI changes. Existing keys:",b),console.log("🔧 Current DMI groups:",s(Yo).length);const k=s(Yo).length;if(b.length>k)for(let A=k;A<b.length;(A+=1)-1){const $=b[A],E=r().saveInds[$];try{console.log("🗑️ Removing excess DMI indicator from pane:",E.pane_id),(T=o())==null||T.removeIndicator({paneId:E.pane_id,name:"DMI"})}catch(Q){console.log("❌ Error removing excess DMI indicator:",Q)}delete r().saveInds[$]}s(Yo).forEach((A,$)=>{var ie,Pe,rt;const E=[A.diPeriod,A.adxPeriod],Q={lines:[{color:A.styles.diPlus.color,size:A.styles.diPlus.thickness,style:A.styles.diPlus.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:A.styles.diPlus.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:A.styles.diMinus.color,size:A.styles.diMinus.thickness,style:A.styles.diMinus.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:A.styles.diMinus.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:A.styles.adx.color,size:A.styles.adx.thickness,style:A.styles.adx.lineStyle==="dashed"?Ke.Dashed:Ke.Solid,dashedValue:A.styles.adx.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};if($===0)console.log("🔄 Updating first DMI in pane:",i().editPaneId),(ie=o())==null||ie.overrideIndicator({name:"DMI",calcParams:E,styles:Q,paneId:i().editPaneId});else{const gn=`pane_DMI_${$+1}_DMI`,cn=b.find(Gt=>Gt===gn);if(cn){const Gt=r().saveInds[cn];console.log("🔄 Updating existing DMI in pane:",Gt.pane_id),(Pe=o())==null||Pe.overrideIndicator({name:"DMI",calcParams:E,styles:Q,paneId:Gt.pane_id})}else{const Gt=`pane_DMI_${$+1}`;console.log("🆕 Creating new DMI in pane:",Gt);const eo=(rt=o())==null?void 0:rt.createIndicator({name:"DMI",calcParams:E,styles:Q},!0,{id:Gt});console.log("✅ Created new DMI indicator with ID:",eo,"in pane:",Gt)}}}),c.update(A=>(Object.keys(A.saveInds).forEach($=>{A.saveInds[$].name==="DMI"&&delete A.saveInds[$]}),s(Yo).forEach(($,E)=>{const Q=E===0?`${i().editPaneId}_DMI`:`pane_DMI_${E+1}_DMI`,ie=E===0?i().editPaneId:`pane_DMI_${E+1}`,Pe={name:"DMI",dmiGroup:$,pane_id:ie,groupIndex:E,dmiGroups:E===0?[...s(Yo)]:void 0,params:[$.diPeriod,$.adxPeriod]};A.saveInds[Q]=Pe,console.log("💾 Saved DMI group",E,"with key:",Q,"and pane ID:",ie)}),A)),l.update(A=>(A.editIndName="",A.editPaneId="",A.modalIndCfg=!1,A)),a(!1)}function ar(b){var Q,ie;const k=s(kr)[b];if(!k||!o()){console.warn("❌ updatePvtIndicator: Missing group or chart",{group:k,chart:!!o()});return}console.log("🔄 updatePvtIndicator called:",{groupIndex:b,group:k});let T=Ke.Solid,A=[2,2];k.lineStyle==="dashed"?(T=Ke.Dashed,A=[4,4]):k.lineStyle==="dotted"&&(T=Ke.Dashed,A=[2,2]);const E=((Q=o())==null?void 0:Q.getIndicators()).filter(Pe=>Pe.name==="PVT");if(console.log("📊 Found PVT indicators on chart:",E.length),console.log("📊 Looking for group index:",b),E.length>b){const Pe=E[b];console.log("✅ Found matching PVT indicator by index, updating styles...");const rt=(ie=o())==null?void 0:ie.overrideIndicator({name:"PVT",paneId:Pe.paneId,styles:{lines:[{color:k.color,size:k.thickness,style:T,dashedValue:A,smooth:!1}]},figures:[{key:"pvt",title:"PVT: ",type:"line"}]});console.log("🎨 overrideIndicator result:",rt),console.log("🎨 Applied styles:",{color:k.color,size:k.thickness,style:T,dashedValue:A});const gn=`${Pe.paneId}_PVT`;console.log("💾 Using save key:",gn),c.update(cn=>{cn.saveInds[gn]||(cn.saveInds[gn]={name:"PVT",pane_id:Pe.paneId,pvtGroups:[]}),cn.saveInds[gn].pvtGroups||(cn.saveInds[gn].pvtGroups=[]);const Gt=cn.saveInds[gn].pvtGroups||[];for(;Gt.length<=b;)Gt.push({});return Gt[b]={...k},cn.saveInds[gn].pvtGroups=Gt,console.log("💾 Persisted PVT changes to save data:",gn,k),cn}),console.log("✅ PVT indicator updated successfully:",b,k)}else console.error("❌ PVT indicator not found on chart for group index:",b),console.log("📊 Available PVT indicators:",E.length),console.log("📊 Requested group index:",b)}function vl(b){if(!s(Le)||!o()||b<0||b>=s(Po).length)return;const k=s(Po)[b];console.log("🔄 Updating TRIX indicator:",b,k);try{let A=function(ie){let Pe=Ke.Solid,rt=[2,2];return ie==="dashed"?(Pe=Ke.Dashed,rt=[4,4]):ie==="dotted"&&(Pe=Ke.Dashed,rt=[2,2]),{lineStyle:Pe,dashedValue:rt}},T=k.paneId||i().editPaneId;console.log("🔍 Using pane ID for TRIX update:",T,"for group:",b),o().removeIndicator({paneId:T,name:"TRIX"});const $=A(k.styles.trix.lineStyle),E=A(k.styles.signal.lineStyle);if(o().createIndicator({name:"TRIX",calcParams:[k.trixPeriod,k.signalPeriod],styles:{lines:[{color:k.styles.trix.color,size:k.styles.trix.thickness,style:$.lineStyle,dashedValue:$.dashedValue},{color:k.styles.signal.color,size:k.styles.signal.thickness,style:E.lineStyle,dashedValue:E.dashedValue}]}},T===i().editPaneId,{id:T})){const ie=`${T}_TRIX`;c.update(Pe=>(Pe.saveInds[ie]?Pe.saveInds[ie].params=[k.trixPeriod,k.signalPeriod]:Pe.saveInds[ie]={name:"TRIX",pane_id:T,params:[k.trixPeriod,k.signalPeriod]},Pe.saveInds[ie].trixGroup={...k},Pe))}console.log("✅ TRIX indicator updated successfully:",b)}catch(T){console.error("❌ Error updating TRIX indicator:",T)}}function Qc(){var T;if(!s(dt)||!o())return;const k=((T=o())==null?void 0:T.getIndicators()).filter(A=>A.name==="ROC");console.log("📊 Found ROC indicators on chart:",k.length),console.log("📊 ROC groups to apply:",s(An).length),s(An).forEach((A,$)=>{var rt,gn;const E=[A.period];let Q=Ke.Solid,ie=[2,2];A.styles.roc.lineStyle==="dashed"?(Q=Ke.Dashed,ie=[4,4]):A.styles.roc.lineStyle==="dotted"&&(Q=Ke.Dashed,ie=[2,2]);const Pe=k[$];if(Pe){console.log(`🎨 Updating existing ROC indicator ${$} in pane:`,Pe.paneId);const cn=(rt=o())==null?void 0:rt.overrideIndicator({name:"ROC",paneId:Pe.paneId,calcParams:E,styles:{lines:[{color:A.styles.roc.color,size:A.styles.roc.thickness,style:Q,dashedValue:ie,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]});console.log("🎨 overrideIndicator result:",cn);const Gt=`${Pe.paneId}_ROC`;c.update(eo=>{eo.saveInds[Gt]||(eo.saveInds[Gt]={name:"ROC",pane_id:Pe.paneId,params:E,rocGroups:[]}),eo.saveInds[Gt].rocGroups||(eo.saveInds[Gt].rocGroups=[]);const Ss=eo.saveInds[Gt].rocGroups||[];for(;Ss.length<=$;)Ss.push({});return Ss[$]={...A},eo.saveInds[Gt].rocGroups=Ss,eo.saveInds[Gt].params=E,console.log("💾 Persisted ROC changes to save data:",Gt,A),eo}),console.log("✅ ROC indicator updated successfully:",$,A)}else{console.log(`➕ Creating new ROC indicator for group ${$}`);const cn={name:"ROC",calcParams:E,styles:{lines:[{color:A.styles.roc.color,size:A.styles.roc.thickness,style:Q,dashedValue:ie,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]};(gn=o())==null||gn.createIndicator(cn,!1,{axis:{gap:{bottom:2}}})}}),l.update(A=>(A.editIndName="",A.editPaneId="",A.modalIndCfg=!1,A)),a(!1)}function ou(){var T;if(!s(pt))return;const b=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="PSY").sort((A,$)=>A===`${i().editPaneId}_PSY`?-1:$===`${i().editPaneId}_PSY`?1:A.localeCompare($)),k=s(on).length;if(b.length>k)for(let A=k;A<b.length;(A+=1)-1){const $=b[A],E=r().saveInds[$];if(E&&E.pane_id)try{(T=o())==null||T.removeIndicator({paneId:E.pane_id,name:"PSY"})}catch(Q){console.log("Error removing excess PSY indicator:",Q)}}s(on).forEach((A,$)=>{var cn,Gt,eo;const E=[A.psyPeriod,A.mapsyPeriod],Q=[{key:"psy",title:"PSY: ",type:"line"}];A.showMapsy&&Q.push({key:"mapsy",title:"MAPSY: ",type:"line"});const ie={lines:[]};let Pe=Ke.Solid,rt=[2,2];if(A.styles.psy.lineStyle==="dashed"?(Pe=Ke.Dashed,rt=[4,4]):A.styles.psy.lineStyle==="dotted"&&(Pe=Ke.Dashed,rt=[2,2]),ie.lines.push({color:A.styles.psy.color,size:A.styles.psy.thickness,style:Pe,dashedValue:rt,smooth:!1}),A.showMapsy){let Ss=Ke.Solid,La=[2,2];A.styles.mapsy.lineStyle==="dashed"?(Ss=Ke.Dashed,La=[4,4]):A.styles.mapsy.lineStyle==="dotted"&&(Ss=Ke.Dashed,La=[2,2]),ie.lines.push({color:A.styles.mapsy.color,size:A.styles.mapsy.thickness,style:Ss,dashedValue:La,smooth:!1})}const gn={name:"PSY",calcParams:E,styles:ie,figures:Q};if($===0)(cn=o())==null||cn.overrideIndicator({...gn,paneId:i().editPaneId});else{const Ss=`psy_${String($+1).padStart(3,"0")}_PSY`,La=b.find(Rl=>Rl===Ss);if(La){const Rl=r().saveInds[La];Rl&&Rl.pane_id&&((Gt=o())==null||Gt.overrideIndicator({...gn,paneId:Rl.pane_id}))}else{const Rl=`psy_${String($+1).padStart(3,"0")}`;((eo=o())==null?void 0:eo.createIndicator(gn,!1,{id:Rl,axis:{gap:{bottom:2}}}))&&(console.log(`✅ PSY ${$+1} created with pane ID:`,Rl),A.actualPaneId=Rl)}}}),c.update(A=>(Object.keys(A.saveInds).forEach($=>{A.saveInds[$].name==="PSY"&&delete A.saveInds[$]}),s(on).forEach(($,E)=>{const Q=E===0?`${i().editPaneId}_PSY`:`psy_${String(E+1).padStart(3,"0")}_PSY`,ie=E===0?i().editPaneId:$.actualPaneId||`psy_${String(E+1).padStart(3,"0")}`;A.saveInds[Q]={name:"PSY",psyGroup:$,pane_id:ie,groupIndex:E,params:[$.psyPeriod,$.mapsyPeriod]}}),A)),l.update(A=>(A.editIndName="",A.editPaneId="",A.modalIndCfg=!1,A)),a(!1)}function Fu(){if(!s(at))return;const b=Object.keys(r().saveInds).filter(k=>r().saveInds[k].name==="OBV");s(rn).forEach((k,T)=>{var rt,gn,cn;const A=[k.obvPeriod,k.maobvPeriod],$=[{key:"obv",title:"OBV: ",type:"line"}];k.showMaobv&&$.push({key:"maobv",title:"MAOBV: ",type:"line"});const E={lines:[]};let Q=Ke.Solid,ie=[2,2];if(k.styles.obv.lineStyle==="dashed"?(Q=Ke.Dashed,ie=[4,4]):k.styles.obv.lineStyle==="dotted"&&(Q=Ke.Dashed,ie=[2,2]),E.lines.push({color:k.styles.obv.color,size:k.styles.obv.thickness,style:Q,dashedValue:ie,smooth:!1}),k.showMaobv){let Gt=Ke.Solid,eo=[2,2];k.styles.maobv.lineStyle==="dashed"?(Gt=Ke.Dashed,eo=[4,4]):k.styles.maobv.lineStyle==="dotted"&&(Gt=Ke.Dashed,eo=[2,2]),E.lines.push({color:k.styles.maobv.color,size:k.styles.maobv.thickness,style:Gt,dashedValue:eo,smooth:!1})}const Pe={name:"OBV",calcParams:A,styles:E,figures:$};if(T===0)(rt=o())==null||rt.overrideIndicator({...Pe,paneId:i().editPaneId});else{const Gt=`pane_OBV_${T+1}_OBV`,eo=b.find(Ss=>Ss===Gt);if(eo){const Ss=r().saveInds[eo];Ss&&Ss.pane_id&&((gn=o())==null||gn.overrideIndicator({...Pe,paneId:Ss.pane_id}))}else{const Ss=`pane_OBV_${T+1}`;((cn=o())==null?void 0:cn.createIndicator(Pe,!1,{id:Ss,axis:{gap:{bottom:2}}}))&&(console.log(`✅ OBV ${T+1} created with pane ID:`,Ss),k.actualPaneId=Ss)}}}),c.update(k=>(Object.keys(k.saveInds).forEach(T=>{k.saveInds[T].name==="OBV"&&delete k.saveInds[T]}),s(rn).forEach((T,A)=>{const $=A===0?`${i().editPaneId}_OBV`:`pane_OBV_${A+1}_OBV`,E=A===0?i().editPaneId:T.actualPaneId||`pane_OBV_${A+1}`,Q={name:"OBV",obvGroup:T,pane_id:E,groupIndex:A,obvGroups:A===0?[...s(rn)]:void 0,params:[T.obvPeriod,T.maobvPeriod]};k.saveInds[$]=Q}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1)}function Ad(){if(console.log("🚀 handleKdjConfirm started"),!s(kn)){console.log("❌ Not KDJ indicator, returning early");return}try{console.log("🔄 Applying KDJ changes, groups:",s(fo).length),console.log("📊 Current KDJ groups data:",JSON.parse(JSON.stringify(s(fo)))),console.log("🔄 Preserving existing indicators and updating with current values"),s(fo).forEach((b,k)=>{console.log(`🔄 Applying KDJ group ${k+1} with current values`),nu(k)}),c.update(b=>(s(fo).forEach((k,T)=>{const A=T===0?`${i().editPaneId}_KDJ`:`pane_KDJ_${T+1}_KDJ`,$=T===0?i().editPaneId:k.actualPaneId||`pane_KDJ_${T+1}`;console.log(`💾 Updating saved KDJ group ${T+1} with key:`,A,"pane ID:",$),b.saveInds[A]={name:"KDJ",kdjGroup:k,pane_id:$,groupIndex:T,kdjGroups:T===0?[...s(fo)]:void 0,params:[k.kPeriod,k.dPeriod,3]}}),b)),l.update(b=>(b.editIndName="",b.editPaneId="",b.modalIndCfg=!1,b)),a(!1)}catch(b){console.error("❌ Error in handleKdjConfirm main logic:",b),console.log("🔄 Forcing popup close due to error in main logic..."),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1),console.log("✅ Popup forcefully closed after error in main logic")}}function Xd(){s(At)&&(en(),x(Gs,!1),l.update(b=>(b.editIndName="",b.editPaneId="",b.modalIndCfg=!1,b)),a(!1))}function Kp(){var T;if(!s(dc))return;console.log("🔄 Applying AO changes, groups:",s(Oc).length);const b=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="AO").sort((A,$)=>A===`${i().editPaneId}_AO`?-1:$===`${i().editPaneId}_AO`?1:A.localeCompare($));console.log("🔍 Existing AO keys:",b);const k=s(Oc).length;if(b.length>k){console.log(`🗑️ Removing ${b.length-k} excess AO indicators`);for(let A=k;A<b.length;(A+=1)-1){const $=b[A],E=r().saveInds[$];if(E&&E.pane_id){console.log("🗑️ Removing AO indicator from pane:",E.pane_id);try{(T=o())==null||T.removeIndicator({paneId:E.pane_id,name:"AO"})}catch(Q){console.log("Error removing excess AO indicator:",Q)}}}}s(Oc).forEach((A,$)=>{var ie,Pe,rt;const E=[A.shortPeriod,A.longPeriod],Q={bars:[{upColor:A.styles.increasing.color,downColor:A.styles.decreasing.color,noChangeColor:"#888888"}]};if($===0)console.log("🔄 Updating first AO indicator in pane:",i().editPaneId),(ie=o())==null||ie.overrideIndicator({name:"AO",calcParams:E,styles:Q,paneId:i().editPaneId});else{const gn=`pane_AO_${$+1}_AO`,cn=b.find(Gt=>Gt===gn);if(cn){const Gt=r().saveInds[cn];Gt&&Gt.pane_id&&(console.log(`🔄 Updating existing AO ${$+1} in pane:`,Gt.pane_id),(Pe=o())==null||Pe.overrideIndicator({name:"AO",calcParams:E,styles:Q,paneId:Gt.pane_id}))}else{const Gt=`pane_AO_${$+1}`;console.log(`🆕 Creating new AO ${$+1} with pane ID:`,Gt),(rt=o())==null||rt.createIndicator({name:"AO",calcParams:E,styles:Q},!0,{id:Gt})}}}),c.update(A=>(Object.keys(A.saveInds).forEach($=>{A.saveInds[$].name==="AO"&&delete A.saveInds[$]}),s(Oc).forEach(($,E)=>{const Q=E===0?`${i().editPaneId}_AO`:`pane_AO_${E+1}_AO`,ie=E===0?i().editPaneId:`pane_AO_${E+1}`;console.log(`💾 Saving AO group ${E+1} with key:`,Q),A.saveInds[Q]={name:"AO",aoGroup:$,pane_id:ie,groupIndex:E,aoGroups:E===0?[...s(Oc)]:void 0,params:[$.shortPeriod,$.longPeriod]}}),A)),l.update(A=>(A.editIndName="",A.editPaneId="",A.modalIndCfg=!1,A)),a(!1)}function yp(){s(zr)&&(s(de).length===0?x(de,N([{id:zi(),paneId:i().editPaneId||"candle_pane",period:s(j),stdDev:s(D),styles:{fillColor:s(S),fillOpacity:s(P),upperColor:s(I),middleColor:s(C),lowerColor:s(M),thickness:s(F),lineStyle:s(V)}}])):(s(de)[0].period=s(j),s(de)[0].stdDev=s(D),s(de)[0].styles.fillColor=s(S),s(de)[0].styles.fillOpacity=s(P),s(de)[0].styles.upperColor=s(I),s(de)[0].styles.middleColor=s(C),s(de)[0].styles.lowerColor=s(M),s(de)[0].styles.thickness=s(F),s(de)[0].styles.lineStyle=s(V)),jn(),l.update(b=>(b.editIndName="",b.editPaneId="",b.modalIndCfg=!1,b)),a(!1))}function $v(b){var A;if(console.log("🔄 handleConfirm called with:",b),console.log("📊 Current context:",{editIndName:i().editIndName,editPaneId:i().editPaneId,isKdj:s(kn),kdjGroups:s(fo)}),b==="close"||b==="cancel"){l.update($=>($.editIndName="",$.editPaneId="",$.modalIndCfg=!1,$)),x(Gs,!1),a(!1);return}if(b==="confirm"&&s(rd)&&i().editIndName&&i().editPaneId){fr();return}if(b==="confirm"&&s(Ht)&&i().editIndName&&i().editPaneId){tr(),l.update($=>($.editIndName="",$.editPaneId="",$.modalIndCfg=!1,$)),a(!1);return}if(b==="confirm"&&s(Zc)&&i().editIndName&&i().editPaneId){console.log("🔄 PVT Confirm: Applying all changes to chart"),s(kr).forEach(($,E)=>{console.log(`🔄 Applying PVT group ${E}:`,$),ar(E)}),c.update($=>{const E=`${i().editPaneId}_PVT`;return $.saveInds[E]={...$.saveInds[E],pvtGroups:[...s(kr)]},console.log("💾 Saved PVT groups to:",E),$}),l.update($=>($.editIndName="",$.editPaneId="",$.modalIndCfg=!1,$)),a(!1);return}if(b==="confirm"&&s(Ct)&&i().editIndName&&i().editPaneId){la();return}if(b==="confirm"&&s(Er)&&i().editIndName&&i().editPaneId){Ll();return}if(b==="confirm"&&s(Sc)&&i().editIndName&&i().editPaneId){ao();return}if(b==="confirm"&&s(ce)&&i().editIndName&&i().editPaneId){ul();return}if(b==="confirm"&&s(ea)&&i().editIndName&&i().editPaneId){Ic();return}if(b==="confirm"&&s(Ei)&&i().editIndName&&i().editPaneId){s(Fo).forEach(($,E)=>{te(E)}),aa(),l.update($=>($.editIndName="",$.editPaneId="",$.modalIndCfg=!1,$)),a(!1);return}if(b==="confirm"&&s(uo)&&i().editIndName&&i().editPaneId){Ra();return}if(b==="confirm"&&s(hs)&&i().editIndName&&i().editPaneId){gi();return}if(b==="confirm"&&s(cc)&&i().editIndName&&i().editPaneId){Yc();return}if(b==="confirm"&&s(Ac)&&i().editIndName&&i().editPaneId){Qi();return}if(b==="confirm"&&s(ro)&&i().editIndName&&i().editPaneId){xi();return}if(b==="confirm"&&s(st)&&i().editIndName&&i().editPaneId){nr();return}if(b==="confirm"&&s(Ys)&&i().editIndName&&i().editPaneId){wi();return}if(b==="confirm"&&s(ge)&&i().editIndName&&i().editPaneId){pl();return}if(b==="confirm"&&s(dt)&&i().editIndName&&i().editPaneId){Qc();return}if(b==="confirm"&&s(pt)&&i().editIndName&&i().editPaneId){ou();return}if(b==="confirm"&&s(at)&&i().editIndName&&i().editPaneId){Fu();return}if(b==="confirm"&&s(Id)&&i().editIndName&&i().editPaneId){Ep();return}if(b==="confirm"&&s(kn)&&i().editIndName&&i().editPaneId){console.log("✅ KDJ confirm condition met, calling handleKdjConfirm"),Ad();return}if(b==="confirm"&&s(dc)&&i().editIndName&&i().editPaneId){Kp();return}if(b==="confirm"&&s(zr)&&i().editIndName&&i().editPaneId){yp();return}if(b==="confirm"&&s(At)&&i().editIndName&&i().editPaneId){Xd();return}if(b!=="confirm"||!i().editIndName||!i().editPaneId||m.length===0){a(!1);return}const k=[],T={lines:[],bars:[]};p.forEach(($,E)=>{const Q=m[E];if(Q&&Q.type==="color"){const ie=Q.styleKey;if(ie){const Pe=ie.match(/^(\w+)\[(\d+)\]\.(\w+)$/);if(Pe){const[,rt,gn,cn]=Pe,Gt=parseInt(gn);T[rt]||(T[rt]=[]),T[rt][Gt]||(T[rt][Gt]={}),T[rt][Gt][cn]=$||Q.default}}}else(!ag.isValid($)||$==="")&&Q&&Q.default&&($=Q.default),k.push(Number($))}),h.forEach(($,E)=>{let Q=Ke.Solid,ie=[2,2];$.lineStyle==="dashed"?(Q=Ke.Dashed,ie=[4,4]):$.lineStyle==="dotted"&&(Q=Ke.Dashed,ie=[2,6]),T.lines[E]={color:$.color,size:$.thickness,style:Q,dashedValue:ie}}),(A=o())==null||A.overrideIndicator({name:i().editIndName,calcParams:k,styles:T,paneId:i().editPaneId}),c.update($=>{const E={name:i().editIndName,params:k,pane_id:i().editPaneId,styles:[...h]};return s(zr)||(E.fields=[...m]),$.saveInds[`${i().editPaneId}_${i().editIndName}`]=E,$}),l.update($=>($.editIndName="",$.editPaneId="",$.modalIndCfg=!1,$)),a(!1)}Ng();var Zp=fR(),Xp=Dt(Zp);vf(Xp,{get title(){return s(Mo)},width:600,maxWidth:"min(600px, 95vw)",maxHeight:"90vh",get show(){return a()},set show(b){a(b)},get theme(){return r().theme},click:$v,children:(b,k)=>{var T=vR(),A=g(T);Te(A,()=>s(rd),E=>{var Q=$N(),ie=g(Q);vs(ie,17,()=>s(Rc),Vs,(gn,cn,Gt)=>{var eo=FN(),Ss=g(eo),La=g(Ss);La.textContent=`MACD ${Gt+1}`;var Rl=u(La,2);Te(Rl,()=>s(Rc).length>1,io=>{var to=LN();to.__click=[TN,$s,cn],z(io,to)}),f(Ss);var pc=u(Ss,2),nl=g(pc),vc=u(g(nl),2);Qt(vc),f(nl);var qc=u(nl,2),Td=u(g(qc),2);Qt(Td),f(qc);var xd=u(qc,2),jd=u(g(xd),2);Qt(jd),f(xd),f(pc);var vd=u(pc,2),Hd=g(vd),Tr=u(g(Hd),2),xl=vt(()=>Vc(Gt,"macdLine"));Tr.__click=function(...io){var to;(to=s(xl))==null||to.apply(this,io)};var Za=u(Tr,2);Za.__change=()=>oi(Gt);var jr=g(Za);jr.value=(jr.__value=1)==null?"":1;var ol=u(jr);ol.value=(ol.__value=2)==null?"":2;var Lr=u(ol);Lr.value=(Lr.__value=3)==null?"":3;var ii=u(Lr);ii.value=(ii.__value=4)==null?"":4;var Di=u(ii);Di.value=(Di.__value=5)==null?"":5,f(Za);var Ha=u(Za,2);Ha.__change=()=>oi(Gt);var Ns=g(Ha);Ns.value=(Ns.__value="solid")==null?"":"solid";var Cr=u(Ns);Cr.value=(Cr.__value="dashed")==null?"":"dashed";var Xa=u(Cr);Xa.value=(Xa.__value="dotted")==null?"":"dotted",f(Ha),f(Hd);var Ur=u(Hd,2),Ja=u(g(Ur),2),Gl=vt(()=>Vc(Gt,"signalLine"));Ja.__click=function(...io){var to;(to=s(Gl))==null||to.apply(this,io)};var Gr=u(Ja,2);Gr.__change=()=>oi(Gt);var Il=g(Gr);Il.value=(Il.__value=1)==null?"":1;var bc=u(Il);bc.value=(bc.__value=2)==null?"":2;var Zr=u(bc);Zr.value=(Zr.__value=3)==null?"":3;var Ua=u(Zr);Ua.value=(Ua.__value=4)==null?"":4;var Rr=u(Ua);Rr.value=(Rr.__value=5)==null?"":5,f(Gr);var Xr=u(Gr,2);Xr.__change=()=>oi(Gt);var lt=g(Xr);lt.value=(lt.__value="solid")==null?"":"solid";var O=u(lt);O.value=(O.__value="dashed")==null?"":"dashed";var pe=u(O);pe.value=(pe.__value="dotted")==null?"":"dotted",f(Xr),f(Ur);var ke=u(Ur,2),Mt=u(g(ke),2),Rt=vt(()=>Vc(Gt,"positiveHistogram"));Mt.__click=function(...io){var to;(to=s(Rt))==null||to.apply(this,io)},f(ke);var xn=u(ke,2),Jt=u(g(xn),2),Qn=vt(()=>Vc(Gt,"negativeHistogram"));Jt.__click=function(...io){var to;(to=s(Qn))==null||to.apply(this,io)},f(xn),f(vd),f(eo),Se(()=>{zt(Tr,"style",`background-color: ${s(cn).styles.macdLine.color??""}; border: 1px solid #ddd;`),zt(Ja,"style",`background-color: ${s(cn).styles.signalLine.color??""}; border: 1px solid #ddd;`),zt(Mt,"style",`background-color: ${s(cn).styles.positiveHistogram.color??""}; border: 1px solid #ddd;`),zt(Jt,"style",`background-color: ${s(cn).styles.negativeHistogram.color??""}; border: 1px solid #ddd;`)}),po(vc,()=>s(cn).fastPeriod,io=>s(cn).fastPeriod=io),po(Td,()=>s(cn).slowPeriod,io=>s(cn).slowPeriod=io),po(jd,()=>s(cn).signalPeriod,io=>s(cn).signalPeriod=io),qo(Za,()=>s(cn).styles.macdLine.thickness,io=>s(cn).styles.macdLine.thickness=io),qo(Ha,()=>s(cn).styles.macdLine.lineStyle,io=>s(cn).styles.macdLine.lineStyle=io),qo(Gr,()=>s(cn).styles.signalLine.thickness,io=>s(cn).styles.signalLine.thickness=io),qo(Xr,()=>s(cn).styles.signalLine.lineStyle,io=>s(cn).styles.signalLine.lineStyle=io),z(gn,eo)});var Pe=u(ie,2),rt=g(Pe);rt.__click=es,f(Pe),f(Q),z(E,Q)},E=>{var Q=Ln(),ie=Dt(Q);Te(ie,()=>s(Ht),Pe=>{var rt=EN(),gn=g(rt),cn=g(gn),Gt=u(g(cn),2);Qt(Gt),Gt.__input=[kf,Ht,o,d,i,l,ln],f(cn);var eo=u(cn,2),Ss=u(g(eo),2);Qt(Ss),Ss.__input=[kf,Ht,o,d,i,l,ln],f(eo);var La=u(eo,2),Rl=u(g(La),2);Qt(Rl),Rl.__input=[kf,Ht,o,d,i,l,ln],f(La);var pc=u(La,2),nl=u(g(pc),2);Qt(nl),nl.__input=[kf,Ht,o,d,i,l,ln],f(pc);var vc=u(pc,2),qc=u(g(vc),2);Qt(qc),qc.__input=[kf,Ht,o,d,i,l,ln],f(vc);var Td=u(vc,2),xd=u(g(Td),2);Qt(xd),xd.__input=[kf,Ht,o,d,i,l,ln],f(Td),f(gn);var jd=u(gn,2),vd=g(jd),Hd=u(g(vd),2),Tr=g(Hd);Qt(Tr),Tr.__input=[kf,Ht,o,d,i,l,ln];var xl=u(Tr,2),Za=g(xl);Se(()=>ze(Za,`${(ln.maxZoneWidthPct*100).toFixed(1)??""}%`)),f(xl),f(Hd),f(vd);var jr=u(vd,2),ol=u(g(jr),2),Lr=g(ol);Qt(Lr),Lr.__input=[kf,Ht,o,d,i,l,ln];var ii=u(Lr,2),Di=g(ii);Se(()=>ze(Di,`${ln.minVolumeFactor.toFixed(2)??""}x`)),f(ii),f(ol),f(jr);var Ha=u(jr,2),Ns=u(g(Ha),2),Cr=g(Ns);Qt(Cr),Cr.__input=[kf,Ht,o,d,i,l,ln];var Xa=u(Cr,2),Ur=g(Xa,!0);Se(()=>ze(Ur,ln.minOBVTrendStrength.toFixed(2))),f(Xa),f(Ns),f(Ha);var Ja=u(Ha,2),Gl=u(g(Ja),2),Gr=g(Gl);Qt(Gr),Gr.__input=[kf,Ht,o,d,i,l,ln];var Il=u(Gr,2),bc=g(Il,!0);Se(()=>ze(bc,ln.minZoneScore.toFixed(2))),f(Il),f(Gl),f(Ja),f(jd);var Zr=u(jd,2),Ua=g(Zr),Rr=u(g(Ua),2);Qt(Rr),Rr.__change=[kf,Ht,o,d,i,l,ln],f(Ua);var Xr=u(Ua,2),lt=u(g(Xr),2);Qt(lt),lt.__change=[kf,Ht,o,d,i,l,ln],f(Xr),f(Zr);var O=u(Zr,2),pe=u(g(O),2);Qt(pe),pe.__input=[kf,Ht,o,d,i,l,ln],f(O),f(rt),po(Gt,()=>ln.zoneLookbackBars,ke=>ln.zoneLookbackBars=ke),po(Ss,()=>ln.priorTrendLookback,ke=>ln.priorTrendLookback=ke),po(Rl,()=>ln.minZoneBars,ke=>ln.minZoneBars=ke),po(nl,()=>ln.maxZoneBars,ke=>ln.maxZoneBars=ke),po(qc,()=>ln.atrPeriod,ke=>ln.atrPeriod=ke),po(xd,()=>ln.volumeMAPeriod,ke=>ln.volumeMAPeriod=ke),po(Tr,()=>ln.maxZoneWidthPct,ke=>ln.maxZoneWidthPct=ke),po(Lr,()=>ln.minVolumeFactor,ke=>ln.minVolumeFactor=ke),po(Cr,()=>ln.minOBVTrendStrength,ke=>ln.minOBVTrendStrength=ke),po(Gr,()=>ln.minZoneScore,ke=>ln.minZoneScore=ke),zf(Rr,()=>ln.mergeNearbyZones,ke=>ln.mergeNearbyZones=ke),zf(lt,()=>ln.showLabels,ke=>ln.showLabels=ke),po(pe,()=>ln.maxZonesDisplayed,ke=>ln.maxZonesDisplayed=ke),z(Pe,rt)},Pe=>{var rt=Ln(),gn=Dt(rt);Te(gn,()=>s(qe),cn=>{var Gt=DN(),eo=g(Gt),Ss=g(eo),La=u(g(Ss),2);Qt(La),La.__input=mn,f(Ss);var Rl=u(Ss,2),pc=u(g(Rl),2);Qt(pc),pc.__input=mn,f(Rl);var nl=u(Rl,2),vc=u(g(nl),2);Qt(vc),vc.__input=mn,f(nl);var qc=u(nl,2),Td=u(g(qc),2);Qt(Td),Td.__input=mn,f(qc);var xd=u(qc,2),jd=u(g(xd),2);Qt(jd),jd.__input=mn,f(xd);var vd=u(xd,2),Hd=u(g(vd),2),Tr=g(Hd);Qt(Tr),Tr.__input=mn;var xl=u(Tr,2),Za=g(xl);Se(()=>ze(Za,`${Number(p[5]??1.2).toFixed(2)??""}x`)),f(xl),f(Hd),f(vd),f(eo);var jr=u(eo,2),ol=g(jr),Lr=u(g(ol),2),ii=g(Lr);Qt(ii),ii.__input=mn,ai(2),f(Lr),f(ol);var Di=u(ol,2),Ha=u(g(Di),2),Ns=g(Ha);Qt(Ns),Ns.__input=mn;var Cr=u(Ns,2),Xa=g(Cr,!0);Se(()=>ze(Xa,Number(p[7]??.35).toFixed(2))),f(Cr),f(Ha),f(Di);var Ur=u(Di,2),Ja=u(g(Ur),2),Gl=g(Ja);Qt(Gl),Gl.__input=mn;var Gr=u(Gl,2),Il=g(Gr,!0);Se(()=>ze(Il,Number(p[8]??.5).toFixed(2))),f(Gr),f(Ja),f(Ur),f(jr);var bc=u(jr,2),Zr=g(bc),Ua=u(g(Zr),2);Qt(Ua),Se(()=>Qv(Ua,Number(p[9]??1)>0)),Ua.__change=[NN,p,mn],f(Zr);var Rr=u(Zr,2),Xr=u(g(Rr),2);Qt(Xr),Xr.__input=mn,f(Rr),f(bc),f(Gt),po(La,()=>p[0],lt=>p[0]=lt),po(pc,()=>p[1],lt=>p[1]=lt),po(vc,()=>p[2],lt=>p[2]=lt),po(Td,()=>p[3],lt=>p[3]=lt),po(jd,()=>p[4],lt=>p[4]=lt),po(Tr,()=>p[5],lt=>p[5]=lt),po(ii,()=>p[6],lt=>p[6]=lt),po(Ns,()=>p[7],lt=>p[7]=lt),po(Gl,()=>p[8],lt=>p[8]=lt),po(Xr,()=>p[10],lt=>p[10]=lt),z(cn,Gt)},cn=>{var Gt=Ln(),eo=Dt(Gt);Te(eo,()=>s(fn),Ss=>{var La=jN(),Rl=g(La),pc=u(g(Rl),2),nl=g(pc),vc=u(g(nl),2);Qt(vc),vc.__input=Kn,f(nl);var qc=u(nl,2),Td=u(g(qc),2);Qt(Td),Td.__input=Kn,f(qc);var xd=u(qc,2),jd=u(g(xd),2);Qt(jd),jd.__input=Kn,f(xd);var vd=u(xd,2),Hd=u(g(vd),2);Qt(Hd),Hd.__input=Kn,f(vd);var Tr=u(vd,2),xl=u(g(Tr),2);Qt(xl),xl.__input=Kn,f(Tr);var Za=u(Tr,2),jr=u(g(Za),2);Qt(jr),jr.__input=Kn,f(Za),f(pc),f(Rl);var ol=u(Rl,2),Lr=u(g(ol),2),ii=g(Lr),Di=u(g(ii),2),Ha=g(Di);Qt(Ha),Ha.__input=Kn;var Ns=u(Ha,2),Cr=g(Ns,!0);Se(()=>ze(Cr,Number(p[6]??.7).toFixed(2))),f(Ns),f(Di),f(ii);var Xa=u(ii,2),Ur=u(g(Xa),2);Qt(Ur),Ur.__input=Kn,f(Xa);var Ja=u(Xa,2),Gl=u(g(Ja),2),Gr=g(Gl);Qt(Gr),Gr.__input=Kn;var Il=u(Gr,2),bc=g(Il);Se(()=>ze(bc,`${Number(p[8]??1.3).toFixed(2)??""}x`)),f(Il),f(Gl),f(Ja);var Zr=u(Ja,2),Ua=u(g(Zr),2),Rr=g(Ua);Qt(Rr),Rr.__input=Kn;var Xr=u(Rr,2),lt=g(Xr);Se(()=>ze(lt,`${Number(p[9]??1.3).toFixed(2)??""}x`)),f(Xr),f(Ua),f(Zr);var O=u(Zr,2),pe=u(g(O),2),ke=g(pe);Qt(ke),ke.__input=Kn;var Mt=u(ke,2),Rt=g(Mt,!0);Se(()=>ze(Rt,Number(p[10]??.6).toFixed(2))),f(Mt),f(pe),f(O);var xn=u(O,2),Jt=u(g(xn),2);Qt(Jt),Jt.__input=Kn,f(xn);var Qn=u(xn,2),io=u(g(Qn),2);Qt(io),io.__input=Kn,f(Qn),f(Lr),f(ol),f(La),po(vc,()=>p[0],to=>p[0]=to),po(Td,()=>p[1],to=>p[1]=to),po(jd,()=>p[2],to=>p[2]=to),po(Hd,()=>p[3],to=>p[3]=to),po(xl,()=>p[4],to=>p[4]=to),po(jr,()=>p[5],to=>p[5]=to),po(Ha,()=>p[6],to=>p[6]=to),po(Ur,()=>p[7],to=>p[7]=to),po(Gr,()=>p[8],to=>p[8]=to),po(Rr,()=>p[9],to=>p[9]=to),po(ke,()=>p[10],to=>p[10]=to),po(Jt,()=>p[11],to=>p[11]=to),po(io,()=>p[12],to=>p[12]=to),z(Ss,La)},Ss=>{var La=Ln(),Rl=Dt(La);Te(Rl,()=>s(Fn),pc=>{var nl=RN(),vc=g(nl),qc=u(g(vc),2),Td=g(qc),xd=u(g(Td),2);Qt(xd),xd.__input=Pn,f(Td);var jd=u(Td,2),vd=u(g(jd),2);Qt(vd),vd.__input=Pn,f(jd);var Hd=u(jd,2),Tr=u(g(Hd),2);Qt(Tr),Tr.__input=Pn,f(Hd);var xl=u(Hd,2),Za=u(g(xl),2);Qt(Za),Za.__input=Pn,f(xl);var jr=u(xl,2),ol=u(g(jr),2);Qt(ol),ol.__input=Pn,f(jr);var Lr=u(jr,2),ii=u(g(Lr),2);Qt(ii),ii.__input=Pn,f(Lr),f(qc),f(vc);var Di=u(vc,2),Ha=u(g(Di),2),Ns=g(Ha),Cr=u(g(Ns),2),Xa=g(Cr);Qt(Xa),Xa.__input=Pn;var Ur=u(Xa,2),Ja=g(Ur,!0);Se(()=>ze(Ja,Number(p[6]??.7).toFixed(2))),f(Ur),f(Cr),f(Ns);var Gl=u(Ns,2),Gr=u(g(Gl),2);Qt(Gr),Gr.__input=Pn,f(Gl);var Il=u(Gl,2),bc=u(g(Il),2),Zr=g(bc);Qt(Zr),Zr.__input=Pn;var Ua=u(Zr,2),Rr=g(Ua);Se(()=>ze(Rr,`${Number(p[8]??1.3).toFixed(2)??""}x`)),f(Ua),f(bc),f(Il);var Xr=u(Il,2),lt=u(g(Xr),2),O=g(lt);Qt(O),O.__input=Pn;var pe=u(O,2),ke=g(pe);Se(()=>ze(ke,`${Number(p[9]??1.3).toFixed(2)??""}x`)),f(pe),f(lt),f(Xr);var Mt=u(Xr,2),Rt=u(g(Mt),2),xn=g(Rt);Qt(xn),xn.__input=Pn;var Jt=u(xn,2),Qn=g(Jt,!0);Se(()=>ze(Qn,Number(p[10]??.6).toFixed(2))),f(Jt),f(Rt),f(Mt);var io=u(Mt,2),to=u(g(io),2);Qt(to),to.__input=Pn,f(io);var ho=u(io,2),Li=u(g(ho),2);Qt(Li),Li.__input=Pn,f(ho),f(Ha),f(Di),f(nl),po(xd,()=>p[0],Ms=>p[0]=Ms),po(vd,()=>p[1],Ms=>p[1]=Ms),po(Tr,()=>p[2],Ms=>p[2]=Ms),po(Za,()=>p[3],Ms=>p[3]=Ms),po(ol,()=>p[4],Ms=>p[4]=Ms),po(ii,()=>p[5],Ms=>p[5]=Ms),po(Xa,()=>p[6],Ms=>p[6]=Ms),po(Gr,()=>p[7],Ms=>p[7]=Ms),po(Zr,()=>p[8],Ms=>p[8]=Ms),po(O,()=>p[9],Ms=>p[9]=Ms),po(xn,()=>p[10],Ms=>p[10]=Ms),po(to,()=>p[11],Ms=>p[11]=Ms),po(Li,()=>p[12],Ms=>p[12]=Ms),z(pc,nl)},pc=>{var nl=Ln(),vc=Dt(nl);Te(vc,()=>s(Ei),qc=>{var Td=zN(),xd=g(Td);vs(xd,17,()=>s(Fo),Vs,(Hd,Tr,xl)=>{var Za=ON(),jr=g(Za),ol=g(jr);ol.textContent=`RSI ${xl+1}`;var Lr=u(ol,2);Te(Lr,()=>s(Fo).length>1,zs=>{var yi=BN();yi.__click=()=>U(xl),z(zs,yi)}),f(jr);var ii=u(jr,2),Di=g(ii),Ha=u(g(Di),2);Qt(Ha),Ha.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)},f(Di);var Ns=u(Di,2),Cr=u(g(Ns),2);Qt(Cr),Cr.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)},f(Ns);var Xa=u(Ns,2),Ur=u(g(Xa),2);Qt(Ur),Ur.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)},f(Xa);var Ja=u(Xa,2),Gl=u(g(Ja),2);Qt(Gl),Gl.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)},f(Ja),f(ii);var Gr=u(ii,2),Il=g(Gr),bc=u(g(Il),2),Zr=g(bc);Zr.__click=zs=>{x(lc,N(xl));const yi=zs.currentTarget.getBoundingClientRect();x(hl,N({x:yi.left+yi.width/2,y:yi.bottom+5})),x(Qr,!0)};var Ua=u(Zr,2);Ua.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)};var Rr=g(Ua);Rr.value=(Rr.__value=1)==null?"":1;var Xr=u(Rr);Xr.value=(Xr.__value=2)==null?"":2;var lt=u(Xr);lt.value=(lt.__value=3)==null?"":3;var O=u(lt);O.value=(O.__value=4)==null?"":4;var pe=u(O);pe.value=(pe.__value=5)==null?"":5,f(Ua);var ke=u(Ua,2);ke.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)};var Mt=g(ke);Mt.value=(Mt.__value="solid")==null?"":"solid";var Rt=u(Mt);Rt.value=(Rt.__value="dashed")==null?"":"dashed";var xn=u(Rt);xn.value=(xn.__value="dotted")==null?"":"dotted",f(ke),f(bc),f(Il),f(Gr);var Jt=u(Gr,2),Qn=u(g(Jt),2),io=u(g(Qn),2),to=g(io);to.__click=zs=>{x(zl,N(xl));const yi=zs.currentTarget.getBoundingClientRect();x(Vd,N({x:yi.left+yi.width/2,y:yi.bottom+5})),x(kc,!0)};var ho=u(to,2);ho.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)};var Li=g(ho);Li.value=(Li.__value=1)==null?"":1;var Ms=u(Li);Ms.value=(Ms.__value=2)==null?"":2;var Zo=u(Ms);Zo.value=(Zo.__value=3)==null?"":3,f(ho);var ko=u(ho,2);ko.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)};var ki=g(ko);ki.value=(ki.__value="solid")==null?"":"solid";var Rs=u(ki);Rs.value=(Rs.__value="dashed")==null?"":"dashed";var pi=u(Rs);pi.value=(pi.__value="dotted")==null?"":"dotted",f(ko),f(io),f(Qn);var Fr=u(Qn,2),Ni=u(g(Fr),2),Sa=g(Ni);Sa.__click=zs=>{x(zl,N(xl));const yi=zs.currentTarget.getBoundingClientRect();x(id,N({x:yi.left+yi.width/2,y:yi.bottom+5})),x(sd,!0)};var $a=u(Sa,2);$a.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)};var Js=g($a);Js.value=(Js.__value=1)==null?"":1;var qi=u(Js);qi.value=(qi.__value=2)==null?"":2;var _r=u(qi);_r.value=(_r.__value=3)==null?"":3,f($a);var Pr=u($a,2);Pr.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)};var Br=g(Pr);Br.value=(Br.__value="solid")==null?"":"solid";var ma=u(Br);ma.value=(ma.__value="dashed")==null?"":"dashed";var Hi=u(ma);Hi.value=(Hi.__value="dotted")==null?"":"dotted",f(Pr),f(Ni),f(Fr);var yr=u(Fr,2),Qa=u(g(yr),2),Yr=g(Qa);Yr.__click=zs=>{x(zl,N(xl));const yi=zs.currentTarget.getBoundingClientRect();x(Ed,N({x:yi.left+yi.width/2,y:yi.bottom+5})),x(Pd,!0)};var Kr=u(Yr,2);Kr.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)};var Ii=g(Kr);Ii.value=(Ii.__value=1)==null?"":1;var Bs=u(Ii);Bs.value=(Bs.__value=2)==null?"":2;var Or=u(Bs);Or.value=(Or.__value=3)==null?"":3,f(Kr);var lr=u(Kr,2);lr.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)};var Ui=g(lr);Ui.value=(Ui.__value="solid")==null?"":"solid";var Mi=u(Ui);Mi.value=(Mi.__value="dashed")==null?"":"dashed";var Fa=u(Mi);Fa.value=(Fa.__value="dotted")==null?"":"dotted",f(lr),f(Qa),f(yr);var xs=u(yr,2),Ba=u(g(xs),2),Ir=g(Ba);Qt(Ir),Ir.__change=()=>{x(Fo,N([...s(Fo)])),te(xl)};var Ci=u(Ir,2),sl=g(Ci);Se(()=>ze(sl,`${Math.round((s(Tr).fillOpacity??.15)*100)??""}%`)),f(Ci),f(Ba),f(xs),f(Jt),f(Za),Se(()=>{zt(Zr,"style",`background-color: ${s(Tr).styles.rsi.color??""}`),zt(to,"style",`background-color: ${(s(Tr).styles.overboughtColor||"#EF4444")??""}`),zt(Sa,"style",`background-color: ${(s(Tr).styles.oversoldColor||"#22C55E")??""}`),zt(Yr,"style",`background-color: ${(s(Tr).styles.middleLineColor||"#6B7280")??""}`)}),po(Ha,()=>s(Tr).period,zs=>s(Tr).period=zs),po(Cr,()=>s(Tr).overboughtLevel,zs=>s(Tr).overboughtLevel=zs),po(Ur,()=>s(Tr).middleLevel,zs=>s(Tr).middleLevel=zs),po(Gl,()=>s(Tr).oversoldLevel,zs=>s(Tr).oversoldLevel=zs),qo(Ua,()=>s(Tr).styles.rsi.thickness,zs=>s(Tr).styles.rsi.thickness=zs),qo(ke,()=>s(Tr).styles.rsi.lineStyle,zs=>s(Tr).styles.rsi.lineStyle=zs),qo(ho,()=>s(Tr).styles.overboughtThickness,zs=>s(Tr).styles.overboughtThickness=zs),qo(ko,()=>s(Tr).styles.overboughtLineStyle,zs=>s(Tr).styles.overboughtLineStyle=zs),qo($a,()=>s(Tr).styles.oversoldThickness,zs=>s(Tr).styles.oversoldThickness=zs),qo(Pr,()=>s(Tr).styles.oversoldLineStyle,zs=>s(Tr).styles.oversoldLineStyle=zs),qo(Kr,()=>s(Tr).styles.middleLineThickness,zs=>s(Tr).styles.middleLineThickness=zs),qo(lr,()=>s(Tr).styles.middleLineStyle,zs=>s(Tr).styles.middleLineStyle=zs),po(Ir,()=>s(Tr).fillOpacity,zs=>s(Tr).fillOpacity=zs),z(Hd,Za)});var jd=u(xd,2),vd=g(jd);vd.__click=ov,f(jd),f(Td),z(qc,Td)},qc=>{var Td=Ln(),xd=Dt(Td);Te(xd,()=>s(ei),jd=>{var vd=qN(),Hd=g(vd);vs(Hd,17,()=>s($e),Vs,(Za,jr,ol)=>{var Lr=WN(),ii=g(Lr),Di=g(ii);Di.textContent=`Stochastic ${ol+1}`;var Ha=u(Di,2);Te(Ha,()=>s($e).length>1,Ii=>{var Bs=VN();Bs.__click=()=>wn(ol),z(Ii,Bs)}),f(ii);var Ns=u(ii,2),Cr=g(Ns),Xa=u(g(Cr),2);Qt(Xa),Xa.__change=()=>Zn(ol),f(Cr);var Ur=u(Cr,2),Ja=u(g(Ur),2);Qt(Ja),Ja.__change=()=>Zn(ol),f(Ur);var Gl=u(Ur,2),Gr=u(g(Gl),2);Qt(Gr),Gr.__change=()=>Zn(ol),f(Gl);var Il=u(Gl,2),bc=u(g(Il),2);Qt(bc),bc.__change=()=>Zn(ol),f(Il),f(Ns);var Zr=u(Ns,2),Ua=g(Zr),Rr=u(g(Ua),2);Qt(Rr),Rr.__change=()=>Zn(ol),f(Ua),f(Zr);var Xr=u(Zr,2),lt=g(Xr),O=u(g(lt),2),pe=g(O);pe.__click=Ii=>{const Bs=Ii.currentTarget.getBoundingClientRect();x(Ya,N({x:Bs.left,y:Bs.bottom+5})),x(ur,N(ol)),x(qr,!0)};var ke=u(pe,2);ke.__change=()=>Zn(ol);var Mt=g(ke);Mt.value=(Mt.__value=1)==null?"":1;var Rt=u(Mt);Rt.value=(Rt.__value=2)==null?"":2;var xn=u(Rt);xn.value=(xn.__value=3)==null?"":3;var Jt=u(xn);Jt.value=(Jt.__value=4)==null?"":4;var Qn=u(Jt);Qn.value=(Qn.__value=5)==null?"":5,f(ke);var io=u(ke,2);io.__change=()=>Zn(ol);var to=g(io);to.value=(to.__value="solid")==null?"":"solid";var ho=u(to);ho.value=(ho.__value="dashed")==null?"":"dashed";var Li=u(ho);Li.value=(Li.__value="dotted")==null?"":"dotted",f(io),f(O),f(lt),f(Xr);var Ms=u(Xr,2),Zo=g(Ms),ko=u(g(Zo),2),ki=g(ko);ki.__click=Ii=>{const Bs=Ii.currentTarget.getBoundingClientRect();x(Ya,N({x:Bs.left,y:Bs.bottom+5})),x(ur,N(ol)),x(Ga,!0)};var Rs=u(ki,2);Rs.__change=()=>Zn(ol);var pi=g(Rs);pi.value=(pi.__value=1)==null?"":1;var Fr=u(pi);Fr.value=(Fr.__value=2)==null?"":2;var Ni=u(Fr);Ni.value=(Ni.__value=3)==null?"":3;var Sa=u(Ni);Sa.value=(Sa.__value=4)==null?"":4;var $a=u(Sa);$a.value=($a.__value=5)==null?"":5,f(Rs);var Js=u(Rs,2);Js.__change=()=>Zn(ol);var qi=g(Js);qi.value=(qi.__value="solid")==null?"":"solid";var _r=u(qi);_r.value=(_r.__value="dashed")==null?"":"dashed";var Pr=u(_r);Pr.value=(Pr.__value="dotted")==null?"":"dotted",f(Js),f(ko),f(Zo),f(Ms);var Br=u(Ms,2),ma=u(g(Br),2),Hi=u(g(ma),2);Hi.__click=Ii=>{const Bs=Ii.currentTarget.getBoundingClientRect();x(Ya,N({x:Bs.left,y:Bs.bottom+5})),x(ur,N(ol)),x(Ki,!0)},f(ma);var yr=u(ma,2),Qa=u(g(yr),2);Qa.__click=Ii=>{const Bs=Ii.currentTarget.getBoundingClientRect();x(Ya,N({x:Bs.left,y:Bs.bottom+5})),x(ur,N(ol)),x(Zl,!0)},f(yr);var Yr=u(yr,2),Kr=u(g(Yr),2);Kr.__click=Ii=>{const Bs=Ii.currentTarget.getBoundingClientRect();x(Ya,N({x:Bs.left,y:Bs.bottom+5})),x(ur,N(ol)),x(Tl,!0)},f(Yr),f(Br),f(Lr),Se(()=>{zt(pe,"style",`background-color: ${s(jr).styles.kLine.color??""}`),zt(ki,"style",`background-color: ${s(jr).styles.dLine.color??""}`),zt(Hi,"style",`background-color: ${(s(jr).styles.overboughtColor||"#EF4444")??""}`),zt(Qa,"style",`background-color: ${(s(jr).styles.oversoldColor||"#10B981")??""}`),zt(Kr,"style",`background-color: ${(s(jr).styles.midLineColor||"#6B7280")??""}`)}),po(Xa,()=>s(jr).kPeriod,Ii=>s(jr).kPeriod=Ii),po(Ja,()=>s(jr).dPeriod,Ii=>s(jr).dPeriod=Ii),po(Gr,()=>s(jr).overboughtLevel,Ii=>s(jr).overboughtLevel=Ii),po(bc,()=>s(jr).oversoldLevel,Ii=>s(jr).oversoldLevel=Ii),po(Rr,()=>s(jr).midLevel,Ii=>s(jr).midLevel=Ii),qo(ke,()=>s(jr).styles.kLine.thickness,Ii=>s(jr).styles.kLine.thickness=Ii),qo(io,()=>s(jr).styles.kLine.lineStyle,Ii=>s(jr).styles.kLine.lineStyle=Ii),qo(Rs,()=>s(jr).styles.dLine.thickness,Ii=>s(jr).styles.dLine.thickness=Ii),qo(Js,()=>s(jr).styles.dLine.lineStyle,Ii=>s(jr).styles.dLine.lineStyle=Ii),z(Za,Lr)});var Tr=u(Hd,2),xl=g(Tr);xl.__click=$t,f(Tr),f(vd),z(jd,vd)},jd=>{var vd=Ln(),Hd=Dt(vd);Te(Hd,()=>s(ge),Tr=>{var xl=YN(),Za=g(xl);vs(Za,17,()=>s(Yo),Vs,(Lr,ii,Di)=>{var Ha=GN(),Ns=g(Ha),Cr=g(Ns);Cr.textContent=`DMI ${Di+1}`;var Xa=u(Cr,2);Te(Xa,()=>s(Yo).length>1,Ui=>{var Mi=UN();Mi.__click=[HN,Wi,ii],z(Ui,Mi)}),f(Ns);var Ur=u(Ns,2),Ja=g(Ur),Gl=u(g(Ja),2);Qt(Gl),Gl.__input=Bt,f(Ja);var Gr=u(Ja,2),Il=u(g(Gr),2);Qt(Il),Il.__input=Bt,f(Gr),f(Ur);var bc=u(Ur,2),Zr=g(bc),Ua=u(g(Zr),2),Rr=vt(()=>Su(Di,"diPlus"));Ua.__click=function(...Ui){var Mi;(Mi=s(Rr))==null||Mi.apply(this,Ui)};var Xr=g(Ua);f(Ua);var lt=u(Ua,2);lt.__change=Bt;var O=g(lt);O.value=(O.__value=1)==null?"":1;var pe=u(O);pe.value=(pe.__value=2)==null?"":2;var ke=u(pe);ke.value=(ke.__value=3)==null?"":3;var Mt=u(ke);Mt.value=(Mt.__value=4)==null?"":4;var Rt=u(Mt);Rt.value=(Rt.__value=5)==null?"":5,f(lt);var xn=u(lt,2);xn.__change=Bt;var Jt=g(xn);Jt.value=(Jt.__value="solid")==null?"":"solid";var Qn=u(Jt);Qn.value=(Qn.__value="dashed")==null?"":"dashed";var io=u(Qn);io.value=(io.__value="dotted")==null?"":"dotted",f(xn),f(Zr);var to=u(Zr,2),ho=u(g(to),2),Li=vt(()=>Su(Di,"diMinus"));ho.__click=function(...Ui){var Mi;(Mi=s(Li))==null||Mi.apply(this,Ui)};var Ms=g(ho);f(ho);var Zo=u(ho,2);Zo.__change=Bt;var ko=g(Zo);ko.value=(ko.__value=1)==null?"":1;var ki=u(ko);ki.value=(ki.__value=2)==null?"":2;var Rs=u(ki);Rs.value=(Rs.__value=3)==null?"":3;var pi=u(Rs);pi.value=(pi.__value=4)==null?"":4;var Fr=u(pi);Fr.value=(Fr.__value=5)==null?"":5,f(Zo);var Ni=u(Zo,2);Ni.__change=Bt;var Sa=g(Ni);Sa.value=(Sa.__value="solid")==null?"":"solid";var $a=u(Sa);$a.value=($a.__value="dashed")==null?"":"dashed";var Js=u($a);Js.value=(Js.__value="dotted")==null?"":"dotted",f(Ni),f(to);var qi=u(to,2),_r=u(g(qi),2),Pr=vt(()=>Su(Di,"adx"));_r.__click=function(...Ui){var Mi;(Mi=s(Pr))==null||Mi.apply(this,Ui)};var Br=g(_r);f(_r);var ma=u(_r,2);ma.__change=Bt;var Hi=g(ma);Hi.value=(Hi.__value=1)==null?"":1;var yr=u(Hi);yr.value=(yr.__value=2)==null?"":2;var Qa=u(yr);Qa.value=(Qa.__value=3)==null?"":3;var Yr=u(Qa);Yr.value=(Yr.__value=4)==null?"":4;var Kr=u(Yr);Kr.value=(Kr.__value=5)==null?"":5,f(ma);var Ii=u(ma,2);Ii.__change=Bt;var Bs=g(Ii);Bs.value=(Bs.__value="solid")==null?"":"solid";var Or=u(Bs);Or.value=(Or.__value="dashed")==null?"":"dashed";var lr=u(Or);lr.value=(lr.__value="dotted")==null?"":"dotted",f(Ii),f(qi),f(bc),f(Ha),Se(()=>{zt(Xr,"style",`background-color: ${s(ii).styles.diPlus.color??""}`),zt(Ms,"style",`background-color: ${s(ii).styles.diMinus.color??""}`),zt(Br,"style",`background-color: ${s(ii).styles.adx.color??""}`)}),po(Gl,()=>s(ii).diPeriod,Ui=>s(ii).diPeriod=Ui),po(Il,()=>s(ii).adxPeriod,Ui=>s(ii).adxPeriod=Ui),qo(lt,()=>s(ii).styles.diPlus.thickness,Ui=>s(ii).styles.diPlus.thickness=Ui),qo(xn,()=>s(ii).styles.diPlus.lineStyle,Ui=>s(ii).styles.diPlus.lineStyle=Ui),qo(Zo,()=>s(ii).styles.diMinus.thickness,Ui=>s(ii).styles.diMinus.thickness=Ui),qo(Ni,()=>s(ii).styles.diMinus.lineStyle,Ui=>s(ii).styles.diMinus.lineStyle=Ui),qo(ma,()=>s(ii).styles.adx.thickness,Ui=>s(ii).styles.adx.thickness=Ui),qo(Ii,()=>s(ii).styles.adx.lineStyle,Ui=>s(ii).styles.adx.lineStyle=Ui),z(Lr,Ha)});var jr=u(Za,2),ol=g(jr);ol.__click=[CN,ge,Yo,Bt],f(jr),f(xl),z(Tr,xl)},Tr=>{var xl=Ln(),Za=Dt(xl);Te(Za,()=>s(Er),jr=>{var ol=JN(),Lr=g(ol);vs(Lr,17,()=>s(Bc),Vs,(Ha,Ns,Cr)=>{var Xa=XN(),Ur=g(Xa),Ja=g(Ur);Ja.textContent=`Williams %R ${Cr+1}`;var Gl=u(Ja,2);Te(Gl,()=>s(Bc).length>1,Zs=>{var pa=ZN();pa.__click=[KN,_i,Ns],z(Zs,pa)}),f(Ur);var Gr=u(Ur,2),Il=g(Gr),bc=u(g(Il),2);Qt(bc),bc.__change=()=>Ar(Cr),f(Il);var Zr=u(Il,2),Ua=u(g(Zr),2);Qt(Ua),Ua.__change=()=>Ar(Cr),f(Zr);var Rr=u(Zr,2),Xr=u(g(Rr),2);Qt(Xr),Xr.__change=()=>Ar(Cr),f(Rr);var lt=u(Rr,2),O=u(g(lt),2);Qt(O),O.__change=()=>Ar(Cr),f(lt),f(Gr);var pe=u(Gr,2),ke=g(pe),Mt=u(g(ke),2),Rt=vt(()=>Wu(Cr));Mt.__click=function(...Zs){var pa;(pa=s(Rt))==null||pa.apply(this,Zs)};var xn=g(Mt);f(Mt);var Jt=u(Mt,2);Jt.__change=()=>Ar(Cr);var Qn=g(Jt);Qn.value=(Qn.__value=1)==null?"":1;var io=u(Qn);io.value=(io.__value=2)==null?"":2;var to=u(io);to.value=(to.__value=3)==null?"":3;var ho=u(to);ho.value=(ho.__value=4)==null?"":4;var Li=u(ho);Li.value=(Li.__value=5)==null?"":5,f(Jt);var Ms=u(Jt,2);Ms.__change=()=>Ar(Cr);var Zo=g(Ms);Zo.value=(Zo.__value="solid")==null?"":"solid";var ko=u(Zo);ko.value=(ko.__value="dashed")==null?"":"dashed";var ki=u(ko);ki.value=(ki.__value="dotted")==null?"":"dotted",f(Ms),f(ke),f(pe);var Rs=u(pe,2),pi=u(g(Rs),2),Fr=u(g(pi),2),Ni=vt(()=>tf(Cr));Fr.__click=function(...Zs){var pa;(pa=s(Ni))==null||pa.apply(this,Zs)};var Sa=g(Fr);f(Fr);var $a=u(Fr,2);$a.__change=()=>Ar(Cr);var Js=g($a);Js.value=(Js.__value=1)==null?"":1;var qi=u(Js);qi.value=(qi.__value=2)==null?"":2;var _r=u(qi);_r.value=(_r.__value=3)==null?"":3;var Pr=u(_r);Pr.value=(Pr.__value=4)==null?"":4;var Br=u(Pr);Br.value=(Br.__value=5)==null?"":5,f($a);var ma=u($a,2);ma.__change=()=>Ar(Cr);var Hi=g(ma);Hi.value=(Hi.__value="solid")==null?"":"solid";var yr=u(Hi);yr.value=(yr.__value="dashed")==null?"":"dashed";var Qa=u(yr);Qa.value=(Qa.__value="dotted")==null?"":"dotted",f(ma),f(pi);var Yr=u(pi,2),Kr=u(g(Yr),2),Ii=vt(()=>Yp(Cr));Kr.__click=function(...Zs){var pa;(pa=s(Ii))==null||pa.apply(this,Zs)};var Bs=g(Kr);f(Kr);var Or=u(Kr,2);Or.__change=()=>Ar(Cr);var lr=g(Or);lr.value=(lr.__value=1)==null?"":1;var Ui=u(lr);Ui.value=(Ui.__value=2)==null?"":2;var Mi=u(Ui);Mi.value=(Mi.__value=3)==null?"":3;var Fa=u(Mi);Fa.value=(Fa.__value=4)==null?"":4;var xs=u(Fa);xs.value=(xs.__value=5)==null?"":5,f(Or);var Ba=u(Or,2);Ba.__change=()=>Ar(Cr);var Ir=g(Ba);Ir.value=(Ir.__value="solid")==null?"":"solid";var Ci=u(Ir);Ci.value=(Ci.__value="dashed")==null?"":"dashed";var sl=u(Ci);sl.value=(sl.__value="dotted")==null?"":"dotted",f(Ba),f(Yr);var zs=u(Yr,2),yi=u(g(zs),2),Jr=vt(()=>sv(Cr));yi.__click=function(...Zs){var pa;(pa=s(Jr))==null||pa.apply(this,Zs)};var ga=g(yi);f(yi);var cr=u(yi,2);cr.__change=()=>Ar(Cr);var ua=g(cr);ua.value=(ua.__value=1)==null?"":1;var il=u(ua);il.value=(il.__value=2)==null?"":2;var br=u(il);br.value=(br.__value=3)==null?"":3;var Mr=u(br);Mr.value=(Mr.__value=4)==null?"":4;var ia=u(Mr);ia.value=(ia.__value=5)==null?"":5,f(cr);var ri=u(cr,2);ri.__change=()=>Ar(Cr);var Vo=g(ri);Vo.value=(Vo.__value="solid")==null?"":"solid";var vi=u(Vo);vi.value=(vi.__value="dashed")==null?"":"dashed";var ha=u(vi);ha.value=(ha.__value="dotted")==null?"":"dotted",f(ri),f(zs),f(Rs),f(Xa),Se(()=>{zt(xn,"style",`background-color: ${s(Ns).styles.wr.color??""}`),zt(Sa,"style",`background-color: ${s(Ns).styles.overbought.color??""}`),zt(Bs,"style",`background-color: ${s(Ns).styles.middleLine.color??""}`),zt(ga,"style",`background-color: ${s(Ns).styles.oversold.color??""}`)}),po(bc,()=>s(Ns).period,Zs=>s(Ns).period=Zs),po(Ua,()=>s(Ns).overboughtLevel,Zs=>s(Ns).overboughtLevel=Zs),po(Xr,()=>s(Ns).middleLevel,Zs=>s(Ns).middleLevel=Zs),po(O,()=>s(Ns).oversoldLevel,Zs=>s(Ns).oversoldLevel=Zs),qo(Jt,()=>s(Ns).styles.wr.thickness,Zs=>s(Ns).styles.wr.thickness=Zs),qo(Ms,()=>s(Ns).styles.wr.lineStyle,Zs=>s(Ns).styles.wr.lineStyle=Zs),qo($a,()=>s(Ns).styles.overbought.thickness,Zs=>s(Ns).styles.overbought.thickness=Zs),qo(ma,()=>s(Ns).styles.overbought.lineStyle,Zs=>s(Ns).styles.overbought.lineStyle=Zs),qo(Or,()=>s(Ns).styles.middleLine.thickness,Zs=>s(Ns).styles.middleLine.thickness=Zs),qo(Ba,()=>s(Ns).styles.middleLine.lineStyle,Zs=>s(Ns).styles.middleLine.lineStyle=Zs),qo(cr,()=>s(Ns).styles.oversold.thickness,Zs=>s(Ns).styles.oversold.thickness=Zs),qo(ri,()=>s(Ns).styles.oversold.lineStyle,Zs=>s(Ns).styles.oversold.lineStyle=Zs),z(Ha,Xa)});var ii=u(Lr,2),Di=g(ii);Di.__click=$o,f(ii),f(ol),z(jr,ol)},jr=>{var ol=Ln(),Lr=Dt(ol);Te(Lr,()=>s(Sc),ii=>{var Di=tD(),Ha=g(Di);vs(Ha,17,()=>s(qd),Vs,(Xa,Ur,Ja)=>{var Gl=eD(),Gr=g(Gl),Il=g(Gr);Il.textContent=`VR ${Ja+1}`;var bc=u(Il,2);Te(bc,()=>s(qd).length>1,Vo=>{var vi=QN();vi.__click=()=>ds(Ja),z(Vo,vi)}),f(Gr);var Zr=u(Gr,2),Ua=g(Zr),Rr=u(g(Ua),2);Qt(Rr),f(Ua);var Xr=u(Ua,2),lt=u(g(Xr),2);Qt(lt),f(Xr);var O=u(Xr,2),pe=u(g(O),2);Qt(pe),f(O),f(Zr);var ke=u(Zr,2),Mt=u(g(ke),2),Rt=g(Mt),xn=u(g(Rt),2),Jt=vt(()=>_u(Ja,"vr"));xn.__click=function(...Vo){var vi;(vi=s(Jt))==null||vi.apply(this,Vo)};var Qn=g(xn);f(xn),f(Rt);var io=u(Rt,2),to=u(g(io),2);to.__change=()=>wo(Ja);var ho=g(to);ho.value=(ho.__value=1)==null?"":1;var Li=u(ho);Li.value=(Li.__value=2)==null?"":2;var Ms=u(Li);Ms.value=(Ms.__value=3)==null?"":3;var Zo=u(Ms);Zo.value=(Zo.__value=4)==null?"":4;var ko=u(Zo);ko.value=(ko.__value=5)==null?"":5,f(to),f(io);var ki=u(io,2),Rs=u(g(ki),2);Rs.__change=()=>wo(Ja);var pi=g(Rs);pi.value=(pi.__value="solid")==null?"":"solid";var Fr=u(pi);Fr.value=(Fr.__value="dashed")==null?"":"dashed";var Ni=u(Fr);Ni.value=(Ni.__value="dotted")==null?"":"dotted",f(Rs),f(ki),f(Mt),f(ke);var Sa=u(ke,2),$a=u(g(Sa),2),Js=g($a),qi=u(g(Js),2),_r=vt(()=>_u(Ja,"vrShort"));qi.__click=function(...Vo){var vi;(vi=s(_r))==null||vi.apply(this,Vo)};var Pr=g(qi);f(qi),f(Js);var Br=u(Js,2),ma=u(g(Br),2);ma.__change=()=>wo(Ja);var Hi=g(ma);Hi.value=(Hi.__value=1)==null?"":1;var yr=u(Hi);yr.value=(yr.__value=2)==null?"":2;var Qa=u(yr);Qa.value=(Qa.__value=3)==null?"":3;var Yr=u(Qa);Yr.value=(Yr.__value=4)==null?"":4;var Kr=u(Yr);Kr.value=(Kr.__value=5)==null?"":5,f(ma),f(Br);var Ii=u(Br,2),Bs=u(g(Ii),2);Bs.__change=()=>wo(Ja);var Or=g(Bs);Or.value=(Or.__value="solid")==null?"":"solid";var lr=u(Or);lr.value=(lr.__value="dashed")==null?"":"dashed";var Ui=u(lr);Ui.value=(Ui.__value="dotted")==null?"":"dotted",f(Bs),f(Ii),f($a),f(Sa);var Mi=u(Sa,2),Fa=u(g(Mi),2),xs=g(Fa),Ba=u(g(xs),2),Ir=vt(()=>_u(Ja,"vrLong"));Ba.__click=function(...Vo){var vi;(vi=s(Ir))==null||vi.apply(this,Vo)};var Ci=g(Ba);f(Ba),f(xs);var sl=u(xs,2),zs=u(g(sl),2);zs.__change=()=>wo(Ja);var yi=g(zs);yi.value=(yi.__value=1)==null?"":1;var Jr=u(yi);Jr.value=(Jr.__value=2)==null?"":2;var ga=u(Jr);ga.value=(ga.__value=3)==null?"":3;var cr=u(ga);cr.value=(cr.__value=4)==null?"":4;var ua=u(cr);ua.value=(ua.__value=5)==null?"":5,f(zs),f(sl);var il=u(sl,2),br=u(g(il),2);br.__change=()=>wo(Ja);var Mr=g(br);Mr.value=(Mr.__value="solid")==null?"":"solid";var ia=u(Mr);ia.value=(ia.__value="dashed")==null?"":"dashed";var ri=u(ia);ri.value=(ri.__value="dotted")==null?"":"dotted",f(br),f(il),f(Fa),f(Mi),f(Gl),Se(()=>{zt(Qn,"style",`background-color: ${s(Ur).styles.vr.color??""}`),zt(Pr,"style",`background-color: ${s(Ur).styles.vrShort.color??""}`),zt(Ci,"style",`background-color: ${s(Ur).styles.vrLong.color??""}`)}),po(Rr,()=>s(Ur).period,Vo=>s(Ur).period=Vo),po(lt,()=>s(Ur).shortPeriod,Vo=>s(Ur).shortPeriod=Vo),po(pe,()=>s(Ur).longPeriod,Vo=>s(Ur).longPeriod=Vo),qo(to,()=>s(Ur).styles.vr.thickness,Vo=>s(Ur).styles.vr.thickness=Vo),qo(Rs,()=>s(Ur).styles.vr.lineStyle,Vo=>s(Ur).styles.vr.lineStyle=Vo),qo(ma,()=>s(Ur).styles.vrShort.thickness,Vo=>s(Ur).styles.vrShort.thickness=Vo),qo(Bs,()=>s(Ur).styles.vrShort.lineStyle,Vo=>s(Ur).styles.vrShort.lineStyle=Vo),qo(zs,()=>s(Ur).styles.vrLong.thickness,Vo=>s(Ur).styles.vrLong.thickness=Vo),qo(br,()=>s(Ur).styles.vrLong.lineStyle,Vo=>s(Ur).styles.vrLong.lineStyle=Vo),z(Xa,Gl)});var Ns=u(Ha,2),Cr=g(Ns);Cr.__click=ss,f(Ns),f(Di),z(ii,Di)},ii=>{var Di=Ln(),Ha=Dt(Di);Te(Ha,()=>s(ea),Ns=>{var Cr=iD(),Xa=g(Cr);vs(Xa,17,()=>s(B),Vs,(Gl,Gr,Il)=>{var bc=sD(),Zr=g(bc),Ua=g(Zr);Ua.textContent=`BBI ${Il+1}`;var Rr=u(Ua,2);Te(Rr,()=>s(B).length>1,_r=>{var Pr=oD();Pr.__click=[nD,Wl,Gr],z(_r,Pr)}),f(Zr);var Xr=u(Zr,2),lt=g(Xr),O=u(g(lt),2);Qt(O),O.__change=()=>ir(Il),f(lt);var pe=u(lt,2),ke=u(g(pe),2);Qt(ke),ke.__change=()=>ir(Il),f(pe);var Mt=u(pe,2),Rt=u(g(Mt),2);Qt(Rt),Rt.__change=()=>ir(Il),f(Mt);var xn=u(Mt,2),Jt=u(g(xn),2);Qt(Jt),Jt.__change=()=>ir(Il),f(xn),f(Xr);var Qn=u(Xr,2),io=g(Qn),to=u(g(io),2),ho=vt(()=>ls(Il));to.__click=function(..._r){var Pr;(Pr=s(ho))==null||Pr.apply(this,_r)};var Li=g(to);f(to),f(io);var Ms=u(io,2),Zo=u(g(Ms),2);Zo.__change=()=>ir(Il);var ko=g(Zo);ko.value=(ko.__value=1)==null?"":1;var ki=u(ko);ki.value=(ki.__value=2)==null?"":2;var Rs=u(ki);Rs.value=(Rs.__value=3)==null?"":3;var pi=u(Rs);pi.value=(pi.__value=4)==null?"":4;var Fr=u(pi);Fr.value=(Fr.__value=5)==null?"":5,f(Zo),f(Ms);var Ni=u(Ms,2),Sa=u(g(Ni),2);Sa.__change=()=>ir(Il);var $a=g(Sa);$a.value=($a.__value="solid")==null?"":"solid";var Js=u($a);Js.value=(Js.__value="dashed")==null?"":"dashed";var qi=u(Js);qi.value=(qi.__value="dotted")==null?"":"dotted",f(Sa),f(Ni),f(Qn),f(bc),Se(()=>zt(Li,"style",`background-color: ${s(Gr).color??""}`)),po(O,()=>s(Gr).period1,_r=>s(Gr).period1=_r),po(ke,()=>s(Gr).period2,_r=>s(Gr).period2=_r),po(Rt,()=>s(Gr).period3,_r=>s(Gr).period3=_r),po(Jt,()=>s(Gr).period4,_r=>s(Gr).period4=_r),qo(Zo,()=>s(Gr).thickness,_r=>s(Gr).thickness=_r),qo(Sa,()=>s(Gr).lineStyle,_r=>s(Gr).lineStyle=_r),z(Gl,bc)});var Ur=u(Xa,2),Ja=g(Ur);Ja.__click=Gc,f(Ur),f(Cr),z(Ns,Cr)},Ns=>{var Cr=Ln(),Xa=Dt(Cr);Te(Xa,()=>s(uo),Ur=>{var Ja=cD(),Gl=g(Ja);vs(Gl,17,()=>s(Gn),Vs,(bc,Zr)=>{var Ua=lD(),Rr=g(Ua),Xr=g(Rr),lt=g(Xr,!0);f(Xr);var O=u(Xr,2);Te(O,()=>s(Gn).length>1,Js=>{var qi=aD();qi.__click=[rD,Nt,Zr],z(Js,qi)}),f(Rr);var pe=u(Rr,2),ke=g(pe),Mt=u(g(ke),2);Qt(Mt),f(ke);var Rt=u(ke,2),xn=u(g(Rt),2);Qt(xn),f(Rt),f(pe);var Jt=u(pe,2),Qn=g(Jt),io=u(g(Qn),2);io.__click=[MN,ye,K];var to=g(io);f(io),f(Qn);var ho=u(Qn,2),Li=u(g(ho),2),Ms=g(Li);Ms.value=(Ms.__value=1)==null?"":1;var Zo=u(Ms);Zo.value=(Zo.__value=2)==null?"":2;var ko=u(Zo);ko.value=(ko.__value=3)==null?"":3;var ki=u(ko);ki.value=(ki.__value=4)==null?"":4;var Rs=u(ki);Rs.value=(Rs.__value=5)==null?"":5,f(Li),f(ho);var pi=u(ho,2),Fr=u(g(pi),2),Ni=g(Fr);Ni.value=(Ni.__value="solid")==null?"":"solid";var Sa=u(Ni);Sa.value=(Sa.__value="dashed")==null?"":"dashed";var $a=u(Sa);$a.value=($a.__value="dotted")==null?"":"dotted",f(Fr),f(pi),f(Jt),f(Ua),Se(()=>{ze(lt,s(Zr).name),zt(to,"style",`background-color: ${s(Zr).color??""}`)}),po(Mt,()=>s(Zr).period,Js=>s(Zr).period=Js),po(xn,()=>s(Zr).period2,Js=>s(Zr).period2=Js),qo(Li,()=>s(Zr).thickness,Js=>s(Zr).thickness=Js),qo(Fr,()=>s(Zr).lineStyle,Js=>s(Zr).lineStyle=Js),z(bc,Ua)});var Gr=u(Gl,2),Il=g(Gr);Il.__click=[yN,uo,Gn],f(Gr),f(Ja),z(Ur,Ja)},Ur=>{var Ja=Ln(),Gl=Dt(Ja);Te(Gl,()=>s(hs),Gr=>{var Il=vD(),bc=g(Il);vs(bc,17,()=>s(Ds),Vs,(Rr,Xr,lt)=>{var O=pD(),pe=g(O),ke=g(pe),Mt=g(ke,!0);f(ke);var Rt=u(ke,2);Te(Rt,()=>s(Ds).length>1,Pr=>{var Br=uD();Br.__click=[dD,mo,Xr],z(Pr,Br)}),f(pe);var xn=u(pe,2),Jt=g(xn),Qn=u(g(Jt),2);Qt(Qn),Qn.__input=Bo,f(Jt),f(xn);var io=u(xn,2),to=g(io),ho=u(g(to),2),Li=vt(()=>Zd(lt));ho.__click=function(...Pr){var Br;(Br=s(Li))==null||Br.apply(this,Pr)};var Ms=g(ho);f(ho),f(to);var Zo=u(to,2),ko=u(g(Zo),2);ko.__change=Bo;var ki=g(ko);ki.value=(ki.__value=1)==null?"":1;var Rs=u(ki);Rs.value=(Rs.__value=2)==null?"":2;var pi=u(Rs);pi.value=(pi.__value=3)==null?"":3;var Fr=u(pi);Fr.value=(Fr.__value=4)==null?"":4;var Ni=u(Fr);Ni.value=(Ni.__value=5)==null?"":5,f(ko),f(Zo);var Sa=u(Zo,2),$a=u(g(Sa),2);$a.__change=Bo;var Js=g($a);Js.value=(Js.__value="solid")==null?"":"solid";var qi=u(Js);qi.value=(qi.__value="dashed")==null?"":"dashed";var _r=u(qi);_r.value=(_r.__value="dotted")==null?"":"dotted",f($a),f(Sa),f(io),f(O),Se(()=>{ze(Mt,s(Xr).name),zt(Ms,"style",`background-color: ${s(Xr).color??""}`)}),po(Qn,()=>s(Xr).period,Pr=>s(Xr).period=Pr),qo(ko,()=>s(Xr).thickness,Pr=>s(Xr).thickness=Pr),qo($a,()=>s(Xr).lineStyle,Pr=>s(Xr).lineStyle=Pr),z(Rr,O)});var Zr=u(bc,2),Ua=g(Zr);Ua.__click=[bN,hs,Ds,Bo],f(Zr),f(Il),z(Gr,Il)},Gr=>{var Il=Ln(),bc=Dt(Il);Te(bc,()=>s(dc),Zr=>{var Ua=gD(),Rr=g(Ua);vs(Rr,17,()=>s(Oc),Vs,(O,pe,ke)=>{var Mt=mD(),Rt=g(Mt),xn=g(Rt);xn.textContent=ke===0?"Awesome Oscillator":`AO ${ke+1}`;var Jt=u(xn,2);Jt.__click=[fD,Wv,pe],f(Rt);var Qn=u(Rt,2),io=g(Qn),to=u(g(io),2);Qt(to),to.__input=Jc,f(io);var ho=u(io,2),Li=u(g(ho),2);Qt(Li),Li.__input=Jc,f(ho),f(Qn);var Ms=u(Qn,2),Zo=u(g(Ms),2),ko=g(Zo),ki=u(g(ko),2),Rs=g(ki),pi=u(Rs,2),Fr=vt(()=>Cu(ke*2));pi.__click=function(...Br){var ma;(ma=s(Fr))==null||ma.apply(this,Br)};var Ni=g(pi);f(pi),f(ki),f(ko);var Sa=u(ko,2),$a=u(g(Sa),2),Js=g($a),qi=u(Js,2),_r=vt(()=>Cu(ke*2+1));qi.__click=function(...Br){var ma;(ma=s(_r))==null||ma.apply(this,Br)};var Pr=g(qi);f(qi),f($a),f(Sa),f(Zo),f(Ms),f(Mt),Se(()=>{zt(Rs,"style",`background-color: ${s(pe).styles.increasing.color??""}`),zt(Ni,"style",`background-color: ${s(pe).styles.increasing.color??""}`),zt(Js,"style",`background-color: ${s(pe).styles.decreasing.color??""}`),zt(Pr,"style",`background-color: ${s(pe).styles.decreasing.color??""}`)}),po(to,()=>s(pe).shortPeriod,Br=>s(pe).shortPeriod=Br),po(Li,()=>s(pe).longPeriod,Br=>s(pe).longPeriod=Br),z(O,Mt)});var Xr=u(Rr,2),lt=g(Xr);lt.__click=[IN,dc,Oc,Jc],f(Xr),f(Ua),z(Zr,Ua)},Zr=>{var Ua=Ln(),Rr=Dt(Ua);Te(Rr,()=>s(Ct),Xr=>{var lt=bD(),O=g(lt);vs(O,17,()=>s(Is),Vs,(Mt,Rt,xn)=>{var Jt=yD(),Qn=g(Jt),io=g(Qn);io.textContent=`CR ${xn+1}`;var to=u(io,2);Te(to,()=>s(Is).length>1,_a=>{var ed=_D();ed.__click=[hD,er,Rt],z(_a,ed)}),f(Qn);var ho=u(Qn,2),Li=g(ho),Ms=u(g(Li),2);Qt(Ms),Ms.__input=js,f(Li);var Zo=u(Li,2),ko=u(g(Zo),2);Qt(ko),ko.__input=js,f(Zo);var ki=u(Zo,2),Rs=u(g(ki),2);Qt(Rs),Rs.__input=js,f(ki);var pi=u(ki,2),Fr=u(g(pi),2);Qt(Fr),Fr.__input=js,f(pi);var Ni=u(pi,2),Sa=u(g(Ni),2);Qt(Sa),Sa.__input=js,f(Ni),f(ho);var $a=u(ho,2),Js=g($a),qi=u(g(Js),2),_r=vt(()=>qa(xn,"cr"));qi.__click=function(..._a){var ed;(ed=s(_r))==null||ed.apply(this,_a)};var Pr=g(qi);f(qi);var Br=u(qi,2);Br.__change=js;var ma=g(Br);ma.value=(ma.__value=1)==null?"":1;var Hi=u(ma);Hi.value=(Hi.__value=2)==null?"":2;var yr=u(Hi);yr.value=(yr.__value=3)==null?"":3;var Qa=u(yr);Qa.value=(Qa.__value=4)==null?"":4;var Yr=u(Qa);Yr.value=(Yr.__value=5)==null?"":5,f(Br);var Kr=u(Br,2);Kr.__change=js;var Ii=g(Kr);Ii.value=(Ii.__value="solid")==null?"":"solid";var Bs=u(Ii);Bs.value=(Bs.__value="dashed")==null?"":"dashed";var Or=u(Bs);Or.value=(Or.__value="dotted")==null?"":"dotted",f(Kr),f(Js);var lr=u(Js,2),Ui=u(g(lr),2),Mi=vt(()=>qa(xn,"ma1"));Ui.__click=function(..._a){var ed;(ed=s(Mi))==null||ed.apply(this,_a)};var Fa=g(Ui);f(Ui);var xs=u(Ui,2);xs.__change=js;var Ba=g(xs);Ba.value=(Ba.__value=1)==null?"":1;var Ir=u(Ba);Ir.value=(Ir.__value=2)==null?"":2;var Ci=u(Ir);Ci.value=(Ci.__value=3)==null?"":3;var sl=u(Ci);sl.value=(sl.__value=4)==null?"":4;var zs=u(sl);zs.value=(zs.__value=5)==null?"":5,f(xs);var yi=u(xs,2);yi.__change=js;var Jr=g(yi);Jr.value=(Jr.__value="solid")==null?"":"solid";var ga=u(Jr);ga.value=(ga.__value="dashed")==null?"":"dashed";var cr=u(ga);cr.value=(cr.__value="dotted")==null?"":"dotted",f(yi),f(lr);var ua=u(lr,2),il=u(g(ua),2),br=vt(()=>qa(xn,"ma2"));il.__click=function(..._a){var ed;(ed=s(br))==null||ed.apply(this,_a)};var Mr=g(il);f(il);var ia=u(il,2);ia.__change=js;var ri=g(ia);ri.value=(ri.__value=1)==null?"":1;var Vo=u(ri);Vo.value=(Vo.__value=2)==null?"":2;var vi=u(Vo);vi.value=(vi.__value=3)==null?"":3;var ha=u(vi);ha.value=(ha.__value=4)==null?"":4;var Zs=u(ha);Zs.value=(Zs.__value=5)==null?"":5,f(ia);var pa=u(ia,2);pa.__change=js;var Oi=g(pa);Oi.value=(Oi.__value="solid")==null?"":"solid";var Ea=u(Oi);Ea.value=(Ea.__value="dashed")==null?"":"dashed";var fc=u(Ea);fc.value=(fc.__value="dotted")==null?"":"dotted",f(pa),f(ua);var wl=u(ua,2),Ml=u(g(wl),2),Yl=vt(()=>qa(xn,"ma3"));Ml.__click=function(..._a){var ed;(ed=s(Yl))==null||ed.apply(this,_a)};var Hc=g(Ml);f(Ml);var $c=u(Ml,2);$c.__change=js;var jc=g($c);jc.value=(jc.__value=1)==null?"":1;var Mc=u(jc);Mc.value=(Mc.__value=2)==null?"":2;var xc=u(Mc);xc.value=(xc.__value=3)==null?"":3;var Oa=u(xc);Oa.value=(Oa.__value=4)==null?"":4;var ad=u(Oa);ad.value=(ad.__value=5)==null?"":5,f($c);var iu=u($c,2);iu.__change=js;var Mu=g(iu);Mu.value=(Mu.__value="solid")==null?"":"solid";var Uc=u(Mu);Uc.value=(Uc.__value="dashed")==null?"":"dashed";var Eu=u(Uc);Eu.value=(Eu.__value="dotted")==null?"":"dotted",f(iu),f(wl);var Nu=u(wl,2),wd=u(g(Nu),2),va=vt(()=>qa(xn,"ma4"));wd.__click=function(..._a){var ed;(ed=s(va))==null||ed.apply(this,_a)};var Ku=g(wd);f(wd);var kd=u(wd,2);kd.__change=js;var ep=g(kd);ep.value=(ep.__value=1)==null?"":1;var Du=u(ep);Du.value=(Du.__value=2)==null?"":2;var $l=u(Du);$l.value=($l.__value=3)==null?"":3;var tp=u($l);tp.value=(tp.__value=4)==null?"":4;var yu=u(tp);yu.value=(yu.__value=5)==null?"":5,f(kd);var vu=u(kd,2);vu.__change=js;var Ld=g(vu);Ld.value=(Ld.__value="solid")==null?"":"solid";var ru=u(Ld);ru.value=(ru.__value="dashed")==null?"":"dashed";var np=u(ru);np.value=(np.__value="dotted")==null?"":"dotted",f(vu),f(Nu),f($a),f(Jt),Se(()=>{zt(Pr,"style",`background-color: ${s(Rt).styles.cr.color??""}`),zt(Fa,"style",`background-color: ${s(Rt).styles.ma1.color??""}`),zt(Mr,"style",`background-color: ${s(Rt).styles.ma2.color??""}`),zt(Hc,"style",`background-color: ${s(Rt).styles.ma3.color??""}`),zt(Ku,"style",`background-color: ${s(Rt).styles.ma4.color??""}`)}),po(Ms,()=>s(Rt).crPeriod,_a=>s(Rt).crPeriod=_a),po(ko,()=>s(Rt).crMa1Period,_a=>s(Rt).crMa1Period=_a),po(Rs,()=>s(Rt).crMa2Period,_a=>s(Rt).crMa2Period=_a),po(Fr,()=>s(Rt).crMa3Period,_a=>s(Rt).crMa3Period=_a),po(Sa,()=>s(Rt).crMa4Period,_a=>s(Rt).crMa4Period=_a),qo(Br,()=>s(Rt).styles.cr.thickness,_a=>s(Rt).styles.cr.thickness=_a),qo(Kr,()=>s(Rt).styles.cr.lineStyle,_a=>s(Rt).styles.cr.lineStyle=_a),qo(xs,()=>s(Rt).styles.ma1.thickness,_a=>s(Rt).styles.ma1.thickness=_a),qo(yi,()=>s(Rt).styles.ma1.lineStyle,_a=>s(Rt).styles.ma1.lineStyle=_a),qo(ia,()=>s(Rt).styles.ma2.thickness,_a=>s(Rt).styles.ma2.thickness=_a),qo(pa,()=>s(Rt).styles.ma2.lineStyle,_a=>s(Rt).styles.ma2.lineStyle=_a),qo($c,()=>s(Rt).styles.ma3.thickness,_a=>s(Rt).styles.ma3.thickness=_a),qo(iu,()=>s(Rt).styles.ma3.lineStyle,_a=>s(Rt).styles.ma3.lineStyle=_a),qo(kd,()=>s(Rt).styles.ma4.thickness,_a=>s(Rt).styles.ma4.thickness=_a),qo(vu,()=>s(Rt).styles.ma4.lineStyle,_a=>s(Rt).styles.ma4.lineStyle=_a),z(Mt,Jt)});var pe=u(O,2),ke=g(pe);ke.__click=[PN,Ct,Is,js],f(pe),f(lt),z(Xr,lt)},Xr=>{var lt=Ln(),O=Dt(lt);Te(O,()=>s(At),pe=>{var ke=wD(),Mt=g(ke);vs(Mt,17,()=>s(Ue),Vs,(Jt,Qn,io)=>{var to=xD(),ho=g(to),Li=g(ho);Li.textContent=`ZigZag ${io+1}`,f(ho);var Ms=u(ho,2),Zo=g(Ms),ko=u(g(Zo),2);Qt(ko),ko.__input=en,f(Zo);var ki=u(Zo,2),Rs=u(g(ki),2);Qt(Rs),Rs.__input=en,f(ki),f(Ms);var pi=u(Ms,2),Fr=u(g(pi),2),Ni=g(Fr),Sa=u(g(Ni),2),$a=g(Sa),Js=u($a,2);Js.__click=()=>_n(io);var qi=g(Js);f(Js),f(Sa),f(Ni);var _r=u(Ni,2),Pr=u(g(_r),2);Pr.__change=en;var Br=g(Pr);Br.value=(Br.__value=1)==null?"":1;var ma=u(Br);ma.value=(ma.__value=2)==null?"":2;var Hi=u(ma);Hi.value=(Hi.__value=3)==null?"":3;var yr=u(Hi);yr.value=(yr.__value=4)==null?"":4;var Qa=u(yr);Qa.value=(Qa.__value=5)==null?"":5,f(Pr),f(_r);var Yr=u(_r,2),Kr=u(g(Yr),2);Kr.__change=en;var Ii=g(Kr);Ii.value=(Ii.__value="solid")==null?"":"solid";var Bs=u(Ii);Bs.value=(Bs.__value="dashed")==null?"":"dashed";var Or=u(Bs);Or.value=(Or.__value="dotted")==null?"":"dotted",f(Kr),f(Yr),f(Fr),f(pi),f(to),Se(()=>{zt($a,"style",`background-color: ${s(Qn).styles.color??""}`),zt(qi,"style",`background-color: ${s(Qn).styles.color??""}`)}),po(ko,()=>s(Qn).deviation,lr=>s(Qn).deviation=lr),po(Rs,()=>s(Qn).depth,lr=>s(Qn).depth=lr),qo(Pr,()=>s(Qn).styles.thickness,lr=>s(Qn).styles.thickness=lr),qo(Kr,()=>s(Qn).styles.lineStyle,lr=>s(Qn).styles.lineStyle=lr),z(Jt,to)});var Rt=u(Mt,2),xn=g(Rt);xn.__click=[mN,Ue,en],f(Rt),f(ke),z(pe,ke)},pe=>{var ke=Ln(),Mt=Dt(ke);Te(Mt,()=>s(Zc),Rt=>{var xn=CD(),Jt=g(xn);vs(Jt,17,()=>s(kr),Vs,(to,ho,Li)=>{var Ms=SD(),Zo=g(Ms),ko=g(Zo),ki=g(ko);Se(()=>ze(ki,`${s(ho).name??""} (ID: ${s(ho).id.slice(0,8)??""})`)),f(ko);var Rs=u(ko,2);Te(Rs,()=>s(kr).length>1,Bs=>{var Or=kD();Or.__click=()=>Jl(Li),z(Bs,Or)}),f(Zo);var pi=u(Zo,2),Fr=g(pi),Ni=u(g(Fr),2),Sa=vt(()=>iv(Li));Ni.__click=function(...Bs){var Or;(Or=s(Sa))==null||Or.apply(this,Bs)};var $a=g(Ni);f(Ni),f(Fr);var Js=u(Fr,2),qi=u(g(Js),2);qi.__change=Bs=>{Bs.target&&(s(ho).thickness=parseInt(Bs.target.value),ar(Li))};var _r=g(qi);_r.value=(_r.__value=1)==null?"":1;var Pr=u(_r);Pr.value=(Pr.__value=2)==null?"":2;var Br=u(Pr);Br.value=(Br.__value=3)==null?"":3;var ma=u(Br);ma.value=(ma.__value=4)==null?"":4;var Hi=u(ma);Hi.value=(Hi.__value=5)==null?"":5,f(qi),f(Js);var yr=u(Js,2),Qa=u(g(yr),2);Qa.__change=Bs=>{Bs.target&&(s(ho).lineStyle=Bs.target.value,ar(Li))};var Yr=g(Qa);Yr.value=(Yr.__value="solid")==null?"":"solid";var Kr=u(Yr);Kr.value=(Kr.__value="dashed")==null?"":"dashed";var Ii=u(Kr);Ii.value=(Ii.__value="dotted")==null?"":"dotted",f(Qa),f(yr),f(pi),f(Ms),Se(()=>zt($a,"style",`background-color: ${s(ho).color??""}`)),qo(qi,()=>s(ho).thickness,Bs=>s(ho).thickness=Bs),qo(Qa,()=>s(ho).lineStyle,Bs=>s(ho).lineStyle=Bs),z(to,Ms)});var Qn=u(Jt,2),io=g(Qn);io.__click=Pa,f(Qn),f(xn),z(Rt,xn)},Rt=>{var xn=Ln(),Jt=Dt(xn);Te(Jt,()=>s(st),Qn=>{var io=AD(),to=g(io);vs(to,17,()=>s(ms),Vs,(Ms,Zo,ko)=>{var ki=MD(),Rs=g(ki),pi=g(Rs);pi.textContent=`SAR ${ko+1}`;var Fr=u(pi,2);Te(Fr,()=>s(ms).length>1,Mi=>{var Fa=ID();Fa.__click=[PD,_v,Zo],z(Mi,Fa)}),f(Rs);var Ni=u(Rs,2),Sa=g(Ni),$a=u(g(Sa),2);Qt($a),f(Sa);var Js=u(Sa,2),qi=u(g(Js),2);Qt(qi),f(Js);var _r=u(Js,2),Pr=u(g(_r),2);Qt(Pr),f(_r),f(Ni);var Br=u(Ni,2),ma=g(Br),Hi=u(g(ma),2),yr=vt(()=>rv(ko));Hi.__click=function(...Mi){var Fa;(Fa=s(yr))==null||Fa.apply(this,Mi)};var Qa=g(Hi);f(Hi),f(ma);var Yr=u(ma,2),Kr=u(g(Yr),2),Ii=g(Kr);Ii.value=(Ii.__value=1)==null?"":1;var Bs=u(Ii);Bs.value=(Bs.__value=2)==null?"":2;var Or=u(Bs);Or.value=(Or.__value=3)==null?"":3;var lr=u(Or);lr.value=(lr.__value=4)==null?"":4;var Ui=u(lr);Ui.value=(Ui.__value=5)==null?"":5,f(Kr),f(Yr),f(Br),f(ki),Se(()=>zt(Qa,"style",`background-color: ${s(Zo).color??""}`)),po($a,()=>s(Zo).start,Mi=>s(Zo).start=Mi),po(qi,()=>s(Zo).increment,Mi=>s(Zo).increment=Mi),po(Pr,()=>s(Zo).maxValue,Mi=>s(Zo).maxValue=Mi),qo(Kr,()=>s(Zo).dotSize,Mi=>s(Zo).dotSize=Mi),z(Ms,ki)});var ho=u(to,2),Li=g(ho);Li.__click=[kN,st,ms,Bu],f(ho),f(io),z(Qn,io)},Qn=>{var io=Ln(),to=Dt(io);Te(to,()=>s(Ys),ho=>{var Li=$D(),Ms=g(Li);vs(Ms,17,()=>s(Wo),Vs,(ki,Rs,pi)=>{var Fr=FD(),Ni=g(Fr),Sa=g(Ni);Sa.textContent=`Smart Trend ${pi+1}`;var $a=u(Sa,2);Te($a,()=>s(Wo).length>1,Oi=>{var Ea=LD();Ea.__click=[TD,Hp,Rs],z(Oi,Ea)}),f(Ni);var Js=u(Ni,2),qi=g(Js),_r=u(g(qi),2);Qt(_r),_r.__change=()=>Ou(pi),f(qi);var Pr=u(qi,2),Br=u(g(Pr),2);Qt(Br),Br.__change=()=>Ou(pi),f(Pr),f(Js);var ma=u(Js,2),Hi=g(ma);Qt(Hi),Hi.__change=()=>Ou(pi),ai(2),f(ma);var yr=u(ma,2),Qa=u(g(yr),2),Yr=g(Qa),Kr=u(g(Yr),2);Kr.__click=()=>{x(Va,!0),x(cd,N(pi)),x(Sd,"uptrend")};var Ii=g(Kr);f(Kr),f(Yr);var Bs=u(Yr,2),Or=u(g(Bs),2);Or.__change=()=>Ou(pi);var lr=g(Or);lr.value=(lr.__value=1)==null?"":1;var Ui=u(lr);Ui.value=(Ui.__value=2)==null?"":2;var Mi=u(Ui);Mi.value=(Mi.__value=3)==null?"":3;var Fa=u(Mi);Fa.value=(Fa.__value=4)==null?"":4;var xs=u(Fa);xs.value=(xs.__value=5)==null?"":5,f(Or),f(Bs);var Ba=u(Bs,2),Ir=u(g(Ba),2);Ir.__change=()=>Ou(pi);var Ci=g(Ir);Ci.value=(Ci.__value="solid")==null?"":"solid";var sl=u(Ci);sl.value=(sl.__value="dashed")==null?"":"dashed",f(Ir),f(Ba),f(Qa),f(yr);var zs=u(yr,2),yi=u(g(zs),2),Jr=g(yi),ga=u(g(Jr),2);ga.__click=()=>{x(Va,!0),x(cd,N(pi)),x(Sd,"downtrend")};var cr=g(ga);f(ga),f(Jr);var ua=u(Jr,2),il=u(g(ua),2);il.__change=()=>Ou(pi);var br=g(il);br.value=(br.__value=1)==null?"":1;var Mr=u(br);Mr.value=(Mr.__value=2)==null?"":2;var ia=u(Mr);ia.value=(ia.__value=3)==null?"":3;var ri=u(ia);ri.value=(ri.__value=4)==null?"":4;var Vo=u(ri);Vo.value=(Vo.__value=5)==null?"":5,f(il),f(ua);var vi=u(ua,2),ha=u(g(vi),2);ha.__change=()=>Ou(pi);var Zs=g(ha);Zs.value=(Zs.__value="solid")==null?"":"solid";var pa=u(Zs);pa.value=(pa.__value="dashed")==null?"":"dashed",f(ha),f(vi),f(yi),f(zs),f(Fr),Se(()=>{zt(Ii,"style",`background-color: ${s(Rs).styles.uptrend.color??""}`),zt(cr,"style",`background-color: ${s(Rs).styles.downtrend.color??""}`)}),po(_r,()=>s(Rs).period,Oi=>s(Rs).period=Oi),po(Br,()=>s(Rs).multiplier,Oi=>s(Rs).multiplier=Oi),zf(Hi,()=>s(Rs).showLabels,Oi=>s(Rs).showLabels=Oi),qo(Or,()=>s(Rs).styles.uptrend.thickness,Oi=>s(Rs).styles.uptrend.thickness=Oi),qo(Ir,()=>s(Rs).styles.uptrend.lineStyle,Oi=>s(Rs).styles.uptrend.lineStyle=Oi),qo(il,()=>s(Rs).styles.downtrend.thickness,Oi=>s(Rs).styles.downtrend.thickness=Oi),qo(ha,()=>s(Rs).styles.downtrend.lineStyle,Oi=>s(Rs).styles.downtrend.lineStyle=Oi),z(ki,Fr)});var Zo=u(Ms,2),ko=g(Zo);ko.__click=[SN,Ys,Wo,_p],f(Zo),f(Li),z(ho,Li)},ho=>{var Li=Ln(),Ms=Dt(Li);Te(Ms,()=>s(Cc),Zo=>{var ko=VD(),ki=g(ko);vs(ki,17,()=>m,Vs,(pi,Fr,Ni)=>{var Sa=OD(),$a=g(Sa),Js=g($a),qi=g(Js,!0);f(Js);var _r=u(Js,2),Pr=g(_r);Qt(Pr),Pr.__change=[ED,Ji];var Br=u(Pr,2);Te(Br,()=>p.length>1,Hi=>{var yr=ND();yr.__click=()=>ja(Ni),z(Hi,yr)},Hi=>{var yr=DD();z(Hi,yr)}),f(_r),f($a);var ma=u($a,2);Te(ma,()=>h[Ni],Hi=>{var yr=BD(),Qa=g(yr),Yr=u(g(Qa),2),Kr=vt(()=>av(Ni));Yr.__click=function(...yi){var Jr;(Jr=s(Kr))==null||Jr.apply(this,yi)};var Ii=g(Yr);f(Yr),f(Qa);var Bs=u(Qa,2),Or=u(g(Bs),2);Or.__change=[jD,Ji];var lr=g(Or);lr.value=(lr.__value=1)==null?"":1;var Ui=u(lr);Ui.value=(Ui.__value=2)==null?"":2;var Mi=u(Ui);Mi.value=(Mi.__value=3)==null?"":3;var Fa=u(Mi);Fa.value=(Fa.__value=4)==null?"":4;var xs=u(Fa);xs.value=(xs.__value=5)==null?"":5,f(Or),f(Bs);var Ba=u(Bs,2),Ir=u(g(Ba),2);Ir.__change=[RD,Ji];var Ci=g(Ir);Ci.value=(Ci.__value="solid")==null?"":"solid";var sl=u(Ci);sl.value=(sl.__value="dashed")==null?"":"dashed";var zs=u(sl);zs.value=(zs.__value="dotted")==null?"":"dotted",f(Ir),f(Ba),f(yr),Se(()=>zt(Ii,"style",`background-color: ${h[Ni].color??""}`)),qo(Or,()=>h[Ni].thickness,yi=>h[Ni].thickness=yi),qo(Ir,()=>h[Ni].lineStyle,yi=>h[Ni].lineStyle=yi),z(Hi,yr)}),f(Sa),Se(()=>ze(qi,s(Fr).title)),po(Pr,()=>p[Ni],Hi=>p[Ni]=Hi),z(pi,Sa)});var Rs=u(ki,2);Te(Rs,()=>m.length<10,pi=>{var Fr=zD(),Ni=g(Fr);Ni.__click=[W0,zr,cc,Wr,dc,ka,Er,bl,Le,yc,m,p,h,cu,el,Cc,Ji],f(Fr),z(pi,Fr)}),f(ko),z(Zo,ko)},Zo=>{var ko=Ln(),ki=Dt(ko);Te(ki,()=>s(Ac),Rs=>{var pi=HD(),Fr=g(pi);vs(Fr,17,()=>s($n),Vs,($a,Js,qi)=>{var _r=qD(),Pr=g(_r),Br=g(Pr),ma=g(Br);f(Br);var Hi=u(Br,2);Te(Hi,()=>s($n).length>1,Jr=>{var ga=WD();ga.__click=()=>gc(qi),z(Jr,ga)}),f(Pr);var yr=u(Pr,2),Qa=u(g(yr),2);Qt(Qa),Qa.__change=()=>Ma(qi),f(yr);var Yr=u(yr,2),Kr=g(Yr),Ii=u(g(Kr),2);Ii.__click=Jr=>{x(Xt,N(qi));const ga=Jr.currentTarget.getBoundingClientRect();x(qn,N({x:ga.left+ga.width/2,y:ga.bottom+5})),x(qt,!0)};var Bs=g(Ii);f(Ii),f(Kr);var Or=u(Kr,2),lr=u(g(Or),2);lr.__change=()=>Ma(qi);var Ui=g(lr);Ui.value=(Ui.__value=1)==null?"":1;var Mi=u(Ui);Mi.value=(Mi.__value=2)==null?"":2;var Fa=u(Mi);Fa.value=(Fa.__value=3)==null?"":3;var xs=u(Fa);xs.value=(xs.__value=4)==null?"":4;var Ba=u(xs);Ba.value=(Ba.__value=5)==null?"":5,f(lr),f(Or);var Ir=u(Or,2),Ci=u(g(Ir),2);Ci.__change=()=>Ma(qi);var sl=g(Ci);sl.value=(sl.__value="solid")==null?"":"solid";var zs=u(sl);zs.value=(zs.__value="dashed")==null?"":"dashed";var yi=u(zs);yi.value=(yi.__value="dotted")==null?"":"dotted",f(Ci),f(Ir),f(Yr),f(_r),Se(()=>{ze(ma,`SMA (${s(Js).period??""})`),zt(Bs,"style",`background-color: ${s(Js).color??""}`)}),po(Qa,()=>s(Js).period,Jr=>s(Js).period=Jr),qo(lr,()=>s(Js).thickness,Jr=>s(Js).thickness=Jr),qo(Ci,()=>s(Js).lineStyle,Jr=>s(Js).lineStyle=Jr),z($a,_r)});var Ni=u(Fr,2),Sa=g(Ni);Sa.__click=jl,f(Ni),f(pi),z(Rs,pi)},Rs=>{var pi=Ln(),Fr=Dt(pi);Te(Fr,()=>s(ce),Ni=>{var Sa=KD();vs(Sa,21,()=>s(nt),Vs,($a,Js,qi)=>{var _r=YD(),Pr=g(_r),Br=g(Pr);Br.textContent=`Volume ${qi+1}`;var ma=u(Br,2);Te(ma,()=>s(nt).length>1,Oi=>{var Ea=UD();Ea.__click=()=>yn(qi),z(Oi,Ea)},Oi=>{var Ea=GD();z(Oi,Ea)}),f(Pr);var Hi=u(Pr,2),yr=g(Hi),Qa=u(g(yr),2);Qt(Qa),Qa.__change=()=>si(qi),f(yr),f(Hi);var Yr=u(Hi,2),Kr=u(g(Yr),2),Ii=g(Kr),Bs=u(g(Ii),2),Or=vt(()=>xv(qi,"histogram"));Bs.__click=function(...Oi){var Ea;(Ea=s(Or))==null||Ea.apply(this,Oi)};var lr=g(Bs);f(Bs),f(Ii);var Ui=u(Ii,2),Mi=u(g(Ui),2),Fa=vt(()=>xv(qi,"histogram-down"));Mi.__click=function(...Oi){var Ea;(Ea=s(Fa))==null||Ea.apply(this,Oi)};var xs=g(Mi);f(Mi),f(Ui),f(Kr),f(Yr);var Ba=u(Yr,2),Ir=u(g(Ba),2),Ci=g(Ir);Qt(Ci),Ci.__change=()=>si(qi),ai(2),f(Ir);var sl=u(Ir,2),zs=g(sl),yi=u(g(zs),2),Jr=vt(()=>xv(qi,"ema"));yi.__click=function(...Oi){var Ea;(Ea=s(Jr))==null||Ea.apply(this,Oi)};var ga=g(yi);f(yi),f(zs);var cr=u(zs,2),ua=u(g(cr),2);ua.__change=()=>si(qi);var il=g(ua);il.value=(il.__value=1)==null?"":1;var br=u(il);br.value=(br.__value=2)==null?"":2;var Mr=u(br);Mr.value=(Mr.__value=3)==null?"":3;var ia=u(Mr);ia.value=(ia.__value=4)==null?"":4;var ri=u(ia);ri.value=(ri.__value=5)==null?"":5,f(ua),f(cr);var Vo=u(cr,2),vi=u(g(Vo),2);vi.__change=()=>si(qi);var ha=g(vi);ha.value=(ha.__value="solid")==null?"":"solid";var Zs=u(ha);Zs.value=(Zs.__value="dashed")==null?"":"dashed";var pa=u(Zs);pa.value=(pa.__value="dotted")==null?"":"dotted",f(vi),f(Vo),f(sl),f(Ba),f(_r),Se(()=>{zt(lr,"style",`background-color: ${s(Js).styles.histogram.upColor??""}`),zt(xs,"style",`background-color: ${s(Js).styles.histogram.downColor??""}`),zt(ga,"style",`background-color: ${s(Js).styles.ema.color??""}`)}),po(Qa,()=>s(Js).period,Oi=>s(Js).period=Oi),zf(Ci,()=>s(Js).styles.ema.visible,Oi=>s(Js).styles.ema.visible=Oi),qo(ua,()=>s(Js).styles.ema.thickness,Oi=>s(Js).styles.ema.thickness=Oi),qo(vi,()=>s(Js).styles.ema.lineStyle,Oi=>s(Js).styles.ema.lineStyle=Oi),z($a,_r)}),f(Sa),z(Ni,Sa)},Ni=>{var Sa=Ln(),$a=Dt(Sa);Te($a,()=>s(Le),Js=>{var qi=QD(),_r=g(qi);vs(_r,17,()=>s(Po),Vs,(ma,Hi,yr)=>{var Qa=XD(),Yr=g(Qa),Kr=g(Yr),Ii=g(Kr,!0);f(Kr);var Bs=u(Kr,2);Te(Bs,()=>s(Po).length>1,Uc=>{var Eu=ZD();Eu.__click=()=>gu(yr),z(Uc,Eu)}),f(Yr);var Or=u(Yr,2),lr=g(Or),Ui=u(g(lr),2);Qt(Ui),Ui.__input=()=>vl(yr),f(lr);var Mi=u(lr,2),Fa=u(g(Mi),2);Qt(Fa),Fa.__input=()=>vl(yr),f(Mi),f(Or);var xs=u(Or,2),Ba=g(xs),Ir=u(g(Ba),2);f(Ba);var Ci=u(Ba,2),sl=g(Ci),zs=u(g(sl),2);Qt(zs),zs.__input=()=>vl(yr),f(sl);var yi=u(sl,2),Jr=u(g(yi),2);Jr.__change=()=>vl(yr);var ga=g(Jr);ga.value=(ga.__value=1)==null?"":1;var cr=u(ga);cr.value=(cr.__value=2)==null?"":2;var ua=u(cr);ua.value=(ua.__value=3)==null?"":3;var il=u(ua);il.value=(il.__value=4)==null?"":4;var br=u(il);br.value=(br.__value=5)==null?"":5,f(Jr),f(yi);var Mr=u(yi,2),ia=u(g(Mr),2);ia.__change=()=>vl(yr);var ri=g(ia);ri.value=(ri.__value="solid")==null?"":"solid";var Vo=u(ri);Vo.value=(Vo.__value="dashed")==null?"":"dashed";var vi=u(Vo);vi.value=(vi.__value="dotted")==null?"":"dotted",f(ia),f(Mr),f(Ci),f(xs);var ha=u(xs,2),Zs=g(ha),pa=u(g(Zs),2);f(Zs);var Oi=u(Zs,2),Ea=g(Oi),fc=u(g(Ea),2);Qt(fc),fc.__input=()=>vl(yr),f(Ea);var wl=u(Ea,2),Ml=u(g(wl),2);Ml.__change=()=>vl(yr);var Yl=g(Ml);Yl.value=(Yl.__value=1)==null?"":1;var Hc=u(Yl);Hc.value=(Hc.__value=2)==null?"":2;var $c=u(Hc);$c.value=($c.__value=3)==null?"":3;var jc=u($c);jc.value=(jc.__value=4)==null?"":4;var Mc=u(jc);Mc.value=(Mc.__value=5)==null?"":5,f(Ml),f(wl);var xc=u(wl,2),Oa=u(g(xc),2);Oa.__change=()=>vl(yr);var ad=g(Oa);ad.value=(ad.__value="solid")==null?"":"solid";var iu=u(ad);iu.value=(iu.__value="dashed")==null?"":"dashed";var Mu=u(iu);Mu.value=(Mu.__value="dotted")==null?"":"dotted",f(Oa),f(xc),f(Oi),f(ha),f(Qa),Se(()=>{ze(Ii,s(Hi).name),zt(Ir,"style",`background-color: ${s(Hi).styles.trix.color??""}`),zt(pa,"style",`background-color: ${s(Hi).styles.signal.color??""}`)}),po(Ui,()=>s(Hi).trixPeriod,Uc=>s(Hi).trixPeriod=Uc),po(Fa,()=>s(Hi).signalPeriod,Uc=>s(Hi).signalPeriod=Uc),po(zs,()=>s(Hi).styles.trix.color,Uc=>s(Hi).styles.trix.color=Uc),qo(Jr,()=>s(Hi).styles.trix.thickness,Uc=>s(Hi).styles.trix.thickness=Uc),qo(ia,()=>s(Hi).styles.trix.lineStyle,Uc=>s(Hi).styles.trix.lineStyle=Uc),po(fc,()=>s(Hi).styles.signal.color,Uc=>s(Hi).styles.signal.color=Uc),qo(Ml,()=>s(Hi).styles.signal.thickness,Uc=>s(Hi).styles.signal.thickness=Uc),qo(Oa,()=>s(Hi).styles.signal.lineStyle,Uc=>s(Hi).styles.signal.lineStyle=Uc),z(ma,Qa)});var Pr=u(_r,2),Br=g(Pr);Br.__click=[JD,zc],f(Pr),f(qi),z(Js,qi)},Js=>{var qi=Ln(),_r=Dt(qi);Te(_r,()=>s(cc),Pr=>{var Br=oj(),ma=g(Br);vs(ma,17,()=>s(Un),Vs,(Qa,Yr,Kr)=>{var Ii=nj(),Bs=g(Ii),Or=g(Bs);Or.textContent=`BIAS ${Kr+1}`;var lr=u(Or,2);Te(lr,()=>s(Un).length>1,ri=>{var Vo=tj();Vo.__click=[ej,gp,Yr],z(ri,Vo)}),f(Bs);var Ui=u(Bs,2),Mi=u(g(Ui),2);Qt(Mi),Mi.__input=Md,f(Ui);var Fa=u(Ui,2),xs=g(Fa),Ba=u(g(xs),2),Ir=vt(()=>Pu(Kr));Ba.__click=function(...ri){var Vo;(Vo=s(Ir))==null||Vo.apply(this,ri)};var Ci=g(Ba);f(Ba),f(xs);var sl=u(xs,2),zs=u(g(sl),2);zs.__change=Md;var yi=g(zs);yi.value=(yi.__value=1)==null?"":1;var Jr=u(yi);Jr.value=(Jr.__value=2)==null?"":2;var ga=u(Jr);ga.value=(ga.__value=3)==null?"":3;var cr=u(ga);cr.value=(cr.__value=4)==null?"":4,f(zs),f(sl);var ua=u(sl,2),il=u(g(ua),2);il.__change=Md;var br=g(il);br.value=(br.__value="solid")==null?"":"solid";var Mr=u(br);Mr.value=(Mr.__value="dashed")==null?"":"dashed";var ia=u(Mr);ia.value=(ia.__value="dotted")==null?"":"dotted",f(il),f(ua),f(Fa),f(Ii),Se(()=>zt(Ci,"style",`background-color: ${s(Yr).color??""}`)),po(Mi,()=>s(Yr).period,ri=>s(Yr).period=ri),qo(zs,()=>s(Yr).thickness,ri=>s(Yr).thickness=ri),qo(il,()=>s(Yr).lineStyle,ri=>s(Yr).lineStyle=ri),z(Qa,Ii)});var Hi=u(ma,2),yr=g(Hi);yr.__click=[xN,cc,Un,Md],f(Hi),f(Br),z(Pr,Br)},Pr=>{var Br=Ln(),ma=Dt(Br);Te(ma,()=>s(ro),Hi=>{var yr=aj(),Qa=g(yr);vs(Qa,17,()=>s(Bn),Vs,(Ii,Bs,Or)=>{var lr=rj(),Ui=g(lr),Mi=g(Ui);Mi.textContent=`CCI ${Or+1}`;var Fa=u(Mi,2);Te(Fa,()=>s(Bn).length>1,ha=>{var Zs=ij();Zs.__click=[sj,hv,Bs],z(ha,Zs)}),f(Ui);var xs=u(Ui,2),Ba=u(g(xs),2);Qt(Ba),Ba.__input=hp,f(xs);var Ir=u(xs,2),Ci=g(Ir),sl=u(g(Ci),2),zs=vt(()=>dl(Or));sl.__click=function(...ha){var Zs;(Zs=s(zs))==null||Zs.apply(this,ha)};var yi=g(sl);f(sl),f(Ci);var Jr=u(Ci,2),ga=u(g(Jr),2);ga.__change=hp;var cr=g(ga);cr.value=(cr.__value=1)==null?"":1;var ua=u(cr);ua.value=(ua.__value=2)==null?"":2;var il=u(ua);il.value=(il.__value=3)==null?"":3;var br=u(il);br.value=(br.__value=4)==null?"":4,f(ga),f(Jr);var Mr=u(Jr,2),ia=u(g(Mr),2);ia.__change=hp;var ri=g(ia);ri.value=(ri.__value="solid")==null?"":"solid";var Vo=u(ri);Vo.value=(Vo.__value="dashed")==null?"":"dashed";var vi=u(Vo);vi.value=(vi.__value="dotted")==null?"":"dotted",f(ia),f(Mr),f(Ir),f(lr),Se(()=>zt(yi,"style",`background-color: ${s(Bs).color??""}`)),po(Ba,()=>s(Bs).period,ha=>s(Bs).period=ha),qo(ga,()=>s(Bs).thickness,ha=>s(Bs).thickness=ha),qo(ia,()=>s(Bs).lineStyle,ha=>s(Bs).lineStyle=ha),z(Ii,lr)});var Yr=u(Qa,2),Kr=g(Yr);Kr.__click=[wN,ro,Bn,hp],f(Yr),f(yr),z(Hi,yr)},Hi=>{var yr=Ln(),Qa=Dt(yr);Te(Qa,()=>s(Id),Yr=>{var Kr=uj(),Ii=g(Kr),Bs=u(g(Ii),2);vs(Bs,21,()=>s(hc),Vs,(Ui,Mi,Fa)=>{var xs=dj(),Ba=g(xs),Ir=g(Ba),Ci=g(Ir,!0);f(Ir);var sl=u(Ir,2);Te(sl,()=>s(hc).length>1,yi=>{var Jr=lj();Jr.__click=()=>Vu(Fa),z(yi,Jr)}),f(Ba);var zs=u(Ba,4);vs(zs,17,()=>m,Vs,(yi,Jr,ga)=>{var cr=cj(),ua=g(cr),il=g(ua),br=u(il,2),Mr=g(br,!0);f(br),f(ua);var ia=u(ua,2),ri=u(g(ia),2);Qt(ri),ri.__change=()=>Gu(),f(ia);var Vo=u(ia,2),vi=u(g(Vo),2),ha=vt(()=>We(ga,Fa));vi.__click=function(...Oa){var ad;(ad=s(ha))==null||ad.apply(this,Oa)};var Zs=g(vi);f(vi),f(Vo);var pa=u(Vo,2),Oi=u(g(pa),2);Oi.__change=()=>Gu();var Ea=g(Oi);Ea.value=(Ea.__value=1)==null?"":1;var fc=u(Ea);fc.value=(fc.__value=2)==null?"":2;var wl=u(fc);wl.value=(wl.__value=3)==null?"":3;var Ml=u(wl);Ml.value=(Ml.__value=4)==null?"":4;var Yl=u(Ml);Yl.value=(Yl.__value=5)==null?"":5,f(Oi),f(pa);var Hc=u(pa,2),$c=u(g(Hc),2);$c.__change=()=>Gu();var jc=g($c);jc.value=(jc.__value="solid")==null?"":"solid";var Mc=u(jc);Mc.value=(Mc.__value="dashed")==null?"":"dashed";var xc=u(Mc);xc.value=(xc.__value="dotted")==null?"":"dotted",f($c),f(Hc),f(cr),Se(()=>{var Oa,ad;zt(il,"style",`background-color: ${((Oa=s(Mi).styles[ga])==null?void 0:Oa.color)??""}`),ze(Mr,s(Jr).title),zt(Zs,"style",`background-color: ${((ad=s(Mi).styles[ga])==null?void 0:ad.color)??""}`)}),po(ri,()=>s(Mi).params[ga],Oa=>s(Mi).params[ga]=Oa),qo(Oi,()=>s(Mi).styles[ga].thickness,Oa=>s(Mi).styles[ga].thickness=Oa),qo($c,()=>s(Mi).styles[ga].lineStyle,Oa=>s(Mi).styles[ga].lineStyle=Oa),z(yi,cr)}),f(xs),Se(()=>ze(Ci,s(Mi).name)),z(Ui,xs)}),f(Bs);var Or=u(Bs,2),lr=g(Or);lr.__click=up,f(Or),ai(2),f(Ii),f(Kr),z(Yr,Kr)},Yr=>{var Kr=Ln(),Ii=Dt(Kr);Te(Ii,()=>s(Ac),Bs=>{var Or=gj(),lr=g(Or);vs(lr,17,()=>m,Vs,(Mi,Fa,xs)=>{var Ba=fj(),Ir=g(Ba),Ci=g(Ir),sl=g(Ci,!0);f(Ci);var zs=u(Ci,2),yi=g(zs);Qt(yi);var Jr=u(yi,2);Te(Jr,()=>p.length>1,Ml=>{var Yl=pj();Yl.__click=()=>ja(xs),z(Ml,Yl)},Ml=>{var Yl=vj();z(Ml,Yl)}),f(zs),f(Ir);var ga=u(Ir,2),cr=g(ga),ua=u(g(cr),2),il=vt(()=>Fv(xs));ua.__click=function(...Ml){var Yl;(Yl=s(il))==null||Yl.apply(this,Ml)};var br=g(ua);f(ua),f(cr);var Mr=u(cr,2),ia=u(g(Mr),2),ri=g(ia);ri.value=(ri.__value=1)==null?"":1;var Vo=u(ri);Vo.value=(Vo.__value=2)==null?"":2;var vi=u(Vo);vi.value=(vi.__value=3)==null?"":3;var ha=u(vi);ha.value=(ha.__value=4)==null?"":4;var Zs=u(ha);Zs.value=(Zs.__value=5)==null?"":5,f(ia),f(Mr);var pa=u(Mr,2),Oi=u(g(pa),2),Ea=g(Oi);Ea.value=(Ea.__value="solid")==null?"":"solid";var fc=u(Ea);fc.value=(fc.__value="dashed")==null?"":"dashed";var wl=u(fc);wl.value=(wl.__value="dotted")==null?"":"dotted",f(Oi),f(pa),f(ga),f(Ba),Se(()=>{ze(sl,s(Fa).title),zt(br,"style",`background-color: ${h[xs].color??""}`)}),po(yi,()=>p[xs],Ml=>p[xs]=Ml),qo(ia,()=>h[xs].thickness,Ml=>h[xs].thickness=Ml),qo(Oi,()=>h[xs].lineStyle,Ml=>h[xs].lineStyle=Ml),z(Mi,Ba)});var Ui=u(lr,2);Te(Ui,()=>m.length<10,Mi=>{var Fa=mj(),xs=g(Fa);xs.__click=[W0,zr,cc,Wr,dc,ka,Er,bl,Le,yc,m,p,h,cu,el,Cc,Ji],f(Fa),z(Mi,Fa)}),f(Or),z(Bs,Or)},Bs=>{var Or=Ln(),lr=Dt(Or);Te(lr,()=>s(cu),Ui=>{var Mi=Cj(),Fa=g(Mi);vs(Fa,17,()=>m,Vs,(Ba,Ir,Ci)=>{var sl=kj(),zs=g(sl),yi=g(zs),Jr=g(yi,!0);f(yi);var ga=u(yi,2),cr=g(ga);Qt(cr),cr.__change=[hj,el];var ua=u(cr,2);Te(ua,()=>p.length>1,br=>{var Mr=_j();Mr.__click=()=>ja(Ci),z(br,Mr)},br=>{var Mr=yj();z(br,Mr)}),f(ga),f(zs);var il=u(zs,2);Te(il,()=>h[Ci],br=>{var Mr=wj(),ia=g(Mr),ri=u(g(ia),2),Vo=vt(()=>Uo(Ci));ri.__click=function(...Mc){var xc;(xc=s(Vo))==null||xc.apply(this,Mc)};var vi=g(ri);f(ri),f(ia);var ha=u(ia,2),Zs=u(g(ha),2);Zs.__change=[bj,el];var pa=g(Zs);pa.value=(pa.__value=1)==null?"":1;var Oi=u(pa);Oi.value=(Oi.__value=2)==null?"":2;var Ea=u(Oi);Ea.value=(Ea.__value=3)==null?"":3;var fc=u(Ea);fc.value=(fc.__value=4)==null?"":4;var wl=u(fc);wl.value=(wl.__value=5)==null?"":5,f(Zs),f(ha);var Ml=u(ha,2),Yl=u(g(Ml),2);Yl.__change=[xj,el];var Hc=g(Yl);Hc.value=(Hc.__value="solid")==null?"":"solid";var $c=u(Hc);$c.value=($c.__value="dashed")==null?"":"dashed";var jc=u($c);jc.value=(jc.__value="dotted")==null?"":"dotted",f(Yl),f(Ml),f(Mr),Se(()=>zt(vi,"style",`background-color: ${h[Ci].color??""}`)),qo(Zs,()=>h[Ci].thickness,Mc=>h[Ci].thickness=Mc),qo(Yl,()=>h[Ci].lineStyle,Mc=>h[Ci].lineStyle=Mc),z(br,Mr)}),f(sl),Se(()=>ze(Jr,s(Ir).title)),po(cr,()=>p[Ci],br=>p[Ci]=br),z(Ba,sl)});var xs=u(Fa,2);Te(xs,()=>m.length<10,Ba=>{var Ir=Sj(),Ci=g(Ir);Ci.__click=[W0,zr,cc,Wr,dc,ka,Er,bl,Le,yc,m,p,h,cu,el,Cc,Ji],f(Ir),z(Ba,Ir)}),f(Mi),z(Ui,Mi)},Ui=>{var Mi=Ln(),Fa=Dt(Mi);Te(Fa,()=>s(dt),xs=>{var Ba=Aj(),Ir=g(Ba);vs(Ir,17,()=>s(An),Vs,(zs,yi,Jr)=>{var ga=Mj(),cr=g(ga),ua=g(cr);ua.textContent=`ROC ${Jr+1}`;var il=u(ua,2);Te(il,()=>s(An).length>1,Oa=>{var ad=Ij();ad.__click=[Pj,sp,yi],z(Oa,ad)}),f(cr);var br=u(cr,2),Mr=g(br),ia=u(g(Mr),2);Qt(ia),ia.__change=()=>Hu(Jr),f(Mr);var ri=u(Mr,2),Vo=g(ri),vi=u(g(Vo),2),ha=vt(()=>wv(Jr));vi.__click=function(...Oa){var ad;(ad=s(ha))==null||ad.apply(this,Oa)};var Zs=g(vi);f(vi),f(Vo);var pa=u(Vo,2),Oi=u(g(pa),2);Oi.__change=()=>Hu(Jr);var Ea=g(Oi);Ea.value=(Ea.__value=1)==null?"":1;var fc=u(Ea);fc.value=(fc.__value=2)==null?"":2;var wl=u(fc);wl.value=(wl.__value=3)==null?"":3;var Ml=u(wl);Ml.value=(Ml.__value=4)==null?"":4;var Yl=u(Ml);Yl.value=(Yl.__value=5)==null?"":5,f(Oi),f(pa);var Hc=u(pa,2),$c=u(g(Hc),2);$c.__change=()=>Hu(Jr);var jc=g($c);jc.value=(jc.__value="solid")==null?"":"solid";var Mc=u(jc);Mc.value=(Mc.__value="dashed")==null?"":"dashed";var xc=u(Mc);xc.value=(xc.__value="dotted")==null?"":"dotted",f($c),f(Hc),f(ri),f(br),f(ga),Se(()=>zt(Zs,"style",`background-color: ${s(yi).styles.roc.color??""}`)),po(ia,()=>s(yi).period,Oa=>s(yi).period=Oa),qo(Oi,()=>s(yi).styles.roc.thickness,Oa=>s(yi).styles.roc.thickness=Oa),qo($c,()=>s(yi).styles.roc.lineStyle,Oa=>s(yi).styles.roc.lineStyle=Oa),z(zs,ga)});var Ci=u(Ir,2),sl=g(Ci);sl.__click=zu,f(Ci),f(Ba),z(xs,Ba)},xs=>{var Ba=Ln(),Ir=Dt(Ba);Te(Ir,()=>s(pt),Ci=>{var sl=$j(),zs=g(sl);vs(zs,17,()=>s(on),Vs,(ga,cr,ua)=>{var il=Fj(),br=g(il),Mr=g(br);Mr.textContent=`PSY ${ua+1}`;var ia=u(Mr,2);Te(ia,()=>s(on).length>1,tc=>{var ju=Lj();ju.__click=[Tj,dp,cr],z(tc,ju)}),f(br);var ri=u(br,2),Vo=g(ri),vi=u(g(Vo),2);Qt(vi),vi.__change=()=>Pl(ua),f(Vo);var ha=u(Vo,2),Zs=u(g(ha),2),pa=g(Zs),Oi=u(g(pa),2),Ea=vt(()=>ip(ua*2));Oi.__click=function(...tc){var ju;(ju=s(Ea))==null||ju.apply(this,tc)};var fc=g(Oi);f(Oi),f(pa);var wl=u(pa,2),Ml=u(g(wl),2);Ml.__change=()=>Pl(ua);var Yl=g(Ml);Yl.value=(Yl.__value=1)==null?"":1;var Hc=u(Yl);Hc.value=(Hc.__value=2)==null?"":2;var $c=u(Hc);$c.value=($c.__value=3)==null?"":3;var jc=u($c);jc.value=(jc.__value=4)==null?"":4;var Mc=u(jc);Mc.value=(Mc.__value=5)==null?"":5,f(Ml),f(wl);var xc=u(wl,2),Oa=u(g(xc),2);Oa.__change=()=>Pl(ua);var ad=g(Oa);ad.value=(ad.__value="solid")==null?"":"solid";var iu=u(ad);iu.value=(iu.__value="dashed")==null?"":"dashed";var Mu=u(iu);Mu.value=(Mu.__value="dotted")==null?"":"dotted",f(Oa),f(xc),f(Zs),f(ha);var Uc=u(ha,2),Eu=u(g(Uc),2);Qt(Eu),Eu.__change=()=>Pl(ua),f(Uc);var Nu=u(Uc,2),wd=u(g(Nu),2),va=g(wd),Ku=u(g(va),2),kd=vt(()=>ip(ua*2+1));Ku.__click=function(...tc){var ju;(ju=s(kd))==null||ju.apply(this,tc)};var ep=g(Ku);f(Ku),f(va);var Du=u(va,2),$l=u(g(Du),2);$l.__change=()=>Pl(ua);var tp=g($l);tp.value=(tp.__value=1)==null?"":1;var yu=u(tp);yu.value=(yu.__value=2)==null?"":2;var vu=u(yu);vu.value=(vu.__value=3)==null?"":3;var Ld=u(vu);Ld.value=(Ld.__value=4)==null?"":4;var ru=u(Ld);ru.value=(ru.__value=5)==null?"":5,f($l),f(Du);var np=u(Du,2),_a=u(g(np),2);_a.__change=()=>Pl(ua);var ed=g(_a);ed.value=(ed.__value="solid")==null?"":"solid";var jp=u(ed);jp.value=(jp.__value="dashed")==null?"":"dashed";var Rp=u(jp);Rp.value=(Rp.__value="dotted")==null?"":"dotted",f(_a),f(np),f(wd),f(Nu);var dv=u(Nu,2),fp=g(dv);Qt(fp),fp.__change=()=>Pl(ua);var Sv=u(fp,2);f(dv),f(ri),f(il),Se(()=>{zt(fc,"style",`background-color: ${s(cr).styles.psy.color??""}`),zt(ep,"style",`background-color: ${s(cr).styles.mapsy.color??""}`),zt(fp,"id",`showMapsy_${s(cr).id??""}`),zt(Sv,"for",`showMapsy_${s(cr).id??""}`)}),po(vi,()=>s(cr).psyPeriod,tc=>s(cr).psyPeriod=tc),qo(Ml,()=>s(cr).styles.psy.thickness,tc=>s(cr).styles.psy.thickness=tc),qo(Oa,()=>s(cr).styles.psy.lineStyle,tc=>s(cr).styles.psy.lineStyle=tc),po(Eu,()=>s(cr).mapsyPeriod,tc=>s(cr).mapsyPeriod=tc),qo($l,()=>s(cr).styles.mapsy.thickness,tc=>s(cr).styles.mapsy.thickness=tc),qo(_a,()=>s(cr).styles.mapsy.lineStyle,tc=>s(cr).styles.mapsy.lineStyle=tc),zf(fp,()=>s(cr).showMapsy,tc=>s(cr).showMapsy=tc),z(ga,il)});var yi=u(zs,2),Jr=g(yi);Jr.__click=Sp,f(yi),f(sl),z(Ci,sl)},Ci=>{var sl=Ln(),zs=Dt(sl);Te(zs,()=>s(at),yi=>{var Jr=jj(),ga=g(Jr);vs(ga,17,()=>s(rn),Vs,(il,br,Mr)=>{var ia=Dj(),ri=g(ia),Vo=g(ri);Vo.textContent=`OBV ${Mr+1}`;var vi=u(Vo,2);Te(vi,()=>s(rn).length>1,tc=>{var ju=Nj();ju.__click=[Ej,Wa,br],z(tc,ju)}),f(ri);var ha=u(ri,2),Zs=g(ha),pa=u(g(Zs),2);Qt(pa),pa.__input=rr,f(Zs);var Oi=u(Zs,2),Ea=u(g(Oi),2),fc=g(Ea),wl=u(g(fc),2),Ml=vt(()=>Np(Mr*2));wl.__click=function(...tc){var ju;(ju=s(Ml))==null||ju.apply(this,tc)};var Yl=g(wl);f(wl),f(fc);var Hc=u(fc,2),$c=u(g(Hc),2);$c.__change=rr;var jc=g($c);jc.value=(jc.__value=1)==null?"":1;var Mc=u(jc);Mc.value=(Mc.__value=2)==null?"":2;var xc=u(Mc);xc.value=(xc.__value=3)==null?"":3;var Oa=u(xc);Oa.value=(Oa.__value=4)==null?"":4;var ad=u(Oa);ad.value=(ad.__value=5)==null?"":5,f($c),f(Hc);var iu=u(Hc,2),Mu=u(g(iu),2);Mu.__change=rr;var Uc=g(Mu);Uc.value=(Uc.__value="solid")==null?"":"solid";var Eu=u(Uc);Eu.value=(Eu.__value="dashed")==null?"":"dashed";var Nu=u(Eu);Nu.value=(Nu.__value="dotted")==null?"":"dotted",f(Mu),f(iu),f(Ea),f(Oi);var wd=u(Oi,2),va=u(g(wd),2);Qt(va),va.__input=rr,ai(2),f(wd);var Ku=u(wd,2),kd=u(g(Ku),2),ep=g(kd),Du=u(g(ep),2),$l=vt(()=>Np(Mr*2+1));Du.__click=function(...tc){var ju;(ju=s($l))==null||ju.apply(this,tc)};var tp=g(Du);f(Du),f(ep);var yu=u(ep,2),vu=u(g(yu),2);vu.__change=rr;var Ld=g(vu);Ld.value=(Ld.__value=1)==null?"":1;var ru=u(Ld);ru.value=(ru.__value=2)==null?"":2;var np=u(ru);np.value=(np.__value=3)==null?"":3;var _a=u(np);_a.value=(_a.__value=4)==null?"":4;var ed=u(_a);ed.value=(ed.__value=5)==null?"":5,f(vu),f(yu);var jp=u(yu,2),Rp=u(g(jp),2);Rp.__change=rr;var dv=g(Rp);dv.value=(dv.__value="solid")==null?"":"solid";var fp=u(dv);fp.value=(fp.__value="dashed")==null?"":"dashed";var Sv=u(fp);Sv.value=(Sv.__value="dotted")==null?"":"dotted",f(Rp),f(jp),f(kd),f(Ku),f(ha),f(ia),Se(()=>{zt(Yl,"style",`background-color: ${s(br).styles.obv.color??""}`),zt(tp,"style",`background-color: ${s(br).styles.maobv.color??""}`)}),po(pa,()=>s(br).obvPeriod,tc=>s(br).obvPeriod=tc),qo($c,()=>s(br).styles.obv.thickness,tc=>s(br).styles.obv.thickness=tc),qo(Mu,()=>s(br).styles.obv.lineStyle,tc=>s(br).styles.obv.lineStyle=tc),po(va,()=>s(br).maobvPeriod,tc=>s(br).maobvPeriod=tc),qo(vu,()=>s(br).styles.maobv.thickness,tc=>s(br).styles.maobv.thickness=tc),qo(Rp,()=>s(br).styles.maobv.lineStyle,tc=>s(br).styles.maobv.lineStyle=tc),z(il,ia)});var cr=u(ga,2),ua=g(cr);ua.__click=pr,f(cr),f(Jr),z(yi,Jr)},yi=>{var Jr=Ln(),ga=Dt(Jr);Te(ga,()=>s(kn),cr=>{var ua=zj(),il=g(ua);vs(il,17,()=>s(fo),Vs,(ia,ri,Vo)=>{var vi=Oj(),ha=g(vi),Zs=g(ha);Zs.textContent=`KDJ ${Vo+1}`;var pa=u(Zs,2);Te(pa,()=>s(fo).length>1,Bd=>{var td=Bj();td.__click=[Rj,vr,ri],z(Bd,td)}),f(ha);var Oi=u(ha,2),Ea=g(Oi),fc=g(Ea),wl=u(g(fc),2);Qt(wl),wl.__input=Bd=>{Bd.target&&(console.log("📊 K Period changed to:",Bd.target.value,"for group:",Vo),nu(Vo))},f(fc);var Ml=u(fc,2),Yl=u(g(Ml),2);Qt(Yl),Yl.__input=Bd=>{Bd.target&&(console.log("📊 D Period changed to:",Bd.target.value,"for group:",Vo),nu(Vo))},f(Ml),f(Ea);var Hc=u(Ea,2),$c=u(g(Hc),2),jc=u(g($c),2),Mc=vt(()=>Gp(Vo,0));jc.__click=function(...Bd){var td;(td=s(Mc))==null||td.apply(this,Bd)};var xc=g(jc);f(jc);var Oa=u(jc,2);Oa.__change=()=>nu(Vo);var ad=g(Oa);ad.value=(ad.__value=1)==null?"":1;var iu=u(ad);iu.value=(iu.__value=2)==null?"":2;var Mu=u(iu);Mu.value=(Mu.__value=3)==null?"":3;var Uc=u(Mu);Uc.value=(Uc.__value=4)==null?"":4;var Eu=u(Uc);Eu.value=(Eu.__value=5)==null?"":5,f(Oa);var Nu=u(Oa,2);Nu.__change=()=>nu(Vo);var wd=g(Nu);wd.value=(wd.__value="solid")==null?"":"solid";var va=u(wd);va.value=(va.__value="dashed")==null?"":"dashed";var Ku=u(va);Ku.value=(Ku.__value="dotted")==null?"":"dotted",f(Nu),f($c),f(Hc);var kd=u(Hc,2),ep=u(g(kd),2),Du=u(g(ep),2),$l=vt(()=>Gp(Vo,1));Du.__click=function(...Bd){var td;(td=s($l))==null||td.apply(this,Bd)};var tp=g(Du);f(Du);var yu=u(Du,2);yu.__change=()=>nu(Vo);var vu=g(yu);vu.value=(vu.__value=1)==null?"":1;var Ld=u(vu);Ld.value=(Ld.__value=2)==null?"":2;var ru=u(Ld);ru.value=(ru.__value=3)==null?"":3;var np=u(ru);np.value=(np.__value=4)==null?"":4;var _a=u(np);_a.value=(_a.__value=5)==null?"":5,f(yu);var ed=u(yu,2);ed.__change=()=>nu(Vo);var jp=g(ed);jp.value=(jp.__value="solid")==null?"":"solid";var Rp=u(jp);Rp.value=(Rp.__value="dashed")==null?"":"dashed";var dv=u(Rp);dv.value=(dv.__value="dotted")==null?"":"dotted",f(ed),f(ep),f(kd);var fp=u(kd,2),Sv=u(g(fp),2),tc=u(g(Sv),2),ju=vt(()=>Gp(Vo,2));tc.__click=function(...Bd){var td;(td=s(ju))==null||td.apply(this,Bd)};var bm=g(tc);f(tc);var Cv=u(tc,2);Cv.__change=()=>nu(Vo);var _f=g(Cv);_f.value=(_f.__value=1)==null?"":1;var jf=u(_f);jf.value=(jf.__value=2)==null?"":2;var yf=u(jf);yf.value=(yf.__value=3)==null?"":3;var bf=u(yf);bf.value=(bf.__value=4)==null?"":4;var xm=u(bf);xm.value=(xm.__value=5)==null?"":5,f(Cv);var Au=u(Cv,2);Au.__change=()=>nu(Vo);var Rd=g(Au);Rd.value=(Rd.__value="solid")==null?"":"solid";var Kv=u(Rd);Kv.value=(Kv.__value="dashed")==null?"":"dashed";var Um=u(Kv);Um.value=(Um.__value="dotted")==null?"":"dotted",f(Au),f(Sv),f(fp),f(Oi),f(vi),Se(()=>{zt(xc,"style",`background-color: ${s(ri).styles.k.color??""}`),zt(tp,"style",`background-color: ${s(ri).styles.d.color??""}`),zt(bm,"style",`background-color: ${s(ri).styles.j.color??""}`)}),po(wl,()=>s(ri).kPeriod,Bd=>s(ri).kPeriod=Bd),po(Yl,()=>s(ri).dPeriod,Bd=>s(ri).dPeriod=Bd),qo(Oa,()=>s(ri).styles.k.thickness,Bd=>s(ri).styles.k.thickness=Bd),qo(Nu,()=>s(ri).styles.k.lineStyle,Bd=>s(ri).styles.k.lineStyle=Bd),qo(yu,()=>s(ri).styles.d.thickness,Bd=>s(ri).styles.d.thickness=Bd),qo(ed,()=>s(ri).styles.d.lineStyle,Bd=>s(ri).styles.d.lineStyle=Bd),qo(Cv,()=>s(ri).styles.j.thickness,Bd=>s(ri).styles.j.thickness=Bd),qo(Au,()=>s(ri).styles.j.lineStyle,Bd=>s(ri).styles.j.lineStyle=Bd),z(ia,vi)});var br=u(il,2),Mr=g(br);Mr.__click=Qu,f(br),f(ua),z(cr,ua)},cr=>{var ua=Ln(),il=Dt(ua);Te(il,()=>s(Re),br=>{var Mr=Uj(),ia=g(Mr),ri=u(g(ia),2),Vo=g(ri),vi=u(g(Vo),2);Qt(vi),vi.__change=[gN,Rn,Yn],f(Vo);var ha=u(Vo,2),Zs=u(g(ha),2);Zs.__click=[Vj,xo];var pa=g(Zs);const Oi=vt(()=>`background-color: ${w(s(Ft),s(je))}`);f(Zs),f(ha),f(ri);var Ea=u(ri,2),fc=g(Ea),wl=u(g(fc),2),Ml=g(wl);f(wl),f(fc);var Yl=u(fc,2);Qt(Yl),Yl.__change=Dn,f(Ea),f(ia);var Hc=u(ia,2),$c=u(g(Hc),2),jc=u(g($c),2);Qt(jc),jc.__change=[hN,Rn,bn],f($c);var Mc=u($c,2),xc=g(Mc),Oa=u(g(xc),2);Oa.__click=[Wj,xo];var ad=g(Oa);f(Oa),f(xc);var iu=u(xc,2),Mu=u(g(iu),2);Mu.__click=[qj,xo];var Uc=g(Mu);f(Mu),f(iu),f(Mc);var Eu=u(Mc,2),Nu=g(Eu),wd=u(g(Nu),2);wd.__change=[Eb,Rn,_e,q];var va=g(wd);va.value=(va.__value=1)==null?"":1;var Ku=u(va);Ku.value=(Ku.__value=2)==null?"":2;var kd=u(Ku);kd.value=(kd.__value=3)==null?"":3;var ep=u(kd);ep.value=(ep.__value=4)==null?"":4;var Du=u(ep);Du.value=(Du.__value=5)==null?"":5,f(wd),f(Nu);var $l=u(Nu,2),tp=u(g($l),2);tp.__change=[Eb,Rn,_e,q];var yu=g(tp);yu.value=(yu.__value="solid")==null?"":"solid";var vu=u(yu);vu.value=(vu.__value="dashed")==null?"":"dashed",f(tp),f($l);var Ld=u($l,2),ru=u(g(Ld),2);ru.__change=[Nb,Rn,De,ot];var np=g(ru);np.value=(np.__value=1)==null?"":1;var _a=u(np);_a.value=(_a.__value=2)==null?"":2;var ed=u(_a);ed.value=(ed.__value=3)==null?"":3;var jp=u(ed);jp.value=(jp.__value=4)==null?"":4;var Rp=u(jp);Rp.value=(Rp.__value=5)==null?"":5,f(ru),f(Ld);var dv=u(Ld,2),fp=u(g(dv),2);fp.__change=[Nb,Rn,De,ot];var Sv=g(fp);Sv.value=(Sv.__value="solid")==null?"":"solid";var tc=u(Sv);tc.value=(tc.__value="dashed")==null?"":"dashed",f(fp),f(dv),f(Eu),f(Hc);var ju=u(Hc,2),bm=u(g(ju),2),Cv=g(bm),_f=u(g(Cv),2);_f.__click=[Hj,xo];var jf=g(_f);f(_f),f(Cv);var yf=u(Cv,2),bf=u(g(yf),2);bf.__change=[$b,Rn,H,ne];var xm=g(bf);xm.value=(xm.__value=1)==null?"":1;var Au=u(xm);Au.value=(Au.__value=2)==null?"":2;var Rd=u(Au);Rd.value=(Rd.__value=3)==null?"":3;var Kv=u(Rd);Kv.value=(Kv.__value=4)==null?"":4;var Um=u(Kv);Um.value=(Um.__value=5)==null?"":5,f(bf),f(yf);var Bd=u(yf,2),td=u(g(Bd),2);td.__change=[$b,Rn,H,ne];var kg=g(td);kg.value=(kg.__value="solid")==null?"":"solid";var ug=u(kg);ug.value=(ug.__value="dashed")==null?"":"dashed",f(td),f(Bd),f(bm),f(ju);var Rf=u(ju,2),Gm=u(g(Rf),2),Ym=u(g(Gm),2);Qt(Ym),Ym.__change=[_N,Rn,be],f(Gm),f(Rf),f(Mr),Se(()=>{zt(pa,"style",s(Oi)),ze(Ml,`${s(je)??""}%`),zt(ad,"style",`background-color: ${s(xt)}`),zt(Uc,"style",`background-color: ${s(an)}`),zt(jf,"style",`background-color: ${s(Be)}`)}),zf(vi,()=>s(Yn),mp=>x(Yn,mp)),po(Yl,()=>s(je),mp=>x(je,mp)),zf(jc,()=>s(bn),mp=>x(bn,mp)),qo(wd,()=>s(_e),mp=>x(_e,mp)),qo(tp,()=>s(q),mp=>x(q,mp)),qo(ru,()=>s(De),mp=>x(De,mp)),qo(fp,()=>s(ot),mp=>x(ot,mp)),qo(bf,()=>s(H),mp=>x(H,mp)),qo(td,()=>s(ne),mp=>x(ne,mp)),zf(Ym,()=>s(be),mp=>x(be,mp)),z(br,Mr)},br=>{var Mr=Ln(),ia=Dt(Mr);Te(ia,()=>s(zr),ri=>{var Vo=iR(),vi=g(Vo),ha=u(g(vi),2),Zs=g(ha),pa=u(g(Zs),2);Qt(pa),f(Zs);var Oi=u(Zs,2),Ea=u(g(Oi),2);Qt(Ea),f(Oi),f(ha),f(vi);var fc=u(vi,2),wl=u(g(fc),2),Ml=u(g(wl),2),Yl=g(Ml),Hc=u(Yl,2);Hc.__click=[Gj,Vn];var $c=g(Hc);f(Hc),f(Ml),f(wl);var jc=u(wl,2),Mc=g(jc),xc=u(g(Mc),2),Oa=g(xc);f(xc),f(Mc);var ad=u(Mc,2);Qt(ad),ai(2),f(jc),f(fc);var iu=u(fc,2),Mu=u(g(iu),2),Uc=g(Mu),Eu=u(g(Uc),2),Nu=g(Eu),wd=u(Nu,2);wd.__click=[Yj,Vn];var va=g(wd);f(wd),f(Eu),f(Uc);var Ku=u(Uc,2),kd=u(g(Ku),2),ep=g(kd),Du=u(ep,2);Du.__click=[Kj,Vn];var $l=g(Du);f(Du),f(kd),f(Ku);var tp=u(Ku,2),yu=u(g(tp),2),vu=g(yu),Ld=u(vu,2);Ld.__click=[Zj,Vn];var ru=g(Ld);f(Ld),f(yu),f(tp),f(Mu),f(iu);var np=u(iu,2),_a=u(g(np),2),ed=g(_a),jp=u(g(ed),2),Rp=g(jp);Rp.value=(Rp.__value=1)==null?"":1;var dv=u(Rp);dv.value=(dv.__value=2)==null?"":2;var fp=u(dv);fp.value=(fp.__value=3)==null?"":3;var Sv=u(fp);Sv.value=(Sv.__value=4)==null?"":4;var tc=u(Sv);tc.value=(tc.__value=5)==null?"":5,f(jp),f(ed);var ju=u(ed,2),bm=u(g(ju),2),Cv=g(bm);Cv.value=(Cv.__value="solid")==null?"":"solid";var _f=u(Cv);_f.value=(_f.__value="dashed")==null?"":"dashed";var jf=u(_f);jf.value=(jf.__value="dotted")==null?"":"dotted",f(bm),f(ju),f(_a),f(np);var yf=u(np,2),bf=g(yf);bf.__click=[AN,zr,i,l,de,j,D,S,P,I,C,M,F,V,jn];var xm=u(bf,2);Te(xm,()=>s(de).length>1,Rd=>{var Kv=Jj();Kv.__click=[Xj,Sn],z(Rd,Kv)}),f(yf);var Au=u(yf,2);Te(Au,()=>s(de).length>1,Rd=>{var Kv=Ln(),Um=Dt(Kv);vs(Um,17,()=>s(de).slice(1),Vs,(Bd,td,kg)=>{var ug=sR();const Rf=vt(()=>kg+1);var Gm=g(ug),Ym=g(Gm),mp=g(Ym);f(Ym);var l0=u(Ym,2);l0.__click=[Qj,Sn,Rf],f(Gm);var Dg=u(Gm,2),jg=g(Dg),ih=u(g(jg),2);Qt(ih),ih.__change=jn,f(jg);var c0=u(jg,2),rh=u(g(c0),2);Qt(rh),rh.__change=jn,f(c0),f(Dg);var ah=u(Dg,2),wm=u(g(ah),2),d0=u(g(wm),2),u0=g(d0),lh=u(u0,2);lh.__click=[eR,Vn,Rf];var A_=g(lh);f(lh),f(d0),f(wm);var p0=u(wm,2),Rg=g(p0),ch=u(g(Rg),2),T_=g(ch);f(ch),f(Rg);var dh=u(Rg,2);Qt(dh),dh.__change=jn,f(p0),f(ah);var uh=u(ah,2),v0=u(g(uh),2),ph=g(v0),f0=u(g(ph),2),m0=g(f0),vh=u(m0,2);vh.__click=[tR,Vn,Rf];var L_=g(vh);f(vh),f(f0),f(ph);var fh=u(ph,2),g0=u(g(fh),2),h0=g(g0),mh=u(h0,2);mh.__click=[nR,Vn,Rf];var F_=g(mh);f(mh),f(g0),f(fh);var _0=u(fh,2),y0=u(g(_0),2),b0=g(y0),gh=u(b0,2);gh.__click=[oR,Vn,Rf];var $_=g(gh);f(gh),f(y0),f(_0),f(v0),f(uh);var x0=u(uh,2),w0=u(g(x0),2),hh=g(w0),Bg=u(g(hh),2);Bg.__change=jn;var _h=g(Bg);_h.value=(_h.__value=1)==null?"":1;var yh=u(_h);yh.value=(yh.__value=2)==null?"":2;var Sg=u(yh);Sg.value=(Sg.__value=3)==null?"":3;var Og=u(Sg);Og.value=(Og.__value=4)==null?"":4;var bh=u(Og);bh.value=(bh.__value=5)==null?"":5,f(Bg),f(hh);var k0=u(hh,2),zg=u(g(k0),2);zg.__change=jn;var xh=g(zg);xh.value=(xh.__value="solid")==null?"":"solid";var Cg=u(xh);Cg.value=(Cg.__value="dashed")==null?"":"dashed";var S0=u(Cg);S0.value=(S0.__value="dotted")==null?"":"dotted",f(zg),f(k0),f(w0),f(x0),f(ug),Se(()=>{ze(mp,`BOLL ${s(Rf)+1}`),zt(l0,"title",`Remove BOLL ${s(Rf)+1}`),zt(u0,"style",`background-color: ${s(td).styles.fillColor}; opacity: ${(s(td).styles.fillOpacity||0)/100}`),zt(A_,"style",`background-color: ${s(td).styles.fillColor}; opacity: ${(s(td).styles.fillOpacity||0)/100}`),ze(T_,`${s(td).styles.fillOpacity??""}%`),zt(m0,"style",`background-color: ${s(td).styles.upperColor}`),zt(L_,"style",`background-color: ${s(td).styles.upperColor}`),zt(h0,"style",`background-color: ${s(td).styles.middleColor}`),zt(F_,"style",`background-color: ${s(td).styles.middleColor}`),zt(b0,"style",`background-color: ${s(td).styles.lowerColor}`),zt($_,"style",`background-color: ${s(td).styles.lowerColor}`)}),po(ih,()=>s(td).period,Zf=>s(td).period=Zf),po(rh,()=>s(td).stdDev,Zf=>s(td).stdDev=Zf),po(dh,()=>s(td).styles.fillOpacity,Zf=>s(td).styles.fillOpacity=Zf),qo(Bg,()=>s(td).styles.thickness,Zf=>s(td).styles.thickness=Zf),qo(zg,()=>s(td).styles.lineStyle,Zf=>s(td).styles.lineStyle=Zf),z(Bd,ug)}),z(Rd,Kv)}),f(Vo),Se(()=>{zt(Yl,"style",`background-color: ${s(S)??""}; opacity: ${s(P)/100}`),zt($c,"style",`background-color: ${s(S)??""}; opacity: ${s(P)/100}`),ze(Oa,`${s(P)??""}%`),zt(Nu,"style",`background-color: ${s(I)??""}`),zt(va,"style",`background-color: ${s(I)??""}`),zt(ep,"style",`background-color: ${s(C)??""}`),zt($l,"style",`background-color: ${s(C)??""}`),zt(vu,"style",`background-color: ${s(M)??""}`),zt(ru,"style",`background-color: ${s(M)??""}`)}),po(pa,()=>s(j),Rd=>x(j,Rd)),po(Ea,()=>s(D),Rd=>x(D,Rd)),po(ad,()=>s(P),Rd=>x(P,Rd)),qo(jp,()=>s(F),Rd=>x(F,Rd)),qo(bm,()=>s(V),Rd=>x(V,Rd)),z(ri,Vo)},ri=>{var Vo=Ln(),vi=Dt(Vo);Te(vi,()=>!m.length,ha=>{var Zs=rR(),pa=g(Zs),Oi=g(pa,!0);Se(()=>ze(Oi,Sx())),f(pa),f(Zs),z(ha,Zs)},ha=>{var Zs=uR(),pa=g(Zs);vs(pa,17,()=>m,Vs,(Ea,fc,wl)=>{var Ml=cR(),Yl=g(Ml),Hc=g(Yl),$c=g(Hc,!0);f(Hc);var jc=u(Hc,2),Mc=g(jc);Qt(Mc);var xc=u(Mc,2);Te(xc,()=>p.length>1&&!s(zr),Ld=>{var ru=aR();ru.__click=()=>ja(wl),z(Ld,ru)},Ld=>{var ru=Ln(),np=Dt(ru);Te(np,()=>!s(zr),_a=>{var ed=lR();z(_a,ed)},null,!0),z(Ld,ru)}),f(jc),f(Yl);var Oa=u(Yl,2),ad=g(Oa),iu=u(g(ad),2),Mu=vt(()=>dl(wl));iu.__click=function(...Ld){var ru;(ru=s(Mu))==null||ru.apply(this,Ld)};var Uc=g(iu);f(iu),f(ad);var Eu=u(ad,2),Nu=u(g(Eu),2),wd=g(Nu);wd.value=(wd.__value=1)==null?"":1;var va=u(wd);va.value=(va.__value=2)==null?"":2;var Ku=u(va);Ku.value=(Ku.__value=3)==null?"":3;var kd=u(Ku);kd.value=(kd.__value=4)==null?"":4;var ep=u(kd);ep.value=(ep.__value=5)==null?"":5,f(Nu),f(Eu);var Du=u(Eu,2),$l=u(g(Du),2),tp=g($l);tp.value=(tp.__value="solid")==null?"":"solid";var yu=u(tp);yu.value=(yu.__value="dashed")==null?"":"dashed";var vu=u(yu);vu.value=(vu.__value="dotted")==null?"":"dotted",f($l),f(Du),f(Oa),f(Ml),Se(()=>{ze($c,s(fc).title),zt(Uc,"style",`background-color: ${h[wl].color??""}`)}),po(Mc,()=>p[wl],Ld=>p[wl]=Ld),qo(Nu,()=>h[wl].thickness,Ld=>h[wl].thickness=Ld),qo($l,()=>h[wl].lineStyle,Ld=>h[wl].lineStyle=Ld),z(Ea,Ml)});var Oi=u(pa,2);Te(Oi,()=>m.length<10&&!s(zr)&&!s(Zc)&&!s(At),Ea=>{var fc=dR(),wl=g(fc);wl.__click=[W0,zr,cc,Wr,dc,ka,Er,bl,Le,yc,m,p,h,cu,el,Cc,Ji],f(fc),Se(()=>zt(wl,"title",s(cc)?"Add more BIAS indicator":s(dc)?"Add more Awesome Oscillator":s(Er)?"Add more WR indicator":s(Cc)?"Add more EMA":"Add parameter")),z(Ea,fc)}),f(Zs),z(ha,Zs)},!0),z(ri,Vo)},!0),z(br,Mr)},!0),z(cr,ua)},!0),z(yi,Jr)},!0),z(Ci,sl)},!0),z(xs,Ba)},!0),z(Ui,Mi)},!0),z(Bs,Or)},!0),z(Yr,Kr)},!0),z(Hi,yr)},!0),z(Pr,Br)},!0),z(Js,qi)},!0),z(Ni,Sa)},!0),z(Rs,pi)},!0),z(Zo,ko)},!0),z(ho,Li)},!0),z(Qn,io)},!0),z(Rt,xn)},!0),z(pe,ke)},!0),z(Xr,lt)},!0),z(Zr,Ua)},!0),z(Gr,Il)},!0),z(Ur,Ja)},!0),z(Ns,Cr)},!0),z(ii,Di)},!0),z(jr,ol)},!0),z(Tr,xl)},!0),z(jd,vd)},!0),z(qc,Td)},!0),z(pc,nl)},!0),z(Ss,La)},!0),z(cn,Gt)},!0),z(Pe,rt)},!0),z(E,Q)});var $=u(A,2);Te($,()=>s(Vt),E=>{var Q=pR();z(E,Q)}),f(T),z(b,T)},$$slots:{default:!0}});var Jp=u(Xp,2),lv=vt(()=>{var b,k;return((k=(b=s(de)[s(Oe)])==null?void 0:b.styles)==null?void 0:k.upperColor)||"#f23645"});rl(Jp,{get show(){return s(Eo)},set show(b){x(Eo,N(b))},get selectedColor(){return s(lv)},get position(){return s(di)},$$events:{colorChange:b=>{s(de)[s(Oe)]?(s(de)[s(Oe)].styles.upperColor=b.detail.rgba||b.detail.color,jn()):x(I,N(b.detail.rgba||b.detail.color))}}});var qv=u(Jp,2),pp=vt(()=>{var b,k;return((k=(b=s(de)[s(Oe)])==null?void 0:b.styles)==null?void 0:k.middleColor)||"#2962ff"});rl(qv,{get show(){return s(ns)},set show(b){x(ns,N(b))},get selectedColor(){return s(pp)},get position(){return s($i)},$$events:{colorChange:b=>{s(de)[s(Oe)]?(s(de)[s(Oe)].styles.middleColor=b.detail.rgba||b.detail.color,jn()):x(C,N(b.detail.rgba||b.detail.color))}}});var Iu=u(qv,2),Qp=vt(()=>{var b,k;return((k=(b=s(de)[s(Oe)])==null?void 0:b.styles)==null?void 0:k.lowerColor)||"#089981"});rl(Iu,{get show(){return s(hi)},set show(b){x(hi,N(b))},get selectedColor(){return s(Qp)},get position(){return s(li)},$$events:{colorChange:b=>{s(de)[s(Oe)]?(s(de)[s(Oe)].styles.lowerColor=b.detail.rgba||b.detail.color,jn()):x(M,N(b.detail.rgba||b.detail.color))}}});var Lf=u(Iu,2),lg=vt(()=>{var b,k;return((k=(b=s(de)[s(Oe)])==null?void 0:b.styles)==null?void 0:k.fillColor)||"#2196F3"});rl(Lf,{get show(){return s(hn)},set show(b){x(hn,N(b))},get selectedColor(){return s(lg)},get position(){return s(Ho)},$$events:{colorChange:b=>{s(de)[s(Oe)]?(s(de)[s(Oe)].styles.fillColor=b.detail.rgba||b.detail.color,jn()):x(S,N(b.detail.rgba||b.detail.color))}}});var $m=u(Lf,2);rl($m,{get show(){return s(ks)},set show(b){x(ks,N(b))},get selectedColor(){return s(Be)},get position(){return s(Vi)},$$events:{colorChange:b=>{var T;x(Be,N(b.detail.rgba||b.detail.color));const k=window.__npoMaeApi;(T=k==null?void 0:k.setColors)==null||T.call(k,{median:s(Be)})}}});var Cp=u($m,2),qf=vt(()=>w(s(Ft),s(je)));rl(Cp,{get show(){return s(gs)},set show(b){x(gs,N(b))},get selectedColor(){return s(qf)},get position(){return s(ll)},$$events:{colorChange:b=>{x(Ft,N(b.detail.rgba||b.detail.color)),Dn()}}});var $u=u(Cp,2);rl($u,{get show(){return s(mi)},set show(b){x(mi,N(b))},get selectedColor(){return s(xt)},get position(){return s(Na)},$$events:{colorChange:b=>{var T;x(xt,N(b.detail.rgba||b.detail.color));const k=window.__npoMaeApi;(T=k==null?void 0:k.setColors)==null||T.call(k,{slLong:s(xt)})}}});var Pp=u($u,2);rl(Pp,{get show(){return s(le)},set show(b){x(le,N(b))},get selectedColor(){return s(an)},get position(){return s(we)},$$events:{colorChange:b=>{var T;x(an,N(b.detail.rgba||b.detail.color));const k=window.__npoMaeApi;(T=k==null?void 0:k.setColors)==null||T.call(k,{slShort:s(an)})}}});var rp=u(Pp,2),nf=vt(()=>{var b,k,T;return((T=(k=(b=s(Rc)[s(J)])==null?void 0:b.styles)==null?void 0:k[s(Z)])==null?void 0:T.color)||"#2563eb"});rl(rp,{get show(){return s(R)},set show(b){x(R,N(b))},get selectedColor(){return s(nf)},get position(){return s(W)},$$events:{colorChange:b=>{s(Rc).length>s(J)&&(s(Rc)[s(J)].styles[s(Z)].color=b.detail.rgba||b.detail.color,Ts(s(J),s(Z)))}}});var of=u(rp,2),sf=vt(()=>{var b,k,T;return((T=(k=(b=s(Wo)[s(cd)])==null?void 0:b.styles)==null?void 0:k[s(Sd)])==null?void 0:T.color)||"#2563eb"});rl(of,{get show(){return s(Va)},set show(b){x(Va,N(b))},get selectedColor(){return s(sf)},get position(){return $r},$$events:{colorChange:b=>{s(Wo).length>s(cd)&&s(Wo)[s(cd)].styles[s(Sd)]&&(s(Wo)[s(cd)].styles[s(Sd)].color=b.detail.rgba||b.detail.color,_p())}}});var Aa=u(of,2),Hv=vt(()=>{var b;return((b=s(Bn)[s(Y)])==null?void 0:b.color)||"#2563eb"});rl(Aa,{get show(){return s(G)},set show(b){x(G,N(b))},get selectedColor(){return s(Hv)},get position(){return s(se)},$$events:{colorChange:b=>{s(Bn).length>s(Y)&&(s(Bn)[s(Y)].color=b.detail.rgba||b.detail.color,hp())}}});var ff=u(Aa,2),Ev=vt(()=>{var b,k,T;return((T=(k=(b=s(Yo)[0])==null?void 0:b.styles)==null?void 0:k.diPlus)==null?void 0:T.color)||"#2563eb"});rl(ff,{get show(){return s(oe)},set show(b){x(oe,N(b))},get selectedColor(){return s(Ev)},get position(){return s(ee)},$$events:{colorChange:b=>{s(Yo).length>0&&(s(Yo)[0].styles.diPlus.color=b.detail.rgba||b.detail.color)}}});var vm=u(ff,2),Uv=vt(()=>{var b;return((b=h[0])==null?void 0:b.color)||"#2563eb"});rl(vm,{get show(){return s(K)},set show(b){x(K,N(b))},get selectedColor(){return s(Uv)},get position(){return s(ye)},$$events:{colorChange:b=>{h.length>0&&(h[0].color=b.detail.rgba||b.detail.color)}}});var Gv=u(vm,2),ap=vt(()=>{var b;return((b=s(Ds)[s(kt)])==null?void 0:b.color)||"#2563eb"});rl(Gv,{get show(){return s(Ye)},set show(b){x(Ye,N(b))},get selectedColor(){return s(ap)},get position(){return s(ct)},$$events:{colorChange:b=>{s(Ds)[s(kt)]&&(s(Ds)[s(kt)].color=b.detail.rgba||b.detail.color,Bo())}}});var Hf=u(Gv,2),Em=vt(()=>{var b;return((b=h[0])==null?void 0:b.color)||"#2563eb"});rl(Hf,{get show(){return s(Me)},set show(b){x(Me,N(b))},get selectedColor(){return s(Em)},get position(){return s(Fe)},$$events:{colorChange:b=>{h.length>0&&(h[0].color=b.detail.rgba||b.detail.color)}}});var mf=u(Hf,2),Uf=vt(()=>{var b;return((b=h[0])==null?void 0:b.color)||"#2563eb"});rl(mf,{get show(){return s(ft)},set show(b){x(ft,N(b))},get selectedColor(){return s(Uf)},get position(){return s(bt)},$$events:{colorChange:b=>{h.length>0&&(h[0].color=b.detail.rgba||b.detail.color)}}});var Ff=u(mf,2),cg=vt(()=>{var b,k,T,A,$,E,Q,ie,Pe;return s(xe)==="histogram"?((T=(k=(b=s(nt)[s(yt)])==null?void 0:b.styles)==null?void 0:k.histogram)==null?void 0:T.upColor)||"#26a69a":s(xe)==="histogram-down"?((E=($=(A=s(nt)[s(yt)])==null?void 0:A.styles)==null?void 0:$.histogram)==null?void 0:E.downColor)||"#ef5350":((Pe=(ie=(Q=s(nt)[s(yt)])==null?void 0:Q.styles)==null?void 0:ie.ema)==null?void 0:Pe.color)||"#2563eb"}),xg=vt(()=>s(xe)==="histogram"||s(xe)==="histogram-down"?70:100);rl(Ff,{get show(){return s(Pt)},set show(b){x(Pt,N(b))},get selectedColor(){return s(cg)},get opacity(){return s(xg)},get position(){return s(Qe)},$$events:{colorChange:b=>{s(nt).length>s(yt)&&(s(xe)==="histogram"?s(nt)[s(yt)].styles.histogram.upColor=b.detail.rgba||b.detail.color:s(xe)==="histogram-down"?s(nt)[s(yt)].styles.histogram.downColor=b.detail.rgba||b.detail.color:s(xe)==="ema"&&(s(nt)[s(yt)].styles.ema.color=b.detail.rgba||b.detail.color),si(s(yt)))}}});var Nm=u(Ff,2),kv=vt(()=>{var b,k,T;return((T=(k=(b=s(Bc)[s(jt)])==null?void 0:b.styles)==null?void 0:k.wr)==null?void 0:T.color)||"#2563eb"});rl(Nm,{get show(){return s(Ve)},set show(b){x(Ve,N(b))},get selectedColor(){return s(kv)},get position(){return s(Je)},$$events:{colorChange:b=>{s(Bc).length>s(jt)&&s(Bc)[s(jt)].styles.wr&&(s(Bc)[s(jt)].styles.wr.color=b.detail.rgba||b.detail.color,Ar(s(jt)))}}});var vp=u(Nm,2),cv=vt(()=>{var b,k,T;return((T=(k=(b=s(Bc)[s(jt)])==null?void 0:b.styles)==null?void 0:k.overbought)==null?void 0:T.color)||"#FF4444"});rl(vp,{get show(){return s(St)},set show(b){x(St,N(b))},get selectedColor(){return s(cv)},get position(){return s(Ne)},$$events:{colorChange:b=>{s(Bc).length>s(jt)&&s(Bc)[s(jt)].styles.overbought&&(s(Bc)[s(jt)].styles.overbought.color=b.detail.rgba||b.detail.color,Ar(s(jt)))}}});var wg=u(vp,2),Nv=vt(()=>{var b,k,T;return((T=(k=(b=s(Bc)[s(jt)])==null?void 0:b.styles)==null?void 0:k.oversold)==null?void 0:T.color)||"#00C851"});rl(wg,{get show(){return s(ue)},set show(b){x(ue,N(b))},get selectedColor(){return s(Nv)},get position(){return s(he)},$$events:{colorChange:b=>{s(Bc).length>s(jt)&&s(Bc)[s(jt)].styles.oversold&&(s(Bc)[s(jt)].styles.oversold.color=b.detail.rgba||b.detail.color,Ar(s(jt)))}}});var Dm=u(wg,2),jm=vt(()=>{var b,k,T;return((T=(k=(b=s(Bc)[s(jt)])==null?void 0:b.styles)==null?void 0:k.middleLine)==null?void 0:T.color)||"#808080"});rl(Dm,{get show(){return s(_t)},set show(b){x(_t,N(b))},get selectedColor(){return s(jm)},get position(){return s(Wt)},$$events:{colorChange:b=>{s(Bc).length>s(jt)&&s(Bc)[s(jt)].styles.middleLine&&(s(Bc)[s(jt)].styles.middleLine.color=b.detail.rgba||b.detail.color,Ar(s(jt)))}}});var gf=u(Dm,2),fm=vt(()=>{var b,k,T;return((T=(k=(b=s(qd)[s(zn)])==null?void 0:b.styles)==null?void 0:k[s(un)])==null?void 0:T.color)||"#2563eb"});rl(gf,{get show(){return s(Zt)},set show(b){x(Zt,N(b))},get selectedColor(){return s(fm)},get position(){return s(dn)},$$events:{colorChange:b=>{s(qd).length>s(zn)&&s(qd)[s(zn)].styles[s(un)]&&(s(qd)[s(zn)].styles[s(un)].color=b.detail.rgba||b.detail.color,wo(s(zn)))}}});var $f=u(gf,2),Rm=vt(()=>{var b,k,T;return((T=(k=(b=s(An)[s(fs)])==null?void 0:b.styles)==null?void 0:k.roc)==null?void 0:T.color)||"#2563eb"});rl($f,{get show(){return s(On)},set show(b){x(On,N(b))},get selectedColor(){return s(Rm)},get position(){return s(no)},$$events:{colorChange:b=>{s(An).length>s(fs)&&(s(An)[s(fs)].styles.roc.color=b.detail.rgba||b.detail.color,Hu(s(fs)))}}});var mm=u($f,2),dg=vt(()=>{var b,k,T,A,$,E;return s(Es)%2===0?((T=(k=(b=s(on)[Math.floor(s(Es)/2)])==null?void 0:b.styles)==null?void 0:k.psy)==null?void 0:T.color)||"#2563eb":((E=($=(A=s(on)[Math.floor(s(Es)/2)])==null?void 0:A.styles)==null?void 0:$.mapsy)==null?void 0:E.color)||"#dc2626"});rl(mm,{get show(){return s(ps)},set show(b){x(ps,N(b))},get selectedColor(){return s(dg)},get position(){return s(So)},$$events:{colorChange:b=>{const k=Math.floor(s(Es)/2);s(on).length>k&&(s(Es)%2===0?(s(on)[k].styles.psy.color=b.detail.rgba||b.detail.color,console.log("🎨 Updated PSY color to:",b.detail.color)):(s(on)[k].styles.mapsy.color=b.detail.rgba||b.detail.color,console.log("🎨 Updated MAPSY color to:",b.detail.color)),Pl(k))}}});var Gf=u(mm,2),gm=vt(()=>{var b,k,T,A,$,E;return s(oo)%2===0?((T=(k=(b=s(rn)[Math.floor(s(oo)/2)])==null?void 0:b.styles)==null?void 0:k.obv)==null?void 0:T.color)||"#FF6B35":((E=($=(A=s(rn)[Math.floor(s(oo)/2)])==null?void 0:A.styles)==null?void 0:$.maobv)==null?void 0:E.color)||"#2196F3"});rl(Gf,{get show(){return s(Qo)},set show(b){x(Qo,N(b))},get selectedColor(){return s(gm)},get position(){return s(Ko)},$$events:{colorChange:b=>{const k=Math.floor(s(oo)/2);s(rn).length>k&&(s(oo)%2===0?(s(rn)[k].styles.obv.color=b.detail.rgba||b.detail.color,console.log("🎨 Updated OBV color to:",b.detail.color)):(s(rn)[k].styles.maobv.color=b.detail.rgba||b.detail.color,console.log("🎨 Updated MAOBV color to:",b.detail.color)),rr())}}});var Yf=u(Gf,2),Bm=vt(()=>{var b;return((b=s(Ue)[s(mt)])==null?void 0:b.styles.color)||"#2962FF"});rl(Yf,{get show(){return s(Gs)},set show(b){x(Gs,N(b))},get selectedColor(){return s(Bm)},get position(){return s(jo)},$$events:{colorChange:b=>{s(Ue).length>s(mt)&&(s(Ue)[s(mt)].styles.color=b.detail.rgba||b.detail.color,en())}}});var Ef=u(Yf,2),hm=vt(()=>{var b;return((b=s(kr)[s(xa)])==null?void 0:b.color)||"#FF6B35"});rl(Ef,{get show(){return s(fi)},set show(b){x(fi,N(b))},get selectedColor(){return s(hm)},get position(){return s(ba)},$$events:{colorChange:b=>{s(kr).length>s(xa)&&(s(kr)[s(xa)].color=b.detail.rgba||b.detail.color,console.log("🎨 Updated PVT color to:",b.detail.color),ar(s(xa)))}}});var hf=u(Ef,2),Nf=vt(()=>{var b;return((b=s(ms)[s(Fs)])==null?void 0:b.color)||"#2563eb"});rl(hf,{get show(){return s(Al)},set show(b){x(Al,N(b))},get selectedColor(){return s(Nf)},get position(){return s(Qs)},$$events:{colorChange:b=>{s(ms).length>s(Fs)&&(s(ms)[s(Fs)].color=b.detail.rgba||b.detail.color)}}});var Df=u(hf,2),Om=vt(()=>{var b;return((b=s(Un)[s(Cd)])==null?void 0:b.color)||"#2563eb"});rl(Df,{get show(){return s(Nl)},set show(b){x(Nl,N(b))},get selectedColor(){return s(Om)},get position(){return s(dd)},$$events:{colorChange:b=>{s(Un).length>s(Cd)&&(s(Un)[s(Cd)].color=b.detail.rgba||b.detail.color,Md())}}});var rf=u(Df,2),zm=vt(()=>{var b,k;return((k=(b=s(hc)[s(To)])==null?void 0:b.styles[s(vo)])==null?void 0:k.color)||"#2563eb"});rl(rf,{get show(){return s(fa)},set show(b){x(fa,N(b))},get selectedColor(){return s(zm)},get position(){return s(Dl)},$$events:{colorChange:b=>{const k=s(hc)[s(To)];k&&k.styles&&k.styles.length>s(vo)&&(k.styles[s(vo)].color=b.detail.rgba||b.detail.color,Gu(s(To)))}}});var Dp=u(rf,2),af=vt(()=>{var b;return((b=h[0])==null?void 0:b.color)||"#2563eb"});rl(Dp,{get show(){return s(ml)},set show(b){x(ml,N(b))},get selectedColor(){return s(af)},get position(){return s(gl)},$$events:{colorChange:b=>{h.length>0&&(h[0].color=b.detail.rgba||b.detail.color)}}});var _m=u(Dp,2),Kf=vt(()=>{var b,k,T,A,$,E;return s(ic)%2===0?((T=(k=(b=s(Oc)[Math.floor(s(ic)/2)])==null?void 0:b.styles)==null?void 0:k.increasing)==null?void 0:T.color)||"#00C851":((E=($=(A=s(Oc)[Math.floor(s(ic)/2)])==null?void 0:A.styles)==null?void 0:$.decreasing)==null?void 0:E.color)||"#FF4444"});rl(_m,{get show(){return s(_d)},set show(b){x(_d,N(b))},get selectedColor(){return s(Kf)},get position(){return s(Kl)},$$events:{colorChange:b=>{const k=Math.floor(s(ic)/2);s(Oc)[k]&&(s(ic)%2===0?s(Oc)[k].styles.increasing.color=b.detail.rgba||b.detail.color:s(Oc)[k].styles.decreasing.color=b.detail.rgba||b.detail.color,Jc())}}});var Vm=u(_m,2),ym=vt(()=>{var b,k,T;return((T=(k=(b=s(Yo)[s(re)])==null?void 0:b.styles)==null?void 0:k[s(me)])==null?void 0:T.color)||"#2563eb"});rl(Vm,{get show(){return s(oe)},set show(b){x(oe,N(b))},get selectedColor(){return s(ym)},get position(){return s(ee)},$$events:{colorChange:b=>{s(Yo).length>s(re)&&s(Yo)[s(re)].styles[s(me)]&&(s(Yo)[s(re)].styles[s(me)].color=b.detail.rgba||b.detail.color,Bt())}}});var Wm=u(Vm,2),qm=vt(()=>{var b,k,T;return((T=(k=(b=s(Oc)[0])==null?void 0:b.styles)==null?void 0:k.increasing)==null?void 0:T.color)||"#16a34a"});rl(Wm,{get show(){return s(Gd)},set show(b){x(Gd,N(b))},get selectedColor(){return s(qm)},get position(){return s(lu)},$$events:{colorChange:b=>{s(Oc).length>0&&(s(Oc)[0].styles.increasing.color=b.detail.rgba||b.detail.color)}}});var Hm=u(Wm,2),Ti=vt(()=>{var b,k,T;return((T=(k=(b=s(Oc)[0])==null?void 0:b.styles)==null?void 0:k.decreasing)==null?void 0:T.color)||"#dc2626"});rl(Hm,{get show(){return s(Yd)},set show(b){x(Yd,N(b))},get selectedColor(){return s(Ti)},get position(){return s(eu)},$$events:{colorChange:b=>{s(Oc).length>0&&(s(Oc)[0].styles.decreasing.color=b.detail.rgba||b.detail.color)}}});var zo=u(Hm,2),ca=vt(()=>{var b;return((b=h[0])==null?void 0:b.color)||"#2563eb"});rl(zo,{get show(){return s(Ju)},set show(b){x(Ju,N(b))},get selectedColor(){return s(ca)},get position(){return mu},$$events:{colorChange:b=>{h.length>0&&(h[0].color=b.detail.rgba||b.detail.color)}}});var oa=u(zo,2),_s=vt(()=>{var b;return((b=h[1])==null?void 0:b.color)||"#dc2626"});rl(oa,{get show(){return s(yd)},set show(b){x(yd,N(b))},get selectedColor(){return s(_s)},get position(){return tn},$$events:{colorChange:b=>{h.length>1&&(h[1].color=b.detail.rgba||b.detail.color)}}});var Gi=u(oa,2),Fl=vt(()=>{var b;return((b=h[2])==null?void 0:b.color)||"#16a34a"});rl(Gi,{get show(){return s(En)},set show(b){x(En,N(b))},get selectedColor(){return s(Fl)},get position(){return s(go)},$$events:{colorChange:b=>{h.length>2&&(h[2].color=b.detail.rgba||b.detail.color)}}});var Ta=u(Gi,2);rl(Ta,{get show(){return s(hn)},set show(b){x(hn,N(b))},get selectedColor(){return s(S)},get position(){return s(Ho)},$$events:{colorChange:b=>{x(S,N(b.detail.rgba||b.detail.color))}}});var sa=u(Ta,2);rl(sa,{get show(){return s(Eo)},set show(b){x(Eo,N(b))},get selectedColor(){return s(I)},get position(){return s(di)},$$events:{colorChange:b=>{x(I,N(b.detail.rgba||b.detail.color))}}});var ec=u(sa,2);rl(ec,{get show(){return s(ns)},set show(b){x(ns,N(b))},get selectedColor(){return s(C)},get position(){return s($i)},$$events:{colorChange:b=>{x(C,N(b.detail.rgba||b.detail.color))}}});var Dr=u(ec,2);rl(Dr,{get show(){return s(hi)},set show(b){x(hi,N(b))},get selectedColor(){return s(M)},get position(){return s(li)},$$events:{colorChange:b=>{x(M,N(b.detail.rgba||b.detail.color))}}});var Ul=u(Dr,2),Wc=vt(()=>{var b;return((b=h[s(Lt)])==null?void 0:b.color)||"#2563eb"});rl(Ul,{get show(){return s(tt)},set show(b){x(tt,N(b))},get selectedColor(){return s(Wc)},get position(){return s(wt)},$$events:{colorChange:b=>{h.length>s(Lt)&&(h[s(Lt)].color=b.detail.rgba||b.detail.color,Ji())}}});var uu=u(Ul,2),Yu=vt(()=>{var b;return((b=s($n)[s(Xt)])==null?void 0:b.color)||"#FF6C37"});rl(uu,{get show(){return s(qt)},set show(b){x(qt,N(b))},get selectedColor(){return s(Yu)},get position(){return s(qn)},$$events:{colorChange:b=>{s($n).length>s(Xt)&&(s($n)[s(Xt)].color=b.detail.rgba||b.detail.color,Ma(s(Xt)))}}});var pu=u(uu,2),Yv=vt(()=>{var b;return((b=h[s(Jo)])==null?void 0:b.color)||"#2563eb"});rl(pu,{get show(){return s(co)},set show(b){x(co,N(b))},get selectedColor(){return s(Yv)},get position(){return s(so)},$$events:{colorChange:b=>{h.length>s(Jo)&&(h[s(Jo)].color=b.detail.rgba||b.detail.color,el())}}});var Ip=u(pu,2),lf=vt(()=>{var b;return((b=s(B)[s(ra)])==null?void 0:b.color)||"#2563eb"});rl(Ip,{get show(){return s(Os)},set show(b){x(Os,N(b))},get selectedColor(){return s(lf)},get position(){return s(wr)},$$events:{colorChange:b=>{s(B).length>s(ra)&&(s(B)[s(ra)].color=b.detail.rgba||b.detail.color,ir(s(ra)))}}});var et=u(Ip,2),Ae=vt(()=>(()=>{const b=Math.floor(s(it)/3),k=s(it)%3,T=s(fo)[b];if(!T)return"#2563eb";switch(k){case 0:return T.styles.k.color;case 1:return T.styles.d.color;case 2:return T.styles.j.color;default:return"#2563eb"}})());rl(et,{get show(){return s(Ze)},set show(b){x(Ze,N(b))},get selectedColor(){return s(Ae)},get position(){return s(Ge)},$$events:{colorChange:b=>{const k=Math.floor(s(it)/3),T=s(it)%3,A=s(fo)[k];if(console.log("🎨 KDJ Color change:",{groupIndex:k,lineIndex:T,newColor:b.detail.color,group:A}),A){switch(T){case 0:A.styles.k.color=b.detail.rgba||b.detail.color,console.log("🎨 Updated K color to:",b.detail.color);break;case 1:A.styles.d.color=b.detail.rgba||b.detail.color,console.log("🎨 Updated D color to:",b.detail.color);break;case 2:A.styles.j.color=b.detail.rgba||b.detail.color,console.log("🎨 Updated J color to:",b.detail.color);break}console.log("🎨 Updated KDJ group:",A),nu(k)}}}});var gt=u(et,2),He=vt(()=>(()=>{const b=s(Is)[s(Ec)];if(!b)return"#2563eb";switch(s(al)){case"cr":return b.styles.cr.color;case"ma1":return b.styles.ma1.color;case"ma2":return b.styles.ma2.color;case"ma3":return b.styles.ma3.color;case"ma4":return b.styles.ma4.color;default:return"#2563eb"}})());rl(gt,{get show(){return s(od)},set show(b){x(od,N(b))},get selectedColor(){return s(He)},get position(){return s(zd)},$$events:{colorChange:b=>{const k=s(Is)[s(Ec)];if(k){switch(s(al)){case"cr":k.styles.cr.color=b.detail.rgba||b.detail.color;break;case"ma1":k.styles.ma1.color=b.detail.rgba||b.detail.color;break;case"ma2":k.styles.ma2.color=b.detail.rgba||b.detail.color;break;case"ma3":k.styles.ma3.color=b.detail.rgba||b.detail.color;break;case"ma4":k.styles.ma4.color=b.detail.rgba||b.detail.color;break}js()}}}});var ht=u(gt,2),It=vt(()=>{var b,k,T;return((T=(k=(b=s(Fo)[s(lc)])==null?void 0:b.styles)==null?void 0:k.rsi)==null?void 0:T.color)||"#8B5CF6"});rl(ht,{get show(){return s(Qr)},set show(b){x(Qr,N(b))},get selectedColor(){return s(It)},get position(){return s(hl)},$$events:{colorChange:b=>{s(Fo).length>s(lc)&&(s(Fo)[s(lc)].styles.rsi.color=b.detail.rgba||b.detail.color,te(s(lc)))}}});var Ot=u(ht,2),lo=vt(()=>{var b,k;return((k=(b=s(Fo)[s(zl)])==null?void 0:b.styles)==null?void 0:k.overboughtColor)||"#EF4444"});rl(Ot,{get show(){return s(kc)},set show(b){x(kc,N(b))},get selectedColor(){return s(lo)},get position(){return s(Vd)},$$events:{colorChange:b=>{if(s(Fo).length>s(zl)){const k=b.detail.rgba||b.detail.color;s(Fo)[s(zl)].styles.overboughtColor=k,x(Fo,N([...s(Fo)])),te(s(zl))}}}});var sn=u(Ot,2),Ao=vt(()=>{var b,k;return((k=(b=s(Fo)[s(zl)])==null?void 0:b.styles)==null?void 0:k.oversoldColor)||"#22C55E"});rl(sn,{get show(){return s(sd)},set show(b){x(sd,N(b))},get selectedColor(){return s(Ao)},get position(){return s(id)},$$events:{colorChange:b=>{if(s(Fo).length>s(zl)){const k=b.detail.rgba||b.detail.color;s(Fo)[s(zl)].styles.oversoldColor=k,x(Fo,N([...s(Fo)])),te(s(zl))}}}});var Cn=u(sn,2),Jn=vt(()=>{var b,k;return((k=(b=s(Fo)[s(zl)])==null?void 0:b.styles)==null?void 0:k.middleLineColor)||"#6B7280"});rl(Cn,{get show(){return s(Pd)},set show(b){x(Pd,N(b))},get selectedColor(){return s(Jn)},get position(){return s(Ed)},$$events:{colorChange:b=>{if(s(Fo).length>s(zl)){const k=b.detail.rgba||b.detail.color;s(Fo)[s(zl)].styles.middleLineColor=k,x(Fo,N([...s(Fo)])),te(s(zl))}}}});var nn=u(Cn,2),us=vt(()=>{var b,k,T;return((T=(k=(b=s($e)[s(ur)])==null?void 0:b.styles)==null?void 0:k.kLine)==null?void 0:T.color)||"#2962FF"});rl(nn,{get show(){return s(qr)},set show(b){x(qr,N(b))},get selectedColor(){return s(us)},get position(){return s(Ya)},$$events:{colorChange:b=>{s($e).length>s(ur)&&(s($e)[s(ur)].styles.kLine.color=b.detail.rgba||b.detail.color,Zn(s(ur)))}}});var Tn=u(nn,2),ui=vt(()=>{var b,k,T;return((T=(k=(b=s($e)[s(ur)])==null?void 0:b.styles)==null?void 0:k.dLine)==null?void 0:T.color)||"#FF6D00"});rl(Tn,{get show(){return s(Ga)},set show(b){x(Ga,N(b))},get selectedColor(){return s(ui)},get position(){return s(Ya)},$$events:{colorChange:b=>{s($e).length>s(ur)&&(s($e)[s(ur)].styles.dLine.color=b.detail.rgba||b.detail.color,Zn(s(ur)))}}});var Hs=u(Tn,2),da=vt(()=>{var b,k;return((k=(b=s($e)[s(ur)])==null?void 0:b.styles)==null?void 0:k.overboughtColor)||"#EF4444"});rl(Hs,{get show(){return s(Ki)},set show(b){x(Ki,N(b))},get selectedColor(){return s(da)},get position(){return s(Ya)},$$events:{colorChange:b=>{s($e).length>s(ur)&&(s($e)[s(ur)].styles.overboughtColor=b.detail.rgba||b.detail.color,Zn(s(ur)))}}});var Yi=u(Hs,2),Bi=vt(()=>{var b,k;return((k=(b=s($e)[s(ur)])==null?void 0:b.styles)==null?void 0:k.oversoldColor)||"#10B981"});rl(Yi,{get show(){return s(Zl)},set show(b){x(Zl,N(b))},get selectedColor(){return s(Bi)},get position(){return s(Ya)},$$events:{colorChange:b=>{s($e).length>s(ur)&&(s($e)[s(ur)].styles.oversoldColor=b.detail.rgba||b.detail.color,Zn(s(ur)))}}});var bo=u(Yi,2),cs=vt(()=>{var b,k;return((k=(b=s($e)[s(ur)])==null?void 0:b.styles)==null?void 0:k.midLineColor)||"#6B7280"});return rl(bo,{get show(){return s(Tl)},set show(b){x(Tl,N(b))},get selectedColor(){return s(cs)},get position(){return s(Ya)},$$events:{colorChange:b=>{s($e).length>s(ur)&&(s($e)[s(ur)].styles.midLineColor=b.detail.rgba||b.detail.color,Zn(s(ur)))}}}),z(n,Zp),hd({clearCciGroups:Io,clearEmvGroups:ti,clearMtmGroups:bi,clearObvGroups:yl,clearPsyGroups:uc,clearPvtGroups:Ka,clearVolGroups:ni,clearWrGroups:Ca,clearRocGroups:bd,clearRsiGroups:Ql,clearStochasticGroups:ut})}qu(["click","change","input"]);function gR(n,e,t){const o=n.target;x(e,parseInt(o.value)),t()}function hR(n,e){n.target===n.currentTarget&&e(!1)}var _R=n=>n.stopPropagation(),yR=(n,e)=>e(!1),bR=(n,e)=>e("linear"),xR=(n,e)=>e("radial"),wR=(n,e,t)=>e(s(t).angle),kR=fe('<button class="w-8 h-8 text-sm rounded border transition-colors flex items-center justify-center"> </button>'),SR=fe('<div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Direction</label> <div class="grid grid-cols-4 gap-1 mb-3"></div> <div class="relative"><input type="range" min="0" max="360" class="w-full h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <div class="flex justify-between text-xs text-gray-500 mt-1"><span>0°</span> <span class="text-gray-300"> </span> <span>360°</span></div></div></div>'),CR=fe('<button class="absolute -top-2 -right-1 w-3 h-3 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hover:bg-red-600 transition-colors">×</button>'),PR=fe('<div class="absolute top-0 w-4 h-6 border-2 rounded cursor-grab transform -translate-x-1/2"><!></div>'),IR=fe('<button class="mt-2 w-full py-1 text-xs text-gray-400 border border-dashed border-gray-600 rounded hover:border-gray-400 hover:text-gray-300 transition-colors">+ Add Color Stop</button>'),MR=(n,e,t)=>e(s(t),parseInt(n.currentTarget.value)),AR=(n,e,t)=>e(n,s(t)),TR=(n,e,t)=>e(s(t),n.currentTarget.value),LR=(n,e,t)=>e(s(t),parseInt(n.currentTarget.value)),FR=fe('<div class="mb-4 p-3 bg-[#1A1A1A] rounded border border-[#404040]"><h4 class="text-xs font-medium text-gray-300 mb-3"> </h4> <div class="mb-3"><label class="block text-xs text-gray-400 mb-1">Position</label> <div class="flex items-center gap-2"><input type="range" min="0" max="100" class="flex-1 h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <span class="text-xs text-gray-300 w-8"> </span></div></div> <div class="mb-3"><label class="block text-xs text-gray-400 mb-1">Color</label> <div class="flex items-center gap-2"><button class="w-8 h-8 rounded border-2 border-[#404040] cursor-pointer hover:border-gray-300 transition-colors"></button> <input type="text" class="flex-1 px-2 py-1 bg-[#404040] border border-[#555] rounded text-white text-xs focus:border-blue-500 focus:outline-none" placeholder="#000000"></div></div> <div><label class="block text-xs text-gray-400 mb-1">Opacity</label> <div class="flex items-center gap-2"><input type="range" min="0" max="100" class="flex-1 h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <span class="text-xs text-gray-300 w-8"> </span></div></div></div>'),$R=fe('<div class="fixed inset-0 z-[70] flex items-center justify-center p-4"><div class="gradient-editor-container bg-[#2A2A2A] border border-[#404040] rounded-lg shadow-xl w-full max-w-sm max-h-[90vh] overflow-y-auto svelte-e3zmk9"><div class="p-4"><div class="mb-4"><div class="flex items-center justify-between mb-3"><h3 class="text-sm font-semibold text-white">Gradient Editor</h3> <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors">OK</button></div> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Gradient Type</label> <div class="flex gap-2"><button class="flex-1 px-3 py-2 text-xs rounded transition-colors">Linear</button> <button class="flex-1 px-3 py-2 text-xs rounded transition-colors">Radial</button></div></div> <!> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Preview</label> <div class="w-full h-12 rounded border border-[#404040]"></div></div> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Color Stops</label> <div class="relative"><div class="relative w-full h-6 rounded border border-[#404040] cursor-pointer"></div> <!></div></div> <!></div></div></div></div>'),ER=fe("<!> <!>",1);function Db(n,e){gd(e,!1);const t=mv();let o=Ws(e,"show",12,!1),i=Ws(e,"initialGradient",24,()=>({type:"linear",direction:0,stops:[{position:0,color:"#ffffff",opacity:100},{position:100,color:"#000000",opacity:100}]})),r=Qd(),a=Qd(),l=!1,c=-1,d=Qd(!1),p=Qd(0),m=Qd(i().type),h=Qd(i().direction),_=Qd([...i().stops]);const w=[{angle:0,label:"→",title:"Left to Right"},{angle:45,label:"↗",title:"Bottom-Left to Top-Right"},{angle:90,label:"↑",title:"Bottom to Top"},{angle:135,label:"↖",title:"Bottom-Right to Top-Left"},{angle:180,label:"←",title:"Right to Left"},{angle:225,label:"↙",title:"Top-Right to Bottom-Left"},{angle:270,label:"↓",title:"Top to Bottom"},{angle:315,label:"↘",title:"Top-Left to Bottom-Right"}];function S(){const K=[...s(_)].sort((ye,Me)=>ye.position-Me.position).map(ye=>`${P(ye.color,ye.opacity/100)} ${ye.position}%`);return s(m)==="linear"?`linear-gradient(${s(h)}deg, ${K.join(", ")})`:`radial-gradient(circle, ${K.join(", ")})`}function P(me,K){const ye=parseInt(me.slice(1,3),16),Me=parseInt(me.slice(3,5),16),Fe=parseInt(me.slice(5,7),16);return`rgba(${ye}, ${Me}, ${Fe}, ${K})`}function I(me){x(m,me),Y()}function C(me){x(h,me),Y()}function M(){if(s(_).length>=5)return;const me=[...s(_)].sort((Ze,Ge)=>Ze.position-Ge.position);let K=50,ye=0,Me=50;for(let Ze=0;Ze<me.length-1;(Ze+=1)-1){const Ge=me[Ze+1].position-me[Ze].position;Ge>ye&&(ye=Ge,Me=me[Ze].position+Ge/2)}ye>10&&(K=Me);const Fe={position:K,color:"#808080",opacity:100};x(_,[...s(_),Fe]),x(p,s(_).length-1),Y()}function F(me){s(_).length<=2||(x(_,s(_).filter((K,ye)=>ye!==me)),s(p)>=s(_).length&&x(p,s(_).length-1),Y())}function V(me,K){Zm(_,s(_)[me].position=Math.max(0,Math.min(100,K))),Y()}function j(me,K){Zm(_,s(_)[me].color=K),Y()}function D(me,K){Zm(_,s(_)[me].opacity=Math.max(0,Math.min(100,K))),Y()}function R(me,K){const ye=me.target.getBoundingClientRect();ye.right+10,ye.top,x(p,K),x(d,!0)}function W(me){s(p)>=0&&s(p)<s(_).length&&(Zm(_,s(_)[s(p)].color=me.detail),Y())}function J(me){s(p)>=0&&s(p)<s(_).length&&(Zm(_,s(_)[s(p)].opacity=me.detail),Y())}function Z(me){if(!s(a))return;const K=s(a).getBoundingClientRect(),ye=me.clientX-K.left,Me=ye/K.width*100;let Fe=-1;const Ze=8;if(s(_).forEach((Ge,it)=>{const Ye=Ge.position/100*K.width;Math.abs(ye-Ye)<=Ze&&(Fe=it)}),Fe>=0)l=!0,c=Fe,x(p,Fe);else if(s(_).length<5){const Ge={position:Math.max(0,Math.min(100,Me)),color:"#808080",opacity:100};x(_,[...s(_),Ge]),x(p,s(_).length-1),Y()}}function G(me){if(!l||c<0||!s(a))return;const K=s(a).getBoundingClientRect(),ye=me.clientX-K.left,Me=Math.max(0,Math.min(100,ye/K.width*100));Zm(_,s(_)[c].position=Me),Y()}function se(){l=!1,c=-1}function Y(){const me={type:s(m),direction:s(h),stops:[...s(_)],css:S()};t("gradientChange",me)}Lm(()=>{typeof document<"u"&&(document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",se))}),fv(()=>{Y()}),Jv(()=>jv(o()),()=>{o()&&typeof document<"u"&&setTimeout(()=>{document.addEventListener("mousemove",G),document.addEventListener("mouseup",se)},0)}),Jv(()=>jv(o()),()=>{!o()&&typeof document<"u"&&(document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",se))}),Eg(),Bv();var oe=ER(),ee=Dt(oe);Te(ee,o,me=>{var K=$R();K.__click=[hR,o];var ye=g(K);ye.__click=[_R];var Me=g(ye),Fe=g(Me),Ze=g(Fe),Ge=u(g(Ze),2);Ge.__click=[yR,o],f(Ze);var it=u(Ze,2),Ye=u(g(it),2),ct=g(Ye);ct.__click=[bR,I];var kt=u(ct,2);kt.__click=[xR,I],f(Ye),f(it);var ft=u(it,2);Te(ft,()=>s(m)==="linear",Ne=>{var ue=SR(),he=u(g(ue),2);vs(he,5,()=>w,Vs,(zn,un)=>{var On=kR();On.__click=[wR,C,un];var no=g(On,!0);f(On),Se(()=>{zt(On,"title",s(un).title),Fi(On,"border-blue-500",s(h)===s(un).angle),Fi(On,"bg-blue-600",s(h)===s(un).angle),Fi(On,"text-white",s(h)===s(un).angle),Fi(On,"border-[#404040]",s(h)!==s(un).angle),Fi(On,"text-gray-300",s(h)!==s(un).angle),ze(no,s(un).label)}),z(zn,On)}),f(he);var _t=u(he,2),Wt=g(_t);Qt(Wt),Wt.__input=[gR,h,Y];var jt=u(Wt,2),Zt=u(g(jt),2),dn=g(Zt);f(Zt),ai(2),f(jt),f(_t),f(ue),Se(()=>ze(dn,`${s(h)??""}°`)),po(Wt,()=>s(h),zn=>x(h,zn)),z(Ne,ue)});var bt=u(ft,2),nt=u(g(bt),2);const Pt=Rv(()=>`background: ${S()??""};`);f(bt);var Qe=u(bt,2),yt=u(g(Qe),2),xe=g(yt);const Ve=Rv(()=>`background: ${S()??""};`);xe.__mousedown=Z,vs(xe,5,()=>s(_),Vs,(Ne,ue,he)=>{var _t=PR();_t.__click=jt=>{jt.stopPropagation(),x(p,he)};var Wt=g(_t);Te(Wt,()=>s(_).length>2,jt=>{var Zt=CR();Zt.__click=dn=>{dn.stopPropagation(),F(he)},z(jt,Zt)}),f(_t),Se(()=>{zt(_t,"style",`left: ${s(ue).position??""}%; background-color: ${s(ue).color??""};`),Fi(_t,"border-white",he===s(p)),Fi(_t,"border-gray-500",he!==s(p))}),z(Ne,_t)}),f(xe),Xu(xe,Ne=>x(a,Ne),()=>s(a));var Je=u(xe,2);Te(Je,()=>s(_).length<5,Ne=>{var ue=IR();ue.__click=M,z(Ne,ue)}),f(yt),f(Qe);var St=u(Qe,2);Te(St,()=>s(p)>=0&&s(p)<s(_).length,Ne=>{var ue=FR(),he=g(ue),_t=g(he);f(he);var Wt=u(he,2),jt=u(g(Wt),2),Zt=g(jt);Qt(Zt),Zt.__input=[MR,V,p];var dn=u(Zt,2),zn=g(dn);f(dn),f(jt),f(Wt);var un=u(Wt,2),On=u(g(un),2),no=g(On);no.__click=[AR,R,p];var fs=u(no,2);Qt(fs),fs.__input=[TR,j,p],f(On),f(un);var ps=u(un,2),So=u(g(ps),2),Es=g(So);Qt(Es),Es.__input=[LR,D,p];var Qo=u(Es,2),Ko=g(Qo);f(Qo),f(So),f(ps),f(ue),Se(()=>{ze(_t,`Stop ${s(p)+1} Configuration`),ze(zn,`${s(_)[s(p)].position??""}%`),zt(no,"style",`background-color: ${s(_)[s(p)].color??""};`),ze(Ko,`${s(_)[s(p)].opacity??""}%`)}),po(Zt,()=>s(_)[s(p)].position,oo=>Zm(_,s(_)[s(p)].position=oo)),po(fs,()=>s(_)[s(p)].color,oo=>Zm(_,s(_)[s(p)].color=oo)),po(Es,()=>s(_)[s(p)].opacity,oo=>Zm(_,s(_)[s(p)].opacity=oo)),z(Ne,ue)}),f(Fe),f(Me),f(ye),Xu(ye,Ne=>x(r,Ne),()=>s(r)),f(K),Se(()=>{Fi(ct,"bg-blue-600",s(m)==="linear"),Fi(ct,"text-white",s(m)==="linear"),Fi(ct,"bg-[#404040]",s(m)!=="linear"),Fi(ct,"text-gray-300",s(m)!=="linear"),Fi(kt,"bg-blue-600",s(m)==="radial"),Fi(kt,"text-white",s(m)==="radial"),Fi(kt,"bg-[#404040]",s(m)!=="radial"),Fi(kt,"text-gray-300",s(m)!=="radial"),zt(nt,"style",s(Pt)),zt(xe,"style",s(Ve))}),z(me,K)});var re=u(ee,2);Te(re,()=>s(d),me=>{var K=Rv(()=>{var Me;return((Me=s(_)[s(p)])==null?void 0:Me.color)||"#000000"}),ye=Rv(()=>{var Me;return((Me=s(_)[s(p)])==null?void 0:Me.opacity)||100});Pf(me,{get show(){return s(d)},set show(Me){x(d,Me)},get selectedColor(){return s(K)},get opacity(){return s(ye)},$$events:{colorChange:W,opacityChange:J},$$legacy:!0})}),z(n,oe),hd()}qu(["click","input","mousedown"]);var Im,Mm,tg,eh,s_;const yy=class yy extends Map{constructor(t){super();wh(this,eh);wh(this,Im,new Map);wh(this,Mm,Vg(0));wh(this,tg,Vg(0));if(t){for(var[o,i]of t)super.set(o,i);Ap(this,tg).v=super.size}}has(t){var o=Ap(this,Im),i=o.get(t);if(i===void 0){var r=super.get(t);if(r!==void 0)i=Vg(0),o.set(t,i);else return s(Ap(this,Mm)),!1}return s(i),!0}forEach(t,o){C0(this,eh,s_).call(this),super.forEach(t,o)}get(t){var o=Ap(this,Im),i=o.get(t);if(i===void 0){var r=super.get(t);if(r!==void 0)i=Vg(0),o.set(t,i);else{s(Ap(this,Mm));return}}return s(i),super.get(t)}set(t,o){var m;var i=Ap(this,Im),r=i.get(t),a=super.get(t),l=super.set(t,o),c=Ap(this,Mm);if(r===void 0)i.set(t,Vg(0)),x(Ap(this,tg),super.size),kh(c);else if(a!==o){kh(r);var d=c.reactions===null?null:new Set(c.reactions),p=d===null||!((m=r.reactions)!=null&&m.every(h=>d.has(h)));p&&kh(c)}return l}delete(t){var o=Ap(this,Im),i=o.get(t),r=super.delete(t);return i!==void 0&&(o.delete(t),x(Ap(this,tg),super.size),x(i,-1),kh(Ap(this,Mm))),r}clear(){if(super.size!==0){super.clear();var t=Ap(this,Im);x(Ap(this,tg),0);for(var o of t.values())x(o,-1);kh(Ap(this,Mm)),t.clear()}}keys(){return s(Ap(this,Mm)),super.keys()}values(){return C0(this,eh,s_).call(this),super.values()}entries(){return C0(this,eh,s_).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return s(Ap(this,tg)),super.size}};Im=new WeakMap,Mm=new WeakMap,tg=new WeakMap,eh=new WeakSet,s_=function(){s(Ap(this,Mm));var t=Ap(this,Im);if(Ap(this,tg).v!==t.size)for(var o of Sy(yy.prototype,this,"keys").call(this))t.has(o)||t.set(o,Vg(0));for(var[,i]of Ap(this,Im))s(i)};let e0=yy;function U1(n="dark"){return{version:2,canvas:{background:{mode:"solid",solid:{color:n==="dark"?"#070211":"#ffffff",alpha:1}},grid:{mode:"solid",solid:{color:n==="dark"?"#081115":"#F3F3F3",alpha:1}}}}}function q0(n){return JSON.parse(JSON.stringify(n))}function NR(n,e="dark"){const o={current:U1(e),pending:null,chartId:n};return zp(o)}function DR(n,e){if(typeof window>"u"||!window.localStorage)return;const t=`dutyai.chart.theme.${n}`;try{localStorage.setItem(t,JSON.stringify(e)),console.debug("THEME_PERSIST",{chartId:n,settings:e})}catch(o){console.error("Failed to persist theme settings:",o)}}function jb(n,e="dark"){if(typeof window>"u"||!window.localStorage)return U1(e);const t=`dutyai.chart.theme.${n}`;try{const o=localStorage.getItem(t);if(o){const i=JSON.parse(o);if(i.version===2&&i.canvas)return console.debug("THEME_LOAD",{chartId:n,settings:i}),i}}catch(o){console.error("Failed to load persisted theme settings:",o)}return U1(e)}function jR(n){if(!n||!n.stops||n.stops.length===0)return"transparent";const e=n.stops.map(t=>{const o=t.alpha!==void 0?t.alpha:1,i=t.color;if(o!==1&&i.startsWith("#")){const r=parseInt(i.slice(1,3),16),a=parseInt(i.slice(3,5),16),l=parseInt(i.slice(5,7),16);return`rgba(${r}, ${a}, ${l}, ${o}) ${t.offset*100}%`}return`${i} ${t.offset*100}%`}).join(", ");if(n.type==="linear")return`linear-gradient(${n.angle||0}deg, ${e})`;if(n.type==="radial"){const t=n.cx||.5,o=n.cy||.5;return n.r,`radial-gradient(circle at ${t*100}% ${o*100}%, ${e})`}return"transparent"}function h1(n,e=1){if(!n.startsWith("#"))return n;const t=parseInt(n.slice(1,3),16),o=parseInt(n.slice(3,5),16),i=parseInt(n.slice(5,7),16);return`rgba(${t}, ${o}, ${i}, ${e})`}class hy{constructor(e,t,o="dark"){Ce(this,"settingsStore");Ce(this,"chart");Ce(this,"chartId");Ce(this,"pendingThemeApplication",null);Ce(this,"chartUnsubscribe",null);Ce(this,"chartReadinessTimeout",null);Ce(this,"applyCanvasColorsFn",null);this.chartId=e,this.chart=t,this.settingsStore=NR(e,o),this.setupChartReadinessMonitoring(),this.loadPersistedSettings(o)}setApplyCanvasColorsFunction(e){this.applyCanvasColorsFn=e,console.log("🎨 Canvas colors function registered with theme manager")}applyCanvasColorsIfAvailable(){this.applyCanvasColorsFn&&(console.log("🎨 Applying canvas colors via theme manager"),this.applyCanvasColorsFn())}getStore(){return this.settingsStore}setupChartReadinessMonitoring(){this.chartUnsubscribe=this.chart.subscribe(e=>{e&&this.pendingThemeApplication&&(console.log("📊 Chart became available, applying pending theme"),this.applyTheme(this.pendingThemeApplication,{preview:!1}),this.pendingThemeApplication=null,this.chartReadinessTimeout&&(clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=null))})}setupChartReadinessTimeout(){this.chartReadinessTimeout&&clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=setTimeout(()=>{this.pendingThemeApplication&&(console.warn("📊 Chart readiness timeout - clearing pending theme application"),this.pendingThemeApplication=null),this.chartReadinessTimeout=null},1e4)}destroy(){this.chartUnsubscribe&&(this.chartUnsubscribe(),this.chartUnsubscribe=null),this.chartReadinessTimeout&&(clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=null)}loadPersistedSettings(e){let t=jb(this.chartId,e);const o=this.loadFromLegacySystem();o&&(t=this.mergeThemeSettings(t,o)),this.settingsStore.update(r=>({...r,current:t})),tv(this.chart)?this.applyTheme(t,{preview:!1}):(console.log("📊 Chart not ready, deferring theme application"),this.pendingThemeApplication=t,this.setupChartReadinessTimeout())}loadFromLegacySystem(){var e,t,o,i,r,a;try{const l=localStorage.getItem("chart");if(!l)return null;const c=JSON.parse(l);if(!c.styles)return null;console.log("📦 Loading from localStorage - chart type:",(t=(e=c.styles)==null?void 0:e.candle)==null?void 0:t.type);const d={canvas:{background:{},grid:{}}},p=c.styles.backgroundType||"solid";p==="solid"&&c.styles.backgroundColor?d.canvas.background={mode:"solid",solid:{color:c.styles.backgroundColor,alpha:(c.styles.backgroundOpacity??100)/100}}:p==="gradient"&&c.styles.backgroundGradient&&(d.canvas.background={mode:"gradient",gradient:c.styles.backgroundGradient});const m=c.styles.gridType||"solid";if(m==="solid"){const h=((i=(o=c.styles.grid)==null?void 0:o.horizontal)==null?void 0:i.color)||((a=(r=c.styles.grid)==null?void 0:r.vertical)==null?void 0:a.color);if(h){const _=this.extractHexFromColor(h),w=c.styles.gridOpacity??100;d.canvas.grid={mode:"solid",solid:{color:_,alpha:w/100}}}}else m==="gradient"&&c.styles.gridGradient&&(d.canvas.grid={mode:"gradient",gradient:c.styles.gridGradient});return console.debug("LEGACY_LOAD",{loadedSettings:d}),d}catch(l){return console.error("Failed to load from legacy system:",l),null}}extractHexFromColor(e){if(e.startsWith("#"))return e;if(e.startsWith("rgba")||e.startsWith("rgb")){const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(t){const o=parseInt(t[1]).toString(16).padStart(2,"0"),i=parseInt(t[2]).toString(16).padStart(2,"0"),r=parseInt(t[3]).toString(16).padStart(2,"0");return`#${o}${i}${r}`}}return e}mergeThemeSettings(e,t){var i,r;const o=q0(e);return(i=t.canvas)!=null&&i.background&&(o.canvas.background=t.canvas.background),(r=t.canvas)!=null&&r.grid&&(o.canvas.grid=t.canvas.grid),o}openModal(){this.settingsStore.update(e=>(e.pending===null&&(e.pending=q0(e.current),console.debug("THEME_MODAL_OPEN",{pending:e.pending})),e))}updatePending(e,t=!1){this.settingsStore.update(o=>(o.pending&&(e(o.pending),t&&this.applyTheme(o.pending,{preview:!0}),console.debug("THEME_PENDING_UPDATE",{pending:o.pending,applyPreview:t})),o))}confirm(){this.settingsStore.update(e=>(e.pending&&(e.current=q0(e.pending),DR(this.chartId,e.current),this.applyTheme(e.current,{preview:!1}),this.syncToLegacySystem(e.current),console.debug("THEME_COMMIT",{current:e.current}),e.pending=null),e))}syncToLegacySystem(e){var t,o;try{const i=localStorage.getItem("chart");if(i){const r=JSON.parse(i),a=(o=(t=r.styles)==null?void 0:t.candle)==null?void 0:o.type;if(console.log("🔒 Preserving chart type in syncToLegacySystem:",a),r.styles||(r.styles={}),e.canvas.background.mode==="solid"&&e.canvas.background.solid?(r.styles.backgroundColor=e.canvas.background.solid.color,r.styles.backgroundOpacity=(e.canvas.background.solid.alpha??1)*100,r.styles.backgroundType="solid",delete r.styles.backgroundGradient):e.canvas.background.mode==="gradient"&&e.canvas.background.gradient&&(r.styles.backgroundGradient=e.canvas.background.gradient,r.styles.backgroundType="gradient",delete r.styles.backgroundColor,delete r.styles.backgroundOpacity),e.canvas.grid.mode==="solid"&&e.canvas.grid.solid){r.styles.grid||(r.styles.grid={}),r.styles.grid.horizontal||(r.styles.grid.horizontal={}),r.styles.grid.vertical||(r.styles.grid.vertical={});const l=e.canvas.grid.solid.alpha!==void 0&&e.canvas.grid.solid.alpha!==1?h1(e.canvas.grid.solid.color,e.canvas.grid.solid.alpha):e.canvas.grid.solid.color;r.styles.grid.horizontal.color=l,r.styles.grid.vertical.color=l,r.styles.gridOpacity=(e.canvas.grid.solid.alpha??1)*100,r.styles.gridType="solid",delete r.styles.gridGradient}else e.canvas.grid.mode==="gradient"&&e.canvas.grid.gradient&&(r.styles.gridGradient=e.canvas.grid.gradient,r.styles.gridType="gradient");a&&(r.styles.candle||(r.styles.candle={}),r.styles.candle.type=a,console.log("✅ Restored chart type in syncToLegacySystem:",a)),localStorage.setItem("chart",JSON.stringify(r)),console.debug("LEGACY_SYNC",{syncedStyles:r.styles,preservedChartType:a})}}catch(i){console.error("Failed to sync to legacy system:",i)}}cancel(){this.settingsStore.update(e=>(e.pending&&(this.applyTheme(e.current,{preview:!1}),console.debug("THEME_CANCEL",{reverted_to:e.current}),e.pending=null),e))}reset(){this.settingsStore.update(e=>(e.pending&&(e.pending=q0(e.current),this.applyTheme(e.pending,{preview:!0}),console.debug("THEME_RESET",{pending:e.pending})),e))}applyTheme(e,t={}){const o=tv(this.chart);if(!o){console.log("📊 Chart not available for theme application, storing for later"),t.preview||(this.pendingThemeApplication=e,this.setupChartReadinessTimeout());return}if(!e||!e.canvas){console.warn("Invalid theme configuration, skipping application");return}const i=t.preview||!1;i?this.addPreviewWatermark():this.removePreviewWatermark();try{e.canvas.background&&this.applyBackground(e.canvas.background),i||(e.canvas.grid&&this.applyGrid(e.canvas.grid,o),setTimeout(()=>{this.applyCanvasColorsIfAvailable()},150)),console.debug("THEME_APPLIED",{theme:e.canvas,preview:i,chartId:this.chartId,appliedGrid:!i})}catch(r){console.error("Failed to apply theme:",r)}}applyBackground(e){const t=document.querySelector(".kline-main"),o=document.querySelector(".kline-widget");if(!t&&!o){console.warn("Chart containers not found for background application");return}if(!e){console.warn("Background configuration is null or undefined, skipping");return}let i;if(e.mode==="solid"&&e.solid&&e.solid.color){const r=e.solid.alpha!==void 0?e.solid.alpha:1;i=r!==1?h1(e.solid.color,r):e.solid.color}else e.mode==="gradient"&&e.gradient?i=jR(e.gradient):(console.warn("Invalid background configuration, using fallback"),i="#070211");console.log("🎨 Applying background:",i),[t,o].forEach(r=>{r&&(r.style.removeProperty("background"),r.style.removeProperty("background-color"),r.offsetHeight,r.style.background=i,r.style.backgroundColor=i,r.style.setProperty("--chart-background-color",i),r.offsetHeight)})}applyGrid(e,t){var a,l;const o=t.getStyles()??{},i=Mn.cloneDeep(o);try{const c=localStorage.getItem("chart");if(c){const d=JSON.parse(c);(l=(a=d.styles)==null?void 0:a.candle)!=null&&l.type&&(i.candle||(i.candle={}),i.candle.type=d.styles.candle.type,console.log("🔒 Preserved chart type in applyGrid:",d.styles.candle.type))}}catch(c){console.warn("Failed to preserve chart type:",c)}let r;if(e.mode==="solid"&&e.solid){const c=e.solid.alpha!==void 0?e.solid.alpha:1;r=c!==1?h1(e.solid.color,c):e.solid.color}else if(e.mode==="gradient"&&e.gradient){const c=e.gradient.stops;if(c.length===1)r=c[0].color;else if(c.length>=2)r=this.blendColors(c[0].color,c[c.length-1].color,.5);else{console.warn("Invalid grid gradient configuration");return}}else{console.warn("Invalid grid configuration");return}console.log("🎨 ThemeManager applying grid color:",r),Mn.set(i,"grid.horizontal.color",r),Mn.set(i,"grid.vertical.color",r),t.setStyles(i),console.log("✅ Applied grid styles directly:",{gridColor:r,gridConfig:i.grid})}blendColors(e,t,o){if(!e.startsWith("#")||!t.startsWith("#"))return e;const i=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16),l=parseInt(t.slice(1,3),16),c=parseInt(t.slice(3,5),16),d=parseInt(t.slice(5,7),16),p=Math.round(i*(1-o)+l*o),m=Math.round(r*(1-o)+c*o),h=Math.round(a*(1-o)+d*o);return`#${p.toString(16).padStart(2,"0")}${m.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}`}addPreviewWatermark(){this.removePreviewWatermark();const e=document.querySelector(".kline-main");if(!e)return;const t=document.createElement("div");t.id="theme-preview-watermark",t.style.cssText=`
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 0, 0, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      z-index: 1000;
      pointer-events: none;
    `,t.textContent="PREVIEW",e.style.position="relative",e.appendChild(t)}removePreviewWatermark(){const e=document.getElementById("theme-preview-watermark");e&&e.remove()}getCurrentSettings(){return tv(this.settingsStore).current}getPendingSettings(){return tv(this.settingsStore).pending}isModalOpen(){return tv(this.settingsStore).pending!==null}resetToThemeDefaults(e){const t=jb(this.chartId,e);this.settingsStore.update(o=>({...o,current:t,pending:null})),console.log("🔄 Reset TransactionalThemeManager to theme defaults:",e)}}function RR(n,e,t){const o=n.target.checked;x(e,N(o)),t({wick:o})}function BR(n,e,t){const o=n.target.value;x(e,N(o)),t({source:o})}function OR(n,e,t){const o="ATR";x(e,o),t({method:o})}function zR(n,e,t){const o=parseInt(n.target.value||"14",10),i=Math.max(1,isNaN(o)?14:o);x(e,N(i)),t({atrLength:i})}function VR(n,e,t){const o=n.target.value;x(e,N(o)),t({boxSizeMode:o})}function WR(n,e,t){const o=parseFloat(n.target.value||"1"),i=Math.max(1e-4,isNaN(o)?1:o);x(e,N(i)),t({boxSize:i})}function qR(n,e,t){const o=parseInt(n.target.value||"14",10),i=Math.max(1,isNaN(o)?14:o);x(e,N(i)),t({atrLength:i})}function HR(n,e,t){const o=parseInt(n.target.value||"3",10),i=Math.max(1,isNaN(o)?3:o);x(e,N(i)),t({reversalBoxes:i})}function UR(n,e,t){const o=n.target.value;x(e,N(o)),t({upColor:o})}function GR(n,e,t){const o=n.target.value;x(e,N(o)),t({downColor:o})}function YR(n,e,t,o,i,r,a,l){x(e,"ATR"),x(t,1),x(o,14),x(i,3),x(r,"#00E6D8"),x(a,"#FF4D4D"),l({boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"})}function KR(n,e,t,o,i,r,a,l,c,d){if(s(e)==="solid"){const p=n.target.getBoundingClientRect();x(t,N({x:p.right+10,y:p.top})),x(o,!0),x(i,!1),x(r,!1),x(a,!1),x(l,!1),x(c,!1),d()}else s(e)==="gradient"&&(x(r,!0),x(o,!1),x(i,!1),x(a,!1),x(l,!1),x(c,!1))}function ZR(n,e,t,o,i,r,a,l,c){if(console.log("🔥 Grid picker clicked, type:",s(e)),s(e)==="solid"){const d=n.target.getBoundingClientRect();x(t,N({x:d.right+10,y:d.top})),console.log("🔥 Opening grid color picker at:",s(t)),x(o,!0),x(i,!1),x(r,!1),x(a,!1),x(l,!1),x(c,!1)}else s(e)==="gradient"&&(x(a,!0),x(o,!1),x(i,!1),x(r,!1),x(l,!1),x(c,!1))}function XR(n,e,t,o,i,r,a,l,c){const d=n.target.getBoundingClientRect();x(e,N({x:d.right+10,y:d.top})),x(t,!0),x(o,!1),x(i,!1),x(r,!1),x(a,!1),x(l,!1),c()}function JR(n,e,t,o,i,r,a,l,c){const d=n.target.getBoundingClientRect();x(e,N({x:d.right+10,y:d.top})),x(t,!0),x(o,!1),x(i,!1),x(r,!1),x(a,!1),x(l,!1),c()}function QR(n,e,t,o,i,r,a,l,c,d){const p=n.target.getBoundingClientRect();x(e,N({x:p.right+10,y:p.top})),x(t,!1),x(o,!1),x(i,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(d,!0)}function eB(n,e,t,o,i,r,a,l,c,d){const p=n.target.getBoundingClientRect();x(e,N({x:p.right+10,y:p.top})),x(t,!1),x(o,!1),x(i,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(d,!0)}function tB(n,e,t,o,i,r,a,l,c,d){const p=n.target.getBoundingClientRect();x(e,N({x:p.right+10,y:p.top})),x(t,!1),x(o,!1),x(i,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(d,!0)}function nB(n,e,t,o,i,r,a,l,c,d){const p=n.target.getBoundingClientRect();x(e,N({x:p.right+10,y:p.top})),x(t,!1),x(o,!1),x(i,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(d,!0)}function oB(n,e,t,o,i,r,a,l,c,d){const p=n.target.getBoundingClientRect();x(e,N({x:p.right+10,y:p.top})),x(t,!1),x(o,!1),x(i,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(d,!0)}function sB(n,e,t,o,i,r,a,l,c,d){const p=n.target.getBoundingClientRect();x(e,N({x:p.right+10,y:p.top})),x(t,!1),x(o,!1),x(i,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(d,!0)}function iB(n,e,t){x(e,!s(e)),t()}function rB(n,e,t){x(e,!s(e)),t()}function aB(n,e,t){x(e,!s(e)),t()}var lB=(n,e)=>x(e,"canvas"),cB=(n,e)=>x(e,"other"),dB=(n,e)=>x(e,"candle"),uB=(n,e)=>x(e,"renko"),pB=fe('<button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Duty AI Renko</button>'),vB=(n,e)=>x(e,"pnf"),fB=fe('<button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Point & Figure</button>'),mB=fe('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Canvas Settings</h4> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Background color</label> <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3"><select class="select select-bordered select-sm w-full sm:w-32"><option>Solid</option><option>Gradient</option></select> <button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Grid color</label> <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3"><select class="select select-bordered select-sm w-full sm:w-32"><option>Solid</option><option>Gradient</option></select> <button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">X-Axis tick text color</label> <div class="flex items-center space-x-3"><button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Y-Axis tick text color</label> <div class="flex items-center space-x-3"><button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div></div>'),gB=(n,e,t)=>e(s(t).key,n.target.value),hB=fe("<option> </option>"),_B=fe('<select class="select select-bordered select-sm w-full sm:w-32 flex-shrink-0"></select>'),yB=(n,e,t)=>e(s(t).key,n.target.checked),bB=fe('<input type="checkbox" class="toggle toggle-sm flex-shrink-0">'),xB=fe('<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-2 space-y-2 sm:space-y-0"><label class="text-sm font-medium text-base-content/80 flex-1"> </label> <!></div>'),wB=fe('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Other Settings</h4> <div class="grid grid-cols-1 gap-4"></div></div>'),kB=fe('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Candle Color Customization</h4> <div class="space-y-4"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b border-base-300"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Body</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div> <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b border-base-300"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Borders</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div> <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Wick</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div></div></div>'),SB=fe('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Duty AI Renko Settings</h4> <div class="space-y-4 p-3 rounded-lg border border-base-300"><div class="flex items-center gap-3"><label class="flex items-center gap-2"><input type="checkbox" class="checkbox checkbox-sm"> <span>Wick</span></label></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><div class="flex flex-col gap-1"><label class="text-xs opacity-80">Source</label> <select class="select select-bordered select-sm"><option>Close</option><option>Open</option><option>High</option><option>Low</option></select></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">Box size assignment method</label> <select class="select select-bordered select-sm" disabled><option>ATR</option></select></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">ATR length</label> <input type="number" min="1" class="input input-bordered input-sm"></div></div></div></div>'),CB=fe('<div class="flex flex-col gap-1"><label class="text-xs opacity-80">ATR Length</label> <input type="number" min="1" max="200" step="1" class="input input-bordered input-sm"></div>'),PB=fe('<div class="flex flex-col gap-1"><label class="text-xs opacity-80"> </label> <input type="number" min="0.0001" step="0.1" class="input input-bordered input-sm"></div>'),IB=fe('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Point & Figure Settings</h4> <div class="space-y-4 p-3 rounded-lg border border-base-300"><div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><div class="flex flex-col gap-1"><label class="text-xs opacity-80">Box Size Mode</label> <select class="select select-bordered select-sm"><option>ATR (Auto-fit)</option><option>Absolute (Price Units)</option><option>Percent (%)</option></select></div> <!></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">Reversal Boxes (typical: 3)</label> <input type="number" min="1" max="10" step="1" class="input input-bordered input-sm w-32"></div> <div class="pt-2 border-t border-base-300"><h5 class="text-sm font-medium mb-3">Symbol Colors</h5> <div class="grid grid-cols-2 gap-4"><div class="flex flex-col items-center gap-2"><label class="text-xs opacity-80">Up Column (X)</label> <div class="flex items-center gap-2"><input type="color" class="w-10 h-10 cursor-pointer rounded border border-base-300"> <span class="text-xs font-mono opacity-70"> </span></div></div> <div class="flex flex-col items-center gap-2"><label class="text-xs opacity-80">Down Column (O)</label> <div class="flex items-center gap-2"><input type="color" class="w-10 h-10 cursor-pointer rounded border border-base-300"> <span class="text-xs font-mono opacity-70"> </span></div></div></div></div> <div class="pt-4 border-t border-base-300"><button class="btn btn-sm btn-outline">Reset P&F to Defaults</button></div></div></div>'),MB=fe('<div class="flex flex-col lg:flex-row min-h-[400px] max-h-[70vh] overflow-hidden"><div class="w-full lg:w-48 border-b lg:border-b-0 lg:border-r border-base-300 pb-4 lg:pb-0 lg:pr-4 mb-4 lg:mb-0"><div class="flex lg:flex-col space-x-2 lg:space-x-0 lg:space-y-2 overflow-x-auto lg:overflow-x-visible"><button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Canvas</button> <button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Other Settings</button> <button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Candle</button> <!> <!></div></div> <div class="flex-1 lg:pl-6 overflow-y-auto"><!></div></div>'),AB=fe("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function Uw(n,e){gd(e,!0);const t=wp(),o=()=>ya(c,"$save",t),i=()=>ya(d,"$chart",t),r=()=>ya(l,"$ctx",t);let a=Ws(e,"show",15);const l=Kc("ctx"),c=Kc("save"),d=Kc("chart"),p=new hy("chart-settings",d,"dark");Lm(()=>{p.destroy()});let m=ae(!1),h=null;mr(()=>{var tn,En,go,hn,Ho;if(a())console.log("🔧 Settings modal OPENED"),console.log("  - Current $save.styles.candle.type:",(En=(tn=o().styles)==null?void 0:tn.candle)==null?void 0:En.type),console.log("  - Current chart.getStyles().candle.type:",(Ho=(hn=(go=i())==null?void 0:go.getStyles())==null?void 0:hn.candle)==null?void 0:Ho.type),x(m,!1),p.openModal();else if(!s(m)){console.log("🚫 Settings modal CANCELLED"),h&&(clearTimeout(h),h=null);try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors()}});let _=ae("canvas");const w=new e0;let S=ae(!1),P=ae(!1),I=ae(!1),C=ae(!1),M=ae(N({x:0,y:0})),F=ae(N({x:0,y:0})),V=ae(N({x:0,y:0})),j=ae(N({x:0,y:0})),D=ae(!1),R=ae(!1),W=ae(!1),J=ae(!1),Z=ae(!1),G=ae(!1),se=ae(N({x:0,y:0})),Y=ae(N({x:0,y:0})),oe=ae(N({x:0,y:0})),ee=ae(N({x:0,y:0})),re=ae(N({x:0,y:0})),me=ae(N({x:0,y:0})),K=ae(!1),ye=ae(!1),Me=ae(!1),Fe=ae(N(Mn.get(o().styles,"backgroundType")||"solid")),Ze=ae(N(Mn.get(o().styles,"gridType")||"solid")),Ge=ae(N(Mn.get(o().styles,"backgroundColor")||"#000000")),it=ae(N(Mn.get(o().styles,"grid.horizontal.color")||"#333333")),Ye=ae(100),ct=ae(100),kt=ae(100),ft=ae(100);const bt=[{key:"candle.priceMark.last.show",label:"Show Last Price",type:"switch",default:!0},{key:"candle.priceMark.high.show",label:"Show High Price",type:"switch",default:!0},{key:"candle.priceMark.low.show",label:"Show Low Price",type:"switch",default:!0},{key:"indicator.lastValueMark.show",label:"Show Indicator Last Value",type:"switch",default:!0},{key:"yAxis.reverse",label:"Reverse Coordinate",type:"switch",default:!1},{key:"grid.show",label:"Grid Show",type:"switch",default:!0}],nt=new e0;let Pt=ae(!0),Qe=ae(!0),yt=ae(!0),xe=ae("#26a69a"),Ve=ae("#ef5350"),Je=ae("#26a69a"),St=ae("#ef5350"),Ne=ae("#26a69a"),ue=ae("#ef5350");const he=vt(()=>{var tn,En;return((En=(tn=o().styles)==null?void 0:tn.candle)==null?void 0:En.type)==="renko_atr"});let _t=ae(!1),Wt=ae("close"),jt=ae("ATR"),Zt=ae(14);mr(()=>{var En,go;if(!a())return;const tn=((go=(En=o().styles)==null?void 0:En.candle)==null?void 0:go.renko)||{};x(_t,!!tn.wick),x(Wt,N(tn.source||"close")),x(jt,N(tn.method||"ATR")),x(Zt,N(Math.max(1,(tn.atrLength??14)|0)))}),mr(()=>{a()&&(s(he)?x(_,N(s(_)==="canvas"||s(_)==="other"?s(_):"renko")):s(_)==="renko"&&x(_,"candle"))});function dn(tn){c.update(En=>{En.styles||(En.styles={}),En.styles.candle||(En.styles.candle={});const go=En.styles.candle;return go.renko||(go.renko={method:"ATR",atrLength:14,source:"close",wick:!1}),go.renko={...go.renko,...tn},En})}const zn=vt(()=>{var tn,En;return((En=(tn=o().styles)==null?void 0:tn.candle)==null?void 0:En.type)==="point_and_figure"});let un=ae("ATR"),On=ae(1),no=ae(14),fs=ae(3),ps=ae("#00E6D8"),So=ae("#FF4D4D");mr(()=>{var En,go;if(!a())return;const tn=((go=(En=o().styles)==null?void 0:En.candle)==null?void 0:go.pnf)||{};x(un,N(tn.boxSizeMode||"ATR")),x(On,N(Math.max(1e-4,tn.boxSize??1))),x(no,N(Math.max(1,Math.round(tn.atrLength??14)))),x(fs,N(Math.max(1,Math.round(tn.reversalBoxes??3)))),x(ps,N(tn.upColor||"#00E6D8")),x(So,N(tn.downColor||"#FF4D4D"))}),mr(()=>{a()&&(s(zn)?x(_,N(s(_)==="canvas"||s(_)==="other"?s(_):"pnf")):s(_)==="pnf"&&x(_,"candle"))});function Es(tn){c.update(En=>{En.styles||(En.styles={}),En.styles.candle||(En.styles.candle={});const go=En.styles.candle;return go.pnf||(go.pnf={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"}),go.pnf={...go.pnf,...tn},En})}let Qo=ae(N(Mn.get(o().styles,"backgroundGradient")||{type:"linear",direction:90,stops:[{position:0,color:"#1a1a1a",opacity:100},{position:100,color:"#4a4a4a",opacity:100}]})),Ko=ae(N(Mn.get(o().styles,"gridGradient")||{type:"linear",direction:90,stops:[{position:0,color:"#2a2a2a",opacity:100},{position:100,color:"#3a3a3a",opacity:100}]}));function oo(tn){if(!tn||!tn.stops)return"";const go=[...tn.stops].sort((hn,Ho)=>hn.position-Ho.position).map(hn=>{const Ho=parseInt(hn.color.slice(1,3),16),Eo=parseInt(hn.color.slice(3,5),16),di=parseInt(hn.color.slice(5,7),16),ns=hn.opacity/100;return`rgba(${Ho}, ${Eo}, ${di}, ${ns}) ${hn.position}%`});return tn.type==="linear"?`linear-gradient(${tn.direction}deg, ${go.join(", ")})`:`radial-gradient(circle, ${go.join(", ")})`}function Gs(tn){if(typeof tn=="string"&&tn.startsWith("rgba(")){const En=tn.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/);if(En){const go=parseInt(En[1]),hn=parseInt(En[2]),Ho=parseInt(En[3]);return`#${go.toString(16).padStart(2,"0")}${hn.toString(16).padStart(2,"0")}${Ho.toString(16).padStart(2,"0")}`}}return tn}function jo(){const tn=o().theme;return{backgroundColor:tn==="dark"?"#070211":"#ffffff",backgroundOpacity:100,gridColor:tn==="dark"?"#081115":"#F3F3F3",gridOpacity:100,xAxisTickTextColor:tn==="dark"?"#ffffff":"#000000",yAxisTickTextColor:tn==="dark"?"#ffffff":"#000000"}}mr(()=>{a()&&i()&&(console.log("📂 Modal opened - restoring saved values..."),x(Me,!0),w.clear(),fi(),queueMicrotask(()=>{x(Me,!1),console.log("✅ Restoration complete - preview enabled")}))}),mr(()=>{if(!i()||!a()||s(Me))return;const tn=s(Ye),En=s(Ge),go=s(Fe),hn=s(Qo);hn==null||hn.stops,hn==null||hn.type,hn==null||hn.direction;const Ho=document.querySelector(".kline-main"),Eo=document.querySelector(".kline-widget");if(go==="solid"){const di=w.get("backgroundColor")||En||jo().backgroundColor,$i=(w.get("backgroundOpacity")??tn??100)/100,hi=Dl(di,$i);[Ho,Eo].forEach(li=>{if(li){const ks=li;ks.style.removeProperty("background"),ks.style.removeProperty("background-color"),ks.offsetHeight,ks.style.setProperty("background",hi,"important"),ks.style.setProperty("background-color",hi,"important"),ks.style.setProperty("--chart-background-color",hi),ks.offsetHeight}})}else if(go==="gradient"){const di=w.get("backgroundGradient")||hn;let ns=di;(!di||!di.stops||di.stops.length===0)&&(ns={type:"linear",direction:90,stops:[{position:0,color:"#1a1a1a",opacity:100},{position:100,color:"#4a4a4a",opacity:100}]},w.set("backgroundGradient",ns));const $i=ns.css||oo(ns);[Ho,Eo].forEach(hi=>{if(hi){const li=hi;li.style.removeProperty("background"),li.style.removeProperty("background-color"),li.offsetHeight,li.style.setProperty("background",$i,"important"),li.style.setProperty("background-color",$i,"important"),li.style.setProperty("--chart-background-color",$i),li.offsetHeight}})}}),mr(()=>{var Ho,Eo,di,ns;if(!i()||!a()||s(Me))return;const tn=s(ct),En=s(it),go=s(Ze),hn=s(Ko);if(hn==null||hn.stops,hn==null||hn.type,hn==null||hn.direction,console.log("🔄 Grid effect triggered:",{gridColorType:go,gridColor:En,gridOpacity:tn}),go==="solid"){const $i=w.get("gridColor")||En||jo().gridColor,hi=w.get("gridOpacity")??tn??100,li=Dl($i,hi/100);console.log("🎨 Applying solid grid color via effect:",li);const ks=i().getStyles()??{},Vi=Mn.cloneDeep(ks);(Eo=(Ho=o().styles)==null?void 0:Ho.candle)!=null&&Eo.type&&Mn.set(Vi,"candle.type",o().styles.candle.type);const gs=Mn.get(ks,"grid.show",!0);Mn.set(Vi,"grid.show",gs),Mn.set(Vi,"grid.horizontal.show",gs),Mn.set(Vi,"grid.horizontal.color",li),Mn.set(Vi,"grid.vertical.show",gs),Mn.set(Vi,"grid.vertical.color",li),i().setStyles(Vi)}else if(go==="gradient"){const $i=w.get("gridGradient")||hn;if($i&&$i.stops&&$i.stops.length>0){const hi=$i.stops[0],li=$i.stops[$i.stops.length-1],ks=dd(hi.color,li.color,.5);console.log("🎨 Applying gradient grid color via effect:",ks);const Vi=i().getStyles()??{},gs=Mn.cloneDeep(Vi);(ns=(di=o().styles)==null?void 0:di.candle)!=null&&ns.type&&Mn.set(gs,"candle.type",o().styles.candle.type);const ll=Mn.get(Vi,"grid.show",!0);Mn.set(gs,"grid.show",ll),Mn.set(gs,"grid.horizontal.show",ll),Mn.set(gs,"grid.horizontal.color",ks),Mn.set(gs,"grid.vertical.show",ll),Mn.set(gs,"grid.vertical.color",ks),i().setStyles(gs)}}});function fi(){const tn=jo();console.log("🔄 Restoring saved values...",{backgroundType:Mn.get(o().styles,"backgroundType"),gridType:Mn.get(o().styles,"gridType")});const En=Mn.get(o().styles,"backgroundType")||"solid";if(x(Fe,N(En)),En==="solid"){const mi=Mn.get(o().styles,"backgroundColor")||tn.backgroundColor,Na=Mn.get(o().styles,"backgroundOpacity")||tn.backgroundOpacity,le=Gs(mi);x(Ge,N(le)),x(Ye,N(Na)),w.set("backgroundColor",le),w.set("backgroundOpacity",Na),console.log("✅ Restored solid BG:",le,"opacity:",Na)}else if(En==="gradient"){const mi=Mn.get(o().styles,"backgroundGradient");mi&&(x(Qo,N({...mi})),w.set("backgroundGradient",mi),console.log("✅ Restored gradient BG:",mi))}const go=Mn.get(o().styles,"gridType")||"solid";if(x(Ze,N(go)),go==="solid"){const mi=Mn.get(o().styles,"grid.horizontal.color")||Mn.get(o().styles,"grid.vertical.color")||tn.gridColor,Na=Mn.get(o().styles,"gridOpacity")||tn.gridOpacity,le=Gs(mi);x(it,N(le)),x(ct,N(Na)),w.set("gridColor",le),w.set("gridOpacity",Na),console.log("✅ Restored solid Grid:",le,"opacity:",Na)}else if(go==="gradient"){const mi=Mn.get(o().styles,"gridGradient");mi&&(x(Ko,N({...mi})),w.set("gridGradient",mi),console.log("✅ Restored gradient Grid:",mi))}const hn=Mn.get(o().styles,"xAxis.tickText.color")||tn.xAxisTickTextColor,Ho=Mn.get(o().styles,"xAxis.tickText.opacity")||100,Eo=Gs(hn);x(kt,N(Ho)),w.set("xAxisTickTextColor",Eo),w.set("xAxisTickTextOpacity",Ho);const di=Mn.get(o().styles,"yAxis.tickText.color")||tn.yAxisTickTextColor,ns=Mn.get(o().styles,"yAxis.tickText.opacity")||100,$i=Gs(di);x(ft,N(ns)),w.set("yAxisTickTextColor",$i),w.set("yAxisTickTextOpacity",ns);try{if(i()&&typeof i().getStyles=="function"){const mi=i().getStyles()??{},Na=Mn.get(mi,"xAxis.tickText.color"),le=Mn.get(mi,"yAxis.tickText.color");if(Na){const we=Gs(Na);w.set("xAxisTickTextColor",we)}if(le){const we=Gs(le);w.set("yAxisTickTextColor",we)}}}catch(mi){console.warn("Failed to read live axis styles from chart:",mi)}const hi=Mn.get(o().styles,"candle.bar.upColor")||"#26a69a",li=Mn.get(o().styles,"candle.bar.downColor")||"#ef5350",ks=Mn.get(o().styles,"candle.bar.upBorderColor")||"#26a69a",Vi=Mn.get(o().styles,"candle.bar.downBorderColor")||"#ef5350",gs=Mn.get(o().styles,"candle.bar.upWickColor")||"#26a69a",ll=Mn.get(o().styles,"candle.bar.downWickColor")||"#ef5350";x(xe,N(hi)),x(Ve,N(li)),x(Je,N(ks)),x(St,N(Vi)),x(Ne,N(gs)),x(ue,N(ll)),bt.forEach(mi=>{const Na=Mn.get(o().styles,mi.key);Na!==void 0?nt.set(mi.key,Na):nt.set(mi.key,mi.default)})}function ba(tn){if(x(Ge,N(tn.detail)),w.set("backgroundColor",tn.detail),s(Fe)==="solid"){const En=s(Ye)/100,go=Dl(tn.detail,En),hn=document.querySelector(".kline-main"),Ho=document.querySelector(".kline-widget");[hn,Ho].forEach(Eo=>{if(Eo){const di=Eo;di.style.removeProperty("background"),di.style.removeProperty("background-color"),di.style.removeProperty("background-image"),di.offsetHeight,di.style.setProperty("background",go,"important"),di.style.setProperty("background-color",go,"important"),di.style.setProperty("--chart-background-color",go),di.offsetHeight}})}}function xa(tn){if(x(Ye,N(tn.detail)),w.set("backgroundOpacity",tn.detail),s(Fe)==="solid"){const En=w.get("backgroundColor")||s(Ge)||jo().backgroundColor,go=tn.detail/100,hn=Dl(En,go),Ho=document.querySelector(".kline-main"),Eo=document.querySelector(".kline-widget");[Ho,Eo].forEach(di=>{if(di){const ns=di;ns.style.removeProperty("background"),ns.style.removeProperty("background-color"),ns.offsetHeight,ns.style.setProperty("background",hn,"important"),ns.style.setProperty("background-color",hn,"important"),ns.style.setProperty("--chart-background-color",hn),ns.offsetHeight}})}}function Al(tn){var Eo,di;if(console.log("🎨 Grid color changed to:",tn.detail),x(it,N(tn.detail)),w.set("gridColor",tn.detail),!i()){console.warn("⚠️ No chart available for grid color preview");return}const En=Dl(tn.detail,s(ct)/100);console.log("🎨 Applying grid color:",En);const go=i().getStyles()??{},hn=Mn.cloneDeep(go);(di=(Eo=o().styles)==null?void 0:Eo.candle)!=null&&di.type&&Mn.set(hn,"candle.type",o().styles.candle.type);const Ho=Mn.get(go,"grid.show",!0);Mn.set(hn,"grid.show",Ho),Mn.set(hn,"grid.horizontal.show",Ho),Mn.set(hn,"grid.horizontal.color",En),Mn.set(hn,"grid.vertical.show",Ho),Mn.set(hn,"grid.vertical.color",En),console.log("🎨 New grid styles:",hn.grid);try{i().setStyles(hn),console.log("✅ Grid styles applied successfully")}catch(ns){console.error("❌ Failed to apply grid styles:",ns)}}function Qs(tn){var di,ns;if(console.log("🎨 Grid opacity changed to:",tn.detail),x(ct,N(tn.detail)),w.set("gridOpacity",tn.detail),!i()){console.warn("⚠️ No chart available for grid opacity preview");return}const En=w.get("gridColor")||s(it)||jo().gridColor,go=Dl(En,tn.detail/100);console.log("🎨 Applying grid opacity:",go);const hn=i().getStyles()??{},Ho=Mn.cloneDeep(hn);(ns=(di=o().styles)==null?void 0:di.candle)!=null&&ns.type&&Mn.set(Ho,"candle.type",o().styles.candle.type);const Eo=Mn.get(hn,"grid.show",!0);Mn.set(Ho,"grid.show",Eo),Mn.set(Ho,"grid.horizontal.show",Eo),Mn.set(Ho,"grid.horizontal.color",go),Mn.set(Ho,"grid.vertical.show",Eo),Mn.set(Ho,"grid.vertical.color",go),console.log("🎨 New grid styles:",Ho.grid);try{i().setStyles(Ho),console.log("✅ Grid opacity applied successfully")}catch($i){console.error("❌ Failed to apply grid opacity:",$i)}}function Fs(tn){if(w.set("xAxisTickTextColor",tn.detail),i()){const En=i().getStyles()??{},go=Mn.cloneDeep(En);Mn.set(go,"xAxis.tickText.color",tn.detail);const hn=$d(go);i().setStyles(hn)}}function Va(tn){if(w.set("yAxisTickTextColor",tn.detail),i()){const En=i().getStyles()??{},go=Mn.cloneDeep(En);Mn.set(go,"yAxis.tickText.color",tn.detail);const hn=$d(go);i().setStyles(hn)}}function $r(tn){if(x(kt,N(tn.detail)),w.set("xAxisTickTextOpacity",tn.detail),i()){const En=i().getStyles()??{},go=Mn.cloneDeep(En),hn=w.get("xAxisTickTextColor")||jo().xAxisTickTextColor,Ho=tn.detail/100,Eo=Dl(hn,Ho);Mn.set(go,"xAxis.tickText.color",Eo);const di=$d(go);i().setStyles(di)}}function cd(tn){if(x(ft,N(tn.detail)),w.set("yAxisTickTextOpacity",tn.detail),i()){const En=i().getStyles()??{},go=Mn.cloneDeep(En),hn=w.get("yAxisTickTextColor")||jo().yAxisTickTextColor,Ho=tn.detail/100,Eo=Dl(hn,Ho);Mn.set(go,"yAxis.tickText.color",Eo);const di=$d(go);i().setStyles(di)}}function Sd(tn){if(x(Qo,N({...tn.detail})),w.set("backgroundGradient",s(Qo)),s(Fe)==="gradient"){const En=document.querySelector(".kline-main"),go=document.querySelector(".kline-widget"),hn=oo(s(Qo));[En,go].forEach(Ho=>{if(Ho){const Eo=Ho;Eo.style.removeProperty("background"),Eo.style.removeProperty("background-color"),Eo.offsetHeight,Eo.style.setProperty("background",hn,"important"),Eo.style.setProperty("background-color",hn,"important"),Eo.style.setProperty("--chart-background-color",hn),Eo.offsetHeight}})}}function Nl(tn){var En,go;if(x(Ko,N({...tn.detail})),w.set("gridGradient",s(Ko)),i()&&s(Ze)==="gradient"){const hn=tn.detail.stops[0],Ho=tn.detail.stops[tn.detail.stops.length-1],Eo=dd(hn.color,Ho.color,.5),di=i().getStyles()??{},ns=Mn.cloneDeep(di);(go=(En=o().styles)==null?void 0:En.candle)!=null&&go.type&&Mn.set(ns,"candle.type",o().styles.candle.type),Mn.set(ns,"grid.horizontal.color",Eo),Mn.set(ns,"grid.vertical.color",Eo);const $i=$d(ns);i().setStyles($i)}}function dd(tn,En,go){const hn=tn.replace("#",""),Ho=En.replace("#",""),Eo=parseInt(hn.substr(0,2),16),di=parseInt(hn.substr(2,2),16),ns=parseInt(hn.substr(4,2),16),$i=parseInt(Ho.substr(0,2),16),hi=parseInt(Ho.substr(2,2),16),li=parseInt(Ho.substr(4,2),16),ks=Math.round(Eo*(1-go)+$i*go),Vi=Math.round(di*(1-go)+hi*go),gs=Math.round(ns*(1-go)+li*go);return`#${ks.toString(16).padStart(2,"0")}${Vi.toString(16).padStart(2,"0")}${gs.toString(16).padStart(2,"0")}`}function Cd(tn,En){var di,ns,$i;const go=(di=i())==null?void 0:di.getStyles(),hn=Mn.get(go,tn);if(tn==="yAxis.reverse")try{(ns=i())==null||ns.setPaneOptions({axis:{reverse:En}}),c.update(hi=>(Mn.set(hi.styles,tn,En),hi)),nt.set(tn,En);return}catch(hi){console.warn("setPaneOptions not available, falling back to styles:",hi)}else if(tn==="yAxis.type"){console.warn("yAxis.type is not supported in klinecharts v10");return}if(hn==En)return;nt.set(tn,En),c.update(hi=>(Mn.set(hi.styles,tn,En),hi));const Ho=wu(o().theme),Eo=Mn.merge({},Ho,o().styles);($i=i())==null||$i.setStyles($d(Eo))}function fa(){let tn=i();if(!tn)return;const En=tn.getStyles()??{};bt.forEach(go=>{const hn=Mn.get(En,go.key);go.key==="yAxis.reverse"?nt.set(go.key,hn||!1):nt.set(go.key,hn??go.default)})}function Dl(tn,En){const go=tn.replace("#",""),hn=parseInt(go.substr(0,2),16),Ho=parseInt(go.substr(2,2),16),Eo=parseInt(go.substr(4,2),16);return`rgba(${hn}, ${Ho}, ${Eo}, ${En})`}function ml(){x(D,!1),x(R,!1),x(W,!1),x(J,!1),x(Z,!1),x(G,!1)}function gl(tn){x(xe,N(tn.detail)),Ec()}function _d(tn){x(Ve,N(tn.detail)),Ec()}function Kl(tn){x(Je,N(tn.detail)),Ec()}function ic(tn){x(St,N(tn.detail)),Ec()}function od(tn){x(Ne,N(tn.detail)),Ec()}function zd(tn){x(ue,N(tn.detail)),Ec()}function Ec(){h&&clearTimeout(h),h=setTimeout(()=>{var hn,Ho;if(!i())return;const tn=i().getStyles()??{},En=Mn.cloneDeep(tn);(Ho=(hn=o().styles)==null?void 0:hn.candle)!=null&&Ho.type&&Mn.set(En,"candle.type",o().styles.candle.type),s(Pt)&&(Mn.set(En,"candle.bar.upColor",s(xe)),Mn.set(En,"candle.bar.downColor",s(Ve))),s(Qe)&&(Mn.set(En,"candle.bar.upBorderColor",s(Je)),Mn.set(En,"candle.bar.downBorderColor",s(St))),s(yt)&&(Mn.set(En,"candle.bar.upWickColor",s(Ne)),Mn.set(En,"candle.bar.downWickColor",s(ue)));const go=$d(En);i().setStyles(go),h=null},16)}function al(tn){var En,go;if(tn==="confirm"){console.log("🔧 CONFIRM CLICKED - Using theme manager"),p.updatePending(hn=>{if(s(Fe)==="solid"){const Ho=w.get("backgroundColor")||s(Ge),Eo=w.get("backgroundOpacity")??s(Ye);hn.canvas.background.mode="solid",hn.canvas.background.solid={color:Ho,alpha:Eo/100},delete hn.canvas.background.gradient}else if(s(Fe)==="gradient"){const Ho=w.get("backgroundGradient")||s(Qo);hn.canvas.background.mode="gradient",hn.canvas.background.gradient=Ho,delete hn.canvas.background.solid}if(s(Ze)==="solid"){const Ho=w.get("gridColor")||s(it),Eo=w.get("gridOpacity")??s(ct);hn.canvas.grid.mode="solid",hn.canvas.grid.solid={color:Ho,alpha:Eo/100},delete hn.canvas.grid.gradient}else if(s(Ze)==="gradient"){const Ho=w.get("gridGradient")||s(Ko);hn.canvas.grid.mode="gradient",hn.canvas.grid.gradient=Ho,delete hn.canvas.grid.solid}}),c.update(hn=>{var Eo,di,ns,$i,hi,li;hn.styles||(hn.styles={}),hn.styles.candle||(hn.styles.candle={}),hn.styles.candle.bar||(hn.styles.candle.bar={}),console.log("🎨 Saving settings - Background Type:",s(Fe)),console.log("🎨 Saving settings - Grid Type:",s(Ze));const Ho=(di=(Eo=hn.styles)==null?void 0:Eo.candle)==null?void 0:di.type;if(Ho&&console.log("🔒 Preserving chart type:",Ho),s(Fe)==="solid"){const ks=w.get("backgroundColor")||s(Ge),Vi=w.get("backgroundOpacity")??s(Ye);console.log("🎨 Solid BG:",{bgColor:ks,bgOpacity:Vi}),ks&&(hn.styles.backgroundColor=ks,hn.styles.backgroundOpacity=Vi,hn.styles.backgroundType="solid",delete hn.styles.backgroundGradient)}else if(s(Fe)==="gradient"){const ks=w.get("backgroundGradient")||s(Qo);console.log("🎨 Gradient BG:",ks),ks&&ks.stops&&ks.stops.length>0?(hn.styles.backgroundGradient=ks,hn.styles.backgroundType="gradient",delete hn.styles.backgroundColor,delete hn.styles.backgroundOpacity,console.log("✅ Gradient background saved to $save.styles")):console.warn("⚠️ Invalid gradient data:",ks)}if(s(Ze)==="solid"){const ks=w.get("gridColor")||s(it),Vi=w.get("gridOpacity")??100;console.log("🎨 Solid Grid:",{gridColor:ks,gridOpacity:Vi}),ks&&(hn.styles.grid||(hn.styles.grid={}),hn.styles.grid.horizontal||(hn.styles.grid.horizontal={}),hn.styles.grid.vertical||(hn.styles.grid.vertical={}),hn.styles.grid.horizontal.color=ks,hn.styles.grid.vertical.color=ks,hn.styles.gridOpacity=Vi,hn.styles.gridType="solid",delete hn.styles.gridGradient)}else if(s(Ze)==="gradient"){const ks=w.get("gridGradient")||s(Ko);console.log("🎨 Gradient Grid:",ks),ks&&ks.stops&&ks.stops.length>0?(hn.styles.gridGradient=ks,hn.styles.gridType="gradient",($i=(ns=hn.styles.grid)==null?void 0:ns.horizontal)==null||delete $i.color,(li=(hi=hn.styles.grid)==null?void 0:hi.vertical)==null||delete li.color,delete hn.styles.gridOpacity,console.log("✅ Gradient grid saved to $save.styles")):console.warn("⚠️ Invalid grid gradient data:",ks)}try{const ks=w.get("xAxisTickTextColor")||jo().xAxisTickTextColor,Vi=w.get("xAxisTickTextOpacity")??100,gs=Dl(ks,Vi/100);Mn.set(hn.styles,"xAxis.tickText.color",gs),Mn.set(hn.styles,"xAxis.tickText.opacity",Vi);const ll=w.get("yAxisTickTextColor")||jo().yAxisTickTextColor,mi=w.get("yAxisTickTextOpacity")??100,Na=Dl(ll,mi/100);Mn.set(hn.styles,"yAxis.tickText.color",Na),Mn.set(hn.styles,"yAxis.tickText.opacity",mi)}catch(ks){console.warn("Failed to persist axis tick text colors:",ks)}try{const ks=hn.styles.candle.bar;s(Pt)&&(ks.upColor=s(xe),ks.downColor=s(Ve)),s(Qe)&&(ks.upBorderColor=s(Je),ks.downBorderColor=s(St)),s(yt)&&(ks.upWickColor=s(Ne),ks.downWickColor=s(ue))}catch(ks){console.warn("Failed to persist candle colors to $save.styles:",ks)}return Ho&&hn.styles.candle&&(hn.styles.candle.type=Ho,console.log("✅ Restored chart type:",Ho)),hn}),p.confirm(),x(m,!0);try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors(),a(!1)}else if(tn==="reset"){console.log("🔄 RESET CLICKED - Using theme manager"),p.reset();const hn=jo();x(Fe,"solid"),x(Ye,N(hn.backgroundOpacity)),x(Ze,"solid"),x(ct,N(hn.gridOpacity)),x(kt,100),x(ft,100),x(Pt,!0),x(Qe,!0),x(yt,!0),x(xe,"#26a69a"),x(Ve,"#ef5350"),x(Je,"#26a69a"),x(St,"#ef5350"),x(Ne,"#26a69a"),x(ue,"#ef5350");try{const Ho=jo();if(c.update(Eo=>{Eo.styles||(Eo.styles={}),Eo.styles.backgroundType="solid",Eo.styles.backgroundColor=Ho.backgroundColor,Eo.styles.backgroundOpacity=Ho.backgroundOpacity,delete Eo.styles.backgroundGradient,Eo.styles.grid||(Eo.styles.grid={}),Eo.styles.grid.horizontal||(Eo.styles.grid.horizontal={}),Eo.styles.grid.vertical||(Eo.styles.grid.vertical={}),Eo.styles.gridType="solid",Eo.styles.gridOpacity=Ho.gridOpacity,Eo.styles.grid.horizontal.color=Ho.gridColor,Eo.styles.grid.vertical.color=Ho.gridColor,delete Eo.styles.gridGradient;const di=Ho.xAxisTickTextColor,ns=Ho.yAxisTickTextColor,$i=Dl(di,1),hi=Dl(ns,1);Mn.set(Eo.styles,"xAxis.tickText.color",$i),Mn.set(Eo.styles,"xAxis.tickText.opacity",100),Mn.set(Eo.styles,"yAxis.tickText.color",hi),Mn.set(Eo.styles,"yAxis.tickText.opacity",100),Eo.styles.candle||(Eo.styles.candle={}),Eo.styles.candle.bar||(Eo.styles.candle.bar={});const li=Eo.styles.candle.bar;return li.upColor=s(xe),li.downColor=s(Ve),li.upBorderColor=s(Je),li.downBorderColor=s(St),li.upWickColor=s(Ne),li.downWickColor=s(ue),Eo}),i()){const Eo=wu(o().theme),di=Mn.merge({},Eo,o().styles);(go=(En=o().styles)==null?void 0:En.candle)!=null&&go.type&&Mn.set(di,"candle.type",o().styles.candle.type);const ns=jo().xAxisTickTextColor,$i=jo().yAxisTickTextColor,hi=Dl(ns,1),li=Dl($i,1);Mn.set(di,"xAxis.tickText.color",hi),Mn.set(di,"yAxis.tickText.color",li);const ks=$d(di);i().setStyles(ks);try{const Vi=document.querySelector(".kline-main"),gs=document.querySelector(".kline-widget");[Vi,gs].forEach(ll=>{if(ll){const mi=ll;mi.style.removeProperty("background"),mi.style.removeProperty("background-color"),mi.style.removeProperty("background-image"),mi.style.removeProperty("--chart-background-color")}})}catch{}try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors()}}catch(Ho){console.warn("Failed to apply default candle colors on reset:",Ho)}fa(),w.clear(),w.set("backgroundColor",hn.backgroundColor),w.set("backgroundOpacity",hn.backgroundOpacity),w.set("gridColor",hn.gridColor),w.set("gridOpacity",hn.gridOpacity),w.set("xAxisTickTextColor",hn.xAxisTickTextColor),w.set("xAxisTickTextOpacity",100),w.set("yAxisTickTextColor",hn.yAxisTickTextColor),w.set("yAxisTickTextOpacity",100)}else console.log("🚫 CANCEL CLICKED - Using theme manager"),p.cancel(),a(!1);x(S,!1),x(P,!1),x(I,!1),x(C,!1),x(K,!1),x(ye,!1),ml()}var kc=AB(),Vd=Dt(kc);vf(Vd,{title:"Chart Setting",width:"min(90vw, 700px)",get show(){return a()},set show(tn){a(tn)},get theme(){return o().theme},click:al,buttons:["confirm","reset"],children:(tn,En)=>{var go=MB(),hn=g(go),Ho=g(hn),Eo=g(Ho);Eo.__click=[lB,_];var di=u(Eo,2);di.__click=[cB,_];var ns=u(di,2);ns.__click=[dB,_];var $i=u(ns,2);Te($i,()=>s(he),Vi=>{var gs=pB();gs.__click=[uB,_],Se(()=>{Fi(gs,"bg-primary",s(_)==="renko"),Fi(gs,"text-primary-content",s(_)==="renko"),Fi(gs,"hover:bg-base-200",s(_)!=="renko")}),z(Vi,gs)});var hi=u($i,2);Te(hi,()=>s(zn),Vi=>{var gs=fB();gs.__click=[vB,_],Se(()=>{Fi(gs,"bg-primary",s(_)==="pnf"),Fi(gs,"text-primary-content",s(_)==="pnf"),Fi(gs,"hover:bg-base-200",s(_)!=="pnf")}),z(Vi,gs)}),f(Ho),f(hn);var li=u(hn,2),ks=g(li);Te(ks,()=>s(_)==="canvas",Vi=>{var gs=mB(),ll=u(g(gs),2),mi=u(g(ll),2),Na=g(mi),le=g(Na);le.value=(le.__value="solid")==null?"":"solid";var we=u(le);we.value=(we.__value="gradient")==null?"":"gradient",f(Na);var H=u(Na,2);const ne=vt(()=>{var qt;return`background: ${(s(Fe)==="gradient"?((qt=w.get("backgroundGradient"))==null?void 0:qt.css)||oo(s(Qo))||"linear-gradient(0deg, #ffffff 0%, #000000 100%)":w.get("backgroundColor")||jo().backgroundColor)??""}`});H.__click=[KR,Fe,M,S,P,K,ye,I,C,ml],f(mi),f(ll);var _e=u(ll,2),q=u(g(_e),2),De=g(q),ot=g(De);ot.value=(ot.__value="solid")==null?"":"solid";var je=u(ot);je.value=(je.__value="gradient")==null?"":"gradient",f(De);var Ft=u(De,2);const Be=vt(()=>{var qt;return`background: ${(s(Ze)==="gradient"?((qt=w.get("gridGradient"))==null?void 0:qt.css)||oo(s(Ko))||"linear-gradient(0deg, #f3f3f3 0%, #1c1c1c 100%)":w.get("gridColor")||s(it)||jo().gridColor)??""}`});Ft.__click=[ZR,Ze,F,P,S,K,ye,I,C],f(q),f(_e);var xt=u(_e,2),an=u(g(xt),2),Yn=g(an);const bn=vt(()=>`background: ${(w.get("xAxisTickTextColor")||jo().xAxisTickTextColor)??""}`);Yn.__click=[XR,V,I,S,P,K,ye,C,ml],f(an),f(xt);var be=u(xt,2),tt=u(g(be),2),wt=g(tt);const Lt=vt(()=>`background: ${(w.get("yAxisTickTextColor")||jo().yAxisTickTextColor)??""}`);wt.__click=[JR,j,C,S,P,K,ye,I,ml],f(tt),f(be),f(gs),Se(()=>{zt(H,"style",s(ne)),zt(Ft,"style",s(Be)),zt(Yn,"style",s(bn)),zt(wt,"style",s(Lt))}),qo(Na,()=>s(Fe),qt=>x(Fe,qt)),qo(De,()=>s(Ze),qt=>x(Ze,qt)),z(Vi,gs)},Vi=>{var gs=Ln(),ll=Dt(gs);Te(ll,()=>s(_)==="other",mi=>{var Na=wB(),le=u(g(Na),2);vs(le,21,()=>bt,Vs,(we,H)=>{var ne=xB(),_e=g(ne),q=g(_e,!0);f(_e);var De=u(_e,2);Te(De,()=>s(H).type==="select",ot=>{var je=_B();_g(je,()=>nt.get(s(H).key)??s(H).default);var Ft;je.__change=[gB,Cd,H],vs(je,21,()=>s(H).options||[],Vs,(Be,xt)=>{var an=hB(),Yn={},bn=g(an,!0);f(an),Se(()=>{Yn!==(Yn=s(xt).value)&&(an.value=(an.__value=s(xt).value)==null?"":s(xt).value),ze(bn,s(xt).label)}),z(Be,an)}),f(je),Se(()=>{Ft!==(Ft=nt.get(s(H).key)??s(H).default)&&(je.value=(je.__value=nt.get(s(H).key)??s(H).default)==null?"":nt.get(s(H).key)??s(H).default,Am(je,nt.get(s(H).key)??s(H).default))}),z(ot,je)},ot=>{var je=Ln(),Ft=Dt(je);Te(Ft,()=>s(H).type==="switch",Be=>{var xt=bB();Qt(xt),Se(()=>Qv(xt,nt.get(s(H).key)??s(H).default)),xt.__change=[yB,Cd,H],z(Be,xt)},null,!0),z(ot,je)}),f(ne),Se(()=>ze(q,s(H).label)),z(we,ne)}),f(le),f(Na),z(mi,Na)},mi=>{var Na=Ln(),le=Dt(Na);Te(le,()=>s(_)==="candle",we=>{var H=kB(),ne=u(g(H),2),_e=g(ne),q=g(_e),De=g(q);Qt(De),De.__change=[iB,Pt,Ec],ai(2),f(q);var ot=u(q,2),je=g(ot),Ft=u(g(je),2);Ft.__click=[QR,se,S,P,I,C,K,ye,ml,D],f(je);var Be=u(je,2),xt=u(g(Be),2);xt.__click=[eB,Y,S,P,I,C,K,ye,ml,R],f(Be),f(ot),f(_e);var an=u(_e,2),Yn=g(an),bn=g(Yn);Qt(bn),bn.__change=[rB,Qe,Ec],ai(2),f(Yn);var be=u(Yn,2),tt=g(be),wt=u(g(tt),2);wt.__click=[tB,oe,S,P,I,C,K,ye,ml,W],f(tt);var Lt=u(tt,2),qt=u(g(Lt),2);qt.__click=[nB,ee,S,P,I,C,K,ye,ml,J],f(Lt),f(be),f(an);var qn=u(an,2),Xt=g(qn),vo=g(Xt);Qt(vo),vo.__change=[aB,yt,Ec],ai(2),f(Xt);var To=u(Xt,2),co=g(To),so=u(g(co),2);so.__click=[oB,re,S,P,I,C,K,ye,ml,Z],f(co);var Jo=u(co,2),Os=u(g(Jo),2);Os.__click=[sB,me,S,P,I,C,K,ye,ml,G],f(Jo),f(To),f(qn),f(ne),f(H),Se(()=>{zt(Ft,"style",`background-color: ${s(xe)??""}`),Ft.disabled=!s(Pt),Fi(Ft,"opacity-50",!s(Pt)),zt(xt,"style",`background-color: ${s(Ve)??""}`),xt.disabled=!s(Pt),Fi(xt,"opacity-50",!s(Pt)),zt(wt,"style",`background-color: ${s(Je)??""}`),wt.disabled=!s(Qe),Fi(wt,"opacity-50",!s(Qe)),zt(qt,"style",`background-color: ${s(St)??""}`),qt.disabled=!s(Qe),Fi(qt,"opacity-50",!s(Qe)),zt(so,"style",`background-color: ${s(Ne)??""}`),so.disabled=!s(yt),Fi(so,"opacity-50",!s(yt)),zt(Os,"style",`background-color: ${s(ue)??""}`),Os.disabled=!s(yt),Fi(Os,"opacity-50",!s(yt))}),zf(De,()=>s(Pt),wr=>x(Pt,wr)),zf(bn,()=>s(Qe),wr=>x(Qe,wr)),zf(vo,()=>s(yt),wr=>x(yt,wr)),z(we,H)},we=>{var H=Ln(),ne=Dt(H);Te(ne,()=>s(_)==="renko",_e=>{var q=SB(),De=u(g(q),2),ot=g(De),je=g(ot),Ft=g(je);Qt(Ft),Ft.__change=[RR,_t,dn],ai(2),f(je),f(ot);var Be=u(ot,2),xt=g(Be),an=u(g(xt),2);an.__change=[BR,Wt,dn];var Yn=g(an);Yn.value=(Yn.__value="close")==null?"":"close";var bn=u(Yn);bn.value=(bn.__value="open")==null?"":"open";var be=u(bn);be.value=(be.__value="high")==null?"":"high";var tt=u(be);tt.value=(tt.__value="low")==null?"":"low",f(an),f(xt);var wt=u(xt,2),Lt=u(g(wt),2);Lt.__change=[OR,jt,dn];var qt=g(Lt);qt.value=(qt.__value="ATR")==null?"":"ATR",f(Lt),f(wt);var qn=u(wt,2),Xt=u(g(qn),2);Qt(Xt),Xt.__input=[zR,Zt,dn],f(qn),f(Be),f(De),f(q),Se(()=>{Qv(Ft,s(_t)),Jd(Xt,s(Zt))}),qo(an,()=>s(Wt),vo=>x(Wt,vo)),qo(Lt,()=>s(jt),vo=>x(jt,vo)),z(_e,q)},_e=>{var q=Ln(),De=Dt(q);Te(De,()=>s(_)==="pnf",ot=>{var je=IB(),Ft=u(g(je),2),Be=g(Ft),xt=g(Be),an=u(g(xt),2);an.__change=[VR,un,Es];var Yn=g(an);Yn.value=(Yn.__value="ATR")==null?"":"ATR";var bn=u(Yn);bn.value=(bn.__value="absolute")==null?"":"absolute";var be=u(bn);be.value=(be.__value="percent")==null?"":"percent",f(an),f(xt);var tt=u(xt,2);Te(tt,()=>s(un)==="ATR",qr=>{var Ga=CB(),Ki=u(g(Ga),2);Qt(Ki),Ki.__input=[qR,no,Es],f(Ga),Se(()=>Jd(Ki,s(no))),z(qr,Ga)},qr=>{var Ga=PB(),Ki=g(Ga),Zl=g(Ki);f(Ki);var Tl=u(Ki,2);Qt(Tl),Tl.__input=[WR,On,Es],f(Ga),Se(()=>{ze(Zl,`Box Size ${(s(un)==="percent"?"(%)":"(Price)")??""}`),Jd(Tl,s(On))}),z(qr,Ga)}),f(Be);var wt=u(Be,2),Lt=u(g(wt),2);Qt(Lt),Lt.__input=[HR,fs,Es],f(wt);var qt=u(wt,2),qn=u(g(qt),2),Xt=g(qn),vo=u(g(Xt),2),To=g(vo);Qt(To),To.__input=[UR,ps,Es];var co=u(To,2),so=g(co,!0);f(co),f(vo),f(Xt);var Jo=u(Xt,2),Os=u(g(Jo),2),wr=g(Os);Qt(wr),wr.__input=[GR,So,Es];var ra=u(wr,2),Qr=g(ra,!0);f(ra),f(Os),f(Jo),f(qn),f(qt);var hl=u(qt,2),lc=g(hl);lc.__click=[YR,un,On,no,fs,ps,So,Es],f(hl),f(Ft),f(je),Se(()=>{Jd(Lt,s(fs)),ze(so,s(ps)),ze(Qr,s(So))}),qo(an,()=>s(un),qr=>x(un,qr)),po(To,()=>s(ps),qr=>x(ps,qr)),po(wr,()=>s(So),qr=>x(So,qr)),z(ot,je)},null,!0),z(_e,q)},!0),z(we,H)},!0),z(mi,Na)},!0),z(Vi,gs)}),f(li),f(go),Se(()=>{Fi(Eo,"bg-primary",s(_)==="canvas"),Fi(Eo,"text-primary-content",s(_)==="canvas"),Fi(Eo,"hover:bg-base-200",s(_)!=="canvas"),Fi(di,"bg-primary",s(_)==="other"),Fi(di,"text-primary-content",s(_)==="other"),Fi(di,"hover:bg-base-200",s(_)!=="other"),Fi(ns,"bg-primary",s(_)==="candle"),Fi(ns,"text-primary-content",s(_)==="candle"),Fi(ns,"hover:bg-base-200",s(_)!=="candle")}),z(tn,go)},$$slots:{default:!0}});var sd=u(Vd,2);Te(sd,()=>s(S),tn=>{var En=vt(()=>w.get("backgroundColor")||jo().backgroundColor);Pf(tn,{get show(){return s(S)},set show(go){x(S,N(go))},get selectedColor(){return s(En)},get opacity(){return s(Ye)},$$events:{colorChange:ba,opacityChange:xa}})});var id=u(sd,2);Te(id,()=>s(P),tn=>{var En=vt(()=>w.get("gridColor")||s(it)||jo().gridColor);Pf(tn,{get show(){return s(P)},set show(go){x(P,N(go))},get selectedColor(){return s(En)},get opacity(){return s(ct)},$$events:{colorChange:Al,opacityChange:Qs}})});var Pd=u(id,2);Te(Pd,()=>s(I),tn=>{var En=vt(()=>w.get("xAxisTickTextColor")||jo().xAxisTickTextColor);Pf(tn,{get show(){return s(I)},set show(go){x(I,N(go))},get selectedColor(){return s(En)},get opacity(){return s(kt)},$$events:{colorChange:Fs,opacityChange:$r}})});var Ed=u(Pd,2);Te(Ed,()=>s(C),tn=>{var En=vt(()=>w.get("yAxisTickTextColor")||jo().yAxisTickTextColor);Pf(tn,{get show(){return s(C)},set show(go){x(C,N(go))},get selectedColor(){return s(En)},get opacity(){return s(ft)},$$events:{colorChange:Va,opacityChange:cd}})});var zl=u(Ed,2);Te(zl,()=>s(D),tn=>{Pf(tn,{get show(){return s(D)},set show(En){x(D,N(En))},get selectedColor(){return s(xe)},$$events:{colorChange:gl}})});var Gd=u(zl,2);Te(Gd,()=>s(R),tn=>{Pf(tn,{get show(){return s(R)},set show(En){x(R,N(En))},get selectedColor(){return s(Ve)},$$events:{colorChange:_d}})});var lu=u(Gd,2);Te(lu,()=>s(W),tn=>{Pf(tn,{get show(){return s(W)},set show(En){x(W,N(En))},get selectedColor(){return s(Je)},$$events:{colorChange:Kl}})});var Yd=u(lu,2);Te(Yd,()=>s(J),tn=>{Pf(tn,{get show(){return s(J)},set show(En){x(J,N(En))},get selectedColor(){return s(St)},$$events:{colorChange:ic}})});var eu=u(Yd,2);Te(eu,()=>s(Z),tn=>{Pf(tn,{get show(){return s(Z)},set show(En){x(Z,N(En))},get selectedColor(){return s(Ne)},$$events:{colorChange:od}})});var Ju=u(eu,2);Te(Ju,()=>s(G),tn=>{Pf(tn,{get show(){return s(G)},set show(En){x(G,N(En))},get selectedColor(){return s(ue)},$$events:{colorChange:zd}})});var mu=u(Ju,2);Te(mu,()=>s(K),tn=>{Db(tn,{get show(){return s(K)},set show(En){x(K,N(En))},get initialGradient(){return s(Qo)},$$events:{gradientChange:Sd}})});var yd=u(mu,2);Te(yd,()=>s(ye),tn=>{Db(tn,{get show(){return s(ye)},set show(En){x(ye,N(En))},get initialGradient(){return s(Ko)},$$events:{gradientChange:Nl}})}),z(n,kc),hd()}qu(["click","change","input"]);var TB=(n,e,t)=>e(s(t).key,n.currentTarget.value),LB=fe("<option> </option>"),FB=fe('<select class="select select-bordered select-sm w-full"></select>'),$B=(n,e,t)=>e(s(t).key,n.currentTarget.checked),EB=fe('<input type="checkbox" class="toggle toggle-sm">'),NB=fe('<span class="text-base-content/70 text-right"> </span> <!>',1),DB=(n,e)=>x(e,!0),jB=fe('<div class="grid grid-cols-[3fr_2fr_3fr_2fr] gap-5 mx-7 my-5 items-center"><!> <div class="col-span-4 mt-4 pt-4 border-t border-base-300"><button class="btn btn-outline btn-primary w-full">Chart Setting</button></div></div>'),RB=fe("<!> <!>",1);function BB(n,e){gd(e,!0);const t=wp(),o=()=>ya(d,"$chart",t),i=()=>ya(c,"$save",t);let r=Ws(e,"show",15);const a=new e0,l=Kc("ctx"),c=Kc("save"),d=Kc("chart");let p=ae(!1);const m=[{key:"candle.priceMark.last.show",text:"last_price_show",component:"switch"},{key:"candle.priceMark.high.show",text:"high_price_show",component:"switch"},{key:"candle.priceMark.low.show",text:"low_price_show",component:"switch"},{key:"indicator.lastValueMark.show",text:"indicator_last_value_show",component:"switch"},{key:"yAxis.reverse",text:"reverse_coordinate",component:"switch"},{key:"grid.show",text:"grid_show",component:"switch"}];function h(F,V){var J,Z,G,se,Y,oe,ee,re,me,K,ye,Me,Fe,Ze,Ge,it,Ye,ct,kt,ft,bt,nt,Pt,Qe,yt,xe,Ve;const j=(J=o())==null?void 0:J.getStyles(),D=Mn.get(j,F);if(F==="yAxis.reverse")try{(Z=o())==null||Z.setPaneOptions({axis:{reverse:V}}),c.update(Je=>(Mn.set(Je.styles,F,V),Je)),a.set(F,V);return}catch(Je){console.warn("setPaneOptions not available, falling back to styles:",Je)}if(D==V)return;a.set(F,V),c.update(Je=>(Mn.set(Je.styles,F,V),Je));const R=wu(i().theme);console.log("🟡 Settings.update key:",F,"value:",V,"theme:",i().theme),console.log("🎨 theme axis colors:",(Y=(se=(G=R==null?void 0:R.xAxis)==null?void 0:G.tickText)==null?void 0:se.style)==null?void 0:Y.color,(re=(ee=(oe=R==null?void 0:R.yAxis)==null?void 0:oe.tickText)==null?void 0:ee.style)==null?void 0:re.color),console.log("💾 saved axis colors:",Mn.get(i().styles,"xAxis.tickText.style.color"),Mn.get(i().styles,"yAxis.tickText.style.color"));const W=Mn.merge({},R,i().styles);try{const Je=(ye=(K=(me=R==null?void 0:R.xAxis)==null?void 0:me.tickText)==null?void 0:K.style)==null?void 0:ye.color,St=(Ze=(Fe=(Me=R==null?void 0:R.yAxis)==null?void 0:Me.tickText)==null?void 0:Fe.style)==null?void 0:Ze.color;Je&&((it=(Ge=W==null?void 0:W.xAxis)==null?void 0:Ge.tickText)!=null&&it.style)&&(W.xAxis.tickText.style.color=Je,(Ye=W==null?void 0:W.xAxis)!=null&&Ye.tickText&&(delete W.xAxis.tickText.color,delete W.xAxis.tickText.opacity)),St&&((kt=(ct=W==null?void 0:W.yAxis)==null?void 0:ct.tickText)!=null&&kt.style)&&(W.yAxis.tickText.style.color=St,(ft=W==null?void 0:W.yAxis)!=null&&ft.tickText&&(delete W.yAxis.tickText.color,delete W.yAxis.tickText.opacity))}catch{}console.log("🔄 merged axis colors before apply:",(Pt=(nt=(bt=W==null?void 0:W.xAxis)==null?void 0:bt.tickText)==null?void 0:nt.style)==null?void 0:Pt.color,(xe=(yt=(Qe=W==null?void 0:W.yAxis)==null?void 0:Qe.tickText)==null?void 0:yt.style)==null?void 0:xe.color),(Ve=o())==null||Ve.setStyles($d(W)),setTimeout(()=>{var ue,he,_t,Wt,jt,Zt,dn,zn,un,On,no;const Je=((ue=o())==null?void 0:ue.getStyles())||{},St=((Wt=(_t=(he=Je==null?void 0:Je.xAxis)==null?void 0:he.tickText)==null?void 0:_t.style)==null?void 0:Wt.color)??((Zt=(jt=Je==null?void 0:Je.xAxis)==null?void 0:jt.tickText)==null?void 0:Zt.color),Ne=((un=(zn=(dn=Je==null?void 0:Je.yAxis)==null?void 0:dn.tickText)==null?void 0:zn.style)==null?void 0:un.color)??((no=(On=Je==null?void 0:Je.yAxis)==null?void 0:On.tickText)==null?void 0:no.color);console.log("✅ chart axis colors after apply:",St,Ne)},0)}function _(F){var V,j,D,R,W,J,Z,G,se,Y,oe,ee,re,me,K,ye,Me,Fe,Ze,Ge,it,Ye,ct,kt,ft,bt,nt;if(F==="reset"){const Pt=(j=(V=i().styles)==null?void 0:V.candle)==null?void 0:j.type,Qe=wu(i().theme),yt=i().styles;m.forEach(Ve=>{Mn.unset(yt,Ve.key)}),c.update(Ve=>(Ve.styles=yt,Pt&&(Ve.styles.candle||(Ve.styles.candle={}),Ve.styles.candle.type=Pt),Ve));const xe=Mn.merge({},Qe,i().styles);console.log("🟠 Settings.reset theme:",i().theme),console.log("🎨 default axis colors:",(W=(R=(D=Qe==null?void 0:Qe.xAxis)==null?void 0:D.tickText)==null?void 0:R.style)==null?void 0:W.color,(G=(Z=(J=Qe==null?void 0:Qe.yAxis)==null?void 0:J.tickText)==null?void 0:Z.style)==null?void 0:G.color);try{const Ve=(oe=(Y=(se=Qe==null?void 0:Qe.xAxis)==null?void 0:se.tickText)==null?void 0:Y.style)==null?void 0:oe.color,Je=(me=(re=(ee=Qe==null?void 0:Qe.yAxis)==null?void 0:ee.tickText)==null?void 0:re.style)==null?void 0:me.color;Ve&&((ye=(K=xe==null?void 0:xe.xAxis)==null?void 0:K.tickText)!=null&&ye.style)&&(xe.xAxis.tickText.style.color=Ve,(Me=xe==null?void 0:xe.xAxis)!=null&&Me.tickText&&(delete xe.xAxis.tickText.color,delete xe.xAxis.tickText.opacity)),Je&&((Ze=(Fe=xe==null?void 0:xe.yAxis)==null?void 0:Fe.tickText)!=null&&Ze.style)&&(xe.yAxis.tickText.style.color=Je,(Ge=xe==null?void 0:xe.yAxis)!=null&&Ge.tickText&&(delete xe.yAxis.tickText.color,delete xe.yAxis.tickText.opacity))}catch{}console.log("🔄 merged axis colors on reset:",(ct=(Ye=(it=xe==null?void 0:xe.xAxis)==null?void 0:it.tickText)==null?void 0:Ye.style)==null?void 0:ct.color,(bt=(ft=(kt=xe==null?void 0:xe.yAxis)==null?void 0:kt.tickText)==null?void 0:ft.style)==null?void 0:bt.color),(nt=o())==null||nt.setStyles($d(xe)),setTimeout(()=>{var Ne,ue,he,_t,Wt,jt,Zt,dn,zn,un,On;const Ve=((Ne=o())==null?void 0:Ne.getStyles())||{},Je=((_t=(he=(ue=Ve==null?void 0:Ve.xAxis)==null?void 0:ue.tickText)==null?void 0:he.style)==null?void 0:_t.color)??((jt=(Wt=Ve==null?void 0:Ve.xAxis)==null?void 0:Wt.tickText)==null?void 0:jt.color),St=((zn=(dn=(Zt=Ve==null?void 0:Ve.yAxis)==null?void 0:Zt.tickText)==null?void 0:dn.style)==null?void 0:zn.color)??((On=(un=Ve==null?void 0:Ve.yAxis)==null?void 0:un.tickText)==null?void 0:On.color);console.log("✅ chart axis colors after reset apply:",Je,St)},0),w()}else r(!1)}function w(){let F=o();if(!F)return;const V=F.getStyles()??{};m.forEach(j=>{const D=Mn.get(V,j.key);j.key==="yAxis.reverse"?a.set(j.key,D||!1):a.set(j.key,D)})}Lu(l,F=>F.initDone).subscribe(w),mr(()=>{r()&&o()&&w()});var P=RB(),I=Dt(P),C=vt(()=>Px());vf(I,{get title(){return s(C)},width:760,get show(){return r()},set show(F){r(F)},get theme(){return i().theme},click:_,buttons:["confirm","reset"],children:(F,V)=>{var j=jB(),D=g(j);vs(D,17,()=>m,Vs,(J,Z)=>{var G=NB(),se=Dt(G),Y=g(se,!0);Se(()=>{var ee;return ze(Y,(ee=Vf[s(Z).text])==null?void 0:ee.call(Vf))}),f(se);var oe=u(se,2);Te(oe,()=>s(Z).component==="select",ee=>{var re=FB();_g(re,()=>a.get(s(Z).key));var me;re.__change=[TB,h,Z],vs(re,21,()=>s(Z).dataSource||[],Vs,(K,ye)=>{var Me=LB(),Fe={},Ze=g(Me,!0);Se(()=>{var Ge;return ze(Ze,((Ge=Vf[s(ye).text])==null?void 0:Ge.call(Vf))||s(ye).text)}),f(Me),Se(()=>{Fe!==(Fe=s(ye).key)&&(Me.value=(Me.__value=s(ye).key)==null?"":s(ye).key)}),z(K,Me)}),f(re),Se(()=>{me!==(me=a.get(s(Z).key))&&(re.value=(re.__value=a.get(s(Z).key))==null?"":a.get(s(Z).key),Am(re,a.get(s(Z).key)))}),z(ee,re)},ee=>{var re=Ln(),me=Dt(re);Te(me,()=>s(Z).component==="switch",K=>{var ye=EB();Qt(ye),Se(()=>Qv(ye,!!a.get(s(Z).key))),ye.__change=[$B,h,Z],z(K,ye)},null,!0),z(ee,re)}),z(J,G)});var R=u(D,2),W=g(R);W.__click=[DB,p],f(R),f(j),z(F,j)},$$slots:{default:!0}});var M=u(I,2);Uw(M,{get show(){return s(p)},set show(F){x(p,N(F))}}),z(n,P),hd()}qu(["change","click"]);var OB=fe('<img alt="screenshot" class="w-[500px] mt-5">');function zB(n,e){gd(e,!0);const t=wp(),o=()=>ya(r,"$save",t);let i=Ws(e,"show",15);const r=Kc("save");function a(l){if(l==="confirm"){const c=document.createElement("a");c.download="screenshot",c.href=e.url,document.body.appendChild(c),c.click(),c.remove()}i(!1)}vf(n,{title:"Screenshot",width:540,get show(){return i()},set show(l){i(l)},get theme(){return o().theme},click:a,children:(l,c)=>{var d=OB();Se(()=>zt(d,"src",e.url)),z(l,d)},$$slots:{default:!0}}),hd()}function VB(n,e,t){const o=n.target;kl(t,rs(e).timezone=o.value,rs(e))}var WB=fe("<option> </option>"),qB=fe('<div class="flex justify-center items-center min-h-[70px]"><select class="select select-bordered w-[70%]"></select></div>');function HB(n,e){gd(e,!0);const t=wp(),o=()=>ya(r,"$save",t);let i=Ws(e,"show",15);const r=Kc("save"),a=g8();function l(d){i(!1)}var c=vt(()=>wx());vf(n,{get title(){return s(c)},width:400,get show(){return i()},set show(d){i(d)},get theme(){return o().theme},click:l,children:(d,p)=>{var m=qB(),h=g(m);_g(h,()=>o().timezone);var _;h.__change=[VB,o,r],vs(h,21,()=>a,Vs,(w,S)=>{var P=WB(),I={},C=g(P,!0);Se(()=>ze(C,Vf[s(S).text]())),f(P),Se(()=>{I!==(I=s(S).key)&&(P.value=(P.__value=s(S).key)==null?"":s(S).key)}),z(w,P)}),f(h),f(m),Se(()=>{_!==(_=o().timezone)&&(h.value=(h.__value=o().timezone)==null?"":o().timezone,Am(h,o().timezone))}),z(d,m)},$$slots:{default:!0}}),hd()}qu(["change"]);var UB=fe('<div class="warning-banner"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01M10.29 3.86l-7.6 13.17A1 1 0 003.53 19h16.94a1 1 0 00.84-1.5L13.71 3.86a1 1 0 00-1.73 0z"></path></svg> <span> </span></div>'),GB=(n,e,t)=>e(s(t),n),YB=fe('<div class="selection-badge"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M13.3 4.3L6 11.6 2.7 8.3l1.1-1.1L6 9.4l6.2-6.2 1.1 1.1z" fill="currentColor" stroke="currentColor" stroke-width="0.5"></path></svg></div>'),KB=fe('<button class="chart-card"><div class="card-bg"></div> <!> <div class="icon-container"><div class="icon-glow"></div> <!></div> <span class="chart-name"> </span> <div class="shine-effect"></div></button>'),ZB=fe(`<!> <div class="premium-grid"></div> <style>/* ===== PREMIUM GRID LAYOUT ===== */
    .premium-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
      padding: 8px;
    }
    
    @media (max-width: 640px) {
      .premium-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        padding: 6px;
      }
    }
    
    @media (max-width: 480px) {
      .premium-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        padding: 8px;
      }
    }
    
    /* ===== PREMIUM CHART CARD ===== */
    .chart-card {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 20px 12px 18px;
      background: linear-gradient(145deg, 
        rgba(30, 35, 48, 0.6) 0%, 
        rgba(20, 25, 35, 0.4) 100%);
      border: 1.5px solid rgba(255, 255, 255, 0.06);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 
        0 4px 20px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    @media (max-width: 640px) {
      .chart-card {
        padding: 16px 10px 14px;
        gap: 8px;
      }
    }
    
    @media (max-width: 480px) {
      .chart-card {
        padding: 22px 14px 20px;
        gap: 12px;
      }
    }
    
    /* Animated background */
    .card-bg {
      position: absolute;
      inset: 0;
      background: linear-gradient(145deg,
        rgba(45, 55, 75, 0.3) 0%,
        rgba(30, 40, 60, 0.2) 50%,
        rgba(20, 30, 50, 0.3) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }
    
    /* Hover state */
    .chart-card:hover {
      transform: translateY(-3px);
      border-color: rgba(255, 255, 255, 0.12);
      background: linear-gradient(145deg, 
        rgba(35, 45, 60, 0.7) 0%, 
        rgba(25, 35, 50, 0.5) 100%);
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.4),
        0 6px 20px rgba(20, 30, 50, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }
    
    .chart-card:hover .card-bg {
      opacity: 1;
    }
    
    /* Active state */
    .chart-card.active {
      background: linear-gradient(145deg, 
        rgba(30, 50, 80, 0.5) 0%,
        rgba(20, 40, 70, 0.4) 50%,
        rgba(25, 45, 75, 0.5) 100%);
      border-color: rgba(70, 120, 180, 0.4);
      box-shadow: 
        0 8px 32px rgba(30, 60, 100, 0.3),
        0 4px 16px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(60, 100, 150, 0.2);
      transform: translateY(-2px);
    }
    
    .chart-card.active .card-bg {
      background: linear-gradient(145deg,
        rgba(40, 65, 95, 0.4) 0%,
        rgba(30, 55, 85, 0.3) 50%,
        rgba(35, 60, 90, 0.4) 100%);
      opacity: 1;
    }
    
    .chart-card.active:hover {
      transform: translateY(-2px);
      border-color: rgba(80, 130, 190, 0.5);
    }
    
    /* ===== SELECTION BADGE ===== */
    .selection-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, 
        rgba(70, 120, 180, 0.9) 0%, 
        rgba(50, 100, 160, 0.85) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      z-index: 10;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 
        0 3px 10px rgba(30, 60, 100, 0.4),
        0 1px 3px rgba(0, 0, 0, 0.3);
      animation: badgePulse 2.5s ease-in-out infinite;
    }
    
    @keyframes badgePulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 
          0 3px 10px rgba(30, 60, 100, 0.4),
          0 1px 3px rgba(0, 0, 0, 0.3);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 
          0 4px 14px rgba(40, 70, 110, 0.5),
          0 2px 5px rgba(0, 0, 0, 0.35);
      }
    }
    
    /* ===== ICON CONTAINER ===== */
    .icon-container {
      position: relative;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: linear-gradient(145deg, 
        rgba(40, 50, 65, 0.5) 0%, 
        rgba(25, 35, 50, 0.3) 100%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 3px 12px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.06);
      z-index: 1;
    }
    
    @media (max-width: 640px) {
      .icon-container {
        width: 42px;
        height: 42px;
        border-radius: 10px;
      }
    }
    
    @media (max-width: 480px) {
      .icon-container {
        width: 50px;
        height: 50px;
        border-radius: 12px;
      }

    }
    
    .icon-glow {
      position: absolute;
      inset: -3px;
      background: linear-gradient(145deg, 
        rgba(50, 90, 140, 0.3) 0%, 
        rgba(35, 70, 120, 0.25) 100%);
      border-radius: inherit;
      opacity: 0;
      filter: blur(10px);
      transition: opacity 0.3s ease;
      z-index: -1;
    }
    
    .chart-card:hover .icon-container {
      transform: scale(1.06);
      background: linear-gradient(145deg, 
        rgba(50, 65, 85, 0.6) 0%, 
        rgba(35, 50, 70, 0.4) 100%);
      box-shadow: 
        0 5px 18px rgba(0, 0, 0, 0.25),
        0 2px 10px rgba(30, 50, 80, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    .chart-card.active .icon-container {
      background: linear-gradient(145deg, 
        rgba(40, 70, 110, 0.5) 0%, 
        rgba(30, 60, 95, 0.4) 100%);
      border-color: rgba(70, 110, 160, 0.3);
      transform: scale(1.04);
      box-shadow: 
        0 6px 20px rgba(30, 60, 100, 0.3),
        0 3px 12px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.12);
    }
    
    .chart-card.active .icon-glow {
      opacity: 0.5;
    }
    
    /* ===== CHART ICON ===== */
    :global(.chart-icon) {
      color: rgba(200, 210, 230, 0.85);
      filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.3));
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 2;
    }
    
    .chart-card:hover :global(.chart-icon) {
      color: rgba(220, 230, 245, 0.95);
      filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.35));
      transform: scale(1.05);
    }
    
    .chart-card.active :global(.chart-icon) {
      color: rgba(160, 200, 240, 1);
      filter: drop-shadow(0 4px 12px rgba(40, 80, 130, 0.5));
      transform: scale(1.03);
    }
    
    /* ===== CHART NAME ===== */
    .chart-name {
      color: rgba(180, 190, 210, 0.85);
      font-size: 12px;
      font-weight: 500;
      text-align: center;
      line-height: 1.3;
      letter-spacing: 0.4px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }
    
    @media (max-width: 640px) {
      .chart-name {
        font-size: 11px;
      }
    }
    
    @media (max-width: 480px) {
      .chart-name {
        font-size: 12.5px;
      }
    }
    
    .chart-card:hover .chart-name {
      color: rgba(210, 220, 235, 0.95);
      transform: translateY(-1px);
    }
    
    .chart-card.active .chart-name {
      color: rgba(180, 210, 240, 1);
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    /* ===== SHINE EFFECT ===== */
    .shine-effect {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        115deg,
        transparent 25%,
        rgba(255, 255, 255, 0.08) 45%,
        rgba(200, 220, 240, 0.12) 50%,
        rgba(255, 255, 255, 0.08) 55%,
        transparent 75%
      );
      transform: translateX(-100%) skewX(-15deg);
      transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .chart-card:hover .shine-effect {
      transform: translateX(100%) skewX(-15deg);
    }
    
    /* ===== LIGHT THEME ===== */
    :global([data-theme="light"]) .chart-card {
      background: linear-gradient(145deg, #ffffff 0%, #f9fbff 100%);
      border-color: rgba(59, 130, 246, 0.15);
      box-shadow: 
        0 2px 6px rgba(59, 130, 246, 0.08),
        0 1px 2px rgba(0, 0, 0, 0.04);
    }
    
    :global([data-theme="light"]) .card-bg {
      background: transparent;
      opacity: 0;
    }
    
    :global([data-theme="light"]) .chart-card:hover {
      background: #ffffff;
      border-color: rgba(59, 130, 246, 0.25);
      box-shadow: 
        0 6px 14px rgba(59, 130, 246, 0.10),
        0 3px 8px rgba(0, 0, 0, 0.05);
    }
    
    :global([data-theme="light"]) .chart-card.active {
      background: linear-gradient(145deg, #e8f4ff 0%, #f0f8ff 100%);
      border-color: rgba(100, 150, 220, 0.4);
      box-shadow: 
        0 3px 10px rgba(100, 150, 220, 0.15),
        0 1px 4px rgba(0, 0, 0, 0.05);
    }
    
    :global([data-theme="light"]) .chart-card.active .card-bg {
      opacity: 0;
    }
    
    :global([data-theme="light"]) .icon-container {
      background: #f3f6fb;
      border-color: rgba(59, 130, 246, 0.15);
      box-shadow: 
        0 1px 3px rgba(0, 0, 0, 0.04),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .chart-card:hover .icon-container {
      background: #f0f2f5;
      box-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.05),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .chart-card.active .icon-container {
      background: linear-gradient(145deg, #dceeff 0%, #e6f3ff 100%);
      border-color: rgba(100, 150, 220, 0.2);
      box-shadow: 
        0 2px 8px rgba(100, 150, 220, 0.12),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .icon-glow {
      opacity: 0;
    }
    
    :global([data-theme="light"]) :global(.chart-icon) {
      color: #3b82f6;
      filter: drop-shadow(0 0.5px 1px rgba(59, 130, 246, 0.15));
    }
    
    :global([data-theme="light"]) .chart-card:hover :global(.chart-icon) {
      color: #2563eb;
      filter: drop-shadow(0 1px 2px rgba(37, 99, 235, 0.2));
    }
    
    :global([data-theme="light"]) .chart-card.active :global(.chart-icon) {
      color: #1d4ed8;
      filter: drop-shadow(0 1px 3px rgba(29, 78, 216, 0.3));
    }
    
    :global([data-theme="light"]) .chart-name {
      color: #334155;
    }
    
    :global([data-theme="light"]) .chart-card:hover .chart-name {
      color: #1f2937;
    }
    
    :global([data-theme="light"]) .chart-card.active .chart-name {
      color: #2563eb;
      font-weight: 600;
    }
    
    :global([data-theme="light"]) .selection-badge {
      background: linear-gradient(135deg, #5ba3f5 0%, #4a90e2 100%);
      border-color: rgba(255, 255, 255, 0.8);
      box-shadow: 
        0 2px 8px rgba(74, 144, 226, 0.3),
        0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    /* ===== WARNING BANNER ===== */
    .warning-banner {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 18px;
      margin-bottom: 16px;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(239, 68, 68, 0.1) 100%);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 12px;
      color: rgba(251, 191, 36, 0.95);
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
    }
    
    .warning-banner svg {
      flex-shrink: 0;
      color: rgba(251, 191, 36, 1);
      filter: drop-shadow(0 2px 4px rgba(245, 158, 11, 0.3));
    }
    
    :global([data-theme="light"]) .warning-banner {
      background: linear-gradient(135deg, rgba(254, 243, 199, 0.9) 0%, rgba(254, 226, 226, 0.8) 100%);
      border-color: rgba(217, 119, 6, 0.3);
      color: rgba(146, 64, 14, 0.95);
      box-shadow: 0 2px 8px rgba(217, 119, 6, 0.15);
    }
    
    :global([data-theme="light"]) .warning-banner svg {
      color: rgba(217, 119, 6, 1);
      filter: drop-shadow(0 1px 2px rgba(217, 119, 6, 0.2));
    }
    
    /* ===== DISABLED STATE ===== */
    .chart-card.disabled {
      opacity: 0.35;
      cursor: not-allowed;
      pointer-events: auto;
    }
    
    .chart-card.disabled:hover {
      transform: none;
      opacity: 0.35;
      border-color: rgba(255, 255, 255, 0.06);
      background: linear-gradient(145deg, 
        rgba(30, 35, 48, 0.6) 0%, 
        rgba(20, 25, 35, 0.4) 100%);
      box-shadow: 
        0 4px 20px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    .chart-card.disabled .card-bg {
      opacity: 0;
    }
    
    .chart-card.disabled .icon-container {
      transform: none;
    }
    
    .chart-card.disabled .shine-effect {
      display: none;
    }
    
    :global([data-theme="light"]) .chart-card.disabled {
      opacity: 0.4;
    }
    
    :global([data-theme="light"]) .chart-card.disabled:hover {
      opacity: 0.4;
    }</style>`,1);function XB(n,e){gd(e,!0);const t=wp(),o=()=>ya(a,"$save",t),i=()=>ya(l,"$chart",t);let r=Ws(e,"show",15);Kc("ctx");const a=Kc("save"),l=Kc("chart"),c=[{id:"candle_solid",name:"Candlestick",icon:"candle_solid"},{id:"candle_stroke",name:"Hollow",icon:"candle_stroke"},{id:"candle_up_stroke",name:"Up Hollow",icon:"candle_up_stroke"},{id:"candle_down_stroke",name:"Down Hollow",icon:"candle_down_stroke"},{id:"heikin_ashi",name:"Heikin Ashi",icon:"candle_solid"},{id:"renko_atr",name:"Duty AI Renko",icon:"candle_solid"},{id:"point_and_figure",name:"Point & Figure",icon:"point_and_figure"},{id:"ohlc",name:"OHLC",icon:"ohlc"},{id:"area",name:"Area",icon:"area"},{id:"line_chart",name:"Line",icon:"line"}],d=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"];function p(){return!o()||!o().saveInds?!1:Object.values(o().saveInds).some(S=>S&&d.includes(S.name))}let m=ae(!1),h=ae("");mr(()=>{if(s(m)){const S=setTimeout(()=>{x(m,!1)},5e3);return()=>clearTimeout(S)}});function _(S,P){var F,V,j,D,R;const I=S;if(I.id==="renko_atr"&&p()){x(h,"You cannot use Duty AI Renko chart with AI Indicator"),x(m,!0),console.log("⚠️ Cannot add Renko chart: AI indicators present");return}if(I.id==="point_and_figure"&&p()){x(h,"You cannot use Point & Figure chart with AI Indicator"),x(m,!0),console.log("⚠️ Cannot add P&F chart: AI indicators present");return}if(console.log("📊 CHART TYPE CLICK:",I.id),P){const W=P.currentTarget;W.classList.add("selecting"),setTimeout(()=>{W.classList.remove("selecting")},800)}if(o().styles.candle||kl(a,rs(o).styles.candle={},rs(o)),I.id==="line_chart"){console.log("🎯 Setting up LINE CHART (using area with transparent background)"),kl(a,rs(o).styles.candle.type="area",rs(o));const W=((V=(F=o().styles.candle)==null?void 0:F.bar)==null?void 0:V.upColor)||"#2196F3";kl(a,rs(o).styles.candle.area={lineSize:2,lineColor:W,lineSmooth:!1,value:"close",backgroundColor:[{offset:0,color:"rgba(0, 0, 0, 0)"},{offset:1,color:"rgba(0, 0, 0, 0)"}]},rs(o)),kl(a,rs(o).styles.candle._isLineChart=!0,rs(o)),console.log("✅ Line chart configured with area type and transparent background")}else if(I.id==="area"){console.log("🎯 Setting up AREA CHART with gradient fill"),kl(a,rs(o).styles.candle.type="area",rs(o)),delete o().styles.candle._isLineChart;const W=((D=(j=o().styles.candle)==null?void 0:j.bar)==null?void 0:D.upColor)||"#2196F3";kl(a,rs(o).styles.candle.area={lineSize:2,lineColor:W,lineSmooth:!1,value:"close",backgroundColor:[{offset:0,color:W+"60"},{offset:1,color:W+"10"}]},rs(o)),console.log("✅ Area chart configured with gradient background")}else I.id==="renko_atr"?(console.log("🎯 Setting up RENKO (ATR) chart"),kl(a,rs(o).styles.candle.type="renko_atr",rs(o)),o().styles.candle.renko||kl(a,rs(o).styles.candle.renko={method:"ATR",atrLength:14,source:"close",wick:!1},rs(o)),delete o().styles.candle._isLineChart,delete o().styles.candle.area):I.id==="point_and_figure"?(console.log("🎯 Setting up POINT & FIGURE chart"),kl(a,rs(o).styles.candle.type="point_and_figure",rs(o)),o().styles.candle.pnf||kl(a,rs(o).styles.candle.pnf={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"},rs(o)),delete o().styles.candle._isLineChart,delete o().styles.candle.area):(kl(a,rs(o).styles.candle.type=I.id,rs(o)),delete o().styles.candle._isLineChart,delete o().styles.candle.area);console.log("✅ Saved chart type to $save.styles:",{type:o().styles.candle.type,isLineChart:o().styles.candle._isLineChart,area:o().styles.candle.area});const C=wu(o().theme);Mn.merge(C,o().styles);const M=$d(C);(R=i())==null||R.setStyles(M),console.log("✅ Styles applied to chart with processing"),r(!1)}function w(){var P,I,C,M;return(I=(P=o().styles)==null?void 0:P.candle)!=null&&I._isLineChart?"line_chart":((M=(C=o().styles)==null?void 0:C.candle)==null?void 0:M.type)||"renko_atr"}vf(n,{get show(){return r()},set show(S){r(S)},title:"Chart Type",width:"550px",maxWidth:"95vw",maxHeight:"90vh",buttons:[],get theme(){return o().theme},class:"chart-type-modal-premium",children:(S,P)=>{var I=ZB(),C=Dt(I);Te(C,()=>s(m),F=>{var V=UB(),j=u(g(V),2),D=g(j,!0);f(j),f(V),Se(()=>ze(D,s(h))),Mf(3,V,()=>Qh,()=>({y:-20,duration:300})),z(F,V)});var M=u(C,2);vs(M,21,()=>c,F=>F.id,(F,V)=>{var j=KB();const D=vt(()=>(s(V).id==="renko_atr"||s(V).id==="point_and_figure")&&p());j.__click=[GB,_,V];const R=vt(()=>w()===s(V).id);Se(()=>Fi(j,"active",s(R)));var W=u(g(j),2);Te(W,()=>w()===s(V).id&&!s(D),Y=>{var oe=YB();z(Y,oe)});var J=u(W,2),Z=u(g(J),2);If(Z,{get name(){return s(V).icon},size:26,class:"chart-icon"}),f(J);var G=u(J,2),se=g(G,!0);f(G),ai(2),f(j),Se(()=>{Fi(j,"disabled",s(D)),ze(se,s(V).name)}),z(F,j)}),f(M),ai(2),z(S,I)},$$slots:{default:!0}}),hd()}qu(["click"]);function Rb(n,e){e(!1)}var JB=(n,e,t,o,i)=>!s(e)&&!s(t)&&o(s(i).is_main,s(i).name),QB=fe('<div class="particle svelte-uswuii"></div>'),eO=fe('<div class="stream-line svelte-uswuii"></div>'),tO=fe('<div class="segment svelte-uswuii"></div>'),nO=fe('<div class="ai-loading-overlay svelte-uswuii"><div class="particles-container svelte-uswuii"></div> <div class="data-stream svelte-uswuii"></div> <div class="loading-content svelte-uswuii"><div class="ai-loader-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg> <div class="ai-pulse-ring ring-1 svelte-uswuii"></div> <div class="ai-pulse-ring ring-2 svelte-uswuii"></div> <div class="ai-pulse-ring ring-3 svelte-uswuii"></div> <div class="ai-glow svelte-uswuii"></div></div> <div class="loading-text-container svelte-uswuii"><div class="loading-text-main svelte-uswuii"> </div> <div class="loading-text-sub svelte-uswuii"> </div></div> <div class="progress-container svelte-uswuii"><div class="progress-bar svelte-uswuii"><div class="progress-glow svelte-uswuii"></div></div> <div class="progress-segments svelte-uswuii"></div></div> <div class="progress-info svelte-uswuii"><div class="progress-percentage svelte-uswuii"> </div> <div class="progress-status svelte-uswuii"> </div></div></div></div>'),oO=(n,e,t,o)=>{n.stopPropagation(),e(s(t),s(o).name)},sO=(n,e,t,o)=>{n.stopPropagation(),e(s(t),s(o).name)},iO=fe('<div class="indicator-actions svelte-uswuii"><button class="action-btn edit-btn svelte-uswuii" title="Edit Parameters"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" class="svelte-uswuii"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" class="svelte-uswuii"></path></svg></button> <button class="action-btn delete-btn svelte-uswuii" title="Remove Indicator"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="3 6 5 6 21 6" class="svelte-uswuii"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" class="svelte-uswuii"></path><line x1="10" y1="11" x2="10" y2="17" class="svelte-uswuii"></line><line x1="14" y1="11" x2="14" y2="17" class="svelte-uswuii"></line></svg></button></div>'),rO=fe('<div class="add-indicator-hint svelte-uswuii"><span class="svelte-uswuii">Click to add</span></div>'),aO=fe('<div class="indicator-icon svelte-uswuii"> </div> <div class="indicator-info svelte-uswuii"><span class="indicator-name svelte-uswuii"> </span></div> <!>',1),lO=fe("<div><!></div>"),cO=n=>n.stopPropagation(),dO=fe('<div class="ai-modal-backdrop svelte-uswuii" role="presentation"></div> <div class="ai-modal-container svelte-uswuii" role="dialog" aria-modal="true" aria-labelledby="ai-modal-title"><div class="ai-background svelte-uswuii"><div class="orb orb-1 svelte-uswuii"></div> <div class="orb orb-2 svelte-uswuii"></div> <div class="orb orb-3 svelte-uswuii"></div></div> <div class="ai-content svelte-uswuii"><div class="ai-header svelte-uswuii"><div class="ai-header-left svelte-uswuii"><div class="ai-icon-small svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg></div> <div class="ai-header-text svelte-uswuii"><h2 id="ai-modal-title" class="ai-title svelte-uswuii">AI Indicators</h2> <p class="ai-subtitle svelte-uswuii">Duty AI Advanced Algorithm - Exclusive for Pro Traders</p></div></div> <button class="close-btn svelte-uswuii" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="18" y1="6" x2="6" y2="18" class="svelte-uswuii"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-uswuii"></line></svg></button></div> <div class="indicators-list svelte-uswuii"><!> <div class="indicator-row coming-soon-item disabled svelte-uswuii"><div class="coming-soon-glitter-bg svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-1 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-2 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-3 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-4 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-5 svelte-uswuii"></div> <div class="coming-soon-shine-sweep svelte-uswuii"></div> <div class="indicator-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg></div> <div class="indicator-info svelte-uswuii"><span class="indicator-name svelte-uswuii">AI Trade Entry Finder and more AI algorithms</span> <span class="coming-soon-badge svelte-uswuii">Coming Soon</span></div></div></div> <div class="ai-powered-footer svelte-uswuii"><span class="powered-by-text svelte-uswuii">Powered by Duty AI</span></div></div></div>',1),uO=(n,e)=>x(e,!1),pO=(n,e)=>x(e,!1),vO=fe('<div class="premium-modal-backdrop svelte-uswuii" role="presentation"></div> <div class="premium-modal-container svelte-uswuii" role="dialog" aria-modal="true" aria-labelledby="premium-modal-title"><div class="premium-background svelte-uswuii"><div class="premium-orb premium-orb-1 svelte-uswuii"></div> <div class="premium-orb premium-orb-2 svelte-uswuii"></div></div> <div class="premium-content svelte-uswuii"><button class="premium-close-btn svelte-uswuii" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="18" y1="6" x2="6" y2="18" class="svelte-uswuii"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-uswuii"></line></svg></button> <div class="premium-icon-wrapper svelte-uswuii"><div class="premium-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-uswuii"></path><path d="M2 17l10 5 10-5" class="svelte-uswuii"></path><path d="M2 12l10 5 10-5" class="svelte-uswuii"></path></svg> <div class="premium-icon-glow svelte-uswuii"></div></div></div> <h2 id="premium-modal-title" class="premium-title svelte-uswuii">Premium Feature</h2> <p class="premium-message svelte-uswuii">AI Indicators are exclusive premium features. Upgrade to Premium to unlock all advanced AI algorithms and take your trading to the next level.</p> <div class="premium-features svelte-uswuii"><div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Smart Money Footprint</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Trap Hunter (Bull/Bear Traps)</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Volcanic Move & Eruptions</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">More AI algorithms coming soon</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-uswuii"><span class="svelte-uswuii">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="5" y1="12" x2="19" y2="12" class="svelte-uswuii"></line><polyline points="12 5 19 12 12 19" class="svelte-uswuii"></polyline></svg></a></div></div>',1),fO=fe("<!> <!>",1);function mO(n,e){gd(e,!0);const t=wp(),o=()=>ya(p,"$chart",t),i=()=>ya(d,"$save",t),r=()=>ya(c,"$ctx",t),a=()=>ya(Fm,"$userPreferences",t);let l=Ws(e,"show",15);const c=Kc("ctx"),d=Kc("save"),p=Kc("chart"),m=[{name:"SMART_MONEY",title:"Smart Money Footprint",is_main:!0,icon:"💰"},{name:"TRAP_HUNTER",title:"Trap Hunter (Bull/Bear Traps)",is_main:!0,icon:"🎯"},{name:"VOLCANIC",title:"Volcanic Move (Pressure) (Sub Pane)",is_main:!1,icon:"🌋"},{name:"VOLCANIC_SIG",title:"Volcanic Eruptions (Markers) (Main Pane)",is_main:!0,icon:"💥"}],h={SMART_MONEY:[{text:"💰 Tracking institutional money flow",duration:1200,subtext:"Analyzing whale movements..."},{text:"🏦 Detecting smart money footprints",duration:1400,subtext:"Scanning OBV patterns..."},{text:"📊 Mapping accumulation zones",duration:1300,subtext:"Identifying support levels..."},{text:"🎯 Calculating volume clusters",duration:1200,subtext:"Processing 50,000+ trades..."},{text:"✨ Activating smart money radar",duration:1100,subtext:"Deploying footprint tracker..."}],TRAP_HUNTER:[{text:"🎯 Scanning for bull/bear traps",duration:1200,subtext:"Analyzing false breakouts..."},{text:"🔍 Detecting fake-out patterns",duration:1400,subtext:"Identifying trap signatures..."},{text:"⚡ Processing trap probability",duration:1300,subtext:"Calculating 20+ parameters..."},{text:"🚨 Mapping high-risk zones",duration:1200,subtext:"Locating potential traps..."},{text:"✨ Deploying trap detection AI",duration:1100,subtext:"Activating alert system..."}],VOLCANIC:[{text:"🌋 Measuring market pressure",duration:1200,subtext:"Analyzing momentum buildup..."},{text:"📈 Detecting volcanic activity",duration:1400,subtext:"Scanning RSI extremes..."},{text:"🔥 Calculating eruption zones",duration:1300,subtext:"Processing pressure levels..."},{text:"⚡ Tracking explosive setups",duration:1200,subtext:"Identifying breakout points..."},{text:"✨ Activating volcanic pressure",duration:1100,subtext:"Deploying oscillator..."}],VOLCANIC_SIG:[{text:"💥 Detecting eruption signals",duration:1200,subtext:"Scanning breakout candles..."},{text:"🚀 Analyzing explosive moves",duration:1400,subtext:"Tracking volume spikes..."},{text:"🎯 Mapping eruption markers",duration:1300,subtext:"Calculating signal strength..."},{text:"⚡ Processing 15,000+ patterns",duration:1200,subtext:"Identifying eruption points..."},{text:"✨ Deploying eruption markers",duration:1100,subtext:"Activating signal alerts..."}]};let _=ae(N(new Set));mr(()=>{var me;if(!l()||!o())return;const ee=o();let re=new Set;try{const K=((me=ee.getIndicators)==null?void 0:me.call(ee))??[];re=new Set(K.map(ye=>ye.name)),console.log("🧠 AI Modal (open) - from chart.getIndicators:",K)}catch(K){console.warn("⚠️ AI Modal - getIndicators failed, falling back to saveInds",K);const ye=new Set;i()&&i().saveInds&&Object.values(i().saveInds).forEach(Me=>{Me&&Me.name&&ye.add(Me.name)}),re=ye}console.log("🔄 AI Modal (open) - selectedIndicators updated:",Array.from(re)),console.log("🔍 AI Modal (open) - saveInds keys:",Object.keys(i().saveInds||{})),x(_,N(re))});let w=ae(!1),S=ae(null),P=ae(0),I=ae(0),C=ae(N([])),M=ae(!1);mr(()=>{!r().modalIndCfg&&s(w)&&(x(w,!1),setTimeout(()=>{l(!0)},100))}),mr(()=>{l()&&(console.log("🎯 AI Modal opened"),console.log("📊 Current saveInds:",i().saveInds),console.log("✅ AI indicators in chart:",Array.from(s(_))))});function F(){var re,me,K;if(((me=(re=i().styles)==null?void 0:re.candle)==null?void 0:me.type)==="renko_atr"){console.log("🔄 Converting Renko chart to Candlestick for AI indicator compatibility"),kl(d,rs(i).styles.candle.type="candle_solid",rs(i)),delete i().styles.candle.renko,delete i().styles.candle._isLineChart,delete i().styles.candle.area;const ye=wu(i().theme);Mn.merge(ye,i().styles);const Me=$d(ye);return(K=o())==null||K.setStyles(Me),console.log("✅ Chart converted from Renko to Candlestick"),!0}return!1}async function V(ee){x(S,N(ee)),x(P,0),x(I,0),x(C,N(h[ee]||h.SMART_MONEY));for(let re=0;re<s(C).length;(re+=1)-1){x(P,N(re));const me=s(C)[re],K=re/s(C).length*100,ye=(re+1)/s(C).length*100,Me=20,Fe=me.duration/Me;for(let Ze=0;Ze<=Me;(Ze+=1)-1)x(I,K+(ye-K)*(Ze/Me)),await new Promise(Ge=>setTimeout(Ge,Fe))}x(S,null),x(P,0),x(I,0),x(C,N([]))}function j(){var re;const ee=(re=a())==null?void 0:re.data;return ee?ee.isPremium===!0||ee.isTrial===!0:!1}async function D(ee,re){if(!j()){console.log("🔒 Premium access required for AI indicators"),x(M,!0);return}await V(re),F();let me=!1;if(re==="SMART_MONEY"){const K="candle_pane",ye=o();if(ye&&ye.createIndicator({name:"SMART_MONEY",calcParams:[40,5,25,14,20,1.2,.03,20,.2,.6,1,20,1]},!0,{id:K})){const Fe={name:"SMART_MONEY",pane_id:K,params:[40,5,25,14,20,1.2,.03,20,.2,.6,1,20,1]},Ze=`${K}_SMART_MONEY`;d.update(Ge=>(Ge.saveInds[Ze]=Fe,Ge)),dm(),op.recordAddIndicator(re,K,Fe.params,Ze),me=!0}}else if(re==="TRAP_HUNTER"){const K="candle_pane",ye=o();if(ye){const Me=[20,20,3,5,20,1.3,7e-4,.35,.5,1,5];if(ye.createIndicator({name:"TRAP_HUNTER",calcParams:Me},!0,{id:K})){const Ze={name:"TRAP_HUNTER",pane_id:K,params:Me},Ge=`${K}_TRAP_HUNTER`;d.update(it=>(it.saveInds[Ge]=Ze,it)),dm(),op.recordAddIndicator(re,K,Ze.params,Ge),me=!0}}}else if(re==="VOLCANIC"){const K="pane_VOLCANIC",ye=o();if(ye){const Me=[16,2,14,20,60,2,.5,1,.8,.8,.4,10,1,30,0,7e-4,0,1];if(ye.createIndicator({name:"VOLCANIC",calcParams:Me},!1,{id:K})){const Ze={name:"VOLCANIC",pane_id:K,params:Me},Ge=`${K}_VOLCANIC`;d.update(it=>(it.saveInds[Ge]=Ze,it)),dm(),op.recordAddIndicator(re,K,Ze.params,Ge),me=!0}}}else if(re==="VOLCANIC_SIG"){const K="candle_pane",ye=o();if(ye){const Me=[16,2,14,20,60,2,.5,1,.8,.8,.4,10,1,30,0,7e-4,0,1];if(ye.createIndicator({name:"VOLCANIC_SIG",calcParams:Me},!0,{id:K})){const Ze={name:"VOLCANIC_SIG",pane_id:K,params:Me},Ge=`${K}_VOLCANIC_SIG`;d.update(it=>(it.saveInds[Ge]=Ze,it)),dm(),op.recordAddIndicator(re,K,Ze.params,Ge),me=!0}}}me&&console.log(`✅ ${re} added successfully from AI modal`)}function R(ee,re){x(w,!0),l(!1),c.update(me=>(me.editPaneId=ee,me.editIndName=re,me.modalIndCfg=!0,me))}async function W(ee,re){if(console.log("🗑️ Deleting indicator:",{paneId:ee,name:re}),!o()){console.log("❌ No chart available");return}const me=o(),K=`${ee}_${re}`,ye=i().saveInds[K];ye&&op.recordRemoveIndicator(re,ee,ye.params||[],K);try{me.removeIndicator({paneId:ee,name:re}),console.log("✅ Indicator removed"),d.update(Me=>(delete Me.saveInds[K],Me)),dm()}catch(Me){console.log("❌ Error removing indicator:",Me)}}const J=Ng(),[Z,G]=J;var se=fO(),Y=Dt(se);Te(Y,l,ee=>{var re=dO(),me=Dt(re);me.__click=[Rb,l];var K=u(me,2),ye=u(g(K),2),Me=g(ye),Fe=u(g(Me),2);Fe.__click=[Rb,l],f(Me);var Ze=u(Me,2),Ge=g(Ze);vs(Ge,19,()=>m,Ye=>Ye.name,(Ye,ct)=>{var kt=lO();const ft=vt(()=>s(_).has(s(ct).name)),bt=vt(()=>s(S)===s(ct).name),nt=vt(()=>s(ct).is_main?"candle_pane":`pane_${s(ct).name}`);kt.__click=[JB,ft,bt,D,ct];var Pt=g(kt);Te(Pt,()=>s(bt),Qe=>{var yt=nO(),xe=g(yt);vs(xe,20,()=>Array(12),Vs,(Es,Qo,Ko)=>{var oo=QB();zt(oo,"style",`--delay: ${Ko*.15}s; --x: ${Math.random()*100}%; --y: ${Math.random()*100}%`),z(Es,oo)}),f(xe);var Je=u(xe,2);vs(Je,20,()=>Array(8),Vs,(Es,Qo,Ko)=>{var oo=eO();zt(oo,"style",`--stream-delay: ${Ko*.2}s; left: ${10+Ko*12}%`),z(Es,oo)}),f(Je);var Ne=u(Je,2),ue=u(g(Ne),2),he=g(ue),_t=g(he,!0);f(he);var Wt=u(he,2),jt=g(Wt,!0);f(Wt),f(ue);var Zt=u(ue,2),dn=g(Zt),zn=u(dn,2);vs(zn,20,()=>Array(5),Vs,(Es,Qo,Ko)=>{var oo=tO();Se(()=>Fi(oo,"active",s(P)>=Ko)),z(Es,oo)}),f(zn),f(Zt);var On=u(Zt,2),no=g(On),fs=g(no);Se(()=>ze(fs,`${Math.round(s(I))??""}%`)),f(no);var ps=u(no,2),So=g(ps);f(ps),f(On),f(Ne),f(yt),Se(()=>{var Es,Qo;ze(_t,((Es=s(C)[s(P)])==null?void 0:Es.text)||""),ze(jt,((Qo=s(C)[s(P)])==null?void 0:Qo.subtext)||""),zt(dn,"style",`width: ${s(I)??""}%`),ze(So,`Phase ${s(P)+1}/5`)}),z(Qe,yt)},Qe=>{var yt=aO(),xe=Dt(yt),Ve=g(xe,!0);f(xe);var Je=u(xe,2),St=g(Je),Ne=g(St,!0);f(St),f(Je);var ue=u(Je,2);Te(ue,()=>s(ft),he=>{var _t=iO(),Wt=g(_t);Wt.__click=[oO,R,nt,ct];var jt=u(Wt,2);jt.__click=[sO,W,nt,ct],f(_t),z(he,_t)},he=>{var _t=rO();z(he,_t)}),Se(()=>{ze(Ve,s(ct).icon),ze(Ne,s(ct).title)}),z(Qe,yt)}),f(kt),Se(()=>Us(kt,`indicator-row ${(s(ft)?"indicator-selected":"")??""} ${(s(bt)?"indicator-loading":"")??""} svelte-uswuii`)),z(Ye,kt)});var it=u(Ge,2);it.__click=[cO],f(Ze),ai(2),f(ye),f(K),Mf(3,me,()=>Fg,()=>({duration:200})),Mf(3,K,()=>Qh,()=>({y:20,duration:300,easing:q1})),z(ee,re)});var oe=u(Y,2);Te(oe,()=>s(M),ee=>{var re=vO(),me=Dt(re);me.__click=[uO,M];var K=u(me,2),ye=u(g(K),2),Me=g(ye);Me.__click=[pO,M];var Fe=u(Me,10);Se(()=>zt(Fe,"href",Z("https://dutyai.app/settings/investor?device=1",void 0))),f(ye),f(K),Mf(3,me,()=>Fg,()=>({duration:200})),Mf(3,K,()=>Qh,()=>({y:20,duration:300,easing:q1})),z(ee,re)}),z(n,se),hd()}qu(["click"]);var gO=fe('<span class="loading loading-spinner loading-xs"></span>'),hO=fe('<span class="text-xs">•</span>'),_O=fe('<button class="btn btn-primary btn-sm min-w-[100px] transition-all duration-200 svelte-1ib83i5" title="Save Layout Options"><!> Save <!></button>');function yO(n,e){gd(e,!1);const t=Qd(),o=Qd();let i=Ws(e,"savedLayouts",24,()=>[]),r=Ws(e,"activeSaveId",8,null),a=Ws(e,"isLoading",8,!1),l=Ws(e,"hasUnsavedChanges",8,!1);const c=mv();function d(){c("showPopup")}Jv(()=>(jv(r()),jv(i())),()=>{x(t,r()?i().find(_=>_.id===r()):null)}),Jv(()=>s(t),()=>{x(o,!!s(t))}),Eg(),Bv();var p=_O(),m=g(p);Te(m,a,_=>{var w=gO();z(_,w)},_=>{sF(_,{class:"h-4 w-4"})});var h=u(m,2);Te(h,l,_=>{var w=hO();z(_,w)}),f(p),Se(()=>{p.disabled=a(),Fi(p,"btn-warning",l())}),sc("click",p,d),z(n,p),hd()}function bO(n,e,t,o,i){n.key==="Enter"&&s(e).valid&&s(t).trim()?(n.preventDefault(),o()):n.key==="Escape"&&(n.preventDefault(),i())}var xO=fe('<div class="flex items-center gap-2 text-sm text-error"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> </div>'),wO=fe('<div class="flex items-center gap-2 text-sm text-success"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Layout name is available</div>'),kO=fe('<div class="flex items-center justify-between text-sm"><span class="text-base-content/80"> </span> <span class="text-xs text-base-content/50"> </span></div>'),SO=fe('<div class="space-y-2"><h4 class="text-sm font-medium text-base-content/70"> </h4> <div class="max-h-32 overflow-y-auto space-y-1 p-3 bg-base-200/30 rounded-lg border border-base-300/50 svelte-bhlz05"></div></div>'),CO=fe('<span class="loading loading-spinner loading-sm"></span> Saving...',1),PO=fe('<div class="space-y-6"><div class="space-y-2"><label for="layout-name" class="block text-sm font-medium text-base-content">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter layout name..." class="w-full px-4 py-3 border border-base-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 bg-base-100 text-base-content placeholder-base-content/50"> <!></div> <!> <div class="flex gap-3 justify-end pt-4 border-t border-base-300/50"><button class="btn btn-ghost min-w-[100px] rounded-lg font-medium transition-all duration-200">Cancel</button> <button class="btn btn-primary min-w-[100px] rounded-lg font-medium transition-all duration-200 hover:scale-105"><!></button></div></div>');function IO(n,e){gd(e,!1);const t=Qd();let o=Ws(e,"show",12,!1),i=Ws(e,"savedLayouts",24,()=>[]),r=Ws(e,"isLoading",8,!1),a=Ws(e,"mode",8,"save"),l=Ws(e,"showExisting",8,!1),c=Qd(""),d=Qd({valid:!0}),p=Qd(!1);const m=mv();function h(S){if(x(p,!0),!S){x(d,{valid:!1,error:"Layout name is required"}),x(p,!1);return}if(S.length<2){x(d,{valid:!1,error:"Layout name must be at least 2 characters"}),x(p,!1);return}if(S.length>50){x(d,{valid:!1,error:"Layout name must be less than 50 characters"}),x(p,!1);return}if(/[<>:"/\\|?*]/.test(S)){x(d,{valid:!1,error:"Layout name contains invalid characters"}),x(p,!1);return}if(i().some(C=>C.name.toLowerCase()===S.toLowerCase())){x(d,{valid:!1,error:"A layout with this name already exists"}),x(p,!1);return}x(d,{valid:!0}),x(p,!1)}function _(){const S=s(c).trim();s(d).valid&&S&&m("save",{name:S})}function w(){o(!1),m("cancel")}Jv(()=>jv(o()),()=>{o()&&(x(c,""),x(d,{valid:!0}),x(p,!1))}),Jv(()=>s(c),()=>{s(c).trim()?h(s(c).trim()):x(d,{valid:!1,error:"Layout name is required"})}),Jv(()=>jv(a()),()=>{x(t,a()==="save"?"Save Chart Layout":"Save Layout As")}),Eg(),Bv(),vf(n,{get show(){return o()},set show(S){o(S)},get title(){return s(t)},width:450,buttons:[],children:(S,P)=>{var I=PO(),C=g(I),M=u(g(C),2);Qt(M),M.__keydown=[bO,d,c,_,w],I2(M,!0);const F=Rv(()=>!s(d).valid&&s(c).trim()),V=Rv(()=>s(d).valid&&s(c).trim());var j=u(M,2);Te(j,()=>s(c).trim()&&!s(d).valid,G=>{var se=xO(),Y=u(g(se));f(se),Se(()=>ze(Y,` ${s(d).error??""}`)),z(G,se)},G=>{var se=Ln(),Y=Dt(se);Te(Y,()=>s(d).valid&&s(c).trim(),oe=>{var ee=wO();z(oe,ee)},null,!0),z(G,se)}),f(C);var D=u(C,2);Te(D,()=>l()&&i().length>0,G=>{var se=SO(),Y=g(se),oe=g(Y);f(Y);var ee=u(Y,2);vs(ee,5,i,Vs,(re,me)=>{var K=kO(),ye=g(K),Me=g(ye,!0);f(ye);var Fe=u(ye,2),Ze=g(Fe,!0);Se(()=>ze(Ze,new Date(s(me).updatedAt).toLocaleDateString())),f(Fe),f(K),Se(()=>ze(Me,s(me).name)),z(re,K)}),f(ee),f(se),Se(()=>ze(oe,`Existing Layouts (${i().length??""})`)),z(G,se)});var R=u(D,2),W=g(R);W.__click=w;var J=u(W,2);J.__click=_,Se(()=>J.disabled=!s(d).valid||!s(c).trim()||r()||s(p));var Z=g(J);Te(Z,r,G=>{var se=CO();ai(),z(G,se)},G=>{var se=fg("Save Layout");z(G,se)}),f(J),f(R),f(I),Se(()=>{M.disabled=r(),Fi(M,"border-error",s(F)),Fi(M,"border-success",s(V)),W.disabled=r()}),po(M,()=>s(c),G=>x(c,G)),z(S,I)},$$slots:{default:!0},$$legacy:!0}),hd()}qu(["keydown","click"]);var MO=fe('<span class="loading loading-spinner loading-xs"></span>'),AO=fe('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path></svg>'),TO=fe('<span class="text-xs text-warning">• Unsaved changes</span>'),LO=fe('<div class="p-4 bg-primary/5 border-b border-base-300/50"><div class="flex items-center gap-2 text-sm"><div class="w-2 h-2 bg-primary rounded-full"></div> <span class="font-medium text-base-content"> </span> <!></div> <div class="text-xs text-base-content/60 mt-1"> </div></div>'),FO=fe('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts yet</div>'),$O=fe('<div class="w-1.5 h-1.5 bg-primary rounded-full"></div>'),EO=fe('<div><div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-sm font-medium text-base-content truncate"> </span> <!></div> <div class="text-xs text-base-content/60"> </div></div> <button class="opacity-0 group-hover:opacity-100 p-1 hover:bg-error/20 rounded transition-all duration-150" title="Delete layout"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),NO=fe('<div class="p-4"><div class="text-xs font-medium text-base-content/70 px-2 py-2"> </div> <div class="space-y-1"></div></div>'),DO=fe('<div class="max-h-48 overflow-y-auto svelte-10s4pck"><!></div>'),jO=fe('<div class="fixed inset-0 bg-transparent z-40"></div> <div class="fixed z-50 bg-base-100 border border-base-300 rounded-lg shadow-xl animate-in fade-in zoom-in-95 duration-200"><div class="flex items-center justify-between p-4 border-b border-base-300/50"><h3 class="text-lg font-semibold text-base-content">Save Chart Layout</h3> <button class="btn btn-ghost btn-sm btn-circle" title="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-4 border-b border-base-300/50"><div class="space-y-2"><button class="w-full flex items-center gap-3 px-4 py-3 text-sm bg-primary text-primary-content hover:bg-primary/90 rounded-md transition-colors duration-150"><!> </button> <button class="w-full flex items-center gap-3 px-4 py-3 text-sm hover:bg-base-200 rounded-md transition-colors duration-150"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> Save As...</button> <button class="w-full flex items-center gap-3 px-4 py-3 text-sm hover:bg-base-200 rounded-md transition-colors duration-150"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> New Layout</button></div></div> <!> <!></div>',1);function RO(n,e){gd(e,!1);const t=Qd(),o=Qd();let i=Ws(e,"show",12,!1),r=Ws(e,"savedLayouts",24,()=>[]),a=Ws(e,"activeSaveId",8,null),l=Ws(e,"isLoading",8,!1),c=Ws(e,"hasUnsavedChanges",8,!1),d=Ws(e,"position",24,()=>({x:0,y:0})),p=Ws(e,"showLayouts",8,!0),m=Qd();const h=mv();function _(W){s(m)&&!s(m).contains(W.target)&&S()}function w(W){W.key==="Escape"&&S()}fv(()=>{console.log("🎯 ChartSavePopup mounted with props:",{show:i(),savedLayouts:r(),activeSaveId:a(),isLoading:l(),hasUnsavedChanges:c(),position:d()}),i()&&(document.addEventListener("click",_),document.addEventListener("keydown",w))}),Lm(()=>{document.removeEventListener("click",_),document.removeEventListener("keydown",w)});function S(){i(!1),h("close")}function P(){s(o)?h("quickSave"):(h("save"),S())}function I(){h("saveAs"),S()}function C(){h("newLayout"),S()}function M(W){h("load",{layoutId:W}),S()}function F(W,J){W.stopPropagation(),h("delete",{layoutId:J})}function V(W){return new Date(W).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function j(){const Z=document.querySelector(".chart-container")||document.querySelector(".kline-widget");if(!Z)return`left: ${d().x}px; top: ${d().y}px;`;const G=Z.getBoundingClientRect();let se=G.left+G.width/2-320/2,Y=G.top+G.height/2-400/2;return se=Math.max(20,Math.min(se,window.innerWidth-320-20)),Y=Math.max(20,Math.min(Y,window.innerHeight-400-20)),`left: ${se}px; top: ${Y}px;`}Jv(()=>(jv(a()),jv(r())),()=>{x(t,a()?r().find(W=>W.id===a()):null)}),Jv(()=>s(t),()=>{x(o,!!s(t))}),Jv(()=>(jv(i()),jv(r()),jv(a()),s(t),s(o)),()=>{var W;i()&&console.log("🔄 ChartSavePopup reactive update (visible):",{show:i(),savedLayouts:((W=r())==null?void 0:W.length)||0,savedLayoutsData:r(),activeSaveId:a(),activeLayout:s(t),hasActiveSave:s(o)})}),Jv(()=>jv(i()),()=>{i()?setTimeout(()=>{document.addEventListener("click",_),document.addEventListener("keydown",w)},0):(document.removeEventListener("click",_),document.removeEventListener("keydown",w))}),Eg(),Bv();var D=Ln(),R=Dt(D);Te(R,i,W=>{var J=jO(),Z=Dt(J),G=u(Z,2);const se=Rv(j);var Y=g(G),oe=u(g(Y),2);f(Y);var ee=u(Y,2),re=g(ee),me=g(re),K=g(me);Te(K,l,it=>{var Ye=MO();z(it,Ye)},it=>{var Ye=AO();z(it,Ye)});var ye=u(K);f(me);var Me=u(me,2),Fe=u(Me,2);f(re),f(ee);var Ze=u(ee,2);Te(Ze,()=>s(t),it=>{var Ye=LO(),ct=g(Ye),kt=u(g(ct),2),ft=g(kt);f(kt);var bt=u(kt,2);Te(bt,c,Qe=>{var yt=TO();z(Qe,yt)}),f(ct);var nt=u(ct,2),Pt=g(nt);Se(()=>ze(Pt,`Last saved: ${V(new Date(s(t).updatedAt).getTime())??""}`)),f(nt),f(Ye),Se(()=>ze(ft,`Active: ${s(t).name??""}`)),z(it,Ye)});var Ge=u(Ze,2);Te(Ge,p,it=>{var Ye=DO(),ct=g(Ye);Te(ct,()=>r().length===0,kt=>{var ft=FO();z(kt,ft)},kt=>{var ft=NO(),bt=g(ft),nt=g(bt);f(bt);var Pt=u(bt,2);vs(Pt,5,r,Vs,(Qe,yt)=>{var xe=EO(),Ve=g(xe),Je=g(Ve),St=g(Je),Ne=g(St,!0);f(St);var ue=u(St,2);Te(ue,()=>s(yt).id===a(),jt=>{var Zt=$O();z(jt,Zt)}),f(Je);var he=u(Je,2),_t=g(he,!0);Se(()=>ze(_t,V(new Date(s(yt).updatedAt).getTime()))),f(he),f(Ve);var Wt=u(Ve,2);f(xe),Se(()=>{Us(xe,`group flex items-center justify-between px-3 py-2 hover:bg-base-200 rounded-md transition-colors duration-150 cursor-pointer ${(s(yt).id===a()?"bg-primary/10":"")??""}`),ze(Ne,s(yt).name)}),sc("click",Wt,jt=>F(jt,s(yt).id)),sc("click",xe,()=>M(s(yt).id)),z(Qe,xe)}),f(Pt),f(ft),Se(()=>ze(nt,`Saved Layouts (${r().length??""})`)),z(kt,ft)}),f(Ye),z(it,Ye)}),f(G),Xu(G,it=>x(m,it),()=>s(m)),Se(()=>{zt(G,"style",s(se)),me.disabled=l(),ze(ye,` ${(s(o)?"Save to Current Layout":"Save New Layout")??""}`)}),sc("click",Z,S),sc("click",oe,S),sc("click",me,P),sc("click",Me,I),sc("click",Fe,C),z(W,J)}),z(n,D),hd()}var BO=fe('<div class="p-6 text-center text-base-content/60 text-sm"><span class="loading loading-spinner loading-xs"></span></div>'),OO=fe('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts yet</div>'),zO=fe('<div class="w-1.5 h-1.5 bg-primary rounded-full"></div>'),VO=fe('<div><div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-sm font-medium text-base-content truncate"> </span> <!></div> <div class="text-xs text-base-content/60"> </div></div> <button class="opacity-0 group-hover:opacity-100 p-1 hover:bg-error/20 rounded transition-all duration-150" title="Delete layout"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),WO=fe('<div class="p-4"><div class="text-xs font-medium text-base-content/70 px-2 py-2"> </div> <div class="space-y-1"></div></div>'),qO=fe('<div class="fixed inset-0 bg-transparent z-40"></div> <div class="fixed z-50 bg-base-100 border border-base-300 rounded-lg shadow-xl animate-in fade-in zoom-in-95 duration-200"><div class="flex items-center justify-between p-4 border-b border-base-300/50"><h3 class="text-lg font-semibold text-base-content">Load Chart Layout</h3> <button class="btn btn-ghost btn-sm btn-circle" title="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="max-h-80 overflow-y-auto svelte-ciowbr"><!></div></div>',1);function HO(n,e){gd(e,!1);let t=Ws(e,"show",12,!1),o=Ws(e,"savedLayouts",24,()=>[]),i=Ws(e,"activeSaveId",8,null),r=Ws(e,"isLoading",8,!1),a=Ws(e,"position",24,()=>({x:0,y:0})),l=Qd();const c=mv();function d(M){s(l)&&!s(l).contains(M.target)&&m()}function p(M){M.key==="Escape"&&m()}fv(()=>{t()&&(document.addEventListener("click",d),document.addEventListener("keydown",p))}),Lm(()=>{document.removeEventListener("click",d),document.removeEventListener("keydown",p)});function m(){t(!1),c("close")}function h(M){c("load",{layoutId:M}),m()}function _(M){M!==i()&&h(M)}function w(M,F){M.stopPropagation(),c("delete",{layoutId:F})}function S(M){return new Date(M).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function P(){const V=document.querySelector(".chart-container")||document.querySelector(".kline-widget");if(!V)return`left: ${a().x}px; top: ${a().y}px;`;const j=V.getBoundingClientRect();let D=j.left+j.width/2-320/2,R=j.top+j.height/2-400/2;return D=Math.max(20,Math.min(D,window.innerWidth-320-20)),R=Math.max(20,Math.min(R,window.innerHeight-400-20)),`left: ${D}px; top: ${R}px;`}Jv(()=>jv(t()),()=>{t()?setTimeout(()=>{document.addEventListener("click",d),document.addEventListener("keydown",p)},0):(document.removeEventListener("click",d),document.removeEventListener("keydown",p))}),Eg(),Bv();var I=Ln(),C=Dt(I);Te(C,t,M=>{var F=qO(),V=Dt(F),j=u(V,2);const D=Rv(P);var R=g(j),W=u(g(R),2);f(R);var J=u(R,2),Z=g(J);Te(Z,r,G=>{var se=BO();z(G,se)},G=>{var se=Ln(),Y=Dt(se);Te(Y,()=>o().length===0,oe=>{var ee=OO();z(oe,ee)},oe=>{var ee=WO(),re=g(ee),me=g(re);f(re);var K=u(re,2);vs(K,5,o,Vs,(ye,Me)=>{var Fe=VO(),Ze=g(Fe),Ge=g(Ze),it=g(Ge),Ye=g(it,!0);f(it);var ct=u(it,2);Te(ct,()=>s(Me).id===i(),nt=>{var Pt=zO();z(nt,Pt)}),f(Ge);var kt=u(Ge,2),ft=g(kt,!0);Se(()=>ze(ft,S(new Date(s(Me).updatedAt).getTime()))),f(kt),f(Ze);var bt=u(Ze,2);f(Fe),Se(()=>{Us(Fe,`group flex items-center justify-between px-3 py-2 hover:bg-base-200 rounded-md transition-colors duration-150 cursor-pointer ${(s(Me).id===i()?"bg-primary/10":"")??""}`),ze(Ye,s(Me).name)}),sc("click",bt,nt=>w(nt,s(Me).id)),sc("click",Fe,()=>_(s(Me).id)),z(ye,Fe)}),f(K),f(ee),Se(()=>ze(me,`Saved Layouts (${o().length??""})`)),z(oe,ee)},!0),z(G,se)}),f(J),f(j),Xu(j,G=>x(l,G),()=>s(l)),Se(()=>zt(j,"style",s(D))),sc("click",V,m),sc("click",W,m),z(M,F)}),z(n,I),hd()}function UO(n,e,t){s(e)?(console.log("💾 SaveAsSelectModal dispatching saveTo event with layoutId:",s(e)),t("saveTo",{layoutId:s(e)})):console.log("❌ SaveAsSelectModal: No layout selected")}function GO(n,e){e("back")}function YO(n,e){e("cancel")}var KO=fe('<div class="p-6 text-center text-base-content/60 text-sm"><span class="loading loading-spinner loading-xs"></span></div>'),ZO=fe('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts found.</div>'),XO=fe('<label class="flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-base-200"><input type="radio" name="save-as-target" class="radio radio-primary"> <div class="flex-1 min-w-0"><div class="text-sm font-medium text-base-content truncate"> </div> <div class="text-xs text-base-content/60"> </div></div></label>'),JO=fe('<span class="loading loading-spinner loading-xs"></span> Saving...',1),QO=fe('<div class="space-y-4"><div class="flex items-center justify-between"><button class="btn btn-ghost btn-sm" title="Back">← Back</button> <div></div></div> <div class="text-sm text-base-content/70">Select a saved layout to overwrite with the current chart.</div> <div class="max-h-80 overflow-y-auto divide-y divide-base-300/50 rounded-lg border border-base-300/50 svelte-1a3gcnl"><!></div> <div class="flex justify-end gap-3 pt-2"><button class="btn btn-ghost">Cancel</button> <button class="btn btn-primary"><!></button></div></div>');function ez(n,e){gd(e,!1);const t=[];let o=Ws(e,"show",12,!1),i=Ws(e,"savedLayouts",24,()=>[]),r=Ws(e,"isLoading",8,!1),a=Qd(null);const l=mv();Jv(()=>jv(o()),()=>{o()&&x(a,null)}),Eg(),Bv(),vf(n,{get show(){return o()},set show(c){o(c)},title:"Save As: Choose Layout to Overwrite",width:520,buttons:[],children:(c,d)=>{var p=QO(),m=g(p),h=g(m);h.__click=[GO,l],ai(2),f(m);var _=u(m,4),w=g(_);Te(w,r,M=>{var F=KO();z(M,F)},M=>{var F=Ln(),V=Dt(F);Te(V,()=>i().length===0,j=>{var D=ZO();z(j,D)},j=>{var D=Ln(),R=Dt(D);vs(R,1,i,Vs,(W,J)=>{var Z=XO(),G=g(Z);Qt(G);var se,Y=u(G,2),oe=g(Y),ee=g(oe,!0);f(oe);var re=u(oe,2),me=g(re,!0);Se(()=>ze(me,new Date(s(J).updatedAt).toLocaleString())),f(re),f(Y),f(Z),Se(()=>{se!==(se=s(J).id)&&(G.value=(G.__value=s(J).id)==null?"":s(J).id),ze(ee,s(J).name)}),xk(t,[],G,()=>(s(J).id,s(a)),K=>x(a,K)),z(W,Z)}),z(j,D)},!0),z(M,F)}),f(_);var S=u(_,2),P=g(S);P.__click=[YO,l];var I=u(P,2);I.__click=[UO,a,l];var C=g(I);Te(C,r,M=>{var F=JO();ai(),z(M,F)},M=>{var F=fg("Save");z(M,F)}),f(I),f(S),f(p),Se(()=>{P.disabled=r(),I.disabled=!s(a)||r()}),z(c,p)},$$slots:{default:!0},$$legacy:!0}),hd()}qu(["click"]);function tz(n,e,t,o,i,r,a){if(!e()){x(t,!0);return}Iw("normal"),n0(!0),ww(o().symbol),r(!1),a("close");try{window.predictNextCandle&&window.predictNextCandle()}catch{}}function nz(n,e,t,o,i,r){if(!e()){x(t,!0);return}ww(o().symbol),x(r,"deposit")}function oz(n,e,t,o,i,r){if(!e()){x(t,!0),x(o,"choose");return}kw(s(i)),Sw(Math.max(0,Number(s(r))||0)),x(o,"leverage")}function Bb(n,e,t,o,i,r,a,l){if(!e()){x(t,!0),x(o,"choose");return}Cw(s(i)?s(r)||100:null),Pw(!0),Iw("strategy"),a(!1),l("close");const c=window.sidebarHostRef;c&&c.openSidebar&&c.openSidebar()}var sz=fe('<div class="grid grid-cols-1 md:grid-cols-2 gap-3 items-stretch svelte-ju0qho"><div class="card lux-card shadow overflow-hidden h-full svelte-ju0qho"><div class="card-body p-4 min-w-0 flex flex-col h-full svelte-ju0qho"><div class="flex items-center gap-2 svelte-ju0qho"><div class="text-sm font-semibold svelte-ju0qho">Normal Price Simulator</div></div> <div class="text-xs opacity-70 mt-1 svelte-ju0qho">Auto-play historical candles to simulate price movement.</div> <div class="mt-auto pt-3 svelte-ju0qho"><button class="btn btn-premium-primary w-full svelte-ju0qho" type="button">Start Normal Mode</button></div></div></div> <div class="card lux-card shadow overflow-hidden h-full svelte-ju0qho"><div class="card-body p-4 min-w-0 flex flex-col h-full svelte-ju0qho"><div class="flex items-center gap-2 svelte-ju0qho"><div class="p-2 rounded-full bg-base-300/60 svelte-ju0qho"><!></div> <div class="text-sm font-semibold svelte-ju0qho">Trade Strategy Test</div></div> <div class="text-xs opacity-70 mt-1 svelte-ju0qho">Deposit, set leverage, buy/pending orders, and track portfolio & PnL.</div> <div class="mt-auto pt-3 svelte-ju0qho"><button class="btn btn-premium-outline w-full svelte-ju0qho" type="button">Start Strategy Mode</button></div></div></div></div>'),iz=(n,e)=>x(e,"choose"),rz=fe('<option class="svelte-ju0qho"> </option>'),az=fe('<div class="card lux-card shadow overflow-hidden svelte-ju0qho"><div class="card-body p-4 min-w-0 svelte-ju0qho"><div class="text-sm font-semibold svelte-ju0qho">Confirm Deposit</div> <div class="mt-2 flex items-center svelte-ju0qho"><button class="btn btn-xs btn-premium-outline svelte-ju0qho" type="button">Back</button></div> <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2 items-end svelte-ju0qho"><div class="flex flex-col gap-1 svelte-ju0qho"><div class="text-xs opacity-80 svelte-ju0qho">Currency</div> <select class="select select-bordered select-sm svelte-ju0qho"></select></div> <input class="input input-bordered input-sm svelte-ju0qho" type="number" min="0" placeholder="Deposit"> <button class="btn btn-sm btn-premium-primary svelte-ju0qho" type="button">Confirm Deposit</button></div></div></div>'),lz=(n,e)=>x(e,"deposit"),cz=(n,e)=>x(e,!0),dz=(n,e)=>x(e,!1),uz=fe('<div class="mt-2 flex items-center gap-2 svelte-ju0qho"><select class="select select-bordered select-sm svelte-ju0qho"><option class="svelte-ju0qho">1:50</option><option class="svelte-ju0qho">1:100</option><option class="svelte-ju0qho">1:200</option><option class="svelte-ju0qho">1:400</option><option class="svelte-ju0qho">1:500</option></select> <button class="btn btn-sm btn-premium-primary svelte-ju0qho" type="button">Confirm</button></div>'),pz=fe('<div class="mt-2 svelte-ju0qho"><button class="btn btn-sm btn-premium-outline svelte-ju0qho" type="button">Confirm</button></div>'),vz=fe('<div class="card lux-card shadow overflow-hidden svelte-ju0qho"><div class="card-body p-4 min-w-0 svelte-ju0qho"><div class="text-sm font-semibold svelte-ju0qho">Take leverage?</div> <div class="mt-2 flex items-center svelte-ju0qho"><button class="btn btn-xs btn-premium-outline svelte-ju0qho" type="button">Back</button></div> <div class="mt-2 flex items-center gap-2 svelte-ju0qho"><label class="label cursor-pointer svelte-ju0qho"><input type="radio" name="lev-modal" class="radio radio-sm svelte-ju0qho"> <span class="label-text ml-2 svelte-ju0qho">Yes</span></label> <label class="label cursor-pointer svelte-ju0qho"><input type="radio" name="lev-modal" class="radio radio-sm svelte-ju0qho"> <span class="label-text ml-2 svelte-ju0qho">No</span></label></div> <!></div></div>'),fz=fe('<div class="p-3 space-y-3 svelte-ju0qho"><!></div>'),mz=(n,e)=>x(e,!1),gz=(n,e)=>x(e,!1),hz=fe('<div class="premium-modal-backdrop svelte-ju0qho" role="presentation"></div> <div class="premium-modal-container svelte-ju0qho" role="dialog" aria-modal="true" aria-labelledby="sim-premium-title"><div class="premium-background svelte-ju0qho"><div class="premium-orb premium-orb-1 svelte-ju0qho"></div> <div class="premium-orb premium-orb-2 svelte-ju0qho"></div></div> <div class="premium-content svelte-ju0qho"><button class="premium-close-btn svelte-ju0qho" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-ju0qho"><line x1="18" y1="6" x2="6" y2="18" class="svelte-ju0qho"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-ju0qho"></line></svg></button> <div class="premium-icon-wrapper svelte-ju0qho"><div class="premium-icon svelte-ju0qho"><!> <div class="premium-icon-glow svelte-ju0qho"></div></div></div> <h2 id="sim-premium-title" class="premium-title svelte-ju0qho">Premium Feature</h2> <p class="premium-message svelte-ju0qho">Simulator Normal + Strategy modes are AI Pro exclusives. Unlock them to stress-test setups, fast-forward price action, and train with live-like executions.</p> <div class="premium-features svelte-ju0qho"><div class="premium-feature-item svelte-ju0qho"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-ju0qho"><polyline points="20 6 9 17 4 12" class="svelte-ju0qho"></polyline></svg> <span class="svelte-ju0qho">Lightning-fast Normal Simulator</span></div> <div class="premium-feature-item svelte-ju0qho"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-ju0qho"><polyline points="20 6 9 17 4 12" class="svelte-ju0qho"></polyline></svg> <span class="svelte-ju0qho">Strategy Mode with deposits, leverage, and PnL</span></div> <div class="premium-feature-item svelte-ju0qho"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-ju0qho"><polyline points="20 6 9 17 4 12" class="svelte-ju0qho"></polyline></svg> <span class="svelte-ju0qho">Priority AI signals & future pro drops</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-ju0qho"><span class="svelte-ju0qho">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-ju0qho"><line x1="5" y1="12" x2="19" y2="12" class="svelte-ju0qho"></line><polyline points="12 5 19 12 12 19" class="svelte-ju0qho"></polyline></svg></a></div></div>',1),_z=fe("<!> <!>",1);function yz(n,e){gd(e,!0);const t=wp(),o=()=>ya(m,"$save",t),i=()=>ya(Fm,"$userPreferences",t);let r=Ws(e,"show",15),a=ae("choose"),l=ae(1e5),c=ae(!1),d=ae(null),p=ae(!1);const m=Kc("save");let h=ae(N(o().symbol.priceCurrency||"USD"));const _=mv();function w(j){j==="close"&&_("close")}function S(){var D;const j=(D=i())==null?void 0:D.data;return(j==null?void 0:j.isPremium)===!0||(j==null?void 0:j.isTrial)===!0}const P=Ng(),[I,C]=P;var M=_z(),F=Dt(M);vf(F,{get show(){return r()},set show(j){r(j)},title:"Choose Simulator Mode",buttons:[],click:w,get theme(){return o().theme},children:(j,D)=>{var R=fz(),W=g(R);Te(W,()=>s(a)==="choose",J=>{var Z=sz(),G=g(Z),se=g(G),Y=u(g(se),4),oe=g(Y);oe.__click=[tz,S,p,o,m,r,_],f(Y),f(se),f(G);var ee=u(G,2),re=g(ee),me=g(re),K=g(me),ye=g(K);ZL(ye,{size:18}),f(K),ai(2),f(me);var Me=u(me,4),Fe=g(Me);Fe.__click=[nz,S,p,o,m,a],f(Me),f(re),f(ee),f(Z),z(J,Z)},J=>{var Z=Ln(),G=Dt(Z);Te(G,()=>s(a)==="deposit",se=>{var Y=az(),oe=g(Y),ee=u(g(oe),2),re=g(ee);re.__click=[iz,a],f(ee);var me=u(ee,2),K=g(me),ye=u(g(K),2);vs(ye,21,()=>Tw,Vs,(Ze,Ge)=>{var it=rz(),Ye={},ct=g(it,!0);f(it),Se(()=>{Ye!==(Ye=s(Ge))&&(it.value=(it.__value=s(Ge))==null?"":s(Ge)),ze(ct,s(Ge))}),z(Ze,it)}),f(ye),f(K);var Me=u(K,2);Qt(Me);var Fe=u(Me,2);Fe.__click=[oz,S,p,a,h,l],f(me),f(oe),f(Y),qo(ye,()=>s(h),Ze=>x(h,Ze)),po(Me,()=>s(l),Ze=>x(l,Ze)),z(se,Y)},se=>{var Y=vz(),oe=g(Y),ee=u(g(oe),2),re=g(ee);re.__click=[lz,a],f(ee);var me=u(ee,2),K=g(me),ye=g(K);Qt(ye),ye.__click=[cz,c],ai(2),f(K);var Me=u(K,2),Fe=g(Me);Qt(Fe),Fe.__click=[dz,c],ai(2),f(Me),f(me);var Ze=u(me,2);Te(Ze,()=>s(c),Ge=>{var it=uz(),Ye=g(it),ct=g(Ye);ct.value=(ct.__value=50)==null?"":50;var kt=u(ct);kt.value=(kt.__value=100)==null?"":100;var ft=u(kt);ft.value=(ft.__value=200)==null?"":200;var bt=u(ft);bt.value=(bt.__value=400)==null?"":400;var nt=u(bt);nt.value=(nt.__value=500)==null?"":500,f(Ye);var Pt=u(Ye,2);Pt.__click=[Bb,S,p,a,c,d,r,_],f(it),qo(Ye,()=>s(d),Qe=>x(d,Qe)),z(Ge,it)},Ge=>{var it=pz(),Ye=g(it);Ye.__click=[Bb,S,p,a,c,d,r,_],f(it),z(Ge,it)}),f(oe),f(Y),Se(()=>{Qv(ye,s(c)),Qv(Fe,!s(c))}),z(se,Y)},!0),z(J,Z)}),f(R),z(j,R)},$$slots:{default:!0}});var V=u(F,2);Te(V,()=>s(p),j=>{var D=hz(),R=Dt(D);R.__click=[mz,p];var W=u(R,2),J=u(g(W),2),Z=g(J);Z.__click=[gz,p];var G=u(Z,2),se=g(G),Y=g(se);qL(Y,{size:34}),ai(2),f(se),f(G);var oe=u(G,8);Se(()=>zt(oe,"href",I("https://dutyai.app/settings/investor?device=1",void 0))),f(J),f(W),Mf(3,R,()=>Fg,()=>({duration:200})),Mf(3,W,()=>Qh,()=>({y:18,duration:260})),z(j,D)}),z(n,M),hd()}qu(["click"]);var bz=fe('<div class="toast svelte-66mo1o"><span class="toast-message svelte-66mo1o"> </span></div>');function Gw(n,e){gd(e,!1);let t=Ws(e,"message",8,""),o=Ws(e,"duration",8,3e3),i=Ws(e,"visible",12,!1);const r=mv();let a=Qd();fv(()=>{i()&&l()});function l(){i(!0),setTimeout(()=>{c()},o())}function c(){i(!1),r("hide")}Bv();var d=Ln(),p=Dt(d);return Te(p,i,m=>{var h=bz(),_=g(h),w=g(_,!0);f(_),f(h),Xu(h,S=>x(a,S),()=>s(a)),Se(()=>{Fi(h,"show",i()),ze(w,t())}),z(m,h)}),z(n,d),Ey(e,"showToast",l),Ey(e,"hideToast",c),hd({showToast:l,hideToast:c})}function xz(n,e,t,o,i,r,a){const l=e().theme==="dark"?"light":"dark";if(o()){x(i,N(l)),x(r,!0);return}a(l,!0)}function wz(n,e,t,o){s(e)&&(t(s(e),!0),x(o,!1),x(e,null))}function kz(n,e,t,o){s(e)&&(t(s(e),!1),x(o,!1),x(e,null))}function Sz(n,e,t,o,i,r,a,l){const c=n.target;if(!c.files||!c.files.length)return;const d=c.files[0],p=d.name.split(".").shift()||"Unknown";eE.parse(d,{skipEmptyLines:!0,complete:m=>{var _;const h=m.data.map(w=>({timestamp:parseInt(w[0]),open:parseFloat(w[1]),high:parseFloat(w[2]),low:parseFloat(w[3]),close:parseFloat(w[4]),volume:parseFloat(w[5])}));if(x(e,N(p)),h.length>1){const w=h.length-1,S=Math.min(h[1].timestamp-h[0].timestamp,h[w].timestamp-h[w-1].timestamp);kl(o,rs(t).period=Cf(f8(S/1e3)),rs(t))}h.length>0&&cT(Math.min(h[0].low,h[h.length-1].low))+3,(_=i())==null||_.applyNewData(h,!1),kl(l,rs(a).loadingKLine=!1,rs(a)),kl(l,rs(a).klineLoaded+=1,rs(a))}})}function Cz(n,e,t,o,i){const r=!s(e);x(e,r);try{sessionStorage.setItem("drawbarShown",String(r))}catch{}try{const a=t();a&&a.style.setProperty("--drawing-bar-width",r?"52px":"0px");const l=typeof document<"u"?document.querySelector(".kline-main"):null;l&&l.style.setProperty("--drawing-bar-width",r?"52px":"0px");const c=typeof document<"u"?document.querySelector(".drawbar-host"):null;c&&(c.style.width=r?"52px":"0px",c.style.overflow="hidden");const d=typeof document<"u"?document.querySelector(".drawbar-container"):null;d&&r&&(d.style.borderRightWidth="2px",d.style.borderRightStyle="solid",d.style.borderRightColor="var(--menu-border)");const p=typeof document<"u"?document.querySelector(".drawbar-wrapper"):null;p&&r&&(p.style.display="")}catch{}requestAnimationFrame(()=>{var a;(a=o())==null||a.resize()})}async function Pz(n,e,t,o,i,r,a,l,c,d,p,m){if(!s(e)){x(e,!0);try{if(s(t))if(o())try{d();let h=!1;if(document.webkitExitFullscreen)try{document.webkitExitFullscreen(),h=!0}catch(_){console.log("webkitExitFullscreen failed:",_)}if(window.iosFullscreenCleanup)try{window.iosFullscreenCleanup(),delete window.iosFullscreenCleanup,h=!0}catch(_){console.log("iOS cleanup function failed:",_)}if(!h)try{document.body.classList.remove("ios-fullscreen");const _=document.getElementById("ios-fullscreen-style");_&&_.remove();const w=document.querySelector('meta[name="viewport"]');w&&w.setAttribute("content","width=device-width, initial-scale=1.0")}catch(_){console.log("Manual iOS cleanup failed:",_)}x(t,!1),x(p,!1),setTimeout(()=>{a()&&a().resize(),setTimeout(()=>{x(e,!1)},50)},150)}catch(h){console.log("iOS exit rotation failed:",h),x(t,!1),x(p,!1),x(e,!1)}else{try{"screen"in window&&"orientation"in window.screen&&"unlock"in window.screen.orientation&&window.screen.orientation.unlock()}catch(h){console.log("Screen orientation unlock failed:",h)}await m(),x(t,!1),a()?setTimeout(()=>{a().resize(),setTimeout(()=>{x(e,!1)},50)},150):setTimeout(()=>{x(e,!1)},50)}else if(o())try{await i(),window.DeviceOrientationEvent&&r(),x(t,!0),setTimeout(()=>{window.scrollTo(0,1),setTimeout(()=>{window.scrollTo(0,0),a()&&a().resize(),setTimeout(()=>{x(e,!1)},50)},50)},100)}catch(h){console.log("iOS rotation setup failed:",h),x(t,!0),x(e,!1)}else await c(),setTimeout(async()=>{try{"screen"in window&&"orientation"in window.screen&&"lock"in window.screen.orientation?await window.screen.orientation.lock("landscape"):console.log("Screen Orientation API not supported. Please rotate your device manually.")}catch(h){console.log("Screen orientation lock failed:",h)}x(t,!0),a()?setTimeout(()=>{a().resize(),setTimeout(()=>{x(e,!1)},50)},100):setTimeout(()=>{x(e,!1)},50)},50)}catch(h){console.error("Rotation failed:",h),x(t,!1),x(e,!1)}}}function Iz(n,e,t,o){if(e()){const i=e().querySelector(".chart-container");if(i){const r=i.getBoundingClientRect();x(t,N({x:r.left+r.width/2,y:r.top+r.height/2}))}else{const r=e().getBoundingClientRect();x(t,N({x:r.left+r.width/2,y:r.top+r.height/2}))}}x(o,!0)}var Mz=fe('<div class="save-overlay svelte-d8izos"><div class="save-success svelte-d8izos">Saved to current layout</div></div>'),Az=(n,e)=>{var t;return(t=s(e))==null?void 0:t.click()},Tz=fe('<div class="custom-load-section svelte-d8izos"><input type="file" class="hidden svelte-d8izos" accept="text/csv"> <button class="custom-load-btn svelte-d8izos"><span class="custom-load-text svelte-d8izos">打开</span> <div class="custom-load-glow svelte-d8izos"></div></button></div>'),Lz=fe('<div class="rotate-loading-overlay svelte-d8izos"><div class="rotate-loading-spinner svelte-d8izos"><div class="rotate-spinner-ring svelte-d8izos"></div> <div class="rotate-spinner-ring svelte-d8izos"></div> <div class="rotate-spinner-ring svelte-d8izos"></div></div> <div class="rotate-loading-text svelte-d8izos">Rotating...</div></div>'),Fz=gr('<path d="M322.402 1.33524C319.002 2.83524 282.402 41.3352 279.802 46.2352C277.602 50.4352 277.602 56.6352 279.802 60.9352C282.102 65.5352 317.402 107.535 320.802 109.735C324.702 112.235 335.002 112.035 338.602 109.335C345.002 104.635 347.402 97.6352 345.002 90.4352C344.302 88.4352 340.902 83.3352 337.402 79.1352C333.902 74.9352 331.302 71.3352 331.502 71.1352C331.702 70.8352 334.802 71.2352 338.202 71.8352C379.802 79.7352 409.802 111.735 415.002 153.835C416.302 163.835 417.802 167.035 422.702 170.435C430.002 175.335 440.902 173.135 445.702 165.735C448.202 162.135 448.302 161.435 447.702 152.135C446.102 124.435 432.902 96.5352 411.102 74.9352C390.202 54.0352 367.102 42.7352 336.702 38.4352L331.902 37.8352L338.402 30.9352C345.302 23.5352 347.002 18.9352 345.502 12.0352C343.502 2.73524 331.702 -2.66476 322.402 1.33524Z" fill="currentColor" class="svelte-d8izos"></path><path d="M169.504 40.9358C163.204 42.2358 157.004 44.7358 152.004 47.9358C149.504 49.5358 125.204 73.2358 97.8044 100.636C44.9044 153.736 44.8044 153.936 41.4044 167.236C39.3044 175.336 40.0044 188.336 43.0044 196.136C44.1044 199.336 47.1044 204.436 49.4044 207.636C51.8044 210.836 95.8043 255.336 147.104 306.536C217.704 376.836 241.704 400.236 245.604 402.236C259.904 409.736 277.304 409.836 292.304 402.336C296.404 400.336 308.404 388.836 348.304 349.136C393.904 303.636 399.404 297.736 402.504 291.736C406.904 282.936 408.404 275.436 407.704 265.436C407.104 255.636 404.304 247.836 398.604 240.236C396.204 237.036 352.404 192.736 301.404 141.836C200.004 40.8358 204.204 44.5358 189.304 41.4358C181.904 39.8358 175.704 39.7358 169.504 40.9358ZM185.804 74.8358C187.904 75.9358 229.704 117.136 281.704 169.136C363.504 251.136 373.904 261.836 374.504 265.236C376.204 274.436 377.804 272.436 326.204 324.336C299.004 351.536 277.104 372.736 275.304 373.536C270.904 375.436 266.604 375.336 262.204 373.036C257.604 370.636 76.8043 189.636 74.6043 185.236C72.4043 180.936 72.6043 175.636 75.0043 170.936C78.3043 164.336 78.8044 164.436 94.8044 172.336C108.704 179.136 109.704 179.436 117.404 179.736C123.904 180.036 126.704 179.636 131.504 177.936C136.904 175.836 139.304 173.836 156.604 156.536C173.904 139.236 175.904 136.836 178.004 131.436C179.704 126.636 180.104 123.836 179.804 117.336C179.504 109.636 179.204 108.636 172.404 94.7358C164.504 78.8358 164.504 78.3358 170.804 74.9358C175.604 72.4358 181.104 72.4358 185.804 74.8358ZM133.404 133.036L119.404 147.036L112.204 143.736L105.004 140.436L122.804 122.636L140.504 104.936L144.004 111.936L147.504 118.936L133.404 133.036Z" fill="currentColor" class="svelte-d8izos"></path><path d="M310.402 275.936C308.602 276.336 305.902 277.536 304.402 278.736C299.102 282.436 278.102 304.436 277.102 307.336C275.502 311.236 275.802 318.536 277.502 321.836C280.902 328.436 288.102 331.836 295.802 330.436C298.802 329.836 302.002 327.236 313.902 315.636C321.802 307.836 328.902 300.036 329.602 298.236C334.902 285.836 323.602 272.736 310.402 275.936Z" fill="currentColor" class="svelte-d8izos"></path><path d="M7.40372 276.837C-0.296283 281.537 -1.79628 290.337 2.00372 309.037C12.9037 362.537 55.5037 401.637 111.304 409.437L116.104 410.037L109.604 416.937C102.704 424.337 101.004 428.937 102.504 435.837C104.504 445.137 116.004 450.537 125.304 446.537C128.904 445.037 165.304 407.037 168.304 401.637C170.504 397.537 170.504 391.337 168.204 386.937C165.904 382.337 130.604 340.337 127.204 338.137C123.304 335.637 113.004 335.837 109.404 338.537C103.004 343.237 100.604 350.237 103.004 357.437C103.704 359.437 107.104 364.537 110.604 368.737C114.104 372.937 116.704 376.537 116.504 376.737C116.304 377.037 113.204 376.637 109.804 376.037C79.4037 370.237 54.9037 351.637 41.9037 324.437C36.6037 313.337 34.4037 305.937 32.9037 293.737C31.7037 284.037 30.2037 280.837 25.3037 277.437C20.5037 274.237 12.1037 273.937 7.40372 276.837Z" fill="currentColor" class="svelte-d8izos"></path>',1),$z=gr('<path d="M322.402 1.33524C319.002 2.83524 282.402 41.3352 279.802 46.2352C277.602 50.4352 277.602 56.6352 279.802 60.9352C282.102 65.5352 317.402 107.535 320.802 109.735C324.702 112.235 335.002 112.035 338.602 109.335C345.002 104.635 347.402 97.6352 345.002 90.4352C344.302 88.4352 340.902 83.3352 337.402 79.1352C333.902 74.9352 331.302 71.3352 331.502 71.1352C331.702 70.8352 334.802 71.2352 338.202 71.8352C379.802 79.7352 409.802 111.735 415.002 153.835C416.302 163.835 417.802 167.035 422.702 170.435C430.002 175.335 440.902 173.135 445.702 165.735C448.202 162.135 448.302 161.435 447.702 152.135C446.102 124.435 432.902 96.5352 411.102 74.9352C390.202 54.0352 367.102 42.7352 336.702 38.4352L331.902 37.8352L338.402 30.9352C345.302 23.5352 347.002 18.9352 345.502 12.0352C343.502 2.73524 331.702 -2.66476 322.402 1.33524Z" fill="currentColor" class="svelte-d8izos"></path><path d="M169.504 40.9358C163.204 42.2358 157.004 44.7358 152.004 47.9358C149.504 49.5358 125.204 73.2358 97.8044 100.636C44.9044 153.736 44.8044 153.936 41.4044 167.236C39.3044 175.336 40.0044 188.336 43.0044 196.136C44.1044 199.336 47.1044 204.436 49.4044 207.636C51.8044 210.836 95.8043 255.336 147.104 306.536C217.704 376.836 241.704 400.236 245.604 402.236C259.904 409.736 277.304 409.836 292.304 402.336C296.404 400.336 308.404 388.836 348.304 349.136C393.904 303.636 399.404 297.736 402.504 291.736C406.904 282.936 408.404 275.436 407.704 265.436C407.104 255.636 404.304 247.836 398.604 240.236C396.204 237.036 352.404 192.736 301.404 141.836C200.004 40.8358 204.204 44.5358 189.304 41.4358C181.904 39.8358 175.704 39.7358 169.504 40.9358ZM185.804 74.8358C187.904 75.9358 229.704 117.136 281.704 169.136C363.504 251.136 373.904 261.836 374.504 265.236C376.204 274.436 377.804 272.436 326.204 324.336C299.004 351.536 277.104 372.736 275.304 373.536C270.904 375.436 266.604 375.336 262.204 373.036C257.604 370.636 76.8043 189.636 74.6043 185.236C72.4043 180.936 72.6043 175.636 75.0043 170.936C78.3043 164.336 78.8044 164.436 94.8044 172.336C108.704 179.136 109.704 179.436 117.404 179.736C123.904 180.036 126.704 179.636 131.504 177.936C136.904 175.836 139.304 173.836 156.604 156.536C173.904 139.236 175.904 136.836 178.004 131.436C179.704 126.636 180.104 123.836 179.804 117.336C179.504 109.636 179.204 108.636 172.404 94.7358C164.504 78.8358 164.504 78.3358 170.804 74.9358C175.604 72.4358 181.104 72.4358 185.804 74.8358ZM133.404 133.036L119.404 147.036L112.204 143.736L105.004 140.436L122.804 122.636L140.504 104.936L144.004 111.936L147.504 118.936L133.404 133.036Z" fill="currentColor" class="svelte-d8izos"></path><path d="M310.402 275.936C308.602 276.336 305.902 277.536 304.402 278.736C299.102 282.436 278.102 304.436 277.102 307.336C275.502 311.236 275.802 318.536 277.502 321.836C280.902 328.436 288.102 331.836 295.802 330.436C298.802 329.836 302.002 327.236 313.902 315.636C321.802 307.836 328.902 300.036 329.602 298.236C334.902 285.836 323.602 272.736 310.402 275.936Z" fill="currentColor" class="svelte-d8izos"></path><path d="M7.40372 276.837C-0.296283 281.537 -1.79628 290.337 2.00372 309.037C12.9037 362.537 55.5037 401.637 111.304 409.437L116.104 410.037L109.604 416.937C102.704 424.337 101.004 428.937 102.504 435.837C104.504 445.137 116.004 450.537 125.304 446.537C128.904 445.037 165.304 407.037 168.304 401.637C170.504 397.537 170.504 391.337 168.204 386.937C165.904 382.337 130.604 340.337 127.204 338.137C123.304 335.637 113.004 335.837 109.404 338.537C103.004 343.237 100.604 350.237 103.004 357.437C103.704 359.437 107.104 364.537 110.604 368.737C114.104 372.937 116.704 376.537 116.504 376.737C116.304 377.037 113.204 376.637 109.804 376.037C79.4037 370.237 54.9037 351.637 41.9037 324.437C36.6037 313.337 34.4037 305.937 32.9037 293.737C31.7037 284.037 30.2037 280.837 25.3037 277.437C20.5037 274.237 12.1037 273.937 7.40372 276.837Z" fill="currentColor" class="svelte-d8izos"></path>',1),Ez=(n,e)=>x(e,!0),Nz=(n,e,t)=>e(s(t)),Dz=fe('<button><span class="timeframe-text svelte-d8izos"> </span> <div class="timeframe-glow svelte-d8izos"></div></button>'),jz=(n,e,t)=>e(t[0]),Rz=fe('<button><span class="timeframe-text svelte-d8izos">4h</span> <div class="timeframe-glow svelte-d8izos"></div></button>'),Bz=(n,e,t)=>e(s(t)),Oz=fe('<button><span class="timeframe-text svelte-d8izos"> </span> <div class="timeframe-glow svelte-d8izos"></div></button>'),zz=fe('<div class="timeframe-group desktop-only svelte-d8izos"><!> <!> <!></div>'),Vz=(n,e,t)=>e(t.find(o=>o.timeframe==="1d")),Wz=fe('<button><span class="timeframe-text svelte-d8izos">1d</span> <div class="timeframe-glow svelte-d8izos"></div></button>'),qz=(n,e,t)=>e(t.find(o=>o.timeframe==="1w")),Hz=fe('<button><span class="timeframe-text svelte-d8izos">1w</span> <div class="timeframe-glow svelte-d8izos"></div></button>'),Uz=(n,e)=>x(e,!s(e)),Gz=(n,e,t)=>e(s(t)),Yz=fe('<button><span class="timeframe-text svelte-d8izos"> </span> <div class="timeframe-glow svelte-d8izos"></div></button>'),Kz=(n,e,t)=>e(t[0]),Zz=fe('<button><span class="timeframe-text svelte-d8izos">4h</span> <div class="timeframe-glow svelte-d8izos"></div></button>'),Xz=(n,e,t)=>e(t.find(o=>o.timeframe==="1M")),Jz=fe('<button><span class="timeframe-text svelte-d8izos">1M</span> <div class="timeframe-glow svelte-d8izos"></div></button>'),Qz=fe('<div class="timeframe-inline-expand svelte-d8izos"><!> <!> <!></div>'),eV=fe('<div class="timeframe-group mobile-only svelte-d8izos"><!> <!> <button aria-label="More timeframes" title="More"><span class="timeframe-text svelte-d8izos">⋯</span> <div class="timeframe-glow svelte-d8izos"></div></button> <!></div>'),tV=(n,e)=>x(e,!0),nV=(n,e)=>x(e,!0),oV=(n,e)=>x(e,!0),sV=(n,e)=>x(e,!0),iV=fe('<button class="pro-menu-btn pro-menu-btn-icon-only svelte-d8izos" title="Play" type="button"><!></button>'),rV=fe('<button class="pro-menu-btn pro-menu-btn-icon-only svelte-d8izos" disabled title="Simulator active" type="button"><!></button>'),aV=(n,e)=>x(e,!0),lV=(n,e)=>x(e,!0),cV=(n,e,t)=>{e("🖱️ Fullscreen button clicked!"),t()},dV=(n,e)=>e(n),uV=(n,e)=>e(n),pV=n=>{n.preventDefault(),n.stopPropagation()},vV=(n,e)=>e(n),fV=fe('<button class="menu-scroll-arrow svelte-d8izos" title="Scroll to see more" aria-label="Scroll right" type="button"><span class="arrow-icon svelte-d8izos"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-d8izos"><polyline points="9 18 15 12 9 6" class="svelte-d8izos"></polyline></svg></span></button>'),mV=fe(`<div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 svelte-d8izos" role="dialog" aria-modal="true"><div class="bg-base-100 rounded-lg shadow-xl p-6 w-full max-w-md svelte-d8izos"><div class="text-base-content text-lg font-semibold mb-2 svelte-d8izos">Switch chart template theme?</div> <div class="text-base-content/80 text-sm mb-5 svelte-d8izos"> <br class="svelte-d8izos"> Would you like to switch the chart template's theme too?</div> <div class="flex justify-end gap-2 svelte-d8izos"><button class="btn btn-sm svelte-d8izos" type="button">No</button> <button class="btn btn-sm btn-primary svelte-d8izos" type="button">Yes</button></div></div></div>`),gV=(n,e)=>x(e,!1),hV=(n,e)=>x(e,!1),_V=fe('<div class="premium-modal-backdrop svelte-d8izos" role="presentation"></div> <div class="premium-modal-container svelte-d8izos" role="dialog" aria-modal="true" aria-labelledby="renko-premium-title"><div class="premium-background svelte-d8izos"><div class="premium-orb premium-orb-1 svelte-d8izos"></div> <div class="premium-orb premium-orb-2 svelte-d8izos"></div></div> <div class="premium-content svelte-d8izos"><button class="premium-close-btn svelte-d8izos" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-d8izos"><line x1="18" y1="6" x2="6" y2="18" class="svelte-d8izos"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-d8izos"></line></svg></button> <div class="premium-icon-wrapper svelte-d8izos"><div class="premium-icon svelte-d8izos"><!> <div class="premium-icon-glow svelte-d8izos"></div></div></div> <h2 id="renko-premium-title" class="premium-title svelte-d8izos">Premium Feature</h2> <p class="premium-message svelte-d8izos">Renko and Point &amp; Figure intraday/daily views are AI Pro only. Weekly and Monthly stay free—upgrade to unlock every timeframe and keep your edge live.</p> <div class="premium-features svelte-d8izos"><div class="premium-feature-item svelte-d8izos"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-d8izos"><polyline points="20 6 9 17 4 12" class="svelte-d8izos"></polyline></svg> <span class="svelte-d8izos">Full Renko &amp; Point &amp; Figure timeframes</span></div> <div class="premium-feature-item svelte-d8izos"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-d8izos"><polyline points="20 6 9 17 4 12" class="svelte-d8izos"></polyline></svg> <span class="svelte-d8izos">Sharper entries with intraday brick precision</span></div> <div class="premium-feature-item svelte-d8izos"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-d8izos"><polyline points="20 6 9 17 4 12" class="svelte-d8izos"></polyline></svg> <span class="svelte-d8izos">All future AI Pro chart perks, included</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-d8izos"><span class="svelte-d8izos">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-d8izos"><line x1="5" y1="12" x2="19" y2="12" class="svelte-d8izos"></line><polyline points="12 5 19 12 12 19" class="svelte-d8izos"></polyline></svg></a></div></div>',1),yV=fe('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="menu-wrapper svelte-d8izos"><div class="menu-container svelte-d8izos"><div class="menu-left-section svelte-d8izos"><div class="menu-toggle-wrapper svelte-d8izos"><button class="menu-toggle-btn svelte-d8izos" title="Toggle Left Panel"><div class="menu-toggle-icon-wrapper svelte-d8izos"><svg viewBox="0 0 1024 1024"><path d="M192.037 287.953h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32zM832.161 479.169H438.553c-17.673 0-32 14.327-32 32s14.327 32 32 32h393.608c17.673 0 32-14.327 32-32s-14.327-32-32-32zM832.161 735.802H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32zM319.028 351.594l-160 160 160 160z" class="svelte-d8izos"></path></svg></div> <div class="menu-toggle-glow svelte-d8izos"></div></button></div> <!> <div class="rotate-button-wrapper-mobile svelte-d8izos"><button type="button"><!> <div class="menu-btn-content svelte-d8izos"><div class="menu-icon-wrapper svelte-d8izos"><svg width="20" height="20" viewBox="0 0 448 448" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-d8izos"><!></svg></div></div> <div class="menu-btn-glow svelte-d8izos"></div></button></div> <div class="symbol-search-section svelte-d8izos"><div class="symbol-search-content svelte-d8izos"><div class="symbol-search-icon svelte-d8izos"><!></div> <span class="symbol-name svelte-d8izos"> </span></div></div> <div class="timeframe-section svelte-d8izos"><!> <!></div> <div class="ai-section svelte-d8izos"><button class="ai-btn group relative overflow-hidden svelte-d8izos" aria-label="AI Indicators" title="AI Powered Indicators" type="button"><div class="ai-glitter-bg svelte-d8izos"></div> <div class="ai-glitter-particle ai-glitter-1 svelte-d8izos"></div> <div class="ai-glitter-particle ai-glitter-2 svelte-d8izos"></div> <div class="ai-glitter-particle ai-glitter-3 svelte-d8izos"></div> <div class="ai-glitter-particle ai-glitter-4 svelte-d8izos"></div> <div class="ai-glitter-particle ai-glitter-5 svelte-d8izos"></div> <div class="ai-shine-sweep svelte-d8izos"></div> <div class="ai-btn-content svelte-d8izos"><div class="ai-icon-wrapper svelte-d8izos"><svg class="ai-icon svelte-d8izos" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-d8izos"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-d8izos"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-d8izos"></line></svg></div> <span class="ai-text svelte-d8izos">AI</span> <div class="ai-badge-mini svelte-d8izos">New</div></div></button></div> <div class="chart-type-section svelte-d8izos"><button class="pro-menu-btn svelte-d8izos" title="Chart Type"><!> <span class="pro-menu-text svelte-d8izos"> </span></button></div> <div class="indicator-section svelte-d8izos"><button class="pro-menu-btn svelte-d8izos" title="Indicators"><!> <span class="pro-menu-text svelte-d8izos"> </span></button></div> <div class="undo-redo-section svelte-d8izos"><button title="Undo (Ctrl+Z)"><!></button> <button title="Redo (Ctrl+Y)"><!></button></div></div> <div class="menu-right-section svelte-d8izos"><!> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-d8izos" title="Load Chart Layout" type="button"><!></button> <!> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-d8izos" title="Timezone" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-d8izos" title="Settings" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-d8izos" title="Script Studio" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-d8izos" title="Screenshot" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-d8izos" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-d8izos" title="Toggle Theme" type="button"><!></button></div></div> <!></div> <!> <!> <!>',1);function bV(n,e){gd(e,!0);const t=wp(),o=()=>ya(m,"$chart",t),i=()=>ya(_,"$save",t),r=()=>ya(h,"$ctx",t),a=()=>ya(Fm,"$userPreferences",t),l=()=>ya(Ko,"$isRenkoActive",t),c=()=>ya(gv,"$simulator",t);let d=Ws(e,"customLoad",3,!1),p=Ws(e,"mainContainer",15);const m=Kc("chart"),h=Kc("ctx"),_=Kc("save");let w=ae(!0);fv(()=>{try{const ge=sessionStorage.getItem("drawbarShown");if(ge!=null){x(w,ge==="true");const Le=p(),dt=typeof document<"u"?document.querySelector(".kline-main"):null,At=typeof document<"u"?document.querySelector(".drawbar-host"):null,pt=s(w)?"52px":"0px";Le&&Le.style.setProperty("--drawing-bar-width",pt),dt&&dt.style.setProperty("--drawing-bar-width",pt),At&&(At.style.width=pt)}else{const Le=typeof document<"u"?document.querySelector(".drawbar-host"):null;if(Le){const dt=parseFloat(getComputedStyle(Le).width||"52");x(w,dt>0)}}}catch{}});const S="*";function P(){let ge=document;return(ge.fullscreenElement||ge.mozFullScreenElement||ge.webkitFullscreenElement||ge.msFullscreenElement)!=null}let I=ae(N(P())),C=ae(!1);{const ge=()=>{const dt=s(I);if(x(I,N(P())),dt&&!s(I)){if(o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const At=wu(i().theme);Mn.merge(At,i().styles),o().setStyles($d(At)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied chart styles before fullscreen exit")}p()&&(p(p().style.cssText="",!0),p().classList.remove("fullscreen")),setTimeout(()=>{var At;if(p()&&(p().offsetHeight,p().offsetWidth,window.getComputedStyle(p()).height),(At=o())==null||At.resize(),o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const pt=wu(i().theme);Mn.merge(pt,i().styles),o().setStyles($d(pt)),r().applyCanvasColors&&r().applyCanvasColors()}},10),setTimeout(()=>{var At;if((At=o())==null||At.resize(),o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const pt=wu(i().theme);Mn.merge(pt,i().styles),o().setStyles($d(pt)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var At;if((At=o())==null||At.resize(),o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const pt=wu(i().theme);if(Mn.merge(pt,i().styles),o().setStyles($d(pt)),r().applyCanvasColors){r().applyCanvasColors();const at=o().getVisibleRange();at&&o().scrollToDataIndex(at.to,0)}console.log("✅ Final chart colors applied after fullscreen exit")}},300),setTimeout(()=>{var At;(At=o())==null||At.resize()},600),setTimeout(()=>{var At;(At=o())==null||At.resize()},1200)}else setTimeout(()=>{var At;(At=o())==null||At.resize()},100)},Le=()=>{if(console.log("📱 handleIOSFullscreenChange triggered"),$r()){const dt=window.innerHeight===screen.height,At=document.body.classList.contains("ios-fullscreen"),pt=window.navigator.standalone;console.log("🔍 iOS fullscreen checks:",{heightMatch:dt,hasIOSClass:At,isStandalone:pt,windowHeight:window.innerHeight,screenHeight:screen.height,currentFullScreen:s(I)});const at=dt||At||pt,Ct=s(I);if(s(I)!==at){if(console.log(`🔄 iOS fullscreen state changed: ${s(I)} → ${at}`),x(I,N(at)),Ct&&!at&&o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const Re=wu(i().theme);Mn.merge(Re,i().styles),o().setStyles($d(Re)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied chart styles for iOS exit")}console.log("📏 Scheduling iOS chart resizes..."),setTimeout(()=>{var Re;if((Re=o())==null||Re.resize(),Ct&&!at&&o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const kn=wu(i().theme);Mn.merge(kn,i().styles),o().setStyles($d(kn)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var Re;if((Re=o())==null||Re.resize(),Ct&&!at&&o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const kn=wu(i().theme);if(Mn.merge(kn,i().styles),o().setStyles($d(kn)),r().applyCanvasColors){r().applyCanvasColors();const ro=o().getVisibleRange();ro&&o().scrollToDataIndex(ro.to,0)}console.log("✅ Final iOS chart colors applied")}},300)}else console.log("✅ No iOS fullscreen state change needed")}else console.log("❌ Not iOS Safari, skipping handler")};document.addEventListener("fullscreenchange",ge),document.addEventListener("webkitfullscreenchange",ge),document.addEventListener("mozfullscreenchange",ge),document.addEventListener("MSFullscreenChange",ge),$r()&&(window.addEventListener("resize",Le),window.addEventListener("orientationchange",Le),document.addEventListener("webkitfullscreenchange",Le),"standalone"in window.navigator&&window.addEventListener("beforeunload",()=>{s(Ve)&&s(Ve)()}))}let M=ae(!1),F=ae(!1),V=ae(!1),j=ae(!1),D=ae(!1),R=ae(!1),W=ae(!1),J=ae(!1),Z=ae(""),G=ae(""),se=ae(!1),Y=ae(!1),oe=ae(!1),ee=ae(!1),re=ae(!1),me=ae(null),K=ae(!1),ye=ae(!1),Me=ae(!1),Fe=ae(N({x:0,y:0})),Ze=ae(!1),Ge=ae(N({x:0,y:0})),it=ae(N([])),Ye=ae(null),ct=ae(!1),kt=ae(!1),ft=!1,bt=ae(!1),nt=ae(""),Pt=ae(!1),Qe=ae(N({x:0,y:0})),yt=ae(!1);function xe(){try{if(p()){const Le=(p().querySelector(".chart-container")||p()).getBoundingClientRect();x(Qe,N({x:Le.left+Le.width/2,y:Le.top+Le.height/2}))}else{const ge=typeof window<"u"?window.innerWidth:0,Le=typeof window<"u"?window.innerHeight:0;x(Qe,N({x:ge/2,y:Le/2}))}}catch{}}let Ve=ae(null);function Je(ge){console.log(ge)}let St=ae(void 0);const Ne=[{timeframe:"1m",multiplier:1,timespan:"minute",secs:60},{timeframe:"5m",multiplier:5,timespan:"minute",secs:300},{timeframe:"15m",multiplier:15,timespan:"minute",secs:900},{timeframe:"30m",multiplier:30,timespan:"minute",secs:1800},{timeframe:"1h",multiplier:1,timespan:"hour",secs:3600}],ue=[{timeframe:"1d",multiplier:1,timespan:"day",secs:86400},{timeframe:"1w",multiplier:1,timespan:"week",secs:604800},{timeframe:"1M",multiplier:1,timespan:"month",secs:2592e3}],he=[{timeframe:"4h",multiplier:4,timespan:"hour",secs:14400}],_t=["1w","1M"],Wt=[{id:"candle_solid",name:"Candlestick",icon:"candle_solid"},{id:"candle_stroke",name:"Hollow",icon:"candle_stroke"},{id:"candle_up_stroke",name:"Up Hollow",icon:"candle_up_stroke"},{id:"candle_down_stroke",name:"Down Hollow",icon:"candle_down_stroke"},{id:"heikin_ashi",name:"Heikin Ashi",icon:"candle_solid"},{id:"renko_atr",name:"Duty AI Renko",icon:"candle_solid"},{id:"point_and_figure",name:"Point & Figure",icon:"point_and_figure"},{id:"ohlc",name:"OHLC",icon:"ohlc"},{id:"area",name:"Area",icon:"area"},{id:"line_chart",name:"Line",icon:"line"}];let jt=ae(!1),Zt=ae(!1),dn=ae(!1),zn=ae(!1),un=ae(void 0);mr(()=>{let ge=null,Le=null;function dt(){return typeof window<"u"&&window.saveManager?(ge=window.saveManager.state.subscribe(pt=>{console.log("📊 SaveManager state updated:",pt),pt.initialized?(console.log("🔗 SaveManager is initialized, updating UI state..."),x(it,N(pt.savedLayouts)),x(Ye,N(pt.activeSaveId)),x(ct,N(pt.isLoading)),Le&&(clearInterval(Le),Le=null)):console.log("⏳ SaveManager exists but not yet initialized...")}),!0):!1}return dt()||(console.log("⏳ Waiting for SaveManager to be available..."),Le=setInterval(()=>{dt()},100)),()=>{ge&&ge(),Le&&clearInterval(Le)}});function On(){o()&&setTimeout(()=>{o().resize()},300)}fv(()=>{op.init({chart:o(),saveStore:_,overlaysStore:null});const ge=()=>{x(Zt,N(op.canUndo())),x(dn,N(op.canRedo()))};ge();const Le=setInterval(ge,100);"screen"in window&&"orientation"in window.screen?window.screen.orientation.addEventListener("change",On):window.addEventListener("orientationchange",On),kc();const dt=()=>{kc()},At=()=>{kc(),typeof window<"u"&&x(ee,window.innerWidth<=768)};return s(un)&&s(un).addEventListener("scroll",dt),window.addEventListener("resize",At),setTimeout(()=>{kc(),typeof window<"u"&&x(ee,window.innerWidth<=768)},500),()=>{clearInterval(Le),"screen"in window&&"orientation"in window.screen?window.screen.orientation.removeEventListener("change",On):window.removeEventListener("orientationchange",On),s(un)&&s(un).removeEventListener("scroll",dt),window.removeEventListener("resize",At)}});function no(){s(Zt)&&op.undo()}function fs(){s(dn)&&op.redo()}function ps(ge){var Le;if(ba()&&!fi()){const dt=ge==null?void 0:ge.timeframe;if(!_t.includes(dt)){x(yt,!0);return}}kl(_,rs(i).period=ge,rs(i));try{const dt=(Le=i())!=null&&Le.key&&typeof i().key=="string"?i().key:"chart";typeof localStorage<"u"&&localStorage.setItem(`${dt}.lastTimeframe`,(ge==null?void 0:ge.timeframe)||"")}catch{}s(oe)&&x(oe,!1)}function So(){var dt,At,pt,at;if((At=(dt=i().styles)==null?void 0:dt.candle)!=null&&At._isLineChart)return Wt.find(Ct=>Ct.id==="line_chart")||Wt[0];const ge=((at=(pt=i().styles)==null?void 0:pt.candle)==null?void 0:at.type)||"renko_atr";return Wt.find(Ct=>Ct.id===ge)||Wt[0]}const Es=Lu(_,ge=>ge.symbol.ticker),Qo=Lu(_,ge=>ge.symbol.shortName),Ko=Lu(_,ge=>{var Le,dt;return((dt=(Le=ge.styles)==null?void 0:Le.candle)==null?void 0:dt.type)==="renko_atr"});Lu(_,ge=>{var Le,dt;return((dt=(Le=ge.styles)==null?void 0:Le.candle)==null?void 0:dt.type)==="point_and_figure"}),Es.subscribe(()=>{x(G,N(i().symbol.shortName||i().symbol.ticker))}),Qo.subscribe(()=>{x(G,N(i().symbol.shortName||i().symbol.ticker))});function oo(){const ge=i().styles||{},Le=wu(i().theme);if(ge.backgroundColor||ge.backgroundGradient||ge.backgroundType||ge.backgroundOpacity!==void 0||ge.gridGradient||ge.gridType||ge.gridOpacity!==void 0)return!0;const dt=uo=>{if(!uo||typeof uo!="string")return"";const hs=uo.trim().toLowerCase();if(hs.startsWith("rgba(")){const Ei=hs.match(/rgba\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);if(Ei){const ei=Number(Ei[1]).toString(16).padStart(2,"0"),Ys=Number(Ei[2]).toString(16).padStart(2,"0"),Ht=Number(Ei[3]).toString(16).padStart(2,"0");return`#${ei}${Ys}${Ht}`}}return hs},At=dt(Mn.get(ge,"pane.backgroundColor")),pt=dt(Mn.get(ge,"candle.pane.backgroundColor")),at=dt(Mn.get(Le,"pane.backgroundColor"));if(At&&at&&At!==at||pt&&at&&pt!==at)return!0;const Ct=dt(Mn.get(ge,"grid.horizontal.color")),Re=dt(Mn.get(ge,"grid.vertical.color")),kn=dt(Mn.get(Le,"grid.horizontal.color")),ro=dt(Mn.get(Le,"grid.vertical.color"));return!!(Ct&&kn&&Ct!==kn||Re&&ro&&Re!==ro)}function Gs(ge){try{if(window.self!==window.top){const Le={type:"theme-change",theme:ge};let dt=S;try{window.parent.location&&(dt=window.parent.location.origin)}catch{dt=S}window.parent.postMessage(Le,dt),console.log("📤 Sent theme-change message to parent:",Le,"origin:",dt)}}catch(Le){console.error("Failed to send theme-change message to parent:",Le)}}function jo(ge,Le){var pt,at,Ct,Re,kn;const dt=document.querySelector(".kline-main");if(dt&&dt.setAttribute("data-theme",ge),Le){try{const ro=localStorage.getItem("chart");if(ro){const uo=JSON.parse(ro);uo.styles&&(delete uo.styles.backgroundColor,delete uo.styles.backgroundOpacity,delete uo.styles.backgroundType,delete uo.styles.backgroundGradient,uo.styles.grid&&(delete uo.styles.grid.horizontal,delete uo.styles.grid.vertical),delete uo.styles.gridColor,delete uo.styles.gridOpacity,delete uo.styles.gridType,delete uo.styles.gridGradient,localStorage.setItem("chart",JSON.stringify(uo)),console.log("🧹 Cleared custom background and grid colors from localStorage"))}}catch(ro){console.error("Failed to clear custom colors from localStorage:",ro)}if(o()){window.__forceApplyThemeDefaults=!0;const ro=wu(ge),uo=JSON.parse(JSON.stringify(i().styles||{})),hs=ro,Ei={...uo,pane:{...uo.pane,backgroundColor:hs.pane.backgroundColor},candle:{...uo.candle,pane:{...(pt=uo.candle)==null?void 0:pt.pane,backgroundColor:hs.candle.pane.backgroundColor}},grid:{...uo.grid,horizontal:{...(at=uo.grid)==null?void 0:at.horizontal,color:hs.grid.horizontal.color},vertical:{...(Ct=uo.grid)==null?void 0:Ct.vertical,color:hs.grid.vertical.color}}},ei=(Re=uo==null?void 0:uo.candle)==null?void 0:Re.type,Ys=Mn.merge({},ro,Ei);delete Ys.backgroundColor,delete Ys.backgroundOpacity,delete Ys.backgroundType,delete Ys.backgroundGradient,delete Ys.gridColor,delete Ys.gridOpacity,delete Ys.gridType,delete Ys.gridGradient,ei&&Ys.candle&&(Ys.candle.type=ei),o().setStyles($d(Ys)),kl(_,rs(i).styles=Ys,rs(i))}try{const ro=new hy("chart-settings",m,ge);ro.resetToThemeDefaults(ge),ro.destroy(),console.log("🔄 Reset TransactionalThemeManager for theme toggle")}catch(ro){console.error("Failed to reset TransactionalThemeManager:",ro)}}kl(_,rs(i).theme=ge,rs(i));const At=(kn=a())==null?void 0:kn.data;if(At!=null&&At.clerkId){const ro=ge==="dark"?"Dark":"Light";rT(At.clerkId,ro).catch(uo=>{console.error("Failed to save theme to API:",uo)})}Gs(ge)}function fi(){var Le;const ge=(Le=a())==null?void 0:Le.data;return(ge==null?void 0:ge.isPremium)===!0||(ge==null?void 0:ge.isTrial)===!0}function ba(){var Le,dt;const ge=(dt=(Le=i().styles)==null?void 0:Le.candle)==null?void 0:dt.type;return ge==="renko_atr"||ge==="point_and_figure"}function xa(){var Le;if(fi()||!ba())return;const ge=(Le=i().period)==null?void 0:Le.timeframe;if(!_t.includes(ge)){const dt=ue.find(At=>At.timeframe==="1M")||ue.find(At=>At.timeframe==="1w");dt&&ps(dt)}}mr(()=>{var ge,Le,dt;(Le=(ge=i().styles)==null?void 0:ge.candle)==null||Le.type,(dt=i().period)==null||dt.timeframe,xa()});function Al(){const ge=Mn.get(i().styles,"backgroundType")==="gradient",Le=Mn.get(i().styles,"backgroundGradient"),dt=ge&&Le&&Array.isArray(Le.stops)&&Le.stops.length>0,At=(at,Ct)=>{const Re=(at||"#000000").replace("#",""),kn=parseInt(Re.substring(0,2),16)||0,ro=parseInt(Re.substring(2,4),16)||0,uo=parseInt(Re.substring(4,6),16)||0,hs=Math.max(0,Math.min(1,Ct??1));return`rgba(${kn}, ${ro}, ${uo}, ${hs})`};if(dt){requestAnimationFrame(()=>{var at,Ct;try{const Re=(at=o())==null?void 0:at.getConvertPictureUrl(!0,"png","rgba(0, 0, 0, 0)");if(!Re)return;const kn=new Image;kn.onload=()=>{const ro=kn.naturalWidth||kn.width,uo=kn.naturalHeight||kn.height,hs=document.createElement("canvas");hs.width=ro,hs.height=uo;const Ei=hs.getContext("2d");if(!Ei)return;let ei;if((Le.type==="radial"?"radial":"linear")==="radial")ei=Ei.createRadialGradient(ro/2,uo/2,0,ro/2,uo/2,Math.max(ro,uo)/2);else{const fn=((typeof Le.direction=="number"?Le.direction:90)-90)*Math.PI/180,Fn=Math.cos(fn),Vt=Math.sin(fn),mn=ro/2-ro/2*Fn,Kn=uo/2-uo/2*Vt,Pn=ro/2+ro/2*Fn,Hn=uo/2+uo/2*Vt;ei=Ei.createLinearGradient(mn,Kn,Pn,Hn)}[...Le.stops].sort((qe,fn)=>(qe.position??0)-(fn.position??0)).forEach(qe=>{const fn=Math.max(0,Math.min(1,(qe.position??0)/100)),Fn=At(qe.color,(qe.opacity??100)/100);ei.addColorStop(fn,Fn)}),Ei.fillStyle=ei,Ei.fillRect(0,0,ro,uo),Ei.drawImage(kn,0,0,ro,uo),x(Z,N(hs.toDataURL("image/png"))),x(R,!0)},kn.src=Re}catch{let kn=i().theme==="dark"?"#151517":"#ffffff";x(Z,N(((Ct=o())==null?void 0:Ct.getConvertPictureUrl(!0,"jpeg",kn))??"")),x(R,!0)}});return}let pt;try{const at=document.querySelector(".kline-widget"),Ct=document.querySelector(".kline-main"),Re=kn=>{if(!kn)return"";const ro=getComputedStyle(kn).getPropertyValue("--chart-background-color").trim();return ro&&!ro.includes("gradient")?ro:""};if(pt=Re(at)||Re(Ct)||void 0,!pt&&o()&&typeof o().getStyles=="function"){const kn=o().getStyles()??{};pt=Mn.get(kn,"pane.backgroundColor")||Mn.get(kn,"candle.pane.backgroundColor")||void 0}if(!pt){const kn=Mn.get(i().styles,"backgroundColor");pt=kn&&typeof kn=="string"?kn:void 0}}catch{}pt||(pt=i().theme==="dark"?"#151517":"#ffffff"),requestAnimationFrame(()=>{var at;x(Z,N(((at=o())==null?void 0:at.getConvertPictureUrl(!0,"jpeg",pt))??"")),x(R,!0)})}function Qs(){if($r()&&s(Ve)){s(Ve)();return}let ge=document;const Le=ge.exitFullscreen??ge.mozCancelFullScreen??ge.webkitExitFullscreen??ge.msExitFullscreen;Le?Le.call(ge):$r()&&Sd()}function Fs(){Je("🔄 toggleFullscreen called, current fullScreen: "+s(I)),Je("🔍 iOS detection - isIOS(): "+Va()+", isIOSSafari(): "+$r()),s(I)?(Je("🚪 Exiting fullscreen..."),Qs()):$r()?(Je("📱 Using iOS Safari fullscreen method"),cd()):(Je("🖥️ Using standard fullscreen method"),Nl())}function Va(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function $r(){const ge=navigator.userAgent,Le=/iPad|iPhone|iPod/.test(ge)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,dt=/Safari/.test(ge)&&!/Chrome|CriOS|FxiOS/.test(ge);return Le&&dt}function cd(){return Je("📱 enterFullscreenIOS called"),new Promise(ge=>{var dt;const Le=p();if(Je("🎯 mainContainer element: "+(Le?"Found":"Not found")),Le&&Le.webkitRequestFullscreen){Je("🔧 Trying webkitRequestFullscreen...");try{Le.webkitRequestFullscreen(),setTimeout(()=>{Je("✅ webkitRequestFullscreen success, setting fullScreen = true"),x(I,!0),ge(!0)},300);return}catch(At){Je("❌ webkitRequestFullscreen failed: "+At)}}else Je("❌ webkitRequestFullscreen not available");if(Le&&Le.webkitEnterFullscreen)try{Le.webkitEnterFullscreen(),setTimeout(()=>{x(I,!0),ge(!0)},300);return}catch(At){console.log("webkitEnterFullscreen failed:",At)}Je("🔧 Trying viewport manipulation fallback...");try{const At=document.querySelector('meta[name="viewport"]'),pt=(At==null?void 0:At.getAttribute("content"))||"";Je("📋 Original viewport content: "+pt);const at=At||document.createElement("meta");at.setAttribute("name","viewport"),at.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"),At?console.log("🔄 Updated existing viewport meta tag"):(document.head.appendChild(at),console.log("➕ Added new viewport meta tag")),window.scrollTo(0,1),console.log("📜 Scrolled to hide Safari UI");const Ct=document.createElement("style");Ct.id="ios-fullscreen-style",Ct.textContent=`
          body.ios-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100vh !important;
            overflow: hidden !important;
            -webkit-overflow-scrolling: touch !important;
          }
          
          .ios-fullscreen #main-container {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
          }
          
          /* Hide Safari bottom bar */
          @supports (padding: max(0px)) {
            .ios-fullscreen {
              padding-bottom: env(safe-area-inset-bottom) !important;
            }
          }
        `,document.head.appendChild(Ct),console.log("🎨 Added iOS fullscreen CSS styles");const Re=((dt=p())==null?void 0:dt.getAttribute("data-theme"))||i().theme;Je("🎨 Preserving theme during iOS fullscreen: "+Re),document.body.classList.add("ios-fullscreen"),console.log("✅ Applied ios-fullscreen class to body"),p()&&(p().setAttribute("data-theme",Re),Je("🔄 Restored theme attribute: "+Re)),setTimeout(()=>{window.scrollTo(0,0),x(I,!0),Je("🎯 iOS fullscreen activated successfully!"),x(Ve,()=>{var uo;Je("🧹 Cleaning up iOS fullscreen...");const kn=((uo=p())==null?void 0:uo.getAttribute("data-theme"))||i().theme;Je("🎨 Preserving theme during cleanup: "+kn),document.body.classList.remove("ios-fullscreen");const ro=document.getElementById("ios-fullscreen-style");ro&&ro.remove(),At&&pt&&At.setAttribute("content",pt),p()&&(p().setAttribute("data-theme",kn),Je("🔄 Restored theme attribute after cleanup: "+kn)),x(I,!1),Je("✅ iOS fullscreen cleanup completed")}),ge(!0)},100)}catch(At){console.log("iOS Safari viewport fallback failed:",At),ge(!1)}})}function Sd(){var ge;if(console.log("🚪 exitFullscreenIOS called"),o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const Le=wu(i().theme);Mn.merge(Le,i().styles),o().setStyles($d(Le)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied styles before iOS exit")}try{document.webkitExitFullscreen?(console.log("🔧 Trying webkitExitFullscreen..."),document.webkitExitFullscreen()):console.log("❌ webkitExitFullscreen not available"),s(Ve)?(console.log("🧹 Using stored cleanup function..."),s(Ve)(),x(Ve,null)):console.log("❌ No stored cleanup function available"),console.log("🔧 Performing manual cleanup...");const Le=((ge=p())==null?void 0:ge.getAttribute("data-theme"))||i().theme;console.log("🎨 Preserving theme during manual cleanup: "+Le),document.body.classList.remove("ios-fullscreen");const dt=document.getElementById("ios-fullscreen-style");dt&&(dt.remove(),console.log("🗑️ Removed iOS fullscreen styles"));const At=document.querySelector('meta[name="viewport"]');At&&(At.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),console.log("📱 Restored viewport meta tag")),p()&&(p().setAttribute("data-theme",Le),console.log("🔄 Restored theme attribute after manual cleanup: "+Le)),x(I,!1),console.log("✅ Set fullScreen = false"),setTimeout(()=>{var pt;if(console.log("📏 First chart resize..."),(pt=o())==null||pt.resize(),o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const at=wu(i().theme);Mn.merge(at,i().styles),o().setStyles($d(at)),r().applyCanvasColors&&r().applyCanvasColors()}},10),setTimeout(()=>{var pt;if((pt=o())==null||pt.resize(),o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const at=wu(i().theme);Mn.merge(at,i().styles),o().setStyles($d(at)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var pt;if((pt=o())==null||pt.resize(),o()&&i().styles){window.__forceApplySavedCanvasColors=!0;const at=wu(i().theme);if(Mn.merge(at,i().styles),o().setStyles($d(at)),r().applyCanvasColors){r().applyCanvasColors();const Ct=o().getVisibleRange();Ct&&o().scrollToDataIndex(Ct.to,0)}console.log("✅ Final iOS chart colors applied after exit")}},300)}catch(Le){console.log("❌ iOS exit fullscreen failed:",Le)}}function Nl(){return Va()?cd():new Promise(ge=>{let Le=p();Le&&Le.requestFullscreen?Le.requestFullscreen().then(()=>ge(!0)).catch(()=>ge(!1)):Le&&Le.mozRequestFullScreen?(Le.mozRequestFullScreen(),setTimeout(()=>ge(!0),100)):Le&&Le.webkitRequestFullscreen?(Le.webkitRequestFullscreen(),setTimeout(()=>ge(!0),100)):Le&&Le.msRequestFullscreen?(Le.msRequestFullscreen(),setTimeout(()=>ge(!0),100)):ge(!1)})}function dd(){Cd();const ge=document.createElement("div");ge.id="ios-rotation-hint",ge.innerHTML=`
      <div style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        z-index: 10000;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 280px;
        backdrop-filter: blur(10px);
      ">
        <div style="font-size: 24px; margin-bottom: 10px;">📱</div>
        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Rotate Your Device</div>
        <div style="font-size: 14px; opacity: 0.8;">Turn your device to landscape mode for the best experience</div>
        <div style="margin-top: 15px; font-size: 12px; opacity: 0.6;">Tap anywhere to dismiss</div>
      </div>
    `,ge.onclick=Cd,document.body.appendChild(ge),setTimeout(Cd,4e3)}function Cd(){const ge=document.getElementById("ios-rotation-hint");ge&&ge.remove()}async function fa(){if(typeof window<"u"&&window.saveManager){const ge=window.saveManager,Le=ge.getState();if(x(Pt,!1),Le.activeSaveId){const dt=await ge.quickSave();dt.success||console.error("Quick save failed:",dt.error),dt.success&&(x(Me,!1),x(nt,"Saved to current layout"),x(bt,!0),setTimeout(()=>{x(bt,!1)},2e3),x(Pt,!0),xe(),setTimeout(()=>{x(Pt,!1)},1500))}else x(Me,!1),x(K,!0)}}function Dl(){x(Me,!1),x(ye,!0)}function ml(){x(Me,!1),x(K,!0)}async function gl(ge){const{layoutId:Le}=ge.detail;if(typeof window<"u"&&window.saveManager){const dt=window.saveManager;x(kt,!0);const At=await dt.load(Le);x(kt,!1),At.success||console.error("Load failed:",At.error)}}async function _d(ge){const{layoutId:Le}=ge.detail;if(typeof window<"u"&&window.saveManager){const At=await window.saveManager.delete(Le);if(!At.success){console.error("Delete failed:",At.error);return}x(it,N((s(it)||[]).filter(pt=>pt.id!==Le))),s(Ye)===Le&&x(Ye,null),x(ct,!1)}}async function Kl(ge){const{name:Le}=ge.detail;if(typeof window<"u"&&window.saveManager){const dt=window.saveManager;x(Pt,!1);const At=await dt.save(Le);At.success?(x(K,!1),x(Pt,!0),xe(),setTimeout(()=>{x(Pt,!1)},1500)):console.error("Save failed:",At.error)}}function ic(){x(K,!1)}async function od(ge){const{layoutId:Le}=ge.detail;if(console.log("💾 SaveAsSelectSave triggered with layoutId:",Le),typeof window<"u"&&window.saveManager){const dt=window.saveManager;console.log("✅ SaveManager found, calling saveTo..."),x(Pt,!1);const At=await dt.saveTo(Le);At.success?(console.log("✅ Save to existing successful"),x(ye,!1),x(Pt,!0),xe(),setTimeout(()=>{x(Pt,!1)},1500)):console.error("❌ Save to existing failed:",At.error)}else console.error("❌ SaveManager not available")}function zd(){x(ye,!1),al()}function Ec(){x(ye,!1)}function al(){console.log("🎯 Save button clicked, showing popup..."),console.log("📊 Current savedLayouts:",s(it)),console.log("🎯 Current activeSaveId:",s(Ye)),console.log("💾 SaveManager available:",!!window.saveManager);try{if(typeof window<"u"&&window.saveManager){const Le=window.saveManager.getState();if(!Le||!Array.isArray(Le.savedLayouts)||Le.savedLayouts.length===0){x(Me,!1),x(K,!0);return}}else if(!s(it)||s(it).length===0){x(Me,!1),x(K,!0);return}}catch{x(Me,!1),x(K,!0);return}if(p()){const ge=p().querySelector(".chart-container");if(ge){const Le=ge.getBoundingClientRect();x(Fe,N({x:Le.left+Le.width/2,y:Le.top+Le.height/2}))}else{const Le=p().getBoundingClientRect();x(Fe,N({x:Le.left+Le.width/2,y:Le.top+Le.height/2}))}}x(Me,!0)}function kc(){if(!s(un))return;const{scrollWidth:ge,clientWidth:Le,scrollLeft:dt}=s(un),At=ge>Le,pt=dt+Le>=ge-5;x(zn,N(At&&!pt))}function Vd(ge){if(ge&&(ge.preventDefault(),ge.stopPropagation()),!s(un))return;const{scrollLeft:Le,clientWidth:dt,scrollWidth:At}=s(un),pt=dt*.7,at=Math.min(Le+pt,At-dt);try{s(un).scrollTo({left:at,behavior:"smooth"})}catch{s(un).scrollLeft=at}}function sd(ge){ge.preventDefault(),ge.stopPropagation(),Vd()}const id=Ng(),[Pd,Ed]=id;var zl=yV(),Gd=Dt(zl);mE(Gd,{get show(){return s(M)},set show(ge){x(M,N(ge))}});var lu=u(Gd,2);yE(lu,{get show(){return s(F)},set show(ge){x(F,N(ge))}});var Yd=u(lu,2);nN(Yd,{get show(){return s(V)},set show(ge){x(V,N(ge))}});var eu=u(Yd,2);mR(eu,{get show(){return r().modalIndCfg},set show(ge){kl(h,rs(r).modalIndCfg=ge,rs(r))}});var Ju=u(eu,2);BB(Ju,{get show(){return s(j)},set show(ge){x(j,N(ge))}});var mu=u(Ju,2);Uw(mu,{get show(){return s(D)},set show(ge){x(D,N(ge))}});var yd=u(mu,2);zB(yd,{get show(){return s(R)},set show(ge){x(R,N(ge))},get url(){return s(Z)},set url(ge){x(Z,N(ge))}});var tn=u(yd,2);HB(tn,{get show(){return s(W)},set show(ge){x(W,N(ge))}});var En=u(tn,2);XB(En,{get show(){return s(jt)},set show(ge){x(jt,N(ge))}});var go=u(En,2);mO(go,{get show(){return s(J)},set show(ge){x(J,N(ge))}});var hn=u(go,2);IO(hn,{get show(){return s(K)},set show(ge){x(K,N(ge))},get savedLayouts(){return s(it)},get isLoading(){return s(ct)},mode:"save",showExisting:!1,$$events:{save:Kl,cancel:ic}});var Ho=u(hn,2);ez(Ho,{get show(){return s(ye)},set show(ge){x(ye,N(ge))},get savedLayouts(){return s(it)},get isLoading(){return s(ct)},$$events:{saveTo:od,back:zd,cancel:Ec}});var Eo=u(Ho,2);RO(Eo,{get show(){return s(Me)},set show(ge){x(Me,N(ge))},get savedLayouts(){return s(it)},get activeSaveId(){return s(Ye)},get isLoading(){return s(ct)},get hasUnsavedChanges(){return ft},get position(){return s(Fe)},showLayouts:!1,$$events:{save:fa,saveAs:Dl,quickSave:fa,newLayout:ml}});var di=u(Eo,2);HO(di,{get show(){return s(Ze)},set show(ge){x(Ze,N(ge))},get savedLayouts(){return s(it)},get activeSaveId(){return s(Ye)},get position(){return s(Ge)},get isLoading(){return s(ct)},$$events:{load:gl,delete:_d}});var ns=u(di,2);Gw(ns,{get visible(){return s(bt)},set visible(ge){x(bt,N(ge))},get message(){return s(nt)},duration:2e3});var $i=u(ns,2);Te($i,()=>s(Pt),ge=>{var Le=Mz();Se(()=>zt(Le,"style",`left: ${s(Qe).x??""}px; top: ${s(Qe).y??""}px;`)),z(ge,Le)});var hi=u($i,2),li=g(hi),ks=g(li),Vi=g(ks),gs=g(Vi);gs.__click=[Cz,w,p,o,m];var ll=g(gs),mi=g(ll);f(ll),ai(2),f(gs),f(Vi);var Na=u(Vi,2);Te(Na,d,ge=>{var Le=Tz(),dt=g(Le);dt.__change=[Sz,G,i,_,o,m,r,h],Xu(dt,pt=>x(St,pt),()=>s(St));var At=u(dt,2);At.__click=[Az,St],f(Le),z(ge,Le)});var le=u(Na,2),we=g(le);we.__click=[Pz,Y,se,Va,cd,dd,o,m,Nl,Cd,I,Qs];var H=g(we);Te(H,()=>s(Y),ge=>{var Le=Lz();z(ge,Le)});var ne=u(H,2),_e=g(ne),q=g(_e),De=g(q);Te(De,()=>s(se),ge=>{var Le=Fz();ai(3),z(ge,Le)},ge=>{var Le=$z();ai(3),z(ge,Le)}),f(q),f(_e),f(ne),ai(2),f(we),f(le);var ot=u(le,2);ot.__click=[Ez,M];var je=g(ot),Ft=g(je),Be=g(Ft);iF(Be,{class:"search-icon"}),f(Ft);var xt=u(Ft,2),an=g(xt,!0);f(xt),f(je),f(ot);var Yn=u(ot,2),bn=g(Yn);Te(bn,()=>!s(ee),ge=>{var Le=zz(),dt=g(Le);vs(dt,17,()=>Ne,Vs,(at,Ct)=>{var Re=Dz();Re.__click=[Nz,ps,Ct];var kn=g(Re),ro=g(kn,!0);f(kn),ai(2),f(Re),Se(()=>{var uo;Us(Re,`timeframe-btn ${(s(Ct).timeframe===((uo=i().period)==null?void 0:uo.timeframe)?"timeframe-btn-active":"")??""} svelte-d8izos`),ze(ro,s(Ct).timeframe)}),z(at,Re)});var At=u(dt,2);Te(At,()=>!l(),at=>{var Ct=Rz();Ct.__click=[jz,ps,he],Se(()=>{var Re;return Us(Ct,`timeframe-btn ${(((Re=i().period)==null?void 0:Re.timeframe)==="4h"?"timeframe-btn-active":"")??""} svelte-d8izos`)}),z(at,Ct)});var pt=u(At,2);vs(pt,17,()=>ue,Vs,(at,Ct)=>{var Re=Oz();Re.__click=[Bz,ps,Ct];var kn=g(Re),ro=g(kn,!0);f(kn),ai(2),f(Re),Se(()=>{var uo;Us(Re,`timeframe-btn ${(s(Ct).timeframe===((uo=i().period)==null?void 0:uo.timeframe)?"timeframe-btn-active":"")??""} svelte-d8izos`),ze(ro,s(Ct).timeframe)}),z(at,Re)}),f(Le),z(ge,Le)});var be=u(bn,2);Te(be,()=>s(ee),ge=>{var Le=eV(),dt=g(Le);Te(dt,()=>ue.find(Ct=>Ct.timeframe==="1d"),Ct=>{var Re=Wz();Re.__click=[Vz,ps,ue],Se(()=>{var kn;return Us(Re,`timeframe-btn ${(((kn=i().period)==null?void 0:kn.timeframe)==="1d"?"timeframe-btn-active":"")??""} svelte-d8izos`)}),z(Ct,Re)});var At=u(dt,2);Te(At,()=>ue.find(Ct=>Ct.timeframe==="1w"),Ct=>{var Re=Hz();Re.__click=[qz,ps,ue],Se(()=>{var kn;return Us(Re,`timeframe-btn ${(((kn=i().period)==null?void 0:kn.timeframe)==="1w"?"timeframe-btn-active":"")??""} svelte-d8izos`)}),z(Ct,Re)});var pt=u(At,2);pt.__click=[Uz,oe];var at=u(pt,2);Te(at,()=>s(oe),Ct=>{var Re=Qz(),kn=g(Re);vs(kn,17,()=>Ne,Vs,(hs,Ei)=>{var ei=Yz();ei.__click=[Gz,ps,Ei];var Ys=g(ei),Ht=g(Ys,!0);f(Ys),ai(2),f(ei),Se(()=>{var qe;Us(ei,`timeframe-btn ${(s(Ei).timeframe===((qe=i().period)==null?void 0:qe.timeframe)?"timeframe-btn-active":"")??""} svelte-d8izos`),ze(Ht,s(Ei).timeframe)}),z(hs,ei)});var ro=u(kn,2);Te(ro,()=>!l(),hs=>{var Ei=Zz();Ei.__click=[Kz,ps,he],Se(()=>{var ei;return Us(Ei,`timeframe-btn ${(((ei=i().period)==null?void 0:ei.timeframe)==="4h"?"timeframe-btn-active":"")??""} svelte-d8izos`)}),z(hs,Ei)});var uo=u(ro,2);Te(uo,()=>ue.find(hs=>hs.timeframe==="1M"),hs=>{var Ei=Jz();Ei.__click=[Xz,ps,ue],Se(()=>{var ei;return Us(Ei,`timeframe-btn ${(((ei=i().period)==null?void 0:ei.timeframe)==="1M"?"timeframe-btn-active":"")??""} svelte-d8izos`)}),z(hs,Ei)}),f(Re),Mf(1,Re,()=>xE,()=>({duration:180})),Mf(2,Re,()=>Fg,()=>({duration:120})),z(Ct,Re)}),f(Le),Se(()=>{Us(pt,`timeframe-btn timeframe-more-btn ${(s(oe)?"timeframe-btn-active":"")??""} svelte-d8izos`),zt(pt,"aria-expanded",s(oe))}),z(ge,Le)}),f(Yn);var tt=u(Yn,2),wt=g(tt);wt.__click=[tV,J],f(tt);var Lt=u(tt,2),qt=g(Lt);qt.__click=[nV,jt];var qn=g(qt);If(qn,{get name(){return So().icon},size:16});var Xt=u(qn,2),vo=g(Xt,!0);Se(()=>ze(vo,So().name)),f(Xt),f(qt),f(Lt);var To=u(Lt,2),co=g(To);co.__click=[oV,V];var so=g(co);If(so,{name:"indicator",size:16});var Jo=u(so,2),Os=g(Jo,!0);Se(()=>ze(Os,uy())),f(Jo),f(co),f(To);var wr=u(To,2),ra=g(wr);ra.__click=function(...ge){var Le;(Le=s(Zt)?no:void 0)==null||Le.apply(this,ge)};var Qr=g(ra);If(Qr,{class:"undo-redo-icon",name:"undo",size:16}),f(ra);var hl=u(ra,2);hl.__click=function(...ge){var Le;(Le=s(dn)?fs:void 0)==null||Le.apply(this,ge)};var lc=g(hl);If(lc,{class:"undo-redo-icon",name:"redo",size:16}),f(hl),f(wr),f(ks);var qr=u(ks,2),Ga=g(qr),Ki=vt(()=>s(ct)&&!s(kt));yO(Ga,{get savedLayouts(){return s(it)},get activeSaveId(){return s(Ye)},get isLoading(){return s(Ki)},get hasUnsavedChanges(){return ft},$$events:{save:fa,saveAs:Dl,quickSave:fa,load:gl,delete:_d,newLayout:ml,showPopup:al}});var Zl=u(Ga,2);Zl.__click=[Iz,p,Ge,Ze];var Tl=g(Zl);KL(Tl,{size:18}),f(Zl);var Ya=u(Zl,2);Te(Ya,()=>c().mode==="none",ge=>{var Le=iV();Le.__click=[sV,C];var dt=g(Le);If(dt,{name:"play",size:18}),f(Le),z(ge,Le)},ge=>{var Le=rV(),dt=g(Le);If(dt,{name:"play",size:18}),f(Le),z(ge,Le)});var ur=u(Ya,2);ur.__click=[aV,W];var rc=g(ur);GL(rc,{size:18}),f(ur);var zr=u(ur,2);zr.__click=[lV,D];var rd=g(zr);rF(rd,{size:18}),f(zr);var cc=u(zr,2);cc.__click=function(...ge){var Le;(Le=e.onToggleScriptStudio)==null||Le.apply(this,ge)};var dc=g(cc);YL(dc,{size:18}),f(cc);var Er=u(cc,2);Er.__click=Al;var Sc=g(Er);UL(Sc,{size:18}),f(Er);var ea=u(Er,2);ea.__click=[cV,Je,Fs];var Cc=g(ea);Te(Cc,()=>s(I),ge=>{eF(ge,{size:18})},ge=>{QL(ge,{size:18})}),f(ea);var Ac=u(ea,2);Ac.__click=[xz,i,_,oo,me,re,jo];var cu=g(Ac);Te(cu,()=>i().theme==="dark",ge=>{tF(ge,{size:20})},ge=>{aF(ge,{size:20})}),f(Ac),f(qr),f(li),Xu(li,ge=>x(un,ge),()=>s(un));var Id=u(li,2);Te(Id,()=>s(zn),ge=>{var Le=fV();Le.__click=[dV,Vd],Le.__touchstart=[uV,sd],Le.__touchend=[pV],Le.__pointerdown=[vV,Vd],z(ge,Le)}),f(hi);var Zc=u(hi,2);Te(Zc,()=>s(re),ge=>{var Le=mV(),dt=g(Le),At=u(g(dt),2),pt=g(At);ai(2),f(At);var at=u(At,2),Ct=g(at);Ct.__click=[kz,me,jo,re];var Re=u(Ct,2);Re.__click=[wz,me,jo,re],f(at),f(dt),f(Le),Se(()=>ze(pt,`${`You're changing the user interface to the ${s(me)==="light"?"Light":"Dark"} theme.`??""} `)),z(ge,Le)});var ce=u(Zc,2);Te(ce,()=>s(yt),ge=>{var Le=_V(),dt=Dt(Le);dt.__click=[gV,yt];var At=u(dt,2),pt=u(g(At),2),at=g(pt);at.__click=[hV,yt];var Ct=u(at,2),Re=g(Ct),kn=g(Re);If(kn,{name:"candle_solid",size:36}),ai(2),f(Re),f(Ct);var ro=u(Ct,8);Se(()=>zt(ro,"href",Pd("https://dutyai.app/settings/investor?device=1",void 0))),f(pt),f(At),Mf(3,dt,()=>Fg,()=>({duration:180})),Mf(3,At,()=>Fg,()=>({duration:200})),z(ge,Le)});var st=u(ce,2);yz(st,{get show(){return s(C)},$$events:{close:()=>x(C,!1)}}),Se(()=>{zh(mi,`menu-toggle-icon ${(s(w)?"":"rotate")??""} svelte-d8izos`),Us(we,`menu-btn ${(s(se)?"menu-btn-active":"")??""} ${(s(Y)?"rotate-loading":"")??""} svelte-d8izos`),zt(we,"title",s(se)?"Exit Fullscreen & Rotation":"Fullscreen & Rotate to Landscape"),we.disabled=s(Y),Fi(ne,"rotate-content-hidden",s(Y)),Fi(q,"rotate-icon-spinning",s(Y)),ze(an,s(G)),Us(ra,`undo-redo-btn ${(s(Zt)?"":"undo-redo-disabled")??""} svelte-d8izos`),Us(hl,`undo-redo-btn ${(s(dn)?"":"undo-redo-disabled")??""} svelte-d8izos`),zt(ea,"title",s(I)?"Exit Fullscreen":"Fullscreen")}),z(n,zl),hd()}qu(["click","change","touchstart","touchend","pointerdown"]);var xV=fe('<div class="modal-backdrop svelte-1oypfgf"><div class="modal-content svelte-1oypfgf"><div class="modal-actions svelte-1oypfgf"><button class="action-btn copy-btn svelte-1oypfgf"><svg width="12" height="12" viewBox="0 0 24 24" fill="none"><rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"></rect><path d="M5 15H4C2.9 15 2 14.1 2 13V4C2 2.9 2.9 2 4 2H13C14.1 2 15 2.9 15 4V5" stroke="currentColor" stroke-width="2"></path></svg> <span class="svelte-1oypfgf"> </span></button> <button class="action-btn reset-btn svelte-1oypfgf"><svg width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M3 12C3 7.03 7.03 3 12 3C16.97 3 21 7.03 21 12C21 16.97 16.97 21 12 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><path d="M3 12L7 8M3 12L7 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg> <span class="svelte-1oypfgf">Reset View</span></button></div></div></div>');function wV(n,e){gd(e,!1);let t=Ws(e,"isOpen",12,!1),o=Ws(e,"x",8,0),i=Ws(e,"y",8,0),r=Ws(e,"currentPrice",8,"");const a=mv();function l(){t(!1),a("close")}function c(){a("reset"),l()}function d(){a("copy",{price:r()}),l()}function p(w){w.target===w.currentTarget&&l()}function m(w){w.key==="Escape"&&l()}Bv();var h=Ln();sc("keydown",lk,m);var _=Dt(h);Te(_,t,w=>{var S=xV(),P=g(S),I=g(P),C=g(I),M=u(g(C),2),F=g(M);f(M),f(C);var V=u(C,2);f(I),f(P),f(S),Se(()=>{zt(P,"style",`left: ${o()??""}px; top: ${i()??""}px;`),ze(F,`Copy Price ${(r()?`(${r()})`:"")??""}`)}),sc("click",C,d),sc("click",V,c),sc("click",S,p),z(w,S)}),z(n,h),hd()}class kV{constructor(e){Ce(this,"chart");Ce(this,"overlays",new Map);Ce(this,"projectionQueue",new Set);Ce(this,"isProjecting",!1);Ce(this,"eventListeners",new Map);Ce(this,"resizeObserver");Ce(this,"periodicProjectionId");Ce(this,"lastViewportState");Ce(this,"animationFrameId",null);this.chart=e,this.initializeEventListeners()}initializeEventListeners(){if(typeof ResizeObserver<"u"){const e=this.chart.getDom();if(e){const t=new ResizeObserver(()=>{this.scheduleProjection("resize")});t.observe(e),this.resizeObserver=t}}this.setupPeriodicProjection()}setupPeriodicProjection(){this.periodicProjectionId=window.setInterval(()=>{const e=this.getViewportState();e!==this.lastViewportState&&(this.lastViewportState=e,this.scheduleProjection("scroll"))},100)}getViewportState(){try{const e=this.chart.getVisibleRange(),t=this.chart.getSize();return JSON.stringify({visibleRange:e,chartSize:t})}catch{return""}}scheduleProjection(e){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.animationFrameId=requestAnimationFrame(()=>{this.projectAllOverlays(e),this.animationFrameId=null})}addOverlay(e){this.overlays.set(e.id,e),e.points.length>0&&Tb(e.points,this.chart),this.projectOverlay(e)}removeOverlay(e){this.overlays.delete(e);try{this.chart.removeOverlay({id:e})}catch(t){console.warn("Could not remove overlay from chart:",t)}}updateOverlay(e){this.overlays.has(e.id)&&(this.overlays.set(e.id,e),e.points.length>0&&Tb(e.points,this.chart),this.projectOverlay(e))}getOverlay(e){return this.overlays.get(e)}getAllOverlays(){return Array.from(this.overlays.values())}projectOverlay(e){const t={chart:this.chart,paneId:"candle_pane"},o=Vw(e.points,t);return o.isValid&&e.visible!==!1&&this.updateChartOverlay(e,o.screenPoints),o}projectAllOverlays(e){if(!this.isProjecting){this.isProjecting=!0;try{const t={type:e,chart:this.chart,timestamp:Date.now()};this.emitEvent(e,t);for(const o of this.overlays.values())o.visible!==!1&&this.projectOverlay(o)}finally{this.isProjecting=!1}}}updateChartOverlay(e,t){try{const o=t.map(l=>({x:l.x,y:l.y})),i={id:e.id,name:e.type,points:o.map((l,c)=>{var d,p;return{...l,timestamp:(d=e.points[c])==null?void 0:d.t,value:(p=e.points[c])==null?void 0:p.p}}),styles:this.convertOverlayStyles(e.style),visible:e.visible,lock:e.lock},r=this.chart.getOverlays({id:e.id});(r.length>0?r[0]:null)?this.chart.overrideOverlay(i):this.chart.createOverlay(i)}catch(o){console.error("Error updating chart overlay:",o)}}convertOverlayStyles(e){const t={};return e.line&&(t.line={color:e.line.color,size:e.line.size,style:e.line.style==="dashed"?"dashed":"solid"},e.line.dashedValue&&(t.line.dashedValue=e.line.dashedValue)),e.text&&(t.text={color:e.text.color,backgroundColor:e.text.backgroundColor,borderColor:e.text.borderColor,fontSize:e.text.fontSize}),e.polygon&&(t.polygon={color:e.polygon.color,fillColor:e.polygon.fillColor}),t}onTimeframeChange(){this.scheduleProjection("timeframeChange")}onTimezoneChange(){this.scheduleProjection("timezoneChange")}onPriceScaleChange(){this.scheduleProjection("priceScaleChange")}addEventListener(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}removeEventListener(e,t){const o=this.eventListeners.get(e);o&&o.delete(t)}emitEvent(e,t){const o=this.eventListeners.get(e);o&&o.forEach(i=>{try{i(t)}catch(r){console.error("Error in overlay event listener:",r)}})}forceProjection(){this.projectAllOverlays("resize")}clearAllOverlays(){for(const e of this.overlays.keys())this.removeOverlay(e);this.overlays.clear()}dispose(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0),this.periodicProjectionId&&(clearInterval(this.periodicProjectionId),this.periodicProjectionId=void 0),this.clearAllOverlays(),this.eventListeners.clear()}}const SV={timeframeChange:{debounceMs:100,enabled:!0},zoom:{throttleMs:16,enabled:!0},scroll:{throttleMs:16,enabled:!0},resize:{debounceMs:250,enabled:!0},dataUpdate:{debounceMs:50,enabled:!0},priceScaleChange:{debounceMs:100,enabled:!0}};class CV{constructor(e,t={}){Ce(this,"chart");Ce(this,"projectionManager",null);Ce(this,"creationManager",null);Ce(this,"eventListeners",new Map);Ce(this,"resizeObserver",null);Ce(this,"config");Ce(this,"debounceTimers",new Map);Ce(this,"throttleTimers",new Map);this.chart=e,this.config={...SV,...t}}setProjectionManager(e){this.projectionManager=e}setCreationManager(e){this.creationManager=e}initialize(){this.setupChartEventListeners(),this.setupResizeObserver(),this.setupCustomEventListeners()}setupChartEventListeners(){this.setupViewportChangeDetection()}setupViewportChangeDetection(){let e=null;const o=setInterval(()=>{try{const i=this.chart.getVisibleRange();i&&this.hasRangeChanged(e,i)&&(e=i,this.handleEvent("scroll"))}catch(i){console.error("Error checking viewport changes:",i)}},16);this.eventListeners.set("viewportPolling",()=>clearInterval(o))}setupResizeObserver(){const e=this.chart.getDom();e&&(this.resizeObserver=new ResizeObserver(()=>{this.handleEvent("resize")}),this.resizeObserver.observe(e))}setupCustomEventListeners(){const e=this.chart.getDom();if(!e)return;const t=()=>this.handleEvent("timeframeChange"),o=()=>this.handleEvent("dataUpdate");e.addEventListener("timeframeChange",t),e.addEventListener("dataUpdate",o),this.eventListeners.set("timeframeChange",()=>{e.removeEventListener("timeframeChange",t)}),this.eventListeners.set("dataUpdate",()=>{e.removeEventListener("dataUpdate",o)})}handleEvent(e){const t=this.config[e];t.enabled&&(t.debounceMs?this.debounceEvent(e,t.debounceMs):t.throttleMs?this.throttleEvent(e,t.throttleMs):this.executeEvent(e))}debounceEvent(e,t){const o=this.debounceTimers.get(e);o&&clearTimeout(o);const i=setTimeout(()=>{this.executeEvent(e),this.debounceTimers.delete(e)},t);this.debounceTimers.set(e,i)}throttleEvent(e,t){const o=this.throttleTimers.get(e)||0,i=Date.now();i-o>=t&&(this.executeEvent(e),this.throttleTimers.set(e,i))}executeEvent(e){try{this.projectionManager&&this.projectionManager.forceProjection();const t=this.chart.getDom();t&&t.dispatchEvent(new CustomEvent("overlayEvent",{detail:{type:e,timestamp:Date.now()}}))}catch(t){console.error(`Error handling ${e} event:`,t)}}hasRangeChanged(e,t){return e?e.from!==t.from||e.to!==t.to:!0}hasPriceRangeChanged(e,t){return e?Math.abs(e.min-t.min)>1e-8||Math.abs(e.max-t.max)>1e-8:!0}triggerEvent(e){this.handleEvent(e)}updateConfig(e,t){this.config[e]={...this.config[e],...t}}setEventEnabled(e,t){this.config[e].enabled=t}destroy(){this.debounceTimers.forEach(e=>clearTimeout(e)),this.debounceTimers.clear(),this.throttleTimers.clear(),this.eventListeners.forEach(e=>e()),this.eventListeners.clear(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}}function Ob(n){return typeof n=="object"&&n!==null&&typeof n.x=="number"&&typeof n.y=="number"}function zb(n){return typeof n=="object"&&n!==null&&typeof n.timestamp=="number"&&typeof n.value=="number"}function _1(n){return typeof n=="object"&&n!==null}class PV{constructor(e){Ce(this,"chart");Ce(this,"currentSymbolKey",null);this.chart=e}toDrawing(e,t){try{if(!this.currentSymbolKey)return null;const o=Array.isArray(t==null?void 0:t.points)?t.points.map(d=>{if(d&&typeof d=="object"){if(typeof d.timestamp=="number"&&typeof d.value=="number")return{time:d.timestamp,price:d.value};if(typeof d.t=="number"&&typeof d.p=="number")return{time:d.t,price:d.p}}return null}).filter(Boolean):[];if(o.length===0)return null;const i=(t==null?void 0:t.name)||(t==null?void 0:t.type)||"unknown",r=(t==null?void 0:t.styles)||(t==null?void 0:t.style)||{},a=!!(t!=null&&t.lock),l=(t==null?void 0:t.visible)!==!1;return{id:e,symbolKey:this.currentSymbolKey,type:i,points:o,styles:r,...t!=null&&t.extendData?{extendData:t.extendData}:{},locked:a,visible:l}}catch{return null}}setCurrentSymbolKey(e){this.currentSymbolKey=e,console.log("📍 OverlayCreationManager symbol set:",e)}getCurrentSymbolKey(){return this.currentSymbolKey}createPointFromMouse(e,t){try{const o={x:e,y:t},i={chart:this.chart},r=wE(o,i);return r?{timestamp:r.t,value:r.p}:null}catch(o){return console.error("Failed to create point from mouse coordinates:",o),null}}createDataSpaceOverlay(e){if(!_1(e)||!e.points||!Array.isArray(e.points))return e;const t=e.points.map(o=>{if(Ob(o)){const i=this.createPointFromMouse(o.x,o.y);return i?{timestamp:i.timestamp,value:i.value}:o}else if(zb(o))return o;return o});return{...e,points:t,_isDataSpace:!0}}convertLegacyOverlay(e){if(!_1(e)||e._isDataSpace||!e.points)return e;const t=e.points.map(o=>{if(Ob(o)){const i=this.createPointFromMouse(o.x,o.y);return i?{timestamp:i.timestamp,value:i.value}:o}return o});return{...e,points:t,_isDataSpace:!0}}projectOverlayToScreen(e){if(!_1(e)||!e._isDataSpace||!e.points)return e;const t=e.points.map(o=>{if(zb(o)){const i={id:o.id||"temp",t:o.timestamp,p:o.value},r={chart:this.chart},a=v_(i,r);return a?{x:a.x,y:a.y}:o}return o});return{...e,points:t}}addOverlay(e){try{const t=this.createDataSpaceOverlay(e),o=this.projectOverlayToScreen(t),i=this.chart.createOverlay(o);if(i){const r=Array.isArray(i)?i[0]:i;if(typeof r=="string"){const a=cm();if(a){const l=this.toDrawing(r,t);if(l){a.addDrawing(l);try{dm()}catch{}}}}return r}return null}catch(t){return console.error("Failed to add overlay:",t),null}}storeDataSpaceOverlay(e,t){}getStoredDataSpaceOverlay(e){try{const t=localStorage.getItem("dataSpaceOverlays");return t&&JSON.parse(t)[e]||null}catch(t){return console.error("Failed to retrieve data-space overlay:",t),null}}removeStoredDataSpaceOverlay(e){try{const t=cm();if(t){t.removeDrawing(e);try{dm()}catch{}}}catch(t){console.error("Failed to remove overlay from DrawingManager:",t)}}}function IV(n){return n.createDataSpaceTemplate("enhancedRect",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:o})=>{var c,d,p,m,h,_;if(o.length<2)return[];const[i,r]=o,a=[],l=30;return a.push({type:"rect",attrs:{x:Math.min(i.x,r.x)-l,y:Math.min(i.y,r.y)-l,width:Math.abs(r.x-i.x)+l*2,height:Math.abs(r.y-i.y)+l*2},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),a.push({type:"rect",attrs:{x:Math.min(i.x,r.x),y:Math.min(i.y,r.y),width:Math.abs(r.x-i.x),height:Math.abs(r.y-i.y)},styles:{style:"stroke",color:((d=(c=e.style)==null?void 0:c.line)==null?void 0:d.color)||"#1677FF",borderSize:((m=(p=e.style)==null?void 0:p.line)==null?void 0:m.size)||1,borderStyle:((_=(h=e.style)==null?void 0:h.line)==null?void 0:_.style)||"solid"}}),a},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function MV(n){return n.createDataSpaceTemplate("enhancedCircle",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:o})=>{var d,p,m,h,_,w;if(o.length<2)return[];const[i,r]=o,a=Math.sqrt(Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2)),l=[];return l.push({type:"circle",attrs:{x:i.x,y:i.y,r:a+30},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),l.push({type:"circle",attrs:{x:i.x,y:i.y,r:a},styles:{style:"stroke",color:((p=(d=e.style)==null?void 0:d.line)==null?void 0:p.color)||"#1677FF",borderSize:((h=(m=e.style)==null?void 0:m.line)==null?void 0:h.size)||1,borderStyle:((w=(_=e.style)==null?void 0:_.line)==null?void 0:w.style)||"solid"}}),l},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function AV(n){return n.createDataSpaceTemplate("enhancedLine",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:o})=>{var r,a,l,c,d,p;if(o.length<2)return[];const i=[];for(let m=0;m<o.length-1;m++){const h=o[m],_=o[m+1];i.push({type:"line",attrs:{coordinates:[{x:h.x,y:h.y},{x:_.x,y:_.y}]},styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),i.push({type:"line",attrs:{coordinates:[{x:h.x,y:h.y},{x:_.x,y:_.y}]},styles:{color:((a=(r=e.style)==null?void 0:r.line)==null?void 0:a.color)||"#1677FF",size:((c=(l=e.style)==null?void 0:l.line)==null?void 0:c.size)||.5,style:((p=(d=e.style)==null?void 0:d.line)==null?void 0:p.style)||"solid"}})}return i},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function TV(n){return n.createDataSpaceTemplate("enhancedTrendLine",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:o,chart:i})=>{var h,_,w,S,P,I;if(o.length<2)return[];const[r,a]=o,l=[];let c=r,d=a;const p=e.extendLeft,m=e.extendRight;if(p||m){const C=i.getSize();if(C){const M=(a.y-r.y)/(a.x-r.x);if(p&&(c={x:0,y:r.y+M*(0-r.x)}),m){const F=r.y+M*(C.width-r.x);d={x:C.width,y:F}}}}return l.push({type:"line",attrs:{coordinates:[{x:c.x,y:c.y},{x:d.x,y:d.y}]},styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),l.push({type:"line",attrs:{coordinates:[{x:c.x,y:c.y},{x:d.x,y:d.y}]},styles:{color:((_=(h=e.style)==null?void 0:h.line)==null?void 0:_.color)||"#1677FF",size:((S=(w=e.style)==null?void 0:w.line)==null?void 0:S.size)||.5,style:((I=(P=e.style)==null?void 0:P.line)==null?void 0:I.style)||"solid"}}),l},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function LV(n){return n.createDataSpaceTemplate("enhancedFibonacci",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:o})=>{if(o.length<2)return[];const[i,r]=o,a=[],l=[0,.236,.382,.5,.618,.786,1,1.618,2.618],c=r.y-i.y;return l.forEach(d=>{var m,h,_,w,S,P,I,C;const p=i.y+c*d;a.push({type:"line",attrs:{coordinates:[{x:Math.min(i.x,r.x),y:p},{x:Math.max(i.x,r.x),y:p}]},styles:{color:"transparent",size:30,style:"solid"},ignoreEvent:!1}),a.push({type:"line",attrs:{coordinates:[{x:Math.min(i.x,r.x),y:p},{x:Math.max(i.x,r.x),y:p}]},styles:{color:((h=(m=e.style)==null?void 0:m.line)==null?void 0:h.color)||"#1677FF",style:"dashed",size:((w=(_=e.style)==null?void 0:_.line)==null?void 0:w.size)||2}}),a.push({type:"text",attrs:{x:Math.max(i.x,r.x)+5,y:p,text:`${(d*100).toFixed(1)}%`},styles:{color:((P=(S=e.style)==null?void 0:S.text)==null?void 0:P.color)||"#666666",size:((C=(I=e.style)==null?void 0:I.text)==null?void 0:C.fontSize)||12}})}),a},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function FV(n){return{enhancedRect:IV(n),enhancedCircle:MV(n),enhancedLine:AV(n),enhancedTrendLine:TV(n),enhancedFibonacci:LV(n)}}const Th=n=>n>="0"&&n<="9",Vb=n=>n>="a"&&n<="z"||n>="A"&&n<="Z"||n==="_"||n==="$";class $V{constructor(e){Ce(this,"pos",0);this.input=e}next(){const e=this.input,t=e.length;for(;this.pos<t&&/\s/.test(e[this.pos]??"");)this.pos++;if(this.pos>=t)return{type:"eof",start:this.pos,end:this.pos};const o=e[this.pos],i=this.pos;if(o==='"'||o==="'"){const r=o;this.pos++;let a="",l=!1;for(;this.pos<t;){const c=e[this.pos];if(this.pos++,l){switch(c){case"n":a+=`
`;break;case"t":a+="	";break;case"r":a+="\r";break;case"\\":case"'":case'"':a+=c;break;default:a+=c;break}l=!1;continue}if(c==="\\"){l=!0;continue}if(c===r)break;a+=c}return{type:"string",value:a,start:i,end:this.pos}}if(Th(o)||o==="."&&Th(e[this.pos+1]??"")){let r=o===".";for(this.pos++;this.pos<t;){const a=e[this.pos];if(Th(a))this.pos++;else if(a==="."&&!r)r=!0,this.pos++;else break}if(e[this.pos]==="e"||e[this.pos]==="E"){let l=this.pos+1;(e[l]==="+"||e[l]==="-")&&l++;const c=l;for(;l<t&&Th(e[l]);)l++;l>c&&(this.pos=l)}return{type:"number",value:e.slice(i,this.pos),start:i,end:this.pos}}if(Vb(o)){for(this.pos++;this.pos<t;){const l=e[this.pos];if(Vb(l)||Th(l))this.pos++;else break}const r=e.slice(i,this.pos),a=r.toLowerCase();return a==="and"?{type:"and",start:i,end:this.pos}:a==="or"?{type:"or",start:i,end:this.pos}:a==="not"?{type:"not",start:i,end:this.pos}:a==="true"||a==="false"?{type:"boolean",value:a,start:i,end:this.pos}:{type:"identifier",value:r,start:i,end:this.pos}}switch(this.pos++,o){case">":return e[this.pos]==="="?(this.pos++,{type:"gte",start:i,end:this.pos}):{type:"gt",start:i,end:this.pos};case"<":return e[this.pos]==="="?(this.pos++,{type:"lte",start:i,end:this.pos}):{type:"lt",start:i,end:this.pos};case"=":if(e[this.pos]==="=")return this.pos++,{type:"eq",start:i,end:this.pos};throw new Error(`Unexpected '=' at position ${i}`);case"!":if(e[this.pos]==="=")return this.pos++,{type:"neq",start:i,end:this.pos};throw new Error(`Unexpected '!' at position ${i}`);case"+":return{type:"plus",start:i,end:this.pos};case"-":return{type:"minus",start:i,end:this.pos};case"*":return{type:"star",start:i,end:this.pos};case"/":return{type:"slash",start:i,end:this.pos};case"%":return{type:"percent",start:i,end:this.pos};case"(":return{type:"lparen",start:i,end:this.pos};case")":return{type:"rparen",start:i,end:this.pos};case",":return{type:"comma",start:i,end:this.pos};case"?":return{type:"qmark",start:i,end:this.pos};case":":return{type:"colon",start:i,end:this.pos};default:throw new Error(`Unexpected character "${o}" at position ${i}`)}}}class Tm extends Error{constructor(e,t){super(e),this.position=t,this.name="ParseError"}}class EV{constructor(e){Ce(this,"current");this.tokenizer=e,this.current=e.next()}eat(e){if(this.current.type!==e)throw new Tm(`Expected ${e} but found ${this.current.type}`,this.current.start);const t=this.current;return this.current=this.tokenizer.next(),t}match(e){return this.current.type===e?(this.current=this.tokenizer.next(),!0):!1}parseExpression(){return this.parseTernary()}parseTernary(){const e=this.parseOr();if(this.current.type==="qmark"){this.current=this.tokenizer.next();const t=this.parseExpression();this.eat("colon");const o=this.parseExpression();return{kind:"CallExpression",callee:"iff",args:[e,t,o]}}return e}parseOr(){let e=this.parseAnd();for(;this.current.type==="or";){this.current=this.tokenizer.next();const t=this.parseAnd();e={kind:"BinaryExpression",operator:"or",left:e,right:t}}return e}parseAnd(){let e=this.parseComparison();for(;this.current.type==="and";){this.current=this.tokenizer.next();const t=this.parseComparison();e={kind:"BinaryExpression",operator:"and",left:e,right:t}}return e}parseComparison(){let e=this.parseAddSub();for(;this.current.type==="gt"||this.current.type==="lt"||this.current.type==="gte"||this.current.type==="lte"||this.current.type==="eq"||this.current.type==="neq";){const t=this.current;this.current=this.tokenizer.next();const o=this.parseAddSub();let i="==";t.type==="gt"?i=">":t.type==="lt"?i="<":t.type==="gte"?i=">=":t.type==="lte"?i="<=":t.type==="neq"&&(i="!="),e={kind:"BinaryExpression",operator:i,left:e,right:o}}return e}parseAddSub(){let e=this.parseTerm();for(;this.current.type==="plus"||this.current.type==="minus";){const t=this.current;this.current=this.tokenizer.next();const o=this.parseTerm();e={kind:"BinaryExpression",operator:t.type==="plus"?"+":"-",left:e,right:o}}return e}parseTerm(){let e=this.parseFactor();for(;this.current.type==="star"||this.current.type==="slash"||this.current.type==="percent";){const t=this.current;this.current=this.tokenizer.next();const o=this.parseFactor();e={kind:"BinaryExpression",operator:t.type==="star"?"*":t.type==="slash"?"/":"%",left:e,right:o}}return e}parseFactor(){if(this.current.type==="not")return this.current=this.tokenizer.next(),{kind:"UnaryExpression",operator:"not",expr:this.parseFactor()};if(this.current.type==="plus"||this.current.type==="minus"){const e=this.current.type==="minus";this.current=this.tokenizer.next();const t=this.parseFactor();return e?{kind:"BinaryExpression",operator:"*",left:{kind:"NumberLiteral",value:-1},right:t}:t}return this.parsePrimary()}parsePrimary(){const e=this.current;switch(e.type){case"number":{this.current=this.tokenizer.next();const t=Number(e.value);if(!Number.isFinite(t))throw new Tm("Invalid number literal",e.start);return{kind:"NumberLiteral",value:t}}case"string":return this.current=this.tokenizer.next(),{kind:"StringLiteral",value:String(e.value??"")};case"boolean":return this.current=this.tokenizer.next(),{kind:"NumberLiteral",value:String(e.value||"").toLowerCase()==="true"?1:0};case"identifier":{this.current=this.tokenizer.next();const t=(e.value||"").toString();if(this.current.type==="lparen"){this.eat("lparen");const o=[];if(this.current.type!=="rparen")for(;o.push(this.parseExpression()),!!this.match("comma"););return this.eat("rparen"),{kind:"CallExpression",callee:t,args:o}}return{kind:"Identifier",name:t}}case"lparen":{this.eat("lparen");const t=this.parseExpression();return this.eat("rparen"),t}default:throw new Tm(`Unexpected token ${e.type}`,e.start)}}}function Tf(n){const e=new EV(new $V(n)),t=e.parseExpression();if(e.current.type!=="eof")throw new Tm("Unexpected input after end of expression",e.current.start);return t}function ef(n){if(!n)return 0;let e=2166136261;for(let o=0;o<n.length;o++)e^=n.charCodeAt(o),e=Math.imul(e,16777619);const t=e>>>0;return t===0?1:t}function s0(n){return Number.isFinite(n)?n.toFixed(2):""}function G1(n,e){if(!Number.isFinite(n))return"";if(!e)return s0(n);const t=String(e),o=t.includes("%"),i=t.split(".");let r=0;i.length>1&&(r=i[1].replace(/[^0-9#]/g,"").length);const a=o?n*100:n,l=r>0?a.toFixed(r):String(Math.round(a));return o?`${l}%`:l}class Ls extends Error{constructor(e){super(e),this.name="ExpressionEngineError"}}function NV(n,e){const t=n.length,o=new Float32Array(t);let i=0;for(let r=0;r<t;r++){const a=n[r];if(Number.isFinite(a)&&(i+=a),r>=e){const l=n[r-e];Number.isFinite(l)&&(i-=l)}o[r]=r>=e-1?i:NaN}return o}function DV(n,e){const t=n.length,o=new Float32Array(t),i=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-i,l=n[r],c=a>=0?n[a]:NaN;o[r]=Number.isFinite(l)&&Number.isFinite(c)?l-c:NaN}return o}function jV(n,e){const t=n.length,o=new Float32Array(t),i=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-i,l=n[r],c=a>=0?n[a]:NaN;!Number.isFinite(l)||!Number.isFinite(c)||c===0?o[r]=NaN:o[r]=(l-c)/c*100}return o}function RV(n,e){const t=n.length,o=new Float32Array(t),i=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-i,l=n[r],c=a>=0?n[a]:NaN;o[r]=Number.isFinite(l)&&Number.isFinite(c)?l-c:NaN}return o}function mc(n,e){if(n.kind==="series")return n.value;const t=new Float32Array(e.length);return t.fill(n.value),t}function Qf(n){if(n.kind==="scalar")return n.value;const e=n.value;return e.length?e[e.length-1]:NaN}function Wb(n,e){const t=n.length,o=new Float32Array(t);for(let i=0;i<t;i++)o[i]=e(n[i]);return o}function y1(n,e,t){const o=n.length,i=new Float32Array(o);for(let r=0;r<o;r++)i[r]=t(n[r],e[r]);return i}function BV(n,e,t,o){const i=e.kind==="series",r=t.kind==="series",a=m=>Number.isFinite(m)&&m!==0;if(!i&&!r){const m=e.value,h=t.value;switch(n){case"+":return{kind:"scalar",value:m+h};case"-":return{kind:"scalar",value:m-h};case"*":return{kind:"scalar",value:m*h};case"/":return{kind:"scalar",value:h===0?NaN:m/h};case"%":return{kind:"scalar",value:h===0?NaN:m%h};case">":return{kind:"scalar",value:Number.isFinite(m)&&Number.isFinite(h)&&m>h?1:0};case"<":return{kind:"scalar",value:Number.isFinite(m)&&Number.isFinite(h)&&m<h?1:0};case">=":return{kind:"scalar",value:Number.isFinite(m)&&Number.isFinite(h)&&m>=h?1:0};case"<=":return{kind:"scalar",value:Number.isFinite(m)&&Number.isFinite(h)&&m<=h?1:0};case"==":return{kind:"scalar",value:Number.isFinite(m)&&Number.isFinite(h)&&Math.abs(m-h)<1e-9?1:0};case"!=":return{kind:"scalar",value:Number.isFinite(m)&&Number.isFinite(h)&&Math.abs(m-h)>=1e-9?1:0};case"and":return{kind:"scalar",value:a(m)&&a(h)?1:0};case"or":return{kind:"scalar",value:a(m)||a(h)?1:0}}}const l=mc(e,o),c=mc(t,o),d=o.length,p=new Float32Array(d);for(let m=0;m<d;m++){const h=l[m],_=c[m];switch(n){case"+":p[m]=h+_;break;case"-":p[m]=h-_;break;case"*":p[m]=h*_;break;case"/":p[m]=_===0?NaN:h/_;break;case"%":p[m]=_===0?NaN:h%_;break;case">":p[m]=Number.isFinite(h)&&Number.isFinite(_)&&h>_?1:0;break;case"<":p[m]=Number.isFinite(h)&&Number.isFinite(_)&&h<_?1:0;break;case">=":p[m]=Number.isFinite(h)&&Number.isFinite(_)&&h>=_?1:0;break;case"<=":p[m]=Number.isFinite(h)&&Number.isFinite(_)&&h<=_?1:0;break;case"==":p[m]=Number.isFinite(h)&&Number.isFinite(_)&&Math.abs(h-_)<1e-9?1:0;break;case"!=":p[m]=Number.isFinite(h)&&Number.isFinite(_)&&Math.abs(h-_)>=1e-9?1:0;break;case"and":p[m]=a(h)&&a(_)?1:0;break;case"or":p[m]=a(h)||a(_)?1:0;break}}return{kind:"series",value:p}}function OV(n,e){const t=n.length,o=new Float32Array(t);let i=0,r=0;for(let a=0;a<t;a++){const l=n[a];if(Number.isFinite(l)&&(i+=l,r+=1),a>=e){const c=n[a-e];Number.isFinite(c)&&(i-=c,r-=1)}a>=e-1?o[a]=r>0?i/r:NaN:o[a]=NaN}return o}function zV(n,e){const t=n.length,o=new Float32Array(t),i=2/(e+1);let r;for(let a=0;a<t;a++){const l=n[a];if(!Number.isFinite(l)){o[a]=r===void 0?NaN:r;continue}if(r===void 0||!Number.isFinite(r)){r=l,o[a]=l;continue}r=l*i+r*(1-i),o[a]=r}return o}function qb(n,e){const t=n.length,o=new Float32Array(t);let i,r=0,a=0;for(let l=0;l<t;l++){const c=n[l];if(i===void 0){if(Number.isFinite(c)&&(r+=c,a+=1),a<e){o[l]=NaN;continue}i=r/e,o[l]=i;continue}Number.isFinite(c)&&(i=(i*(e-1)+c)/e),o[l]=i}return o}function VV(n,e){const t=n.length,o=new Float32Array(t);let i,r=0,a=0,l=!1;const c=[],d=[];for(let p=0;p<t;p++){const m=n[p];if(!Number.isFinite(m)){o[p]=NaN;continue}if(i===void 0){i=m,o[p]=NaN;continue}if(!Number.isFinite(i)){i=m,o[p]=NaN;continue}const h=m-i;i=m;const _=h>0?h:0,w=h<0?-h:0;if(l)r=(r*(e-1)+_)/e,a=(a*(e-1)+w)/e;else{c.push(_),d.push(w);const S=c.length,P=Math.max(1,Math.min(e,S));r=c.reduce((I,C)=>I+C,0)/P,a=d.reduce((I,C)=>I+C,0)/P,S>=e&&(l=!0)}if(a===0)o[p]=100;else{const S=r/a;o[p]=100-100/(1+S)}}return o}function WV(n,e){const t=n.length,o=new Float32Array(t);for(let i=0;i<t;i++){if(i<e-1){o[i]=NaN;continue}let r=0,a=0;for(let d=i-e+1;d<=i;d++){const p=n[d];Number.isFinite(p)&&(r+=p,a+=1)}if(a<2){o[i]=NaN;continue}const l=r/a;let c=0;for(let d=i-e+1;d<=i;d++){const p=n[d];if(!Number.isFinite(p))continue;const m=p-l;c+=m*m}o[i]=Math.sqrt(c/a)}return o}function qV(n,e){const t=n.length,o=new Float32Array(t);for(let i=0;i<t;i++){if(i<e-1){o[i]=NaN;continue}let r=0,a=0;for(let l=0;l<e;l++){const c=n[i-l],d=e-l;Number.isFinite(c)&&(r+=c*d,a+=d)}o[i]=a>0?r/a:NaN}return o}function HV(n,e){const t=n.length,o=new Float32Array(t);for(let i=0;i<t;i++){let r=-1/0,a=!1;const l=Math.max(0,i-e+1);for(let c=l;c<=i;c++){const d=n[c];Number.isFinite(d)&&(a=!0,d>r&&(r=d))}o[i]=a?r:NaN}return o}function UV(n,e){const t=n.length,o=new Float32Array(t);for(let i=0;i<t;i++){let r=1/0,a=!1;const l=Math.max(0,i-e+1);for(let c=l;c<=i;c++){const d=n[c];Number.isFinite(d)&&(a=!0,d<r&&(r=d))}o[i]=a?r:NaN}return o}function GV(n,e){const t=n.length,o=new Float32Array(t);for(let i=0;i<t;i++){if(i<e-1){o[i]=NaN;continue}let r=-1/0,a=NaN;for(let l=0;l<e;l++){const c=i-l,d=n[c];Number.isFinite(d)&&d>r&&(r=d,a=l)}o[i]=Number.isFinite(a)?a:NaN}return o}function YV(n,e){const t=n.length,o=new Float32Array(t);for(let i=0;i<t;i++){if(i<e-1){o[i]=NaN;continue}let r=1/0,a=NaN;for(let l=0;l<e;l++){const c=i-l,d=n[c];Number.isFinite(d)&&d<r&&(r=d,a=l)}o[i]=Number.isFinite(a)?a:NaN}return o}function KV(n,e){const t=n.length,o=new Float32Array(t);for(let i=0;i<t;i++){if(i<e-1){o[i]=NaN;continue}let r=0,a=0,l=0;const c=i-e+1;for(let m=c;m<=i;m++){const h=n[m];Number.isFinite(h)&&(r+=h,a+=h*h,l+=1)}if(l<2){o[i]=NaN;continue}const d=r/l,p=a/l-d*d;o[i]=Number.isFinite(p)?p:NaN}return o}function ZV(n,e,t){const o=n.length,i=new Float32Array(o);for(let r=0;r<o;r++){if(r<t-1){i[r]=NaN;continue}let a=0,l=0,c=0,d=0,p=0,m=0;const h=r-t+1;for(let M=h;M<=r;M++){const F=n[M],V=e[M];!Number.isFinite(F)||!Number.isFinite(V)||(a+=F,l+=V,c+=F*F,d+=V*V,p+=F*V,m+=1)}if(m<2){i[r]=NaN;continue}const _=a/m,w=l/m,S=p/m-_*w,P=c/m-_*_,I=d/m-w*w,C=Math.sqrt(P*I);i[r]=C>0?S/C:NaN}return i}function XV(n,e,t){const o=n.length,i=new Float32Array(o),r=Math.max(1,Math.floor(e)),a=Math.floor(t),l=(r-1)*r/2,c=(r-1)*r*(2*r-1)/6,d=r*c-l*l;for(let p=0;p<o;p++){if(p<r-1||d===0){i[p]=NaN;continue}let m=0,h=0,_=0;for(let I=0;I<r;I++){const C=p-(r-1-I),M=n[C];Number.isFinite(M)&&(m+=M,h+=M*I,_+=1)}if(_<2){i[p]=NaN;continue}const w=(r*h-l*m)/d,S=(m-w*l)/r,P=r-1+a;i[p]=S+w*P}return i}function JV(n,e){const t=n.callee.toLowerCase(),o=_y(t);if(o){if(!e.draw)return{kind:"scalar",value:NaN};const l=n.args[0];let c="";if(l&&l.kind==="Identifier"&&(c=l.name),l&&l.kind==="StringLiteral"&&(c=l.value),!c)return{kind:"scalar",value:NaN};const d=e.length,p=new Float32Array(d);for(let m=0;m<d;m++){const h=e.draw.get(o.kind,o.prop,c,m);typeof h=="string"?p[m]=ef(h):typeof h=="number"&&Number.isFinite(h)?p[m]=h:p[m]=NaN}return{kind:"series",value:p}}const i=n.args.map(l=>Qg(l,e)),r=Yw(t);if(r){if(!e.strategy)return{kind:"scalar",value:NaN};if(!i.length)throw new Ls(`${n.callee} expects (index)`);const l=mc(i[0],e),c=e.length,d=new Float32Array(c);for(let p=0;p<c;p++){const m=l[p],h=Number.isFinite(m)?Math.floor(m):NaN;if(!Number.isFinite(h)){d[p]=NaN;continue}d[p]=Kw(e,r.kind,r.prop,p,h)}return{kind:"series",value:d}}const a=()=>{if(i.length!==2)throw new Ls(`${t} expects (series, period)`);const l=mc(i[0],e),c=Math.max(1,Math.floor(Qf(i[1])));return[l,c]};switch(t){case"iff":case"iif":case"if":{if(i.length!==3)throw new Ls(`${n.callee} expects (cond, a, b)`);const l=i[0],c=i[1],d=i[2],p=l.kind==="series",m=c.kind==="series",h=d.kind==="series";if(!p&&!m&&!h){const C=l.value;return{kind:"scalar",value:Number.isFinite(C)&&C!==0?c.value:d.value}}const _=mc(l,e),w=mc(c,e),S=mc(d,e),P=e.length,I=new Float32Array(P);for(let C=0;C<P;C++){const M=_[C],F=Number.isFinite(M)&&M!==0;I[C]=F?w[C]:S[C]}return{kind:"series",value:I}}case"nz":{if(i.length<1||i.length>2)throw new Ls("nz expects (series[, fallback])");const l=i[0],c=i[1]??{kind:"scalar",value:0};if(l.kind==="scalar"&&c.kind==="scalar")return{kind:"scalar",value:Number.isFinite(l.value)?l.value:c.value};const d=mc(l,e),p=mc(c,e),m=e.length,h=new Float32Array(m);for(let _=0;_<m;_++){const w=d[_];h[_]=Number.isFinite(w)?w:p[_]}return{kind:"series",value:h}}case"add":case"sub":case"mul":case"div":{if(i.length!==2)throw new Ls(`${t} expects 2 arguments`);const l=i[0],c=i[1];if(l.kind==="scalar"&&c.kind==="scalar"){const _=l.value,w=c.value;return t==="add"?{kind:"scalar",value:_+w}:t==="sub"?{kind:"scalar",value:_-w}:t==="mul"?{kind:"scalar",value:_*w}:{kind:"scalar",value:w===0?NaN:_/w}}const d=mc(l,e),p=mc(c,e),m=e.length,h=new Float32Array(m);for(let _=0;_<m;_++){const w=d[_],S=p[_];t==="add"?h[_]=w+S:t==="sub"?h[_]=w-S:t==="mul"?h[_]=w*S:h[_]=S===0?NaN:w/S}return{kind:"series",value:h}}case"pow":{if(i.length!==2)throw new Ls("pow expects 2 arguments");const l=i[0],c=i[1];if(l.kind==="scalar"&&c.kind==="scalar")return{kind:"scalar",value:Math.pow(l.value,c.value)};const d=mc(l,e),p=mc(c,e);return{kind:"series",value:y1(d,p,(m,h)=>Math.pow(m,h))}}case"sqrt":case"log":case"ln":case"log10":case"exp":case"floor":case"ceil":case"round":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"sign":{if(i.length!==1)throw new Ls(`${t} expects 1 argument`);const l=t==="sqrt"?Math.sqrt:t==="log"||t==="ln"?Math.log:t==="log10"?Math.log10:t==="exp"?Math.exp:t==="floor"?Math.floor:t==="ceil"?Math.ceil:t==="round"?Math.round:t==="sin"?Math.sin:t==="cos"?Math.cos:t==="tan"?Math.tan:t==="asin"?Math.asin:t==="acos"?Math.acos:t==="atan"?Math.atan:Math.sign,c=i[0];return c.kind==="scalar"?{kind:"scalar",value:l(c.value)}:{kind:"series",value:Wb(mc(c,e),l)}}case"todegrees":case"toradians":{if(i.length!==1)throw new Ls(`${t} expects 1 argument`);const l=i[0],c=t==="todegrees"?180/Math.PI:Math.PI/180;return l.kind==="scalar"?{kind:"scalar",value:l.value*c}:{kind:"series",value:Wb(mc(l,e),d=>d*c)}}case"atan2":{if(i.length!==2)throw new Ls("atan2 expects (y, x)");const l=i[0],c=i[1];if(l.kind==="scalar"&&c.kind==="scalar")return{kind:"scalar",value:Math.atan2(l.value,c.value)};const d=mc(l,e),p=mc(c,e);return{kind:"series",value:y1(d,p,(m,h)=>Math.atan2(m,h))}}case"avg":{if(i.length!==2)throw new Ls("avg expects (a, b)");const l=i[0],c=i[1];if(l.kind==="scalar"&&c.kind==="scalar")return{kind:"scalar",value:(l.value+c.value)/2};const d=mc(l,e),p=mc(c,e);return{kind:"series",value:y1(d,p,(m,h)=>(m+h)/2)}}case"clamp":{if(i.length!==3)throw new Ls("clamp expects (x, min, max)");const l=i[0],c=i[1],d=i[2],p=(P,I,C)=>Math.min(C,Math.max(I,P));if(l.kind==="scalar"&&c.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:p(l.value,c.value,d.value)};const m=mc(l,e),h=mc(c,e),_=mc(d,e),w=e.length,S=new Float32Array(w);for(let P=0;P<w;P++)S[P]=p(m[P],h[P],_[P]);return{kind:"series",value:S}}case"cum":case"cumsum":{if(i.length!==1)throw new Ls(`${t} expects 1 argument`);const l=mc(i[0],e),c=e.length,d=new Float32Array(c);let p=0;for(let m=0;m<c;m++){const h=l[m];Number.isFinite(h)&&(p+=h),d[m]=p}return{kind:"series",value:d}}case"barssince":{if(i.length!==1)throw new Ls("barssince expects (condition)");const l=mc(i[0],e),c=e.length,d=new Float32Array(c);let p=NaN;for(let m=0;m<c;m++){const h=l[m];Number.isFinite(h)&&h!==0?(p=0,d[m]=0):Number.isFinite(p)?(p+=1,d[m]=p):d[m]=NaN}return{kind:"series",value:d}}case"sma":{const[l,c]=a();return{kind:"series",value:OV(l,c)}}case"wma":{const[l,c]=a();return{kind:"series",value:qV(l,c)}}case"ema":{const[l,c]=a();return{kind:"series",value:zV(l,c)}}case"smma":{const[l,c]=a();return{kind:"series",value:qb(l,c)}}case"rsi":{const[l,c]=a();return{kind:"series",value:VV(l,c)}}case"rma":{const[l,c]=a();return{kind:"series",value:qb(l,c)}}case"linreg":{if(i.length<2||i.length>3)throw new Ls("linreg expects (series, period[, offset])");const l=mc(i[0],e),c=Math.max(1,Math.floor(Qf(i[1]))),d=i[2]?Math.floor(Qf(i[2])):0;return{kind:"series",value:XV(l,c,d)}}case"tr":case"trange":case"true_range":{if(i.length!==0&&i.length!==3)throw new Ls("tr expects () or (high, low, close)");const l=i.length===3?mc(i[0],e):e.series.high,c=i.length===3?mc(i[1],e):e.series.low,d=i.length===3?mc(i[2],e):e.series.close;if(!l||!c||!d)throw new Ls("tr requires high/low/close series");const p=e.length,m=new Float32Array(p);let h=NaN;for(let _=0;_<p;_++){const w=l[_],S=c[_],P=d[_];let I=Math.max(0,w-S);Number.isFinite(h)&&(I=Math.max(I,Math.abs(w-h),Math.abs(S-h))),m[_]=I,h=P}return{kind:"series",value:m}}case"atr":{if(i.length!==4)throw new Ls("atr expects (high, low, close, period)");const l=mc(i[0],e),c=mc(i[1],e),d=mc(i[2],e),p=Math.max(1,Math.floor(Qf(i[3]))),m=e.length,h=new Float32Array(m);let _=NaN;for(let P=0;P<m;P++){const I=l[P],C=c[P],M=d[P];let F=Math.max(0,I-C);Number.isFinite(_)&&(F=Math.max(F,Math.abs(I-_),Math.abs(C-_))),h[P]=F,_=M}const w=new Float32Array(m);let S=0;for(let P=0;P<m;P++)S+=h[P],P===p-1?w[P]=S/p:P>=p?w[P]=(w[P-1]*(p-1)+h[P])/p:w[P]=NaN;return{kind:"series",value:w}}case"stdev":case"stddev":case"dev":{const[l,c]=a();return{kind:"series",value:WV(l,c)}}case"variance":case"var":{const[l,c]=a();return{kind:"series",value:KV(l,c)}}case"correlation":case"corr":{if(i.length!==3)throw new Ls(`${n.callee} expects (a, b, period)`);const l=mc(i[0],e),c=mc(i[1],e),d=Math.max(1,Math.floor(Qf(i[2])));return{kind:"series",value:ZV(l,c,d)}}case"highest":{const[l,c]=a();return{kind:"series",value:HV(l,c)}}case"highestbars":{const[l,c]=a();return{kind:"series",value:GV(l,c)}}case"lowest":{const[l,c]=a();return{kind:"series",value:UV(l,c)}}case"lowestbars":{const[l,c]=a();return{kind:"series",value:YV(l,c)}}case"sum":{const[l,c]=a();return{kind:"series",value:NV(l,c)}}case"lag":{const[l,c]=a();return{kind:"series",value:Gb(l,c)}}case"prev":{if(i.length<1||i.length>2)throw new Ls("prev expects (series[, n])");const l=mc(i[0],e),c=Math.max(1,Math.floor(Qf(i[1]??{kind:"scalar",value:1})));return{kind:"series",value:Gb(l,c)}}case"change":{if(i.length<1||i.length>2)throw new Ls("change expects (series[, n])");const l=mc(i[0],e),c=Math.max(1,Math.floor(Qf(i[1]??{kind:"scalar",value:1})));return{kind:"series",value:DV(l,c)}}case"roc":{if(i.length<1||i.length>2)throw new Ls("roc expects (series[, n])");const l=mc(i[0],e),c=Math.max(1,Math.floor(Qf(i[1]??{kind:"scalar",value:1})));return{kind:"series",value:jV(l,c)}}case"mom":case"momentum":{if(i.length<1||i.length>2)throw new Ls("mom expects (series[, n])");const l=mc(i[0],e),c=Math.max(1,Math.floor(Qf(i[1]??{kind:"scalar",value:1})));return{kind:"series",value:RV(l,c)}}case"crossover":case"crossunder":{if(i.length<2||i.length>3)throw new Ls(`${n.callee} expects (series, series[, tol])`);const l=mc(i[0],e),c=i[1],d=c.kind==="series",p=mc(c,e),m=i[2]?Math.max(0,Qf(i[2])):0,h=e.length,_=new Float32Array(h);_[0]=0;for(let w=1;w<h;w++){const S=l[w-1],P=l[w],I=d?p[w-1]:p[0],C=d?p[w]:p[0];if(![S,P,I,C].every(Number.isFinite)){_[w]=0;continue}t==="crossover"?_[w]=S<=I+m&&P>C+m?1:0:_[w]=S>=I-m&&P<C-m?1:0}return{kind:"series",value:_}}case"hl2":{if(i.length!==0)throw new Ls("hl2 expects no arguments");const l=e.series.high,c=e.series.low;if(!l||!c)throw new Ls("hl2 requires high/low series");const d=e.length,p=new Float32Array(d);for(let m=0;m<d;m++)p[m]=(l[m]+c[m])/2;return{kind:"series",value:p}}case"hlc3":{if(i.length!==0)throw new Ls("hlc3 expects no arguments");const l=e.series.high,c=e.series.low,d=e.series.close;if(!l||!c||!d)throw new Ls("hlc3 requires high/low/close series");const p=e.length,m=new Float32Array(p);for(let h=0;h<p;h++)m[h]=(l[h]+c[h]+d[h])/3;return{kind:"series",value:m}}case"ohlc4":{if(i.length!==0)throw new Ls("ohlc4 expects no arguments");const l=e.series.open,c=e.series.high,d=e.series.low,p=e.series.close;if(!l||!c||!d||!p)throw new Ls("ohlc4 requires open/high/low/close series");const m=e.length,h=new Float32Array(m);for(let _=0;_<m;_++)h[_]=(l[_]+c[_]+d[_]+p[_])/4;return{kind:"series",value:h}}case"vwap":{if(i.length!==2)throw new Ls("vwap expects (close, volume)");const l=mc(i[0],e),c=mc(i[1],e),d=e.length,p=new Float32Array(d);let m=0,h=0;for(let _=0;_<d;_++){const w=l[_],S=c[_];if(!Number.isFinite(w)||!Number.isFinite(S)){p[_]=NaN;continue}m+=w*S,h+=S,p[_]=h===0?NaN:m/h}return{kind:"series",value:p}}case"vwma":{if(i.length!==3)throw new Ls("vwma expects (close, volume, period)");const l=mc(i[0],e),c=mc(i[1],e),d=Math.max(1,Math.floor(Qf(i[2]))),p=e.length,m=new Float32Array(p);let h=0,_=0;for(let w=0;w<p;w++){const S=l[w],P=c[w];if(Number.isFinite(S)&&Number.isFinite(P)&&(h+=S*P,_+=P),w>=d){const I=l[w-d],C=c[w-d];Number.isFinite(I)&&Number.isFinite(C)&&(h-=I*C,_-=C)}m[w]=w>=d-1&&_!==0?h/_:NaN}return{kind:"series",value:m}}case"min":{if(i.length!==2)throw new Ls("min expects 2 arguments");const l=i[0],c=i[1];if(l.kind==="scalar"&&c.kind==="scalar")return{kind:"scalar",value:Math.min(l.value,c.value)};const d=mc(l,e),p=mc(c,e),m=e.length,h=new Float32Array(m);for(let _=0;_<m;_++)h[_]=Math.min(d[_],p[_]);return{kind:"series",value:h}}case"max":{if(i.length!==2)throw new Ls("max expects 2 arguments");const l=i[0],c=i[1];if(l.kind==="scalar"&&c.kind==="scalar")return{kind:"scalar",value:Math.max(l.value,c.value)};const d=mc(l,e),p=mc(c,e),m=e.length,h=new Float32Array(m);for(let _=0;_<m;_++)h[_]=Math.max(d[_],p[_]);return{kind:"series",value:h}}case"abs":{if(i.length!==1)throw new Ls("abs expects 1 argument");const l=i[0];if(l.kind==="scalar")return{kind:"scalar",value:Math.abs(l.value)};const c=l.value,d=e.length,p=new Float32Array(d);for(let m=0;m<d;m++)p[m]=Math.abs(c[m]);return{kind:"series",value:p}}default:throw new Ls(`Unknown function "${n.callee}"`)}}function Qg(n,e){var t;switch(n.kind){case"NumberLiteral":return{kind:"scalar",value:n.value};case"StringLiteral":return{kind:"scalar",value:ef(n.value)};case"Identifier":{const o=n.name.replace(/\s+/g,"_").toLowerCase();if(o==="na"||o==="nan")return{kind:"scalar",value:NaN};if(o==="pi")return{kind:"scalar",value:Math.PI};if(o==="e")return{kind:"scalar",value:Math.E};const i=e.series[o];if(i)return{kind:"series",value:i};const r=(t=e.scalars)==null?void 0:t[o];if(typeof r=="number"&&Number.isFinite(r))return{kind:"scalar",value:r};throw e.seriesNames.has(o)?new Ls(`Series "${n.name}" is used before it is defined (circular or forward reference)`):new Ls(`Unknown identifier "${n.name}"`)}case"UnaryExpression":{const o=Qg(n.expr,e);if(n.operator==="not"){if(o.kind==="scalar"){const a=o.value;return{kind:"scalar",value:Number.isFinite(a)&&a!==0?0:1}}const i=o.value,r=new Float32Array(i.length);for(let a=0;a<i.length;a++){const l=i[a];r[a]=Number.isFinite(l)&&l!==0?0:1}return{kind:"series",value:r}}throw new Ls("Unsupported unary operator")}case"BinaryExpression":return BV(n.operator,Qg(n.left,e),Qg(n.right,e),e);case"CallExpression":return JV(n,e);default:throw new Ls("Unsupported expression node")}}function gg(n,e,t,o){var C;const i=new Set;for(const M of n){const F=M.name.replace(/\s+/g,"_").toLowerCase();i.add(F)}const r=Object.entries(e),a=((C=r[0])==null?void 0:C[1].length)??0;for(const[,M]of r)if(M.length!==a)throw new Ls("All base series must have the same length");const l=n.map(M=>{try{const F=Tf(M.expr);return{name:M.name.replace(/\s+/g,"_").toLowerCase(),expr:M.expr,ast:F}}catch(F){throw F instanceof Tm?new Ls(`Syntax error in series "${M.name}" at position ${F.position}: ${F.message}`):F}}),c={length:a,series:{...e},seriesNames:i,scalars:(()=>{if(!t||typeof t!="object")return;const M={};return Object.entries(t).forEach(([F,V])=>{const j=F.replace(/\s+/g,"_").toLowerCase();if(typeof V=="number"&&Number.isFinite(V)){M[j]=V;return}if(typeof V=="string"){const D=Number(V);M[j]=Number.isFinite(D)?D:ef(V)}}),Object.keys(M).length?M:void 0})(),strategy:o},d={},p=M=>{const F=new Set,V=j=>{switch(j.kind){case"Identifier":{const D=j.name.replace(/\s+/g,"_").toLowerCase();F.add(D);break}case"BinaryExpression":V(j.left),V(j.right);break;case"UnaryExpression":V(j.expr);break;case"CallExpression":j.args.forEach(D=>V(D));break}};return V(M),F},m=new Set(l.map(M=>M.name)),h={},_={};l.forEach(M=>{h[M.name]=new Set,_[M.name]=new Set}),l.forEach(M=>{p(M.ast).forEach(V=>{m.has(V)&&V!==M.name&&(h[M.name].add(V),_[V].add(M.name))})});const w={};Object.keys(h).forEach(M=>{var F;w[M]=((F=h[M])==null?void 0:F.size)??0});const S=Object.keys(w).filter(M=>(w[M]||0)===0),P=[];for(;S.length;){const M=S.shift();P.push(M);for(const F of _[M]||[])w[F]=(w[F]||0)-1,w[F]===0&&S.push(F)}if(P.length!==l.length){const M=l.map(F=>F.name).filter(F=>!P.includes(F));throw new Ls(`Circular dependency detected among series: ${M.join(" -> ")}`)}const I={};l.forEach(M=>{I[M.name]=M});for(const M of P){const F=I[M];if(c.series[F.name])throw new Ls(`Series name "${F.name}" conflicts with an existing base series`);const V=Qg(F.ast,c),j=mc(V,c);c.series[F.name]=j,d[F.name]=j}return d}function QV(n,e){var r;const t=n.replace(/\s+/g,"_").toLowerCase();if(t==="na"||t==="nan")return NaN;if(t==="pi")return Math.PI;if(t==="e")return Math.E;if(e.selfKey&&e.selfOut&&t===e.selfKey){if(e.selfMode==="current"){const l=e.selfOut[e.index];if(Number.isFinite(l))return l}const a=e.index-1;return a>=0?e.selfOut[a]:NaN}const o=e.series[t];if(o)return o[e.index]??NaN;const i=(r=e.scalars)==null?void 0:r[t];if(typeof i=="number"&&Number.isFinite(i))return i;throw new Ls(`Unknown identifier "${n}"`)}function _y(n){const e=n.match(/^(line|label|box|table)_get_([a-z0-9_]+)$/i);return e?{kind:e[1].toLowerCase(),prop:e[2].toLowerCase()}:null}function Yw(n){const e=n.match(/^strategy_(closedtrades|opentrades)_([a-z0-9_]+)$/i);return e?{kind:e[1].toLowerCase(),prop:e[2].toLowerCase()}:null}const eW={profit_pct:"profit_percent",pnl:"profit",max_profit:"max_runup",max_profit_pct:"max_runup_percent",max_profit_percent:"max_runup_percent",max_runup_pct:"max_runup_percent",max_drawdown_pct:"max_drawdown_percent",max_loss:"max_drawdown",max_loss_pct:"max_drawdown_percent",max_loss_percent:"max_drawdown_percent"};function tW(n){const e=n.toLowerCase();return eW[e]??e}function Kw(n,e,t,o,i){const r=tW(t),a=n.strategy;if(!a)return NaN;if(i<0)return NaN;if(e==="closedtrades"){const D=a.closedTrades||[];if(!D.length)return 0;const R=n.series.strategy_closedtrades,W=R?R[o]:NaN,Z=(typeof W=="number"&&Number.isFinite(W)?Math.floor(W):0)-1-i;if(Z<0||Z>=D.length)return 0;const G=D[Z];switch(r){case"entry_price":return G.entryPrice;case"entry_time":return G.entryTimestamp;case"entry_bar_index":return G.entryIndex;case"exit_price":return G.exitPrice;case"exit_time":return G.exitTimestamp;case"exit_bar_index":return G.exitIndex;case"size":return G.qty;case"profit":return Number.isFinite(G.pnl)?G.pnl:0;case"profit_percent":return Number.isFinite(G.pnlPct)?G.pnlPct:0;case"max_runup":return typeof G.mfePct!="number"||!Number.isFinite(G.mfePct)?0:G.mfePct/100*G.entryPrice*G.qty;case"max_runup_percent":return typeof G.mfePct=="number"&&Number.isFinite(G.mfePct)?G.mfePct:0;case"max_drawdown":return typeof G.maePct!="number"||!Number.isFinite(G.maePct)?0:G.maePct/100*G.entryPrice*G.qty;case"max_drawdown_percent":return typeof G.maePct=="number"&&Number.isFinite(G.maePct)?G.maePct:0;case"is_long":return G.side==="long"?1:0;case"is_short":return G.side==="short"?1:0;case"entry_id":return ef(String(G.entryOrderId??G.entrySignalId??""));case"exit_id":return ef(String(G.exitOrderId??G.exitSignalId??""));default:return 0}}const l=a.openTradesByBar||[];if(o<0||o>=l.length)return 0;const c=l[o]||[];if(i>=c.length)return 0;const d=c[i],p=n.series.close,m=p&&Number.isFinite(p[o])?p[o]:NaN,h=d.qty,_=d.entryPrice,w=_>0&&h>0?_*h:NaN,S=Number.isFinite(m)&&Number.isFinite(_)?d.side==="long"?(m-_)*h:(_-m)*h:NaN,P=Number.isFinite(w)&&w!==0?S/w*100:NaN,I=d.maxFav,C=d.maxAdv,M=Number.isFinite(_)&&Number.isFinite(h)&&Number.isFinite(I)?d.side==="long"?(I-_)*h:(_-I)*h:NaN,F=Number.isFinite(_)&&_>0&&Number.isFinite(I)?d.side==="long"?(I-_)/_*100:(_-I)/_*100:NaN,V=Number.isFinite(_)&&Number.isFinite(h)&&Number.isFinite(C)?d.side==="long"?(C-_)*h:(_-C)*h:NaN,j=Number.isFinite(_)&&_>0&&Number.isFinite(C)?d.side==="long"?(C-_)/_*100:(_-C)/_*100:NaN;switch(r){case"entry_price":return _;case"entry_time":return d.entryTimestamp;case"entry_bar_index":return d.entryIndex;case"size":return h;case"profit":return Number.isFinite(S)?S:0;case"profit_percent":return Number.isFinite(P)?P:0;case"max_runup":return Number.isFinite(M)?M:0;case"max_runup_percent":return Number.isFinite(F)?F:0;case"max_drawdown":return Number.isFinite(V)?V:0;case"max_drawdown_percent":return Number.isFinite(j)?j:0;case"is_long":return d.side==="long"?1:0;case"is_short":return d.side==="short"?1:0;case"entry_id":return ef(String(d.entryOrderId??d.entrySignalId??""));default:return 0}}function Tu(n,e){var t;switch(n.kind){case"NumberLiteral":return n.value;case"StringLiteral":return ef(n.value);case"Identifier":return QV(n.name,e);case"UnaryExpression":{if(n.operator==="not"){const o=Tu(n.expr,e);return Number.isFinite(o)&&o!==0?0:1}return NaN}case"BinaryExpression":{const o=Tu(n.left,e),i=Tu(n.right,e);switch(n.operator){case"+":return o+i;case"-":return o-i;case"*":return o*i;case"/":return i===0?NaN:o/i;case"%":return i===0?NaN:o%i;case">":return Number.isFinite(o)&&Number.isFinite(i)&&o>i?1:0;case"<":return Number.isFinite(o)&&Number.isFinite(i)&&o<i?1:0;case">=":return Number.isFinite(o)&&Number.isFinite(i)&&o>=i?1:0;case"<=":return Number.isFinite(o)&&Number.isFinite(i)&&o<=i?1:0;case"==":return Number.isFinite(o)&&Number.isFinite(i)&&Math.abs(o-i)<1e-9?1:0;case"!=":return Number.isFinite(o)&&Number.isFinite(i)&&Math.abs(o-i)>=1e-9?1:0;case"and":return Number.isFinite(o)&&o!==0&&Number.isFinite(i)&&i!==0?1:0;case"or":return Number.isFinite(o)&&o!==0||Number.isFinite(i)&&i!==0?1:0;default:return NaN}}case"CallExpression":{const o=n.callee.toLowerCase(),i=_y(o);if(i&&e.draw){const c=n.args[0];let d="";if(c&&c.kind==="Identifier"&&(d=c.name),c&&c.kind==="StringLiteral"&&(d=c.value),!d)return NaN;const p=e.draw.get(i.kind,i.prop,d,e.index);return typeof p=="string"?ef(p):typeof p=="number"&&Number.isFinite(p)?p:NaN}const r=Yw(o);if(r){if(!e.strategy)return NaN;if(!n.args.length)throw new Ls(`${n.callee} expects (index)`);const c=Tu(n.args[0],e),d=Number.isFinite(c)?Math.floor(c):NaN;return Number.isFinite(d)?Kw(e,r.kind,r.prop,e.index,d):NaN}const a=n.args[0],l=n.args[1];if(o==="nz"){if(n.args.length<1||n.args.length>2)throw new Ls("nz expects (x[, fallback])");const c=Tu(a,e);return Number.isFinite(c)?c:n.args.length===2?Tu(l,e):0}if(o==="iff"||o==="iif"||o==="if"){if(n.args.length!==3)throw new Ls(`${n.callee} expects (cond, a, b)`);const c=Tu(a,e),d=Number.isFinite(c)&&c!==0,p=Tu(n.args[1],e),m=Tu(n.args[2],e);return d?p:m}if(o==="tostring"||o==="format"||o==="upper"||o==="lower"||o==="trim"||o==="replace"||o==="replace_all"||o==="contains"||o==="startswith"||o==="endswith"||o==="length"||o==="substring"||o==="repeat"){const c=m=>Number.isFinite(m)?String(m):"",d=m=>ef(m),p=m=>{var w;const h=n.args[m];if(!h)return"";if(h.kind==="StringLiteral")return h.value;if(h.kind==="Identifier"){const S=h.name.replace(/\s+/g,"_").toLowerCase(),P=(w=e.strings)==null?void 0:w[S];if(typeof P=="string")return P}const _=Tu(h,e);return c(_)};if(o==="tostring"){if(n.args.length<1||n.args.length>2)throw new Ls("tostring expects (x[, format])");const m=Tu(n.args[0],e),h=n.args[1];let _="";if(h){if(h.kind==="StringLiteral")_=h.value;else if(h.kind==="Identifier"){const S=h.name.replace(/\s+/g,"_").toLowerCase(),P=(t=e.strings)==null?void 0:t[S];typeof P=="string"&&(_=P)}}const w=G1(m,_||void 0);return d(w)}if(o==="format"){if(n.args.length<1)throw new Ls("format expects (fmt, ...)");const m=p(0),h=n.args.slice(1).map(w=>s0(Tu(w,e))),_=m.replace(/\{(\d+)\}/g,(w,S)=>h[Number(S)]??"");return d(_.replace(/{{/g,"{").replace(/}}/g,"}"))}if(o==="upper")return d(p(0).toUpperCase());if(o==="lower")return d(p(0).toLowerCase());if(o==="trim")return d(p(0).trim());if(o==="replace"||o==="replace_all"){if(n.args.length<3)throw new Ls("replace expects (s, from, to)");const m=p(0),h=p(1),_=p(2);return d(m.split(h).join(_))}if(o==="contains"){if(n.args.length<2)throw new Ls("contains expects (s, sub)");const m=p(0),h=p(1);return m.includes(h)?1:0}if(o==="startswith"){if(n.args.length<2)throw new Ls("startswith expects (s, sub)");const m=p(0),h=p(1);return m.startsWith(h)?1:0}if(o==="endswith"){if(n.args.length<2)throw new Ls("endswith expects (s, sub)");const m=p(0),h=p(1);return m.endsWith(h)?1:0}if(o==="length"){if(n.args.length!==1)throw new Ls("length expects (s)");return p(0).length}if(o==="substring"){if(n.args.length<2)throw new Ls("substring expects (s, from[, to])");const m=p(0),h=Tu(n.args[1],e),_=n.args.length>2?Tu(n.args[2],e):NaN,w=Math.max(0,Math.floor(h)),S=Number.isFinite(_)?Math.max(w,Math.floor(_)):void 0;return d(S==null?m.slice(w):m.slice(w,S))}if(o==="repeat"){if(n.args.length<2)throw new Ls("repeat expects (s, count)");const m=p(0),h=Math.max(0,Math.floor(Tu(n.args[1],e)));return d(m.repeat(h))}}if(o==="add"||o==="sub"||o==="mul"||o==="div"){if(n.args.length!==2)throw new Ls(`${n.callee} expects 2 arguments`);const c=Tu(a,e),d=Tu(l,e);return o==="add"?c+d:o==="sub"?c-d:o==="mul"?c*d:d===0?NaN:c/d}if(o==="min"||o==="max"){if(n.args.length!==2)throw new Ls(`${n.callee} expects 2 arguments`);const c=Tu(a,e),d=Tu(l,e);return o==="min"?Math.min(c,d):Math.max(c,d)}if(o==="abs"){if(n.args.length!==1)throw new Ls("abs expects 1 argument");return Math.abs(Tu(a,e))}if(o==="pow"){if(n.args.length!==2)throw new Ls("pow expects 2 arguments");const c=Tu(a,e),d=Tu(l,e);return Math.pow(c,d)}if(o==="sqrt"||o==="log"||o==="log10"||o==="exp"||o==="floor"||o==="ceil"||o==="round"||o==="sin"||o==="cos"||o==="tan"||o==="asin"||o==="acos"||o==="atan"||o==="sign"){if(n.args.length!==1)throw new Ls(`${n.callee} expects 1 argument`);const c=Tu(a,e);switch(o){case"sqrt":return Math.sqrt(c);case"log":return Math.log(c);case"log10":return Math.log10(c);case"exp":return Math.exp(c);case"floor":return Math.floor(c);case"ceil":return Math.ceil(c);case"round":return Math.round(c);case"sin":return Math.sin(c);case"cos":return Math.cos(c);case"tan":return Math.tan(c);case"asin":return Math.asin(c);case"acos":return Math.acos(c);case"atan":return Math.atan(c);default:return Math.sign(c)}}if(o==="cum"||o==="cumsum"){if(n.args.length!==1)throw new Ls(`${n.callee} expects 1 argument`);const c=a;if(c.kind!=="Identifier")throw new Ls(`${n.callee} expects a series identifier`);const d=c.name.replace(/\s+/g,"_").toLowerCase(),p=e.series[d];if(!p)throw new Ls(`Unknown identifier "${c.name}"`);let m=0;for(let h=0;h<=e.index;h++){const _=p[h];Number.isFinite(_)&&(m+=_)}return m}if(o==="barssince"){if(n.args.length!==1)throw new Ls("barssince expects (condition)");const c=a;if(c.kind!=="Identifier")throw new Ls("barssince expects a series identifier");const d=c.name.replace(/\s+/g,"_").toLowerCase(),p=e.series[d];if(!p)throw new Ls(`Unknown identifier "${c.name}"`);for(let m=e.index;m>=0;m--){const h=p[m];if(Number.isFinite(h)&&h!==0)return e.index-m}return NaN}if(o==="tr"){if(n.args.length!==0&&n.args.length!==3)throw new Ls("tr expects () or (high, low, close)");const c=(P,I)=>{if(!P){const F=e.series[I];if(!F)throw new Ls(`Unknown identifier "${I}"`);return F}if(P.kind!=="Identifier")throw new Ls("tr expects series identifiers");const C=P.name.replace(/\s+/g,"_").toLowerCase(),M=e.series[C];if(!M)throw new Ls(`Unknown identifier "${P.name}"`);return M},d=c(n.args[0],"high"),p=c(n.args[1],"low"),m=c(n.args[2],"close"),h=d[e.index],_=p[e.index],w=e.index>0?m[e.index-1]:NaN;let S=Math.max(0,h-_);return Number.isFinite(w)&&(S=Math.max(S,Math.abs(h-w),Math.abs(_-w))),S}if(o==="prev"||o==="lag"||o==="change"){if(n.args.length!==2)throw new Ls(`${n.callee} expects (series, n)`);const c=a;if(c.kind!=="Identifier")throw new Ls(`${n.callee} expects first argument to be a series identifier`);const d=c.name.replace(/\s+/g,"_").toLowerCase(),p=Tu(l,e),m=Math.max(1,Math.floor(p)),h=e.index-m,_=P=>{if(P<0)return NaN;if(e.selfKey&&e.selfOut&&d===e.selfKey)return e.selfOut[P]??NaN;const I=e.series[d];if(!I)throw new Ls(`Unknown identifier "${c.name}"`);return I[P]??NaN};if(o==="prev"||o==="lag")return _(h);const w=_(e.index),S=_(h);return Number.isFinite(w)&&Number.isFinite(S)?w-S:NaN}if(o==="crossover"||o==="crossunder"){if(n.args.length<2||n.args.length>3)throw new Ls(`${n.callee} expects (series, series[, tol])`);const c=a;if(c.kind!=="Identifier")throw new Ls(`${n.callee} expects first argument to be a series identifier`);const d=c.name.replace(/\s+/g,"_").toLowerCase(),p=e.series[d];if(!p)throw new Ls(`Unknown identifier "${c.name}"`);const m=n.args[1];let h=null,_=NaN;if(m.kind==="Identifier"){const M=m.name.replace(/\s+/g,"_").toLowerCase();if(h=e.series[M]||null,!h){const F=Number(m.name);_=Number.isFinite(F)?F:NaN}}else _=Tu(m,e);const w=n.args[2]?Math.max(0,Tu(n.args[2],e)):0;if(e.index<=0)return 0;const S=p[e.index-1],P=p[e.index],I=h?h[e.index-1]:_,C=h?h[e.index]:_;return[S,P,I,C].every(Number.isFinite)?o==="crossover"?S<=I+w&&P>C+w?1:0:S>=I-w&&P<C-w?1:0:0}throw new Ls(`Unknown function "${n.callee}"`)}default:return NaN}}function Hb(n,e,t,o,i){var w;const r=Object.entries(e),a=((w=r[0])==null?void 0:w[1].length)??0;for(const[,S]of r)if(S.length!==a)throw new Ls("All base series must have the same length");const l=(()=>{if(!t||typeof t!="object")return;const S={};return Object.entries(t).forEach(([P,I])=>{const C=P.replace(/\s+/g,"_").toLowerCase();if(typeof I=="number"&&Number.isFinite(I)){S[C]=I;return}if(typeof I=="string"){const M=Number(I);S[C]=Number.isFinite(M)?M:ef(I)}}),Object.keys(S).length?S:void 0})(),c=(()=>{if(!t||typeof t!="object")return;const S={};return Object.entries(t).forEach(([P,I])=>{typeof I=="string"&&(S[P.replace(/\s+/g,"_").toLowerCase()]=I)}),Object.keys(S).length?S:void 0})(),d=n.map(S=>{const P=S.name.replace(/\s+/g,"_").toLowerCase();try{const I=S.initExpr?Tf(S.initExpr):null,C=Tf(S.updateExpr);return{name:P,initAst:I,updateAst:C,initExpr:S.initExpr,updateExpr:S.updateExpr,selfMode:S.selfMode}}catch(I){throw I instanceof Tm?new Ls(`Syntax error in series "${S.name}" at position ${I.position}: ${I.message}`):I}}),p=(()=>{if(!(i!=null&&i.autoSort)||d.length<=1)return d;const S=new Set(d.map(Z=>Z.name)),P={},I={},C=new Map;d.forEach((Z,G)=>{P[Z.name]=new Set,I[Z.name]=new Set,C.set(Z.name,G)});const M=Z=>Z.replace(/\s+/g,"_").toLowerCase(),F=Z=>{const G=new Set,se=(Y,oe)=>{switch(Y.kind){case"Identifier":{const ee=M(Y.name);oe||G.add(ee);break}case"BinaryExpression":se(Y.left,oe),se(Y.right,oe);break;case"UnaryExpression":se(Y.expr,oe);break;case"CallExpression":{const ee=String(Y.callee||"").toLowerCase(),re=ee==="prev"||ee==="lag";Y.args.forEach((me,K)=>{se(me,oe||re&&K===0)});break}}};return Z&&se(Z,!1),{direct:G}},V=(Z,G)=>{if(!G)return;const{direct:se}=F(G);se.forEach(Y=>{!S.has(Y)||Y===Z||(P[Z].add(Y),I[Y].add(Z))})};d.forEach(Z=>{V(Z.name,Z.updateAst),V(Z.name,Z.initAst)});const j={};Object.keys(P).forEach(Z=>{var G;j[Z]=((G=P[Z])==null?void 0:G.size)??0});const D=Object.keys(j).filter(Z=>(j[Z]||0)===0);D.sort((Z,G)=>(C.get(Z)??0)-(C.get(G)??0));const R=[],W=Z=>{const G=D.findIndex(se=>(C.get(se)??0)>(C.get(Z)??0));G===-1?D.push(Z):D.splice(G,0,Z)};for(;D.length;){const Z=D.shift();R.push(Z);const G=Array.from(I[Z]||[]).sort((se,Y)=>(C.get(se)??0)-(C.get(Y)??0));for(const se of G)j[se]=(j[se]||0)-1,j[se]===0&&W(se)}if(R.length!==d.length){const Z=d.map(G=>G.name).filter(G=>!R.includes(G));throw new Ls(`Circular dependency detected among state series: ${Z.join(" -> ")}`)}const J={};return d.forEach(Z=>{J[Z.name]=Z}),R.map(Z=>J[Z])})(),m={},h={...e},_=new Set(Object.keys(e));for(const S of d){if(_.has(S.name))throw new Ls(`Series name "${S.name}" conflicts with an existing base series`);if(h[S.name])m[S.name]||(m[S.name]=h[S.name]);else{const P=new Float32Array(a);P.fill(NaN),h[S.name]=P,m[S.name]=P}}for(let S=0;S<a;S++)for(const P of p){const I=m[P.name],C={series:h,scalars:l,strings:c,length:a,index:S,selfKey:P.name,selfOut:I,selfMode:P.selfMode,strategy:o},M=S===0&&P.initAst?P.initAst:P.updateAst,F=Tu(M,C);I[S]=F}return m}function H0(n,e,t,o){var p;const i=Object.entries(e),r=((p=i[0])==null?void 0:p[1].length)??0;for(const[,m]of i)if(m.length!==r)throw new Ls("All base series must have the same length");const a=(()=>{if(!t||typeof t!="object")return;const m={};return Object.entries(t).forEach(([h,_])=>{const w=h.replace(/\s+/g,"_").toLowerCase();if(typeof _=="number"&&Number.isFinite(_)){m[w]=_;return}if(typeof _=="string"){const S=Number(_);m[w]=Number.isFinite(S)?S:ef(_)}}),Object.keys(m).length?m:void 0})(),l=(()=>{if(!t||typeof t!="object")return;const m={};return Object.entries(t).forEach(([h,_])=>{typeof _=="string"&&(m[h.replace(/\s+/g,"_").toLowerCase()]=_)}),Object.keys(m).length?m:void 0})();let c;try{c=Tf(n)}catch(m){throw m instanceof Tm?new Ls(`Syntax error at position ${m.position}: ${m.message}`):m}const d=new Float32Array(r);for(let m=0;m<r;m++){const h={series:e,scalars:a,strings:l,length:r,index:m,strategy:o};d[m]=Tu(c,h)}return d}function nW(n,e,t,o,i,r){var h;const a=Object.entries(e),l=((h=a[0])==null?void 0:h[1].length)??0;if(o<0||o>=l)return NaN;for(const[,_]of a)if(_.length!==l)throw new Ls("All base series must have the same length");const c=(()=>{if(!t||typeof t!="object")return;const _={};return Object.entries(t).forEach(([w,S])=>{const P=w.replace(/\s+/g,"_").toLowerCase();if(typeof S=="number"&&Number.isFinite(S)){_[P]=S;return}if(typeof S=="string"){const I=Number(S);_[P]=Number.isFinite(I)?I:ef(S)}}),Object.keys(_).length?_:void 0})(),d=(()=>{if(!t||typeof t!="object")return;const _={};return Object.entries(t).forEach(([w,S])=>{typeof S=="string"&&(_[w.replace(/\s+/g,"_").toLowerCase()]=S)}),Object.keys(_).length?_:void 0})();let p;if(typeof n=="string")try{p=Tf(n)}catch(_){throw _ instanceof Tm?new Ls(`Syntax error at position ${_.position}: ${_.message}`):_}else p=n;return Tu(p,{series:e,scalars:c,strings:d,length:l,index:o,draw:i,strategy:r})}function oW(n,e){var a,l;const t=n.replace(/\s+/g,"_").toLowerCase();if(t==="na"||t==="nan")return NaN;if(t==="pi")return Math.PI;if(t==="e")return Math.E;const o=e.series[t];if(o)return o[e.index]??NaN;const i=(a=e.strings)==null?void 0:a[t];if(typeof i=="string")return i;const r=(l=e.scalars)==null?void 0:l[t];if(typeof r=="number"&&Number.isFinite(r))return r;throw new Ls(`Unknown identifier "${n}"`)}function xu(n,e,t,o){const i=c=>typeof c=="number"?c:ef(c),r=c=>typeof c=="string"?c:Number.isFinite(c)?String(c):"",a=(c,d)=>typeof c=="string"?c:G1(c,d),l=c=>{let d=o.get(c);return d||(d=Qg(c,t),o.set(c,d)),d.kind==="scalar"?d.value:d.value[e.index]??NaN};switch(n.kind){case"NumberLiteral":return n.value;case"StringLiteral":return n.value;case"Identifier":return oW(n.name,e);case"UnaryExpression":{if(n.operator==="not"){const c=i(xu(n.expr,e,t,o));return Number.isFinite(c)&&c!==0?0:1}return NaN}case"BinaryExpression":{const c=xu(n.left,e,t,o),d=xu(n.right,e,t,o);if(n.operator==="+")return typeof c=="string"||typeof d=="string"?`${r(c)}${r(d)}`:i(c)+i(d);const p=i(c),m=i(d);switch(n.operator){case"-":return p-m;case"*":return p*m;case"/":return m===0?NaN:p/m;case"%":return m===0?NaN:p%m;case">":return Number.isFinite(p)&&Number.isFinite(m)&&p>m?1:0;case"<":return Number.isFinite(p)&&Number.isFinite(m)&&p<m?1:0;case">=":return Number.isFinite(p)&&Number.isFinite(m)&&p>=m?1:0;case"<=":return Number.isFinite(p)&&Number.isFinite(m)&&p<=m?1:0;case"==":return Number.isFinite(p)&&Number.isFinite(m)&&Math.abs(p-m)<1e-9?1:0;case"!=":return Number.isFinite(p)&&Number.isFinite(m)&&Math.abs(p-m)>=1e-9?1:0;case"and":return Number.isFinite(p)&&p!==0&&Number.isFinite(m)&&m!==0?1:0;case"or":return Number.isFinite(p)&&p!==0||Number.isFinite(m)&&m!==0?1:0;default:return NaN}}case"CallExpression":{const c=n.callee.toLowerCase(),d=_y(c);if(d&&e.draw){const p=n.args[0];let m="";if(p&&p.kind==="Identifier"&&(m=p.name),p&&p.kind==="StringLiteral"&&(m=p.value),!m)return"";const h=e.draw.get(d.kind,d.prop,m,e.index);return h??""}if(c==="iff"||c==="iif"||c==="if"){if(n.args.length!==3)throw new Ls(`${n.callee} expects (cond, a, b)`);const p=i(xu(n.args[0],e,t,o));return xu(p!==0?n.args[1]:n.args[2],e,t,o)}if(c==="tostring"){if(n.args.length<1||n.args.length>2)throw new Ls("tostring expects (x[, format])");const p=xu(n.args[0],e,t,o);let m;if(n.args[1]){const h=xu(n.args[1],e,t,o);m=typeof h=="string"?h:String(h)}return a(p,m)}if(c==="format"){if(n.args.length<1)throw new Ls("format expects (fmt, ...)");const p=xu(n.args[0],e,t,o),m=r(p),h=n.args.slice(1).map(w=>xu(w,e,t,o));return m.replace(/\{(\d+)(?:,([^,}]+))?(?:,([^}]+))?\}/g,(w,S,P,I)=>{const C=Number(S),M=h[C];return M==null?"":typeof M=="number"?P&&String(P).trim().toLowerCase()==="number"?G1(M,String(I??"")):s0(M):String(M)}).replace(/{{/g,"{").replace(/}}/g,"}")}if(c==="upper")return r(xu(n.args[0],e,t,o)).toUpperCase();if(c==="lower")return r(xu(n.args[0],e,t,o)).toLowerCase();if(c==="trim")return r(xu(n.args[0],e,t,o)).trim();if(c==="replace"||c==="replace_all"){if(n.args.length<3)throw new Ls("replace expects (s, from, to)");const p=r(xu(n.args[0],e,t,o)),m=r(xu(n.args[1],e,t,o)),h=r(xu(n.args[2],e,t,o));return p.split(m).join(h)}if(c==="contains"){if(n.args.length<2)throw new Ls("contains expects (s, sub)");const p=r(xu(n.args[0],e,t,o)),m=r(xu(n.args[1],e,t,o));return p.includes(m)?1:0}if(c==="startswith"){if(n.args.length<2)throw new Ls("startswith expects (s, sub)");const p=r(xu(n.args[0],e,t,o)),m=r(xu(n.args[1],e,t,o));return p.startsWith(m)?1:0}if(c==="endswith"){if(n.args.length<2)throw new Ls("endswith expects (s, sub)");const p=r(xu(n.args[0],e,t,o)),m=r(xu(n.args[1],e,t,o));return p.endsWith(m)?1:0}if(c==="length"){if(n.args.length!==1)throw new Ls("length expects (s)");return r(xu(n.args[0],e,t,o)).length}if(c==="substring"){if(n.args.length<2)throw new Ls("substring expects (s, from[, to])");const p=r(xu(n.args[0],e,t,o)),m=i(xu(n.args[1],e,t,o)),h=n.args.length>2?i(xu(n.args[2],e,t,o)):NaN,_=Math.max(0,Math.floor(m)),w=Number.isFinite(h)?Math.max(_,Math.floor(h)):void 0;return w==null?p.slice(_):p.slice(_,w)}if(c==="repeat"){if(n.args.length<2)throw new Ls("repeat expects (s, count)");const p=r(xu(n.args[0],e,t,o)),m=i(xu(n.args[1],e,t,o)),h=Math.max(0,Math.floor(m));return p.repeat(h)}return l(n)}default:return l(n)}}function Ub(n,e,t,o){var h;const i=Object.entries(e),r=((h=i[0])==null?void 0:h[1].length)??0;for(const[,_]of i)if(_.length!==r)throw new Ls("All base series must have the same length");const a=(()=>{if(!t||typeof t!="object")return;const _={};return Object.entries(t).forEach(([w,S])=>{const P=w.replace(/\s+/g,"_").toLowerCase();if(typeof S=="number"&&Number.isFinite(S)){_[P]=S;return}if(typeof S=="string"){const I=Number(S);_[P]=Number.isFinite(I)?I:ef(S)}}),Object.keys(_).length?_:void 0})(),l=(()=>{if(!t||typeof t!="object")return;const _={};return Object.entries(t).forEach(([w,S])=>{typeof S=="string"&&(_[w.replace(/\s+/g,"_").toLowerCase()]=S)}),Object.keys(_).length?_:void 0})();let c;try{c=Tf(n)}catch(_){throw _ instanceof Tm?new Ls(`Syntax error at position ${_.position}: ${_.message}`):_}const d={length:r,series:e,seriesNames:new Set(Object.keys(e)),scalars:a,strategy:o},p=new WeakMap,m=new Array(r);for(let _=0;_<r;_++){const S=xu(c,{series:e,scalars:a,strings:l,length:r,index:_,strategy:o},d,p);typeof S=="string"?m[_]=S:m[_]=s0(S)}return m}function sW(n,e,t,o,i,r){var S;const a=Object.entries(e),l=((S=a[0])==null?void 0:S[1].length)??0;if(o<0||o>=l)return"";for(const[,P]of a)if(P.length!==l)throw new Ls("All base series must have the same length");const c=(()=>{if(!t||typeof t!="object")return;const P={};return Object.entries(t).forEach(([I,C])=>{const M=I.replace(/\s+/g,"_").toLowerCase();if(typeof C=="number"&&Number.isFinite(C)){P[M]=C;return}if(typeof C=="string"){const F=Number(C);P[M]=Number.isFinite(F)?F:ef(C)}}),Object.keys(P).length?P:void 0})(),d=(()=>{if(!t||typeof t!="object")return;const P={};return Object.entries(t).forEach(([I,C])=>{typeof C=="string"&&(P[I.replace(/\s+/g,"_").toLowerCase()]=C)}),Object.keys(P).length?P:void 0})();let p;if(typeof n=="string")try{p=Tf(n)}catch(P){throw P instanceof Tm?new Ls(`Syntax error at position ${P.position}: ${P.message}`):P}else p=n;const m={length:l,series:e,seriesNames:new Set(Object.keys(e)),scalars:c,strategy:r},w=xu(p,{series:e,scalars:c,strings:d,length:l,index:o,draw:i,strategy:r},m,new WeakMap);return typeof w=="string"?w:s0(w)}function Gb(n,e){const t=n.length,o=new Float32Array(t);for(let i=0;i<t;i++){const r=i-e;o[i]=r>=0?n[r]:NaN}return o}function f_(n){return typeof n=="number"&&Number.isFinite(n)}function Rh(n,e,t){const o=n[t];if(f_(o))return o;const i=e[t];return f_(i)?i:NaN}function Bh(n,e,t){const o=n[t];if(f_(o))return o;const i=e[t];return f_(i)?i:NaN}function Yb(n,e,t,o){let i=-1,r=-1/0;for(let a=t;a<=o;a++){const l=Rh(n,e,a);Number.isFinite(l)&&l>r&&(r=l,i=a)}return i}function Kb(n,e,t,o){let i=-1,r=1/0;for(let a=t;a<=o;a++){const l=Bh(n,e,a);Number.isFinite(l)&&l<r&&(r=l,i=a)}return i}function Zw(n,e,t,o,i){const r=Math.min(n.length,e.length,t.length);if(r<=1)return null;const a=Math.min(r-1,Math.max(0,Math.trunc(o))),l=Math.max(2,Math.trunc(i.lookback||200)),c=Math.max(0,a-l+1),d=i.direction==="down"?"down":"up";if((i.method==="pivots"?"pivots":"extremes")==="pivots"){const S=Math.max(1,Math.floor(Number(i.pivotLeft??3))),P=Math.max(1,Math.floor(Number(i.pivotRight??3))),I=a;if(I<P)return null;const C=[],M=[],F=J=>{const Z=Rh(n,t,J);if(!Number.isFinite(Z))return null;const G=Math.max(0,J-S),se=Math.min(I,J+P);if(se<J+P)return null;for(let Y=G;Y<=se;Y++){if(Y===J)continue;const oe=Rh(n,t,Y);if(!Number.isFinite(oe)||oe>=Z)return null}return Z},V=J=>{const Z=Bh(e,t,J);if(!Number.isFinite(Z))return null;const G=Math.max(0,J-S),se=Math.min(I,J+P);if(se<J+P)return null;for(let Y=G;Y<=se;Y++){if(Y===J)continue;const oe=Bh(e,t,Y);if(!Number.isFinite(oe)||oe<=Z)return null}return Z},j=Math.max(c,0),D=Math.min(a-P,a);for(let J=j;J<=D;J++){const Z=F(J);Z!=null&&C.push({index:J,value:Z});const G=V(J);G!=null&&M.push({index:J,value:G})}const R=C.length?C[C.length-1]:null,W=M.length?M[M.length-1]:null;if(!(!R||!W))if(d==="up"){let J=null;for(let Z=M.length-1;Z>=0;Z--)if(M[Z].index<R.index){J=M[Z];break}if(J)return{fromIndex:J.index,toIndex:R.index,fromValue:J.value,toValue:R.value}}else{let J=null;for(let Z=C.length-1;Z>=0;Z--)if(C[Z].index<W.index){J=C[Z];break}if(J)return{fromIndex:J.index,toIndex:W.index,fromValue:J.value,toValue:W.value}}}if(d==="up"){const S=Yb(n,t,c,a);if(S<0)return null;const P=Kb(e,t,c,S);if(P<0)return null;const I=Bh(e,t,P),C=Rh(n,t,S);return[I,C].every(Number.isFinite)?{fromIndex:P,toIndex:S,fromValue:I,toValue:C}:null}const m=Kb(e,t,c,a);if(m<0)return null;const h=Yb(n,t,c,m);if(h<0)return null;const _=Bh(e,t,m),w=Rh(n,t,h);return[_,w].every(Number.isFinite)?{fromIndex:h,toIndex:m,fromValue:w,toValue:_}:null}function iW(n,e,t,o){const i=Math.min(n.length,e.length,t.length),r=new Array(i),a=new Array(i),l=new Array(i),c=new Array(i),d=new Array(i),p=new Array(i),m=new Array(i);for(let h=0;h<i;h++){const _=Zw(n,e,t,h,o);if(!_){r[h]=void 0,a[h]=void 0,l[h]=void 0,c[h]=void 0,d[h]=void 0,p[h]=void 0,m[h]=void 0;continue}r[h]=_.fromValue,a[h]=_.toValue,l[h]=_.fromIndex,c[h]=_.toIndex,d[h]=_.fromValue,m[h]=_.toValue,p[h]=_.fromValue+(_.toValue-_.fromValue)*.5}return{from:r,to:a,fromIndex:l,toIndex:c,lvl0:d,lvl50:p,lvl100:m}}function sh(n,e){const t=[];let o=0;for(let i=0;i<n.length;i++){const r=n[i];o+=r??0,i>=e&&(o-=n[i-e]??0),t.push(i>=e-1?o/e:void 0)}return t}function rW(n,e){const t=[],o=e*(e+1)/2;for(let i=0;i<n.length;i++){if(i<e-1){t.push(void 0);continue}let r=0;for(let a=0;a<e;a++)r+=(n[i-a]??0)*(e-a);t.push(r/o)}return t}function aW(n,e){const t=[];let o,i=0;for(let r=0;r<n.length;r++){const a=n[r];if(a==null){t.push(void 0);continue}if(o===void 0){if(i+=a,r<e-1){t.push(void 0);continue}o=i/e,t.push(o);continue}o=(o*(e-1)+a)/e,t.push(o)}return t}function hg(n,e){const t=[],o=2/(e+1);let i;for(let r=0;r<n.length;r++){const a=n[r];if(a==null){t.push(void 0);continue}i=i===void 0?a:a*o+i*(1-o),t.push(i)}return t}function lW(n,e){const t=[];let o,i=0,r=0,a=!1;const l=[],c=[];for(let d=0;d<n.length;d++){const p=n[d];if(p==null){t.push(void 0);continue}if(o===void 0){o=p,t.push(void 0);continue}const m=p-o;o=p;const h=m>0?m:0,_=m<0?-m:0;if(a)i=(i*(e-1)+h)/e,r=(r*(e-1)+_)/e;else{if(l.push(h),c.push(_),l.length<e){t.push(void 0);continue}i=l.reduce((w,S)=>w+S,0)/e,r=c.reduce((w,S)=>w+S,0)/e,a=!0}if(r===0)t.push(100);else{const w=i/r;t.push(100-100/(1+w))}}return t}function m_(n,e,t,o){const i=t.length,r=new Array(i).fill(0);let a;for(let d=0;d<i;d++){const p=n[d]??t[d]??NaN,m=e[d]??t[d]??NaN,h=t[d]??NaN;let _=Math.max(0,p-m);a!==void 0&&(_=Math.max(_,Math.abs(p-a),Math.abs(m-a))),r[d]=_,a=h}const l=new Array(i);let c=0;for(let d=0;d<i;d++)c+=r[d],d===o-1?l[d]=c/o:d>=o?l[d]=(l[d-1]*(o-1)+r[d])/o:l[d]=void 0;return l}function cW(n,e){const t=new Array(n.length);let o=0,i;for(let r=0;r<n.length;r++){const a=n[r],l=e[r]??0;if(i===void 0||a===void 0){t[r]=void 0,i=a;continue}a>i?o+=l:a<i&&(o-=l),t[r]=o,i=a}return t}function dW(n,e,t,o){const i=t.length,r=new Array(i);for(let c=0;c<i;c++)r[c]=((n[c]??t[c]??0)+(e[c]??t[c]??0)+(t[c]??0))/3;const a=sh(r.map(c=>c),o).map(c=>c),l=new Array(i);for(let c=0;c<i;c++){if(c<o-1){l[c]=void 0;continue}let d=0;for(let m=c-o+1;m<=c;m++)d+=Math.abs(r[m]-a[c]);d=d/o;const p=.015*d;l[c]=p===0?void 0:(r[c]-a[c])/p}return l}function uW(n,e,t,o,i){const r=t.length,a=new Array(r),l=new Array(r);for(let d=0;d<r;d++)l[d]=((n[d]??t[d]??0)+(e[d]??t[d]??0)+(t[d]??0))/3;const c=new Array(r);for(let d=0;d<r;d++)c[d]=l[d]*(o[d]??0);for(let d=0;d<r;d++){if(d<i){a[d]=void 0;continue}let p=0,m=0;for(let _=d-i+1;_<=d;_++)l[_]>=l[_-1]?p+=c[_]:m+=c[_];const h=m===0?1/0:p/m;a[d]=100-100/(1+h)}return a}function pW(n,e){const t=n.map((a,l)=>((a??0)+(e[l]??0))/2),o=sh(t,5),i=sh(t,34),r=new Array(t.length);for(let a=0;a<t.length;a++){const l=o[a],c=i[a];r[a]=l===void 0||c===void 0?void 0:l-c}return r}function vW(n,e){const t=hg(n,e).map(a=>a??NaN),o=hg(t,e).map(a=>a??NaN),i=hg(o,e).map(a=>a??NaN),r=new Array(n.length);for(let a=1;a<n.length;a++){const l=i[a-1],c=i[a];r[a]=l===void 0||c===void 0||l===0?void 0:(c/l-1)*100}return r[0]=void 0,r}function Zb(n,e){const t=new Array(n.length);let o=0,i=0;for(let r=0;r<n.length;r++){const a=n[r],l=e[r]??0;if(a===void 0){t[r]=void 0;continue}o+=a*l,i+=l,t[r]=i===0?void 0:o/i}return t}function fW(n,e,t){const o=new Array(n.length);let i=0,r=0;for(let a=0;a<n.length;a++){const l=n[a],c=e[a]??0;if(l!==void 0&&(i+=l*c,r+=c),a>=t){const d=n[a-t],p=e[a-t]??0;d!==void 0&&(i-=d*p,r-=p)}o[a]=a>=t-1&&r!==0?i/r:void 0}return o}function Xb(n,e,t){const o=n.map(c=>c??NaN),i=sh(o,e),r=[];for(let c=0;c<o.length;c++){if(c<e-1){r.push(void 0);continue}let d=0;for(let h=c-e+1;h<=c;h++)d+=o[h];const p=d/e;let m=0;for(let h=c-e+1;h<=c;h++){const _=o[h]-p;m+=_*_}r.push(Math.sqrt(m/e))}const a=new Array(o.length),l=new Array(o.length);for(let c=0;c<o.length;c++){const d=i[c],p=r[c];a[c]=d===void 0||p===void 0?void 0:d+t*p,l[c]=d===void 0||p===void 0?void 0:d-t*p}return{mid:i,upper:a,lower:l}}function mW(n,e,t,o,i){const r=t.length,a=m_(n,e,t,o).map(_=>_??NaN),l=new Array(r),c=new Array(r);for(let _=0;_<r;_++){const w=((n[_]??t[_]??0)+(e[_]??t[_]??0))/2,S=a[_];l[_]=w+i*S,c[_]=w-i*S}const d=new Array(r);let p=NaN,m=NaN,h=!0;for(let _=0;_<r;_++){p=Number.isFinite(p)?Math.min(l[_],p):l[_],m=Number.isFinite(m)?Math.max(c[_],m):c[_];const w=t[_]??NaN;if(!Number.isFinite(w)){d[_]=void 0;continue}h?(w<m&&(h=!1,p=l[_]),d[_]=m):(w>p&&(h=!0,m=c[_]),d[_]=p)}return d}function gW(n,e,t,o,i){const r=hg(t,o).map(p=>p??NaN),a=m_(n,e,t,o).map(p=>p??NaN),l=t.length,c=new Array(l),d=new Array(l);for(let p=0;p<l;p++){const m=r[p],h=a[p];c[p]=Number.isFinite(m)&&Number.isFinite(h)?m+i*h:void 0,d[p]=Number.isFinite(m)&&Number.isFinite(h)?m-i*h:void 0}return{mid:r,upper:c,lower:d}}function hW(n,e,t){const o=n.length,i=new Array(o),r=new Array(o),a=new Array(o);for(let l=0;l<o;l++){if(l<t-1){i[l]=void 0,r[l]=void 0,a[l]=void 0;continue}let c=-1/0,d=1/0;for(let p=l-t+1;p<=l;p++){const m=n[p]??e[p]??NaN,h=e[p]??n[p]??NaN;Number.isFinite(m)&&m>c&&(c=m),Number.isFinite(h)&&h<d&&(d=h)}i[l]=c,r[l]=d,a[l]=Number.isFinite(c)&&Number.isFinite(d)?(c+d)/2:void 0}return{upper:i,lower:r,mid:a}}function Xw(n,e){const t=n.length,o=new Array(t);for(let i=0;i<t;i++){if(i<e-1){o[i]=void 0;continue}let r=0;for(let p=i-e+1;p<=i;p++)r+=n[p]??0;const a=r/e;let l=0;for(let p=i-e+1;p<=i;p++){const m=(n[p]??0)-a;l+=m*m}const c=Math.sqrt(l/e),d=n[i]??NaN;o[i]=Number.isFinite(c)&&c!==0?(d-a)/c:void 0}return o}function Jb(n,e){const t=n.length,o=new Array(t);let i=n[0];for(let r=0;r<t;r++){const a=n[r],l=e[r]??0;if(a==null){o[r]=void 0;continue}const c=a>=(i??a)?1:-1;o[r]=c*l,i=a}return o}function _W(n){const e=n.length,t=new Array(e);let o=0;for(let i=0;i<e;i++){const r=n[i];if(r==null){t[i]=void 0;continue}o+=r,t[i]=o}return t}function yW(n,e){const t=n.length,o=new Array(t),i=new Array(t),r=new Array(t);for(let a=0;a<t;a++){if(a<e-1){o[a]=void 0,i[a]=void 0,r[a]=void 0;continue}let l=0,c=0,d=0,p=0,m=0;for(let M=a-e+1;M<=a;M++){const F=M-(a-e+1),V=n[M]??NaN;Number.isFinite(V)&&(l+=F,c+=V,d+=F*F,p+=F*V,m++)}const h=m*d-l*l;if(h===0||m===0){o[a]=void 0,i[a]=void 0,r[a]=void 0;continue}const _=(m*p-l*c)/h,w=(c-_*l)/m,S=e-1,P=_*S+w;o[a]=P;const I=Xw(n.slice(a-e+1,a+1).map(M=>M??NaN),e).pop(),C=Number(I)*(n[a]??0?1:0);i[a]=Number.isFinite(P)?P+Math.abs(C||0):void 0,r[a]=Number.isFinite(P)?P-Math.abs(C||0):void 0}return{mid:o,upper:i,lower:r}}function bW(n,e,t){const o=n.length,i=new Array(o);let r=0;for(let a=0;a<o;a++){const l=n[a],c=e[a]??0;if(l==null){i[a]=void 0;continue}const d=c/Math.max(1,e[a-1]??c);r=(r*(t-1)+l*d)/t,i[a]=r}return i}function xW(n){const{seriesMap:e,calcDefs:t,len:o,params:i,lastPrevSource:r,resolveNum:a,onError:l}=n,c=i||{};for(const d of t){const p=d.name||d.type;if(!p)continue;const m=String(p).replace(/\s+/g,"_").toLowerCase(),h=String(d.type||"").toLowerCase();if(h!=="security"){if(h==="sma"){const _=d.source||"close";e[m]=sh(e[_]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(h==="smma"){const _=d.source||"close";e[m]=aW(e[_]||e.close,Math.max(1,a(d.period,`${m}_period`,13)))}else if(h==="ema"){const _=d.source||"close";e[m]=hg(e[_]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(h==="wma"){const _=d.source||"close";e[m]=rW(e[_]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(h==="rsi"){const _=d.source||"close";e[m]=lW(e[_]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(h==="bbands"||h==="bollinger"||h==="bollinger_bands"){const _=d.source||"close",w=Math.max(1,a(d.period,`${m}_period`,20)),S=Math.max(.1,a(d.std,`${m}_std`,a(d.deviation,`${m}_deviation`,2))),{mid:P,upper:I,lower:C}=Xb(e[_]||e.close,w,S);e[m+"_mid"]=P,e[m+"_upper"]=I,e[m+"_lower"]=C}else if(h==="atr"){const _=Math.max(1,a(d.period,`${m}_period`,14));e[m]=m_(e.high,e.low,e.close,_)}else if(h==="obv")e[m]=cW(e.close,e.volume);else if(h==="cci"){const _=Math.max(1,a(d.period,`${m}_period`,20));e[m]=dW(e.high,e.low,e.close,_)}else if(h==="mfi"){const _=Math.max(1,a(d.period,`${m}_period`,14));e[m]=uW(e.high,e.low,e.close,e.volume,_)}else if(h==="ao")e[m]=pW(e.high,e.low);else if(h==="trix"){const _=Math.max(1,a(d.period,`${m}_period`,12));e[m]=vW(e.close,_)}else if(h==="vwap")e[m]=Zb(e.close,e.volume);else if(h==="vwma"){const _=Math.max(1,a(d.period,`${m}_period`,20));e[m]=fW(e.close,e.volume,_)}else if(h==="macd"){const _=(d.source||"close").replace(/\s+/g,"_").toLowerCase(),w=Math.max(1,Number(d.fast)||12),S=Math.max(1,Number(d.slow)||26),P=Math.max(1,Number(d.signal)||9),I=e[_]||e.close,C=hg(I,w),M=hg(I,S),F=new Array(o);for(let R=0;R<o;R++)F[R]=C[R]===void 0||M[R]===void 0?void 0:C[R]-M[R];const V=hg(F,P),j=new Array(o),D=new Array(o);for(let R=0;R<o;R++){const W=F[R],J=V[R];j[R]=typeof J=="number"&&Number.isFinite(J)?J:void 0,D[R]=W!==void 0&&J!==void 0?W-J:void 0}e.macd_line=F,e.macd_signal=j,e.macd_hist=D}else if(h==="supertrend"){const _=Math.max(1,Number(d.period)||10),w=Math.max(.1,Number(d.factor)||3);e[m]=mW(e.high,e.low,e.close,_,w)}else if(h==="kc"||h==="keltner"){const _=Math.max(1,Number(d.period)||20),w=Math.max(.1,Number(d.mult)||2),S=gW(e.high,e.low,e.close,_,w);e[m+"_mid"]=S.mid,e[m+"_upper"]=S.upper,e[m+"_lower"]=S.lower}else if(h==="donchian"){const _=Math.max(1,Number(d.period)||20),w=hW(e.high,e.low,_);e[m+"_mid"]=w.mid,e[m+"_upper"]=w.upper,e[m+"_lower"]=w.lower}else if(h==="atr_bands"){const _=Math.max(1,Number(d.period)||14),w=Math.max(.1,Number(d.mult)||2),S=m_(e.high,e.low,e.close,_),P=new Array(o),I=new Array(o);for(let C=0;C<o;C++){const M=S[C],F=e.close[C];P[C]=M!=null&&F!=null?F+w*M:void 0,I[C]=M!=null&&F!=null?F-w*M:void 0}e[m+"_upper"]=P,e[m+"_lower"]=I}else if(h==="zscore"){const _=Math.max(1,Number(d.period)||20),w=d.source||"close";e[m]=Xw(e[w]||e.close,_)}else if(h==="volume_delta")e[m]=Jb(e.close,e.volume);else if(h==="cum_delta"){const _=Jb(e.close,e.volume);e[m]=_W(_)}else if(h==="vwap_bands"){const _=Math.max(1,Number(d.period)||20),w=Zb(e.close,e.volume),{upper:S,lower:P}=Xb(Array.from(w).map(I=>I),_,Math.max(.1,Number(d.std)||2));e[m+"_mid"]=Array.from(w),e[m+"_upper"]=S,e[m+"_lower"]=P}else if(h==="linreg_channel"){const _=Math.max(1,Number(d.period)||20),w=d.source||"close",S=yW(e[w]||e.close,_);e[m+"_mid"]=S.mid,e[m+"_upper"]=S.upper,e[m+"_lower"]=S.lower}else if(h==="evwma"){const _=Math.max(1,Number(d.period)||20);e[m]=bW(e.close,e.volume,_)}else if(h==="sar"){const _=Math.max(.001,Number(d.step)||.02),w=Math.max(_,Number(d.max)||.2),S=e.high,P=e.low,I=new Array(o);let C=_,M=S[0],F=P[0],V=!0;for(let j=1;j<o;j++){const D=S[j]??NaN,R=P[j]??NaN;if(!Number.isFinite(D)||!Number.isFinite(R)){I[j]=void 0;continue}let W=F;V?(W=F+C*(M-F),D>M&&(M=D,C=Math.min(w,C+_)),W>R&&(V=!1,W=M,M=R,C=_)):(W=F-C*(F-M),R<M&&(M=R,C=Math.min(w,C+_)),W<D&&(V=!0,W=M,M=D,C=_)),I[j]=W,F=W}I[0]=F,e.sar=I}else if(h==="stoch"){const _=Number(d.kPeriod)||14,w=Number(d.dPeriod)||3,S=[],P=[];for(let C=0;C<o;C++){const M=Math.max(0,C-_+1);let F=-1/0,V=1/0;for(let W=M;W<=C;W++){const J=e.high[W]??e.close[W]??NaN,Z=e.low[W]??e.close[W]??NaN;J>F&&(F=J),Z<V&&(V=Z)}const j=e.close[C]??NaN,D=F-V,R=D===0?void 0:100*((j-V)/D);S.push(R)}const I=sh(S.map(C=>C??NaN),w);for(let C=0;C<o;C++)P.push(isNaN(I[C])?void 0:I[C]);e[m+"_k"]=S,e[m+"_d"]=P}else if(h==="roc"){const _=d.source||"close",w=e[_]||e.close,S=Math.max(1,Number(d.period)||10),P=new Array(o);for(let I=0;I<o;I++){const C=w[I],M=w[I-S];C===void 0||M===void 0||M===0?P[I]=void 0:P[I]=(C/M-1)*100}e[m]=P}else if(h==="ichimoku"){const _=Math.max(1,Number(d.tenkan)||9),w=Math.max(1,Number(d.kijun)||26),S=Math.max(1,Number(d.senkouB)||52),P=w,I=new Array(o),C=new Array(o),M=new Array(o),F=new Array(o),V=new Array(o),j=new Array(o),D=new Array(o),R=e.high,W=e.low,J=e.close,Z=(G,se)=>{let Y=-1/0,oe=1/0;const ee=Math.max(0,G-se+1);for(let re=ee;re<=G;re++){const me=R[re]??J[re]??NaN,K=W[re]??J[re]??NaN;me>Y&&(Y=me),K<oe&&(oe=K)}return{hi:Y,lo:oe}};for(let G=0;G<o;G++){if(G>=_-1){const{hi:se,lo:Y}=Z(G,_);I[G]=(se+Y)/2}if(G>=w-1){const{hi:se,lo:Y}=Z(G,w);C[G]=(se+Y)/2}if(I[G]!==void 0&&C[G]!==void 0&&(M[G]=(I[G]+C[G])/2),G>=S-1){const{hi:se,lo:Y}=Z(G,S);F[G]=(se+Y)/2}D[G]=G+P<o?J[G+P]:void 0}for(let G=0;G<o;G++)V[G]=G>=P?M[G-P]:void 0,j[G]=G>=P?F[G-P]:void 0;e.tenkan=I,e.kijun=C,e.spana=V,e.spanb=j,e.chikou=D}else if(h==="pivot_high"){const _=Math.max(0,Number(d.left)||3),w=Math.max(0,Number(d.right)||3),S=new Array(o);for(let P=0;P<o;P++){const I=e.high[P]??e.close[P]??NaN;if(!Number.isFinite(I)){S[P]=void 0;continue}let C=!0;const M=Math.max(0,P-_),F=Math.min(o-1,P+w);for(let V=M;V<=F;V++){if(V===P)continue;const j=e.high[V]??e.close[V]??NaN;if(!Number.isFinite(j)){C=!1;break}if(j>=I){C=!1;break}}S[P]=C?I:void 0}e[m]=S}else if(h==="pivot_low"){const _=Math.max(0,Number(d.left)||3),w=Math.max(0,Number(d.right)||3),S=new Array(o);for(let P=0;P<o;P++){const I=e.low[P]??e.close[P]??NaN;if(!Number.isFinite(I)){S[P]=void 0;continue}let C=!0;const M=Math.max(0,P-_),F=Math.min(o-1,P+w);for(let V=M;V<=F;V++){if(V===P)continue;const j=e.low[V]??e.close[V]??NaN;if(!Number.isFinite(j)){C=!1;break}if(j<=I){C=!1;break}}S[P]=C?I:void 0}e[m]=S}else if(h==="auto_fib"||h==="autofib"){const _=Math.max(2,Math.floor(a(d.lookback,`${m}_lookback`,200))),S=String(d.direction||"up").trim().toLowerCase()==="down"?"down":"up",P=String(d.method||d.mode||"extremes").trim().toLowerCase(),I=P==="pivots"||P==="pivot"||P==="swing"?"pivots":"extremes",C=Math.max(1,Math.floor(Number(d.pivotLeft??d.left??3))),M=Math.max(1,Math.floor(Number(d.pivotRight??d.right??3))),F=iW(e.high,e.low,e.close,{lookback:_,direction:S,method:I,pivotLeft:C,pivotRight:M});e[`${m}_from`]=F.from,e[`${m}_to`]=F.to,e[`${m}_from_idx`]=F.fromIndex,e[`${m}_to_idx`]=F.toIndex,e[`${m}_0`]=F.lvl0,e[`${m}_50`]=F.lvl50,e[`${m}_100`]=F.lvl100}else if(h==="last_value"){const _=String(d.source||"close").replace(/\s+/g,"_").toLowerCase(),w=e[_]||e.close,S=new Array(o);let P;for(let I=0;I<o;I++){const C=w[I];C!=null&&Number.isFinite(C)&&(P=C),S[I]=P}e[m]=S,r[m]=_}else if(h==="prev_value"){const _=String(d.source||"close").replace(/\s+/g,"_").toLowerCase(),w=e[_]||e.close,S=new Array(o);let P,I;for(let C=0;C<o;C++){const M=w[C];if(M!=null&&Number.isFinite(M)){const F=M;(P===void 0||F!==P)&&(I=P,P=F)}S[C]=I}e[m]=S,r[m]=_}else if(h==="line_value"){const _=String(d.startValue||"").replace(/\s+/g,"_").toLowerCase(),w=String(d.endValue||"").replace(/\s+/g,"_").toLowerCase();let P=r[_]||r[w]||"";P||(/pl|low/i.test(_)||/pl|low/i.test(w)?P="pl":(/ph|high/i.test(_)||/ph|high/i.test(w))&&(P="ph"));const I=e[P],C=new Array(o);if(I){const M=[];for(let F=o-1;F>=0&&M.length<2;F--){const V=I[F];V!=null&&Number.isFinite(V)&&M.push(F)}if(M.reverse(),M.length===2){const F=M[0],V=M[1],j=I[F],D=I[V];if(Number.isFinite(j)&&Number.isFinite(D)&&V!==F){const R=(D-j)/(V-F),W=j-R*F,J=Math.max(1,Number(d.lookback)||o),Z=Math.max(0,V-J);for(let G=0;G<o;G++)C[G]=G>=Z?R*G+W:void 0}}}e[m]=C}else if(h==="compare"){const _=String(d.left??"").trim(),w=String(d.right??"").trim(),S=String(d.op||">"),P=/^[-+]?\d+(?:\.\d+)?$/.test(_),I=/^[-+]?\d+(?:\.\d+)?$/.test(w),C=_.replace(/\s+/g,"_").toLowerCase(),M=w.replace(/\s+/g,"_").toLowerCase(),F=P?null:e[C]||e.close,V=I?null:e[M]||e.close,j=P?Number(_):NaN,D=I?Number(w):NaN,R=new Array(o);for(let W=0;W<o;W++){const J=P?j:(F==null?void 0:F[W])??NaN,Z=I?D:(V==null?void 0:V[W])??NaN;if(!Number.isFinite(J)||!Number.isFinite(Z)){R[W]=0;continue}let G=!1;switch(S){case">":G=J>Z;break;case"<":G=J<Z;break;case">=":G=J>=Z;break;case"<=":G=J<=Z;break;case"==":G=Math.abs(J-Z)<1e-9;break;default:G=J>Z;break}R[W]=G?1:0}e[m]=R}else if(typeof d.expr=="string"&&String(d.expr).trim().length)try{const _={};Object.entries(e).forEach(([I,C])=>{const M=new Float32Array(o);for(let F=0;F<o;F++)M[F]=C[F]??NaN;_[I.replace(/\s+/g,"_").toLowerCase()]=M});const w=gg([{name:m,expr:String(d.expr).replace(/\$\{([^}]+)\}/g,(I,C)=>String(c[C]??I))}],_,c),S=new Array(o),P=w[m];for(let I=0;I<o;I++){const C=P==null?void 0:P[I];S[I]=Number.isFinite(C)?C:void 0}e[m]=S}catch(_){if(l){const w=(_==null?void 0:_.message)!=null?String(_.message):String(_);l(`Expression error: ${w}`,_)}}}}}const Lh=n=>n>="0"&&n<="9",Qb=n=>n>="a"&&n<="z"||n>="A"&&n<="Z"||n==="_"||n==="$";class wW{constructor(e){Ce(this,"pos",0);this.input=e}next(){const e=this.input,t=e.length;for(;this.pos<t&&/\s/.test(e[this.pos]??"");)this.pos++;if(this.pos>=t)return{type:"eof",pos:this.pos};const o=this.pos,i=e[this.pos];if(Lh(i)||i==="."&&Lh(e[this.pos+1]??"")){let r=i===".";for(this.pos++;this.pos<t;){const a=e[this.pos];if(Lh(a))this.pos++;else if(a==="."&&!r)r=!0,this.pos++;else break}if(e[this.pos]==="e"||e[this.pos]==="E"){let l=this.pos+1;(e[l]==="+"||e[l]==="-")&&l++;const c=l;for(;l<t&&Lh(e[l]);)l++;l>c&&(this.pos=l)}return{type:"number",value:e.slice(o,this.pos),pos:o}}if(Qb(i)){for(this.pos++;this.pos<t;){const l=e[this.pos];if(Qb(l)||Lh(l))this.pos++;else break}const r=e.slice(o,this.pos),a=r.toLowerCase();return a==="and"?{type:"and",pos:o}:a==="or"?{type:"or",pos:o}:a==="not"?{type:"not",pos:o}:a==="crossesabove"?{type:"crossesAbove",pos:o}:a==="crossesbelow"?{type:"crossesBelow",pos:o}:a==="true"||a==="false"?{type:"number",value:a==="true"?"1":"0",pos:o}:{type:"identifier",value:r,pos:o}}switch(this.pos++,i){case">":return e[this.pos]==="="?(this.pos++,{type:"gte",pos:o}):{type:"gt",pos:o};case"<":return e[this.pos]==="="?(this.pos++,{type:"lte",pos:o}):{type:"lt",pos:o};case"=":{if(e[this.pos]==="=")return this.pos++,{type:"eq",pos:o};throw new Error(`Unexpected '=' at ${o}, expected '=='`)}case"!":{if(e[this.pos]==="=")return this.pos++,{type:"neq",pos:o};throw new Error(`Unexpected '!' at ${o}, expected '!='`)}case"(":return{type:"lparen",pos:o};case")":return{type:"rparen",pos:o};case",":return{type:"comma",pos:o};default:throw new Error(`Unexpected character "${i}" at position ${o}`)}}}class vg extends Error{constructor(e,t){super(e),this.position=t,this.name="ConditionParseError"}}class kW{constructor(e){Ce(this,"current");this.tokenizer=e,this.current=e.next()}cur(){return this.current.type}eat(e){if(this.current.type!==e)throw new vg(`Expected ${e} but found ${this.current.type}`,this.current.pos);const t=this.current;return this.current=this.tokenizer.next(),t}match(e){return this.current.type===e?(this.current=this.tokenizer.next(),!0):!1}parseCondition(){const e=this.parseOr();if(this.current.type!=="eof")throw new vg("Unexpected input after end of condition",this.current.pos);return e}parseOr(){let e=this.parseAnd();for(;this.current.type==="or";){this.eat("or");const t=this.parseAnd();e={kind:"Logical",op:"or",left:e,right:t}}return e}parseAnd(){let e=this.parsePrimary();for(;this.current.type==="and";){this.eat("and");const t=this.parsePrimary();e={kind:"Logical",op:"and",left:e,right:t}}return e}parsePrimary(){if(this.current.type==="lparen"){this.eat("lparen");const e=this.parseOr();return this.eat("rparen"),e}if(this.current.type==="not")return this.eat("not"),{kind:"Negation",expr:this.parsePrimary()};if(this.current.type==="identifier"){const e=this.eat("identifier");if(this.cur()==="lparen"){this.eat("lparen");const a=[];if(this.cur()!=="rparen")for(;a.push(this.parseValue()),!!this.match("comma"););return this.eat("rparen"),String(e.value||"").toLowerCase()==="between"&&a.length===3?{kind:"Between",value:a[0],a:a[1],b:a[2]}:{kind:"Call",name:String(e.value||""),args:a}}const t={kind:"SeriesRef",name:String(e.value||"")};{const a=this.cur();if(a==="crossesAbove"||a==="crossesBelow"){const l=this.current;if(this.current=this.tokenizer.next(),t.kind!=="SeriesRef")throw new vg("`crossesAbove/crossesBelow` left side must be a series name",l.pos);const c=this.parseValue();return{kind:"Cross",dir:l.type==="crossesAbove"?"above":"below",left:t,right:c}}}{const a=this.cur();if(a!=="gt"&&a!=="lt"&&a!=="gte"&&a!=="lte"&&a!=="eq"&&a!=="neq")return{kind:"Comparison",op:">",left:t,right:{kind:"NumberLiteral",value:0}}}const o=this.current;this.current=this.tokenizer.next();let i=">";o.type==="lt"?i="<":o.type==="gte"?i=">=":o.type==="lte"?i="<=":o.type==="eq"&&(i="==");const r=this.parseValue();return o.type==="neq"?{kind:"Logical",op:"or",left:{kind:"Comparison",op:">",left:t,right:r},right:{kind:"Comparison",op:"<",left:t,right:r}}:{kind:"Comparison",op:i,left:t,right:r}}return this.parseAtomCondition()}parseAtomCondition(){const e=this.parseValue();if(this.current.type==="crossesAbove"||this.current.type==="crossesBelow"){const a=this.current;if(this.current=this.tokenizer.next(),e.kind!=="SeriesRef")throw new vg("`crossesAbove/crossesBelow` left side must be a series name",a.pos);const l=this.parseValue();return{kind:"Cross",dir:a.type==="crossesAbove"?"above":"below",left:e,right:l}}if(this.current.type!=="gt"&&this.current.type!=="lt"&&this.current.type!=="gte"&&this.current.type!=="lte"&&this.current.type!=="eq"&&this.current.type!=="neq")return{kind:"Comparison",op:">",left:e,right:{kind:"NumberLiteral",value:0}};const t=this.current;let o;switch(t.type){case"gt":o=">";break;case"lt":o="<";break;case"gte":o=">=";break;case"lte":o="<=";break;case"eq":o="==";break;case"neq":o="==";break;default:o=">";break}this.current=this.tokenizer.next();const i=this.parseValue(),r={kind:"Comparison",op:o,left:e,right:i};return t.type==="neq"?{kind:"Logical",op:"or",left:{kind:"Comparison",op:">",left:e,right:i},right:{kind:"Comparison",op:"<",left:e,right:i}}:r}parseSeriesRef(){if(this.current.type!=="identifier")throw new vg("Expected series name",this.current.pos);const e=this.current;return this.current=this.tokenizer.next(),{kind:"SeriesRef",name:e.value||""}}parseValue(){if(this.current.type==="number"){const e=this.current;this.current=this.tokenizer.next();const t=Number(e.value);if(!Number.isFinite(t))throw new vg("Invalid number literal",e.pos);return{kind:"NumberLiteral",value:t}}if(this.current.type==="identifier"){const e=this.current;if(this.current=this.tokenizer.next(),this.current.type==="lparen"){this.eat("lparen");const t=[];if(this.current.type!=="rparen")for(;t.push(this.parseValue()),!!this.match("comma"););return this.eat("rparen"),{kind:"ValueCall",name:String(e.value||""),args:t}}return{kind:"SeriesRef",name:String(e.value||"")}}throw new vg(`Expected number or identifier but found ${this.current.type}`,this.current.pos)}}function Lg(n){return new kW(new wW(n)).parseCondition()}class Jw extends Error{constructor(e){super(e),this.name="ConditionEngineError"}}function SW(n){return n.replace(/\s+/g,"_").toLowerCase()}function Bp(n,e){const t=SW(e),o=n[t];if(o)return o;const i=t.replace(/_/g,"");if(i&&n[i])return n[i];if(i){const a=Object.keys(n).find(l=>l.replace(/_/g,"")===i);if(a&&n[a])return n[t]=n[a],n[t]}const r=Object.keys(n).slice(0,24).join(", ");throw new Jw(`Series "${e}" not found; available series: ${r}${Object.keys(n).length>24?", ...":""}`)}function CW(n){const e=Object.entries(n);if(!e.length)return 0;const t=e[0][1].length;for(const[,o]of e)if(o.length!==t)throw new Jw("All series must have the same length");return t}function um(n,e,t){var o,i,r,a,l,c;if(n.kind==="NumberLiteral")return n.value;if(n.kind==="SeriesRef")return Bp(t,n.name)[e];if(n.kind==="ValueCall"){const d=String(n.name||"").toLowerCase(),p=n.args;if(d==="lowest"||d==="highest"){const m=p[0],h=p[1],_=Bp(t,m.name||String(m)),w=Math.max(1,Math.floor(h.value??Number(h.name)??1)),S=Math.max(0,e-w+1);let P=d==="lowest"?1/0:-1/0;for(let I=S;I<=e;I++){const C=_[I];Number.isFinite(C)&&(d==="lowest"?P=Math.min(P,C):P=Math.max(P,C))}return Number.isFinite(P)?P:NaN}if(d==="lag"||d==="prev"){const m=p[0],h=p[1],_=Bp(t,m.name||String(m)),w=Math.max(1,Math.floor((h==null?void 0:h.value)??Number(h==null?void 0:h.name)??1)),S=e-w;return S>=0?_[S]:NaN}if(d==="change"){const m=p[0],h=p[1],_=Bp(t,m.name||String(m)),w=Math.max(1,Math.floor((h==null?void 0:h.value)??Number(h==null?void 0:h.name)??1)),S=e-w,P=_[e],I=S>=0?_[S]:NaN;return Number.isFinite(P)&&Number.isFinite(I)?P-I:NaN}if(d==="abs"){const m=um(p[0],e,t);return Math.abs(m)}if(d==="add"||d==="sub"||d==="mul"||d==="div"){const m=um(p[0],e,t),h=um(p[1],e,t);return[m,h].every(Number.isFinite)?d==="add"?m+h:d==="sub"?m-h:d==="mul"?m*h:h===0?NaN:m/h:NaN}if(d==="min"||d==="max"){const m=um(p[0],e,t),h=um(p[1],e,t);return[m,h].every(Number.isFinite)?d==="min"?Math.min(m,h):Math.max(m,h):NaN}if(d==="sma"){const m=((o=p[0])==null?void 0:o.name)||String(p[0]),h=((i=p[1])==null?void 0:i.value)??Number((r=p[1])==null?void 0:r.name),_=Math.max(1,Math.floor(Number(h)||0)),w=Bp(t,m);if(!Number.isFinite(w[e]))return NaN;let S=0,P=0;const I=Math.max(0,e-_+1);for(let C=I;C<=e;C++){const M=w[C];Number.isFinite(M)&&(S+=M,P++)}return P?S/P:NaN}if(d==="ema"){const m=((a=p[0])==null?void 0:a.name)||String(p[0]),h=((l=p[1])==null?void 0:l.value)??Number((c=p[1])==null?void 0:c.name),_=Math.max(1,Math.floor(Number(h)||0)),w=Bp(t,m),S=2/(_+1);let P;for(let I=0;I<=e;I++){const C=w[I];Number.isFinite(C)&&(P===void 0?P=C:P=C*S+P*(1-S))}return P??NaN}return NaN}return NaN}function PW(n,e,t){const o=um(n.left,e,t),i=um(n.right,e,t);if(!Number.isFinite(o)||!Number.isFinite(i))return!1;switch(n.op){case">":return o>i;case"<":return o<i;case">=":return o>=i;case"<=":return o<=i;case"==":return Math.abs(o-i)<1e-9;default:return!1}}function IW(n,e,t){if(e===0)return!1;const o=Bp(t,n.left.name);let i,r;if(n.right.kind==="NumberLiteral")i=n.right.value,r=n.right.value;else{const c=Bp(t,n.right.name);i=c[e-1],r=c[e]}const a=o[e-1],l=o[e];return!Number.isFinite(a)||!Number.isFinite(i)||!Number.isFinite(l)||!Number.isFinite(r)?!1:n.dir==="above"?a<=i&&l>r:a>=i&&l<r}function MW(n,e,t){return n.op==="and"?Zg(n.left,e,t)&&Zg(n.right,e,t):Zg(n.left,e,t)||Zg(n.right,e,t)}function AW(n,e,t){let o=-1/0;for(let i=e;i<=t;i++){const r=n[i];Number.isFinite(r)&&r>o&&(o=r)}return o}function TW(n,e,t){let o=1/0;for(let i=e;i<=t;i++){const r=n[i];Number.isFinite(r)&&r<o&&(o=r)}return o}function Ig(n,e=1){if(!n)return e;if(n.kind==="NumberLiteral")return Number(n.value)||e;const t=n.name?String(n.name):"",o=Number(t);return Number.isFinite(o)?o:e}function LW(n,e,t,o){var l,c;const i=n.toLowerCase(),r=d=>um(d,t,o),a=d=>{const p=d?r(d):NaN;return Number.isFinite(p)?Math.max(0,p):0};if(i==="higherhigh"){const d=Math.max(1,Math.floor(Ig(e[0],1))),p=Bp(o,"high"),m=Math.max(0,t-d),h=AW(p,m,Math.max(0,t-1));return Number.isFinite(p[t])&&p[t]>h}if(i==="lowerlow"){const d=Math.max(1,Math.floor(Ig(e[0],1))),p=Bp(o,"low"),m=Math.max(0,t-d),h=TW(p,m,Math.max(0,t-1));return Number.isFinite(p[t])&&p[t]<h}if(i==="swinghigh"){const d=Math.max(1,Math.floor(Ig(e[0],3))),p=Bp(o,"high"),m=p[t];if(!Number.isFinite(m))return!1;for(let h=t-d;h<=t+d;h++){if(h===t)continue;const _=p[h];if(Number.isFinite(_)&&_>=m)return!1}return!0}if(i==="swinglow"){const d=Math.max(1,Math.floor(Ig(e[0],3))),p=Bp(o,"low"),m=p[t];if(!Number.isFinite(m))return!1;for(let h=t-d;h<=t+d;h++){if(h===t)continue;const _=p[h];if(Number.isFinite(_)&&_<=m)return!1}return!0}if(i==="volspike"){const d=Math.max(1,Ig(e[0],1)),p=Bp(o,"volume"),h=Math.max(0,t-20+1),_=(()=>{let w=0,S=0;for(let P=h;P<=t;P++){const I=p[P];Number.isFinite(I)&&(w+=I,S++)}return S?w/S:NaN})();return Number.isFinite(p[t])&&Number.isFinite(_)&&p[t]>d*_}if(i==="atrspike"){const d=Math.max(1,Ig(e[0],1)),p=Bp(o,"high"),m=Bp(o,"low"),h=Bp(o,"close"),_=14,w=F=>{const V=p[F],j=m[F],D=h[F-1];let R=Math.max(0,V-j);return Number.isFinite(D)&&(R=Math.max(R,Math.abs(V-D),Math.abs(j-D))),R};let S=NaN,P=0;for(let F=0;F<=t;F++){const V=w(F);P+=V,F===_-1?S=P/_:F>=_&&(S=(S*(_-1)+V)/_)}let I=NaN,C=0,M=0;for(let F=Math.max(0,t-_+1);F<=t;F++){const V=w(F);C+=V,M++}return I=M?C/M:NaN,Number.isFinite(S)&&Number.isFinite(I)&&S>d*I}if(i==="trend"){const d=String(((l=e[0])==null?void 0:l.name)||"").toLowerCase()||"up",p=Bp(o,"close"),h=Math.max(0,t-10+1),_=(()=>{let w=0,S=0,P=0,I=0,C=0;for(let F=h;F<=t;F++){const V=F-h,j=p[F];Number.isFinite(j)&&(w+=V,S+=j,P+=V*V,I+=V*j,C++)}const M=C*P-w*w;return M===0||C===0?0:(C*I-w*S)/M})();return d==="up"?_>0:_<0}if(i==="crossover"||i==="crossunder"){const d=e[0],p=e[1],m=a(e[2]),h=Bp(o,d.name||String(d));let _,w;if(p.kind==="NumberLiteral")_=p.value,w=p.value;else{const I=Bp(o,p.name||String(p));_=I[t-1],w=I[t]}const S=h[t-1],P=h[t];return[S,P,_,w].every(Number.isFinite)?i==="crossover"?S<=_+m&&P>w+m:S>=_-m&&P<w-m:!1}if(i==="rising"||i==="falling"){const d=Bp(o,((c=e[0])==null?void 0:c.name)||String(e[0])),p=Math.max(1,Math.floor(Ig(e[1],3))),m=Math.max(0,t-p+1);let h=0,_=0,w=0,S=0,P=0;for(let M=m;M<=t;M++){const F=M-m,V=d[M];Number.isFinite(V)&&(h+=F,_+=V,w+=F*F,S+=F*V,P++)}const I=P*w-h*h,C=I===0||P===0?0:(P*S-h*_)/I;return i==="rising"?C>0:C<0}if(i==="above"||i==="below"){const d=r(e[0]),p=r(e[1]),m=a(e[2]);return!Number.isFinite(d)||!Number.isFinite(p)?!1:i==="above"?d>p+m:d<p-m}return!1}function Zg(n,e,t){switch(n.kind){case"Comparison":return PW(n,e,t);case"Cross":return IW(n,e,t);case"Logical":return MW(n,e,t);case"Negation":return!Zg(n.expr,e,t);case"Between":{const o=n,i=um(o.value,e,t),r=um(o.a,e,t),a=um(o.b,e,t);if(![i,r,a].every(Number.isFinite))return!1;const l=Math.min(r,a),c=Math.max(r,a);return i>=l&&i<=c}case"Call":{const o=n;return LW(String(o.name||""),o.args||[],e,t)}default:return!1}}function e2(n,e){const t=CW(e),o=new Uint8Array(t);for(let i=0;i<t;i++)o[i]=Zg(n,i,e)?1:0;return o}const t2=["sma","smma","ema","wma","rsi","bbands","bollinger","bollinger_bands","atr","obv","cci","mfi","ao","trix","vwap","vwma","zscore","evwma","roc","macd","supertrend","kc","keltner","donchian","atr_bands","vwap_bands","linreg_channel","sar","stoch","ichimoku","pivot_high","pivot_low","auto_fib","autofib","last_value","prev_value","line_value","security","expr","formula"],n2=["line","histogram","area","dots","stepped","bar","candles","ohlc","neon_line","bezier_line","glow_points","heatmap","distortion","cloud","aura","candleshadow","supertrend_cloud","fractal_boxes","liquidity_tiles"],o2=["arrowUp","arrowDown","circle","square","triangle_up_filled","triangle_down_filled","box","label","text","emoji","triangle_up_gradient","arrow_up_glow","pill","tag","flag"];function Bl(n){return Array.isArray(n)?n:[]}function Od(n){return typeof n=="string"?n:void 0}function lp(n){return typeof n=="number"&&Number.isFinite(n)?n:void 0}function b1(n){return String(n||"").replace(/\s+/g,"_").toLowerCase()}function FW(n,e,t,o){if(!n.length)return{series:[],stateSeries:[]};const i=[],r=[],a=new Set(e.map(d=>b1(String((d==null?void 0:d.name)||""))).filter(Boolean)),l=new Set(t.map(d=>b1(String((d==null?void 0:d.name)||""))).filter(Boolean)),c=d=>d==null?"":typeof d=="string"?d:typeof d=="number"&&Number.isFinite(d)?String(d):typeof d=="boolean"?d?"true":"false":"";return n.forEach((d,p)=>{if(!d||typeof d!="object")return;const m=Od(d.type),h=(m?m.toLowerCase():"")||(d.state?"state":(d.series,"series")),_=Od(d.name)||Od(d.series)||Od(d.state)||"";if(!_){o.push(`rules[${p}] missing name`);return}if(h!=="series"&&h!=="state"){o.push(`rules[${p}] invalid type "${String(d.type||"")}"`);return}const w=b1(_);if(a.has(w)||l.has(w)){o.push(`rules[${p}] name "${_}" conflicts with existing series/stateSeries`);return}const S=c(d.whenExpr??d.when),P=c(d.then??d.value??d.expr);if(!P){o.push(`rules[${p}] missing expression`);return}const I=c(d.else),C=S&&S.trim()?`iff(${S}, ${P}, ${I||(h==="state"?_:"na")})`:P;if(h==="state"){const M=c(d.init)||void 0,F=d.selfMode;r.push({name:_,initExpr:M,updateExpr:C,selfMode:F}),l.add(w)}else i.push({name:_,expr:C}),a.add(w)}),{series:i,stateSeries:r}}function Y1(n){const e=[];if(!n||typeof n!="object")return e.push("Script must be an object"),{ok:!1,errors:e};const t=n,o=!!(t!=null&&t.strategy)||Bl(t==null?void 0:t.signals).length>0,i=Bl(t.calc),r=Bl(t.series),a=Bl(t.stateSeries),l=Bl(t.rules),c=FW(l,r,a,e);c.series.length&&r.push(...c.series),c.stateSeries.length&&a.push(...c.stateSeries);const d=[];if(Array.isArray(t.panes)&&t.panes.length)for(const m of t.panes){const h=m.pane==="sub"?"sub":"main";d.push({pane:h,plots:Bl(m.plots),levels:Bl(m.levels),labels:Bl(m.labels),lines:Bl(m.lines),runtimeDrawOps:Bl(m.runtimeDrawOps),runtimeLabels:Bl(m.runtimeLabels),runtimeLines:Bl(m.runtimeLines),runtimeBoxes:Bl(m.runtimeBoxes),runtimeTables:Bl(m.runtimeTables),overlays:Bl(m.overlays),min:lp(m.min),max:lp(m.max),shortName:Od(m.shortName),fills:Bl(m.fills),backgroundZones:Bl(m.backgroundZones),height:lp(m.height)})}else if(t.main||t.sub)t.main&&d.push({pane:"main",plots:Bl(t.main.plots),levels:Bl(t.main.levels),labels:Bl(t.main.labels),lines:Bl(t.main.lines),runtimeDrawOps:Bl(t.main.runtimeDrawOps),runtimeLabels:Bl(t.main.runtimeLabels),runtimeLines:Bl(t.main.runtimeLines),runtimeBoxes:Bl(t.main.runtimeBoxes),runtimeTables:Bl(t.main.runtimeTables),overlays:Bl(t.main.overlays),min:lp(t.main.min),max:lp(t.main.max),shortName:Od(t.main.shortName||t.shortName),fills:Bl(t.main.fills),backgroundZones:Bl(t.main.backgroundZones),height:lp(t.main.height)}),t.sub&&d.push({pane:"sub",plots:Bl(t.sub.plots),levels:Bl(t.sub.levels),labels:Bl(t.sub.labels),lines:Bl(t.sub.lines),runtimeDrawOps:Bl(t.sub.runtimeDrawOps),runtimeLabels:Bl(t.sub.runtimeLabels),runtimeLines:Bl(t.sub.runtimeLines),runtimeBoxes:Bl(t.sub.runtimeBoxes),runtimeTables:Bl(t.sub.runtimeTables),overlays:Bl(t.sub.overlays),min:lp(t.sub.min),max:lp(t.sub.max),shortName:Od(t.sub.shortName||t.shortName),fills:Bl(t.sub.fills),backgroundZones:Bl(t.sub.backgroundZones),height:lp(t.sub.height)});else if(t.pane||t.plots||t.labels||t.levels||t.lines){const m=t.pane==="sub"?"sub":"main";d.push({pane:m,plots:Bl(t.plots),levels:Bl(t.levels),labels:Bl(t.labels),lines:Bl(t.lines),runtimeDrawOps:Bl(t.runtimeDrawOps),runtimeLabels:Bl(t.runtimeLabels),runtimeLines:Bl(t.runtimeLines),runtimeBoxes:Bl(t.runtimeBoxes),runtimeTables:Bl(t.runtimeTables),overlays:Bl(t.overlays),min:lp(t.min),max:lp(t.max),shortName:Od(t.shortName),fills:[],backgroundZones:[],height:void 0})}d.length||(o?d.push({pane:"main",plots:[],levels:[],labels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],overlays:[],min:lp(t.min),max:lp(t.max),shortName:Od(t.shortName),fills:[],backgroundZones:[],height:void 0}):e.push("No panes defined"));const p={calc:i.map((m,h)=>({name:Od(m.name)||Od(m.type)||`calc_${h}`,type:Od(m.type)||Od(m.name),source:Od(m.source),period:lp(m.period),fast:lp(m.fast),slow:lp(m.slow),signal:lp(m.signal),kPeriod:lp(m.kPeriod),dPeriod:lp(m.dPeriod),left:lp(m.left),right:lp(m.right),tenkan:lp(m.tenkan),kijun:lp(m.kijun),senkouB:lp(m.senkouB),expr:Od(m.expr),timeframe:Od(m.timeframe),symbol:Od(m.symbol),country:Od(m.country),lookahead:Od(m.lookahead),gaps:Od(m.gaps),params:m.params,style:m.style})),series:r.map((m,h)=>({name:Od(m.name)||`series_${h}`,expr:Od(m.expr)||""})),stateSeries:a.map((m,h)=>({name:Od(m.name)||`state_${h}`,initExpr:Od(m.initExpr),updateExpr:Od(m.updateExpr)||"",selfMode:m.selfMode||void 0})),panes:d,signals:Bl(t.signals).map((m,h)=>{const _=m==null?void 0:m.order,w=Od(m==null?void 0:m.title),S=Od(m==null?void 0:m.message),P=Od(m==null?void 0:m.whenExpr),I=Od(m==null?void 0:m.scoreExpr),C=Od(m==null?void 0:m.cooldownExpr),M=Od(_==null?void 0:_.kind),F=M?M.trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit"):void 0,V=Od((m==null?void 0:m.frequency)??(m==null?void 0:m.freq)),j=it=>{if(typeof it=="number"&&Number.isFinite(it)||typeof it=="string")return it},D=it=>{if(typeof it=="number"&&Number.isFinite(it)||typeof it=="string")return it},R=j(_==null?void 0:_.price),W=j((_==null?void 0:_.stopPrice)??(_==null?void 0:_.stop)??(_==null?void 0:_.trigger)),J=j((_==null?void 0:_.limitPrice)??(_==null?void 0:_.limit)??(_==null?void 0:_.lmt)),Z=D(_==null?void 0:_.qty),G=D(_==null?void 0:_.cash),se=D((_==null?void 0:_.commissionPct)??(_==null?void 0:_.commission)),Y=D((_==null?void 0:_.slippagePct)??(_==null?void 0:_.slippage)),oe=typeof(_==null?void 0:_.qtyPct)=="number"&&Number.isFinite(_.qtyPct)?_.qtyPct:void 0,ee=typeof oe=="number"?Math.max(0,Math.min(100,oe)):void 0,re=Od(_==null?void 0:_.oco),me=typeof(_==null?void 0:_.expiresBars)=="number"&&Number.isFinite(_.expiresBars)?_.expiresBars:void 0,K=typeof me=="number"?Math.max(0,Math.floor(me)):void 0,ye=_==null?void 0:_.bracket,Me=(()=>{if(!ye||typeof ye!="object")return;const it=ye,Ye=typeof it.stopLossPct=="number"&&Number.isFinite(it.stopLossPct)?Math.max(0,it.stopLossPct):void 0,ct=typeof it.takeProfitPct=="number"&&Number.isFinite(it.takeProfitPct)?Math.max(0,it.takeProfitPct):void 0,kt=typeof it.trailingStopPct=="number"&&Number.isFinite(it.trailingStopPct)?Math.max(0,it.trailingStopPct):void 0,ft=[],bt=Array.isArray(it.takeProfits)?it.takeProfits:[];for(const nt of bt){if(!nt||typeof nt!="object")continue;const Pt=typeof nt.takeProfitPct=="number"?nt.takeProfitPct:Number(nt.takeProfitPct),Qe=typeof nt.qtyPct=="number"?nt.qtyPct:Number(nt.qtyPct);!Number.isFinite(Pt)||Pt<=0||!Number.isFinite(Qe)||Qe<=0||ft.push({takeProfitPct:Math.max(0,Pt),qtyPct:Math.max(0,Math.min(100,Qe))})}if(ft.sort((nt,Pt)=>nt.takeProfitPct-Pt.takeProfitPct),!(Ye==null&&ct==null&&kt==null&&ft.length===0))return{stopLossPct:Ye,takeProfitPct:ct,trailingStopPct:kt,takeProfits:ft.length?ft:void 0}})(),Fe=typeof(m==null?void 0:m.cooldownBars)=="number"&&Number.isFinite(m.cooldownBars)?m.cooldownBars:void 0,Ze=typeof Fe=="number"?Math.max(0,Math.floor(Fe)):void 0;let Ge=null;return I==null&&(m==null?void 0:m.score)!=null&&(typeof m.score!="number"||!Number.isFinite(m.score)?e.push(`signals[${h}].score must be an integer 0..10`):Number.isInteger(m.score)?m.score<0||m.score>10?e.push(`signals[${h}].score must be in range 0..10`):Ge=m.score:e.push(`signals[${h}].score must be an integer 0..10`)),{type:String((m==null?void 0:m.type)||""),when:String((m==null?void 0:m.when)||""),whenExpr:P,id:Od(m==null?void 0:m.id),orderId:Od(m==null?void 0:m.orderId),title:w,message:S,frequency:V,score:Ge,scoreExpr:I,order:F||R!=null||W!=null||J!=null||Z!=null||G!=null||ee!=null||re!=null||K!=null||se!=null||Y!=null||Me!=null?{kind:F,price:R,stopPrice:W,limitPrice:J,qty:Z,cash:G,qtyPct:ee,oco:re,expiresBars:K,commissionPct:se,slippagePct:Y,bracket:Me}:void 0,cooldownBars:Ze,cooldownExpr:C}}),shortName:Od(t.shortName),strategy:t.strategy,params:t.params,style:t.style};return p.series.forEach((m,h)=>{m.name||e.push(`series[${h}] missing name`)}),p.stateSeries.forEach((m,h)=>{m.name||e.push(`stateSeries[${h}] missing name`),m.updateExpr||e.push(`stateSeries[${h}] missing updateExpr`)}),p.panes.forEach((m,h)=>{var _,w,S,P;!o&&!((_=m.plots)!=null&&_.length)&&!((w=m.labels)!=null&&w.length)&&!((S=m.levels)!=null&&S.length)&&!((P=m.lines)!=null&&P.length)&&e.push(`pane[${h}] has no plots/labels/levels/lines`)}),{ok:e.length===0,spec:p,errors:e}}function $W(n){console.error("[ScriptStudio]",n)}function K1(n,e){const t=i=>i.replace(/\$\{([^}]+)\}/g,(r,a)=>{const l=String(a),c=e[l];if(c==null)return r;if(typeof c=="number"&&Number.isFinite(c))return String(c);if(typeof c=="string")return c;try{return JSON.stringify(c)}catch{return String(c)}}),o=i=>{if(i==null)return i;if(typeof i=="string"){const r=i.match(/^\$\{([^}]+)\}$/);if(r){const a=String(r[1]),l=e[a];return l??i}return t(i)}if(Array.isArray(i))return i.map(o);if(typeof i=="object"){const r=Array.isArray(i)?[]:{};return Object.keys(i).forEach(a=>{const l=i[a];r[a]=o(l)}),r}return i};return o(n)}const s2=512;function EW(n,e){const t=n.match(/^\$\{([^}]+)\}$/);if(t){const o=String(t[1]||"");if(Object.prototype.hasOwnProperty.call(e,o))return e[o]}return n.replace(/\$\{([^}]+)\}/g,(o,i)=>{const r=String(i||"");if(!Object.prototype.hasOwnProperty.call(e,r))return o;const a=e[r];return typeof a=="string"?a:String(a)})}function Z1(n,e){if(n==null)return n;if(typeof n=="string")return EW(n,e);if(Array.isArray(n))return n.map(t=>Z1(t,e));if(typeof n=="object"){const t={};return Object.keys(n).forEach(o=>{t[o]=Z1(n[o],e)}),t}return n}function X1(n){let e=0;const t=r=>{if(e+=r,e>s2)throw new Error(`Loop expansion exceeds ${s2} items`)},o=(r,a)=>{const l=r==null?void 0:r.repeat,c=r==null?void 0:r.forEach,d=r==null?void 0:r.template;if(!d||!l&&!c)return[];const p=[],m=_=>{const w=Z1(d,_),S=i(w,_);Array.isArray(S)?p.push(...S):p.push(S)},h=(_,w,S)=>{_.forEach((P,I)=>{const C={...a,[w]:P};S&&(C[S]=I),t(1),m(C)})};if(c&&typeof c=="object"){if(!Array.isArray(c.items))throw new Error("forEach.items must be an array");const _=String(c.var||"item"),w=c.indexVar?String(c.indexVar):void 0;return h(c.items,_,w),p}if(l&&typeof l=="object"){const _=String(l.var||"i"),w=l.indexVar?String(l.indexVar):void 0;if(Array.isArray(l.items))return h(l.items,_,w),p;if(l.count!=null){const I=Number(l.count);if(!Number.isFinite(I))throw new Error("repeat.count must be a number");const C=Math.max(0,Math.floor(I)),M=new Array(C).fill(0).map((F,V)=>V);return h(M,_,w),p}const S=Number(l.from),P=Number(l.to);if(Number.isFinite(S)&&Number.isFinite(P)){const I=l.step!=null?Number(l.step):S<=P?1:-1;if(!Number.isFinite(I))throw new Error("repeat.step must be a number");const C=I===0?S<=P?1:-1:I,M=[];if(C>0)for(let F=S;F<=P;F+=C)M.push(F);else for(let F=S;F>=P;F+=C)M.push(F);return h(M,_,w),p}throw new Error("repeat requires count or from/to")}return p},i=(r,a)=>{if(r==null)return r;if(Array.isArray(r)){const l=[];return r.forEach(c=>{if(c&&typeof c=="object"&&!Array.isArray(c)&&(c.repeat||c.forEach)){if(!c.template)throw new Error("Loop directive requires template");l.push(...o(c,a))}else l.push(i(c,a))}),l}if(typeof r=="object"){const l={};return Object.keys(r).forEach(c=>{l[c]=i(r[c],a)}),l}return r};return i(n,{})}function P_(n,e,t){if(n.save(),e&&(n.beginPath(),n.rect(e.left,e.top,e.width,e.height),n.clip()),t)try{t()}finally{n.restore()}}function i2(n,e,t,o,i){if(!e.length)return;const r=Math.max(1,o/2);P_(n,i,()=>{n.save(),n.fillStyle=t;for(let a=0;a<e.length;a++){const{x:l,y:c}=e[a];!Number.isFinite(l)||!Number.isFinite(c)||(n.beginPath(),n.arc(l,c,r,0,Math.PI*2),n.fill())}n.restore()})}function NW(n,e,t,o,i,r,a){e.length&&P_(n,a,()=>{n.beginPath();let l=!1;for(let p=0;p<e.length;p++){const m=e[p];!Number.isFinite(m.x)||!Number.isFinite(m.y)||(l?n.lineTo(m.x,m.y):(n.moveTo(m.x,m.y),l=!0))}if(!l)return;const c=e[e.length-1],d=e.find(p=>Number.isFinite(p.x)&&Number.isFinite(p.y));n.lineTo(c.x,t),n.lineTo(d.x,t),n.closePath(),n.save(),n.fillStyle=o,n.fill(),n.restore(),i&&r>0})}function DW(n,e,t,o,i){e.length&&P_(n,i,()=>{n.beginPath();let r=!1;for(let a=0;a<e.length-1;a++){const l=e[a],c=e[a+1];!Number.isFinite(l.x)||!Number.isFinite(l.y)||!Number.isFinite(c.x)||!Number.isFinite(c.y)||(r||(n.moveTo(l.x,l.y),r=!0),n.lineTo(c.x,l.y),n.lineTo(c.x,c.y))}r&&(n.strokeStyle=t,n.lineWidth=o,n.setLineDash([]),n.stroke())})}function x1(n,e,t,o,i){!e.length||!t.length||P_(n,i,()=>{var a,l;n.beginPath();let r=0;for(;r<e.length&&!(Number.isFinite((a=e[r])==null?void 0:a.x)&&Number.isFinite((l=e[r])==null?void 0:l.y));)r++;if(!(r>=e.length)){for(n.moveTo(e[r].x,e[r].y);r<e.length;r++){const c=e[r];!Number.isFinite(c==null?void 0:c.x)||!Number.isFinite(c==null?void 0:c.y)||n.lineTo(c.x,c.y)}for(let c=t.length-1;c>=0;c--){const d=t[c];!Number.isFinite(d==null?void 0:d.x)||!Number.isFinite(d==null?void 0:d.y)||n.lineTo(d.x,d.y)}n.closePath(),n.save(),n.fillStyle=o,n.fill(),n.restore()}})}class Qw{constructor(e){Ce(this,"storage");Ce(this,"runtime",null);Ce(this,"events",{});Ce(this,"state");Ce(this,"symbolChangeCallbacks",new Set);Ce(this,"currentSymbol",null);this.storage=e||fN,this.state=zp({activeSaveId:null,savedLayouts:[],isLoading:!1,lastError:null,initialized:!1}),this.initialize()}async initialize(){try{this.updateState({isLoading:!0});const[e,t]=await Promise.all([this.storage.getActiveSaveId(),this.storage.listSavedLayouts()]);this.updateState({activeSaveId:e,savedLayouts:t,isLoading:!1,lastError:null})}catch(e){console.error("Failed to initialize SaveManager:",e),this.updateState({isLoading:!1,lastError:"Failed to initialize save system"})}}setRuntimeContracts(e){this.runtime=e,this.runtime.onSymbolChange(this.handleSymbolChange.bind(this)),this.currentSymbol=this.runtime.getCurrentSymbol(),this.updateState({initialized:!0}),console.log("✅ SaveManager fully initialized and ready")}setEventHandlers(e){this.events={...this.events,...e}}async handleSymbolChange(e){this.currentSymbol,this.currentSymbol=e;const t=this.getState();if(t.activeSaveId&&this.runtime)try{const o=await this.storage.getSavedLayout(t.activeSaveId);if(o){this.runtime.clearAllDrawings();const i=o.drawingsBySymbol[e]||[];this.runtime.renderDrawings(i)}}catch(o){console.error("Failed to reload drawings for symbol change:",o)}this.symbolChangeCallbacks.forEach(o=>{try{o(e)}catch(i){console.error("Symbol change callback error:",i)}})}onSymbolChange(e){this.symbolChangeCallbacks.add(e)}offSymbolChange(e){this.symbolChangeCallbacks.delete(e)}updateState(e){this.state.update(t=>({...t,...e}))}getState(){let e;return this.state.subscribe(t=>e=t)(),e}validateSaveName(e,t){return!e||e.trim().length===0?{valid:!1,error:"Name is required"}:e.length>100?{valid:!1,error:"Name must be 100 characters or less"}:this.getState().savedLayouts.some(r=>r.name===e&&r.id!==t)?{valid:!1,error:"Name already exists"}:{valid:!0}}async collectCurrentState(){if(!this.runtime)throw new Error("Runtime contracts not set");try{const e=this.runtime.getCurrentSymbol(),t=this.runtime.collectGlobalState(),o=this.runtime.collectDrawings(e);return{global:t,drawings:o,symbol:e}}catch(e){return console.error("Failed to collect chart state:",e),null}}async save(e){var t,o,i,r;try{this.updateState({isLoading:!0,lastError:null});const a=this.validateSaveName(e);if(!a.valid)return this.updateState({isLoading:!1,lastError:a.error}),{success:!1,error:a.error};const l=await this.collectCurrentState();if(!l)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const c={name:e,timezone:l.global.timezone,interval:l.global.interval,chartType:l.global.chartType,theme:l.global.theme,panes:l.global.panes,indicators:l.global.indicators,styles:l.global.styles,options:l.global.options,drawingsBySymbol:{[l.symbol]:l.drawings}},d=await this.storage.createSavedLayout(c);await this.storage.setActiveSaveId(d.id);const p=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:d.id,savedLayouts:p,isLoading:!1}),(o=(t=this.events).onSaved)==null||o.call(t,d),{success:!0,layout:d}}catch(a){console.error("Save failed:",a);const l=a instanceof Error?a.message:"Save failed";return this.updateState({isLoading:!1,lastError:l}),(r=(i=this.events).onError)==null||r.call(i,l),{success:!1,error:l}}}async quickSave(){var t,o,i,r;const e=this.getState();if(!e.activeSaveId)return this.updateState({isLoading:!1,lastError:"No active save to update"}),{success:!1,error:"No active save to update"};try{this.updateState({isLoading:!0,lastError:null});const a=await this.storage.getSavedLayout(e.activeSaveId);if(!a)return this.updateState({isLoading:!1,lastError:"Active save not found"}),{success:!1,error:"Active save not found"};const l=await this.collectCurrentState();if(!l)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const c={timezone:l.global.timezone,interval:l.global.interval,chartType:l.global.chartType,theme:l.global.theme,panes:l.global.panes,indicators:l.global.indicators,styles:l.global.styles,options:l.global.options,drawingsBySymbol:{...a.drawingsBySymbol,[l.symbol]:l.drawings}},d=await this.storage.updateSavedLayout(e.activeSaveId,c),p=await this.storage.listSavedLayouts();return this.updateState({savedLayouts:p,isLoading:!1}),(o=(t=this.events).onSaved)==null||o.call(t,d),{success:!0,layout:d}}catch(a){console.error("Quick save failed:",a);const l=a instanceof Error?a.message:"Quick save failed";return this.updateState({isLoading:!1,lastError:l}),(r=(i=this.events).onError)==null||r.call(i,l),{success:!1,error:l}}}async saveTo(e){var t,o,i,r,a,l;try{this.updateState({isLoading:!0,lastError:null});const c=await this.collectCurrentState();if(!c)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const d=await this.storage.getSavedLayout(e),p={timezone:c.global.timezone,interval:c.global.interval,chartType:c.global.chartType,theme:c.global.theme,panes:c.global.panes,indicators:c.global.indicators,styles:c.global.styles,options:c.global.options,drawingsBySymbol:d?{...d.drawingsBySymbol,[c.symbol]:c.drawings}:{[c.symbol]:c.drawings}};if(!d){console.log("📝 Layout not found locally, creating new layout via API");const _={name:`Layout ${new Date().toLocaleString()}`,...p},w=await this.storage.createSavedLayout(_);await this.storage.setActiveSaveId(w.id);const S=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:w.id,savedLayouts:S,isLoading:!1}),(o=(t=this.events).onSaved)==null||o.call(t,w),{success:!0,layout:w}}const m=await this.storage.updateSavedLayout(e,p);await this.storage.setActiveSaveId(e);const h=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:e,savedLayouts:h,isLoading:!1}),(r=(i=this.events).onSaved)==null||r.call(i,m),{success:!0,layout:m}}catch(c){console.error("Save to existing failed:",c);const d=c instanceof Error?c.message:"Save failed";return this.updateState({isLoading:!1,lastError:d}),(l=(a=this.events).onError)==null||l.call(a,d),{success:!1,error:d}}}async saveAs(e){return this.save(e)}async load(e){var t,o,i,r,a,l,c,d,p,m,h,_;try{this.updateState({isLoading:!0,lastError:null}),console.log("🔄 Loading layout:",e);const w=await this.storage.getSavedLayout(e);if(!w)try{await this.refresh();const I=await this.storage.getSavedLayout(e);if(!I){const V=await this.storage.listSavedLayouts();if(V&&V.length>0){const j=V[0].id,D=await this.storage.getSavedLayout(j);if(D){if(!this.runtime)return this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};await this.runtime.applyGlobalState({timezone:D.timezone,interval:D.interval,chartType:D.chartType,theme:D.theme,panes:D.panes,indicators:D.indicators,styles:D.styles,options:D.options});const R=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const W=D.drawingsBySymbol[R]||[];return this.runtime.renderDrawings(W),await this.storage.setActiveSaveId(D.id),this.updateState({activeSaveId:D.id,isLoading:!1}),(o=(t=this.events).onLoaded)==null||o.call(t,D),{success:!0}}}return await this.storage.setActiveSaveId(null),this.updateState({isLoading:!1,lastError:"Layout not found"}),{success:!1,error:"Layout not found"}}const C=I;if(!this.runtime)return this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};await this.runtime.applyGlobalState({timezone:C.timezone,interval:C.interval,chartType:C.chartType,theme:C.theme,panes:C.panes,indicators:C.indicators,styles:C.styles,options:C.options});const M=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const F=C.drawingsBySymbol[M]||[];return this.runtime.renderDrawings(F),await this.storage.setActiveSaveId(C.id),this.updateState({activeSaveId:C.id,isLoading:!1}),(r=(i=this.events).onLoaded)==null||r.call(i,C),{success:!0}}catch{return await this.storage.setActiveSaveId(null),this.updateState({isLoading:!1,lastError:"Layout not found"}),{success:!1,error:"Layout not found"}}if(console.log("📊 Layout data loaded:",{name:w.name,indicatorCount:((a=w.indicators)==null?void 0:a.length)||0,indicators:((l=w.indicators)==null?void 0:l.map(I=>I.type))||[]}),!this.runtime)return console.error("❌ Runtime contracts not set"),this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};console.log("🔧 Applying global state with indicators:",((c=w.indicators)==null?void 0:c.length)||0),await this.runtime.applyGlobalState({timezone:w.timezone,interval:w.interval,chartType:w.chartType,theme:w.theme,panes:w.panes,indicators:w.indicators,styles:w.styles,options:w.options});const S=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const P=w.drawingsBySymbol[S]||[];return this.runtime.renderDrawings(P),await this.storage.setActiveSaveId(w.id),this.updateState({activeSaveId:w.id,isLoading:!1}),(p=(d=this.events).onLoaded)==null||p.call(d,w),console.log("✅ Layout loaded successfully:",{layoutId:w.id,name:w.name,indicatorsRestored:((m=w.indicators)==null?void 0:m.length)||0}),{success:!0}}catch(w){console.error("Load failed:",w);const S=w instanceof Error?w.message:"Load failed";return this.updateState({isLoading:!1,lastError:S}),(_=(h=this.events).onError)==null||_.call(h,S),{success:!1,error:S}}}async delete(e){var t,o,i,r;try{this.updateState({isLoading:!0,lastError:null}),await this.storage.deleteSavedLayout(e);const[a,l]=await Promise.all([this.storage.getActiveSaveId(),this.storage.listSavedLayouts()]);return this.updateState({activeSaveId:a,savedLayouts:l,isLoading:!1}),(o=(t=this.events).onDeleted)==null||o.call(t,e),{success:!0}}catch(a){console.error("Delete failed:",a);const l=a instanceof Error?a.message:"Delete failed";return this.updateState({isLoading:!1,lastError:l}),(r=(i=this.events).onError)==null||r.call(i,l),{success:!1,error:l}}}hasActiveSave(){return this.getState().activeSaveId!==null}getActiveSaveId(){return this.getState().activeSaveId}async clearActiveSave(){await this.storage.setActiveSaveId(null),this.updateState({activeSaveId:null})}async refresh(){try{this.updateState({isLoading:!0});const e=await this.storage.listSavedLayouts();this.updateState({savedLayouts:e,isLoading:!1,lastError:null})}catch(e){console.error("Refresh failed:",e),this.updateState({isLoading:!1,lastError:"Failed to refresh layouts"})}}destroy(){this.runtime&&this.symbolChangeCallbacks.clear()}}new Qw;const w1="https://noti.dutyai.app/auth/chart/settings";class jW{constructor(){Ce(this,"localStorageProvider");Ce(this,"initialized",!1);this.localStorageProvider=new Hw}async initialize(){this.initialized||(await this.localStorageProvider.initialize(),this.initialized=!0)}hasUserId(){return typeof window<"u"&&!!localStorage.getItem("userId")}getUserId(){return typeof window<"u"?localStorage.getItem("userId"):null}async saveToApi(e){const t=this.getUserId();if(!t)throw new Error("User ID not found in localStorage");if(e._source==="api"&&!e._isModified)return console.log("🔄 Skipping API save for unmodified API-loaded data"),{...e,_source:"api"};try{console.log(e,"layoutData");const o=e.id||this.generateApiId(),i={clerkId:t,settings:e,id:o};console.log("🌐 Sending to API:",i);const r=await fetch(w1,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!r.ok){const l=await r.text();throw console.error("API error response:",l),new Error(`API request failed: ${r.status} ${r.statusText} - ${l}`)}const a=await r.json();return console.log("✅ API save successful:",a),{...e,id:a.id||o,createdAt:a.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(o){throw console.error("API save failed:",o),new Error("Failed to save to API")}}generateApiId(){return`api_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async loadFromApi(){var t;const e=this.getUserId();if(!e)throw new Error("User ID not found in localStorage");try{const o=`${w1}/${e}`;console.log("🌐 API Request:",o);const i=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("🌐 API Response Status:",i.status,i.statusText),!i.ok)throw new Error(`API request failed: ${i.status} ${i.statusText}`);const r=await i.json();return console.log("🌐 API Response Data:",r),Array.isArray(r)?r.map(a=>{var l;return{id:a.id,name:((l=a.settings)==null?void 0:l.name)||"Untitled Layout",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...a.settings,_source:"api"}}):[{id:r.id,name:((t=r.settings)==null?void 0:t.name)||"Untitled Layout",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...r.settings,_source:"api"}]}catch(o){throw console.error("API load failed:",o),new Error("Failed to load from API")}}async deleteFromApi(e){if(!this.getUserId())throw new Error("User ID not found in localStorage");try{const o=`${w1}/${e}`;console.log("🌐 API Delete Request:",o);const i=await fetch(o,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("🌐 API Delete Response Status:",i.status,i.statusText),!i.ok)throw new Error(`API delete request failed: ${i.status} ${i.statusText}`);console.log("✅ Layout deleted successfully from API")}catch(o){throw console.error("API delete failed:",o),new Error("Failed to delete from API")}}async listSavedLayouts(){if(await this.initialize(),this.hasUserId())try{return console.log("🌐 Loading layouts from API (userId found)"),(await this.loadFromApi()).map(t=>({id:t.id,name:t.name||"Untitled Layout",createdAt:t.createdAt||new Date().toISOString(),updatedAt:t.updatedAt||new Date().toISOString()}))}catch(e){console.error("API load failed, falling back to localStorage:",e)}return console.log("💾 Loading layouts from localStorage (no userId or API failed)"),this.localStorageProvider.listSavedLayouts()}async getSavedLayout(e){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Loading specific layout from API");const o=(await this.loadFromApi()).find(i=>i.id===e);if(o)return o;console.log("📖 Layout not found in API response, falling back to localStorage")}catch(t){console.error("API load failed, falling back to localStorage:",t)}return this.localStorageProvider.getSavedLayout(e)}async createSavedLayout(e){if(await this.initialize(),this.hasUserId())try{return console.log("🌐 Saving to API (userId found)"),await this.saveToApi(e)}catch(t){console.error("API save failed, falling back to localStorage:",t)}return console.log("💾 Saving to localStorage (no userId or API failed)"),this.localStorageProvider.createSavedLayout(e)}async updateSavedLayout(e,t){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Updating via API (userId found)");try{const a=(await this.loadFromApi()).find(l=>l.id===e);if(a){console.log("📝 Layout found in API, updating via API");const l={...a,...t,_isModified:!0};return await this.saveToApi(l)}}catch(r){console.log("📖 Layout not found in API, checking localStorage:",r)}const o=await this.localStorageProvider.getSavedLayout(e);if(o){console.log("📝 Layout found in localStorage, updating via API");const r={...o,...t};return await this.saveToApi(r)}console.log("📝 Layout not found, creating new via API");const i={id:e,...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),_isModified:!0};return await this.saveToApi(i)}catch(o){console.error("API update failed, falling back to localStorage:",o)}return console.log("💾 Updating in localStorage"),this.localStorageProvider.updateSavedLayout(e,t)}async deleteSavedLayout(e){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Deleting layout from API"),await this.deleteFromApi(e),console.log("✅ Layout deleted from API successfully");return}catch(t){console.error("API delete failed, falling back to localStorage:",t)}return console.log("💾 Deleting from localStorage"),this.localStorageProvider.deleteSavedLayout(e)}async getActiveSaveId(){return await this.initialize(),this.localStorageProvider.getActiveSaveId()}async setActiveSaveId(e){return await this.initialize(),this.localStorageProvider.setActiveSaveId(e)}async cleanup(){return await this.initialize(),this.localStorageProvider.cleanup()}}function RW(n,e){gd(e,!1);const t=wp(),o=()=>ya(r,"$save",t),i=()=>ya(a,"$chart",t),r=Kc("save");Kc("ctx");const a=Kc("chart"),l=Kc("drawingManager"),c=(()=>{try{return Kc("saveRestoring")||null}catch{return null}})(),d=new jW,p=new Qw(d);let m=null,h=null;function _(){try{console.log("🧹 Clearing persisted chart cache to prevent showing unsaved changes...");const P=o(),I=P!=null&&P.key&&typeof P.key=="string"?P.key:"chart";if(typeof localStorage<"u"){const C=localStorage.getItem(I);if(C)try{const V=JSON.parse(C),j={key:V.key||I,theme:V.theme||"dark",symbol:V.symbol||"BINANCE:BTCUSDT",period:V.period||{timeframe:"1d",timespan:"day"}};localStorage.setItem(I,JSON.stringify(j)),console.log("✅ Cleared unsaved chart changes, kept basic settings")}catch(V){console.warn("⚠️ Could not parse stored chart, clearing completely:",V),localStorage.removeItem(I)}const M=`${I}_drawings`,F=`${I}_overlays`;localStorage.removeItem(M),localStorage.removeItem(F),localStorage.removeItem("dataSpaceOverlays"),console.log("✅ Persisted chart cache cleared successfully")}try{r.update(C=>{var V,j,D,R;const M=((j=(V=C.styles)==null?void 0:V.candle)==null?void 0:j.type)||"renko_atr",F=((R=(D=C.styles)==null?void 0:D.candle)==null?void 0:R.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};return C.styles={candle:{type:M,renko:F}},C.options={},C.saveInds={},C})}catch(C){console.warn("⚠️ Failed to clear in‑memory save styles/options:",C)}}catch(P){console.error("❌ Error clearing persisted chart cache:",P)}}fv(async()=>{if(i())w(i());else{const P=a.subscribe(I=>{I&&(P(),w(I))})}});async function w(P){var I,C;try{let M=0;const F=20;for(;!l.get()&&M<F;)await new Promise(D=>setTimeout(D,100)),M+=1;const V=l.get();V?console.log("✅ DrawingManager is available for save system"):console.error("❌ DrawingManager not available after waiting");const j={getCurrentSymbol:()=>Sb(o()),collectGlobalState:()=>fT(o(),P),collectDrawings:D=>{if(!V)return console.warn("⚠️ DrawingManager not available, returning empty drawings"),[];const R=V.getDrawingsForSymbol(D);return console.log(`📥 Collected ${R.length} drawings for symbol:`,D),R},applyGlobalState:async D=>await mT(D,r,P),clearAllDrawings:()=>{var D,R;V?V.hideRenderedDrawings():console.warn("⚠️ DrawingManager not available, cannot clear drawings");try{const W=((D=P==null?void 0:P.getOverlays)==null?void 0:D.call(P,{groupId:"drawing_tools"}))||[];for(const J of W)try{(R=P==null?void 0:P.removeOverlay)==null||R.call(P,{id:J.id})}catch{}console.log("🗑️ Cleared chart overlays for drawing_tools group")}catch{}},renderDrawings:D=>{if(!V){console.warn("⚠️ DrawingManager not available, cannot render drawings");return}const R=Sb(o());console.log(`🎨 Rendering ${D.length} drawings for symbol:`,R),V.setCurrentSymbol(R),V.loadDrawingsForSymbol(R,D)},onSymbolChange:D=>{h=Lu(r,W=>ig(W.symbol)).subscribe(W=>{m!==null&&m!==W&&(console.log("🔄 Save system detected symbol change:",m,"->",W),D(W)),m=W})},offSymbolChange:D=>{h&&(h(),h=null)}};p.setRuntimeContracts(j),p.setEventHandlers({onSaved:()=>{try{o1()}catch{}},onLoaded:()=>{try{o1()}catch{}}}),typeof window<"u"&&(window.saveManager=p,window.forceRefreshChart=async()=>{console.log("🔄 Force refresh triggered from WebView parent"),await S()},window.clearChartCache=()=>{var D;console.log("🗑️ Clearing chart cache");try{const R=(D=o())!=null&&D.key&&typeof o().key=="string"?o().key:"chart";localStorage.removeItem(R);const W=`${R}_drawings`;localStorage.removeItem(W);const J=`${R}_overlays`;localStorage.removeItem(J),localStorage.removeItem("dataSpaceOverlays"),console.log("✅ Chart cache cleared")}catch(R){console.error("❌ Error clearing cache:",R)}});try{p.getActiveSaveId()&&(c==null||c.set(!0))}catch{}_();try{const D=(I=o())!=null&&I.key&&typeof o().key=="string"?o().key:"chart";(typeof localStorage<"u"?localStorage.getItem(`${D}.lastTimeframe`):null)||typeof localStorage<"u"&&localStorage.setItem(`${D}.lastTimeframe`,"1d")}catch{}await S();try{const D=(C=o())!=null&&C.key&&typeof o().key=="string"?o().key:"chart",R=typeof localStorage<"u"?localStorage.getItem(`${D}.lastTimeframe`):null;if(R&&typeof R=="string"&&R.length>0){const W=R.slice(-1),J=parseInt(R.slice(0,-1))||1,Z=W==="M"?"month":W==="w"?"week":W==="d"?"day":W==="h"?"hour":W==="m"?"minute":W==="s"?"second":"day",G=Pv(R);r.update(se=>(se.period={multiplier:J,timespan:Z,timeframe:R,secs:G},se))}}catch{}try{o1()}catch{}try{c==null||c.set(!1)}catch{}console.log("✅ Save system initialized successfully")}catch(M){console.error("❌ Failed to initialize save system:",M)}}async function S(){try{console.log("🔍 Starting automatic restoration process (WebView-safe)...");let P=null;try{P=typeof window<"u"?localStorage.getItem("userId"):null}catch{}if(P){console.log("🌐 User logged in, refreshing saved layouts from server...");try{await p.refresh(),console.log("✅ Saved layouts refreshed from server")}catch(F){console.warn("⚠️ Could not refresh saved layouts from server:",F)}}const I=p.getActiveSaveId();if(console.log("🔍 Active save ID found:",I),I){console.log("🔄 Restoring active saved data:",I);const F=await p.load(I);if(F.success){console.log("✅ Active saved data restored successfully:",I);return}else{console.warn("⚠️ Failed to restore active saved data:",F.error);try{await p.clearActiveSave(),console.log("🧹 Cleared stale activeSaveId after failed restore")}catch(V){console.warn("⚠️ Could not clear activeSaveId:",V)}}}let C=[];const M=p.state.subscribe(F=>{C=(F==null?void 0:F.savedLayouts)||[]});if(M&&M(),C&&C.length>0){const F=C[0];if(console.log("🧭 Auto-selecting first saved layout:",F==null?void 0:F.id,F==null?void 0:F.name),F!=null&&F.id){const V=await p.load(F.id);if(V.success){console.log("✅ First saved layout auto-restored and set active:",F.id);return}else console.warn("⚠️ Failed to auto-load chosen layout:",V.error)}}console.log("ℹ️ No saved layouts found, using default chart configuration")}catch(P){console.error("❌ Error restoring active saved data:",P)}}Lm(()=>{h&&h(),p.destroy()}),Bv(),hd()}function BW(n,e){e("cancel")}function OW(n,e){e("confirm")}var zW=fe('<div class="ucm-backdrop svelte-16egrl4"><div class="ucm-modal svelte-16egrl4" role="dialog" aria-modal="true" aria-labelledby="ucm-title"><div class="ucm-header svelte-16egrl4"><h2 id="ucm-title" class="svelte-16egrl4"> </h2></div> <div class="ucm-body svelte-16egrl4"><p> </p></div> <div class="ucm-actions svelte-16egrl4"><button class="btn btn-cancel svelte-16egrl4">Cancel</button> <button class="btn btn-confirm svelte-16egrl4">Confirm</button></div></div></div>');function VW(n,e){gd(e,!1);let t=Ws(e,"show",8,!1),o=Ws(e,"title",8,"Unsaved changes"),i=Ws(e,"message",8,"You have unsaved changes. If you refresh, your changes will be lost.");const r=mv();Bv();var a=Ln(),l=Dt(a);Te(l,t,c=>{var d=zW(),p=g(d),m=g(p),h=g(m),_=g(h,!0);f(h),f(m);var w=u(m,2),S=g(w),P=g(S,!0);f(S),f(w);var I=u(w,2),C=g(I);C.__click=[BW,r];var M=u(C,2);M.__click=[OW,r],f(I),f(p),f(d),Se(()=>{ze(_,o()),ze(P,i())}),z(c,d)}),z(n,a),hd()}qu(["click"]);const WW={lookbackPeriod:50,trendWeight:.3,momentumWeight:.25,volatilityWeight:.2,supportResistanceWeight:.15,volumeWeight:.1};function df(n,e){return n.length<e?n[n.length-1]||0:n.slice(-e).reduce((o,i)=>o+i,0)/e}function k1(n,e){if(n.length===0)return 0;if(n.length<e)return df(n,n.length);const t=2/(e+1);let o=df(n.slice(0,e),e);for(let i=e;i<n.length;i++)o=(n[i]-o)*t+o;return o}function e5(n,e=14){if(n.length<e+1)return 50;const t=[];for(let c=1;c<n.length;c++)t.push(n[c]-n[c-1]);let o=0,i=0;for(let c=0;c<e;c++)t[c]>=0?o+=t[c]:i-=t[c];let r=o/e,a=i/e;for(let c=e;c<t.length;c++)t[c]>=0?(r=(r*(e-1)+t[c])/e,a=a*(e-1)/e):(r=r*(e-1)/e,a=(a*(e-1)-t[c])/e);return a===0?100:100-100/(1+r/a)}function qW(n,e=14){if(n.length<2)return 0;const t=[];for(let o=1;o<n.length;o++){const i=n[o].high,r=n[o].low,a=n[o-1].close,l=Math.max(i-r,Math.abs(i-a),Math.abs(r-a));t.push(l)}return df(t,Math.min(e,t.length))}function HW(n,e=3){if(n.length<10)return{support:[],resistance:[]};const t=n.map(a=>a.high),o=n.map(a=>a.low),i=[],r=[];for(let a=2;a<n.length-2;a++)t[a]>t[a-1]&&t[a]>t[a-2]&&t[a]>t[a+1]&&t[a]>t[a+2]&&i.push(t[a]),o[a]<o[a-1]&&o[a]<o[a-2]&&o[a]<o[a+1]&&o[a]<o[a+2]&&r.push(o[a]);return i.sort((a,l)=>l-a),r.sort((a,l)=>a-l),{resistance:i.slice(0,e),support:r.slice(0,e)}}function UW(n){if(n.length<3)return{pattern:"none",bullish:!0,confidence:.5};const e=n[n.length-1],t=n[n.length-2],o=n[n.length-3],i=Math.abs(e.close-e.open),r=e.high-e.low,a=e.close>e.open,l=Math.abs(t.close-t.open),c=t.close>t.open;if(i>l*1.5){if(a&&!c)return{pattern:"bullish_engulfing",bullish:!0,confidence:.75};if(!a&&c)return{pattern:"bearish_engulfing",bullish:!1,confidence:.75}}if(i<r*.1)return{pattern:"doji",bullish:c,confidence:.4};const d=a?e.open-e.low:e.close-e.low,p=a?e.high-e.close:e.high-e.open;return d>i*2&&p<i*.5?{pattern:"hammer",bullish:!0,confidence:.65}:p>i*2&&d<i*.5?{pattern:"shooting_star",bullish:!1,confidence:.65}:a&&c&&o.close>o.open?{pattern:"three_white_soldiers",bullish:!0,confidence:.7}:!a&&!c&&o.close<o.open?{pattern:"three_black_crows",bullish:!1,confidence:.7}:{pattern:"none",bullish:a,confidence:.5}}function GW(n){if(n.length<30)return{phase:"accumulation",confidence:.5};const e=n.slice(-30),t=e.map(p=>p.close),o=e.map(p=>p.volume||0),i=e.map(p=>p.high-p.low),r=(t[t.length-1]-t[0])/t.length,a=df(o,o.length),l=df(o.slice(-5),5),c=df(i,i.length),d=df(i.slice(-5),5);return Math.abs(r)<c*.1&&l<a*1.1&&d<c*1.1?{phase:"accumulation",confidence:.7}:r>c*.3&&l>a*1.2?{phase:"markup",confidence:.75}:Math.abs(r)<c*.15&&l>a*1.3&&(t[t.length-10]-t[0])/10>0?{phase:"distribution",confidence:.7}:r<-c*.3&&l>a*1.2?{phase:"markdown",confidence:.75}:{phase:"accumulation",confidence:.5}}function YW(n){if(n.length<20)return{direction:"sideways",strength:.5};const e=n.map(D=>D.close),t=n.map(D=>D.high),o=n.map(D=>D.low),i=k1(e,9),r=k1(e,21),a=k1(e,Math.min(50,e.length)),l=e[e.length-1];let c="sideways",d=0,p=0;i>r?d++:p++,r>a?d++:p++,l>i?d++:p++;const m=t.slice(-5),h=o.slice(-5),_=m[m.length-1]>m[0],w=h[h.length-1]>h[0],S=m[m.length-1]<m[0],P=h[h.length-1]<h[0];_&&w?d+=2:S&&P&&(p+=2);const I=e.slice(-10),C=(I[I.length-1]-I[0])/I.length,M=df(I,I.length),F=C/M*100;F>.15?d+=2:F<-.15&&(p+=2),d>p+1?c="up":p>d+1&&(c="down");const V=d+p,j=V>0?Math.abs(d-p)/V:.5;return{direction:c,strength:Math.min(j,1)}}function KW(n){if(n.length<20)return{value:0,strength:.5};const e=n.map(c=>c.close),t=e5(e,14),o=(t-50)/50,i=(e[e.length-1]-e[e.length-10])/e[e.length-10],r=o*.6+i*10*.4,a=Math.max(-1,Math.min(1,r)),l=Math.abs(t-50)/50;return{value:a,strength:Math.min(l,1)}}function ZW(n){if(n.length<20)return{trend:"stable",relativeCurrent:1};const e=n.map(l=>l.volume||0),t=df(e,Math.min(20,e.length)),o=df(e.slice(-5),5),i=e[e.length-1],r=t>0?i/t:1;let a="stable";return o>t*1.2?a="increasing":o<t*.8&&(a="decreasing"),{trend:a,relativeCurrent:r}}function XW(n,e={}){const t={...WW,...e};if(n.length<10)return console.warn("Not enough historical data for prediction"),null;const o=n.slice(-t.lookbackPeriod),i=o[o.length-1];console.log("🔮 Predicting next candle from",o.length,"candles");const r=YW(o);console.log("📈 Trend:",r);const a=KW(o);console.log("⚡ Momentum:",a);const l=qW(o,14),c=df(o.map(bt=>bt.close),o.length),d=l/c*100;console.log("📊 Volatility (ATR%):",d.toFixed(2));const p=HW(o);console.log("🎯 Support/Resistance:",p);const m=ZW(o);console.log("📦 Volume:",m);const h=UW(o);console.log("🎨 Pattern:",h);const _=GW(o);console.log("🔄 Market Cycle:",_);let w=0;const S=(Math.random()-.5)*.8;w+=S;const P=e5(o.map(bt=>bt.close),14),I=P>70,C=P<30,M=r.strength>.7;let F=.15;if(I&&r.direction==="up"&&(F+=.25),C&&r.direction==="down"&&(F+=.25),M&&(F+=.15),Math.random()<F){console.log("🔄 REVERSAL DETECTED - Creating counter-trend candle");const bt=.5+Math.random()*1.5;r.direction==="up"?w-=bt:r.direction==="down"?w+=bt:w+=(Math.random()>.5?1:-1)*bt}else r.direction==="up"?w+=r.strength*t.trendWeight*1.5:r.direction==="down"?w-=r.strength*t.trendWeight*1.5:w+=(Math.random()-.5)*.6,w+=a.value*a.strength*t.momentumWeight*1.8;if(h.pattern!=="none"){const bt=h.confidence*1.2;h.bullish?w+=bt:w-=bt,console.log(`🎯 Pattern impact: ${h.bullish?"+":"-"}${bt.toFixed(2)}%`)}_.phase==="markup"?w+=_.confidence*.5:_.phase==="markdown"?w-=_.confidence*.5:_.phase==="distribution"?w-=_.confidence*.2:_.phase==="accumulation"&&(w+=_.confidence*.2);const j=Math.min(d/2,2)*t.volatilityWeight;let D=0;const R=i.close;for(const bt of p.resistance)R>=bt*.98&&R<=bt*1.02&&(D-=.5);for(const bt of p.support)R>=bt*.98&&R<=bt*1.02&&(D+=.5);if(w+=D*t.supportResistanceWeight*1.5,m.trend==="increasing"){const bt=t.volumeWeight*.8;(w>0||w<0)&&(w*=1+bt)}else m.trend==="decreasing"&&(w*=.85);const W=(Math.random()-.5)*j*2.5;if(w+=W,Math.random()<.05){const bt=(Math.random()-.5)*3;w+=bt,console.log("📰 Surprise move:",bt.toFixed(2)+"%")}w=Math.max(-6,Math.min(6,w)),console.log("💹 Predicted change:",w.toFixed(2)+"%");const J=R*(w/100),Z=w>0;let G,se,Y,oe;const ee=d>2?.15:.05,me=Math.random()<ee?(Math.random()*.5+.2)*(Z?1:-1):0,K=Math.abs(J),ye=(Math.random()-.5)*.4,Me=K*(1+ye);if(Z){G=R*(1+me/100),oe=G+Me;const bt=Math.random();let nt,Pt;bt<.2?(nt=l*(.05+Math.random()*.15),Pt=l*(.05+Math.random()*.15)):bt<.4?(nt=l*(.4+Math.random()*.5),Pt=l*(.1+Math.random()*.2)):bt<.6?(nt=l*(.05+Math.random()*.15),Pt=l*(.4+Math.random()*.6)):(nt=l*(.15+Math.random()*.35),Pt=l*(.15+Math.random()*.35)),se=oe+nt,Y=G-Pt}else{G=R*(1+me/100),oe=G-Me;const bt=Math.random();let nt,Pt;bt<.2?(nt=l*(.05+Math.random()*.15),Pt=l*(.05+Math.random()*.15)):bt<.4?(nt=l*(.4+Math.random()*.6),Pt=l*(.05+Math.random()*.15)):bt<.6?(nt=l*(.1+Math.random()*.2),Pt=l*(.4+Math.random()*.5)):(nt=l*(.15+Math.random()*.35),Pt=l*(.15+Math.random()*.35)),se=G+nt,Y=oe-Pt}const Fe=r.direction==="sideways"?.15:.05;if(Math.random()<Fe){oe=G+(Math.random()-.5)*l*.1;const bt=l*(.3+Math.random()*.4);se=Math.max(G,oe)+bt,Y=Math.min(G,oe)-bt,console.log("🎲 Created Doji candle (indecision)")}se=Math.max(G,oe,se),Y=Math.min(G,oe,Y);const Ze=df(o.map(bt=>bt.volume||0),20);df(o.slice(-5).map(bt=>bt.volume||0),5);let Ge=Ze;const it=Math.min(Math.abs(w)/2,1.5);Ge*=.8+it*.4,m.trend==="increasing"?Ge*=1.1+Math.random()*.3:m.trend==="decreasing"?Ge*=.7+Math.random()*.2:Ge*=.85+Math.random()*.3,h.pattern==="bullish_engulfing"||h.pattern==="bearish_engulfing"?Ge*=1.2+Math.random()*.3:h.pattern==="doji"&&(Ge*=.7+Math.random()*.2),(_.phase==="distribution"||_.phase==="markdown")&&(Ge*=1.1+Math.random()*.2),Ge=Math.max(Ze*.3,Math.min(Ge,Ze*3));const Ye=o.slice(-5).map((bt,nt,Pt)=>nt>0?bt.timestamp-Pt[nt-1].timestamp:0).filter(bt=>bt>0),ct=Ye.length>0?df(Ye,Ye.length):6e4,ft={timestamp:i.timestamp+ct,open:Math.round(G*100)/100,high:Math.round(se*100)/100,low:Math.round(Y*100)/100,close:Math.round(oe*100)/100,volume:Math.round(Ge)};return console.log("🎯 Predicted candle:",ft),ft}function JW(n,e){return Date.now()-n>e*2}function QW(){var n;try{(n=window.predictNextCandle)==null||n.call(window)}catch{}n0(!0)}function eq(n,e){(!(typeof window<"u")||window.confirm("Exit simulator?"))&&(e(),xw())}function tq(n){const e=parseFloat(n.target.value);fy(e)}var nq=fe('<button class="fc-btn svelte-u36ajg" type="button">Stop</button>'),oq=fe('<button class="fc-btn svelte-u36ajg" type="button">Start</button>'),sq=fe('<div class="floating-controls svelte-u36ajg"><div class="fc-content svelte-u36ajg"><div class="fc-header svelte-u36ajg"><div class="fc-title svelte-u36ajg">Simulator</div> <div class="fc-badge svelte-u36ajg"> </div></div> <div class="fc-row svelte-u36ajg"><input type="range" min="0.5" max="10" step="0.5" class="fc-range svelte-u36ajg"></div> <div class="fc-row svelte-u36ajg"><!> <button class="fc-btn fc-danger svelte-u36ajg" type="button">Exit</button></div></div></div>');function iq(n,e){gd(e,!0);const t=wp(),o=()=>ya(gv,"$simulator",t);let i=ae(20),r=ae(80),a=ae(!1),l=0,c=0;function d(S){const P="touches"in S?S.touches[0]:S;l=P.clientX-s(i),c=P.clientY-s(r),x(a,!0),window.addEventListener("mousemove",p),window.addEventListener("mouseup",m),window.addEventListener("touchmove",p,{passive:!0}),window.addEventListener("touchend",m)}function p(S){if(!s(a))return;const P="touches"in S?S.touches[0]:S;x(i,P.clientX-l),x(r,P.clientY-c)}function m(){x(a,!1),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",m),window.removeEventListener("touchmove",p),window.removeEventListener("touchend",m)}function h(){var S;try{(S=window.stopPrediction)==null||S.call(window)}catch{}n0(!1)}var _=Ln(),w=Dt(_);Te(w,()=>o().mode==="normal",S=>{var P=sq(),I=g(P),C=g(I);C.__mousedown=d,C.__touchstart=d;var M=u(g(C),2),F=g(M);f(M),f(C);var V=u(C,2),j=g(V);Qt(j),j.__input=[tq],f(V);var D=u(V,2),R=g(D);Te(R,()=>o().playing,J=>{var Z=nq();Z.__click=h,z(J,Z)},J=>{var Z=oq();Z.__click=[QW],z(J,Z)});var W=u(R,2);W.__click=[eq,h],f(D),f(I),f(P),Se(()=>{zt(P,"style",`left:${s(i)}px;top:${s(r)}px;`),ze(F,`${o().speed??""}x`),Jd(j,o().speed)}),z(S,P)}),z(n,_),hd()}qu(["mousedown","touchstart","input","click"]);const t5="scriptStudio.scripts";function i0(){try{const n=localStorage.getItem(t5);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch{return[]}}function r0(n){try{localStorage.setItem(t5,JSON.stringify(n))}catch{}}function i_(){return i0()}function U0(n){r0(Array.isArray(n)?n:[])}function r2(n){const e=i0(),t=e.findIndex(o=>o.id===n.id);return t>=0?e[t]={...n,updatedAt:Date.now()}:e.push(n),r0(e),n}function rq(n,e,t){const o=i0(),i=Date.now(),a={id:`${i}`,name:n,code:e,tags:t||[],createdAt:i,updatedAt:i};return o.push(a),r0(o),a}function aq(n,e){const t=i0(),o=t.findIndex(r=>r.id===n);if(o===-1)return null;const i={...t[o],...e,updatedAt:Date.now()};return t[o]=i,r0(t),i}function lq(n){const e=i0(),t=e.filter(o=>o.id!==n);return r0(t),t.length!==e.length}function cq(n){let e="",t=null;for(let o=0;o<n.length;o++){const i=n[o],r=n[o+1];if(t){e+=i,i===t&&n[o-1]!=="\\"&&(t=null);continue}if(i==="'"||i==='"'){t=i,e+=i;continue}if(i==="/"&&r==="/")break;e+=i}return e.replace(/\s+$/,"")}function Ri(n){const e=n.trim();return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}function xr(n){const e=[];let t="",o=0,i=0,r=0,a=null;for(let l=0;l<n.length;l++){const c=n[l];if(a){t+=c,c===a&&n[l-1]!=="\\"&&(a=null);continue}if(c==="'"||c==='"'){a=c,t+=c;continue}if(c==="("){o+=1,t+=c;continue}if(c===")"){o=Math.max(0,o-1),t+=c;continue}if(c==="{"){i+=1,t+=c;continue}if(c==="}"){i=Math.max(0,i-1),t+=c;continue}if(c==="["){r+=1,t+=c;continue}if(c==="]"){r=Math.max(0,r-1),t+=c;continue}if(c===","&&o===0&&i===0&&r===0){e.push(t.trim()),t="";continue}t+=c}return t.trim()&&e.push(t.trim()),e}function Ol(n){const e={};for(const t of n){const o=t.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+)$/);o&&(e[o[1]]=o[2].trim())}return e}function Tg(n){let e=n.trim();return e=e.replace(/\bta\./g,""),e=e.replace(/\bmath\./g,""),e=e.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),e=e.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(t,o,i)=>`${String(o).toLowerCase()}_${i}`),e=(()=>{const t=e;let o="",i=null,r=0;const a=c=>/[A-Za-z_$]/.test(c),l=c=>/[A-Za-z0-9_$]/.test(c);for(;r<t.length;){const c=t[r];if(i){o+=c,c===i&&t[r-1]!=="\\"&&(i=null),r+=1;continue}if(c==="'"||c==='"'){i=c,o+=c,r+=1;continue}if(a(c)){let d=r+1;for(;d<t.length&&l(t[d]);)d+=1;const p=t.slice(r,d);let m=d;for(;m<t.length&&/\s/.test(t[m]);)m+=1;if(t[m]==="["){let h=m+1;for(;h<t.length&&/\s/.test(t[h]);)h+=1;let _=1;t[h]==="-"&&(_=-1,h+=1);let w=h;for(;w<t.length&&/[0-9]/.test(t[w]);)w+=1;const S=t.slice(h,w);for(;w<t.length&&/\s/.test(t[w]);)w+=1;if(S&&t[w]==="]"){const P=_*Number(S);if(Number.isFinite(P)&&P>=1){o+=`prev(${p}, ${Math.floor(P)})`,r=w+1;continue}if(Number.isFinite(P)&&P===0){o+=p,r=w+1;continue}}}o+=p,r=d;continue}o+=c,r+=1}return o})(),e}function Dv(n){let e=Tg(n);return e=e.replace(/\bcrossover\s*\(/gi,"crossover("),e=e.replace(/\bcrossunder\s*\(/gi,"crossunder("),e}function wc(n){return/^[A-Za-z_$][A-Za-z0-9_$]*\s*=/.test(n.trim())}function sm(n){const e=n.trim().toLowerCase();return e==="true"?!0:e==="false"?!1:null}function bp(n){const e=n.trim();if(!/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/.test(e))return null;const t=Number(e);return Number.isFinite(t)?t:null}function dq(n){const e=Ri(String(n||"").trim()).toLowerCase();return e?e==="background"||e==="bg"?"background":e==="main"||e==="base"?"main":e==="overlay"||e==="over"?"overlay":e==="ui"?"ui":null:null}function em(n){if(n!=null)return dq(n)??void 0}function tm(n){if(n==null)return;const e=bp(Ri(String(n)));return e??void 0}function nm(n){if(n==null)return;const e=Ri(String(n)),t=sm(e);if(t!=null)return t;const o=bp(e);if(o!=null)return o!==0}function uq(n){const e=String(n||"").trim().match(/^timestamp\s*\((.*)\)\s*$/i);if(!e)return null;const t=xr(e[1]||"");if(!t.length)return null;const o=P=>{const I=bp(Ri(P));return I??null};let i=0,r=0;const a=Ri(String(t[0]||"")).trim(),l=o(a);if(a&&l==null){const I=a.toUpperCase().match(/^(GMT|UTC)([+-]\d{1,2})?$/);if(I){const C=I[2]?Number(I[2]):0;Number.isFinite(C)&&(r=C*60),i=1}else{const C=Date.parse(a);return Number.isFinite(C)?C:null}}const c=o(t[i]||"");if(c==null)return null;const d=o(t[i+1]||"1")??1,p=o(t[i+2]||"1")??1,m=o(t[i+3]||"0")??0,h=o(t[i+4]||"0")??0,_=o(t[i+5]||"0")??0,w=o(t[i+6]||"0")??0,S=Date.UTC(c,Math.max(0,d-1),p,m,h,_,w);return Number.isFinite(S)?S-r*60*1e3:null}function a2(n){const e=Ri(String(n||"").trim());if(!e)return;if(e.startsWith("#")||e.startsWith("rgb"))return e;const t=e.toLowerCase();if(t==="color.green"||t==="green")return"#16a34a";if(t==="color.red"||t==="red")return"#ef4444";if(t==="color.orange"||t==="orange")return"#f59e0b";if(t==="color.blue"||t==="blue")return"#3b82f6";if(t==="color.gray"||t==="gray"||t==="grey")return"#64748b";if(t==="color.white"||t==="white")return"#e2e8f0";if(t==="color.black"||t==="black")return"#0b1220"}function Ug(n,e){if(!n||e==null||!Number.isFinite(e))return n;const t=Math.max(0,Math.min(100,e)),o=Math.max(0,Math.min(1,1-t/100)),i=n.trim();if(i.startsWith("#")){const a=i.slice(1),l=a.length===3?a.split("").map(c=>c+c).join(""):a.length===6?a:"";if(l){const c=parseInt(l.slice(0,2),16),d=parseInt(l.slice(2,4),16),p=parseInt(l.slice(4,6),16);if(Number.isFinite(c)&&Number.isFinite(d)&&Number.isFinite(p))return`rgba(${c},${d},${p},${o})`}}const r=i.match(/^rgba?\((.*)\)$/i);if(r){const a=r[1].split(",").map(l=>l.trim());if(a.length>=3){const l=Number(a[0]),c=Number(a[1]),d=Number(a[2]),p=a.length>=4?Number(a[3]):1;if([l,c,d,p].every(m=>Number.isFinite(m))){const m=Math.max(0,Math.min(1,p*o));return`rgba(${l},${c},${d},${m})`}}}return n}function pq(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^shape\./,"").replace(/^label\./,"");if(t.includes("triangleup"))return"triangle_up_filled";if(t.includes("triangledown"))return"triangle_down_filled";if(t.includes("arrowup"))return"arrowUp";if(t.includes("arrowdown"))return"arrowDown";if(t.includes("circle"))return"circle";if(t.includes("square"))return"square";if(t.includes("label"))return"label"}function l2(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^label\./,"");return t.includes("up")?"triangle_up_filled":t.includes("down")?"triangle_down_filled":t.includes("circle")?"circle":t.includes("square")?"square":t.includes("none")?"text":"label"}function Fh(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^size\./,"");if(t==="tiny")return 10;if(t==="small")return 12;if(t==="normal")return 14;if(t==="large")return 18;if(t==="huge")return 22;const o=bp(Ri(e));if(o!=null)return Math.max(6,Math.min(64,o))}function om(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^line\./,"");if(t.includes("dashed"))return"dashed";if(t.includes("dotted"))return"dotted";if(t.includes("solid"))return"solid"}function $h(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^extend\./,"");if(t.includes("right"))return"right";if(t.includes("left"))return"left";if(t.includes("both"))return"both";if(t.includes("none"))return"none"}function Sf(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^xloc\./,"");if(t.includes("bar_time")||t.includes("bartime")||t.includes("time"))return"time";if(t.includes("bar_index")||t.includes("barindex"))return"bar_index"}function pg(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^yloc\./,"");if(t.includes("above"))return"abovebar";if(t.includes("below"))return"belowbar";if(t.includes("price"))return"price"}function Sm(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^text\./,"").replace(/^align_/,"");if(t.includes("left"))return"left";if(t.includes("right"))return"right";if(t.includes("center")||t.includes("middle"))return"center"}function Gg(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^text\./,"").replace(/^align_/,"");if(t.includes("top"))return"top";if(t.includes("bottom"))return"bottom";if(t.includes("center")||t.includes("middle"))return"middle"}function c2(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^position\./,"");if(t.includes("top_left"))return"top_left";if(t.includes("top_right"))return"top_right";if(t.includes("top_center"))return"top_center";if(t.includes("bottom_left"))return"bottom_left";if(t.includes("bottom_right"))return"bottom_right";if(t.includes("bottom_center"))return"bottom_center";if(t.includes("middle_center")||t.includes("center"))return"middle_center"}function d2(n){const e=String(n||"").trim().toLowerCase();if(e){if(e.includes("on"))return"on";if(e.includes("off"))return"off"}}function u2(n){const e=String(n||"").toLowerCase().replace(/\s+/g,"");if(e){if(e.includes("onceperbarclose")||e.includes("perbarclose")||e.includes("barclose"))return"once_per_bar_close";if(e.includes("onceperbar")||e.includes("perbar")||e.includes("all"))return"once_per_bar";if(e.includes("once"))return"once"}}function p2(n){const e=String(n||"").trim(),t=e.match(/^(?:request\.)?security(?:_lower_tf)?\s*\((.*)\)\s*$/i);if(!t)return null;const o=e.toLowerCase().startsWith("request.security_lower_tf")||e.toLowerCase().startsWith("security_lower_tf"),i=xr(t[1]||"");if(i.length<2)return null;const r=Ol(i),a=i.filter(P=>!wc(P)),l=a[0]!=null?String(a[0]).trim():"",c=Ri(l),d=c&&c.toLowerCase()==="syminfo.tickerid"?"syminfo.tickerid":!(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(c)&&!/^\d+$/.test(c)?`\${${c}}`:c,p=a[1]!=null?String(a[1]).trim():"",m=Ri(p),h=m&&m.toLowerCase()==="timeframe.period"?"__CURRENT__":!(p.startsWith('"')&&p.endsWith('"')||p.startsWith("'")&&p.endsWith("'"))&&/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(m)&&!/^\d+$/.test(m)?`\${${m}}`:m,_=a[2]!=null?Tg(String(a[2])):"close",w=d2(String(r.lookahead??""))??(String(r.lookahead??"").toLowerCase().includes("lookahead_on")?"on":String(r.lookahead??"").toLowerCase().includes("lookahead_off")?"off":void 0),S=d2(String(r.gaps??""))??(String(r.gaps??"").toLowerCase().includes("gaps_on")?"on":String(r.gaps??"").toLowerCase().includes("gaps_off")?"off":void 0);return{symbol:d,country:r.country!=null?Ri(String(r.country)):void 0,timeframe:h||"__CURRENT__",expr:_||"close",lookahead:w,gaps:S,lower:o}}function g_(n){var mi,Na;const e=[],t=[],o=le=>{let we=0;for(let H=0;H<le.length;H++){const ne=le[H];if(ne===" ")we+=1;else if(ne==="	")we+=2;else break}return we},i=le=>{let we=0,H=null;for(let ne=0;ne<le.length;ne++){const _e=le[ne];if(H){_e===H&&le[ne-1]!=="\\"&&(H=null);continue}if(_e==="'"||_e==='"'){H=_e;continue}_e==="("?we+=1:_e===")"&&(we-=1)}return we},r=le=>{const we=String(le||"").split(/\r?\n/),H=[];let ne="",_e=1,q=0,De=0;for(let ot=0;ot<we.length;ot++){const je=ot+1,Ft=cq(we[ot]||""),Be=Ft.trim();Be&&(ne||(_e=je,De=o(Ft)),ne=ne?`${ne} ${Be}`:Be,q+=i(Be),q<=0&&(H.push({text:ne.trim(),indent:De,lineNo:_e,loopSeq:!1}),ne="",q=0,De=0))}return ne.trim()&&H.push({text:ne.trim(),indent:De,lineNo:_e,loopSeq:!1}),H};let a=r(n);const l=le=>{const we=Ri(String(le||"").trim());if(!we)return null;const H=we.split("/").filter(Boolean);if(!H.length)return null;for(let ne=H.length-1;ne>=0;ne--){const _e=H[ne];if(!/^\d+$/.test(_e))return _e}return H[0]||null},c=le=>le.replace(/^\s*export\s+/i,""),d=(le,we)=>{const H=[];let ne=0,_e=null;const q=ot=>/[A-Za-z_$]/.test(ot),De=ot=>/[A-Za-z0-9_$]/.test(ot);for(;ne<le.length;){const ot=le[ne];if(_e){H.push(ot),ot===_e&&le[ne-1]!=="\\"&&(_e=null),ne+=1;continue}if(ot==="'"||ot==='"'){_e=ot,H.push(ot),ne+=1;continue}if(q(ot)){let je=ne+1;for(;je<le.length&&De(le[je]);)je+=1;const Ft=le.slice(ne,je);H.push(we[Ft]||Ft),ne=je;continue}H.push(ot),ne+=1}return H.join("")},p=le=>{const we=le.toLowerCase();return!!(/tradingview\/ta(\/|$)/.test(we)||/tradingview\/math(\/|$)/.test(we)||/tradingview\/str(\/|$)/.test(we))},m=le=>{const we=Ri(String(le||"").trim());if(!we)return{error:"import path is empty"};if(typeof window>"u")return{error:`import "${we}" is only supported in browser (local library cache)`};const H=i_(),ne=ot=>{if(typeof ot=="string"){const je=ot.trim();if(je.startsWith("{")&&je.includes('"script"')){try{const Be=JSON.parse(je);if(Be&&typeof Be=="object"&&typeof Be.script=="string")return Be.script}catch{}const Ft=je.match(/"script"\s*:\s*"([\s\S]*?)"\s*,\s*"(?:name|userPreferenceId|createdAt)"/);if(Ft&&Ft[1])try{return JSON.parse(`"${Ft[1]}"`)}catch{}}return ot}if(ot&&typeof ot=="object"){const je=ot.script??ot.code;if(typeof je=="string")return je}return String(ot||"")},_e=l(we)||we,q=ot=>H.filter(je=>je.name===ot).sort((je,Ft)=>(Ft.updatedAt||0)-(je.updatedAt||0))[0],De=q(we)||q(_e);return De?{code:ne(De.code),name:De.name}:{error:`library "${we}" not found in saved scripts`}},h=le=>{const we=/^\s*export\s+/i.test(le),H=c(le).trim();if(!H||/^(import|library|indicator|study|strategy)\b/i.test(H))return null;const ne=H.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*\((.*)\)\s*=>/);if(ne)return{name:ne[1],exported:we};const _e=H.match(/^(?:varip\s+|var\s+)?(?:(?:float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)/i);return _e?{name:_e[1],exported:we}:null},_=(le,we,H,ne,_e)=>{if(ne>6)return e.push({message:`import "${we}" exceeded max depth`,line:1}),{lines:[],exports:new Set};const q=r(le),De=[],ot=new Set,je=new Set;let Ft=!1;for(const be of q){const tt=be.text.trim(),wt=tt.match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i);if(wt){const qt=wt[1]||"",qn=wt[2]||l(qt)||"";qn&&De.push({path:qt,alias:qn,lineNo:be.lineNo});continue}if(/^library\s*\(/i.test(tt))continue;const Lt=h(tt);Lt&&(ot.add(Lt.name),Lt.exported&&(je.add(Lt.name),Ft=!0))}const Be=Ft?je:new Set(ot),xt={},an=[];for(const be of De){const tt=be.alias,wt=Ri(be.path);if(!tt){e.push({message:`import "${wt}" needs an alias`,line:be.lineNo});continue}if(p(wt)){xt[tt]="";continue}if(_e.includes(wt)){e.push({message:`cyclic import detected: ${_e.join(" -> ")} -> ${wt}`,line:be.lineNo});continue}const Lt=m(wt);if(Lt.error||!Lt.code){e.push({message:Lt.error||`library "${wt}" not found`,line:be.lineNo});continue}const qt=`${H}${tt}__`;xt[tt]=qt;const qn=_(Lt.code,tt,qt,ne+1,[..._e,wt]);an.push(...qn.lines)}const Yn={};ot.forEach(be=>{Yn[be]=`${H}${be}`});const bn=[];for(const be of q){const tt=be.text.trim();if(!tt||/^import\b/i.test(tt)||/^library\s*\(/i.test(tt))continue;let wt=c(be.text);Object.entries(xt).forEach(([Lt,qt])=>{if(!Lt)return;const qn=new RegExp(`\\b${Lt}\\.`,"gi");wt=wt.replace(qn,qt)}),wt=d(wt,Yn),bn.push({...be,text:wt})}return{lines:[...an,...bn],exports:Be}},w={},S=[],P=[];for(const le of a){const H=le.text.trim().match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i);if(H){const ne=H[1]||"",_e=H[2]||l(ne)||"",q=Ri(ne);if(!_e){e.push({message:`import "${q}" needs an alias`,line:le.lineNo});continue}if(w[_e]){e.push({message:`import alias "${_e}" already used`,line:le.lineNo});continue}if(p(q)){w[_e]={replacement:"",exports:new Set};continue}const De=m(q);if(De.error||!De.code){e.push({message:De.error||`library "${q}" not found`,line:le.lineNo});continue}const ot=`__lib_${_e}__`,je=_(De.code,_e,ot,1,[q]);S.push(...je.lines),w[_e]={replacement:ot,exports:je.exports};continue}P.push(le)}a=[...S,...P];let I="main";for(const le of a){const we=le.text.trim().match(/^(indicator|study)\s*\((.*)\)\s*$/i);if(!we)continue;const H=xr(we[2]||""),_e=Ol(H).overlay;if(_e!=null){const q=sm(Ri(String(_e)));q==null?e.push({message:"indicator overlay must be true or false",line:le.lineNo}):I=q?"main":"sub"}else I="sub";break}const C=[{pane:"main",plots:[],labels:[],levels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],overlays:[],fills:[],backgroundZones:[]}],M=[],F=[],V={},j=[],D=[],R={},W=[],J={},Z={};let G=null;const se={},Y={},oe={},ee={},re={},me={};let K=0;const ye=(le,we)=>{const H=we.replace(/[^A-Za-z0-9_]+/g,"_").toLowerCase(),ne=H?`__sec_${H}`:"__sec";let _e=ne,q=1;const De=ot=>M.some(je=>String((je==null?void 0:je.name)||"").toLowerCase()===ot.toLowerCase())||j.some(je=>String((je==null?void 0:je.name)||"").toLowerCase()===ot.toLowerCase());for(;De(_e);)q+=1,_e=`${ne}_${q}`;return j.push({name:_e,type:"security",symbol:le.symbol,country:le.country,timeframe:le.timeframe,expr:le.expr,lookahead:le.lookahead,gaps:le.gaps,lower:le.lower}),_e},Me=(le,we)=>{const H=String(le||"");let ne="",_e=0,q=null;const De=H.toLowerCase();for(;_e<H.length;){const ot=H[_e];if(q){ne+=ot,ot===q&&H[_e-1]!=="\\"&&(q=null),_e+=1;continue}if(ot==="'"||ot==='"'){q=ot,ne+=ot,_e+=1;continue}const je=De.slice(_e),Ft=je.startsWith("request.security_lower_tf"),Be=!Ft&&je.startsWith("request.security"),xt=!Ft&&!Be&&je.startsWith("security_lower_tf")&&(_e===0||!/[a-z0-9_$]/i.test(De[_e-1]||"")),an=!Ft&&!Be&&!xt&&je.startsWith("security")&&(_e===0||!/[a-z0-9_$]/i.test(De[_e-1]||""));if(Ft||Be||xt||an){let bn=_e+(Ft?25:Be?16:xt?17:8);for(;bn<H.length&&/\s/.test(H[bn]);)bn+=1;if(H[bn]!=="("){ne+=ot,_e+=1;continue}let be=0,tt=bn,wt=null;for(;tt<H.length;tt++){const Xt=H[tt];if(wt){Xt===wt&&H[tt-1]!=="\\"&&(wt=null);continue}if(Xt==="'"||Xt==='"'){wt=Xt;continue}if(Xt==="(")be+=1;else if(Xt===")"&&(be-=1,be===0))break}if(tt>=H.length){ne+=H.slice(_e);break}const Lt=H.slice(_e,tt+1),qt=p2(Lt);if(!qt){ne+=Lt,_e=tt+1;continue}K+=1;const qn=ye(qt,`${we}_${K}`);ne+=qn,_e=tt+1;continue}ne+=ot,_e+=1}return ne};if(!/(^\s*\/\/@\s*pine)|(^\s*\/\/@\s*version)|\b(strategy|indicator|study)\s*\(/m.test(n))return{ok:!1,errors:[{message:"Not a Pine-like script",line:1}]};const Ze=()=>{C.some(le=>le.pane==="sub")||C.push({pane:"sub",plots:[],labels:[],levels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],overlays:[],fills:[],backgroundZones:[]})},Ge=le=>(le==="sub"&&Ze(),C.find(we=>we.pane===le)||C[0]),it=le=>{const we=String(le||"").trim();return!we||/[+\-*/%]/.test(we)?!1:!!(/\b(crossover|crossunder|between|above|below)\s*\(/i.test(we)||/\bcrosses(Above|Below)\b/i.test(we)||/[<>]=?|==|!=/.test(we)||/\b(and|or|not)\b/i.test(we)||/^\s*true\s*$|^\s*false\s*$/i.test(we))},Ye=le=>String(le||"").trim().replace(/\s+/g,"_").toLowerCase(),ct=(le,we)=>{let H="",ne=null;for(let _e=0;_e<le.length;_e++){const q=le[_e];if(ne){H+=q,q===ne&&le[_e-1]!=="\\"&&(ne=null);continue}if(q==="'"||q==='"'){ne=q,H+=q;continue}if(/[A-Za-z_$]/.test(q)){let De=_e+1;for(;De<le.length&&/[A-Za-z0-9_$]/.test(le[De]);)De+=1;const ot=le.slice(_e,De),je=we[ot];H+=je??ot,_e=De-1;continue}H+=q}return H},kt=(le,we)=>{let H=String(le||"");for(let ne=0;ne<8;ne++){let _e=!1,q="",De=0,ot=null;for(;De<H.length;){const je=H[De];if(ot){q+=je,je===ot&&H[De-1]!=="\\"&&(ot=null),De+=1;continue}if(je==="'"||je==='"'){ot=je,q+=je,De+=1;continue}if(/[A-Za-z_$]/.test(je)){let Ft=De+1;for(;Ft<H.length&&/[A-Za-z0-9_$]/.test(H[Ft]);)Ft+=1;const Be=H.slice(De,Ft);let xt=Ft;for(;xt<H.length&&/\s/.test(H[xt]);)xt+=1;if(H[xt]==="("){const an=se[Ye(Be)];if(an){let Yn=0,bn=xt,be=null;for(;bn<H.length;bn++){const tt=H[bn];if(be){tt===be&&H[bn-1]!=="\\"&&(be=null);continue}if(tt==="'"||tt==='"'){be=tt;continue}if(tt==="(")Yn+=1;else if(tt===")"&&(Yn-=1,Yn===0))break}if(bn<H.length&&H[bn]===")"){const tt=H.slice(xt+1,bn),wt=xr(tt),Lt={};for(let qn=0;qn<an.args.length;qn++){const Xt=an.args[qn],vo=wt[qn]!=null?String(wt[qn]).trim():"na";Lt[Xt]=Tg(Me(vo,`${we}_${an.name}`))}const qt=ct(an.body,Lt);q+=`(${qt})`,De=bn+1,_e=!0;continue}}}q+=Be,De=Ft;continue}q+=je,De+=1}if(!_e)return H;H=q}return t.push({message:`User function expansion reached max depth while processing "${we}".`,line:1}),H},ft=le=>String(le||"").replace(/\barray\.size\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\)/gi,(we,H)=>{const ne=Ye(String(H)),_e=ee[ne];if(_e!=null&&_e.dynamic)return we;const q=Y[ne],De=oe[ne],ot=(_e==null?void 0:_e.size)??(q==null?void 0:q.length)??(De==null?void 0:De.length);return Number.isFinite(ot)?String(ot):we}),bt=le=>{switch(le.kind){case"NumberLiteral":return le.value;case"Identifier":{const we=Ye(le.name);if(we==="true")return 1;if(we==="false")return 0;if(we==="na"||we==="nan")return NaN;const H=R[we]??R[le.name],ne=typeof H=="number"?H:Number(H);return Number.isFinite(ne)?ne:null}case"UnaryExpression":{if(le.operator!=="not")return null;const we=bt(le.expr);return we==null?null:Number.isFinite(we)&&we!==0?0:1}case"BinaryExpression":{const we=bt(le.left),H=bt(le.right);if(we==null||H==null)return null;switch(le.operator){case"+":return we+H;case"-":return we-H;case"*":return we*H;case"/":return H===0?NaN:we/H;case"%":return H===0?NaN:we%H;case">":return Number.isFinite(we)&&Number.isFinite(H)&&we>H?1:0;case"<":return Number.isFinite(we)&&Number.isFinite(H)&&we<H?1:0;case">=":return Number.isFinite(we)&&Number.isFinite(H)&&we>=H?1:0;case"<=":return Number.isFinite(we)&&Number.isFinite(H)&&we<=H?1:0;case"==":return Number.isFinite(we)&&Number.isFinite(H)&&Math.abs(we-H)<1e-9?1:0;case"!=":return Number.isFinite(we)&&Number.isFinite(H)&&Math.abs(we-H)>=1e-9?1:0;case"and":return Number.isFinite(we)&&we!==0&&Number.isFinite(H)&&H!==0?1:0;case"or":return Number.isFinite(we)&&we!==0||Number.isFinite(H)&&H!==0?1:0;default:return null}}case"CallExpression":{const we=le.callee.toLowerCase();if(we==="iff"&&le.args.length===3){const q=bt(le.args[0]);return q==null?null:bt(q!==0?le.args[1]:le.args[2])}const H=le.args.map(q=>bt(q));if(H.some(q=>q==null))return null;const ne=H[0],_e=H[1];switch(we){case"min":return Math.min(ne,_e);case"max":return Math.max(ne,_e);case"abs":return Math.abs(ne);case"ceil":return Math.ceil(ne);case"floor":return Math.floor(ne);case"round":return Math.round(ne);case"sqrt":return Math.sqrt(ne);case"pow":return Math.pow(ne,_e);default:return null}}default:return null}},nt=le=>{const we=Ri(String(le||"").trim());if(!we)return null;const H=we.match(/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g)||[];for(const je of H){const Ft=Ye(je);if(J[Ft])return null}const ne=bp(we);if(ne!=null)return ne;const _e=Ye(we),q=R[_e]??R[we],De=typeof q=="number"?q:Number(q);if(Number.isFinite(De))return De;const ot=ft(Tg(we));try{const je=Tf(ot),Ft=bt(je);return Number.isFinite(Ft)?Ft:null}catch{return null}},Pt=le=>{const we=Ri(String(le||"").trim());if(!we)return null;const H=bp(we);if(H!=null)return H;const ne=Ye(we),_e=R[ne]??R[we],q=typeof _e=="number"?_e:Number(_e);if(Number.isFinite(q))return q;const De=ft(Tg(we));try{const ot=Tf(De),je=bt(ot);return Number.isFinite(je)?je:null}catch{return null}},Qe=32,yt=1024,xe=256,Ve=(le,we)=>`__arr_${le}_${we}`,Je=le=>`__arr_${le}__size`,St=le=>{const we=Ye(le),H=oe[we];if(H)for(let ne=0;ne<H.length;ne++)R[Ve(we,ne)]=H[ne]??""},Ne=(le,we)=>{const H=Je(le),ne=V[H];if(typeof ne=="number")return F[ne].initExpr||(F[ne].initExpr=String(we)),H;const _e=F.length;return V[H]=_e,F.push({name:H,initExpr:String(we),updateExpr:H,selfMode:"current"}),H},ue=(le,we,H,ne)=>{const _e=Ye(le),q=Math.max(0,Math.floor(we)),De=ee[_e],ot=ne??q,je=Math.min(yt,Math.max((De==null?void 0:De.capacity)??0,Math.floor(ot))),Ft=Ne(_e,Math.max((De==null?void 0:De.size)??0,q)),Be=De?De.elements.slice():[];for(let xt=Be.length;xt<je;xt++){const an=Ve(_e,xt);if(Be.push(an),an in V){if(H&&H[xt]!=null){const Yn=V[an];F[Yn].initExpr||(F[Yn].initExpr=String(H[xt]))}}else{const Yn=F.length;V[an]=Yn;const bn=H&&H[xt]!=null?String(H[xt]):void 0;F.push({name:an,initExpr:bn,updateExpr:an,selfMode:"current"})}}return ee[_e]={size:Math.max((De==null?void 0:De.size)??0,q),capacity:je,elements:Be,sizeSeries:Ft,dynamic:(De==null?void 0:De.dynamic)??!1},{key:_e,elements:Be}},he=(le,we)=>{const H=Ye(le),ne=ee[H];ne&&(ne.capacity>=we||ue(H,ne.size,void 0,we))},_t=(le,we)=>{var q,De,ot,je;const H=nt(we);if(H==null)return null;const ne=Math.floor(H),_e=((q=ee[le])==null?void 0:q.capacity)??((De=ee[le])==null?void 0:De.size)??((ot=Y[le])==null?void 0:ot.length)??((je=oe[le])==null?void 0:je.length)??0;return ne<0||_e<=0||ne>=_e?null:ne},Wt=(le,we)=>{const H=Y[le],ne=oe[le],_e=ee[le],q=(_e==null?void 0:_e.capacity)??(_e==null?void 0:_e.size)??(H==null?void 0:H.length)??(ne==null?void 0:ne.length)??0;if(!q)return null;if(ne&&!_e){const je=String(ne.length);let Ft='""';for(let Be=q-1;Be>=0;Be--){const xt=je?`(${je}) > ${Be}`:"1",an=JSON.stringify(ne[Be]??"");Ft=`iff(((${we}) == ${Be}) and (${xt}), ${an}, ${Ft})`}return Ft}ue(le,(_e==null?void 0:_e.size)??q,H,q);const De=_e!=null&&_e.dynamic?_e.sizeSeries:String((_e==null?void 0:_e.size)??(H==null?void 0:H.length)??q);let ot="na";for(let je=q-1;je>=0;je--){const Ft=De?`(${De}) > ${je}`:"1";ot=`iff(((${we}) == ${je}) and (${Ft}), ${Ve(le,je)}, ${ot})`}return ot},jt=(le,we,H,ne)=>{const _e=Y[le],q=ee[le],De=(q==null?void 0:q.capacity)??(q==null?void 0:q.size)??(_e==null?void 0:_e.length)??0;if(!De)return null;ue(le,(q==null?void 0:q.size)??De,_e,De);const ot=[];for(let je=0;je<De;je++){const Ft=ne?`(${ne}) and `:"";ot.push(`iff(${Ft}(${we}) == ${je}, ${H}, ${Ve(le,je)})`)}return ot},Zt=le=>String(le||"").replace(/\barray\.size\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\)/gi,(we,H)=>{const ne=Ye(String(H)),_e=ee[ne];if(_e)return _e.sizeSeries;const q=Y[ne];return q?String(q.length):we}),dn=(le,we,H)=>{const ne=ee[H],_e=Y[H],q=(ne==null?void 0:ne.capacity)??(ne==null?void 0:ne.size)??(_e==null?void 0:_e.length)??0;if(!q)return null;const De=`array.size(${we})`,ot=(Be,xt)=>{const an=`array.get(${we}, ${Be})`,Yn=xt?`(${an} * ${an})`:an;return`iff(${De} > ${Be}, ${Yn}, 0)`};if(le==="sum"||le==="avg"||le==="stdev"){let Be=ot(0,!1);for(let bn=1;bn<q;bn++)Be=`(${Be} + ${ot(bn,!1)})`;if(le==="sum")return Be;if(le==="avg")return`iff(${De} > 0, (${Be}) / ${De}, na)`;let xt=ot(0,!0);for(let bn=1;bn<q;bn++)xt=`(${xt} + ${ot(bn,!0)})`;const an=`iff(${De} > 0, (${Be}) / ${De}, na)`;return`sqrt(max(${`iff(${De} > 0, (${xt}) / ${De} - (${an} * ${an}), na)`}, 0))`}const je=le==="min"?"1000000000000":"-1000000000000";let Ft=`iff(${De} > 0, array.get(${we}, 0), ${je})`;for(let Be=1;Be<q;Be++){const xt=`iff(${De} > ${Be}, array.get(${we}, ${Be}), ${je})`;Ft=`${le}(${Ft}, ${xt})`}return Ft},zn=le=>{const we=String(le||"");let H="",ne=0,_e=null;const q=we.toLowerCase(),De=ot=>/[a-z0-9_$]/i.test(ot);for(;ne<we.length;){const ot=we[ne];if(_e){H+=ot,ot===_e&&we[ne-1]!=="\\"&&(_e=null),ne+=1;continue}if(ot==="'"||ot==='"'){_e=ot,H+=ot,ne+=1;continue}const je=q.slice(ne).match(/^array\.(sum|min|max|avg|stdev)\b/);if(!je||ne>0&&De(q[ne-1]||"")){H+=ot,ne+=1;continue}const Ft=String(je[1]||"").toLowerCase();let Be=ne+je[0].length;for(;Be<we.length&&/\s/.test(we[Be]);)Be+=1;if(we[Be]!=="("){H+=ot,ne+=1;continue}let xt=0,an=Be,Yn=null;for(;an<we.length;an++){const qt=we[an];if(Yn){qt===Yn&&we[an-1]!=="\\"&&(Yn=null);continue}if(qt==="'"||qt==='"'){Yn=qt;continue}if(qt==="(")xt+=1;else if(qt===")"&&(xt-=1,xt===0))break}if(an>=we.length){H+=we.slice(ne);break}const bn=we.slice(Be+1,an),be=xr(bn),tt=String(be[0]||"").trim();if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(tt)){H+=we.slice(ne,an+1),ne=an+1;continue}const wt=Ye(tt),Lt=dn(Ft,tt,wt);if(!Lt){H+=we.slice(ne,an+1),ne=an+1;continue}H+=`(${Lt})`,ne=an+1}return H},un=le=>{const we=ee[le];we&&(we.dynamic=!0)},On=(le,we,H,ne)=>{const _e=ee[le];if(!_e)return null;const q=_e.sizeSeries,De=q,ot=_e.capacity,je=[],Ft=Be=>{Be.forEach((xt,an)=>{je.push({name:Ve(le,an),hasVar:!1,declaredType:"",op:":=",rhs:xt,lineNo:ne})})};if(we==="push"){const Be=So(String(H.value||"na"),`${le}_push`),xt=`(${De}) < ${ot}`,an=jt(le,De,Be,xt);return an&&Ft(an),je.push({name:q,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${xt}, min(${q} + 1, ${ot}), ${q})`,lineNo:ne}),je}if(we==="pop")return je.push({name:q,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${q} > 0, max(${q} - 1, 0), ${q})`,lineNo:ne}),je;if(we==="clear")return je.push({name:q,hasVar:!1,declaredType:"",op:":=",rhs:"0",lineNo:ne}),je;if(we==="resize"){const Be=So(String(H.size||"0"),`${le}_resize`);return je.push({name:q,hasVar:!1,declaredType:"",op:":=",rhs:`min(max(0, ${Be}), ${ot})`,lineNo:ne}),je}if(we==="shift"||we==="remove"){const Be=we==="shift"?"0":So(String(H.index||"0"),`${le}_remove`),xt=`(${Be}) >= 0 and (${Be}) < ${De}`,an=[];for(let Yn=0;Yn<ot;Yn++){const bn=Yn<ot-1?`(${xt}) and (${Yn} >= (${Be})) and (${Yn} < (${De} - 1))`:"0",be=Yn<ot-1?Ve(le,Yn+1):Ve(le,Yn);an.push(`iff(${bn}, ${be}, ${Ve(le,Yn)})`)}return Ft(an),je.push({name:q,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${xt}, max(${q} - 1, 0), ${q})`,lineNo:ne}),je}if(we==="unshift"||we==="insert"){const Be=we==="unshift"?"0":So(String(H.index||"0"),`${le}_insert`),xt=So(String(H.value||"na"),`${le}_insert_val`),an=`(${prevSize}) < ${ot}`,Yn=`(${Be}) >= 0 and (${Be}) <= ${De}`,bn=[];for(let be=0;be<ot;be++){const tt=`(${be} == (${Be}))`,wt=`(${be} > (${Be})) and (${be} <= ${De})`,Lt=be>0?Ve(le,be-1):Ve(le,be);bn.push(`iff(${an} and ${Yn} and ${tt}, ${xt}, iff(${an} and ${Yn} and ${wt}, ${Lt}, ${Ve(le,be)}))`)}return Ft(bn),je.push({name:q,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${an} and ${Yn}, min(${q} + 1, ${ot}), ${q})`,lineNo:ne}),je}return null},no=(le,we,H)=>{const ne=ee[we];if(!ne)return null;ue(le,ne.size,void 0,ne.capacity);const _e=ee[le];if(!_e)return null;const q=[];for(let De=0;De<_e.capacity;De++)q.push({name:Ve(le,De),hasVar:!1,declaredType:"",op:":=",rhs:Ve(we,De),lineNo:H});return q.push({name:_e.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:ne.sizeSeries,lineNo:H}),q},fs=(le,we,H,ne)=>{const _e=ee[we],q=ee[H];if(!_e||!q)return null;const De=Math.min(yt,_e.capacity+q.capacity);ue(le,Math.min(De,_e.size+q.size),void 0,De);const ot=ee[le];if(!ot)return null;const je=[];for(let Ft=0;Ft<ot.capacity;Ft++){const Be=`iff(${Ft} < ${_e.sizeSeries}, array.get(${we}, ${Ft}), iff(${Ft} < (${_e.sizeSeries} + ${q.sizeSeries}), array.get(${H}, ${Ft} - ${_e.sizeSeries}), na))`;je.push({name:Ve(le,Ft),hasVar:!1,declaredType:"",op:":=",rhs:So(Be,`${le}_concat_${Ft}`),lineNo:ne})}return je.push({name:ot.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:`min(${_e.sizeSeries} + ${q.sizeSeries}, ${De})`,lineNo:ne}),un(le),je},ps=le=>{const we=String(le||"");let H="",ne=0,_e=null;const q=we.toLowerCase();for(;ne<we.length;){const De=we[ne];if(_e){H+=De,De===_e&&we[ne-1]!=="\\"&&(_e=null),ne+=1;continue}if(De==="'"||De==='"'){_e=De,H+=De,ne+=1;continue}if(!(q.startsWith("array.get",ne)&&(ne===0||!/[a-z0-9_$]/i.test(q[ne-1]||"")))){H+=De,ne+=1;continue}let je=ne+9;for(;je<we.length&&/\s/.test(we[je]);)je+=1;if(we[je]!=="("){H+=De,ne+=1;continue}let Ft=0,Be=je,xt=null;for(;Be<we.length;Be++){const co=we[Be];if(xt){co===xt&&we[Be-1]!=="\\"&&(xt=null);continue}if(co==="'"||co==='"'){xt=co;continue}if(co==="(")Ft+=1;else if(co===")"&&(Ft-=1,Ft===0))break}if(Be>=we.length){H+=we.slice(ne);break}const an=we.slice(je+1,Be),Yn=xr(an),bn=String(Yn[0]||"").trim(),be=String(Yn[1]||"").trim();if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(bn)||!be){H+=we.slice(ne,Be+1),ne=Be+1;continue}const tt=Ye(bn),wt=Y[tt],Lt=oe[tt],qt=ee[tt];if(!((qt==null?void 0:qt.capacity)??(qt==null?void 0:qt.size)??(wt==null?void 0:wt.length)??(Lt==null?void 0:Lt.length)??0)){H+=we.slice(ne,Be+1),ne=Be+1;continue}const Xt=ps(be),vo=_t(tt,Xt);if(vo!=null){if(ee[tt])H+=Ve(tt,vo);else if(wt){const co=wt[vo];H+=typeof co=="number"&&Number.isFinite(co)?String(co):"na"}else Lt?H+=JSON.stringify(Lt[vo]??""):H+=Ve(tt,vo);ne=Be+1;continue}const To=Wt(tt,Xt);H+=To??we.slice(ne,Be+1),ne=Be+1}return H},So=(le,we)=>(()=>{let H=Me(le,we);const ne=Object.entries(w);return ne.length&&ne.forEach(([_e,q])=>{H=H.replace(new RegExp(`\\b${_e}\\.`,"gi"),q.replacement)}),H=kt(H,we),H=Tg(H),H=H.replace(/\bta\./gi,""),H=H.replace(/\bmath\./gi,""),H=H.replace(/\bstr\./gi,""),H=H.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),H=H.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),H=H.replace(/\bstrategy_(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),H=zn(H),H=Zt(H),H=ps(H),H})(),Es=(le,we)=>(()=>{let H=Me(le,we);const ne=Object.entries(w);return ne.length&&ne.forEach(([_e,q])=>{H=H.replace(new RegExp(`\\b${_e}\\.`,"gi"),q.replacement)}),H=kt(H,we),H=Tg(H),H=H.replace(/\bta\./gi,""),H=H.replace(/\bmath\./gi,""),H=H.replace(/\bstr\./gi,""),H=H.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),H=H.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),H=H.replace(/\bstrategy_(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),H=ft(H),H})(),Qo=(le,we)=>{if(le==null)return{};const H=String(le).trim();return H.startsWith('"')&&H.endsWith('"')||H.startsWith("'")&&H.endsWith("'")?{text:Ri(H)}:H?{textExpr:So(H,we)}:{}},Ko=le=>le.when&&tn(Dv(So(String(le.when),"when")))||void 0,oo=le=>Ri(String(le.pane??I)).toLowerCase()==="sub"?"sub":"main",Gs=(le,we)=>{if(le.pane!=null)return oo(le);const H=we?Ye(String(we)):"";return H&&re[H]||I},jo=(le,we,H)=>{if(!le)return e.push({message:`${we} requires a value`,line:H}),null;const ne=So(String(le),we);return ne||(e.push({message:`${we} requires a value`,line:H}),null)},fi=le=>{if(!le)return null;const we=Ri(String(le||"")).trim();return!we||we.toLowerCase()==="na"?null:Ye(we)},ba=le=>{if(le==null)return;const we=Ri(String(le)).trim();return we?we.toLowerCase():void 0},xa=le=>{if(!le)return;if(Array.isArray(le)){const H=le.map(ne=>String(ne||"").trim().toLowerCase()).filter(Boolean);return H.length?H:void 0}const we=String(le||"").split(",").map(H=>H.trim().toLowerCase()).filter(Boolean);return we.length?we:void 0},Al=(le,we,H,ne,_e,q)=>{const De=[];for(let ot=we;ot+1<le.length;ot+=2){const je=jo(le[ot],`${ne} x`,H),Ft=jo(le[ot+1],`${ne} y`,H);!je||!Ft||De.push({x:je,y:Ft,xloc:_e,yloc:q})}return De},Qs=le=>{if(!le)return;const we=String(le||"").trim(),H=we.match(/^color\.new\s*\((.*)\)\s*$/i);if(H){const ot=xr(H[1]||""),je=Qs(ot[0]),Ft=ot[1]!=null?Ri(String(ot[1])):"",Be=bp(Ft);return Ug(je,Be??void 0)}const ne=we.match(/^color\.rgb\s*\((.*)\)\s*$/i);if(ne){const ot=xr(ne[1]||""),je=bp(Ri(String(ot[0]??""))),Ft=bp(Ri(String(ot[1]??""))),Be=bp(Ri(String(ot[2]??""))),xt=bp(Ri(String(ot[3]??"")));if(typeof je=="number"&&typeof Ft=="number"&&typeof Be=="number"){const an=Math.max(0,Math.min(255,Math.round(je))),Yn=Math.max(0,Math.min(255,Math.round(Ft))),bn=Math.max(0,Math.min(255,Math.round(Be)));if(typeof xt=="number"&&Number.isFinite(xt)){const be=Math.max(0,Math.min(255,Math.round(xt))),tt=Math.max(0,Math.min(1,be/255));return`rgba(${an},${Yn},${bn},${tt})`}return`rgb(${an},${Yn},${bn})`}}const _e=we.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(_e&&J[Ye(_e[0])]==="color")return`\${${_e[0]}}`;const q=a2(we);if(q)return q;const De=Ri(we);if(De.startsWith("#")||De.startsWith("rgb"))return De},Fs=(le,we)=>{if(!le)return{};const H=So(String(le),we);if(!H)return{};const ne=nt(H);return ne!=null?{value:ne}:{expr:H}},Va=(le,we)=>{if(le==null)return{};const H=Fh(String(le));return H!=null?{value:H}:Fs(le,we)},$r=(le,we)=>{const H=Ge(le);Array.isArray(H.runtimeDrawOps)||(H.runtimeDrawOps=[]),H.runtimeDrawOps.push(we)},cd=(le,we,H,ne)=>{const _e=xr(le||""),q=Ol(_e),De=_e.filter(qn=>!wc(qn)),ot=jo(De[0]??q.x1??q.x,"line.new x1",we),je=jo(De[1]??q.y1??q.y,"line.new y1",we),Ft=jo(De[2]??q.x2,"line.new x2",we),Be=jo(De[3]??q.y2,"line.new y2",we);if(!ot||!je||!Ft||!Be)return!0;const xt=oo(q),an=Ko(q),Yn=Fs(q.width??q.linewidth,"line.width"),bn=em(q.layer??q.Layer),be=tm(q.zindex??q.z_index??q.zIndex),tt=nm(q.include_in_autoscale??q.includeInAutoscale??q.autoscale),wt=ba(q.group??q.group_id??q.groupId),Lt=xa(q.tags??q.tag),qt=H?Ye(H):void 0;return qt&&(re[qt]=xt),$r(xt,{kind:"line_new",assign:qt,once:ne?!0:void 0,x1:ot,y1:je,x2:Ft,y2:Be,when:an,color:Qs(String(q.color??""))||void 0,width:Yn.value,widthExpr:Yn.expr,style:om(String(q.style??""))||void 0,extend:$h(String(q.extend??""))||void 0,xloc:Sf(String(q.xloc??""))||void 0,layer:bn,zIndex:be,includeInAutoscale:tt,groupId:wt,tags:Lt}),!0},Sd=(le,we,H,ne)=>{const _e=xr(le||""),q=Ol(_e),De=_e.filter(Qr=>!wc(Qr)),ot=jo(De[0]??q.x,"label.new x",we);let je=jo(De[1]??q.y,"label.new y",we);if(!ot)return!0;const Ft=De[2]??q.text??q.title??"",Be=Qo(String(Ft||""),"label_text"),xt=Qo(String(q.tooltip??""),"label_tooltip"),an=oo(q),Yn=Ko(q),bn=pg(String(q.yloc??""))||void 0;if(bn&&(!je||String(je).trim().toLowerCase()==="na")&&(je=bn==="belowbar"?"low":bn==="abovebar"?"high":je),!je)return!0;const be=Va(q.size,"label.size"),tt=em(q.layer??q.Layer),wt=tm(q.zindex??q.z_index??q.zIndex),Lt=nm(q.include_in_autoscale??q.includeInAutoscale??q.autoscale),qt=ba(q.group??q.group_id??q.groupId),qn=xa(q.tags??q.tag),Xt=q.wrap!=null?String(q.wrap).toLowerCase()==="true"||Number(q.wrap)===1:void 0,vo=Fs(q.maxwidth??q.maxWidth,"label.max_width"),To=Fs(q.bg_opacity??q.bgOpacity,"label.bg_opacity"),co=Fs(q.border_width??q.borderWidth,"label.border_width"),so=Fs(q.radius,"label.radius"),Jo=Fs(q.line_height??q.lineHeight,"label.line_height"),Os=q.padding;let wr;if(Os!=null){const Qr=Number(Os);if(Number.isFinite(Qr))wr=Qr;else{const hl=String(Os).trim();if(hl.startsWith("{"))try{wr=JSON.parse(hl.replace(/([A-Za-z0-9_]+)\s*:/g,'"$1":'))}catch{wr=void 0}}}const ra=H?Ye(H):void 0;return ra&&(re[ra]=an),$r(an,{kind:"label_new",assign:ra,once:ne?!0:void 0,x:ot,y:je,when:Yn,yloc:bn,textAlign:Sm(String(q.textalign??q.text_align??q.textAlign??"")),tooltip:xt.text,tooltipExpr:xt.textExpr,text:Be.text,textExpr:Be.textExpr,color:Qs(String(q.color??""))||void 0,bgColor:Qs(String(q.bgcolor??q.bgColor??""))||void 0,borderColor:Qs(String(q.bordercolor??q.border_color??q.borderColor??""))||void 0,textColor:Qs(String(q.textcolor??q.textColor??""))||void 0,style:l2(String(q.style??q.shape??""))||void 0,size:be.value??Fh(String(q.size??"")),sizeExpr:be.expr,xloc:Sf(String(q.xloc??""))||void 0,layer:tt,zIndex:wt,includeInAutoscale:Lt,groupId:qt,tags:qn,wrap:Xt,maxWidth:vo.value,bgOpacity:To.value,borderWidth:co.value,radius:so.value,padding:wr,align:Sm(String(q.align??q.textalign??q.textAlign??""))||void 0,valign:["top","middle","bottom"].includes(String(q.valign??"").toLowerCase())?String(q.valign).toLowerCase():void 0,lineHeight:Jo.value,fontFamily:q.font_family??q.fontFamily,fontSize:Fs(q.font_size??q.fontSize,"label.font_size").value,fontWeight:q.font_weight??q.fontWeight,monospace:q.monospace!=null?String(q.monospace).toLowerCase()==="true"||Number(q.monospace)===1:void 0}),!0},Nl=(le,we,H,ne)=>{const _e=xr(le||""),q=Ol(_e),De=_e.filter(wr=>!wc(wr)),ot=jo(De[0]??q.left,"box.new left",we),je=jo(De[1]??q.top,"box.new top",we),Ft=jo(De[2]??q.right,"box.new right",we),Be=jo(De[3]??q.bottom,"box.new bottom",we);if(!ot||!je||!Ft||!Be)return!0;const xt=oo(q),an=Ko(q),Yn=Fs(q.border_width??q.borderWidth,"box.border_width"),bn=q.text??"",be=Qo(String(bn||""),"box_text"),tt=Qo(String(q.tooltip??""),"box_tooltip"),wt=Va(q.text_size??q.textSize,"box.text_size"),Lt=Sm(String(q.text_halign??q.textHalign??""))||void 0,qt=Gg(String(q.text_valign??q.textValign??""))||void 0,qn=q.text_wrap??q.textWrap,Xt=qn!=null?sm(String(qn))??void 0:void 0,vo=em(q.layer??q.Layer),To=tm(q.zindex??q.z_index??q.zIndex),co=nm(q.include_in_autoscale??q.includeInAutoscale??q.autoscale),so=ba(q.group??q.group_id??q.groupId),Jo=xa(q.tags??q.tag),Os=H?Ye(H):void 0;return Os&&(re[Os]=xt),$r(xt,{kind:"box_new",assign:Os,once:ne?!0:void 0,left:ot,top:je,right:Ft,bottom:Be,when:an,borderColor:Qs(String(q.border_color??q.borderColor??""))||void 0,width:Yn.value,widthExpr:Yn.expr,borderStyle:om(String(q.border_style??q.borderStyle??""))||void 0,bgColor:Qs(String(q.bgcolor??q.bgColor??q.color??""))||void 0,text:be.text,textExpr:be.textExpr,tooltip:tt.text,tooltipExpr:tt.textExpr,textColor:Qs(String(q.text_color??q.textColor??""))||void 0,textSize:wt.value,textSizeExpr:wt.expr,textHalign:Lt,textValign:qt,textWrap:Xt,extend:$h(String(q.extend??""))||void 0,xloc:Sf(String(q.xloc??""))||void 0,layer:vo,zIndex:To,includeInAutoscale:co,groupId:so,tags:Jo}),!0},dd=(le,we,H,ne)=>{const _e=xr(le||""),q=Ol(_e),De=_e.filter(To=>!wc(To)),ot=De[0]??q.position??q.pos??"top_right",je=De[1]??q.columns??q.cols,Ft=De[2]??q.rows,Be=je!=null?Number(je):NaN,xt=Ft!=null?Number(Ft):NaN;if(!Number.isFinite(Be)||!Number.isFinite(xt))return e.push({message:"table.new(position, columns, rows) requires numeric columns/rows",line:we}),!0;const an=oo(q),Yn=Ko(q),bn=Fs(q.border_width??q.borderWidth,"table.border_width"),be=Fs(q.frame_width??q.frameWidth,"table.frame_width"),tt=Va(q.text_size??q.textSize,"table.text_size"),wt=em(q.layer??q.Layer),Lt=tm(q.zindex??q.z_index??q.zIndex),qt=nm(q.include_in_autoscale??q.includeInAutoscale??q.autoscale),qn=ba(q.group??q.group_id??q.groupId),Xt=xa(q.tags??q.tag),vo=H?Ye(H):void 0;return vo&&(re[vo]=an),$r(an,{kind:"table_new",assign:vo,once:ne?!0:void 0,when:Yn,position:c2(String(ot))||Ri(String(ot)),columns:Math.max(1,Math.floor(Be)),rows:Math.max(1,Math.floor(xt)),bgcolor:Qs(String(q.bgcolor??q.bgColor??""))||void 0,borderColor:Qs(String(q.border_color??q.borderColor??""))||void 0,borderWidth:bn.value,borderWidthExpr:bn.expr,textColor:Qs(String(q.text_color??q.textColor??""))||void 0,textSize:tt.value,textSizeExpr:tt.expr,textHalign:Sm(String(q.text_halign??q.textHalign??""))||void 0,textValign:Gg(String(q.text_valign??q.textValign??""))||void 0,frameColor:Qs(String(q.frame_color??q.frameColor??""))||void 0,frameWidth:be.value,frameWidthExpr:be.expr,layer:wt,zIndex:Lt,includeInAutoscale:qt,groupId:qn,tags:Xt}),!0},Cd=(le,we,H="table_cell")=>{const ne=xr(le||""),_e=Ol(ne),q=ne.filter(qn=>!wc(qn)),De=q[0]??"",ot=fi(String(De||""))||"",je=q[1]??_e.column??_e.col,Ft=q[2]??_e.row,Be=je!=null?Number(je):NaN,xt=Ft!=null?Number(Ft):NaN;if(!ot||!Number.isFinite(Be)||!Number.isFinite(xt))return t.push({message:"table.cell(table, column, row, text) requires a table id and numeric column/row",line:we}),!0;const an=q[3]??_e.text??_e.title??"",Yn=Qo(String(an||""),"table_cell_text"),bn=Va(_e.text_size??_e.textSize,"table.cell_text_size"),be=Fs(_e.width,"table.cell_width"),tt=Fs(_e.height,"table.cell_height"),wt=Gs(_e,ot),Lt=_e.tooltip!=null?Qo(String(_e.tooltip),"table_cell_tooltip"):{},qt={kind:H,target:ot,targetExpr:De!=null?String(De):void 0,when:Ko(_e),column:Math.floor(Be),row:Math.floor(xt),text:Yn.text,textExpr:Yn.textExpr,textColor:Qs(String(_e.text_color??_e.textColor??""))||void 0,textSize:bn.value,textSizeExpr:bn.expr,textHalign:Sm(String(_e.text_halign??_e.textHalign??""))||void 0,textValign:Gg(String(_e.text_valign??_e.textValign??""))||void 0,bgcolor:Qs(String(_e.bgcolor??_e.bgColor??""))||void 0,width:be.value,widthExpr:be.expr,height:tt.value,heightExpr:tt.expr,tooltip:Lt.text,tooltipExpr:Lt.textExpr};return $r(wt,qt),!0},fa=(le,we,H)=>{const ne=xr(we||""),_e=Ol(ne),q=ne.filter(xt=>!wc(xt)),De=q[0],ot=fi(De);if(!ot)return!0;const je=String(le||"").toLowerCase().replace(/_/g,""),Ft=Gs(_e,ot),Be={kind:"line_set",target:ot,targetExpr:De!=null?String(De):void 0,when:Ko(_e)};if(je==="x1")Be.x1=jo(q[1],"line.set_x1",H);else if(je==="y1")Be.y1=jo(q[1],"line.set_y1",H);else if(je==="x2")Be.x2=jo(q[1],"line.set_x2",H);else if(je==="y2")Be.y2=jo(q[1],"line.set_y2",H);else if(je==="xy1")Be.x1=jo(q[1],"line.set_xy1 x",H),Be.y1=jo(q[2],"line.set_xy1 y",H);else if(je==="xy2")Be.x2=jo(q[1],"line.set_xy2 x",H),Be.y2=jo(q[2],"line.set_xy2 y",H);else if(je==="xy")Be.x1=jo(q[1],"line.set_xy x1",H),Be.y1=jo(q[2],"line.set_xy y1",H),Be.x2=jo(q[3],"line.set_xy x2",H),Be.y2=jo(q[4],"line.set_xy y2",H);else if(je==="color")Be.color=Qs(q[1]??_e.color);else if(je==="width"||je==="linewidth"){const xt=Fs(q[1]??_e.width,"line.set_width");Be.width=xt.value,Be.widthExpr=xt.expr}else if(je==="style")Be.style=om(String(q[1]??_e.style??""))||void 0;else if(je==="extend")Be.extend=$h(String(q[1]??_e.extend??""))||void 0;else if(je==="xloc")Be.xloc=Sf(String(q[1]??_e.xloc??""))||void 0;else return t.push({message:`Unsupported line.set_${le}()`,line:H}),!0;return $r(Ft,Be),!0},Dl=(le,we)=>{const H=xr(le||""),ne=Ol(H),q=H.filter(je=>!wc(je))[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De);return $r(ot,{kind:"line_delete",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne)}),!0},ml=(le,we,H,ne)=>{const _e=xr(le||""),q=Ol(_e),De=_e.filter(wt=>!wc(wt)),ot=fi(De[0]??q.line1??q.line_1??q.l1),je=fi(De[1]??q.line2??q.line_2??q.l2);if(!ot||!je)return t.push({message:"linefill.new(line1, line2) requires two line ids",line:we}),!0;const Ft=Gs(q,ot||je),Be=Ko(q),xt=em(q.layer??q.Layer),an=tm(q.zindex??q.z_index??q.zIndex),Yn=nm(q.include_in_autoscale??q.includeInAutoscale??q.autoscale),bn=ba(q.group??q.group_id??q.groupId),be=xa(q.tags??q.tag),tt=H?Ye(H):void 0;return tt&&(re[tt]=Ft),$r(Ft,{kind:"linefill_new",assign:tt,once:ne?!0:void 0,when:Be,line1:ot,line2:je,color:Qs(De[2]??q.color??q.fillcolor),layer:xt,zIndex:an,includeInAutoscale:Yn,groupId:bn,tags:be}),!0},gl=(le,we,H)=>{const ne=xr(we||""),_e=Ol(ne),q=ne.filter(xt=>!wc(xt)),De=q[0],ot=fi(De);if(!ot)return!0;const je=String(le||"").toLowerCase().replace(/_/g,""),Ft=Gs(_e,ot),Be={kind:"linefill_set",target:ot,targetExpr:De!=null?String(De):void 0,when:Ko(_e)};if(je==="color")Be.color=Qs(q[1]??_e.color??_e.fillcolor);else if(je==="line1")Be.line1=fi(q[1]??_e.line1??_e.line_1??_e.l1)||void 0;else if(je==="line2")Be.line2=fi(q[1]??_e.line2??_e.line_2??_e.l2)||void 0;else return t.push({message:`Unsupported linefill.set_${le}()`,line:H}),!0;return $r(Ft,Be),!0},_d=(le,we)=>{const H=xr(le||""),ne=Ol(H),q=H.filter(je=>!wc(je))[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De);return $r(ot,{kind:"linefill_delete",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne)}),!0},Kl=(le,we,H,ne)=>{const _e=xr(le||""),q=Ol(_e),De=_e.filter(tt=>!wc(tt)),ot=Ko(q),je=Sf(String(q.xloc??""))||void 0,Ft=pg(String(q.yloc??""))||void 0,Be=Al(De,0,we,"polyline.new",je,Ft);if(Be.length<2)return t.push({message:"polyline.new requires at least 2 points (x,y pairs)",line:we}),!0;const xt=oo(q),an=em(q.layer??q.Layer),Yn=tm(q.zindex??q.z_index??q.zIndex),bn=nm(q.include_in_autoscale??q.includeInAutoscale??q.autoscale),be=H?Ye(H):void 0;return be&&(re[be]=xt),$r(xt,{kind:"polyline_new",assign:be,once:ne?!0:void 0,when:ot,points:Be,color:Qs(q.color),width:Fs(q.width,"polyline.width").value,widthExpr:Fs(q.width,"polyline.width").expr,style:om(String(q.style??""))||void 0,opacity:q.opacity!=null?Number(q.opacity):void 0,xloc:je,yloc:Ft,layer:an,zIndex:Yn,includeInAutoscale:bn,groupId:ba(q.group??q.group_id??q.groupId),tags:xa(q.tags??q.tag)}),!0},ic=(le,we)=>{const H=xr(le||""),ne=Ol(H),_e=H.filter(an=>!wc(an)),q=_e[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De),je=Sf(String(ne.xloc??""))||void 0,Ft=pg(String(ne.yloc??""))||void 0,Be=Al(_e,1,we,"polyline.set_points",je,Ft),xt=Fs(ne.width,"polyline.set_width");return $r(ot,{kind:"polyline_set",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne),points:Be.length?Be:void 0,color:Qs(ne.color),width:xt.value,widthExpr:xt.expr,style:om(String(ne.style??""))||void 0,opacity:ne.opacity!=null?Number(ne.opacity):void 0,xloc:je,yloc:Ft,layer:em(ne.layer??ne.Layer),zIndex:tm(ne.zindex??ne.z_index??ne.zIndex),includeInAutoscale:nm(ne.include_in_autoscale??ne.includeInAutoscale??ne.autoscale),groupId:ba(ne.group??ne.group_id??ne.groupId),tags:xa(ne.tags??ne.tag)}),!0},od=(le,we)=>{const H=xr(le||""),ne=Ol(H),q=H.filter(je=>!wc(je))[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De);return $r(ot,{kind:"polyline_delete",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne)}),!0},zd=(le,we,H,ne)=>{const _e=xr(le||""),q=Ol(_e),De=_e.filter(bn=>!wc(bn)),ot=Ko(q),je=Sf(String(q.xloc??""))||void 0,Ft=pg(String(q.yloc??""))||void 0,Be=Al(De,0,we,"polygon.new",je,Ft);if(Be.length<3)return t.push({message:"polygon.new requires at least 3 points (x,y pairs)",line:we}),!0;const xt=oo(q),an=H?Ye(H):void 0;an&&(re[an]=xt);const Yn=Fs(q.stroke_width??q.strokeWidth,"polygon.stroke_width");return $r(xt,{kind:"polygon_new",assign:an,once:ne?!0:void 0,when:ot,points:Be,fillColor:Qs(q.fill_color??q.fillcolor??q.color),strokeColor:Qs(q.stroke_color??q.strokeColor??q.borderColor),strokeWidth:Yn.value,strokeWidthExpr:Yn.expr,strokeStyle:om(String(q.stroke_style??q.strokeStyle??""))||void 0,opacity:q.opacity!=null?Number(q.opacity):void 0,xloc:je,yloc:Ft,layer:em(q.layer??q.Layer),zIndex:tm(q.zindex??q.z_index??q.zIndex),includeInAutoscale:nm(q.include_in_autoscale??q.includeInAutoscale??q.autoscale),groupId:ba(q.group??q.group_id??q.groupId),tags:xa(q.tags??q.tag)}),!0},Ec=(le,we)=>{const H=xr(le||""),ne=Ol(H),_e=H.filter(an=>!wc(an)),q=_e[0],De=fi(q);if(!De)return!0;const ot=Sf(String(ne.xloc??""))||void 0,je=pg(String(ne.yloc??""))||void 0,Ft=Al(_e,1,we,"polygon.set_points",ot,je),Be=Gs(ne,De),xt=Fs(ne.stroke_width??ne.strokeWidth,"polygon.stroke_width");return $r(Be,{kind:"polygon_set",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne),points:Ft.length?Ft:void 0,fillColor:Qs(ne.fill_color??ne.fillcolor??ne.color),strokeColor:Qs(ne.stroke_color??ne.strokeColor??ne.borderColor),strokeWidth:xt.value,strokeWidthExpr:xt.expr,strokeStyle:om(String(ne.stroke_style??ne.strokeStyle??""))||void 0,opacity:ne.opacity!=null?Number(ne.opacity):void 0,xloc:ot,yloc:je,layer:em(ne.layer??ne.Layer),zIndex:tm(ne.zindex??ne.z_index??ne.zIndex),includeInAutoscale:nm(ne.include_in_autoscale??ne.includeInAutoscale??ne.autoscale),groupId:ba(ne.group??ne.group_id??ne.groupId),tags:xa(ne.tags??ne.tag)}),!0},al=(le,we)=>{const H=xr(le||""),ne=Ol(H),q=H.filter(je=>!wc(je))[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De);return $r(ot,{kind:"polygon_delete",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne)}),!0},kc=(le,we,H,ne)=>{const _e=xr(le||""),q=Ol(_e),De=_e.filter(be=>!wc(be)),ot=Ko(q),je=Sf(String(q.xloc??""))||void 0,Ft=pg(String(q.yloc??""))||void 0,Be=Al(De,0,we,"path.new",je,Ft);if(!Be.length)return t.push({message:"path.new requires at least one (x,y) point",line:we}),!0;const xt=Be.map((be,tt)=>({cmd:tt===0?"M":"L",x:be.x,y:be.y,xloc:be.xloc,yloc:be.yloc})),an=oo(q),Yn=H?Ye(H):void 0;Yn&&(re[Yn]=an);const bn=Fs(q.width,"path.width");return $r(an,{kind:"path_new",assign:Yn,once:ne?!0:void 0,when:ot,commands:xt,color:Qs(q.color),width:bn.value,widthExpr:bn.expr,style:om(String(q.style??""))||void 0,opacity:q.opacity!=null?Number(q.opacity):void 0,layer:em(q.layer??q.Layer),zIndex:tm(q.zindex??q.z_index??q.zIndex),includeInAutoscale:nm(q.include_in_autoscale??q.includeInAutoscale??q.autoscale),groupId:ba(q.group??q.group_id??q.groupId),tags:xa(q.tags??q.tag)}),!0},Vd=(le,we)=>{const H=xr(le||""),ne=Ol(H),_e=H.filter(Yn=>!wc(Yn)),q=_e[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De),je=Sf(String(ne.xloc??""))||void 0,Ft=pg(String(ne.yloc??""))||void 0,Be=Al(_e,1,we,"path.set_points",je,Ft),xt=Be.length>0?Be.map((Yn,bn)=>({cmd:bn===0?"M":"L",x:Yn.x,y:Yn.y,xloc:Yn.xloc,yloc:Yn.yloc})):void 0,an=Fs(ne.width,"path.set_width");return $r(ot,{kind:"path_set",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne),commands:xt,color:Qs(ne.color),width:an.value,widthExpr:an.expr,style:om(String(ne.style??""))||void 0,opacity:ne.opacity!=null?Number(ne.opacity):void 0,layer:em(ne.layer??ne.Layer),zIndex:tm(ne.zindex??ne.z_index??ne.zIndex),includeInAutoscale:nm(ne.include_in_autoscale??ne.includeInAutoscale??ne.autoscale),groupId:ba(ne.group??ne.group_id??ne.groupId),tags:xa(ne.tags??ne.tag)}),!0},sd=(le,we)=>{const H=xr(le||""),ne=Ol(H),q=H.filter(je=>!wc(je))[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De);return $r(ot,{kind:"path_delete",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne)}),!0},id=(le,we,H)=>{const ne=xr(we||""),_e=Ol(ne),q=ne.filter(xt=>!wc(xt)),De=q[0],ot=fi(De);if(!ot)return!0;const je=String(le||"").toLowerCase().replace(/_/g,""),Ft=Gs(_e,ot),Be={kind:"label_set",target:ot,targetExpr:De!=null?String(De):void 0,when:Ko(_e)};if(je==="x")Be.x=jo(q[1],"label.set_x",H);else if(je==="y")Be.y=jo(q[1],"label.set_y",H);else if(je==="xy")Be.x=jo(q[1],"label.set_xy x",H),Be.y=jo(q[2],"label.set_xy y",H);else if(je==="text"){const xt=Qo(String(q[1]??_e.text??""),"label_set_text");Be.text=xt.text,Be.textExpr=xt.textExpr}else if(je==="color")Be.color=Qs(q[1]??_e.color);else if(je==="textcolor")Be.textColor=Qs(q[1]??_e.textcolor??_e.textColor);else if(je==="style")Be.style=l2(String(q[1]??_e.style??""))||void 0;else if(je==="size"){const xt=Va(q[1]??_e.size,"label.set_size");Be.size=xt.value??Fh(String(q[1]??_e.size??"")),Be.sizeExpr=xt.expr}else if(je==="yloc")Be.yloc=pg(String(q[1]??_e.yloc??""))||void 0;else if(je==="textalign")Be.textAlign=Sm(String(q[1]??_e.textalign??_e.textAlign??""))||void 0;else if(je==="tooltip"){const xt=Qo(String(q[1]??_e.tooltip??""),"label_set_tooltip");Be.tooltip=xt.text,Be.tooltipExpr=xt.textExpr}else if(je==="xloc")Be.xloc=Sf(String(q[1]??_e.xloc??""))||void 0;else return t.push({message:`Unsupported label.set_${le}()`,line:H}),!0;return $r(Ft,Be),!0},Pd=(le,we)=>{const H=xr(le||""),ne=Ol(H),q=H.filter(je=>!wc(je))[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De);return $r(ot,{kind:"label_delete",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne)}),!0},Ed=(le,we,H)=>{const ne=xr(we||""),_e=Ol(ne),q=ne.filter(xt=>!wc(xt)),De=q[0],ot=fi(De);if(!ot)return!0;const je=String(le||"").toLowerCase().replace(/_/g,""),Ft=Gs(_e,ot),Be={kind:"box_set",target:ot,targetExpr:De!=null?String(De):void 0,when:Ko(_e)};if(je==="left")Be.left=jo(q[1],"box.set_left",H);else if(je==="right")Be.right=jo(q[1],"box.set_right",H);else if(je==="top")Be.top=jo(q[1],"box.set_top",H);else if(je==="bottom")Be.bottom=jo(q[1],"box.set_bottom",H);else if(je==="lefttop")Be.left=jo(q[1],"box.set_lefttop left",H),Be.top=jo(q[2],"box.set_lefttop top",H);else if(je==="rightbottom")Be.right=jo(q[1],"box.set_rightbottom right",H),Be.bottom=jo(q[2],"box.set_rightbottom bottom",H);else if(je==="bgcolor")Be.bgColor=Qs(q[1]??_e.bgcolor??_e.bgColor);else if(je==="bordercolor")Be.borderColor=Qs(q[1]??_e.border_color??_e.borderColor);else if(je==="borderwidth"){const xt=Fs(q[1]??_e.border_width??_e.borderWidth,"box.set_border_width");Be.width=xt.value,Be.widthExpr=xt.expr}else if(je==="borderstyle")Be.borderStyle=om(String(q[1]??_e.border_style??_e.borderStyle??""))||void 0;else if(je==="text"){const xt=Qo(String(q[1]??_e.text??""),"box_set_text");Be.text=xt.text,Be.textExpr=xt.textExpr}else if(je==="textcolor")Be.textColor=Qs(q[1]??_e.text_color??_e.textColor);else if(je==="textsize"){const xt=Va(q[1]??_e.text_size??_e.textSize,"box.set_text_size");Be.textSize=xt.value,Be.textSizeExpr=xt.expr}else if(je==="texthalign")Be.textHalign=Sm(String(q[1]??_e.text_halign??_e.textHalign??""))||void 0;else if(je==="textvalign")Be.textValign=Gg(String(q[1]??_e.text_valign??_e.textValign??""))||void 0;else if(je==="textwrap"){const xt=q[1]??_e.text_wrap??_e.textWrap;xt!=null&&(Be.textWrap=sm(String(xt))??void 0)}else if(je==="tooltip"){const xt=Qo(String(q[1]??_e.tooltip??""),"box_set_tooltip");Be.tooltip=xt.text,Be.tooltipExpr=xt.textExpr}else if(je==="extend")Be.extend=$h(String(q[1]??_e.extend??""))||void 0;else if(je==="xloc")Be.xloc=Sf(String(q[1]??_e.xloc??""))||void 0;else return t.push({message:`Unsupported box.set_${le}()`,line:H}),!0;return $r(Ft,Be),!0},zl=(le,we)=>{const H=xr(le||""),ne=Ol(H),q=H.filter(je=>!wc(je))[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De);return $r(ot,{kind:"box_delete",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne)}),!0},Gd=(le,we,H)=>{const ne=xr(we||""),_e=Ol(ne),q=ne.filter(xt=>!wc(xt)),De=q[0],ot=fi(De);if(!ot)return!0;const je=String(le||"").toLowerCase().replace(/_/g,""),Ft=Gs(_e,ot),Be={kind:"table_set",target:ot,targetExpr:De!=null?String(De):void 0,when:Ko(_e)};if(je==="position")Be.position=c2(String(q[1]??_e.position??""))||Ri(String(q[1]??_e.position??""));else if(je==="bgcolor")Be.bgcolor=Qs(q[1]??_e.bgcolor??_e.bgColor);else if(je==="bordercolor")Be.borderColor=Qs(q[1]??_e.border_color??_e.borderColor);else if(je==="borderwidth"){const xt=Fs(q[1]??_e.border_width??_e.borderWidth,"table.set_border_width");Be.borderWidth=xt.value,Be.borderWidthExpr=xt.expr}else if(je==="textcolor")Be.textColor=Qs(q[1]??_e.text_color??_e.textColor);else if(je==="textsize"){const xt=Va(q[1]??_e.text_size??_e.textSize,"table.set_text_size");Be.textSize=xt.value,Be.textSizeExpr=xt.expr}else if(je==="texthalign")Be.textHalign=Sm(String(q[1]??_e.text_halign??_e.textHalign??""))||void 0;else if(je==="textvalign")Be.textValign=Gg(String(q[1]??_e.text_valign??_e.textValign??""))||void 0;else if(je==="framecolor")Be.frameColor=Qs(q[1]??_e.frame_color??_e.frameColor);else if(je==="framewidth"){const xt=Fs(q[1]??_e.frame_width??_e.frameWidth,"table.set_frame_width");Be.frameWidth=xt.value,Be.frameWidthExpr=xt.expr}else return t.push({message:`Unsupported table.set_${le}()`,line:H}),!0;return $r(Ft,Be),!0},lu=(le,we)=>{const H=xr(le||""),ne=Ol(H),q=H.filter(je=>!wc(je))[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De);return $r(ot,{kind:"table_delete",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne)}),!0},Yd=(le,we)=>{const H=xr(le||""),ne=Ol(H),_e=H.filter(Be=>!wc(Be)),q=_e[0],De=fi(q);if(!De)return!0;const ot=Gs(ne,De),je=(Be,xt)=>{if(!(Be==null||String(Be).trim()===""))return jo(String(Be),xt,we)||void 0},Ft={kind:"table_clear",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne)};return Ft.startColumn=je(_e[1]??ne.start_column??ne.start_col,"table.clear start_column"),Ft.startRow=je(_e[2]??ne.start_row,"table.clear start_row"),Ft.endColumn=je(_e[3]??ne.end_column??ne.end_col,"table.clear end_column"),Ft.endRow=je(_e[4]??ne.end_row,"table.clear end_row"),$r(ot,Ft),!0},eu=(le,we)=>{const H=xr(le||""),ne=Ol(H),_e=H.filter(Yn=>!wc(Yn)),q=_e[0],De=fi(q);if(!De)return!0;const ot=_e[1]??ne.left,je=_e[2]??ne.top,Ft=_e[3]??ne.right,Be=_e[4]??ne.bottom;if(ot==null||je==null||Ft==null||Be==null)return t.push({message:"table.merge(table, left, top, right, bottom) requires 4 numeric args",line:we}),!0;const xt=Gs(ne,De),an={kind:"table_merge",target:De,targetExpr:q!=null?String(q):void 0,when:Ko(ne)};return an.left=jo(String(ot),"table.merge left",we)||void 0,an.top=jo(String(je),"table.merge top",we)||void 0,an.right=jo(String(Ft),"table.merge right",we)||void 0,an.bottom=jo(String(Be),"table.merge bottom",we)||void 0,$r(xt,an),!0},Ju=(le,we,H)=>{const ne=xr(we||""),_e=Ol(ne),q=ne.filter(be=>!wc(be)),De=q[0]??"",ot=fi(String(De||""))||"",je=q[1]??_e.column??_e.col,Ft=q[2]??_e.row,Be=je!=null?Number(je):NaN,xt=Ft!=null?Number(Ft):NaN;if(!ot||!Number.isFinite(Be)||!Number.isFinite(xt))return t.push({message:"table.cell_set_* requires a table id and numeric column/row",line:H}),!0;const an=String(le||"").toLowerCase().replace(/_/g,""),Yn=Gs(_e,ot),bn={kind:"table_cell_set",target:ot,targetExpr:De!=null?String(De):void 0,when:Ko(_e),column:Math.floor(Be),row:Math.floor(xt)};if(an==="text"){const be=Qo(String(q[3]??_e.text??""),"table_cell_set_text");bn.text=be.text,bn.textExpr=be.textExpr}else if(an==="textcolor")bn.textColor=Qs(q[3]??_e.text_color??_e.textColor);else if(an==="bgcolor")bn.bgcolor=Qs(q[3]??_e.bgcolor??_e.bgColor);else if(an==="textsize"){const be=Va(q[3]??_e.text_size??_e.textSize,"table.cell_set_text_size");bn.textSize=be.value,bn.textSizeExpr=be.expr}else if(an==="texthalign")bn.textHalign=Sm(String(q[3]??_e.text_halign??_e.textHalign??""))||void 0;else if(an==="textvalign")bn.textValign=Gg(String(q[3]??_e.text_valign??_e.textValign??""))||void 0;else if(an==="width"){const be=Fs(q[3]??_e.width,"table.cell_set_width");bn.width=be.value,bn.widthExpr=be.expr}else if(an==="height"){const be=Fs(q[3]??_e.height,"table.cell_set_height");bn.height=be.value,bn.heightExpr=be.expr}else if(an==="tooltip"){const be=Qo(String(q[3]??_e.tooltip??""),"table_cell_set_tooltip");bn.tooltip=be.text,bn.tooltipExpr=be.textExpr}else return t.push({message:`Unsupported table.cell_set_${le}()`,line:H}),!0;return $r(Yn,bn),!0};for(let le=0;le<a.length;le++){const we=a[le],H=we.text.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*\((.*)\)\s*=>\s*(.*)$/);if(!H)continue;const ne=H[1],_e=H[2]||"";let q=String(H[3]||"").trim();if(!q){const je=we.indent,Ft=[];let Be=le+1;for(;Be<a.length&&a[Be].indent>je;)a[Be].text.startsWith("//@pine_fn")||Ft.push(a[Be]),Be+=1;const xt=Ft.map(bn=>String(bn.text||"").trim()).filter(Boolean);if(!xt.length){e.push({message:`Function "${ne}" requires a body expression`,line:we.lineNo});continue}const an=xt[xt.length-1];q=an.replace(/^return\s+/i,"").trim()||an,xt.length>1&&t.push({message:`Function "${ne}" uses only the final expression; earlier lines are ignored.`,line:we.lineNo});for(let bn=le+1;bn<Be;bn++)a[bn]={...a[bn],text:"//@pine_fn"};le=Be-1}const De=xr(_e).map(je=>String(je||"").trim()).filter(Boolean).map(je=>{const Ft=je.match(/^(?:(?:varip|var)\s+)?(?:float|int|bool|string)\s+([A-Za-z_$][A-Za-z0-9_$]*)$/i);return(Ft?Ft[1]:je).trim()}),ot=Ye(ne);se[ot]&&t.push({message:`Duplicate function definition "${ne}" (later definition overrides).`,line:we.lineNo}),se[ot]={name:ne,args:De,body:q,lineNo:we.lineNo},a[le]={...we,text:"//@pine_fn"}}const mu=le=>{const we=String(le||"").trim(),H=Ye(we),ne=Z[H];return ne||we},yd=le=>{const we=/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g,H=new Map,ne=new Set,_e=De=>{const ot=Ye(De);if(H.has(ot))return H.get(ot);const je=Z[ot];if(!je)return De;if(ne.has(ot))return je;ne.add(ot);const Ft=String(je).replace(we,Be=>{const xt=Ye(Be);return Z[xt]?`(${_e(xt)})`:Be});return ne.delete(ot),H.set(ot,Ft),Ft},q=mu(le);return String(q).replace(we,De=>{const ot=Ye(De);return Z[ot]?`(${_e(ot)})`:De})},tn=le=>{const we=/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g,H=new Map,ne=new Set,_e=xt=>{const an=Ye(xt);if(H.has(an))return H.get(an);const Yn=Z[an];if(!Yn)return xt;if(ne.has(an))return Yn;ne.add(an);const bn=String(Yn).replace(we,be=>{const tt=Ye(be);return Z[tt]?`(${_e(tt)})`:be});return ne.delete(an),H.set(an,bn),bn},q=mu(le),De=String(q).replace(we,xt=>{const an=Ye(xt);return Z[an]?`(${_e(an)})`:xt}),ot=new Set(M.map(xt=>Ye(String((xt==null?void 0:xt.name)||""))).filter(Boolean)),je=new Set(Object.keys(R||{}).map(xt=>Ye(xt)).filter(Boolean)),Ft=new Set(["open","high","low","close","volume","time","and","or","not","true","false","crossesabove","crossesbelow"]);return De.replace(we,(xt,an)=>{const Yn=Ye(xt);if(!Yn||Ft.has(Yn))return xt;const bn=De.slice(an+xt.length);return/^\s*\(/.test(bn)||!je.has(Yn)||ot.has(Yn)?xt:`\${${xt}}`})},En=(le,we)=>{const H=String(le||"").trim(),ne=So(H,we),_e=ne.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(_e)return _e[0];const q=bp(ne);if(q!=null){const Ft=`__const_${String(q).replace(/[^\d]/g,"_")}`;return M.some(Be=>Be.name.toLowerCase()===Ft.toLowerCase())||M.push({name:Ft,expr:String(q)}),Ft}const De=we.replace(/[^A-Za-z0-9_]+/g,"_").toLowerCase();let ot=`__${De||"expr"}`,je=1;for(;M.some(Ft=>Ft.name.toLowerCase()===ot.toLowerCase());)je+=1,ot=`__${De||"expr"}_${je}`;return M.push({name:ot,expr:ne}),ot},go=(le,we)=>{const H=Ri(String(le||"").trim()),ne=Ye(H);return me[ne]?me[ne]:En(H,we).replace(/\s+/g,"_").toLowerCase()},hn=(le,we,H)=>{const ne=xr(le||"");if(!ne.length){e.push({message:"plot() requires at least 1 argument",line:we});return}const _e=ne[0],q=ne[1]&&!ne[1].includes("=")?ne[1]:null,De=Ol(ne),ot=oo(De),je=Ge(ot),Ft=En(_e,Ri(String(De.title??De.name??q??_e??"plot"))),Be=Fs(De.offset,"plot_offset"),xt=Fs(De.show_last,"plot_show_last"),an=Fs(De.precision,"plot_precision"),Yn=Be.value!=null?Be.value:Be.expr,bn=xt.value!=null?xt.value:xt.expr,be=an.value!=null?an.value:an.expr,tt=De.display!=null?String(De.display):void 0,wt=De.trackprice!=null?sm(String(De.trackprice)):void 0,Lt=De.transp??De.transparency,qt=Lt!=null?Number(Lt):void 0,qn=Qs(String(De.color??"")),Xt=Ug(qn,qt),vo=Ft.replace(/\s+/g,"_").toLowerCase();je.plots.push({name:Ri(String(De.title??De.name??q??Ft)),source:vo,type:Ri(String(De.type??"line")),color:Xt,width:De.width!=null?Number(De.width):De.linewidth!=null?Number(De.linewidth):void 0,style:De.style!=null?Ri(String(De.style)):void 0,offset:Yn,showLast:bn,precision:be,display:tt,trackPrice:wt}),H&&(me[Ye(H)]=vo)},Ho=(le,we,H)=>{const ne=xr(we||""),_e=Ol(ne),q=ne.filter(hl=>!wc(hl));if(q.length<4){e.push({message:`${le} plot requires open/high/low/close`,line:H});return}const De=oo(_e),ot=Ge(De),je=En(q[0],`${le}_open`).replace(/\s+/g,"_").toLowerCase(),Ft=En(q[1],`${le}_high`).replace(/\s+/g,"_").toLowerCase(),Be=En(q[2],`${le}_low`).replace(/\s+/g,"_").toLowerCase(),xt=En(q[3],`${le}_close`).replace(/\s+/g,"_").toLowerCase(),an=Ri(String(_e.title??_e.name??q[4]??le)),Yn=_e.color??q[5]??"",bn=_e.colordown??_e.color_down??_e.colordn??"",be=_e.wickcolor??q[6]??"",tt=_e.bordercolor??q[7]??"",wt=_e.transp??_e.transparency,Lt=wt!=null?Number(wt):void 0,qt=Ug(Qs(String(Yn)),Lt),qn=Ug(Qs(String(bn))||qt,Lt),Xt=Ug(Qs(String(be)),Lt),vo=Ug(Qs(String(tt)),Lt),To=Fs(_e.offset,`${le}_offset`),co=Fs(_e.show_last,`${le}_show_last`),so=Fs(_e.precision,`${le}_precision`),Jo=To.value!=null?To.value:To.expr,Os=co.value!=null?co.value:co.expr,wr=so.value!=null?so.value:so.expr,ra=_e.display!=null?String(_e.display):void 0,Qr=_e.trackprice!=null?sm(String(_e.trackprice)):void 0;ot.plots.push({name:an||le,type:le,open:je,high:Ft,low:Be,close:xt,color:qt||(le==="candles"?"#22c55e":"#64748b"),downColor:qn||"#ef4444",wickColor:Xt||void 0,borderColor:vo||void 0,offset:Jo,showLast:Os,precision:wr,display:ra,trackPrice:Qr})},Eo=(le,we,H)=>{const ne=we.match(/^input\.(int|float|bool|string|time|session|source|symbol|color)\s*\((.*)\)\s*$/i);if(!ne)return!1;const _e=ne[1].toLowerCase(),q=xr(ne[2]||""),De=Ol(q),ot=q.filter(wt=>!wc(wt)),je=De.defval??ot[0]??"",Ft=De.title??ot[1]??"",Be=Ft?Ri(String(Ft)):void 0,xt=wt=>{e.push({message:wt,line:H})},an=wt=>{const Lt=typeof wt=="number"?wt:Number(wt);return Number.isFinite(Lt)?Lt:void 0},Yn=an(De.minval),bn=an(De.maxval),be=an(De.step);let tt=null;if(_e==="bool"){const wt=sm(String(je));if(wt==null)return xt(`input.bool() requires defval true/false for "${le}"`),!0;tt=wt}else if(_e==="string"||_e==="session"||_e==="symbol")tt=Ri(String(je||""));else if(_e==="color"){const wt=a2(String(je))||Ri(String(je||""));if(!wt)return xt(`input.color() requires a valid color for "${le}"`),!0;tt=wt}else if(_e==="time"){const wt=an(String(je));if(wt!=null)tt=wt;else{const Lt=uq(String(je))??(()=>{const qt=Ri(String(je||"")),qn=Date.parse(qt);return Number.isFinite(qn)?qn:null})();if(Lt==null)return xt(`input.time() requires a numeric or timestamp defval for "${le}"`),!0;tt=Lt}}else if(_e==="source"){const wt=So(String(je||"close"),`input_source_${le}`),Lt=wt.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);tt=Lt?Lt[0]:En(wt,`input_source_${le}`)}else{const wt=an(je);if(wt==null)return xt(`input.${_e}() requires numeric defval for "${le}"`),!0;tt=_e==="int"?Math.floor(wt):wt}return R[le]=tt,J[Ye(le)]=_e,W.push({name:le,type:_e,title:Be,defval:tt,minval:Yn,maxval:bn,step:be}),!0};let di=0;const ns=(le,we,H)=>{const ne=[];let _e=!1,q=0;for(;q<le.length;){const De=le[q],ot=De.text.trim();if(ot==="break"||ot==="continue"){ot==="break"?(ne.push({...De,text:`${we} := 1`}),ne.push({...De,text:`${H} := 1`})):ne.push({...De,text:`${H} := 1`}),_e=!0,q+=1;continue}if(!_e){ne.push(De),q+=1;continue}const je=De.indent;let Ft=q+1;for(;Ft<le.length&&le[Ft].indent>je;)Ft+=1;ne.push({text:`if (${H} == 0 and ${we} == 0)`,indent:je,lineNo:De.lineNo});for(let Be=q;Be<Ft;Be++){const xt=le[Be];ne.push({...xt,indent:xt.indent+1})}q=Ft}return ne},$i=le=>{const we=le.qty_percent??le.qtyPct??le.qtyPctVal??le.qtyPercent,H=we!=null?Number(we):void 0,ne=le.qty??le.quantity,_e=le.cash??le.cashQty??le.cash_qty,q=le.oco??le.oca_name??le.ocaName??le.oca,De=q?Ri(String(q)):void 0,ot=le.expiresBars!=null?Number(le.expiresBars):void 0,je=le.commission??le.commissionPct??le.commission_pct,Ft=le.slippage??le.slippagePct??le.slippage_pct,Be=le.stop??le.stopPrice,xt=le.limit??le.limitPrice,an=le.price,Yn=(vo,To)=>{if(vo==null)return null;const co=So(String(vo),To);if(!co)return null;const so=co.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(so)return so[0];const Jo=bp(Ri(co));return Jo!=null?String(Jo):En(co,To)},bn=Yn(Be,"order_stop"),be=Yn(xt,"order_limit"),tt=Yn(an,"order_price"),wt=Yn(ne,"order_qty"),Lt=Yn(_e,"order_cash"),qt=je!=null?bp(Ri(String(je))):null,qn=Ft!=null?bp(Ri(String(Ft))):null,Xt={};return typeof H=="number"&&Number.isFinite(H)&&(Xt.qtyPct=H),wt&&(Xt.qty=wt),Lt&&(Xt.cash=Lt),De&&(Xt.oco=De),typeof ot=="number"&&Number.isFinite(ot)&&(Xt.expiresBars=ot),qt!=null&&Number.isFinite(qt)&&(Xt.commissionPct=qt),qn!=null&&Number.isFinite(qn)&&(Xt.slippagePct=qn),bn&&be?(Xt.kind="stop_limit",Xt.stopPrice=bn,Xt.limitPrice=be,Xt):be?(Xt.kind="limit",Xt.price=be,Xt):bn?(Xt.kind="stop",Xt.price=bn,Xt):tt?(Xt.kind="market",Xt):Object.keys(Xt).length?{kind:"market",...Xt}:null},hi=le=>{const we=q=>{let De=null,ot=0;const je=bn=>/[A-Za-z0-9_$]/.test(bn),Ft=q.toLowerCase(),Be=[{token:"cooldown_bars",key:"cooldown"},{token:"cooldownbars",key:"cooldown"},{token:"cooldown",key:"cooldown"},{token:"score",key:"score"}];let xt=null;for(let bn=0;bn<q.length;bn++){const be=q[bn];if(De){be===De&&q[bn-1]!=="\\"&&(De=null);continue}if(be==="'"||be==='"'){De=be;continue}if(be==="("){ot+=1;continue}if(be===")"){ot=Math.max(0,ot-1);continue}if(!(ot>0)&&!(bn>0&&je(q[bn-1])))for(const tt of Be){if(!Ft.startsWith(tt.token,bn))continue;const wt=bn+tt.token.length;if(wt<q.length&&je(q[wt]))continue;let Lt=wt;for(;Lt<q.length&&/\s/.test(q[Lt]);)Lt+=1;const qt=q[Lt];if(!(qt!=="="&&qt!==":")){xt={key:tt.key,start:bn,valueStart:Lt+1};break}}}if(!xt)return null;const an=q.slice(0,xt.start).replace(/[,;]+\s*$/,"").trim(),Yn=q.slice(xt.valueStart).trim();return{key:xt.key,when:an,value:Yn}};let H=le.trim(),ne,_e;for(let q=0;q<4;q++){const De=we(H);if(!De)break;H=De.when,De.key==="score"&&ne==null&&(ne=De.value),De.key==="cooldown"&&_e==null&&(_e=De.value)}return{when:H.trim(),scoreRaw:ne,cooldownRaw:_e}},li=(le,we,H)=>{if(le==null)return;const ne=So(String(le),H),_e=Pt(ne);if(_e==null||!Number.isFinite(_e)){e.push({message:"score must be an integer between 0 and 10",line:we});return}if(!Number.isInteger(_e)){e.push({message:"score must be an integer between 0 and 10",line:we});return}if(_e<0||_e>10){e.push({message:"score must be in range 0..10",line:we});return}return _e},ks=(le,we,H)=>{if(le==null)return;const ne=So(String(le),H),_e=Pt(ne);if(_e==null||!Number.isFinite(_e)){e.push({message:"cooldown must be a non-negative integer",line:we});return}if(!Number.isInteger(_e)){e.push({message:"cooldown must be a non-negative integer",line:we});return}if(_e<0){e.push({message:"cooldown must be a non-negative integer",line:we});return}return _e},Vi=(le,we,H)=>{const ne=le.cooldown??le.cooldownBars??le.cooldown_bars??le.cooldownbars;return ne==null?{value:void 0,hadRaw:!1}:{value:ks(String(ne),we,H),hadRaw:!0}};for(let le=0;le<a.length;le++){const we=a[le],H=we.lineNo;let ne=we.text.trim();if(!ne||ne.startsWith("//@pine_fn")||(/^\s*export\s+/i.test(ne)&&(ne=c(ne),a[le]={...we,text:ne}),ne.match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i))||ne.match(/^library\s*\((.*)\)\s*$/i))continue;const De=ne.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*switch\s*(?:\((.*)\)|(.*))$/i);if(De){const Ht=De[3],qe=ne.includes(":=")?":=":"=",fn=String(De[4]??De[5]??"").trim(),Fn=we.indent,Vt=[];let mn=le+1;for(;mn<a.length&&a[mn].indent>Fn;){const Hn=a[mn].text.trim(),No=Hn.indexOf("=>");if(No>=0){const Mo=Hn.slice(0,No).trim(),qs=Hn.slice(No+2).trim();Vt.push({cond:Mo||void 0,expr:qs||void 0,lineNo:a[mn].lineNo})}mn+=1}if(!Vt.length){e.push({message:"switch requires at least one case",line:H});continue}const Kn=fn?So(fn,`switch_${Ht}`):"";let Pn="na";for(let Hn=Vt.length-1;Hn>=0;Hn--){const No=Vt[Hn],Mo=No.expr?So(No.expr,`switch_${Ht}_case`):"na";if(!No.cond){Pn=Mo;continue}Pn=`iff(${Kn?`(${Kn}) == (${So(No.cond,`switch_${Ht}_cond`)})`:`(${So(No.cond,`switch_${Ht}_cond`)})`}, ${Mo}, ${Pn})`}a.splice(le,mn-le,{text:`${Ht} ${qe} ${Pn}`,indent:Fn,lineNo:H}),le-=1;continue}const ot=ne.match(/^switch\s*(?:\((.*)\)|(.*))$/i);if(ot){const Ht=String(ot[1]??ot[2]??"").trim(),qe=we.indent,fn=[];let Fn=le+1;for(;Fn<a.length&&a[Fn].indent>qe;){const Kn=a[Fn].text.trim(),Pn=Kn.indexOf("=>");if(Pn>=0){const Hn=Kn.slice(0,Pn).trim(),No=Kn.slice(Pn+2).trim();fn.push({cond:Hn||void 0,expr:No||void 0,lineNo:a[Fn].lineNo})}Fn+=1}if(!fn.length){e.push({message:"switch requires at least one case",line:H});continue}const Vt=Ht?So(Ht,"switch_expr"):"",mn=[];fn.forEach((Kn,Pn)=>{if(Kn.expr){if(!Kn.cond)mn.push({text:"else",indent:qe,lineNo:Kn.lineNo});else if(Pn===0){const Hn=Vt?`(${Vt}) == (${So(Kn.cond,"switch_cond")})`:`(${So(Kn.cond,"switch_cond")})`;mn.push({text:`if (${Hn})`,indent:qe,lineNo:Kn.lineNo})}else{const Hn=Vt?`(${Vt}) == (${So(Kn.cond,"switch_cond")})`:`(${So(Kn.cond,"switch_cond")})`;mn.push({text:`else if (${Hn})`,indent:qe,lineNo:Kn.lineNo})}mn.push({text:Kn.expr,indent:qe+1,lineNo:Kn.lineNo})}}),a.splice(le,Fn-le,...mn),le-=1;continue}const je=ne.match(/^for\s+([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+?)\s+to\s+(.+?)(?:\s+by\s+(.+))?$/i);if(je){const Ht=je[1],qe=String(je[2]??"").trim(),fn=String(je[3]??"").trim(),Fn=String(je[4]??"1").trim(),Vt=Es(qe,"for_start"),mn=Es(fn,"for_end"),Kn=Es(Fn,"for_step"),Pn=nt(Vt),Hn=nt(mn),No=nt(Kn);if(No===0){e.push({message:"for-loop step must not be 0",line:H});continue}const Mo=[],qs=we.indent;let ta=le+1;for(;ta<a.length&&a[ta].indent>qs;)a[ta].text.startsWith("//@pine_fn")||Mo.push(a[ta]),ta+=1;if(!Mo.length){e.push({message:"for-loop requires an indented body",line:H});continue}const Nc=Mo.some(Yt=>{const Xo=Yt.text.trim();return Xo==="break"||Xo==="continue"}),Tc=Nc?++di:0,Sl=Nc?`__loop_break_${Tc}`:"",Ks=Nc?`__loop_continue_${Tc}`:"",ci=(Yt,Xo)=>{let as=Yt;return typeof Xo=="number"&&(as=as.replace(/\barray\.get\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([A-Za-z_$][A-Za-z0-9_$]*|[-+]?\d+(?:\.\d+)?)\s*\)/gi,(Pi,As,Xs)=>{const Hr=Ye(String(As));if(ee[Hr])return Pi;const Xl=Y[Hr],Nd=oe[Hr];if(!Xl&&!Nd)return Pi;const Ru=Ye(String(Xs))===Ye(Ht)?Math.floor(Xo):bp(String(Xs))!=null?Math.floor(bp(String(Xs))):NaN;if(!Number.isFinite(Ru))return Pi;if(Xl){const Vl=Xl[Ru];return typeof Vl=="number"&&Number.isFinite(Vl)?String(Vl):"na"}const Xc=Nd==null?void 0:Nd[Ru];return Xc!=null?JSON.stringify(Xc):'""'})),ct(as,{[Ht]:String(Xo)})};if(!Nc&&Pn!=null&&Hn!=null&&No!=null&&No!==0){const Yt=[];if(No>0)for(let as=Pn;as<=Hn+1e-12;as+=No)for(const Pi of Mo)Yt.push({...Pi,text:ci(Pi.text,as),indent:qs,loopSeq:!0});else for(let as=Pn;as>=Hn-1e-12;as+=No)for(const Pi of Mo)Yt.push({...Pi,text:ci(Pi.text,as),indent:qs,loopSeq:!0});a.splice(le,ta-le,...Yt),le-=1;continue}const Lo=So(qe,`for_start_${Ht}`),ln=So(fn,`for_end_${Ht}`),or=So(Fn,`for_step_${Ht}`);if(nt(or)===0){e.push({message:"for-loop step must not be 0",line:H});continue}t.push({message:`Runtime for-loop expanded to ${xe} iterations`,line:H});const Zi=[];Nc&&(Zi.push({text:`var ${Sl} = 0`,indent:qs,lineNo:H}),Zi.push({text:`var ${Ks} = 0`,indent:qs,lineNo:H}),Zi.push({text:`${Sl} := 0`,indent:qs,lineNo:H}));for(let Yt=0;Yt<xe;Yt++){const Xo=`(${Lo}) + (${or}) * ${Yt}`,as=`(${or}) != 0 and (((${or}) > 0 and (${Xo}) <= (${ln})) or (((${or}) < 0) and (${Xo}) >= (${ln})))`,Pi=Nc?`(${Sl} == 0) and (${as})`:as;Zi.push({text:`if (${Pi})`,indent:qs,lineNo:H,loopSeq:!0});const As=Mo.map(Hr=>({...Hr,text:ci(Hr.text,`(${Xo})`),loopSeq:!0})),Xs=Nc?ns(As,Sl,Ks):As;Nc&&Xs.unshift({text:`${Ks} := 0`,indent:qs+1,lineNo:H,loopSeq:!0}),Xs.forEach(Hr=>Zi.push(Hr))}a.splice(le,ta-le,...Zi),le-=1;continue}const Ft=ne.match(/^while\s*(?:\((.*)\)|(.*))$/i);if(Ft){const Ht=String(Ft[1]??Ft[2]??"").trim();if(!Ht){e.push({message:"while statement missing condition",line:H});continue}const qe=we.indent,fn=[];let Fn=le+1;for(;Fn<a.length&&a[Fn].indent>qe;)a[Fn].text.startsWith("//@pine_fn")||fn.push(a[Fn]),Fn+=1;if(!fn.length){e.push({message:"while-loop requires an indented body",line:H});continue}const Vt=fn.some(No=>{const Mo=No.text.trim();return Mo==="break"||Mo==="continue"}),mn=Vt?++di:0,Kn=Vt?`__loop_break_${mn}`:"",Pn=Vt?`__loop_continue_${mn}`:"";t.push({message:`Runtime while-loop expanded to ${xe} iterations`,line:H});const Hn=[];Vt&&(Hn.push({text:`var ${Kn} = 0`,indent:qe,lineNo:H}),Hn.push({text:`var ${Pn} = 0`,indent:qe,lineNo:H}),Hn.push({text:`${Kn} := 0`,indent:qe,lineNo:H}));for(let No=0;No<xe;No++){const Mo=Vt?`(${Kn} == 0) and (${Ht})`:Ht;Hn.push({text:`if (${Mo})`,indent:qe,lineNo:H,loopSeq:!0});const qs=fn.map(Nc=>({...Nc,loopSeq:!0})),ta=Vt?ns(qs,Kn,Pn):qs;Vt&&ta.unshift({text:`${Pn} := 0`,indent:qe+1,lineNo:H,loopSeq:!0}),ta.forEach(Nc=>Hn.push(Nc))}a.splice(le,Fn-le,...Hn),le-=1;continue}const Be=ne.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(Be){const Ht=String(Be[1]??Be[2]??"").trim();if(!Ht){e.push({message:"if statement missing condition",line:H});continue}const qe=we.indent,fn=Yt=>{const Xo=[];let as=Yt;for(;as<a.length&&a[as].indent>qe;)a[as].text.startsWith("//@pine_fn")||Xo.push(a[as]),as+=1;return{body:Xo,nextIdx:as}},Fn=[],Vt=fn(le+1);if(!Vt.body.length){e.push({message:"if statement requires an indented body",line:H});continue}Fn.push({condRaw:Ht,body:Vt.body,lineNo:H});let mn=Vt.nextIdx;for(;mn<a.length&&a[mn].indent===qe;){const Yt=a[mn].text.trim(),Xo=Yt.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(Xo){const Pi=String(Xo[1]??Xo[2]??"").trim();if(!Pi){e.push({message:"else if missing condition",line:a[mn].lineNo});break}const As=fn(mn+1);if(!As.body.length){e.push({message:"else if requires an indented body",line:a[mn].lineNo});break}Fn.push({condRaw:Pi,body:As.body,lineNo:a[mn].lineNo}),mn=As.nextIdx;continue}if(Yt.match(/^else$/i)){const Pi=fn(mn+1);if(!Pi.body.length){e.push({message:"else requires an indented body",line:a[mn].lineNo});break}Fn.push({condRaw:void 0,body:Pi.body,lineNo:a[mn].lineNo}),mn=Pi.nextIdx;break}break}const Kn=[],Pn=[];Fn.forEach((Yt,Xo)=>{if(!Yt.condRaw){Kn.push(null),Pn.push(null);return}const as=So(Yt.condRaw,`if_${Xo+1}`);Kn.push(yd(as)),Pn.push(tn(Dv(as)))});const Hn=(Yt,Xo)=>{const as=Yt.slice(0,Xo).filter(Boolean);return as.length?as.map(Pi=>`(${Pi})`).join(" or "):""},No=Yt=>{const Xo=Kn[Yt],as=Hn(Kn,Yt);return Xo?as?`((${Xo}) and not (${as}))`:`(${Xo})`:as?`not (${as})`:"1"},Mo=Yt=>{const Xo=Pn[Yt],as=Hn(Pn,Yt);return Xo?as?`((${Xo}) and not (${as}))`:`(${Xo})`:as?`not (${as})`:"1"},qs=(Yt,Xo)=>{var Nd,Ru;const as=Yt.match(/^array\.set\s*\((.*)\)\s*$/i);if(as){const Xc=xr(as[1]||""),Vl=String(Xc[0]||"").trim(),_l=String(Xc[1]||"").trim(),Et=String(Xc[2]||"").trim();if(!Vl||!_l||!Et)return e.push({message:"array.set(name, index, value) requires 3 args",line:Xo}),null;const Nn=Ye(Vl),pn=Y[Nn],os=ee[Nn];if(!pn&&!os)return e.push({message:`array.set unknown array "${Vl}"`,line:Xo}),null;const Ps=_t(Nn,_l);if(Ps!=null){const Wd=(os==null?void 0:os.size)??(pn==null?void 0:pn.length)??Ps+1;ue(Nn,Wd,pn);const kp=So(Et,`${Nn}_${Ps}`),Ov=nt(kp);return pn&&Ov!=null&&(pn[Ps]=Ov),[{name:Ve(Nn,Ps),hasVar:!1,declaredType:"",op:":=",rhs:kp,lineNo:Xo}]}const sr=So(_l,`${Nn}_idx`),Cl=So(Et,`${Nn}_set`),Lc=(Nd=ee[Nn])==null?void 0:Nd.sizeSeries,cp=Lc!=null?`(${sr}) >= 0 and (${sr}) < ${Lc}`:void 0,qp=jt(Nn,sr,Cl,cp);return qp?qp.map((Wd,kp)=>({name:Ve(Nn,kp),hasVar:!1,declaredType:"",op:":=",rhs:Wd,lineNo:Xo})):(e.push({message:"array.set index must be within array size",line:Xo}),null)}const Pi=Yt.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(Pi){const Xc=String(Pi[1]||"").toLowerCase(),Vl=xr(Pi[2]||""),_l=String(Vl[0]||"").trim(),Et=Ye(_l);if(!_l)return e.push({message:`array.${Xc} requires array name`,line:Xo}),null;if(!ee[Et]&&!Y[Et])return e.push({message:`array.${Xc} unknown array "${_l}"`,line:Xo}),null;!ee[Et]&&Y[Et]&&ue(Et,Y[Et].length,Y[Et]);const Nn=ee[Et];if(!Nn)return null;if(Xc==="push"||Xc==="unshift"||Xc==="insert"){const Ps=Math.min(yt,Math.max(Nn.capacity,Nn.size+Qe));he(Et,Ps)}if(Xc==="resize"){const Ps=String(Vl[1]||"0"),sr=nt(Ps);if(sr!=null){const Cl=Math.min(yt,Math.max(Nn.capacity,Math.floor(sr)));he(Et,Cl)}}un(Et);const pn={};Xc==="push"||Xc==="unshift"?pn.value=Vl[1]:Xc==="insert"?(pn.index=Vl[1],pn.value=Vl[2]):Xc==="remove"?pn.index=Vl[1]:Xc==="resize"&&(pn.size=Vl[1]);const os=On(Et,Xc,pn,Xo);return os||null}const As=Yt.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(!As)return null;const Xs=String(As[5]||"").trim();if(/^(line|label|box|table|linefill)\.new\s*\(/i.test(Xs)||/^table\.cell\s*\(/i.test(Xs))return null;const Hr=Xs.match(/^array\.(pop|shift|remove)\s*\((.*)\)\s*$/i);if(Hr){const Xc=String(Hr[1]||"").toLowerCase(),Vl=xr(Hr[2]||""),_l=String(Vl[0]||"").trim(),Et=Ye(_l);if(!_l)return e.push({message:`array.${Xc} requires array name`,line:Xo}),null;if(!ee[Et]&&!Y[Et])return e.push({message:`array.${Xc} unknown array "${_l}"`,line:Xo}),null;if(!ee[Et]&&Y[Et]&&ue(Et,Y[Et].length,Y[Et]),!ee[Et])return null;un(Et);const pn=Xc==="pop"?`array.size(${_l}) - 1`:Xc==="shift"?"0":String(Vl[1]||"0"),os=So(`array.get(${_l}, ${pn})`,As[3]||"array_pop"),Ps=On(Et,Xc==="pop"?"pop":Xc==="shift"?"shift":"remove",{index:Vl[1]},Xo);return Ps?[{name:As[3],hasVar:!!As[1],declaredType:As[2]?String(As[2]).toLowerCase():"",op:As[4],rhs:os,lineNo:Xo},...Ps]:null}const Xl=Xs.match(/^array\.(copy|concat)\s*\((.*)\)\s*$/i);if(Xl){const Xc=String(Xl[1]||"").toLowerCase(),Vl=xr(Xl[2]||""),_l=Ye(As[3]);if(Xc==="copy"){const sr=String(Vl[0]||"").trim(),Cl=Ye(sr);if(!sr)return e.push({message:"array.copy requires source array name",line:Xo}),null;if(oe[Cl])return oe[_l]=[...oe[Cl]],St(_l),[];if(!ee[Cl]&&!Y[Cl])return e.push({message:`array.copy unknown array "${sr}"`,line:Xo}),null;!ee[Cl]&&Y[Cl]&&ue(Cl,Y[Cl].length,Y[Cl]);const Lc=no(_l,Cl,Xo);return Lc?((Ru=ee[Cl])!=null&&Ru.dynamic&&ee[_l]&&(ee[_l].dynamic=!0),Lc):null}const Et=String(Vl[0]||"").trim(),Nn=String(Vl[1]||"").trim(),pn=Ye(Et),os=Ye(Nn);if(!Et||!Nn)return e.push({message:"array.concat requires two arrays",line:Xo}),null;if(oe[pn]||oe[os])return!oe[pn]||!oe[os]?(e.push({message:"array.concat string arrays must be same type",line:Xo}),null):(oe[_l]=[...oe[pn],...oe[os]],St(_l),[]);if(!ee[pn]&&!Y[pn])return e.push({message:`array.concat unknown array "${Et}"`,line:Xo}),null;if(!ee[os]&&!Y[os])return e.push({message:`array.concat unknown array "${Nn}"`,line:Xo}),null;!ee[pn]&&Y[pn]&&ue(pn,Y[pn].length,Y[pn]),!ee[os]&&Y[os]&&ue(os,Y[os].length,Y[os]);const Ps=fs(_l,pn,os,Xo);return Ps||null}return[{name:As[3],hasVar:!!As[1],declaredType:As[2]?String(As[2]).toLowerCase():"",op:As[4],rhs:So(Xs,As[3]),lineNo:Xo}]},ta={},Nc=[],Tc=(Yt,Xo)=>{for(const as of Yt){const Pi=qs(as.text,as.lineNo);if(Pi){for(const As of Pi){const Xs=Ye(As.name),Hr=ta[Xs]||(ta[Xs]={base:void 0,branches:new Array(Fn.length).fill(null)});Hr.base||(Hr.base=As),Hr.branches[Xo]=As}continue}Nc.push({text:as.text,lineNo:as.lineNo,branchIndex:Xo,indent:as.indent})}};Fn.forEach((Yt,Xo)=>Tc(Yt.body,Xo));const Sl=(Yt,Xo)=>{let as=!1;const Pi=Yt.map(As=>as||wc(As)?As:(as=!0,Xo));return as||Pi.unshift(Xo),Pi},Ks=(Yt,Xo,as)=>{const Pi=Xo.match(new RegExp(`^${Yt}\\s*\\((.*)\\)\\s*$`,"i"));if(!Pi)return null;const As=xr(Pi[1]||""),Xs=No(as),Hr=Mo(as);if(Yt==="plot"){const Ru=As.find(Vl=>!wc(Vl))||"",Xc=`iff(${Xs}, ${Ru||"na"}, na)`;return`${Yt}(${Sl(As,Xc).join(", ")})`}const Xl=As.find(Ru=>!wc(Ru))||"",Nd=Xl?`${Hr} and (${Xl})`:Hr;return`${Yt}(${Sl(As,Nd).join(", ")})`},ci=(Yt,Xo)=>{const as=Yt.match(/^signal\s+([A-Za-z_$][A-Za-z0-9_$]*)\s+when\s+(.+)$/i);if(!as)return null;const Pi=as[1],As=String(as[2]||"").trim(),Xs=Mo(Xo),Hr=As?`${Xs} and (${As})`:Xs;return`signal ${Pi} when ${Hr}`},Lo=(Yt,Xo)=>{const as=Yt.match(/^(strategy\.(entry|exit|close|close_all|order|cancel|cancel_all))\s*\((.*)\)\s*$/i);if(!as)return null;const Pi=as[1],As=xr(as[3]||""),Xs=Mo(Xo);let Hr=!1;const Xl=As.map(Nd=>/^\s*when\s*=/.test(Nd)?(Hr=!0,`when=${Xs} and (${Nd.replace(/^\s*when\s*=\s*/i,"")})`):Nd);return Hr||Xl.push(`when=${Xs}`),`${Pi}(${Xl.join(", ")})`},ln=(Yt,Xo,as)=>{const Pi=Xo.match(new RegExp(`^(?:varip\\s+|var\\s+)?(?:(?:float|int|bool|string|line|label|box|table|linefill)\\s+)?[A-Za-z_$][A-Za-z0-9_$]*\\s*(?::=|=)\\s*${Yt}\\s*\\((.*)\\)\\s*$`,"i")),As=Xo.match(new RegExp(`^${Yt}\\s*\\((.*)\\)\\s*$`,"i"));if(!Pi&&!As)return null;const Xs=xr(((Pi==null?void 0:Pi[1])||(As==null?void 0:As[1]))??""),Hr=Mo(as);let Xl=!1;const Nd=Xs.map(Ru=>/^\s*when\s*=/.test(Ru)?(Xl=!0,`when=${Hr} and (${Ru.replace(/^\s*when\s*=\s*/i,"")})`):Ru);return Xl||Nd.push(`when=${Hr}`),`${Yt}(${Nd.join(", ")})`},or=(Yt,Xo)=>{const as=Yt.match(/^(line|label|box|table|linefill|polyline|polygon|path)\.([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(!as)return null;const Pi=`${String(as[1]).toLowerCase()}.${String(as[2]).toLowerCase()}`,As=xr(as[3]||""),Xs=Mo(Xo);let Hr=!1;const Xl=As.map(Nd=>/^\s*when\s*=/.test(Nd)?(Hr=!0,`when=${Xs} and (${Nd.replace(/^\s*when\s*=\s*/i,"")})`):Nd);return Hr||Xl.push(`when=${Xs}`),`${Pi}(${Xl.join(", ")})`},tr=[],Zi=(Yt,Xo,as)=>tr.push({text:Yt,indent:as??qe,lineNo:Xo,loopSeq:!!we.loopSeq});Object.values(ta).forEach(Yt=>{var Ru,Xc;const Xo=Yt.base;if(!Xo)return;const as=!!Yt.branches.some(Vl=>Vl==null?void 0:Vl.hasVar),Pi=((Ru=Yt.branches.find(Vl=>Vl==null?void 0:Vl.declaredType))==null?void 0:Ru.declaredType)||"",As=((Xc=Yt.branches.find(Vl=>Vl==null?void 0:Vl.op))==null?void 0:Xc.op)||"=",Xs=As===":="?Xo.name:"na",Hr=Vl=>{for(let _l=Vl;_l<Fn.length;_l++){const Et=Yt.branches[_l];if(!Et)continue;const Nn=Kn[_l],pn=Hr(_l+1);return Nn?`iff(${Nn}, ${Et.rhs}, ${pn})`:Et.rhs}return Xs},Xl=Hr(0),Nd=`${as?"var ":""}${Pi?`${Pi} `:""}`;Zi(`${Nd}${Xo.name} ${As} ${Xl}`,Xo.lineNo)});for(const Yt of Nc){const Xo=Yt.text.trim(),as=No(Yt.branchIndex);Mo(Yt.branchIndex);const Pi=Xo.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(Pi){const Hr=String(Pi[1]??Pi[2]??"").trim(),Xl=as&&as!=="1"?`(${as}) and (${Hr})`:Hr;Zi(`if (${Xl})`,Yt.lineNo,Yt.indent);continue}const As=Xo.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(As){const Hr=String(As[1]??As[2]??"").trim(),Xl=as&&as!=="1"?`(${as}) and (${Hr})`:Hr;Zi(`else if (${Xl})`,Yt.lineNo,Yt.indent);continue}if(/^else$/i.test(Xo)){Zi(as&&as!=="1"?`else if (${as})`:"else",Yt.lineNo,Yt.indent);continue}const Xs=Ks("plot",Yt.text,Yt.branchIndex)||Ks("plotshape",Yt.text,Yt.branchIndex)||Ks("plotchar",Yt.text,Yt.branchIndex)||ln("line.new",Yt.text,Yt.branchIndex)||ln("linefill.new",Yt.text,Yt.branchIndex)||ln("label.new",Yt.text,Yt.branchIndex)||ln("box.new",Yt.text,Yt.branchIndex)||ln("polyline.new",Yt.text,Yt.branchIndex)||ln("polygon.new",Yt.text,Yt.branchIndex)||ln("path.new",Yt.text,Yt.branchIndex)||ln("table.cell",Yt.text,Yt.branchIndex)||or(Yt.text,Yt.branchIndex)||ci(Yt.text,Yt.branchIndex)||Lo(Yt.text,Yt.branchIndex);if(Xs){Zi(Xs,Yt.lineNo,Yt.indent);continue}e.push({message:`Unsupported statement inside if: ${Yt.text}`,line:Yt.lineNo})}tr.length||t.push({message:"if statement produced no output",line:H}),a.splice(le,mn-le,...tr),le-=1;continue}const xt=ne.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.from\s*\((.*)\)\s*$/i);if(xt){const Ht=Ye(xt[1]),qe=xr(xt[2]||""),fn=[],Fn=[];let Vt=!1,mn=!1,Kn=!0;for(const Pn of qe){const Hn=String(Pn||"").trim();if(Hn.startsWith('"')&&Hn.endsWith('"')||Hn.startsWith("'")&&Hn.endsWith("'")){Fn.push(Ri(Hn)),Vt=!0;continue}const Mo=So(Hn,`array_from_${Ht}`),qs=nt(Mo);if(qs==null){Kn=!1;break}fn.push(qs),mn=!0}if(!Kn||!fn.length&&!Fn.length||Vt&&mn){e.push({message:"array.from(...) supports only all-numeric or all-string literals (compile-time)",line:H});continue}Vt?(oe[Ht]=Fn,St(Ht)):(ue(Ht,fn.length,fn),Y[Ht]=fn);continue}const an=ne.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.new_(float|int|bool|string)\s*\((.*)\)\s*$/i);if(an){const Ht=Ye(an[1]),qe=String(an[2]||"").toLowerCase(),fn=xr(an[3]||""),Fn=fn[0]??"0",Vt=fn[1]??"0",mn=nt(Fn);if(mn==null||mn<0){e.push({message:"array.new_* size must be a numeric constant or param",line:H});continue}if(qe==="string"){let Hn="";const No=String(Vt??"").trim();(No.startsWith('"')&&No.endsWith('"')||No.startsWith("'")&&No.endsWith("'"))&&(Hn=Ri(No));const qs=new Array(Math.floor(mn));for(let ta=0;ta<qs.length;ta++)qs[ta]=Hn;oe[Ht]=qs,St(Ht);continue}let Kn=nt(Vt);if(Kn==null){const Hn=sm(String(Vt));Hn!=null&&(Kn=Hn?1:0)}Kn==null&&(Kn=0);const Pn=new Array(Math.floor(mn));for(let Hn=0;Hn<Pn.length;Hn++)Pn[Hn]=Kn;ue(Ht,Pn.length,Pn);continue}const Yn=ne.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(Yn){const Ht=String(Yn[1]||"").toLowerCase(),qe=xr(Yn[2]||""),fn=String(qe[0]||"").trim(),Fn=Ye(fn);if(!fn){e.push({message:`array.${Ht} requires array name`,line:H});continue}if(oe[Fn]){t.push({message:`array.${Ht} on string arrays is not supported yet (ignored)`,line:H});continue}if(!ee[Fn]&&!Y[Fn]){e.push({message:`array.${Ht} unknown array "${fn}"`,line:H});continue}!ee[Fn]&&Y[Fn]&&ue(Fn,Y[Fn].length,Y[Fn]);const Vt=ee[Fn];if(!Vt)continue;if(Ht==="push"||Ht==="unshift"||Ht==="insert"){const Hn=Math.min(yt,Math.max(Vt.capacity,Vt.size+Qe));he(Fn,Hn)}if(Ht==="resize"){const Hn=String(qe[1]||"0"),No=nt(Hn);if(No!=null){const Mo=Math.min(yt,Math.max(Vt.capacity,Math.floor(No)));he(Fn,Mo)}}un(Fn);const mn={};Ht==="push"||Ht==="unshift"?mn.value=qe[1]:Ht==="insert"?(mn.index=qe[1],mn.value=qe[2]):Ht==="remove"?mn.index=qe[1]:Ht==="resize"&&(mn.size=qe[1]);const Kn=On(Fn,Ht,mn,H);if(!Kn)continue;const Pn=Kn.map(Hn=>({text:`${Hn.name} ${Hn.op} ${Hn.rhs}`,indent:we.indent,lineNo:H,loopSeq:we.loopSeq}));a.splice(le,1,...Pn),le-=1;continue}const bn=ne.match(/^array\.set\s*\((.*)\)\s*$/i);if(bn){const Ht=xr(bn[1]||""),qe=String(Ht[0]||"").trim(),fn=String(Ht[1]||"").trim(),Fn=String(Ht[2]||"").trim();if(!qe||!fn||!Fn){e.push({message:"array.set(name, index, value) requires 3 args",line:H});continue}const Vt=Ye(qe),mn=Y[Vt],Kn=oe[Vt],Pn=ee[Vt];if(!mn&&!Pn&&!Kn){e.push({message:`array.set unknown array "${qe}"`,line:H});continue}if(Kn){const No=_t(Vt,fn);if(No==null){t.push({message:"array.set string index must be constant",line:H});continue}const Mo=String(Fn||"").trim();if(!(Mo.startsWith('"')&&Mo.endsWith('"')||Mo.startsWith("'")&&Mo.endsWith("'"))){t.push({message:"array.set string value must be a literal",line:H});continue}Kn[No]=Ri(Mo),St(Vt);continue}const Hn=_t(Vt,fn);if(Hn!=null){const No=(Pn==null?void 0:Pn.size)??(mn==null?void 0:mn.length)??Hn+1;ue(Vt,No,mn);const Mo=So(Fn,`${Vt}_${Hn}`),qs=nt(Mo);mn&&qs!=null&&(mn[Hn]=qs),ne=`${Ve(Vt,Hn)} := ${Mo}`}else{const No=So(fn,`${Vt}_idx`),Mo=So(Fn,`${Vt}_set`),qs=(mi=ee[Vt])==null?void 0:mi.sizeSeries,ta=qs!=null?`(${No}) >= 0 and (${No}) < ${qs}`:void 0,Nc=jt(Vt,No,Mo,ta);if(!Nc){e.push({message:"array.set index must be within array size",line:H});continue}const Tc=Nc.map((Sl,Ks)=>({text:`${Ve(Vt,Ks)} := ${Sl}`,indent:we.indent,lineNo:H,loopSeq:we.loopSeq}));a.splice(le,1,...Tc),le-=1;continue}}const be=ne.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(be){const Ht=!!be[1],qe=be[2]?String(be[2]).toLowerCase():"",fn=be[3],Fn=be[4],Vt=String(be[5]||"").trim(),mn=Vt.match(/^(line|label|box|table|linefill|polyline|polygon|path)\.new\s*\((.*)\)\s*$/i);if(mn){const ci=String(mn[1]||"").toLowerCase();if(ci==="line"){cd(mn[2]||"",H,fn,Ht);continue}if(ci==="linefill"){ml(mn[2]||"",H,fn,Ht);continue}if(ci==="label"){Sd(mn[2]||"",H,fn,Ht);continue}if(ci==="box"){Nl(mn[2]||"",H,fn,Ht);continue}if(ci==="table"){dd(mn[2]||"",H,fn,Ht);continue}if(ci==="polyline"){Kl(mn[2]||"",H,fn,Ht);continue}if(ci==="polygon"){zd(mn[2]||"",H,fn,Ht);continue}if(ci==="path"){kc(mn[2]||"",H,fn,Ht);continue}}const Kn=Vt.match(/^table\.cell\s*\((.*)\)\s*$/i);if(Kn){Cd(Kn[1]||"",H);continue}const Pn=Vt.match(/^plot\s*\((.*)\)\s*$/i);if(Pn){hn(Pn[1]||"",H,fn);continue}const Hn=Vt.match(/^array\.(pop|shift|remove)\s*\((.*)\)\s*$/i);if(Hn){const ci=String(Hn[1]||"").toLowerCase(),Lo=xr(Hn[2]||""),ln=String(Lo[0]||"").trim(),or=Ye(ln);if(!ln){e.push({message:`array.${ci} requires array name`,line:H});continue}if(!ee[or]&&!Y[or]){e.push({message:`array.${ci} unknown array "${ln}"`,line:H});continue}if(!ee[or]&&Y[or]&&ue(or,Y[or].length,Y[or]),!ee[or])continue;un(or);const Zi=ci==="pop"?`array.size(${ln}) - 1`:ci==="shift"?"0":String(Lo[1]||"0"),Yt=So(`array.get(${ln}, ${Zi})`,fn),Xo=On(or,ci==="pop"?"pop":ci==="shift"?"shift":"remove",{index:Lo[1]},H);if(!Xo)continue;const Pi=[{text:`${`${Ht?"var ":""}${qe?`${qe} `:""}`}${fn} ${Fn} ${Yt}`,indent:we.indent,lineNo:H,loopSeq:we.loopSeq},...Xo.map(As=>({text:`${As.name} ${As.op} ${As.rhs}`,indent:we.indent,lineNo:H,loopSeq:we.loopSeq}))];a.splice(le,1,...Pi),le-=1;continue}const No=Vt.match(/^array\.(copy|concat)\s*\((.*)\)\s*$/i);if(No){const ci=String(No[1]||"").toLowerCase(),Lo=xr(No[2]||""),ln=Ye(fn);if(ci==="copy"){const Pi=String(Lo[0]||"").trim(),As=Ye(Pi);if(!Pi){e.push({message:"array.copy requires source array name",line:H});continue}if(oe[As]){oe[ln]=[...oe[As]],St(ln),a.splice(le,1),le-=1;continue}if(!ee[As]&&!Y[As]){e.push({message:`array.copy unknown array "${Pi}"`,line:H});continue}!ee[As]&&Y[As]&&ue(As,Y[As].length,Y[As]);const Xs=no(ln,As,H);if(!Xs)continue;(Na=ee[As])!=null&&Na.dynamic&&ee[ln]&&(ee[ln].dynamic=!0);const Hr=Xs.map(Xl=>({text:`${Xl.name} ${Xl.op} ${Xl.rhs}`,indent:we.indent,lineNo:H,loopSeq:we.loopSeq}));a.splice(le,1,...Hr),le-=1;continue}const or=String(Lo[0]||"").trim(),tr=String(Lo[1]||"").trim(),Zi=Ye(or),Yt=Ye(tr);if(!or||!tr){e.push({message:"array.concat requires two arrays",line:H});continue}if(oe[Zi]||oe[Yt]){if(!oe[Zi]||!oe[Yt]){e.push({message:"array.concat string arrays must be same type",line:H});continue}oe[ln]=[...oe[Zi],...oe[Yt]],St(ln),a.splice(le,1),le-=1;continue}if(!ee[Zi]&&!Y[Zi]){e.push({message:`array.concat unknown array "${or}"`,line:H});continue}if(!ee[Yt]&&!Y[Yt]){e.push({message:`array.concat unknown array "${tr}"`,line:H});continue}!ee[Zi]&&Y[Zi]&&ue(Zi,Y[Zi].length,Y[Zi]),!ee[Yt]&&Y[Yt]&&ue(Yt,Y[Yt].length,Y[Yt]);const Xo=fs(ln,Zi,Yt,H);if(!Xo)continue;const as=Xo.map(Pi=>({text:`${Pi.name} ${Pi.op} ${Pi.rhs}`,indent:we.indent,lineNo:H,loopSeq:we.loopSeq}));a.splice(le,1,...as),le-=1;continue}if(Fn===":="){const ci=Ye(fn);ci in R||fn in R||!!Z[ci]||M.some(ln=>Ye(String((ln==null?void 0:ln.name)||""))===ci)||F.some(ln=>Ye(String((ln==null?void 0:ln.name)||""))===ci)||j.some(ln=>Ye(String((ln==null?void 0:ln.name)||""))===ci)||t.push({message:`":=" used before "${fn}" is defined (use "=" for first assignment)`,line:H})}const Mo=p2(Vt);if(Mo){j.push({name:fn,type:"security",symbol:Mo.symbol,country:Mo.country,timeframe:Mo.timeframe,expr:Mo.expr,lookahead:Mo.lookahead,gaps:Mo.gaps,lower:Mo.lower});continue}const qs=So(Vt,fn);if(!fn.startsWith("__arr_")&&Eo(fn,qs,H))continue;if(it(qs)&&(Z[fn.replace(/\s+/g,"_").toLowerCase()]=Dv(qs)),(Ht||Fn===":=")&&qe!=="bool"&&qe!=="string"){const ci=Ye(fn),Lo=ci.startsWith("__arr_"),or=(()=>{const Zi=V[ci];if(typeof Zi=="number")return Zi;const Yt=F.length;return V[ci]=Yt,F.push({name:fn,initExpr:void 0,updateExpr:fn,selfMode:Lo?"current":void 0}),Yt})();if(Fn===":="){const Zi=Ye(fn),Yt=Object.prototype.hasOwnProperty.call(R,fn)?fn:Object.prototype.hasOwnProperty.call(R,Zi)?Zi:null;if(Yt&&F[or]&&!F[or].initExpr){const Xo=R[Yt];if(typeof Xo=="number"&&Number.isFinite(Xo))F[or].initExpr=String(Xo),delete R[Yt];else if(typeof Xo=="string"){const as=Number(Xo);Number.isFinite(as)&&(F[or].initExpr=String(as),delete R[Yt])}}}if((Lo||!!we.loopSeq)&&Fn===":="&&typeof V[ci]=="number"){F.push({name:fn,initExpr:void 0,updateExpr:qs,selfMode:"current"});continue}if(Ht&&Fn==="="){F[or].initExpr=qs;continue}if(Ht&&Fn===":="){F[or].initExpr=qs,F[or].updateExpr=qs;continue}F[or].updateExpr=qs;continue}const Sl=bp(qs);if(Sl!=null){R[fn]=Sl;continue}const Ks=sm(qs);if(Ks!=null){R[fn]=Ks;continue}if(qs.startsWith('"')&&qs.endsWith('"')||qs.startsWith("'")&&qs.endsWith("'")){R[fn]=Ri(qs);continue}M.push({name:fn,expr:qs});continue}const tt=ne.match(/^strategy\s*\((.*)\)\s*$/i);if(tt){const Ht=xr(tt[1]||""),qe=Ol(Ht),fn=G&&typeof G=="object"?{...G}:null,Fn=(...No)=>{for(const Mo of No){if(qe[Mo]==null)continue;const qs=Ri(String(qe[Mo])),ta=bp(qs);if(ta!=null)return ta}},Vt=(...No)=>{for(const Mo of No){if(qe[Mo]==null)continue;const qs=Ri(String(qe[Mo])),ta=bp(qs);return ta??qs}},mn=(...No)=>{for(const Mo of No)if(qe[Mo]!=null)return Ri(String(qe[Mo]))},Kn=Ri(String(qe.default_qty_type??qe.default_qty_type??"")).toLowerCase(),Pn=Number(qe.default_qty_value??qe.default_qty_value??NaN),Hn=Kn==="cash"?{type:"cash",value:Number.isFinite(Pn)?Pn:1e4}:Kn==="qty"?{type:"qty",value:Number.isFinite(Pn)?Pn:1}:{type:"percent_of_equity",value:Number.isFinite(Pn)?Pn:100};if(G={initialCapital:Fn("initial_capital","initialCapital")??1e4,from:Vt("from","start","startDate","dateFrom","rangeStart"),to:Vt("to","end","endDate","dateTo","rangeEnd"),session:mn("session","tradingSession","sessionTime"),orderSize:Hn,commissionPct:Fn("commissionPct","commission")??0,slippagePct:Fn("slippagePct","slippage")??0,spreadPct:Fn("spreadPct","spread_pct","spread")??(Fn("spreadBps","spread_bps")!=null?Fn("spreadBps","spread_bps")/100:void 0),leverage:Fn("leverage","lev","marginLeverage","margin_leverage")??void 0,maintenanceMarginPct:Fn("maintenanceMarginPct","maintenance_margin_pct","maintMarginPct")??void 0,liquidationFeePct:Fn("liquidationFeePct","liquidation_fee_pct","liqFeePct")??void 0,borrowPctPerYear:Fn("borrowPctPerYear","borrow_pct_per_year","shortBorrowPctPerYear")??void 0,fundingPctPerDay:Fn("fundingPctPerDay","funding_pct_per_day","funding")??void 0,positionMode:(()=>{const No=Ri(String(qe.positionMode??qe.position_mode??"")).toLowerCase();if(No)return No.includes("hedge")?"hedging":"netting"})()??void 0,closeMethod:(()=>{const No=Ri(String(qe.closeMethod??qe.close_method??qe.costBasis??qe.cost_basis??"")).toLowerCase();if(No)return No.includes("lifo")?"lifo":No.includes("avg")||No.includes("average")?"avg":"fifo"})()??void 0,priceTick:Fn("priceTick","price_tick","tickSize","tick_size","tick","minTick","min_tick")??void 0,qtyStep:Fn("qtyStep","qty_step","quantityStep","quantity_step","lotStep","lot_step")??void 0,minQty:Fn("minQty","min_qty","minimumQty","minimum_qty")??void 0,pyramiding:Fn("pyramiding")??1,execution:Ri(String(qe.execution??"intrabar_ohlc")),intrabarTieBreak:Ri(String(qe.intrabarTieBreak??"worst_case")),ohlcPath:Ri(String(qe.ohlcPath??"open_high_low_close")),allowShort:sm(String(qe.allowShort??""))??void 0,allowLong:sm(String(qe.allowLong??""))??void 0},fn){const No=["maxDrawdownPct","maxDrawdownCash","maxPositionPct","maxPositionCash","maxPositionQty","maxIntradayFilledOrders","maxIntradayLossPct","maxIntradayLossCash"];for(const Mo of No)fn[Mo]!=null&&(G[Mo]=fn[Mo])}continue}const wt=ne.match(/^strategy\.risk\.([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(wt){const Ht=String(wt[1]||"").trim().toLowerCase(),qe=xr(wt[2]||""),fn=Ol(qe),Fn=qe.filter(ta=>!wc(ta)),Vt=fn.value??fn.max??fn.size??Fn[0],mn=fn.type??fn.qty_type??fn.qtyType??fn.position_type??Fn[1],Kn=Vt!=null?bp(Ri(String(Vt))):null;if(Kn==null||!Number.isFinite(Kn)){e.push({message:`strategy.risk.${Ht}(...) requires numeric value`,line:H});continue}const Pn=mn!=null?Ri(String(mn)).toLowerCase():"",Hn=Pn.includes("percent")||Pn.includes("equity"),No=Pn.includes("cash")||Pn.includes("currency")||Pn.includes("fixed"),Mo=Pn.includes("qty")||Pn.includes("contract"),qs=Hn?"percent":No?"cash":Mo?"qty":"percent";if((!G||typeof G!="object")&&(G={enabled:!0}),Ht==="max_drawdown"||Ht==="max_drawdown_percent"){qs==="cash"?G.maxDrawdownCash=Kn:G.maxDrawdownPct=Kn;continue}if(Ht==="max_position_size"||Ht==="max_position"||Ht==="max_position_size_contracts"){qs==="cash"?G.maxPositionCash=Kn:qs==="qty"?G.maxPositionQty=Kn:G.maxPositionPct=Kn;continue}if(Ht==="max_intraday_filled_orders"||Ht==="max_intraday_orders"){G.maxIntradayFilledOrders=Math.max(0,Math.floor(Kn));continue}if(Ht==="max_intraday_loss"||Ht==="max_daily_loss"){qs==="cash"?G.maxIntradayLossCash=Kn:G.maxIntradayLossPct=Kn;continue}t.push({message:`Ignored strategy.risk method: ${Ht}`,line:H});continue}if(ne.match(/^(indicator|study)\s*\((.*)\)\s*$/i))continue;const qt=ne.match(/^line\.new\s*\((.*)\)\s*$/i);if(qt){cd(qt[1]||"",H);continue}const qn=ne.match(/^linefill\.new\s*\((.*)\)\s*$/i);if(qn){ml(qn[1]||"",H);continue}const Xt=ne.match(/^label\.new\s*\((.*)\)\s*$/i);if(Xt){Sd(Xt[1]||"",H);continue}const vo=ne.match(/^box\.new\s*\((.*)\)\s*$/i);if(vo){Nl(vo[1]||"",H);continue}const To=ne.match(/^polyline\.new\s*\((.*)\)\s*$/i);if(To){Kl(To[1]||"",H);continue}const co=ne.match(/^polygon\.new\s*\((.*)\)\s*$/i);if(co){zd(co[1]||"",H);continue}const so=ne.match(/^path\.new\s*\((.*)\)\s*$/i);if(so){kc(so[1]||"",H);continue}const Jo=ne.match(/^table\.new\s*\((.*)\)\s*$/i);if(Jo){dd(Jo[1]||"",H);continue}const Os=ne.match(/^table\.clear\s*\((.*)\)\s*$/i);if(Os){Yd(Os[1]||"",H);continue}const wr=ne.match(/^table\.merge(?:_cells)?\s*\((.*)\)\s*$/i);if(wr){eu(wr[1]||"",H);continue}const ra=ne.match(/^table\.cell\s*\((.*)\)\s*$/i);if(ra){Cd(ra[1]||"",H);continue}const Qr=ne.match(/^line\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Qr){fa(Qr[1]||"",Qr[2]||"",H);continue}const hl=ne.match(/^line\.delete\s*\((.*)\)\s*$/i);if(hl){Dl(hl[1]||"");continue}const lc=ne.match(/^polyline\.set\s*\((.*)\)\s*$/i);if(lc){ic(lc[1]||"",H);continue}const qr=ne.match(/^polyline\.delete\s*\((.*)\)\s*$/i);if(qr){od(qr[1]||"");continue}const Ga=ne.match(/^polygon\.set\s*\((.*)\)\s*$/i);if(Ga){Ec(Ga[1]||"",H);continue}const Ki=ne.match(/^polygon\.delete\s*\((.*)\)\s*$/i);if(Ki){al(Ki[1]||"");continue}const Zl=ne.match(/^path\.set\s*\((.*)\)\s*$/i);if(Zl){Vd(Zl[1]||"",H);continue}const Tl=ne.match(/^path\.delete\s*\((.*)\)\s*$/i);if(Tl){sd(Tl[1]||"");continue}const Ya=ne.match(/^linefill\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Ya){gl(Ya[1]||"",Ya[2]||"",H);continue}const ur=ne.match(/^linefill\.delete\s*\((.*)\)\s*$/i);if(ur){_d(ur[1]||"");continue}const rc=ne.match(/^label\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(rc){id(rc[1]||"",rc[2]||"",H);continue}const zr=ne.match(/^label\.delete\s*\((.*)\)\s*$/i);if(zr){Pd(zr[1]||"");continue}const rd=ne.match(/^box\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(rd){Ed(rd[1]||"",rd[2]||"",H);continue}const cc=ne.match(/^box\.delete\s*\((.*)\)\s*$/i);if(cc){zl(cc[1]||"");continue}const dc=ne.match(/^table\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(dc){Gd(dc[1]||"",dc[2]||"",H);continue}const Er=ne.match(/^table\.delete\s*\((.*)\)\s*$/i);if(Er){lu(Er[1]||"");continue}const Sc=ne.match(/^table\.cell_set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Sc){Ju(Sc[1]||"",Sc[2]||"",H);continue}const ea=ne.match(/^plotcandle\s*\((.*)\)\s*$/i);if(ea){Ho("candles",ea[1]||"",H);continue}const Cc=ne.match(/^plotbar\s*\((.*)\)\s*$/i);if(Cc){Ho("ohlc",Cc[1]||"",H);continue}const Ac=ne.match(/^plotohlc\s*\((.*)\)\s*$/i);if(Ac){Ho("ohlc",Ac[1]||"",H);continue}const cu=ne.match(/^plotfill\s*\((.*)\)\s*$/i);if(cu){const Ht=xr(cu[1]||""),qe=Ol(Ht),fn=Ht.filter(Pn=>!wc(Pn));if(fn.length<2){e.push({message:"plotfill() requires 2 plot series",line:H});continue}const Fn=oo(qe),Vt=Ge(Fn),mn=go(fn[0],"plotfill_a"),Kn=go(fn[1],"plotfill_b");Vt.fills=Array.isArray(Vt.fills)?Vt.fills:[],Vt.fills.push({between:[mn,Kn],color:Qs(String(qe.color??""))||Ri(String(qe.color??""))||"rgba(34,197,94,0.10)"});continue}const Id=ne.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*plot\s*\((.*)\)\s*$/i);if(Id){hn(Id[2]||"",H,Id[1]);continue}const Zc=ne.match(/^plot\s*\((.*)\)\s*$/i);if(Zc){hn(Zc[1]||"",H);continue}const ce=ne.match(/^plotarrow\s*\((.*)\)\s*$/i);if(ce){const Ht=xr(ce[1]||""),qe=Ol(Ht),fn=Ht.filter(Mo=>!wc(Mo));if(!fn.length){e.push({message:"plotarrow() requires a series",line:H});continue}const Fn=oo(qe),Vt=Ge(Fn),mn=En(fn[0],"plotarrow").replace(/\s+/g,"_").toLowerCase(),Kn=Dv(So(`${mn} > 0`,"plotarrow_up")),Pn=Dv(So(`${mn} < 0`,"plotarrow_down")),Hn=Qs(String(qe.colorup??qe.color_up??""))||"#22c55e",No=Qs(String(qe.colordown??qe.color_down??""))||"#ef4444";Vt.labels.push({when:Kn,text:"▲",color:Hn,position:"below",source:"low",shape:"arrowUp"}),Vt.labels.push({when:Pn,text:"▼",color:No,position:"above",source:"high",shape:"arrowDown"});continue}const st=ne.match(/^plotshape\s*\((.*)\)\s*$/i);if(st){const Ht=xr(st[1]||"");if(!Ht.length){e.push({message:"plotshape() requires at least 1 argument",line:H});continue}const qe=Ol(Ht),fn=Ht.filter(Ks=>!wc(Ks)),Fn=fn[0]?tn(Dv(So(fn[0],"when"))):null;if(!Fn){e.push({message:"plotshape() missing condition",line:H});continue}const Vt=oo(qe),mn=Ge(Vt),Kn=String(qe.location??"").toLowerCase(),Pn=Kn.includes("below")||Kn.includes("bottom")||Kn.includes("low"),Hn=Pn?"below":"above",No=qe.price??qe.y??qe.source??qe.series,Mo=No!=null?En(String(No),"shape_price").replace(/\s+/g,"_").toLowerCase():Pn?"low":"high",qs=pq(String(qe.style??qe.shape??""))||(Pn?"triangle_up_filled":"triangle_down_filled"),ta=Ri(String(qe.text??qe.title??""))||(Pn?"BUY":"SELL"),Nc=Qs(String(qe.color??""))||(Pn?"#16a34a":"#ef4444"),Tc=Qs(String(qe.textcolor??qe.textColor??""))||void 0,Sl=Fh(String(qe.size??""))||void 0;mn.labels.push({when:Fn,text:ta,color:Nc,textColor:Tc,position:Hn,source:Mo,shape:qs,size:Sl});continue}const ge=ne.match(/^plotchar\s*\((.*)\)\s*$/i);if(ge){const Ht=xr(ge[1]||"");if(!Ht.length){e.push({message:"plotchar() requires at least 1 argument",line:H});continue}const qe=Ol(Ht),fn=Ht.filter(Sl=>!wc(Sl)),Fn=fn[0]?tn(Dv(So(fn[0],"when"))):null;if(!Fn){e.push({message:"plotchar() missing condition",line:H});continue}const Vt=oo(qe),mn=Ge(Vt),Kn=String(qe.location??"").toLowerCase(),Pn=Kn.includes("below")||Kn.includes("bottom")||Kn.includes("low"),Hn=Pn?"below":"above",No=qe.price??qe.y??qe.source??qe.series,Mo=No!=null?En(String(No),"char_price").replace(/\s+/g,"_").toLowerCase():Pn?"low":"high",qs=Ri(String(qe.char??""))||Ri(String(qe.text??""))||"•",ta=Qs(String(qe.color??""))||(Pn?"#16a34a":"#ef4444"),Nc=Qs(String(qe.textcolor??qe.textColor??""))||void 0,Tc=Fh(String(qe.size??""))||14;mn.labels.push({when:Fn,text:qs,color:ta,textColor:Nc,position:Hn,source:Mo,shape:"text",size:Tc});continue}const Le=ne.match(/^alert\s*\((.*)\)\s*$/i);if(Le){const Ht=xr(Le[1]||"");if(!Ht.length){e.push({message:"alert() requires a message",line:H});continue}const qe=Ol(Ht),fn=Ht.filter(Mo=>!wc(Mo)),Fn=fn[0]??qe.message??qe.msg??"",Vt=fn[1]??qe.freq??qe.frequency??qe.alert_freq??"",mn=qe.when??null,Kn=mn?tn(Dv(So(String(mn),"when"))):"close >= close",Pn=Ri(String(qe.title??"")),Hn=Ri(String(Fn??"")),No=u2(String(Vt??""));D.push({id:Pn?`${Pn}`:`alert_${H}`,type:"alert",when:Kn,title:Pn||void 0,message:Hn||void 0,frequency:No});continue}const dt=ne.match(/^alertcondition\s*\((.*)\)\s*$/i);if(dt){const Ht=xr(dt[1]||"");if(!Ht.length){e.push({message:"alertcondition() requires a condition",line:H});continue}const qe=Ol(Ht),fn=Ht.filter(No=>!wc(No)),Fn=fn[0]!=null?String(fn[0]):"",Vt=Fn?tn(Dv(So(Fn,"when"))):null;if(!Vt){e.push({message:"alertcondition() missing condition",line:H});continue}const mn=Ri(String(qe.title??"")),Kn=Ri(String(qe.message??"")),Pn=qe.freq??qe.frequency??qe.alert_freq??"",Hn=u2(String(Pn??""));D.push({id:mn?`${mn}`:`alert_${H}`,type:"alert",when:Vt,title:mn||void 0,message:Kn||void 0,frequency:Hn});continue}const At=ne.match(/^hline\s*\((.*)\)\s*$/i);if(At){const Ht=xr(At[1]||"");if(!Ht.length){e.push({message:"hline() requires value",line:H});continue}const qe=Ol(Ht),fn=Ht.filter(Kn=>!wc(Kn)),Fn=bp(Ri(fn[0]??""));if(Fn==null){e.push({message:"hline() value must be a number",line:H});continue}const Vt=oo(qe);Ge(Vt).levels.push({name:Ri(String(qe.title??qe.name??String(Fn))),value:Fn,color:Qs(String(qe.color??""))||void 0,style:Ri(String(qe.linestyle??qe.style??"dashed")),width:qe.width!=null?Number(qe.width):void 0});continue}const pt=ne.match(/^fill\s*\((.*)\)\s*$/i);if(pt){const Ht=xr(pt[1]||""),qe=Ol(Ht),fn=Ht.filter(Pn=>!wc(Pn));if(fn.length<2){e.push({message:"fill() requires 2 plot series",line:H});continue}const Fn=oo(qe),Vt=Ge(Fn),mn=En(fn[0],"fill_a"),Kn=En(fn[1],"fill_b");Vt.fills=Array.isArray(Vt.fills)?Vt.fills:[],Vt.fills.push({between:[mn,Kn],color:Qs(String(qe.color??""))||Ri(String(qe.color??""))||"rgba(34,197,94,0.10)"});continue}const at=ne.match(/^signal\s+(entry_long|exit_long|entry_short|exit_short|buy|sell|exit)\s+when\s+(.+)$/i);if(at){const Ht=hi(at[2]||"");if(!Ht.when){e.push({message:"signal ... when requires a condition",line:H});continue}const qe=tn(Dv(So(Ht.when,"when"))),fn=li(Ht.scoreRaw,H,"signal_score");if(Ht.scoreRaw!=null&&fn==null)continue;const Fn=ks(Ht.cooldownRaw,H,"signal_cooldown");if(Ht.cooldownRaw!=null&&Fn==null)continue;const Vt=at[1].toLowerCase(),mn=Vt==="buy"?"entry_long":Vt==="sell"||Vt==="exit"?"exit_long":Vt;D.push({type:mn,when:qe,score:fn??null,cooldownBars:Fn});continue}const Ct=ne.match(/^strategy\.entry\s*\((.*)\)\s*$/i);if(Ct){const Ht=xr(Ct[1]||""),qe=Ol(Ht),Fn=Ht.filter(Mo=>!wc(Mo))[0]||"",Vt=Ht.find(Mo=>/strategy\.(long|short)/i.test(Mo))||"",mn=/short/i.test(Vt)?"short":"long",Kn=qe.when?tn(Dv(So(qe.when,"when"))):null;if(!Kn){e.push({message:"strategy.entry(...) requires when=...",line:H});continue}const Pn=$i(qe),Hn=li(qe.score??qe.signal_score,H,"entry_score");if((qe.score??qe.signal_score)!=null&&Hn==null)continue;const No=Vi(qe,H,"entry_cooldown");if(No.hadRaw&&No.value==null)continue;D.push({id:Fn?Ri(String(Fn)):void 0,type:mn==="long"?"entry_long":"entry_short",when:Kn,order:Pn||void 0,score:Hn??null,cooldownBars:No.value});continue}const Re=ne.match(/^strategy\.order\s*\((.*)\)\s*$/i);if(Re){const Ht=xr(Re[1]||""),qe=Ol(Ht),fn=Ht.filter(qs=>!wc(qs)),Fn=fn[0]||"",Vt=Fn?Ri(String(Fn)):"";if(!Vt){e.push({message:"strategy.order(...) requires id",line:H});continue}const mn=Ht.find(qs=>/strategy\.(long|short)/i.test(qs))||fn[1]||"",Kn=/short/i.test(mn)?"short":/long/i.test(mn)?"long":"";if(!Kn){e.push({message:"strategy.order(...) requires strategy.long/strategy.short",line:H});continue}qe.qty==null&&fn[2]!=null&&(qe.qty=String(fn[2]));const Pn=qe.when?tn(Dv(So(qe.when,"when"))):null;if(!Pn){e.push({message:"strategy.order(...) requires when=...",line:H});continue}const Hn=$i(qe),No=li(qe.score??qe.signal_score,H,"order_score");if((qe.score??qe.signal_score)!=null&&No==null)continue;const Mo=Vi(qe,H,"order_cooldown");if(Mo.hadRaw&&Mo.value==null)continue;D.push({id:Vt,orderId:Vt,type:Kn==="long"?"entry_long":"entry_short",when:Pn,order:Hn||void 0,score:No??null,cooldownBars:Mo.value});continue}const kn=ne.match(/^strategy\.(close|exit)\s*\((.*)\)\s*$/i);if(kn){const Ht=xr(kn[2]||""),qe=Ol(Ht),Fn=Ht.filter(ci=>!wc(ci))[0]||"",Vt=qe.when?tn(Dv(So(qe.when,"when"))):null,mn=qe.side&&/short/i.test(String(qe.side))?"short":"long",Kn=$i(qe),Pn=li(qe.score??qe.signal_score,H,"exit_score");if((qe.score??qe.signal_score)!=null&&Pn==null)continue;const Hn=Vi(qe,H,"exit_cooldown");if(Hn.hadRaw&&Hn.value==null)continue;const No=qe.stop??qe.stopPrice,Mo=qe.limit??qe.limitPrice,qs=qe.qty_percent??qe.qtyPct??qe.qtyPctVal??qe.qtyPercent,ta=qs!=null?Number(qs):void 0,Nc=No!=null?En(String(No),"exit_stop"):null,Tc=Mo!=null?En(String(Mo),"exit_limit"):null,Sl=Fn?`${Ri(String(Fn))}__bracket`:`exit__bracket_${H}`;let Ks=!1;if(No!=null&&(D.push({id:`${Fn?Ri(String(Fn)):H}_STOP`,type:mn==="long"?"exit_long":"exit_short",when:`between(${Nc||"close"}, low, high)`,order:{kind:"stop",price:(Nc||"close").replace(/\s+/g,"_").toLowerCase(),qtyPct:typeof ta=="number"&&Number.isFinite(ta)?ta:void 0,oco:Sl},score:Pn??null,cooldownBars:Hn.value}),Ks=!0),Mo!=null&&(D.push({id:`${Fn?Ri(String(Fn)):H}_LIMIT`,type:mn==="long"?"exit_long":"exit_short",when:`between(${Tc||"close"}, low, high)`,order:{kind:"limit",price:(Tc||"close").replace(/\s+/g,"_").toLowerCase(),qtyPct:typeof ta=="number"&&Number.isFinite(ta)?ta:void 0,oco:Sl},score:Pn??null,cooldownBars:Hn.value}),Ks=!0),Vt&&(D.push({id:Fn?Ri(String(Fn)):void 0,type:mn==="long"?"exit_long":"exit_short",when:Vt,order:No!=null||Mo!=null?typeof ta=="number"&&Number.isFinite(ta)?{kind:"market",qtyPct:ta}:void 0:Kn||(typeof ta=="number"&&Number.isFinite(ta)?{kind:"market",qtyPct:ta}:void 0),score:Pn??null,cooldownBars:Hn.value}),Ks=!0),!Ks){e.push({message:"strategy.exit/close(...) needs when=... or stop=/limit=...",line:H});continue}continue}const ro=ne.match(/^strategy\.cancel\s*\((.*)\)\s*$/i);if(ro){const Ht=xr(ro[1]||""),qe=Ol(Ht),Fn=Ht.filter(Kn=>!wc(Kn))[0]||"",Vt=Fn?Ri(String(Fn)):"";if(!Vt){e.push({message:"strategy.cancel(...) requires id",line:H});continue}const mn=qe.when?tn(Dv(So(qe.when,"when"))):"close >= close";D.push({id:`cancel_${Vt}_${H}`,type:"cancel",when:mn,orderId:Vt});continue}const uo=ne.match(/^strategy\.cancel_all\s*\((.*)\)\s*$/i);if(uo){const Ht=xr(uo[1]||""),qe=Ol(Ht),fn=qe.when?tn(Dv(So(qe.when,"when"))):"close >= close";D.push({id:`cancel_all_${H}`,type:"cancel_all",when:fn});continue}const hs=ne.match(/^strategy\.close_all\s*\((.*)\)\s*$/i);if(hs){const Ht=xr(hs[1]||""),qe=Ol(Ht),fn=qe.when?tn(Dv(So(qe.when,"when"))):null;if(!fn){e.push({message:"strategy.close_all(...) requires when=...",line:H});continue}const Fn=li(qe.score??qe.signal_score,H,"close_all_score");if((qe.score??qe.signal_score)!=null&&Fn==null)continue;const Vt=Vi(qe,H,"close_all_cooldown");if(Vt.hadRaw&&Vt.value==null)continue;D.push({type:"exit_long",when:fn,id:`close_all_long_${H}`,order:{kind:"market",qtyPct:100},score:Fn??null,cooldownBars:Vt.value}),D.push({type:"exit_short",when:fn,id:`close_all_short_${H}`,order:{kind:"market",qtyPct:100},score:Fn??null,cooldownBars:Vt.value});continue}const Ei=ne.match(/^draw\.clear\s*\((.*)\)\s*$/i);if(Ei){const Ht=xr(Ei[1]||""),qe=Ol(Ht),fn=oo(qe),Fn=String(qe.kind??qe.type??"").toLowerCase(),Vt=["line","label","box","linefill","table","polyline","polygon","path"].includes(Fn)?Fn:void 0,mn=ba(qe.group??qe.group_id??qe.groupId),Kn=ba(qe.tag??qe.tags);$r(fn,{kind:"draw_clear",when:Ko(qe),filterKind:Vt,groupId:mn,tag:Kn});continue}const ei=ne.match(/^draw\.for_each\s*\((.*)\)\s*$/i);if(ei){const Ht=xr(ei[1]||""),qe=Ol(Ht),fn=oo(qe),Fn=String(qe.kind??qe.type??"").toLowerCase(),Vt=["line","label","box","linefill","table","polyline","polygon","path"].includes(Fn)?Fn:void 0,mn=ba(qe.group??qe.group_id??qe.groupId),Kn=ba(qe.tag??qe.tags),Pn=Fs(qe.width,"draw.for_each_width"),Hn=Va(qe.text_size??qe.textSize,"draw.for_each_text_size"),No=qe.text!=null?Qo(String(qe.text),"draw.for_each_text"):{text:void 0,textExpr:void 0},Mo={color:Qs(qe.color),fillColor:Qs(qe.fill_color??qe.fillcolor??qe.bgcolor??qe.bgColor),width:Pn.value,widthExpr:Pn.expr,style:om(String(qe.style??""))||void 0,extend:$h(String(qe.extend??""))||void 0,xloc:Sf(String(qe.xloc??""))||void 0,bgColor:Qs(qe.bgcolor??qe.bgColor),bgOpacity:qe.bg_opacity!=null?Number(qe.bg_opacity):qe.bgOpacity!=null?Number(qe.bgOpacity):void 0,borderColor:Qs(qe.border_color??qe.borderColor),borderWidth:qe.border_width!=null?Number(qe.border_width):qe.borderWidth!=null?Number(qe.borderWidth):void 0,textColor:Qs(qe.text_color??qe.textColor),text:No.text,textExpr:No.textExpr,textSize:Hn.value,textSizeExpr:Hn.expr,opacity:qe.opacity!=null?Number(qe.opacity):void 0,wrap:qe.wrap!=null?String(qe.wrap).toLowerCase()==="true"||Number(qe.wrap)===1:void 0,maxWidth:qe.maxwidth!=null?Number(qe.maxwidth):qe.maxWidth!=null?Number(qe.maxWidth):void 0,padding:qe.padding,radius:qe.radius!=null?Number(qe.radius):void 0,align:Sm(String(qe.align??qe.textalign??qe.textAlign??""))||void 0,valign:["top","middle","bottom"].includes(String(qe.valign??"").toLowerCase())?String(qe.valign).toLowerCase():void 0,lineHeight:qe.line_height!=null?Number(qe.line_height):qe.lineHeight!=null?Number(qe.lineHeight):void 0,fontFamily:qe.font_family??qe.fontFamily,fontSize:qe.font_size!=null?Number(qe.font_size):qe.fontSize!=null?Number(qe.fontSize):void 0,fontWeight:qe.font_weight??qe.fontWeight,monospace:qe.monospace!=null?String(qe.monospace).toLowerCase()==="true"||Number(qe.monospace)===1:void 0};$r(fn,{kind:"draw_for_each",when:Ko(qe),filterKind:Vt,groupId:mn,tag:Kn,updates:Mo});continue}const Ys=ne.match(/^draw\.fib\.auto\s*\((.*)\)\s*$/i);if(Ys){const Ht=xr(Ys[1]||""),qe=Ol(Ht),fn=Ri(String(qe.name??"fibo"));j.push({name:fn,type:"auto_fib",method:Ri(String(qe.method??"pivots")),pivotLeft:Number(qe.left??qe.pivotLeft??3),pivotRight:Number(qe.right??qe.pivotRight??3),lookback:Number(qe.lookback??400),direction:Ri(String(qe.direction??"up")),draw:!0});continue}ne.startsWith("//@")||t.push({message:`Ignored Pine statement: ${ne}`,line:H})}if(!C.some(le=>Array.isArray(le.plots)&&le.plots.length||Array.isArray(le.labels)&&le.labels.length||Array.isArray(le.levels)&&le.levels.length||Array.isArray(le.lines)&&le.lines.length||Array.isArray(le.runtimeDrawOps)&&le.runtimeDrawOps.length||Array.isArray(le.runtimeLabels)&&le.runtimeLabels.length||Array.isArray(le.runtimeLines)&&le.runtimeLines.length||Array.isArray(le.runtimeBoxes)&&le.runtimeBoxes.length||Array.isArray(le.runtimeTables)&&le.runtimeTables.length)){const le=M.length?M[M.length-1].name:F.length?F[F.length-1].name:null,we=le||"close";Ge(I).plots.push({name:le?Ri(String(le)):"Close",source:we.replace(/\s+/g,"_").toLowerCase(),type:"line",color:"#60a5fa",width:2}),t.push({message:le?`No plot() found; auto-plotted "${le}". Add plot(...) to control output.`:'No plot() found; auto-plotted "close". Add plot(...) to control output.',line:1})}for(const le of C)if((Array.isArray(le.runtimeDrawOps)&&le.runtimeDrawOps.length||Array.isArray(le.runtimeLabels)&&le.runtimeLabels.length||Array.isArray(le.runtimeLines)&&le.runtimeLines.length||Array.isArray(le.runtimeBoxes)&&le.runtimeBoxes.length||Array.isArray(le.runtimeTables)&&le.runtimeTables.length||Array.isArray(le.runtimePolylines)&&le.runtimePolylines.length||Array.isArray(le.runtimePolygons)&&le.runtimePolygons.length?!0:Array.isArray(le.runtimePaths)&&le.runtimePaths.length)&&(!Array.isArray(le.plots)||le.plots.length===0)){const H=M.length?M[M.length-1].name:"close";Array.isArray(le.plots)||(le.plots=[]),le.plots.push({name:"__runtime_stub__",source:String(H||"close").replace(/\s+/g,"_").toLowerCase(),type:"line",color:"rgba(0,0,0,0)",width:0})}if(e.length)return{ok:!1,errors:e,warnings:t.length?t:void 0};try{const le=C.find(we=>we.pane==="sub");if(le&&typeof le.min!="number"&&typeof le.max!="number"){const H=(Array.isArray(le.levels)?le.levels:[]).map(ne=>Number(ne==null?void 0:ne.value)).filter(ne=>Number.isFinite(ne));if(H.length){const ne=Math.min(...H),_e=Math.max(...H),q=H.some(ot=>ot<=30),De=H.some(ot=>ot>=70);H.length>=2&&ne>=0&&_e<=100&&q&&De&&(le.min=0,le.max=100)}}}catch{}return{ok:!0,spec:{panes:C,calc:j,series:M,stateSeries:F,signals:D,strategy:G,params:R},inputDefs:W,warnings:t.length?t:void 0}}function vq(n){return new Worker(""+new URL("../workers/editor.worker-oRlJJsnX.js",import.meta.url).href,{name:n==null?void 0:n.name})}function fq(n){return new Worker(""+new URL("../workers/json.worker-CPn_BmvY.js",import.meta.url).href,{name:n==null?void 0:n.name})}function mq(n){return new Worker(""+new URL("../workers/css.worker-DGFkc2qH.js",import.meta.url).href,{name:n==null?void 0:n.name})}function gq(n){return new Worker(""+new URL("../workers/html.worker-CltiozTZ.js",import.meta.url).href,{name:n==null?void 0:n.name})}function hq(n){return new Worker(""+new URL("../workers/ts.worker-CGiXAPLT.js",import.meta.url).href,{name:n==null?void 0:n.name})}const _q=()=>{var e;if(typeof window>"u")return;const n=window;(e=n.MonacoEnvironment)!=null&&e.getWorker||(n.MonacoEnvironment={getWorker(t,o){return o==="json"?new fq:o==="css"||o==="scss"||o==="less"?new mq:o==="html"||o==="handlebars"||o==="razor"?new gq:o==="typescript"||o==="javascript"?new hq:new vq}})};function yq(n,e){e("reset")}function bq(n,e){e()}function xq(n,e,t){s(e)&&(x(e,!1),t("fullpage",{enabled:!1})),t("close")}function wq(n,e){e("guide")}function kq(){Xh.set(!0)}async function Sq(n,e,t){x(e,!0),await t(!1)}function v2(n,e){x(e,!1)}async function Cq(n,e){await e(!0)}function f2(n,e){x(e,!1)}function Pq(n,e,t){x(e,!s(e)),t("labels",{enabled:s(e)})}function m2(n,e){x(e,!1)}function Iq(n,e,t,o,i){if(!s(e))return;const r=s(t).trim()||`Run ${s(o).length+1}`,a=`cmp_${Date.now()}_${s(o).length}`,l=s(i)&&typeof s(i)=="object"?{...s(i)}:null;x(o,N([...s(o),{id:a,label:r,summary:s(e),params:l,ts:Date.now()}])),x(t,"")}function Mq(n,e,t,o){x(e,N([])),x(t,null),x(o,N({}))}function Aq(n,e,t,o){x(e,""),x(t,""),x(o,"")}function Tq(n,e,t,o,i,r,a,l,c,d,p,m,h,_,w,S,P,I,C,M,F,V,j){var Z;if(!s(e).length)return;if(x(t,""),!s(o)){x(t,"Select Param A");return}if(s(i)&&s(i)===s(o)){x(t,"Param B must differ from Param A");return}const D=r(s(o),s(a),s(l),s(c));if(!D.length){x(t,"Invalid range for Param A");return}const R=s(i)?r(s(i),s(d),s(p),s(m)):[null],W=D.length*(R.length||1);if(W>200){x(t,`Too many combos (${W}). Reduce ranges or steps.`);return}const J=[];for(const G of D)for(const se of R){const Y={...s(h)};Y[s(o)]=G,s(i)&&se!=null&&(Y[s(i)]=se),J.push({params:Y})}x(_,N(J)),x(w,N([])),x(S,0),x(P,!0),x(I,!1),x(C,"train"),x(M,null),x(F,N(Number(((Z=V())==null?void 0:Z._updatedAt)??0))),j(0)}function Lq(n,e,t,o,i){x(e,!1),x(t,!1),x(o,N([])),x(i,0)}function Fq(n,e,t,o,i,r,a,l,c){x(e,N([])),x(t,null),x(o,""),x(i,0),x(r,N([])),x(a,!1),x(l,!1),x(c,0)}function $q(n,e,t){x(e,!s(e)),t("fullpage",{enabled:s(e)})}function g2(n,e){x(e,!1)}function h2(n,e,t,o,i,r,a,l,c,d){const p=[e(["side","entryIndex","entryTime","entryPrice","exitIndex","exitTime","exitPrice","qty","barsHeld","netPnl","pnlPct","fees","grossPnl","maePct","mfePct","entrySignalId","exitSignalId","exitReason","cumNetPnl"])];for(const m of s(t))p.push(e([o(m.side),m.entryIndex,m.entryTimeLabel,i(m.entryPrice),m.exitIndex,m.exitTimeLabel,i(m.exitPrice),r(m.qty),a(m.barsHeld,0),l(m.netPnl),c(m.pnlPct),l(m.fees),l(m.pnl),m.maePct==null?"-":c(m.maePct),m.mfePct==null?"-":c(m.mfePct),m.entrySignalId,m.exitSignalId,m.exitReason,l(m.cumNet)]));d("backtest_trades.csv",p.join(`
`),"text/csv;charset=utf-8")}function _2(n,e,t,o,i,r,a,l){const c=[e(["id","status","action","side","kind","createdIndex","createdTime","activeFromIndex","expiresAtIndex","qtyPct","qty","cash","price","stopPrice","limitPrice","filledIndex","filledTime","fillQty","fillPrice","fees","signalId","ocoGroup","note"])];for(const d of s(t))c.push(e([d.id,d.statusLabel,d.actionLabel,d.sideLabel,d.kindLabel,d.createdIndex,d.createdTimeLabel,d.activeFromIndex,d.expiresAtIndex,`${o(d.qtyPct,2)}%`,d.qty==null?"-":i(d.qty),d.cash==null?"-":r(d.cash),d.price==null?"-":a(d.price),d.stopPrice==null?"-":a(d.stopPrice),d.limitPrice==null?"-":a(d.limitPrice),d.filledIndex,d.filledTimeLabel,d.fillQty==null?"-":i(d.fillQty),d.fillPrice==null?"-":a(d.fillPrice),d.fees==null?"-":r(d.fees),d.signalId,d.ocoGroup,d.note]));l("backtest_orders.csv",c.join(`
`),"text/csv;charset=utf-8")}function Eq(n,e,t,o,i,r,a,l,c,d,p){const m=[e(["side","entryIndex","entryTime","entryPrice","exitIndex","exitTime","exitPrice","qty","barsHeld","netPnl","pnlPct","fees","grossPnl","maePct","mfePct","entrySignalId","exitSignalId","exitReason","cumNetPnl"])];for(const _ of s(t))m.push(e([o(_.side),_.entryIndex,_.entryTimeLabel,i(_.entryPrice),_.exitIndex,_.exitTimeLabel,i(_.exitPrice),r(_.qty),a(_.barsHeld,0),l(_.netPnl),c(_.pnlPct),l(_.fees),l(_.pnl),_.maePct==null?"-":c(_.maePct),_.mfePct==null?"-":c(_.mfePct),_.entrySignalId,_.exitSignalId,_.exitReason,l(_.cumNet)]));const h=s(d).type==="all"?"all":`${s(d).type}_${String(s(d).key).replace(/[^a-zA-Z0-9_-]+/g,"_")}`;p(`backtest_trades_${h}.csv`,m.join(`
`),"text/csv;charset=utf-8")}function Nq(n,e,t,o){const i=[e(["index","timestamp","equity"])];for(const r of s(t))i.push(e([r.index,r.timestamp,r.equity]));o("backtest_equity.csv",i.join(`
`),"text/csv;charset=utf-8")}var Dq=n=>n.stopPropagation(),jq=(n,e)=>{n.stopPropagation(),x(e,"editor")},Rq=(n,e)=>{n.stopPropagation(),x(e,"errors")},Bq=fe("<span> </span>"),Oq=(n,e)=>{n.stopPropagation(),x(e,"results")},zq=n=>n.stopPropagation(),Vq=(n,e)=>e("main"),Wq=(n,e)=>e("sub"),qq=fe('<div class="pane-toggle svelte-dgb5y3" aria-label="Target pane"><button type="button" class="svelte-dgb5y3">Main</button> <button type="button" class="svelte-dgb5y3">Sub pane</button></div>'),Hq=fe('<button class="icon svelte-dgb5y3" type="button" aria-label="Full page view" title="Full page view"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 9V4h5M20 9V4h-5M4 15v5h5M20 15v5h-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg></button>'),Uq=fe('<button class="icon svelte-dgb5y3" type="button" aria-label="Exit full page view" title="Exit full page view (Esc)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 4H4v5M15 4h5v5M9 20H4v-5M15 20h5v-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg></button>'),Gq=fe('<div class="monaco-loading svelte-dgb5y3">Loading editor…</div>'),Yq=fe('<div class="monaco-shell svelte-dgb5y3"><!></div>'),Kq=fe('<div class="gutter-line svelte-dgb5y3"></div>'),Zq=fe('<div class="editor-gutter svelte-dgb5y3"></div> <div class="code-shell svelte-dgb5y3"><pre class="code-overlay svelte-dgb5y3" aria-hidden="true"><code class="svelte-dgb5y3"><!></code><mark class="err svelte-dgb5y3" style="display:none" aria-hidden="true"></mark><mark class="err-warning svelte-dgb5y3" style="display:none" aria-hidden="true"></mark></pre> <textarea class="code-input svelte-dgb5y3" spellcheck="false" placeholder="Write or paste your script here, then press Run to see it on the chart"></textarea></div>',1),Xq=fe('<div class="pine-warn-row svelte-dgb5y3"> </div>'),Jq=fe('<div class="pine-warn svelte-dgb5y3"></div>'),Qq=(n,e,t)=>e(s(t).name,n.currentTarget.checked),eH=fe('<label class="toggle svelte-dgb5y3"><input type="checkbox" class="svelte-dgb5y3"> <span class="toggle-track svelte-dgb5y3"></span></label>'),tH=(n,e,t)=>e(s(t).name,n.currentTarget.value),nH=fe('<input class="input svelte-dgb5y3" type="text">'),oH=(n,e,t,o)=>{const i=n.currentTarget.value,r=e(i);r!=null&&t(s(o).name,r)},sH=fe('<input class="input svelte-dgb5y3" type="datetime-local">'),iH=(n,e,t)=>e(s(t).name,n.currentTarget.value),rH=fe("<option></option>"),aH=fe('<div class="input-source svelte-dgb5y3"><input class="input svelte-dgb5y3"> <datalist></datalist></div>'),lH=(n,e,t)=>e(s(t).name,n.currentTarget.value),cH=fe('<input class="input input-color svelte-dgb5y3" type="color">'),dH=(n,e,t)=>{const o=n.currentTarget.value,i=Number(o);Number.isFinite(i)&&e(s(t).name,s(t).type==="int"?Math.floor(i):i)},uH=fe('<input class="input svelte-dgb5y3" type="number">'),pH=fe('<div class="input-row svelte-dgb5y3"><div class="input-label svelte-dgb5y3"><div class="input-name svelte-dgb5y3"> </div> <div class="input-key mono svelte-dgb5y3"> </div></div> <div class="input-control svelte-dgb5y3"><!></div></div>'),vH=fe('<div class="editor-side svelte-dgb5y3"><div class="side-card svelte-dgb5y3"><div class="side-title svelte-dgb5y3">Inputs</div> <div class="side-sub svelte-dgb5y3">Script inputs — update values, then press Run.</div> <!> <div class="inputs-list svelte-dgb5y3"></div> <div class="side-hint svelte-dgb5y3">Change inputs → press <b>Run</b> to re‑calculate.</div></div></div>'),fH=fe('<div class="no-errors svelte-dgb5y3">No errors • All good</div>'),mH=fe('<span class="diag-loc svelte-dgb5y3"> <!> —</span>'),gH=fe('<span class="diag-hint svelte-dgb5y3"> </span>'),hH=fe('<div><span class="diag-dot svelte-dgb5y3"></span> <span class="diag-msg svelte-dgb5y3"><!> </span> <!></div>'),_H=fe('<div class="errors-header svelte-dgb5y3"><div class="errors-title svelte-dgb5y3"> </div> <div class="errors-sub svelte-dgb5y3">Newest errors appear here as you type.</div></div> <div class="errors-list svelte-dgb5y3" aria-live="polite"></div>',1),yH=fe('<div class="errors-area svelte-dgb5y3"><!></div>'),bH=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},xH=(n,e)=>x(e,"trades"),wH=(n,e)=>x(e,"orders"),kH=(n,e)=>x(e,N(n.currentTarget.value)),SH=(n,e)=>x(e,N(s(e)==="compact"?"full":"compact")),CH=(n,e)=>e({type:"all"}),PH=fe('<button class="btn btn-xs btn-outline" type="button">Clear filter</button>'),IH=(n,e)=>e("side"),MH=(n,e)=>e("entryIndex"),AH=(n,e)=>e("exitIndex"),TH=(n,e)=>e("qty"),LH=(n,e)=>e("barsHeld"),FH=(n,e)=>e("netPnl"),$H=(n,e)=>e("pnlPct"),EH=(n,e)=>e("fees"),NH=(n,e)=>e("pnl"),DH=(n,e)=>e("maePct"),jH=(n,e)=>e("mfePct"),RH=(n,e)=>e("cumNet"),BH=fe('<th class="right svelte-dgb5y3"><button class="th-btn right svelte-dgb5y3" type="button"> </button></th> <th class="right svelte-dgb5y3"><button class="th-btn right svelte-dgb5y3" type="button"> </button></th> <th class="right svelte-dgb5y3"><button class="th-btn right svelte-dgb5y3" type="button"> </button></th> <th class="right svelte-dgb5y3"><button class="th-btn right svelte-dgb5y3" type="button"> </button></th> <th class="svelte-dgb5y3">Signals</th> <th class="svelte-dgb5y3">Reason</th> <th class="right svelte-dgb5y3"><button class="th-btn right svelte-dgb5y3" type="button"> </button></th>',1),OH=(n,e,t)=>e(s(t)),zH=(n,e,t)=>{n.key==="Enter"&&e(s(t))},VH=(n,e,t)=>{var o;try{(o=n==null?void 0:n.stopPropagation)==null||o.call(n)}catch{}e(s(t))},WH=fe('<td class="right mono svelte-dgb5y3"> </td> <td class="right mono svelte-dgb5y3"> </td> <td class="right mono svelte-dgb5y3"> </td> <td class="right mono svelte-dgb5y3"> </td> <td class="svelte-dgb5y3"><div class="tt-cell-stack svelte-dgb5y3"><div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Entry</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Exit</span><span class="mono svelte-dgb5y3"> </span></div></div></td> <td class="mono svelte-dgb5y3"> </td> <td class="right mono svelte-dgb5y3"> </td>',1),qH=fe('<tr tabindex="0" class="svelte-dgb5y3"><td class="svelte-dgb5y3"><button class="btn btn-xs btn-ghost svelte-dgb5y3" type="button" title="Focus this trade on chart">Focus</button></td><td class="svelte-dgb5y3"><span class="tt-pill tt-pill-side svelte-dgb5y3"> </span></td><td class="svelte-dgb5y3"><div class="tt-cell-stack svelte-dgb5y3"><div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Idx</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Time</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Price</span><span class="mono svelte-dgb5y3"> </span></div></div></td><td class="svelte-dgb5y3"><div class="tt-cell-stack svelte-dgb5y3"><div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Idx</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Time</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Price</span><span class="mono svelte-dgb5y3"> </span></div></div></td><td class="right mono svelte-dgb5y3"> </td><td class="right mono svelte-dgb5y3"> </td><td class="right mono svelte-dgb5y3"> </td><td class="right mono svelte-dgb5y3"> </td><!></tr>'),HH=fe('<div class="tt-scroll svelte-dgb5y3"><table><thead class="svelte-dgb5y3"><tr><th class="svelte-dgb5y3">Focus</th><th class="svelte-dgb5y3"><button class="th-btn svelte-dgb5y3" type="button"> </button></th><th class="svelte-dgb5y3"><button class="th-btn svelte-dgb5y3" type="button"> </button></th><th class="svelte-dgb5y3"><button class="th-btn svelte-dgb5y3" type="button"> </button></th><th class="right svelte-dgb5y3"><button class="th-btn right svelte-dgb5y3" type="button"> </button></th><th class="right svelte-dgb5y3"><button class="th-btn right svelte-dgb5y3" type="button"> </button></th><th class="right svelte-dgb5y3"><button class="th-btn right svelte-dgb5y3" type="button"> </button></th><th class="right svelte-dgb5y3"><button class="th-btn right svelte-dgb5y3" type="button"> </button></th><!></tr></thead><tbody class="svelte-dgb5y3"></tbody></table></div>'),UH=fe('<div class="no-errors svelte-dgb5y3">No trades to show.</div>'),GH=fe(`<div class="tt-toolbar svelte-dgb5y3"><div class="tt-toolbar-left svelte-dgb5y3"><div class="tt-title svelte-dgb5y3">Trades Table <span class="tt-sub mono svelte-dgb5y3"> </span></div> <div class="tt-note-inline svelte-dgb5y3">Entry/Exit show index, time, price. Bars = holding
                      duration.</div></div> <div class="tt-toolbar-right"><input class="input input-sm svelte-dgb5y3" type="text" placeholder="Search trades..."> <button class="btn btn-xs btn-outline" type="button"> </button> <!> <button class="btn btn-xs btn-outline" type="button">Download CSV</button></div></div> <!>`,1),YH=(n,e)=>x(e,N(s(e)==="compact"?"full":"compact")),KH=fe('<th class="svelte-dgb5y3">Active / Expire</th> <th class="svelte-dgb5y3">Signal / OCO</th> <th class="svelte-dgb5y3">Note</th>',1),ZH=fe('<div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Qty</span><span class="mono svelte-dgb5y3"> </span></div>'),XH=fe('<div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Cash</span><span class="mono svelte-dgb5y3"> </span></div>'),JH=fe('<div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Price</span><span class="mono svelte-dgb5y3"> </span></div>'),QH=fe('<div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Stop</span><span class="mono svelte-dgb5y3"> </span></div>'),eU=fe('<div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Limit</span><span class="mono svelte-dgb5y3"> </span></div>'),tU=fe('<td class="svelte-dgb5y3"><div class="tt-cell-stack svelte-dgb5y3"><div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Active</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Expire</span><span class="mono svelte-dgb5y3"> </span></div></div></td> <td class="svelte-dgb5y3"><div class="tt-cell-stack svelte-dgb5y3"><div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Signal</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">OCO</span><span class="mono svelte-dgb5y3"> </span></div></div></td> <td class="mono svelte-dgb5y3"> </td>',1),nU=fe('<tr class="svelte-dgb5y3"><td class="mono svelte-dgb5y3"> </td><td class="svelte-dgb5y3"><span> </span></td><td class="svelte-dgb5y3"><div class="tt-cell-stack svelte-dgb5y3"><div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Action</span> <span class="tt-pill tt-pill-action svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Side</span> <span class="tt-pill tt-pill-side svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Kind</span> <span class="tt-pill tt-pill-kind svelte-dgb5y3"> </span></div></div></td><td class="svelte-dgb5y3"><div class="tt-cell-stack svelte-dgb5y3"><div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Idx</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Time</span><span class="mono svelte-dgb5y3"> </span></div></div></td><td class="svelte-dgb5y3"><div class="tt-cell-stack svelte-dgb5y3"><div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Qty%</span><span class="mono svelte-dgb5y3"> </span></div> <!> <!> <!> <!> <!></div></td><td class="svelte-dgb5y3"><div class="tt-cell-stack svelte-dgb5y3"><div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Idx</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Time</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Qty</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Price</span><span class="mono svelte-dgb5y3"> </span></div> <div class="svelte-dgb5y3"><span class="tt-label svelte-dgb5y3">Fees</span><span class="mono svelte-dgb5y3"> </span></div></div></td><!></tr>'),oU=fe('<div class="tt-scroll svelte-dgb5y3"><table><thead class="svelte-dgb5y3"><tr><th class="svelte-dgb5y3">ID</th><th class="svelte-dgb5y3">Status</th><th class="svelte-dgb5y3">Type</th><th class="svelte-dgb5y3">Created</th><th class="svelte-dgb5y3">Request</th><th class="svelte-dgb5y3">Fill</th><!></tr></thead><tbody class="svelte-dgb5y3"></tbody></table></div>'),sU=fe('<div class="no-errors svelte-dgb5y3">No orders to show.</div>'),iU=fe(`<div class="tt-title-row svelte-dgb5y3"><div class="tt-title-group svelte-dgb5y3"><div class="tt-title svelte-dgb5y3">Orders</div> <div class="tt-sub mono svelte-dgb5y3"> <!></div> <div class="tt-note-inline svelte-dgb5y3">Request shows desired qty/price; Fill shows executed
                      values.</div></div> <div class="tt-title-actions svelte-dgb5y3"><button class="btn btn-xs btn-outline" type="button"> </button> <button class="btn btn-xs btn-outline" type="button">Download CSV</button></div></div> <!>`,1),rU=fe('<div class="tables-modal-backdrop svelte-dgb5y3" role="presentation"><div class="tables-modal svelte-dgb5y3" role="dialog" aria-modal="true" aria-label="Trades and Orders"><div class="tables-modal-head svelte-dgb5y3"><div class="tables-modal-title svelte-dgb5y3">Trades & Orders</div> <div class="tables-modal-actions svelte-dgb5y3"><div class="tables-modal-tabs svelte-dgb5y3" role="tablist" aria-label="Tables"><button type="button" role="tab" class="svelte-dgb5y3">Trades</button> <button type="button" role="tab" class="svelte-dgb5y3">Orders</button></div> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="tables-modal-body svelte-dgb5y3"><!></div></div></div>'),aU=fe("Backtest requires <code>strategy(...)</code> — add it, then press <b>Run</b>.",1),lU=fe('Backtest requires <code>"strategy"</code> — add it, then press <b>Run</b>.',1),cU=fe('<div class="no-errors svelte-dgb5y3"><!></div>'),dU=fe("No backtest results yet — add <code>strategy.entry/strategy.exit</code>, then press <b>Run</b>.",1),uU=fe('No backtest results yet — add <code>"signals"</code>, then press <b>Run</b>.',1),pU=fe('<div class="no-errors svelte-dgb5y3"><!></div>'),vU=fe("Ready — press <b>Run</b> to calculate results.",1),fU=fe('<div class="mono svelte-dgb5y3" style="margin-top:6px; opacity:0.8"> </div>'),mU=fe('<div class="no-errors svelte-dgb5y3"><!> <!></div>'),gU=fe('<div class="meta-chip svelte-dgb5y3">Last signal <span class="mono svelte-dgb5y3"> </span></div>'),hU=fe('<div class="meta-chip svelte-dgb5y3">Filter <span class="mono svelte-dgb5y3"> </span></div>'),_U=(n,e)=>e("setup"),yU=(n,e)=>x(e,N(n.currentTarget.value)),bU=(n,e)=>x(e,N(n.currentTarget.value)),xU=(n,e)=>x(e,N(n.currentTarget.value)),wU=fe('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),kU=fe('<div class="bt-active mono svelte-dgb5y3"> </div>'),SU=(n,e)=>x(e,N(n.currentTarget.value)),CU=fe('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),PU=(n,e,t)=>e(s(t).id),IU=(n,e,t)=>e(s(t).id),MU=fe('<div class="compare-metric svelte-dgb5y3"><span class="cd-key svelte-dgb5y3"> </span> <span class="mono svelte-dgb5y3"> </span></div>'),AU=fe('<div class="compare-metric svelte-dgb5y3"><span class="cd-key svelte-dgb5y3"> </span> <span class="mono svelte-dgb5y3"> </span></div>'),TU=fe('<div class="compare-params svelte-dgb5y3"></div>'),LU=fe('<div class="cd-empty svelte-dgb5y3">No params</div>'),FU=(n,e,t)=>e(s(t).id),$U=fe('<pre class="compare-raw mono svelte-dgb5y3"> </pre>'),EU=fe('<div class="compare-details svelte-dgb5y3"><div class="compare-detail svelte-dgb5y3"><div class="cd-title svelte-dgb5y3">Summary</div> <div class="compare-metrics svelte-dgb5y3"></div></div> <div class="compare-detail svelte-dgb5y3"><div class="cd-title svelte-dgb5y3">Params</div> <!></div> <div class="compare-detail svelte-dgb5y3"><div class="cd-title svelte-dgb5y3">Raw (optional)</div> <button class="btn btn-xs btn-outline" type="button"> </button> <!></div></div>'),NU=fe('<div class="compare-row svelte-dgb5y3"><div class="mono svelte-dgb5y3"> </div> <div> </div> <div class="right mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div> <div class="mono svelte-dgb5y3"> </div> <div class="compare-actions svelte-dgb5y3"><button class="btn btn-xs btn-outline" type="button"> </button> <button class="btn btn-xs btn-outline" type="button">Remove</button></div></div> <!>',1),DU=fe('<div class="compare-table svelte-dgb5y3"><div class="compare-head svelte-dgb5y3"><div>Run</div> <div class="right svelte-dgb5y3">Net</div> <div class="right svelte-dgb5y3">Ret%</div> <div class="right svelte-dgb5y3">DD%</div> <div class="right svelte-dgb5y3">Sharpe</div> <div class="right svelte-dgb5y3">Win%</div> <div class="right svelte-dgb5y3">Trades</div> <div>Params</div> <div>Actions</div></div> <!></div>'),jU=fe('<div class="bt-empty svelte-dgb5y3">Pin runs to compare net PnL, drawdown, Sharpe, and params.</div>'),RU=(n,e)=>e("performance"),BU=fe(`No signals matched. Check <code>when</code> conditions and series
                    names; try a simpler condition first.`,1),OU=fe(`Signals matched but no orders filled. Common causes:
                    limit/stop price never touches • stop‑limit expires • try <code>"order": &#123; "kind": "market" &#125;</code> first, then add limit/stop.`,1),zU=fe('<div class="bt-hint svelte-dgb5y3"><div class="bt-hint-title svelte-dgb5y3">No trades yet</div> <div class="bt-hint-body svelte-dgb5y3"><!></div></div>'),VU=(n,e)=>e("behavior"),WU=fe('<div class="sig-row svelte-dgb5y3"><div class="mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div> <div> </div> <div class="right mono svelte-dgb5y3"> </div></div>'),qU=fe('<div class="signal-table svelte-dgb5y3"><div class="sig-head svelte-dgb5y3"><div>Signal</div> <div class="right svelte-dgb5y3">Trades</div> <div class="right svelte-dgb5y3">Win%</div> <div class="right svelte-dgb5y3">Net</div> <div class="right svelte-dgb5y3">PF</div></div> <!></div>'),HU=fe('<div class="no-errors svelte-dgb5y3">No signal stats yet.</div>'),UU=(n,e)=>e("optimization"),GU=(n,e)=>e(n.currentTarget.value),YU=fe("<option> </option>"),KU=(n,e)=>x(e,N(Number(n.currentTarget.value))),ZU=(n,e)=>x(e,N(Number(n.currentTarget.value))),XU=(n,e)=>x(e,N(Number(n.currentTarget.value))),JU=(n,e)=>e(n.currentTarget.value),QU=fe("<option> </option>"),eG=(n,e)=>x(e,N(Number(n.currentTarget.value))),tG=(n,e)=>x(e,N(Number(n.currentTarget.value))),nG=(n,e)=>x(e,N(Number(n.currentTarget.value))),oG=fe('<div class="opt-range-grid svelte-dgb5y3"><label class="opt-field svelte-dgb5y3"><span class="bt-label svelte-dgb5y3">From</span> <input class="input input-sm svelte-dgb5y3" type="number"></label> <label class="opt-field svelte-dgb5y3"><span class="bt-label svelte-dgb5y3">To</span> <input class="input input-sm svelte-dgb5y3" type="number"></label> <label class="opt-field svelte-dgb5y3"><span class="bt-label svelte-dgb5y3">Step</span> <input class="input input-sm svelte-dgb5y3" type="number"></label></div>'),sG=(n,e)=>x(e,N(n.currentTarget.value)),iG=(n,e)=>x(e,N(n.currentTarget.checked)),rG=(n,e)=>x(e,N(Math.max(10,Math.min(90,Number(n.currentTarget.value)||70)))),aG=fe('<div class="opt-row svelte-dgb5y3"><div class="opt-label svelte-dgb5y3">Train %</div> <div class="opt-control svelte-dgb5y3"><input class="input input-sm svelte-dgb5y3" type="number" min="10" max="90"></div></div>'),lG=fe('<button class="btn btn-xs btn-outline" type="button">Stop</button>'),cG=fe('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),dG=fe('<div class="opt-warning svelte-dgb5y3"> </div>'),uG=fe('<div class="opt-progress svelte-dgb5y3"><span class="svelte-dgb5y3"></span></div>'),pG=fe('<div class="opt-row svelte-dgb5y3"><div class="opt-label svelte-dgb5y3">Param A</div> <div class="opt-control svelte-dgb5y3"><select class="input input-sm svelte-dgb5y3"></select></div></div> <div class="opt-range-grid svelte-dgb5y3"><label class="opt-field svelte-dgb5y3"><span class="bt-label svelte-dgb5y3">From</span> <input class="input input-sm svelte-dgb5y3" type="number"></label> <label class="opt-field svelte-dgb5y3"><span class="bt-label svelte-dgb5y3">To</span> <input class="input input-sm svelte-dgb5y3" type="number"></label> <label class="opt-field svelte-dgb5y3"><span class="bt-label svelte-dgb5y3">Step</span> <input class="input input-sm svelte-dgb5y3" type="number"></label></div> <div class="opt-row svelte-dgb5y3"><div class="opt-label svelte-dgb5y3">Param B</div> <div class="opt-control svelte-dgb5y3"><select class="input input-sm svelte-dgb5y3"><option>None</option><!></select></div></div> <!> <div class="opt-row svelte-dgb5y3"><div class="opt-label svelte-dgb5y3">Metric</div> <div class="opt-control svelte-dgb5y3"><select class="input input-sm svelte-dgb5y3"><option>Net PnL</option><option>Profit Factor</option><option>Sharpe</option><option>Win Rate</option><option>Max Drawdown (lower better)</option></select></div></div> <div class="opt-row svelte-dgb5y3"><div class="opt-label svelte-dgb5y3">Walk-forward</div> <div class="opt-control opt-toggle svelte-dgb5y3"><label class="toggle svelte-dgb5y3"><input type="checkbox" class="svelte-dgb5y3"> <span class="toggle-track svelte-dgb5y3"></span></label></div></div> <!> <div class="opt-actions svelte-dgb5y3"><button class="btn btn-xs btn-primary" type="button">Run grid</button> <!> <span class="opt-note svelte-dgb5y3">Up to 200 combos per run.</span></div> <!> <!>',1),vG=fe('<div class="bt-empty svelte-dgb5y3">No numeric inputs found. Add <code>input.int</code> or <code>input.float</code> to optimize.</div>'),fG=fe('<div><div class="mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div> <div> </div> <div class="right mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div></div>'),mG=fe('<div class="opt-test svelte-dgb5y3"> </div>'),gG=fe('<div class="opt-results-meta svelte-dgb5y3"> </div> <div class="opt-results svelte-dgb5y3"><div class="opt-results-head svelte-dgb5y3"><div>Params</div> <div class="right svelte-dgb5y3">Metric</div> <div class="right svelte-dgb5y3">Net</div> <div class="right svelte-dgb5y3">Ret%</div> <div class="right svelte-dgb5y3">DD%</div> <div class="right svelte-dgb5y3">Win%</div> <div class="right svelte-dgb5y3">Trades</div></div> <!></div> <!>',1),hG=fe('<div class="bt-empty svelte-dgb5y3">Run a grid search to see ranked results.</div>'),_G=(n,e)=>e("charts"),yG=(n,e)=>{x(e,"1w")},bG=(n,e)=>{x(e,"1m")},xG=(n,e)=>{x(e,"3m")},wG=(n,e)=>{x(e,"6m")},kG=(n,e)=>{x(e,"1y")},SG=(n,e)=>{x(e,"5y")},CG=(n,e)=>{x(e,"all")},PG=fe('<div class="report-metrics svelte-dgb5y3"><div class="metric svelte-dgb5y3"><span class="metric-label svelte-dgb5y3">Start</span> <span class="mono svelte-dgb5y3"> </span></div> <div class="metric svelte-dgb5y3"><span class="metric-label svelte-dgb5y3">End</span> <span class="mono svelte-dgb5y3"> </span></div> <div class="metric svelte-dgb5y3"><span class="metric-label svelte-dgb5y3">Net</span> <span> </span></div> <div class="metric svelte-dgb5y3"><span class="metric-label svelte-dgb5y3">Return</span> <span> </span></div> <div class="metric svelte-dgb5y3"><span class="metric-label svelte-dgb5y3">Range</span> <span class="mono svelte-dgb5y3"> </span></div></div>'),IG=gr('<path fill="none" stroke="var(--report-benchmark-stroke)" stroke-width="1.25" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path>'),MG=gr('<circle class="report-dot equity svelte-dgb5y3" r="1.8"></circle>'),AG=fe('<svg class="report-svg svelte-dgb5y3" viewBox="0 0 100 100" preserveAspectRatio="none" aria-label="Equity curve"><path fill="var(--report-equity-fill)"></path><path fill="none" stroke="var(--report-equity-stroke)" stroke-width="1.5" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path><!><line x1="0" y1="25" x2="100" y2="25" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="50" x2="100" y2="50" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="75" x2="100" y2="75" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><!></svg> <div class="chart-axis top mono svelte-dgb5y3"> </div> <div class="chart-axis bottom mono svelte-dgb5y3"> </div>',1),TG=fe('<div class="report-empty svelte-dgb5y3">No data</div>'),LG=fe('<div class="crosshair v svelte-dgb5y3"></div> <div class="crosshair h svelte-dgb5y3"></div> <div class="chart-tooltip svelte-dgb5y3"><div class="tt-title mono svelte-dgb5y3"> </div> <div class="tt-val svelte-dgb5y3">Equity: <span class="mono svelte-dgb5y3"> </span></div> <div class="tt-sub svelte-dgb5y3">Net: <span class="mono svelte-dgb5y3"> </span></div> <div class="tt-sub svelte-dgb5y3">Return: <span class="mono svelte-dgb5y3"> </span></div></div>',1),FG=fe('<div class="report-legend svelte-dgb5y3"><div class="legend-item svelte-dgb5y3"><span class="legend-dot equity svelte-dgb5y3"></span>Equity</div> <div class="legend-item svelte-dgb5y3"><span class="legend-dot bench svelte-dgb5y3"></span>Buy &amp; Hold</div></div>'),$G=fe('<div class="report-metrics svelte-dgb5y3"><div class="metric svelte-dgb5y3"><span class="metric-label svelte-dgb5y3">Worst DD</span> <span class="mono svelte-dgb5y3"> </span></div> <div class="metric svelte-dgb5y3"><span class="metric-label svelte-dgb5y3">Avg DD</span> <span class="mono svelte-dgb5y3"> </span></div> <div class="metric svelte-dgb5y3"><span class="metric-label svelte-dgb5y3">Last DD</span> <span class="mono svelte-dgb5y3"> </span></div></div>'),EG=gr('<circle class="report-dot dd svelte-dgb5y3" r="1.8"></circle>'),NG=fe('<svg class="report-svg svelte-dgb5y3" viewBox="0 0 100 100" preserveAspectRatio="none" aria-label="Drawdown"><path fill="var(--report-dd-fill)"></path><path fill="none" stroke="var(--report-dd-stroke)" stroke-width="1.5" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path><line x1="0" y1="25" x2="100" y2="25" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="50" x2="100" y2="50" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="75" x2="100" y2="75" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><!></svg> <div class="chart-axis top mono svelte-dgb5y3"> </div> <div class="chart-axis bottom mono svelte-dgb5y3"> </div>',1),DG=fe('<div class="report-empty svelte-dgb5y3">No data</div>'),jG=fe('<div class="tt-sub svelte-dgb5y3">Equity: <span class="mono svelte-dgb5y3"> </span></div>'),RG=fe('<div class="crosshair v svelte-dgb5y3"></div> <div class="crosshair h svelte-dgb5y3"></div> <div class="chart-tooltip svelte-dgb5y3"><div class="tt-title mono svelte-dgb5y3"> </div> <div class="tt-val svelte-dgb5y3">DD: <span class="mono svelte-dgb5y3"> </span></div> <!></div>',1),BG=(n,e)=>e("returns"),OG=(n,e,t,o,i)=>{e({type:"month",key:s(t).key}),o("focusIndex",{index:s(t).toIndex,timestamp:s(t).toTs}),i("trades")},zG=(n,e,t,o,i)=>{n.key==="Enter"&&(e({type:"month",key:s(t).key}),o("focusIndex",{index:s(t).toIndex,timestamp:s(t).toTs}),i("trades"))},VG=fe('<div role="button" tabindex="0"><div class="mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div></div>'),WG=fe('<div class="returns-table svelte-dgb5y3"><div class="rt-head svelte-dgb5y3"><div>Month</div> <div class="right svelte-dgb5y3">Return</div></div> <!></div>'),qG=fe('<div class="no-errors svelte-dgb5y3">No monthly returns yet.</div>'),HG=(n,e,t,o,i)=>{e({type:"week",key:s(t).key}),o("focusIndex",{index:s(t).toIndex,timestamp:s(t).toTs}),i("trades")},UG=(n,e,t,o,i)=>{n.key==="Enter"&&(e({type:"week",key:s(t).key}),o("focusIndex",{index:s(t).toIndex,timestamp:s(t).toTs}),i("trades"))},GG=fe('<div role="button" tabindex="0"><div class="mono svelte-dgb5y3"> </div> <div class="right mono svelte-dgb5y3"> </div></div>'),YG=fe('<div class="returns-table svelte-dgb5y3"><div class="rt-head svelte-dgb5y3"><div>Week</div> <div class="right svelte-dgb5y3">Return</div></div> <!></div>'),KG=fe('<div class="no-errors svelte-dgb5y3">No weekly returns yet.</div>'),ZG=(n,e)=>e("distributions"),XG=fe('<div class="hist-row svelte-dgb5y3"><div class="hist-label mono svelte-dgb5y3"> </div> <div class="hist-bar svelte-dgb5y3"><span class="svelte-dgb5y3"></span></div> <div class="hist-count mono svelte-dgb5y3"> </div></div>'),JG=fe('<div class="hist svelte-dgb5y3"></div>'),QG=fe('<div class="no-errors svelte-dgb5y3">No trades yet.</div>'),eY=fe('<div class="hist-row svelte-dgb5y3"><div class="hist-label mono svelte-dgb5y3"> </div> <div class="hist-bar svelte-dgb5y3"><span class="svelte-dgb5y3"></span></div> <div class="hist-count mono svelte-dgb5y3"> </div></div>'),tY=fe('<div class="hist svelte-dgb5y3"></div>'),nY=fe('<div class="no-errors svelte-dgb5y3">No MAE data.</div>'),oY=fe('<div class="hist-row svelte-dgb5y3"><div class="hist-label mono svelte-dgb5y3"> </div> <div class="hist-bar svelte-dgb5y3"><span class="svelte-dgb5y3"></span></div> <div class="hist-count mono svelte-dgb5y3"> </div></div>'),sY=fe('<div class="hist svelte-dgb5y3"></div>'),iY=fe('<div class="no-errors svelte-dgb5y3">No MFE data.</div>'),rY=fe('<div class="hist-row svelte-dgb5y3"><div class="hist-label mono svelte-dgb5y3"> </div> <div class="hist-bar svelte-dgb5y3"><span class="svelte-dgb5y3"></span></div> <div class="hist-count mono svelte-dgb5y3"> </div></div>'),aY=fe('<div class="hist svelte-dgb5y3"></div>'),lY=fe('<div class="no-errors svelte-dgb5y3">No duration data.</div>'),cY=(n,e)=>e("exports"),dY=(n,e)=>e("trades"),uY=(n,e)=>e("orders"),pY=fe('<button class="btn btn-sm btn-outline" type="button">Download Filtered Trades CSV</button>'),vY=fe('<div class="results-shell svelte-dgb5y3"><div class="results-hero svelte-dgb5y3"><div class="results-title-group svelte-dgb5y3"><div class="results-title svelte-dgb5y3">Strategy Results</div> <div class="results-sub svelte-dgb5y3">Latest run summary. Update inputs or filters, then press Run.</div></div> <div class="results-kpis svelte-dgb5y3"><div class="kpi svelte-dgb5y3"><div class="kpi-label svelte-dgb5y3">Final equity</div> <div class="kpi-value mono svelte-dgb5y3"> </div></div> <div class="kpi svelte-dgb5y3"><div class="kpi-label svelte-dgb5y3">Net PnL</div> <div> </div></div> <div class="kpi svelte-dgb5y3"><div class="kpi-label svelte-dgb5y3">Max drawdown</div> <div class="kpi-value mono svelte-dgb5y3"> </div></div></div></div> <div class="results-meta svelte-dgb5y3"><div class="meta-chip svelte-dgb5y3">Signals <span class="mono svelte-dgb5y3"> </span> <span class="meta-sub mono svelte-dgb5y3"> </span></div> <!> <!></div> <div class="results-section svelte-dgb5y3"><div class="section-head svelte-dgb5y3"><div><div class="section-title-row svelte-dgb5y3"><div class="section-title svelte-dgb5y3">Setup</div> <button class="info-btn svelte-dgb5y3" type="button" aria-label="Setup info">i</button></div> <div class="section-sub svelte-dgb5y3">Limit the backtest window or pin runs for comparison.</div></div></div> <div class="bt-tools svelte-dgb5y3"><div class="bt-tool-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Backtest Filters</div> <div class="bt-field-grid svelte-dgb5y3"><label class="bt-field svelte-dgb5y3"><span class="bt-label svelte-dgb5y3">From</span> <input class="input input-sm svelte-dgb5y3" type="date"></label> <label class="bt-field svelte-dgb5y3"><span class="bt-label svelte-dgb5y3">To</span> <input class="input input-sm svelte-dgb5y3" type="date"></label> <label class="bt-field svelte-dgb5y3"><span class="bt-label svelte-dgb5y3">Session</span> <input class="input input-sm svelte-dgb5y3" type="text" placeholder="0930-1600"></label></div> <div class="bt-actions svelte-dgb5y3"><button class="btn btn-xs btn-primary" type="button">Re-run</button> <!> <!> <div class="bt-note svelte-dgb5y3">Dates use UTC • Session HHMM‑HHMM</div></div></div> <div class="bt-tool-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Compare Runs</div> <div class="bt-compare-toolbar svelte-dgb5y3"><input class="input input-sm svelte-dgb5y3" type="text" placeholder="Label (optional)"> <button class="btn btn-xs btn-primary" type="button">Pin current</button> <!></div> <!></div></div></div> <div class="results-section svelte-dgb5y3"><div class="section-head svelte-dgb5y3"><div><div class="section-title-row svelte-dgb5y3"><div class="section-title svelte-dgb5y3">Performance Snapshot</div> <button class="info-btn svelte-dgb5y3" type="button" aria-label="Performance snapshot info">i</button></div> <div class="section-sub svelte-dgb5y3">Core stats for this run at a glance.</div></div></div> <div class="results-grid svelte-dgb5y3"><div class="result-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Trades</div> <div class="rc-value svelte-dgb5y3"> </div> <div class="rc-sub svelte-dgb5y3"> <!></div></div> <div class="result-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Win rate</div> <div class="rc-value svelte-dgb5y3"> </div> <div class="rc-sub svelte-dgb5y3"> </div></div> <div class="result-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Net PnL</div> <div class="rc-value svelte-dgb5y3"> </div> <div class="rc-sub svelte-dgb5y3"> </div></div> <div class="result-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Expectancy</div> <div class="rc-value svelte-dgb5y3"> </div> <div class="rc-sub svelte-dgb5y3"> </div></div> <div class="result-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Risk</div> <div class="rc-value svelte-dgb5y3"> </div> <div class="rc-sub svelte-dgb5y3"> </div></div> <div class="result-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Exposure</div> <div class="rc-value svelte-dgb5y3"> </div> <div class="rc-sub svelte-dgb5y3"> </div></div></div> <!></div> <div class="results-section svelte-dgb5y3"><div class="section-head svelte-dgb5y3"><div><div class="section-title-row svelte-dgb5y3"><div class="section-title svelte-dgb5y3">Trade Behavior</div> <button class="info-btn svelte-dgb5y3" type="button" aria-label="Trade behavior info">i</button></div> <div class="section-sub svelte-dgb5y3">Breakdowns by side and signal.</div></div></div> <div class="breakdown-grid svelte-dgb5y3"><div class="breakdown-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Long vs Short</div> <div class="breakdown-row svelte-dgb5y3"><span class="mono svelte-dgb5y3">Long</span> <span class="mono svelte-dgb5y3"> </span> <span class="mono svelte-dgb5y3"> </span> <span class="mono svelte-dgb5y3"> </span> <span class="mono svelte-dgb5y3"> </span></div> <div class="breakdown-row svelte-dgb5y3"><span class="mono svelte-dgb5y3">Short</span> <span class="mono svelte-dgb5y3"> </span> <span class="mono svelte-dgb5y3"> </span> <span class="mono svelte-dgb5y3"> </span> <span class="mono svelte-dgb5y3"> </span></div></div> <div class="breakdown-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Per‑Signal Stats</div> <!></div></div></div> <div class="results-section svelte-dgb5y3"><div class="section-head svelte-dgb5y3"><div><div class="section-title-row svelte-dgb5y3"><div class="section-title svelte-dgb5y3">Optimization</div> <button class="info-btn svelte-dgb5y3" type="button" aria-label="Optimization info">i</button></div> <div class="section-sub svelte-dgb5y3">Search numeric inputs and rank by the chosen metric.</div></div> <div class="section-meta mono svelte-dgb5y3"> <!></div></div> <div class="opt-grid svelte-dgb5y3"><div class="opt-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Params</div> <!></div> <div class="opt-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Results</div> <!></div></div></div> <div class="results-section svelte-dgb5y3"><div class="section-head svelte-dgb5y3"><div><div class="section-title-row svelte-dgb5y3"><div class="section-title svelte-dgb5y3">Charts</div> <button class="info-btn svelte-dgb5y3" type="button" aria-label="Charts info">i</button></div> <div class="section-sub svelte-dgb5y3">Equity and drawdown for the selected range.</div></div> <div class="section-meta svelte-dgb5y3"><div class="range-toggle svelte-dgb5y3" role="group" aria-label="Report range"><button type="button" class="svelte-dgb5y3">1W</button> <button type="button" class="svelte-dgb5y3">1M</button> <button type="button" class="svelte-dgb5y3">3M</button> <button type="button" class="svelte-dgb5y3">6M</button> <button type="button" class="svelte-dgb5y3">1Y</button> <button type="button" class="svelte-dgb5y3">5Y</button> <button type="button" class="svelte-dgb5y3">All</button></div></div></div> <div class="reports-grid svelte-dgb5y3"><div class="report-card svelte-dgb5y3"><div class="report-head svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Equity Curve</div> <div class="report-sub mono svelte-dgb5y3"><!></div></div> <!> <div class="report-canvas svelte-dgb5y3"><!> <!></div> <!></div> <div class="report-card svelte-dgb5y3"><div class="report-head svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Drawdown (%)</div> <div class="report-sub mono svelte-dgb5y3"> </div></div> <!> <div class="report-canvas svelte-dgb5y3"><!> <!></div></div></div></div> <div class="results-section svelte-dgb5y3"><div class="section-head svelte-dgb5y3"><div><div class="section-title-row svelte-dgb5y3"><div class="section-title svelte-dgb5y3">Returns</div> <button class="info-btn svelte-dgb5y3" type="button" aria-label="Returns info">i</button></div> <div class="section-sub svelte-dgb5y3">Monthly and weekly performance snapshots.</div></div></div> <div class="returns-grid svelte-dgb5y3"><div class="return-card svelte-dgb5y3"><div class="rc-title-row svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Monthly Returns</div></div> <div class="rc-subhint svelte-dgb5y3">Click a row to filter trades by that period.</div> <!></div> <div class="return-card svelte-dgb5y3"><div class="rc-title-row svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Weekly Returns</div></div> <div class="rc-subhint svelte-dgb5y3">Click a row to filter trades by that period.</div> <!></div></div></div> <div class="results-section svelte-dgb5y3"><div class="section-head svelte-dgb5y3"><div><div class="section-title-row svelte-dgb5y3"><div class="section-title svelte-dgb5y3">Distributions</div> <button class="info-btn svelte-dgb5y3" type="button" aria-label="Distributions info">i</button></div> <div class="section-sub svelte-dgb5y3">See how trades are distributed across outcomes.</div></div></div> <div class="dist-grid svelte-dgb5y3"><div class="dist-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">PnL% Distribution</div> <!></div> <div class="dist-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">MAE% Distribution</div> <!></div> <div class="dist-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">MFE% Distribution</div> <!></div> <div class="dist-card svelte-dgb5y3"><div class="rc-title svelte-dgb5y3">Trade Duration (bars)</div> <!></div></div></div> <div class="results-section svelte-dgb5y3"><div class="section-head svelte-dgb5y3"><div><div class="section-title-row svelte-dgb5y3"><div class="section-title svelte-dgb5y3">Exports & Totals</div> <button class="info-btn svelte-dgb5y3" type="button" aria-label="Exports info">i</button></div> <div class="section-sub svelte-dgb5y3">Download data or review totals for this run.</div></div></div> <div class="export-row svelte-dgb5y3"><button class="btn btn-sm btn-primary" type="button">Open Trades Table</button> <button class="btn btn-sm btn-primary" type="button">Open Orders Table</button> <button class="btn btn-sm btn-outline" type="button">Download Trades CSV</button> <!> <button class="btn btn-sm btn-outline" type="button">Download Orders CSV</button> <button class="btn btn-sm btn-outline" type="button">Download Equity CSV</button></div> <div class="pnl-strip svelte-dgb5y3"><div class="pnl-item pos svelte-dgb5y3"> </div> <div class="pnl-item neg svelte-dgb5y3"> </div> <div> </div></div> <div class="pnl-strip pnl-strip-2 svelte-dgb5y3"><div class="pnl-item svelte-dgb5y3"> </div> <div class="pnl-item svelte-dgb5y3"> </div> <div class="pnl-item svelte-dgb5y3"> </div></div></div></div>'),fY=fe('<div class="errors-area svelte-dgb5y3"><!> <!></div>'),mY=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},gY=(n,e)=>x(e,"en"),hY=(n,e)=>x(e,"bn"),_Y=fe("<li> </li>"),yY=fe("<li> </li>"),bY=fe('<ul class="info-list svelte-dgb5y3"></ul> <div class="info-example svelte-dgb5y3"><div class="info-example-title svelte-dgb5y3">Example</div> <ul class="svelte-dgb5y3"></ul></div>',1),xY=fe('<div class="info-modal-backdrop svelte-dgb5y3" role="presentation"><div class="info-modal svelte-dgb5y3" role="dialog" aria-modal="true" aria-label="Section info"><div class="info-modal-head svelte-dgb5y3"><div class="info-modal-title svelte-dgb5y3"> </div> <div class="info-modal-actions svelte-dgb5y3"><div class="info-lang-toggle svelte-dgb5y3" role="group" aria-label="Info language"><button type="button" class="svelte-dgb5y3">EN</button> <button type="button" class="svelte-dgb5y3">BN</button></div> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="info-modal-body svelte-dgb5y3"><!></div></div></div>'),wY=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},kY=(n,e)=>{n.key==="Enter"&&e()},SY=fe('<div class="library-loading svelte-dgb5y3">Loading saved scripts…</div>'),CY=fe('<div class="library-empty svelte-dgb5y3">No saved scripts yet.</div>'),PY=(n,e,t)=>x(e,N(s(t).id)),IY=fe('<button type="button"><div class="save-row-name svelte-dgb5y3"> </div> <div class="save-row-meta svelte-dgb5y3"> </div></button>'),MY=(n,e,t)=>s(e)&&t(s(e)),AY=fe('<div class="library-error svelte-dgb5y3"> </div>'),TY=fe('<div class="library-modal-backdrop svelte-dgb5y3" role="presentation"><div class="library-modal save-modal svelte-dgb5y3" role="dialog" aria-modal="true" aria-label="Save script"><div class="library-head svelte-dgb5y3"><div class="library-title svelte-dgb5y3">Save Script</div> <div class="library-head-actions svelte-dgb5y3"><button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="library-body save-grid svelte-dgb5y3"><div class="save-panel svelte-dgb5y3"><div class="save-card svelte-dgb5y3"><label class="input-label svelte-dgb5y3" for="save-script-name">Script name</label> <input id="save-script-name" class="input svelte-dgb5y3" placeholder="Enter a unique name"> <div class="save-actions svelte-dgb5y3"><button class="btn btn-sm btn-primary" type="button">Save as new</button> <span class="save-hint svelte-dgb5y3">Names must be unique</span></div></div></div> <div class="save-panel svelte-dgb5y3"><div class="save-card svelte-dgb5y3"><div class="save-divider svelte-dgb5y3">Overwrite existing</div> <div class="save-list svelte-dgb5y3"><!></div> <div class="save-actions overwrite-actions svelte-dgb5y3"><button class="btn btn-sm btn-primary" type="button">Overwrite selected</button> <span class="save-hint svelte-dgb5y3">Replaces the selected script with current code</span></div></div></div> <!></div></div></div>'),LY=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},FY=fe('<div class="library-error svelte-dgb5y3"> </div>'),$Y=fe('<div class="library-loading svelte-dgb5y3">Loading scripts…</div>'),EY=fe('<div class="library-empty svelte-dgb5y3">No scripts found.</div>'),NY=(n,e,t)=>e(s(t)),DY=(n,e,t)=>e(s(t)),jY=(n,e,t)=>e(s(t)),RY=(n,e,t)=>e(s(t)),BY=(n,e,t)=>e(s(t).id),OY=fe('<div class="library-row svelte-dgb5y3"><div><div class="library-name svelte-dgb5y3"> </div> <div class="library-meta svelte-dgb5y3"> </div></div> <div class="library-actions svelte-dgb5y3"><button class="btn btn-xs btn-outline" type="button">Edit</button> <button class="btn btn-xs btn-outline" type="button">Insert</button> <button class="btn btn-xs btn-outline" type="button">Run</button> <button class="btn btn-xs btn-outline" type="button">Copy</button> <button class="btn btn-xs btn-danger svelte-dgb5y3" type="button">Delete</button></div></div>'),zY=fe('<div class="library-list svelte-dgb5y3"></div>'),VY=fe('<div class="library-modal-backdrop svelte-dgb5y3" role="presentation"><div class="library-modal svelte-dgb5y3" role="dialog" aria-modal="true" aria-label="My script library"><div class="library-head svelte-dgb5y3"><div class="library-title svelte-dgb5y3">My Script Library</div> <div class="library-head-actions svelte-dgb5y3"><button class="btn btn-xs btn-outline" type="button">Refresh</button> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="library-toolbar svelte-dgb5y3"><input class="input library-search svelte-dgb5y3" type="search" placeholder="Search scripts"> <div class="library-count svelte-dgb5y3"> </div></div> <!> <div class="library-body svelte-dgb5y3"><!></div></div></div>'),WY=fe('<span class="footer-alert-line svelte-dgb5y3"> </span>'),qY=fe('<span tabindex="0"><span class="footer-alert-icon svelte-dgb5y3">!</span> <span class="footer-alert-label svelte-dgb5y3"> </span> <span class="footer-alert-tip svelte-dgb5y3" role="tooltip"><span class="footer-alert-title svelte-dgb5y3"> </span> <!></span></span>'),HY=fe('<div class="script-studio svelte-dgb5y3"><div class="studio-header svelte-dgb5y3"><div class="studio-title svelte-dgb5y3"><div class="title-dot svelte-dgb5y3"></div> <div class="title-text-group svelte-dgb5y3"><div class="title-text svelte-dgb5y3">Script Studio</div> <div class="title-sub svelte-dgb5y3">Inline editor · draft → chart</div></div></div> <div class="studio-meta svelte-dgb5y3"><div class="view-toggle svelte-dgb5y3"><button type="button" class="svelte-dgb5y3">Editor</button> <button type="button" class="svelte-dgb5y3"><span> </span> <!></button> <button type="button" class="svelte-dgb5y3">Results</button></div> <div class="lang-toggle svelte-dgb5y3" aria-label="Script mode"><span class="lang-label svelte-dgb5y3">Mode</span> <select class="lang-select svelte-dgb5y3"><option>Auto</option><option>JSON</option><option>Pine</option><option>DSL</option></select></div></div> <div class="studio-actions svelte-dgb5y3"><!> <button class="ghost svelte-dgb5y3" type="button" title="Toggle chart labels"><span class="btn-icon svelte-dgb5y3"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M2 3.5h8M2 6h8M2 8.5h5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span> </span></button> <button class="ghost ghost-secondary svelte-dgb5y3" type="button"><span>Documentation</span></button> <button class="ghost svelte-dgb5y3" type="button"><span>Alerts</span></button> <button class="ghost svelte-dgb5y3" type="button"><span>My Library</span></button> <button class="ghost svelte-dgb5y3" type="button"><span class="btn-icon svelte-dgb5y3"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M3 2.5h6v7H3z" stroke="currentColor" stroke-width="1.2"></path><path d="M4 1h4v2H4z" fill="currentColor"></path><path d="M5 7h2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span>Save</span></button> <button class="ghost svelte-dgb5y3" type="button"><span class="btn-icon svelte-dgb5y3"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M6 2a4 4 0 1 1-3.5 2.06" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path><path d="M2.5 2.5v3h3" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span>Reset</span></button> <button class="primary svelte-dgb5y3" type="button"><span class="btn-icon svelte-dgb5y3"><svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true"><path d="M4 3.2v5.6L9 6 4 3.2Z"></path></svg></span> <span> </span></button> <!> <button class="icon svelte-dgb5y3" type="button" aria-label="Collapse script dock">&times;</button></div></div> <div class="editor-area svelte-dgb5y3"><div class="editor-shell svelte-dgb5y3"><div class="editor-main svelte-dgb5y3"><div class="editor-toolbar svelte-dgb5y3"><div class="editor-file svelte-dgb5y3"><span class="file-dot svelte-dgb5y3"></span> <span class="file-name svelte-dgb5y3"> </span> <span class="file-meta svelte-dgb5y3"> </span></div> <div class="editor-hints svelte-dgb5y3"><span class="hint svelte-dgb5y3">1. Write or paste script</span> <span class="hint svelte-dgb5y3">2. Press Run ▶</span></div></div> <div class="editor-scroll svelte-dgb5y3"><!></div></div> <!></div></div> <!> <!> <!> <!> <div class="studio-footer svelte-dgb5y3"><div class="footer-left svelte-dgb5y3"><span></span> <span class="footer-text svelte-dgb5y3"> </span> <!></div> <div class="footer-right svelte-dgb5y3"><span class="footer-hint svelte-dgb5y3">Ctrl/Cmd + S to save</span> <span class="footer-divider svelte-dgb5y3">•</span> <span class="footer-hint svelte-dgb5y3">Ctrl/Cmd + Enter to run</span></div></div></div>');function UY(n,e){gd(e,!0);let t=Ws(e,"code",15,""),o=Ws(e,"codeVersion",3,0),i=Ws(e,"status",3,null),r=Ws(e,"error",3,null),a=Ws(e,"backtest",3,null),l=Ws(e,"signalEvents",19,()=>[]),c=Ws(e,"isRunning",3,!1),d=Ws(e,"isOpen",3,!0),p=Ws(e,"paneTarget",7,"main"),m=Ws(e,"labelsEnabled",3,!0);const h=mv();function _(){const U=M(t());(typeof t()!="string"||U!==t())&&(t(U),s(Wd)&&sr&&(cp=!0,sr.setValue(U),cp=!1)),h("run",{code:U,params:s(ot),lang:s(_t),backtest:s(fi)})}const w="https://noti.dutyai.app/auth/chart/scripts",S=U=>String(U||"").trim().toLowerCase(),P=U=>{const te=String(U||""),$e=te.match(/^\s*library\s*\(\s*["']([^"']+)["']/im);if($e)return $e[1];const ut=te.match(/^\s*(indicator|study|strategy)\s*\(\s*["']([^"']+)["']/im);return ut?ut[2]:null},I=()=>typeof window<"u"?localStorage.getItem("userId"):null,C=U=>{if(typeof U=="string")return U;if(U==null)return"";try{return JSON.stringify(U,null,2)}catch{return String(U)}},M=U=>{if(typeof U=="string"){const te=U.trim();if(te.startsWith("{")&&te.includes('"script"')){try{const $e=JSON.parse(te);if($e&&typeof $e=="object"&&typeof $e.script=="string"&&($e.userPreferenceId||$e.createdAt||$e.updatedAt))return $e.script}catch{}if(te.includes('"userPreferenceId"')||te.includes('"createdAt"')){const $e=te.match(/"script"\s*:\s*"([\s\S]*?)"\s*,\s*"(?:name|userPreferenceId|createdAt)"/);if($e&&$e[1])try{return JSON.parse(`"${$e[1]}"`)}catch{}}}return U}if(U&&typeof U=="object"){const te=U.script??U.code;if(typeof te=="string")return te}return C(U)};let F=ae(!1),V=ae(!1),j=ae(!1),D=ae(null),R=ae(""),W=ae(N([])),J=ae(!1),Z=ae(""),G=ae(null),se=ae(!1),Y=ae(null);function oe(U){h("saveStatus",{status:U})}const ee=U=>{if(typeof U=="number"&&Number.isFinite(U))return U;if(typeof U=="string"&&U.trim()){const te=Date.parse(U);if(Number.isFinite(te))return te}return Date.now()},re=U=>{if(!U)return null;const te=String(U.id||U._id||U.scriptId||U.name||"").trim()||`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,$e=String(U.name||U.title||"Untitled Script").trim(),ut=U.script??U.code??U.source??"",Kt=C(ut).trim(),$t=ee(U.createdAt||U.created_at),wn=ee(U.updatedAt||U.updated_at||$t);return{id:te,name:$e,code:Kt,createdAt:$t,updatedAt:wn}},me=U=>[...U].sort((te,$e)=>($e.updatedAt||0)-(te.updatedAt||0));async function K(U=!1){if(s(j)&&!U)return;x(V,!0),x(D,null);const te=I();if(!te){const $e=me(i_());x(W,N($e)),x(j,!0),x(V,!1);return}try{const $e=await fetch(`${w}/${te}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!$e.ok){const Zn=await $e.text();throw new Error(Zn||`${$e.status} ${$e.statusText}`)}const ut=await $e.json(),$t=(Array.isArray(ut)?ut:Array.isArray(ut==null?void 0:ut.data)?ut.data:Array.isArray(ut==null?void 0:ut.scripts)?ut.scripts:[]).map(re).filter(Boolean),wn=me($t);x(W,N(wn)),U0(wn),x(j,!0)}catch{const ut=me(i_());x(W,N(ut)),x(j,!0),x(D,"Could not reach server. Showing local copies.")}finally{x(V,!1)}}function ye(){x(J,!0),x(G,null),x(Y,null);const U=P(M(t()));x(Z,N(U||"")),K(!1)}const Me=(U,te)=>{const $e=S(U);return $e?(s(W).length?s(W):i_()).some(Kt=>S(Kt.name)===$e&&Kt.id!==te):!1};async function Fe(){if(s(se))return;const U=String(s(Z)||"").trim();if(!U){x(G,"Enter a script name to save.");return}if(Me(U)){x(G,"That name already exists. Choose a different name.");return}x(se,!0),x(G,null);const te=I();try{let $e=null;const ut=M(t());if(te){const Kt=await fetch(`${w}/${te}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:U,script:ut})});if(!Kt.ok){const Zn=await Kt.text();throw new Error(Zn||`${Kt.status} ${Kt.statusText}`)}const $t=await Kt.json(),wn=re({id:($t==null?void 0:$t.id)||($t==null?void 0:$t.scriptId)||($t==null?void 0:$t._id),name:U,script:($t==null?void 0:$t.script)||($t==null?void 0:$t.code)||ut,createdAt:$t==null?void 0:$t.createdAt,updatedAt:$t==null?void 0:$t.updatedAt});wn&&($e=wn,r2($e))}else $e=rq(U,ut);$e&&(x(W,N(me([$e,...s(W).filter(Kt=>Kt.id!==$e.id)]))),U0(s(W)),oe(`Saved • ${$e.name}`)),x(J,!1)}catch{x(G,"Save failed. Please try again.")}finally{x(se,!1)}}async function Ze(U){if(s(se))return;const te=s(W).find(Kt=>Kt.id===U);if(!te)return;const $e=String(te.name||"").trim();if(!$e)return;if(Me($e,U)){x(G,"Another script already uses this name.");return}x(se,!0),x(G,null);const ut=I();try{let Kt=null;const $t=M(t());if(ut){const wn=await fetch(`${w}/${U}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:$e,script:$t})});if(!wn.ok){const es=await wn.text();throw new Error(es||`${wn.status} ${wn.statusText}`)}const Zn=await wn.json(),yo=re({id:U,name:$e,script:(Zn==null?void 0:Zn.script)||(Zn==null?void 0:Zn.code)||$t,createdAt:te.createdAt,updatedAt:(Zn==null?void 0:Zn.updatedAt)||Date.now()});yo&&(Kt=yo,r2(Kt))}else Kt=aq(U,{code:$t,name:$e});Kt&&(x(W,N(me([Kt,...s(W).filter(wn=>wn.id!==Kt.id)]))),U0(s(W)),oe(`Saved • ${Kt.name}`)),x(J,!1)}catch{x(G,"Update failed. Please try again.")}finally{x(se,!1)}}async function Ge(U){const te=s(W).find(Kt=>Kt.id===U);if(!te||!(typeof window>"u"?!0:window.confirm(`Delete "${te.name}"? This cannot be undone.`)))return;const ut=I();try{if(ut){const $t=await fetch(`${w}/${U}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!$t.ok){const wn=await $t.text();throw new Error(wn||`${$t.status} ${$t.statusText}`)}}else lq(U);const Kt=s(W).filter($t=>$t.id!==U);x(W,N(me(Kt))),U0(s(W)),oe(`Deleted • ${te.name}`)}catch{x(D,"Delete failed. Please try again.")}}async function it(U){try{await navigator.clipboard.writeText(String(U.code||"")),oe(`Copied • ${U.name}`)}catch{oe("Copy failed")}}async function Ye(U,te){const $e=M(t()),ut=M(U),Kt=te!=null&&te.append&&$e?`${$e}

${ut}`.trim():ut;t(Kt),s(Wd)&&sr&&(cp=!0,sr.setValue(Kt),cp=!1),x(he,"editor"),await A1(),requestAnimationFrame(()=>Ps==null?void 0:Ps.layout()),te!=null&&te.run&&_()}function ct(U){Ye(U)}async function kt(U){await Ye(U.code||""),x(F,!1),oe(`Loaded • ${U.name}`)}async function ft(U){await Ye(U.code||"",{append:!0}),x(F,!1),oe(`Inserted • ${U.name}`)}async function bt(U){await Ye(U.code||"",{run:!0}),x(F,!1)}const nt=()=>{const U=String(s(R)||"").trim().toLowerCase();return U?s(W).filter(te=>String(te.name||"").toLowerCase().includes(U)):s(W)},Pt=U=>{if(!Number.isFinite(U))return"";try{return new Date(U).toLocaleString()}catch{return""}};mr(()=>{const U=M(t());U!==t()&&(t(U),s(Wd)&&sr&&(cp=!0,sr.setValue(U),cp=!1))});function Qe(U){p()!==U&&(p(U),h("pane",{target:U}))}const yt=U=>{if(!U)return 0;let te=2166136261;for(let ut=0;ut<U.length;(ut+=1)-1)te^=U.charCodeAt(ut),te=Math.imul(te,16777619);const $e=te>>>0;return $e===0?1:$e},xe=U=>{const te=String(U||"");let $e="",ut=0;for(;ut<te.length;){const Kt=te[ut];if(Kt==='"'||Kt==="'"){const $t=Kt;ut+=1;let wn="",Zn=!1;for(;ut<te.length;){const yo=te[ut];if(Zn){wn+=yo,Zn=!1,ut+=1;continue}if(yo==="\\"){Zn=!0,ut+=1;continue}if(yo===$t){ut+=1;break}wn+=yo,ut+=1}$e+=String(yt(wn));continue}$e+=Kt,ut+=1}return $e},Ve=U=>{let te=String(U||"").trim();return te=te.replace(/\/\/.*$/,"").replace(/#.*$/,""),te=te.split(";")[0],te=te.replace(/,\s*$/,""),te=te.replace(/\b(and|or)\b\s*$/i,""),te=te.replace(/\bta\./gi,""),te=te.replace(/\bmath\./gi,""),te=te.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),te=te.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,($e,ut,Kt)=>`${String(ut).toLowerCase()}_${Kt}`),te=xe(te),te=te.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),te=te.replace(/\bcrosses\s+below\b/gi,"crossesBelow"),te.trim()},Je=["close","open","high","low","hl2","hlc3","ohlc4","volume"],St=U=>{const te=typeof U=="number"?U:Number(U);if(!Number.isFinite(te)||te<=0)return"";try{return new Date(te).toISOString().slice(0,16)}catch{return""}},Ne=U=>{if(!U)return null;const te=Date.parse(U);if(Number.isFinite(te))return te;const $e=Number(U);return Number.isFinite($e)?$e:null},ue=U=>{const te=String(U||"").trim();if(/^#([0-9a-f]{6}|[0-9a-f]{3})$/i.test(te))return te.length===4?`#${te[1]}${te[1]}${te[2]}${te[2]}${te[3]}${te[3]}`:te;const $e=te.match(/^rgba?\(([^)]+)\)$/i);if($e){const ut=$e[1].split(",").map(Kt=>Kt.trim());if(ut.length>=3){const Kt=Number(ut[0]),$t=Number(ut[1]),wn=Number(ut[2]);if([Kt,$t,wn].every(Zn=>Number.isFinite(Zn))){const Zn=yo=>Math.max(0,Math.min(255,Math.round(yo))).toString(16).padStart(2,"0");return`#${Zn(Kt)}${Zn($t)}${Zn(wn)}`}}}return"#22c55e"};let he=ae("editor"),_t=ae("auto"),Wt=ae(N(!!m())),jt=ae(!1),Zt=ae("trades"),dn=ae("compact"),zn=ae("compact"),un=ae(!1);const On={setup:{en:{title:"Setup",desc:["Backtest Filters define the time window for the run (date range + session).","Filters do not change results until you press Run again.","Session uses HHMM-HHMM (leave blank for full day).","Compare Runs saves a snapshot (results + inputs) when you press Pin current.","Use Compare to see how parameter changes affect results side-by-side."],examples:["From 2025-01-01 to 2025-03-31 + Session 0930-1600 -> Run shows only those hours.","Pin Run A -> change fast=10 -> Run -> Pin Run B to compare."]},bn:{title:"সেটআপ",desc:["Backtest Filters মানে কোন সময়ের ডেটা নিয়ে টেস্ট করবেন (তারিখ + সেশন)।","ফিল্টার বদলালেই ফল বদলায় না—আবার Run দিলেই নতুন ফল আসবে।","Session ফরম্যাট HHMM-HHMM; ফাঁকা রাখলে পুরো দিন ধরা হয়।","Pin current দিলে ওই মুহূর্তের ফল + ইনপুট সেভ হয়।","Compare দিয়ে ছোট পরিবর্তনের ফল পাশাপাশিই দেখা যায়।"],examples:["From 2025-01-01, To 2025-03-31 + Session 0930-1600 দিলে শুধু ওই সময়ের ফল।","Run A Pin -> fast=10 দিন -> Run -> Pin -> দুইটা রানের ফল তুলনা।"]}},performance:{en:{title:"Performance Snapshot",desc:["Trades means a complete position: entry -> exit. For long it is buy->sell; for short it is sell->buy.","Net PnL is your real profit after fees; Return (%) compares that to your starting capital.","Max Drawdown is the biggest fall from a previous peak; smaller is safer.","Profit Factor > 1 means total wins are larger than total losses; Expectancy is avg profit per trade.","Sharpe/Sortino show risk-adjusted return; Exposure shows how long you were in the market."],examples:["A 60% win rate with negative Net PnL means losses are larger than wins.","A smooth, slowly rising equity curve usually means lower risk."]},bn:{title:"পারফরম্যান্স স্ন্যাপশট",desc:["Trades মানে সম্পূর্ণ একটি পজিশন: entry থেকে exit। Long হলে buy->sell, short হলে sell->buy।","Net PnL হলো আসল লাভ/ক্ষতি: মোট লাভ থেকে ফি/চার্জ বাদ।","Return (%) দেখায় শুরু করা টাকার তুলনায় কত শতাংশ লাভ/ক্ষতি হলো।","Max Drawdown মানে আগের সর্বোচ্চ লেভেল থেকে সবচেয়ে বড় পতন—এটা যত কম, তত নিরাপদ।","Profit Factor > 1 হলে লাভ ক্ষতির চেয়ে বেশি; Expectancy হলো প্রতি ট্রেডে গড় লাভ/ক্ষতি।","Sharpe/Sortino বলে একই লাভ করতে কত ঝুঁকি নিয়েছেন; Exposure দেখায় কত সময় ট্রেডে ছিলেন।"],examples:["Win rate বেশি হলেও Net negative হলে loss-গুলো বড় হয়েছে।","কম Drawdown + ধীরে ওপরে ওঠা curve মানে স্টেবল ট্রেডিং।"]}},behavior:{en:{title:"Trade Behavior",desc:["Long vs Short splits performance by direction.","Per-Signal Stats groups trades by signal ID so you can see what works.","Signals with low Net/PF are usually the ones to fix or remove.","Use this section to debug entries/exits, not just profitability."],examples:["Short trades = 0 means a long-only strategy.","If EXIT_FULL is net negative, your exit logic may be hurting results."]},bn:{title:"ট্রেড বিহেভিয়ার",desc:["Long বনাম Short আলাদা করে দেখায় কোন দিক বেশি কাজ করেছে।","Per-Signal Stats দেখায় কোন signal ID লাভ/ক্ষতি দিচ্ছে।","যে signal বারবার ক্ষতি করে, সেটি পরিবর্তন বা বন্ধ করতে পারবেন।","Trades/Net/PF দেখে বোঝা যায় কোনটা শক্তিশালী।"],examples:["Short ট্রেড 0 হলে long-only।","EXIT_FULL যদি net negative হয়, exit logic ঠিক করুন।"]}},optimization:{en:{title:"Optimization",desc:["Optimization only works if your script defines input.int or input.float.","Param A/B choose which inputs to sweep.","From/To/Step sets the grid values for each parameter.","Total runs = count(A) x count(B); too many combos triggers a warning.","Metric controls ranking (Max DD: lower is better).","Walk-forward splits Train/Test so results are more realistic."],examples:["Fast 5->20 step 5 gives 4 values; Slow 20->60 step 10 gives 5 values -> 20 runs.","Top row is best by the chosen metric."]},bn:{title:"অপ্টিমাইজেশন",desc:["Optimization কাজ করবে শুধু input.int বা input.float থাকলে।","Param A/B মানে কোন ইনপুটের মান ঘুরিয়ে দেখা হবে।","From/To/Step দিয়ে রেঞ্জ সেট হয়।","মোট রান = A-র মান x B-র মান (খুব বেশি হলে warning আসবে)।","Metric অনুযায়ী র‍্যাংক হয় (Max DD হলে কম মান ভালো)।","Walk-forward দিলে Train/Test আলাদা হয়ে বাস্তবসম্মত ফল পাওয়া যায়।"],examples:["Fast 5->20 step 5 = 4 মান; Slow 20->60 step 10 = 5 মান -> মোট 20 রান।","Top row মানে সেরা ফল।"]}},charts:{en:{title:"Charts",desc:["Equity curve (area + line) shows how your balance moved over time.","Buy & Hold line is the benchmark: what if you just held.","Drawdown chart shows the depth of pullbacks from peaks.","Range buttons only change the chart window, not the backtest itself."],examples:["Equity above Buy & Hold means the strategy outperformed holding.","Hover to see the exact date and equity value."]},bn:{title:"চার্টস",desc:["Equity curve (area + line) দেখায় আপনার ব্যালেন্স সময়ের সাথে কেমন বদলেছে।","Buy & Hold line হলো তুলনা—শুধু ধরে রাখলে কী হতো।","Drawdown chart দেখায় সবচেয়ে বড় পতন কত % ছিল।","1M/3M/6M/All শুধু চার্ট রেঞ্জ বদলায়, ট্রেড রেজাল্ট নয়।"],examples:["Equity line যদি Buy & Hold-এর উপরে থাকে, স্ট্র্যাটেজি ভালো।","Hover করলে নির্দিষ্ট দিনের equity দেখা যায়।"]}},returns:{en:{title:"Returns",desc:["Monthly/Weekly returns show which periods were good or bad.","Click a row to filter trades for that period.","Great for spotting seasonality or outlier months.","Empty means there were no trades in that period."],examples:["2025-02 +3.2% means that month was profitable.","Click a week row, then open Trades table to see those trades."]},bn:{title:"রিটার্নস",desc:["Monthly/Weekly রিটার্নস দেখায় কোন সময় ভালো বা খারাপ গেছে।","Row ক্লিক করলে ওই সময়ের ট্রেড ফিল্টার হয়।","Seasonality ধরতে কাজে লাগে।","ডেটা না থাকলে ওই সময় ট্রেড হয়নি।"],examples:["2025-02 মাসে +3.2% মানে লাভ।","Week row ক্লিক করলে Trades টেবিলে ফিল্টার হয়।"]}},distributions:{en:{title:"Distributions",desc:["PnL% histogram shows how trade outcomes are spread.","MAE% = worst adverse move; MFE% = best favorable move.","Duration shows how long trades usually last (in bars).","Use these to tune stops, targets, and holding time."],examples:["If most PnL% bins are small, results are consistent but modest.","High MAE suggests trades go deep negative before exit."]},bn:{title:"ডিস্ট্রিবিউশন",desc:["PnL% histogram দেখায় ফলাফল কোন রেঞ্জে বেশি হচ্ছে।","MAE% = সবচেয়ে খারাপ adverse move; MFE% = সবচেয়ে ভালো move।","Duration দিয়ে ট্রেড কত বার ধরে থাকে বোঝা যায়।","এগুলো দেখে stop-loss/TP টিউন করা যায়।"],examples:["PnL% ছোট রেঞ্জে বেশি মানে consistent ছোট লাভ।","MAE বেশি হলে ট্রেড আগে অনেক নিচে যায়।"]}},exports:{en:{title:"Exports & Totals",desc:["Open Trades/Orders tables to inspect each trade and order.","CSV exports are for Excel/Sheets or external analysis.","Totals summarize gross profit, gross loss, net, initial/final equity.","Filtered trades CSV respects the current month/week filter."],examples:["Use Trades CSV to build custom reports.","Total = Gross Profit - Gross Loss (fees shown separately)."]},bn:{title:"এক্সপোর্টস ও টোটালস",desc:["Trades/Orders টেবিলে প্রতিটি ট্রেডের Net PnL/fees/price দেখা যায়।","CSV ডাউনলোড করে Excel/Sheets-এ বিশ্লেষণ করা যায়।","Totals-এ gross profit, gross loss, net, initial/final equity দেখা যায়।","Filtered trades CSV বর্তমান ফিল্টার মেনে চলে।"],examples:["Trades CSV দিয়ে custom রিপোর্ট বানান।","Total = Gross Profit - Gross Loss (fees আলাদা)।"]}}};let no=ae(!1),fs=ae("setup"),ps=ae("bn");function So(U){x(fs,N(U)),x(no,!0)}let Es=ae(N([])),Qo=ae("");function Ko(U){x(Es,N(s(Es).filter(ut=>ut.id!==U))),s(Ed)===U&&x(Ed,null);const{[U]:te,...$e}=s(zl);x(zl,N($e))}let oo=ae(""),Gs=ae(""),jo=ae("");const fi=vt(()=>{const U={},te=s(oo).trim(),$e=s(Gs).trim(),ut=s(jo).trim();return te&&(U.from=te),$e&&(U.to=$e),ut&&(U.session=ut),Object.keys(U).length?U:null}),ba=vt(()=>!!s(fi)),xa=vt(()=>{const U=[];return(s(oo)||s(Gs))&&U.push(`${s(oo)||"…"} → ${s(Gs)||"…"}`),s(jo)&&U.push(`Session ${s(jo)}`),U.join(" • ")}),Al=vt(()=>s(De).filter(U=>U.type==="int"||U.type==="float"));let Qs=ae(!1),Fs=ae(""),Va=ae(""),$r=ae(0),cd=ae(0),Sd=ae(1),Nl=ae(0),dd=ae(0),Cd=ae(1),fa=ae("netPnl"),Dl=ae(!1),ml=ae(N([])),gl=ae(0),_d=ae(!1),Kl=ae(N([])),ic=ae(""),od=ae(!1),zd=ae(70),Ec=ae("train"),al=ae(null),kc=ae(0);const Vd=vt(()=>s(ml).length),sd=vt(()=>s(Vd)>0?Math.min(100,Math.round(s(gl)/s(Vd)*100)):0),id=vt(()=>[...s(Kl)].sort((U,te)=>hn(te.summary)-hn(U.summary))),Pd=vt(()=>s(fa)==="profitFactor"?"Profit Factor":s(fa)==="sharpe"?"Sharpe":s(fa)==="winRate"?"Win Rate":s(fa)==="maxDrawdownPct"?"Max DD (lower is better)":"Net PnL");let Ed=ae(null),zl=ae(N({}));function Gd(U){x(Ed,N(s(Ed)===U?null:U))}function lu(U){x(zl,N({...s(zl),[U]:!s(zl)[U]}))}function Yd(U,te=40){if(U==null)return"—";let $e="";if(typeof U=="number"||typeof U=="boolean")$e=String(U);else if(typeof U=="string")$e=U;else try{$e=JSON.stringify(U)}catch{$e=String(U)}return te>0&&$e.length>te?`${$e.slice(0,te-1)}…`:$e}function eu(U){return U?Object.entries(U).slice(0,6).map(([te,$e])=>`${te}=${Yd($e,18)}`).join(", "):"-"}const Ju=U=>[{label:"Final",value:Lo(U.finalEquity,2)},{label:"Net",value:`${U.netPnl>=0?"+":""}${Lo(U.netPnl,2)} (${Xs(U.netPnlPct??0)})`},{label:"DD",value:Xs(U.maxDrawdownPct??0)},{label:"PF",value:Hr(U.profitFactor??0)},{label:"Win",value:Xs(U.winRate??0)},{label:"Trades",value:String(U.trades??0)},{label:"Sharpe",value:Hr(U.sharpe??0)},{label:"Sortino",value:Hr(U.sortino??0)},{label:"Exposure",value:Xs(U.exposurePct??0)},{label:"Bars/Trade",value:Lo(U.avgBarsInTrade??0,1)}];function mu(U){try{return JSON.stringify({label:U.label,ts:U.ts,params:U.params,summary:U.summary},null,2)}catch{return String(U.summary)}}function yd(U){const te=s(Al).find(wn=>wn.name===U),$e=typeof(te==null?void 0:te.defval)=="number"?te.defval:0,ut=typeof(te==null?void 0:te.minval)=="number"?te.minval:$e,Kt=typeof(te==null?void 0:te.maxval)=="number"?te.maxval:$e,$t=typeof(te==null?void 0:te.step)=="number"?te.step:(te==null?void 0:te.type)==="int"?1:.1;return{from:ut,to:Kt,step:$t}}function tn(U){x(Fs,N(U));const te=yd(U);x($r,N(te.from)),x(cd,N(te.to)),x(Sd,N(te.step))}function En(U){if(x(Va,N(U)),!U)return;const te=yd(U);x(Nl,N(te.from)),x(dd,N(te.to)),x(Cd,N(te.step))}mr(()=>{s(Qs)||s(Al).length&&(tn(s(Al)[0].name),s(Al).length>1&&En(s(Al)[1].name),x(Qs,!0))});function go(U,te,$e,ut){const Kt=s(Al).find(oi=>oi.name===U),$t=(Kt==null?void 0:Kt.type)==="int",wn=Math.abs(ut||1);if(!Number.isFinite(te)||!Number.isFinite($e)||!Number.isFinite(wn)||wn<=0)return[];const Zn=[],yo=te<=$e?1:-1;let es=te,$s=0;for(;yo>0&&es<=$e+1e-9||yo<0&&es>=$e-1e-9;){const oi=$t?Math.round(es):Number(es.toFixed(6));if(Zn.push(oi),es+=wn*yo,$s+=1,$s>2e3)break}return Array.from(new Set(Zn))}function hn(U){return U?s(fa)==="profitFactor"?U.profitFactor??0:s(fa)==="sharpe"?U.sharpe??0:s(fa)==="winRate"?U.winRate??0:s(fa)==="maxDrawdownPct"?-(U.maxDrawdownPct??0):U.netPnl??0:-1/0}function Ho(U){return U?s(fa)==="profitFactor"?U.profitFactor??0:s(fa)==="sharpe"?U.sharpe??0:s(fa)==="winRate"?U.winRate??0:s(fa)==="maxDrawdownPct"?U.maxDrawdownPct??0:U.netPnl??0:0}function Eo(U){const te=Ho(U);return s(fa)==="winRate"||s(fa)==="maxDrawdownPct"?Xs(te):Lo(te,2)}function di(U){const te=s(fi)&&typeof s(fi)=="object"?{...s(fi)}:null;return!te&&!U?null:{...te||{},...U||{}}}function ns(U){if(!s(ml).length)return;const te=s(ml)[U];if(!te)return;const $e=s(od)?$i(s(Ec)):null,ut=di($e);x(_d,!0),h("run",{code:t(),params:te.params,lang:s(_t),backtest:ut})}function $i(U){var $t,wn;if(!s(ur).length)return null;const te=Number(($t=s(ur)[0])==null?void 0:$t.timestamp),$e=Number((wn=s(ur)[s(ur).length-1])==null?void 0:wn.timestamp);if(!Number.isFinite(te)||!Number.isFinite($e)||$e<=te)return null;const ut=Math.max(10,Math.min(90,Number(s(zd))||70))/100,Kt=Math.round(te+($e-te)*ut);return U==="train"?{from:te,to:Kt}:{from:Kt,to:$e}}mr(()=>{var $t;if(!s(Dl)||!s(_d)||c())return;const U=Cm(a()),te=Number((U==null?void 0:U._updatedAt)??0),$e=Number(Cm(s(kc)));if(!U||!te||te===$e)return;x(kc,N(te)),x(_d,!1);const ut=(($t=s(ml)[s(gl)])==null?void 0:$t.params)||{},Kt=U.summary;if(Kt&&(x(Kl,N([...s(Kl),{params:ut,summary:Kt}])),s(od)&&s(Ec)==="test"&&x(al,N({params:ut,summary:Kt}))),x(gl,s(gl)+1),s(gl)<s(ml).length)ns(s(gl));else if(s(od)&&s(Ec)==="train"){const wn=[...s(Kl)].sort((Zn,yo)=>hn(yo.summary)-hn(Zn.summary))[0];wn?(x(ml,N([{params:wn.params}])),x(gl,0),x(Ec,"test"),ns(0)):x(Dl,!1)}else x(Dl,!1)});const hi=vt(()=>s(_t)==="auto"?"auto":s(_t)),li=U=>{const te=String(U||"").trim();return te.startsWith("{")||te.startsWith("[")},ks=U=>{const te=String(U||"").split(/\r?\n/),$e=Math.min(8,te.length);for(let ut=0;ut<$e;(ut+=1)-1){const $t=(te[ut]||"").match(/^\s*(?:\/\/|#)\s*@?(?:lang|language)\s*(?::|=)?\s*([A-Za-z]+)\s*$/i);if(!$t)continue;const wn=String($t[1]||"").toLowerCase();if(wn==="auto"||wn==="json"||wn==="pine"||wn==="dsl")return wn}return null},Vi=vt(()=>{if(s(_t)!=="auto")return s(_t);const U=ks(t());return U||(li(t())?"json":"auto")});mr(()=>{x(Wt,N(!!m()))});const gs=vt(()=>s(he)==="results");function ll(){x(un,!1),h("fullpage",{enabled:!1})}fv(()=>{const U=te=>{s(un)&&te.key==="Escape"&&(te.preventDefault(),ll())};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)}),fv(async()=>{if(!(typeof window>"u")&&s(pn)==="idle"){x(pn,"loading");try{_q();const U=await im(()=>import("../chunks/editor.api.DpKcps1Q.js").then(ut=>ut.m),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url);if(await Promise.all([im(()=>import("../chunks/monaco.contribution.Bf0eDI41.js"),__vite__mapDeps([15,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),im(()=>import("../chunks/monaco.contribution.B8wnmoa3.js"),__vite__mapDeps([16,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),im(()=>import("../chunks/monaco.contribution.CLgm81C9.js"),__vite__mapDeps([17,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),im(()=>import("../chunks/monaco.contribution.naCy6iCV.js"),__vite__mapDeps([18,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),im(()=>import("../chunks/suggestController.CNhpv9Eh.js"),__vite__mapDeps([19,1,2,3,4,5,6,12,20,21,22]),import.meta.url),im(()=>import("../chunks/parameterHints.D3SwLJfR.js"),__vite__mapDeps([23,2,1,3,24]),import.meta.url),im(()=>import("../chunks/hoverContribution.CrobZDmU.js"),__vite__mapDeps([25,2,1,3,11,4,5,6,20,21,9,10,26]),import.meta.url),im(()=>import("../chunks/formatActions.BuL_rer4.js"),__vite__mapDeps([27,2,4,13,11]),import.meta.url)]),os=U,zv(U),Vv(U),ud(U),await A1(),!s(Nn)){x(pn,"failed");return}const te=Rc(String(t()||""));x(qp,N(te)),sr=U.editor.createModel(String(t()||""),te),Ps=U.editor.create(s(Nn),{model:sr,automaticLayout:!0,minimap:{enabled:!1},fontSize:13,fontFamily:'JetBrains Mono, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace',lineNumbers:"on",scrollBeyondLastLine:!1,wordWrap:"on",theme:Bc(),quickSuggestions:{other:!0,comments:!1,strings:!0},suggestOnTriggerCharacters:!0,parameterHints:{enabled:!0},inlineSuggest:{enabled:!0},tabCompletion:"on",snippetSuggestions:"inline",wordBasedSuggestions:!1,quickSuggestionsDelay:40}),Ps.addAction({id:"scriptstudio.format",label:"Format Document",keybindings:[U.KeyMod.CtrlCmd|U.KeyMod.Shift|U.KeyCode.KeyF],run:()=>Ps==null?void 0:Ps.getAction("editor.action.formatDocument").run()}),Cl.push(Ps.onDidType(ut=>{if(Ps&&(ut==="."||ut==="("))try{const Kt=Ps.getAction("editor.action.triggerSuggest");Kt?Kt.run():Ps.trigger("keyboard","editor.action.triggerSuggest",{})}catch{}})),Cl.push(Ps.onDidChangeModelContent(()=>{if(!sr||cp)return;Lc=!0;const ut=sr.getValue();ut!==t()&&t(ut),Lc=!1}));const $e=new MutationObserver(()=>{os&&os.editor.setTheme(Bc())});if($e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),$e.observe(document.body,{attributes:!0,attributeFilter:["data-theme"]}),Cl.push({dispose:()=>$e.disconnect()}),typeof ResizeObserver<"u"){const ut=new ResizeObserver(()=>{Ps==null||Ps.layout()});s(Nn)&&ut.observe(s(Nn)),Cl.push({dispose:()=>ut.disconnect()})}x(pn,"ready"),qd()}catch(U){console.warn("[ScriptStudio] Monaco init failed:",U),x(pn,"failed")}}}),Lm(()=>{try{s(un)&&h("fullpage",{enabled:!1})}catch{}Cl.forEach(U=>U.dispose()),Cl=[],Ps==null||Ps.dispose(),sr==null||sr.dispose(),Ps=null,sr=null});const mi=vt(()=>{try{const U=JSON.parse(String(t()||"").trim());return!!(U!=null&&U.strategy)}catch{return!1}}),Na=vt(()=>{try{const U=JSON.parse(String(t()||"").trim());return Array.isArray(U==null?void 0:U.signals)&&U.signals.length>0}catch{return!1}}),le=vt(()=>{try{return g_(String(t()||""))}catch{return null}}),we=vt(()=>{const U=s(le);return!!(U&&U.ok&&U.spec&&U.spec.strategy)}),H=vt(()=>{const U=s(le),te=U&&U.ok&&U.spec?U.spec.signals:null;return Array.isArray(te)&&te.length>0}),ne=vt(()=>!!(s(mi)||s(we))),_e=vt(()=>!!(s(Na)||s(H))),q=vt(()=>{const U=s(le);return!U||!U.ok?[]:Array.isArray(U.warnings)?U.warnings:[]}),De=vt(()=>{const U=s(le);return!U||!U.ok?[]:Array.isArray(U.inputDefs)?U.inputDefs:[]});let ot=ae(null);mr(()=>{if(!s(De).length){x(ot,null);return}s(ot)==null&&x(ot,N({}))});const je=vt(()=>{const U={};for(const te of s(De))U[te.name]=s(ot)&&te.name in s(ot)?s(ot)[te.name]:te.defval;return U}),Ft=(U,te)=>{x(ot,N({...s(ot)||{},[U]:te}))},Be=vt(()=>{var U;return((U=a())==null?void 0:U.summary)||null}),xt=vt(()=>{if(!s(gs))return{total:0,entryLong:0,exitLong:0,entryShort:0,exitShort:0,lastTs:null};const U=Array.isArray(l())?l():[],te={total:U.length,entryLong:0,exitLong:0,entryShort:0,exitShort:0};let $e=null;for(const ut of U){if(!ut)continue;ut.type==="entry_long"?te.entryLong+=1:ut.type==="exit_long"?te.exitLong+=1:ut.type==="entry_short"?te.entryShort+=1:ut.type==="exit_short"&&(te.exitShort+=1);const Kt=Number(ut.timestamp);Number.isFinite(Kt)&&($e=$e==null?Kt:Math.max($e,Kt))}return{...te,lastTs:$e}}),an=vt(()=>{var U;return s(gs)&&Array.isArray((U=a())==null?void 0:U.trades)?a().trades:[]}),Yn=vt(()=>{var U;return s(gs)&&Array.isArray((U=a())==null?void 0:U.orders)?a().orders:[]}),bn=U=>{const te=typeof U=="number"?U:Number(U);return!Number.isFinite(te)||te<=0?null:te<1e12?te*1e3:te},be=U=>{const te=bn(U);if(te==null)return"-";try{const ut=new Date(te).toISOString();return`${ut.slice(0,10)} ${ut.slice(11,16)}`}catch{return"-"}},tt=U=>{const te=typeof U=="number"?U:Number(U);return Number.isFinite(te)?te:null},wt=vt(()=>{var Kt;const U=s(gs)&&Array.isArray((Kt=a())==null?void 0:Kt.roundTrips)?a().roundTrips:[],te=s(an).length===0&&U.length>0,$e=(te?U:s(an)).filter($t=>$t&&Number.isFinite(Number($t.entryIndex))&&Number.isFinite(Number($t.exitIndex))).slice().sort(($t,wn)=>Number($t.exitIndex)-Number(wn.exitIndex)||Number($t.entryIndex)-Number(wn.entryIndex));let ut=0;return $e.map(($t,wn)=>{const Zn=tt($t.pnl??$t.grossPnl??$t.profit),yo=tt($t.fees??$t.fee??$t.commission),es=te&&Number.isFinite(Number($t.netPnl))?Number($t.netPnl):(Zn??0)-(yo??0);ut+=es;const $s=bn($t.entryTimestamp),oi=bn($t.exitTimestamp),Ts=be($s),hr=be(oi),Vr=[$t.side||"",$t.entryIndex,$t.exitIndex,$s??0,oi??0,$t.entryOrderId??"",$t.exitOrderId??"",wn].join(":"),Nt=tt(te?$t.avgEntryPrice??$t.entryPrice??$t.entry:$t.entryPrice??$t.entry_price??$t.entry),Wn=tt(te?$t.avgExitPrice??$t.exitPrice??$t.exit:$t.exitPrice??$t.exit_price??$t.exit);return{id:Vr,side:String($t.side||""),qty:tt($t.qty??$t.size??$t.qtyEntered)??0,entryIndex:Number($t.entryIndex)||0,exitIndex:Number($t.exitIndex)||0,entryTimestamp:$s,exitTimestamp:oi,entryTimeLabel:Ts,exitTimeLabel:hr,entryPrice:Nt??0,exitPrice:Wn??0,entrySignalId:$t.entrySignalId!=null?String($t.entrySignalId):"",exitSignalId:$t.exitSignalId!=null?String($t.exitSignalId):"",pnl:Zn??0,pnlPct:tt($t.pnlPct??$t.pnl_pct??$t.returnPct)??0,fees:yo??0,netPnl:es,cumNet:ut,exitReason:String($t.exitReason||""),maePct:Number.isFinite(Number($t.maePct))?Number($t.maePct):null,mfePct:Number.isFinite(Number($t.mfePct))?Number($t.mfePct):null,barsHeld:Math.max(0,(Number($t.exitIndex)||0)-(Number($t.entryIndex)||0)+1)}})}),Lt=vt(()=>s(Yn).filter(te=>te&&Number.isFinite(Number(te.createdIndex))).slice().sort((te,$e)=>Number(te.createdIndex)-Number($e.createdIndex)||String(te.id||"").localeCompare(String($e.id||""))).map((te,$e)=>{const ut=bn(te.createdTimestamp),Kt=bn(te.filledTimestamp),$t=String(te.kind||"").toLowerCase(),wn=String(te.action||""),Zn=String(te.side||""),yo=String(te.status||""),es=tt(te.qty??te.quantity),$s=tt(te.cash),oi=tt(te.price),Ts=tt(te.stopPrice),hr=tt(te.limitPrice),Vr=String(yo||"").toLowerCase().replace(/[^a-z0-9]+/g,"-");return{id:String(te.id||$e),action:wn,actionLabel:Xl(wn),side:Zn,sideLabel:Xl(Zn),kind:String(te.kind||""),kindLabel:Nd(te.kind),originalKind:String(te.originalKind||""),status:yo,statusLabel:Xl(yo),statusKey:Vr,signalId:te.signalId!=null?String(te.signalId):"",ocoGroup:te.ocoGroup!=null?String(te.ocoGroup):"",createdIndex:Number(te.createdIndex)||0,createdTimestamp:ut,createdTimeLabel:be(ut),activeFromIndex:Number(te.activeFromIndex)||0,expiresAtIndex:Number.isFinite(Number(te.expiresAtIndex))?Number(te.expiresAtIndex):null,qtyPct:Number(te.qtyPct)||0,qty:es,cash:$s,price:oi,stopPrice:Ts??($t==="stop"?oi:null),limitPrice:hr??($t==="limit"?oi:null),filledIndex:Number.isFinite(Number(te.filledIndex))?Number(te.filledIndex):null,filledTimestamp:Kt,filledTimeLabel:be(Kt),fillPrice:tt(te.fillPrice),fillQty:tt(te.fillQty),fees:tt(te.fees),note:te.note!=null?String(te.note):""}})),qt=vt(()=>s(Lt).length>500?s(Lt).slice(s(Lt).length-500):s(Lt));let qn=ae(N({type:"all"})),Xt=ae(""),vo=ae(N({key:"exitIndex",dir:"desc"}));function To(U){s(vo).key===U?x(vo,N({key:U,dir:s(vo).dir==="asc"?"desc":"asc"})):x(vo,N({key:U,dir:"desc"}))}function co(U){return s(vo).key!==U?"":s(vo).dir==="asc"?"↑":"↓"}const so=vt(()=>{const U=s(wt),te=Zn=>{const yo=Number(Zn==null?void 0:Zn.exitTimestamp);return!Number.isFinite(yo)||yo<=0?!1:s(qn).type==="month"?At(yo)===s(qn).key:s(qn).type==="week"?pt(yo)===s(qn).key:!0},$e=s(Xt).trim().toLowerCase(),ut=s(qn).type==="all"?U:U.filter(te),Kt=$e?ut.filter(Zn=>[Zn.side,Zn.exitReason,Zn.entrySignalId,Zn.exitSignalId,String(Zn.entryIndex),String(Zn.exitIndex)].filter(Boolean).map(es=>String(es).toLowerCase()).some(es=>es.includes($e))):ut,$t=s(vo).dir==="asc"?1:-1,wn=s(vo).key;return Kt.slice().sort((Zn,yo)=>{const es=Zn==null?void 0:Zn[wn],$s=yo==null?void 0:yo[wn];if(wn==="side")return String(es).localeCompare(String($s))*$t;const oi=typeof es=="number"?es:Number(es),Ts=typeof $s=="number"?$s:Number($s);return!Number.isFinite(oi)&&!Number.isFinite(Ts)?0:Number.isFinite(oi)?Number.isFinite(Ts)?(oi-Ts)*$t:-1:1})}),Jo=U=>{const te=U.length;let $e=0,ut=0,Kt=0,$t=0,wn=0,Zn=0,yo=0,es=0,$s=0;for(const Wn of U){const Co=Number(Wn==null?void 0:Wn.netPnl)||0,mo=Number(Wn==null?void 0:Wn.fees)||0,Bo=Number(Wn==null?void 0:Wn.pnl)||0;Kt+=Co,$t+=mo,wn+=Bo,Bo>0?Zn+=Bo:Bo<0&&(yo+=Math.abs(Bo)),Co>0?($e+=1,es+=Co):Co<0&&(ut+=1,$s+=Co)}const oi=te?$e/te*100:0,Ts=$e?es/$e:0,hr=ut?$s/ut:0,Vr=yo>0?Zn/yo:Zn>0?1/0:0,Nt=te?$e/te*Ts+ut/te*hr:0;return{trades:te,wins:$e,losses:ut,winRate:oi,net:Kt,fees:$t,gross:wn,grossProfit:Zn,grossLoss:yo,profitFactor:Vr,avgWin:Ts,avgLoss:hr,expectancy:Nt}},Os=vt(()=>{const U=s(wt).filter($e=>String($e.side)==="long"),te=s(wt).filter($e=>String($e.side)==="short");return{long:Jo(U),short:Jo(te)}}),wr=vt(()=>{const U=s(wt),te=new Map;for(const ut of U){const Kt=String(ut.entrySignalId||ut.exitSignalId||"unknown"),$t=te.get(Kt)||[];$t.push(ut),te.set(Kt,$t)}const $e=Array.from(te.entries()).map(([ut,Kt])=>({id:ut,...Jo(Kt)}));return $e.sort((ut,Kt)=>(Kt.net||0)-(ut.net||0)),$e}),ra=vt(()=>{const U=s(wt).map(te=>Number(te==null?void 0:te.pnlPct)).filter(te=>Number.isFinite(te));return ce(U,12)}),Qr=vt(()=>{const U=s(wt).map(te=>Number(te==null?void 0:te.maePct)).filter(te=>Number.isFinite(te));return ce(U,10)}),hl=vt(()=>{const U=s(wt).map(te=>Number(te==null?void 0:te.mfePct)).filter(te=>Number.isFinite(te));return ce(U,10)}),lc=vt(()=>{const U=s(wt).map(te=>Number(te==null?void 0:te.barsHeld)).filter(te=>Number.isFinite(te));return ce(U,10)}),qr=vt(()=>s(so).length>500?s(so).slice(s(so).length-500):s(so)),Ga=vt(()=>s(wt).reduce((U,te)=>U+(Number(te.netPnl)||0),0));let Ki=ae(null);function Zl(U){x(Ki,N((U==null?void 0:U.id)||null)),h("selectTrade",{trade:U||null})}function Tl(U){x(qn,N(U)),s(Ki)&&(s(so).some($e=>$e.id===s(Ki))||x(Ki,null))}function Ya(U){x(Zt,N(U)),x(jt,!0)}const ur=vt(()=>{var U;return s(gs)&&Array.isArray((U=a())==null?void 0:U.equity)?a().equity:[]}),rc=vt(()=>{var U;return s(gs)&&Array.isArray((U=a())==null?void 0:U.benchmark)?a().benchmark:[]});let zr=ae("6m");function rd(U,te){var $t;if(!Array.isArray(U)||U.length===0)return[];if(te==="all")return U;const $e=Number(($t=U[U.length-1])==null?void 0:$t.timestamp);if(!Number.isFinite($e)||$e<=0)return U;const ut=te==="1w"?7:te==="1m"?30:te==="3m"?90:te==="6m"?180:te==="1y"?365:365*5,Kt=$e-ut*864e5;return U.filter(wn=>Number(wn==null?void 0:wn.timestamp)>=Kt)}const cc=vt(()=>rd(s(ur),s(zr))),dc=vt(()=>rd(s(rc),s(zr))),Er=vt(()=>s(cc).map(U=>({index:Number(U.index),ts:Number(U.timestamp),equity:Number(U.equity)})).filter(U=>Number.isFinite(U.index)&&Number.isFinite(U.ts)&&Number.isFinite(U.equity))),Sc=vt(()=>s(dc).map(U=>({index:Number(U.index),ts:Number(U.timestamp),equity:Number(U.equity)})).filter(U=>Number.isFinite(U.index)&&Number.isFinite(U.ts)&&Number.isFinite(U.equity))),ea=vt(()=>{if(!s(Er).length)return[];let U=-1/0;return s(Er).map(te=>{U=Math.max(U,te.equity);const $e=U>0?(te.equity-U)/U*100:0;return{index:te.index,ts:te.ts,ddPct:$e}})}),Cc=vt(()=>{if(!s(Er).length)return null;const U=s(Er)[0].equity,te=s(Er)[s(Er).length-1].equity;let $e=1/0,ut=-1/0;for(const wn of s(Er))wn.equity<$e&&($e=wn.equity),wn.equity>ut&&(ut=wn.equity);const Kt=te-U,$t=U!==0?Kt/U*100:0;return{first:U,last:te,net:Kt,retPct:$t,min:$e,max:ut}}),Ac=vt(()=>{if(!s(ea).length)return null;let U=0,te=0;for(const Kt of s(ea)){const $t=Number(Kt.ddPct)||0;$t<U&&(U=$t),te+=$t}const $e=te/s(ea).length,ut=s(ea)[s(ea).length-1].ddPct??0;return{worstAbs:Math.abs(U),avgAbs:Math.abs($e),lastAbs:Math.abs(ut)}}),cu=vt(()=>{if(!s(ge)||!s(Er).length)return null;const U=s(Er)[s(Er).length-1],te=s(ge).maxY-s(ge).minY;return!Number.isFinite(te)||te===0?null:{x:100,y:(1-(U.equity-s(ge).minY)/te)*100,value:U.equity}}),Id=vt(()=>{if(!s(dt)||!s(ea).length)return null;const U=s(ea)[s(ea).length-1],te=s(dt).maxY-s(dt).minY;return!Number.isFinite(te)||te===0?null:{x:100,y:(1-(U.ddPct-s(dt).minY)/te)*100,value:U.ddPct}});function Zc(U,te){const $e=U.filter(hr=>Number.isFinite(hr));if(!$e.length)return null;const ut=typeof te=="number"&&Number.isFinite(te)?te:Math.min(...$e);let Kt=Math.min(...$e,ut),$t=Math.max(...$e,ut);if(!Number.isFinite(Kt)||!Number.isFinite($t))return null;Kt===$t&&(Kt-=1,$t+=1);const wn=$e.length,Zn=hr=>wn<=1?0:hr/(wn-1)*100,yo=hr=>(1-(hr-Kt)/($t-Kt))*100,es=yo(ut),$s=$e.map((hr,Vr)=>({x:Zn(Vr),y:yo(hr)})),oi=$s.map((hr,Vr)=>`${Vr===0?"M":"L"} ${hr.x.toFixed(3)} ${hr.y.toFixed(3)}`).join(" "),Ts=[`M ${$s[0].x.toFixed(3)} ${es.toFixed(3)}`,...$s.map(hr=>`L ${hr.x.toFixed(3)} ${hr.y.toFixed(3)}`),`L ${$s[$s.length-1].x.toFixed(3)} ${es.toFixed(3)}`,"Z"].join(" ");return{line:oi,area:Ts,minY:Kt,maxY:$t,baselineY:es}}function ce(U,te){const $e=U.filter(Zn=>Number.isFinite(Zn));if(!$e.length||te<=0)return[];let ut=Math.min(...$e),Kt=Math.max(...$e);if(ut===Kt)return[{label:`${Lo(ut,2)}`,count:$e.length,min:ut,max:Kt}];const $t=(Kt-ut)/te,wn=[];for(let Zn=0;Zn<te;(Zn+=1)-1){const yo=ut+$t*Zn,es=Zn===te-1?Kt:ut+$t*(Zn+1);wn.push({label:`${Lo(yo,2)}–${Lo(es,2)}`,count:0,min:yo,max:es})}for(const Zn of $e){const yo=Math.min(wn.length-1,Math.floor((Zn-ut)/$t));wn[yo].count+=1}return wn}function st(U){let te=0;for(const $e of U)$e.count>te&&(te=$e.count);return te||1}const ge=vt(()=>Zc(s(Er).map(U=>U.equity))),Le=vt(()=>Zc(s(Sc).map(U=>U.equity))),dt=vt(()=>Zc(s(ea).map(U=>U.ddPct),0));function At(U){const te=new Date(U),$e=te.getUTCFullYear(),ut=String(te.getUTCMonth()+1).padStart(2,"0");return`${$e}-${ut}`}function pt(U){const te=new Date(U),$e=new Date(Date.UTC(te.getUTCFullYear(),te.getUTCMonth(),te.getUTCDate())),ut=$e.getUTCDay()||7;$e.setUTCDate($e.getUTCDate()+4-ut);const Kt=new Date(Date.UTC($e.getUTCFullYear(),0,1)),$t=Math.ceil((($e-Kt)/864e5+1)/7);return`${$e.getUTCFullYear()}-W${String($t).padStart(2,"0")}`}function at(U,te){if(!(U!=null&&U.length))return[];const $e=te==="month"?At:pt,ut=new Map;for(const Zn of U){const yo=Number(Zn==null?void 0:Zn.timestamp),es=Number(Zn==null?void 0:Zn.equity),$s=Number(Zn==null?void 0:Zn.index);if(!Number.isFinite(yo)||!Number.isFinite(es)||!Number.isFinite($s))continue;const oi=$e(yo),Ts=ut.get(oi);Ts?Ts.last={ts:yo,eq:es,idx:$s}:ut.set(oi,{first:{ts:yo,eq:es,idx:$s},last:{ts:yo,eq:es,idx:$s}})}const Kt=Array.from(ut.keys()).sort(),$t=[];let wn=null;for(const Zn of Kt){const yo=ut.get(Zn),es=Number(yo.last.eq);if(!Number.isFinite(es))continue;if(wn==null){wn=es;continue}const $s=wn!==0?(es-wn)/wn*100:0;$t.push({key:Zn,retPct:$s,from:wn,to:es,toIndex:Number(yo.last.idx),toTs:Number(yo.last.ts)}),wn=es}return $t}const Ct=vt(()=>at(s(ur),"month")),Re=vt(()=>at(s(ur),"week")),kn=vt(()=>{const U=new Map;for(const te of s(wt)){const $e=Number(te==null?void 0:te.exitTimestamp);if(!Number.isFinite($e)||$e<=0)continue;const ut=At($e),Kt=U.get(ut)||{trades:0,wins:0,losses:0,net:0,fees:0},$t=Number(te==null?void 0:te.netPnl)||0;Kt.trades+=1,Kt.net+=$t,Kt.fees+=Number(te==null?void 0:te.fees)||0,$t>0?Kt.wins+=1:$t<0&&(Kt.losses+=1),U.set(ut,Kt)}return U}),ro=vt(()=>{const U=new Map;for(const te of s(wt)){const $e=Number(te==null?void 0:te.exitTimestamp);if(!Number.isFinite($e)||$e<=0)continue;const ut=pt($e),Kt=U.get(ut)||{trades:0,wins:0,losses:0,net:0,fees:0},$t=Number(te==null?void 0:te.netPnl)||0;Kt.trades+=1,Kt.net+=$t,Kt.fees+=Number(te==null?void 0:te.fees)||0,$t>0?Kt.wins+=1:$t<0&&(Kt.losses+=1),U.set(ut,Kt)}return U});function uo(U){const te=$e=>{const ut=$e==null?"":String($e);return/[",\n]/.test(ut)?`"${ut.replace(/"/g,'""')}"`:ut};return U.map(te).join(",")}function hs(U,te,$e){try{const ut=new Blob([te],{type:$e}),Kt=URL.createObjectURL(ut),$t=document.createElement("a");$t.href=Kt,$t.download=U,document.body.appendChild($t),$t.click(),$t.remove(),setTimeout(()=>URL.revokeObjectURL(Kt),2500)}catch{}}const Ei=190,ei=86,Ys=10;let Ht=ae(null),qe=ae(null);const fn=vt(()=>{try{const U=JSON.parse(String(t()||"").trim());return!!(U!=null&&U.pane||U!=null&&U.panes||U!=null&&U.main||U!=null&&U.sub)}catch{return!1}});mr(()=>{s(Er),s(ea),s(he),s(he)});function Fn(U){var Vr;if(!s(Er).length)return;const $e=U.currentTarget.getBoundingClientRect(),ut=Math.max(0,Math.min(Ei,$e.width-Ys*2)),Kt=Math.max(0,Math.min(ei,$e.height-Ys*2)),$t=Math.max(0,Math.min($e.width,U.clientX-$e.left)),wn=Math.max(0,Math.min($e.height,U.clientY-$e.top)),Zn=Math.round($t/Math.max(1,$e.width)*(s(Er).length-1)),yo=s(Er)[Zn];if(!yo)return;const es=((Vr=s(Er)[0])==null?void 0:Vr.equity)??yo.equity,$s=yo.equity-es,oi=es!==0?$s/es*100:0;let Ts=$t+12;Ts+ut+Ys>$e.width&&(Ts=$t-12-ut),Ts=Math.max(Ys,Math.min(Ts,$e.width-ut-Ys));let hr=wn-12-Kt;hr<Ys&&(hr=wn+12),hr=Math.max(Ys,Math.min(hr,$e.height-Kt-Ys)),x(Ht,N({x:$t,y:wn,left:Ts,top:hr,ts:yo.ts,equity:yo.equity,net:$s,retPct:oi}))}function Vt(U){var Ts;if(!s(ea).length)return;const $e=U.currentTarget.getBoundingClientRect(),ut=Math.max(0,Math.min(Ei,$e.width-Ys*2)),Kt=Math.max(0,Math.min(ei,$e.height-Ys*2)),$t=Math.max(0,Math.min($e.width,U.clientX-$e.left)),wn=Math.max(0,Math.min($e.height,U.clientY-$e.top)),Zn=Math.round($t/Math.max(1,$e.width)*(s(ea).length-1)),yo=s(ea)[Zn];if(!yo)return;const es=(Ts=s(Er)[Zn])==null?void 0:Ts.equity;let $s=$t+12;$s+ut+Ys>$e.width&&($s=$t-12-ut),$s=Math.max(Ys,Math.min($s,$e.width-ut-Ys));let oi=wn-12-Kt;oi<Ys&&(oi=wn+12),oi=Math.max(Ys,Math.min(oi,$e.height-Kt-Ys)),x(qe,N({x:$t,y:wn,left:$s,top:oi,ts:yo.ts,ddPct:yo.ddPct,equity:Number.isFinite(es)?es:null}))}const mn=vt(()=>String(t()||"").split(`
`)),Kn=vt(()=>s(mn).length||1);function Pn(U,te){let $e=1,ut=1;for(let Kt=0;Kt<te&&Kt<U.length;Kt+=1)U[Kt]===`
`?($e+=1,ut=1):ut+=1;return{line:$e,col:ut}}function Hn(U){try{return{ok:!0,value:JSON.parse(U)}}catch(te){const $e=String((te==null?void 0:te.message)||"Invalid JSON"),ut=$e.match(/position\s+(\d+)/i),Kt=ut?Number(ut[1]):null,$t=typeof Kt=="number"&&Number.isFinite(Kt)?Pn(U,Kt):void 0;return{ok:!1,error:{level:"error",message:$e,hint:"Fix JSON syntax (quotes/commas/braces).",line:$t==null?void 0:$t.line,col:$t==null?void 0:$t.col}}}}function No(){var $t,wn,Zn,yo;const U=[],te=String(t()||"").trim();if(!te)return U;const $e=/^\s*\/\/@\s*(?:pine|version)\b/m.test(te)||/\b(strategy|indicator|plot)\s*\(/m.test(te),ut=s(Vi);if(ut==="pine"||ut==="auto"&&$e){try{const es=g_(te);es&&es.ok===!1&&Array.isArray(es.errors)&&es.errors.length&&es.errors.slice(0,12).forEach($s=>{U.push({level:"error",message:String(($s==null?void 0:$s.message)||"Pine error"),hint:"Fix the Pine line or use the Guide examples.",line:typeof($s==null?void 0:$s.line)=="number"?$s.line:void 0,col:1})})}catch{}return U}if(ut==="dsl"||ut==="auto"&&!li(te))return U;const Kt=Hn(te);if(!Kt.ok)return U.push(Kt.error),U;try{const es=Kt.value;if(es&&(es.plots||es.calc||es.panes||es.main||es.sub)){const $s=es&&typeof es=="object"?es.params||{}:{},oi=K1(es,$s);let Ts=oi;try{Ts=X1(oi)}catch(Oo){return U.push({level:"error",message:`Template expansion error: ${String((Oo==null?void 0:Oo.message)||Oo)}`,hint:"Check repeat/forEach blocks and loop sizes."}),U}const hr=Y1(Ts);hr.ok||(hr.errors||[]).forEach(Oo=>U.push({level:"error",message:Oo,hint:B(Oo)}));const Vr=Ts.pane||Ts.plots||Ts.labels||Ts.levels||Ts.lines?{pane:Ts.pane||"main",plots:Ts.plots||[],labels:Ts.labels||[],levels:Ts.levels||[],lines:Ts.lines||[],min:Ts.min,max:Ts.max}:null,Nt=[].concat(Vr?[Vr]:[]).concat(Ts.panes||[]).concat(Ts.main?[Ts.main]:[]).concat(Ts.sub?[Ts.sub]:[]),Wn=Array.isArray(Ts.calc)?Ts.calc:[],Co=Array.isArray(Ts.series)?Ts.series:[],mo=Array.isArray(($t=hr.spec)==null?void 0:$t.series)?(wn=hr.spec)==null?void 0:wn.series:[],Bo=Array.isArray((Zn=hr.spec)==null?void 0:Zn.stateSeries)?(yo=hr.spec)==null?void 0:yo.stateSeries:[],ws=new Set(["open","high","low","close","volume","time","bar_index"]);Co.forEach(Oo=>{const ss=String((Oo==null?void 0:Oo.name)||"").replace(/\s+/g,"_").toLowerCase();ss&&ws.add(ss)}),mo.forEach(Oo=>{const ss=String((Oo==null?void 0:Oo.name)||"").replace(/\s+/g,"_").toLowerCase();ss&&ws.add(ss)}),Bo.forEach(Oo=>{const ss=String((Oo==null?void 0:Oo.name)||"").replace(/\s+/g,"_").toLowerCase();ss&&ws.add(ss)}),Wn.forEach(Oo=>{const ss=String((Oo==null?void 0:Oo.type)||(Oo==null?void 0:Oo.name)||"").toLowerCase(),ds=String((Oo==null?void 0:Oo.name)||(Oo==null?void 0:Oo.type)||"").replace(/\s+/g,"_").toLowerCase();if(t2.includes(ss)||ss&&U.push({level:"error",message:`Unsupported calc type "${Oo==null?void 0:Oo.type}"`,hint:`Use one of: ${Array.from(t2).join(", ")}`}),ss==="ema"){const yn=Oo==null?void 0:Oo.period;(typeof yn!="number"||!(yn>0))&&U.push({level:"error",message:"EMA requires numeric period > 0",hint:'Add "period": e.g., 20'})}if(ss==="macd"){const yn=wo=>typeof wo=="number"&&wo>0;(!yn(Oo==null?void 0:Oo.fast)||!yn(Oo==null?void 0:Oo.slow)||!yn(Oo==null?void 0:Oo.signal))&&U.push({level:"error",message:"MACD requires numeric fast/slow/signal",hint:'Add "fast":12, "slow":26, "signal":9'})}if(ss==="stoch"){const yn=wo=>typeof wo=="number"&&wo>0;(!yn(Oo==null?void 0:Oo.kPeriod)||!yn(Oo==null?void 0:Oo.dPeriod))&&U.push({level:"error",message:"Stochastic requires kPeriod and dPeriod",hint:'Add "kPeriod":14, "dPeriod":3'})}ds&&(ss==="bbands"||ss==="bollinger"||ss==="bollinger_bands"||ss==="kc"||ss==="keltner"||ss==="donchian"||ss==="linreg_channel"?(ws.add(`${ds}_mid`),ws.add(`${ds}_upper`),ws.add(`${ds}_lower`)):ss==="atr_bands"?(ws.add(`${ds}_upper`),ws.add(`${ds}_lower`)):ss==="macd"?(ws.add("macd_line"),ws.add("macd_signal"),ws.add("macd_hist")):ss==="stoch"?(ws.add(`${ds}_k`),ws.add(`${ds}_d`)):ss==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"].forEach(yn=>ws.add(yn)):ws.add(ds))}),Nt.forEach((Oo,ss)=>{(Oo.plots||[]).forEach((ds,yn)=>{const wo=String((ds==null?void 0:ds.type)||"line").toLowerCase();n2.includes(wo)||U.push({level:"warning",message:`Pane[${ss}] plot[${yn}] unsupported type "${ds==null?void 0:ds.type}"`,hint:`Supported: ${Array.from(n2).join(", ")}`});const si=String((ds==null?void 0:ds.source)||"").replace(/\s+/g,"_").toLowerCase();si&&!ws.has(si)&&U.push({level:"error",message:`Pane[${ss}] plot[${yn}] source "${ds==null?void 0:ds.source}" not defined`,hint:"Define it in calc/series or use a valid alias."})}),(Oo.labels||[]).forEach((ds,yn)=>{const wo=String((ds==null?void 0:ds.shape)||"label");wo&&!o2.includes(wo)&&U.push({level:"warning",message:`Pane[${ss}] label[${yn}] unsupported shape "${wo}"`,hint:`Supported: ${Array.from(o2).join(", ")}`}),ds!=null&&ds.shape||U.push({level:"warning",message:`Pane[${ss}] label[${yn}] no shape set (default: label)`,hint:'Set "shape": triangle_up_filled, triangle_down_filled, label, pill, tag, flag'});const si=String((ds==null?void 0:ds.source)||"").replace(/\s+/g,"_").toLowerCase();si&&!["open","high","low","close","volume"].includes(si)&&!ws.has(si)&&U.push({level:"error",message:`Pane[${ss}] label[${yn}] source "${ds==null?void 0:ds.source}" not defined`,hint:"Use high/low/open/close or a defined series"}),String((Oo==null?void 0:Oo.pane)||"main").toLowerCase()==="sub"&&(si==="high"||si==="low")&&U.push({level:"warning",message:`Pane[${ss}] label[${yn}] anchors to price in sub pane`,hint:"Move label to main pane for price anchors"});const ir=String((ds==null?void 0:ds.when)||"");if(ir.trim())try{const Ji=Lg(Ve(ir)),el=[],Dd=Ma=>{!Ma||typeof Ma!="object"||(Ma.kind==="SeriesRef"&&el.push(String(Ma.name||"")),Object.values(Ma).forEach(Dd))};Dd(Ji),el.forEach(Ma=>{const jl=Ma.replace(/\s+/g,"_").toLowerCase();!ws.has(jl)&&!["open","high","low","close","volume"].includes(jl)&&U.push({level:"warning",message:`Label[${ss}:${yn}] references unknown series "${Ma}"`,hint:"Define via calc/series or use a base series (open/high/low/close/volume)."})})}catch(Ji){const el=(Ji==null?void 0:Ji.position)!=null?` at ${Ji.position}`:"",Dd=Ji instanceof vg?Ji.message:String(Ji),Ma=typeof(Ji==null?void 0:Ji.position)=="number"?Pn(te,Ji.position):void 0;U.push({level:"error",message:`Label[${ss}:${yn}] condition parse failed${el}: ${Dd}`,hint:"Use crossover(a,b), crossunder(a,b), between(x,a,b). Ensure series names exist.",line:Ma==null?void 0:Ma.line,col:Ma==null?void 0:Ma.col})}})});const $o=new Set;Nt.forEach(Oo=>{(Oo.plots||[]).forEach(ss=>{const ds=String((ss==null?void 0:ss.source)||"").replace(/\s+/g,"_").toLowerCase();ds&&$o.add(ds)}),(Oo.labels||[]).forEach(ss=>{const ds=String((ss==null?void 0:ss.source)||"").replace(/\s+/g,"_").toLowerCase();ds&&$o.add(ds);const yn=String((ss==null?void 0:ss.when)||"");try{const wo=Lg(Ve(yn)),si=[],ir=Ji=>{!Ji||typeof Ji!="object"||(Ji.kind==="SeriesRef"&&si.push(String(Ji.name||"")),Object.values(Ji).forEach(ir))};ir(wo),si.forEach(Ji=>$o.add(Ji.replace(/\s+/g,"_").toLowerCase()))}catch{}}),(Oo.lines||[]).forEach(ss=>{const ds=String((ss==null?void 0:ss.segmentsFrom)||"").replace(/\s+/g,"_").toLowerCase();ds&&$o.add(ds);const yn=String((ss==null?void 0:ss.start)||"").replace(/\s+/g,"_").toLowerCase();yn&&$o.add(yn);const wo=String((ss==null?void 0:ss.end)||"").replace(/\s+/g,"_").toLowerCase();wo&&$o.add(wo)})}),(Array.isArray(es.signals)?es.signals:[]).forEach(Oo=>{const ss=String((Oo==null?void 0:Oo.when)||"");try{const ds=Lg(Ve(ss)),yn=[],wo=si=>{!si||typeof si!="object"||(si.kind==="SeriesRef"&&yn.push(String(si.name||"")),Object.values(si).forEach(wo))};wo(ds),yn.forEach(si=>$o.add(si.replace(/\s+/g,"_").toLowerCase()))}catch{}});const Ar=Co.map(Oo=>String((Oo==null?void 0:Oo.expr)||"")).join(" ").replace(/\s+/g," ").toLowerCase(),Da=(Oo,ss)=>{const ds=Oo.toLowerCase(),yn=ss;return ds==="bbands"||ds==="bollinger"||ds==="bollinger_bands"||ds==="kc"||ds==="keltner"||ds==="donchian"||ds==="linreg_channel"?[`${yn}_mid`,`${yn}_upper`,`${yn}_lower`]:ds==="atr_bands"?[`${yn}_upper`,`${yn}_lower`]:ds==="stoch"?[`${yn}_k`,`${yn}_d`]:ds==="macd"?["macd_line","macd_signal","macd_hist"]:ds==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"]:[yn]};return Wn.forEach(Oo=>{const ss=String((Oo==null?void 0:Oo.name)||(Oo==null?void 0:Oo.type)||"").replace(/\s+/g,"_").toLowerCase();if(ss&&!$o.has(ss)){const ds=String((Oo==null?void 0:Oo.type)||""),yn=Da(ds,ss);if(!yn.some(si=>$o.has(si))){const si=Ar&&new RegExp(`\\b${ss.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")}\\b`,"i").test(Ar),ir=Ar&&yn.some(Ji=>new RegExp(`\\b${Ji.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")}\\b`,"i").test(Ar));if(si||ir)return;U.push({level:"warning",message:`Calc "${ds}" (${ss}) is defined but not used`,hint:"Reference it in plots or label conditions"})}}}),U}}catch{U.push({level:"warning",message:"Non‑JSON script detected",hint:"Use JSON spec or the DSL examples from Guide. If JSON, ensure valid commas/quotes/braces.",line:1,col:1})}return U}const Mo=vt(No),qs=vt(()=>s(Mo).filter(U=>U.level==="error").length),ta=vt(()=>s(Mo).filter(U=>U.level==="warning").length),Nc=vt(()=>s(Mo).length),Tc=vt(()=>s(qs)>0?"Errors":s(ta)>0?"Warnings":"Issues"),Sl=vt(()=>r()?`Error: ${r()}`:c()?"Running…":i()?i():"Ready"),Ks=vt(()=>{const U=String(t()||"");if(!/security_lower_tf/i.test(U))return null;const te=String(r()||""),$e=String(i()||"");return te&&/(lower_tf|lower timeframe)/i.test(te)?{kind:"error",label:"Lower TF",title:"Lower TF not available",lines:["Lower TF must be smaller than the chart timeframe.","Switch chart timeframe higher or lower the requested TF.","Lower TF needs server data; wait if loading."]}:te&&/request\.security/i.test(te)?{kind:"warning",label:"Lower TF",title:"Lower TF data not ready",lines:["Lower TF data may be missing for this range.","Zoom to recent data or wait for fetch to finish."]}:/loading request\.security/i.test($e)?{kind:"info",label:"Lower TF",title:"Lower TF data loading",lines:["Lower TF candles are loading from the server.","The chart will refresh when data arrives."]}:null}),ci=vt(()=>{const U=typeof s(Ks)=="function"?s(Ks)():s(Ks);if(!U)return"";const te=U.title||"Lower TF",$e=Array.isArray(U.lines)?U.lines:[];return[te,...$e].join(`
`)}),Lo=(U,te=2)=>Number.isFinite(U)?U.toFixed(te):"—",ln=(U,te=2,$e=8)=>{if(!Number.isFinite(U))return"—";const ut=Math.abs(U);if(ut===0||ut>=1)return U.toFixed(te);const Kt=Math.ceil(-Math.log10(ut)),$t=Math.max(te,Math.min($e,te+Kt));return U.toFixed($t)},or=U=>ln(U,2,6),tr=U=>ln(U,2,10),Zi=U=>ln(U,6,10),Yt=(U,te=2)=>{const $e=typeof U=="number"?U:Number(U);return Number.isFinite($e)?Lo($e,te):"—"},Xo=U=>{const te=typeof U=="number"?U:Number(U);return Number.isFinite(te)?or(te):"—"},as=U=>{const te=typeof U=="number"?U:Number(U);return Number.isFinite(te)?tr(te):"—"},Pi=U=>{const te=typeof U=="number"?U:Number(U);return Number.isFinite(te)?Zi(te):"—"},As=U=>{const te=typeof U=="number"?U:Number(U);return Number.isFinite(te)?Xs(te):"—"},Xs=U=>`${Lo(U,2)}%`,Hr=U=>U===1/0?"∞":Lo(U,2),Xl=U=>{const te=String(U||"").replace(/_/g," ").trim();return te?te.charAt(0).toUpperCase()+te.slice(1):"—"},Nd=U=>{const te=String(U||"").toLowerCase();return te?te==="stop_limit"?"Stop-limit":te==="market"?"Market":te==="limit"?"Limit":te==="stop"?"Stop":Xl(te):"—"},Ru=vt(()=>s(Mo).filter(U=>typeof U.line=="number").map(U=>({line:U.line,col:U.col,level:U.level}))),Xc=vt(()=>{const U=String(t()||"").split(`
`),te=new Map;s(Ru).forEach(ut=>{te.has(ut.line)||te.set(ut.line,[]),te.get(ut.line).push({col:ut.col,level:ut.level})});const $e=ut=>ut.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return U.map((ut,Kt)=>{const $t=Kt+1,wn=te.get($t)||[],Zn=wn.some(Ts=>!Ts.col),yo=$e(ut||" ");if(Zn)return`<div class="code-line"><mark class="err err-${wn[0].level}">${yo}</mark></div>`;if(!wn.length)return`<div class="code-line"><span>${yo}</span></div>`;const es=wn.filter(Ts=>typeof Ts.col=="number"&&Ts.col>0).sort((Ts,hr)=>Ts.col-hr.col);let $s="",oi=0;return es.forEach((Ts,hr)=>{const Vr=Math.max(0,Ts.col-1);Vr>oi&&($s+=$e(ut.slice(oi,Vr))),$s+=`<mark class="err err-${Ts.level}">${$e(ut.slice(Vr))||"&nbsp;"}</mark>`,oi=ut.length}),oi<ut.length&&($s+=$e(ut.slice(oi))),`<div class="code-line"><span>${$s||"&nbsp;"}</span></div>`}).join("")});let Vl=ae(void 0),_l=ae(void 0),Et=ae(void 0),Nn=ae(void 0),pn=ae("idle"),os=null,Ps=null,sr=null,Cl=[],Lc=!1,cp=!1,qp=ae("plaintext");const Wd=vt(()=>s(pn)==="ready"),kp={indicator:"Creates an indicator script.",strategy:"Creates a strategy script with backtest settings.",library:"Marks this script as a reusable library.",import:"Import a local library by name.",plot:"Plot a series on chart.",plotcandle:"Plot custom candles from OHLC series.",plotbar:"Plot OHLC bars from series.",plotohlc:"Plot OHLC bars from series.",plotarrow:"Plot up/down arrows from a series.",plotfill:"Fill between two plots.",fill:"Fill between two series.",plotshape:"Plot a shape on chart.",plotchar:"Plot a character on chart.",hline:"Draw a horizontal line.",input:"Create a user input.","input.int":"Integer input.","input.float":"Float input.","input.bool":"Boolean input.","input.string":"String input.","request.security":"Fetch HTF/MTF series.","request.security_lower_tf":"Fetch lower timeframe series.","strategy.entry":"Place an entry order.","strategy.exit":"Place an exit order.","strategy.order":"Place a generic order.",alertcondition:"Emit an alert when condition is true.",barstate:"Bar state flags (islast, isnewbar, isrealtime).",timeframe:"Chart timeframe helpers.",syminfo:"Symbol metadata (ticker, type, etc.)."},Ov={uri:"scriptstudio://schema/script.json",fileMatch:["*"],schema:{type:"object",description:"Script Studio JSON spec",properties:{pane:{type:"string",description:'Default pane ("main" or "sub")'},min:{type:"number"},max:{type:"number"},params:{type:"object",description:"Named params (input values)"},strategy:{type:"object",properties:{initialCapital:{type:"number"},orderSize:{type:"object"},commissionPct:{type:"number"},slippagePct:{type:"number"},execution:{type:"string"},allowShort:{type:"boolean"},pyramiding:{type:"number"}}},calc:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"},source:{type:"string"},period:{type:"number"},fast:{type:"number"},slow:{type:"number"},signal:{type:"number"},expr:{type:"string"},timeframe:{type:"string"},symbol:{type:"string"},country:{type:"string"},lookahead:{type:"string"},gaps:{type:"string"}}}},series:{type:"array",items:{type:"object",properties:{name:{type:"string"},expr:{type:"string"}}}},rules:{type:"array",items:{type:"object",properties:{type:{type:"string",enum:["series","state"]},name:{type:"string"},series:{type:"string"},state:{type:"string"},when:{type:"string"},whenExpr:{type:"string"},then:{type:"string"},value:{type:"string"},expr:{type:"string"},else:{type:"string"},init:{type:"string"},selfMode:{type:"string",enum:["prev","current"]}}}},stateSeries:{type:"array",items:{type:"object",properties:{name:{type:"string"},initExpr:{type:"string"},updateExpr:{type:"string"},selfMode:{type:"string",enum:["prev","current"]}}}},plots:{type:"array",items:{type:"object",properties:{name:{type:"string"},source:{type:"string"},type:{type:"string"},color:{type:"string"},width:{type:"number"},style:{type:"string"},offset:{type:["number","string"]},showLast:{type:["number","string"]},open:{type:"string"},high:{type:"string"},low:{type:"string"},close:{type:"string"},downColor:{type:"string"},wickColor:{type:"string"},borderColor:{type:"string"}}}},labels:{type:"array",items:{type:"object",properties:{when:{type:"string"},whenExpr:{type:"string"},text:{type:"string"},textExpr:{type:"string"},shape:{type:"string"},color:{type:"string"},colorExpr:{type:"string"},position:{type:"string"},source:{type:"string"},bgColor:{type:"string"},bgColorExpr:{type:"string"},borderColor:{type:"string"},borderColorExpr:{type:"string"},textColor:{type:"string"},textColorExpr:{type:"string"},size:{type:"number"},sizeExpr:{type:"string"},offsetY:{type:"number"},offsetYExpr:{type:"string"}}}},lines:{type:"array",items:{type:"object",properties:{name:{type:"string"},start:{type:"string"},end:{type:"string"},color:{type:"string"},colorExpr:{type:"string"},width:{type:"number"},widthExpr:{type:"string"},sizeExpr:{type:"string"},style:{type:"string"},extend:{type:"string"},segmentsFrom:{type:"string"},maxSegments:{type:"number"}}}},signals:{type:"array",items:{type:"object",properties:{id:{type:"string"},type:{type:"string"},when:{type:"string"},whenExpr:{type:"string"},score:{type:"number",minimum:0,maximum:10,multipleOf:1},scoreExpr:{type:"string"},cooldownBars:{type:"number"},cooldownExpr:{type:"string"},order:{type:"object"}}}},panes:{type:"array",items:{type:"object",properties:{pane:{type:"string"},plots:{$ref:"#/properties/plots"},labels:{$ref:"#/properties/labels"},levels:{type:"array"},lines:{$ref:"#/properties/lines"},min:{type:"number"},max:{type:"number"}}}},main:{$ref:"#/properties/panes/items"},sub:{$ref:"#/properties/panes/items"}}}},Lv=U=>{const te=(Kt,$t,wn)=>({label:Kt,kind:U.languages.CompletionItemKind.Function,insertText:Kt,insertTextRules:void 0,detail:$t}),$e=Kt=>({label:Kt,kind:U.languages.CompletionItemKind.Keyword,insertText:Kt,detail:"keyword"}),ut=(Kt,$t,wn)=>({label:Kt,kind:U.languages.CompletionItemKind.Snippet,insertText:$t,insertTextRules:U.languages.CompletionItemInsertTextRule.InsertAsSnippet,detail:wn});return[$e("if"),$e("else"),$e("for"),$e("while"),$e("switch"),$e("break"),$e("continue"),$e("return"),$e("var"),$e("varip"),$e("export"),$e("import"),$e("library"),ut("indicator",'indicator("${1:Title}", overlay=${2:true})',"indicator(...)"),ut("strategy",'strategy(initial_capital=${1:10000}, execution="bar_close", allowShort=${2:false})',"strategy(...)"),ut("input.int",'input.int(${1:14}, title="${2:Length}")',"input.int(...)"),ut("input.float",'input.float(${1:14.0}, title="${2:Length}")',"input.float(...)"),ut("input.bool",'input.bool(${1:true}, title="${2:Enabled}")',"input.bool(...)"),ut("input.string",'input.string("${1:Value}", title="${2:Title}")',"input.string(...)"),te("plot","plot(series)"),te("plotcandle","plotcandle(open, high, low, close)"),te("plotbar","plotbar(open, high, low, close)"),te("plotohlc","plotohlc(open, high, low, close)"),te("plotarrow","plotarrow(series)"),te("plotfill","plotfill(plotA, plotB, color)"),te("fill","fill(seriesA, seriesB, color)"),te("plotshape","plotshape(condition)"),te("plotchar","plotchar(condition)"),te("hline","hline(price)"),te("line.new","line.new(x1, y1, x2, y2)"),te("label.new","label.new(x, y, text)"),te("box.new","box.new(left, top, right, bottom)"),te("table.new","table.new(position, columns, rows)"),te("table.cell","table.cell(table_id, column, row, text)"),te("table.clear","table.clear(table_id)"),te("request.security","request.security(symbol, timeframe, expr)"),te("request.security_lower_tf","request.security_lower_tf(symbol, timeframe, expr)"),te("strategy.entry","strategy.entry(id, side)"),te("strategy.exit","strategy.exit(id, side)"),te("strategy.order","strategy.order(id, side)"),te("strategy.cancel","strategy.cancel(id)"),te("strategy.close","strategy.close(id)"),te("alertcondition","alertcondition(condition, title, message)"),te("ema","ema(source, length)"),te("sma","sma(source, length)"),te("rsi","rsi(source, length)"),te("macd","macd(source, fast, slow, signal)"),te("highest","highest(source, length)"),te("lowest","lowest(source, length)"),te("atr","atr(high, low, close, length)"),te("stoch","stoch(high, low, close, kPeriod, dPeriod)"),te("array.new_float","array.new_float(size, initial)"),te("array.new_string","array.new_string(size, initial)"),te("array.from","array.from(val1, val2, val3)"),te("array.get","array.get(arr, index)"),te("array.set","array.set(arr, index, value)"),te("array.push","array.push(arr, value)"),te("array.pop","array.pop(arr)"),te("array.size","array.size(arr)")]},zv=U=>{U.languages.getLanguages().some(te=>te.id==="pine")||(U.languages.register({id:"pine"}),U.languages.setLanguageConfiguration("pine",{comments:{lineComment:"//"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:'"',close:'"'},{open:"'",close:"'"},{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"}],surroundingPairs:[{open:'"',close:'"'},{open:"'",close:"'"},{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"}]}),U.languages.setMonarchTokensProvider("pine",{keywords:["if","else","for","while","switch","break","continue","return","var","varip","export","import","library","strategy","indicator","study"],types:["int","float","bool","string","line","label","box","table","linefill","color"],tokenizer:{root:[[/\/\/.*$/,"comment"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/\b(true|false|na)\b/,"constant"],[/\b\d+(\.\d+)?\b/,"number"],[/[{}()[\]]/,"@brackets"],[/[=><!~?:&|+\-*\/%^]/,"operator"],[/[A-Za-z_][A-Za-z0-9_]*/,{cases:{"@keywords":"keyword","@types":"type","@default":"identifier"}}]],string_double:[[/[^\\"]+/,"string"],[/\\./,"string.escape"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/\\./,"string.escape"],[/'/,"string","@pop"]]}}),U.languages.registerCompletionItemProvider("pine",{triggerCharacters:[".","("],provideCompletionItems:(te,$e)=>{const ut=te.getWordUntilPosition($e),Kt=new U.Range($e.lineNumber,ut.startColumn,$e.lineNumber,ut.endColumn);return{suggestions:Lv(U).map(wn=>({...wn,range:Kt}))}}}),U.languages.registerHoverProvider("pine",{provideHover(te,$e){const ut=te.getWordAtPosition($e);if(!ut)return null;const Kt=ut.word,$t=kp[Kt]||kp[Kt.toLowerCase()];return $t?{range:new U.Range($e.lineNumber,ut.startColumn,$e.lineNumber,ut.endColumn),contents:[{value:`**${Kt}**`},{value:$t}]}:null}}))},Vv=U=>{var te,$e;($e=(te=U.languages)==null?void 0:te.json)!=null&&$e.jsonDefaults&&U.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemas:[Ov]})},ud=U=>{U.editor.getTheme&&U.editor._scriptStudioThemes||(U.editor.defineTheme("scriptstudio-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#0b0a1a","editor.foreground":"#e2e8f0","editorLineNumber.foreground":"#475569","editorLineNumber.activeForeground":"#94a3b8","editor.selectionBackground":"#1f2a44","editor.inactiveSelectionBackground":"#1b2338","editorCursor.foreground":"#94a3b8"}}),U.editor.defineTheme("scriptstudio-light",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#f8fafc","editor.foreground":"#0f172a","editorLineNumber.foreground":"#94a3b8","editorLineNumber.activeForeground":"#334155","editor.selectionBackground":"#dbeafe","editor.inactiveSelectionBackground":"#e2e8f0","editorCursor.foreground":"#1e293b"}}),U.editor._scriptStudioThemes=!0)},Rc=U=>s(Vi)==="json"?"json":s(Vi)==="dsl"?"plaintext":s(Vi)==="pine"||/^\s*\/\/@\s*(?:pine|version)\b/m.test(U)||/\b(strategy|indicator|library|plot)\s*\(/m.test(U)||/\b(plotshape|plotchar|hline|table|line|label|box|alertcondition)\b/i.test(U)||/\b(request\.security(?:_lower_tf)?|input\.)\b/i.test(U)?"pine":li(U)?"json":"plaintext",Bc=()=>(document.documentElement.getAttribute("data-theme")||document.body.getAttribute("data-theme"))==="light"?"scriptstudio-light":"scriptstudio-dark",qd=()=>{if(!os||!sr)return;const U=[],te=s(mn),$e=(ut,Kt,$t,wn,Zn)=>{const yo=Math.max(1,$t||1),es=Math.max(1,wn||1),$s=te[yo-1]||"",oi=Math.max(es+1,$s.length+1);U.push({startLineNumber:yo,startColumn:es,endLineNumber:yo,endColumn:oi,message:Zn?`${Kt} • ${Zn}`:Kt,severity:ut==="error"?os.MarkerSeverity.Error:os.MarkerSeverity.Warning})};s(Mo).forEach(ut=>$e(ut.level,ut.message,ut.line,ut.col,ut.hint)),s(q).forEach(ut=>$e("warning",ut.message,ut.line,1)),os.editor.setModelMarkers(sr,"scriptstudio",U)};function Oc(){var $e,ut;const U=(($e=s(Vl))==null?void 0:$e.scrollTop)??0,te=((ut=s(Vl))==null?void 0:ut.scrollLeft)??0;s(_l)&&(s(_l).scrollTop=U,s(_l).scrollLeft=te),s(Et)&&(s(Et).scrollTop=U)}function B(U){const te=U.toLowerCase();return te.includes("no panes defined")?'Add pane:"main" or {main:{...}} with plots/labels.':te.includes("has no plots/labels/levels/lines")?"Add at least one plot or label in the pane.":te.includes("series")?"Check series names and expressions; use normalized aliases like macd_line.":"Review field names/types; see Guide examples."}mr(()=>{if(!os||!sr||!s(Wd)||Lc)return;o();const U=String(t()||"");sr.getValue()!==U&&(cp=!0,sr.setValue(U),cp=!1)}),mr(()=>{if(!os||!Ps||!s(Wd)||o()<=0)return;const U=String(t()||""),te=Rc(U),$e=Ps.getModel();$e&&(sr=$e,$e.setValue(U),s(qp)!==te&&(x(qp,N(te)),os.editor.setModelLanguage($e,te)),qd(),requestAnimationFrame(()=>Ps==null?void 0:Ps.layout()))}),mr(()=>{if(!os||!sr||!s(Wd))return;const U=Rc(String(t()||""));U!==s(qp)&&(x(qp,N(U)),os.editor.setModelLanguage(sr,U))}),mr(()=>{!os||!sr||!s(Wd)||qd()}),mr(()=>{!Ps||!s(Wd)||s(he)==="editor"&&requestAnimationFrame(()=>Ps==null?void 0:Ps.layout())}),mr(()=>{!Ps||!s(Wd)||(s(De).length,requestAnimationFrame(()=>Ps==null?void 0:Ps.layout()))}),Ng();var de=HY(),Oe=g(de);Oe.__pointerdown=[Dq];var Ue=u(g(Oe),2),mt=g(Ue),_n=g(mt);_n.__click=[jq,he];var en=u(_n,2);en.__click=[Rq,he];var Vn=g(en),Rn=g(Vn,!0);f(Vn);var xo=u(Vn,2);Te(xo,()=>s(Nc),U=>{var te=Bq(),$e=g(te,!0);f(te),Se(()=>{Us(te,`err-badge ${(s(qs)===0&&s(ta)>0?"warn":"")??""} svelte-dgb5y3`),ze($e,s(Nc))}),z(U,te)}),f(en);var Dn=u(en,2);Dn.__click=[Oq,he],f(mt);var ys=u(mt,2),jn=u(g(ys),2);jn.__click=[zq];var Sn=g(jn);Sn.value=(Sn.__value="auto")==null?"":"auto";var Un=u(Sn);Un.value=(Un.__value="json")==null?"":"json";var $n=u(Un);$n.value=($n.__value="pine")==null?"":"pine";var ms=u($n);ms.value=(ms.__value="dsl")==null?"":"dsl",f(jn),f(ys),f(Ue);var Wo=u(Ue,2),Yo=g(Wo);Te(Yo,()=>!s(fn),U=>{var te=qq(),$e=g(te);$e.__click=[Vq,Qe];var ut=u($e,2);ut.__click=[Wq,Qe],f(te),Se(()=>{Fi($e,"active",p()==="main"),Fi(ut,"active",p()==="sub")}),z(U,te)});var Po=u(Yo,2);Po.__click=[Pq,Wt,h];var Is=u(g(Po),2),An=g(Is);f(Is),f(Po);var Ro=u(Po,2);Ro.__click=[wq,h];var vn=u(Ro,2);vn.__click=[kq];var on=u(vn,2);on.__click=[Sq,F,K];var rn=u(on,2);rn.__click=[bq,ye];var fo=u(rn,2);fo.__click=[yq,h];var Bn=u(fo,2);Bn.__click=_;var Io=u(g(Bn),2),Gn=g(Io,!0);f(Io),f(Bn);var ti=u(Bn,2);Te(ti,()=>!s(un),U=>{var te=Hq();te.__click=[$q,un,h],z(U,te)},U=>{var te=Uq();te.__click=ll,z(U,te)});var Ds=u(ti,2);Ds.__click=[xq,un,h],f(Wo),f(Oe);var bi=u(Oe,2),yl=g(bi),uc=g(yl),kr=g(uc),Ka=g(kr),ni=u(g(Ka),2),Ca=g(ni);f(ni);var wa=u(ni,2),Pa=g(wa);f(wa),f(Ka),ai(2),f(kr);var Jl=u(kr,2),bd=g(Jl);Te(bd,()=>s(pn)!=="failed",U=>{var te=Yq(),$e=g(te);Te($e,()=>s(pn)!=="ready",ut=>{var Kt=Gq();z(ut,Kt)}),f(te),Xu(te,ut=>x(Nn,ut),()=>s(Nn)),z(U,te)},U=>{var te=Zq(),$e=Dt(te);vs($e,21,()=>s(mn),Vs,(yo,es,$s)=>{var oi=Kq();oi.textContent=$s+1,z(yo,oi)}),f($e),Xu($e,yo=>x(Et,yo),()=>s(Et));var ut=u($e,2),Kt=g(ut),$t=g(Kt),wn=g($t);mk(wn,()=>s(Xc)),f($t),ai(2),f(Kt),Xu(Kt,yo=>x(_l,yo),()=>s(_l));var Zn=u(Kt,2);W5(Zn),Zn.__input=Oc,Xu(Zn,yo=>x(Vl,yo),()=>s(Vl)),f(ut),sc("scroll",Zn,Oc),po(Zn,t),z(U,te)}),f(Jl),f(uc);var Fo=u(uc,2);Te(Fo,()=>s(De).length,U=>{var te=vH(),$e=g(te),ut=u(g($e),4);Te(ut,()=>s(q).length,$t=>{var wn=Jq();vs(wn,21,()=>s(q).slice(0,3),Zn=>Zn.message,(Zn,yo)=>{var es=Xq(),$s=g(es);f(es),Se(()=>ze($s,`Line ${s(yo).line??""}: ${s(yo).message??""}`)),z(Zn,es)}),f(wn),z($t,wn)});var Kt=u(ut,2);vs(Kt,21,()=>s(De),$t=>$t.name,($t,wn)=>{var Zn=pH(),yo=g(Zn),es=g(yo),$s=g(es,!0);f(es);var oi=u(es,2),Ts=g(oi,!0);f(oi),f(yo);var hr=u(yo,2),Vr=g(hr);Te(Vr,()=>s(wn).type==="bool",Nt=>{var Wn=eH(),Co=g(Wn);Qt(Co),Se(()=>Qv(Co,!!s(je)[s(wn).name])),Co.__change=[Qq,Ft,wn],ai(2),f(Wn),z(Nt,Wn)},Nt=>{var Wn=Ln(),Co=Dt(Wn);Te(Co,()=>s(wn).type==="string"||s(wn).type==="session"||s(wn).type==="symbol",mo=>{var Bo=nH();Qt(Bo),Se(()=>Jd(Bo,String(s(je)[s(wn).name]??""))),Bo.__input=[tH,Ft,wn],z(mo,Bo)},mo=>{var Bo=Ln(),ws=Dt(Bo);Te(ws,()=>s(wn).type==="time",$o=>{var _i=sH();Qt(_i),Se(()=>Jd(_i,St(s(je)[s(wn).name]??s(wn).defval))),_i.__input=[oH,Ne,Ft,wn],z($o,_i)},$o=>{var _i=Ln(),Ar=Dt(_i);Te(Ar,()=>s(wn).type==="source",Da=>{var Oo=aH(),ss=g(Oo);Qt(ss),Se(()=>Jd(ss,String(s(je)[s(wn).name]??s(wn).defval??"close"))),ss.__input=[iH,Ft,wn];var ds=u(ss,2);vs(ds,21,()=>Je,Vs,(yn,wo)=>{var si=rH(),ir={};Se(()=>{ir!==(ir=s(wo))&&(si.value=(si.__value=s(wo))==null?"":s(wo))}),z(yn,si)}),f(ds),f(Oo),Se(()=>{zt(ss,"list",`source-options-${s(wn).name}`),zt(ds,"id",`source-options-${s(wn).name}`)}),z(Da,Oo)},Da=>{var Oo=Ln(),ss=Dt(Oo);Te(ss,()=>s(wn).type==="color",ds=>{var yn=cH();Qt(yn),Se(()=>Jd(yn,ue(s(je)[s(wn).name]??s(wn).defval))),yn.__input=[lH,Ft,wn],z(ds,yn)},ds=>{var yn=uH();Qt(yn),Se(()=>Jd(yn,Number(s(je)[s(wn).name]??s(wn).defval))),yn.__input=[dH,Ft,wn],Se(()=>{zt(yn,"step",s(wn).step??(s(wn).type==="int"?1:.01)),zt(yn,"min",s(wn).minval),zt(yn,"max",s(wn).maxval)}),z(ds,yn)},!0),z(Da,Oo)},!0),z($o,_i)},!0),z(mo,Bo)},!0),z(Nt,Wn)}),f(hr),f(Zn),Se(()=>{ze($s,s(wn).title||s(wn).name),ze(Ts,s(wn).name)}),z($t,Zn)}),f(Kt),ai(2),f($e),f(te),z(U,te)}),f(yl),f(bi);var Ql=u(bi,2);Te(Ql,()=>s(he)==="errors",U=>{var te=yH(),$e=g(te);Te($e,()=>s(Mo).length===0,ut=>{var Kt=fH();z(ut,Kt)},ut=>{var Kt=_H(),$t=Dt(Kt),wn=g($t),Zn=g(wn);f(wn),ai(2),f($t);var yo=u($t,2);vs(yo,21,()=>s(Mo),Vs,(es,$s)=>{var oi=hH(),Ts=u(g(oi),2),hr=g(Ts);Te(hr,()=>s($s).line,Wn=>{var Co=mH(),mo=g(Co),Bo=u(mo);Te(Bo,()=>s($s).col,ws=>{var $o=fg();Se(()=>ze($o,`· Col ${s($s).col??""}`)),z(ws,$o)}),ai(),f(Co),Se(()=>ze(mo,`Line ${s($s).line??""}`)),z(Wn,Co)});var Vr=u(hr);f(Ts);var Nt=u(Ts,2);Te(Nt,()=>s($s).hint,Wn=>{var Co=gH(),mo=g(Co);f(Co),Se(()=>ze(mo,`— ${s($s).hint??""}`)),z(Wn,Co)}),f(oi),Se(()=>{Us(oi,`${`diag-item ${s($s).level}`??""} svelte-dgb5y3`),ze(Vr,` ${s($s).message??""}`)}),z(es,oi)}),f(yo),Se(()=>ze(Zn,`Errors (${(s(qs)||0)??""})`)),z(ut,Kt)}),f(te),z(U,te)},U=>{var te=Ln(),$e=Dt(te);Te($e,()=>s(he)==="results",ut=>{var Kt=fY(),$t=g(Kt);Te($t,()=>s(jt),Zn=>{var yo=rU();yo.__click=[g2,jt];var es=g(yo);es.__click=[bH];var $s=g(es),oi=u(g($s),2),Ts=g(oi),hr=g(Ts);hr.__click=[xH,Zt];var Vr=u(hr,2);Vr.__click=[wH,Zt],f(Ts);var Nt=u(Ts,2);Nt.__click=[g2,jt],f(oi),f($s);var Wn=u($s,2),Co=g(Wn);Te(Co,()=>s(Zt)==="trades",mo=>{var Bo=GH(),ws=Dt(Bo),$o=g(ws),_i=g($o),Ar=u(g(_i)),Da=g(Ar);f(Ar),f(_i),ai(2),f($o);var Oo=u($o,2),ss=g(Oo);Qt(ss),ss.__input=[kH,Xt];var ds=u(ss,2);ds.__click=[SH,dn];var yn=g(ds,!0);f(ds);var wo=u(ds,2);Te(wo,()=>s(qn).type!=="all",Ji=>{var el=PH();el.__click=[CH,Tl],z(Ji,el)});var si=u(wo,2);si.__click=[h2,uo,wt,Xl,as,Pi,Yt,Xo,As,hs],f(Oo),f(ws);var ir=u(ws,2);Te(ir,()=>s(qr).length,Ji=>{var el=HH(),Dd=g(el),Ma=g(Dd),jl=g(Ma),gc=u(g(jl)),Qi=g(gc);Qi.__click=[IH,To];var Kd=g(Qi);Se(()=>ze(Kd,`Side ${co("side")??""}`)),f(Qi),f(gc);var Gc=u(gc),Wl=g(Gc);Wl.__click=[MH,To];var Fc=g(Wl);Se(()=>ze(Fc,`Entry ${co("entryIndex")??""}`)),f(Wl),f(Gc);var zc=u(Gc),gu=g(zc);gu.__click=[AH,To];var ku=g(gu);Se(()=>ze(ku,`Exit ${co("exitIndex")??""}`)),f(gu),f(zc);var Md=u(zc),gp=g(Md);gp.__click=[TH,To];var $p=g(gp);Se(()=>ze($p,`Qty ${co("qty")??""}`)),f(gp),f(Md);var hp=u(Md),hv=g(hp);hv.__click=[LH,To];var tu=g(hv);Se(()=>ze(tu,`Bars ${co("barsHeld")??""}`)),f(hv),f(hp);var _v=u(hp),yv=g(_v);yv.__click=[FH,To];var Bu=g(yv);Se(()=>ze(Bu,`Net PnL ${co("netPnl")??""}`)),f(yv),f(_v);var bv=u(_v),Hp=g(bv);Hp.__click=[$H,To];var Ou=g(Hp);Se(()=>ze(Ou,`PnL% ${co("pnlPct")??""}`)),f(Hp),f(bv);var _p=u(bv);Te(_p,()=>s(dn)==="full",ve=>{var Bt=BH(),Wi=Dt(Bt),js=g(Wi);js.__click=[EH,To];var er=g(js);Se(()=>ze(er,`Fees ${co("fees")??""}`)),f(js),f(Wi);var na=u(Wi,2),cl=g(na);cl.__click=[NH,To];var zu=g(cl);Se(()=>ze(zu,`Gross ${co("pnl")??""}`)),f(cl),f(na);var sp=u(na,2),Hu=g(sp);Hu.__click=[DH,To];var hu=g(Hu);Se(()=>ze(hu,`MAE% ${co("maePct")??""}`)),f(Hu),f(sp);var Sp=u(sp,2),dp=g(Sp);dp.__click=[jH,To];var Pl=g(dp);Se(()=>ze(Pl,`MFE% ${co("mfePct")??""}`)),f(dp),f(Sp);var pd=u(Sp,6),pr=g(pd);pr.__click=[RH,To];var Wa=g(pr);Se(()=>ze(Wa,`Cum Net ${co("cumNet")??""}`)),f(pr),f(pd),z(ve,Bt)}),f(jl),f(Ma);var du=u(Ma);vs(du,21,()=>s(qr),ve=>ve.id,(ve,Bt)=>{var Wi=qH();Wi.__click=[OH,Zl,Bt],Wi.__keydown=[zH,Zl,Bt];var js=g(Wi),er=g(js);er.__click=[VH,Zl,Bt],f(js);var na=u(js),cl=g(na),zu=g(cl,!0);Se(()=>ze(zu,Xl(s(Bt).side))),f(cl),f(na);var sp=u(na),Hu=g(sp),hu=g(Hu),Sp=u(g(hu)),dp=g(Sp);f(Sp),f(hu);var Pl=u(hu,2),pd=u(g(Pl)),pr=g(pd,!0);f(pd),f(Pl);var Wa=u(Pl,2),rr=u(g(Wa)),Up=g(rr,!0);Se(()=>ze(Up,as(s(Bt).entryPrice))),f(rr),f(Wa),f(Hu),f(sp);var Qu=u(sp),nu=g(Qu),hc=g(nu),Uu=u(g(hc)),up=g(Uu);f(Uu),f(hc);var Gu=u(hc,2),Vu=u(g(Gu)),Ep=g(Vu,!0);f(Vu),f(Gu);var vr=u(Gu,2),Sr=u(g(vr)),ji=g(Sr,!0);Se(()=>ze(ji,as(s(Bt).exitPrice))),f(Sr),f(vr),f(nu),f(Qu);var Jc=u(Qu),Wv=g(Jc,!0);Se(()=>ze(Wv,Pi(s(Bt).qty))),f(Jc);var su=u(Jc),Vc=g(su,!0);Se(()=>ze(Vc,Yt(s(Bt).barsHeld,0))),f(su);var dl=u(su);const Su=vt(()=>(Number(s(Bt).netPnl)>=0?"+":"")??""),Zd=vt(()=>Xo(s(Bt).netPnl)??"");var qa=g(dl);Se(()=>ze(qa,`${s(Su)}${s(Zd)}`)),f(dl);var Gp=u(dl),xv=g(Gp,!0);Se(()=>ze(xv,As(s(Bt).pnlPct))),f(Gp);var Wu=u(Gp);Te(Wu,()=>s(dn)==="full",tf=>{var sv=WH(),Yp=Dt(sv),_u=g(Yp,!0);Se(()=>ze(_u,Xo(s(Bt).fees))),f(Yp);var wv=u(Yp,2);const ip=vt(()=>(Number(s(Bt).pnl)>=0?"+":"")??""),Np=vt(()=>Xo(s(Bt).pnl)??"");var iv=g(wv);Se(()=>ze(iv,`${s(ip)}${s(Np)}`)),f(wv);var rv=u(wv,2),Cu=g(rv,!0);Se(()=>ze(Cu,s(Bt).maePct==null?"-":As(s(Bt).maePct))),f(rv);var Pu=u(rv,2),av=g(Pu,!0);Se(()=>ze(av,s(Bt).mfePct==null?"-":As(s(Bt).mfePct))),f(Pu);var Fv=u(Pu,2),We=g(Fv),Uo=g(We),ls=u(g(Uo)),Si=g(ls,!0);f(ls),f(Uo);var bs=u(Uo,2),Go=u(g(bs)),Nr=g(Go,!0);f(Go),f(bs),f(We),f(Fv);var Xn=u(Fv,2),tl=g(Xn,!0);f(Xn);var _c=u(Xn,2);const Ai=vt(()=>(Number(s(Bt).cumNet)>=0?"+":"")??""),ql=vt(()=>Xo(s(Bt).cumNet)??"");var Hl=g(_c);Se(()=>ze(Hl,`${s(Ai)}${s(ql)}`)),f(_c),Se(()=>{ze(Si,s(Bt).entrySignalId||"-"),ze(Nr,s(Bt).exitSignalId||"-"),ze(tl,s(Bt).exitReason||"-")}),z(tf,sv)}),f(Wi),Se(()=>{Fi(Wi,"selected",s(Ki)===s(Bt).id),Fi(Wi,"pos",s(Bt).netPnl>=0),Fi(Wi,"neg",s(Bt).netPnl<0),ze(dp,`#${s(Bt).entryIndex??""}`),ze(pr,s(Bt).entryTimeLabel),ze(up,`#${s(Bt).exitIndex??""}`),ze(Ep,s(Bt).exitTimeLabel)}),z(ve,Wi)}),f(du),f(Dd),f(el),Se(()=>Us(Dd,`${`tt-table tt-table-trades ${s(dn)}`??""} svelte-dgb5y3`)),z(Ji,el)},Ji=>{var el=UH();z(Ji,el)}),Se(()=>{ze(Da,`(${s(so).length??""}/${s(wt).length??""})`),Jd(ss,s(Xt)),ze(yn,s(dn)==="compact"?"Show details":"Compact view")}),z(mo,Bo)},mo=>{var Bo=iU(),ws=Dt(Bo),$o=g(ws),_i=u(g($o),2),Ar=g(_i),Da=u(Ar);Te(Da,()=>s(Lt).length>500,si=>{var ir=fg("• Showing last 500");z(si,ir)}),f(_i),ai(2),f($o);var Oo=u($o,2),ss=g(Oo);ss.__click=[YH,zn];var ds=g(ss,!0);f(ss);var yn=u(ss,2);yn.__click=[_2,uo,Lt,Yt,Pi,Xo,as,hs],f(Oo),f(ws);var wo=u(ws,2);Te(wo,()=>s(Lt).length,si=>{var ir=oU(),Ji=g(ir),el=g(Ji),Dd=g(el),Ma=u(g(Dd),6);Te(Ma,()=>s(zn)==="full",gc=>{var Qi=KH();ai(4),z(gc,Qi)}),f(Dd),f(el);var jl=u(el);vs(jl,21,()=>s(qt),gc=>gc.id,(gc,Qi)=>{var Kd=nU(),Gc=g(Kd),Wl=g(Gc,!0);f(Gc);var Fc=u(Gc),zc=g(Fc),gu=g(zc,!0);f(zc),f(Fc);var ku=u(Fc),Md=g(ku),gp=g(Md),$p=u(g(gp),2),hp=g($p,!0);f($p),f(gp);var hv=u(gp,2),tu=u(g(hv),2),_v=g(tu,!0);f(tu),f(hv);var yv=u(hv,2),Bu=u(g(yv),2),bv=g(Bu,!0);f(Bu),f(yv),f(Md),f(ku);var Hp=u(ku),Ou=g(Hp),_p=g(Ou),du=u(g(_p)),ve=g(du);f(du),f(_p);var Bt=u(_p,2),Wi=u(g(Bt)),js=g(Wi,!0);f(Wi),f(Bt),f(Ou),f(Hp);var er=u(Hp),na=g(er),cl=g(na),zu=u(g(cl)),sp=g(zu);Se(()=>ze(sp,`${Yt(s(Qi).qtyPct,2)??""}%`)),f(zu),f(cl);var Hu=u(cl,2);Te(Hu,()=>s(Qi).qty!=null,su=>{var Vc=ZH(),dl=u(g(Vc)),Su=g(dl,!0);Se(()=>ze(Su,Pi(s(Qi).qty))),f(dl),f(Vc),z(su,Vc)});var hu=u(Hu,2);Te(hu,()=>s(Qi).cash!=null,su=>{var Vc=XH(),dl=u(g(Vc)),Su=g(dl,!0);Se(()=>ze(Su,Xo(s(Qi).cash))),f(dl),f(Vc),z(su,Vc)});var Sp=u(hu,2);Te(Sp,()=>s(Qi).price!=null,su=>{var Vc=JH(),dl=u(g(Vc)),Su=g(dl,!0);Se(()=>ze(Su,as(s(Qi).price))),f(dl),f(Vc),z(su,Vc)});var dp=u(Sp,2);Te(dp,()=>s(Qi).stopPrice!=null,su=>{var Vc=QH(),dl=u(g(Vc)),Su=g(dl,!0);Se(()=>ze(Su,as(s(Qi).stopPrice))),f(dl),f(Vc),z(su,Vc)});var Pl=u(dp,2);Te(Pl,()=>s(Qi).limitPrice!=null,su=>{var Vc=eU(),dl=u(g(Vc)),Su=g(dl,!0);Se(()=>ze(Su,as(s(Qi).limitPrice))),f(dl),f(Vc),z(su,Vc)}),f(na),f(er);var pd=u(er),pr=g(pd),Wa=g(pr),rr=u(g(Wa)),Up=g(rr,!0);f(rr),f(Wa);var Qu=u(Wa,2),nu=u(g(Qu)),hc=g(nu,!0);f(nu),f(Qu);var Uu=u(Qu,2),up=u(g(Uu)),Gu=g(up,!0);Se(()=>ze(Gu,s(Qi).fillQty==null?"-":Pi(s(Qi).fillQty))),f(up),f(Uu);var Vu=u(Uu,2),Ep=u(g(Vu)),vr=g(Ep,!0);Se(()=>ze(vr,s(Qi).fillPrice==null?"-":as(s(Qi).fillPrice))),f(Ep),f(Vu);var Sr=u(Vu,2),ji=u(g(Sr)),Jc=g(ji,!0);Se(()=>ze(Jc,s(Qi).fees==null?"-":Xo(s(Qi).fees))),f(ji),f(Sr),f(pr),f(pd);var Wv=u(pd);Te(Wv,()=>s(zn)==="full",su=>{var Vc=tU(),dl=Dt(Vc),Su=g(dl),Zd=g(Su),qa=u(g(Zd)),Gp=g(qa);f(qa),f(Zd);var xv=u(Zd,2),Wu=u(g(xv)),tf=g(Wu,!0);f(Wu),f(xv),f(Su),f(dl);var sv=u(dl,2),Yp=g(sv),_u=g(Yp),wv=u(g(_u)),ip=g(wv,!0);f(wv),f(_u);var Np=u(_u,2),iv=u(g(Np)),rv=g(iv,!0);f(iv),f(Np),f(Yp),f(sv);var Cu=u(sv,2),Pu=g(Cu,!0);f(Cu),Se(()=>{ze(Gp,`#${s(Qi).activeFromIndex??""}`),ze(tf,s(Qi).expiresAtIndex==null?"-":`#${s(Qi).expiresAtIndex}`),ze(ip,s(Qi).signalId||"-"),ze(rv,s(Qi).ocoGroup||"-"),ze(Pu,s(Qi).note||"-")}),z(su,Vc)}),f(Kd),Se(()=>{ze(Wl,s(Qi).id),Us(zc,`${`tt-pill status status-${s(Qi).statusKey}`??""} svelte-dgb5y3`),ze(gu,s(Qi).statusLabel),ze(hp,s(Qi).actionLabel),ze(_v,s(Qi).sideLabel),ze(bv,s(Qi).kindLabel),ze(ve,`#${s(Qi).createdIndex??""}`),ze(js,s(Qi).createdTimeLabel),ze(Up,s(Qi).filledIndex==null?"-":`#${s(Qi).filledIndex}`),ze(hc,s(Qi).filledIndex==null?"-":s(Qi).filledTimeLabel)}),z(gc,Kd)}),f(jl),f(Ji),f(ir),Se(()=>Us(Ji,`${`tt-table tt-table-orders ${s(zn)}`??""} svelte-dgb5y3`)),z(si,ir)},si=>{var ir=sU();z(si,ir)}),Se(()=>{ze(Ar,`Rows ${s(Lt).length??""}`),ze(ds,s(zn)==="compact"?"Show details":"Compact view")}),z(mo,Bo)}),f(Wn),f(es),f(yo),Se(()=>{Fi(hr,"active",s(Zt)==="trades"),Fi(Vr,"active",s(Zt)==="orders")}),z(Zn,yo)});var wn=u($t,2);Te(wn,()=>!s(Be),Zn=>{var yo=Ln(),es=Dt(yo);Te(es,()=>!s(ne),$s=>{var oi=cU(),Ts=g(oi);Te(Ts,()=>s(we)||s(H),hr=>{var Vr=aU();ai(4),z(hr,Vr)},hr=>{var Vr=lU();ai(4),z(hr,Vr)}),f(oi),z($s,oi)},$s=>{var oi=Ln(),Ts=Dt(oi);Te(Ts,()=>!s(_e),hr=>{var Vr=pU(),Nt=g(Vr);Te(Nt,()=>s(we)||s(H),Wn=>{var Co=dU();ai(4),z(Wn,Co)},Wn=>{var Co=uU();ai(4),z(Wn,Co)}),f(Vr),z(hr,Vr)},hr=>{var Vr=mU(),Nt=g(Vr);Te(Nt,c,Co=>{var mo=fg("Running… please wait.");z(Co,mo)},Co=>{var mo=vU();ai(2),z(Co,mo)});var Wn=u(Nt,2);Te(Wn,()=>s(we)||s(H),Co=>{var mo=fU(),Bo=g(mo);f(mo),Se(()=>ze(Bo,`Pine parsed: strategy ${(s(we)?"yes":"no")??""} • signals
                ${(s(H)?"yes":"no")??""}`)),z(Co,mo)}),f(Vr),z(hr,Vr)},!0),z($s,oi)}),z(Zn,yo)},Zn=>{var yo=vY(),es=g(yo),$s=u(g(es),2),oi=g($s),Ts=u(g(oi),2),hr=g(Ts,!0);Se(()=>ze(hr,Lo(s(Be).finalEquity,2))),f(Ts),f(oi);var Vr=u(oi,2),Nt=u(g(Vr),2),Wn=g(Nt);Se(()=>ze(Wn,`${(s(Be).netPnl>=0?"+":"")??""}${Lo(s(Be).netPnl,2)??""}`)),f(Nt),f(Vr);var Co=u(Vr,2),mo=u(g(Co),2),Bo=g(mo,!0);Se(()=>ze(Bo,Xs(s(Be).maxDrawdownPct))),f(mo),f(Co),f($s),f(es);var ws=u(es,2),$o=g(ws),_i=u(g($o)),Ar=g(_i,!0);f(_i);var Da=u(_i,2),Oo=g(Da);f(Da),f($o);var ss=u($o,2);Te(ss,()=>s(xt).lastTs,Ti=>{var zo=gU(),ca=u(g(zo)),oa=g(ca,!0);Se(()=>ze(oa,new Date(s(xt).lastTs).toISOString().slice(0,10))),f(ca),f(zo),z(Ti,zo)});var ds=u(ss,2);Te(ds,()=>s(xa),Ti=>{var zo=hU(),ca=u(g(zo)),oa=g(ca,!0);f(ca),f(zo),Se(()=>ze(oa,s(xa))),z(Ti,zo)}),f(ws);var yn=u(ws,2),wo=g(yn),si=g(wo),ir=g(si),Ji=u(g(ir),2);Ji.__click=[_U,So],f(ir),ai(2),f(si),f(wo);var el=u(wo,2),Dd=g(el),Ma=u(g(Dd),2),jl=g(Ma),gc=u(g(jl),2);Qt(gc),gc.__input=[yU,oo],f(jl);var Qi=u(jl,2),Kd=u(g(Qi),2);Qt(Kd),Kd.__input=[bU,Gs],f(Qi);var Gc=u(Qi,2),Wl=u(g(Gc),2);Qt(Wl),Wl.__input=[xU,jo],f(Gc),f(Ma);var Fc=u(Ma,2),zc=g(Fc);zc.__click=_;var gu=u(zc,2);Te(gu,()=>s(ba),Ti=>{var zo=wU();zo.__click=[Aq,oo,Gs,jo],z(Ti,zo)});var ku=u(gu,2);Te(ku,()=>s(xa),Ti=>{var zo=kU(),ca=g(zo,!0);f(zo),Se(()=>ze(ca,s(xa))),z(Ti,zo)}),ai(2),f(Fc),f(Dd);var Md=u(Dd,2),gp=u(g(Md),2),$p=g(gp);Qt($p),$p.__input=[SU,Qo];var hp=u($p,2);hp.__click=[Iq,Be,Qo,Es,ot];var hv=u(hp,2);Te(hv,()=>s(Es).length,Ti=>{var zo=CU();zo.__click=[Mq,Es,Ed,zl],z(Ti,zo)}),f(gp);var tu=u(gp,2);Te(tu,()=>s(Es).length,Ti=>{var zo=DU(),ca=u(g(zo),2);vs(ca,17,()=>s(Es),oa=>oa.id,(oa,_s)=>{var Gi=NU(),Fl=Dt(Gi),Ta=g(Fl),sa=g(Ta,!0);f(Ta);var ec=u(Ta,2),Dr=g(ec);Se(()=>ze(Dr,`${(s(_s).summary.netPnl>=0?"+":"")??""}${Lo(s(_s).summary.netPnl,2)??""}`)),f(ec);var Ul=u(ec,2),Wc=g(Ul,!0);Se(()=>ze(Wc,Xs(s(_s).summary.netPnlPct??0))),f(Ul);var uu=u(Ul,2),Yu=g(uu,!0);Se(()=>ze(Yu,Xs(s(_s).summary.maxDrawdownPct??0))),f(uu);var pu=u(uu,2),Yv=g(pu,!0);Se(()=>ze(Yv,Hr(s(_s).summary.sharpe??0))),f(pu);var Ip=u(pu,2),lf=g(Ip,!0);Se(()=>ze(lf,Xs(s(_s).summary.winRate??0))),f(Ip);var et=u(Ip,2),Ae=g(et,!0);f(et);var gt=u(et,2),He=g(gt,!0);Se(()=>ze(He,eu(s(_s).params))),f(gt);var ht=u(gt,2),It=g(ht);It.__click=[PU,Gd,_s];var Ot=g(It,!0);f(It);var lo=u(It,2);lo.__click=[IU,Ko,_s],f(ht),f(Fl);var sn=u(Fl,2);Te(sn,()=>s(Ed)===s(_s).id,Ao=>{var Cn=EU(),Jn=g(Cn),nn=u(g(Jn),2);vs(nn,21,()=>Ju(s(_s).summary),Vs,(Bi,bo)=>{var cs=MU(),b=g(cs),k=g(b,!0);f(b);var T=u(b,2),A=g(T,!0);f(T),f(cs),Se(()=>{ze(k,s(bo).label),ze(A,s(bo).value)}),z(Bi,cs)}),f(nn),f(Jn);var us=u(Jn,2),Tn=u(g(us),2);Te(Tn,()=>s(_s).params&&Object.keys(s(_s).params).length,Bi=>{var bo=TU();vs(bo,21,()=>Object.entries(s(_s).params),Vs,(cs,b)=>{let k=()=>s(b)[0],T=()=>s(b)[1];var A=AU(),$=g(A),E=g($,!0);f($);var Q=u($,2),ie=g(Q,!0);Se(()=>ze(ie,Yd(T(),0))),f(Q),f(A),Se(()=>ze(E,k())),z(cs,A)}),f(bo),z(Bi,bo)},Bi=>{var bo=LU();z(Bi,bo)}),f(us);var ui=u(us,2),Hs=u(g(ui),2);Hs.__click=[FU,lu,_s];var da=g(Hs,!0);f(Hs);var Yi=u(Hs,2);Te(Yi,()=>s(zl)[s(_s).id],Bi=>{var bo=$U(),cs=g(bo,!0);Se(()=>ze(cs,mu(s(_s)))),f(bo),z(Bi,bo)}),f(ui),f(Cn),Se(()=>ze(da,s(zl)[s(_s).id]?"Hide raw":"Show raw")),z(Ao,Cn)}),Se(()=>{ze(sa,s(_s).label),Us(ec,`${`right mono ${s(_s).summary.netPnl>=0?"pos":"neg"}`??""} svelte-dgb5y3`),ze(Ae,s(_s).summary.trades??0),zt(It,"aria-expanded",s(Ed)===s(_s).id),ze(Ot,s(Ed)===s(_s).id?"Hide":"Details")}),z(oa,Gi)}),f(zo),z(Ti,zo)},Ti=>{var zo=jU();z(Ti,zo)}),f(Md),f(el),f(yn);var _v=u(yn,2),yv=g(_v),Bu=g(yv),bv=g(Bu),Hp=u(g(bv),2);Hp.__click=[RU,So],f(bv),ai(2),f(Bu),f(yv);var Ou=u(yv,2),_p=g(Ou),du=u(g(_p),2),ve=g(du,!0);f(du);var Bt=u(du,2),Wi=g(Bt),js=u(Wi);Te(js,()=>s(Be).roundTrips!=null,Ti=>{var zo=fg();Se(()=>ze(zo,`• Positions ${s(Be).roundTrips??""}`)),z(Ti,zo)}),f(Bt),f(_p);var er=u(_p,2),na=u(g(er),2),cl=g(na,!0);Se(()=>ze(cl,Xs(s(Be).winRate))),f(na);var zu=u(na,2),sp=g(zu);Se(()=>ze(sp,`Max DD ${Xs(s(Be).maxDrawdownPct)??""}`)),f(zu),f(er);var Hu=u(er,2),hu=u(g(Hu),2),Sp=g(hu);Se(()=>ze(Sp,`${(s(Be).netPnl>=0?"+":"")??""}${Lo(s(Be).netPnl,2)??""}`)),f(hu);var dp=u(hu,2);const Pl=vt(()=>Xs(s(Be).netPnlPct)??""),pd=vt(()=>Lo(s(Be).feesPaid,2)??""),pr=vt(()=>Hr(s(Be).profitFactor)??"");var Wa=g(dp);Se(()=>ze(Wa,`${s(Pl)} • Fees ${s(pd)} • PF ${s(pr)}`)),f(dp),f(Hu);var rr=u(Hu,2),Up=u(g(rr),2),Qu=g(Up);Se(()=>ze(Qu,`${(s(Be).expectancy>=0?"+":"")??""}${Lo(s(Be).expectancy??0,2)??""}`)),f(Up);var nu=u(Up,2);const hc=vt(()=>Lo(s(Be).avgTrade??0,2)??""),Uu=vt(()=>Hr(s(Be).payoffRatio??0)??""),up=vt(()=>s(Be).maxConsecWins??0??""),Gu=vt(()=>s(Be).maxConsecLosses??0??"");var Vu=g(nu);Se(()=>ze(Vu,`Avg ${s(hc)} • Payoff
                  ${s(Uu)} • Streak
                  W ${s(up)}/L ${s(Gu)}`)),f(nu),f(rr);var Ep=u(rr,2),vr=u(g(Ep),2),Sr=g(vr);Se(()=>ze(Sr,`Sharpe ${Hr(s(Be).sharpe??0)??""}`)),f(vr);var ji=u(vr,2);const Jc=vt(()=>Hr(s(Be).sortino??0)??""),Wv=vt(()=>Xs(s(Be).volatilityPct??0)??"");var su=g(ji);Se(()=>ze(su,`Sortino ${s(Jc)} • Vol
                  ${s(Wv)}`)),f(ji),f(Ep);var Vc=u(Ep,2),dl=u(g(Vc),2),Su=g(dl,!0);Se(()=>ze(Su,Xs(s(Be).exposurePct??0))),f(dl);var Zd=u(dl,2);const qa=vt(()=>Xs(s(Be).maxRunupPct??0)??""),Gp=vt(()=>Lo(s(Be).avgBarsInTrade??0,1)??""),xv=vt(()=>Hr(s(Be).calmar??0)??"");var Wu=g(Zd);Se(()=>ze(Wu,`Run-up ${s(qa)} • Bars/trade
                  ${s(Gp)} • Calmar
                  ${s(xv)}`)),f(Zd),f(Vc),f(Ou);var tf=u(Ou,2);Te(tf,()=>s(Be).trades===0,Ti=>{var zo=zU(),ca=u(g(zo),2),oa=g(ca);Te(oa,()=>s(xt).total===0,_s=>{var Gi=BU();ai(2),z(_s,Gi)},_s=>{var Gi=OU();ai(2),z(_s,Gi)}),f(ca),f(zo),z(Ti,zo)}),f(_v);var sv=u(_v,2),Yp=g(sv),_u=g(Yp),wv=g(_u),ip=u(g(wv),2);ip.__click=[VU,So],f(wv),ai(2),f(_u),f(Yp);var Np=u(Yp,2),iv=g(Np),rv=u(g(iv),2),Cu=u(g(rv),2),Pu=g(Cu);f(Cu);var av=u(Cu,2),Fv=g(av);Se(()=>ze(Fv,`Win ${Xs(s(Os).long.winRate)??""}`)),f(av);var We=u(av,2),Uo=g(We);Se(()=>ze(Uo,`Net ${(s(Os).long.net>=0?"+":"")??""}${Lo(s(Os).long.net,2)??""}`)),f(We);var ls=u(We,2),Si=g(ls);Se(()=>ze(Si,`PF ${Hr(s(Os).long.profitFactor)??""}`)),f(ls),f(rv);var bs=u(rv,2),Go=u(g(bs),2),Nr=g(Go);f(Go);var Xn=u(Go,2),tl=g(Xn);Se(()=>ze(tl,`Win ${Xs(s(Os).short.winRate)??""}`)),f(Xn);var _c=u(Xn,2),Ai=g(_c);Se(()=>ze(Ai,`Net ${(s(Os).short.net>=0?"+":"")??""}${Lo(s(Os).short.net,2)??""}`)),f(_c);var ql=u(_c,2),Hl=g(ql);Se(()=>ze(Hl,`PF ${Hr(s(Os).short.profitFactor)??""}`)),f(ql),f(bs),f(iv);var ja=u(iv,2),Wr=u(g(ja),2);Te(Wr,()=>s(wr).length,Ti=>{var zo=qU(),ca=u(g(zo),2);vs(ca,17,()=>s(wr).slice(0,12),Vs,(oa,_s)=>{var Gi=WU(),Fl=g(Gi),Ta=g(Fl,!0);f(Fl);var sa=u(Fl,2),ec=g(sa,!0);f(sa);var Dr=u(sa,2),Ul=g(Dr,!0);Se(()=>ze(Ul,Xs(s(_s).winRate))),f(Dr);var Wc=u(Dr,2),uu=g(Wc);Se(()=>ze(uu,`${(s(_s).net>=0?"+":"")??""}${Lo(s(_s).net,2)??""}`)),f(Wc);var Yu=u(Wc,2),pu=g(Yu,!0);Se(()=>ze(pu,Hr(s(_s).profitFactor))),f(Yu),f(Gi),Se(()=>{ze(Ta,s(_s).id),ze(ec,s(_s).trades),Us(Wc,`${`right mono ${s(_s).net>=0?"pos":"neg"}`??""} svelte-dgb5y3`)}),z(oa,Gi)}),f(zo),z(Ti,zo)},Ti=>{var zo=HU();z(Ti,zo)}),f(ja),f(Np),f(sv);var ka=u(sv,2),bl=g(ka),yc=g(bl),la=g(yc),fr=u(g(la),2);fr.__click=[UU,So],f(la),ai(2),f(yc);var Ll=u(yc,2),ao=g(Ll,!0),ul=u(ao);Te(ul,()=>s(Dl),Ti=>{var zo=fg();Se(()=>ze(zo,`• Running ${s(gl)??""}/${s(Vd)??""} (${s(sd)??""}%) • ${s(Ec)??""}`)),z(Ti,zo)}),f(Ll),f(bl);var Ic=u(bl,2),Ra=g(Ic),gi=u(g(Ra),2);Te(gi,()=>s(Al).length,Ti=>{var zo=pG(),ca=Dt(zo),oa=u(g(ca),2),_s=g(oa);_g(_s,()=>s(Fs));var Gi;_s.__change=[GU,tn],vs(_s,21,()=>s(Al),bo=>bo.name,(bo,cs)=>{var b=YU(),k={},T=g(b,!0);f(b),Se(()=>{k!==(k=s(cs).name)&&(b.value=(b.__value=s(cs).name)==null?"":s(cs).name),ze(T,s(cs).title||s(cs).name)}),z(bo,b)}),f(_s),f(oa),f(ca);var Fl=u(ca,2),Ta=g(Fl),sa=u(g(Ta),2);Qt(sa),sa.__input=[KU,$r],f(Ta);var ec=u(Ta,2),Dr=u(g(ec),2);Qt(Dr),Dr.__input=[ZU,cd],f(ec);var Ul=u(ec,2),Wc=u(g(Ul),2);Qt(Wc),Wc.__input=[XU,Sd],f(Ul),f(Fl);var uu=u(Fl,2),Yu=u(g(uu),2),pu=g(Yu);_g(pu,()=>s(Va));var Yv;pu.__change=[JU,En];var Ip=g(pu);Ip.value=((Ip.__value="")==null,"");var lf=u(Ip);vs(lf,17,()=>s(Al),bo=>bo.name,(bo,cs)=>{var b=QU(),k={},T=g(b,!0);f(b),Se(()=>{k!==(k=s(cs).name)&&(b.value=(b.__value=s(cs).name)==null?"":s(cs).name),ze(T,s(cs).title||s(cs).name)}),z(bo,b)}),f(pu),f(Yu),f(uu);var et=u(uu,2);Te(et,()=>s(Va),bo=>{var cs=oG(),b=g(cs),k=u(g(b),2);Qt(k),k.__input=[eG,Nl],f(b);var T=u(b,2),A=u(g(T),2);Qt(A),A.__input=[tG,dd],f(T);var $=u(T,2),E=u(g($),2);Qt(E),E.__input=[nG,Cd],f($),f(cs),Se(()=>{Jd(k,s(Nl)),Jd(A,s(dd)),Jd(E,s(Cd))}),z(bo,cs)});var Ae=u(et,2),gt=u(g(Ae),2),He=g(gt);_g(He,()=>s(fa));var ht;He.__change=[sG,fa];var It=g(He);It.value=(It.__value="netPnl")==null?"":"netPnl";var Ot=u(It);Ot.value=(Ot.__value="profitFactor")==null?"":"profitFactor";var lo=u(Ot);lo.value=(lo.__value="sharpe")==null?"":"sharpe";var sn=u(lo);sn.value=(sn.__value="winRate")==null?"":"winRate";var Ao=u(sn);Ao.value=(Ao.__value="maxDrawdownPct")==null?"":"maxDrawdownPct",f(He),f(gt),f(Ae);var Cn=u(Ae,2),Jn=u(g(Cn),2),nn=g(Jn),us=g(nn);Qt(us),us.__change=[iG,od],ai(2),f(nn),f(Jn),f(Cn);var Tn=u(Cn,2);Te(Tn,()=>s(od),bo=>{var cs=aG(),b=u(g(cs),2),k=g(b);Qt(k),k.__input=[rG,zd],f(b),f(cs),Se(()=>Jd(k,s(zd))),z(bo,cs)});var ui=u(Tn,2),Hs=g(ui);Hs.__click=[Tq,Al,ic,Fs,Va,go,$r,cd,Sd,Nl,dd,Cd,je,ml,Kl,gl,Dl,_d,Ec,al,kc,a,ns];var da=u(Hs,2);Te(da,()=>s(Dl),bo=>{var cs=lG();cs.__click=[Lq,Dl,_d,ml,kc],z(bo,cs)},bo=>{var cs=Ln(),b=Dt(cs);Te(b,()=>s(Kl).length,k=>{var T=cG();T.__click=[Fq,Kl,al,ic,gl,ml,Dl,_d,kc],z(k,T)},null,!0),z(bo,cs)}),ai(2),f(ui);var Yi=u(ui,2);Te(Yi,()=>s(ic),bo=>{var cs=dG(),b=g(cs,!0);f(cs),Se(()=>ze(b,s(ic))),z(bo,cs)});var Bi=u(Yi,2);Te(Bi,()=>s(Dl),bo=>{var cs=uG(),b=g(cs);f(cs),Se(()=>zt(b,"style",`width:${s(sd)}%`)),z(bo,cs)}),Se(()=>{Gi!==(Gi=s(Fs))&&(_s.value=(_s.__value=s(Fs))==null?"":s(Fs),Am(_s,s(Fs))),Jd(sa,s($r)),Jd(Dr,s(cd)),Jd(Wc,s(Sd)),Yv!==(Yv=s(Va))&&(pu.value=(pu.__value=s(Va))==null?"":s(Va),Am(pu,s(Va))),ht!==(ht=s(fa))&&(He.value=(He.__value=s(fa))==null?"":s(fa),Am(He,s(fa))),Qv(us,s(od)),Hs.disabled=s(Dl)}),z(Ti,zo)},Ti=>{var zo=vG();z(Ti,zo)}),f(Ra);var Yc=u(Ra,2),xi=u(g(Yc),2);Te(xi,()=>s(id).length,Ti=>{var zo=gG(),ca=Dt(zo),oa=g(ca);f(ca);var _s=u(ca,2),Gi=u(g(_s),2);vs(Gi,19,()=>s(id),(Ta,sa)=>eu(Ta.params)+sa,(Ta,sa,ec)=>{var Dr=fG(),Ul=g(Dr),Wc=g(Ul,!0);Se(()=>ze(Wc,eu(s(sa).params))),f(Ul);var uu=u(Ul,2),Yu=g(uu,!0);Se(()=>ze(Yu,Eo(s(sa).summary))),f(uu);var pu=u(uu,2),Yv=g(pu);Se(()=>ze(Yv,`${(s(sa).summary.netPnl>=0?"+":"")??""}${Lo(s(sa).summary.netPnl,2)??""}`)),f(pu);var Ip=u(pu,2),lf=g(Ip,!0);Se(()=>ze(lf,Xs(s(sa).summary.netPnlPct??0))),f(Ip);var et=u(Ip,2),Ae=g(et,!0);Se(()=>ze(Ae,Xs(s(sa).summary.maxDrawdownPct??0))),f(et);var gt=u(et,2),He=g(gt,!0);Se(()=>ze(He,Xs(s(sa).summary.winRate??0))),f(gt);var ht=u(gt,2),It=g(ht,!0);f(ht),f(Dr),Se(()=>{Us(Dr,`${`opt-results-row ${s(ec)===0?"best":""}`??""} svelte-dgb5y3`),Us(pu,`${`right mono ${s(sa).summary.netPnl>=0?"pos":"neg"}`??""} svelte-dgb5y3`),ze(It,s(sa).summary.trades??0)}),z(Ta,Dr)}),f(_s);var Fl=u(_s,2);Te(Fl,()=>s(od)&&s(al),Ta=>{var sa=mG();const ec=vt(()=>eu(s(al).params)??""),Dr=vt(()=>(s(al).summary.netPnl>=0?"+":"")??""),Ul=vt(()=>Lo(s(al).summary.netPnl,2)??""),Wc=vt(()=>Xs(s(al).summary.maxDrawdownPct??0)??""),uu=vt(()=>Xs(s(al).summary.winRate??0)??"");var Yu=g(sa);Se(()=>ze(Yu,`Test run: ${s(ec)} • Net ${s(Dr)}${s(Ul)} • DD ${s(Wc)} • Win ${s(uu)}`)),f(sa),z(Ta,sa)}),Se(()=>ze(oa,`Showing ${s(id).length??""} runs`)),z(Ti,zo)},Ti=>{var zo=hG();z(Ti,zo)}),f(Yc),f(Ic),f(ka);var nr=u(ka,2),wi=g(nr),pl=g(wi),ar=g(pl),vl=u(g(ar),2);vl.__click=[_G,So],f(ar),ai(2),f(pl);var Qc=u(pl,2),ou=g(Qc),Fu=g(ou);Fu.__click=[yG,zr];var Ad=u(Fu,2);Ad.__click=[bG,zr];var Xd=u(Ad,2);Xd.__click=[xG,zr];var Kp=u(Xd,2);Kp.__click=[wG,zr];var yp=u(Kp,2);yp.__click=[kG,zr];var $v=u(yp,2);$v.__click=[SG,zr];var Zp=u($v,2);Zp.__click=[CG,zr],f(ou),f(Qc),f(wi);var Xp=u(wi,2),Jp=g(Xp),lv=g(Jp),qv=u(g(lv),2),pp=g(qv);Te(pp,()=>s(Er).length,Ti=>{var zo=fg();const ca=vt(()=>Lo(s(Er)[0].equity,2)??""),oa=vt(()=>Lo(s(Er)[s(Er).length-1].equity,2)??"");Se(()=>ze(zo,`${s(ca)} → ${s(oa)}`)),z(Ti,zo)}),f(qv),f(lv);var Iu=u(lv,2);Te(Iu,()=>s(Cc),Ti=>{var zo=PG(),ca=g(zo),oa=u(g(ca),2),_s=g(oa,!0);Se(()=>ze(_s,Lo(s(Cc).first,2))),f(oa),f(ca);var Gi=u(ca,2),Fl=u(g(Gi),2),Ta=g(Fl,!0);Se(()=>ze(Ta,Lo(s(Cc).last,2))),f(Fl),f(Gi);var sa=u(Gi,2),ec=u(g(sa),2),Dr=g(ec);Se(()=>ze(Dr,`${(s(Cc).net>=0?"+":"")??""}${Lo(s(Cc).net,2)??""}`)),f(ec),f(sa);var Ul=u(sa,2),Wc=u(g(Ul),2),uu=g(Wc);Se(()=>ze(uu,`${(s(Cc).retPct>=0?"+":"")??""}${Xs(s(Cc).retPct)??""}`)),f(Wc),f(Ul);var Yu=u(Ul,2),pu=u(g(Yu),2);const Yv=vt(()=>Lo(s(Cc).min,2)??""),Ip=vt(()=>Lo(s(Cc).max,2)??"");var lf=g(pu);Se(()=>ze(lf,`${s(Yv)}–${s(Ip)}`)),f(pu),f(Yu),f(zo),Se(()=>{Us(ec,`${`mono ${s(Cc).net>=0?"pos":"neg"}`??""} svelte-dgb5y3`),Us(Wc,`${`mono ${s(Cc).retPct>=0?"pos":"neg"}`??""} svelte-dgb5y3`)}),z(Ti,zo)});var Qp=u(Iu,2);Qp.__pointermove=Fn;var Lf=g(Qp);Te(Lf,()=>s(ge),Ti=>{var zo=AG(),ca=Dt(zo),oa=g(ca),_s=u(oa),Gi=u(_s);Te(Gi,()=>s(Le),Ul=>{var Wc=IG();Se(()=>zt(Wc,"d",s(Le).line)),z(Ul,Wc)});var Fl=u(Gi,4);Te(Fl,()=>s(cu),Ul=>{var Wc=MG();Se(()=>{zt(Wc,"cx",s(cu).x),zt(Wc,"cy",s(cu).y)}),z(Ul,Wc)}),f(ca);var Ta=u(ca,2),sa=g(Ta,!0);Se(()=>ze(sa,Lo(s(ge).maxY,2))),f(Ta);var ec=u(Ta,2),Dr=g(ec,!0);Se(()=>ze(Dr,Lo(s(ge).minY,2))),f(ec),Se(()=>{zt(oa,"d",s(ge).area),zt(_s,"d",s(ge).line)}),z(Ti,zo)},Ti=>{var zo=TG();z(Ti,zo)});var lg=u(Lf,2);Te(lg,()=>s(Ht),Ti=>{var zo=LG(),ca=Dt(zo),oa=u(ca,2),_s=u(oa,2),Gi=g(_s),Fl=g(Gi,!0);Se(()=>ze(Fl,new Date(s(Ht).ts).toISOString().slice(0,10))),f(Gi);var Ta=u(Gi,2),sa=u(g(Ta)),ec=g(sa,!0);Se(()=>ze(ec,Lo(s(Ht).equity,2))),f(sa),f(Ta);var Dr=u(Ta,2),Ul=u(g(Dr)),Wc=g(Ul);Se(()=>ze(Wc,`${(s(Ht).net>=0?"+":"")??""}${Xo(s(Ht).net)??""}`)),f(Ul),f(Dr);var uu=u(Dr,2),Yu=u(g(uu)),pu=g(Yu);Se(()=>ze(pu,`${(s(Ht).retPct>=0?"+":"")??""}${As(s(Ht).retPct)??""}`)),f(Yu),f(uu),f(_s),Se(()=>{zt(ca,"style",`left:${s(Ht).x}px;`),zt(oa,"style",`top:${s(Ht).y}px;`),zt(_s,"style",`left:${s(Ht).left}px; top:${s(Ht).top}px;`)}),z(Ti,zo)}),f(Qp);var $m=u(Qp,2);Te($m,()=>s(Le),Ti=>{var zo=FG();z(Ti,zo)}),f(Jp);var Cp=u(Jp,2),qf=g(Cp),$u=u(g(qf),2),Pp=g($u);Se(()=>ze(Pp,`Max ${Xs(s(Be).maxDrawdownPct)??""}`)),f($u),f(qf);var rp=u(qf,2);Te(rp,()=>s(Ac),Ti=>{var zo=$G(),ca=g(zo),oa=u(g(ca),2),_s=g(oa,!0);Se(()=>ze(_s,Xs(s(Ac).worstAbs))),f(oa),f(ca);var Gi=u(ca,2),Fl=u(g(Gi),2),Ta=g(Fl,!0);Se(()=>ze(Ta,Xs(s(Ac).avgAbs))),f(Fl),f(Gi);var sa=u(Gi,2),ec=u(g(sa),2),Dr=g(ec,!0);Se(()=>ze(Dr,Xs(s(Ac).lastAbs))),f(ec),f(sa),f(zo),z(Ti,zo)});var nf=u(rp,2);nf.__pointermove=Vt;var of=g(nf);Te(of,()=>s(dt),Ti=>{var zo=NG(),ca=Dt(zo),oa=g(ca),_s=u(oa),Gi=u(_s,4);Te(Gi,()=>s(Id),Dr=>{var Ul=EG();Se(()=>{zt(Ul,"cx",s(Id).x),zt(Ul,"cy",s(Id).y)}),z(Dr,Ul)}),f(ca);var Fl=u(ca,2),Ta=g(Fl);Se(()=>ze(Ta,`${Lo(s(dt).maxY,2)??""}%`)),f(Fl);var sa=u(Fl,2),ec=g(sa);Se(()=>ze(ec,`${Lo(s(dt).minY,2)??""}%`)),f(sa),Se(()=>{zt(oa,"d",s(dt).area),zt(_s,"d",s(dt).line)}),z(Ti,zo)},Ti=>{var zo=DG();z(Ti,zo)});var sf=u(of,2);Te(sf,()=>s(qe),Ti=>{var zo=RG(),ca=Dt(zo),oa=u(ca,2),_s=u(oa,2),Gi=g(_s),Fl=g(Gi,!0);Se(()=>ze(Fl,new Date(s(qe).ts).toISOString().slice(0,10))),f(Gi);var Ta=u(Gi,2),sa=u(g(Ta)),ec=g(sa,!0);Se(()=>ze(ec,Xs(Math.abs(s(qe).ddPct)))),f(sa),f(Ta);var Dr=u(Ta,2);Te(Dr,()=>s(qe).equity!=null,Ul=>{var Wc=jG(),uu=u(g(Wc)),Yu=g(uu,!0);Se(()=>ze(Yu,Lo(s(qe).equity,2))),f(uu),f(Wc),z(Ul,Wc)}),f(_s),Se(()=>{zt(ca,"style",`left:${s(qe).x}px;`),zt(oa,"style",`top:${s(qe).y}px;`),zt(_s,"style",`left:${s(qe).left}px; top:${s(qe).top}px;`)}),z(Ti,zo)}),f(nf),f(Cp),f(Xp),f(nr);var Aa=u(nr,2),Hv=g(Aa),ff=g(Hv),Ev=g(ff),vm=u(g(Ev),2);vm.__click=[BG,So],f(Ev),ai(2),f(ff),f(Hv);var Uv=u(Hv,2),Gv=g(Uv),ap=u(g(Gv),4);Te(ap,()=>s(Ct).length,Ti=>{var zo=WG(),ca=u(g(zo),2);vs(ca,17,()=>s(Ct),Vs,(oa,_s)=>{var Gi=VG();Se(()=>zt(Gi,"title",(()=>{const Dr=s(kn).get(s(_s).key)||null;if(!Dr)return"Click to filter trades by this month";const Ul=Dr.trades?Dr.wins/Dr.trades*100:0,Wc=Dr.net>=0?`+${Lo(Dr.net,2)}`:`${Lo(Dr.net,2)}`;return`Trades ${Dr.trades} • Win ${Xs(Ul)} • Net ${Wc} • Fees ${Lo(Dr.fees,2)} • Click to filter`})())),Gi.__click=[OG,Tl,_s,h,Ya],Gi.__keydown=[zG,Tl,_s,h,Ya];var Fl=g(Gi),Ta=g(Fl,!0);f(Fl);var sa=u(Fl,2),ec=g(sa);Se(()=>ze(ec,`${(s(_s).retPct>=0?"+":"")??""}${Xs(s(_s).retPct)??""}`)),f(sa),f(Gi),Se(()=>{Us(Gi,`${`rt-row ${s(_s).retPct>=0?"pos":"neg"} ${s(qn).type==="month"&&s(qn).key===s(_s).key?"active":""}`??""} svelte-dgb5y3`),ze(Ta,s(_s).key)}),z(oa,Gi)}),f(zo),z(Ti,zo)},Ti=>{var zo=qG();z(Ti,zo)}),f(Gv);var Hf=u(Gv,2),Em=u(g(Hf),4);Te(Em,()=>s(Re).length,Ti=>{var zo=YG(),ca=u(g(zo),2);vs(ca,17,()=>s(Re),Vs,(oa,_s)=>{var Gi=GG();Se(()=>zt(Gi,"title",(()=>{const Dr=s(ro).get(s(_s).key)||null;if(!Dr)return"Click to filter trades by this week";const Ul=Dr.trades?Dr.wins/Dr.trades*100:0,Wc=Dr.net>=0?`+${Lo(Dr.net,2)}`:`${Lo(Dr.net,2)}`;return`Trades ${Dr.trades} • Win ${Xs(Ul)} • Net ${Wc} • Fees ${Lo(Dr.fees,2)} • Click to filter`})())),Gi.__click=[HG,Tl,_s,h,Ya],Gi.__keydown=[UG,Tl,_s,h,Ya];var Fl=g(Gi),Ta=g(Fl,!0);f(Fl);var sa=u(Fl,2),ec=g(sa);Se(()=>ze(ec,`${(s(_s).retPct>=0?"+":"")??""}${Xs(s(_s).retPct)??""}`)),f(sa),f(Gi),Se(()=>{Us(Gi,`${`rt-row ${s(_s).retPct>=0?"pos":"neg"} ${s(qn).type==="week"&&s(qn).key===s(_s).key?"active":""}`??""} svelte-dgb5y3`),ze(Ta,s(_s).key)}),z(oa,Gi)}),f(zo),z(Ti,zo)},Ti=>{var zo=KG();z(Ti,zo)}),f(Hf),f(Uv),f(Aa);var mf=u(Aa,2),Uf=g(mf),Ff=g(Uf),cg=g(Ff),xg=u(g(cg),2);xg.__click=[ZG,So],f(cg),ai(2),f(Ff),f(Uf);var Nm=u(Uf,2),kv=g(Nm),vp=u(g(kv),2);Te(vp,()=>s(ra).length,Ti=>{var zo=JG();vs(zo,21,()=>s(ra),Vs,(ca,oa)=>{var _s=XG(),Gi=g(_s),Fl=g(Gi,!0);f(Gi);var Ta=u(Gi,2),sa=g(Ta);const ec=vt(()=>`width:${s(oa).count/st(s(ra))*100}%`);f(Ta);var Dr=u(Ta,2),Ul=g(Dr,!0);f(Dr),f(_s),Se(()=>{ze(Fl,s(oa).label),zt(sa,"style",s(ec)),ze(Ul,s(oa).count)}),z(ca,_s)}),f(zo),z(Ti,zo)},Ti=>{var zo=QG();z(Ti,zo)}),f(kv);var cv=u(kv,2),wg=u(g(cv),2);Te(wg,()=>s(Qr).length,Ti=>{var zo=tY();vs(zo,21,()=>s(Qr),Vs,(ca,oa)=>{var _s=eY(),Gi=g(_s),Fl=g(Gi,!0);f(Gi);var Ta=u(Gi,2),sa=g(Ta);const ec=vt(()=>`width:${s(oa).count/st(s(Qr))*100}%`);f(Ta);var Dr=u(Ta,2),Ul=g(Dr,!0);f(Dr),f(_s),Se(()=>{ze(Fl,s(oa).label),zt(sa,"style",s(ec)),ze(Ul,s(oa).count)}),z(ca,_s)}),f(zo),z(Ti,zo)},Ti=>{var zo=nY();z(Ti,zo)}),f(cv);var Nv=u(cv,2),Dm=u(g(Nv),2);Te(Dm,()=>s(hl).length,Ti=>{var zo=sY();vs(zo,21,()=>s(hl),Vs,(ca,oa)=>{var _s=oY(),Gi=g(_s),Fl=g(Gi,!0);f(Gi);var Ta=u(Gi,2),sa=g(Ta);const ec=vt(()=>`width:${s(oa).count/st(s(hl))*100}%`);f(Ta);var Dr=u(Ta,2),Ul=g(Dr,!0);f(Dr),f(_s),Se(()=>{ze(Fl,s(oa).label),zt(sa,"style",s(ec)),ze(Ul,s(oa).count)}),z(ca,_s)}),f(zo),z(Ti,zo)},Ti=>{var zo=iY();z(Ti,zo)}),f(Nv);var jm=u(Nv,2),gf=u(g(jm),2);Te(gf,()=>s(lc).length,Ti=>{var zo=aY();vs(zo,21,()=>s(lc),Vs,(ca,oa)=>{var _s=rY(),Gi=g(_s),Fl=g(Gi,!0);f(Gi);var Ta=u(Gi,2),sa=g(Ta);const ec=vt(()=>`width:${s(oa).count/st(s(lc))*100}%`);f(Ta);var Dr=u(Ta,2),Ul=g(Dr,!0);f(Dr),f(_s),Se(()=>{ze(Fl,s(oa).label),zt(sa,"style",s(ec)),ze(Ul,s(oa).count)}),z(ca,_s)}),f(zo),z(Ti,zo)},Ti=>{var zo=lY();z(Ti,zo)}),f(jm),f(Nm),f(mf);var fm=u(mf,2),$f=g(fm),Rm=g($f),mm=g(Rm),dg=u(g(mm),2);dg.__click=[cY,So],f(mm),ai(2),f(Rm),f($f);var Gf=u($f,2),gm=g(Gf);gm.__click=[dY,Ya];var Yf=u(gm,2);Yf.__click=[uY,Ya];var Bm=u(Yf,2);Bm.__click=[h2,uo,wt,Xl,as,Pi,Yt,Xo,As,hs];var Ef=u(Bm,2);Te(Ef,()=>s(qn).type!=="all",Ti=>{var zo=pY();zo.__click=[Eq,uo,so,Xl,as,Pi,Yt,Xo,As,qn,hs],z(Ti,zo)});var hm=u(Ef,2);hm.__click=[_2,uo,Lt,Yt,Pi,Xo,as,hs];var hf=u(hm,2);hf.__click=[Nq,uo,ur,hs],f(Gf);var Nf=u(Gf,2),Df=g(Nf),Om=g(Df);Se(()=>ze(Om,`Gross Profit: +${Lo(s(Be).grossProfit,2)??""}`)),f(Df);var rf=u(Df,2),zm=g(rf);Se(()=>ze(zm,`Gross Loss: -${Lo(s(Be).grossLoss,2)??""}`)),f(rf);var Dp=u(rf,2),af=g(Dp);Se(()=>ze(af,`Total: ${(s(Be).netPnl>=0?"+":"")??""}${Lo(s(Be).netPnl,2)??""}`)),f(Dp),f(Nf);var _m=u(Nf,2),Kf=g(_m),Vm=g(Kf);Se(()=>ze(Vm,`Net (from trades): ${(s(Ga)>=0?"+":"")??""}${or(s(Ga))??""}`)),f(Kf);var ym=u(Kf,2),Wm=g(ym);Se(()=>ze(Wm,`Initial: ${Lo(s(Be).initialCapital,2)??""}`)),f(ym);var qm=u(ym,2),Hm=g(qm);Se(()=>ze(Hm,`Final: ${Lo(s(Be).finalEquity,2)??""}`)),f(qm),f(_m),f(fm),f(yo),Se(()=>{Us(Nt,`${`kpi-value mono ${s(Be).netPnl>=0?"pos":"neg"}`??""} svelte-dgb5y3`),ze(Ar,s(xt).total),ze(Oo,`L ${s(xt).entryLong??""}/${s(xt).exitLong??""} • S ${s(xt).entryShort??""}/${s(xt).exitShort??""}`),Jd(gc,s(oo)),Jd(Kd,s(Gs)),Jd(Wl,s(jo)),zc.disabled=c(),Jd($p,s(Qo)),hp.disabled=!s(Be),ze(ve,s(Be).trades),ze(Wi,`Wins ${s(Be).wins??""} • Loss ${s(Be).losses??""} `),ze(Pu,`Trades ${s(Os).long.trades??""}`),ze(Nr,`Trades ${s(Os).short.trades??""}`),ze(ao,s(Pd)),Fi(Fu,"active",s(zr)==="1w"),Fi(Ad,"active",s(zr)==="1m"),Fi(Xd,"active",s(zr)==="3m"),Fi(Kp,"active",s(zr)==="6m"),Fi(yp,"active",s(zr)==="1y"),Fi($v,"active",s(zr)==="5y"),Fi(Zp,"active",s(zr)==="all"),Us(Dp,`${`pnl-item ${s(Be).netPnl>=0?"pos":"neg"}`??""} svelte-dgb5y3`)}),sc("pointerleave",Qp,()=>{x(Ht,null)}),sc("pointerleave",nf,()=>{x(qe,null)}),z(Zn,yo)}),f(Kt),z(ut,Kt)},null,!0),z(U,te)});var Dc=u(Ql,2);Te(Dc,()=>s(no),U=>{var te=xY();te.__click=[m2,no];var $e=g(te);$e.__click=[mY];var ut=g($e),Kt=g(ut),$t=g(Kt,!0);f(Kt);var wn=u(Kt,2),Zn=g(wn),yo=g(Zn);yo.__click=[gY,ps];var es=u(yo,2);es.__click=[hY,ps],f(Zn);var $s=u(Zn,2);$s.__click=[m2,no],f(wn),f(ut);var oi=u(ut,2),Ts=g(oi);Te(Ts,()=>On[s(fs)],hr=>{var Vr=bY(),Nt=Dt(Vr);vs(Nt,21,()=>On[s(fs)][s(ps)].desc,Vs,(mo,Bo)=>{var ws=_Y(),$o=g(ws,!0);f(ws),Se(()=>ze($o,s(Bo))),z(mo,ws)}),f(Nt);var Wn=u(Nt,2),Co=u(g(Wn),2);vs(Co,21,()=>On[s(fs)][s(ps)].examples,Vs,(mo,Bo)=>{var ws=yY(),$o=g(ws,!0);f(ws),Se(()=>ze($o,s(Bo))),z(mo,ws)}),f(Co),f(Wn),z(hr,Vr)}),f(oi),f($e),f(te),Se(()=>{var hr,Vr;ze($t,(Vr=(hr=On[s(fs)])==null?void 0:hr[s(ps)])==null?void 0:Vr.title),Fi(yo,"active",s(ps)==="en"),Fi(es,"active",s(ps)==="bn")}),z(U,te)});var Ee=u(Dc,2);Te(Ee,()=>s(J),U=>{var te=TY();te.__click=[f2,J];var $e=g(te);$e.__click=[wY];var ut=g($e),Kt=u(g(ut),2),$t=g(Kt);$t.__click=[f2,J],f(Kt),f(ut);var wn=u(ut,2),Zn=g(wn),yo=g(Zn),es=u(g(yo),2);Qt(es),es.__keydown=[kY,Fe];var $s=u(es,2),oi=g($s);oi.__click=Fe,ai(2),f($s),f(yo),f(Zn);var Ts=u(Zn,2),hr=g(Ts),Vr=u(g(hr),2),Nt=g(Vr);Te(Nt,()=>s(V),Bo=>{var ws=SY();z(Bo,ws)},Bo=>{var ws=Ln(),$o=Dt(ws);Te($o,()=>s(W).length===0,_i=>{var Ar=CY();z(_i,Ar)},_i=>{var Ar=Ln(),Da=Dt(Ar);vs(Da,17,()=>s(W),Vs,(Oo,ss)=>{var ds=IY();ds.__click=[PY,Y,ss];var yn=g(ds),wo=g(yn,!0);f(yn);var si=u(yn,2),ir=g(si,!0);Se(()=>ze(ir,Pt(s(ss).updatedAt))),f(si),f(ds),Se(()=>{Us(ds,`save-row ${(s(Y)===s(ss).id?"selected":"")??""} svelte-dgb5y3`),ze(wo,s(ss).name)}),z(Oo,ds)}),z(_i,Ar)},!0),z(Bo,ws)}),f(Vr);var Wn=u(Vr,2),Co=g(Wn);Co.__click=[MY,Y,Ze],ai(2),f(Wn),f(hr),f(Ts);var mo=u(Ts,2);Te(mo,()=>s(G),Bo=>{var ws=AY(),$o=g(ws,!0);f(ws),Se(()=>ze($o,s(G))),z(Bo,ws)}),f(wn),f($e),f(te),Se(()=>{oi.disabled=s(se),Co.disabled=!s(Y)||s(se)}),po(es,()=>s(Z),Bo=>x(Z,Bo)),z(U,te)});var ac=u(Ee,2);Te(ac,()=>s(F),U=>{var te=VY();te.__click=[v2,F];var $e=g(te);$e.__click=[LY];var ut=g($e),Kt=u(g(ut),2),$t=g(Kt);$t.__click=[Cq,K];var wn=u($t,2);wn.__click=[v2,F],f(Kt),f(ut);var Zn=u(ut,2),yo=g(Zn);Qt(yo);var es=u(yo,2),$s=g(es);Se(()=>ze($s,`${nt().length??""} scripts`)),f(es),f(Zn);var oi=u(Zn,2);Te(oi,()=>s(D),Vr=>{var Nt=FY(),Wn=g(Nt,!0);f(Nt),Se(()=>ze(Wn,s(D))),z(Vr,Nt)});var Ts=u(oi,2),hr=g(Ts);Te(hr,()=>s(V),Vr=>{var Nt=$Y();z(Vr,Nt)},Vr=>{var Nt=Ln(),Wn=Dt(Nt);Te(Wn,()=>nt().length===0,Co=>{var mo=EY();z(Co,mo)},Co=>{var mo=zY();vs(mo,21,nt,Vs,(Bo,ws)=>{var $o=OY(),_i=g($o),Ar=g(_i),Da=g(Ar,!0);f(Ar);var Oo=u(Ar,2),ss=g(Oo);Se(()=>ze(ss,`Updated ${Pt(s(ws).updatedAt)??""}`)),f(Oo),f(_i);var ds=u(_i,2),yn=g(ds);yn.__click=[NY,kt,ws];var wo=u(yn,2);wo.__click=[DY,ft,ws];var si=u(wo,2);si.__click=[jY,bt,ws];var ir=u(si,2);ir.__click=[RY,it,ws];var Ji=u(ir,2);Ji.__click=[BY,Ge,ws],f(ds),f($o),Se(()=>ze(Da,s(ws).name)),z(Bo,$o)}),f(mo),z(Co,mo)},!0),z(Vr,Nt)}),f(Ts),f($e),f(te),Se(()=>$t.disabled=s(V)),po(yo,()=>s(R),Vr=>x(R,Vr)),z(U,te)});var Ia=u(ac,2),Pc=g(Ia),Xi=g(Pc),aa=u(Xi,2),Fp=g(aa,!0);f(aa);var ov=u(aa,2);return Te(ov,()=>typeof s(Ks)=="function"?s(Ks)():s(Ks),U=>{var te=qY();const $e=vt(()=>typeof s(Ks)=="function"?s(Ks)():s(Ks));Se(()=>zt(te,"title",typeof s(ci)=="function"?s(ci)():s(ci)));var ut=u(g(te),2),Kt=g(ut,!0);f(ut);var $t=u(ut,2),wn=g($t),Zn=g(wn,!0);f(wn);var yo=u(wn,2);vs(yo,17,()=>s($e).lines,Vs,(es,$s)=>{var oi=WY(),Ts=g(oi,!0);f(oi),Se(()=>ze(Ts,s($s))),z(es,oi)}),f($t),f(te),Se(()=>{Us(te,`${`footer-alert ${s($e).kind}`??""} svelte-dgb5y3`),ze(Kt,s($e).label),ze(Zn,s($e).title)}),z(U,te)}),f(Pc),ai(2),f(Ia),f(de),Se(()=>{zt(de,"aria-hidden",!d()),Fi(de,"fullpage",s(un)),Fi(_n,"selected",s(he)==="editor"),Fi(en,"selected",s(he)==="errors"),Fi(en,"has-errors",s(qs)>0),Fi(en,"has-warnings",s(qs)===0&&s(ta)>0),ze(Rn,s(Tc)),Fi(Dn,"selected",s(he)==="results"),zt(Po,"aria-pressed",s(Wt)),ze(An,`Labels ${(s(Wt)?"On":"Off")??""}`),Bn.disabled=c(),ze(Gn,c()?"Running...":"Run"),Fi(bi,"hidden",s(he)!=="editor"),ze(Ca,`inline-script.${s(hi)??""}`),ze(Pa,`Lines: ${s(Kn)??""}`),Fi(Jl,"monaco-mode",s(pn)!=="failed"),Us(Xi,`footer-dot ${(r()?"error":c()?"running":"ok")??""} svelte-dgb5y3`),ze(Fp,s(Sl))}),qo(jn,()=>s(_t),U=>x(_t,U)),z(n,de),hd({setEditorCode:ct})}qu(["pointerdown","click","input","change","keydown","pointermove"]);var GY=(n,e)=>{n.target===n.currentTarget&&e()},YY=(n,e)=>x(e,"details"),KY=(n,e)=>x(e,"examples"),ZY=(n,e)=>x(e,"bn"),XY=(n,e)=>x(e,"en"),JY=(n,e)=>x(e,"json"),QY=(n,e)=>x(e,"pine"),eK=(n,e)=>x(e,"dsl"),tK=fe('<h3 class="ss-section-title svelte-50qv65">JSON ডকুমেন্টেশন (Structured Spec)</h3> <p>JSON মোডে আপনি স্ট্রাকচার্ড স্কিমা দিয়ে ইন্ডিকেটর, সিগন্যাল, ব্যাকটেস্ট এবং ভিজ্যুয়াল তৈরি করেন। এটি সম্পূর্ণ প্রোগ্রামিং ভাষা নয়—বরং একটি শক্তিশালী কনফিগ‑স্টাইল স্কিমা।</p> <h4>✅ JSON‑এ যা কাজ করে</h4> <ul class="ss-list svelte-50qv65"><li>Top‑level: <code>pane</code>, <code>panes</code>, <code>plots</code>, <code>levels</code>, <code>labels</code>, <code>lines</code>, <code>fills</code>, <code>overlays</code></li> <li>Calculate: <code>calc</code> (EMA/SMA/RSI/ATR/MACD ইত্যাদি), <code>series</code> (expression‑based)</li> <li>State: <code>stateSeries</code> (bar‑by‑bar state), এবং নতুন <code>rules</code> শর্টকাট</li> <li>Signals: <code>signals</code> + <code>score</code>/<code>scoreExpr</code> + <code>cooldownBars</code>/<code>cooldownExpr</code></li> <li>Strategy: <code>strategy</code> (ব্যাকটেস্ট সেটিংস)</li> <li>Expressions: <code>whenExpr</code>, <code>textExpr</code>, <code>colorExpr</code>, <code>sizeExpr</code>, <code>widthExpr</code> ইত্যাদি</li> <li>Template loops: <code>repeat</code> / <code>forEach</code> (compile‑time expansion)</li> <li>Params: টেমপ্লেট <code>$&#123;param&#125;</code> রিপ্লেসমেন্ট সাপোর্টেড</li></ul> <h4>❌ JSON‑এ যা নেই</h4> <ul class="ss-list svelte-50qv65"><li>ইম্পেরেটিভ ব্লক (if/else, for/while) — JSON‑এ রানটাইম কোড ব্লক নেই</li> <li>JSON‑এ রUNTIME array/loop (শুধু টেমপ্লেট এক্সপ্যানশন আছে)</li> <li>Function ডিফাইন/ইমপোর্ট (শুধু স্কিমা‑লেভেল)</li> <li>টিক‑লেভেল এক্সিকিউশন; সবই bar‑based</li></ul> <h4>বেসিক স্ট্রাকচার</h4> <ul class="ss-list svelte-50qv65"><li>একটি প্লট বা লেবেল থাকা বাধ্যতামূলক (না হলে স্ক্রিপ্ট ব্ল্যাঙ্ক দেখাতে পারে)</li> <li><code>calc</code> থেকে সিরিজ আসে, আর <code>series</code> দিয়ে কাস্টম এক্সপ্রেশন বানানো যায়</li> <li>একাধিক প্যানের জন্য <code>panes</code> ব্যবহার করুন</li></ul> <h4>when বনাম whenExpr</h4> <ul class="ss-list svelte-50qv65"><li><code>when</code> = condition language (crossesAbove, between, and/or)</li> <li><code>whenExpr</code> = expression engine (numeric/boolean)</li> <li>যেকোনো একটিই দিন; দুটো দিলে <code>whenExpr</code> প্রাধান্য পায়</li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">Condition Language (when)</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>Rules + State (JSON‑only)</h4> <ul class="ss-list svelte-50qv65"><li><code>rules</code> শর্টকাট দিয়ে সিরিজ বা স্টেট তৈরি হয়</li> <li>state rule‑এ <code>else</code> না দিলে আগের মান ধরে রাখা হয়</li> <li>stateSeries নিজে‑নিজে ডিপেন্ডেন্সি‑অর্ডার ঠিক করে (JSON‑only)</li> <li>সাইকেল থাকলে হার্ড এরর: circular dependency</li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">JSON · Rules + State</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>repeat / forEach টেমপ্লেট লুপ</h4> <ul class="ss-list svelte-50qv65"><li>এগুলো রানটাইম নয়—ফাইল লোডের সময় এক্সপ্যান্ড হয়</li> <li>সর্বোচ্চ 512 আইটেম পর্যন্ত এক্সপ্যানশন (হার্ড লিমিট)</li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">JSON · Repeat Template</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>Dynamic Visual Expressions</h4> <ul class="ss-list svelte-50qv65"><li><code>label.colorExpr</code>, <code>label.textExpr</code>, <code>label.sizeExpr</code></li> <li><code>line.colorExpr</code>, <code>line.widthExpr</code></li> <li><code>box.bgColorExpr</code>, <code>box.borderColorExpr</code></li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">JSON · Dynamic Label Color/Text</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>Signals + Score + Cooldown</h4> <ul class="ss-list svelte-50qv65"><li><code>score</code> অবশ্যই 0–10 ইন্টিজার; ভুল হলে হার্ড এরর</li> <li><code>scoreExpr</code> ও <code>cooldownExpr</code>‑ও ইন্টিজার হতে হবে (সব বারে)</li> <li>সিগন্যাল রেঞ্জ: <code>entry_long</code>, <code>exit_long</code>, <code>entry_short</code>, <code>exit_short</code>, <code>cancel</code>, <code>cancel_all</code></li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">JSON · Signal + Score</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">JSON · ScoreExpr + CooldownExpr</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>JSON‑এ সাধারণ ভুল</h4> <ul class="ss-list svelte-50qv65"><li><code>Schema validation failed: ...</code> — ভুল ফিল্ড/টাইপ চেক করুন</li> <li><code>Missing series: ...</code> — প্লটে যে নাম ব্যবহার করেছেন তা calc/series‑এ নেই</li> <li><code>Condition parse failed</code> — <code>when</code>‑এ সঠিক condition সিনট্যাক্স দিন</li> <li><code>scoreExpr must be an integer 0..10</code> — ভ্যালু ঠিক করুন</li> <li><code>cooldownExpr must be a non-negative integer</code> — নেগেটিভ দিলে চলবে না</li></ul> <h4>Verification Checklist (JSON)</h4> <ul class="ss-list svelte-50qv65"><li>JSON ভ্যালিড কিনা (কমা/কোট ঠিক আছে?)</li> <li>অন্তত 1টি plot/label/level/line আছে?</li> <li>সব সিরিজ নাম ডিফাইন করা আছে?</li> <li><code>when</code> বনাম <code>whenExpr</code> ঠিকমতো ব্যবহার করেছেন?</li></ul>',1),nK=fe('<h3 class="ss-section-title svelte-50qv65">Pine‑like ডকুমেন্টেশন</h3> <p>এটি Pine‑স্টাইল সিনট্যাক্স, তবে সম্পূর্ণ Pine নয়। ধাপে ধাপে compatibility উন্নত করা হচ্ছে। স্ক্রিপ্টের শুরুতে <code>//@pine</code> এবং <code>//@version=5</code> দিতে হবে।</p> <h4>✅ সমর্থিত ফিচার (সংক্ষেপ)</h4> <ul class="ss-list svelte-50qv65"><li><code>indicator()</code>, <code>strategy()</code> (overlay সাপোর্টেড)</li> <li>লিটারাল: সংখ্যা, boolean, স্ট্রিং, <code>na</code></li> <li>if/else, ternary, <code>var</code> + <code>:=</code> (state)</li> <li>Plot/Visual: <code>plot</code>, <code>plotshape</code>, <code>plotchar</code>, <code>hline</code></li> <li>Signals: <code>signal BUY/SELL/EXIT</code> + <code>score</code> + <code>cooldown</code></li> <li>Strategy: <code>strategy.entry/exit/close/order/cancel</code></li> <li><code>request.security</code> (HTF/MTF)</li></ul> <h4>🟡 সীমাবদ্ধতা</h4> <ul class="ss-list svelte-50qv65"><li><code>if/else</code>‑এ সব স্টেটমেন্ট সমর্থিত নয়; unsupported হলে হার্ড এরর</li> <li>লুপ সীমিত; বড় লুপে 256 ইটারেশন ওয়ার্নিং</li> <li>কিছু array/string অপারেশন রানটাইমে সীমিত হতে পারে</li></ul> <h4>❌ যা নেই</h4> <ul class="ss-list svelte-50qv65"><li>সব Pine built‑ins (পুরো লাইব্রেরি নয়)</li> <li>Generic <code>input()</code> — শুধু <code>input.int/float/bool/string</code> ইত্যাদি</li> <li>টিক‑লেভেল এক্সিকিউশন</li></ul> <h4>শুরু করার নিয়ম</h4> <ul class="ss-list svelte-50qv65"><li>1) প্রথম দুই লাইনে <code>//@pine</code> এবং <code>//@version=5</code> লিখুন</li> <li>2) <code>indicator()</code> অথবা <code>strategy()</code> দিয়ে স্ক্রিপ্ট টাইপ নির্ধারণ করুন</li> <li>3) সিরিজ হিসাব করুন (যেমন <code>ema</code>, <code>sma</code>, <code>rsi</code>)</li> <li>4) কমপক্ষে একটি <code>plot</code>/<code>plotshape</code>/<code>plotchar</code> দিন</li> <li>5) সিগন্যাল লাগলে <code>signal BUY/SELL/EXIT</code> ব্যবহার করুন</li> <li>6) ব্যাকটেস্ট চাইলে <code>strategy.entry/exit</code> যোগ করুন</li></ul> <h4>ভ্যারিয়েবল, সিরিজ, এবং state</h4> <ul class="ss-list svelte-50qv65"><li>ডিক্লেয়ার: <code>x = expr</code>, আপডেট: <code>x := expr</code></li> <li><code>var</code> একবারই ইনিশিয়ালাইজ হয় (state memory)</li> <li>Series মান বার‑টু‑বার পরিবর্তিত হয়</li> <li>History: <code>close[1]</code>, <code>ema20[5]</code> (কনস্ট্যান্ট ইনডেক্স নিরাপদ)</li> <li>Boolean literal: <code>true</code>/<code>false</code>; Scientific notation: <code>1e-6</code></li></ul> <h4>অপারেটর ও এক্সপ্রেশন</h4> <ul class="ss-list svelte-50qv65"><li>Arithmetic: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code></li> <li>Comparison: <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code></li> <li>Logic: <code>and</code>, <code>or</code>, <code>not</code></li> <li>Ternary: <code>cond ? a : b</code> বা <code>iff(cond, a, b)</code></li></ul> <h4>if/else নিয়ম (গুরুত্বপূর্ণ)</h4> <ul class="ss-list svelte-50qv65"><li><code>if</code>, <code>else if</code>, <code>else</code>‑এর ব্লক ইনডেন্টেড হতে হবে</li> <li>ভিতরে সাধারণত assignment, plot/plotshape/plotchar, signal, strategy.* সাপোর্টেড</li> <li>Unsupported স্টেটমেন্ট হলে হার্ড এরর: <code>Unsupported statement inside if</code></li> <li>if/else লজিক রানটাইমে গেটিং হয়; সাইলেন্ট ড্রপ নেই</li></ul> <h4>ইন্ডিকেটর ও ফাংশন (কমন)</h4> <ul class="ss-list svelte-50qv65"><li><code>ema</code>, <code>sma</code>, <code>rsi</code>, <code>atr(high, low, close, length)</code></li> <li><code>highest</code>/<code>lowest</code>, <code>crossover</code>/<code>crossunder</code></li> <li><code>barssince</code>, <code>change</code>, <code>mom</code>, <code>roc</code></li> <li><code>nz</code>, <code>iff</code> (utility)</li></ul> <h4>সিগন্যাল লেখা (BUY/SELL/EXIT)</h4> <ul class="ss-list svelte-50qv65"><li>সিনট্যাক্স: <code>signal BUY when cond score=7 cooldown=5</code></li> <li>এলিয়াস: <code>BUY → entry_long</code>, <code>SELL → exit_long</code>, <code>EXIT → exit_long</code></li> <li><code>score</code> অবশ্যই 0–10 ইন্টিজার; ভুল হলে হার্ড এরর</li> <li><code>cooldown</code> বার‑কাউন্ট (non‑negative integer)</li></ul> <h4>স্ট্র্যাটেজি/ব্যাকটেস্ট নিয়ম</h4> <ul class="ss-list svelte-50qv65"><li><code>strategy.entry/order/close_all</code>‑এ <code>when=...</code> বাধ্যতামূলক</li> <li><code>strategy.exit/close</code>‑এ <code>when</code> অথবা <code>stop/limit</code> দরকার</li> <li>Stop/limit এক্সিট OCO গ্রুপে এক্সপ্যান্ড হয়</li></ul> <h4>ইনপুট ফাংশন</h4> <ul class="ss-list svelte-50qv65"><li><code>input.int</code>, <code>input.float</code>, <code>input.bool</code>, <code>input.string</code></li> <li><code>input.time</code>, <code>input.session</code>, <code>input.source</code>, <code>input.symbol</code>, <code>input.color</code></li> <li>সব ইনপুটে সঠিক টাইপের <code>defval</code> প্রয়োজন</li></ul> <h4>ভিজ্যুয়াল ও প্লট</h4> <ul class="ss-list svelte-50qv65"><li>বেসিক প্লট: <code>plot</code>, <code>plotshape</code>, <code>plotchar</code>, <code>hline</code></li> <li>ড্রয়িং: <code>line.new</code>, <code>label.new</code>, <code>box.new</code>, <code>linefill.new</code></li> <li><code>indicator(..., overlay=true)</code> মেইন প্যানে ডিফল্ট দেয়</li></ul> <h4>কমন এরর</h4> <ul class="ss-list svelte-50qv65"><li><code>Unsupported statement inside if: ...</code> — if ব্লকে অননুমোদিত স্টেটমেন্ট</li> <li><code>strategy.entry(...) requires when=...</code> — <code>when</code> যোগ করুন</li> <li><code>score must be an integer between 0 and 10</code> — 0–10 ইন্টিজার দিন</li> <li><code>input.int() requires numeric defval</code> — ভুল defval</li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">Pine‑like · Quick EMA</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">Pine‑like · Signal + Score</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">Pine‑like · Strategy</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>Strategy Rules</h4> <ul class="ss-list svelte-50qv65"><li><code>strategy.entry/order/close_all</code>‑এ <code>when=...</code> বাধ্যতামূলক</li> <li><code>strategy.exit/close</code>‑এ <code>when</code> অথবা <code>stop/limit</code> লাগবে</li></ul>',1),oK=fe('<h3 class="ss-section-title svelte-50qv65">DSL ডকুমেন্টেশন (Minimal)</h3> <p>DSL হলো দ্রুত সিগন্যাল/লেবেল লেখার জন্য একটি খুব ছোট ভাষা। এটি প্লট বা জটিল ব্যাকটেস্টের জন্য নয়।</p> <h4>✅ DSL‑এ যা কাজ করে</h4> <ul class="ss-list svelte-50qv65"><li>Assignment: <code>X = 10</code> (params) বা <code>X = ema(close, 20)</code> (series)</li> <li>Signal: <code>signal BUY when ... score:7 cooldown:5</code></li> <li>Label: <code>label at top text:"BUY" color:#22c55e</code></li></ul> <h4>❌ DSL‑এ যা নেই</h4> <ul class="ss-list svelte-50qv65"><li>Plot বা visual plots</li> <li>Strategy config বা risk settings</li> <li>Runtime loops/arrays</li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">DSL · Signal + Label</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>DSL টিপস</h4> <ul class="ss-list svelte-50qv65"><li><code>when</code> সবসময় condition language ব্যবহার করে</li> <li>একই লাইনে সবকিছু রাখুন; ব্লক নেই</li></ul>',1),sK=fe('<p class="ss-guide-intro svelte-50qv65">Script Studio‑তে তিনটি স্ক্রিপ্ট মোড আছে: JSON, Pine‑like, এবং DSL। নিচের ট্যাব থেকে আপনার মোড বেছে নিন। প্রতিটি মোডের সাপোর্ট, সীমাবদ্ধতা, উদাহরণ, এবং ভুল‑ত্রুটি ঠিক করার গাইড আলাদা করে দেওয়া আছে।</p> <div class="ss-tabs svelte-50qv65" role="tablist" aria-label="ডকুমেন্টেশন মোড"><button role="tab">JSON</button> <button role="tab">Pine‑like</button> <button role="tab">DSL</button></div> <!>',1),iK=(n,e)=>x(e,"json"),rK=(n,e)=>x(e,"pine"),aK=(n,e)=>x(e,"dsl"),lK=fe('<h3 class="ss-section-title svelte-50qv65">JSON Documentation (Structured Spec)</h3> <p>JSON mode uses a structured schema to build indicators, signals, backtests, and visuals. It is not a general-purpose programming language. Think of it as a powerful configuration format.</p> <h4>✅ What works in JSON</h4> <ul class="ss-list svelte-50qv65"><li>Top-level: <code>pane</code>, <code>panes</code>, <code>plots</code>, <code>levels</code>, <code>labels</code>, <code>lines</code>, <code>fills</code>, <code>overlays</code></li> <li>Calculate: <code>calc</code> (EMA/SMA/RSI/ATR/MACD, etc), <code>series</code> (expression-based)</li> <li>State: <code>stateSeries</code> (bar-by-bar state), plus the <code>rules</code> shortcut</li> <li>Signals: <code>signals</code> + <code>score</code>/<code>scoreExpr</code> + <code>cooldownBars</code>/<code>cooldownExpr</code></li> <li>Strategy: <code>strategy</code> (backtest settings)</li> <li>Expressions: <code>whenExpr</code>, <code>textExpr</code>, <code>colorExpr</code>, <code>sizeExpr</code>, <code>widthExpr</code>, etc</li> <li>Template loops: <code>repeat</code> / <code>forEach</code> (compile-time expansion)</li> <li>Params: template <code>$&#123;param&#125;</code> replacement</li></ul> <h4>❌ What JSON does not have</h4> <ul class="ss-list svelte-50qv65"><li>Imperative blocks (if/else, for/while) at runtime</li> <li>Runtime array/loop logic (only template expansion)</li> <li>Function definitions/imports (schema-level only)</li> <li>Tick-level execution; all bar-based</li></ul> <h4>Basic Structure</h4> <ul class="ss-list svelte-50qv65"><li>At least one plot or label is required (or the chart may look blank)</li> <li><code>calc</code> produces series, <code>series</code> defines custom expressions</li> <li>Use <code>panes</code> for multiple panels</li></ul> <h4>when vs whenExpr</h4> <ul class="ss-list svelte-50qv65"><li><code>when</code> = condition language (crossesAbove, between, and/or)</li> <li><code>whenExpr</code> = expression engine (numeric/boolean)</li> <li>If both are present, <code>whenExpr</code> wins</li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">Condition Language (when)</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>Rules + State (JSON-only)</h4> <ul class="ss-list svelte-50qv65"><li><code>rules</code> creates series or state values</li> <li>State rules keep the previous value if <code>else</code> is omitted</li> <li>stateSeries dependency order is auto-sorted (JSON-only)</li> <li>Cycles hard-error: circular dependency</li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">JSON - Rules + State</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>repeat / forEach template loops</h4> <ul class="ss-list svelte-50qv65"><li>These are compile-time expansions, not runtime loops</li> <li>Max expansion is 512 items (hard limit)</li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">JSON - Repeat Template</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>Dynamic Visual Expressions</h4> <ul class="ss-list svelte-50qv65"><li><code>label.colorExpr</code>, <code>label.textExpr</code>, <code>label.sizeExpr</code></li> <li><code>line.colorExpr</code>, <code>line.widthExpr</code></li> <li><code>box.bgColorExpr</code>, <code>box.borderColorExpr</code></li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">JSON - Dynamic Label Color/Text</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>Signals + Score + Cooldown</h4> <ul class="ss-list svelte-50qv65"><li><code>score</code> must be an integer 0-10; invalid values hard-error</li> <li><code>scoreExpr</code> and <code>cooldownExpr</code> must resolve to integers on every bar</li> <li>Signal types: <code>entry_long</code>, <code>exit_long</code>, <code>entry_short</code>, <code>exit_short</code>, <code>cancel</code>, <code>cancel_all</code></li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">JSON - Signal + Score</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">JSON - ScoreExpr + CooldownExpr</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>Common JSON errors</h4> <ul class="ss-list svelte-50qv65"><li><code>Schema validation failed: ...</code> - check field names and types</li> <li><code>Missing series: ...</code> - plot uses a name not defined in calc/series</li> <li><code>Condition parse failed</code> - fix <code>when</code> condition syntax</li> <li><code>scoreExpr must be an integer 0..10</code> - fix the value</li> <li><code>cooldownExpr must be a non-negative integer</code> - value must be &gt;= 0</li></ul> <h4>Verification Checklist (JSON)</h4> <ul class="ss-list svelte-50qv65"><li>JSON is valid (quotes/commas correct)</li> <li>At least one plot/label/level/line exists</li> <li>All series names are defined</li> <li>Use <code>when</code> or <code>whenExpr</code> correctly</li></ul>',1),cK=fe('<h3 class="ss-section-title svelte-50qv65">Pine-like Documentation</h3> <p>This is Pine-style syntax, but not full Pine. Start scripts with <code>//@pine</code> and <code>//@version=5</code>. Compatibility expands in stages.</p> <h4>✅ Supported (quick view)</h4> <ul class="ss-list svelte-50qv65"><li><code>indicator()</code>, <code>strategy()</code> (overlay supported)</li> <li>Literals: numbers, booleans, strings, <code>na</code></li> <li>if/else, ternary, <code>var</code> + <code>:=</code> (state)</li> <li>Plot/Visual: <code>plot</code>, <code>plotshape</code>, <code>plotchar</code>, <code>hline</code></li> <li>Signals: <code>signal BUY/SELL/EXIT</code> + <code>score</code> + <code>cooldown</code></li> <li>Strategy: <code>strategy.entry/exit/close/order/cancel</code></li> <li><code>request.security</code> (HTF/MTF)</li></ul> <h4>🟡 Limitations</h4> <ul class="ss-list svelte-50qv65"><li><code>if/else</code> supports only specific statements; unsupported ones hard-error</li> <li>Loops are limited; large loops warn at 256 iterations</li> <li>Some array/string ops are limited at runtime</li></ul> <h4>❌ Not supported</h4> <ul class="ss-list svelte-50qv65"><li>Full Pine standard library</li> <li>Generic <code>input()</code> (use <code>input.int/float/bool/string</code>, etc)</li> <li>Tick-level execution</li></ul> <h4>How to start</h4> <ul class="ss-list svelte-50qv65"><li>1) Begin with <code>//@pine</code> and <code>//@version=5</code></li> <li>2) Use <code>indicator()</code> or <code>strategy()</code></li> <li>3) Compute series (e.g., <code>ema</code>, <code>sma</code>, <code>rsi</code>)</li> <li>4) Add at least one <code>plot</code>/<code>plotshape</code>/<code>plotchar</code></li> <li>5) Add signals with <code>signal BUY/SELL/EXIT</code> if needed</li> <li>6) Add <code>strategy.entry/exit</code> for backtests</li></ul> <h4>Variables, series, and state</h4> <ul class="ss-list svelte-50qv65"><li>Declare: <code>x = expr</code>, update: <code>x := expr</code></li> <li><code>var</code> initializes once (state memory)</li> <li>Series values update per bar</li> <li>History: <code>close[1]</code>, <code>ema20[5]</code> (constant indexes are safest)</li> <li>Boolean literal: <code>true</code>/<code>false</code>; scientific notation: <code>1e-6</code></li></ul> <h4>Operators & expressions</h4> <ul class="ss-list svelte-50qv65"><li>Arithmetic: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code></li> <li>Comparison: <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code></li> <li>Logic: <code>and</code>, <code>or</code>, <code>not</code></li> <li>Ternary: <code>cond ? a : b</code> or <code>iff(cond, a, b)</code></li></ul> <h4>if/else rules (important)</h4> <ul class="ss-list svelte-50qv65"><li><code>if</code>/<code>else if</code>/<code>else</code> must have an indented body</li> <li>Commonly supported: assignments, plot/plotshape/plotchar, signal, strategy.*</li> <li>Unsupported statements hard-error: <code>Unsupported statement inside if</code></li> <li>No silent dropping inside if/else</li></ul> <h4>Indicators & functions (common)</h4> <ul class="ss-list svelte-50qv65"><li><code>ema</code>, <code>sma</code>, <code>rsi</code>, <code>atr(high, low, close, length)</code></li> <li><code>highest</code>/<code>lowest</code>, <code>crossover</code>/<code>crossunder</code></li> <li><code>barssince</code>, <code>change</code>, <code>mom</code>, <code>roc</code></li> <li><code>nz</code>, <code>iff</code> (utility)</li></ul> <h4>Signals (BUY/SELL/EXIT)</h4> <ul class="ss-list svelte-50qv65"><li>Syntax: <code>signal BUY when cond score=7 cooldown=5</code></li> <li>Aliases: <code>BUY → entry_long</code>, <code>SELL → exit_long</code>, <code>EXIT → exit_long</code></li> <li><code>score</code> must be integer 0-10; invalid values hard-error</li> <li><code>cooldown</code> is bar count (non-negative integer)</li></ul> <h4>Strategy & backtest rules</h4> <ul class="ss-list svelte-50qv65"><li><code>strategy.entry/order/close_all</code> requires <code>when=...</code></li> <li><code>strategy.exit/close</code> needs <code>when</code> or <code>stop/limit</code></li> <li>Stop/limit exits expand into OCO groups</li></ul> <h4>Input functions</h4> <ul class="ss-list svelte-50qv65"><li><code>input.int</code>, <code>input.float</code>, <code>input.bool</code>, <code>input.string</code></li> <li><code>input.time</code>, <code>input.session</code>, <code>input.source</code>, <code>input.symbol</code>, <code>input.color</code></li> <li>All inputs require a correct type for <code>defval</code></li></ul> <h4>Visuals & plots</h4> <ul class="ss-list svelte-50qv65"><li>Core plots: <code>plot</code>, <code>plotshape</code>, <code>plotchar</code>, <code>hline</code></li> <li>Draw objects: <code>line.new</code>, <code>label.new</code>, <code>box.new</code>, <code>linefill.new</code></li> <li><code>indicator(..., overlay=true)</code> sets default pane</li></ul> <h4>Common errors</h4> <ul class="ss-list svelte-50qv65"><li><code>Unsupported statement inside if: ...</code> - not allowed inside if</li> <li><code>strategy.entry(...) requires when=...</code> - add <code>when</code></li> <li><code>score must be an integer between 0 and 10</code> - use 0..10 int</li> <li><code>input.int() requires numeric defval</code> - fix defval type</li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">Pine-like - Quick EMA</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">Pine-like - Signal + Score</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">Pine-like - Strategy</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>Strategy Rules</h4> <ul class="ss-list svelte-50qv65"><li><code>strategy.entry/order/close_all</code> requires <code>when=...</code></li> <li><code>strategy.exit/close</code> needs <code>when</code> or <code>stop/limit</code></li></ul>',1),dK=fe('<h3 class="ss-section-title svelte-50qv65">DSL Documentation (Minimal)</h3> <p>DSL is a very small language for fast signals and labels. It is not for complex visuals or full backtests.</p> <h4>✅ What works in DSL</h4> <ul class="ss-list svelte-50qv65"><li>Assignment: <code>X = 10</code> (params) or <code>X = ema(close, 20)</code> (series)</li> <li>Signal: <code>signal BUY when ... score:7 cooldown:5</code></li> <li>Label: <code>label at top text:"BUY" color:#22c55e</code></li></ul> <h4>❌ What DSL does not have</h4> <ul class="ss-list svelte-50qv65"><li>Plots or advanced visuals</li> <li>Strategy config or risk settings</li> <li>Runtime loops/arrays</li></ul> <div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65">DSL - Signal + Label</div></div> <pre class="ss-code svelte-50qv65"><code></code></pre></div> <h4>DSL Tips</h4> <ul class="ss-list svelte-50qv65"><li><code>when</code> always uses the condition language</li> <li>Keep everything on one line; there are no blocks</li></ul>',1),uK=fe('<p class="ss-guide-intro svelte-50qv65">Script Studio has three script modes: JSON, Pine-like, and DSL. Choose a mode from the tabs below. Each mode has its own support list, limits, examples, and troubleshooting tips.</p> <div class="ss-tabs svelte-50qv65" role="tablist" aria-label="Documentation modes"><button role="tab">JSON</button> <button role="tab">Pine-like</button> <button role="tab">DSL</button></div> <!>',1),pK=fe('<section class="ss-section svelte-50qv65" role="tabpanel" id="ss-tabpanel-details" aria-labelledby="ss-tab-details"><div class="ss-details-head svelte-50qv65"><div class="ss-details-title svelte-50qv65">Documentation</div> <div class="ss-lang-toggle svelte-50qv65" aria-label="Language toggle"><button type="button">বাংলা</button> <button type="button">English</button></div></div> <!></section>'),vK=(n,e,t)=>e(s(t).code),fK=(n,e,t)=>e(s(t).code),mK=fe('<div class="ss-example svelte-50qv65"><div class="ss-example-head svelte-50qv65"><div class="ss-example-title svelte-50qv65"> </div> <div class="ss-example-actions svelte-50qv65"><button type="button" class="ss-copy svelte-50qv65">Copy</button><button type="button" class="ss-use svelte-50qv65">Use in editor</button></div></div> <pre class="ss-code svelte-50qv65"><code> </code></pre></div>'),gK=fe('<section class="ss-section svelte-50qv65" role="tabpanel" id="ss-tabpanel-examples" aria-labelledby="ss-tab-examples"><h3 class="ss-section-title svelte-50qv65">উদাহরণ স্ক্রিপ্ট</h3> <!></section>'),hK=fe('<div class="ss-guide-backdrop svelte-50qv65" role="dialog" aria-modal="true" aria-labelledby="ss-guide-title"><div class="ss-guide-modal svelte-50qv65"><div class="ss-guide-header svelte-50qv65"><h2 id="ss-guide-title" class="svelte-50qv65">Script Studio – Documentation</h2> <button class="ss-guide-close svelte-50qv65" type="button" aria-label="Close guide">&times;</button></div> <div class="ss-guide-body svelte-50qv65"><div class="ss-tabs svelte-50qv65" role="tablist" aria-label="Guide sections"><button id="ss-tab-details" role="tab" aria-controls="ss-tabpanel-details">Documentation</button> <button id="ss-tab-examples" role="tab" aria-controls="ss-tabpanel-examples">Examples</button></div> <!></div></div></div>');function _K(n,e){gd(e,!1);let t=Ws(e,"show",8,!1),o=Qd("details"),i=Qd("bn"),r=Qd("json");const a=mv();function l(){a("close")}function c(Y){return String(Y||"").replace(/\\r\\n/g,`
`).replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"')}function d(Y){a("insert",{code:c(Y)})}function p(Y){try{navigator.clipboard.writeText(c(Y))}catch{}}const m=[{title:"DSL · Fractal tops/bots",code:`WIN = 5
HIWIN = highest(close, WIN)
LOWIN = lowest(close, WIN)
signal top when (close == HIWIN)
signal bot when (close == LOWIN)
label at top text:"▲ fractal" color:#f97316
label at bot text:"▼ fractal" color:#3b82f6`},{title:"Strategy (JSON) · Engine v2 smoke test (partials + trailing + orders table)",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "orderSize": { "type": "percent_of_equity", "value": 25 },
    "commissionPct": 0.06,
    "slippagePct": 0.02,
    "execution": "intrabar_ohlc",
    "intrabarTieBreak": "worst_case",
    "pyramiding": 2,
    "stopLossPct": 1.2,
    "trailingStopPct": 0.8,
    "takeProfits": [
      { "takeProfitPct": 1.0, "qtyPct": 50 },
      { "takeProfitPct": 2.0, "qtyPct": 50 }
    ],
    "allowShort": false
  },
  "calc": [
    { "name": "ema50", "type": "ema", "source": "close", "period": 50 },
    { "name": "rsi14", "type": "rsi", "source": "close", "period": 14 }
  ],
  "plots": [
    { "name": "EMA 50", "source": "ema50", "color": "#22c55e", "width": 2 },
    { "name": "RSI", "source": "rsi14", "color": "#f59e0b", "width": 2, "pane": "sub" }
  ],
  "levels": [
    { "name": "RSI 70", "value": 70, "color": "#ef4444", "style": "dashed", "pane": "sub" },
    { "name": "RSI 50", "value": 50, "color": "#64748b", "style": "dotted", "pane": "sub" },
    { "name": "RSI 30", "value": 30, "color": "#22c55e", "style": "dashed", "pane": "sub" }
  ],
  "labels": [
    { "when": "rsi14 crossesAbove 50", "text": "BUY",  "shape": "triangle_up_filled",   "color": "#16a34a", "position": "below", "source": "low" },
    { "when": "rsi14 crossesBelow 50", "text": "EXIT", "shape": "triangle_down_filled", "color": "#f59e0b", "position": "above", "source": "high" }
  ],
  "signals": [
    { "id": "L", "type": "entry_long", "when": "rsi14 crossesAbove 50", "order": { "kind": "market", "qtyPct": 100 } },
    { "id": "X", "type": "exit_long",  "when": "rsi14 crossesBelow 50", "order": { "kind": "market", "qtyPct": 100 } }
  ]
}`},{title:"Pine (pro) · Periodic entries (mod20) + plotshape",code:`//@pine
//@version=5
strategy(initial_capital=10000, execution="bar_close", allowShort=false)

plot(close, title="Close", color="#60a5fa")

mod20 = bar_index % 20
enter = mod20 == 1
exit  = mod20 == 10

plotshape(enter, text="BUY", color=color.green, location=location.belowbar, style=shape.triangleup)
plotshape(exit,  text="EXIT", color=color.red,   location=location.abovebar, style=shape.triangledown)

strategy.entry("L", strategy.long, when=enter)
strategy.exit("X", side="long", when=exit, qty_percent=100)`},{title:"Pine (pro) · var/ := state (counter + history)",code:`//@pine
//@version=5
indicator("State demo", overlay=true)

// var = initialize once; := = update per bar
var float bars = 0
bars := bars + 1

// history access: x[1]
var float delta = na
delta := close - close[1]

plot(bars, title="Bars since start", color="#22c55e", width=2)
plot(delta, title="Close change", color="#3b82f6", width=1)

plotshape(delta > 0, text="UP", color=color.green, location=location.belowbar, style=shape.triangleup)
plotshape(delta < 0, text="DN", color=color.red,   location=location.abovebar, style=shape.triangledown)`},{title:"Pine (pro) · if/else + ternary + array (demo)",code:`//@pine
//@version=5
indicator("If/Else + Ternary + Array demo", overlay=true)

ema_len = input.int(20, title="EMA Len", minval=1)
atr_len = input.int(14, title="ATR Len", minval=1)

ema_base = ema(close, ema_len)
atr_val  = atr(high, low, close, atr_len)

trend_up = close > ema_base
trend_dn = close < ema_base

// ternary operator
bias = trend_up ? 1 : -1

// if/else-if series update
var float sig = na
if trend_up
    sig := ema_base + atr_val
else if trend_dn
    sig := ema_base - atr_val
else
    sig := ema_base

plot(ema_base, title="EMA Base", color="#22c55e", width=2)
plot(sig, title="IF/ELSE band", color="#f59e0b", width=2)

// array + for loop (compile-time) to draw multiple bands
levels = array.new_float(3, 0)
array.set(levels, 0, 0.5)
array.set(levels, 1, 1.0)
array.set(levels, 2, 1.5)

for i = 0 to 2
    plot(ema_base + atr_val * array.get(levels, i), title="Band i", color="#94a3b8", width=1, style="dotted")

plotchar(bias > 0, char="U", color=color.green, location=location.belowbar)
plotchar(bias < 0, char="D", color=color.red, location=location.abovebar)`},{title:"Pine (pro) · Runtime array.set + for loop (per-bar)",code:`//@pine
//@version=5
indicator("Runtime array demo", overlay=true)

ema_len = input.int(20, title="EMA Len", minval=1)
atr_len = input.int(14, title="ATR Len", minval=1)

ema_base = ema(close, ema_len)
atr_val  = atr(high, low, close, atr_len)

// runtime array: values update every bar via array.set
bands = array.new_float(3, 0)
array.set(bands, 0, ema_base - atr_val)
array.set(bands, 1, ema_base)
array.set(bands, 2, ema_base + atr_val)

plot(ema_base, title="EMA Base", color="#22c55e", width=2)

// loop unrolled at compile-time; array values are runtime
for i = 0 to 2
    plot(array.get(bands, i), title="Band", color="#94a3b8", width=1, style="dotted")`},{title:"Pine (pro) · Multiline function + barssince + math",code:`//@pine
//@version=5
indicator("Functions v2 demo", overlay=true)

len = input.int(20, title="Len", minval=2)
src = close

zscore(src, p) =>
    (src - sma(src, p)) / stdev(src, p)

z = zscore(src, len)
trend_up = z > 0
bars_up = ta.barssince(trend_up)

plot(z, title="Z-score", color="#60a5fa", width=2, pane="sub")
plot(bars_up, title="Bars since up", color="#f59e0b", width=2, pane="sub")

mag = math.pow(math.abs(z), 2)
plot(mag, title="Z^2", color="#22c55e", width=1, pane="sub")`},{title:"Pine (pro) · Built-ins (barstate/timeframe/syminfo/strategy)",code:`//@pine
//@version=5
strategy(initial_capital=10000, execution="bar_close", allowShort=false)

fast = ema(close, 20)
slow = ema(close, 50)

plot(fast, title="EMA 20", color="#22c55e", width=2)
plot(slow, title="EMA 50", color="#3b82f6", width=2, style="dashed")

long_cond = crossover(fast, slow)
exit_cond = crossunder(fast, slow)

strategy.entry("L", strategy.long, when=long_cond)
strategy.exit("X", side="long", when=exit_cond, qty_percent=100)

plotshape(barstate.islast, text="LAST", color=color.blue, location=location.abovebar, style=shape.labeldown)
plotchar(timeframe.isintraday, char="I", color=color.orange, location=location.belowbar)
plotchar(timeframe.period == "60", char="60", color=color.orange, location=location.belowbar)

// Replace "AAMRANET" with your chart symbol to see T marker.
plotchar(syminfo.ticker == "AAMRANET", char="T", color=color.green, location=location.abovebar)

plot(strategy.position_size, title="Pos", color="#60a5fa", width=2, pane="sub")
plot(strategy.opentrades, title="Open", color="#f59e0b", width=2, pane="sub")
plot(strategy.closedtrades, title="Closed", color="#22c55e", width=2, pane="sub")
plot(strategy.equity, title="Equity", color="#eab308", width=2, pane="sub")`},{title:"Pine (pro) · strategy.order + cancel + risk",code:`//@pine
//@version=5
strategy(initial_capital=10000, execution="bar_close", allowShort=false)

// Risk caps (percent of equity)
strategy.risk.max_drawdown(12)
strategy.risk.max_position_size(50, strategy.percent_of_equity)
strategy.risk.max_intraday_filled_orders(3)
strategy.risk.max_intraday_loss(2, strategy.percent_of_equity)

fast = ema(close, 10)
slow = ema(close, 21)

plot(fast, title="EMA Fast", color="#22c55e", width=2)
plot(slow, title="EMA Slow", color="#3b82f6", width=2, style="dashed")

long_cond = crossover(fast, slow)
exit_cond = crossunder(fast, slow)

limit_px = low * 0.995
strategy.order("L", strategy.long, qty_percent=100, limit=limit_px, when=long_cond)
strategy.cancel("L", when=exit_cond)
strategy.exit("X", side="long", when=exit_cond, qty_percent=100)`},{title:"Pine (pro) · Backtest date/session filter",code:`//@pine
//@version=5
strategy(initial_capital=10000, commissionPct=0.06, slippagePct=0.02, from="2023-01-01", to="2023-06-30", session="0930-1600", execution="bar_close", allowShort=false)

fast_len = input.int(20, title="EMA Fast", minval=1)
slow_len = input.int(50, title="EMA Slow", minval=2)

ema_fast = ema(close, fast_len)
ema_slow = ema(close, slow_len)

plot(ema_fast, title="EMA Fast", color="#22c55e", width=2)
plot(ema_slow, title="EMA Slow", color="#3b82f6", width=2, style="dashed")

long_cond = crossover(ema_fast, ema_slow)
exit_cond = crossunder(ema_fast, ema_slow)

strategy.entry("L", strategy.long, when=long_cond)
strategy.exit("X", side="long", when=exit_cond, qty_percent=100)`},{title:"Pine (pro) · Optimization grid (fast/slow)",code:`//@pine
//@version=5
strategy(initial_capital=10000, commissionPct=0.06, slippagePct=0.02, execution="bar_close", allowShort=false)

fast_len = input.int(10, title="Fast", minval=5, maxval=30, step=5)
slow_len = input.int(40, title="Slow", minval=20, maxval=80, step=10)

ema_fast = ema(close, fast_len)
ema_slow = ema(close, slow_len)

plot(ema_fast, title="EMA Fast", color="#22c55e", width=2)
plot(ema_slow, title="EMA Slow", color="#3b82f6", width=2, style="dashed")

long_cond = crossover(ema_fast, ema_slow)
exit_cond = crossunder(ema_fast, ema_slow)

strategy.entry("L", strategy.long, when=long_cond)
strategy.exit("X", side="long", when=exit_cond, qty_percent=100)`},{title:"Pine (pro) · Dynamic draw (line/label/box/table)",code:`//@pine
//@version=5
indicator("Dynamic draw demo", overlay=true)

fast = ema(close, 20)
slow = ema(close, 50)

plot(fast, title="EMA 20", color="#22c55e", width=2)
plot(slow, title="EMA 50", color="#3b82f6", width=2, style="dashed")

// label.new on cross
if crossover(fast, slow)
    label.new(bar_index, low, "BUY", color=color.green, textcolor=color.white, style=label.style_label_up)

// line.new + box.new on last bar only
if barstate.islast
    line.new(bar_index - 20, fast[20], bar_index, fast, color="#f59e0b", width=2, style=line.style_dashed, extend=extend.right)
    box.new(bar_index - 10, high, bar_index, low, bgcolor="#1e293b", border_color="#3b82f6")

// table.new + table.cell on last bar
var table t = table.new(position.top_right, 2, 3)
if barstate.islast
    table.cell(t, 0, 0, "Fast")
    table.cell(t, 1, 0, fast)
    table.cell(t, 0, 1, "Slow")
    table.cell(t, 1, 1, slow)
    table.cell(t, 0, 2, "Trend")
    table.cell(t, 1, 2, fast > slow ? 1 : -1)`},{title:"Pine (pro) · linefill + table merge/clear + tooltips",code:`//@pine
//@version=5
indicator("Linefill + table merge", overlay=true)

fast = ema(close, 20)
slow = ema(close, 50)

plot(fast, title="EMA 20", color="#22c55e", width=2)
plot(slow, title="EMA 50", color="#3b82f6", width=2, style="dashed")

// Two dynamic lines to fill between
var line l1 = line.new(bar_index - 20, fast[20], bar_index, fast, color="#22c55e", width=1, style=line.style_dotted, extend=extend.right)
var line l2 = line.new(bar_index - 20, slow[20], bar_index, slow, color="#3b82f6", width=1, style=line.style_dotted, extend=extend.right)
line.set_xy1(l1, bar_index - 20, fast[20])
line.set_xy2(l1, bar_index, fast)
line.set_xy1(l2, bar_index - 20, slow[20])
line.set_xy2(l2, bar_index, slow)
var linefill f = linefill.new(l1, l2, color="rgba(59,130,246,0.18)")

// Table with merged header + tooltip
var table t = table.new(position.top_right, 3, 3, frame_color="#334155", border_color="#475569", text_color="#e2e8f0")
if barstate.islast
    table.clear(t, 0, 0, 2, 2)
    table.merge_cells(t, 0, 0, 2, 0)
    table.cell(t, 0, 0, "EMA Dashboard", text_halign=text.align_center, bgcolor="rgba(15,23,42,0.8)")
    table.cell(t, 0, 1, "Fast", tooltip="EMA 20 value")
    table.cell(t, 1, 1, fast)
    table.cell(t, 0, 2, "Slow", tooltip="EMA 50 value")
    table.cell(t, 1, 2, slow)`},{title:"Pine (pro) · Draw update/delete (set + delete)",code:`//@pine
//@version=5
indicator("Draw update/delete demo", overlay=true)

fast = ema(close, 20)
slow = ema(close, 50)

plot(fast, title="EMA 20", color="#22c55e", width=2)
plot(slow, title="EMA 50", color="#3b82f6", width=2, style="dashed")

// Update a single trend line every bar
var line trend = line.new(bar_index - 20, fast[20], bar_index, fast, color=color.orange, width=2, style=line.style_dashed)
line.set_xy1(trend, bar_index - 20, fast[20])
line.set_xy2(trend, bar_index, fast)
if fast > slow
    line.set_color(trend, color.green)
else
    line.set_color(trend, color.red)

// Update a rolling 10-bar box
hh = highest(high, 10)
ll = lowest(low, 10)
var box zone = box.new(bar_index - 10, hh, bar_index, ll, bgcolor="rgba(59,130,246,0.12)", border_color="#3b82f6")
box.set_left(zone, bar_index - 10)
box.set_right(zone, bar_index)
box.set_top(zone, hh)
box.set_bottom(zone, ll)

// Delete previous label, then create a new one (keeps only 1 label)
var label last = label.new(bar_index, low, "LAST", color=color.blue, textcolor=color.white, style=label.style_label_up)
label.delete(last)
last := label.new(bar_index, low, "LAST", color=color.blue, textcolor=color.white, style=label.style_label_up)
if fast > slow
    label.set_text(last, "UP")
else
    label.set_text(last, "DOWN")

// Update a small table on the last bar
var table t = table.new(position.top_right, 2, 2)
if barstate.islast
    table.cell(t, 0, 0, "Fast")
    table.cell(t, 1, 0, fast)
    table.cell(t, 0, 1, "Slow")
    table.cell(t, 1, 1, slow)`},{title:"Pine (pro) · Draw text align + yloc + table sizing",code:`//@pine
//@version=5
indicator("Draw extras", overlay=true)

fast = ema(close, 20)
slow = ema(close, 50)

plot(fast, title="EMA 20", color="#22c55e", width=2)
plot(slow, title="EMA 50", color="#3b82f6", width=2, style="dashed")

// yloc + textalign demo (single bar)
if barstate.islast
    label.new(bar_index, na, "ABOVE", yloc=yloc.abovebar, textalign=text.align_left, color=color.green, textcolor=color.white, style=label.style_label_up)
    label.new(bar_index, na, "BELOW", yloc=yloc.belowbar, textalign=text.align_right, color=color.red, textcolor=color.white, style=label.style_label_down)

// box text + border style
hh = highest(high, 8)
ll = lowest(low, 8)
var box zone = box.new(bar_index - 8, hh, bar_index, ll, bgcolor="rgba(59,130,246,0.12)", border_color="#3b82f6", border_style=line.style_dotted, text="ZONE", text_color="#e2e8f0", text_size=size.small, text_halign=text.align_center, text_valign=text.align_middle, text_wrap=true)
box.set_left(zone, bar_index - 8)
box.set_right(zone, bar_index)
box.set_top(zone, hh)
box.set_bottom(zone, ll)

// table sizing + align
var table t = table.new(position.top_right, 2, 2, frame_color="#334155", border_color="#475569", text_color="#e2e8f0", text_size=size.small, text_halign=text.align_left, text_valign=text.align_middle)
if barstate.islast
    table.cell(t, 0, 0, "Fast", text_halign=text.align_left, width=90)
    table.cell(t, 1, 0, fast, text_halign=text.align_right, width=70)
    table.cell(t, 0, 1, "Slow", text_halign=text.align_left, width=90)
    table.cell(t, 1, 1, slow, text_halign=text.align_right, width=70)`},{title:"Pine (pro) · Broker realism (tick/step/minQty) + SL/TP bracket",code:`//@pine
//@version=5
// Broker realism fields (optional):
// - priceTick: minimum price increment (e.g. 0.01)
// - qtyStep: quantity step (e.g. 1 for stocks)
// - minQty: minimum tradable quantity
// Edit these to match your market.
strategy(initial_capital=10000, commissionPct=0.06, slippagePct=0.02, pyramiding=1, execution="intrabar_ohlc", intrabarTieBreak="worst_case", allowShort=false, priceTick=0.01, qtyStep=1, minQty=1)

ema_fast_len = input.int(20, title="EMA Fast", minval=1)
ema_slow_len = input.int(50, title="EMA Slow", minval=2)
sl_pct = input.float(1.2, title="Stop %", minval=0.1, step=0.1)
tp_pct = input.float(2.4, title="TP %",   minval=0.1, step=0.1)

ema_fast = ema(close, ema_fast_len)
ema_slow = ema(close, ema_slow_len)

plot(ema_fast, title="EMA Fast", color="#22c55e", width=2)
plot(ema_slow, title="EMA Slow", color="#3b82f6", width=2, style="dashed")

long_cond = crossover(ema_fast, ema_slow)
exit_cond = crossunder(ema_fast, ema_slow)

plotshape(long_cond, text="BUY",  color=color.green,  location=location.belowbar, style=shape.triangleup)
plotshape(exit_cond, text="EXIT", color=color.orange, location=location.abovebar, style=shape.triangledown)

entry_px = close
sl_px = entry_px * (1 - sl_pct/100)
tp_px = entry_px * (1 + tp_pct/100)

plot(sl_px, title="SL", color="rgba(239,68,68,0.55)", width=1, style="dotted")
plot(tp_px, title="TP", color="rgba(34,197,94,0.55)", width=1, style="dotted")

strategy.entry("L", strategy.long, when=long_cond)
// This expands into stop + limit exits with OCO.
strategy.exit("BRKT", side="long", when=exit_cond, stop=sl_px, limit=tp_px, qty_percent=100)`},{title:"Pine (pro) · Broker realism v2 (spread/leverage/liquidation + FIFO/LIFO/AVG)",code:`//@pine
//@version=5
// Broker realism v2 fields (optional):
// - spreadPct: bid/ask spread in percent (0.05 = 0.05%)
// - leverage: position leverage (>= 1)
// - maintenanceMarginPct: liquidation if equity <= notional * maintenance%
// - liquidationFeePct: extra fee charged on liquidation exits
// - borrowPctPerYear: short borrow cost (annual %)
// - fundingPctPerDay: funding/interest cost (daily %)
// - positionMode: "netting" (default) or "hedging"
// - closeMethod: "fifo" (default), "lifo", or "avg" (average-cost)
strategy(initial_capital=10000, commissionPct=0.06, slippagePct=0.02, spreadPct=0.05, leverage=5, maintenanceMarginPct=1.0, liquidationFeePct=0.2, borrowPctPerYear=6, fundingPctPerDay=0.01, positionMode="netting", closeMethod="fifo", pyramiding=1, execution="intrabar_ohlc", intrabarTieBreak="worst_case", allowShort=true)

fast_len = input.int(20, title="EMA Fast", minval=1)
slow_len = input.int(50, title="EMA Slow", minval=2)
atr_len  = input.int(14, title="ATR", minval=2)
sl_atr   = input.float(2.0, title="SL = ATR x",  minval=0.1, step=0.1)
tp_atr   = input.float(3.0, title="TP = ATR x",  minval=0.1, step=0.1)

ema_fast = ema(close, fast_len)
ema_slow = ema(close, slow_len)
atr_val  = atr(high, low, close, atr_len)

plot(ema_fast, title="EMA Fast", color="#22c55e", width=2)
plot(ema_slow, title="EMA Slow", color="#3b82f6", width=2, style="dashed")

long_cond  = crossover(ema_fast, ema_slow)
short_cond = crossunder(ema_fast, ema_slow)

plotshape(long_cond,  text="BUY",  color=color.green, location=location.belowbar, style=shape.triangleup)
plotshape(short_cond, text="SELL", color=color.red,   location=location.abovebar, style=shape.triangledown)

sl_long = close - (atr_val * sl_atr)
tp_long = close + (atr_val * tp_atr)
sl_short = close + (atr_val * sl_atr)
tp_short = close - (atr_val * tp_atr)

strategy.entry("L", strategy.long,  when=long_cond)
strategy.entry("S", strategy.short, when=short_cond)

// Intrabar exits (gap + best/worst case controlled by intrabarTieBreak)
strategy.exit("XL", side="long",  stop=sl_long,  limit=tp_long,  qty_percent=100)
strategy.exit("XS", side="short", stop=sl_short, limit=tp_short, qty_percent=100)`},{title:"Pine (pro) · request.security (HTF EMA filter) + BUY/SELL",code:`//@pine
//@version=5
// Shows both BUY (long) and SELL (short) entries.
strategy(initial_capital=10000, commissionPct=0.06, slippagePct=0.02, pyramiding=1, execution="bar_close", allowShort=true)

fast_len = input.int(20, title="EMA Fast", minval=1)
slow_len = input.int(50, title="EMA Slow", minval=2)
htf_tf   = input.string("240", title="HTF (minutes)")

ema_fast = ema(close, fast_len)
ema_slow = ema(close, slow_len)

// Higher-timeframe EMA (same symbol). lookahead_off = updates only after HTF bar closes.
ema_htf = request.security(syminfo.tickerid, htf_tf, ema(close, 50), lookahead=barmerge.lookahead_off, gaps=barmerge.gaps_off)

plot(ema_fast, title="EMA Fast", color="#22c55e", width=2)
plot(ema_slow, title="EMA Slow", color="#3b82f6", width=2, style="dashed")
plot(ema_htf,  title="HTF EMA 50", color="#a78bfa", width=2)

long_cond  = crossover(ema_fast, ema_slow) and (close > ema_htf)
short_cond = crossunder(ema_fast, ema_slow) and (close < ema_htf)

exit_long  = crossunder(ema_fast, ema_slow)
exit_short = crossover(ema_fast, ema_slow)

plotshape(long_cond,  text="BUY",  color=color.green, location=location.belowbar, style=shape.triangleup)
plotshape(short_cond, text="SELL", color=color.red,   location=location.abovebar, style=shape.triangledown)

strategy.entry("L", strategy.long,  when=long_cond)
strategy.entry("S", strategy.short, when=short_cond)

strategy.exit("XL", side="long",  when=exit_long,  qty_percent=100)
strategy.exit("XS", side="short", when=exit_short, qty_percent=100)`},{title:"Pine (pro) · request.security (multi-symbol spread) · Z-score (more trades)",code:`//@pine
//@version=5
// Multi-symbol request.security demo.
// IMPORTANT: chart symbol (A) and sym_b (B) should be DIFFERENT.
// If A == B, spread ~ 0 and trades can be 0.
// Optional country: "TICKER@US" or country="US".
// Tip: if sub pane looks blank, reduce lookbk (e.g. 10).

strategy(initial_capital=10000, commissionPct=0.06, slippagePct=0.02, pyramiding=1, execution="bar_close", allowShort=false)

sym_b   = input.string("AAMRANET", title="Symbol B (ticker OR name)")
htf_tf  = input.string("240", title="HTF (minutes)")
lookbk  = input.int(20, title="Z lookback", minval=5)

close_a = request.security(syminfo.tickerid, htf_tf, close, lookahead=barmerge.lookahead_off)
close_b = request.security(sym_b,            htf_tf, close, lookahead=barmerge.lookahead_off)

// Debug marker: shows "B" only when symbol B has valid data (needs Labels ON)
b_ok = close_b > 0
plotchar(b_ok, char="B", color="#a78bfa", location=location.abovebar, price=close, size=size.small)

spread = close_a - close_b
mu = sma(spread, lookbk)
sd = stdev(spread, lookbk)

// Z-score normalizes spread (so DSEX vs AAMRANET still works visually)
z = (spread - mu) / sd

// Put plots in sub pane so you can see them clearly
plot(z, title="Z-score (A-B)", color="#60a5fa", width=2, pane="sub")
hline(0, title="Zero", color="#64748b", pane="sub")

long_cond = crossover(z, 0)
exit_cond = crossunder(z, 0)

plotshape(long_cond, text="BUY",  color=color.green, location=location.belowbar, style=shape.triangleup)
plotshape(exit_cond, text="SELL", color=color.red,   location=location.abovebar, style=shape.triangledown)

strategy.entry("L", strategy.long, when=long_cond)
strategy.exit("X", side="long", when=exit_cond, qty_percent=100)`},{title:"Pine (pro) · Trend+RSI filter + ATR bracket (partial TP + SL)",code:`//@pine
//@version=5
strategy(initial_capital=10000, commissionPct=0.06, slippagePct=0.02, pyramiding=1, execution="intrabar_ohlc", intrabarTieBreak="worst_case", allowShort=false)

ema_fast_len  = input.int(21,  title="EMA Fast",  minval=1)
ema_slow_len  = input.int(55,  title="EMA Slow",  minval=2)
ema_trend_len = input.int(200, title="EMA Trend", minval=10)

rsi_len = input.int(14,  title="RSI Length", minval=2)
rsi_min = input.float(52, title="RSI Min", minval=1, maxval=99, step=0.5)

atr_len  = input.int(14,  title="ATR Length", minval=2)
sl_atr   = input.float(2.0, title="SL = ATR x",  minval=0.1, step=0.1)
tp1_atr  = input.float(1.5, title="TP1 = ATR x", minval=0.1, step=0.1)
tp2_atr  = input.float(3.0, title="TP2 = ATR x", minval=0.1, step=0.1)

ema_fast  = ema(close, ema_fast_len)
ema_slow  = ema(close, ema_slow_len)
ema_trend = ema(close, ema_trend_len)

rsi_val = rsi(close, rsi_len)
atr_val = atr(high, low, close, atr_len)

plot(ema_fast,  title="EMA Fast",  color="#22c55e", width=2)
plot(ema_slow,  title="EMA Slow",  color="#3b82f6", width=2, style="dashed")
plot(ema_trend, title="EMA Trend", color="#94a3b8", width=2)

plot(rsi_val, title="RSI", color="#f59e0b", width=2, pane="sub")
hline(70, title="OB",  color="#ef4444", pane="sub")
hline(50, title="MID", color="#64748b", pane="sub")
hline(30, title="OS",  color="#22c55e", pane="sub")

long_cond = (close > ema_trend) and crossover(ema_fast, ema_slow) and (rsi_val > rsi_min)
exit_cond = crossunder(ema_fast, ema_slow)

plotshape(long_cond, text="BUY",  color=color.green,  location=location.belowbar, style=shape.triangleup)
plotshape(exit_cond, text="EXIT", color=color.orange, location=location.abovebar, style=shape.triangledown)

entry_px = close
sl_px  = entry_px - (atr_val * sl_atr)
tp1_px = entry_px + (atr_val * tp1_atr)
tp2_px = entry_px + (atr_val * tp2_atr)

strategy.entry("L", strategy.long, when=long_cond)
strategy.exit("TP1", side="long", limit=tp1_px, qty_percent=50)
strategy.exit("BRKT", side="long", stop=sl_px, limit=tp2_px, qty_percent=100)
strategy.exit("X", side="long", when=exit_cond, qty_percent=100)`},{title:"Pine (pro) · plotchar + close_all (sub pane anchored)",code:`//@pine
//@version=5
strategy(initial_capital=10000, commissionPct=0.06, slippagePct=0.02, pyramiding=1, execution="bar_close", allowShort=false)

len = input.int(14, title="RSI Length", minval=2)
rsi_val = rsi(close, len)

plot(rsi_val, title="RSI", color="#f59e0b", width=2, pane="sub")
hline(70, title="OB", color="#ef4444", pane="sub")
hline(50, title="MID", color="#64748b", pane="sub")
hline(30, title="OS", color="#22c55e", pane="sub")

go_long = crossover(rsi_val, 50)
close_all = crossunder(rsi_val, 50)

// price=rsi_val anchors labels to RSI series (so sub pane never looks blank)
plotchar(go_long,   char="L", color="#22c55e", location=location.belowbar, pane="sub", price=rsi_val, size=size.large)
plotchar(close_all, char="X", color="#f59e0b", location=location.abovebar, pane="sub", price=rsi_val, size=size.large)

strategy.entry("L", strategy.long, when=go_long)
strategy.close_all(when=close_all)`},{title:"Simple · EMA 20 (main)",code:`{
  "pane": "main",
  "calc": [
    { "name": "ema20", "type": "ema", "source": "close", "period": 20 }
  ],
  "plots": [
    { "name": "EMA 20", "source": "ema20", "color": "#3b82f6", "width": 2 }
  ]
}`},{title:"Simple · Stochastic (sub)",code:`{
  "pane": "sub",
  "min": 0,
  "max": 100,
  "calc": [
    { "name": "stoch", "type": "stoch", "kPeriod": 14, "dPeriod": 3 }
  ],
  "plots": [
    { "name": "%K", "source": "stoch_k", "color": "#1E90FF", "width": 2 },
    { "name": "%D", "source": "stoch_d", "color": "#FF1493", "width": 2, "style": "dashed" }
  ]
}`},{title:"EMA 20/50 cross labels",code:`{
  "pane": "main",
  "calc": [
    { "name": "ema20", "type": "ema", "source": "close", "period": 20 },
    { "name": "ema50", "type": "ema", "source": "close", "period": 50 }
  ],
  "plots": [
    { "name": "EMA 20", "source": "ema20", "color": "#22c55e", "width": 2 },
    { "name": "EMA 50", "source": "ema50", "color": "#3b82f6", "width": 2, "style": "dashed" }
  ],
  "labels": [
    { "when": "ema20 crossesAbove ema50", "text": "BUY",  "color": "#16a34a", "position": "below", "source": "low",  "shape": "triangle_up_filled" },
    { "when": "ema20 crossesBelow ema50", "text": "SELL", "color": "#ef4444", "position": "above", "source": "high", "shape": "triangle_down_filled" }
  ]
}`},{title:"Drawing · Fibonacci + trendline (script)",code:`{
  "pane": "main",
  "overlays": [
    {
      "name": "fibonacciSegment",
      "points": [
        { "index": -120, "source": "low" },
        { "index": -20,  "source": "high" }
      ],
      "extendData": {
        "fibonacciLevels": [
          { "value": 0,     "color": "#64748b", "label": "0" },
          { "value": 0.382, "color": "#60a5fa", "label": "0.382" },
          { "value": 0.5,   "color": "#22c55e", "label": "0.5" },
          { "value": 0.618, "color": "#f59e0b", "label": "0.618" },
          { "value": 1,     "color": "#64748b", "label": "1" }
        ]
      }
    },
    {
      "name": "horizontalRayLine",
      "points": [
        { "index": -20, "source": "close" }
      ]
    },
    {
      "name": "note",
      "points": [
        { "index": -20, "source": "close" }
      ],
      "extendData": {
        "in_text": "SCRIPT NOTE",
        "in_color": "#22c55e",
        "line_color": "#22c55e"
      }
    }
  ]
}`},{title:"Strategy · Orders (market entry + partial exits)",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "orderSize": { "type": "percent_of_equity", "value": 100 },
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "execution": "intrabar_ohlc",
    "intrabarTieBreak": "worst_case",
    "pyramiding": 2,
    "allowShort": false
  },
  "calc": [
    { "name": "ema20", "type": "ema", "source": "close", "period": 20 },
    { "name": "ema50", "type": "ema", "source": "close", "period": 50 },
    { "name": "rsi14", "type": "rsi", "source": "close", "period": 14 }
  ],
  "plots": [
    { "name": "EMA 20", "source": "ema20", "color": "#22c55e", "width": 2 },
    { "name": "EMA 50", "source": "ema50", "color": "#60a5fa", "width": 2, "style": "dashed" }
  ],
  "labels": [
    { "when": "ema20 crossesAbove ema50", "text": "BUY",  "shape": "triangle_up_filled",   "color": "#16a34a", "position": "below", "source": "low" },
    { "when": "rsi14 crossesAbove 70",    "text": "TP 50%", "shape": "pill",               "color": "#16a34a", "position": "above", "source": "high" },
    { "when": "ema20 crossesBelow ema50", "text": "EXIT", "shape": "triangle_down_filled", "color": "#f59e0b", "position": "above", "source": "high" }
  ],
  "signals": [
    {
      "id": "ENTRY",
      "type": "entry_long",
      "when": "ema20 crossesAbove ema50",
      "order": { "kind": "market", "qtyPct": 100 }
    },
    {
      "id": "TP_PART",
      "type": "exit_long",
      "when": "rsi14 crossesAbove 70",
      "order": { "kind": "market", "qtyPct": 50 }
    },
    {
      "id": "EXIT_FULL",
      "type": "exit_long",
      "when": "(ema20 crossesBelow ema50) or (rsi14 crossesBelow 50)",
      "order": { "kind": "market", "qtyPct": 100 }
    }
  ]
}`},{title:"Strategy · Stop‑Limit entry (expiresBars)",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "orderSize": { "type": "percent_of_equity", "value": 100 },
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "execution": "intrabar_ohlc",
    "intrabarTieBreak": "worst_case",
    "pyramiding": 1,
    "stopLossPct": 2,
    "takeProfitPct": 4,
    "allowShort": false
  },
  "calc": [
    { "name": "dc",    "type": "donchian", "period": 20 },
    { "name": "atr14", "type": "atr", "period": 14 }
  ],
  "series": [
    { "name": "entry_stop",  "expr": "dc_upper" },
    { "name": "entry_limit", "expr": "add(dc_upper, mul(atr14, 0.05))" }
  ],
  "plots": [
    { "name": "DC Upper", "source": "dc_upper", "color": "#22c55e", "width": 1, "style": "dashed" },
    { "name": "DC Lower", "source": "dc_lower", "color": "#ef4444", "width": 1, "style": "dashed" }
  ],
  "signals": [
    {
      "id": "BRK",
      "type": "entry_long",
      "when": "close crossesAbove dc_upper",
      "order": {
        "kind": "stop_limit",
        "stopPrice": "entry_stop",
        "limitPrice": "entry_limit",
        "expiresBars": 20
      }
    }
  ]
}`},{title:"Strategy · Smoke test (guaranteed trades)",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "orderSize": { "type": "percent_of_equity", "value": 100 },
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "execution": "bar_close",
    "pyramiding": 1,
    "allowShort": false
  },
  "signals": [
    {
      "id": "ONE",
      "type": "entry_long",
      "when": "close > 0",
      "cooldownBars": 999999,
      "order": { "kind": "market", "qtyPct": 100 }
    }
  ]
}`},{title:"Strategy · Auto Fibonacci (pivot swing) 50% → 100%",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "orderSize": { "type": "percent_of_equity", "value": 100 },
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "execution": "intrabar_ohlc",
    "intrabarTieBreak": "worst_case",
    "stopLossPct": 2,
    "takeProfitPct": 4,
    "allowShort": false
  },
  "calc": [
    {
      "name": "fibo",
      "type": "auto_fib",
      "method": "pivots",
      "pivotLeft": 3,
      "pivotRight": 3,
      "lookback": 400,
      "direction": "up",
      "draw": true
    }
  ],
  "plots": [
    { "name": "Fibo 50",  "source": "fibo_50",  "color": "rgba(34,197,94,0.9)", "width": 1, "style": "dotted" },
    { "name": "Fibo 100", "source": "fibo_100", "color": "rgba(148,163,184,0.9)", "width": 1, "style": "dashed" }
  ],
  "labels": [
    { "when": "between(fibo_50, low, high)",  "text": "BUY",  "color": "#16a34a", "position": "below", "source": "low",  "shape": "triangle_up_filled" },
    { "when": "between(fibo_100, low, high)", "text": "EXIT", "color": "#f59e0b", "position": "above", "source": "high", "shape": "triangle_down_filled" }
  ],
  "signals": [
    { "type": "entry_long", "when": "between(fibo_50, low, high)" },
    { "type": "exit_long",  "when": "between(fibo_100, low, high)" }
  ]
}`},{title:"Strategy · EMA cross backtest (SL/TP)",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "orderSize": { "type": "percent_of_equity", "value": 100 },
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "stopLossPct": 1.5,
    "takeProfitPct": 3,
    "trailingStopPct": 1,
    "allowShort": false
  },
  "calc": [
    { "name": "ema_fast", "type": "ema", "source": "close", "period": 20 },
    { "name": "ema_slow", "type": "ema", "source": "close", "period": 50 }
  ],
  "plots": [
    { "name": "EMA 20", "source": "ema_fast", "color": "#22c55e", "width": 2 },
    { "name": "EMA 50", "source": "ema_slow", "color": "#3b82f6", "width": 2, "style": "dashed" }
  ],
  "labels": [
    { "when": "ema_fast crossesAbove ema_slow", "text": "BUY",  "color": "#16a34a", "position": "below", "source": "low",  "shape": "triangle_up_filled" },
    { "when": "ema_fast crossesBelow ema_slow", "text": "EXIT", "color": "#f59e0b", "position": "above", "source": "high", "shape": "triangle_down_filled" }
  ],
  "signals": [
    { "type": "entry_long", "when": "ema_fast crossesAbove ema_slow" },
    { "type": "exit_long",  "when": "ema_fast crossesBelow ema_slow" }
  ]
}`},{title:"RSI signals + backtest (sub)",code:`{
  "pane": "sub",
  "strategy": {
    "initialCapital": 10000,
    "commissionPct": 0.1,
    "slippagePct": 0.02
  },
  "min": 0,
  "max": 100,
  "calc": [
    { "name": "rsi14", "type": "rsi", "source": "close", "period": 14 }
  ],
  "plots": [
    { "name": "RSI", "source": "rsi14", "color": "#60a5fa", "width": 2 }
  ],
  "levels": [
    { "name": "30", "value": 30, "color": "#64748b", "style": "dotted" },
    { "name": "50", "value": 50, "color": "#94a3b8" },
    { "name": "70", "value": 70, "color": "#64748b", "style": "dotted" }
  ],
  "labels": [
    { "when": "rsi14 crossesAbove 50", "text": "BUY",  "color": "#16a34a", "position": "above", "source": "rsi14", "shape": "pill", "textPadding": 10 },
    { "when": "rsi14 crossesBelow 50", "text": "SELL", "color": "#ef4444", "position": "below", "source": "rsi14", "shape": "pill", "textPadding": 10 }
  ],
  "signals": [
    { "type": "entry_long",  "when": "rsi14 crossesAbove 50" },
    { "type": "entry_short", "when": "rsi14 crossesBelow 50" }
  ]
}`},{title:"Bollinger basis glow",code:`{
  "pane": "main",
  "calc": [
    { "name": "bb", "type": "bbands", "source": "close", "period": 20, "std": 2 }
  ],
  "plots": [
    { "name": "BB Glow", "source": "bb_mid", "type": "neon_line", "color": "rgba(0,255,255,0.35)", "width": 8 },
    { "name": "BB Core", "source": "bb_mid", "type": "line", "color": "#00ffff", "width": 2 }
  ]
}`},{title:"Full Bollinger with fill",code:`{
  "pane": "main",
  "calc": [
    { "name": "bb", "type": "bbands", "source": "close", "period": 20, "std": 2 }
  ],
  "plots": [
    { "name": "Upper", "source": "bb_upper", "type": "line", "color": "#00ffff", "width": 1, "style": "dashed" },
    { "name": "Lower", "source": "bb_lower", "type": "line", "color": "#00ffff", "width": 1, "style": "dashed" },
    { "name": "Mid Glow", "source": "bb_mid", "type": "neon_line", "color": "rgba(0,255,255,0.30)", "width": 8 },
    { "name": "Mid", "source": "bb_mid", "type": "line", "color": "#00ffff", "width": 2 }
  ],
  "fills": [
    { "between": ["bb_upper", "bb_lower"], "color": "rgba(0,255,255,0.10)" }
  ]
}`},{title:"Shape · tags at swing",code:`{
  "pane": "main",
  "calc": [
    { "name": "ph", "type": "pivot_high", "left": 3, "right": 3 },
    { "name": "pl", "type": "pivot_low",  "left": 3, "right": 3 }
  ],
  "labels": [
    { "when": "swinghigh(3)", "text": "▲ HH", "color": "#ef4444", "position": "above", "source": "ph", "shape": "tag" },
    { "when": "swinglow(3)",  "text": "▼ LL", "color": "#22c55e", "position": "below", "source": "pl", "shape": "tag" }
  ]
}`},{title:"Box shape · engulfing",code:`{
  "pane": "main",
  "series": [
    { "name": "prevOpen",  "expr": "lag(open, 1)" },
    { "name": "prevClose", "expr": "lag(close, 1)" }
  ],
  "labels": [
    { "when": "(close>open) and (prevClose<prevOpen) and (close>=prevOpen) and (open<=prevClose)", "shape": "box", "boxMode": "wick", "bgColor": "rgba(59,130,246,0.25)", "borderColor": "#3b82f6", "text": "Bullish Engulfing", "position": "below", "source": "low",  "size": 2, "offsetY": 12 },
    { "when": "(close<open) and (prevClose>prevOpen) and (close<=prevOpen) and (open>=prevClose)", "shape": "box", "boxMode": "wick", "bgColor": "rgba(59,130,246,0.25)", "borderColor": "#3b82f6", "text": "Bearish Engulfing", "position": "above", "source": "high", "size": 2, "offsetY": 12 }
  ]
}`},{title:"Trendlines · auto",code:`{
  "pane": "main",
  "calc": [
    { "name": "ph", "type": "pivot_high", "left": 3, "right": 3 },
    { "name": "pl", "type": "pivot_low",  "left": 3, "right": 3 },
    { "name": "ph_prev", "type": "prev_value", "source": "ph" },
    { "name": "pl_prev", "type": "prev_value", "source": "pl" }
  ],
  "plots": [
    { "name": "PH", "source": "ph", "type": "dots", "color": "#ef4444", "width": 2 },
    { "name": "PL", "source": "pl", "type": "dots", "color": "#22c55e", "width": 2 }
  ],
  "lines": [
    { "name": "Down TL", "segmentsFrom": "ph", "color": "#64748b", "width": 1, "style": "dotted", "extend": "right", "maxSegments": 50 },
    { "name": "Up TL",   "segmentsFrom": "pl", "color": "#64748b", "width": 1, "style": "dotted", "extend": "right", "maxSegments": 50 }
  ],
  "labels": [
    { "when": "swinghigh(3)", "text": "▲ HH", "color": "#ef4444", "position": "above", "source": "ph", "shape": "tag" },
    { "when": "swinglow(3)",  "text": "▼ LL", "color": "#22c55e", "position": "below", "source": "pl", "shape": "tag" }
  ]
}`},{title:"Advanced · EMA200 pullback (backtest)",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "stopLossPct": 2,
    "takeProfitPct": 4,
    "trailingStopPct": 1.2,
    "allowShort": false
  },
  "calc": [
    { "name": "ema200", "type": "ema", "source": "close", "period": 200 },
    { "name": "ema20",  "type": "ema", "source": "close", "period": 20 },
    { "name": "rsi14",  "type": "rsi", "source": "close", "period": 14 }
  ],
  "plots": [
    { "name": "EMA 200", "source": "ema200", "color": "#94a3b8", "width": 2 },
    { "name": "EMA 20",  "source": "ema20",  "color": "#22c55e", "width": 2 }
  ],
  "labels": [
    { "when": "(close > ema200) and (rsi14 crossesAbove 35)", "text": "LONG", "color": "#16a34a", "position": "below", "source": "low", "shape": "triangle_up_filled" },
    { "when": "(rsi14 crossesAbove 55) or (close crossesBelow ema20)", "text": "EXIT", "color": "#f59e0b", "position": "above", "source": "high", "shape": "triangle_down_filled" }
  ],
  "signals": [
    { "type": "entry_long", "when": "(close > ema200) and (rsi14 crossesAbove 35)" },
    { "type": "exit_long",  "when": "(rsi14 crossesAbove 55) or (close crossesBelow ema20)" }
  ]
}`},{title:"Advanced · Donchian breakout (backtest)",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "stopLossPct": 2.2,
    "takeProfitPct": 4.5,
    "trailingStopPct": 1.4,
    "allowShort": false
  },
  "calc": [
    { "name": "ema200", "type": "ema", "source": "close", "period": 200 },
    { "name": "dc", "type": "donchian", "period": 20 },
    { "name": "ema50", "type": "ema", "source": "close", "period": 50 }
  ],
  "plots": [
    { "name": "EMA 200", "source": "ema200", "color": "#94a3b8", "width": 2 },
    { "name": "DC Upper", "source": "dc_upper", "color": "#22c55e", "width": 1, "style": "dashed" },
    { "name": "DC Mid",   "source": "dc_mid",   "color": "#64748b", "width": 1, "style": "dotted" },
    { "name": "DC Lower", "source": "dc_lower", "color": "#ef4444", "width": 1, "style": "dashed" },
    { "name": "EMA 50",   "source": "ema50",   "color": "#60a5fa", "width": 2 }
  ],
  "labels": [
    { "when": "(close > ema200) and (close crossesAbove dc_upper)", "text": "BREAK", "color": "#16a34a", "position": "below", "source": "low", "shape": "triangle_up_filled" },
    { "when": "(close crossesBelow dc_mid) or (close crossesBelow ema50)", "text": "EXIT", "color": "#f59e0b", "position": "above", "source": "high", "shape": "triangle_down_filled" }
  ],
  "signals": [
    { "type": "entry_long", "when": "(close > ema200) and (close crossesAbove dc_upper)" },
    { "type": "exit_long",  "when": "(close crossesBelow dc_mid) or (close crossesBelow ema50)" }
  ]
}`},{title:"Keltner channels + mid",code:`{
  "pane": "main",
  "calc": [
    { "name": "kc", "type": "keltner", "period": 20, "mult": 2 }
  ],
  "plots": [
    { "name": "KC Mid", "source": "kc_mid",    "color": "#22c55e", "width": 2 },
    { "name": "KC Up",  "source": "kc_upper",  "color": "#22c55e", "width": 1, "style": "dashed" },
    { "name": "KC Low", "source": "kc_lower",  "color": "#22c55e", "width": 1, "style": "dashed" }
  ]
}`},{title:"ATR bands",code:`{
  "pane": "main",
  "calc": [
    { "name": "atrb", "type": "atr_bands", "period": 14, "mult": 2 }
  ],
  "plots": [
    { "name": "ATR Up",  "source": "atrb_upper", "color": "#94a3b8", "width": 1 },
    { "name": "ATR Low", "source": "atrb_lower", "color": "#94a3b8", "width": 1 }
  ]
}`},{title:"VWAP bands",code:`{
  "pane": "main",
  "calc": [
    { "name": "vb", "type": "vwap_bands", "period": 20, "std": 2 }
  ],
  "plots": [
    { "name": "VWAP Mid", "source": "vb_mid",   "color": "#22c55e", "width": 2 },
    { "name": "VWAP Up",  "source": "vb_upper", "color": "#22c55e", "width": 1, "style": "dashed" },
    { "name": "VWAP Low", "source": "vb_lower", "color": "#22c55e", "width": 1, "style": "dashed" }
  ]
}`},{title:"Stochastic cross + backtest (sub)",code:`{
  "pane": "sub",
  "strategy": {
    "initialCapital": 10000,
    "commissionPct": 0.1,
    "slippagePct": 0.02
  },
  "min": 0,
  "max": 100,
  "calc": [
    { "name": "stoch", "type": "stoch", "kPeriod": 14, "dPeriod": 3 }
  ],
  "plots": [
    { "name": "%K", "source": "stoch_k", "color": "#1E90FF", "width": 2 },
    { "name": "%D", "source": "stoch_d", "color": "#FF1493", "width": 2, "style": "dashed" }
  ],
  "labels": [
    { "when": "stoch_k crossesAbove stoch_d", "text": "K>D", "color": "#16a34a", "position": "above", "source": "stoch_k", "shape": "pill" },
    { "when": "stoch_k crossesBelow stoch_d", "text": "K<D", "color": "#ef4444", "position": "below", "source": "stoch_k", "shape": "pill" }
  ],
  "signals": [
    { "type": "entry_long",  "when": "stoch_k crossesAbove stoch_d" },
    { "type": "entry_short", "when": "stoch_k crossesBelow stoch_d" }
  ]
}`},{title:"Ichimoku cloud (core)",code:`{
  "pane": "main",
  "calc": [
    { "name": "ichimoku", "type": "ichimoku", "tenkan": 9, "kijun": 26, "senkouB": 52 }
  ],
  "plots": [
    { "name": "Tenkan", "source": "tenkan", "color": "#22c55e", "width": 1 },
    { "name": "Kijun",  "source": "kijun",  "color": "#ef4444", "width": 1 }
  ]
}`},{title:"Complex combo signals",code:`{
  "pane": "main",
  "calc": [
    { "name": "ema200", "type": "ema", "source": "close", "period": 200 },
    { "name": "ema50",  "type": "ema", "source": "close", "period": 50 },
    { "name": "ema20",  "type": "ema", "source": "close", "period": 20 },
    { "name": "macd",   "type": "macd", "source": "close", "fast": 12, "slow": 26, "signal": 9 },
    { "name": "rsi14",  "type": "rsi",  "source": "close", "period": 14 },
    { "name": "sar",    "type": "sar",  "step": 0.02, "max": 0.2 }
  ],
  "labels": [
    { "when": "(close>ema200) and (ema20>ema50) and (macd_line>macd_signal) and (rsi14>55) and (sar<close)", "text": "BUY",  "shape": "triangle_up_filled",   "color": "#16a34a", "position": "below", "source": "low" },
    { "when": "(close<ema200) and (ema20<ema50) and (macd_line<macd_signal) and (rsi14<45) and (sar>close)", "text": "SELL", "shape": "triangle_down_filled", "color": "#ef4444", "position": "above", "source": "high" }
  ]
}`},{title:"EMA cross filtered",code:`{
  "pane": "main",
  "calc": [
    { "name": "ema_fast", "type": "ema", "source": "close", "period": 20 },
    { "name": "ema_slow", "type": "ema", "source": "close", "period": 50 }
  ],
  "plots": [
    { "name": "EMA 20", "source": "ema_fast", "color": "#22c55e", "width": 2 },
    { "name": "EMA 50", "source": "ema_slow", "color": "#3b82f6", "width": 2, "style": "dashed" }
  ],
  "labels": [
    { "when": "ema_fast crossesAbove ema_slow and trend(up)",  "text": "BUY",  "color": "#16a34a", "position": "below", "source": "low",  "shape": "triangle_up_filled" },
    { "when": "ema_fast crossesBelow ema_slow and trend(down)", "text": "SELL", "color": "#ef4444", "position": "above", "source": "high", "shape": "triangle_down_filled" }
  ]
}`}];try{const Y=m.findIndex(oe=>String((oe==null?void 0:oe.title)||"").toLowerCase().includes("multi-symbol spread"));if(Y>=0){const oe=m[Y];let ee=String(oe.code||"");ee=ee.replace(/lookbk\s*=\s*input\.int\(\s*20\s*,/,"lookbk  = input.int(10,"),ee=ee.replace(/z\s*=\s*\(spread\s*-\s*mu\)\s*\/\s*sd/g,"z = (spread - mu) / nz(sd, 0.000001)"),m[Y]={...oe,code:ee}}}catch{}const h=`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "orderSize": { "type": "percent_of_equity", "value": 100 },
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "execution": "intrabar_ohlc",
    "intrabarTieBreak": "worst_case",
    "pyramiding": 1,
    "stopLossPct": 2,
    "takeProfitPct": 4,
    "allowShort": false
  },
  "calc": [
    { "name": "dc",    "type": "donchian", "period": 20 },
    { "name": "atr14", "type": "atr", "period": 14 }
  ],
  "series": [
    { "name": "dc_upper_prev", "expr": "lag(dc_upper, 1)" },
    { "name": "entry_stop",  "expr": "dc_upper_prev" },
    { "name": "entry_limit", "expr": "add(dc_upper_prev, mul(atr14, 0.05))" }
  ],
  "plots": [
    { "name": "DC Upper",      "source": "dc_upper",      "color": "#94a3b8", "width": 1, "style": "dashed" },
    { "name": "DC Upper prev", "source": "dc_upper_prev", "color": "#22c55e", "width": 2 },
    { "name": "DC Lower",      "source": "dc_lower",      "color": "#ef4444", "width": 1, "style": "dashed" }
  ],
  "signals": [
    {
      "id": "BRK",
      "type": "entry_long",
      "when": "high crossesAbove entry_stop",
      "order": {
        "kind": "stop_limit",
        "stopPrice": "entry_stop",
        "limitPrice": "entry_limit",
        "expiresBars": 20
      }
    }
  ]
}`,_=`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "execution": "intrabar_ohlc",
    "intrabarTieBreak": "worst_case",
    "pyramiding": 1,
    "stopLossPct": 2.2,
    "takeProfitPct": 4.5,
    "trailingStopPct": 1.4,
    "allowShort": false
  },
  "calc": [
    { "name": "ema200", "type": "ema", "source": "close", "period": 200 },
    { "name": "dc", "type": "donchian", "period": 20 },
    { "name": "ema50", "type": "ema", "source": "close", "period": 50 }
  ],
  "series": [
    { "name": "dc_upper_prev", "expr": "lag(dc_upper, 1)" },
    { "name": "dc_mid_prev",   "expr": "lag(dc_mid, 1)" }
  ],
  "plots": [
    { "name": "EMA 200", "source": "ema200", "color": "#94a3b8", "width": 2 },
    { "name": "DC Upper", "source": "dc_upper", "color": "#60a5fa", "width": 1, "style": "dashed" },
    { "name": "DC Mid",   "source": "dc_mid",   "color": "#64748b", "width": 1, "style": "dotted" },
    { "name": "DC Lower", "source": "dc_lower", "color": "#ef4444", "width": 1, "style": "dashed" },
    { "name": "EMA 50",   "source": "ema50",   "color": "#22c55e", "width": 2 }
  ],
  "labels": [
    { "when": "(close > ema200) and (high crossesAbove dc_upper_prev)", "text": "BREAK", "color": "#16a34a", "position": "below", "source": "low", "shape": "triangle_up_filled" },
    { "when": "(close crossesBelow dc_mid_prev) or (close crossesBelow ema50)", "text": "EXIT", "color": "#f59e0b", "position": "above", "source": "high", "shape": "triangle_down_filled" }
  ],
  "signals": [
    { "type": "entry_long", "when": "(close > ema200) and (high crossesAbove dc_upper_prev)" },
    { "type": "exit_long",  "when": "(close crossesBelow dc_mid_prev) or (close crossesBelow ema50)" }
  ]
}`,I=m.map(Y=>Y.title==="Strategy · Stop‑Limit entry (expiresBars)"?{...Y,code:h}:Y.title==="Advanced · Donchian breakout (backtest)"?{...Y,code:_}:Y).concat([{title:"Strategy · Bracket entry (SL/TP + partials)",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "orderSize": { "type": "percent_of_equity", "value": 100 },
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "execution": "intrabar_ohlc",
    "intrabarTieBreak": "worst_case",
    "pyramiding": 1,
    "allowShort": false
  },
  "calc": [
    { "name": "ema20", "type": "ema", "source": "close", "period": 20 },
    { "name": "ema50", "type": "ema", "source": "close", "period": 50 }
  ],
  "plots": [
    { "name": "EMA 20", "source": "ema20", "color": "#22c55e", "width": 2 },
    { "name": "EMA 50", "source": "ema50", "color": "#60a5fa", "width": 2, "style": "dashed" }
  ],
  "labels": [
    { "when": "ema20 crossesAbove ema50", "text": "BUY",  "shape": "triangle_up_filled",   "color": "#16a34a", "position": "below", "source": "low" },
    { "when": "ema20 crossesBelow ema50", "text": "EXIT", "shape": "triangle_down_filled", "color": "#f59e0b", "position": "above", "source": "high" }
  ],
  "signals": [
    {
      "id": "L",
      "type": "entry_long",
      "when": "ema20 crossesAbove ema50",
      "order": {
        "kind": "market",
        "qtyPct": 100,
        "bracket": {
          "stopLossPct": 1.2,
          "trailingStopPct": 0.9,
          "takeProfits": [
            { "takeProfitPct": 1.0, "qtyPct": 50 },
            { "takeProfitPct": 2.0, "qtyPct": 50 }
          ]
        }
      }
    },
    {
      "id": "X",
      "type": "exit_long",
      "when": "ema20 crossesBelow ema50",
      "order": { "kind": "market", "qtyPct": 100 }
    }
  ]
}`},{title:"Strategy · Intrabar pending entry (same‑bar exits)",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "orderSize": { "type": "percent_of_equity", "value": 100 },
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "execution": "intrabar_ohlc",
    "intrabarTieBreak": "ohlc",
    "ohlcPath": "open_high_low_close",
    "pyramiding": 1,
    "allowShort": false
  },
  "calc": [
    { "name": "ema20", "type": "ema", "source": "close", "period": 20 }
  ],
  "plots": [
    { "name": "EMA 20", "source": "ema20", "color": "#60a5fa", "width": 2 }
  ],
  "labels": [
    { "when": "close > 0", "text": "STOP BUY (pending)", "shape": "tag", "color": "#64748b", "position": "above", "source": "high", "offsetY": -14 }
  ],
  "signals": [
    {
      "id": "PENDING_STOP",
      "type": "entry_long",
      "when": "close > 0",
      "cooldownBars": 999999,
      "order": {
        "kind": "stop",
        "price": "low",
        "bracket": {
          "stopLossPct": 0.25,
          "takeProfitPct": 0.35
        }
      }
    }
  ]
}`},{title:"Strategy · Donchian stop entry (lag + bracket)",code:`{
  "pane": "main",
  "strategy": {
    "initialCapital": 10000,
    "orderSize": { "type": "percent_of_equity", "value": 100 },
    "commissionPct": 0.1,
    "slippagePct": 0.02,
    "execution": "intrabar_ohlc",
    "intrabarTieBreak": "worst_case",
    "pyramiding": 1,
    "allowShort": false,
    "closeOnEnd": true
  },
  "calc": [
    { "name": "ema200", "type": "ema", "source": "close", "period": 200 },
    { "name": "dc", "type": "donchian", "period": 20 }
  ],
  "series": [
    { "name": "dc_upper_prev", "expr": "lag(dc_upper, 1)" }
  ],
  "plots": [
    { "name": "EMA 200", "source": "ema200", "color": "#94a3b8", "width": 2 },
    { "name": "DC Upper",      "source": "dc_upper",      "color": "#60a5fa", "width": 1, "style": "dashed" },
    { "name": "DC Upper prev", "source": "dc_upper_prev", "color": "#22c55e", "width": 2 }
  ],
  "labels": [
    { "when": "(close > ema200) and (high crossesAbove dc_upper_prev)", "text": "BREAK", "color": "#16a34a", "position": "below", "source": "low", "shape": "triangle_up_filled" }
  ],
  "signals": [
    {
      "id": "BRK_STOP",
      "type": "entry_long",
      "when": "(close > ema200) and (high crossesAbove dc_upper_prev)",
      "order": {
        "kind": "stop",
        "price": "dc_upper_prev",
        "qtyPct": 100,
        "bracket": {
          "stopLossPct": 1.2,
          "takeProfitPct": 2.4,
          "takeProfits": [{ "takeProfitPct": 1.2, "qtyPct": 50 }]
        }
      }
    }
  ]
}`},{title:"Pine (pro) · Functions + for loop + array.from (compile‑time)",code:`//@pine
//@version=5
// New Pine core (v1):
// - single-line functions: f(x)=>...
// - for-loops (compile-time unroll; body must be indented)
// - array.from + array.get (compile-time only)

upper(src, p, m) => sma(src, p) + (stdev(src, p) * m)
lower(src, p, m) => sma(src, p) - (stdev(src, p) * m)

p = input.int(20, title="Period")
m = input.float(2.0, title="Std", step=0.1)

basis = sma(close, p)
u = upper(close, p, m)
l = lower(close, p, m)

plot(basis, title="Basis", color="#94a3b8", width=2)
plot(u,     title="Upper", color="#22c55e", width=2)
plot(l,     title="Lower", color="#ef4444", width=2)

levels = array.from(30, 50, 70)
for i = 0 to 2
  hline(array.get(levels, i), title="RSI level", color="#64748b", style="dotted", pane="sub")

r = rsi(close, 14)
plot(r, title="RSI", color="#f59e0b", width=2, pane="sub")`}]),C=`//@pine
//@version=5
indicator("EMA Quick", overlay=true)

ema20 = ema(close, 20)
plot(ema20, title="EMA 20", color="#3b82f6", width=2)`,M=`//@pine
//@version=5
indicator("Signal Demo", overlay=true)

ema20 = ema(close, 20)
signal BUY when crossover(close, ema20) score=7 cooldown=5
plot(ema20, color="#3b82f6", width=2)`,F=`WIN = 5
HIWIN = highest(close, WIN)
signal BUY when (close == HIWIN) score:7 cooldown:5
label at top text:"BUY" color:#22c55e`,V=`{
  "pane": "main",
  "calc": [
    { "name": "ema20", "type": "ema", "source": "close", "period": 20 }
  ],
  "plots": [
    { "name": "EMA 20", "source": "ema20", "color": "#3b82f6", "width": 2 }
  ],
  "signals": [
    { "id": "L", "type": "entry_long", "when": "close crossesAbove ema20", "score": 8, "cooldownBars": 10 }
  ]
}`,j=`{
  "pane": "main",
  "calc": [
    { "name": "ema20", "type": "ema", "source": "close", "period": 20 },
    { "name": "ema50", "type": "ema", "source": "close", "period": 50 }
  ],
  "rules": [
    { "type": "series", "name": "trend", "whenExpr": "ema20 > ema50", "then": "1", "else": "-1" },
    { "type": "state",  "name": "last_cross", "whenExpr": "crossover(ema20, ema50)", "then": "bar_index" }
  ],
  "plots": [
    { "name": "EMA 20", "source": "ema20", "color": "#22c55e", "width": 2 },
    { "name": "EMA 50", "source": "ema50", "color": "#3b82f6", "width": 2 }
  ],
  "labels": [
    { "whenExpr": "trend > 0", "text": "UP", "color": "#22c55e", "position": "below", "source": "low",  "shape": "triangle_up_filled" },
    { "whenExpr": "trend < 0", "text": "DOWN", "color": "#ef4444", "position": "above", "source": "high", "shape": "triangle_down_filled" }
  ]
}`,D=`{
  "pane": "main",
  "calc": [
    { "repeat": { "items": [10, 20, 50], "var": "p" }, "template": { "name": "ema\${p}", "type": "ema", "source": "close", "period": "\${p}" } }
  ],
  "plots": [
    { "repeat": { "items": [10, 20, 50], "var": "p" }, "template": { "name": "EMA \${p}", "source": "ema\${p}", "color": "#94a3b8", "width": 1 } }
  ]
}`,R=`{
  "pane": "main",
  "series": [
    { "name": "body", "expr": "close - open" }
  ],
  "labels": [
    {
      "whenExpr": "abs(body) > 0",
      "textExpr": "format("Body {0.00}", body)",
      "colorExpr": "iff(body >= 0, "#22c55e", "#ef4444")",
      "textColorExpr": ""#0f172a"",
      "position": "above",
      "source": "close",
      "shape": "label"
    }
  ]
}`,W=`{
  "pane": "main",
  "calc": [
    { "name": "ema20", "type": "ema", "source": "close", "period": 20 }
  ],
  "signals": [
    {
      "id": "L",
      "type": "entry_long",
      "when": "close crossesAbove ema20",
      "scoreExpr": "iff(close > ema20, 8, 4)",
      "cooldownExpr": "iff(close > ema20, 5, 10)"
    }
  ]
}`,J=`//@pine
//@version=5
strategy(initial_capital=10000, execution="bar_close", allowShort=false)

fast = ema(close, 10)
slow = ema(close, 20)
enter = crossover(fast, slow)
exit  = crossunder(fast, slow)

strategy.entry("L", strategy.long, when=enter)
strategy.exit("X", side="long", when=exit)`,Z=`// "when" uses the condition language
signal BUY  when add(close, open) > ema(close, 20)
signal SELL when between(rsi(close, 14), 30, 70)`;Bv();var G=Ln(),se=Dt(G);Te(se,t,Y=>{var oe=hK();oe.__click=[GY,l];var ee=g(oe),re=g(ee),me=u(g(re),2);me.__click=l,f(re);var K=u(re,2),ye=g(K),Me=g(ye);Me.__click=[YY,o];var Fe=u(Me,2);Fe.__click=[KY,o],f(ye);var Ze=u(ye,2);Te(Ze,()=>s(o)==="details",Ge=>{var it=pK(),Ye=g(it),ct=u(g(Ye),2),kt=g(ct);kt.__click=[ZY,i];var ft=u(kt,2);ft.__click=[XY,i],f(ct),f(Ye);var bt=u(Ye,2);Te(bt,()=>s(i)==="bn",nt=>{var Pt=sK(),Qe=u(Dt(Pt),2),yt=g(Qe);yt.__click=[JY,r];var xe=u(yt,2);xe.__click=[QY,r];var Ve=u(xe,2);Ve.__click=[eK,r],f(Qe);var Je=u(Qe,2);Te(Je,()=>s(r)==="json",St=>{var Ne=tK(),ue=u(Dt(Ne),20),he=u(g(ue),2),_t=g(he);_t.textContent=Z,f(he),f(ue);var Wt=u(ue,6),jt=u(g(Wt),2),Zt=g(jt);Zt.textContent=j,f(jt),f(Wt);var dn=u(Wt,6),zn=u(g(dn),2),un=g(zn);un.textContent=D,f(zn),f(dn);var On=u(dn,6),no=u(g(On),2),fs=g(no);fs.textContent=R,f(no),f(On);var ps=u(On,6),So=u(g(ps),2),Es=g(So);Es.textContent=V,f(So),f(ps);var Qo=u(ps,2),Ko=u(g(Qo),2),oo=g(Ko);oo.textContent=W,f(Ko),f(Qo),ai(8),z(St,Ne)},St=>{var Ne=Ln(),ue=Dt(Ne);Te(ue,()=>s(r)==="pine",he=>{var _t=nK(),Wt=u(Dt(_t),56),jt=u(g(Wt),2),Zt=g(jt);Zt.textContent=C,f(jt),f(Wt);var dn=u(Wt,2),zn=u(g(dn),2),un=g(zn);un.textContent=M,f(zn),f(dn);var On=u(dn,2),no=u(g(On),2),fs=g(no);fs.textContent=J,f(no),f(On),ai(4),z(he,_t)},he=>{var _t=oK(),Wt=u(Dt(_t),12),jt=u(g(Wt),2),Zt=g(jt);Zt.textContent=F,f(jt),f(Wt),ai(4),z(he,_t)},!0),z(St,Ne)}),Se(()=>{Us(yt,`ss-tab ${(s(r)==="json"?"active":"")??""} svelte-50qv65`),zt(yt,"aria-selected",s(r)==="json"),Us(xe,`ss-tab ${(s(r)==="pine"?"active":"")??""} svelte-50qv65`),zt(xe,"aria-selected",s(r)==="pine"),Us(Ve,`ss-tab ${(s(r)==="dsl"?"active":"")??""} svelte-50qv65`),zt(Ve,"aria-selected",s(r)==="dsl")}),z(nt,Pt)},nt=>{var Pt=uK(),Qe=u(Dt(Pt),2),yt=g(Qe);yt.__click=[iK,r];var xe=u(yt,2);xe.__click=[rK,r];var Ve=u(xe,2);Ve.__click=[aK,r],f(Qe);var Je=u(Qe,2);Te(Je,()=>s(r)==="json",St=>{var Ne=lK(),ue=u(Dt(Ne),20),he=u(g(ue),2),_t=g(he);_t.textContent=Z,f(he),f(ue);var Wt=u(ue,6),jt=u(g(Wt),2),Zt=g(jt);Zt.textContent=j,f(jt),f(Wt);var dn=u(Wt,6),zn=u(g(dn),2),un=g(zn);un.textContent=D,f(zn),f(dn);var On=u(dn,6),no=u(g(On),2),fs=g(no);fs.textContent=R,f(no),f(On);var ps=u(On,6),So=u(g(ps),2),Es=g(So);Es.textContent=V,f(So),f(ps);var Qo=u(ps,2),Ko=u(g(Qo),2),oo=g(Ko);oo.textContent=W,f(Ko),f(Qo),ai(8),z(St,Ne)},St=>{var Ne=Ln(),ue=Dt(Ne);Te(ue,()=>s(r)==="pine",he=>{var _t=cK(),Wt=u(Dt(_t),56),jt=u(g(Wt),2),Zt=g(jt);Zt.textContent=C,f(jt),f(Wt);var dn=u(Wt,2),zn=u(g(dn),2),un=g(zn);un.textContent=M,f(zn),f(dn);var On=u(dn,2),no=u(g(On),2),fs=g(no);fs.textContent=J,f(no),f(On),ai(4),z(he,_t)},he=>{var _t=dK(),Wt=u(Dt(_t),12),jt=u(g(Wt),2),Zt=g(jt);Zt.textContent=F,f(jt),f(Wt),ai(4),z(he,_t)},!0),z(St,Ne)}),Se(()=>{Us(yt,`ss-tab ${(s(r)==="json"?"active":"")??""} svelte-50qv65`),zt(yt,"aria-selected",s(r)==="json"),Us(xe,`ss-tab ${(s(r)==="pine"?"active":"")??""} svelte-50qv65`),zt(xe,"aria-selected",s(r)==="pine"),Us(Ve,`ss-tab ${(s(r)==="dsl"?"active":"")??""} svelte-50qv65`),zt(Ve,"aria-selected",s(r)==="dsl")}),z(nt,Pt)}),f(it),Se(()=>{Us(kt,`ss-lang-btn ${(s(i)==="bn"?"active":"")??""} svelte-50qv65`),Us(ft,`ss-lang-btn ${(s(i)==="en"?"active":"")??""} svelte-50qv65`)}),z(Ge,it)},Ge=>{var it=gK(),Ye=u(g(it),2);vs(Ye,1,()=>I,Vs,(ct,kt)=>{var ft=mK(),bt=g(ft),nt=g(bt),Pt=g(nt,!0);f(nt);var Qe=u(nt,2),yt=g(Qe);yt.__click=[vK,p,kt];var xe=u(yt);xe.__click=[fK,d,kt],f(Qe),f(bt);var Ve=u(bt,2),Je=g(Ve),St=g(Je,!0);f(Je),f(Ve),f(ft),Se(()=>{ze(Pt,s(kt).title),ze(St,s(kt).code)}),z(ct,ft)}),f(it),z(Ge,it)}),f(K),f(ee),f(oe),Se(()=>{Us(Me,`ss-tab ${(s(o)==="details"?"active":"")??""} svelte-50qv65`),zt(Me,"aria-selected",s(o)==="details"),Us(Fe,`ss-tab ${(s(o)==="examples"?"active":"")??""} svelte-50qv65`),zt(Fe,"aria-selected",s(o)==="examples")}),z(Y,oe)}),z(n,G),hd()}qu(["click"]);const yK={signals:new Set,label:new Set};function y2(n,e){yK[n].forEach(t=>{try{t(e)}catch{}})}const a0=zp({});function bK(n,e){a0.update(t=>({...t,[n]:e}))}function xK(n){return tv(a0)[n]||[]}const wK=a0;function kK(n){a0.update(e=>{const{[n]:t,...o}=e;return o})}function SK(){a0.set({})}const I_=zp({}),CK=I_;function PK(n,e){const t={...e,_updatedAt:Date.now()};I_.update(o=>({...o,[n]:t}))}function b2(n){I_.update(e=>{const{[n]:t,...o}=e;return o})}function IK(){I_.set({})}function Tp(n,e){const t=typeof n=="number"?n:Number(n);return Number.isFinite(t)?t:e}function x2(n,e="start"){if(n==null)return null;if(typeof n=="number"&&Number.isFinite(n))return n>1e12?Math.floor(n):Math.floor(n*1e3);const t=String(n).trim();if(!t)return null;if(/^\d+$/.test(t)){const r=Number(t);if(Number.isFinite(r))return r>1e12?Math.floor(r):Math.floor(r*1e3)}const o=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(o){const r=Number(o[1]),a=Number(o[2])-1,l=Number(o[3]);if([r,a,l].every(c=>Number.isFinite(c))){const c=Date.UTC(r,a,l);return Number.isFinite(c)?e==="end"?c+86399999:c:null}}const i=Date.parse(t);return Number.isFinite(i)?i:null}function MK(n){if(!n)return null;const e=String(n).trim();if(!e)return null;const t=e.match(/^(\d{2})(?::?(\d{2}))?\s*-\s*(\d{2})(?::?(\d{2}))?$/);if(!t)return null;const o=Number(t[1]),i=Number(t[2]||"0"),r=Number(t[3]),a=Number(t[4]||"0");return![o,i,r,a].every(l=>Number.isFinite(l))||o<0||o>23||r<0||r>23||i<0||i>59||a<0||a>59?null:{startMin:o*60+i,endMin:r*60+a}}function AK(n){if(n===!0)return{enabled:!0,execution:"intrabar_ohlc",intrabarTieBreak:"worst_case",ohlcPath:"open_high_low_close",initialCapital:1e4,fromTs:null,toTs:null,session:null,orderSize:{type:"percent_of_equity",value:100},commissionPct:0,slippagePct:0,priceTick:null,qtyStep:null,minQty:null,spreadPct:null,leverage:1,maintenanceMarginPct:null,liquidationFeePct:null,borrowPctPerYear:null,fundingPctPerDay:null,positionMode:"netting",closeMethod:"fifo",pyramiding:1,stopLossPct:null,takeProfitPct:null,takeProfits:[],trailingStopPct:null,maxDrawdownPct:null,maxDrawdownCash:null,maxPositionPct:null,maxPositionCash:null,maxPositionQty:null,maxIntradayFilledOrders:null,maxIntradayLossPct:null,maxIntradayLossCash:null,allowLong:!0,allowShort:!0,closeOnEnd:!0};if(!n||typeof n!="object")return null;const e=n;if(e.enabled===!1)return null;const t=String(e.execution||e.exec||e.mode||"").trim().toLowerCase()||"intrabar_ohlc",o=t==="bar_close"||t==="barclose"||t==="close"?"bar_close":"intrabar_ohlc",i=String(e.intrabarTieBreak||e.tieBreak||"").trim().toLowerCase(),r=i==="best_case"||i==="best"||i==="tp"?"best_case":i==="ohlc"||i==="path"?"ohlc":"worst_case",a=String(e.ohlcPath||e.path||"").trim().toLowerCase(),l=a==="open_low_high_close"||a==="olhc"?"open_low_high_close":"open_high_low_close",c=Math.max(0,Tp(e.initialCapital,1e4)),d=Math.max(0,Tp(e.commissionPct,0)),p=Math.max(0,Tp(e.slippagePct,0)),m=e.priceTick??e.price_tick??e.tickSize??e.tick_size??e.tick??e.minTick??e.min_tick??null,h=e.qtyStep??e.qty_step??e.quantityStep??e.quantity_step??e.lotStep??e.lot_step??null,_=e.minQty??e.min_qty??e.minimumQty??e.minimum_qty??null,w=m==null?null:Math.max(0,Tp(m,0)),S=h==null?null:Math.max(0,Tp(h,0)),P=_==null?null:Math.max(0,Tp(_,0)),I=e.spreadPct??e.spread_pct??e.spread??e.spreadBps??e.spread_bps??null,C=(()=>{if(I==null)return null;const dn=Tp(I,0);return!Number.isFinite(dn)||dn<=0?null:"spreadBps"in e||"spread_bps"in e?dn/100:dn})(),M=e.leverage??e.lev??e.marginLeverage??e.margin_leverage??1,F=Math.max(1,Tp(M,1)),V=e.maintenanceMarginPct??e.maintenance_margin_pct??e.maintMarginPct??null,j=e.liquidationFeePct??e.liquidation_fee_pct??e.liqFeePct??null,D=e.borrowPctPerYear??e.borrow_pct_per_year??e.shortBorrowPctPerYear??null,R=e.fundingPctPerDay??e.funding_pct_per_day??e.funding??null,W=V==null?null:Math.max(0,Tp(V,0)),J=j==null?null:Math.max(0,Tp(j,0)),Z=D==null?null:Math.max(0,Tp(D,0)),G=R==null?null:Math.max(0,Tp(R,0)),se=String(e.positionMode??e.position_mode??"").trim().toLowerCase(),Y=se==="hedge"||se==="hedging"?"hedging":"netting",oe=String(e.closeMethod??e.close_method??e.costBasis??e.cost_basis??"").trim().toLowerCase(),ee=oe==="lifo"?"lifo":oe==="avg"||oe==="average"?"avg":"fifo",re=Math.max(1,Math.min(50,Math.floor(Tp(e.pyramiding??e.maxEntries??e.max_positions??e.maxPositions??1,1)))),me=e.stopLossPct??e.slPct??e.sl??e.stopLoss??e.stop_loss??null,K=e.takeProfitPct??e.tpPct??e.tp??e.takeProfit??e.take_profit??null,ye=e.trailingStopPct??e.trailPct??e.trailing??e.trailingStop??null,Me=me==null?null:Math.max(0,Tp(me,0)),Fe=K==null?null:Math.max(0,Tp(K,0)),Ze=ye==null?null:Math.max(0,Tp(ye,0)),Ge=typeof e.allowLong=="boolean"?e.allowLong:e.allowLong!==!1,it=typeof e.allowShort=="boolean"?e.allowShort:e.allowShort!==!1,Ye=typeof e.closeOnEnd=="boolean"?e.closeOnEnd:e.closeOnEnd!==!1,ct=x2(e.from??e.start??e.startDate??e.dateFrom??e.fromDate??e.rangeStart,"start")??null,kt=x2(e.to??e.end??e.endDate??e.dateTo??e.toDate??e.rangeEnd,"end")??null,ft=MK(e.session??e.tradingSession??e.sessionTime),bt=e.takeProfits??e.tpLevels??e.takeProfitLevels??[],nt=[];if(Array.isArray(bt))for(const dn of bt){if(!dn||typeof dn!="object")continue;const zn=Tp(dn.takeProfitPct??dn.tpPct??dn.pct,NaN),un=Tp(dn.qtyPct??dn.qty??dn.percent,NaN);!Number.isFinite(zn)||zn<=0||!Number.isFinite(un)||un<=0||nt.push({takeProfitPct:zn,qtyPct:Math.max(0,Math.min(100,un))})}nt.sort((dn,zn)=>dn.takeProfitPct-zn.takeProfitPct);const Pt=e.risk&&typeof e.risk=="object"?e.risk:{},Qe=dn=>{if(dn==null)return null;const zn=Tp(dn,NaN);return Number.isFinite(zn)?zn:null},yt=Qe(e.maxDrawdownPct??e.max_drawdown_pct??Pt.maxDrawdownPct??Pt.max_drawdown_pct??Pt.max_drawdown)??null,xe=Qe(e.maxDrawdownCash??e.max_drawdown_cash??Pt.maxDrawdownCash??Pt.max_drawdown_cash)??null,Ve=Qe(e.maxPositionPct??e.max_position_pct??Pt.maxPositionPct??Pt.max_position_pct??Pt.max_position_size)??null,Je=Qe(e.maxPositionCash??e.max_position_cash??Pt.maxPositionCash??Pt.max_position_cash)??null,St=Qe(e.maxPositionQty??e.max_position_qty??Pt.maxPositionQty??Pt.max_position_qty??Pt.max_contracts)??null,Ne=Qe(e.maxIntradayFilledOrders??e.max_intraday_filled_orders??Pt.maxIntradayFilledOrders??Pt.max_intraday_filled_orders)??null,ue=Qe(e.maxIntradayLossPct??e.max_intraday_loss_pct??Pt.maxIntradayLossPct??Pt.max_intraday_loss_pct??Pt.max_intraday_loss)??null,he=Qe(e.maxIntradayLossCash??e.max_intraday_loss_cash??Pt.maxIntradayLossCash??Pt.max_intraday_loss_cash)??null;let _t=0;const Wt=[];for(const dn of nt){if(_t>=100)break;const zn=100-_t,un=Math.min(zn,dn.qtyPct);un<=0||(Wt.push({takeProfitPct:dn.takeProfitPct,qtyPct:un}),_t+=un)}const jt=e.orderSize??e.positionSize??e.order??null;let Zt={type:"percent_of_equity",value:100};if(jt&&typeof jt=="object"){const dn=String(jt.type||"").trim().toLowerCase(),zn=Tp(jt.value,100);dn==="cash"?Zt={type:"cash",value:Math.max(0,zn)}:dn==="qty"?Zt={type:"qty",value:Math.max(0,zn)}:dn?Zt={type:"percent_of_equity",value:Math.max(0,Math.min(100,zn))}:Zt={type:"percent_of_equity",value:Math.max(0,Math.min(100,zn))}}else if(jt!=null){const dn=Tp(jt,100);Zt={type:"percent_of_equity",value:Math.max(0,Math.min(100,dn))}}return{enabled:!0,execution:o,intrabarTieBreak:r,ohlcPath:l,initialCapital:c,fromTs:ct,toTs:kt,session:ft,orderSize:Zt,commissionPct:d,slippagePct:p,priceTick:w&&w>0?w:null,qtyStep:S&&S>0?S:null,minQty:P&&P>0?P:null,spreadPct:C&&C>0?C:null,leverage:F,maintenanceMarginPct:W&&W>0?W:null,liquidationFeePct:J&&J>0?J:null,borrowPctPerYear:Z&&Z>0?Z:null,fundingPctPerDay:G&&G>0?G:null,positionMode:Y,closeMethod:ee,pyramiding:re,stopLossPct:Me!=null&&Me>0?Me:null,takeProfitPct:Fe!=null&&Fe>0?Fe:null,takeProfits:Wt,trailingStopPct:Ze!=null&&Ze>0?Ze:null,maxDrawdownPct:yt!=null&&yt>0?yt:null,maxDrawdownCash:xe!=null&&xe>0?xe:null,maxPositionPct:Ve!=null&&Ve>0?Ve:null,maxPositionCash:Je!=null&&Je>0?Je:null,maxPositionQty:St!=null&&St>0?St:null,maxIntradayFilledOrders:Ne!=null&&Ne>0?Math.floor(Ne):null,maxIntradayLossPct:ue!=null&&ue>0?ue:null,maxIntradayLossCash:he!=null&&he>0?he:null,allowLong:Ge,allowShort:it,closeOnEnd:Ye}}function w2(n){return n==="cancel"||n==="cancel_all"?0:n==="exit_long"?1:n==="exit_short"?2:n==="entry_long"?3:n==="entry_short"?4:9}function r_(n){const e=n==null?void 0:n.close;return typeof e=="number"&&Number.isFinite(e)?e:null}function S1(n){return typeof n=="number"&&Number.isFinite(n)?n:null}function TK(n){const e=r_(n);if(e==null)return null;const t=S1(n==null?void 0:n.open)??e,o=S1(n==null?void 0:n.high)??Math.max(t,e),i=S1(n==null?void 0:n.low)??Math.min(t,e);return{o:t,h:o,l:i,c:e}}function LK(n,e,t){var Cc,Ac,cu,Id,Zc;const o=t.initialCapital,i=t.commissionPct/100,r=t.slippagePct/100,a=t.priceTick&&t.priceTick>0?t.priceTick:null,l=t.qtyStep&&t.qtyStep>0?t.qtyStep:null,c=t.minQty&&t.minQty>0?t.minQty:null,d=t.spreadPct&&t.spreadPct>0?t.spreadPct/100:0,p=d>0?d/2:0,m=Math.max(1,Number(t.leverage)||1),h=t.maintenanceMarginPct&&t.maintenanceMarginPct>0?t.maintenanceMarginPct/100:null,_=t.liquidationFeePct&&t.liquidationFeePct>0?t.liquidationFeePct/100:null,w=t.borrowPctPerYear&&t.borrowPctPerYear>0?t.borrowPctPerYear/100:null,S=t.fundingPctPerDay&&t.fundingPctPerDay>0?t.fundingPctPerDay/100:null,P=t.maxDrawdownPct&&t.maxDrawdownPct>0?t.maxDrawdownPct/100:null,I=t.maxDrawdownCash&&t.maxDrawdownCash>0?t.maxDrawdownCash:null,C=t.maxPositionPct&&t.maxPositionPct>0?t.maxPositionPct/100:null,M=t.maxPositionCash&&t.maxPositionCash>0?t.maxPositionCash:null,F=t.maxPositionQty&&t.maxPositionQty>0?t.maxPositionQty:null,V=t.maxIntradayFilledOrders&&t.maxIntradayFilledOrders>0?Math.floor(t.maxIntradayFilledOrders):null,j=t.maxIntradayLossPct&&t.maxIntradayLossPct>0?t.maxIntradayLossPct/100:null,D=t.maxIntradayLossCash&&t.maxIntradayLossCash>0?t.maxIntradayLossCash:null,R=ce=>{if(!Number.isFinite(ce)||ce<=0)return 0;const st=String(ce),ge=st.match(/e-(\d+)$/i);if(ge)return Math.max(0,Math.min(12,Number(ge[1])||0));const Le=st.indexOf(".");return Le>=0?Math.max(0,Math.min(12,st.length-Le-1)):0},W=(ce,st,ge)=>{if(!Number.isFinite(ce))return NaN;if(!Number.isFinite(st)||st<=0)return ce;const Le=R(st),dt=Math.pow(10,Le),At=Math.round(st*dt);if(!Number.isFinite(At)||At<=0)return ce;const pt=ce*dt;return(ge==="ceil"?Math.ceil(pt/At-1e-12):ge==="round"?Math.round(pt/At):Math.floor(pt/At+1e-12))*At/dt},J=(ce,st)=>l?W(ce,l,st):ce,Z=(ce,st)=>ce==="entry"?st==="long":st==="short",G=(ce,st)=>p?Z(ce,st)?1+p:1-p:1,se=(ce,st,ge)=>{const Le=G(st,ge);return Le===1?ce:{o:ce.o*Le,h:ce.h*Le,l:ce.l*Le,c:ce.c*Le}},Y=(ce,st,ge,Le)=>{if(!a)return Le;const dt=Z(ce,st);return W(Le,a,ge==="limit"?dt?"floor":"ceil":dt?"ceil":"floor")},oe=(ce,st,ge)=>{if(!a)return ge;const dt=Z(ce,st)?"ceil":"floor";return W(ge,a,dt)};let ee=0,re=0;const me={long:[],short:[]},K=ce=>me[ce],ye=ce=>K(ce).some(st=>st.qty>1e-12),Me=()=>ye("long")||ye("short"),Fe=ce=>K(ce).filter(st=>st.qty>1e-12).length,Ze=ce=>ce==="long"?"short":"long",Ge=[],it=[],Ye=[],ct=new Map;let kt=1;const ft=[],bt=()=>`o${kt++}`,nt=ce=>{var ge;const st=Number((ge=n[ce])==null?void 0:ge.timestamp);return Number.isFinite(st)&&st>0?st:Date.now()},Pt=ce=>{const st=bt(),ge={id:st,...ce};return Ye.push(ge),ct.set(st,ge),ge},Qe=(ce,st)=>{if(!ce)return;const ge=ct.get(ce);ge&&Object.assign(ge,st)},yt=n.length,xe={initialCapital:o,finalEquity:o,netPnl:0,netPnlPct:0,grossProfit:0,grossLoss:0,profitFactor:0,trades:0,roundTrips:0,wins:0,losses:0,winRate:0,maxDrawdownPct:0,feesPaid:0,avgTrade:0,avgWin:0,avgLoss:0,payoffRatio:0,expectancy:0,maxConsecWins:0,maxConsecLosses:0,exposurePct:0,maxRunupPct:0,avgBarsInTrade:0,volatilityPct:0,sharpe:0,sortino:0,calmar:0};if(!yt)return{summary:xe,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]};const Ve=new Array(yt).fill(0),Je=new Array(yt).fill(0),St=new Array(yt).fill(0),Ne=new Array(yt).fill(0),ue=new Array(yt).fill(0),he=new Array(yt).fill(0),_t=new Array(yt).fill(0),Wt=new Array(yt).fill(0),jt=new Array(yt).fill(0),Zt=new Array(yt).fill(0),dn=new Array(yt).fill(0),zn=new Array(yt).fill(0),un=new Array(yt).fill(0),On=new Array(yt).fill(0),no=new Array(yt).fill(0),fs=new Array(yt).fill(0),ps=new Array(yt).fill(0),So=new Array(yt).fill(0),Es=new Array(yt).fill(0),Qo=new Array(yt).fill(o),Ko=new Array(yt).fill(0),oo=Array.from({length:yt},()=>[]);let Gs=0,jo=0,fi=0,ba=0,xa=0,Al=0,Qs=0,Fs="",Va=o,$r=!1;const cd=t.fromTs!=null&&Number.isFinite(t.fromTs)?t.fromTs:null,Sd=t.toTs!=null&&Number.isFinite(t.toTs)?t.toTs:null;let Nl=0,dd=yt-1;if(cd!=null){const ce=n.findIndex(st=>Number(st==null?void 0:st.timestamp)>=cd);if(ce>=0)Nl=ce;else return{summary:xe,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}if(Sd!=null){for(let ce=yt-1;ce>=0;ce--){const st=Number((Cc=n[ce])==null?void 0:Cc.timestamp);if(Number.isFinite(st)&&st<=Sd){dd=ce;break}}if(dd<Nl)return{summary:xe,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}const Cd=t.session,fa=ce=>{var pt;if(!Cd)return!0;const st=Number((pt=n[ce])==null?void 0:pt.timestamp);if(!Number.isFinite(st)||st<=0)return!0;const ge=new Date(st),Le=ge.getUTCHours()*60+ge.getUTCMinutes(),{startMin:dt,endMin:At}=Cd;return dt<=At?Le>=dt&&Le<=At:Le>=dt||Le<=At},Dl=(Array.isArray(e)?e:[]).filter(ce=>typeof(ce==null?void 0:ce.index)=="number"&&ce.index>=0).filter(ce=>ce.index>=Nl&&ce.index<=dd).filter(ce=>fa(ce.index)).slice().sort((ce,st)=>ce.index-st.index||w2(ce.type)-w2(st.type));let ml=0,gl=o,_d=0,Kl=0,ic=o,od=0,zd=0,Ec=1;const al={long:null,short:null},kc=(ce,st)=>{const ge=al[ce];if(ge)return ge;const Le={id:`t${Ec++}`,side:ce,entryIndex:st,entryTimestamp:nt(st),exitIndex:st,exitTimestamp:nt(st),qtyEntered:0,entryNotional:0,qtyExited:0,exitNotional:0,grossPnl:0,fees:0,entries:0,exits:0};return al[ce]=Le,Le},Vd=(ce,st)=>{if(ye(ce))return;const ge=al[ce];if(!ge)return;const Le=ge.qtyEntered,dt=Le>0?ge.entryNotional/Le:0,At=ge.qtyExited>0?ge.exitNotional/ge.qtyExited:0,pt=ge.entryNotional>0?ge.grossPnl/ge.entryNotional*100:0;it.push({id:ge.id,side:ge.side,entryIndex:ge.entryIndex,entryTimestamp:ge.entryTimestamp,exitIndex:ge.exitIndex,exitTimestamp:ge.exitTimestamp,qty:Le,avgEntryPrice:dt,avgExitPrice:At,grossPnl:ge.grossPnl,fees:ge.fees,netPnl:ge.grossPnl-ge.fees,pnlPct:pt,entries:ge.entries,exits:ge.exits,maePct:typeof ge.maeMin=="number"&&Number.isFinite(ge.maeMin)?ge.maeMin:void 0,mfePct:typeof ge.mfeMax=="number"&&Number.isFinite(ge.mfeMax)?ge.mfeMax:void 0}),al[ce]=null},sd=(ce,st)=>{let ge=0;for(const Le of K("long"))Le.qty<=0||(ge+=(st-Le.entryPrice)*Le.qty);for(const Le of K("short"))Le.qty<=0||(ge+=(Le.entryPrice-st)*Le.qty);return o+ee+ge-re},id=ce=>{let st=0;for(const ge of K("long"))ge.qty<=0||(st+=(ce-ge.entryPrice)*ge.qty);for(const ge of K("short"))ge.qty<=0||(st+=(ge.entryPrice-ce)*ge.qty);return Number.isFinite(st)?st:0},Pd=()=>{let ce=0,st=0,ge=0,Le=0;for(const At of K("long"))At.qty<=0||(ce+=At.qty,st+=At.entryPrice*At.qty);for(const At of K("short"))At.qty<=0||(ge+=At.qty,Le+=At.entryPrice*At.qty);const dt=ce-ge;return dt>0&&ce>0?st/ce:dt<0&&ge>0?Le/ge:0},Ed=(ce,st)=>{if(t.orderSize.type==="cash")return Math.max(0,t.orderSize.value)*m;if(t.orderSize.type==="qty")return Math.max(0,t.orderSize.value*st);const ge=Math.max(0,Math.min(100,t.orderSize.value));return ce*ge/100*m},zl=()=>{let ce=0;for(const st of K("long"))ce+=st.qty>0?st.entryNotional:0;for(const st of K("short"))ce+=st.qty>0?st.entryNotional:0;return ce},Gd=()=>m>0?zl()/m:0,lu=ce=>{const st=Number(ce);if(!Number.isFinite(st)||st<=0)return{long:0,short:0,total:0};let ge=0,Le=0;for(const dt of K("long"))ge+=dt.qty>0?dt.qty*st:0;for(const dt of K("short"))Le+=dt.qty>0?dt.qty*st:0;return{long:ge,short:Le,total:ge+Le}},Yd=(ce,st,ge)=>{var uo,hs;if(!Me()||!w&&!S||ce<=ge)return;const Le=Number((uo=n[ce-1])==null?void 0:uo.timestamp),dt=Number((hs=n[ce])==null?void 0:hs.timestamp);if(!Number.isFinite(Le)||!Number.isFinite(dt)||dt<=Le)return;const At=dt-Le,pt=At/864e5,at=At/(365*864e5);if(!Number.isFinite(pt)||pt<=0)return;const Ct=lu(st);let Re=0,kn=0;S&&(Re=Math.max(0,Ct.total*S*pt)),w&&(kn=Math.max(0,Ct.short*w*at));const ro=Re+kn;if(!(!Number.isFinite(ro)||ro<=0)){if(re+=ro,Re>0&&Ct.total>0){const Ei=Re*Ct.long/Ct.total,ei=Re-Ei;al.long&&(al.long.fees+=Ei),al.short&&(al.short.fees+=ei)}kn>0&&al.short&&(al.short.fees+=kn)}},eu=(ce,st,ge)=>{if(!Me())return!1;const Le=nt(ce);let dt=!1;for(const At of["long","short"]){if(!ye(At))continue;const pt=Pt({action:"exit",side:At,kind:"market",originalKind:"market",status:"pending",createdIndex:ce,createdTimestamp:Le,activeFromIndex:ce,qtyPct:100,price:st,note:ge}),at=Ho(At,ce,st,"liquidation","market",{orderId:pt.id},_??void 0);at?(Qe(pt.id,{status:"filled",filledIndex:ce,filledTimestamp:Le,fillPrice:at.execPrice,fillQty:at.qtyClosed,fees:at.exitFees}),dt=!0):Qe(pt.id,{status:"rejected",note:`${ge} (no fill)`})}if(dt&&ns.length){for(const At of ns)Qe(At.orderId,{status:"canceled",note:"Canceled on liquidation"});ns.length=0}return dt},Ju=(ce,st)=>{if(!h||!Me())return!1;const ge=Ct=>{const Re=sd(ce,Ct),ro=lu(Ct).total*h;return{px:Ct,equityNow:Re,req:ro,gap:Re-ro}},Le=ge(st.l),dt=ge(st.h),At=Number.isFinite(Le.gap)&&Le.gap<=1e-9,pt=Number.isFinite(dt.gap)&&dt.gap<=1e-9;if(!At&&!pt)return!1;const at=At&&pt?Le.gap<=dt.gap?Le:dt:At?Le:dt;return eu(ce,at.px,"AUTO liquidation")},mu=(ce,st,ge,Le)=>{const dt=Le&&typeof Le.slippageRate=="number"&&Number.isFinite(Le.slippageRate)?Math.max(0,Le.slippageRate):r;if(ge==="limit")return oe("entry",ce,st);const At=st*G("entry",ce),pt=ce==="long"?At*(1+dt):At*(1-dt);return oe("entry",ce,pt)},yd=(ce,st,ge,Le)=>{const dt=Le&&typeof Le.slippageRate=="number"&&Number.isFinite(Le.slippageRate)?Math.max(0,Le.slippageRate):r;if(ge==="limit")return oe("exit",ce,st);const At=st*G("exit",ce),pt=ce==="long"?At*(1-dt):At*(1+dt);return oe("exit",ce,pt)},tn=ce=>{if(!ce||typeof ce!="object")return;const st=Re=>{const kn=typeof Re=="number"?Re:Number(Re);return Number.isFinite(kn)?kn:void 0},ge=st(ce.stopLossPct),Le=st(ce.takeProfitPct),dt=st(ce.trailingStopPct),At=ce.takeProfits,pt=[];if(Array.isArray(At))for(const Re of At){if(!Re||typeof Re!="object")continue;const kn=st(Re.takeProfitPct),ro=st(Re.qtyPct);kn==null||kn<=0||ro==null||ro<=0||pt.push({takeProfitPct:Math.max(0,kn),qtyPct:Math.max(0,Math.min(100,ro))})}pt.sort((Re,kn)=>Re.takeProfitPct-kn.takeProfitPct);let at=0;const Ct=[];for(const Re of pt){if(at>=100)break;const kn=100-at,ro=Math.min(kn,Re.qtyPct);ro<=0||(Ct.push({takeProfitPct:Re.takeProfitPct,qtyPct:ro}),at+=ro)}if(!(ge==null&&Le==null&&dt==null&&Ct.length===0))return{stopLossPct:ge,takeProfitPct:Le,trailingStopPct:dt,takeProfits:Ct.length?Ct:void 0}},En=(ce,st,ge,Le=100,dt="market",At,pt,at)=>{var Nc,Tc,Sl;if(t.positionMode==="netting"&&ye(Ze(ce)))return{ok:!1,reject:"Netting mode: opposite position open"};if($r)return{ok:!1,reject:"Risk limit reached"};if(V!=null&&Qs>=V)return{ok:!1,reject:"Max intraday filled orders reached"};if(Fe(ce)>=t.pyramiding)return{ok:!1,reject:`Pyramiding limit reached (${t.pyramiding})`};const Ct=sd(st,ge),Re=mu(ce,ge,dt,at);if(!Number.isFinite(Re)||Re<=0)return{ok:!1,reject:"Invalid fill price"};const kn=at&&typeof at.qty=="number"&&Number.isFinite(at.qty)?Math.abs(at.qty):null,ro=at&&typeof at.cash=="number"&&Number.isFinite(at.cash)?Math.abs(at.cash):null;let uo=0;if(kn!=null)uo=kn;else if(ro!=null)uo=ro*m/Re;else{const Ks=Number.isFinite(Le)?Math.max(0,Math.min(100,Le)):100;if(Ks<=0)return{ok:!1,reject:"qtyPct <= 0"};const ci=Ed(Ct,Re)*Ks/100;if(!Number.isFinite(ci)||ci<=0)return{ok:!1,reject:"Notional <= 0"};uo=ci/Re}if(!Number.isFinite(uo)||uo<=0)return{ok:!1,reject:"Qty <= 0"};const hs=J(uo,"floor");if(!Number.isFinite(hs)||hs<=0)return l?{ok:!1,reject:`Qty rounded to 0 (qtyStep=${l})`}:{ok:!1,reject:"Qty <= 0"};if(c!=null&&hs<c)return{ok:!1,reject:`Qty ${hs} < minQty ${c}`};if(F!=null&&Eo(ce)+hs>F)return{ok:!1,reject:"Max position qty exceeded"};if(M!=null&&lu(Re)[ce]+hs*Re>M)return{ok:!1,reject:"Max position cash exceeded"};if(C!=null&&C>0){const ci=lu(Re)[ce]+hs*Re,Lo=Ct*C;if(Lo>0&&ci>Lo)return{ok:!1,reject:"Max position percent exceeded"}}const Ei=Re*hs,ei=m>0?Ei/m:Ei,Ys=Gd();if(ei>0&&Ys+ei>Ct+1e-9)return{ok:!1,reject:"Insufficient margin"};const Ht=at&&typeof at.commissionRate=="number"&&Number.isFinite(at.commissionRate)?Math.max(0,at.commissionRate):i,qe=Ei*Ht;re+=qe;{const Ks=kc(ce,st);Ks.qtyEntered+=hs,Ks.entryNotional+=Ei,Ks.fees+=qe,Ks.entries+=1}const fn=t.closeMethod==="avg"?void 0:tn(At),Fn=(fn==null?void 0:fn.stopLossPct)!=null?fn.stopLossPct:t.stopLossPct,Vt=(fn==null?void 0:fn.takeProfitPct)!=null?fn.takeProfitPct:t.takeProfitPct,mn=(fn==null?void 0:fn.trailingStopPct)!=null?fn.trailingStopPct:t.trailingStopPct,Kn=Fn&&Fn>0?ce==="long"?Re*(1-Fn/100):Re*(1+Fn/100):null,Pn=Vt&&Vt>0?ce==="long"?Re*(1+Vt/100):Re*(1-Vt/100):null,Hn=Kn!=null&&Number.isFinite(Kn)?Y("exit",ce,"stop",Kn):null,No=Pn!=null&&Number.isFinite(Pn)?Y("exit",ce,"limit",Pn):null,Mo={side:ce,qty:hs,entryIndex:st,entryTimestamp:((Nc=n[st])==null?void 0:Nc.timestamp)??Date.now(),entryPrice:Re,entrySignalId:pt==null?void 0:pt.signalId,entryOrderId:pt==null?void 0:pt.orderId,entrySignalScore:(pt==null?void 0:pt.score)??null,entryNotional:Ei,entryFee:qe,entryFeeRemaining:qe,stopPrice:Hn&&Number.isFinite(Hn)?Hn:null,takePrice:No&&Number.isFinite(No)?No:null,trailingPct:mn,trailingStop:mn&&mn>0?ce==="long"?Y("exit",ce,"stop",Re*(1-mn/100)):Y("exit",ce,"stop",Re*(1+mn/100)):null,takeProfitOrders:[],maxFav:Re,maxAdv:Re},qs=(Tc=fn==null?void 0:fn.takeProfits)!=null&&Tc.length?fn.takeProfits:t.takeProfits;if(qs!=null&&qs.length){const Ks=[];let ci=0;for(const Lo of qs){if(ci>=hs)break;const ln=Math.max(0,Math.min(hs-ci,hs*Lo.qtyPct/100)),or=J(ln,"floor");if(!Number.isFinite(or)||or<=0||c!=null&&or<c&&or<hs-ci-1e-12)continue;const tr=ce==="long"?Re*(1+Lo.takeProfitPct/100):Re*(1-Lo.takeProfitPct/100),Zi=Y("exit",ce,"limit",tr);!Number.isFinite(Zi)||Zi<=0||(Ks.push({price:Zi,qty:or,pct:Lo.takeProfitPct}),ci+=or)}Mo.takeProfitOrders=Ks.sort((Lo,ln)=>ce==="long"?Lo.price-ln.price:ln.price-Lo.price)}Qs+=1;const ta=K(ce);if(t.closeMethod==="avg"&&ta.length){const Ks=ta[0],ci=Ks.qty+Mo.qty,Lo=Ks.entryNotional+Mo.entryNotional,ln=ci>0?Lo/ci:Ks.entryPrice;Ks.qty=ci,Ks.entryNotional=Lo,Ks.entryPrice=ln,Ks.entryFee+=Mo.entryFee,Ks.entryFeeRemaining+=Mo.entryFeeRemaining;const or=t.stopLossPct,tr=t.takeProfitPct,Zi=t.trailingStopPct,Yt=or&&or>0?ce==="long"?ln*(1-or/100):ln*(1+or/100):null,Xo=tr&&tr>0?ce==="long"?ln*(1+tr/100):ln*(1-tr/100):null;if(Ks.stopPrice=Yt!=null&&Number.isFinite(Yt)?Y("exit",ce,"stop",Yt):null,Ks.takePrice=Xo!=null&&Number.isFinite(Xo)?Y("exit",ce,"limit",Xo):null,Ks.trailingPct=Zi,Ks.trailingStop=Zi&&Zi>0?ce==="long"?Y("exit",ce,"stop",ln*(1-Zi/100)):Y("exit",ce,"stop",ln*(1+Zi/100)):null,Ks.takeProfitOrders=[],(Sl=t.takeProfits)!=null&&Sl.length){const as=[];let Pi=0;for(const As of t.takeProfits){if(Pi>=Ks.qty)break;const Xs=Math.max(0,Math.min(Ks.qty-Pi,Ks.qty*As.qtyPct/100)),Hr=J(Xs,"floor");if(!Number.isFinite(Hr)||Hr<=0)continue;const Xl=ce==="long"?ln*(1+As.takeProfitPct/100):ln*(1-As.takeProfitPct/100),Nd=Y("exit",ce,"limit",Xl);!Number.isFinite(Nd)||Nd<=0||(as.push({price:Nd,qty:Hr,pct:As.takeProfitPct}),Pi+=Hr)}Ks.takeProfitOrders=as.sort((As,Xs)=>ce==="long"?As.price-Xs.price:Xs.price-As.price)}return Ks.maxFav=Ks.maxFav==null?ln:Ks.maxFav,Ks.maxAdv=Ks.maxAdv==null?ln:Ks.maxAdv,{ok:!0,lot:Ks}}return ta.push(Mo),{ok:!0,lot:Mo}},go=(ce,st,ge,Le,dt)=>{const At=Eo(ce);if(!Number.isFinite(At)||At<=0)return 0;if(Le!=null&&Number.isFinite(Le)){const at=Math.abs(Le);return at>0?Math.min(At,at):0}if(dt!=null&&Number.isFinite(dt)){const at=Math.abs(dt);if(at<=0||!Number.isFinite(st)||st<=0)return 0;const Re=(m>0?at*m:at)/st;return Number.isFinite(Re)&&Re>0?Math.min(At,Re):0}const pt=Number.isFinite(ge)?Math.max(0,Math.min(100,ge)):100;return pt<=0?0:At*pt/100},hn=(ce,st,ge,Le="signal",dt,At="market",pt,at,Ct)=>{var Kn;const Re=ce.side;l&&(ce.qty=J(ce.qty,"round"));const kn=yd(Re,ge,At,Ct);if(!Number.isFinite(kn)||kn<=0)return null;const ro=ce.qty,uo=dt==null?ro:Math.max(0,Math.min(ro,dt)),hs=dt==null?l?J(uo,"round"):uo:l?J(uo,"floor"):uo;if(!Number.isFinite(hs)||hs<=0||c!=null&&dt!=null&&hs<c&&hs<ro-1e-12)return null;const Ei=ro>0&&Number.isFinite(ce.entryFeeRemaining)?ce.entryFeeRemaining*hs/ro:0,ei=kn*hs,Ys=Ct&&typeof Ct.commissionRate=="number"&&Number.isFinite(Ct.commissionRate)?Math.max(0,Ct.commissionRate):i,Ht=ei*Ys,qe=at&&at>0?ei*at:0;re+=Ht,re+=qe;const fn=Re==="long"?(kn-ce.entryPrice)*hs:(ce.entryPrice-kn)*hs;ee+=fn;{const Pn=kc(Re,ce.entryIndex);Pn.qtyExited+=hs,Pn.exitNotional+=ei,Pn.grossPnl+=fn,Pn.fees+=Ei+Ht+qe,Pn.exits+=1,Pn.exitIndex=st,Pn.exitTimestamp=nt(st)}const Fn=Number.isFinite(ce.entryPrice)&&ce.entryPrice>0?ce.entryPrice*hs:NaN,Vt=(()=>{if(!(ce.entryPrice<=0)&&!(ce.maxAdv==null||!Number.isFinite(ce.maxAdv)))return ce.side==="long"?(ce.maxAdv-ce.entryPrice)/ce.entryPrice*100:(ce.entryPrice-ce.maxAdv)/ce.entryPrice*100})(),mn=(()=>{if(!(ce.entryPrice<=0)&&!(ce.maxFav==null||!Number.isFinite(ce.maxFav)))return ce.side==="long"?(ce.maxFav-ce.entryPrice)/ce.entryPrice*100:(ce.entryPrice-ce.maxFav)/ce.entryPrice*100})();Ge.push({side:Re,qty:hs,entryIndex:ce.entryIndex,entryTimestamp:ce.entryTimestamp,entryPrice:ce.entryPrice,entrySignalId:ce.entrySignalId,entryOrderId:ce.entryOrderId,entrySignalScore:ce.entrySignalScore??null,exitIndex:st,exitTimestamp:((Kn=n[st])==null?void 0:Kn.timestamp)??Date.now(),exitPrice:kn,exitSignalId:pt==null?void 0:pt.signalId,exitOrderId:pt==null?void 0:pt.orderId,exitSignalScore:(pt==null?void 0:pt.score)??null,exitReason:Le,pnl:fn,pnlPct:Number.isFinite(Fn)&&Fn>0?fn/Fn*100:0,fees:Ei+Ht+qe,maePct:typeof Vt=="number"&&Number.isFinite(Vt)?Vt:void 0,mfePct:typeof mn=="number"&&Number.isFinite(mn)?mn:void 0}),Al+=Math.max(0,st-ce.entryIndex+1),Gs+=Ei+Ht+qe,fn>0?(jo+=fn,ba+=1):fn<0&&(fi+=Math.abs(fn),xa+=1);try{const Pn=al[Re];typeof Vt=="number"&&Number.isFinite(Vt)&&Pn&&(Pn.maeMin=Pn.maeMin==null?Vt:Math.min(Pn.maeMin,Vt)),typeof mn=="number"&&Number.isFinite(mn)&&Pn&&(Pn.mfeMax=Pn.mfeMax==null?mn:Math.max(Pn.mfeMax,mn))}catch{}return ce.qty-=hs,l&&(ce.qty=J(ce.qty,"round")),ce.entryFeeRemaining=Math.max(0,ce.entryFeeRemaining-Ei),ce.qty<=1e-12&&(ce.entryFeeRemaining=0),{qtyClosed:hs,fees:Ei+Ht+qe,exitFee:Ht+qe,execPrice:kn}},Ho=(ce,st,ge,Le="signal",dt="market",At,pt,at)=>{const Ct=K(ce);if(!Ct.length)return null;const Re=Ct.slice();let kn=0,ro=0,uo=0,hs=0;for(const Ei of Re)if(Ei.qty>0){const ei=hn(Ei,st,ge,Le,Ei.qty,dt,At,pt,at);ei&&(kn+=ei.qtyClosed,ro+=ei.fees,uo+=ei.exitFee,hs+=ei.execPrice*ei.qtyClosed)}return me[ce]=K(ce).filter(Ei=>Ei.qty>1e-12),Vd(ce),kn<=0?null:{qtyClosed:kn,fees:ro,exitFees:uo,execPrice:hs/kn}},Eo=ce=>{const st=K(ce);return st.length?st.reduce((ge,Le)=>ge+(Le.qty>0?Le.qty:0),0):0},di=(ce,st,ge,Le,dt="signal",At="market",pt,at,Ct)=>{const Re=K(ce);if(!Re.length)return null;let kn=Math.max(0,Le),ro=0,uo=0,hs=0,Ei=0;const ei=t.closeMethod==="lifo"?Re.slice().reverse():Re;for(const Ys of ei){if(kn<=0)break;if(Ys.qty<=0)continue;const Ht=Math.min(Ys.qty,kn),qe=hn(Ys,st,ge,dt,Ht,At,pt,at,Ct);qe&&(ro+=qe.qtyClosed,uo+=qe.fees,hs+=qe.exitFee,Ei+=qe.execPrice*qe.qtyClosed),kn-=Ht}return me[ce]=K(ce).filter(Ys=>Ys.qty>1e-12),Vd(ce),ro<=0?null:{qtyClosed:ro,fees:uo,exitFees:hs,execPrice:Ei/ro}},ns=[],$i=(ce,st)=>{for(let ge=ns.length-1;ge>=0;ge--){const Le=ns[ge];ce(Le)&&(Qe(Le.orderId,{status:"canceled",note:st}),ns.splice(ge,1))}},hi=(ce,st)=>{if(!ce)return;const ge=String(ce).trim();ge&&$i(Le=>String(Le.signalId||"")===ge||String(Le.orderId||"")===ge,st)},li=ce=>{$i(()=>!0,ce)},ks=ce=>(ce==null?void 0:ce.order)||{},Vi=ce=>{const st=typeof ce=="number"?ce:Number(ce);return!Number.isFinite(st)||st<=0?100:Math.max(0,Math.min(100,st))},gs=ce=>{const st=typeof ce=="number"?ce:Number(ce);return Number.isFinite(st)?Math.max(0,st):null},ll=ce=>{const st=String(ce||"market").trim().toLowerCase();return st==="limit"?"limit":st==="stop"?"stop":"market"},mi=(ce,st,ge,Le,dt)=>Number.isFinite(dt)?ce==="entry"?st==="long"?ge==="limit"?Le.l<=dt:Le.h>=dt:ge==="limit"?Le.h>=dt:Le.l<=dt:st==="long"?ge==="limit"?Le.h>=dt:Le.l<=dt:ge==="limit"?Le.l<=dt:Le.h>=dt:!1,Na=(ce,st,ge)=>{for(const Le of ge)ce.side==="long"?Le==="high"?ce.maxFav=ce.maxFav==null?st.h:Math.max(ce.maxFav,st.h):ce.maxAdv=ce.maxAdv==null?st.l:Math.min(ce.maxAdv,st.l):Le==="low"?ce.maxFav=ce.maxFav==null?st.l:Math.min(ce.maxFav,st.l):ce.maxAdv=ce.maxAdv==null?st.h:Math.max(ce.maxAdv,st.h)},le=ce=>t.intrabarTieBreak==="ohlc"?t.ohlcPath==="open_high_low_close"?["high","low"]:["low","high"]:t.intrabarTieBreak==="best_case"?ce==="long"?["high","low"]:["low","high"]:ce==="long"?["low","high"]:["high","low"],we=ce=>{const{lot:st,i:ge,triggerPx:Le,reason:dt,qty:At,fillKind:pt,note:at}=ce;if(!Number.isFinite(Le)||Le<=0||!Number.isFinite(At)||At<=0)return!1;const Ct=pt==="limit"?"limit":"stop",Re=nt(ge),kn=Pt({action:"exit",side:st.side,kind:Ct,originalKind:Ct,status:"pending",createdIndex:ge,createdTimestamp:Re,activeFromIndex:ge,qtyPct:100,price:Le,note:at}),ro=hn(st,ge,Le,dt,At,pt,{orderId:kn.id});return ro?(Qe(kn.id,{status:"filled",filledIndex:ge,filledTimestamp:Re,fillPrice:ro.execPrice,fillQty:ro.qtyClosed,fees:ro.exitFee,note:at}),!0):(Qe(kn.id,{status:"rejected",note:`${at} (no fill)`}),!1)},H=(ce,st,ge,Le)=>{if(!ye(ce)||t.execution!=="intrabar_ohlc")return!1;let dt=!1;const At=pt=>{var at,Ct;for(const Re of K(ce)){if(Re.qty<=0)continue;const kn=se(ge,"exit",Re.side);if(Re.trailingPct&&Re.trailingPct>0){const ro=Re.trailingPct/100;if(Re.side==="long"&&pt==="high"){const uo=ge.h*(1-ro);Re.trailingStop=Re.trailingStop==null?uo:Math.max(Re.trailingStop,uo)}if(Re.side==="short"&&pt==="low"){const uo=ge.l*(1+ro);Re.trailingStop=Re.trailingStop==null?uo:Math.min(Re.trailingStop,uo)}}if(Re.side==="long"&&pt==="high"){if((at=Re.takeProfitOrders)!=null&&at.length){const ro=[];for(const uo of Re.takeProfitOrders){if(Re.qty<=0)break;kn.h>=uo.price?dt=we({lot:Re,i:st,triggerPx:uo.price,reason:"take_profit",qty:uo.qty,fillKind:"limit",note:`AUTO take_profit (${uo.pct}%)`})||dt:ro.push(uo)}Re.takeProfitOrders=ro}Re.takePrice!=null&&kn.h>=Re.takePrice&&Re.qty>0&&(dt=we({lot:Re,i:st,triggerPx:Re.takePrice,reason:"take_profit",qty:Re.qty,fillKind:"limit",note:"AUTO take_profit"})||dt)}if(Re.side==="short"&&pt==="low"){if((Ct=Re.takeProfitOrders)!=null&&Ct.length){const ro=[];for(const uo of Re.takeProfitOrders){if(Re.qty<=0)break;kn.l<=uo.price?dt=we({lot:Re,i:st,triggerPx:uo.price,reason:"take_profit",qty:uo.qty,fillKind:"limit",note:`AUTO take_profit (${uo.pct}%)`})||dt:ro.push(uo)}Re.takeProfitOrders=ro}Re.takePrice!=null&&kn.l<=Re.takePrice&&Re.qty>0&&(dt=we({lot:Re,i:st,triggerPx:Re.takePrice,reason:"take_profit",qty:Re.qty,fillKind:"limit",note:"AUTO take_profit"})||dt)}if(Re.side==="long"&&pt==="low"){if(Re.stopPrice!=null&&kn.l<=Re.stopPrice){dt=we({lot:Re,i:st,triggerPx:Re.stopPrice,reason:"stop_loss",qty:Re.qty,fillKind:"stop",note:"AUTO stop_loss"})||dt;continue}Re.trailingStop!=null&&kn.l<=Re.trailingStop&&(dt=we({lot:Re,i:st,triggerPx:Re.trailingStop,reason:"trailing_stop",qty:Re.qty,fillKind:"stop",note:"AUTO trailing_stop"})||dt)}if(Re.side==="short"&&pt==="high"){if(Re.stopPrice!=null&&kn.h>=Re.stopPrice){dt=we({lot:Re,i:st,triggerPx:Re.stopPrice,reason:"stop_loss",qty:Re.qty,fillKind:"stop",note:"AUTO stop_loss"})||dt;continue}Re.trailingStop!=null&&kn.h>=Re.trailingStop&&(dt=we({lot:Re,i:st,triggerPx:Re.trailingStop,reason:"trailing_stop",qty:Re.qty,fillKind:"stop",note:"AUTO trailing_stop"})||dt)}}me[ce]=K(ce).filter(Re=>Re.qty>1e-12),Vd(ce)};for(const pt of Le){if(!ye(ce))break;At(pt)}return dt},ne=(ce,st)=>{if(ce)for(let ge=ns.length-1;ge>=0;ge--){const Le=ns[ge];(Le==null?void 0:Le.ocoGroup)===ce&&(st&&Le.orderId===st||(Qe(Le.orderId,{status:"canceled",note:"OCO canceled"}),ns.splice(ge,1)))}},_e=(ce,st,ge)=>ce==="entry"?st==="long"?ge==="limit"?"low":"high":ge==="limit"?"high":"low":st==="long"?ge==="limit"?"high":"low":ge==="limit"?"low":"high",q=(ce,st,ge,Le,dt)=>{const At=dt.o;if(!Number.isFinite(At)||!Number.isFinite(Le))return{px:Le,fillsAtOpen:!1};const pt=At*G(ce,st);return ge==="limit"?ce==="entry"&&st==="long"&&At<=Le||ce==="entry"&&st==="short"&&At>=Le||ce==="exit"&&st==="long"&&At>=Le||ce==="exit"&&st==="short"&&At<=Le?{px:pt,fillsAtOpen:!0}:{px:Le,fillsAtOpen:!1}:ce==="entry"&&st==="long"&&At>=Le||ce==="entry"&&st==="short"&&At<=Le||ce==="exit"&&st==="long"&&At<=Le||ce==="exit"&&st==="short"&&At>=Le?{px:At,fillsAtOpen:!0}:{px:Le,fillsAtOpen:!1}},De=(ce,st,ge)=>{var pt,at;if(!ye(ce)||t.execution!=="intrabar_ohlc")return!1;const Le=ge.o;if(!Number.isFinite(Le)||Le<=0)return!1;const dt=Le*G("exit",ce);let At=!1;for(const Ct of K(ce).slice())if(!(Ct.qty<=0))if(Ct.side==="long"){if(Ct.stopPrice!=null&&dt<=Ct.stopPrice){At=we({lot:Ct,i:st,triggerPx:Le,reason:"stop_loss",qty:Ct.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||At;continue}if(Ct.trailingStop!=null&&dt<=Ct.trailingStop){At=we({lot:Ct,i:st,triggerPx:Le,reason:"trailing_stop",qty:Ct.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||At;continue}if((pt=Ct.takeProfitOrders)!=null&&pt.length){const Re=[];for(const kn of Ct.takeProfitOrders){if(Ct.qty<=0)break;dt>=kn.price?At=we({lot:Ct,i:st,triggerPx:dt,reason:"take_profit",qty:kn.qty,fillKind:"limit",note:`AUTO take_profit (${kn.pct}%) (gap)`})||At:Re.push(kn)}Ct.takeProfitOrders=Re}Ct.takePrice!=null&&dt>=Ct.takePrice&&Ct.qty>0&&(At=we({lot:Ct,i:st,triggerPx:dt,reason:"take_profit",qty:Ct.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||At)}else{if(Ct.stopPrice!=null&&dt>=Ct.stopPrice){At=we({lot:Ct,i:st,triggerPx:Le,reason:"stop_loss",qty:Ct.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||At;continue}if(Ct.trailingStop!=null&&dt>=Ct.trailingStop){At=we({lot:Ct,i:st,triggerPx:Le,reason:"trailing_stop",qty:Ct.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||At;continue}if((at=Ct.takeProfitOrders)!=null&&at.length){const Re=[];for(const kn of Ct.takeProfitOrders){if(Ct.qty<=0)break;dt<=kn.price?At=we({lot:Ct,i:st,triggerPx:dt,reason:"take_profit",qty:kn.qty,fillKind:"limit",note:`AUTO take_profit (${kn.pct}%) (gap)`})||At:Re.push(kn)}Ct.takeProfitOrders=Re}Ct.takePrice!=null&&dt<=Ct.takePrice&&Ct.qty>0&&(At=we({lot:Ct,i:st,triggerPx:dt,reason:"take_profit",qty:Ct.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||At)}return me[ce]=K(ce).filter(Ct=>Ct.qty>1e-12),Vd(ce),At},ot=(ce,st)=>{if(!ns.length)return;if($r){li("Canceled by risk limit");return}V!=null&&Qs>=V&&$i(at=>at.action==="entry","Max intraday filled orders reached");for(let at=ns.length-1;at>=0;at--){const Ct=ns[at];if(!(ce<Ct.activeFromIndex)){if(Ct.expiresAtIndex!=null&&ce>Ct.expiresAtIndex){Qe(Ct.orderId,{status:"expired",note:"Expired"}),ns.splice(at,1);continue}if(Ct.action==="exit"&&!ye(Ct.side)){Qe(Ct.orderId,{status:"canceled",note:"No position"}),ns.splice(at,1);continue}}}const ge=[];for(let at=0;at<ns.length;at++){const Ct=ns[at];if(ce<Ct.activeFromIndex||Ct.expiresAtIndex!=null&&ce>Ct.expiresAtIndex)continue;const Re=se(st,Ct.action,Ct.side);if(Ct.action==="exit"){if(!ye(Ct.side))continue}else if(Fe(Ct.side)>=t.pyramiding)continue;const kn=Ct.ocoGroup||`__solo__${Ct.orderId||at}`,ro=Ct.action==="exit"?0:1,uo=le(Ct.side);if(Ct.kind==="stop_limit"){const Vt=Ct.stopPrice??Ct.price,mn=Ct.limitPrice??Ct.price;if(!Number.isFinite(Vt)||!Number.isFinite(mn)||!mi(Ct.action,Ct.side,"stop",Re,Vt))continue;const Pn=_e(Ct.action,Ct.side,"stop"),Hn=uo.indexOf(Pn),No=q(Ct.action,Ct.side,"stop",Vt,st),Mo=No.fillsAtOpen?0:Hn>=0?Hn+1:99,qs=Pn==="high"?Vt:-Vt;ge.push({groupKey:kn,orderId:Ct.orderId,pi:at,action:Ct.action,side:Ct.side,kind:"stop_limit",triggerExt:Pn,phase:Mo,actionRank:ro,priceRank:qs,sp:Vt,lp:mn,stopAtOpen:No.fillsAtOpen,limitAtOpen:q(Ct.action,Ct.side,"limit",mn,st).fillsAtOpen});continue}const hs=Ct.price;if(hs==null||!Number.isFinite(hs)||!(Ct.kind==="limit"?mi(Ct.action,Ct.side,"limit",Re,hs):mi(Ct.action,Ct.side,"stop",Re,hs)))continue;const ei=Ct.kind,Ys=_e(Ct.action,Ct.side,ei),Ht=uo.indexOf(Ys),fn=q(Ct.action,Ct.side,ei,hs,st).fillsAtOpen?0:Ht>=0?Ht+1:99,Fn=Ys==="high"?hs:-hs;ge.push({groupKey:kn,orderId:Ct.orderId,pi:at,action:Ct.action,side:Ct.side,kind:ei,triggerExt:Ys,phase:fn,actionRank:ro,priceRank:Fn,px:hs})}if(!ge.length)return;const Le=new Map,dt=(at,Ct)=>at.phase!==Ct.phase?at.phase<Ct.phase?at:Ct:at.actionRank!==Ct.actionRank?at.actionRank<Ct.actionRank?at:Ct:at.priceRank!==Ct.priceRank?at.priceRank<Ct.priceRank?at:Ct:at.pi<Ct.pi?at:Ct;for(const at of ge){const Ct=Le.get(at.groupKey);Le.set(at.groupKey,Ct?dt(Ct,at):at)}const At=Array.from(Le.values()).sort((at,Ct)=>at.phase!==Ct.phase?at.phase-Ct.phase:at.actionRank!==Ct.actionRank?at.actionRank-Ct.actionRank:at.priceRank!==Ct.priceRank?at.priceRank-Ct.priceRank:at.pi-Ct.pi),pt=(at,Ct)=>{if(at){const Re=ns.findIndex(kn=>kn.orderId===at);if(Re>=0)return Re}return typeof Ct=="number"?Ct:-1};for(const at of At){const Ct=pt(at.orderId,at.pi);if(Ct<0||Ct>=ns.length)continue;const Re=ns[Ct],kn=Re.slippageRate!=null||Re.commissionRate!=null?{slippageRate:Re.slippageRate,commissionRate:Re.commissionRate}:void 0;if(ce<Re.activeFromIndex||Re.expiresAtIndex!=null&&ce>Re.expiresAtIndex)continue;const ro=se(st,Re.action,Re.side);if(Re.action==="exit"){if(!ye(Re.side)){Qe(Re.orderId,{status:"canceled",note:"No position"}),ns.splice(Ct,1);continue}}else if(Fe(Re.side)>=t.pyramiding)continue;if(Re.kind==="stop_limit"){const Vt=Re.stopPrice??Re.price,mn=Re.limitPrice??Re.price;if(!Number.isFinite(Vt)||!Number.isFinite(mn)||!mi(Re.action,Re.side,"stop",ro,Vt))continue;const Pn=mi(Re.action,Re.side,"limit",ro,mn),Hn=_e(Re.action,Re.side,"stop"),No=_e(Re.action,Re.side,"limit"),Mo=le(Re.side),qs=Mo.indexOf(Hn),ta=Mo.indexOf(No);if(Pn&&qs>=0&&ta>=0&&qs<ta){const Sl=q(Re.action,Re.side,"limit",mn,st).px;if(Re.action==="entry"){const Lo=En(Re.side,ce,Sl,Re.qtyPct,"limit",Re.bracket,{orderId:Re.orderId,signalId:Re.signalId,score:Re.score??null},{qty:Re.qty,cash:Re.cash,...kn});if(Lo.ok){const ln=Lo.lot;Qe(Re.orderId,{status:"filled",filledIndex:ce,filledTimestamp:nt(ce),fillPrice:ln.entryPrice,fillQty:ln.qty,fees:ln.entryFee})}else Qe(Re.orderId,{status:"rejected",note:Lo.reject||"Entry not filled"});if(Lo.ok&&t.execution==="intrabar_ohlc"){const ln=Lo.lot,or=Hn,tr=le(Re.side),Zi=tr.indexOf(or),Yt=Zi>=0?tr.slice(Zi+1):tr;Na(ln,st,Yt),H(Re.side,ce,st,Yt)}}else{const Lo=Eo(Re.side),ln=go(Re.side,Sl,Re.qtyPct,Re.qty,Re.cash),or=J(ln,"floor");if(c!=null&&or>0&&or<c&&or<Lo-1e-12)Qe(Re.orderId,{status:"rejected",note:`Qty ${or} < minQty ${c}`});else{const tr=or>=Lo-1e-12?Ho(Re.side,ce,Sl,"signal","limit",{orderId:Re.orderId,signalId:Re.signalId,score:Re.score??null},void 0,kn):di(Re.side,ce,Sl,or,"signal","limit",{orderId:Re.orderId,signalId:Re.signalId,score:Re.score??null},void 0,kn);Qe(Re.orderId,{status:tr?"filled":"rejected",filledIndex:tr?ce:void 0,filledTimestamp:tr?nt(ce):void 0,fillPrice:(tr==null?void 0:tr.execPrice)??Sl,fillQty:(tr==null?void 0:tr.qtyClosed)??0,fees:(tr==null?void 0:tr.exitFees)??0,note:tr?void 0:"Exit not filled"})}}const Ks=Re.ocoGroup,ci=Re.orderId;ns.splice(Ct,1),ne(Ks,ci);continue}Qe(Re.orderId,{kind:"limit",note:"Stop triggered → limit active next bar"}),Re.kind="limit",Re.price=mn,Re.activeFromIndex=ce+1;continue}const uo=Re.price;if(uo==null||!Number.isFinite(uo)||!(Re.kind==="limit"?mi(Re.action,Re.side,"limit",ro,uo):mi(Re.action,Re.side,"stop",ro,uo)))continue;const Ei=Re.kind,ei=ll(Ei),Ht=q(Re.action,Re.side,Ei,uo,st).px,qe=_e(Re.action,Re.side,Ei);if(Re.action==="entry"){if(t.positionMode==="netting"){const mn=Ze(Re.side);if(ye(mn)){const Kn=nt(ce),Pn=Pt({action:"exit",side:mn,kind:ei==="limit"?"limit":"market",originalKind:"market",status:"pending",createdIndex:ce,createdTimestamp:Kn,activeFromIndex:ce,qtyPct:100,price:Ht,note:"AUTO netting close (reverse)"}),Hn=Ho(mn,ce,Ht,"signal",ei,{orderId:Pn.id,signalId:Re.signalId,score:Re.score??null});Qe(Pn.id,{status:Hn?"filled":"rejected",filledIndex:Hn?ce:void 0,filledTimestamp:Hn?Kn:void 0,fillPrice:Hn==null?void 0:Hn.execPrice,fillQty:(Hn==null?void 0:Hn.qtyClosed)??0,fees:(Hn==null?void 0:Hn.exitFees)??0,note:Hn?"AUTO netting close (reverse)":"AUTO netting close failed"})}}const Vt=En(Re.side,ce,Ht,Re.qtyPct,ei,Re.bracket,{orderId:Re.orderId,signalId:Re.signalId,score:Re.score??null},{qty:Re.qty,cash:Re.cash,...kn});if(Vt.ok){const mn=Vt.lot;Qe(Re.orderId,{status:"filled",filledIndex:ce,filledTimestamp:nt(ce),fillPrice:mn.entryPrice,fillQty:mn.qty,fees:mn.entryFee})}else Qe(Re.orderId,{status:"rejected",note:Vt.reject||"Entry not filled"});if(Vt.ok&&t.execution==="intrabar_ohlc"){const mn=Vt.lot,Kn=le(Re.side),Pn=Kn.indexOf(qe),Hn=Pn>=0?Kn.slice(Pn+1):Kn;Na(mn,st,Hn),H(Re.side,ce,st,Hn)}}else{const Vt=Eo(Re.side),mn=go(Re.side,Ht,Re.qtyPct,Re.qty,Re.cash),Kn=J(mn,"floor");if(c!=null&&Kn>0&&Kn<c&&Kn<Vt-1e-12)Qe(Re.orderId,{status:"rejected",note:`Qty ${Kn} < minQty ${c}`});else{const Pn=Kn>=Vt-1e-12?Ho(Re.side,ce,Ht,"signal",ei,{orderId:Re.orderId,signalId:Re.signalId,score:Re.score??null},void 0,kn):di(Re.side,ce,Ht,Kn,"signal",ei,{orderId:Re.orderId,signalId:Re.signalId,score:Re.score??null},void 0,kn);Qe(Re.orderId,{status:Pn?"filled":"rejected",filledIndex:Pn?ce:void 0,filledTimestamp:Pn?nt(ce):void 0,fillPrice:(Pn==null?void 0:Pn.execPrice)??Ht,fillQty:(Pn==null?void 0:Pn.qtyClosed)??0,fees:(Pn==null?void 0:Pn.exitFees)??0,note:Pn?void 0:"Exit not filled"})}}const fn=Re.ocoGroup,Fn=Re.orderId;ns.splice(Ct,1),ne(fn,Fn)}},je=(ce,st)=>{if(!Me()||t.execution!=="intrabar_ohlc")return!1;const ge=De("long",ce,st),Le=De("short",ce,st),dt=H("long",ce,st,le("long")),At=H("short",ce,st,le("short"));return ge||Le||dt||At};let Ft=0,Be=0;for(let ce=Nl;ce<=dd;ce++){const st=TK(n[ce]);if(!st)continue;const ge=st.c;Yd(ce,ge,Nl);const Le=Number((Ac=n[ce])==null?void 0:Ac.timestamp);if(Number.isFinite(Le)&&Le>0){const pt=new Date(Le).toISOString().slice(0,10);pt&&pt!==Fs&&(Fs=pt,Va=sd(ce,ge),Qs=0)}for(const pt of K("long"))pt.qty<=0||(pt.maxFav=pt.maxFav==null?st.h:Math.max(pt.maxFav,st.h),pt.maxAdv=pt.maxAdv==null?st.l:Math.min(pt.maxAdv,st.l));for(const pt of K("short"))pt.qty<=0||(pt.maxFav=pt.maxFav==null?st.l:Math.min(pt.maxFav,st.l),pt.maxAdv=pt.maxAdv==null?st.h:Math.max(pt.maxAdv,st.h));for(Me()&&je(ce,st),ot(ce,st),Ju(ce,st);ml<Dl.length&&Dl[ml].index===ce;){const pt=Dl[ml];if(pt.type==="cancel"){hi(pt.orderId??pt.signalId,"Canceled by strategy.cancel"),ml+=1;continue}if(pt.type==="cancel_all"){li("Canceled by strategy.cancel_all"),ml+=1;continue}const at=ks(pt),Re=String((at==null?void 0:at.kind)||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit"),kn=Vi(at==null?void 0:at.qtyPct),ro=at==null?void 0:at.qty,uo=at==null?void 0:at.cash,hs=typeof ro=="number"&&Number.isFinite(ro)?ro:Number(ro),Ei=typeof uo=="number"&&Number.isFinite(uo)?uo:Number(uo),ei=Number.isFinite(hs)?hs:void 0,Ys=Number.isFinite(Ei)?Ei:void 0,Ht=(at==null?void 0:at.commissionPct)??(at==null?void 0:at.commission),qe=(at==null?void 0:at.slippagePct)??(at==null?void 0:at.slippage),fn=gs(Ht),Fn=gs(qe),Vt=fn!=null||Fn!=null?{commissionRate:fn!=null?fn/100:void 0,slippageRate:Fn!=null?Fn/100:void 0}:void 0,mn=typeof(at==null?void 0:at.oco)=="string"&&String(at.oco).trim()?String(at.oco).trim():void 0,Kn=at==null?void 0:at.expiresBars,Pn=typeof Kn=="number"&&Number.isFinite(Kn)&&Kn>0?Math.floor(Kn):null,Hn=Pn?ce+Pn:void 0,No=tn(at==null?void 0:at.bracket),Mo=$r?"Risk limit reached":V!=null&&Qs>=V?"Max intraday filled orders reached":null,qs=(Re==="limit"||Re==="stop")&&typeof(at==null?void 0:at.price)=="number"?at.price:ge,ta=typeof(at==null?void 0:at.stopPrice)=="number"?at.stopPrice:typeof(at==null?void 0:at.price)=="number"?at.price:ge,Nc=typeof(at==null?void 0:at.limitPrice)=="number"?at.limitPrice:typeof(at==null?void 0:at.price)=="number"?at.price:ge,Tc=Re==="limit"||Re==="stop"?Y(pt.type.startsWith("entry")?"entry":"exit",pt.type.endsWith("long")?"long":"short",Re==="limit"?"limit":"stop",qs):qs,Sl=Re==="stop_limit"?Y(pt.type.startsWith("entry")?"entry":"exit",pt.type.endsWith("long")?"long":"short","stop",ta):ta,Ks=Re==="stop_limit"?Y(pt.type.startsWith("entry")?"entry":"exit",pt.type.endsWith("long")?"long":"short","limit",Nc):Nc,ci=nt(ce),Lo=Re==="limit"||Re==="stop"||Re==="stop_limit"?Re:"market";if(pt.type==="exit_long"&&ye("long"))if(Lo==="stop_limit"){if(Number.isFinite(Sl)&&Sl>0&&Number.isFinite(Ks)&&Ks>0){const ln=Pt({action:"exit",side:"long",kind:"stop_limit",originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce+1,expiresAtIndex:Hn,qtyPct:kn,stopPrice:Sl,limitPrice:Ks});ns.push({action:"exit",side:"long",kind:"stop_limit",signalId:pt.signalId,score:pt.score??null,stopPrice:Sl,limitPrice:Ks,qtyPct:kn,qty:ei,cash:Ys,commissionRate:Vt==null?void 0:Vt.commissionRate,slippageRate:Vt==null?void 0:Vt.slippageRate,activeFromIndex:ce+1,expiresAtIndex:Hn,ocoGroup:mn,orderId:ln.id})}}else if(Lo==="limit"||Lo==="stop"){if(Number.isFinite(Tc)&&Tc>0){const ln=Pt({action:"exit",side:"long",kind:Lo,originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce+1,expiresAtIndex:Hn,qtyPct:kn,price:Tc});ns.push({action:"exit",side:"long",kind:Lo,signalId:pt.signalId,score:pt.score??null,price:Tc,qtyPct:kn,qty:ei,cash:Ys,commissionRate:Vt==null?void 0:Vt.commissionRate,slippageRate:Vt==null?void 0:Vt.slippageRate,activeFromIndex:ce+1,expiresAtIndex:Hn,ocoGroup:mn,orderId:ln.id})}}else{const ln=Eo("long"),or=go("long",ge,kn,ei,Ys),tr=J(or,"floor"),Zi=Pt({action:"exit",side:"long",kind:"market",originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce,expiresAtIndex:Hn,qtyPct:kn});if(c!=null&&tr>0&&tr<c&&tr<ln-1e-12)Qe(Zi.id,{status:"rejected",note:`Qty ${tr} < minQty ${c}`});else{const Yt=tr>=ln-1e-12?Ho("long",ce,ge,"signal","market",{signalId:pt.signalId,orderId:Zi.id,score:pt.score??null},void 0,Vt):di("long",ce,ge,tr,"signal","market",{signalId:pt.signalId,orderId:Zi.id,score:pt.score??null},void 0,Vt);Qe(Zi.id,{status:Yt?"filled":"rejected",filledIndex:Yt?ce:void 0,filledTimestamp:Yt?ci:void 0,fillPrice:(Yt==null?void 0:Yt.execPrice)??yd("long",ge,"market"),fillQty:(Yt==null?void 0:Yt.qtyClosed)??0,fees:(Yt==null?void 0:Yt.exitFees)??0,note:Yt?void 0:"Exit not filled"})}}else if(pt.type==="exit_short"&&ye("short"))if(Lo==="stop_limit"){if(Number.isFinite(Sl)&&Sl>0&&Number.isFinite(Ks)&&Ks>0){const ln=Pt({action:"exit",side:"short",kind:"stop_limit",originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce+1,expiresAtIndex:Hn,qtyPct:kn,stopPrice:Sl,limitPrice:Ks});ns.push({action:"exit",side:"short",kind:"stop_limit",signalId:pt.signalId,score:pt.score??null,stopPrice:Sl,limitPrice:Ks,qtyPct:kn,qty:ei,cash:Ys,commissionRate:Vt==null?void 0:Vt.commissionRate,slippageRate:Vt==null?void 0:Vt.slippageRate,activeFromIndex:ce+1,expiresAtIndex:Hn,ocoGroup:mn,orderId:ln.id})}}else if(Lo==="limit"||Lo==="stop"){if(Number.isFinite(Tc)&&Tc>0){const ln=Pt({action:"exit",side:"short",kind:Lo,originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce+1,expiresAtIndex:Hn,qtyPct:kn,price:Tc});ns.push({action:"exit",side:"short",kind:Lo,signalId:pt.signalId,score:pt.score??null,price:Tc,qtyPct:kn,qty:ei,cash:Ys,commissionRate:Vt==null?void 0:Vt.commissionRate,slippageRate:Vt==null?void 0:Vt.slippageRate,activeFromIndex:ce+1,expiresAtIndex:Hn,ocoGroup:mn,orderId:ln.id})}}else{const ln=Eo("short"),or=go("short",ge,kn,ei,Ys),tr=J(or,"floor"),Zi=Pt({action:"exit",side:"short",kind:"market",originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce,expiresAtIndex:Hn,qtyPct:kn});if(c!=null&&tr>0&&tr<c&&tr<ln-1e-12)Qe(Zi.id,{status:"rejected",note:`Qty ${tr} < minQty ${c}`});else{const Yt=tr>=ln-1e-12?Ho("short",ce,ge,"signal","market",{signalId:pt.signalId,orderId:Zi.id,score:pt.score??null},void 0,Vt):di("short",ce,ge,tr,"signal","market",{signalId:pt.signalId,orderId:Zi.id,score:pt.score??null},void 0,Vt);Qe(Zi.id,{status:Yt?"filled":"rejected",filledIndex:Yt?ce:void 0,filledTimestamp:Yt?ci:void 0,fillPrice:(Yt==null?void 0:Yt.execPrice)??yd("short",ge,"market"),fillQty:(Yt==null?void 0:Yt.qtyClosed)??0,fees:(Yt==null?void 0:Yt.exitFees)??0,note:Yt?void 0:"Exit not filled"})}}else if(pt.type==="entry_long"&&t.allowLong)if(Lo==="stop_limit"){if(Number.isFinite(Sl)&&Sl>0&&Number.isFinite(Ks)&&Ks>0){const ln=Pt({action:"entry",side:"long",kind:"stop_limit",originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce+1,expiresAtIndex:Hn,qtyPct:kn,stopPrice:Sl,limitPrice:Ks});Mo?Qe(ln.id,{status:"rejected",note:Mo}):ns.push({action:"entry",side:"long",kind:"stop_limit",signalId:pt.signalId,score:pt.score??null,stopPrice:Sl,limitPrice:Ks,qtyPct:kn,qty:ei,cash:Ys,commissionRate:Vt==null?void 0:Vt.commissionRate,slippageRate:Vt==null?void 0:Vt.slippageRate,activeFromIndex:ce+1,expiresAtIndex:Hn,ocoGroup:mn,bracket:No,orderId:ln.id})}}else if(Lo==="limit"||Lo==="stop"){if(Number.isFinite(Tc)&&Tc>0){const ln=Pt({action:"entry",side:"long",kind:Lo,originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce+1,expiresAtIndex:Hn,qtyPct:kn,price:Tc});Mo?Qe(ln.id,{status:"rejected",note:Mo}):ns.push({action:"entry",side:"long",kind:Lo,signalId:pt.signalId,score:pt.score??null,price:Tc,qtyPct:kn,qty:ei,cash:Ys,commissionRate:Vt==null?void 0:Vt.commissionRate,slippageRate:Vt==null?void 0:Vt.slippageRate,activeFromIndex:ce+1,expiresAtIndex:Hn,ocoGroup:mn,bracket:No,orderId:ln.id})}}else{const ln=Pt({action:"entry",side:"long",kind:"market",originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce,expiresAtIndex:Hn,qtyPct:kn});if(Mo){Qe(ln.id,{status:"rejected",note:Mo}),ml+=1;continue}if(t.positionMode==="netting"){const tr="short";if(ye(tr)){const Zi=Pt({action:"exit",side:tr,kind:"market",originalKind:"market",status:"pending",createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce,qtyPct:100,price:ge,note:"AUTO netting close (reverse)"}),Yt=Ho(tr,ce,ge,"signal","market",{signalId:pt.signalId,orderId:Zi.id,score:pt.score??null});Qe(Zi.id,{status:Yt?"filled":"rejected",filledIndex:Yt?ce:void 0,filledTimestamp:Yt?ci:void 0,fillPrice:(Yt==null?void 0:Yt.execPrice)??yd(tr,ge,"market"),fillQty:(Yt==null?void 0:Yt.qtyClosed)??0,fees:(Yt==null?void 0:Yt.exitFees)??0})}}const or=En("long",ce,ge,kn,"market",No,{signalId:pt.signalId,orderId:ln.id,score:pt.score??null},{qty:ei,cash:Ys,...Vt});if(or.ok){const tr=or.lot;Qe(ln.id,{status:"filled",filledIndex:ce,filledTimestamp:ci,fillPrice:tr.entryPrice,fillQty:tr.qty,fees:tr.entryFee})}else Qe(ln.id,{status:"rejected",note:or.reject||"Entry blocked"})}else if(pt.type==="entry_short"&&t.allowShort)if(Lo==="stop_limit"){if(Number.isFinite(Sl)&&Sl>0&&Number.isFinite(Ks)&&Ks>0){const ln=Pt({action:"entry",side:"short",kind:"stop_limit",originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce+1,expiresAtIndex:Hn,qtyPct:kn,stopPrice:Sl,limitPrice:Ks});Mo?Qe(ln.id,{status:"rejected",note:Mo}):ns.push({action:"entry",side:"short",kind:"stop_limit",signalId:pt.signalId,score:pt.score??null,stopPrice:Sl,limitPrice:Ks,qtyPct:kn,qty:ei,cash:Ys,commissionRate:Vt==null?void 0:Vt.commissionRate,slippageRate:Vt==null?void 0:Vt.slippageRate,activeFromIndex:ce+1,expiresAtIndex:Hn,ocoGroup:mn,bracket:No,orderId:ln.id})}}else if(Lo==="limit"||Lo==="stop"){if(Number.isFinite(Tc)&&Tc>0){const ln=Pt({action:"entry",side:"short",kind:Lo,originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce+1,expiresAtIndex:Hn,qtyPct:kn,price:Tc});Mo?Qe(ln.id,{status:"rejected",note:Mo}):ns.push({action:"entry",side:"short",kind:Lo,signalId:pt.signalId,score:pt.score??null,price:Tc,qtyPct:kn,qty:ei,cash:Ys,commissionRate:Vt==null?void 0:Vt.commissionRate,slippageRate:Vt==null?void 0:Vt.slippageRate,activeFromIndex:ce+1,expiresAtIndex:Hn,ocoGroup:mn,bracket:No,orderId:ln.id})}}else{const ln=Pt({action:"entry",side:"short",kind:"market",originalKind:Lo,status:"pending",signalId:pt.signalId,ocoGroup:mn,createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce,expiresAtIndex:Hn,qtyPct:kn});if(Mo){Qe(ln.id,{status:"rejected",note:Mo}),ml+=1;continue}if(t.positionMode==="netting"){const tr="long";if(ye(tr)){const Zi=Pt({action:"exit",side:tr,kind:"market",originalKind:"market",status:"pending",createdIndex:ce,createdTimestamp:ci,activeFromIndex:ce,qtyPct:100,price:ge,note:"AUTO netting close (reverse)"}),Yt=Ho(tr,ce,ge,"signal","market",{signalId:pt.signalId,orderId:Zi.id,score:pt.score??null});Qe(Zi.id,{status:Yt?"filled":"rejected",filledIndex:Yt?ce:void 0,filledTimestamp:Yt?ci:void 0,fillPrice:(Yt==null?void 0:Yt.execPrice)??yd(tr,ge,"market"),fillQty:(Yt==null?void 0:Yt.qtyClosed)??0,fees:(Yt==null?void 0:Yt.exitFees)??0})}}const or=En("short",ce,ge,kn,"market",No,{signalId:pt.signalId,orderId:ln.id,score:pt.score??null},{qty:ei,cash:Ys,...Vt});if(or.ok){const tr=or.lot;Qe(ln.id,{status:"filled",filledIndex:ce,filledTimestamp:ci,fillPrice:tr.entryPrice,fillQty:tr.qty,fees:tr.entryFee})}else Qe(ln.id,{status:"rejected",note:or.reject||"Entry blocked"})}ml+=1}let dt=sd(ce,ge);if(!$r){const pt=Va-dt,at=D??(j!=null?Va*j:null),Ct=gl>0?(gl-dt)/gl:0,Re=gl-dt,kn=P!=null&&Ct>=P||I!=null&&Re>=I,ro=at!=null&&Number.isFinite(pt)&&pt>=at;(kn||ro)&&($r=!0,li("Canceled by risk limit"),ye("long")&&Ho("long",ce,ge,"signal","market"),ye("short")&&Ho("short",ce,ge,"signal","market"),dt=sd(ce,ge))}{const pt=(cu=n==null?void 0:n[ce])==null?void 0:cu.timestamp,at=Number(pt);ft.push({index:ce,timestamp:Number.isFinite(at)&&at>0?at:Date.now(),equity:dt})}if(dt>gl&&(gl=dt),gl>0){const pt=(gl-dt)/gl;pt>_d&&(_d=pt);const at=gl-dt;at>Kl&&(Kl=at)}if(Number.isFinite(dt)){if(!Number.isFinite(ic)||dt<ic)ic=dt;else if(ic>0){const pt=dt-ic;pt>zd&&(zd=pt);const at=pt/ic;at>od&&(od=at)}}Ft+=1,Me()&&(Be+=1);const At=Eo("long")-Eo("short");Ve[ce]=At,Je[ce]=Pd(),St[ce]=Fe("long")+Fe("short"),Ne[ce]=Ge.length,ue[ce]=id(ge),he[ce]=ee-Gs,_t[ce]=jo,Wt[ce]=fi,jt[ce]=ba,Zt[ce]=xa,dn[ce]=Ge.length>0?ba/Ge.length*100:0,zn[ce]=_d*100,un[ce]=Kl,On[ce]=od*100,no[ce]=zd,Qo[ce]=dt,Ko[ce]=dt-o,fs[ce]=Ge.length>0?(ee-Gs)/Ge.length:0,ps[ce]=ba>0?jo/ba:0,So[ce]=xa>0?-(fi/xa):0,Es[ce]=Ge.length>0?Al/Ge.length:0;{const pt=[];for(const at of K("long"))at.qty<=1e-12||pt.push({side:"long",qty:at.qty,entryIndex:at.entryIndex,entryTimestamp:at.entryTimestamp,entryPrice:at.entryPrice,entrySignalId:at.entrySignalId,entryOrderId:at.entryOrderId,entrySignalScore:at.entrySignalScore??null,maxFav:at.maxFav,maxAdv:at.maxAdv});for(const at of K("short"))at.qty<=1e-12||pt.push({side:"short",qty:at.qty,entryIndex:at.entryIndex,entryTimestamp:at.entryTimestamp,entryPrice:at.entryPrice,entrySignalId:at.entrySignalId,entryOrderId:at.entryOrderId,entrySignalScore:at.entrySignalScore??null,maxFav:at.maxFav,maxAdv:at.maxAdv});pt.sort((at,Ct)=>Ct.entryIndex-at.entryIndex),oo[ce]=pt}}if(t.closeOnEnd&&Me()&&n.length){const ce=dd,st=r_(n[ce]);if(st!=null){ye("long")&&Ho("long",ce,st,"end","market"),ye("short")&&Ho("short",ce,st,"end","market");const ge=sd(ce,st);{const dt=(Id=n==null?void 0:n[ce])==null?void 0:Id.timestamp,At=Number(dt);ft.push({index:ce,timestamp:Number.isFinite(At)&&At>0?At:Date.now(),equity:ge})}if(ge>gl&&(gl=ge),gl>0){const dt=(gl-ge)/gl;dt>_d&&(_d=dt);const At=gl-ge;At>Kl&&(Kl=At)}if(Number.isFinite(ge)){if(!Number.isFinite(ic)||ge<ic)ic=ge;else if(ic>0){const dt=ge-ic;dt>zd&&(zd=dt);const At=dt/ic;At>od&&(od=At)}}const Le=Eo("long")-Eo("short");Ve[ce]=Le,Je[ce]=Pd(),St[ce]=Fe("long")+Fe("short"),Ne[ce]=Ge.length,ue[ce]=id(st),he[ce]=ee-Gs,_t[ce]=jo,Wt[ce]=fi,jt[ce]=ba,Zt[ce]=xa,dn[ce]=Ge.length>0?ba/Ge.length*100:0,zn[ce]=_d*100,un[ce]=Kl,On[ce]=od*100,no[ce]=zd,Qo[ce]=ge,Ko[ce]=ge-o,fs[ce]=Ge.length>0?(ee-Gs)/Ge.length:0,ps[ce]=ba>0?jo/ba:0,So[ce]=xa>0?-(fi/xa):0,Es[ce]=Ge.length>0?Al/Ge.length:0,oo[ce]=[]}if(ns.length){for(const ge of ns)Qe(ge.orderId,{status:"canceled",note:"Canceled on end"});ns.length=0}}const xt=ft.length?ft[ft.length-1].equity:o,an=xt-o,Yn=Ge.reduce((ce,st)=>ce+(st.pnl>0?st.pnl:0),0),bn=Ge.reduce((ce,st)=>ce+(st.pnl<0?Math.abs(st.pnl):0),0),be=Ge.filter(ce=>ce.pnl>0).length,tt=Ge.filter(ce=>ce.pnl<0).length,wt=Ge.length,Lt=wt?be/wt*100:0,qt=wt?an/wt:0,qn=be?Yn/be:0,Xt=tt?-(bn/tt):0,vo=Xt!==0?Math.abs(qn/Xt):qn>0?1/0:0,To=wt>0?Ge.reduce((ce,st)=>ce+Math.max(0,st.exitIndex-st.entryIndex+1),0)/wt:0,co=Ft>0?Be/Ft*100:0,so=[];{let ce="",st=NaN,ge=0;for(const Le of ft){const dt=Number(Le.timestamp);if(!Number.isFinite(dt)||dt<=0)continue;const At=new Date(dt).toISOString().slice(0,10);ce&&At!==ce&&Number.isFinite(st)&&so.push({ts:ge,eq:st}),ce=At,st=Le.equity,ge=dt}ce&&Number.isFinite(st)&&so.push({ts:ge,eq:st})}const Jo=[];for(let ce=1;ce<so.length;ce++){const st=so[ce-1].eq,ge=so[ce].eq;Number.isFinite(st)&&st!==0&&Number.isFinite(ge)&&Jo.push((ge-st)/st)}const Os=Jo.length?Jo.reduce((ce,st)=>ce+st,0)/Jo.length:0,wr=Jo.length>1?Jo.reduce((ce,st)=>ce+(st-Os)**2,0)/(Jo.length-1):0,ra=wr>0?Math.sqrt(wr):0,Qr=Jo.filter(ce=>ce<0),hl=Qr.length?Qr.reduce((ce,st)=>ce+st,0)/Qr.length:0,lc=Qr.length>1?Qr.reduce((ce,st)=>ce+(st-hl)**2,0)/(Qr.length-1):0,qr=lc>0?Math.sqrt(lc):0,Ga=ra>0?Os/ra*Math.sqrt(252):0,Ki=qr>0?Os/qr*Math.sqrt(252):0,Zl=ra>0?ra*Math.sqrt(252)*100:0,Tl=ft.length?ft[0].equity:o,Ya=ft.length?Number(ft[0].timestamp):NaN,ur=ft.length?Number(ft[ft.length-1].timestamp):NaN,rc=Number.isFinite(Ya)&&Number.isFinite(ur)&&ur>Ya?(ur-Ya)/(365*864e5):0,zr=Tl>0?xt/Tl:1,rd=rc>0?Math.pow(zr,1/rc)-1:zr-1,cc=_d>0?rd/_d:rd>0?1/0:0,dc=[];if(ft.length){const ce=ft[0].index,st=r_(n[ce])??NaN;if(Number.isFinite(st)&&st>0){const ge=o/st;for(let Le=Nl;Le<=dd;Le++){const dt=r_(n[Le]);if(dt==null||!Number.isFinite(dt))continue;const At=(Zc=n==null?void 0:n[Le])==null?void 0:Zc.timestamp,pt=Number(At);dc.push({index:Le,timestamp:Number.isFinite(pt)&&pt>0?pt:Date.now(),equity:ge*dt})}}}const Er=wt?be/wt*qn+tt/wt*Xt:0;let Sc=0,ea=0;{let ce=0,st=0;for(const ge of Ge)ge.pnl>0?(ce+=1,st=0,ce>Sc&&(Sc=ce)):ge.pnl<0&&(st+=1,ce=0,st>ea&&(ea=st))}return{summary:{initialCapital:o,finalEquity:xt,netPnl:an,netPnlPct:o>0?an/o*100:0,grossProfit:Yn,grossLoss:bn,profitFactor:bn>0?Yn/bn:Yn>0?1/0:0,trades:wt,roundTrips:it.length,wins:be,losses:tt,winRate:Lt,maxDrawdownPct:_d*100,feesPaid:re,avgTrade:qt,avgWin:qn,avgLoss:Xt,payoffRatio:vo,expectancy:Er,maxConsecWins:Sc,maxConsecLosses:ea,exposurePct:co,maxRunupPct:od*100,avgBarsInTrade:To,volatilityPct:Zl,sharpe:Ga,sortino:Ki,calmar:cc},trades:Ge,roundTrips:it,orders:Ye,equity:ft,benchmark:dc,series:{positionSize:Ve,positionAvgPrice:Je,openTrades:St,closedTrades:Ne,openProfit:ue,closedProfit:he,grossProfit:_t,grossLoss:Wt,winTrades:jt,lossTrades:Zt,winRate:dn,maxDrawdownPct:zn,maxDrawdownValue:un,maxRunupPct:On,maxRunupValue:no,avgTrade:fs,avgWin:ps,avgLoss:So,avgBarsInTrade:Es,equity:Qo,netProfit:Ko},accessors:{openTradesByBar:oo,closedTrades:Ge}}}function rm(n){return!Number.isFinite(n)||n<=0?0:n<1e12?n*1e3:n}function FK(n){const e=new Date(n);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0)}function $K(n){const e=new Date(n);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),1,0,0,0,0)}function EK(n){const e=String(n||"").trim(),t=e.toUpperCase();if(!t)return null;if(t==="D"||t==="1D")return{kind:"calendar",unit:"D"};if(t==="W"||t==="1W")return{kind:"calendar",unit:"W"};if(e==="M"||e==="1M")return{kind:"calendar",unit:"M"};if(/^\d+$/.test(t))return{kind:"fixed",ms:Math.max(1,Number(t))*60*1e3};const o=t.match(/^(\d+)\s*([A-Z]+)$/);if(o){const i=Math.max(1,Number(o[1])),r=o[2];if(r==="H"||r==="HR"||r==="HRS")return{kind:"fixed",ms:i*60*60*1e3};if(r==="MIN"||r==="MINS")return{kind:"fixed",ms:i*60*1e3};if(r==="M"&&e.toLowerCase().endsWith("m"))return{kind:"fixed",ms:i*60*1e3};if(r==="D"||r==="DAY"||r==="DAYS")return{kind:"fixed",ms:i*24*60*60*1e3};if(r==="W"||r==="WK"||r==="WEEK"||r==="WEEKS")return{kind:"fixed",ms:i*7*24*60*60*1e3}}return null}const k2=new Map,S2=new Map;function NK(n){const e=n||"UTC",t=k2.get(e);if(t)return t;const o=new Intl.DateTimeFormat("en-GB",{timeZone:e,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return k2.set(e,o),o}function DK(n){const e=n||"UTC",t=S2.get(e);if(t)return t;const o=new Intl.DateTimeFormat("en-GB",{timeZone:e,weekday:"short"});return S2.set(e,o),o}function M_(n,e){if(!Number.isFinite(n))return null;const o=NK(e).formatToParts(new Date(n)),i={};for(const m of o)(m.type==="year"||m.type==="month"||m.type==="day"||m.type==="hour"||m.type==="minute"||m.type==="second")&&(i[m.type]=m.value);const r=Number(i.year),a=Number(i.month),l=Number(i.day),c=Number(i.hour),d=Number(i.minute),p=Number(i.second);return[r,a,l,c,d,p].every(m=>Number.isFinite(m))?{y:r,m:a,d:l,h:c,min:d,s:p}:null}function jK(n,e){const o=DK(e).format(new Date(n));return{Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6}[o]??null}function h_(n,e){const t=M_(n,e);return t?Date.UTC(t.y,t.m-1,t.d,t.h,t.min,t.s,0)-n:0}function n5(n,e){const t=M_(n,e);if(!t)return FK(n);let o=Date.UTC(t.y,t.m-1,t.d,0,0,0,0);const i=h_(o,e);o=o-i;const r=h_(o,e);return o-r}function RK(n,e){const t=n5(n,e),o=jK(n,e);return t-(typeof o=="number"?o:0)*24*60*60*1e3}function BK(n,e){const t=M_(n,e);if(!t)return $K(n);let o=Date.UTC(t.y,t.m-1,1,0,0,0,0);const i=h_(o,e);o=o-i;const r=h_(o,e);return o-r}function Eh(n,e,t){if(!e)return n;if(e.kind==="fixed")return Math.floor(n/e.ms)*e.ms;const o=t||"UTC";return e.unit==="D"?n5(n,o):e.unit==="W"?RK(n,o):BK(n,o)}function OK(n){const e=String(n||"").trim();if(!e)return[];if(e.toLowerCase()==="24x7"||e==="0000-2359")return[];const t=e.split(/[;,]/).map(i=>i.trim()).filter(Boolean),o=[];for(const i of t){const r=i.match(/(\d{1,2}):?(\d{2})\s*-\s*(\d{1,2}):?(\d{2})/);if(!r)continue;const a=Number(r[1]),l=Number(r[2]),c=Number(r[3]),d=Number(r[4]);if([a,l,c,d].some(h=>!Number.isFinite(h)))continue;const p=a*60+l,m=c*60+d;o.push({start:p,end:m})}return o}function G0(n,e,t){const o=OK(e);if(!o.length)return!0;const r=M_(n,t||"UTC");if(!r)return!0;const a=r.h*60+r.min;for(const l of o)if(l.start<=l.end){if(a>=l.start&&a<=l.end)return!0}else if(a>=l.start||a<=l.end)return!0;return!1}function C2(n){const e=[];let t=null;for(let o=0;o<n.length;o++){const i=rm(n[o]??0);if(i){if(t!=null){const r=i-t;r>0&&Number.isFinite(r)&&e.push(r)}if(t=i,e.length>=200)break}}return e.length<3?null:(e.sort((o,i)=>o-i),e[Math.floor(e.length/2)]??null)}function zK(n,e){let t=0,o=n.length;for(;t<o;){const i=t+o>>>1;n[i]>e?o=i:t=i+1}return t}function VK(n){const e=n.length,t=new Float32Array(e),o=new Float32Array(e),i=new Float32Array(e),r=new Float32Array(e),a=new Float32Array(e),l=new Float32Array(e);for(let c=0;c<e;c++){const d=n[c],p=rm((d==null?void 0:d.timestamp)??(d==null?void 0:d.time)??(d==null?void 0:d.t)??0),m=Number(d==null?void 0:d.close),h=Number(d==null?void 0:d.open),_=Number(d==null?void 0:d.high),w=Number(d==null?void 0:d.low);t[c]=Number.isFinite(h)?h:Number.isFinite(m)?m:NaN,r[c]=Number.isFinite(m)?m:NaN,o[c]=Number.isFinite(_)?_:Number.isFinite(m)?m:t[c],i[c]=Number.isFinite(w)?w:Number.isFinite(m)?m:t[c];const S=Number(d==null?void 0:d.volume);a[c]=Number.isFinite(S)?S:0,l[c]=p||0}return{open:t,high:o,low:i,close:r,volume:a,time:l}}function WK(n){var j,D,R,W;const e=n.timestamps.length,t=n.lookahead||"off",o=n.gaps||"off",i=String(n.timeframe||"").trim();if(!i||i.toLowerCase()==="current"||i==="__CURRENT__"){const J={open:new Float32Array(e),high:new Float32Array(e),low:new Float32Array(e),close:new Float32Array(e),volume:new Float32Array(e),time:new Float32Array(e)};for(let Y=0;Y<e;Y++)J.open[Y]=n.open[Y]??NaN,J.high[Y]=n.high[Y]??NaN,J.low[Y]=n.low[Y]??NaN,J.close[Y]=n.close[Y]??NaN,J.volume[Y]=((j=n.volume)==null?void 0:j[Y])??0,J.time[Y]=rm(n.timestamps[Y]??0);const G=gg([{name:"__out",expr:String(n.expr||"close")}],J,n.scalars).__out||new Float32Array(e),se=new Array(e);for(let Y=0;Y<e;Y++){const oe=G[Y],ee=rm(n.timestamps[Y]??0);if(o==="on"&&!G0(ee,n.session,n.timezone)){se[Y]=void 0;continue}se[Y]=Number.isFinite(oe)?oe:void 0}return se}const r=EK(i);if(!r)return new Array(e);if(n.sourceCandles&&n.sourceCandles.length>1){const J=n.sourceCandles,Z=J.length,G=VK(J),Y=gg([{name:"__out",expr:String(n.expr||"close")}],G,n.scalars).__out||new Float32Array(Z),oe=G.time,ee=C2(n.timestamps),re=new Array(e);for(let ye=0;ye<e;ye++){const Me=rm(n.timestamps[ye]??0);if(!Me){re[ye]=-1;continue}let Fe=Me;if(ye+1<e){const Ge=rm(n.timestamps[ye+1]??0);Ge&&Ge>Me&&(Fe=Ge-1)}else ee!=null&&ee>0&&(Fe=Me+ee-1);const Ze=zK(oe,Fe);re[ye]=Ze-1}const me=new Array(e);for(let ye=0;ye<e;ye++){const Me=re[ye],Fe=ye+1<e?re[ye+1]:Me;me[ye]=Me>=0&&ye+1<e&&Me!==Fe}const K=new Array(e);for(let ye=0;ye<e;ye++){const Me=re[ye];if(Me<0||Me>=Z){K[ye]=void 0;continue}const Fe=rm(n.timestamps[ye]??0);if(o==="on"&&!G0(Fe,n.session,n.timezone)){K[ye]=void 0;continue}const Ze=t==="on"||me[ye]?Y[Me]:Me>0?Y[Me-1]:NaN;let Ge=Number.isFinite(Ze)?Ze:void 0;if(o==="on"){const it=Eh(Fe,r,n.timezone),Ye=Eh(oe[Me]??0,r,n.timezone);it!==Ye&&(Ge=void 0)}K[ye]=Ge}return K}const a=C2(n.timestamps);if(r.kind==="fixed"&&a!=null&&r.ms<a){if(n.allowLowerTfFallback){const J={open:new Float32Array(e),high:new Float32Array(e),low:new Float32Array(e),close:new Float32Array(e),volume:new Float32Array(e),time:new Float32Array(e)};for(let Y=0;Y<e;Y++)J.open[Y]=n.open[Y]??NaN,J.high[Y]=n.high[Y]??NaN,J.low[Y]=n.low[Y]??NaN,J.close[Y]=n.close[Y]??NaN,J.volume[Y]=((D=n.volume)==null?void 0:D[Y])??0,J.time[Y]=rm(n.timestamps[Y]??0);const G=gg([{name:"__out",expr:String(n.expr||"close")}],J,n.scalars).__out||new Float32Array(e),se=new Array(e);for(let Y=0;Y<e;Y++){const oe=G[Y],ee=rm(n.timestamps[Y]??0);o==="on"&&!G0(ee,n.session,n.timezone)?se[Y]=void 0:se[Y]=Number.isFinite(oe)?oe:void 0}return se}throw new Error(`request.security: lower timeframe "${i}" is not available from current chart data (base ~${Math.round(a/6e4)}m). Switch chart timeframe lower or provide lower-TF datafeed.`)}const l=new Array(e),c=new Array(e),d=[],p=[],m=[],h=[],_=[],w=[];let S=NaN,P=-1;for(let J=0;J<e;J++){const Z=rm(n.timestamps[J]??0);if(!Z){l[J]=-1;continue}const G=Eh(Z,r,n.timezone);if(!Number.isFinite(S)||G!==S){S=G,P+=1,w[P]=G,d[P]=n.open[J]??n.close[J]??NaN;const se=n.close[J]??NaN;p[P]=n.high[J]??se,m[P]=n.low[J]??se,h[P]=n.close[J]??NaN,_[P]=((R=n.volume)==null?void 0:R[J])??0}else{const se=n.high[J],Y=n.low[J],oe=n.close[J];se!=null&&Number.isFinite(se)&&(p[P]=Math.max(p[P],se)),Y!=null&&Number.isFinite(Y)&&(m[P]=Math.min(m[P],Y)),oe!=null&&Number.isFinite(oe)&&(h[P]=oe);const ee=(W=n.volume)==null?void 0:W[J];ee!=null&&Number.isFinite(ee)&&(_[P]+=ee)}l[J]=P}for(let J=0;J<e;J++){const Z=l[J],G=J+1<e?l[J+1]:Z;c[J]=Z>=0&&J+1<e&&Z!==G}const I=P+1;if(I<=0)return new Array(e);const C={open:new Float32Array(I),high:new Float32Array(I),low:new Float32Array(I),close:new Float32Array(I),volume:new Float32Array(I),time:new Float32Array(I)};for(let J=0;J<I;J++)C.open[J]=d[J]??NaN,C.high[J]=p[J]??NaN,C.low[J]=m[J]??NaN,C.close[J]=h[J]??NaN,C.volume[J]=_[J]??0,C.time[J]=w[J]??0;const F=gg([{name:"__out",expr:String(n.expr||"close")}],C,n.scalars).__out||new Float32Array(I),V=new Array(e);for(let J=0;J<e;J++){const Z=l[J];if(Z<0){V[J]=void 0;continue}const G=rm(n.timestamps[J]??0);if(o==="on"&&!G0(G,n.session,n.timezone)){V[J]=void 0;continue}const se=t==="on"||c[J]?F[Z]:Z>0?F[Z-1]:NaN,Y=Number.isFinite(se)?se:void 0;if(o==="on"){const oe=Eh(G,r,n.timezone),ee=Eh(w[Z]??0,r,n.timezone);V[J]=oe===ee?Y:void 0}else V[J]=Y}return V}function Y0(n){return n.replace(/^"|"$/g,"").replace(/^'|'$/g,"")}function qK(n){const e={},t=/([A-Za-z_$][A-Za-z0-9_$]*)\s*:\s*("([^"\\]|\\.)*"|'([^'\\]|\\.)*'|[^\s]+)/g;let o;for(;o=t.exec(n);){const i=String(o[1]||"").toLowerCase(),r=String(o[2]||"");e[i]=r}return e}function HK(n){const e=r=>{let a=null,l=0;const c=w=>/[A-Za-z0-9_$]/.test(w),d=r.toLowerCase(),p=[{token:"cooldown_bars",key:"cooldown"},{token:"cooldownbars",key:"cooldown"},{token:"cooldown",key:"cooldown"},{token:"score",key:"score"}];let m=null;for(let w=0;w<r.length;w++){const S=r[w];if(a){S===a&&r[w-1]!=="\\"&&(a=null);continue}if(S==="'"||S==='"'){a=S;continue}if(S==="("){l+=1;continue}if(S===")"){l=Math.max(0,l-1);continue}if(!(l>0)&&!(w>0&&c(r[w-1])))for(const P of p){if(!d.startsWith(P.token,w))continue;const I=w+P.token.length;if(I<r.length&&c(r[I]))continue;let C=I;for(;C<r.length&&/\s/.test(r[C]);)C+=1;const M=r[C];if(!(M!=="="&&M!==":")){m={key:P.key,start:w,valueStart:C+1};break}}}if(!m)return null;const h=r.slice(0,m.start).replace(/[,;]+\s*$/,"").trim(),_=r.slice(m.valueStart).trim();return{key:m.key,when:h,value:_}};let t=n.trim(),o,i;for(let r=0;r<4;r++){const a=e(t);if(!a)break;t=a.when,a.key==="score"&&o==null&&(o=a.value),a.key==="cooldown"&&i==null&&(i=a.value)}return{when:t.trim(),scoreRaw:o,cooldownRaw:i}}function UK(n,e,t){const o=n.trim();if(!o)throw new Error(`Line ${t}: score requires a numeric value`);const i=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,r=e[o],a=typeof r=="number"&&Number.isFinite(r)?r:typeof r=="string"&&i.test(r)?Number(r):null,l=a??(i.test(o)?Number(o):null),c=p=>{switch(p.kind){case"NumberLiteral":return p.value;case"Identifier":{const m=e[p.name],h=typeof m=="number"?m:Number(m);return Number.isFinite(h)?h:null}case"UnaryExpression":{if(p.operator!=="not")return null;const m=c(p.expr);return m==null?null:Number.isFinite(m)&&m!==0?0:1}case"BinaryExpression":{const m=c(p.left),h=c(p.right);if(m==null||h==null)return null;switch(p.operator){case"+":return m+h;case"-":return m-h;case"*":return m*h;case"/":return h===0?NaN:m/h;case"%":return h===0?NaN:m%h;case">":return Number.isFinite(m)&&Number.isFinite(h)&&m>h?1:0;case"<":return Number.isFinite(m)&&Number.isFinite(h)&&m<h?1:0;case">=":return Number.isFinite(m)&&Number.isFinite(h)&&m>=h?1:0;case"<=":return Number.isFinite(m)&&Number.isFinite(h)&&m<=h?1:0;case"==":return Number.isFinite(m)&&Number.isFinite(h)&&Math.abs(m-h)<1e-9?1:0;case"!=":return Number.isFinite(m)&&Number.isFinite(h)&&Math.abs(m-h)>=1e-9?1:0;case"and":return Number.isFinite(m)&&m!==0&&Number.isFinite(h)&&h!==0?1:0;case"or":return Number.isFinite(m)&&m!==0||Number.isFinite(h)&&h!==0?1:0;default:return null}}case"CallExpression":{const m=p.callee.toLowerCase();if(m==="iff"&&p.args.length===3){const S=c(p.args[0]);return S==null?null:c(S!==0?p.args[1]:p.args[2])}const h=p.args.map(S=>c(S));if(h.some(S=>S==null))return null;const _=h[0],w=h[1];switch(m){case"min":return Math.min(_,w);case"max":return Math.max(_,w);case"abs":return Math.abs(_);case"ceil":return Math.ceil(_);case"floor":return Math.floor(_);case"round":return Math.round(_);case"sqrt":return Math.sqrt(_);case"pow":return Math.pow(_,w);default:return null}}default:return null}};let d=l;if(d==null)try{const p=Tf(o);d=c(p)}catch{d=null}if(d==null||!Number.isFinite(d))throw new Error(`Line ${t}: score must be an integer between 0 and 10`);if(!Number.isInteger(d))throw new Error(`Line ${t}: score must be an integer between 0 and 10`);if(d<0||d>10)throw new Error(`Line ${t}: score must be in range 0..10`);return d}function GK(n,e,t){const o=n.trim();if(!o)throw new Error(`Line ${t}: cooldown requires a numeric value`);const i=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,r=e[o],a=typeof r=="number"&&Number.isFinite(r)?r:typeof r=="string"&&i.test(r)?Number(r):null,l=a??(i.test(o)?Number(o):null),c=p=>{switch(p.kind){case"NumberLiteral":return p.value;case"Identifier":{const m=e[p.name],h=typeof m=="number"?m:Number(m);return Number.isFinite(h)?h:null}case"UnaryExpression":{if(p.operator!=="not")return null;const m=c(p.expr);return m==null?null:Number.isFinite(m)&&m!==0?0:1}case"BinaryExpression":{const m=c(p.left),h=c(p.right);if(m==null||h==null)return null;switch(p.operator){case"+":return m+h;case"-":return m-h;case"*":return m*h;case"/":return h===0?NaN:m/h;case"%":return h===0?NaN:m%h;case">":return Number.isFinite(m)&&Number.isFinite(h)&&m>h?1:0;case"<":return Number.isFinite(m)&&Number.isFinite(h)&&m<h?1:0;case">=":return Number.isFinite(m)&&Number.isFinite(h)&&m>=h?1:0;case"<=":return Number.isFinite(m)&&Number.isFinite(h)&&m<=h?1:0;case"==":return Number.isFinite(m)&&Number.isFinite(h)&&m===h?1:0;case"!=":return Number.isFinite(m)&&Number.isFinite(h)&&m!==h?1:0;case"and":return Number.isFinite(m)&&m!==0&&Number.isFinite(h)&&h!==0?1:0;case"or":return Number.isFinite(m)&&m!==0||Number.isFinite(h)&&h!==0?1:0;default:return null}}case"CallExpression":{const m=p.callee.toLowerCase();if(m==="iff"&&p.args.length===3){const S=c(p.args[0]);return S==null?null:c(S!==0?p.args[1]:p.args[2])}const h=p.args.map(S=>c(S));if(h.some(S=>S==null))return null;const _=h[0],w=h[1];switch(m){case"min":return Math.min(_,w);case"max":return Math.max(_,w);case"abs":return Math.abs(_);case"ceil":return Math.ceil(_);case"floor":return Math.floor(_);case"round":return Math.round(_);case"sqrt":return Math.sqrt(_);case"pow":return Math.pow(_,w);default:return null}}default:return null}};let d=l;if(d==null)try{const p=Tf(o);d=c(p)}catch{d=null}if(d==null||!Number.isFinite(d))throw new Error(`Line ${t}: cooldown must be a non-negative integer`);if(!Number.isInteger(d))throw new Error(`Line ${t}: cooldown must be a non-negative integer`);if(d<0)throw new Error(`Line ${t}: cooldown must be a non-negative integer`);return d}function P2(n){const e=String(n||"").split(/\n+/),t={},o=[],i=[],r=[],a=[],l={};for(let d=0;d<e.length;d++){const p=e[d],m=d+1,h=p.replace(/#.*$/,"").replace(/\/\/.*$/,"").trim();if(!h)continue;let _;if(_=h.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+)$/),_){const w=_[1],S=_[2].trim(),P=Number(S);Number.isFinite(P)&&/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/.test(S)?t[w]=P:S.startsWith('"')&&S.endsWith('"')||S.startsWith("'")&&S.endsWith("'")?t[w]=Y0(S):o.push({name:w,expr:S});continue}if(_=h.match(/^signal\s+([A-Za-z_$][A-Za-z0-9_$]*)\s+when\s+(.+)\s*$/i),_){const w=_[1],S=HK(_[2]||"");if(!S.when)throw new Error(`Line ${m}: signal ... when requires a condition`);const P=S.when.trim();l[w.toLowerCase()]=P;const I=w.toLowerCase(),C=I==="top"?"entry_long":I==="bot"?"entry_short":I==="buy"?"entry_long":I==="sell"||I==="exit"?"exit_long":I,M=S.scoreRaw!=null?UK(S.scoreRaw,t,m):null,F=S.cooldownRaw!=null?GK(S.cooldownRaw,t,m):void 0;i.push({type:C,when:P,score:M,cooldownBars:F});continue}if(_=h.match(/^label\s+at\s+(top|bot)(?:\s+when\s*\((.+?)\))?\s+(.+)$/i),_){const w=_[1].toLowerCase(),S=(_[2]||"").trim(),P=_[3]||"",I=qK(P),C=I.text?Y0(I.text):w==="top"?"▲":"▼",M=I.color||(w==="top"?"#f97316":"#3b82f6"),F=w==="top"?"above":"below",V=I.source?Y0(I.source):w==="top"?"high":"low",j=I.shape?Y0(I.shape):void 0,D=G=>o.some(se=>se.name.replace(/\s+/g,"_").toLowerCase()===G.replace(/\s+/g,"_").toLowerCase()),R=typeof t.WIN=="number"||typeof t.WIN=="string"&&Number.isFinite(Number(t.WIN)),W=w==="top"?D("hiwin")?"close == HIWIN":R?"close == highest(close, WIN)":"close < -1e20":D("lowin")?"close == LOWIN":R?"close == lowest(close, WIN)":"close < -1e20",Z={when:S||l[w]||W,text:C,color:M,position:F,source:V,shape:j};V==="high"||V==="low"?r.push(Z):a.push(Z);continue}}const c=[];return(r.length||i.length)&&c.push({pane:"main",plots:[],labels:r,levels:[],lines:[]}),a.length&&c.push({pane:"sub",plots:[],labels:a,levels:[],lines:[],min:0,max:100}),{params:t,series:o,signals:i,panes:c}}function YK(n,e){var t;(n.key==="Delete"||n.key==="Backspace")&&(n.preventDefault(),(t=s(e))==null||t.clickRemove())}function KK(n,e,t,o,i){s(e)&&t(),s(o)&&i()}var ZK=(n,e,t)=>kl(t(),rs(e).clickChart+=1,rs(e)),XK=fe('<div class="kline-loading-overlay svelte-1non98y"><div class="loader-content svelte-1non98y"><div class="ai-minimal svelte-1non98y"><div class="brand-text svelte-1non98y">Duty AI</div> <span class="brand-shine svelte-1non98y"></span> <div class="orbit svelte-1non98y"><span class="o-dot o1 svelte-1non98y"></span><span class="o-dot o2 svelte-1non98y"></span></div> <div class="progress-line svelte-1non98y"><span class="dot svelte-1non98y"></span></div> <div class="tagline svelte-1non98y">Preparing data</div></div></div></div>'),JK=n=>n.stopPropagation(),QK=fe('<div class="historical-loading-indicator svelte-1non98y"><div class="loading-spinner svelte-1non98y"></div> <span class="svelte-1non98y">Loading historical data...</span></div>'),eZ=fe('<div class="reset-menu svelte-1non98y"><button class="action-btn copy-btn svelte-1non98y"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" class="svelte-1non98y"><rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2" class="svelte-1non98y"></rect><path d="M5 15H4C2.9 15 2 14.1 2 13V4C2 2.9 2.9 2 4 2H13C14.1 2 15 2.9 15 4V5" stroke="currentColor" stroke-width="2" class="svelte-1non98y"></path></svg> <span class="svelte-1non98y"> </span></button> <button class="action-btn reset-btn svelte-1non98y"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" class="svelte-1non98y"><path d="M3 12C3 7.03 7.03 3 12 3C16.97 3 21 7.03 21 12C21 16.97 16.97 21 12 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" class="svelte-1non98y"></path><path d="M3 12L7 8M3 12L7 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" class="svelte-1non98y"></path></svg> <span class="svelte-1non98y">Reset View</span></button></div>'),tZ=fe('<div class="kline-main svelte-1non98y"><div class="alerts-container svelte-1non98y"></div> <!> <div class="chart-container svelte-1non98y"><div class="chart-shell svelte-1non98y"><div class="kline-content svelte-1non98y"><div class="drawbar-host svelte-1non98y" style="width: var(--drawing-bar-width); overflow: hidden;"><!></div> <!> <div class="kline-widget svelte-1non98y" role="application" tabindex="0"><canvas class="script-overlay svelte-1non98y"></canvas> <canvas class="tool-overlay svelte-1non98y"></canvas></div> <!></div> <div><div class="dock-resize-handle svelte-1non98y" aria-label="Resize script dock"><div class="handle-bar svelte-1non98y"></div></div> <div class="dock-body svelte-1non98y"><!></div></div></div> <!></div> <!> <!> <!> <!> <!> <!> <!> <!></div>');function nZ(n,e){var Rc,Bc,qd,Oc;gd(e,!0);const t=wp(),o=()=>ya(C(),"$save",t),i=()=>ya(Ge,"$chart",t),r=()=>ya(gv,"$simulator",t),a=()=>ya(I(),"$ctx",t),l=()=>ya(A2,"$page",t),c=()=>ya(Fm,"$userPreferences",t),d=()=>ya(Ye,"$alerts",t),p=()=>ya(hn,"$saveRestoring",t),m=()=>ya(CK,"$scriptBacktests",t),h=()=>ya(wK,"$scriptSignals",t);console.log("%c🤖 Welcome to Duty AI Chart %c v1.0.0 ","background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); color: white; font-size: 16px; font-weight: bold; padding: 10px 15px; border-radius: 8px 0 0 8px; text-shadow: 0 1px 2px rgba(0,0,0,0.3);","background: #1a1a2e; color: #00d4ff; font-size: 14px; font-weight: bold; padding: 10px 15px; border-radius: 0 8px 8px 0;"),console.log("%c⚡ Everything Powered by Duty AI %c All Rights Reserved © 2025","background: #0f0f23; color: #00ff88; font-size: 12px; padding: 6px 12px; border-left: 3px solid #00ff88;","background: #0f0f23; color: #888; font-size: 11px; padding: 6px 12px;"),console.log("%c🧠 AI-Driven Trading Intelligence | Real-Time Market Analysis","color: #a855f7; font-size: 11px; font-style: italic; padding: 4px 0;"),rb("UTC");function _(B){const Oe=`${B??""}`.replace(/0[\{\(](\d+)[\}\)]/g,(mt,_n)=>{const en=Number(_n);return!Number.isFinite(en)||en<=0?"0":"0".repeat(Math.min(50,Math.trunc(en)))}),Ue=(mt,_n)=>{if(!Number.isFinite(mt)||mt===0)return`${mt}`;const en=mt<0?"-":"",Vn=Math.abs(mt),Rn=Math.floor(Math.log10(Vn))+1;let xo=Vn/Math.pow(10,Rn),Dn=Rn;const ys=Number(xo.toFixed(_n));return ys>=1?(xo=ys/10,Dn=Rn+1):xo=ys,`${en}${xo.toFixed(_n)}e${Dn}`};try{const mt=/^(-?)([\d,]+)(?:\.(\d+))?$/.exec(Oe.trim());if(mt){const _n=mt[1]||"",en=mt[2]||"0",Vn=mt[3]||"";if(en.replace(/,/g,"").length>=5&&Vn.length>2)return`${_n}${en}.${Vn.slice(0,2).padEnd(2,"0")}`}}catch{}try{const mt=z0(o().symbol);if(mt==="stock"||mt==="crypto"){const _n=Number(Oe.replace(/,/g,"").trim());if(Number.isFinite(_n)){const en=Math.abs(_n);if(en>0&&en<1e-4)return Ue(_n,5)}}}catch{}return Oe}const w=new yM;let S={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},P=null;cI.forEach(B=>Y2(B)),hI.forEach(B=>d6(B)),mM.forEach(B=>{B.extendData=="datafeed"&&(B.extendData=w),H_(B)});let I=Ws(e,"ctx",23,()=>zp(new jx)),C=Ws(e,"save",19,()=>ly("chart",new Q0)),M=Ws(e,"customLoad",3,!1);const F=5e3,V=`{
  "pane": "sub",
  "min": -2,
  "max": 2,
  "shortName": "Debug Area",
  "plots": [
    {
      "name": "AreaTest",
      "source": "close",
      "type": "area",
      "color": "rgba(129,140,248,0.4)",
      "width": 1
    }
  ]
}`;try{const B=sessionStorage.getItem("chart.tabId");B?kl(C(),rs(o).key=`chart:${B}`,rs(o)):o().key||kl(C(),rs(o).key="chart",rs(o))}catch{o().key||kl(C(),rs(o).key="chart",rs(o))}try{const B=o()&&o().symbol&&typeof o().symbol=="object",de=o()&&o().period&&typeof o().period=="object";(!B||!de)&&C().set(new Q0)}catch{C().set(new Q0)}C().update(B=>{if(!(B.allExgs instanceof Set)){const de=Array.isArray(B.allExgs)?B.allExgs:[];B.allExgs=new Set(de)}return B});let j,D,R,W=null,J=null,Z=[],G=null,se=[];const Y=new Set;let oe=null,ee=ae(!1),re=ae(!1),me=ae(null),K=ae(!1),ye=ae(void 0),Me=ae(void 0),Fe=ae(void 0),Ze=ae(void 0);const Ge=zp(null),it=500,Ye=vk();let ct=ae(!1),kt=ae(!1),ft=ae(!1),bt=ae(.35);const nt=.2,Pt=.6;let Qe=ae(!1),yt=0,xe=0,Ve=ae(V),Je=ae(0),St=ae(void 0),Ne=ae("Ready"),ue=ae(null),he=ae(!1),_t=0,Wt="",jt=null,Zt=ae(!0);const dn="SCRIPT_STUDIO";let zn=[],un=[],On=ae(null),no=ae("main"),fs=new Set;const ps="script-trade-focus",So=(B,de)=>{const Oe=typeof B=="number"?B:Number(B);if(!Number.isFinite(Oe))return"-";try{return _(Oe.toFixed(Math.max(0,Math.min(10,de))))}catch{return`${Oe}`}};function Es(){const B=i();if(B)try{B.removeOverlay({groupId:ps})}catch{}}function Qo(B){var Ue;const de=i();if(!de||!B)return;const Oe=mt=>{const _n=typeof mt=="number"?mt:Number(mt);return!Number.isFinite(_n)||_n<=0?null:_n<1e12?_n*1e3:_n};try{const mt=((Ue=de.getDataList)==null?void 0:Ue.call(de))||[],_n=Math.max(0,Math.floor(Number(B.entryIndex)||0)),en=Math.max(0,Math.floor(Number(B.exitIndex)||0)),Vn=mt[_n]||null,Rn=mt[en]||null,xo=Oe(B.entryTimestamp)??Oe((Vn==null?void 0:Vn.timestamp)??(Vn==null?void 0:Vn.time))??null,Dn=Oe(B.exitTimestamp)??Oe((Rn==null?void 0:Rn.timestamp)??(Rn==null?void 0:Rn.time))??null,ys=Number(B.entryPrice),jn=Number(B.exitPrice);if(!Number.isFinite(ys)||!Number.isFinite(jn)||xo==null||Dn==null)return;Es();const Sn=Number(B.netPnl)>=0,Un=Sn?"#22c55e":"#ef4444",$n=Sn?"#16a34a":"#ef4444",ms=Sn?"#16a34a":"#f59e0b",Wo=Number(B.netPnl)||0,Yo=Number(B.fees)||0,Po=String(B.exitReason||"").replace(/_/g," ");de.createOverlay({name:"trade",paneId:"candle_pane",groupId:ps,lock:!0,visible:!0,points:[{timestamp:xo,value:ys},{timestamp:Dn,value:jn},{timestamp:Dn,value:jn}],extendData:{line_color:Un,in_color:$n,out_color:ms,in_text:`ENTRY ${String(B.side||"").toUpperCase()} @ ${So(ys,6)}`,out_text:`EXIT @ ${So(jn,6)} • ${Po||"signal"} • Net ${Wo>=0?"+":""}${So(Wo,2)} • Fees ${So(Yo,2)}`,selected:!0,active:!0,distance:18}});try{de.createOverlay({name:"note",paneId:"candle_pane",groupId:ps,lock:!0,visible:!0,points:[{timestamp:xo,value:ys},{timestamp:xo,value:ys}],extendData:{line_color:"transparent",in_color:$n,in_text:"ENTRY",out_color:$n,out_text:"",distance:22}}),de.createOverlay({name:"note",paneId:"candle_pane",groupId:ps,lock:!0,visible:!0,points:[{timestamp:Dn,value:jn},{timestamp:Dn,value:jn}],extendData:{line_color:"transparent",in_color:ms,in_text:`EXIT • ${Po||"signal"}`,out_color:ms,out_text:"",distance:22}})}catch{}try{de.scrollToDataIndex(en,0)}catch{try{de.scrollToTimestamp(Dn,0)}catch{}}}catch(mt){console.error("[ScriptStudio] focus trade failed",mt)}}function Ko(B){const de=i();if(!de)return!1;const Oe=Math.max(0,Math.floor(Number(B)||0));try{return de.scrollToDataIndex(Oe,0),!0}catch(Ue){return console.error("[ScriptStudio] focus index failed",Ue),!1}}function oo(B){const de=i();if(!de)return!1;const Oe=Math.floor(Number(B)||0);if(!Number.isFinite(Oe)||Oe<=0)return!1;try{return de.scrollToTimestamp(Oe,0),!0}catch(Ue){return console.error("[ScriptStudio] focus timestamp failed",Ue),!1}}let Gs=new Map;const jo=new Set;let fi=null,ba=null;const xa={solid:Ke.Solid,dashed:Ke.Dashed,dotted:Ke.Dashed};let Al={};const Qs=new Map,Fs=new Map,Va=B=>{if(!B)return 0;let de=2166136261;for(let Ue=0;Ue<B.length;(Ue+=1)-1)de^=B.charCodeAt(Ue),de=Math.imul(de,16777619);const Oe=de>>>0;return Oe===0?1:Oe},$r=B=>{const de=String(B||"");let Oe="",Ue=0;for(;Ue<de.length;){const mt=de[Ue];if(mt==='"'||mt==="'"){const _n=mt;Ue+=1;let en="",Vn=!1;for(;Ue<de.length;){const Rn=de[Ue];if(Vn){en+=Rn,Vn=!1,Ue+=1;continue}if(Rn==="\\"){Vn=!0,Ue+=1;continue}if(Rn===_n){Ue+=1;break}en+=Rn,Ue+=1}Oe+=String(Va(en));continue}Oe+=mt,Ue+=1}return Oe};function cd(B){let de=String(B||"").trim();return de=de.replace(/\$\{([^}]+)\}/g,(Oe,Ue)=>{const mt=Al[String(Ue)];if(mt==null)return Oe;if(typeof mt=="number"&&Number.isFinite(mt)||typeof mt=="string")return String(mt);try{return JSON.stringify(mt)}catch{return String(mt)}}),de=de.replace(/\/\/.*$/,"").replace(/#.*$/,""),de=de.split(";")[0],de=de.replace(/,\s*$/,""),de=de.replace(/\b(and|or)\b\s*$/i,""),de=de.replace(/\bta\./gi,""),de=de.replace(/\bmath\./gi,""),de=de.replace(/\bstr\./gi,""),de=de.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),de=de.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),de=de.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(Oe,Ue,mt)=>`${String(Ue).toLowerCase()}_${mt}`),de=$r(de),de=de.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),de=de.replace(/\bcrosses\s+below\b/gi,"crossesBelow"),de.trim()}function Sd(B){const de=String(B||"");let Oe="",Ue=null,mt=0;const _n=Vn=>/[A-Za-z_$]/.test(Vn),en=Vn=>/[A-Za-z0-9_$]/.test(Vn);for(;mt<de.length;){const Vn=de[mt];if(Ue){Oe+=Vn,Vn===Ue&&de[mt-1]!=="\\"&&(Ue=null),mt+=1;continue}if(Vn==="'"||Vn==='"'){Ue=Vn,Oe+=Vn,mt+=1;continue}if(_n(Vn)){let Rn=mt+1;for(;Rn<de.length&&en(de[Rn]);)Rn+=1;const xo=de.slice(mt,Rn);let Dn=Rn;for(;Dn<de.length&&/\s/.test(de[Dn]);)Dn+=1;if(de[Dn]==="["){let ys=Dn+1;for(;ys<de.length&&/\s/.test(de[ys]);)ys+=1;let jn=1;de[ys]==="-"&&(jn=-1,ys+=1);let Sn=ys;for(;Sn<de.length&&/[0-9]/.test(de[Sn]);)Sn+=1;const Un=de.slice(ys,Sn);for(;Sn<de.length&&/\s/.test(de[Sn]);)Sn+=1;if(Un&&de[Sn]==="]"){const $n=jn*Number(Un);if(Number.isFinite($n)&&$n>=1){Oe+=`prev(${xo}, ${Math.floor($n)})`,mt=Sn+1;continue}if(Number.isFinite($n)&&$n===0){Oe+=xo,mt=Sn+1;continue}}}Oe+=xo,mt=Rn;continue}Oe+=Vn,mt+=1}return Oe}function Nl(B){let de=String(B||"").replace(/\bta\./g,"").replace(/\bmath\./g,"").replace(/\bstr\./g,"").replace(/\b(line|label|box|table)\.get_/gi,"$1_get_").replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2").replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(Oe,Ue,mt)=>`${String(Ue).toLowerCase()}_${mt}`);return de=$r(de),Sd(de)}function dd(B){let de=String(B||"").replace(/\bta\./g,"").replace(/\bmath\./g,"").replace(/\bstr\./g,"").replace(/\b(line|label|box|table)\.get_/gi,"$1_get_").replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2").replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(Oe,Ue,mt)=>`${String(Ue).toLowerCase()}_${mt}`);return Sd(de)}function Cd(B){const de=cd(B);try{return Lg(de)}catch{let Ue=de.replace(/[^A-Za-z0-9_().<>=!,\s]/g,"");Ue=Ue.replace(/[,;]+\s*$/,"").replace(/\b(and|or)\b\s*$/i,"").trim(),Ue=Ue.replace(/\bcrosses\s+above\b/gi,"crossesAbove").replace(/\bcrosses\s+below\b/gi,"crossesBelow");try{return Lg(Ue)}catch{const _n=Ue.match(/([A-Za-z_$][A-Za-z0-9_$]*)/),en=Ue.match(/([-+]?\d+(?:\.\d+)?)/),Vn=/crossesBelow|\bbelow\b/i.test(Ue),Rn=_n?_n[1]:"close",xo=en?en[1]:"0",Dn=`${Rn} ${Vn?"<":">"} ${xo}`;return Lg(Dn)}}}function fa(B,de){var Oe,Ue,mt;try{const _n=Cd(B);return e2(_n,de)}catch{const Vn=cd(B).match(/^(\w+)\s*(crossesAbove|crossesBelow)\s*(\w+|[-+]?\d+(?:\.\d+)?)$/i),Rn=((Oe=Object.values(de)[0])==null?void 0:Oe.length)||0,xo=new Uint8Array(Rn);if(Vn&&Rn){const Dn=Vn[1],ys=Vn[2],jn=Vn[3],Sn=de[((Ue=Dn==null?void 0:Dn.toLowerCase)==null?void 0:Ue.call(Dn).replace(/\s+/g,"_"))||Dn],Un=/^[-+]?\d+(?:\.\d+)?$/.test(jn),$n=Un?null:de[((mt=jn==null?void 0:jn.toLowerCase)==null?void 0:mt.call(jn).replace(/\s+/g,"_"))||jn],ms=Un?Number(jn):NaN;if(Sn&&($n||Un))for(let Wo=1;Wo<Rn;(Wo+=1)-1){const Yo=Sn[Wo-1],Po=Sn[Wo],Is=Un?ms:$n[Wo-1],An=Un?ms:$n[Wo];if(![Yo,Po,Is,An].every(Number.isFinite)){xo[Wo]=0;continue}xo[Wo]=ys.toLowerCase()==="crossesabove"?Yo<=Is&&Po>An?1:0:Yo>=Is&&Po<An?1:0}}return xo}}let Dl=!1,ml=ae(!1),gl=ae(null),_d=!0,Kl=null,ic=!1,od=0,zd=null,Ec=ae(!1),al=null,kc=0;function Vd(){return kc+=1,kc}let sd=null,id=null,Pd=null,Ed=null,zl=null,Gd=null,lu=null,Yd=null;const eu=()=>{i()&&(sd&&(clearTimeout(sd),sd=null),id&&(cancelAnimationFrame(id),id=null),id=requestAnimationFrame(()=>{id=null,tn.request(()=>{if(!i())return;i().resize(),window.__forceApplySavedCanvasColors=!0;const B=wu(o().theme);Mn.merge(B,Cm(o().styles)),i().setStyles($d(B)),qt(),di(),ks()})}),sd=setTimeout(()=>{sd=null,tn.request(()=>{var Oe,Ue;if(!i())return;i().resize(),window.__forceApplySavedCanvasColors=!0;const B=wu(o().theme);Mn.merge(B,Cm(o().styles)),i().setStyles($d(B)),qt(),di(),ks();const de=(Ue=(Oe=i()).getVisibleRange)==null?void 0:Ue.call(Oe);de&&typeof de.to=="number"&&setTimeout(()=>{i()&&(i().scrollToDataIndex(de.to,0),console.log("🔄 Forced canvas redraw after window resize to prevent blur"))},30)})},160))};function Ju(B){const de=(B==null?void 0:B.ticker)||(B==null?void 0:B.symbol);if(de)return`https://s3-api.bayah.app/cdn/symbol/logo/${de}.svg`}function mu(B){if(!B)return B;const de=Ju(B);return B.logo&&B.logo2?B:{...B,logo:B.logo||B.logo2||de,logo2:B.logo2}}const yd=gy(),tn=C_(),En=new hy("global-chart",Ge,o().theme||"dark");let go=null;const hn=zp(!1);Xm("ctx",I()),Xm("save",C()),Xm("chart",Ge),Xm("alerts",Ye),Xm("datafeed",w),Xm("renderIntegration",yd),Xm("globalThemeManager",En),Xm("drawingManager",{get:()=>go}),Xm("saveRestoring",hn);function Ho(B){const de=B.match(/WIN\s*=\s*(\d+)/i),Oe=Math.max(2,Math.min(500,de&&parseInt(de[1],10)||5)),Ue=B.match(/label\s+at\s+top\s+text:\s*\"?([^\"\n]+)\"?/i),mt=B.match(/label\s+at\s+bot\s+text:\s*\"?([^\"\n]+)\"?/i),_n=B.match(/label\s+at\s+top.*color:\s*([#a-zA-Z0-9]+)/i),en=B.match(/label\s+at\s+bot.*color:\s*([#a-zA-Z0-9]+)/i),Vn=((Ue==null?void 0:Ue[1])||"▲").trim(),Rn=((mt==null?void 0:mt[1])||"▼").trim(),xo=((_n==null?void 0:_n[1])||"#f97316").trim(),Dn=((en==null?void 0:en[1])||"#3b82f6").trim();if(!Vn||!Rn)throw new Error("Script is missing label text for top/bot.");return{window:Oe,topText:Vn,botText:Rn,topColor:xo,botColor:Dn}}function Eo(B,de){return{name:de,shortName:"Script",precision:4,zLevel:10,calcParams:[B.window],figures:[{key:"hi",title:`HI(${B.window})`,type:"line"},{key:"lo",title:`LO(${B.window})`,type:"line"}],styles:{lines:[{color:"rgba(0,0,0,0)",size:1e-4,style:Ke.Solid},{color:"rgba(0,0,0,0)",size:1e-4,style:Ke.Solid}]},shouldOhlc:!0,calc:(Oe,Ue)=>{var Vn;const mt=Math.max(2,Math.min(500,((Vn=Ue.calcParams)==null?void 0:Vn[0])||B.window||5)),_n=Math.max(2,Math.floor(mt/2)),en=[];for(let Rn=0;Rn<Oe.length;(Rn+=1)-1){const xo=Oe[Rn].high??Oe[Rn].close,Dn=Oe[Rn].low??Oe[Rn].close;let ys,jn,Sn=!1,Un=!1;if(Rn>=_n&&Rn<=Oe.length-_n-1){const $n=Rn-_n,ms=Rn+_n;let Wo=-1/0,Yo=1/0;for(let Ro=$n;Ro<=ms;(Ro+=1)-1){const vn=Oe[Ro].high??Oe[Ro].close,on=Oe[Ro].low??Oe[Ro].close;vn>Wo&&(Wo=vn),on<Yo&&(Yo=on)}ys=Wo,jn=Yo;const Po=Math.max(1e-8,Math.abs(xo||Dn||1)*1e-4);let Is=-1,An=-1;for(let Ro=$n;Ro<=ms;(Ro+=1)-1){const vn=Oe[Ro].high??Oe[Ro].close,on=Oe[Ro].low??Oe[Ro].close;if(Is===-1&&Math.abs(vn-Wo)<=Po&&(Is=Ro),An===-1&&Math.abs(on-Yo)<=Po&&(An=Ro),Is!==-1&&An!==-1)break}Sn=Math.abs(xo-Wo)<=Po&&Rn===Is,Un=Math.abs(Dn-Yo)<=Po&&Rn===An}en.push({hi:ys,lo:jn,high:xo,low:Dn,topSignal:Sn,botSignal:Un})}return en},draw:({ctx:Oe,indicator:Ue,xAxis:mt,yAxis:_n,bounding:en})=>{if(!Oe||!mt||!_n)return!1;const Vn=(Ue==null?void 0:Ue.result)||[];Oe.save(),en&&(Oe.beginPath(),Oe.rect(0,0,en.width,en.height),Oe.clip()),Oe.textAlign="center",Oe.textBaseline="middle",Oe.font='12px "Inter", "SF Pro", system-ui, -apple-system, sans-serif';for(let Rn=0;Rn<Vn.length;(Rn+=1)-1){const xo=Vn[Rn];if(!xo)continue;const Dn=mt.convertToPixel(Rn);if(xo.topSignal&&xo.hi!==void 0){const ys=_n.convertToPixel(xo.hi);if(Number.isFinite(ys)){const jn=ys-8;Oe.fillStyle=B.topColor,Oe.strokeStyle="rgba(0,0,0,0.35)",Oe.lineWidth=1,Oe.textBaseline="middle",Oe.fillText(B.topText,Dn,jn),Oe.strokeText(B.topText,Dn,jn),Oe.beginPath(),Oe.arc(Dn,jn-8,3.5,0,Math.PI*2),Oe.fill(),Oe.stroke()}}if(xo.botSignal&&xo.lo!==void 0){const ys=_n.convertToPixel(xo.lo);if(Number.isFinite(ys)){const jn=ys+8;Oe.fillStyle=B.botColor,Oe.strokeStyle="rgba(0,0,0,0.35)",Oe.lineWidth=1,Oe.textBaseline="middle",Oe.fillText(B.botText,Dn,jn),Oe.strokeText(B.botText,Dn,jn),Oe.beginPath(),Oe.arc(Dn,jn+8,3.5,0,Math.PI*2),Oe.fill(),Oe.stroke()}}}return Oe.restore(),!0}}}function di(){if(!j)return;const B=j.getBoundingClientRect(),de=typeof window<"u"?Math.max(1,window.devicePixelRatio||1):1,Oe=Ue=>{if(!Ue)return;Ue.style.width=`${B.width}px`,Ue.style.height=`${B.height}px`,Ue.width=Math.floor(B.width*de),Ue.height=Math.floor(B.height*de);const mt=Ue.getContext("2d");mt&&mt.setTransform(de,0,0,de,0,0)};Oe(D),Oe(R),W=D==null?void 0:D.getContext("2d"),J=R==null?void 0:R.getContext("2d")}function ns(){const B={},de=j==null?void 0:j.getBoundingClientRect(),Oe=(de==null?void 0:de.width)??((D==null?void 0:D.width)||0),Ue=(de==null?void 0:de.height)??((D==null?void 0:D.height)||0),mt=new DOMRect(0,0,Oe,Ue);return((j==null?void 0:j.querySelectorAll('[class*="klinecharts-pane"]'))||[]).forEach((en,Vn)=>{const xo=en.getAttribute("data-pane-id")||en.getAttribute("data-id")||""||(Vn===0?"candle_pane":`pane_index_${Vn}`);if(!xo)return;const Dn=en.getBoundingClientRect();if(de){const ys=Dn.left-de.left,jn=Dn.top-de.top;B[xo]=new DOMRect(ys,jn,Dn.width,Dn.height)}else B[xo]=mt}),B.candle_pane||(B.candle_pane=mt),B}function $i(B){var _n,en,Vn,Rn,xo,Dn;if(!i())return null;const de=i(),Oe=((_n=de.getDrawPaneById)==null?void 0:_n.call(de,B))??((en=de._drawPanes)==null?void 0:en.find(ys=>{var jn;return((jn=ys==null?void 0:ys.getId)==null?void 0:jn.call(ys))===B}));if(!(Oe!=null&&Oe.getAxisComponent))return null;const Ue=Oe.getAxisComponent(),mt=((xo=(Rn=(Vn=Oe.getMainWidget)==null?void 0:Vn.call(Oe))==null?void 0:Rn.getBounding)==null?void 0:xo.call(Rn))??((Dn=Oe.getBounding)==null?void 0:Dn.call(Oe));return Ue?{axis:Ue,bounding:mt}:null}function hi(B){var Rn,xo;const de=Gs.get(B);if(!de)return;const Oe=$i(B);if(!Oe)return;const{axis:Ue}=Oe,mt=Math.min(de.min,de.max),_n=Math.max(de.min,de.max),en=Math.max(1e-9,_n-mt),Vn={from:mt,to:_n,range:en,realFrom:mt,realTo:_n,realRange:en,displayFrom:mt,displayTo:_n,displayRange:en};(Rn=Ue.setRange)==null||Rn.call(Ue,Vn),(xo=Ue.buildTicks)==null||xo.call(Ue,!0)}function li(B){Gs.has(B)&&(jo.has(B)||(jo.add(B),tn.request(()=>{jo.delete(B),hi(B)})))}function ks(){var mt,_n,en;if(!W||!i())return;const B=W;B.clearRect(0,0,D.width,D.height),B.save(),B.font='12px "Inter", system-ui, -apple-system, sans-serif',B.textAlign="center",B.textBaseline="middle";const de=ns(),Oe=((_n=(mt=i()).getDataList)==null?void 0:_n.call(mt))||[],Ue=[];for(const Vn of se){const{def:Rn,paneId:xo}=Vn,Dn=Rn==null?void 0:Rn.__lastResult,ys=Array.isArray(Dn)?Dn:Array.isArray(Dn==null?void 0:Dn.__rows)?Dn.__rows:[];if(!Array.isArray(ys)||ys.length===0||!Dn)continue;const jn=de[xo]||de.candle_pane,Sn={left:jn.left,top:jn.top,width:jn.width,height:jn.height},Un=Dn.__labelItems;if(Array.isArray(Un)){const Wo=Dn.__tsIndex||{},Yo={},Po={};for(const Is of Un){const An=Is==null?void 0:Is.meta;if(!An)continue;const Ro=An==null?void 0:An.value;if(typeof Ro!="number"||!Number.isFinite(Ro))continue;const vn=Is==null?void 0:Is.ts,on=Is==null?void 0:Is.tsMs,rn=(()=>{if(typeof(Is==null?void 0:Is.index)=="number")return Is.index;if(typeof vn=="number"&&Number.isFinite(vn)){const bi=Wo[String(vn)];if(typeof bi=="number")return bi}if(typeof on=="number"&&Number.isFinite(on)){const bi=Wo[`${Math.floor(on)}_ms`]??Wo[`${Math.floor(on/1e3)}_s`];if(typeof bi=="number")return bi}})();if(typeof rn!="number"||!Number.isFinite(rn))continue;const fo=(An.position||"above")==="above",Bn=typeof An.size=="number"&&An.size>0?An.size:12,Io=typeof An.offsetY=="number"?An.offsetY:10,Gn=fo?Yo[rn]||0:Po[rn]||0,ti=Io+Gn*Math.max(6,Bn/3);fo?Yo[rn]=Gn+1:Po[rn]=Gn+1;const Ds=(An==null?void 0:An.tooltip)!=null?String(An.tooltip):"";Ds&&Ue.push({kind:"label",paneId:xo,ts:typeof vn=="number"?vn:void 0,index:rn,value:Ro,tooltip:Ds,size:Bn,isAbove:fo,offsetPx:ti})}}const $n=Dn.__runtimeTables;if(Array.isArray($n))for(const Wo of $n)(Array.isArray(Wo==null?void 0:Wo.cells)?Wo.cells:[]).some(Is=>Is==null?void 0:Is.tooltip)&&Ue.push({kind:"table",paneId:xo,table:Wo});const ms=xK(Rn.name);if(Array.isArray(ms)&&ms.length)for(const Wo of ms){const Yo=Wo.index,Po=Oe[Yo],Is=(Po==null?void 0:Po.timestamp)??(Po==null?void 0:Po.time);if(!Number.isFinite(Is))continue;let An,Ro="",vn="",on=!0,rn="";Wo.type==="entry_long"?(An=(Po==null?void 0:Po.low)??(Po==null?void 0:Po.close),Ro="triangle_up_filled",vn="#16a34a",on=!0,rn="BUY"):Wo.type==="exit_long"?(An=(Po==null?void 0:Po.high)??(Po==null?void 0:Po.close),Ro="triangle_down_filled",vn="#f59e0b",on=!1,rn="EXIT"):Wo.type==="entry_short"?(An=(Po==null?void 0:Po.high)??(Po==null?void 0:Po.close),Ro="triangle_down_filled",vn="#ef4444",on=!1,rn="SELL"):Wo.type==="exit_short"&&(An=(Po==null?void 0:Po.low)??(Po==null?void 0:Po.close),Ro="triangle_up_filled",vn="#f59e0b",on=!0,rn="EXIT");const fo=Array.isArray(Rn==null?void 0:Rn.figures)&&((en=Rn.figures[0])!=null&&en.key)?String(Rn.figures[0].key):"",Bn=xo!=="candle_pane";let Io=An;if(Bn&&fo){const Jl=(ys[Yo]||{})[fo];Jl!=null&&Number.isFinite(Jl)&&(Io=Jl)}if(!Number.isFinite(Io))continue;const Gn=v_({id:Yo,t:Is,p:Io},{chart:i(),paneId:xo});if(!Gn)continue;let ti=Gn.y;const Ds=10;ti=on?ti-Ds:ti+Ds;const bi=Sn.top+6,yl=Sn.top+Sn.height-6;ti=Math.max(bi,Math.min(yl,ti));const uc=Ro==="triangle_up_filled"?"triangleUpFilled":Ro==="triangle_down_filled"?"triangleDownFilled":Ro==="arrow_up"?"arrowUp":Ro==="arrow_down"?"arrowDown":"label",kr=16,Ka=kr/2,ni="rgba(15,23,42,0.95)",Ca="rgba(0,0,0,0.65)",wa=vn;if(B.lineWidth=1,B.strokeStyle=Ca,B.fillStyle=vn||ni,uc==="triangleUpFilled")B.beginPath(),B.moveTo(Gn.x,ti-Ka),B.lineTo(Gn.x-Ka,ti+Ka),B.lineTo(Gn.x+Ka,ti+Ka),B.closePath(),B.fill(),B.stroke();else if(uc==="triangleDownFilled")B.beginPath(),B.moveTo(Gn.x,ti+Ka),B.lineTo(Gn.x-Ka,ti-Ka),B.lineTo(Gn.x+Ka,ti-Ka),B.closePath(),B.fill(),B.stroke();else if(uc==="arrowUp")B.beginPath(),B.moveTo(Gn.x,ti-Ka),B.lineTo(Gn.x-Ka,ti+Ka),B.lineTo(Gn.x+Ka,ti+Ka),B.closePath(),B.fill(),B.stroke();else if(uc==="arrowDown")B.beginPath(),B.moveTo(Gn.x,ti+Ka),B.lineTo(Gn.x-Ka,ti-Ka),B.lineTo(Gn.x+Ka,ti-Ka),B.closePath(),B.fill(),B.stroke();else{const Pa=Math.max(10,B.measureText(rn).width+12),Jl=Math.max(12,kr+6),bd=Math.max(3,Math.floor(Jl/3)),Fo=Gn.x-Math.floor(Pa/2),Ql=ti-Math.floor(Jl/2);B.beginPath();const Dc=bd;B.moveTo(Fo+Dc,Ql),B.lineTo(Fo+Pa-Dc,Ql),B.quadraticCurveTo(Fo+Pa,Ql,Fo+Pa,Ql+Dc),B.lineTo(Fo+Pa,Ql+Jl-Dc),B.quadraticCurveTo(Fo+Pa,Ql+Jl,Fo+Pa-Dc,Ql+Jl),B.lineTo(Fo+Dc,Ql+Jl),B.quadraticCurveTo(Fo,Ql+Jl,Fo,Ql+Jl-Dc),B.lineTo(Fo,Ql+Dc),B.quadraticCurveTo(Fo,Ql,Fo+Dc,Ql),B.closePath(),B.fill(),B.stroke()}rn&&(B.fillStyle=wa,B.strokeStyle="rgba(0,0,0,0.45)",B.fillText(rn,Gn.x,ti),B.strokeText(rn,Gn.x,ti))}}Z=Ue,gs(),W==null||W.restore()}function Vi(){!J||!R||J.clearRect(0,0,R.width,R.height)}function gs(){G!=null&&cancelAnimationFrame(G),G=requestAnimationFrame(()=>{G=null,Na()})}function ll(B,de,Oe){const Ue=String(de||"").split(/\r?\n/),mt=[];for(const _n of Ue){const en=_n.split(/\s+/).filter(Boolean);if(!en.length){mt.push("");continue}let Vn="";const Rn=()=>{Vn&&(mt.push(Vn),Vn="")},xo=Dn=>{if(!Dn)return;if(B.measureText(Dn).width>Oe&&Oe>4){Rn();let Sn="";for(const Un of Dn){const $n=Sn+Un;B.measureText($n).width>Oe&&Sn?(mt.push(Sn),Sn=Un):Sn=$n}Sn&&mt.push(Sn);return}const jn=Vn?`${Vn} ${Dn}`:Dn;B.measureText(jn).width>Oe&&Vn?(Rn(),Vn=Dn):Vn=jn};for(const Dn of en)xo(Dn);Rn()}return mt.length?mt:[de]}function mi(B,de,Oe,Ue,mt,_n){if(!de)return;const en=260,Vn=10,Rn=8,xo=16;B.save(),B.font='12px "Inter", system-ui, -apple-system, sans-serif';const Dn=ll(B,de,en-Vn*2);let ys=0;for(const Po of Dn)ys=Math.max(ys,B.measureText(Po).width);const jn=Math.min(en,Math.max(60,ys+Vn*2)),Sn=Math.max(xo+Rn*2,Dn.length*xo+Rn*2);let Un=Oe+12,$n=Ue+12;Un+jn>mt-8&&(Un=Oe-jn-12),$n+Sn>_n-8&&($n=Ue-Sn-12),Un=Math.max(8,Math.min(mt-jn-8,Un)),$n=Math.max(8,Math.min(_n-Sn-8,$n));const ms=8;B.fillStyle="rgba(15,23,42,0.92)",B.strokeStyle="rgba(148,163,184,0.35)",B.lineWidth=1,B.beginPath(),B.moveTo(Un+ms,$n),B.lineTo(Un+jn-ms,$n),B.quadraticCurveTo(Un+jn,$n,Un+jn,$n+ms),B.lineTo(Un+jn,$n+Sn-ms),B.quadraticCurveTo(Un+jn,$n+Sn,Un+jn-ms,$n+Sn),B.lineTo(Un+ms,$n+Sn),B.quadraticCurveTo(Un,$n+Sn,Un,$n+Sn-ms),B.lineTo(Un,$n+ms),B.quadraticCurveTo(Un,$n,Un+ms,$n),B.closePath(),B.fill(),B.stroke(),B.fillStyle="#e2e8f0",B.textAlign="left",B.textBaseline="top";let Wo=$n+Rn;const Yo=Un+Vn;for(const Po of Dn)B.fillText(Po,Yo,Wo),Wo+=xo;B.restore()}function Na(){var xo,Dn,ys,jn;if(!J||!R||!j)return;if(J.clearRect(0,0,R.width,R.height),!Z.length){try{ks()}catch{}if(!Z.length)return}const B=i();if(!B)return;const de=j.getBoundingClientRect(),Oe=ns();let Ue=s(Zc),mt=s(ce);const _n=(ys=(xo=B.getChartStore)==null?void 0:(Dn=xo.call(B)).getCrosshair)==null?void 0:ys.call(Dn);if(_n&&(Number.isFinite(_n.realX)||Number.isFinite(_n.x))){const Sn=_n.paneId||"candle_pane",Un=Oe[Sn]||Oe.candle_pane,$n=typeof _n.realX=="number"?_n.realX:_n.x;if(typeof $n=="number"&&Number.isFinite($n)&&(Ue=$n),typeof _n.y=="number"&&Number.isFinite(_n.y)){const ms=(Un==null?void 0:Un.top)??0;mt=_n.y+ms}}if(Ue==null||mt==null||Ue<0||mt<0||Ue>de.width||mt>de.height)return;const en=((jn=B.getDataList)==null?void 0:jn.call(B))||[];let Vn=null;for(const Sn of Z){if(Sn.kind!=="table")continue;const Un=Oe[Sn.paneId]||Oe.candle_pane;if(!Un)continue;const $n=Ue-Un.left,ms=mt-Un.top,Wo=Sn.table;if(!Wo||$n<0||ms<0)continue;const Yo=Math.max(1,Math.floor(Number(Wo.columns??1))),Po=Math.max(1,Math.floor(Number(Wo.rows??1))),Is=typeof Wo.textSize=="number"&&Wo.textSize>0?Wo.textSize:12,An=8,Ro=new Array(Yo).fill(0),vn=new Array(Po).fill(Math.max(20,Is+8)),on=Array.isArray(Wo.cells)?Wo.cells:[],rn=new Map;for(const ni of on){const Ca=Math.max(0,Math.min(Yo-1,ni.column)),wa=Math.max(0,Math.min(Po-1,ni.row));rn.set(`${Ca}:${wa}`,ni)}const fo=Array.isArray(Wo.merges)?Wo.merges:[],Bn=new Map,Io=new Map;for(const ni of fo){if(!ni)continue;let Ca=Math.max(0,Math.min(Yo-1,Math.floor(Number(ni.left)))),wa=Math.max(0,Math.min(Yo-1,Math.floor(Number(ni.right)))),Pa=Math.max(0,Math.min(Po-1,Math.floor(Number(ni.top)))),Jl=Math.max(0,Math.min(Po-1,Math.floor(Number(ni.bottom))));if(!Number.isFinite(Ca)||!Number.isFinite(wa)||!Number.isFinite(Pa)||!Number.isFinite(Jl))continue;Ca>wa&&([Ca,wa]=[wa,Ca]),Pa>Jl&&([Pa,Jl]=[Jl,Pa]);const bd=`${Ca}:${Pa}:${wa}:${Jl}`;Io.has(bd)||Io.set(bd,{left:Ca,top:Pa,right:wa,bottom:Jl,minW:0,minH:0});for(let Fo=Ca;Fo<=wa;(Fo+=1)-1)for(let Ql=Pa;Ql<=Jl;(Ql+=1)-1)Bn.set(`${Fo}:${Ql}`,{left:Ca,top:Pa,right:wa,bottom:Jl})}for(const ni of on){const Ca=Math.max(0,Math.min(Yo-1,ni.column)),wa=Math.max(0,Math.min(Po-1,ni.row)),Pa=Bn.get(`${Ca}:${wa}`);if(Pa&&(Pa.left!==Ca||Pa.top!==wa))continue;const Jl=ni.text||"",bd=typeof ni.textSize=="number"&&ni.textSize>0?ni.textSize:Is;J.font=`${bd}px "Inter", system-ui, -apple-system, sans-serif`;const Fo=J.measureText(Jl).width+An*2,Ql=typeof ni.width=="number"&&ni.width>0?ni.width:0,Dc=typeof ni.height=="number"&&ni.height>0?ni.height:Math.max(20,bd+8);if(Pa){const Ee=`${Pa.left}:${Pa.top}:${Pa.right}:${Pa.bottom}`,ac=Io.get(Ee);ac&&(ac.minW=Math.max(ac.minW,Fo,Ql),ac.minH=Math.max(ac.minH,Dc))}else Ro[Ca]=Math.max(Ro[Ca],Fo,Ql),vn[wa]=Math.max(vn[wa],Dc)}for(let ni=0;ni<Yo;(ni+=1)-1)Ro[ni]<60&&(Ro[ni]=60);for(const ni of Io.values()){let Ca=0;for(let Pa=ni.left;Pa<=ni.right;(Pa+=1)-1)Ca+=Ro[Pa]||0;Ca<ni.minW&&(Ro[ni.right]=(Ro[ni.right]||0)+(ni.minW-Ca));let wa=0;for(let Pa=ni.top;Pa<=ni.bottom;(Pa+=1)-1)wa+=vn[Pa]||0;wa<ni.minH&&(vn[ni.bottom]=(vn[ni.bottom]||0)+(ni.minH-wa))}const Gn=Ro.reduce((ni,Ca)=>ni+Ca,0),ti=vn.reduce((ni,Ca)=>ni+Ca,0),Ds=String(Wo.position||"top_right").toLowerCase();let bi=An,yl=An;const uc=Un.width,kr=Un.height;if(Ds.includes("top_right")?(bi=uc-Gn-An,yl=An):Ds.includes("bottom_left")?(bi=An,yl=kr-ti-An):Ds.includes("bottom_right")?(bi=uc-Gn-An,yl=kr-ti-An):Ds.includes("top_center")?(bi=(uc-Gn)/2,yl=An):Ds.includes("bottom_center")?(bi=(uc-Gn)/2,yl=kr-ti-An):(Ds.includes("middle_center")||Ds.includes("center"))&&(bi=(uc-Gn)/2,yl=(kr-ti)/2),$n<bi||ms<yl||$n>bi+Gn||ms>yl+ti)continue;let Ka=bi;for(let ni=0;ni<Yo;(ni+=1)-1){let Ca=yl;for(let wa=0;wa<Po;(wa+=1)-1){const Pa=Ro[ni],Jl=vn[wa],bd=Bn.get(`${ni}:${wa}`);if(bd&&(bd.left!==ni||bd.top!==wa)){Ca+=Jl;continue}const Fo=bd?(()=>{let Ee=0;for(let ac=bd.left;ac<=bd.right;(ac+=1)-1)Ee+=Ro[ac]||0;return Ee})():Pa,Ql=bd?(()=>{let Ee=0;for(let ac=bd.top;ac<=bd.bottom;(ac+=1)-1)Ee+=vn[ac]||0;return Ee})():Jl,Dc=rn.get(`${ni}:${wa}`);if(Dc!=null&&Dc.tooltip&&$n>=Ka&&$n<=Ka+Fo&&ms>=Ca&&ms<=Ca+Ql){Vn={text:String(Dc.tooltip),x:Un.left+Ka+Fo/2,y:Un.top+Ca+Ql/2};break}Ca+=Jl}if(Vn)break;Ka+=Ro[ni]}if(Vn)break}if(Vn){mi(J,Vn.text,Vn.x,Vn.y,de.width,de.height);return}let Rn=null;for(const Sn of Z){if(Sn.kind!=="label")continue;const Un=typeof Sn.ts=="number"?Sn.ts:typeof Sn.index=="number"?(()=>{const fo=en[Sn.index];return(fo==null?void 0:fo.timestamp)??(fo==null?void 0:fo.time)??(fo==null?void 0:fo.t)})():void 0;if(typeof Un!="number"||!Number.isFinite(Un))continue;const $n=Un<1e12?Un*1e3:Un,ms=v_({t:$n,p:Sn.value},{chart:B,paneId:Sn.paneId});if(!ms)continue;let Wo=ms.y;const Yo=typeof Sn.offsetPx=="number"?Sn.offsetPx:10;Sn.isAbove!==!1?Wo-=Yo:Wo+=Yo;const Is=Oe[Sn.paneId]||Oe.candle_pane,An=typeof Sn.size=="number"&&Sn.size>0?Sn.size/2:6;if(Is){const fo=Is.top+An+2,Bn=Is.top+Is.height-An-2;Wo=Math.max(fo,Math.min(Bn,Wo))}const Ro=Ue-ms.x,vn=mt-Wo,on=Math.hypot(Ro,vn),rn=Math.max(14,An+10);on<=rn&&(!Rn||on<Rn.dist)&&(Rn={text:Sn.tooltip,x:ms.x,y:Wo,dist:on})}Rn&&mi(J,Rn.text,Rn.x,Rn.y,de.width,de.height)}function le(B,de){let Oe=B.replace(/\s+/g,"_").toLowerCase().replace(/[^a-z0-9_]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||"plot",Ue=1;for(;de.has(Oe);)Oe=`${Oe}_${Ue}`,Ue+=1;return de.add(Oe),Oe}function we(B){if(B){try{un.forEach(de=>{kK(de),b2(de)})}catch{}zn.forEach(de=>{try{B.removeIndicator({id:de})}catch{}}),zn=[],un.forEach(de=>{try{B.removeIndicator({paneId:"candle_pane",name:de})}catch{}try{B.removeIndicator({paneId:"pane_script",name:de})}catch{}try{B.removeIndicator({paneId:"script_pane",name:de})}catch{}}),un=[],se=[],Gs.forEach((de,Oe)=>{var mt,_n,en;const Ue=$i(Oe);(mt=Ue==null?void 0:Ue.axis)!=null&&mt.setAutoCalcTickFlag&&(Ue.axis.setAutoCalcTickFlag(!0),(en=(_n=Ue.axis).buildTicks)==null||en.call(_n,!0))}),Gs.clear(),jo.clear(),x(On,null)}}const H={limits:{line:240,linefill:120,label:300,box:180,table:20,polyline:180,polygon:160,path:160},pruningPolicy:"fifo",futureBars:200,time:{mode:"nearest",toleranceBars:2,toleranceMs:6e4},decimationPx:2},ne={maxPx:0,offsetPx:0,lastAppliedTs:0},_e=new Map,q=new Map;async function De(B,de="auto"){var Pc,Xi,aa,Fp,ov,U,te,$e,ut,Kt,$t,wn,Zn,yo,es,$s,oi,Ts,hr,Vr;const Oe=i();if(!Oe)throw new Error("Chart not ready yet. Please try again in a moment.");const Ue=de==="json",mt=Array.isArray(B.calc)?B.calc:[],_n=Array.isArray(B.series)?B.series:[],en=Array.isArray(B.stateSeries)?B.stateSeries:[],Vn=Nt=>{const Wn=[],Co=[];return Nt.forEach(mo=>{const Bo=String((mo==null?void 0:mo.expr)??"");/\b__arr_/i.test(Bo)?Co.push(mo):Wn.push(mo)}),{primary:Wn,arrayDependent:Co}},{primary:Rn,arrayDependent:xo}=Vn(_n),Dn=[],ys=Array.isArray(B.signals)?B.signals:[];if(Array.isArray(B.panes))for(const Nt of B.panes){const Wn=Nt.pane==="sub"?"sub":"main";Dn.push({pane:Wn,plots:Array.isArray(Nt.plots)?Nt.plots:[],levels:Array.isArray(Nt.levels)?Nt.levels:[],labels:Array.isArray(Nt.labels)?Nt.labels:[],lines:Array.isArray(Nt.lines)?Nt.lines:[],runtimeDrawOps:Array.isArray(Nt.runtimeDrawOps)?Nt.runtimeDrawOps:[],runtimeLabels:Array.isArray(Nt.runtimeLabels)?Nt.runtimeLabels:[],runtimeLines:Array.isArray(Nt.runtimeLines)?Nt.runtimeLines:[],runtimeBoxes:Array.isArray(Nt.runtimeBoxes)?Nt.runtimeBoxes:[],runtimeTables:Array.isArray(Nt.runtimeTables)?Nt.runtimeTables:[],overlays:Array.isArray(Nt.overlays)?Nt.overlays:[],fills:Array.isArray(Nt.fills)?Nt.fills:[],backgroundZones:Array.isArray(Nt.backgroundZones)?Nt.backgroundZones:[],min:Nt.min,max:Nt.max,shortName:Nt.shortName||B.shortName,height:Nt.height})}else if(B.main||B.sub)B.main&&Dn.push({pane:"main",plots:Array.isArray(B.main.plots)?B.main.plots:[],levels:Array.isArray(B.main.levels)?B.main.levels:[],labels:Array.isArray(B.main.labels)?B.main.labels:[],lines:Array.isArray(B.main.lines)?B.main.lines:[],runtimeDrawOps:Array.isArray(B.main.runtimeDrawOps)?B.main.runtimeDrawOps:[],runtimeLabels:Array.isArray(B.main.runtimeLabels)?B.main.runtimeLabels:[],runtimeLines:Array.isArray(B.main.runtimeLines)?B.main.runtimeLines:[],runtimeBoxes:Array.isArray(B.main.runtimeBoxes)?B.main.runtimeBoxes:[],runtimeTables:Array.isArray(B.main.runtimeTables)?B.main.runtimeTables:[],overlays:Array.isArray(B.main.overlays)?B.main.overlays:Array.isArray(B.overlays)?B.overlays:[],fills:Array.isArray(B.main.fills)?B.main.fills:[],backgroundZones:Array.isArray(B.main.backgroundZones)?B.main.backgroundZones:[],min:B.main.min,max:B.main.max,shortName:B.main.shortName||B.shortName,height:B.main.height}),B.sub&&Dn.push({pane:"sub",plots:Array.isArray(B.sub.plots)?B.sub.plots:[],levels:Array.isArray(B.sub.levels)?B.sub.levels:[],labels:Array.isArray(B.sub.labels)?B.sub.labels:[],lines:Array.isArray(B.sub.lines)?B.sub.lines:[],runtimeDrawOps:Array.isArray(B.sub.runtimeDrawOps)?B.sub.runtimeDrawOps:[],runtimeLabels:Array.isArray(B.sub.runtimeLabels)?B.sub.runtimeLabels:[],runtimeLines:Array.isArray(B.sub.runtimeLines)?B.sub.runtimeLines:[],runtimeBoxes:Array.isArray(B.sub.runtimeBoxes)?B.sub.runtimeBoxes:[],runtimeTables:Array.isArray(B.sub.runtimeTables)?B.sub.runtimeTables:[],overlays:Array.isArray(B.sub.overlays)?B.sub.overlays:[],fills:Array.isArray(B.sub.fills)?B.sub.fills:[],backgroundZones:Array.isArray(B.sub.backgroundZones)?B.sub.backgroundZones:[],min:B.sub.min,max:B.sub.max,shortName:B.sub.shortName||B.shortName,height:B.sub.height});else{const Wn=B.pane==="sub"?"sub":B.pane==="main"?"main":s(no);Dn.push({pane:Wn,plots:Array.isArray(B.plots)?B.plots:[],levels:Array.isArray(B.levels)?B.levels:[],labels:Array.isArray(B.labels)?B.labels:[],lines:Array.isArray(B.lines)?B.lines:[],runtimeDrawOps:Array.isArray(B.runtimeDrawOps)?B.runtimeDrawOps:[],runtimeLabels:Array.isArray(B.runtimeLabels)?B.runtimeLabels:[],runtimeLines:Array.isArray(B.runtimeLines)?B.runtimeLines:[],runtimeBoxes:Array.isArray(B.runtimeBoxes)?B.runtimeBoxes:[],runtimeTables:Array.isArray(B.runtimeTables)?B.runtimeTables:[],overlays:Array.isArray(B.overlays)?B.overlays:[],fills:Array.isArray(B.fills)?B.fills:[],backgroundZones:Array.isArray(B.backgroundZones)?B.backgroundZones:[],min:B.min,max:B.max,shortName:B.shortName,height:B.height}),x(no,N(Wn))}if(!Dn.length)throw new Error("No panes defined in script.");const jn=(()=>{const Nt=Dn.findIndex(Wn=>Wn.pane==="main");return Nt>=0?Nt:0})(),Sn=Dn.some(Nt=>Nt.plots&&Nt.plots.length||Nt.labels&&Nt.labels.length||Nt.levels&&Nt.levels.length||Nt.lines&&Nt.lines.length||Nt.runtimeDrawOps&&Nt.runtimeDrawOps.length||Nt.runtimeLabels&&Nt.runtimeLabels.length||Nt.runtimeLines&&Nt.runtimeLines.length||Nt.runtimeBoxes&&Nt.runtimeBoxes.length||Nt.runtimeTables&&Nt.runtimeTables.length),Un=!!(B!=null&&B.strategy)||ys.length>0;if(!Sn&&!Un)throw new Error("No plots or labels defined in script.");!Sn&&Un&&(Dn[0]||Dn.push({pane:"main",plots:[],levels:[],labels:[],lines:[],overlays:[]}),Dn[0].plots=Array.isArray(Dn[0].plots)?Dn[0].plots:[],Dn[0].plots.push({name:"__hidden__",source:"close",type:"line",color:"rgba(0,0,0,0)",width:1e-4,style:"solid",layer:"background"})),we(Oe);try{Oe.removeOverlay({groupId:"runtime"})}catch{}const $n=`${dn}_${Date.now()}`;let ms=0,Wo=!1;const Yo=new Map,Po=Nt=>{const Wn=String(Nt||"").trim(),Co=Wn.lastIndexOf("@");if(Co>0&&Co<Wn.length-1){const mo=Wn.slice(0,Co).trim(),Bo=Wn.slice(Co+1).trim();if(mo&&Bo)return{ticker:mo,country:Bo}}return{ticker:Wn}},Is=Nt=>String(Nt||"").trim().toLowerCase().replace(/\s+/g,""),An=Array.isArray((Pc=o())==null?void 0:Pc.allSymbols)?o().allSymbols:[],Ro=new Map,vn=new Map,on=new Map;for(const Nt of An){const Wn=Is(String((Nt==null?void 0:Nt.ticker)||""));Wn&&Ro.set(Wn,Nt);const Co=Is(String((Nt==null?void 0:Nt.shortName)||""));Co&&!vn.has(Co)&&vn.set(Co,Nt);const mo=Is(String((Nt==null?void 0:Nt.name)||""));mo&&!on.has(mo)&&on.set(mo,Nt)}const rn=(Nt,Wn)=>{let Co=String(Nt??"").trim();if(!Co)return"__CURRENT__";try{Co=Co.replace(/\$\{([^}]+)\}/g,($o,_i)=>{var Da;const Ar=(Wn==null?void 0:Wn[_i])??(Wn==null?void 0:Wn[(Da=_i==null?void 0:_i.toLowerCase)==null?void 0:Da.call(_i)]);return Ar==null?$o:String(Ar)})}catch{}const mo=Co.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(mo)){const $o=(Wn==null?void 0:Wn[mo])??(Wn==null?void 0:Wn[mo.toLowerCase()]);typeof $o=="string"&&$o.trim()&&(Co=$o.trim())}const Bo=String(Co).trim(),ws=Bo.toLowerCase();return ws==="syminfo.tickerid"||ws==="syminfo.ticker"||ws==="syminfo.root"||ws==="__current__"||ws==="__current_symbol__"?"__CURRENT__":Bo},fo=(Nt,Wn,Co)=>{const mo=rn(Nt,Co);if(mo==="__CURRENT__")return Io;const Bo=Po(mo),ws=String(Bo.ticker||"").trim(),$o=Is(ws),_i=$o&&Ro.get($o)||$o&&vn.get($o)||$o&&on.get($o)||null,Ar=String(Wn||Bo.country||(_i==null?void 0:_i.country)||Io.country||"BD").trim()||"BD";return _i&&String(_i.ticker||"").trim()?{..._i,country:Ar}:{...Io,ticker:ws,country:Ar}},Bn=B!=null&&B.params&&typeof B.params=="object"?B.params:{},Io=((Xi=o())==null?void 0:Xi.symbol)||{ticker:"UNKNOWN"},Gn=((aa=Oe.getDataList)==null?void 0:aa.call(Oe))||[],ti=typeof((Fp=Gn==null?void 0:Gn[0])==null?void 0:Fp.timestamp)=="number"?Gn[0].timestamp:typeof((ov=Gn==null?void 0:Gn[0])==null?void 0:ov.time)=="number"?Gn[0].time:0,Ds=typeof((U=Gn==null?void 0:Gn[Gn.length-1])==null?void 0:U.timestamp)=="number"?Gn[Gn.length-1].timestamp:typeof((te=Gn==null?void 0:Gn[Gn.length-1])==null?void 0:te.time)=="number"?Gn[Gn.length-1].time:0,bi=Nt=>{const Wn=typeof Nt=="number"?Nt:Number(Nt);return!Number.isFinite(Wn)||Wn<=0?0:Wn<1e12?Wn*1e3:Wn},yl=bi(ti),uc=bi(Ds),kr=Nt=>{const Wn=String(Nt??"").trim();if(!Wn)return"__CURRENT__";const Co=Wn.toUpperCase();if(Co==="CURRENT"||Co==="__CURRENT__"||Co==="TIMEFRAME.PERIOD")return"__CURRENT__";if(Co==="D"||Co==="1D")return"1d";if(Co==="W"||Co==="1W")return"1w";if(Co==="M"||Co==="1M")return"1M";if(/^\d+$/.test(Wn))return`${Wn}m`;const mo=Co.match(/^(\d+)\s*H$/);return mo?`${mo[1]}h`:Wn},Ka=Nt=>{const Wn=String(Nt||"").trim();if(!Wn)return 0;if(/^\d+$/.test(Wn))return Pv(`${Wn}m`);if(Wn==="M"||Wn==="1M")return Pv("1M");const Co=Wn.toUpperCase();if(Co==="D"||Co==="1D")return Pv("1d");if(Co==="W"||Co==="1W")return Pv("1w");const mo=Wn.match(/^(\d+)\s*([A-Za-z]+)$/);if(mo){const Bo=mo[1]||"1",ws=mo[2]||"";if(ws==="M")return Pv(`${Bo}M`);const $o=ws.toLowerCase();return $o.startsWith("min")?Pv(`${Bo}m`):$o==="h"||$o.startsWith("hr")||$o.startsWith("hour")?Pv(`${Bo}h`):$o==="d"||$o.startsWith("day")?Pv(`${Bo}d`):$o==="w"||$o.startsWith("wk")||$o.startsWith("week")?Pv(`${Bo}w`):Pv(`${Bo}${$o}`)}try{return Pv(Wn)}catch{return 0}},ni=Ka(((ut=($e=o())==null?void 0:$e.period)==null?void 0:ut.timeframe)||""),Ca=ni>0?ni*1e3:0,wa=uc>0&&Ca>0?uc+Ca-1:uc,Pa=Nt=>{const Wn=String(Nt||"").trim();if(!Wn)return"__CURRENT__";const Co=Wn.toLowerCase();if(Co.endsWith("m")){const mo=Number(Co.slice(0,-1));if(Number.isFinite(mo)&&mo>0)return String(Math.floor(mo))}if(Co.endsWith("h")){const mo=Number(Co.slice(0,-1));if(Number.isFinite(mo)&&mo>0)return String(Math.floor(mo*60))}return Co.endsWith("d")?"D":Co.endsWith("w")?"W":Wn==="1M"||Wn==="M"?"M":(/^\d+$/.test(Wn),Wn)},Jl=Nt=>{let Wn=String(Nt??"__CURRENT__");try{Wn=Wn.replace(/\$\{([^}]+)\}/g,(mo,Bo)=>{var $o;const ws=(Bn==null?void 0:Bn[Bo])??(Bn==null?void 0:Bn[($o=Bo==null?void 0:Bo.toLowerCase)==null?void 0:$o.call(Bo)]);return ws==null?mo:String(ws)});const Co=Wn.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Co)){const mo=(Bn==null?void 0:Bn[Co])??(Bn==null?void 0:Bn[Co.toLowerCase()]);mo!=null&&(Wn=String(mo))}}catch{}return Wn},bd=new Map;let Fo=[];try{const Nt=(mt||[]).filter(Wn=>String((Wn==null?void 0:Wn.type)||"").toLowerCase()==="security");if(Nt.length&&(Io!=null&&Io.ticker)){if(fs.size)for(const mo of fs){const[Bo]=String(mo).split("@");if(Bo&&Bo!==Io.ticker)try{w.stopSymbolPipelines(Bo)}catch{}}const Wn=new Set,Co=new Map;for(const mo of Nt){const Bo=String((mo==null?void 0:mo.name)||"security").replace(/\s+/g,"_").toLowerCase();if(!Bo)continue;const ws=!!(mo!=null&&mo.lower),$o=fo(mo==null?void 0:mo.symbol,mo==null?void 0:mo.country,Bn),_i=String(($o==null?void 0:$o.ticker)||"").trim(),Ar=String(($o==null?void 0:$o.country)||"BD");if(!_i)continue;Wn.add(`${_i}@${Ar}`);const Da=Jl((mo==null?void 0:mo.timeframe)||(mo==null?void 0:mo.tf)||"__CURRENT__"),Oo=Da==="__CURRENT__"?(($t=(Kt=o())==null?void 0:Kt.period)==null?void 0:$t.timeframe)||"1m":kr(Da),ss=Da==="__CURRENT__"?Pa(((Zn=(wn=o())==null?void 0:wn.period)==null?void 0:Zn.timeframe)||"1m"):String(Da||"__CURRENT__");bd.set(Bo,{ticker:_i,country:Ar,pipelineTf:Oo,computeTf:ss,lower:ws});const ds=`${_i}@${Ar}|${Oo}`;Oo&&Oo!=="__CURRENT__"&&Co.set(ds,{sym:$o,tf:Oo})}if(Fo=Array.from(Co.values()),fs=Wn,Co.size&&yl>0&&wa>0)await Promise.all(Array.from(Co.values()).map(({sym:mo,tf:Bo})=>w.ensureHistoryCovers(mo,Bo,yl,wa,3e3).catch(()=>null)));else if(Co.size)for(const{sym:mo,tf:Bo}of Co.values())try{w.startBackgroundPrefetch(mo,{timeframe:Bo})}catch{}}}catch(Nt){console.warn("[ScriptStudio] request.security prefetch skipped",Nt)}try{oe&&(clearInterval(oe),oe=null)}catch{}if(Fo.length){const Nt=Date.now(),Wn=25e3;oe=setInterval(()=>{var Bo;const Co=i();if(!Co)return;if(Date.now()-Nt>Wn){try{clearInterval(oe)}catch{}oe=null;return}let mo=0;for(const{sym:ws,tf:$o}of Fo){const _i=w.getHistorySnapshot(ws,$o);if(_i!=null&&_i.error)continue;const Ar=(((Bo=_i==null?void 0:_i.candles)==null?void 0:Bo.length)||0)>=2,Da=yl>0&&wa>0&&((_i==null?void 0:_i.oldestTimestampLoaded)??1/0)<=yl&&((_i==null?void 0:_i.newestTimestampLoaded)??0)>=wa;!(_i!=null&&_i.isComplete)&&(!Ar||!Da)&&(mo+=1)}if(mo<=0){try{clearInterval(oe)}catch{}oe=null;return}tn.request(()=>{try{Co.resize()}catch{}try{ks()}catch{}})},350)}const Ql=(Nt,Wn)=>{var Hp,Ou,_p,du;const Co=new Set,mo=[],Bo={min:"__rt_autoscale_min",max:"__rt_autoscale_max"},ws=Nt.plots||[],$o=B!=null&&B.params&&typeof B.params=="object"?B.params:{},_i=ve=>{if(ve!=null){if(typeof ve!="string")return String(ve);try{const Bt=ve.replace(/\$\{([^}]+)\}/g,(js,er)=>{var cl;const na=($o==null?void 0:$o[er])??($o==null?void 0:$o[(cl=er==null?void 0:er.toLowerCase)==null?void 0:cl.call(er)]);return na==null?js:String(na)});if(Bt!==ve)return Bt;const Wi=ve.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Wi)){const js=($o==null?void 0:$o[Wi])??($o==null?void 0:$o[Wi.toLowerCase()]);if(js!=null)return String(js)}return Bt}catch{return ve}}},Ar=ve=>{if(ve==null)return;if(typeof ve=="number"&&Number.isFinite(ve))return ve;const Bt=_i(ve);if(!Bt)return;const Wi=Number(Bt);return Number.isFinite(Wi)?Wi:void 0},Da=ws.filter(ve=>{const Bt=String((ve==null?void 0:ve.display)||"").toLowerCase();return Bt?!Bt.includes("none")&&Bt!=="display.none":!0}).map(ve=>{const Bt=_i(ve==null?void 0:ve.color),Wi=Ar(ve==null?void 0:ve.offset),js=Ar((ve==null?void 0:ve.showLast)??(ve==null?void 0:ve.show_last)),er=Ar(ve==null?void 0:ve.precision);return{...ve,color:Bt??(ve==null?void 0:ve.color),offset:Wi,showLast:js,precision:er}}),Oo=Nt.runtimeDrawOps||[],ss=Nt.runtimeLabels||[],ds=Nt.runtimeLines||[],yn=Nt.runtimeBoxes||[],wo=Nt.runtimeTables||[],si=Da.some(ve=>String((ve==null?void 0:ve.type)||"").toLowerCase()==="histogram"),ir=si,Ji=typeof Nt.min=="number"||typeof Nt.max=="number",el=Nt.pane==="sub"&&!ir&&!Ji;Nt.pane==="sub"&&si&&Da.push({name:"__zero__",source:"__zero__",type:"line",color:"rgba(0,0,0,0)",width:0});const Dd=[...Nt.levels||[],...Nt._trackLevels||[]],Ma=Nt.labels||[],jl=Nt.lines||[],gc={},Qi=Da.map(ve=>{const Bt=le(ve.name||ve.source||"plot",Co);mo.push(Bt);const Wi=(ve.source||ve.name||"").replace(/\s+/g,"_").toLowerCase();Wi&&(gc[Wi]=Bt);const js=(ve.type||ve.style||"").toLowerCase();return js==="histogram"?{key:Bt,title:ve.name||Bt,type:"bar",baseValue:0}:js==="bar"?{key:Bt,title:ve.name||Bt,type:"bar",baseValue:0}:{key:Bt,title:ve.name||Bt,type:"line"}});Qi.push({key:Bo.min,type:"line"},{key:Bo.max,type:"line"});const Kd=Da.map((ve,Bt)=>{var er;const Wi=String((ve==null?void 0:ve.type)||"").toLowerCase();return Wi!=="candles"&&Wi!=="ohlc"?null:{key:mo[Bt]||((er=Qi[Bt])==null?void 0:er.key)||`plot_${Bt}`,openKey:String((ve==null?void 0:ve.open)||"open").replace(/\s+/g,"_").toLowerCase(),highKey:String((ve==null?void 0:ve.high)||"high").replace(/\s+/g,"_").toLowerCase(),lowKey:String((ve==null?void 0:ve.low)||"low").replace(/\s+/g,"_").toLowerCase(),closeKey:String((ve==null?void 0:ve.close)||"close").replace(/\s+/g,"_").toLowerCase(),offset:Number.isFinite(ve==null?void 0:ve.offset)?Math.trunc(ve.offset):0,showLast:Number.isFinite(ve==null?void 0:ve.showLast)?Math.max(0,Math.floor(ve.showLast)):0}}).filter(Boolean),Gc=`${$n}_${Nt.pane}_${Wn}`,Wl=`${$n}__strategy`,Fc=(B==null?void 0:B.drawConfig)||{},zc={limits:{...H.limits,...Fc.limits||{}},pruningPolicy:Fc.pruningPolicy==="lru"||Fc.pruningPolicy==="byGroup"?Fc.pruningPolicy:H.pruningPolicy,futureBars:Number.isFinite(Fc.futureBars)?Math.max(0,Math.floor(Fc.futureBars)):H.futureBars,time:{mode:((Hp=Fc==null?void 0:Fc.time)==null?void 0:Hp.mode)==="prev"||((Ou=Fc==null?void 0:Fc.time)==null?void 0:Ou.mode)==="next"?Fc.time.mode:H.time.mode,toleranceBars:Number.isFinite((_p=Fc==null?void 0:Fc.time)==null?void 0:_p.toleranceBars)?Math.max(0,Math.floor(Fc.time.toleranceBars)):H.time.toleranceBars,toleranceMs:Number.isFinite((du=Fc==null?void 0:Fc.time)==null?void 0:du.toleranceMs)?Math.max(0,Math.floor(Fc.time.toleranceMs)):H.time.toleranceMs},decimationPx:Number.isFinite(Fc.decimationPx)?Math.max(1,Math.floor(Fc.decimationPx)):H.decimationPx},gu={};let ku="",Md=!1,gp=-1;const $p=Wn===jn;let hp=!1,hv="",tu=null;const _v=2e4,yv=ve=>new Promise((Bt,Wi)=>{const js=new Worker(new URL(""+new URL("../workers/runtime.worker-DgCbSfBO.js",import.meta.url).href,import.meta.url),{type:"module"}),er=setTimeout(()=>{try{js.terminate()}catch{}Wi(new Error("Runtime worker timed out"))},_v);js.onerror=()=>{try{clearTimeout(er)}catch{}try{js.terminate()}catch{}Wi(new Error("Runtime worker error"))},js.onmessage=na=>{const cl=na.data;if(!(!cl||cl.id!==ve.id)){try{clearTimeout(er)}catch{}try{js.terminate()}catch{}if(cl.error){Wi(new Error(String(cl.error)));return}Bt({seriesMap:cl.seriesMap||{},lastPrevSource:cl.lastPrevSource||void 0})}},js.postMessage(ve)}),Bu=Da.map((ve,Bt)=>{var na;const Wi=(ve.source||ve.name||"").replace(/\s+/g,"_").toLowerCase();let js="#22d3ee";/ema\d+/i.test(Wi)?js=(na=/ema(\d+)/i.exec(Wi))!=null&&na[1]&&Number(RegExp.$1)<=20?"#22c55e":"#ef4444":/signal|sig/i.test(Wi)?js="#f59e0b":/hist|bar/i.test(ve.type||ve.style||"")&&(js="#64748b");const er=(ve.type||ve.style||"").toLowerCase();return er==="histogram"?{color:"rgba(0,0,0,0)",size:1e-4,style:Ke.Solid}:er==="candles"||er==="ohlc"?{color:"rgba(0,0,0,0)",size:1e-4,style:Ke.Solid}:{color:ve.color||js,size:ve.width??2,style:xa[(ve.style||"solid").toLowerCase()]??Ke.Solid}});Bu.push({color:"rgba(0,0,0,0)",size:0,style:Ke.Solid},{color:"rgba(0,0,0,0)",size:0,style:Ke.Solid});const bv={name:Gc,shortName:Nt.shortName||"Script",precision:4,calcParams:[],figures:Qi,shouldOhlc:!1,minValue:(()=>{const ve=Nt.pane==="sub",Bt=Da.some(Wi=>String((Wi==null?void 0:Wi.type)||"").toLowerCase()==="histogram");if(typeof Nt.min=="number")return Nt.min;if(ve&&Bt)return-5})(),maxValue:(()=>{const ve=Nt.pane==="sub",Bt=Da.some(Wi=>String((Wi==null?void 0:Wi.type)||"").toLowerCase()==="histogram");if(typeof Nt.max=="number")return Nt.max;if(ve&&Bt)return 5})(),styles:{lines:Bu},calc:async ve=>{var Dm,jm,gf,fm,$f,Rm,mm,dg,Gf,gm,Yf,Bm,Ef,hm,hf,Nf,Df,Om,rf,zm,Dp,af,_m,Kf,Vm,ym,Wm,qm,Hm,Ti,zo,ca,oa,_s,Gi,Fl,Ta,sa,ec,Dr,Ul,Wc,uu,Yu,pu,Yv,Ip,lf;const Bt=ve.length,Wi=Bt?ve[Bt-1]:null,js=(Wi==null?void 0:Wi.timestamp)??(Wi==null?void 0:Wi.time)??(Wi==null?void 0:Wi.t)??0,er=typeof js=="number"?js:Number(js),na=Bt?ve[0]:null,cl=(na==null?void 0:na.timestamp)??(na==null?void 0:na.time)??(na==null?void 0:na.t)??0,zu=typeof cl=="number"?cl:Number(cl);let sp=0,Hu=0,hu=0,Sp=0;if(Fo.length)for(const{sym:et,tf:Ae}of Fo){const gt=w.getHistorySnapshot(et,Ae),He=Number((gt==null?void 0:gt.lastUpdatedAt)??0);Number.isFinite(He)&&(sp=Math.max(sp,He));const ht=((Dm=gt==null?void 0:gt.candles)==null?void 0:Dm.length)??0;Hu+=Number.isFinite(ht)?ht:0,gt!=null&&gt.error&&(hu+=1),!(gt!=null&&gt.error)&&!(gt!=null&&gt.isComplete)&&(((jm=gt==null?void 0:gt.candles)==null?void 0:jm.length)??0)<2&&(Sp+=1)}const dp=`${Bt}:${Number.isFinite(zu)?zu:0}:${Number.isFinite(er)?er:0}:${s(Zt)?1:0}:${sp}:${Hu}:${hu}:${Sp}:${_t}:${Wt}:${ms}`;if(dp===hv&&tu)return tu;const Pl={},pd={},pr={};let Wa=!1;const rr=(B==null?void 0:B.params)||{};Al=rr;const Up=(et,Ae,gt)=>{if(typeof et=="number"&&Number.isFinite(et))return et;if(typeof et=="string"){const He=Number(et);if(Number.isFinite(He))return He;const ht=et.match(/^\$\{([^}]+)\}$/),It=ht?ht[1]:et,Ot=rr[It],lo=typeof Ot=="number"?Ot:Number(Ot);if(Number.isFinite(lo))return lo}if(Ae&&rr[Ae]!=null){const He=rr[Ae],ht=typeof He=="number"?He:Number(He);if(Number.isFinite(ht))return ht}return gt??0},Qu=et=>{const Ae=typeof et=="number"?et:Number(et);return Number.isFinite(Ae)?Ae:void 0},nu=new Array(Bt),hc=new Array(Bt),Uu=new Array(Bt),up=new Array(Bt),Gu=new Array(Bt),Vu=new Array(Bt),Ep=new Array(Bt);for(let et=0;et<Bt;(et+=1)-1){const Ae=ve[et],gt=Qu((Ae==null?void 0:Ae.close)??(Ae==null?void 0:Ae.c)??(Ae==null?void 0:Ae.price)??(Ae==null?void 0:Ae.value)),He=Qu((Ae==null?void 0:Ae.open)??(Ae==null?void 0:Ae.o))??gt,ht=Qu((Ae==null?void 0:Ae.high)??(Ae==null?void 0:Ae.h))??gt??He,It=Qu((Ae==null?void 0:Ae.low)??(Ae==null?void 0:Ae.l))??gt??He,Ot=Qu((Ae==null?void 0:Ae.volume)??(Ae==null?void 0:Ae.vol))??0,lo=Qu((Ae==null?void 0:Ae.timestamp)??(Ae==null?void 0:Ae.time)??(Ae==null?void 0:Ae.t))??0;up[et]=gt,nu[et]=He,hc[et]=ht,Uu[et]=It,Gu[et]=Ot,Vu[et]=lo,Ep[et]=et}pr.open=nu,pr.close=up,pr.high=hc,pr.low=Uu,pr.volume=Gu,pr.time=Vu,pr.bar_index=Ep;const vr=et=>{const Ae=new Array(Bt);for(let gt=0;gt<Bt;(gt+=1)-1)Ae[gt]=et;return Ae},Sr={},ji=Qs.get(Wl),Jc=et=>Array.isArray(et)&&et.length===Bt?et:null;Sr.strategy_position_size=Jc(ji==null?void 0:ji.positionSize)??vr(0),Sr.strategy_position_avg_price=Jc(ji==null?void 0:ji.positionAvgPrice)??vr(0),Sr.strategy_opentrades=Jc(ji==null?void 0:ji.openTrades)??vr(0),Sr.strategy_closedtrades=Jc(ji==null?void 0:ji.closedTrades)??vr(0),Sr.strategy_openprofit=Jc(ji==null?void 0:ji.openProfit)??vr(0),Sr.strategy_closedprofit=Jc(ji==null?void 0:ji.closedProfit)??vr(0),Sr.strategy_grossprofit=Jc(ji==null?void 0:ji.grossProfit)??vr(0),Sr.strategy_grossloss=Jc(ji==null?void 0:ji.grossLoss)??vr(0),Sr.strategy_wintrades=Jc(ji==null?void 0:ji.winTrades)??vr(0),Sr.strategy_losstrades=Jc(ji==null?void 0:ji.lossTrades)??vr(0),Sr.strategy_winrate=Jc(ji==null?void 0:ji.winRate)??vr(0),Sr.strategy_max_drawdown=Jc(ji==null?void 0:ji.maxDrawdownPct)??vr(0),Sr.strategy_max_drawdown_value=Jc(ji==null?void 0:ji.maxDrawdownValue)??vr(0),Sr.strategy_max_runup=Jc(ji==null?void 0:ji.maxRunupPct)??vr(0),Sr.strategy_max_runup_value=Jc(ji==null?void 0:ji.maxRunupValue)??vr(0),Sr.strategy_avg_trade=Jc(ji==null?void 0:ji.avgTrade)??vr(0),Sr.strategy_avg_win=Jc(ji==null?void 0:ji.avgWin)??vr(0),Sr.strategy_avg_loss=Jc(ji==null?void 0:ji.avgLoss)??vr(0),Sr.strategy_avg_bars_in_trade=Jc(ji==null?void 0:ji.avgBarsInTrade)??vr(0),Sr.strategy_equity=Jc(ji==null?void 0:ji.equity)??vr(0),Sr.strategy_netprofit=Jc(ji==null?void 0:ji.netProfit)??vr(0);const Wv=ji==null?void 0:ji.initialCapital;Sr.strategy_initial_capital=vr(typeof Wv=="number"&&Number.isFinite(Wv)?Wv:0);const su=String(((fm=(gf=o())==null?void 0:gf.period)==null?void 0:fm.timeframe)||"1m").trim(),Vc=su.match(/^(\d+)\s*([a-zA-Z])$/);let dl=0,Su="";Vc?(dl=Number(Vc[1]),Su=Vc[2]||""):/^\d+$/.test(su)&&(dl=Number(su),Su="m");const Zd=Su==="M"?"M":Su.toLowerCase();let qa=0;if(dl>0&&Zd)try{qa=Pv(`${dl}${Zd}`)}catch{}const Gp=Zd==="s",xv=Zd==="m",Wu=Zd==="h",tf=Zd==="d",sv=Zd==="w",Yp=Zd==="M",_u=Zd==="y",wv=Gp||xv||Wu;let ip="";dl>0&&Zd&&(Zd==="m"?ip=String(dl):Zd==="h"?ip=String(dl*60):Zd==="s"?ip=`${dl}S`:Zd==="d"?ip=dl===1?"D":`${dl}D`:Zd==="w"?ip=dl===1?"W":`${dl}W`:Zd==="M"?ip=dl===1?"M":`${dl}M`:Zd==="y"&&(ip=dl===1?"Y":`${dl}Y`)),Sr.timeframe_multiplier=vr(dl||0),Sr.timeframe_seconds=vr(qa||0),Sr.timeframe_isseconds=vr(Gp?1:0),Sr.timeframe_isminutes=vr(xv?1:0),Sr.timeframe_ishours=vr(Wu?1:0),Sr.timeframe_isdaily=vr(tf?1:0),Sr.timeframe_isweekly=vr(sv?1:0),Sr.timeframe_ismonthly=vr(Yp?1:0),Sr.timeframe_isyearly=vr(_u?1:0),Sr.timeframe_isintraday=vr(wv?1:0),Sr.timeframe_period=vr(Va(ip));const Np=Io==null?void 0:Io.pricePrecision,iv=typeof Np=="number"?Np:Number(Np),rv=Number.isFinite(iv)?Math.max(0,Math.floor(iv)):2,Cu=1/Math.pow(10,rv);Sr.syminfo_mintick=vr(Cu),Sr.syminfo_pointvalue=vr(1);const Pu=String((Io==null?void 0:Io.ticker)||""),av=String((Io==null?void 0:Io.country)||""),Fv=av?`${Pu}@${av}`:Pu,We=Pu.split(/[:.]/).pop()||Pu,Uo=String((Io==null?void 0:Io.exchange)||(Io==null?void 0:Io.market)||""),ls=String((Io==null?void 0:Io.name)||(Io==null?void 0:Io.shortName)||""),Si=String((Io==null?void 0:Io.type)||""),bs=String((Io==null?void 0:Io.priceCurrency)||""),Go=String((($f=o())==null?void 0:$f.timezone)||"UTC"),Nr=String((Io==null?void 0:Io.session)||"");Sr.syminfo_tickerid=vr(Va(Fv)),Sr.syminfo_ticker=vr(Va(Pu)),Sr.syminfo_root=vr(Va(We)),Sr.syminfo_prefix=vr(Va(Uo)),Sr.syminfo_exchange=vr(Va(Uo)),Sr.syminfo_description=vr(Va(ls)),Sr.syminfo_type=vr(Va(Si)),Sr.syminfo_currency=vr(Va(bs)),Sr.syminfo_timezone=vr(Va(Go)),Sr.syminfo_session=vr(Va(Nr)),Sr.syminfo_isdelayed=vr(0);const Xn=vr(0),tl=vr(0),_c=vr(0),Ai=vr(Bt>0?1:0),ql=vr(0),Hl=vr(Bt>0?1:0),ja=vr(Bt>0?1:0);if(Bt>0){Xn[0]=1,tl[Bt-1]=1;const et=sn=>{const Ao=typeof sn=="number"?sn:Number(sn);return!Number.isFinite(Ao)||Ao<=0?0:Ao<1e12?Ao*1e3:Ao},Ae=Date.now(),gt=et(Vu[Bt-1]??0),He=qa>0?qa*1e3:0,ht=((Rm=o().options)==null?void 0:Rm.enableRealtime)===!0||r().playing===!0,It=Math.max(6e4,He>0?He*2:6e4),Ot=ht&&S.active&&S.lastUpdateAt>0&&Ae-S.lastUpdateAt<=It,lo=He>0&&gt>0?Ae<gt+He:Ot;if(Ot){lo&&(ql[Bt-1]=1,Hl[Bt-1]=0),Ai[Bt-1]=lo?0:1,ja.fill(0);const sn=S.lastNewBarIndex>=0?S.lastNewBarIndex:Bt-1;sn>=0&&sn<Bt&&(ja[sn]=1);const Ao=lo?Bt-2:Bt-1;Ao>=0&&(_c[Ao]=1)}else _c[Bt-1]=1}Sr.barstate_isfirst=Xn,Sr.barstate_islast=tl,Sr.barstate_islastconfirmedhistory=_c,Sr.barstate_isconfirmed=Ai,Sr.barstate_isrealtime=ql,Sr.barstate_ishistory=Hl,Sr.barstate_isnew=ja,Object.entries(Sr).forEach(([et,Ae])=>{pr[et]=Ae});const Wr=Da.some(et=>String((et==null?void 0:et.source)||"").toLowerCase()==="__zero__");let ka=null;if(Wr){ka=new Array(Bt);for(let et=0;et<Bt;(et+=1)-1)ka[et]=0}const bl=[];try{const et=(mt||[]).filter(Ae=>String((Ae==null?void 0:Ae.type)||"").toLowerCase()==="security");if(et.length&&Bt>0)for(const Ae of et){const gt=String((Ae==null?void 0:Ae.name)||"security").replace(/\s+/g,"_").toLowerCase();if(!gt)continue;const He=fo(Ae==null?void 0:Ae.symbol,Ae==null?void 0:Ae.country,rr);let ht=String((Ae==null?void 0:Ae.timeframe)||(Ae==null?void 0:Ae.tf)||"__CURRENT__");try{ht=ht.replace(/\$\{([^}]+)\}/g,(Pe,rt)=>{var cn;const gn=(rr==null?void 0:rr[rt])??(rr==null?void 0:rr[(cn=rt==null?void 0:rt.toLowerCase)==null?void 0:cn.call(rt)]);return gn==null?Pe:String(gn)});const ie=ht.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(ie)){const Pe=(rr==null?void 0:rr[ie])??(rr==null?void 0:rr[ie.toLowerCase()]);Pe!=null&&(ht=String(Pe))}}catch{}const It=String(ht||"__CURRENT__"),Ot=It==="__CURRENT__"?((dg=(mm=o())==null?void 0:mm.period)==null?void 0:dg.timeframe)||"1m":kr(It),lo=bd.get(gt),sn=(lo==null?void 0:lo.pipelineTf)||Ot,Ao=(lo==null?void 0:lo.computeTf)||(It==="__CURRENT__"?Pa(((gm=(Gf=o())==null?void 0:Gf.period)==null?void 0:gm.timeframe)||"1m"):It),Cn=!!(lo!=null&&lo.lower||Ae!=null&&Ae.lower),Jn=Ka(Ao);if(Cn&&ni>0&&Jn>0&&Jn>=ni){if(!s(ue)){const ie=String(((Bm=(Yf=o())==null?void 0:Yf.period)==null?void 0:Bm.timeframe)||"");x(ue,`request.security_lower_tf: "${Ao}" must be lower than chart timeframe "${ie}"`)}pr[gt]=new Array(Bt),bl.push(gt);continue}const nn=sn&&sn!=="__CURRENT__"?w.getHistorySnapshot(He,sn):null,us=nn?nn.candles:null,Tn=Number(Vu[0]??0),ui=Number(Vu[Bt-1]??0);if(sn&&sn!=="__CURRENT__"){const ie=pc=>{const nl=typeof pc=="number"?pc:Number(pc);return!Number.isFinite(nl)||nl<=0?0:nl<1e12?nl*1e3:nl},Pe=ie(Tn),rt=ie(ui),gn=us&&us.length>=2,cn=us&&us.length?Number(((Ef=us[0])==null?void 0:Ef.timestamp)??((hm=us[0])==null?void 0:hm.time)??((hf=us[0])==null?void 0:hf.t)??0):0,Gt=us&&us.length?Number(((Nf=us[us.length-1])==null?void 0:Nf.timestamp)??((Df=us[us.length-1])==null?void 0:Df.time)??((Om=us[us.length-1])==null?void 0:Om.t)??0):0,eo=ie((nn==null?void 0:nn.oldestTimestampLoaded)??cn),Ss=ie((nn==null?void 0:nn.newestTimestampLoaded)??Gt),La=gn&&Pe>0&&rt>0&&eo>0&&Ss>0&&eo<=rt&&Ss>=Pe,Rl=La&&eo<=Pe&&Ss>=rt;if(!gn||!La){const pc=String((He==null?void 0:He.ticker)||""),nl=String((He==null?void 0:He.country)||"");if(nn!=null&&nn.error)s(ue)||x(ue,`request.security: ${pc}${nl?`@${nl}`:""} (${sn}) error: ${nn.error}`);else if(nn!=null&&nn.isComplete){if(!s(ue)){const vc=!gn||!(us&&us.length);x(ue,N(vc?`request.security: no data for ${pc}${nl?`@${nl}`:""} (${sn})`:`request.security: no overlap for ${pc}${nl?`@${nl}`:""} (${sn})`))}}else if(s(Ne)==="Running..."||s(Ne)==="Plotted from Pine"||s(Ne)==="Plotted from DSL"){const vc=nn!=null&&nn.oldestTimestampLoaded?new Date(nn.oldestTimestampLoaded).toISOString().slice(0,10):"?",qc=nn!=null&&nn.newestTimestampLoaded?new Date(nn.newestTimestampLoaded).toISOString().slice(0,10):"?";x(Ne,`Loading request.security: ${pc}${nl?`@${nl}`:""} (${sn})… loaded ${vc}→${qc}`)}pr[gt]=new Array(Bt),bl.push(gt);continue}if(!Rl&&!(nn!=null&&nn.error)&&!(nn!=null&&nn.isComplete)&&(s(Ne)==="Running..."||s(Ne)==="Plotted from Pine"||s(Ne)==="Plotted from DSL")){const pc=String((He==null?void 0:He.ticker)||""),nl=String((He==null?void 0:He.country)||""),vc=nn!=null&&nn.oldestTimestampLoaded?new Date(nn.oldestTimestampLoaded).toISOString().slice(0,10):"?",qc=nn!=null&&nn.newestTimestampLoaded?new Date(nn.newestTimestampLoaded).toISOString().slice(0,10):"?";x(Ne,`Loading request.security (partial): ${pc}${nl?`@${nl}`:""} (${sn})… loaded ${vc}→${qc}`)}}const Hs=String((Ae==null?void 0:Ae.expr)||"close"),da=String((Ae==null?void 0:Ae.lookahead)||"off").toLowerCase(),Yi=da==="on"||da.includes("on")&&!da.includes("off")?"on":"off",Bi=String((Ae==null?void 0:Ae.gaps)||"off").toLowerCase(),bo=Bi==="on"||Bi.includes("on")&&!Bi.includes("off")?"on":"off",cs=`${nu[Bt-1]??""}|${hc[Bt-1]??""}|${Uu[Bt-1]??""}|${up[Bt-1]??""}|${Gu[Bt-1]??""}`,b=us&&us.length?Number(((rf=us[0])==null?void 0:rf.timestamp)??((zm=us[0])==null?void 0:zm.time)??0):0,k=us&&us.length?Number(((Dp=us[us.length-1])==null?void 0:Dp.timestamp)??((af=us[us.length-1])==null?void 0:af.time)??0):0,T=String((He==null?void 0:He.ticker)||"").trim(),A=String((He==null?void 0:He.country)||"").trim(),$=`sym=${T}${A?`@${A}`:""}|tf=${Ao}|srcTf=${sn}|srcLen=${us?us.length:0}|src0=${b}|srcN=${k}|la=${Yi}|gaps=${bo}|lower=${Cn?1:0}|expr=${Hs}|len=${Bt}|t0=${Tn}|tN=${ui}|tail=${cs}`,E=Yo.get($),Q=E&&E.len===Bt&&E.firstTime===Tn&&E.lastTime===ui&&E.tailSig===cs?E.out:(()=>{var Pe;const ie=WK({timestamps:Vu,open:nu,high:hc,low:Uu,close:up,volume:Gu,sourceCandles:us||void 0,timeframe:Ao,expr:Hs,lookahead:Yi,gaps:bo,scalars:rr,timezone:String((He==null?void 0:He.timezone)||((Pe=o())==null?void 0:Pe.timezone)||"UTC"),session:String((He==null?void 0:He.session)||(Io==null?void 0:Io.session)||""),allowLowerTfFallback:!Cn});return Yo.set($,{out:ie,len:Bt,firstTime:Tn,lastTime:ui,tailSig:cs}),ie})();try{let ie=!1;const Pe=Math.max(0,Bt-250);for(let rt=Bt-1;rt>=Pe;(rt-=1)+1){const gn=Q[rt];if(gn!=null&&Number.isFinite(gn)){ie=!0;break}}if(!ie&&!s(ue)){const rt=String((He==null?void 0:He.ticker)||""),gn=String((He==null?void 0:He.country)||"");x(Ne,`request.security: no overlap for ${rt}${gn?`@${gn}`:""} (${sn}) — try a more recent chart range or switch chart timeframe`)}}catch{}pr[gt]=Q,bl.push(gt)}}catch(et){const Ae=(et==null?void 0:et.message)!=null?String(et.message):String(et);console.error("[ScriptStudio] request.security error",et),s(ue)||x(ue,`request.security error: ${Ae}`)}const yc=()=>{if(Rn.length&&Bt>0)try{const et={open:new Float32Array(Bt),high:new Float32Array(Bt),low:new Float32Array(Bt),close:new Float32Array(Bt),volume:new Float32Array(Bt),time:new Float32Array(Bt),bar_index:new Float32Array(Bt)};for(let He=0;He<Bt;(He+=1)-1)et.open[He]=nu[He]??NaN,et.high[He]=hc[He]??NaN,et.low[He]=Uu[He]??NaN,et.close[He]=up[He]??NaN,et.volume[He]=Gu[He]??0,et.time[He]=Vu[He]??0,et.bar_index[He]=Ep[He]??He;const Ae=He=>{if(!et[He]){if(He==="hl2"){const ht=new Float32Array(Bt);for(let It=0;It<Bt;(It+=1)-1){const Ot=hc[It],lo=Uu[It];ht[It]=Ot==null||lo==null?NaN:(Ot+lo)/2}et[He]=ht}else if(He==="hlc3"){const ht=new Float32Array(Bt);for(let It=0;It<Bt;(It+=1)-1){const Ot=hc[It],lo=Uu[It],sn=up[It];ht[It]=Ot==null||lo==null||sn==null?NaN:(Ot+lo+sn)/3}et[He]=ht}else if(He==="ohlc4"){const ht=new Float32Array(Bt);for(let It=0;It<Bt;(It+=1)-1){const Ot=nu[It],lo=hc[It],sn=Uu[It],Ao=up[It];ht[It]=Ot==null||lo==null||sn==null||Ao==null?NaN:(Ot+lo+sn+Ao)/4}et[He]=ht}}};rr&&typeof rr=="object"&&Object.entries(rr).forEach(([He,ht])=>{if(typeof ht!="string")return;const It=String(He).replace(/\s+/g,"_").toLowerCase(),Ot=String(ht).replace(/\s+/g,"_").toLowerCase();Ae(Ot);const lo=et[Ot];if(lo){et[It]=lo;const sn=new Array(Bt);for(let Ao=0;Ao<Bt;(Ao+=1)-1){const Cn=lo[Ao];sn[Ao]=Number.isFinite(Cn)?Cn:void 0}pr[It]=sn}});for(const He of bl){const ht=pr[He];if(!ht)continue;const It=new Float32Array(Bt);for(let Ot=0;Ot<Bt;(Ot+=1)-1)It[Ot]=ht[Ot]??NaN;et[He]=It}Object.entries(Sr).forEach(([He,ht])=>{if(!ht)return;const It=new Float32Array(Bt);for(let Ot=0;Ot<Bt;(Ot+=1)-1)It[Ot]=ht[Ot]??NaN;et[He]=It});const gt=gg(Rn.map((He,ht)=>({name:String(He.name||`series_${ht}`),expr:Nl(String(He.expr||"").replace(/\$\{([^}]+)\}/g,(It,Ot)=>String(rr[Ot]??It)))})),et,rr,Fs.get(Wl));Object.entries(gt).forEach(([He,ht])=>{const It=He.replace(/\s+/g,"_").toLowerCase(),Ot=new Array(Bt);for(let lo=0;lo<Bt;(lo+=1)-1)Ot[lo]=ht[lo];pr[It]=Ot})}catch(et){const Ae=(et==null?void 0:et.message)!=null?String(et.message):String(et);console.error("[ScriptStudio] expression engine error",et),s(ue)||x(ue,`Expression error: ${Ae}`),s(Ne)||x(Ne,"Expression error")}xW({seriesMap:pr,calcDefs:mt,len:Bt,params:rr,lastPrevSource:gu,resolveNum:Up,onError:(et,Ae)=>{Ae&&console.error("[ScriptStudio] expr eval error",Ae),s(ue)||x(ue,N(et)),s(Ne)||x(Ne,"Expression error")}})};if(Bt>0&&(_n.length||mt.length||en.length)){const et={...Sr};if(bl.length&&bl.forEach(gt=>{const He=pr[gt];He&&(et[gt]=He)}),ka&&(et.__zero__=ka),(()=>{const gt=/\bstrategy[._](closedtrades|opentrades)[._]/i,He=ht=>gt.test(String(ht??""));return!!(_n.some(ht=>He(ht==null?void 0:ht.expr))||en.some(ht=>He(ht==null?void 0:ht.initExpr)||He(ht==null?void 0:ht.updateExpr)||He(ht==null?void 0:ht.expr))||mt.some(ht=>He(ht==null?void 0:ht.expr)||He(ht==null?void 0:ht.when)))})())yc();else try{const gt=`${Gc}_rt_${Bt}_${Number.isFinite(er)?er:0}`,He=el?"calc_only":"full",ht=await yv({id:gt,base:{open:nu,high:hc,low:Uu,close:up,volume:Gu,time:Vu},calc:mt,series:_n,stateSeries:en,params:rr,extraSeries:et,stage:He,autoSortStateSeries:Ue}),It=ht.seriesMap||{};Object.keys(pr).forEach(Ot=>delete pr[Ot]),Object.entries(It).forEach(([Ot,lo])=>{pr[Ot]=lo}),ht.lastPrevSource&&Object.assign(gu,ht.lastPrevSource),Wa=He==="full"}catch(gt){console.warn("[ScriptStudio] runtime worker fallback",gt),yc()}}else yc();if(Wr){if(!ka){ka=new Array(Bt);for(let et=0;et<Bt;(et+=1)-1)ka[et]=0}pr.__zero__=ka}if(Nt.pane==="sub"){const et=new Set,Ae=new Set;Da.forEach(He=>{const ht=(He.source||He.name||"").replace(/\s+/g,"_").toLowerCase();ht&&et.add(ht),String(He.type||"").toLowerCase()==="histogram"&&ht&&Ae.add(ht)}),(Nt.labels||[]).forEach(He=>{const ht=((He==null?void 0:He.source)||(He==null?void 0:He.name)||"").replace(/\s+/g,"_").toLowerCase();ht&&et.add(ht)}),(_m=Nt.fills)==null||_m.forEach(He=>{(Array.isArray(He==null?void 0:He.between)?He.between:[]).forEach(It=>{const Ot=String(It||"").replace(/\s+/g,"_").toLowerCase();Ot&&et.add(Ot)})});const gt=(He,ht)=>{let It=1/0,Ot=-1/0;for(let Cn=0;Cn<He.length;(Cn+=1)-1){const Jn=He[Cn];Jn==null||Number.isNaN(Jn)||(Jn<It&&(It=Jn),Jn>Ot&&(Ot=Jn))}const lo=Ot-It;if(!(Ot>200||It<-50||lo>200))return He;const Ao=new Array(He.length);if(lo>1e-8){for(let Cn=0;Cn<He.length;(Cn+=1)-1){const Jn=He[Cn];Ao[Cn]=Jn==null?void 0:(Jn-It)/lo*100}return Ao}if(ht){for(let Cn=0;Cn<He.length;(Cn+=1)-1){const Jn=He[Cn],nn=ht[Cn];Ao[Cn]=Jn==null||nn===void 0||nn===null||nn===0?void 0:Jn/nn*50+50}return Ao}return He};!ir&&!Ji&&et.forEach(He=>{pr[He]&&!Ae.has(He)&&!/hist|macd|signal/i.test(He)&&(pr[He]=gt(pr[He],pr.close))})}if(!Wa&&Rn.length&&Bt>0)try{const et=new Set(Rn.map((He,ht)=>String((He==null?void 0:He.name)||`series_${ht}`).replace(/\s+/g,"_").toLowerCase()).filter(Boolean)),Ae={};Object.entries(pr).forEach(([He,ht])=>{const It=String(He||"").replace(/\s+/g,"_").toLowerCase();if(et.has(It))return;const Ot=new Float32Array(Bt);for(let lo=0;lo<Bt;(lo+=1)-1)Ot[lo]=ht[lo]??NaN;Ae[It]=Ot});const gt=gg(Rn.map((He,ht)=>({name:String(He.name||`series_${ht}`),expr:Nl(String(He.expr||"").replace(/\$\{([^}]+)\}/g,(It,Ot)=>String(rr[Ot]??It)))})),Ae,rr,Fs.get(Wl));Object.entries(gt).forEach(([He,ht])=>{const It=He.replace(/\s+/g,"_").toLowerCase(),Ot=new Array(Bt);for(let lo=0;lo<Bt;(lo+=1)-1)Ot[lo]=ht[lo];pr[It]=Ot})}catch(et){const Ae=(et==null?void 0:et.message)!=null?String(et.message):String(et);console.error("[ScriptStudio] expression engine error (2nd pass)",et),s(ue)||x(ue,`Expression error: ${Ae}`),s(Ne)||x(Ne,"Expression error")}const la=en.filter(et=>/^__arr_/i.test(String((et==null?void 0:et.name)||""))),fr=en.filter(et=>!/^__arr_/i.test(String((et==null?void 0:et.name)||"")));if(!Wa&&la.length&&Bt>0)try{const et={};Object.entries(pr).forEach(([gt,He])=>{const ht=String(gt||"").replace(/\s+/g,"_").toLowerCase(),It=new Float32Array(Bt);for(let Ot=0;Ot<Bt;(Ot+=1)-1)It[Ot]=He[Ot]??NaN;et[ht]=It});const Ae=Hb(la.map((gt,He)=>({name:String((gt==null?void 0:gt.name)||`state_${He}`),initExpr:(gt==null?void 0:gt.initExpr)!=null?Nl(String(gt.initExpr).replace(/\$\{([^}]+)\}/g,(ht,It)=>String(rr[It]??ht))):void 0,updateExpr:Nl(String((gt==null?void 0:gt.updateExpr)??(gt==null?void 0:gt.expr)??"").replace(/\$\{([^}]+)\}/g,(ht,It)=>String(rr[It]??ht))),selfMode:gt==null?void 0:gt.selfMode})),et,rr,Fs.get(Wl),{autoSort:Ue});Object.entries(Ae).forEach(([gt,He])=>{const ht=gt.replace(/\s+/g,"_").toLowerCase(),It=new Array(Bt);for(let Ot=0;Ot<Bt;(Ot+=1)-1)It[Ot]=He[Ot];pr[ht]=It})}catch(et){const Ae=(et==null?void 0:et.message)!=null?String(et.message):String(et);console.error("[ScriptStudio] state series error",et),s(ue)||x(ue,`Expression error: ${Ae}`),s(Ne)||x(Ne,"Expression error")}if(!Wa&&xo.length&&Bt>0)try{const et=new Set(xo.map((He,ht)=>String((He==null?void 0:He.name)||`series_${ht}`).replace(/\s+/g,"_").toLowerCase()).filter(Boolean)),Ae={};Object.entries(pr).forEach(([He,ht])=>{const It=String(He||"").replace(/\s+/g,"_").toLowerCase();if(et.has(It))return;const Ot=new Float32Array(Bt);for(let lo=0;lo<Bt;(lo+=1)-1)Ot[lo]=ht[lo]??NaN;Ae[It]=Ot});const gt=gg(xo.map((He,ht)=>({name:String(He.name||`series_${ht}`),expr:Nl(String(He.expr||"").replace(/\$\{([^}]+)\}/g,(It,Ot)=>String(rr[Ot]??It)))})),Ae,rr,Fs.get(Wl));Object.entries(gt).forEach(([He,ht])=>{const It=He.replace(/\s+/g,"_").toLowerCase(),Ot=new Array(Bt);for(let lo=0;lo<Bt;(lo+=1)-1)Ot[lo]=ht[lo];pr[It]=Ot})}catch(et){const Ae=(et==null?void 0:et.message)!=null?String(et.message):String(et);console.error("[ScriptStudio] expression engine error (array pass)",et),s(ue)||x(ue,`Expression error: ${Ae}`),s(Ne)||x(Ne,"Expression error")}if(!Wa&&fr.length&&Bt>0)try{const et={};Object.entries(pr).forEach(([gt,He])=>{const ht=String(gt||"").replace(/\s+/g,"_").toLowerCase(),It=new Float32Array(Bt);for(let Ot=0;Ot<Bt;(Ot+=1)-1)It[Ot]=He[Ot]??NaN;et[ht]=It});const Ae=Hb(fr.map((gt,He)=>({name:String((gt==null?void 0:gt.name)||`state_${He}`),initExpr:(gt==null?void 0:gt.initExpr)!=null?Nl(String(gt.initExpr).replace(/\$\{([^}]+)\}/g,(ht,It)=>String(rr[It]??ht))):void 0,updateExpr:Nl(String((gt==null?void 0:gt.updateExpr)??(gt==null?void 0:gt.expr)??"").replace(/\$\{([^}]+)\}/g,(ht,It)=>String(rr[It]??ht))),selfMode:gt==null?void 0:gt.selfMode})),et,rr,Fs.get(Wl),{autoSort:Ue});Object.entries(Ae).forEach(([gt,He])=>{const ht=gt.replace(/\s+/g,"_").toLowerCase(),It=new Array(Bt);for(let Ot=0;Ot<Bt;(Ot+=1)-1)It[Ot]=He[Ot];pr[ht]=It})}catch(et){const Ae=(et==null?void 0:et.message)!=null?String(et.message):String(et);console.error("[ScriptStudio] state series error",et),s(ue)||x(ue,`Expression error: ${Ae}`),s(Ne)||x(Ne,"Expression error")}const Ll={};Qi.forEach(et=>{Ll[et.key]=new Array(Bt)});const ao=new Array(Bt),ul=[];for(let et=0;et<Bt;(et+=1)-1){const Ae={};Da.forEach((He,ht)=>{const It=mo[ht]||Qi[ht].key,Ot=(He.source||He.name||"").replace(/\s+/g,"_").toLowerCase(),lo=pr[Ot]||pr[It]||pr.close,sn=Up(He==null?void 0:He.offset,void 0,0),Ao=Number.isFinite(sn)?Math.trunc(sn):0,Cn=et-Ao,Jn=Up((He==null?void 0:He.showLast)??(He==null?void 0:He.show_last),void 0,NaN),nn=Number.isFinite(Jn)?Math.max(0,Math.floor(Jn)):0,Tn=(!nn||et>=Bt-nn)&&Cn>=0&&Cn<lo.length?lo[Cn]:void 0;Ae[It]=Tn,Ll[It][et]=Tn}),Ae.__open=pr.open[et],Ae.__close=pr.close[et],Ae.__high=pr.high[et],Ae.__low=pr.low[et],Kd.length&&Kd.forEach(He=>{const ht=pr[He.openKey]||pr.open,It=pr[He.highKey]||pr.high,Ot=pr[He.lowKey]||pr.low,lo=pr[He.closeKey]||pr.close;if(!ht||!It||!Ot||!lo)return;const sn=Number.isFinite(He.offset)?He.offset:0,Ao=et-sn,Cn=Number.isFinite(He.showLast)?He.showLast:0,Jn=!Cn||et>=Bt-Cn,nn=us=>Jn&&Ao>=0&&Ao<us.length?us[Ao]:void 0;Ae[`${He.key}__open`]=nn(ht),Ae[`${He.key}__high`]=nn(It),Ae[`${He.key}__low`]=nn(Ot),Ae[`${He.key}__close`]=nn(lo)}),ao[et]=Ae;const gt=((Kf=ve[et])==null?void 0:Kf.timestamp)??((Vm=ve[et])==null?void 0:Vm.time)??((ym=ve[et])==null?void 0:ym.t);if(typeof gt=="number"){const He=String(gt);Pl[He]=Ae,pd[He]=et;const ht=gt<1e12?Math.floor(gt*1e3):Math.floor(gt);ul.push(ht),pd[`${ht}_ms`]=et,pd[`${Math.floor(ht/1e3)}_s`]=et}}let Ic=0;if(ul.length>=2){let et=0;for(let Ae=1;Ae<ul.length;(Ae+=1)-1)et+=Math.abs(ul[Ae]-ul[Ae-1]);Ic=et/(ul.length-1)}const Ra=[];Da.forEach((et,Ae)=>{if(!(et!=null&&et.trackPrice))return;const gt=mo[Ae]||Qi[Ae].key,He=Ll[gt];if(!He||!He.length)return;let ht=NaN;for(let It=He.length-1;It>=0;(It-=1)+1){const Ot=He[It];if(Ot!=null&&Number.isFinite(Ot)){ht=Ot;break}}Number.isFinite(ht)&&Ra.push({value:ht,color:et.color||"#94a3b8",width:1,style:"dashed"})}),Nt._trackLevels=Ra;const gi={},Yc=et=>{const Ae=new Float32Array(Bt);for(let gt=0;gt<Bt;(gt+=1)-1){const He=et[gt];Ae[gt]=He??NaN}return Ae};Object.entries(pr).forEach(([et,Ae])=>{gi[et.replace(/\s+/g,"_").toLowerCase()]=Yc(Ae)}),Object.entries(Ll).forEach(([et,Ae])=>{gi[et]=Yc(Ae)});try{Object.entries(gc).forEach(([et,Ae])=>{const gt=String(et||"").replace(/\s+/g,"_").toLowerCase(),He=String(Ae||"");!gt||!He||gi[gt]||gi[He]&&(gi[gt]=gi[He])})}catch{}{const et=Object.keys(gi);for(const Ae of et){if(!Ae.includes("_"))continue;const gt=Ae.replace(/_/g,"");!gt||gt===Ae||gi[gt]||(gi[gt]=gi[Ae])}}if($p&&!hp&&_n.length){try{const Ae=_n.map(gt=>String((gt==null?void 0:gt.name)||"")).map(gt=>gt.replace(/\s+/g,"_").toLowerCase()).filter(Boolean).filter(gt=>!(gt in pr));if(Ae.length){const gt=`Missing series: ${Ae.slice(0,6).join(", ")}${Ae.length>6?", ...":""}`;x(ue,N(s(ue)?`${s(ue)} • ${gt}`:gt))}}catch{}hp=!0}const xi=[],nr=new Map,wi=new Map,pl=new Map,ar=et=>Nl(String(et||"").replace(/\$\{([^}]+)\}/g,(Ae,gt)=>String(rr[gt]??Ae))),vl=et=>dd(String(et||"").replace(/\$\{([^}]+)\}/g,(Ae,gt)=>String(rr[gt]??Ae))),Qc=et=>{const Ae=ar(et);if(!Ae)return null;const gt=nr.get(Ae);if(gt)return gt;try{const He=H0(Ae,gi,rr,Fs.get(Wl)),ht=new Uint8Array(Bt);for(let It=0;It<Bt;(It+=1)-1){const Ot=He[It];ht[It]=Number.isFinite(Ot)&&Ot!==0?1:0}return nr.set(Ae,ht),ht}catch(He){const ht=(He==null?void 0:He.message)!=null?String(He.message):String(He);return s(ue)||x(ue,`Expression error: ${ht}`),s(Ne)||x(Ne,"Expression error"),null}},ou=et=>{const Ae=vl(et);if(!Ae)return null;const gt=wi.get(Ae);if(gt)return gt;try{const He=Ub(Ae,gi,rr,Fs.get(Wl));return wi.set(Ae,He),He}catch(He){const ht=(He==null?void 0:He.message)!=null?String(He.message):String(He);return s(ue)||x(ue,`Expression error: ${ht}`),s(Ne)||x(Ne,"Expression error"),null}},Fu=et=>{const Ae=ar(et);if(!Ae)return null;const gt=pl.get(Ae);if(gt)return gt;try{const He=H0(Ae,gi,rr,Fs.get(Wl));return pl.set(Ae,He),He}catch(He){const ht=(He==null?void 0:He.message)!=null?String(He.message):String(He);return s(ue)||x(ue,`Expression error: ${ht}`),s(Ne)||x(Ne,"Expression error"),null}},Ad=(et,Ae,gt)=>{if(!et)return gt;const He=et[Ae];if(He==null)return gt;const ht=String(He);return ht||gt},Xd=(et,Ae,gt)=>{if(!et)return gt;const He=et[Ae];return Number.isFinite(He)?He:gt};if(s(Zt)&&Array.isArray(Ma)&&Ma.length){const et=((Wm=B==null?void 0:B.style)==null?void 0:Wm.labelLimit)??((qm=Nt==null?void 0:Nt.style)==null?void 0:qm.labelLimit)??(Nt==null?void 0:Nt.labelLimit),Ae=(()=>{const ht=typeof et=="number"?et:Number(et);return Number.isFinite(ht)?Math.max(0,Math.floor(ht)):600})();let gt=0,He=!1;for(const ht of Ma){if(He)break;if(!ht)continue;const It=String(ht.whenExpr||"").trim();if(!It&&!ht.when)continue;const Ot=String(ht.shape||"").toLowerCase()==="text"&&String(ht.text||"").trim().length<=1;let lo;if(It){const ie=Qc(It);if(!ie)continue;lo=ie}else try{const ie=Cd(String(ht.when));try{lo=e2(ie,gi)}catch{lo=fa(String(ht.when),gi)}}catch{lo=fa(String(ht.when),gi)}const sn=(ht.source||ht.name||"").replace(/\s+/g,"_").toLowerCase(),Ao=sn==="open"||sn==="high"||sn==="low"||sn==="close"||sn==="volume"||sn==="time",Cn=gc[sn],Jn=Cn||((Hm=Qi[0])==null?void 0:Hm.key);if(!Ot&&(Ae===0||gt>=Ae)){He=!0;break}const nn=[];for(let ie=0;ie<Bt;(ie+=1)-1)lo[ie]&&nn.push(ie);if(!nn.length)continue;const us=Ot?nn.length:Math.max(0,Ae-gt);if(us<=0){Ot||(He=!0);break}const Tn=nn.length<=us?nn:(()=>{const ie=Math.max(1,Math.ceil(nn.length/us)),Pe=[];for(let rt=nn.length-1;rt>=0&&Pe.length<us;rt-=ie)Pe.push(nn[rt]);return Pe.sort((rt,gn)=>rt-gn),Pe})(),ui=String(ht.textExpr||"").trim(),Hs=ui?ou(ui):null,da=String(ht.colorExpr||"").trim(),Yi=da?ou(da):null,Bi=String(ht.bgColorExpr||"").trim(),bo=Bi?ou(Bi):null,cs=String(ht.borderColorExpr||"").trim(),b=cs?ou(cs):null,k=String(ht.textColorExpr||"").trim(),T=k?ou(k):null,A=String(ht.sizeExpr||"").trim(),$=A?Fu(A):null,E=String(ht.offsetYExpr||"").trim(),Q=E?Fu(E):null;for(const ie of Tn){if(!Ot&&gt>=Ae){He=!0;break}const Pe=ao[ie]||(ao[ie]={});let rt=(sn&&pr[sn]?pr[sn][ie]:void 0)??(Cn?Pe[Cn]:void 0)??(Jn?Pe[Jn]:void 0);if(Nt.pane==="sub"&&Ao&&Jn&&Pe[Jn]!==void 0&&Pe[Jn]!==null&&Number.isFinite(Pe[Jn])&&(rt=Pe[Jn]),Nt.pane==="sub"&&typeof Nt.min=="number"&&typeof Nt.max=="number"&&Ao&&typeof rt=="number"&&Number.isFinite(rt)&&(rt<Nt.min-5||rt>Nt.max+5)&&(rt=Jn?Pe[Jn]:rt),rt==null||Number.isNaN(rt)){const Td=gc.__zero__||"__zero__",xd=Pe[Td];rt=xd??0}const gn=Ao&&sn||Jn,cn=`__label_${gn}_${ht.position||"above"}`,Gt=ht.text!=null?String(ht.text):Hs?String(Hs[ie]??""):"",eo=Ad(Yi,ie,ht.color||"#f97316"),Ss=Ad(bo,ie,ht.bgColor),La=Ad(b,ie,ht.borderColor),Rl=Ad(T,ie,ht.textColor),pc=Xd($,ie,ht.size),nl=Xd(Q,ie,ht.offsetY);Pe[cn]={text:Gt,color:eo,yKey:gn,position:ht.position||"above",value:rt,shape:ht.shape,bgColor:Ss,borderColor:La,textColor:Rl,size:pc,offsetY:nl,wrap:ht.wrap,maxWidth:ht.maxWidth,padding:ht.padding,bgOpacity:ht.bgOpacity,borderWidth:ht.borderWidth,radius:ht.radius,align:ht.align,valign:ht.valign,lineHeight:ht.lineHeight,fontFamily:ht.fontFamily,fontSize:ht.fontSize,fontWeight:ht.fontWeight,monospace:ht.monospace};const vc=((Ti=ve[ie])==null?void 0:Ti.timestamp)??((zo=ve[ie])==null?void 0:zo.time)??((ca=ve[ie])==null?void 0:ca.t),qc=typeof vc=="number"&&Number.isFinite(vc)?vc<1e12?Math.floor(vc*1e3):Math.floor(vc):void 0;xi.push({index:ie,ts:vc,tsMs:qc,meta:Pe[cn]}),Ot||(gt+=1);try{y2("label",{pane:Nt.pane,index:ie,meta:Pe[cn]})}catch{}}}}const Kp=new Map,yp=new Map,$v=new Map,Zp=new Map,Xp=/\b(?:line|label|box|table)_get_[a-z0-9_]+\s*\(/i;let Jp=null;const lv=et=>Nl(String(et||"").replace(/\$\{([^}]+)\}/g,(Ae,gt)=>String(rr[gt]??Ae))),qv=et=>dd(String(et||"").replace(/\$\{([^}]+)\}/g,(Ae,gt)=>String(rr[gt]??Ae))),pp=(et,Ae)=>{const gt=lv(et);if(!gt)return null;const He=Kp.get(gt);if(He)return He;try{const ht=H0(gt,gi,rr,Fs.get(Wl));return Kp.set(gt,ht),ht}catch(ht){const It=(ht==null?void 0:ht.message)!=null?String(ht.message):String(ht);return s(ue)||x(ue,`Expression error: ${It}`),s(Ne)||x(Ne,"Expression error"),null}},Iu=(et,Ae)=>{const gt=qv(et);if(!gt)return null;const He=yp.get(gt);if(He)return He;try{const ht=Ub(gt,gi,rr,Fs.get(Wl));return yp.set(gt,ht),ht}catch(ht){const It=(ht==null?void 0:ht.message)!=null?String(ht.message):String(ht);return s(ue)||x(ue,`Expression error: ${It}`),s(Ne)||x(Ne,"Expression error"),null}},Qp=(et,Ae,gt)=>{const He=lv(et);if(!He||!Jp)return;let ht=$v.get(He);if(!ht)try{ht=Tf(He),$v.set(He,ht)}catch(It){const Ot=(It==null?void 0:It.message)!=null?String(It.message):String(It);s(ue)||x(ue,`Expression error: ${Ot}`),s(Ne)||x(Ne,"Expression error");return}try{const It=nW(ht,gi,rr,gt,Jp,Fs.get(Wl));return Number.isFinite(It)?It:void 0}catch(It){const Ot=(It==null?void 0:It.message)!=null?String(It.message):String(It);s(ue)||x(ue,`Expression error: ${Ot}`),s(Ne)||x(Ne,"Expression error");return}},Lf=(et,Ae,gt)=>{const He=qv(et);if(!He||!Jp)return"";let ht=Zp.get(He);if(!ht)try{ht=Tf(He),Zp.set(He,ht)}catch(It){const Ot=(It==null?void 0:It.message)!=null?String(It.message):String(It);return s(ue)||x(ue,`Expression error: ${Ot}`),s(Ne)||x(Ne,"Expression error"),""}try{return sW(ht,gi,rr,gt,Jp,Fs.get(Wl))}catch(It){const Ot=(It==null?void 0:It.message)!=null?String(It.message):String(It);return s(ue)||x(ue,`Expression error: ${Ot}`),s(Ne)||x(Ne,"Expression error"),""}},lg=new Set,$m=et=>{const Ae=et;lg.has(Ae)||(lg.add(Ae),console.warn(et))},Cp=(et,Ae,gt)=>bM({xVal:et,xloc:Ae,len:Bt,timeSeriesMs:ul,tsIndex:pd,config:{mode:zc.time.mode,toleranceBars:zc.time.toleranceBars,toleranceMs:zc.time.toleranceMs,futureBars:zc.futureBars,avgIntervalMs:Ic},warn:$m,meta:gt}),qf=(et,Ae)=>{const gt=[];if(et)for(let It=0;It<Bt;(It+=1)-1)et[It]&&gt.push(It);else for(let It=0;It<Bt;(It+=1)-1)gt.push(It);if(gt.length<=Ae)return gt;const He=Math.max(1,Math.ceil(gt.length/Ae)),ht=[];for(let It=gt.length-1;It>=0&&ht.length<Ae;It-=He)ht.push(gt[It]);return ht.sort((It,Ot)=>It-Ot),ht},$u=et=>{if(typeof et!="string")return;const Ae=et.trim().toLowerCase();if(Ae==="background"||Ae==="bg")return"background";if(Ae==="main"||Ae==="base")return"main";if(Ae==="overlay"||Ae==="over")return"overlay";if(Ae==="ui")return"ui"},Pp=et=>{if(typeof et=="number"&&Number.isFinite(et))return et;if(typeof et=="string"){const Ae=Number(et);return Number.isFinite(Ae)?Ae:void 0}},rp=et=>{if(typeof et=="boolean")return et;if(typeof et=="number")return Number.isFinite(et)?et!==0:void 0;if(typeof et=="string"){const Ae=et.trim().toLowerCase();if(Ae==="true")return!0;if(Ae==="false")return!1;const gt=Number(Ae);if(Number.isFinite(gt))return gt!==0}},nf=[],of=[],sf=[],Aa=[],Hv=Math.max(Bt-1+zc.futureBars,Bt-1),ff=[],Ev=[],vm=[];let Uv=null,Gv=null;if(Oo.length){const et=new Map,Ae=lt=>{const O=String(lt||"").trim();return O?O.replace(/\s+/g,"_").toLowerCase():null};Uv=`${Ae(String((B==null?void 0:B.id)??(B==null?void 0:B.name)??Gc))}_${Nt.pane}_${Wn}`||Gc;const gt=_e.get(Uv)??new Map;_e.set(Uv,gt),Gv=q.get(Uv)??{created:{},updated:{},pruned:{}};const He=(lt,O)=>{const pe=Gv[O][lt]??0;Gv[O][lt]=pe+1},ht=(lt,O)=>`${lt}:${O}`,It=new Map,Ot=new Map,lo=(lt,O)=>{const pe=Ae(lt);return pe?O.get(pe)||pe:null},sn=(lt,O)=>{if(!O)return null;const pe=ht(lt,O),ke=It.get(pe);if(ke)return ke;const Mt={__handle:!0,kind:lt,id:O,key:pe};return It.set(pe,Mt),Mt},Ao=(lt,O)=>{const pe=Ae(lt);pe&&O&&Ot.set(pe,O)},Cn=(lt,O)=>{const pe=Ae(lt);if(!pe)return null;const ke=Ot.get(pe);return!ke||O&&ke.kind!==O?null:ke},Jn=(lt,O,pe,ke)=>{const Mt=Cn(pe,lt);if(Mt)return Mt;const Rt=Cn(O,lt);if(Rt)return Rt;const xn=lo(O,ke);if(!xn)return null;const Jt=sn(lt,xn);return Jt&&Ao(O,Jt),Jt},nn=(lt,O,pe,ke)=>{var Mt;return((Mt=Jn(lt,O,pe,ke))==null?void 0:Mt.id)??null},us=(lt,O)=>{const pe=String(lt||"").trim();if(!pe)return!0;const ke=lv(pe);if(ke&&Xp.test(ke)){const Rt=Qp(ke,"when",O);return Number.isFinite(Rt)&&Rt!==0}let Mt=et.get(pe);if(!Mt){try{Mt=fa(pe,gi)}catch{Mt=null}et.set(pe,Mt)}return Mt?!!Mt[O]:!1},Tn=(lt,O,pe)=>{if(!lt)return;const ke=lv(String(lt));if(ke&&Xp.test(ke))return Qp(ke,O,pe);const Mt=pp(String(lt));if(!Mt)return;const Rt=Mt[pe];return Number.isFinite(Rt)?Rt:void 0},ui=(lt,O,pe,ke)=>{if(lt!=null)return String(lt);if(!O)return"";const Mt=qv(String(O));if(Mt&&Xp.test(Mt))return Lf(Mt,pe,ke);const Rt=Iu(O);return Rt?String(Rt[ke]??""):""},Hs=lt=>{if(Array.isArray(lt)){const O=lt.map(pe=>String(pe||"").trim().toLowerCase()).filter(Boolean);return O.length?O:void 0}if(typeof lt=="string"){const O=lt.split(",").map(pe=>pe.trim().toLowerCase()).filter(Boolean);return O.length?O:void 0}},da=(lt,O,pe)=>{if(!lt)return;O&&(lt.groupId=O);const ke=Hs(pe);ke&&(lt.tags=ke)},Yi=lt=>String(lt??"").trim().toLowerCase(),Bi=(lt,O)=>O?It.get(ht(lt,O)):null,bo=(lt,O,pe,ke,Mt,Rt)=>{if(!O||ke&&ke!==lt)return!1;const xn=Bi(lt,O),Jt=Yi(Mt);if(Jt&&Yi((pe==null?void 0:pe.groupId)??(xn==null?void 0:xn.groupId))!==Jt)return!1;const Qn=Yi(Rt);if(Qn){const io=Hs((pe==null?void 0:pe.tags)??(xn==null?void 0:xn.tags))??(xn!=null&&xn.tags?Hs(xn.tags):void 0);if(!io||!io.includes(Qn))return!1}return!0},cs=(lt,O)=>{var Mt;if(!O)return;const pe=ht(lt,O);if(It.get(pe)){It.delete(pe);const Rt=Za==null?void 0:Za[lt];(Mt=Rt==null?void 0:Rt.delete)==null||Mt.call(Rt,O);for(const[Jt,Qn]of Ot.entries())(Qn==null?void 0:Qn.key)===pe&&Ot.delete(Jt);for(const[Jt,Qn]of gt.entries())(Qn==null?void 0:Qn.key)===pe&&gt.delete(Jt);const xn=Jt=>{for(const[Qn,io]of Jt.entries())io===O&&Jt.delete(Qn)};lt==="line"&&xn($),lt==="linefill"&&xn(E),lt==="label"&&xn(Q),lt==="box"&&xn(ie),lt==="table"&&xn(Pe),lt==="polyline"&&xn(rt),lt==="polygon"&&xn(gn),lt==="path"&&xn(cn)}},b=(lt,O,pe)=>{O<=0||console.warn(`[ScriptStudio] ${lt} limit ${pe} reached; pruned ${O} via ${zc.pruningPolicy} policy`)},k=(lt,O,pe)=>{if(zc.pruningPolicy==="lru"){const ke=Za[pe];return lt.slice().sort((Mt,Rt)=>(ke.get(Mt)??Number.MIN_SAFE_INTEGER)-(ke.get(Rt)??Number.MIN_SAFE_INTEGER))}if(zc.pruningPolicy==="byGroup"){const ke=new Map;return lt.forEach((Mt,Rt)=>{var Jt;const xn=((Jt=O.get(Mt))==null?void 0:Jt.groupId)||"";ke.has(xn)||ke.set(xn,Rt)}),lt.slice().sort((Mt,Rt)=>{var to,ho;const xn=((to=O.get(Mt))==null?void 0:to.groupId)||"",Jt=((ho=O.get(Rt))==null?void 0:ho.groupId)||"",Qn=ke.get(xn)??0,io=ke.get(Jt)??0;return Qn!==io?Qn-io:lt.indexOf(Mt)-lt.indexOf(Rt)})}return lt.slice()},T=(lt,O,pe,ke)=>{const Mt=[];if(lt.length<=pe)return;const Rt=k(lt,O,ke);for(;lt.length>pe&&Rt.length;){const xn=Rt.shift();if(!xn)continue;O.delete(xn);const Jt=lt.indexOf(xn);Jt>=0&&lt.splice(Jt,1),jr[ke].push(xn),cs(ke,xn),Mt.push(xn),He(ke,"pruned")}Mt.length&&b(ke,Mt.length,pe)},A=(lt,O,pe,ke,Mt)=>{const Rt=[];if(!lt||!lt.length)return Rt;for(const xn of lt){if(!xn)continue;const Jt=Tn(xn.x,`${ke}.x`,Mt),Qn=Tn(xn.y,`${ke}.y`,Mt);Jt==null||Qn==null||Rt.push({x:Jt,y:Qn,xloc:xn.xloc||O,yloc:xn.yloc||pe})}return Rt},$=new Map,E=new Map,Q=new Map,ie=new Map,Pe=new Map,rt=new Map,gn=new Map,cn=new Map,Gt=new Map,eo=new Map,Ss=new Map,La=new Map,Rl=new Map,pc=new Map,nl=new Map,vc=new Map,qc=[],Td=[],xd=[],jd=[],vd=[],Hd=[],Tr=[],xl=[],Za={line:new Map,linefill:new Map,label:new Map,box:new Map,table:new Map,polyline:new Map,polygon:new Map,path:new Map},jr={line:[],linefill:[],label:[],box:[],table:[],polyline:[],polygon:[],path:[]};let ol=0,Lr=0,ii=0,Di=0,Ha=0,Ns=0,Cr=0,Xa=0;gt.forEach((lt,O)=>{if(!lt||!lt.key)return;It.set(lt.key,lt),Ot.set(O,lt);const pe=lt.id;if(pe){if(lt.kind==="line"){$.set(O,pe);const ke=pe.match(/line_(\d+)/);ke&&(ol=Math.max(ol,Number(ke[1])))}else if(lt.kind==="linefill"){E.set(O,pe);const ke=pe.match(/linefill_(\d+)/);ke&&(Lr=Math.max(Lr,Number(ke[1])))}else if(lt.kind==="label"){Q.set(O,pe);const ke=pe.match(/label_(\d+)/);ke&&(ii=Math.max(ii,Number(ke[1])))}else if(lt.kind==="box"){ie.set(O,pe);const ke=pe.match(/box_(\d+)/);ke&&(Di=Math.max(Di,Number(ke[1])))}else if(lt.kind==="table"){Pe.set(O,pe);const ke=pe.match(/table_(\d+)/);ke&&(Ha=Math.max(Ha,Number(ke[1])))}else if(lt.kind==="polyline"){rt.set(O,pe);const ke=pe.match(/polyline_(\d+)/);ke&&(Ns=Math.max(Ns,Number(ke[1])))}else if(lt.kind==="polygon"){gn.set(O,pe);const ke=pe.match(/polygon_(\d+)/);ke&&(Cr=Math.max(Cr,Number(ke[1])))}else if(lt.kind==="path"){cn.set(O,pe);const ke=pe.match(/path_(\d+)/);ke&&(Xa=Math.max(Xa,Number(ke[1])))}}});const Ur=zc.limits.line||240,Ja=zc.limits.label||300,Gl=zc.limits.box||180,Gr=zc.limits.table||20,Il=zc.limits.linefill||120,bc=zc.limits.polyline||180,Zr=zc.limits.polygon||160,Ua=zc.limits.path||160;Jp={get:(lt,O,pe,ke)=>{const Mt=String(O||"").toLowerCase().replace(/[^a-z0-9]/g,""),Rt=Ae(String(pe||""));if(Rt){if(lt==="line"){const xn=nn("line",Rt,Rt,$),Jt=Gt.get(xn);return Jt?Mt==="x1"?Number.isFinite(Jt.x1)?Jt.x1:NaN:Mt==="y1"?Number.isFinite(Jt.y1)?Jt.y1:NaN:Mt==="x2"?Number.isFinite(Jt.x2)?Jt.x2:NaN:Mt==="y2"?Number.isFinite(Jt.y2)?Jt.y2:NaN:Mt==="width"||Mt==="linewidth"?Number.isFinite(Jt.width)?Jt.width:NaN:Mt==="color"?Jt.color??"":Mt==="style"?Jt.style??"":Mt==="extend"?Jt.extend??"":Mt==="xloc"?Jt.xloc??"":void 0:void 0}if(lt==="label"){const xn=nn("label",Rt,Rt,Q),Jt=Ss.get(xn);return Jt?Mt==="x"?Number.isFinite(Jt.x)?Jt.x:NaN:Mt==="y"?Number.isFinite(Jt.y)?Jt.y:NaN:Mt==="size"?Number.isFinite(Jt.size)?Jt.size:NaN:Mt==="text"?Jt.text??"":Mt==="color"?Jt.color??"":Mt==="textcolor"?Jt.textColor??"":Mt==="style"?Jt.shape??"":Mt==="yloc"?Jt.yloc??"":Mt==="xloc"?Jt.xloc??"":Mt==="textalign"?Jt.textAlign??"":Mt==="tooltip"?Jt.tooltip??"":void 0:void 0}if(lt==="box"){const xn=nn("box",Rt,Rt,ie),Jt=La.get(xn);return Jt?Mt==="left"?Number.isFinite(Jt.left)?Jt.left:NaN:Mt==="right"?Number.isFinite(Jt.right)?Jt.right:NaN:Mt==="top"?Number.isFinite(Jt.top)?Jt.top:NaN:Mt==="bottom"?Number.isFinite(Jt.bottom)?Jt.bottom:NaN:Mt==="borderwidth"?Number.isFinite(Jt.borderWidth)?Jt.borderWidth:NaN:Mt==="textsize"?Number.isFinite(Jt.textSize)?Jt.textSize:NaN:Mt==="textwrap"?Jt.textWrap?1:0:Mt==="bgcolor"?Jt.bgColor??"":Mt==="bordercolor"?Jt.borderColor??"":Mt==="borderstyle"?Jt.borderStyle??"":Mt==="text"?Jt.text??"":Mt==="textcolor"?Jt.textColor??"":Mt==="texthalign"?Jt.textHalign??"":Mt==="textvalign"?Jt.textValign??"":Mt==="extend"?Jt.extend??"":Mt==="xloc"?Jt.xloc??"":void 0:void 0}if(lt==="table"){const xn=nn("table",Rt,Rt,Pe),Jt=Rl.get(xn);return Jt?Mt==="position"?Jt.position??"":Mt==="columns"?Number.isFinite(Jt.columns)?Jt.columns:NaN:Mt==="rows"?Number.isFinite(Jt.rows)?Jt.rows:NaN:Mt==="borderwidth"?Number.isFinite(Jt.borderWidth)?Jt.borderWidth:NaN:Mt==="framewidth"?Number.isFinite(Jt.frameWidth)?Jt.frameWidth:NaN:Mt==="textsize"?Number.isFinite(Jt.textSize)?Jt.textSize:NaN:Mt==="bgcolor"?Jt.bgcolor??"":Mt==="bordercolor"?Jt.borderColor??"":Mt==="textcolor"?Jt.textColor??"":Mt==="texthalign"?Jt.textHalign??"":Mt==="textvalign"?Jt.textValign??"":Mt==="framecolor"?Jt.frameColor??"":void 0:void 0}}}};let Rr=0;for(let lt=0;lt<Bt;(lt+=1)-1)for(const O of Oo)if(Rr+=1,!(!O||!us(O.when,lt))){if(O.kind==="line_new"){const pe=Ae(O.assign),ke=pe?Ot.get(pe):null,Mt=pe?$.get(pe):null,Rt=Mt?Gt.get(Mt):null;if(O.once&&pe&&Mt&&Rt)continue;const xn=Tn(O.x1,"line.x1",lt),Jt=Tn(O.y1,"line.y1",lt),Qn=Tn(O.x2,"line.x2",lt),io=Tn(O.y2,"line.y2",lt);if(xn==null||Jt==null||Qn==null||io==null)continue;const to=jr.line.shift(),ho=(ke==null?void 0:ke.id)||Mt||to||`line_${ol+=1}`,Li=ho.match(/line_(\d+)/);Li&&(ol=Math.max(ol,Number(Li[1])));const Ms=O.width??Tn(O.widthExpr,"line.width",lt)??void 0,Zo=$u(O.layer),ko=Pp(O.zIndex),ki=rp(O.includeInAutoscale),Rs=ke??sn("line",ho);da(Rs,O.groupId,Hs(O.tags)),Gt.set(ho,{x1:xn,y1:Jt,x2:Qn,y2:io,color:O.color,width:Ms,style:O.style,extend:O.extend,xloc:O.xloc,layer:Zo,zIndex:ko,includeInAutoscale:ki,groupId:O.groupId??(Rs==null?void 0:Rs.groupId),tags:Hs(O.tags)??(Rs==null?void 0:Rs.tags)}),Za.line.set(ho,Rr),He("line",Rt?"updated":"created"),qc.push(ho),T(qc,Gt,Ur,"line"),pe&&Rs&&($.set(pe,ho),Ao(pe,Rs),gt.set(pe,Rs));continue}if(O.kind==="line_set"){const pe=nn("line",O.target,O.targetExpr,$);if(!pe)continue;const ke=Gt.get(pe);if(!ke)continue;const Mt=Tn(O.x1,"line.set_x1",lt),Rt=Tn(O.y1,"line.set_y1",lt),xn=Tn(O.x2,"line.set_x2",lt),Jt=Tn(O.y2,"line.set_y2",lt);if(Mt!=null&&(ke.x1=Mt),Rt!=null&&(ke.y1=Rt),xn!=null&&(ke.x2=xn),Jt!=null&&(ke.y2=Jt),O.color&&(ke.color=O.color),O.width!=null||O.widthExpr){const Qn=O.width??Tn(O.widthExpr,"line.set_width",lt);Qn!=null&&(ke.width=Qn)}O.style&&(ke.style=O.style),O.extend&&(ke.extend=O.extend),O.xloc&&(ke.xloc=O.xloc),Za.line.set(pe,Rr),He("line","updated");continue}if(O.kind==="line_delete"){const pe=nn("line",O.target,O.targetExpr,$);if(!pe)continue;Gt.delete(pe);const ke=qc.indexOf(pe);ke>=0&&qc.splice(ke,1),cs("line",pe);continue}if(O.kind==="linefill_new"){const pe=Ae(O.assign),ke=pe?Ot.get(pe):null,Mt=pe?E.get(pe):null,Rt=Mt?eo.get(Mt):null;if(O.once&&pe&&Mt&&Rt)continue;const xn=nn("line",O.line1,O.line1,$),Jt=nn("line",O.line2,O.line2,$);if(!xn||!Jt)continue;const Qn=jr.linefill.shift(),io=(ke==null?void 0:ke.id)||Mt||Qn||`linefill_${Lr+=1}`,to=io.match(/linefill_(\d+)/);to&&(Lr=Math.max(Lr,Number(to[1])));const ho=$u(O.layer),Li=Pp(O.zIndex),Ms=rp(O.includeInAutoscale),Zo=ke??sn("linefill",io);da(Zo,O.groupId,Hs(O.tags)),eo.set(io,{line1:xn,line2:Jt,color:O.color,layer:ho,zIndex:Li,includeInAutoscale:Ms,groupId:O.groupId??(Zo==null?void 0:Zo.groupId),tags:Hs(O.tags)??(Zo==null?void 0:Zo.tags)}),Za.linefill.set(io,Rr),He("linefill",Rt?"updated":"created"),Td.push(io),T(Td,eo,Il,"linefill"),pe&&Zo&&(E.set(pe,io),Ao(pe,Zo),gt.set(pe,Zo));continue}if(O.kind==="linefill_set"){const pe=nn("linefill",O.target,O.targetExpr,E);if(!pe)continue;const ke=eo.get(pe);if(!ke)continue;if(O.color&&(ke.color=O.color),O.line1){const Mt=nn("line",O.line1,O.line1,$);Mt&&(ke.line1=Mt)}if(O.line2){const Mt=nn("line",O.line2,O.line2,$);Mt&&(ke.line2=Mt)}Za.linefill.set(pe,Rr),He("linefill","updated");continue}if(O.kind==="linefill_delete"){const pe=nn("linefill",O.target,O.targetExpr,E);if(!pe)continue;eo.delete(pe);const ke=Td.indexOf(pe);ke>=0&&Td.splice(ke,1),cs("linefill",pe);continue}if(O.kind==="label_new"){const pe=Ae(O.assign),ke=pe?Ot.get(pe):null,Mt=pe?Q.get(pe):null,Rt=Mt?Ss.get(Mt):null;if(O.once&&pe&&Mt&&Rt)continue;const xn=Tn(O.x,"label.x",lt),Jt=Tn(O.y,"label.y",lt);if(xn==null||Jt==null)continue;const Qn=jr.label.shift(),io=(ke==null?void 0:ke.id)||Mt||Qn||`label_${ii+=1}`,to=io.match(/label_(\d+)/);to&&(ii=Math.max(ii,Number(to[1])));const ho=O.size??Tn(O.sizeExpr,"label.size",lt)??void 0,Li=O.padding,Ms=O.radius??Tn(O.radiusExpr,"label.radius",lt),Zo=O.maxWidth??Tn(O.maxWidthExpr,"label.max_width",lt),ko=O.borderWidth??Tn(O.borderWidthExpr,"label.border_width",lt),ki=O.lineHeight??Tn(O.lineHeightExpr,"label.line_height",lt),Rs=$u(O.layer),pi=Pp(O.zIndex),Fr=rp(O.includeInAutoscale),Ni=ke??sn("label",io);da(Ni,O.groupId,Hs(O.tags)),Ss.set(io,{x:xn,y:Jt,text:ui(O.text,O.textExpr,"label.text",lt),color:O.color,textColor:O.textColor,shape:O.style,size:ho,xloc:O.xloc,yloc:O.yloc,textAlign:O.textAlign,tooltip:ui(O.tooltip,O.tooltipExpr,"label.tooltip",lt),wrap:O.wrap,maxWidth:Zo,padding:Li,bgColor:O.bgColor,bgOpacity:O.bgOpacity,borderColor:O.borderColor,borderWidth:ko,radius:Ms,align:O.align,valign:O.valign,lineHeight:ki,fontFamily:O.fontFamily,fontSize:O.fontSize,fontWeight:O.fontWeight,monospace:O.monospace,layer:Rs,zIndex:pi,includeInAutoscale:Fr,groupId:O.groupId??(Ni==null?void 0:Ni.groupId),tags:Hs(O.tags)??(Ni==null?void 0:Ni.tags)}),Za.label.set(io,Rr),He("label",Rt?"updated":"created"),xd.push(io),T(xd,Ss,Ja,"label"),pe&&Ni&&(Q.set(pe,io),Ao(pe,Ni),gt.set(pe,Ni));continue}if(O.kind==="label_set"){const pe=nn("label",O.target,O.targetExpr,Q);if(!pe)continue;const ke=Ss.get(pe);if(!ke)continue;const Mt=Tn(O.x,"label.set_x",lt),Rt=Tn(O.y,"label.set_y",lt);if(Mt!=null&&(ke.x=Mt),Rt!=null&&(ke.y=Rt),(O.text!=null||O.textExpr)&&(ke.text=ui(O.text,O.textExpr,"label.set_text",lt)),O.color&&(ke.color=O.color),O.textColor&&(ke.textColor=O.textColor),O.style&&(ke.shape=O.style),O.size!=null||O.sizeExpr){const xn=O.size??Tn(O.sizeExpr,"label.set_size",lt);xn!=null&&(ke.size=xn)}O.yloc&&(ke.yloc=O.yloc),O.textAlign&&(ke.textAlign=O.textAlign),(O.tooltip!=null||O.tooltipExpr)&&(ke.tooltip=ui(O.tooltip,O.tooltipExpr,"label.set_tooltip",lt)),O.xloc&&(ke.xloc=O.xloc),O.wrap!=null&&(ke.wrap=O.wrap),O.maxWidth!=null&&(ke.maxWidth=O.maxWidth),O.padding!=null&&(ke.padding=O.padding),O.bgColor&&(ke.bgColor=O.bgColor),O.bgOpacity!=null&&(ke.bgOpacity=O.bgOpacity),O.borderColor&&(ke.borderColor=O.borderColor),O.borderWidth!=null&&(ke.borderWidth=O.borderWidth),O.radius!=null&&(ke.radius=O.radius),O.align&&(ke.align=O.align),O.valign&&(ke.valign=O.valign),O.lineHeight!=null&&(ke.lineHeight=O.lineHeight),O.fontFamily&&(ke.fontFamily=O.fontFamily),O.fontSize!=null&&(ke.fontSize=O.fontSize),O.fontWeight&&(ke.fontWeight=O.fontWeight),O.monospace!=null&&(ke.monospace=O.monospace),Za.label.set(pe,Rr),He("label","updated");continue}if(O.kind==="label_delete"){const pe=nn("label",O.target,O.targetExpr,Q);if(!pe)continue;Ss.delete(pe);const ke=xd.indexOf(pe);ke>=0&&xd.splice(ke,1),cs("label",pe);continue}if(O.kind==="box_new"){const pe=Ae(O.assign),ke=pe?Ot.get(pe):null,Mt=pe?ie.get(pe):null,Rt=Mt?La.get(Mt):null;if(O.once&&pe&&Mt&&Rt)continue;const xn=Tn(O.left,"box.left",lt),Jt=Tn(O.right,"box.right",lt),Qn=Tn(O.top,"box.top",lt),io=Tn(O.bottom,"box.bottom",lt);if(xn==null||Jt==null||Qn==null||io==null)continue;const to=jr.box.shift(),ho=(ke==null?void 0:ke.id)||Mt||to||`box_${Di+=1}`,Li=ho.match(/box_(\d+)/);Li&&(Di=Math.max(Di,Number(Li[1])));const Ms=O.width??Tn(O.widthExpr,"box.border_width",lt)??void 0,Zo=O.textSize??Tn(O.textSizeExpr,"box.text_size",lt)??void 0,ko=$u(O.layer),ki=Pp(O.zIndex),Rs=rp(O.includeInAutoscale),pi=ke??sn("box",ho);da(pi,O.groupId,Hs(O.tags)),La.set(ho,{left:xn,right:Jt,top:Qn,bottom:io,borderColor:O.borderColor,bgColor:O.bgColor,borderWidth:Ms,borderStyle:O.borderStyle,text:ui(O.text,O.textExpr,"box.text",lt),textColor:O.textColor,textSize:Zo,textHalign:O.textHalign,textValign:O.textValign,textWrap:O.textWrap,extend:O.extend,xloc:O.xloc,layer:ko,zIndex:ki,includeInAutoscale:Rs,groupId:O.groupId??(pi==null?void 0:pi.groupId),tags:Hs(O.tags)??(pi==null?void 0:pi.tags)}),Za.box.set(ho,Rr),He("box",Rt?"updated":"created"),jd.push(ho),T(jd,La,Gl,"box"),pe&&pi&&(ie.set(pe,ho),Ao(pe,pi),gt.set(pe,pi));continue}if(O.kind==="box_set"){const pe=nn("box",O.target,O.targetExpr,ie);if(!pe)continue;const ke=La.get(pe);if(!ke)continue;const Mt=Tn(O.left,"box.set_left",lt),Rt=Tn(O.right,"box.set_right",lt),xn=Tn(O.top,"box.set_top",lt),Jt=Tn(O.bottom,"box.set_bottom",lt);if(Mt!=null&&(ke.left=Mt),Rt!=null&&(ke.right=Rt),xn!=null&&(ke.top=xn),Jt!=null&&(ke.bottom=Jt),O.borderColor&&(ke.borderColor=O.borderColor),O.bgColor&&(ke.bgColor=O.bgColor),O.width!=null||O.widthExpr){const Qn=O.width??Tn(O.widthExpr,"box.set_border_width",lt);Qn!=null&&(ke.borderWidth=Qn)}if(O.borderStyle&&(ke.borderStyle=O.borderStyle),(O.text!=null||O.textExpr)&&(ke.text=ui(O.text,O.textExpr,"box.set_text",lt)),O.textColor&&(ke.textColor=O.textColor),O.textSize!=null||O.textSizeExpr){const Qn=O.textSize??Tn(O.textSizeExpr,"box.set_text_size",lt);Qn!=null&&(ke.textSize=Qn)}O.textHalign&&(ke.textHalign=O.textHalign),O.textValign&&(ke.textValign=O.textValign),typeof O.textWrap=="boolean"&&(ke.textWrap=O.textWrap),O.extend&&(ke.extend=O.extend),O.xloc&&(ke.xloc=O.xloc),Za.box.set(pe,Rr),He("box","updated");continue}if(O.kind==="box_delete"){const pe=nn("box",O.target,O.targetExpr,ie);if(!pe)continue;La.delete(pe);const ke=jd.indexOf(pe);ke>=0&&jd.splice(ke,1),cs("box",pe);continue}if(O.kind==="polyline_new"){const pe=Ae(O.assign),ke=pe?Ot.get(pe):null,Mt=pe?rt.get(pe):null,Rt=Mt?pc.get(Mt):null;if(O.once&&pe&&Mt&&Rt)continue;const xn=A(O.points,O.xloc,O.yloc,"polyline.points",lt);if(!xn.length)continue;const Jt=jr.polyline.shift(),Qn=(ke==null?void 0:ke.id)||Mt||Jt||`polyline_${Ns+=1}`,io=Qn.match(/polyline_(\d+)/);io&&(Ns=Math.max(Ns,Number(io[1])));const to=O.width??Tn(O.widthExpr,"polyline.width",lt)??void 0,ho=ke??sn("polyline",Qn);da(ho,O.groupId,Hs(O.tags)),pc.set(Qn,{id:Qn,points:xn,color:O.color,width:to,style:O.style,opacity:O.opacity,layer:$u(O.layer),zIndex:Pp(O.zIndex),includeInAutoscale:rp(O.includeInAutoscale),groupId:O.groupId??(ho==null?void 0:ho.groupId),tags:Hs(O.tags)??(ho==null?void 0:ho.tags)}),Za.polyline.set(Qn,Rr),He("polyline",Rt?"updated":"created"),Hd.push(Qn),T(Hd,pc,bc,"polyline"),pe&&ho&&(rt.set(pe,Qn),Ao(pe,ho),gt.set(pe,ho));continue}if(O.kind==="polyline_set"){const pe=nn("polyline",O.target,O.targetExpr,rt);if(!pe)continue;const ke=pc.get(pe);if(!ke)continue;if(O.points&&O.points.length){const Rt=A(O.points,O.xloc,O.yloc,"polyline.set_points",lt);Rt.length&&(ke.points=Rt)}if(O.color&&(ke.color=O.color),O.width!=null||O.widthExpr){const Rt=O.width??Tn(O.widthExpr,"polyline.set_width",lt);Rt!=null&&(ke.width=Rt)}O.style&&(ke.style=O.style),O.opacity!=null&&(ke.opacity=O.opacity),O.layer&&(ke.layer=O.layer),O.zIndex!=null&&(ke.zIndex=O.zIndex),O.includeInAutoscale!=null&&(ke.includeInAutoscale=O.includeInAutoscale),O.groupId&&(ke.groupId=O.groupId);const Mt=Hs(O.tags);Mt&&(ke.tags=Mt),Za.polyline.set(pe,Rr),He("polyline","updated");continue}if(O.kind==="polyline_delete"){const pe=nn("polyline",O.target,O.targetExpr,rt);if(!pe)continue;pc.delete(pe);const ke=Hd.indexOf(pe);ke>=0&&Hd.splice(ke,1),cs("polyline",pe);continue}if(O.kind==="polygon_new"){const pe=Ae(O.assign),ke=pe?Ot.get(pe):null,Mt=pe?gn.get(pe):null,Rt=Mt?nl.get(Mt):null;if(O.once&&pe&&Mt&&Rt)continue;const xn=A(O.points,O.xloc,O.yloc,"polygon.points",lt);if(xn.length<3)continue;const Jt=jr.polygon.shift(),Qn=(ke==null?void 0:ke.id)||Mt||Jt||`polygon_${Cr+=1}`,io=Qn.match(/polygon_(\d+)/);io&&(Cr=Math.max(Cr,Number(io[1])));const to=O.strokeWidth??Tn(O.strokeWidthExpr,"polygon.stroke_width",lt)??void 0,ho=ke??sn("polygon",Qn);da(ho,O.groupId,Hs(O.tags)),nl.set(Qn,{id:Qn,points:xn,fillColor:O.fillColor,strokeColor:O.strokeColor,strokeWidth:to,strokeStyle:O.strokeStyle,opacity:O.opacity,layer:$u(O.layer),zIndex:Pp(O.zIndex),includeInAutoscale:rp(O.includeInAutoscale),groupId:O.groupId??(ho==null?void 0:ho.groupId),tags:Hs(O.tags)??(ho==null?void 0:ho.tags)}),Za.polygon.set(Qn,Rr),He("polygon",Rt?"updated":"created"),Tr.push(Qn),T(Tr,nl,Zr,"polygon"),pe&&ho&&(gn.set(pe,Qn),Ao(pe,ho),gt.set(pe,ho));continue}if(O.kind==="polygon_set"){const pe=nn("polygon",O.target,O.targetExpr,gn);if(!pe)continue;const ke=nl.get(pe);if(!ke)continue;if(O.points&&O.points.length){const Rt=A(O.points,O.xloc,O.yloc,"polygon.set_points",lt);Rt.length>=3&&(ke.points=Rt)}if(O.fillColor&&(ke.fillColor=O.fillColor),O.strokeColor&&(ke.strokeColor=O.strokeColor),O.strokeWidth!=null||O.strokeWidthExpr){const Rt=O.strokeWidth??Tn(O.strokeWidthExpr,"polygon.stroke_width",lt);Rt!=null&&(ke.strokeWidth=Rt)}O.strokeStyle&&(ke.strokeStyle=O.strokeStyle),O.opacity!=null&&(ke.opacity=O.opacity),O.layer&&(ke.layer=O.layer),O.zIndex!=null&&(ke.zIndex=O.zIndex),O.includeInAutoscale!=null&&(ke.includeInAutoscale=O.includeInAutoscale),O.groupId&&(ke.groupId=O.groupId);const Mt=Hs(O.tags);Mt&&(ke.tags=Mt),Za.polygon.set(pe,Rr),He("polygon","updated");continue}if(O.kind==="polygon_delete"){const pe=nn("polygon",O.target,O.targetExpr,gn);if(!pe)continue;nl.delete(pe);const ke=Tr.indexOf(pe);ke>=0&&Tr.splice(ke,1),cs("polygon",pe);continue}if(O.kind==="path_new"){const pe=Ae(O.assign),ke=pe?Ot.get(pe):null,Mt=pe?cn.get(pe):null,Rt=Mt?vc.get(Mt):null;if(O.once&&pe&&Mt&&Rt)continue;const xn=Array.isArray(O.commands)&&O.commands.length?O.commands:(O.points||[]).map((Li,Ms)=>({cmd:Ms===0?"M":"L",x:Li.x,y:Li.y,xloc:Li.xloc||O.xloc,yloc:Li.yloc||O.yloc}));if(!xn.length)continue;const Jt=jr.path.shift(),Qn=(ke==null?void 0:ke.id)||Mt||Jt||`path_${Xa+=1}`,io=Qn.match(/path_(\d+)/);io&&(Xa=Math.max(Xa,Number(io[1])));const to=O.width??Tn(O.widthExpr,"path.width",lt)??void 0,ho=ke??sn("path",Qn);da(ho,O.groupId,Hs(O.tags)),vc.set(Qn,{id:Qn,commands:xn,color:O.color,width:to,style:O.style,opacity:O.opacity,layer:$u(O.layer),zIndex:Pp(O.zIndex),includeInAutoscale:rp(O.includeInAutoscale),groupId:O.groupId??(ho==null?void 0:ho.groupId),tags:Hs(O.tags)??(ho==null?void 0:ho.tags)}),Za.path.set(Qn,Rr),He("path",Rt?"updated":"created"),xl.push(Qn),T(xl,vc,Ua,"path"),pe&&ho&&(cn.set(pe,Qn),Ao(pe,ho),gt.set(pe,ho));continue}if(O.kind==="path_set"){const pe=nn("path",O.target,O.targetExpr,cn);if(!pe)continue;const ke=vc.get(pe);if(!ke)continue;if(O.commands&&O.commands.length&&(ke.commands=O.commands),O.color&&(ke.color=O.color),O.width!=null||O.widthExpr){const Rt=O.width??Tn(O.widthExpr,"path.set_width",lt);Rt!=null&&(ke.width=Rt)}O.style&&(ke.style=O.style),O.opacity!=null&&(ke.opacity=O.opacity),O.layer&&(ke.layer=O.layer),O.zIndex!=null&&(ke.zIndex=O.zIndex),O.includeInAutoscale!=null&&(ke.includeInAutoscale=O.includeInAutoscale),O.groupId&&(ke.groupId=O.groupId);const Mt=Hs(O.tags);Mt&&(ke.tags=Mt),Za.path.set(pe,Rr),He("path","updated");continue}if(O.kind==="path_delete"){const pe=nn("path",O.target,O.targetExpr,cn);if(!pe)continue;vc.delete(pe);const ke=xl.indexOf(pe);ke>=0&&xl.splice(ke,1),cs("path",pe);continue}if(O.kind==="table_new"){const pe=Ae(O.assign),ke=pe?Ot.get(pe):null,Mt=pe?Pe.get(pe):null,Rt=Mt?Rl.get(Mt):null;if(O.once&&pe&&Mt&&Rt)continue;const xn=Math.max(1,Math.floor(Number(O.columns??0))),Jt=Math.max(1,Math.floor(Number(O.rows??0)));if(!xn||!Jt)continue;const Qn=jr.table.shift(),io=(ke==null?void 0:ke.id)||Mt||Qn||`table_${Ha+=1}`,to=io.match(/table_(\d+)/);to&&(Ha=Math.max(Ha,Number(to[1])));const ho=$u(O.layer),Li=Pp(O.zIndex),Ms=rp(O.includeInAutoscale),Zo=ke??sn("table",io);da(Zo,O.groupId,Hs(O.tags)),Rl.set(io,{id:io,position:O.position||"top_right",columns:xn,rows:Jt,bgcolor:O.bgcolor,borderColor:O.borderColor,borderWidth:O.borderWidth??Tn(O.borderWidthExpr,"table.border_width",lt)??void 0,textColor:O.textColor,textSize:O.textSize??Tn(O.textSizeExpr,"table.text_size",lt)??void 0,textHalign:O.textHalign,textValign:O.textValign,frameColor:O.frameColor,frameWidth:O.frameWidth??Tn(O.frameWidthExpr,"table.frame_width",lt)??void 0,cells:new Map,merges:[],layer:ho,zIndex:Li,includeInAutoscale:Ms,groupId:O.groupId??(Zo==null?void 0:Zo.groupId),tags:Hs(O.tags)??(Zo==null?void 0:Zo.tags)}),Za.table.set(io,Rr),He("table",Rt?"updated":"created"),vd.push(io),T(vd,Rl,Gr,"table"),pe&&Zo&&(Pe.set(pe,io),Ao(pe,Zo),gt.set(pe,Zo));continue}if(O.kind==="table_set"){const pe=nn("table",O.target,O.targetExpr,Pe);if(!pe)continue;const ke=Rl.get(pe);if(!ke)continue;if(O.position&&(ke.position=O.position),O.bgcolor&&(ke.bgcolor=O.bgcolor),O.borderColor&&(ke.borderColor=O.borderColor),O.borderWidth!=null||O.borderWidthExpr){const Mt=O.borderWidth??Tn(O.borderWidthExpr,"table.set_border_width",lt);Mt!=null&&(ke.borderWidth=Mt)}if(O.textColor&&(ke.textColor=O.textColor),O.textSize!=null||O.textSizeExpr){const Mt=O.textSize??Tn(O.textSizeExpr,"table.set_text_size",lt);Mt!=null&&(ke.textSize=Mt)}if(O.textHalign&&(ke.textHalign=O.textHalign),O.textValign&&(ke.textValign=O.textValign),O.frameColor&&(ke.frameColor=O.frameColor),O.frameWidth!=null||O.frameWidthExpr){const Mt=O.frameWidth??Tn(O.frameWidthExpr,"table.set_frame_width",lt);Mt!=null&&(ke.frameWidth=Mt)}Za.table.set(pe,Rr),He("table","updated");continue}if(O.kind==="table_delete"){const pe=nn("table",O.target,O.targetExpr,Pe);if(!pe)continue;Rl.delete(pe);const ke=vd.indexOf(pe);ke>=0&&vd.splice(ke,1),cs("table",pe);continue}if(O.kind==="table_clear"){const pe=nn("table",O.target,O.targetExpr,Pe);if(!pe)continue;const ke=Rl.get(pe);if(!ke)continue;if(!(O.startColumn!=null||O.startRow!=null||O.endColumn!=null||O.endRow!=null)){(_s=(oa=ke.cells)==null?void 0:oa.clear)==null||_s.call(oa),ke.merges=[],Za.table.set(pe,Rr),He("table","updated");continue}const Rt=Tn(O.startColumn,"table.clear_start_col",lt),xn=Tn(O.startRow,"table.clear_start_row",lt),Jt=Tn(O.endColumn,"table.clear_end_col",lt),Qn=Tn(O.endRow,"table.clear_end_row",lt);if(Rt==null||xn==null||Jt==null||Qn==null){(Fl=(Gi=ke.cells)==null?void 0:Gi.clear)==null||Fl.call(Gi),ke.merges=[];continue}const io=Math.min(Math.floor(Rt),Math.floor(Jt)),to=Math.max(Math.floor(Rt),Math.floor(Jt)),ho=Math.min(Math.floor(xn),Math.floor(Qn)),Li=Math.max(Math.floor(xn),Math.floor(Qn)),Ms=ke.cells||new Map;for(const Zo of Array.from(Ms.keys())){const[ko,ki]=String(Zo).split(":"),Rs=Number(ko),pi=Number(ki);Rs>=io&&Rs<=to&&pi>=ho&&pi<=Li&&Ms.delete(Zo)}ke.cells=Ms,Array.isArray(ke.merges)&&ke.merges.length&&(ke.merges=ke.merges.filter(Zo=>{if(!Zo)return!1;const ko=Math.min(Zo.left,Zo.right),ki=Math.max(Zo.left,Zo.right),Rs=Math.min(Zo.top,Zo.bottom),pi=Math.max(Zo.top,Zo.bottom);return!(ko<=to&&ki>=io&&Rs<=Li&&pi>=ho)})),Za.table.set(pe,Rr),He("table","updated");continue}if(O.kind==="table_merge"){const pe=nn("table",O.target,O.targetExpr,Pe);if(!pe)continue;const ke=Rl.get(pe);if(!ke)continue;const Mt=Tn(O.left,"table.merge_left",lt),Rt=Tn(O.top,"table.merge_top",lt),xn=Tn(O.right,"table.merge_right",lt),Jt=Tn(O.bottom,"table.merge_bottom",lt);if(Mt==null||Rt==null||xn==null||Jt==null)continue;const Qn=Math.min(Math.floor(Mt),Math.floor(xn)),io=Math.max(Math.floor(Mt),Math.floor(xn)),to=Math.min(Math.floor(Rt),Math.floor(Jt)),ho=Math.max(Math.floor(Rt),Math.floor(Jt));ke.columns=Math.max(ke.columns||1,io+1),ke.rows=Math.max(ke.rows||1,ho+1),Array.isArray(ke.merges)||(ke.merges=[]);const Li=`${Qn}:${to}:${io}:${ho}`;ke.merges.some(Ms=>`${Ms.left}:${Ms.top}:${Ms.right}:${Ms.bottom}`===Li)||ke.merges.push({left:Qn,top:to,right:io,bottom:ho}),Za.table.set(pe,Rr),He("table","updated");continue}if(O.kind==="table_cell"||O.kind==="table_cell_set"){const pe=nn("table",O.target,O.targetExpr,Pe);if(!pe)continue;let ke=Rl.get(pe);if(!ke){const xn=Bi("table",pe);ke={id:pe,position:"top_right",columns:Math.max(1,Math.floor(Number(O.column??0)+1)),rows:Math.max(1,Math.floor(Number(O.row??0)+1)),cells:new Map,merges:[],groupId:xn==null?void 0:xn.groupId,tags:xn==null?void 0:xn.tags},Rl.set(pe,ke),vd.push(pe),T(vd,Rl,Gr,"table")}ke.columns=Math.max(ke.columns||1,Math.floor(Number(O.column??0)+1)),ke.rows=Math.max(ke.rows||1,Math.floor(Number(O.row??0)+1));const Mt=`${O.column??0}:${O.row??0}`,Rt=ke.cells.get(Mt)||{column:Math.floor(Number(O.column??0)),row:Math.floor(Number(O.row??0))};if((O.text!=null||O.textExpr)&&(Rt.text=ui(O.text,O.textExpr,"table.cell_text",lt)),O.textColor&&(Rt.textColor=O.textColor),O.bgcolor&&(Rt.bgcolor=O.bgcolor),O.textSize!=null||O.textSizeExpr){const xn=O.textSize??Tn(O.textSizeExpr,"table.cell_text_size",lt);xn!=null&&(Rt.textSize=xn)}if(O.textHalign&&(Rt.textHalign=O.textHalign),O.textValign&&(Rt.textValign=O.textValign),O.width!=null||O.widthExpr){const xn=O.width??Tn(O.widthExpr,"table.cell_width",lt);xn!=null&&(Rt.width=xn)}if(O.height!=null||O.heightExpr){const xn=O.height??Tn(O.heightExpr,"table.cell_height",lt);xn!=null&&(Rt.height=xn)}(O.tooltip!=null||O.tooltipExpr)&&(Rt.tooltip=ui(O.tooltip,O.tooltipExpr,"table.cell_tooltip",lt)),ke.cells.set(Mt,Rt),Za.table.set(pe,Rr),He("table","updated");continue}if(O.kind==="draw_clear"){const pe=O.filterKind,ke=Yi(O.groupId),Mt=Yi(O.tag),Rt=(xn,Jt,Qn)=>{const io=Array.from(Jt.keys());for(const to of io){const ho=Jt.get(to);if(!bo(xn,to,ho,pe,ke,Mt))continue;Jt.delete(to);const Li=Qn.indexOf(to);Li>=0&&Qn.splice(Li,1),cs(xn,to)}};(!pe||pe==="line")&&Rt("line",Gt,qc),(!pe||pe==="linefill")&&Rt("linefill",eo,Td),(!pe||pe==="label")&&Rt("label",Ss,xd),(!pe||pe==="box")&&Rt("box",La,jd),(!pe||pe==="table")&&Rt("table",Rl,vd),(!pe||pe==="polyline")&&Rt("polyline",pc,Hd),(!pe||pe==="polygon")&&Rt("polygon",nl,Tr),(!pe||pe==="path")&&Rt("path",vc,xl);continue}if(O.kind==="draw_for_each"){const pe=O.updates||{},ke=O.filterKind,Mt=Yi(O.groupId),Rt=Yi(O.tag),xn=ko=>{if(pe.color&&(ko.color=pe.color),pe.width!=null||pe.widthExpr){const ki=pe.width??Tn(pe.widthExpr,"draw.for_each_line_width",lt);ki!=null&&(ko.width=ki)}pe.style&&(ko.style=pe.style),pe.extend&&(ko.extend=pe.extend),pe.xloc&&(ko.xloc=pe.xloc)},Jt=ko=>{if(pe.color&&(ko.color=pe.color),pe.textColor&&(ko.textColor=pe.textColor),(pe.text!=null||pe.textExpr)&&(ko.text=ui(pe.text,pe.textExpr,"draw.for_each_label_text",lt)),pe.textSize!=null||pe.textSizeExpr){const ki=pe.textSize??Tn(pe.textSizeExpr,"draw.for_each_label_size",lt);ki!=null&&(ko.size=ki)}pe.xloc&&(ko.xloc=pe.xloc),pe.wrap!=null&&(ko.wrap=pe.wrap),pe.maxWidth!=null&&(ko.maxWidth=pe.maxWidth),pe.padding!=null&&(ko.padding=pe.padding),pe.bgColor&&(ko.bgColor=pe.bgColor),pe.bgOpacity!=null&&(ko.bgOpacity=pe.bgOpacity),pe.borderColor&&(ko.borderColor=pe.borderColor),pe.borderWidth!=null&&(ko.borderWidth=pe.borderWidth),pe.radius!=null&&(ko.radius=pe.radius),pe.align&&(ko.align=pe.align),pe.valign&&(ko.valign=pe.valign),pe.lineHeight!=null&&(ko.lineHeight=pe.lineHeight),pe.fontFamily&&(ko.fontFamily=pe.fontFamily),pe.fontSize!=null&&(ko.fontSize=pe.fontSize),pe.fontWeight&&(ko.fontWeight=pe.fontWeight),pe.monospace!=null&&(ko.monospace=pe.monospace)},Qn=ko=>{if(pe.bgColor&&(ko.bgColor=pe.bgColor),pe.borderColor&&(ko.borderColor=pe.borderColor),pe.textColor&&(ko.textColor=pe.textColor),(pe.text!=null||pe.textExpr)&&(ko.text=ui(pe.text,pe.textExpr,"draw.for_each_box_text",lt)),pe.textSize!=null||pe.textSizeExpr){const ki=pe.textSize??Tn(pe.textSizeExpr,"draw.for_each_box_text_size",lt);ki!=null&&(ko.textSize=ki)}pe.extend&&(ko.extend=pe.extend),pe.xloc&&(ko.xloc=pe.xloc)},io=ko=>{pe.color&&(ko.color=pe.color)},to=ko=>{if(pe.bgColor&&(ko.bgcolor=pe.bgColor),pe.borderColor&&(ko.borderColor=pe.borderColor),pe.textColor&&(ko.textColor=pe.textColor),pe.textSize!=null||pe.textSizeExpr){const ki=pe.textSize??Tn(pe.textSizeExpr,"draw.for_each_table_text_size",lt);ki!=null&&(ko.textSize=ki)}},ho=ko=>{if(pe.color&&(ko.color=pe.color),pe.width!=null||pe.widthExpr){const ki=pe.width??Tn(pe.widthExpr,"draw.for_each_polyline_width",lt);ki!=null&&(ko.width=ki)}pe.style&&(ko.style=pe.style),pe.opacity!=null&&(ko.opacity=pe.opacity)},Li=ko=>{if(pe.fillColor&&(ko.fillColor=pe.fillColor),pe.color&&(ko.strokeColor=pe.color),pe.borderColor&&(ko.strokeColor=pe.borderColor),pe.width!=null||pe.widthExpr){const ki=pe.width??Tn(pe.widthExpr,"draw.for_each_polygon_width",lt);ki!=null&&(ko.strokeWidth=ki)}pe.opacity!=null&&(ko.opacity=pe.opacity)},Ms=ko=>{if(pe.color&&(ko.color=pe.color),pe.width!=null||pe.widthExpr){const ki=pe.width??Tn(pe.widthExpr,"draw.for_each_path_width",lt);ki!=null&&(ko.width=ki)}pe.style&&(ko.style=pe.style),pe.opacity!=null&&(ko.opacity=pe.opacity)},Zo=(ko,ki,Rs)=>{for(const[pi,Fr]of ki.entries())bo(ko,pi,Fr,ke,Mt,Rt)&&Rs(Fr)};(!ke||ke==="line")&&Zo("line",Gt,xn),(!ke||ke==="linefill")&&Zo("linefill",eo,io),(!ke||ke==="label")&&Zo("label",Ss,Jt),(!ke||ke==="box")&&Zo("box",La,Qn),(!ke||ke==="table")&&Zo("table",Rl,to),(!ke||ke==="polyline")&&Zo("polyline",pc,ho),(!ke||ke==="polygon")&&Zo("polygon",nl,Li),(!ke||ke==="path")&&Zo("path",vc,Ms);continue}}if(s(Zt)){let lt=0;for(const[O,pe]of Ss.entries()){if(lt>=Ja)break;const ke=Cp(pe.x,pe.xloc,{kind:"label",id:O});if(ke==null||ke<0||ke>Hv)continue;const Mt=pe.yloc;let Rt=pe.y;if(Mt==="abovebar"||Mt==="belowbar"){if(ke>=Bt)continue;const to=ve[ke],ho=(to==null?void 0:to.high)??(to==null?void 0:to.h),Li=(to==null?void 0:to.low)??(to==null?void 0:to.l);Mt==="abovebar"&&Number.isFinite(ho)&&(Rt=ho),Mt==="belowbar"&&Number.isFinite(Li)&&(Rt=Li)}if(!Number.isFinite(Rt))continue;const xn=ao[ke]||(ao[ke]={}),Jt=`__label_rt_${ke}_${xi.length}`;xn[Jt]={text:pe.text||"",color:pe.color||"#f97316",yKey:"__rt__",position:Mt==="belowbar"?"below":"above",value:Rt,shape:pe.shape,textColor:pe.textColor,textAlign:pe.textAlign,tooltip:pe.tooltip,size:pe.size,wrap:pe.wrap,maxWidth:pe.maxWidth,padding:pe.padding,bgColor:pe.bgColor,bgOpacity:pe.bgOpacity,borderColor:pe.borderColor,borderWidth:pe.borderWidth,radius:pe.radius,align:pe.align,valign:pe.valign,lineHeight:pe.lineHeight,fontFamily:pe.fontFamily,fontSize:pe.fontSize,fontWeight:pe.fontWeight,monospace:pe.monospace,offsetY:0,layer:pe.layer,zIndex:pe.zIndex,includeInAutoscale:pe.includeInAutoscale};const Qn=((Ta=ve[ke])==null?void 0:Ta.timestamp)??((sa=ve[ke])==null?void 0:sa.time)??((ec=ve[ke])==null?void 0:ec.t),io=typeof Qn=="number"&&Number.isFinite(Qn)?Qn<1e12?Math.floor(Qn*1e3):Math.floor(Qn):void 0;xi.push({index:ke,ts:Qn,tsMs:io,meta:xn[Jt]}),lt+=1}}const Xr=new Map;for(const[lt,O]of Gt.entries()){const pe={kind:"line",id:lt},ke=Cp(O.x1,O.xloc,pe),Mt=Cp(O.x2,O.xloc,pe);if(ke==null||Mt==null||!Number.isFinite(O.y1)||!Number.isFinite(O.y2))continue;const Rt=Mt!==ke?(O.y2-O.y1)/(Mt-ke):void 0,xn=Rt!=null?O.y1-Rt*ke:void 0,Jt={id:lt,startIndex:ke,endIndex:Mt,startValue:O.y1,endValue:O.y2,slope:Rt,intercept:xn,color:O.color,width:O.width,style:O.style,extend:O.extend,layer:O.layer,zIndex:O.zIndex,includeInAutoscale:O.includeInAutoscale};Xr.set(lt,Jt),nf.push(Jt)}for(const lt of eo.values()){if(!lt)continue;const O=Xr.get(lt.line1),pe=Xr.get(lt.line2);!O||!pe||ff.push({line1:O,line2:pe,color:lt.color,layer:lt.layer,zIndex:lt.zIndex,includeInAutoscale:lt.includeInAutoscale})}for(const[lt,O]of La.entries()){const pe={kind:"box",id:lt},ke=Cp(O.left,O.xloc,pe),Mt=Cp(O.right,O.xloc,pe);ke==null||Mt==null||!Number.isFinite(O.top)||!Number.isFinite(O.bottom)||Ev.push({leftIndex:ke,rightIndex:Mt,topValue:O.top,bottomValue:O.bottom,borderColor:O.borderColor,bgColor:O.bgColor,borderWidth:O.borderWidth,borderStyle:O.borderStyle,text:O.text,textColor:O.textColor,textSize:O.textSize,textHalign:O.textHalign,textValign:O.textValign,textWrap:O.textWrap,extend:O.extend,layer:O.layer,zIndex:O.zIndex,includeInAutoscale:O.includeInAutoscale})}for(const[lt,O]of pc.entries()){if(!O||!Array.isArray(O.points))continue;const pe=[];for(const ke of O.points){if(!ke)continue;const Mt=Cp(ke.x,ke.xloc||O.xloc,{kind:"polyline",id:lt});if(Mt==null)continue;const Rt=ke.y;Number.isFinite(Rt)&&pe.push({index:Mt,value:Rt})}pe.length<2||of.push({id:O.id,points:pe,color:O.color,width:O.width,style:O.style,opacity:O.opacity,layer:O.layer,zIndex:O.zIndex,includeInAutoscale:O.includeInAutoscale})}for(const[lt,O]of nl.entries()){if(!O||!Array.isArray(O.points))continue;const pe=[];for(const ke of O.points){if(!ke)continue;const Mt=Cp(ke.x,ke.xloc||O.xloc,{kind:"polygon",id:lt});if(Mt==null)continue;const Rt=ke.y;Number.isFinite(Rt)&&pe.push({index:Mt,value:Rt})}pe.length<3||sf.push({id:O.id,points:pe,fillColor:O.fillColor,strokeColor:O.strokeColor,strokeWidth:O.strokeWidth,strokeStyle:O.strokeStyle,opacity:O.opacity,layer:O.layer,zIndex:O.zIndex,includeInAutoscale:O.includeInAutoscale})}for(const[lt,O]of vc.entries()){if(!O||!Array.isArray(O.commands))continue;const pe=[];for(const ke of O.commands){if(!ke||!ke.cmd)continue;const Mt=Cp(ke.x,ke.xloc||O.xloc,{kind:"path",id:lt});if(Mt==null)continue;const Rt=ke.y;if(!Number.isFinite(Rt))continue;const xn=String(ke.cmd||"").toUpperCase();xn!=="M"&&xn!=="L"||pe.push({cmd:xn,index:Mt,value:Rt})}pe.length&&Aa.push({id:O.id,commands:pe,color:O.color,width:O.width,style:O.style,opacity:O.opacity,layer:O.layer,zIndex:O.zIndex,includeInAutoscale:O.includeInAutoscale})}for(const lt of Rl.values()){const O=[];(lt.cells||new Map).forEach(ke=>{O.push({column:Math.floor(Number(ke.column??0)),row:Math.floor(Number(ke.row??0)),text:ke.text||"",textColor:ke.textColor,bgcolor:ke.bgcolor,textSize:ke.textSize,textHalign:ke.textHalign,textValign:ke.textValign,width:ke.width,height:ke.height,tooltip:ke.tooltip})}),vm.push({id:lt.id,position:lt.position,columns:Math.max(1,Math.floor(Number(lt.columns??1))),rows:Math.max(1,Math.floor(Number(lt.rows??1))),bgcolor:lt.bgcolor,borderColor:lt.borderColor,textColor:lt.textColor,frameColor:lt.frameColor,borderWidth:lt.borderWidth,frameWidth:lt.frameWidth,textSize:lt.textSize,textHalign:lt.textHalign,textValign:lt.textValign,cells:O,merges:Array.isArray(lt.merges)?lt.merges:[],layer:lt.layer,zIndex:lt.zIndex,includeInAutoscale:lt.includeInAutoscale})}}if(s(Zt)&&ss.length)for(const Ae of ss){if(!Ae||!Ae.x||!Ae.y)continue;const gt=String(Ae.when||"").trim();let He=null;if(gt)try{He=fa(gt,gi)}catch{He=null}const ht=pp(String(Ae.x)),It=pp(String(Ae.y));if(!ht||!It)continue;const Ot=qf(He,300),lo=Ae.textExpr?String(Ae.textExpr):"",sn=lo?Iu(lo):null,Ao=Ae.colorExpr?String(Ae.colorExpr):"",Cn=Ao?Iu(Ao):null,Jn=Ae.textColorExpr?String(Ae.textColorExpr):"",nn=Jn?Iu(Jn):null,us=Ae.sizeExpr?String(Ae.sizeExpr):"",Tn=us?pp(us):null,ui=$u(Ae.layer),Hs=Pp(Ae.zIndex),da=rp(Ae.includeInAutoscale);for(const Yi of Ot){const Bi=ht[Yi],bo=Cp(Bi,Ae.xloc,{kind:"runtime_label",id:Yi});if(bo==null||bo<0||bo>Hv)continue;let b=It[Yi];if(Ae.yloc==="abovebar"||Ae.yloc==="belowbar"){if(bo>=Bt)continue;const gn=ve[bo],cn=(gn==null?void 0:gn.high)??(gn==null?void 0:gn.h),Gt=(gn==null?void 0:gn.low)??(gn==null?void 0:gn.l);Ae.yloc==="abovebar"&&Number.isFinite(cn)&&(b=cn),Ae.yloc==="belowbar"&&Number.isFinite(Gt)&&(b=Gt)}if(!Number.isFinite(b))continue;const k=Ae.text!=null?String(Ae.text):sn?String(sn[Yi]??""):"",T=Cn&&Cn[Yi]!=null&&String(Cn[Yi]).trim()?String(Cn[Yi]):Ae.color||"#f97316",A=nn&&nn[Yi]!=null&&String(nn[Yi]).trim()?String(nn[Yi]):Ae.textColor,$=Tn?Tn[Yi]:NaN,E=Number.isFinite($)?$:Ae.size,Q=ao[bo]||(ao[bo]={}),ie=`__label_rt_${bo}_${xi.length}`;Q[ie]={text:k,color:T,yKey:"__rt__",position:Ae.yloc==="belowbar"?"below":"above",value:b,shape:Ae.shape,textColor:A,textAlign:Ae.textAlign,tooltip:Ae.tooltip,size:E,offsetY:0,layer:ui,zIndex:Hs,includeInAutoscale:da,wrap:Ae.wrap,maxWidth:Ae.maxWidth,padding:Ae.padding,bgColor:Ae.bgColor,bgOpacity:Ae.bgOpacity,borderColor:Ae.borderColor,borderWidth:Ae.borderWidth,radius:Ae.radius,align:Ae.align,valign:Ae.valign,lineHeight:Ae.lineHeight,fontFamily:Ae.fontFamily,fontSize:Ae.fontSize,fontWeight:Ae.fontWeight,monospace:Ae.monospace};const Pe=((Dr=ve[bo])==null?void 0:Dr.timestamp)??((Ul=ve[bo])==null?void 0:Ul.time)??((Wc=ve[bo])==null?void 0:Wc.t),rt=typeof Pe=="number"&&Number.isFinite(Pe)?Pe<1e12?Math.floor(Pe*1e3):Math.floor(Pe):void 0;xi.push({index:bo,ts:Pe,tsMs:rt,meta:Q[ie]})}}Pl.__labelItems=xi,Pl.__tsIndex=pd;const ap=[];if(ds.length)for(const Ae of ds){if(!Ae)continue;const gt=String(Ae.when||"").trim();let He=null;if(gt)try{He=fa(gt,gi)}catch{He=null}const ht=pp(String(Ae.x1)),It=pp(String(Ae.y1)),Ot=pp(String(Ae.x2)),lo=pp(String(Ae.y2));if(!ht||!It||!Ot||!lo)continue;const sn=qf(He,240),Ao=Ae.colorExpr?String(Ae.colorExpr):"",Cn=Ao?Iu(Ao):null,Jn=Ae.widthExpr||Ae.sizeExpr,nn=Jn?String(Jn):"",us=nn?pp(nn):null;for(const Tn of sn){const ui={kind:"runtime_line",id:Tn},Hs=Cp(ht[Tn],Ae.xloc,ui),da=Cp(Ot[Tn],Ae.xloc,ui);if(Hs==null||da==null)continue;const Yi=It[Tn],Bi=lo[Tn];if(!Number.isFinite(Yi)||!Number.isFinite(Bi))continue;const bo=da!==Hs?(Bi-Yi)/(da-Hs):void 0,cs=bo!=null?Yi-bo*Hs:void 0,b=Cn&&Cn[Tn]!=null&&String(Cn[Tn]).trim()?String(Cn[Tn]):Ae.color,k=us?us[Tn]:NaN,T=Number.isFinite(k)?k:Ae.width;ap.push({startIndex:Hs,endIndex:da,startValue:Yi,endValue:Bi,slope:bo,intercept:cs,color:b,width:T,style:Ae.style,extend:Ae.extend,layer:$u(Ae.layer),zIndex:Pp(Ae.zIndex),includeInAutoscale:rp(Ae.includeInAutoscale)})}}const Hf=[];if(yn.length)for(const Ae of yn){if(!Ae)continue;const gt=String(Ae.when||"").trim();let He=null;if(gt)try{He=fa(gt,gi)}catch{He=null}const ht=pp(String(Ae.left)),It=pp(String(Ae.right)),Ot=pp(String(Ae.top)),lo=pp(String(Ae.bottom)),sn=Ae.textExpr?String(Ae.textExpr):"",Ao=sn?Iu(sn):null,Cn=Ae.bgColorExpr?String(Ae.bgColorExpr):"",Jn=Cn?Iu(Cn):null,nn=Ae.borderColorExpr?String(Ae.borderColorExpr):"",us=nn?Iu(nn):null,Tn=Ae.textColorExpr?String(Ae.textColorExpr):"",ui=Tn?Iu(Tn):null,Hs=Ae.borderWidthExpr||Ae.sizeExpr,da=Hs?String(Hs):"",Yi=da?pp(da):null;if(!ht||!It||!Ot||!lo)continue;const Bi=qf(He,180);for(const bo of Bi){const cs={kind:"runtime_box",id:bo},b=Cp(ht[bo],Ae.xloc,cs),k=Cp(It[bo],Ae.xloc,cs);if(b==null||k==null)continue;const T=Ot[bo],A=lo[bo];if(!Number.isFinite(T)||!Number.isFinite(A))continue;const $=Ae.text!=null?String(Ae.text):Ao?String(Ao[bo]??""):"",E=Jn&&Jn[bo]!=null&&String(Jn[bo]).trim()?String(Jn[bo]):Ae.bgColor,Q=us&&us[bo]!=null&&String(us[bo]).trim()?String(us[bo]):Ae.borderColor,ie=ui&&ui[bo]!=null&&String(ui[bo]).trim()?String(ui[bo]):Ae.textColor,Pe=Yi?Yi[bo]:NaN,rt=Number.isFinite(Pe)?Pe:Ae.borderWidth;Hf.push({leftIndex:b,rightIndex:k,topValue:T,bottomValue:A,borderColor:Q,bgColor:E,borderWidth:rt,borderStyle:Ae.borderStyle,text:$,textColor:ie,textSize:Ae.textSize,textHalign:Ae.textHalign,textValign:Ae.textValign,textWrap:Ae.textWrap,extend:Ae.extend,layer:$u(Ae.layer),zIndex:Pp(Ae.zIndex),includeInAutoscale:rp(Ae.includeInAutoscale)})}}const Em=[];if(wo.length){const et=Math.max(0,Bt-1);for(const Ae of wo){if(!Ae)continue;const gt=Math.max(1,Math.floor(Number(Ae.columns??1))),He=Math.max(1,Math.floor(Number(Ae.rows??1))),ht=[],It=Array.isArray(Ae.cells)?Ae.cells:[];for(const Ot of It){if(!Ot)continue;const lo=String(Ot.when||"").trim();if(lo)try{if(!fa(lo,gi)[et])continue}catch{}let sn="";if(Ot.text!=null)sn=String(Ot.text);else if(Ot.textExpr){const Cn=Iu(String(Ot.textExpr));sn=Cn?String(Cn[et]??""):""}const Ao=Ot.tooltip!=null?String(Ot.tooltip):Ot.tooltipExpr?evalTextAt(void 0,String(Ot.tooltipExpr),"table.tooltip",et):void 0;ht.push({column:Math.floor(Number(Ot.column??0)),row:Math.floor(Number(Ot.row??0)),text:sn,textColor:Ot.textColor,bgcolor:Ot.bgcolor,textSize:Ot.textSize,textHalign:Ot.textHalign,textValign:Ot.textValign,width:Ot.width,height:Ot.height,tooltip:Ao})}Em.push({id:Ae.id,position:Ae.position,columns:gt,rows:He,bgcolor:Ae.bgcolor,borderColor:Ae.borderColor,textColor:Ae.textColor,frameColor:Ae.frameColor,borderWidth:Ae.borderWidth,frameWidth:Ae.frameWidth,textSize:Ae.textSize,textHalign:Ae.textHalign,textValign:Ae.textValign,cells:ht,merges:Array.isArray(Ae.merges)?Ae.merges:[],layer:$u(Ae.layer),zIndex:Pp(Ae.zIndex),includeInAutoscale:rp(Ae.includeInAutoscale)})}}const mf=ap.length||nf.length?ap.concat(nf):[],Uf=ff.length?ff:[],Ff=Hf.length||Ev.length?Hf.concat(Ev):[],cg=of.length?of:[],xg=sf.length?sf:[],Nm=Aa.length?Aa:[],kv=Em.length||vm.length?Em.concat(vm):[];if(Pl.__runtimeLineDefs=mf,Pl.__runtimeLineFills=Uf,Pl.__runtimeBoxDefs=Ff,Pl.__runtimePolylineDefs=cg,Pl.__runtimePolygonDefs=xg,Pl.__runtimePathDefs=Nm,Pl.__runtimeTables=kv,Uv&&Gv&&q.set(Uv,Gv),Array.isArray(jl)&&jl.length){let et=[];const Ae=gt=>{const He=[];for(let ht=Bt-1;ht>=0&&He.length<2;(ht-=1)+1){const It=gt[ht];It!=null&&Number.isFinite(It)&&He.push(ht)}return He.reverse()};if(jl.forEach(gt=>{const He=String(gt.colorExpr||"").trim(),ht=He?ou(He):null,It=String(gt.widthExpr||gt.sizeExpr||"").trim(),Ot=It?Fu(It):null,lo=String(gt.start||"").replace(/\s+/g,"_").toLowerCase(),sn=String(gt.end||"").replace(/\s+/g,"_").toLowerCase();let Cn=gu[lo]||gu[sn]||"";Cn||(/low/i.test(lo)||/low/i.test(sn)?Cn="pl":(/high/i.test(lo)||/high/i.test(sn))&&(Cn="ph"));const nn=(gt.segmentsFrom?String(gt.segmentsFrom):"").replace(/\s+/g,"_").toLowerCase(),us=pr[Cn],Tn=nn&&pr[nn]||void 0,ui=Tn||us||pr.ph||pr.pl;if(ui)if(Tn){const Hs=[];for(let bo=0;bo<Bt;(bo+=1)-1){const cs=Tn[bo];cs!=null&&Number.isFinite(cs)&&Hs.push(bo)}const da=Math.max(1,Number(gt.maxSegments)||Hs.length-1),Yi=Math.min(da,24);let Bi=0;for(let bo=Hs.length-2;bo>=0&&!(Bi>=Yi);(bo-=1)+1){const cs=Hs[bo],b=Hs[bo+1],k=Tn[cs],T=Tn[b];if(!Number.isFinite(k)||!Number.isFinite(T)||b===cs)continue;const A=(T-k)/(b-cs),$=k-A*cs;let E=!1;const Q=Math.max(cs,Bt-80);let ie=NaN;for(let Pe=Q;Pe<=Math.min(b,Bt-1);(Pe+=1)-1){const rt=A*Pe+$,gn=pr.close[Pe];if(!Number.isFinite(rt)||!Number.isFinite(gn))continue;const cn=gn-rt;if(!Number.isNaN(ie)&&cn*ie<0){E=!0;break}ie=cn}E||(et.push({startIndex:cs,endIndex:b,startValue:k,endValue:T,slope:A,intercept:$,color:Ad(ht,b,gt.color||"#64748b"),width:Xd(Ot,b,gt.width??1),style:(gt.style||"dotted").toLowerCase(),extend:gt.extend||"right",name:gt.name}),Bi+=1)}}else{const Hs=Ae(ui);if(Hs.length===2){const da=Hs[0],Yi=Hs[1],Bi=ui[da],bo=ui[Yi];if(Number.isFinite(Bi)&&Number.isFinite(bo)){const cs=(bo-Bi)/(Yi-da),b=Bi-cs*da;let k=!1;const T=Math.max(da,Bt-80);let A=NaN;for(let $=T;$<=Math.min(Yi,Bt-1);($+=1)-1){const E=cs*$+b,Q=pr.close[$];if(!Number.isFinite(E)||!Number.isFinite(Q))continue;const ie=Q-E;if(!Number.isNaN(A)&&ie*A<0){k=!0;break}A=ie}if(k)return;et.push({startIndex:da,endIndex:Yi,startValue:Bi,endValue:bo,slope:cs,intercept:b,color:Ad(ht,Yi,gt.color||"#22c55e"),width:Xd(Ot,Yi,gt.width??2),style:(gt.style||"solid").toLowerCase(),extend:gt.extend||"none",name:gt.name})}}}}),et.length){const gt=[],He=new Set;for(const ht of et){const It=Math.round((ht.slope||0)*1e4),Ot=Math.round((ht.intercept||0)*100),lo=`${It}:${Ot}:${ht.style}:${ht.color}:${ht.extend}`;He.has(lo)||(He.add(lo),gt.push(ht))}et=gt.slice(0,60)}if(!et.length){const gt=(He,ht,It,Ot)=>{const lo=String(He||"").replace(/\s+/g,"_").toLowerCase(),sn=pr[lo];if(!sn)return;const Ao=[];for(let Cn=0;Cn<Bt;(Cn+=1)-1){const Jn=sn[Cn];Jn!=null&&Number.isFinite(Jn)&&Ao.push(Cn)}if(Ao.length>=2){const Cn=Ao[Ao.length-2],Jn=Ao[Ao.length-1],nn=sn[Cn],us=sn[Jn];if(Number.isFinite(nn)&&Number.isFinite(us)&&Jn!==Cn){const Tn=(us-nn)/(Jn-Cn),ui=nn-Tn*Cn;et.push({startIndex:Cn,endIndex:Jn,startValue:nn,endValue:us,slope:Tn,intercept:ui,color:ht,width:Ot,style:It,extend:"right",name:lo})}}};gt("ph","#64748b","dotted",1),gt("pl","#64748b","dotted",1)}Pl.__lineDefs=et}if($p&&(ys.length||B!=null&&B.strategy)){const et=Gc;try{const Ae=ve.map(It=>({timestamp:It.timestamp??It.time??0})),gt=ys.map(It=>({...It,when:cd(String((It==null?void 0:It.when)||"")),frequency:It==null?void 0:It.frequency,cooldownBars:typeof(It==null?void 0:It.cooldownBars)=="number"&&Number.isFinite(It.cooldownBars)?Math.max(0,Math.floor(It.cooldownBars)):void 0}));gt.forEach((It,Ot)=>{!It||It.id!=null||(It.id=String(Ot))});const He=(It,Ot)=>{var ol;let lo=new Array(Ot).fill(0),sn=new Array(Ot).fill(0),Ao=new Array(Ot).fill(0),Cn=new Array(Ot).fill(0),Jn=new Array(Ot).fill(0),nn=new Array(Ot).fill(0),us=new Array(Ot).fill(0),Tn=new Array(Ot).fill(0),ui=new Array(Ot).fill(0),Hs=new Array(Ot).fill(0),da=new Array(Ot).fill(0),Yi=new Array(Ot).fill(0),Bi=new Array(Ot).fill(0),bo=new Array(Ot).fill(0),cs=new Array(Ot).fill(0),b=new Array(Ot).fill(0),k=new Array(Ot).fill(0),T=new Array(Ot).fill(0),A=new Array(Ot).fill(0);const $=((ol=It==null?void 0:It.summary)==null?void 0:ol.initialCapital)??0;let E=new Array(Ot).fill($),Q=new Array(Ot).fill(0);if(!It)return{positionSize:lo,positionAvgPrice:sn,openTrades:Ao,closedTrades:Cn,openProfit:Jn,closedProfit:nn,grossProfit:us,grossLoss:Tn,winTrades:ui,lossTrades:Hs,winRate:da,maxDrawdownPct:Yi,maxDrawdownValue:Bi,maxRunupPct:bo,maxRunupValue:cs,avgTrade:b,avgWin:k,avgLoss:T,avgBarsInTrade:A,equity:E,netProfit:Q,initialCapital:$};const ie=It==null?void 0:It.series,Pe=Lr=>Array.isArray(Lr)&&Lr.length===Ot?Lr:null,rt=Pe(ie==null?void 0:ie.positionSize),gn=Pe(ie==null?void 0:ie.positionAvgPrice),cn=Pe(ie==null?void 0:ie.openTrades),Gt=Pe(ie==null?void 0:ie.closedTrades),eo=Pe(ie==null?void 0:ie.openProfit),Ss=Pe(ie==null?void 0:ie.closedProfit),La=Pe(ie==null?void 0:ie.grossProfit),Rl=Pe(ie==null?void 0:ie.grossLoss),pc=Pe(ie==null?void 0:ie.winTrades),nl=Pe(ie==null?void 0:ie.lossTrades),vc=Pe(ie==null?void 0:ie.winRate),qc=Pe(ie==null?void 0:ie.maxDrawdownPct),Td=Pe(ie==null?void 0:ie.maxDrawdownValue),xd=Pe(ie==null?void 0:ie.maxRunupPct),jd=Pe(ie==null?void 0:ie.maxRunupValue),vd=Pe(ie==null?void 0:ie.avgTrade),Hd=Pe(ie==null?void 0:ie.avgWin),Tr=Pe(ie==null?void 0:ie.avgLoss),xl=Pe(ie==null?void 0:ie.avgBarsInTrade),Za=Pe(ie==null?void 0:ie.equity),jr=Pe(ie==null?void 0:ie.netProfit);if(rt&&(lo=rt),gn&&(sn=gn),cn&&(Ao=cn),Gt&&(Cn=Gt),eo&&(Jn=eo),Ss&&(nn=Ss),La&&(us=La),Rl&&(Tn=Rl),pc&&(ui=pc),nl&&(Hs=nl),vc&&(da=vc),qc&&(Yi=qc),Td&&(Bi=Td),xd&&(bo=xd),jd&&(cs=jd),vd&&(b=vd),Hd&&(k=Hd),Tr&&(T=Tr),xl&&(A=xl),Za&&(E=Za),jr&&(Q=jr),!rt){const Lr=new Array(Ot);for(const Di of It.orders||[]){if(!Di||Di.status!=="filled")continue;const Ha=Di==null?void 0:Di.filledIndex,Ns=typeof Ha=="number"&&Number.isFinite(Ha)?Math.floor(Ha):-1;if(Ns<0||Ns>=Ot)continue;const Cr=Di==null?void 0:Di.fillQty,Xa=typeof Cr=="number"?Cr:Number(Cr);if(!Number.isFinite(Xa)||Xa===0)continue;const Ur=String((Di==null?void 0:Di.side)||"").toLowerCase(),Ja=String((Di==null?void 0:Di.action)||"").toLowerCase();let Gl=0;Ja==="entry"?Gl=Ur==="short"?-Xa:Xa:Ja==="exit"&&(Gl=Ur==="short"?Xa:-Xa),!(!Number.isFinite(Gl)||Gl===0)&&(Lr[Ns]||(Lr[Ns]=[]),Lr[Ns].push(Gl))}let ii=0;for(let Di=0;Di<Ot;(Di+=1)-1){const Ha=Lr[Di];if(Ha)for(const Ns of Ha)ii+=Ns;lo[Di]=ii}}if(!cn||!Gt){const Lr=new Int32Array(Ot+1),ii=new Int32Array(Ot+1);for(const Ns of It.roundTrips||[]){const Cr=typeof Ns.entryIndex=="number"&&Number.isFinite(Ns.entryIndex)?Math.max(0,Math.floor(Ns.entryIndex)):-1,Xa=typeof Ns.exitIndex=="number"&&Number.isFinite(Ns.exitIndex)?Math.max(0,Math.floor(Ns.exitIndex)):-1;Cr>=0&&Cr<Ot&&(Lr[Cr]+=1),Xa>=0&&Xa<Ot&&(Lr[Xa]-=1,ii[Xa]+=1)}let Di=0,Ha=0;for(let Ns=0;Ns<Ot;(Ns+=1)-1){Di+=Lr[Ns],Ha+=ii[Ns];const Cr=lo[Ns]!==0;cn||(Ao[Ns]=Di>0?Di:Cr?1:0),Gt||(Cn[Ns]=Ha)}}if(!Za&&Array.isArray(It.equity)&&It.equity.length){for(const ii of It.equity){const Di=Number(ii==null?void 0:ii.index),Ha=Number(ii==null?void 0:ii.equity);!Number.isFinite(Di)||Di<0||Di>=Ot||Number.isFinite(Ha)&&(E[Math.floor(Di)]=Ha)}let Lr=E[0];for(let ii=0;ii<Ot;(ii+=1)-1){const Di=E[ii];if(!Number.isFinite(Di)){E[ii]=Lr;continue}Lr=Di}}if(!jr)for(let Lr=0;Lr<Ot;(Lr+=1)-1){const ii=E[Lr];Q[Lr]=Number.isFinite(ii)?ii-$:NaN}if(!vc)for(let Lr=0;Lr<Ot;(Lr+=1)-1){const ii=Cn[Lr]??0,Di=ui[Lr]??0;da[Lr]=ii>0?Di/ii*100:0}if(!qc){let Lr=$;for(let ii=0;ii<Ot;(ii+=1)-1){const Di=E[ii];if(Number.isFinite(Di)&&(Di>Lr&&(Lr=Di),Lr>0)){const Ha=(Lr-Di)/Lr;Yi[ii]=Math.max(Yi[ii],Ha*100)}}}return{positionSize:lo,positionAvgPrice:sn,openTrades:Ao,closedTrades:Cn,openProfit:Jn,closedProfit:nn,grossProfit:us,grossLoss:Tn,winTrades:ui,lossTrades:Hs,winRate:da,maxDrawdownPct:Yi,maxDrawdownValue:Bi,maxRunupPct:bo,maxRunupValue:cs,avgTrade:b,avgWin:k,avgLoss:T,avgBarsInTrade:A,equity:E,netProfit:Q,initialCapital:$}},ht=It=>{if(!It)return;if(Array.isArray(It==null?void 0:It.errors)&&It.errors.length){const Cn=It.errors.slice(0,4).map(Jn=>String(Jn)).join(" • ");x(ue,N(s(ue)?`${s(ue)} • ${Cn}`:Cn)),(!s(Ne)||s(Ne)==="Plotted from Pine"||s(Ne)==="Plotted from DSL")&&x(Ne,"Signals error")}const Ot=new Map;gt.forEach((Cn,Jn)=>{Ot.set(String((Cn==null?void 0:Cn.id)??Jn),Cn)});const lo=(Cn,Jn,nn)=>{if(typeof Cn=="number"&&Number.isFinite(Cn))return Cn;if(typeof Cn=="string"){const us=Cn.replace(/\s+/g,"_").toLowerCase(),Tn=gi==null?void 0:gi[us],ui=Tn?Tn[Jn]:NaN;if(Number.isFinite(ui))return ui;const Hs=Number(Cn);if(Number.isFinite(Hs))return Hs}return nn},sn=(Cn,Jn)=>{if(typeof Cn=="number"&&Number.isFinite(Cn))return Cn;if(typeof Cn=="string"){const nn=Cn.replace(/\s+/g,"_").toLowerCase(),us=gi==null?void 0:gi[nn],Tn=us?us[Jn]:NaN;if(Number.isFinite(Tn))return Tn;const ui=Number(Cn);if(Number.isFinite(ui))return ui}},Ao=(It.signals||[]).map(Cn=>{const Jn=Ot.get(String((Cn==null?void 0:Cn.signalId)??""))||null,nn=(Jn==null?void 0:Jn.order)||null;if(!nn)return{...Cn,orderId:(Jn==null?void 0:Jn.orderId)??(Cn==null?void 0:Cn.orderId),title:Jn==null?void 0:Jn.title,message:Jn==null?void 0:Jn.message,frequency:Jn==null?void 0:Jn.frequency};const us=String(nn.kind||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit"),Tn=gi==null?void 0:gi.close,ui=Tn?Tn[Cn.index]:NaN,Hs=Number.isFinite(ui)?ui:0,da=eo=>{const Ss=typeof eo=="string"?eo.trim():"";return Ss||void 0},Yi=eo=>{const Ss=typeof eo=="number"?eo:Number(eo);if(!(!Number.isFinite(Ss)||Ss<=0))return Math.floor(Ss)},Bi=(eo,Ss,La)=>{if(typeof eo=="number"&&Number.isFinite(eo))return eo;if(typeof eo=="string")return lo(eo,Ss,La)},bo=us==="limit"||us==="stop"?lo(nn.price,Cn.index,Hs):void 0,cs=nn.stopPrice??nn.stop??nn.trigger,b=nn.limitPrice??nn.limit??nn.lmt,k=nn.qty??nn.quantity,T=nn.cash,A=sn(k,Cn.index),$=sn(T,Cn.index),E=nn.commissionPct??nn.commission,Q=nn.slippagePct??nn.slippage,ie=sn(E,Cn.index),Pe=sn(Q,Cn.index),rt=us==="stop_limit"?Bi(cs??nn.price,Cn.index,Hs):void 0,gn=us==="stop_limit"?Bi(b??nn.price,Cn.index,Hs):void 0,cn=nn==null?void 0:nn.bracket,Gt=cn&&typeof cn=="object"?{stopLossPct:typeof cn.stopLossPct=="number"?cn.stopLossPct:Number(cn.stopLossPct),takeProfitPct:typeof cn.takeProfitPct=="number"?cn.takeProfitPct:Number(cn.takeProfitPct),trailingStopPct:typeof cn.trailingStopPct=="number"?cn.trailingStopPct:Number(cn.trailingStopPct),takeProfits:Array.isArray(cn.takeProfits)?cn.takeProfits.map(eo=>({takeProfitPct:typeof(eo==null?void 0:eo.takeProfitPct)=="number"?eo.takeProfitPct:Number(eo==null?void 0:eo.takeProfitPct),qtyPct:typeof(eo==null?void 0:eo.qtyPct)=="number"?eo.qtyPct:Number(eo==null?void 0:eo.qtyPct)})).filter(eo=>Number.isFinite(eo.takeProfitPct)&&eo.takeProfitPct>0&&Number.isFinite(eo.qtyPct)&&eo.qtyPct>0):void 0}:void 0;return{...Cn,orderId:(Jn==null?void 0:Jn.orderId)??(Cn==null?void 0:Cn.orderId),title:Jn==null?void 0:Jn.title,message:Jn==null?void 0:Jn.message,frequency:Jn==null?void 0:Jn.frequency,order:{kind:us,price:bo,stopPrice:rt,limitPrice:gn,qty:A,cash:$,commissionPct:ie,slippagePct:Pe,qtyPct:nn.qtyPct==null?void 0:Math.max(0,Math.min(100,Number(nn.qtyPct)||0)),oco:da(nn.oco),expiresBars:Yi(nn.expiresBars),bracket:Gt}}});bK(et,Ao);try{const Cn=gt.filter(nn=>String((nn==null?void 0:nn.type)||"")==="alert").map(nn=>({id:String((nn==null?void 0:nn.id)??""),title:nn==null?void 0:nn.title,message:nn==null?void 0:nn.message,frequency:nn==null?void 0:nn.frequency})).filter(nn=>nn.id);Cn.length&&pF(Cn);const Jn=Ao.filter(nn=>String((nn==null?void 0:nn.type)||"")==="alert");if(Jn.length){const nn=Ae.length?Ae.length-1:0,us=gi==null?void 0:gi.close,Tn=us&&us.length?us[nn]:void 0;(async()=>{var Hs,da,Yi,Bi,bo,cs;const ui=await hF({events:Jn.map(b=>({signalId:b.signalId,title:b.title,message:b.message,frequency:b.frequency,index:b.index,timestamp:b.timestamp})),context:{symbol:((da=(Hs=o())==null?void 0:Hs.symbol)==null?void 0:da.ticker)||((Bi=(Yi=o())==null?void 0:Yi.symbol)==null?void 0:Bi.name),timeframe:(cs=(bo=o())==null?void 0:bo.period)==null?void 0:cs.timeframe,price:Number.isFinite(Tn)?Tn:void 0,latestIndex:nn}});for(const b of ui){const k=b.deliveries.find(T=>T.channel==="app");if(k&&k.status==="pending"){const T=b.message||b.title||"Alert fired";Ye.addAlert("info",T,4)}}for(const b of ui){if(!b.deliveries.some(T=>T.status==="pending"))continue;const k=await $w(b);Ew(b.id,k)}})()}}catch{}try{const Cn=(B==null?void 0:B.strategy)??null,Jn=Cn===!0?{enabled:!0}:Cn,nn=Jn&&typeof Jn=="object"?{...Jn}:Jn,us=jt&&typeof jt=="object"?nn&&typeof nn=="object"?{...nn,...jt}:{...jt}:nn,Tn=AK(us);if(Tn){const ui=bo=>{const cs=typeof bo=="number"?bo:Number(bo);return Number.isFinite(cs)?cs:void 0},Hs=ve.map((bo,cs)=>{const b=(bo==null?void 0:bo.timestamp)??(bo==null?void 0:bo.time)??0,k=typeof b=="number"?b:Number(b),T=ui(bo==null?void 0:bo.close);return{index:cs,timestamp:Number.isFinite(k)?k:0,open:ui(bo==null?void 0:bo.open),high:ui(bo==null?void 0:bo.high),low:ui(bo==null?void 0:bo.low),close:T??NaN}}),da=Ao.filter(bo=>{const cs=String((bo==null?void 0:bo.type)||"");return cs==="entry_long"||cs==="exit_long"||cs==="entry_short"||cs==="exit_short"||cs==="cancel"||cs==="cancel_all"}),Yi=LK(Hs,da,Tn);PK(et,Yi);const Bi=He(Yi,Hs.length);Qs.set(Wl,{positionSize:Bi.positionSize,positionAvgPrice:Bi.positionAvgPrice,openTrades:Bi.openTrades,closedTrades:Bi.closedTrades,openProfit:Bi.openProfit,closedProfit:Bi.closedProfit,grossProfit:Bi.grossProfit,grossLoss:Bi.grossLoss,winTrades:Bi.winTrades,lossTrades:Bi.lossTrades,winRate:Bi.winRate,maxDrawdownPct:Bi.maxDrawdownPct,maxDrawdownValue:Bi.maxDrawdownValue,maxRunupPct:Bi.maxRunupPct,maxRunupValue:Bi.maxRunupValue,avgTrade:Bi.avgTrade,avgWin:Bi.avgWin,avgLoss:Bi.avgLoss,avgBarsInTrade:Bi.avgBarsInTrade,equity:Bi.equity,netProfit:Bi.netProfit,initialCapital:Bi.initialCapital}),Yi.accessors?Fs.set(Wl,Yi.accessors):Fs.delete(Wl),ms+=1,Wo||(Wo=!0,tn.request(()=>{var bo,cs;try{const b=((bo=Oe.getDataList)==null?void 0:bo.call(Oe))||[];(cs=Oe.applyNewData)==null||cs.call(Oe,b,!1)}catch{}}))}else b2(et),Qs.delete(Wl),Fs.delete(Wl)}catch(Cn){console.error("[ScriptStudio] backtest error",Cn)}try{y2("signals",{id:It.id,signals:It.signals})}catch{}};if(!gt.length)ht({id:et,signals:[]});else{const It=`${Ae.length}:${((uu=Ae[Ae.length-1])==null?void 0:uu.timestamp)??0}:${gt.map(lo=>`${String((lo==null?void 0:lo.type)||"")}:${String((lo==null?void 0:lo.whenExpr)||"")}:${String((lo==null?void 0:lo.when)||"")}`).join("|")}`;let Ot=!1;if(_t!==gp){try{const lo=[],sn=Ae.length,Ao=new Map,Cn=new Map,Jn=us=>{const Tn=Nl(String(us||"").replace(/\$\{([^}]+)\}/g,(Hs,da)=>String(rr[da]??Hs)));if(!Tn)return null;const ui=Ao.get(Tn);if(ui)return ui;try{const Hs=H0(Tn,gi,rr,Fs.get(Wl));return Ao.set(Tn,Hs),Hs}catch{return null}},nn=us=>{const Tn=Nl(String(us||"").replace(/\$\{([^}]+)\}/g,(Yi,Bi)=>String(rr[Bi]??Yi)));if(!Tn)return null;const ui=Cn.get(Tn);if(ui)return ui;const Hs=Jn(us);if(!Hs)return null;const da=new Uint8Array(sn);for(let Yi=0;Yi<sn;(Yi+=1)-1){const Bi=Hs[Yi];da[Yi]=Number.isFinite(Bi)&&Bi!==0?1:0}return Cn.set(Tn,da),da};for(let us=0;us<gt.length;(us+=1)-1){const Tn=gt[us],ui=String((Tn==null?void 0:Tn.type)||"");if(ui!=="entry_long"&&ui!=="exit_long"&&ui!=="entry_short"&&ui!=="exit_short"&&ui!=="alert"&&ui!=="cancel"&&ui!=="cancel_all")continue;const Hs=String((Tn==null?void 0:Tn.id)??us),da=(Tn==null?void 0:Tn.orderId)!=null&&String(Tn.orderId).trim()?String(Tn.orderId).trim():void 0,Yi=String((Tn==null?void 0:Tn.whenExpr)||"").trim(),Bi=String((Tn==null?void 0:Tn.when)||"").trim();if(!Yi&&!Bi)continue;const bo=Yi?nn(Yi):fa(Bi,gi);if(!bo)continue;const cs=String((Tn==null?void 0:Tn.cooldownExpr)||"").trim(),b=cs?Jn(cs):null;if(b)for(let Pe=0;Pe<sn;(Pe+=1)-1){const rt=b[Pe];if(Number.isFinite(rt)&&(!Number.isInteger(rt)||rt<0))throw new Error("cooldownExpr must be a non-negative integer")}const k=Tn==null?void 0:Tn.cooldownBars,T=typeof k=="number"&&Number.isFinite(k)?Math.max(0,Math.floor(k)):0,A=String((Tn==null?void 0:Tn.scoreExpr)||"").trim(),$=A?Jn(A):null;if($)for(let Pe=0;Pe<sn;(Pe+=1)-1){const rt=$[Pe];if(Number.isFinite(rt)&&(!Number.isInteger(rt)||rt<0||rt>10))throw new Error("scoreExpr must be an integer 0..10")}const E=Tn==null?void 0:Tn.score,Q=typeof E=="number"&&Number.isFinite(E)?E:null;let ie=0;for(let Pe=0;Pe<sn;(Pe+=1)-1){const rt=b&&Number.isFinite(b[Pe])?Math.max(0,Math.floor(b[Pe])):T;if(rt>0&&Pe<ie||!bo[Pe])continue;const gn=((Yu=Ae[Pe])==null?void 0:Yu.timestamp)??Date.now(),cn=$&&Number.isFinite($[Pe])?$[Pe]:Q;lo.push({type:ui,index:Pe,timestamp:gn,signalId:Hs,orderId:da,score:cn??null}),rt>0&&(ie=Pe+rt)}}ht({id:et,signals:lo})}catch(lo){console.error("[ScriptStudio] local signals/backtest error",lo)}gp=_t,Ot=!0}if(Ot&&(ku=It),!(Md||It===ku)){Md=!0,ku=It;const lo=new Worker(new URL(""+new URL("../workers/signals.worker-BdYjYzQL.js",import.meta.url).href,import.meta.url),{type:"module"}),sn={id:et,condSeries:gi,bars:Ae,signals:gt,params:rr};lo.onerror=()=>{Md=!1;try{lo.terminate()}catch{}},lo.onmessage=Ao=>{const Cn=Ao.data;if(!(!Cn||Cn.id!==sn.id)){ht(Cn);try{lo.terminate()}catch{}Md=!1}},lo.postMessage(sn)}}}catch(Ae){Md=!1,console.error("[ScriptStudio] signals worker error",Ae)}}const vp=rp(((pu=B==null?void 0:B.style)==null?void 0:pu.runtimeDrawAutoscale)??((Yv=B==null?void 0:B.style)==null?void 0:Yv.includeDrawingsInAutoscale)),cv=et=>!!vp||rp(et)===!0;if(!!vp||Ff.some(et=>cv(et==null?void 0:et.includeInAutoscale))||mf.some(et=>cv(et==null?void 0:et.includeInAutoscale))||Uf.some(et=>cv(et==null?void 0:et.includeInAutoscale))||xi.some(et=>{var Ae;return cv((Ae=et==null?void 0:et.meta)==null?void 0:Ae.includeInAutoscale)})){const et=new Array(Bt),Ae=new Array(Bt),gt=(sn,Ao)=>{if(!Number.isFinite(Ao)||sn<0||sn>=Bt)return;const Cn=et[sn],Jn=Ae[sn];et[sn]=Cn==null||Ao<Cn?Ao:Cn,Ae[sn]=Jn==null||Ao>Jn?Ao:Jn},He=(sn,Ao,Cn)=>{if(!Number.isFinite(Cn))return;const Jn=Math.max(0,Math.min(sn,Ao)),nn=Math.min(Bt-1,Math.max(sn,Ao));for(let us=Jn;us<=nn;(us+=1)-1)gt(us,Cn)},ht=sn=>{let Ao=Number(sn==null?void 0:sn.startIndex),Cn=Number(sn==null?void 0:sn.endIndex);if(!Number.isFinite(Ao)||!Number.isFinite(Cn))return null;if(Ao>Cn){const nn=Ao;Ao=Cn,Cn=nn}const Jn=String((sn==null?void 0:sn.extend)||"").toLowerCase();return Jn==="both"?(Ao=0,Cn=Math.max(0,Bt-1)):Jn==="left"?Ao=0:Jn==="right"&&(Cn=Math.max(0,Bt-1)),{a:Ao,b:Cn}},It=(sn,Ao)=>Number.isFinite(sn==null?void 0:sn.slope)&&Number.isFinite(sn==null?void 0:sn.intercept)?sn.slope*Ao+sn.intercept:Number.isFinite(sn==null?void 0:sn.startValue)?sn.startValue:Number.NaN;for(const sn of Ff){if(!cv(sn==null?void 0:sn.includeInAutoscale))continue;let Ao=sn.leftIndex,Cn=sn.rightIndex;const Jn=String(sn.extend||"").toLowerCase();Jn==="both"?(Ao=0,Cn=Math.max(0,Bt-1)):Jn==="left"?Ao=0:Jn==="right"&&(Cn=Math.max(0,Bt-1)),He(Ao,Cn,Number(sn.topValue)),He(Ao,Cn,Number(sn.bottomValue))}for(const sn of mf){if(!cv(sn==null?void 0:sn.includeInAutoscale))continue;const Ao=ht(sn);if(!Ao)continue;const{a:Cn,b:Jn}=Ao;if(Number.isFinite(sn==null?void 0:sn.slope)&&Number.isFinite(sn==null?void 0:sn.intercept))for(let nn=Cn;nn<=Jn;(nn+=1)-1){const us=It(sn,nn);gt(nn,us)}else gt(Cn,Number(sn==null?void 0:sn.startValue)),gt(Jn,Number(sn==null?void 0:sn.endValue))}for(const sn of Uf){if(!cv(sn==null?void 0:sn.includeInAutoscale))continue;const Ao=sn==null?void 0:sn.line1,Cn=sn==null?void 0:sn.line2;if(!Ao||!Cn)continue;const Jn=ht(Ao),nn=ht(Cn);if(!Jn||!nn)continue;const us=Math.max(Jn.a,nn.a),Tn=Math.min(Jn.b,nn.b);if(!(us>Tn))for(let ui=us;ui<=Tn;(ui+=1)-1){const Hs=It(Ao,ui),da=It(Cn,ui);!Number.isFinite(Hs)||!Number.isFinite(da)||(gt(ui,Math.min(Hs,da)),gt(ui,Math.max(Hs,da)))}}for(const sn of xi){if(!cv((Ip=sn==null?void 0:sn.meta)==null?void 0:Ip.includeInAutoscale))continue;const Ao=sn==null?void 0:sn.index,Cn=(lf=sn==null?void 0:sn.meta)==null?void 0:lf.value;typeof Ao!="number"||!Number.isFinite(Ao)||Number.isFinite(Cn)&&gt(Ao,Number(Cn))}const Ot=Ll[Bo.min],lo=Ll[Bo.max];for(let sn=0;sn<Bt;(sn+=1)-1){const Ao=et[sn],Cn=Ae[sn];Ot&&(Ot[sn]=Ao),lo&&(lo[sn]=Cn);const Jn=ao[sn];Jn&&(Jn[Bo.min]=Ao,Jn[Bo.max]=Cn)}}ao.length=Math.max(ao.length,Hv+1);const Nv=Pl;Nv.__rows=ao,Nv.__len=Bt,Nv.__futureBars=zc.futureBars,Nv.__virtualMaxIndex=Hv,Nv.__drawConfig=zc,hv=dp,tu=Nv,bv.__lastResult=tu;try{tn.request(()=>{try{ks()}catch{}})}catch{}return tu},draw:({ctx:ve,indicator:Bt,bounding:Wi,xAxis:js,yAxis:er})=>{if(!ve||!js||!er)return!1;const na=(Bt==null?void 0:Bt.result)||{},cl=Array.isArray(na)?na:Array.isArray(na.__rows)?na.__rows:[],zu=na.__drawConfig||{},sp=Number.isFinite(na.__futureBars)?Math.max(0,Number(na.__futureBars)):Number.isFinite(zu==null?void 0:zu.futureBars)?Math.max(0,Number(zu.futureBars)):0,Hu=typeof na.__virtualMaxIndex=="number"?Number(na.__virtualMaxIndex):cl.length&&sp?cl.length-1+sp:cl.length?cl.length-1:-1,hu=typeof js.getRange=="function"?js.getRange():{from:0,to:cl.length?cl.length-1:0},Sp=cl.length?cl.length-1:-1,dp=Math.max(Sp,Hu),Pl=dp>=0?Math.max(0,Math.floor(((hu==null?void 0:hu.from)??0)-2)):0,pd=dp>=0?Math.min(dp,Math.ceil(((hu==null?void 0:hu.to)??dp)+2)):-1;(()=>{var Nr,Xn,tl,_c,Ai,ql,Hl;if(!sp||Hu<=Sp){(ne.maxPx||ne.offsetPx)&&(ne.maxPx=0,ne.offsetPx=0,ne.lastAppliedTs=0);return}const We=(Ai=(_c=(tl=(Xn=(Nr=js==null?void 0:js.getParent)==null?void 0:Nr.call(js))==null?void 0:Xn.getChart)==null?void 0:tl.call(Xn))==null?void 0:_c.getChartStore)==null?void 0:Ai.call(_c);if(!We)return;const Uo=typeof performance<"u"?performance.now():Date.now();if(Uo-ne.lastAppliedTs<500)return;const ls=((ql=We.getBarSpace)==null?void 0:ql.call(We).bar)??6,Si=Math.max(0,sp*ls),bs=((Hl=We.getOffsetRightDistance)==null?void 0:Hl.call(We))??0,Go=Math.max(Si,bs);typeof We.setMaxOffsetRightDistance=="function"&&Math.abs(Go-ne.maxPx)>.5&&(We.setMaxOffsetRightDistance(Go),ne.maxPx=Go),bs+.5<Si&&typeof We.setOffsetRightDistance=="function"&&Math.abs(Si-ne.offsetPx)>.5&&(We.setOffsetRightDistance(Si,!0),ne.offsetPx=Si,ne.lastAppliedTs=Uo)})();const Wa=Wi?{left:0,top:0,width:Wi.width,height:Wi.height}:void 0;ve.save(),Wa&&(ve.beginPath(),ve.rect(0,0,Wa.width,Wa.height),ve.clip());const rr=Array.isArray(na.__runtimeBoxDefs)?na.__runtimeBoxDefs:[],Up=Array.isArray(na.__runtimePolylineDefs)?na.__runtimePolylineDefs:[],Qu=Array.isArray(na.__runtimePolygonDefs)?na.__runtimePolygonDefs:[],nu=Array.isArray(na.__runtimePathDefs)?na.__runtimePathDefs:[],hc=Array.isArray(na.__runtimeLineFills)?na.__runtimeLineFills:[],Uu=Array.isArray(na.__runtimeLineDefs)?na.__runtimeLineDefs:[],up=Array.isArray(na.__runtimeTables)?na.__runtimeTables:[],Gu=Array.isArray(na.__lineDefs)?na.__lineDefs:[],Vu=Array.isArray(na.__labelItems)?na.__labelItems:[],Ep=na.__tsIndex||{},vr=cl.length,Sr=(We,Uo)=>{const ls=typeof We=="string"?We.trim().toLowerCase():"";return ls==="background"||ls==="bg"?"background":ls==="main"||ls==="base"?"main":ls==="overlay"||ls==="over"?"overlay":ls==="ui"?"ui":Uo},ji=(We,Uo)=>{if(typeof We=="number"&&Number.isFinite(We))return We;if(typeof We=="string"){const ls=Number(We);if(Number.isFinite(ls))return ls}return Uo},Jc={box:"overlay",line:"overlay",linefill:"overlay",label:"overlay",table:"ui",lineSegment:"overlay",polyline:"overlay",polygon:"overlay",path:"overlay"},Wv={box:10,lineSegment:20,linefill:30,line:40,label:50,table:60,polyline:25,polygon:15,path:27},su=Number.isFinite(zu==null?void 0:zu.decimationPx)&&Number(zu.decimationPx)>0?Math.floor(Number(zu.decimationPx)):H.decimationPx,Vc=(We,Uo)=>Uo<Pl-2||We>pd+2,dl=We=>({x:js.convertToPixel(We.index),y:er.convertToPixel(We.value)}),Su=We=>{if(!(We!=null&&We.points)||We.points.length<2)return;const Uo=Math.min(...We.points.map(Nr=>Nr.index)),ls=Math.max(...We.points.map(Nr=>Nr.index));if(Vc(Uo,ls))return;const Si=su>1?hb(We.points,dl,su):We.points;if(!Si.length)return;ve.save(),ve.beginPath();let bs=!0;for(const Nr of Si){const{x:Xn,y:tl}=dl(Nr);!Number.isFinite(Xn)||!Number.isFinite(tl)||(bs?(ve.moveTo(Xn,tl),bs=!1):ve.lineTo(Xn,tl))}if(bs){ve.restore();return}ve.strokeStyle=We.color||"#e2e8f0",ve.globalAlpha=typeof We.opacity=="number"?Math.max(0,Math.min(1,We.opacity)):1,ve.lineWidth=We.width??2;const Go=String(We.style||"solid").toLowerCase();Go==="dashed"?ve.setLineDash([6,4]):Go==="dotted"?ve.setLineDash([2,2]):ve.setLineDash([]),ve.stroke(),ve.setLineDash([]),ve.globalAlpha=1,ve.restore()},Zd=We=>{if(!(We!=null&&We.points)||We.points.length<3)return;const Uo=Math.min(...We.points.map(Go=>Go.index)),ls=Math.max(...We.points.map(Go=>Go.index));if(Vc(Uo,ls))return;const Si=su>1?hb(We.points,dl,su):We.points;if(Si.length<3)return;ve.save(),ve.beginPath();let bs=!0;for(const Go of Si){const{x:Nr,y:Xn}=dl(Go);!Number.isFinite(Nr)||!Number.isFinite(Xn)||(bs?(ve.moveTo(Nr,Xn),bs=!1):ve.lineTo(Nr,Xn))}if(ve.closePath(),ve.globalAlpha=typeof We.opacity=="number"?Math.max(0,Math.min(1,We.opacity)):1,We.fillColor&&(ve.fillStyle=We.fillColor,ve.fill()),We.strokeColor||We.strokeWidth){ve.strokeStyle=We.strokeColor||"#e2e8f0",ve.lineWidth=We.strokeWidth??1;const Go=String(We.strokeStyle||"solid").toLowerCase();Go==="dashed"?ve.setLineDash([6,4]):Go==="dotted"?ve.setLineDash([2,2]):ve.setLineDash([]),ve.stroke(),ve.setLineDash([])}ve.globalAlpha=1,ve.restore()},qa=We=>{if(!(We!=null&&We.commands)||!We.commands.length)return;const Uo=Math.min(...We.commands.map(Go=>Go.index)),ls=Math.max(...We.commands.map(Go=>Go.index));if(Vc(Uo,ls))return;ve.save(),ve.beginPath();let Si=!1;for(const Go of We.commands){const Nr=js.convertToPixel(Go.index),Xn=er.convertToPixel(Go.value);!Number.isFinite(Nr)||!Number.isFinite(Xn)||(Go.cmd==="M"?(ve.moveTo(Nr,Xn),Si=!0):Go.cmd==="L"&&(ve.lineTo(Nr,Xn),Si=!0))}if(!Si){ve.restore();return}ve.strokeStyle=We.color||"#e2e8f0",ve.lineWidth=We.width??2;const bs=String(We.style||"solid").toLowerCase();bs==="dashed"?ve.setLineDash([6,4]):bs==="dotted"?ve.setLineDash([2,2]):ve.setLineDash([]),ve.globalAlpha=typeof We.opacity=="number"?Math.max(0,Math.min(1,We.opacity)):1,ve.stroke(),ve.setLineDash([]),ve.globalAlpha=1,ve.restore()},Gp={background:[],main:[],overlay:[],ui:[]};let xv=0;const Wu=(We,Uo,ls,Si)=>{const bs=Sr(Uo,Jc[We]),Go=ji(ls,Wv[We]);Gp[bs].push({kind:We,layer:bs,zIndex:Go,createdAt:(xv+=1)-1,payload:Si})};if(rr.length)for(const We of rr)We&&Wu("box",We.layer,We.zIndex,We);if(Qu.length)for(const We of Qu)We&&Wu("polygon",We.layer,We.zIndex,We);if(Up.length)for(const We of Up)We&&Wu("polyline",We.layer,We.zIndex,We);if(nu.length)for(const We of nu)We&&Wu("path",We.layer,We.zIndex,We);if(Gu.length)for(const We of Gu)We&&Wu("lineSegment",We.layer,We.zIndex,We);if(hc.length)for(const We of hc)We&&Wu("linefill",We.layer,We.zIndex,We);if(Uu.length)for(const We of Uu)We&&Wu("line",We.layer,We.zIndex,We);if(s(Zt)&&Vu.length)for(const We of Vu){const Uo=We==null?void 0:We.meta;Uo&&Wu("label",Uo.layer,Uo.zIndex,We)}if(up.length)for(const We of up)We&&Wu("table",We.layer,We.zIndex,We);const tf=We=>{let Uo=We.leftIndex,ls=We.rightIndex;We.extend==="both"?(Uo=0,ls=Math.max(0,vr-1)):We.extend==="left"?Uo=0:We.extend==="right"&&(ls=Math.max(0,vr-1));const Si=js.convertToPixel(Uo),bs=js.convertToPixel(ls),Go=er.convertToPixel(We.topValue),Nr=er.convertToPixel(We.bottomValue);if(!Number.isFinite(Si)||!Number.isFinite(bs)||!Number.isFinite(Go)||!Number.isFinite(Nr))return;const Xn=Math.min(Si,bs),tl=Math.min(Go,Nr),_c=Math.abs(bs-Si),Ai=Math.abs(Nr-Go);if(We.bgColor&&(ve.fillStyle=We.bgColor,ve.fillRect(Xn,tl,_c,Ai)),We.borderColor||We.borderWidth){ve.strokeStyle=We.borderColor||"#64748b",ve.lineWidth=We.borderWidth??1;const ql=String(We.borderStyle||"solid").toLowerCase();ql==="dashed"?ve.setLineDash([6,4]):ql==="dotted"?ve.setLineDash([2,2]):ve.setLineDash([]),ve.strokeRect(Xn,tl,_c,Ai),ve.setLineDash([])}if(We.text){const ql=String(We.text||"");if(ql){const Hl=typeof We.textSize=="number"&&We.textSize>0?We.textSize:12,ja=6,Wr=Math.max(0,_c-ja*2);ve.save(),ve.font=`${Hl}px "Inter", system-ui, -apple-system, sans-serif`,ve.fillStyle=We.textColor||We.borderColor||"#e2e8f0";const ka=We.textHalign==="left"||We.textHalign==="right"?We.textHalign:"center";ve.textAlign=ka,ve.textBaseline="top";const bl=We.textWrap===!0,yc=ql.split(/\n/),la=[];if(bl&&Wr>0)for(const Ra of yc){const gi=Ra.split(/\s+/).filter(Boolean);let Yc="";const xi=()=>{Yc&&(la.push(Yc),Yc="")},nr=wi=>{if(!wi)return;if(ve.measureText(wi).width>Wr&&Wr>4){xi();let vl="";for(const Qc of wi){const ou=vl+Qc;ve.measureText(ou).width>Wr&&vl?(la.push(vl),vl=Qc):vl=ou}vl&&la.push(vl);return}const ar=Yc?`${Yc} ${wi}`:wi;ve.measureText(ar).width>Wr&&Yc?(xi(),Yc=wi):Yc=ar};for(const wi of gi)nr(wi);xi()}else for(const Ra of yc)la.push(Ra);const fr=Math.max(12,Hl+2),Ll=Math.max(1,Math.floor(Math.max(0,Ai-ja*2)/fr));if(la.length>Ll){la.length=Ll;const Ra="...";let gi=la[Ll-1]||"";if(Wr>0)for(;gi&&ve.measureText(`${gi}${Ra}`).width>Wr;)gi=gi.slice(0,-1);la[Ll-1]=gi?`${gi}${Ra}`:Ra}const ao=la.length*fr;let ul=tl+ja;We.textValign==="middle"||We.textValign==="center"?ul=tl+(Ai-ao)/2:We.textValign==="bottom"&&(ul=tl+Ai-ja-ao);let Ic=Xn+_c/2;ka==="left"&&(Ic=Xn+ja),ka==="right"&&(Ic=Xn+_c-ja);for(let Ra=0;Ra<la.length;(Ra+=1)-1)ve.fillText(la[Ra],Ic,ul+Ra*fr);ve.restore()}}},sv=We=>{let Uo=We.startIndex,ls=We.endIndex;We.extend==="both"?(Uo=0,ls=Math.max(0,vr-1)):We.extend==="left"?Uo=0:We.extend==="right"&&(ls=Math.max(0,vr-1));const Si=Number.isFinite(We.slope)&&Number.isFinite(We.intercept)?We.slope*Uo+We.intercept:We.startValue,bs=Number.isFinite(We.slope)&&Number.isFinite(We.intercept)?We.slope*ls+We.intercept:We.endValue,Go=js.convertToPixel(Uo),Nr=er.convertToPixel(Si),Xn=js.convertToPixel(ls),tl=er.convertToPixel(bs);if(!Number.isFinite(Go)||!Number.isFinite(Nr)||!Number.isFinite(Xn)||!Number.isFinite(tl))return;ve.beginPath(),ve.moveTo(Go,Nr),ve.lineTo(Xn,tl),ve.strokeStyle=We.color||"#22c55e",ve.lineWidth=We.width??2;const _c=(We.style||"solid").toLowerCase();_c==="dashed"?ve.setLineDash([6,4]):_c==="dotted"?ve.setLineDash([2,2]):ve.setLineDash([]),ve.stroke(),ve.setLineDash([])},Yp=We=>{let Uo=Number(We==null?void 0:We.startIndex),ls=Number(We==null?void 0:We.endIndex);if(!Number.isFinite(Uo)||!Number.isFinite(ls))return null;if(Uo>ls){const bs=Uo;Uo=ls,ls=bs}const Si=String((We==null?void 0:We.extend)||"").toLowerCase();return Si==="both"?(Uo=0,ls=Math.max(0,vr-1)):Si==="left"?Uo=0:Si==="right"&&(ls=Math.max(0,vr-1)),{a:Uo,b:ls}},_u=(We,Uo)=>Number.isFinite(We==null?void 0:We.slope)&&Number.isFinite(We==null?void 0:We.intercept)?We.slope*Uo+We.intercept:Number.isFinite(We==null?void 0:We.startValue)?We.startValue:Number.NaN,wv=We=>{const Uo=We==null?void 0:We.line1,ls=We==null?void 0:We.line2;if(!Uo||!ls)return;const Si=Yp(Uo),bs=Yp(ls);if(!Si||!bs)return;const Go=Math.max(Pl,Si.a,bs.a),Nr=Math.min(pd,Si.b,bs.b);if(Go>Nr)return;const Xn=[],tl=[];for(let _c=Go;_c<=Nr;(_c+=1)-1){const Ai=_u(Uo,_c),ql=_u(ls,_c);if(!Number.isFinite(Ai)||!Number.isFinite(ql))continue;const Hl=js.convertToPixel(_c),ja=er.convertToPixel(Ai),Wr=er.convertToPixel(ql);Xn.push({x:Hl,y:ja}),tl.push({x:Hl,y:Wr})}Xn.length>1&&tl.length>1&&x1(ve,Xn,tl,We.color||"rgba(59,130,246,0.15)",Wa)},ip=(We,Uo)=>{const ls=Number(We);if(Number.isFinite(ls))return{left:ls,right:ls,top:ls,bottom:ls};if(We&&typeof We=="object"){const Si=We,bs=Number(Si.left),Go=Number(Si.right),Nr=Number(Si.top),Xn=Number(Si.bottom);return{left:Number.isFinite(bs)?bs:Uo.left,right:Number.isFinite(Go)?Go:Uo.right,top:Number.isFinite(Nr)?Nr:Uo.top,bottom:Number.isFinite(Xn)?Xn:Uo.bottom}}return Uo},Np=We=>{const Uo=Number.isFinite(We==null?void 0:We.fontSize)&&Number(We.fontSize)>0?Number(We.fontSize):Number.isFinite(We==null?void 0:We.size)&&Number(We.size)>0?Number(We.size):12,ls=(We==null?void 0:We.fontFamily)||(We!=null&&We.monospace?'"SFMono-Regular", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace':'"Inter", system-ui, -apple-system, sans-serif');return{font:`${(We==null?void 0:We.fontWeight)||"600"} ${Uo}px ${ls}`,size:Uo}},iv=(We,Uo,ls,Si,bs,Go)=>{const Nr=Math.max(0,Math.min(Go,Math.min(Si,bs)/2));We.beginPath(),We.moveTo(Uo+Nr,ls),We.lineTo(Uo+Si-Nr,ls),We.quadraticCurveTo(Uo+Si,ls,Uo+Si,ls+Nr),We.lineTo(Uo+Si,ls+bs-Nr),We.quadraticCurveTo(Uo+Si,ls+bs,Uo+Si-Nr,ls+bs),We.lineTo(Uo+Nr,ls+bs),We.quadraticCurveTo(Uo,ls+bs,Uo,ls+bs-Nr),We.lineTo(Uo,ls+Nr),We.quadraticCurveTo(Uo,ls,Uo+Nr,ls),We.closePath()},rv=(We,Uo)=>{ve.font='12px "Inter", system-ui, -apple-system, sans-serif';const ls=We==null?void 0:We.ts,Si=We==null?void 0:We.tsMs,bs=(()=>{let xi;return typeof ls=="number"&&Number.isFinite(ls)&&(xi=Ep[String(ls)]),xi==null&&typeof Si=="number"&&Number.isFinite(Si)&&(xi=Ep[`${Math.floor(Si)}_ms`]??Ep[`${Math.floor(Si/1e3)}_s`]),typeof xi=="number"&&Number.isFinite(xi)?xi:We==null?void 0:We.index})();if(typeof bs!="number"||!Number.isFinite(bs)||pd>=0&&(bs<Pl||bs>pd))return;const Go=js.convertToPixel(bs);if(!Number.isFinite(Go))return;const Nr=cl[bs]||{},Xn=We==null?void 0:We.meta;if(!Xn)return;const tl=Xn.textAlign==="left"||Xn.textAlign==="right"?Xn.textAlign:"center";ve.textAlign=tl;const _c=Xn==null?void 0:Xn.value;if(_c==null)return;let Ai=er.convertToPixel(_c);if(!Number.isFinite(Ai))return;const ql=typeof Xn.offsetY=="number"?Xn.offsetY:10,Hl=(Xn.position||"above")==="above",ja=Hl?Uo.above[bs]||0:Uo.below[bs]||0,Wr=ql+ja*Math.max(6,(Xn.size||12)/3);Hl?(Ai-=Wr,ve.textBaseline="bottom",Uo.above[bs]=ja+1):(Ai+=Wr,ve.textBaseline="top",Uo.below[bs]=ja+1);const ka=typeof Xn.size=="number"&&Xn.size>0?Xn.size:12,bl=ka/2;if(Wa||Wi){const xi=0+bl+2,nr=((Wa==null?void 0:Wa.height)??Wi.height)-bl-2;Ai=Math.max(xi,Math.min(nr,Ai))}if(Xn.wrap===!0||Xn.maxWidth!=null||Xn.padding!=null||Xn.bgOpacity!=null||Xn.radius!=null||Xn.borderWidth!=null||Xn.align||Xn.valign||Xn.lineHeight!=null||Xn.fontFamily||Xn.fontSize!=null||Xn.fontWeight||Xn.monospace){const xi=Np(Xn),nr=ip(Xn.padding,{left:8,right:8,top:6,bottom:6}),wi=xM({text:String(Xn.text??""),font:xi.font,maxWidth:Xn.maxWidth,wrap:Xn.wrap===!0||Xn.textWrap===!0,lineHeight:Xn.lineHeight}),pl=Math.ceil(wi.width+nr.left+nr.right),ar=Math.ceil(wi.height+nr.top+nr.bottom),vl=Xn.align||Xn.textAlign,Qc=vl==="left"||vl==="right"?vl:"center",ou=Xn.valign,Fu=ou==="top"||ou==="middle"||ou==="bottom"?ou:Hl?"bottom":"top";let Ad=Go;Qc==="center"?Ad=Go-pl/2:Qc==="right"&&(Ad=Go-pl);let Xd=Ai;if(Fu==="middle"?Xd=Ai-ar/2:Fu==="bottom"&&(Xd=Ai-ar),Wa||Wi){const Lf=((Wa==null?void 0:Wa.height)??Wi.height)-ar;Xd=Math.max(0,Math.min(Lf,Xd))}const Kp=Xn.bgColor||Xn.color||"rgba(15,23,42,0.95)",yp=Xn.bgOpacity!=null?Math.max(0,Math.min(1,Number(Xn.bgOpacity))):null,$v=Xn.borderColor||"rgba(0,0,0,0.65)",Zp=Xn.borderWidth!=null?Math.max(0,Number(Xn.borderWidth)):1,Xp=Xn.radius!=null?Number(Xn.radius):String(Xn.shape||"").toLowerCase()==="pill"?ar/2:void 0,Jp=Math.max(0,Xp??6),lv=Xn.textColor||Xn.color||"#f97316",qv=ve.globalAlpha;if(ve.globalAlpha=typeof Xn.opacity=="number"?Math.max(0,Math.min(1,Xn.opacity)):1,ve.save(),iv(ve,Ad,Xd,pl,ar,Jp),Kp){const Qp=ve.globalAlpha;yp!=null&&(ve.globalAlpha=Qp*yp),ve.fillStyle=Kp,ve.fill(),ve.globalAlpha=Qp}Zp>0&&(ve.strokeStyle=$v,ve.lineWidth=Zp,ve.stroke()),ve.font=xi.font,ve.fillStyle=lv,ve.textBaseline="top",ve.textAlign=Qc==="left"?"left":Qc==="right"?"right":"center";const pp=Qc==="left"?Ad+nr.left:Qc==="right"?Ad+pl-nr.right:Ad+pl/2;let Iu=Xd+nr.top;for(const Qp of wi.lines)ve.fillText(Qp,Math.round(pp),Math.round(Iu)),Iu+=wi.lineHeight;ve.restore(),ve.globalAlpha=qv;return}const la=Xn.shape||"",fr=la==="arrow_up"?"arrowUp":la==="arrow_down"?"arrowDown":la==="triangle_up_filled"?"triangleUpFilled":la==="triangle_down_filled"?"triangleDownFilled":la==="arrow_up_glow"?"arrowUpGlow":la==="arrow_down_glow"?"arrowDownGlow":la==="triangle_up_gradient"?"triangleUpGradient":la==="triangle_down_gradient"?"triangleDownGradient":la==="circle_pulse"?"circlePulse":la==="tag"?"tag":la==="flag"?"flag":la==="pill"?"pill":la==="box_gradient"?"boxGradient":la==="bubble"?"bubble":la==="spark"?"spark":la==="star"?"star":la==="label"?"label":la==="text"||la==="emoji"?"text":la,Ll=typeof Xn.size=="number"&&Xn.size>0?Xn.size:12,ao=Ll/2,ul=Xn.bgColor||"rgba(15,23,42,0.95)",Ic=Xn.borderColor||"rgba(0,0,0,0.65)",Ra=Xn.textColor||Xn.color||"#f97316",gi=String(Xn.text||"");ve.lineWidth=typeof Xn.borderWidth=="number"?Xn.borderWidth:1;const Yc=ve.globalAlpha;if(ve.globalAlpha=typeof Xn.opacity=="number"?Math.max(0,Math.min(1,Xn.opacity)):1,fr==="circle"||fr==="square"||fr==="arrowUp"||fr==="arrowDown"||fr==="box"||fr==="triangleUpFilled"||fr==="triangleDownFilled"||fr==="label"||fr==="arrowUpGlow"||fr==="arrowDownGlow"||fr==="triangleUpGradient"||fr==="triangleDownGradient"||fr==="circlePulse"||fr==="tag"||fr==="flag"||fr==="pill"||fr==="boxGradient"||fr==="bubble"||fr==="spark"||fr==="star"||fr==="text"){if(ve.save(),ve.strokeStyle=Ic,ve.fillStyle=Xn.color||ul,fr==="circle")ve.beginPath(),ve.arc(Go,Ai,ao,0,Math.PI*2),ve.fill(),ve.stroke();else if(fr==="square")ve.beginPath(),ve.rect(Go-ao,Ai-ao,Ll,Ll),ve.fill(),ve.stroke();else if(fr==="arrowUp"||fr==="arrowUpGlow")ve.beginPath(),ve.moveTo(Go,Ai-ao),ve.lineTo(Go-ao,Ai+ao),ve.lineTo(Go+ao,Ai+ao),ve.closePath(),(fr==="arrowUpGlow"||Xn.shadow)&&(ve.shadowColor=Xn.color||ul,ve.shadowBlur=12),ve.fill(),ve.stroke();else if(fr==="arrowDown"||fr==="arrowDownGlow")ve.beginPath(),ve.moveTo(Go,Ai+ao),ve.lineTo(Go-ao,Ai-ao),ve.lineTo(Go+ao,Ai-ao),ve.closePath(),(fr==="arrowDownGlow"||Xn.shadow)&&(ve.shadowColor=Xn.color||ul,ve.shadowBlur=12),ve.fill(),ve.stroke();else if(fr==="triangleUpFilled")ve.beginPath(),ve.moveTo(Go,Ai-ao),ve.lineTo(Go-ao,Ai+ao),ve.lineTo(Go+ao,Ai+ao),ve.closePath(),ve.fill(),ve.stroke();else if(fr==="triangleDownFilled")ve.beginPath(),ve.moveTo(Go,Ai+ao),ve.lineTo(Go-ao,Ai-ao),ve.lineTo(Go+ao,Ai-ao),ve.closePath(),ve.fill(),ve.stroke();else if(fr==="triangleUpGradient"||fr==="triangleDownGradient"){const xi=ve.createLinearGradient(Go-ao,Ai-ao,Go+ao,Ai+ao);xi.addColorStop(0,Xn.bgColor||"rgba(59,130,246,0.6)"),xi.addColorStop(1,Xn.color||"rgba(34,197,94,0.6)"),ve.fillStyle=xi,ve.beginPath(),fr==="triangleUpGradient"?(ve.moveTo(Go,Ai-ao),ve.lineTo(Go-ao,Ai+ao),ve.lineTo(Go+ao,Ai+ao)):(ve.moveTo(Go,Ai+ao),ve.lineTo(Go-ao,Ai-ao),ve.lineTo(Go+ao,Ai-ao)),ve.closePath(),ve.fill(),ve.stroke()}else if(fr==="circlePulse")ve.beginPath(),ve.arc(Go,Ai,ao,0,Math.PI*2),ve.fill(),ve.stroke(),ve.globalAlpha=.4,ve.beginPath(),ve.arc(Go,Ai,ao*1.6,0,Math.PI*2),ve.stroke(),ve.globalAlpha=1;else if(fr==="pill"){const xi=Math.max(10,ve.measureText(gi||"").width+16),nr=Math.max(12,Ll),wi=Go-Math.floor(xi/2),pl=Ai-Math.floor(nr/2),ar=nr/2;ve.beginPath(),ve.moveTo(wi+ar,pl),ve.lineTo(wi+xi-ar,pl),ve.arc(wi+xi-ar,pl+ar,ar,-Math.PI/2,Math.PI/2),ve.lineTo(wi+ar,pl+nr),ve.arc(wi+ar,pl+ar,ar,Math.PI/2,-Math.PI/2),ve.closePath(),ve.fill(),ve.stroke()}else if(fr==="tag"||fr==="flag"){const xi=Math.max(10,ve.measureText(gi||"").width+20),nr=Math.max(12,Ll+4),wi=Go-Math.floor(xi/2),pl=Ai-Math.floor(nr/2);ve.beginPath(),ve.rect(wi,pl,xi,nr),ve.fill(),ve.stroke(),fr==="flag"&&(ve.beginPath(),ve.moveTo(wi,pl),ve.lineTo(wi-nr/2,pl+nr/2),ve.lineTo(wi,pl+nr),ve.closePath(),ve.fill(),ve.stroke())}else if(fr==="boxGradient"){const xi=Math.max(10,ve.measureText(gi||"").width+12),nr=Math.max(12,Ll+6),wi=Go-Math.floor(xi/2),pl=Ai-Math.floor(nr/2),ar=ve.createLinearGradient(wi,pl,wi+xi,pl+nr);ar.addColorStop(0,Xn.bgColor||"rgba(15,23,42,0.5)"),ar.addColorStop(1,Xn.color||"rgba(59,130,246,0.35)"),ve.fillStyle=ar,ve.beginPath(),ve.rect(wi,pl,xi,nr),ve.fill(),ve.stroke()}else if(fr==="bubble")ve.beginPath(),ve.arc(Go,Ai,ao,0,Math.PI*2),ve.fill(),ve.stroke(),ve.beginPath(),ve.moveTo(Go,Ai+ao),ve.lineTo(Go+ao,Ai+ao+6),ve.stroke();else if(fr==="spark")ve.beginPath(),ve.moveTo(Go,Ai-ao),ve.lineTo(Go,Ai+ao),ve.moveTo(Go-ao,Ai),ve.lineTo(Go+ao,Ai),ve.stroke();else if(fr==="star"){ve.beginPath();for(let xi=0;xi<5;(xi+=1)-1){const nr=Math.PI*2*xi/5,wi=Go+Math.cos(nr)*ao,pl=Ai+Math.sin(nr)*ao,ar=nr+Math.PI/5,vl=Go+Math.cos(ar)*(ao/2),Qc=Ai+Math.sin(ar)*(ao/2);xi===0?ve.moveTo(wi,pl):ve.lineTo(wi,pl),ve.lineTo(vl,Qc)}ve.closePath(),ve.fill(),ve.stroke()}else if(fr==="box"){const xi=Nr.__open,nr=Nr.__close,wi=Nr.__high,pl=Nr.__low;if(xi!=null&&nr!=null&&wi!=null&&pl!=null){const ar=Xn.boxMode||"body",vl=ar==="wick"?wi:Math.max(xi,nr),Qc=ar==="wick"?pl:Math.min(xi,nr),ou=er.convertToPixel(vl),Fu=er.convertToPixel(Qc);if(Number.isFinite(ou)&&Number.isFinite(Fu)){const Ad=js.convertToPixel(bs),Xd=bs>0?js.convertToPixel(bs-1):Ad-Math.abs(js.convertToPixel(1)-js.convertToPixel(0)),Kp=bs<cl.length-1?js.convertToPixel(bs+1):Ad+Math.abs(js.convertToPixel(1)-js.convertToPixel(0)),yp=0,$v=((Wa==null?void 0:Wa.width)??Wi.width)||0,Zp=Math.min(Ad,Math.max(yp,Math.floor((Xd+Ad)/2))),Xp=Math.max(Ad,Math.min($v,Math.ceil((Ad+Kp)/2))),Jp=Math.min(ou,Fu),lv=Math.max(1,Math.abs(Fu-ou)),qv=Math.max(2,Xp-Zp);ve.beginPath(),ve.rect(Zp,Jp,qv,lv),ve.fill(),ve.strokeStyle=Ic,ve.lineWidth=Ll,ve.stroke()}}}else if(fr==="label"){const xi=ve.measureText(gi||""),nr=Math.max(10,xi.width+12),wi=Math.max(12,Ll+6),pl=Math.max(3,Math.floor(wi/3)),ar=Go-Math.floor(nr/2),vl=Ai-Math.floor(wi/2);ve.beginPath();const Qc=pl;ve.moveTo(ar+Qc,vl),ve.lineTo(ar+nr-Qc,vl),ve.quadraticCurveTo(ar+nr,vl,ar+nr,vl+Qc),ve.lineTo(ar+nr,vl+wi-Qc),ve.quadraticCurveTo(ar+nr,vl+wi,ar+nr-Qc,vl+wi),ve.lineTo(ar+Qc,vl+wi),ve.quadraticCurveTo(ar,vl+wi,ar,vl+wi-Qc),ve.lineTo(ar,vl+Qc),ve.quadraticCurveTo(ar,vl,ar+Qc,vl),ve.closePath(),ve.fill(),ve.stroke()}else if(fr==="text"){ve.fillStyle=Ra,ve.textAlign=tl;const xi=typeof Xn.size=="number"&&Xn.size>0?Xn.size:14;ve.font=`${xi}px sans-serif`;const nr=Hl?Ai-(xi/2+4):Ai+(xi/2+4);ve.fillText(gi||"",Go,nr)}if(gi&&fr!=="text"){const nr=(typeof Xn.size=="number"&&Xn.size>0?Xn.size:12)/2,wi=typeof Xn.textPadding=="number"?Math.max(0,Xn.textPadding):nr+6,pl=Hl?Ai-wi:Ai+wi;ve.fillStyle=Ra,ve.strokeStyle="rgba(0,0,0,0.45)",ve.textAlign=tl,ve.fillText(gi,Go,pl),ve.strokeText(gi,Go,pl)}ve.restore(),ve.globalAlpha=Yc}else if(gi)ve.fillStyle=Ra,ve.strokeStyle="rgba(0,0,0,0.45)",ve.lineWidth=1,ve.fillText(gi,Go,Ai),ve.strokeText(gi,Go,Ai);else{const xi=String(la||"");if(!Y.has(xi)){Y.add(xi);try{console.warn("[ScriptStudio] Unknown label shape:",xi)}catch{}}ve.beginPath(),ve.arc(Go,Ai,Math.max(3,ka/3),0,Math.PI*2),ve.fillStyle=Xn.color||"#22d3ee",ve.fill()}},Cu=We=>{if(!We||!We.columns||!We.rows)return;const Uo=8,ls=((Wa==null?void 0:Wa.width)??Wi.width)||0,Si=((Wa==null?void 0:Wa.height)??Wi.height)||0,bs=Math.max(1,Math.floor(We.columns)),Go=Math.max(1,Math.floor(We.rows)),Nr=typeof We.textSize=="number"&&We.textSize>0?We.textSize:12,Xn=new Array(bs).fill(0),tl=new Array(Go).fill(Math.max(20,Nr+8)),_c=Array.isArray(We.cells)?We.cells:[],Ai=new Map;for(const ao of _c){const ul=Math.max(0,Math.min(bs-1,ao.column)),Ic=Math.max(0,Math.min(Go-1,ao.row));Ai.set(`${ul}:${Ic}`,ao)}const ql=Array.isArray(We.merges)?We.merges:[],Hl=new Map,ja=new Map;for(const ao of ql){if(!ao)continue;let ul=Math.max(0,Math.min(bs-1,Math.floor(Number(ao.left)))),Ic=Math.max(0,Math.min(bs-1,Math.floor(Number(ao.right)))),Ra=Math.max(0,Math.min(Go-1,Math.floor(Number(ao.top)))),gi=Math.max(0,Math.min(Go-1,Math.floor(Number(ao.bottom))));if(!Number.isFinite(ul)||!Number.isFinite(Ic)||!Number.isFinite(Ra)||!Number.isFinite(gi))continue;ul>Ic&&([ul,Ic]=[Ic,ul]),Ra>gi&&([Ra,gi]=[gi,Ra]);const Yc=`${ul}:${Ra}:${Ic}:${gi}`;ja.has(Yc)||ja.set(Yc,{left:ul,top:Ra,right:Ic,bottom:gi,minW:0,minH:0});for(let xi=ul;xi<=Ic;(xi+=1)-1)for(let nr=Ra;nr<=gi;(nr+=1)-1)Hl.set(`${xi}:${nr}`,{left:ul,top:Ra,right:Ic,bottom:gi})}for(const ao of _c){const ul=Math.max(0,Math.min(bs-1,ao.column)),Ic=Math.max(0,Math.min(Go-1,ao.row)),Ra=Hl.get(`${ul}:${Ic}`);if(Ra&&(Ra.left!==ul||Ra.top!==Ic))continue;const gi=ao.text||"",Yc=typeof ao.textSize=="number"&&ao.textSize>0?ao.textSize:Nr;ve.font=`${Yc}px "Inter", system-ui, -apple-system, sans-serif`;const xi=ve.measureText(gi).width+Uo*2,nr=typeof ao.width=="number"&&ao.width>0?ao.width:0,wi=typeof ao.height=="number"&&ao.height>0?ao.height:Math.max(20,Yc+8);if(Ra){const pl=`${Ra.left}:${Ra.top}:${Ra.right}:${Ra.bottom}`,ar=ja.get(pl);ar&&(ar.minW=Math.max(ar.minW,xi,nr),ar.minH=Math.max(ar.minH,wi))}else Xn[ul]=Math.max(Xn[ul],xi,nr),tl[Ic]=Math.max(tl[Ic],wi)}for(let ao=0;ao<bs;(ao+=1)-1)Xn[ao]<60&&(Xn[ao]=60);for(const ao of ja.values()){let ul=0;for(let Ra=ao.left;Ra<=ao.right;(Ra+=1)-1)ul+=Xn[Ra]||0;ul<ao.minW&&(Xn[ao.right]=(Xn[ao.right]||0)+(ao.minW-ul));let Ic=0;for(let Ra=ao.top;Ra<=ao.bottom;(Ra+=1)-1)Ic+=tl[Ra]||0;Ic<ao.minH&&(tl[ao.bottom]=(tl[ao.bottom]||0)+(ao.minH-Ic))}const Wr=Xn.reduce((ao,ul)=>ao+ul,0),ka=tl.reduce((ao,ul)=>ao+ul,0),bl=String(We.position||"top_right").toLowerCase();let yc=Uo,la=Uo;bl.includes("top_right")?(yc=ls-Wr-Uo,la=Uo):bl.includes("bottom_left")?(yc=Uo,la=Si-ka-Uo):bl.includes("bottom_right")?(yc=ls-Wr-Uo,la=Si-ka-Uo):bl.includes("top_center")?(yc=(ls-Wr)/2,la=Uo):bl.includes("bottom_center")?(yc=(ls-Wr)/2,la=Si-ka-Uo):(bl.includes("middle_center")||bl.includes("center"))&&(yc=(ls-Wr)/2,la=(Si-ka)/2),ve.save(),We.bgcolor&&(ve.fillStyle=We.bgcolor,ve.fillRect(yc,la,Wr,ka));const fr=We.frameColor||We.borderColor;fr&&(ve.strokeStyle=fr,ve.lineWidth=typeof We.frameWidth=="number"&&We.frameWidth>0?We.frameWidth:typeof We.borderWidth=="number"&&We.borderWidth>0?We.borderWidth:1,ve.strokeRect(yc,la,Wr,ka));let Ll=yc;for(let ao=0;ao<bs;(ao+=1)-1){let ul=la;for(let Ic=0;Ic<Go;(Ic+=1)-1){const Ra=Xn[ao],gi=tl[Ic],Yc=Hl.get(`${ao}:${Ic}`);if(Yc&&(Yc.left!==ao||Yc.top!==Ic)){ul+=gi;continue}const xi=Yc?(()=>{let Ad=0;for(let Xd=Yc.left;Xd<=Yc.right;(Xd+=1)-1)Ad+=Xn[Xd]||0;return Ad})():Ra,nr=Yc?(()=>{let Ad=0;for(let Xd=Yc.top;Xd<=Yc.bottom;(Xd+=1)-1)Ad+=tl[Xd]||0;return Ad})():gi,wi=Ai.get(`${ao}:${Ic}`);wi!=null&&wi.bgcolor&&(ve.fillStyle=wi.bgcolor,ve.fillRect(Ll,ul,xi,nr)),ve.strokeStyle=We.borderColor||"rgba(148,163,184,0.5)",ve.lineWidth=typeof We.borderWidth=="number"&&We.borderWidth>0?We.borderWidth:1,ve.strokeRect(Ll,ul,xi,nr);const pl=(wi==null?void 0:wi.text)||"",ar=typeof(wi==null?void 0:wi.textSize)=="number"&&wi.textSize>0?wi.textSize:Nr;ve.font=`${ar}px "Inter", system-ui, -apple-system, sans-serif`;const vl=(wi==null?void 0:wi.textHalign)||We.textHalign||"left",Qc=(wi==null?void 0:wi.textValign)||We.textValign||"middle";ve.textAlign=vl==="center"||vl==="right"?vl:"left",ve.textBaseline=Qc==="top"?"top":Qc==="bottom"?"bottom":"middle";let ou=Ll+Uo;ve.textAlign==="center"&&(ou=Ll+xi/2),ve.textAlign==="right"&&(ou=Ll+xi-Uo);let Fu=ul+nr/2;ve.textBaseline==="top"&&(Fu=ul+Uo),ve.textBaseline==="bottom"&&(Fu=ul+nr-Uo),ve.fillStyle=(wi==null?void 0:wi.textColor)||We.textColor||"#e2e8f0",ve.fillText(pl,ou,Fu),ul+=gi}Ll+=Xn[ao]}ve.restore()},Pu=We=>{const Uo=Gp[We];if(!Uo||!Uo.length)return;const ls=Uo.slice().sort((bs,Go)=>bs.zIndex!==Go.zIndex?bs.zIndex-Go.zIndex:bs.createdAt-Go.createdAt),Si={above:{},below:{}};for(const bs of ls)bs.kind==="box"?tf(bs.payload):bs.kind==="polygon"?Zd(bs.payload):bs.kind==="polyline"?Su(bs.payload):bs.kind==="path"?qa(bs.payload):bs.kind==="line"||bs.kind==="lineSegment"?sv(bs.payload):bs.kind==="linefill"?wv(bs.payload):bs.kind==="label"?rv(bs.payload,Si):bs.kind==="table"&&Cu(bs.payload)};Pu("background"),Da.forEach((We,Uo)=>{var bs,Go,Nr,Xn,tl,_c,Ai;const ls=mo[Uo]||Qi[Uo].key,Si=(We.type||"").toLowerCase();if(Si==="candles"||Si==="ohlc"){const ql=`${ls}__open`,Hl=`${ls}__high`,ja=`${ls}__low`,Wr=`${ls}__close`,ka=js.convertToPixel(Pl),bl=Pl+1<=pd?js.convertToPixel(Pl+1):js.convertToPixel(Math.max(Pl-1,0)),yc=Number.isFinite(ka)&&Number.isFinite(bl)?Math.max(2,Math.abs(bl-ka)):6,la=Math.max(2,Math.min(14,yc*.7)),fr=la/2,Ll=We.color||"#22c55e",ao=We.downColor||"#ef4444",ul=We.borderColor||Ll,Ic=We.borderColor||ao,Ra=We.wickColor||Ll,gi=We.wickColor||ao;for(let Yc=Pl;Yc<=pd;(Yc+=1)-1){const xi=cl[Yc]||{},nr=xi[ql]??xi.__open,wi=xi[Hl]??xi.__high,pl=xi[ja]??xi.__low,ar=xi[Wr]??xi.__close;if(nr==null||wi==null||pl==null||ar==null||Number.isNaN(nr)||Number.isNaN(wi)||Number.isNaN(pl)||Number.isNaN(ar))continue;const vl=js.convertToPixel(Yc),Qc=ar>=nr,ou=er.convertToPixel(Math.max(nr,ar)),Fu=er.convertToPixel(Math.min(nr,ar)),Ad=er.convertToPixel(wi),Xd=er.convertToPixel(pl),Kp=Qc?Ra:gi;if(ve.beginPath(),ve.strokeStyle=Kp,ve.lineWidth=1,ve.moveTo(vl,Ad),ve.lineTo(vl,Xd),ve.stroke(),Si==="candles"){const yp=Qc?Ll:ao,$v=Qc?ul:Ic,Zp=Math.max(1,Math.abs(Fu-ou));ve.fillStyle=yp,ve.strokeStyle=$v,ve.lineWidth=1,ve.beginPath(),ve.rect(vl-fr,Math.min(ou,Fu),la,Zp),ve.fill(),ve.stroke()}else{const yp=Qc?ul:Ic;ve.strokeStyle=yp,ve.lineWidth=1,ve.beginPath(),ve.moveTo(vl-fr,er.convertToPixel(nr)),ve.lineTo(vl,er.convertToPixel(nr)),ve.moveTo(vl,er.convertToPixel(ar)),ve.lineTo(vl+fr,er.convertToPixel(ar)),ve.stroke()}}}if(Si==="dots"){const ql=We.color||"#22d3ee",Hl=We.width||4,ja=[];for(let Wr=Pl;Wr<=pd;(Wr+=1)-1){const ka=(bs=cl[Wr])==null?void 0:bs[ls];if(ka==null){ja.push({x:NaN,y:NaN});continue}const bl=js.convertToPixel(Wr),yc=er.convertToPixel(ka);ja.push({x:bl,y:yc})}i2(ve,ja,ql,Hl,Wa)}if(Si==="stepped"||Si==="step"){const ql=We.color||"#22c55e",Hl=We.width||2,ja=[];for(let Wr=Pl;Wr<=pd;(Wr+=1)-1){const ka=(Go=cl[Wr])==null?void 0:Go[ls];if(ka==null){ja.push({x:NaN,y:NaN});continue}ja.push({x:js.convertToPixel(Wr),y:er.convertToPixel(ka)})}DW(ve,ja,ql,Hl,Wa)}if(Si==="area"){const ql=We.color||"rgba(56,189,248,0.3)",Hl=[];for(let bl=Pl;bl<=pd;(bl+=1)-1){const yc=(Nr=cl[bl])==null?void 0:Nr[ls];if(yc==null){Hl.push({x:NaN,y:NaN});continue}const la=js.convertToPixel(bl),fr=er.convertToPixel(yc);Hl.push({x:la,y:fr})}const ja=er.convertToPixel(0),ka=String(We.baseline||"").toLowerCase()==="zero"?ja:Wa?Wa.height:Wi.top+Wi.height;NW(ve,Hl,ka,ql,null,0,Wa)}if(Si==="glow_points"){const ql=We.color||"#22d3ee",Hl=(We.width||4)+2,ja=[];for(let Wr=Pl;Wr<=pd;(Wr+=1)-1){const ka=(Xn=cl[Wr])==null?void 0:Xn[ls];if(ka==null){ja.push({x:NaN,y:NaN});continue}ja.push({x:js.convertToPixel(Wr),y:er.convertToPixel(ka)})}ve.save(),ve.shadowColor=ql,ve.shadowBlur=12,i2(ve,ja,ql,Hl,Wa),ve.restore()}if(Si==="neon_line"){const ql=We.color||"#22d3ee",Hl=We.width||2;ve.save(),ve.shadowColor=ql,ve.shadowBlur=14,ve.beginPath();let ja=!1;for(let Wr=Pl;Wr<=pd;(Wr+=1)-1){const ka=(tl=cl[Wr])==null?void 0:tl[ls];if(ka==null)continue;const bl=js.convertToPixel(Wr),yc=er.convertToPixel(ka);ja?ve.lineTo(bl,yc):(ve.moveTo(bl,yc),ja=!0)}ve.strokeStyle=ql,ve.lineWidth=Hl,ve.stroke(),ve.restore()}if(Si==="bezier_line"){const ql=We.color||"#34d399",Hl=We.width||2;ve.save(),ve.beginPath();let ja=NaN,Wr=NaN,ka=!1;for(let bl=Pl;bl<=pd;(bl+=1)-1){const yc=(_c=cl[bl])==null?void 0:_c[ls];if(yc==null)continue;const la=js.convertToPixel(bl),fr=er.convertToPixel(yc);if(!ka)ve.moveTo(la,fr),ka=!0;else{const Ll=(ja+la)/2,ao=(Wr+fr)/2;ve.quadraticCurveTo(ja,Wr,Ll,ao)}ja=la,Wr=fr}ve.strokeStyle=ql,ve.lineWidth=Hl,ve.stroke(),ve.restore()}if(Si==="cloud"||Si==="supertrend_cloud"){const ql=We.color||"rgba(14,165,233,0.12)";ve.save();const Hl=[],ja=[];for(let Wr=Pl;Wr<=pd;(Wr+=1)-1){const ka=cl[Wr]||{},bl=js.convertToPixel(Wr),yc=er.convertToPixel(ka[ls]),la=er.convertToPixel(ka[mo[0]]);Hl.push({x:bl,y:yc}),ja.push({x:bl,y:la})}x1(ve,Hl,ja,ql,Wa),ve.restore()}if(Si==="aura"||Si==="candleshadow"){const ql=We.color||"#a78bfa",Hl=We.width||2;ve.save(),ve.shadowColor=ql,ve.shadowBlur=18,ve.beginPath();let ja=!1;for(let Wr=Pl;Wr<=pd;(Wr+=1)-1){const ka=(Ai=cl[Wr])==null?void 0:Ai[ls];if(ka==null)continue;const bl=js.convertToPixel(Wr),yc=er.convertToPixel(ka);ja?ve.lineTo(bl,yc):(ve.moveTo(bl,yc),ja=!0)}ve.strokeStyle=ql,ve.lineWidth=Hl,ve.stroke(),ve.restore()}});const av=Nt.fills||[];if(Array.isArray(av)&&av.length)for(const We of av){const Uo=Array.isArray(We==null?void 0:We.between)?We.between:[];if(!Uo||Uo.length!==2)continue;const ls=(Uo[0]||"").replace(/\s+/g,"_").toLowerCase(),Si=(Uo[1]||"").replace(/\s+/g,"_").toLowerCase(),bs=gc[ls],Go=gc[Si];if(!bs||!Go)continue;const Nr=[],Xn=[];for(let tl=Pl;tl<=pd;(tl+=1)-1){const _c=cl[tl]||{},Ai=js.convertToPixel(tl),ql=er.convertToPixel(_c[bs]),Hl=er.convertToPixel(_c[Go]);Nr.push({x:Ai,y:ql}),Xn.push({x:Ai,y:Hl})}x1(ve,Nr,Xn,We.color||"rgba(0,0,0,0.12)",Wa)}Pu("main"),Dd.forEach(We=>{const Uo=er.convertToPixel(We.value);if(!Number.isFinite(Uo))return;ve.beginPath(),ve.moveTo(0,Uo),ve.lineTo(((Wa==null?void 0:Wa.width)??Wi.width)||0,Uo),ve.strokeStyle=We.color||"#64748b",ve.lineWidth=We.width??1;const ls=(We.style||"dashed").toLowerCase();ls==="dashed"||ls==="dotted"?ve.setLineDash(ls==="dashed"?[4,4]:[2,2]):ve.setLineDash([]),ve.stroke(),ve.setLineDash([])});const Fv=Nt.backgroundZones||[];if(Array.isArray(Fv)&&Fv.length)for(const We of Fv){const Uo=Number.isFinite(We.from)?er.convertToPixel(We.from):0,ls=Number.isFinite(We.to)?er.convertToPixel(We.to):(Wa==null?void 0:Wa.height)??Wi.height,Si=Math.min(Uo,ls),bs=Math.abs(ls-Uo);ve.beginPath(),ve.rect(0,Si,((Wa==null?void 0:Wa.width)??Wi.width)||0,bs),ve.fillStyle=We.color||"rgba(34,197,94,0.08)",ve.fill()}return Pu("overlay"),Pu("ui"),ve.restore(),!1}};return bv},Dc=[],Ee=[];Dn.forEach((Nt,Wn)=>{var ss,ds,yn,wo,si,ir,Ji;const Co=Ql(Nt,Wn);try{H_(Co)}catch(el){console.debug("Script indicator register error",el)}const mo=Nt.pane==="main"?"candle_pane":`pane_script_${Wn}`;Ee[Wn]=mo;const Bo=Nt.pane==="main",ws=typeof Nt.min=="number"&&typeof Nt.max=="number",$o=Nt.pane==="sub"?{gap:ws?{top:0,bottom:0}:{top:2,bottom:2}}:void 0;let _i=Oe.createIndicator(Co.name,Bo,{id:mo,height:typeof Nt.height=="number"&&Number.isFinite(Nt.height)?Nt.height:Nt.pane==="sub"?((ss=B==null?void 0:B.sub)==null?void 0:ss.height)??(B==null?void 0:B.height)??200:((ds=B==null?void 0:B.main)==null?void 0:ds.height)??(B==null?void 0:B.height)??void 0,axis:$o});if(_i||(_i=Oe.createIndicator(Co,Bo,{id:mo,height:typeof Nt.height=="number"&&Number.isFinite(Nt.height)?Nt.height:Nt.pane==="sub"?((yn=B==null?void 0:B.sub)==null?void 0:yn.height)??(B==null?void 0:B.height)??200:((wo=B==null?void 0:B.main)==null?void 0:wo.height)??(B==null?void 0:B.height)??void 0,axis:$o})),!_i)throw new Error("Unable to render script indicator.");zn.push(_i),un.push(Co.name),se.push({def:Co,paneId:mo}),ws?(Gs.set(mo,{min:Nt.min,max:Nt.max}),hi(mo),li(mo)):Gs.delete(mo);try{Oe.createOverlay({name:"script-layer",visible:!0,lock:!0,groupId:"runtime"})}catch{}const Ar=(Ji=Co.calc)==null?void 0:Ji.call(Co,((ir=(si=i())==null?void 0:si.getDataList)==null?void 0:ir.call(si))||[],{calcParams:[]}),Da=Array.isArray(Ar)?Ar:Array.isArray(Ar==null?void 0:Ar.__rows)?Ar.__rows:[],Oo=s(Zt)?Da.reduce((el,Dd)=>el+Object.keys(Dd||{}).filter(Ma=>Ma.startsWith("__label_")).length,0):0;Dc.push(Oo)});try{const Nt=se.find(Wn=>Wn.paneId==="candle_pane");x(On,N(((yo=Nt==null?void 0:Nt.def)==null?void 0:yo.name)||(($s=(es=se[0])==null?void 0:es.def)==null?void 0:$s.name)||null))}catch{x(On,null)}try{const Nt=((oi=Oe.getDataList)==null?void 0:oi.call(Oe))||[],Wn=yn=>{const wo=typeof yn=="number"?yn:Number(yn);return Number.isFinite(wo)?wo:void 0},Co=Nt.map(yn=>{const wo=Wn((yn==null?void 0:yn.close)??(yn==null?void 0:yn.c)??(yn==null?void 0:yn.price));return Wn((yn==null?void 0:yn.high)??(yn==null?void 0:yn.h))??wo}),mo=Nt.map(yn=>{const wo=Wn((yn==null?void 0:yn.close)??(yn==null?void 0:yn.c)??(yn==null?void 0:yn.price));return Wn((yn==null?void 0:yn.low)??(yn==null?void 0:yn.l))??wo}),Bo=Nt.map(yn=>Wn((yn==null?void 0:yn.close)??(yn==null?void 0:yn.c)??(yn==null?void 0:yn.price))),ws=(yn,wo)=>{const si=yn[wo];return typeof si=="number"&&Number.isFinite(si)?si:null},$o=(yn,wo)=>{const si=Nt.length;if(si<=0)return null;const ir=Math.max(1,Math.floor(wo.left)),Ji=Math.max(1,Math.floor(wo.right)),el=Math.max(2,Math.floor(wo.lookback)),Dd=si-1,Ma=Math.max(0,Dd-el+1),jl=Math.max(0,Dd-Ji);if(jl<Ma)return null;const gc=yn==="high"?Co:mo,Qi=[];for(let Wl=Ma+ir;Wl<=jl;(Wl+=1)-1){const Fc=ws(gc,Wl);if(Fc==null)continue;let zc=!0;for(let gu=Wl-ir;gu<=Wl+Ji;(gu+=1)-1){if(gu===Wl)continue;const ku=ws(gc,gu);if(ku==null){zc=!1;break}if(yn==="high"){if(ku>=Fc){zc=!1;break}}else if(ku<=Fc){zc=!1;break}}zc&&Qi.push(Wl)}if(!Qi.length)return null;const Kd=Math.trunc(wo.which);if(Kd===0)return Qi[Qi.length-1];if(Kd<0){const Wl=Qi.length+Kd;return Wl>=0?Qi[Wl]:null}const Gc=Kd-1;return Gc>=0&&Gc<Qi.length?Qi[Gc]:null},_i=(yn,wo)=>{const si=Nt.length;if(si<=0)return null;const ir=Math.max(2,Math.floor(wo.lookback)),Ji=si-1,el=Math.max(0,Ji-ir+1),Dd=yn==="high"?Co:mo;let Ma=null,jl=yn==="high"?-1/0:1/0;for(let gc=el;gc<=Ji;(gc+=1)-1){const Qi=ws(Dd,gc);Qi!=null&&(yn==="high"?Qi>jl&&(jl=Qi,Ma=gc):Qi<jl&&(jl=Qi,Ma=gc))}return Ma},Ar=yn=>{const wo=typeof yn=="number"?yn:Number(yn);if(!Number.isFinite(wo))return null;const si=Nt.length,ir=wo<0?si+Math.trunc(wo):Math.trunc(wo);return ir<0||ir>=si?null:ir},Da=yn=>{var el,Dd;if(!yn||typeof yn!="object")return null;if(yn.pivot){const Ma=String(yn.pivot).toLowerCase()==="low"?"low":"high",jl=$o(Ma,{left:Number(yn.left??yn.pivotLeft??3),right:Number(yn.right??yn.pivotRight??3),lookback:Number(yn.lookback??400),which:Number(yn.which??-1)});jl!=null&&(yn={index:jl,source:Ma})}else if(yn.extreme){const Ma=String(yn.extreme).toLowerCase()==="low"?"low":"high",jl=_i(Ma,{lookback:Number(yn.lookback??400)});jl!=null&&(yn={index:jl,source:Ma})}const wo=Ar(yn.index),si=typeof yn.timestamp=="number"&&Number.isFinite(yn.timestamp)?yn.timestamp:wo!=null?((el=Nt[wo])==null?void 0:el.timestamp)??((Dd=Nt[wo])==null?void 0:Dd.time)??null:null;let ir=typeof yn.value=="number"&&Number.isFinite(yn.value)?yn.value:null;if(ir==null&&wo!=null&&yn.source){const Ma=String(yn.source||"").replace(/\s+/g,"_").toLowerCase(),jl=Nt[wo],gc=Ma==="open"?jl==null?void 0:jl.open:Ma==="high"?jl==null?void 0:jl.high:Ma==="low"?jl==null?void 0:jl.low:Ma==="close"?jl==null?void 0:jl.close:Ma==="volume"?jl==null?void 0:jl.volume:null;typeof gc=="number"&&Number.isFinite(gc)&&(ir=gc)}const Ji={};return si!=null&&(Ji.timestamp=si),ir!=null&&(Ji.value=ir),wo!=null&&(Ji.__index=wo),Object.keys(Ji).length?Ji:null},Oo=[];Dn.forEach((yn,wo)=>{(Array.isArray(yn.overlays)?yn.overlays:[]).forEach(ir=>Oo.push({paneId:Ee[wo]||(yn.pane==="main"?"candle_pane":"pane_script"),overlay:ir}))});let ss=0;const ds=[];Oo.forEach(({paneId:yn,overlay:wo})=>{try{const si=String((wo==null?void 0:wo.name)||"").trim();if(!si)return;const Ji=(Array.isArray(wo==null?void 0:wo.points)?wo.points:[]).map(Da).filter(Boolean),el={name:si,paneId:(wo==null?void 0:wo.pane)==="main"?"candle_pane":((wo==null?void 0:wo.pane)==="sub",yn),groupId:"runtime",lock:(wo==null?void 0:wo.lock)===!0,visible:(wo==null?void 0:wo.visible)!==!1,points:Ji};wo!=null&&wo.styles&&(el.styles=wo.styles),wo!=null&&wo.extendData&&(el.extendData=wo.extendData),Oe.createOverlay(el),ss+=1}catch(si){ds.push(String((si==null?void 0:si.message)||si))}});try{const yn=Array.isArray(mt)?mt:[];for(const wo of yn){const si=String((wo==null?void 0:wo.type)||"").trim().toLowerCase();if(si!=="auto_fib"&&si!=="autofib"||!(wo.draw===!0||wo.autoDraw===!0)||Nt.length<2)continue;const Ji=Math.max(2,Math.floor(Number(wo.lookback)||200)),Dd=String(wo.direction||"up").trim().toLowerCase()==="down"?"down":"up",Ma=String(wo.method||wo.mode||"extremes").trim().toLowerCase(),jl=Ma==="pivots"||Ma==="pivot"||Ma==="swing"?"pivots":"extremes",gc=Math.max(1,Math.floor(Number(wo.pivotLeft??wo.left??3))),Qi=Math.max(1,Math.floor(Number(wo.pivotRight??wo.right??3))),Kd=Zw(Co,mo,Bo,Nt.length-1,{lookback:Ji,direction:Dd,method:jl,pivotLeft:gc,pivotRight:Qi});if(!Kd)continue;const Gc=Nt[Kd.fromIndex],Wl=Nt[Kd.toIndex],Fc=(Gc==null?void 0:Gc.timestamp)??(Gc==null?void 0:Gc.time)??null,zc=(Wl==null?void 0:Wl.timestamp)??(Wl==null?void 0:Wl.time)??null;if(Fc==null||zc==null)continue;const gu=wo.levels,ku=Array.isArray(gu)&&gu.length?gu.map(Md=>{if(typeof Md=="number")return{value:Md,color:"#64748b",label:String(Md)};if(Md&&typeof Md=="object"){const gp=typeof Md.value=="number"?Md.value:Number(Md.value);return Number.isFinite(gp)?{value:gp,color:String(Md.color||"#64748b"),label:String(Md.label??gp)}:null}return null}).filter(Boolean):[{value:0,color:"#64748b",label:"0"},{value:.382,color:"#60a5fa",label:"0.382"},{value:.5,color:"#22c55e",label:"0.5"},{value:.618,color:"#f59e0b",label:"0.618"},{value:1,color:"#64748b",label:"1"}];Oe.createOverlay({name:"fibonacciSegment",paneId:"candle_pane",groupId:"runtime",lock:!1,visible:!0,points:[{timestamp:Fc,value:Kd.fromValue},{timestamp:zc,value:Kd.toValue}],extendData:{fibonacciLevels:ku}}),ss+=1}}catch(yn){ds.push(String((yn==null?void 0:yn.message)||yn))}ss&&x(Ne,`${s(Ne)||"Plotted"} • overlays: ${ss}`),ds.length&&x(ue,`Overlay error: ${ds.slice(0,2).join(" • ")}`)}catch(Nt){console.error("[ScriptStudio] overlay create error",Nt)}try{const Nt=se.find(Wn=>Wn.paneId==="candle_pane");x(On,N(((Ts=Nt==null?void 0:Nt.def)==null?void 0:Ts.name)||((Vr=(hr=se[0])==null?void 0:hr.def)==null?void 0:Vr.name)||null))}catch{x(On,null)}const ac=Dn.map(Nt=>Nt.pane).join("+"),Ia=Dc.reduce((Nt,Wn)=>Nt+Wn,0);if(x(Ne,`Plotted (${ac}) • labels: ${s(Zt)?Ia:"off"}`),Ia===0)try{const Nt=Dn.reduce((Bo,ws)=>Bo+(ws.plots||[]).length,0),Wn=[];Nt===0&&Wn.push("Pane has no plots");const Co=new Set(["open","high","low","close","volume","time","bar_index","barstate_isfirst","barstate_islast","barstate_islastconfirmedhistory","barstate_isconfirmed","barstate_isrealtime","barstate_ishistory","barstate_isnew","timeframe_multiplier","timeframe_seconds","timeframe_isseconds","timeframe_isminutes","timeframe_ishours","timeframe_isdaily","timeframe_isweekly","timeframe_ismonthly","timeframe_isyearly","timeframe_isintraday","timeframe_period","syminfo_mintick","syminfo_pointvalue","syminfo_tickerid","syminfo_ticker","syminfo_root","syminfo_prefix","syminfo_exchange","syminfo_description","syminfo_type","syminfo_currency","syminfo_timezone","syminfo_session","syminfo_isdelayed","strategy_position_size","strategy_position_avg_price","strategy_opentrades","strategy_closedtrades","strategy_openprofit","strategy_closedprofit","strategy_grossprofit","strategy_grossloss","strategy_wintrades","strategy_losstrades","strategy_winrate","strategy_max_drawdown","strategy_max_drawdown_value","strategy_max_runup","strategy_max_runup_value","strategy_avg_trade","strategy_avg_win","strategy_avg_loss","strategy_avg_bars_in_trade","strategy_equity","strategy_netprofit","strategy_initial_capital"]),mo=(Bo,ws)=>{const $o=(Bo||"").toLowerCase(),_i=ws.replace(/\s+/g,"_").toLowerCase();return $o==="bbands"||$o==="bollinger"||$o==="bollinger_bands"||$o==="kc"||$o==="keltner"||$o==="donchian"||$o==="linreg_channel"?[`${_i}_mid`,`${_i}_upper`,`${_i}_lower`]:$o==="atr_bands"?[`${_i}_upper`,`${_i}_lower`]:$o==="stoch"?[`${_i}_k`,`${_i}_d`]:$o==="macd"?["macd_line","macd_signal","macd_hist"]:$o==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"]:[_i]};if(mt.forEach(Bo=>{const ws=String((Bo==null?void 0:Bo.name)||(Bo==null?void 0:Bo.type)||"").replace(/\s+/g,"_").toLowerCase();mo(String((Bo==null?void 0:Bo.type)||""),ws).forEach($o=>Co.add($o))}),_n.forEach(Bo=>{const ws=String((Bo==null?void 0:Bo.name)||"").replace(/\s+/g,"_").toLowerCase();ws&&Co.add(ws)}),Dn.forEach((Bo,ws)=>{(Bo.labels||[]).forEach(($o,_i)=>{const Ar=String(($o==null?void 0:$o.when)||"").trim();if(!Ar){Wn.push(`Label[${ws}:${_i}] has empty condition`);return}try{const Da=B!=null&&B.params&&typeof B.params=="object"?B.params:{},Oo=Ar.replace(/\$\{([^}]+)\}/g,(ir,Ji)=>{const el=Da[Ji],Dd=typeof el=="number"?el:Number(el);return Number.isFinite(Dd)?String(Dd):"0"}),ss=cd(Oo),ds=Lg(ss),yn=[],wo=ir=>{!ir||typeof ir!="object"||(ir.kind==="SeriesRef"&&yn.push(String(ir.name||"")),Object.values(ir).forEach(wo))};wo(ds);const si=yn.filter(ir=>!Co.has(ir.replace(/\s+/g,"_").toLowerCase())&&!["open","high","low","close","volume"].includes(ir.replace(/\s+/g,"_").toLowerCase()));si.length&&Wn.push(`Label[${ws}:${_i}] unknown series: ${si.join(", ")}`)}catch(Da){const Oo=(Da==null?void 0:Da.position)!=null?` at ${Da.position}`:"",ss=Da!=null&&Da.message?String(Da.message):String(Da);Wn.push(`Label[${ws}:${_i}] parse failed${Oo}: ${ss}`)}})}),Wn.length){const Bo=Wn.join(" • ");x(ue,N(s(ue)?`${s(ue)} • ${Bo}`:Bo))}else x(Ne,"No label signals matched")}catch{}di();try{oe&&(clearInterval(oe),oe=null)}catch{}ks()}function ot(B){const de=String(B||"").split(/\r?\n/),Oe=Math.min(8,de.length);for(let Ue=0;Ue<Oe;(Ue+=1)-1){const _n=(de[Ue]||"").match(/^\s*(?:\/\/|#)\s*@?(?:lang|language)\s*(?::|=)?\s*([A-Za-z]+)\s*$/i);if(!_n)continue;const en=String(_n[1]||"").toLowerCase();if(en==="auto"||en==="json"||en==="pine"||en==="dsl")return en}return null}function je(B,de){return de&&de!=="auto"?de:ot(B)||"auto"}async function Ft(B,de,Oe,Ue){var Vn,Rn,xo,Dn,ys,jn;x(ue,null),x(Ne,"Running..."),x(he,!0),_t+=1,vF(),jt=Ue&&typeof Ue=="object"?{...Ue}:null,Wt=(()=>{if(!jt)return"";const Sn=jt,Un=Sn.from??"",$n=Sn.to??"",ms=Sn.session??"";return`${Un}|${$n}|${ms}`})();let mt="parse",_n=Oe||void 0,en;try{let Sn=null;const Un=String(B||""),$n=Un.trim(),ms=je(Un,Oe);_n=ms;const Wo=$n.startsWith("{")||$n.startsWith("["),Yo=An=>{try{return JSON.parse(An)}catch{return null}},Po=An=>An&&typeof An=="object"&&(An.plots||An.calc||An.series||An.signals||An.strategy||An.labels||An.levels||An.lines||An.overlays||An.panes||An.main||An.sub);if(ms==="json"){const An=Yo($n);if(!An){x(ue,"Invalid JSON: expected a script spec object"),x(Ne,"Validation failed");return}if(!Po(An)){x(ue,"JSON mode expects a script spec object"),x(Ne,"Validation failed");return}try{const Ro=An&&typeof An=="object"?An.params||{}:{},vn=K1(An,Ro);let on=vn;try{on=X1(vn)}catch(fo){const Bn=fo instanceof Error?fo.message:String(fo);x(ue,`Template expansion error: ${Bn}`),x(Ne,"Validation failed");return}en=String(on&&(on.shortName||on.name||on.title)||"").trim()||void 0,mt="normalize";const rn=Y1(on);if(rn.ok&&rn.spec)Ue&&typeof Ue=="object"&&(on.strategy={...on.strategy||{},...Ue}),mt="draw",await De(on,"json"),x(Ne,"Plotted from JSON");else{const fo=(rn.errors||[]).join("; ");x(ue,N(fo?`Schema validation failed: ${fo}`:"Schema validation failed")),x(Ne,"Validation failed");return}}catch(Ro){const vn=Ro instanceof Error?Ro.message:String(Ro);x(ue,`Schema validation error: ${vn}`),x(Ne,"Validation failed");return}return}if(ms==="pine"){const An=g_(B);if(An.ok){try{const Ro=An.spec&&typeof An.spec=="object"?An.spec.params||{}:{},vn=de&&typeof de=="object"?{...Ro,...de}:Ro;An.spec.params=vn}catch{}en=String(((Vn=An.spec)==null?void 0:Vn.shortName)||((Rn=An.spec)==null?void 0:Rn.name)||((xo=An.spec)==null?void 0:xo.title)||"").trim()||void 0,Ue&&typeof Ue=="object"&&(An.spec.strategy={...An.spec.strategy||{},...Ue}),mt="draw",await De(An.spec,"pine"),x(Ne,"Plotted from Pine")}else x(ue,N((An.errors||[]).slice(0,6).map(Ro=>`Line ${Ro.line}: ${Ro.message}`).join(" • "))),x(Ne,"Validation failed");return}if(ms==="dsl"){const An=P2(B),Ro={calc:[],series:An.series,panes:An.panes,signals:An.signals,params:de&&typeof de=="object"?{...An.params,...de}:An.params};en=String(Ro.shortName||Ro.name||Ro.title||"").trim()||void 0,Ue&&typeof Ue=="object"&&(Ro.strategy={...Ro.strategy||{},...Ue}),mt="draw",await De(Ro,"dsl"),x(Ne,"Plotted from DSL");return}if(Wo)try{Sn=JSON.parse($n)}catch(An){const Ro=String((An==null?void 0:An.message)||"Invalid JSON");x(ue,`Invalid JSON: ${Ro}`),x(Ne,"Validation failed");return}else try{Sn=JSON.parse($n)}catch{}if(Po(Sn))try{const An=Sn&&typeof Sn=="object"?Sn.params||{}:{},Ro=K1(Sn,An);let vn=Ro;try{vn=X1(Ro)}catch(rn){const fo=rn instanceof Error?rn.message:String(rn);x(ue,`Template expansion error: ${fo}`),x(Ne,"Validation failed");return}en=String(vn&&(vn.shortName||vn.name||vn.title)||"").trim()||void 0,mt="normalize";const on=Y1(vn);if(on.ok&&on.spec)Ue&&typeof Ue=="object"&&(vn.strategy={...vn.strategy||{},...Ue}),mt="draw",await De(vn,"json");else{const rn=(on.errors||[]).join("; ");x(ue,N(rn?`Schema validation failed: ${rn}`:"Schema validation failed")),x(Ne,"Validation failed");return}}catch(An){const Ro=An instanceof Error?An.message:String(An);x(ue,`Schema validation error: ${Ro}`),x(Ne,"Validation failed");return}else try{const An=g_(B);if(An.ok){try{const on=An.spec&&typeof An.spec=="object"?An.spec.params||{}:{},rn=de&&typeof de=="object"?{...on,...de}:on;An.spec.params=rn}catch{}Ue&&typeof Ue=="object"&&(An.spec.strategy={...An.spec.strategy||{},...Ue}),await De(An.spec,"pine"),x(Ne,"Plotted from Pine");return}else{const on=(An.errors||[]).filter(rn=>String((rn==null?void 0:rn.message)||"")!=="Not a Pine-like script");if(on.length){x(ue,N(on.slice(0,6).map(rn=>`Line ${rn.line}: ${rn.message}`).join(" • "))),x(Ne,"Validation failed");return}}const Ro=P2(B),vn={calc:[],series:Ro.series,panes:Ro.panes,signals:Ro.signals,params:de&&typeof de=="object"?{...Ro.params,...de}:Ro.params};en=String(vn.shortName||vn.name||vn.title||"").trim()||void 0,Ue&&typeof Ue=="object"&&(vn.strategy={...vn.strategy||{},...Ue}),mt="draw",await De(vn,"dsl"),x(Ne,"Plotted from DSL")}catch{const Ro=Ho(B),vn=i();if(!vn)throw new Error("Chart not ready yet. Please try again in a moment.");we(vn);const on=`${dn}_${Date.now()}`,rn=Eo(Ro,on);try{H_(rn)}catch(bi){console.debug("Script indicator register error",bi)}const fo=s(no)==="main"?"candle_pane":"pane_script",Bn=s(no)==="main";let Io=vn.createIndicator(rn.name,Bn,{id:fo,axis:s(no)==="sub"?{gap:{top:2,bottom:2}}:void 0});if(Io||(Io=vn.createIndicator(rn,Bn,{id:fo,axis:s(no)==="sub"?{gap:{top:2,bottom:2}}:void 0})),!Io)throw new Error("Unable to render script indicator.");zn.push(Io),un.push(rn.name),x(On,N(rn.name));const Gn=((jn=rn.calc)==null?void 0:jn.call(rn,((ys=(Dn=i())==null?void 0:Dn.getDataList)==null?void 0:ys.call(Dn))||[],{calcParams:[Ro.window]}))||[],ti=Gn.filter(bi=>bi==null?void 0:bi.topSignal).length,Ds=Gn.filter(bi=>bi==null?void 0:bi.botSignal).length;x(Ne,`Plotted (WIN=${Ro.window}) • ▲ ${ti} / ▼ ${Ds}`)}}catch(Sn){const Un=Sn instanceof Error?Sn.message:"Script failed to run.";x(ue,N(Un)),x(Ne,null);try{we(i())}catch{}$W({scriptId:en,format:_n,stage:mt,message:Un,stack:Sn instanceof Error?Sn.stack:void 0}),console.error("[ScriptStudio] run failed",Sn)}finally{x(he,!1)}W==null||W.restore()}function Be(){const B=i();try{we(B)}catch{}try{B==null||B.removeOverlay({groupId:"runtime"})}catch{}try{B==null||B.removeOverlay({name:"script-layer"})}catch{}se=[];try{oe&&(clearInterval(oe),oe=null)}catch{}try{W&&D&&W.clearRect(0,0,D.width,D.height)}catch{}try{SK()}catch{}try{IK()}catch{}x(Ne,"Reset"),x(ue,null),x(he,!1),x(On,null),jt=null,Wt=""}function xt(){typeof requestAnimationFrame>"u"||requestAnimationFrame(()=>{tn.request(()=>{var Oe,Ue;if(!i())return;i().resize(),window.__forceApplySavedCanvasColors=!0;const B=wu(o().theme);Mn.merge(B,Cm(o().styles)),i().setStyles($d(B)),qt();const de=(Ue=(Oe=i()).getVisibleRange)==null?void 0:Ue.call(Oe);de&&typeof de.to=="number"&&setTimeout(()=>{i()&&i().scrollToDataIndex(de.to,0)},30)})})}function an(){x(ct,!0),xt()}function Yn(){x(ct,!1),x(kt,!1),xt()}const bn=()=>{window.removeEventListener("mousemove",tt),window.removeEventListener("touchmove",tt),window.removeEventListener("mouseup",wt),window.removeEventListener("touchend",wt)};function be(B){if(!s(ct))return;const de="touches"in B?B.touches[0]:B,{clientY:Oe}=de;yt=Oe,xe=s(bt),x(Qe,!0),window.addEventListener("mousemove",tt),window.addEventListener("touchmove",tt,{passive:!1}),window.addEventListener("mouseup",wt),window.addEventListener("touchend",wt),B.preventDefault()}function tt(B){var en;if(!s(Qe))return;const de="touches"in B?B.touches[0]:B,Oe=(en=s(Fe))==null?void 0:en.getBoundingClientRect();if(!Oe)return;const Ue=yt-de.clientY,mt=xe*Oe.height+Ue,_n=Math.min(Pt,Math.max(nt,mt/Oe.height));x(bt,N(_n)),xt(),B.preventDefault()}function wt(){s(Qe)&&(x(Qe,!1),bn(),xt(),setTimeout(()=>{tn.request(()=>{var Oe,Ue;if(!i())return;i().resize(),window.__forceApplySavedCanvasColors=!0;const B=wu(o().theme);Mn.merge(B,Cm(o().styles)),i().setStyles($d(B)),qt();const de=(Ue=(Oe=i()).getVisibleRange)==null?void 0:Ue.call(Oe);de&&typeof de.to=="number"&&setTimeout(()=>{i()&&i().scrollToDataIndex(de.to,0)},30)})},140))}Lm(()=>{if(bn(),oe){try{clearInterval(oe)}catch{}oe=null}});function Lt(B){if(!B)return"";if(Array.isArray(B.colors)&&B.colors.length>0){const de=B.angle||B.direction||0,Oe=B.colors.map(Ue=>`${Ue.color} ${Ue.position}%`).join(", ");return`linear-gradient(${de}deg, ${Oe})`}if(Array.isArray(B.stops)&&B.stops.length>0){const de=B.type==="radial"?"radial":"linear",Oe=B.direction??B.angle??0,mt=[...B.stops].sort((_n,en)=>(_n.position??0)-(en.position??0)).map(_n=>{const en=(_n.color||"").trim(),Vn=_n.position??0,Rn=(_n.opacity??100)/100;if(en.startsWith("#")){const xo=parseInt(en.slice(1,3),16),Dn=parseInt(en.slice(3,5),16),ys=parseInt(en.slice(5,7),16);return`rgba(${xo}, ${Dn}, ${ys}, ${Rn}) ${Vn}%`}if(en.startsWith("rgb(")||en.startsWith("rgba(")){const xo=en.match(/rgba?\(([^)]+)\)/i);if(xo){const Dn=xo[1].split(",").map(Un=>Un.trim()),[ys,jn,Sn]=Dn;return`rgba(${ys}, ${jn}, ${Sn}, ${Rn}) ${Vn}%`}}return`${en} ${Vn}%`});return de==="radial"?`radial-gradient(circle, ${mt.join(", ")})`:`linear-gradient(${Oe}deg, ${mt.join(", ")})`}return""}function qt(){var B,de,Oe,Ue,mt,_n,en,Vn,Rn,xo,Dn,ys;if(!ic){vo=!0;try{const jn=o().styles;if(!jn)return;const Sn=wu(o().theme),Un=Mn.get(Sn,"pane.backgroundColor")||(o().theme==="dark"?"#070211":"#ffffff"),$n=o().theme==="dark"?"#ffffff":"#070211",ms=jn.backgroundType||"solid",Wo=document.querySelector(".kline-main"),Yo=document.querySelector(".kline-widget");let Po="";const Is=ms==="gradient"&&!!jn.backgroundGradient;if(!window.__forceApplyThemeDefaults&&!window.__forceApplySavedCanvasColors&&!Is){const on=rn=>{if(!rn)return"";const fo=rn,Io=(window.getComputedStyle(fo).getPropertyValue("--chart-background-color")||"").trim(),Gn=(fo.style.background||fo.style.backgroundColor||"").trim();return Io||Gn||""};Po=on(Wo)||on(Yo)}if(!window.__forceApplyThemeDefaults&&!window.__forceApplySavedCanvasColors&&!Is&&Po)[Wo,Yo].forEach(on=>{on&&(on.style.background=Po,on.style.backgroundColor=Po,on.style.setProperty("--chart-background-color",Po))}),console.log("🎨 Preserved live preview background:",Po);else if(ms==="solid"){let on=jn.backgroundColor||Un;const rn=(jn.backgroundOpacity??100)/100,fo=typeof jn.backgroundColor=="string"&&jn.backgroundColor.trim().toLowerCase()===$n.toLowerCase(),Bn=!!jn.backgroundType||!!jn.backgroundGradient||typeof jn.backgroundOpacity=="number";fo&&!Bn&&(on=Un);let Io=on;if(rn!==1&&on.startsWith("#")){const Gn=parseInt(on.slice(1,3),16),ti=parseInt(on.slice(3,5),16),Ds=parseInt(on.slice(5,7),16);Io=`rgba(${Gn}, ${ti}, ${Ds}, ${rn})`}[Wo,Yo].forEach(Gn=>{Gn&&(Gn.style.background=Io,Gn.style.backgroundColor=Io,Gn.style.setProperty("--chart-background-color",Io))}),console.log("🎨 Applied saved background color:",Io)}else if(ms==="gradient"&&jn.backgroundGradient){const on=jn.backgroundGradient,rn=on.css||Lt(on);[Wo,Yo].forEach(fo=>{fo&&(fo.style.background=rn,fo.style.backgroundColor=rn,fo.style.setProperty("--chart-background-color",rn))}),console.log("🎨 Applied saved gradient background:",rn)}const An=jn.gridType||"solid",Ro=Mn.get(Sn,"grid.horizontal.color")||(o().theme==="dark"?"#081115":"#F3F3F3"),vn=o().theme==="dark"?"#F3F3F3":"#081115";if(i()&&An==="solid"){const on=((de=(B=i()).getStyles)==null?void 0:de.call(B))??{},rn=window.__forceApplyThemeDefaults||window.__forceApplySavedCanvasColors?void 0:Mn.get(on,"grid.horizontal.color")||Mn.get(on,"grid.vertical.color"),fo=((Ue=(Oe=jn.grid)==null?void 0:Oe.horizontal)==null?void 0:Ue.color)||((_n=(mt=jn.grid)==null?void 0:mt.vertical)==null?void 0:_n.color),Bn=typeof jn.gridOpacity=="number"?jn.gridOpacity:100,Io=Math.max(0,Math.min(100,Bn))/100;let Gn=rn||fo||Ro;const ti=!rn&&typeof fo=="string"&&fo.trim().toLowerCase()===vn.toLowerCase(),Ds=!!jn.gridType||!!jn.gridGradient||typeof jn.gridOpacity=="number";if(ti&&!Ds&&(Gn=Ro),!rn&&typeof Gn=="string"&&Gn.startsWith("#")&&Io!==1){const yl=parseInt(Gn.slice(1,3),16),uc=parseInt(Gn.slice(3,5),16),kr=parseInt(Gn.slice(5,7),16);Gn=`rgba(${yl}, ${uc}, ${kr}, ${Io})`}const bi=Mn.cloneDeep(on);Mn.set(bi,"grid.horizontal.color",Gn),Mn.set(bi,"grid.vertical.color",Gn),(Vn=(en=o().styles)==null?void 0:en.candle)!=null&&Vn.type&&Mn.set(bi,"candle.type",o().styles.candle.type),Xt?Xt($d(bi)):i().setStyles($d(bi)),console.log("🎨 Applied grid color (preserving preview when available):",Gn)}else if(i()&&An==="gradient"&&jn.gridGradient){const on=((xo=(Rn=i()).getStyles)==null?void 0:xo.call(Rn))??{},rn=window.__forceApplyThemeDefaults||window.__forceApplySavedCanvasColors?void 0:Mn.get(on,"grid.horizontal.color")||Mn.get(on,"grid.vertical.color"),fo=jn.gridGradient,Bn=fo.css||Lt(fo),Io=rn||Bn,Gn=Mn.cloneDeep(on);Mn.set(Gn,"grid.horizontal.color",Io),Mn.set(Gn,"grid.vertical.color",Io),(ys=(Dn=o().styles)==null?void 0:Dn.candle)!=null&&ys.type&&Mn.set(Gn,"candle.type",o().styles.candle.type),Xt?Xt($d(Gn)):i().setStyles($d(Gn)),console.log("🎨 Applied gradient grid (preserving preview when available):",Io)}}catch(jn){console.error("Error applying canvas colors:",jn)}finally{vo=!1,window.__forceApplyThemeDefaults&&(window.__forceApplyThemeDefaults=!1),window.__forceApplySavedCanvasColors&&(window.__forceApplySavedCanvasColors=!1)}}}kl(I(),rs(a).applyCanvasColors=qt,rs(a)),yd.setApplyCanvasColorsFunction(qt),En.setApplyCanvasColorsFunction(qt);let qn=null,Xt=null,vo=!1,To=null;mr(()=>{var B;if(i()&&i()!==qn){qn=i(),Xt=i().setStyles.bind(i());const de=i().resize.bind(i());To=((B=i().createIndicator)==null?void 0:B.bind(i()))??null,kl(Ge,rs(i).setStyles=function(Oe){const Ue=Xt(Oe);return vo||tn.request(()=>qt()),Ue},rs(i)),kl(Ge,rs(i).resize=function(){const Oe=de();return tn.request(()=>qt()),Oe},rs(i)),To&&kl(Ge,rs(i).createIndicator=function(Oe,Ue,mt){var xo,Dn,ys;const _n=this;let en=[];try{const jn=(xo=_n.getPaneOptions)==null?void 0:xo.call(_n);Array.isArray(jn)&&(en=jn)}catch{}const Vn=To(Oe,Ue,mt);let Rn=[];try{const jn=(Dn=_n.getPaneOptions)==null?void 0:Dn.call(_n);Array.isArray(jn)&&(Rn=jn)}catch{return Vn}try{const jn=new Set(en.map(Sn=>Sn==null?void 0:Sn.id).filter(Boolean));for(const Sn of Rn){const Un=Sn==null?void 0:Sn.id;if(Un&&!(Un==="candle_pane"||Un==="x_axis_pane")&&!jn.has(Un)&&!Ks()){const $n=typeof Sn.height=="number"&&Sn.height>0?Sn.height:void 0;if($n!==void 0){const ms=$n+100;try{(ys=_n.setPaneOptions)==null||ys.call(_n,{id:Un,height:ms}),console.log("📏 Increased new sub‑pane height by 100px (desktop only)",{paneId:Un,baseHeight:$n,newHeight:ms})}catch{}}}}}catch{}return Vn},rs(i)),console.log("🔧 Chart methods wrapped to preserve canvas colors")}});let co=`${((Rc=o().period)==null?void 0:Rc.timespan)||""}_${((Bc=o().period)==null?void 0:Bc.multiplier)||""}`;mr(()=>{const B=o().period;if(!i()||!B||!B.timespan)return;const Oe={s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month"}[B.timespan]??"day",Ue=Number(B.multiplier)||1,mt=`${Oe}_${Ue}`;if(mt!==co){co=mt;try{i().setPeriod({type:Oe,span:Ue});const _n=wu(o().theme);Mn.merge(_n,Cm(o().styles)),i().setStyles($d(_n))}catch{}}}),console.log("📊 About to define onMount function"),console.log("📊 Browser environment:",T1),console.log("🚀 Attempting to call loadSymbols immediately"),Jo().then(()=>{console.log("✅ loadSymbols completed successfully"),console.log("📊 allSymbols length:",o().allSymbols.length)}).catch(B=>{console.error("❌ loadSymbols failed:",B)}),fv(async()=>{var Vn,Rn,xo,Dn,ys,jn,Sn,Un,$n,ms,Wo,Yo,Po,Is,An,Ro;if(console.log("🚀 onMount started - browser:",T1),console.log("📊 chartRef:",j),!j){console.error("❌ chartRef is not available");return}try{let vn=!1;typeof window<"u"&&(vn=!!localStorage.getItem("chart.activeSaveId")),vn&&hn.set(!0)}catch{}(Rn=(Vn=o().styles)==null?void 0:Vn.candle)!=null&&Rn.type||C().update(vn=>(vn.styles=vn.styles||{},vn.styles.candle=vn.styles.candle||{},vn.styles.candle.type="renko_atr",vn.styles.candle.renko||(vn.styles.candle.renko={method:"ATR",atrLength:14,source:"close",wick:!1}),vn));const B=wu(o().theme),de=Mn.merge({},B,o().styles);if(console.log("🎨 onMount - Theme styles:",JSON.stringify(B,null,2)),console.log("💾 onMount - Saved styles:",JSON.stringify(o().styles,null,2)),console.log("🔄 onMount - Merged styles:",JSON.stringify(de,null,2)),M2(Ge,N(e8(j,{styles:(()=>{var vn,on,rn,fo,Bn,Io,Gn,ti,Ds,bi,yl,uc,kr,Ka,ni,Ca,wa,Pa,Jl,bd,Fo,Ql,Dc,Ee;try{if((on=(vn=de==null?void 0:de.candle)==null?void 0:vn.tooltip)!=null&&on.legend){const ac=de.candle.tooltip.legend.color;de.candle.tooltip.legend.template=({current:Ia})=>{const Pc="#32CD32",Xi="#FF0000",aa=((Ia==null?void 0:Ia.close)??0)>((Ia==null?void 0:Ia.open)??0),Fp=((Ia==null?void 0:Ia.close)??0)<((Ia==null?void 0:Ia.open)??0),ov=aa?Pc:Fp?Xi:ac,U=$e=>({text:$e,color:ov});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:U("{open}")},{title:"H",value:U("{high}")},{title:"L",value:U("{low}")},{title:"C",value:U("{close}")},{title:"V",value:U("{volume}")}]:[{title:"O",value:U("{open}")},{title:"H",value:U("{high}")},{title:"L",value:U("{low}")},{title:"C",value:U("{close}")},{title:"V",value:U("{volume}")}]}}}catch{}try{const ac=(Bn=(fo=(rn=B==null?void 0:B.xAxis)==null?void 0:rn.tickText)==null?void 0:fo.style)==null?void 0:Bn.color,Ia=(ti=(Gn=(Io=B==null?void 0:B.yAxis)==null?void 0:Io.tickText)==null?void 0:Gn.style)==null?void 0:ti.color;if(ac&&((bi=(Ds=de==null?void 0:de.xAxis)==null?void 0:Ds.tickText)!=null&&bi.style)&&(de.xAxis.tickText.style.color=ac,(yl=de==null?void 0:de.xAxis)!=null&&yl.tickText)){delete de.xAxis.tickText.color,delete de.xAxis.tickText.opacity,de.xAxis.tickText.color=ac;try{C().update(aa=>(aa.styles||(aa.styles={}),Mn.unset(aa.styles,"xAxis.tickText.color"),Mn.unset(aa.styles,"xAxis.tickText.opacity"),Mn.set(aa.styles,"xAxis.tickText.style.color",ac),aa))}catch{}}if(Ia&&((kr=(uc=de==null?void 0:de.yAxis)==null?void 0:uc.tickText)!=null&&kr.style)&&(de.yAxis.tickText.style.color=Ia,(Ka=de==null?void 0:de.yAxis)!=null&&Ka.tickText)){delete de.yAxis.tickText.color,delete de.yAxis.tickText.opacity,de.yAxis.tickText.color=Ia;try{C().update(aa=>(aa.styles||(aa.styles={}),Mn.unset(aa.styles,"yAxis.tickText.color"),Mn.unset(aa.styles,"yAxis.tickText.opacity"),Mn.set(aa.styles,"yAxis.tickText.style.color",Ia),aa))}catch{}}const Pc=(wa=(Ca=(ni=B==null?void 0:B.candle)==null?void 0:ni.tooltip)==null?void 0:Ca.legend)==null?void 0:wa.color,Xi=(bd=(Jl=(Pa=B==null?void 0:B.indicator)==null?void 0:Pa.tooltip)==null?void 0:Jl.legend)==null?void 0:bd.color;if(Pc&&((Ql=(Fo=de==null?void 0:de.candle)==null?void 0:Fo.tooltip)!=null&&Ql.legend)){de.candle.tooltip.legend.color=Pc;try{C().update(aa=>(aa.styles||(aa.styles={}),Mn.set(aa.styles,"candle.tooltip.legend.color",Pc),aa))}catch{}}if(Xi&&((Ee=(Dc=de==null?void 0:de.indicator)==null?void 0:Dc.tooltip)!=null&&Ee.legend)){de.indicator.tooltip.legend.color=Xi;try{C().update(aa=>(aa.styles||(aa.styles={}),Mn.set(aa.styles,"indicator.tooltip.legend.color",Xi),aa))}catch{}}}catch{}try{const ac=de.crosshair??{},Ia=ac.vertical??{},Pc=Ia.text??{};de.crosshair={...ac,show:ac.show??!0},de.crosshair.vertical={...Ia,show:Ia.show??!0},de.crosshair.vertical.text={...Pc,show:!0}}catch{}return $d(de)})(),decimalFold:{threshold:999,format:_},formatter:{formatDate:({timestamp:vn,template:on,type:rn})=>ib(o().period.timespan)(vn,on,rn)}}))),i()){const vn=fo=>(fo||"").toUpperCase(),on=fo=>{var Gn,ti;const Bn=(ti=(Gn=o().allSymbols)==null?void 0:Gn.find)==null?void 0:ti.call(Gn,Ds=>vn(Ds.ticker)===vn(fo));return Bn!=null&&Bn.name?Bn.name:{GP:"Grameen Phone",DSEBD:"DSE Board Index",DSEX:"Dhaka Stock Exchange"}[vn(fo)]||""},rn={...o().symbol,ticker:o().symbol.ticker,name:o().symbol.name||on(o().symbol.ticker)||o().symbol.ticker,pricePrecision:V0(o().symbol),volumePrecision:o().symbol.volumePrecision};i().setSymbol(rn);try{const fo=o().period;if(fo!=null&&fo.timespan&&(fo!=null&&fo.multiplier)){const Io={second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month",year:"year",s:"second",m:"minute",h:"hour",d:"day",w:"week"}[fo.timespan]??"day",Gn=Number(fo.multiplier)||1;i().setPeriod({type:Io,span:Gn})}}catch{}}if(di(),i()){const vn=on=>{var ti,Ds,bi,yl;const rn=typeof on=="object"&&on&&"paneId"in on?on.paneId:void 0;if(!rn)return;const fo=rn.startsWith("pane_script")||se.some(uc=>uc.paneId===rn),Bn=fo?$i(rn):null,Io=(Ds=(ti=Bn==null?void 0:Bn.axis)==null?void 0:ti.getRange)==null?void 0:Ds.call(ti),Gn=(yl=(bi=Bn==null?void 0:Bn.axis)==null?void 0:bi.getAutoCalcTickFlag)==null?void 0:yl.call(bi);Gs.has(rn)&&li(rn),fo&&requestAnimationFrame(()=>{var uc,kr,Ka,ni,Ca,wa;Bn!=null&&Bn.axis&&Io&&fo&&((kr=(uc=Bn.axis).setRange)==null||kr.call(uc,Io),(ni=(Ka=Bn.axis).buildTicks)==null||ni.call(Ka,!0),Gn&&((wa=(Ca=Bn.axis).setAutoCalcTickFlag)==null||wa.call(Ca,!0)))})};(Dn=(xo=i()).subscribeAction)==null||Dn.call(xo,am.OnPaneDrag,vn),fi=()=>{var on,rn;return(rn=(on=i())==null?void 0:on.unsubscribeAction)==null?void 0:rn.call(on,am.OnPaneDrag,vn)}}try{const vn=(jn=(ys=o().styles)==null?void 0:ys.candle)==null?void 0:jn.type;i()&&(vn==="renko_atr"||vn==="point_and_figure"||vn==="heikin_ashi")&&yd.switchChartType({chart:i(),newType:vn,reloadDataFn:async()=>{await Qr()}})}catch{}if(i()){const vn=new kV(i()),on=new CV(i()),rn=new PV(i()),fo=Ww(i()),Bn=FV(fo);on.setProjectionManager(vn),on.setCreationManager(rn),on.initialize(),console.log("Enhanced overlay system initialized with templates:",Object.keys(Bn)),go=hT({chart:i(),persistenceKey:o().key+"_drawings",onDrawingCreated:Gn=>{console.log("✅ Drawing created:",Gn.id,"for symbol:",Gn.symbolKey)},onDrawingRemoved:(Gn,ti)=>{console.log("🗑️ Drawing removed:",Gn,"from symbol:",ti)},onSymbolChanged:(Gn,ti)=>{console.log("🔄 Symbol changed in DrawingManager:",Gn,"→",ti)}});const Io=ig(o().symbol);go.setCurrentSymbol(Io),rn.setCurrentSymbolKey(Io),typeof window<"u"&&(window.overlayCreationManager=rn),console.log("✅ DrawingManager initialized for symbol:",Io)}kl(I(),rs(a).cloudIndLoaded+=1,rs(a)),yb.set(o().symbol),W1.set(o().period),console.log("🚀 About to call loadSymbols from onMount"),await Jo(),console.log("✅ loadSymbols completed from onMount");try{window.__datafeed=w,window.__pipelineMetrics=()=>{var vn;return(vn=w.getPipelineMetrics)==null?void 0:vn.call(w)}}catch{}window.addEventListener("resize",eu);let Oe=i();try{Yd=new ResizeObserver(()=>{eu()}),j&&Yd.observe(j),s(Fe)&&Yd.observe(s(Fe)),s(Me)&&Yd.observe(s(Me))}catch{}const Ue=()=>{},mt=()=>{},_n=vn=>{var Gn,ti;const on=!vn||vn&&vn.x==null&&vn.y==null;if(!on&&vn&&typeof vn.x=="number"&&typeof vn.y=="number"&&(x(Zc,N(vn.x)),x(ce,N(vn.y)),Z.length&&gs()),!on||!j)return;const rn=j.getBoundingClientRect();if(!(s(st)>=rn.left&&s(st)<=rn.right&&s(ge)>=rn.top&&s(ge)<=rn.bottom))return;const Bn=s(st)-rn.left,Io=s(ge)-rn.top;try{(ti=(Gn=i())==null?void 0:Gn.getChartStore)==null||ti.call(Gn).setCrosshair({x:Bn,y:Io,paneId:"candle_pane"},{forceInvalidate:!0})}catch{}};if(i()&&((Un=(Sn=i()).subscribeAction)==null||Un.call(Sn,am.OnZoom,Ue),(ms=($n=i()).subscribeAction)==null||ms.call($n,am.OnScroll,mt),(Yo=(Wo=i()).subscribeAction)==null||Yo.call(Wo,am.OnCrosshairChange,_n),zl=()=>{var vn,on;return(on=(vn=i())==null?void 0:vn.unsubscribeAction)==null?void 0:on.call(vn,am.OnZoom,Ue)},Gd=()=>{var vn,on;return(on=(vn=i())==null?void 0:vn.unsubscribeAction)==null?void 0:on.call(vn,am.OnScroll,mt)},lu=()=>{var vn,on;return(on=(vn=i())==null?void 0:vn.unsubscribeAction)==null?void 0:on.call(vn,am.OnCrosshairChange,_n)}),setTimeout(()=>{var vn,on;if(Oe)try{const rn=((vn=Oe.getDataList)==null?void 0:vn.call(Oe))??[];Array.isArray(rn)&&rn.length>0&&x(ee,!0);const fo=(on=Oe.getVisibleRange)==null?void 0:on.call(Oe);(Array.isArray(rn)&&rn.length>0&&fo&&typeof fo.to=="number"?fo.to>=rn.length-2:!1)&&Oe.scrollToRealTime()}catch{}},100),al){try{al()}catch{}al=null}al=so(Oe);const en=wu(o().theme);Mn.merge(en,Cm(o().styles)),(Po=i())==null||Po.setStyles($d(en)),qt();try{const vn=()=>{var ti,Ds,bi,yl,uc,kr,Ka,ni,Ca,wa,Pa,Jl,bd;if(!i())return;const Bn=i();let Io=[];try{Io=((ti=Bn.getIndicators)==null?void 0:ti.call(Bn))??[]}catch{Io=[]}const Gn=Object.entries(o().saveInds||{});for(const[,Fo]of Gn){const Ql=Fo==null?void 0:Fo.name;if(!Ql)continue;const Dc=(Fo==null?void 0:Fo.pane_id)||"";if(Io.some(Xi=>Xi.name===Ql&&(!Dc||Xi.paneId===Dc)))continue;let ac;if(Array.isArray(Fo.styles)&&Fo.styles.length>0){const Xi=aa=>aa==="dashed"||aa==="dotted"?{style:Ke.Dashed,dashedValue:aa==="dotted"?[2,2]:[4,4]}:{style:Ke.Solid,dashedValue:[2,2]};ac={lines:Fo.styles.map(aa=>{const Fp=Xi(aa==null?void 0:aa.lineStyle);return{color:aa==null?void 0:aa.color,size:(aa==null?void 0:aa.thickness)??1,style:Fp.style,dashedValue:Fp.dashedValue}})}}let Ia;if(Ql==="SMARTTREND"){const Xi=Fo.superTrendGroup;if(Ia=Xi?{showLabels:!!Xi.showLabels,uptrendColor:((bi=(Ds=Xi.styles)==null?void 0:Ds.uptrend)==null?void 0:bi.color)??"#00FF00",downtrendColor:((uc=(yl=Xi.styles)==null?void 0:yl.downtrend)==null?void 0:uc.color)??"#FF0000",uptrendThickness:((Ka=(kr=Xi.styles)==null?void 0:kr.uptrend)==null?void 0:Ka.thickness)??1,downtrendThickness:((Ca=(ni=Xi.styles)==null?void 0:ni.downtrend)==null?void 0:Ca.thickness)??1,uptrendLineStyle:((Pa=(wa=Xi.styles)==null?void 0:wa.uptrend)==null?void 0:Pa.lineStyle)??"dashed",downtrendLineStyle:((bd=(Jl=Xi.styles)==null?void 0:Jl.downtrend)==null?void 0:bd.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},!ac){const aa=Ia.uptrendLineStyle==="dotted"||Ia.uptrendLineStyle==="dashed";ac={lines:[{color:Ia.uptrendColor,size:Ia.uptrendThickness,style:aa?Ke.Dashed:Ke.Solid,dashedValue:Ia.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}const Pc=Dc==="candle_pane";try{Bn.createIndicator({name:Ql,calcParams:Fo==null?void 0:Fo.params,styles:ac,...Ia?{extendData:Ia}:{}},Pc,Dc?{id:Dc}:void 0)}catch(Xi){console.warn("⚠️ Failed to restore indicator:",Ql,Xi)}}};let on=null;try{on=typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null}catch{}console.log(on?"ℹ️ Active layout detected, SaveSystem will restore indicators.":"ℹ️ No active layout, will add default indicators if needed.");const rn=Bn=>{try{if(!i())return;const Io=i();console.log("🎨 Adding default indicators...");const Gn="candle_pane";if(Ki())try{Io.createIndicator({name:"SMARTTREND",calcParams:[10,3],styles:{lines:[{color:"#00FF00",size:1,style:Ke.Dashed,dashedValue:[4,4]}]},extendData:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"}},!0,{id:Gn})&&C().update(Ds=>(Ds.saveInds[`${Gn}_SMARTTREND`]={name:"SMARTTREND",pane_id:Gn,params:[10,3]},Ds))}catch{}try{const ti="candle_pane";Io.createIndicator({name:"VOL",calcParams:[20],styles:{lines:[]}},!0,{id:ti})&&C().update(bi=>(bi.saveInds[`${ti}_VOL`]={name:"VOL",pane_id:ti,params:[20]},bi))}catch{}console.log("✅ Default indicators applied",{force:Bn})}catch(Io){console.warn("⚠️ Failed to add default indicators:",Io)}};let fo=!1;try{const Bn=(Is=performance.getEntriesByType)==null?void 0:Is.call(performance,"navigation");Bn&&Bn.length>0?fo=Bn[0].type==="reload":performance.navigation&&(fo=performance.navigation.type===1)}catch{}C().update(Bn=>(Bn.saveInds={},Bn)),on?(console.log("✅ Active saved layout will be restored by SaveSystem"),setTimeout(()=>{var Bn,Io;try{const Gn=typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null,ti=((Io=(Bn=i())==null?void 0:Bn.getIndicators)==null?void 0:Io.call(Bn))??[];!Gn&&(!ti||ti.length===0)&&(console.log("🛟 No active layout after restore attempt; applying default indicators"),rn(!0))}catch{}},500)):(console.log("🎨 No saved layout found, adding default indicators"),setTimeout(()=>{try{(typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null)?console.log("ℹ️ activeSaveId appeared; skipping default indicators"):rn(!0)}catch{rn(!0)}},250))}catch(vn){console.warn("⚠️ Indicator restore failed:",vn)}if(((Ro=(An=o().styles)==null?void 0:An.candle)==null?void 0:Ro.type)==="point_and_figure"&&i())try{i().createIndicator("PNF",!1,{id:"candle_pane"}),console.log("📊 Added PNF indicator for initial Point & Figure chart")}catch(vn){console.warn("Failed to add initial PNF indicator:",vn)}kl(I(),rs(a).initDone+=1,rs(a)),M()||setTimeout(()=>{i()&&!a().loadingKLine&&(console.log("🔄 Loading initial chart data after initialization"),Qr())},100),Jo(),setTimeout(()=>{console.log("🔍 Current allSymbols:",o().allSymbols),console.log("🔍 allSymbols length:",o().allSymbols.length)},3e3),j==null||j.focus();try{typeof window<"u"&&(window.drawBarRef=s(ye),window.sidebarHostRef=s(Ze),window.predictNextCandle=()=>Xo(),window.getAutoPlayState=()=>s(ei),window.getPlaybackSpeed=()=>s(Ht),window.setPlaybackSpeed=vn=>tr(vn),window.stopPrediction=()=>Yt())}catch{}Pd=vn=>{if(!s1())return;(vn.key==="F5"||(vn.metaKey||vn.ctrlKey)&&(vn.key==="r"||vn.key==="R"))&&(vn.preventDefault(),vn.stopPropagation(),x(Ec,!0))},window.addEventListener("keydown",Pd,{capture:!0}),Ed=vn=>{var on,rn;if(s1()){try{const fo=(((on=o())==null?void 0:on.key)||"chart")+"_drawings";localStorage.removeItem(fo)}catch{}try{const fo=(((rn=o())==null?void 0:rn.key)||"chart")+"_overlays";localStorage.removeItem(fo)}catch{}try{localStorage.removeItem("dataSpaceOverlays")}catch{}vn.preventDefault(),vn.returnValue=""}},window.addEventListener("beforeunload",Ed),setTimeout(()=>{const vn=j==null?void 0:j.querySelectorAll(".klinecharts-pane-separator");vn==null||vn.forEach(on=>{const rn=on;rn.style.transition="background-color 0.2s ease, transform 0.1s ease",rn.addEventListener("mouseenter",()=>{rn.style.cursor="row-resize",rn.style.transform="scaleY(1.2)"}),rn.addEventListener("mouseleave",()=>{rn.style.transform="scaleY(1)"}),rn.addEventListener("mousedown",()=>{rn.classList.add("dragging"),document.body.style.cursor="row-resize"});const fo=()=>{rn.classList.remove("dragging"),document.body.style.cursor=""};document.addEventListener("mouseup",fo),rn.addEventListener("touchstart",Bn=>{Bn.preventDefault(),rn.classList.add("dragging"),"vibrate"in navigator&&navigator.vibrate(10)}),rn.addEventListener("touchend",()=>{rn.classList.remove("dragging")})})},500)}),Lm(()=>{Yt(),sd&&(clearTimeout(sd),sd=null),id&&(cancelAnimationFrame(id),id=null),Pd&&window.removeEventListener("keydown",Pd,{capture:!0}),Ed&&window.removeEventListener("beforeunload",Ed);try{const B=ba}catch{}try{window.removeEventListener("resize",eu)}catch{}if(zl){try{zl()}catch{}zl=null}if(Gd){try{Gd()}catch{}Gd=null}if(lu){try{lu()}catch{}lu=null}if(fi){try{fi()}catch{}fi=null}if(Yd){try{Yd.disconnect()}catch{}Yd=null}if(al){try{al()}catch{}al=null}i()&&we(i())});function so(B){let de=null,Oe=!1,Ue=0;const mt=800;let _n=0;const en=5;let Vn=null,Rn=!1;const xo=()=>{try{if(Rn)return;const jn=B.getVisibleRange();if(!jn||Oe)return;const Sn=B.getDataList();if(Sn.length===0)return;const Un=Sn.length-1;_d=jn.to>=Un-1;const ms=jn.to-jn.from;Vn=ms;const Wo=Math.max(3,Math.min(15,Math.floor(ms*.15))),Yo=de&&jn.from<de.from,Po=jn.from<=Wo,Is=!de||Math.abs(jn.from-de.from)>1,An=Date.now(),Ro=_n>=en?mt*3:mt,vn=An-Ue>Ro;if(jn.from<=Math.max(1,Math.floor(Wo/2))&&vn||Po&&vn){const Bn=Sn[0];console.log(`🚀 Infinite scroll triggered: from=${jn.from}, threshold=${Wo}, dataLength=${Sn.length}, consecutive=${_n}`),Dn(Bn.timestamp),Ue=An,_n+=1,setTimeout(()=>{_n=Math.max(0,_n-1)},mt*1.5)}de={...jn}}catch(jn){console.error("❌ Error checking scroll position:",jn)}},Dn=async jn=>{var Sn,Un,$n,ms,Wo,Yo,Po,Is,An,Ro,vn,on;if(Oe||a().loadingKLine||s(ml)){console.log("⏳ Already loading data, skipping request...");return}Oe=!0,x(ml,!0),x(gl,null),console.log("🔄 Loading more historical data...");try{const fo=((Un=(Sn=o().styles)==null?void 0:Sn.candle)==null?void 0:Un.type)==="renko_atr"?Kl??jn:jn,Bn=await w.loadMoreHistoricalData(o().symbol,o().period,fo);if(Bn.data.length>0){let Io=Bn.data;if(((ms=($n=o().styles)==null?void 0:$n.candle)==null?void 0:ms.type)==="heikin_ashi")Io=xb(Io);else if(((Yo=(Wo=o().styles)==null?void 0:Wo.candle)==null?void 0:Yo.type)==="renko_atr"){const bi=((Is=(Po=o().styles)==null?void 0:Po.candle)==null?void 0:Is.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};Io=wb(Io,bi);try{const yl=ra(Bn.data);yl!=null&&(!Kl||yl<Kl)&&(Kl=yl)}catch{}}else if(((Ro=(An=o().styles)==null?void 0:An.candle)==null?void 0:Ro.type)==="point_and_figure"){const bi=((on=(vn=o().styles)==null?void 0:vn.candle)==null?void 0:on.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};Io=kb(Io,bi)}const Gn=B.getDataList();Io.sort((bi,yl)=>bi.timestamp-yl.timestamp);const ti=new Set(Gn.map(bi=>bi.timestamp)),Ds=Io.filter(bi=>!ti.has(bi.timestamp));if(Ds.length>0){const bi=B.getVisibleRange(),yl=(bi==null?void 0:bi.to)??null,uc=!bi||!Gn.length?!1:bi.to>=Gn.length-2,kr=yl!==null&&Gn[yl]?Gn[yl].timestamp:null,Ka=[...Ds,...Gn].sort((ni,Ca)=>ni.timestamp-Ca.timestamp);B.applyNewData(Ka,{backward:!0,forward:!0});try{Tc()}catch{}try{Ka.length>0&&x(ee,!0)}catch{}console.log(`✅ Successfully loaded and merged ${Ds.length} more historical bars`),x(gl,null),bi&&requestAnimationFrame(()=>{var ni;try{if(uc){B.scrollToDataIndex(Ka.length-1),console.log("🎯 Scroll anchored to right edge (pinned)");return}if(kr){B.scrollToTimestamp(kr),console.log(`🎯 Scroll anchored to timestamp ${kr} (stable)`);return}const Ca=(yl??0)+Ds.length;B.scrollToDataIndex(Ca),console.log(`🎯 Scroll anchored to index ${Ca} (fallback)`)}catch(Ca){const wa=kr??((ni=Ka[Ds.length])==null?void 0:ni.timestamp);if(wa)try{B.scrollToTimestamp(wa)}catch{}console.warn("Could not maintain scroll position:",Ca)}})}else console.log("📭 No new unique historical data to add");Bn.lays&&Bn.lays.length>0&&s(ye)&&Bn.lays.forEach(bi=>{s(ye).addOverlay(bi)})}else console.log("📭 No historical chunk available from cache at the moment"),Rn=!w.hasMoreServerHistory(o().symbol,o().period)}catch(rn){console.error("❌ Error loading more historical data:",rn),x(gl,N(rn instanceof Error?rn.message:"Failed to load historical data")),Ye.addAlert("error",`Failed to load historical data: ${s(gl)}`)}finally{Oe=!1,x(ml,!1)}},ys=setInterval(xo,100);return()=>{clearInterval(ys),console.log("🧹 Infinite scrolling cleanup completed")}}async function Jo(){o().allSymbols||kl(C(),rs(o).allSymbols=[],rs(o)),console.log("🚀 loadSymbols function called. loadingPairs:",a().loadingPairs,"allSymbols length:",o().allSymbols.length),kl(I(),rs(a).loadingPairs=!0,rs(a)),console.log("🔄 Loading symbols..."),console.log("🔄 loadSymbols proceeding");const B=await w.getSymbols();console.log("📊 Symbols loaded:",B),console.log("📊 Symbols loaded count:",B.length),kl(C(),rs(o).allSymbols=B,rs(o));const de=new Set;B.forEach(Oe=>{Oe.exchange&&de.add(Oe.exchange)}),C().update(Oe=>(de.forEach(Ue=>{Oe.allExgs.add(Ue)}),Oe)),kl(I(),rs(a).loadingPairs=!1,rs(a))}async function Os(B,de,Oe,Ue,mt=!0,_n=kc){var ms,Wo,Yo,Po,Is,An,Ro,vn,on,rn,fo;const en=i();if(!en)return;S={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},_n===kc&&kl(I(),rs(a).loadingKLine=!0,rs(a));const Vn=l().url.searchParams.get("strategy");console.log("loadKlineRange",{symbol:B,period:de,start_ms:Oe,stop_ms:Ue,strategy:Vn});const Rn=await w.getHistoryKLineData({symbol:B,period:de,from:Oe,to:Ue,strategy:Vn});let Dn=(Rn.data||[]).slice(Math.max(0,(Rn.data||[]).length-600));if(!Dn||Dn.length===0){_n===kc&&kl(I(),rs(a).loadingKLine=!1,rs(a));return}const ys=((Wo=(ms=o().styles)==null?void 0:ms.candle)==null?void 0:Wo.type)||pT((Po=(Yo=i())==null?void 0:Yo.getStyles)==null?void 0:Po.call(Yo),o().styles),jn=z0(B),Sn=ys;if(Sn==="heikin_ashi")Dn=xb(Dn);else if(Sn==="renko_atr"){try{const Io=ra(Rn.data);Io!=null&&(!Kl||Io<Kl)&&(Kl=Io)}catch{}const Bn=((An=(Is=o().styles)==null?void 0:Is.candle)==null?void 0:An.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};Dn=wb(Dn,Bn)}else if(Sn==="point_and_figure"){const Bn=((vn=(Ro=o().styles)==null?void 0:Ro.candle)==null?void 0:vn.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};Dn=kb(Dn,Bn)}if(Dn=Dn.map((Bn,Io)=>((!Bn.timestamp||isNaN(Bn.timestamp)||Bn.timestamp<=0)&&(console.warn(`Invalid timestamp in klines at index ${Io}:`,Bn.timestamp),Bn.timestamp=Date.now()-(Dn.length-Io)*6e4),Bn)),_n!==kc){console.log("⏭️ Ignoring stale load result");return}try{let Bn=V0(B,Rn.data);try{const ti=Array.isArray(Rn.data)?Rn.data[Rn.data.length-1]:null,Ds=ti&&typeof ti=="object"?Number(ti.close):Array.isArray(ti)?Number(ti[4]):NaN;(Number.isFinite(Ds)&&Math.abs(Ds)>=1e4||jn==="crypto"&&Number.isFinite(Ds)&&Math.abs(Ds)>=1e3)&&(Bn=2)}catch{}((rn=(on=en==null?void 0:en.getSymbol)==null?void 0:on.call(en))==null?void 0:rn.pricePrecision)!==Bn&&(en==null||en.setSymbol({pricePrecision:Bn}));const Gn=B==null?void 0:B.pricePrecision;(!Number.isFinite(Gn)||Gn!==Bn)&&C().update(ti=>(ti.symbol&&ti.symbol.ticker===B.ticker&&(ti.symbol.pricePrecision=Bn),ti))}catch{}const Un=Sn==="renko_atr",$n=!Un&&mt&&Dn.length>0;en.applyNewData(Dn,!!$n);try{Tc()}catch{}try{(Dn??[]).length>0&&x(ee,!0)}catch{}try{w.startBackgroundPrefetch(B,{timeframe:de.timeframe})}catch{}if(Rn.lays&&Rn.lays.length>0&&s(ye)&&Rn.lays.forEach(Bn=>{s(ye).addOverlay(Bn)}),_n===kc&&kl(I(),rs(a).loadingKLine=!1,rs(a)),kl(I(),rs(a).klineLoaded+=1,rs(a)),Dn.length){const Bn=Pv(de.timeframe)*1e3,Io=new Date().getTime(),Gn=Dn[Dn.length-1].timestamp+Bn;!Un&&Gn+Bn>Io&&(((fo=o().options)==null?void 0:fo.enableRealtime)===!0||r().playing===!0?w.subscribe(B,Ds=>{var Ee,ac;const bi=Ds;if(!(B.exchange==="DSEBD"?(()=>{var U,te,$e;const Ia=new Date,Pc=new Intl.DateTimeFormat("en-GB",{timeZone:"Asia/Dhaka",hour12:!1,weekday:"short",hour:"2-digit",minute:"2-digit"}).formatToParts(Ia),Xi=((U=Pc.find(ut=>ut.type==="weekday"))==null?void 0:U.value)??"",aa=Number(((te=Pc.find(ut=>ut.type==="hour"))==null?void 0:te.value)??"0"),Fp=Number((($e=Pc.find(ut=>ut.type==="minute"))==null?void 0:$e.value)??"0"),ov=aa*60+Fp;return["Sun","Mon","Tue","Wed","Thu"].includes(Xi)&&ov>=600&&ov<=870})():!0))return;const uc=en.getDataList(),kr=uc[uc.length-1],Ka=kr&&kr.timestamp?[kr.timestamp,kr.open,kr.high,kr.low,kr.close,kr.volume??0]:null,ni=uT(bi.bars,bi.secs*1e3,Bn,Ka),Ca=en.getChartStore(),wa=en.getVisibleRange(),Pa=en.getDataList(),Jl=wa&&Pa[wa.from]?Pa[wa.from].timestamp:null,bd=Pa.length-1,Fo=wa?wa.to>=bd-1:!0,Ql=Pa&&Pa.length?Number(((Ee=Pa[Pa.length-1])==null?void 0:Ee.timestamp)??0):0,Dc=ni.map(([Ia,Pc,Xi,aa,Fp,ov])=>({timestamp:Ia,open:Pc,high:Xi,low:aa,close:Fp,volume:ov}));Ca.addData(Dc,"backward",{forward:Fo,backward:!1});try{const Ia=en.getDataList();Array.isArray(Ia)&&Ia.length>0&&x(ee,!0);const Pc=Ia&&Ia.length?Number(((ac=Ia[Ia.length-1])==null?void 0:ac.timestamp)??0):0;if(Pc>0){const Xi=Pc>Ql;S.active=!0,S.lastUpdateAt=Date.now(),S.lastBarTs=Pc,Xi&&(S.lastNewBarIndex=Ia.length-1),S.lastNewBarIndex<0&&(S.lastNewBarIndex=Ia.length-1)}}catch{}!Fo&&wa&&Jl&&requestAnimationFrame(()=>{try{const Pc=en.getDataList().findIndex(Xi=>Xi.timestamp===Jl);Pc!==-1?en.scrollToDataIndex(Pc):en.scrollToDataIndex(wa.from)}catch{}})}):console.log("⏹️ Realtime updates disabled"))}}async function wr(){x(ee,!1);const B=ob(o().dateStart);let de=ob(o().dateEnd);if(!B||!de){Ye.addAlert("error","invalid time, please use: 202301011200");return}const Oe=Pv(o().period.timeframe)*1e3;(de-B)/Oe>F&&(de=B+Oe*F),await Os(o().symbol,o().period,B,de,!1)}const ra=B=>{if(!Array.isArray(B)||B.length===0)return null;let de=1/0;for(const Oe of B){const Ue=Oe==null?void 0:Oe.timestamp,mt=typeof Ue=="number"?Ue:Number(Ue);Number.isFinite(mt)&&mt<de&&(de=mt)}return Number.isFinite(de)?de:null};async function Qr(B){console.log("🔄 loadSymbolPeriod called"),x(ee,!1);const de=o().symbol,Oe=o().period;console.log("🔄 Loading symbol:",de.ticker,"period:",Oe.timeframe);const Ue=new Date().getTime(),[mt,_n]=v8(Oe,Ue,it),en=B??kc,Vn=de.ticker,Rn=Oe.timeframe;console.log("🔄 Time range:",new Date(mt),"to",new Date(Ue));try{await Os(de,Oe,mt,Ue,!M(),en)}catch(xo){console.warn("⚠️ loadSymbolPeriod failed:",xo)}try{setTimeout(()=>{var xo;try{if(en!==kc||Vn!==o().symbol.ticker||Rn!==o().period.timeframe)return;const Dn=i(),ys=((xo=Dn==null?void 0:Dn.getDataList)==null?void 0:xo.call(Dn))??[];if(!Array.isArray(ys)||ys.length===0){const jn=en;console.log("🔁 Retrying loadSymbolPeriod due to empty data after TF change"),Os(de,Oe,mt,Ue,!M(),jn)}}catch{}},250)}catch{}}Lu(C(),B=>B.period.timeframe).subscribe(async B=>{var Oe,Ue,mt,_n,en,Vn,Rn,xo,Dn,ys,jn;const de=((Ue=(Oe=o().styles)==null?void 0:Oe.candle)==null?void 0:Ue.type)==="renko_atr";try{if(!de){const Sn=`${o().period.timespan}`;if(zd!==Sn){const Un=ib(o().period.timespan),$n=new Map,ms=800,Wo=({timestamp:Is,template:An,type:Ro})=>{const vn=`${Ro}|${An}|${Is}`,on=$n.get(vn);if(on)return on;const rn=Un(Is,An,Ro);return $n.size>=ms&&$n.clear(),$n.set(vn,rn),rn},Yo=i(),Po=(mt=Yo==null?void 0:Yo.getChartStore)==null?void 0:mt.call(Yo);Po!=null&&Po.setFormatter&&(Po.setFormatter({formatDate:Wo}),zd=Sn)}}}catch{}W1.set(o().period);try{const Sn=o().period,$n={s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month"}[Sn.timespan]??"day",ms=Number(Sn.multiplier)||1;((en=(_n=o().styles)==null?void 0:_n.candle)==null?void 0:en.type)!=="renko_atr"&&((Vn=i())==null||Vn.setPeriod({type:$n,span:ms}))}catch{}if(Kl=null,!(M()||!i())){try{w.unsubscribe()}catch{}if(S={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},!de&&ic&&(ic=!1),de){od+=1;const Sn=od,Un=Vd();ic=!0;try{try{(Rn=i())==null||Rn.setScrollEnabled(!1),(xo=i())==null||xo.setZoomEnabled(!1)}catch{}try{x(ee,!1)}catch{}try{(Dn=i())==null||Dn.applyNewData([],!1)}catch{}try{const $n=w;typeof $n.stopSymbolPipelines=="function"&&$n.stopSymbolPipelines(o().symbol.ticker)}catch{}await Qr(Un),kc===Un&&od===Sn&&(ic=!1,tn.request(()=>{var $n;try{($n=i())==null||$n.resize()}catch{}qt()}))}catch($n){console.warn("⚠️ Renko timeframe refresh failed:",$n)}finally{try{(ys=i())==null||ys.setScrollEnabled(!0),(jn=i())==null||jn.setZoomEnabled(!0)}catch{}od===Sn&&(ic=!1)}}else yd.changeTimeframe({chart:i(),period:o().period,loadDataFn:async()=>{const Sn=Vd();try{x(ee,!1)}catch{}await Qr(Sn)}});if(al){try{al()}catch{}al=null}i()&&(al=so(i()))}}),Lu(C(),B=>B.symbol.ticker).subscribe(B=>{var _n;console.log("📊 Symbol subscription triggered:",B),console.log("📊 Current symbol:",o().symbol),console.log("📊 Loading state:",a().loadingKLine,"Custom load:",M()),yb.set(o().symbol);const de=mu(o().symbol);de!==o().symbol&&C().update(en=>(en.symbol=de,en));const Oe={...de,ticker:o().symbol.ticker,pricePrecision:V0(o().symbol),volumePrecision:o().symbol.volumePrecision};try{dx({logo:de.logo,logo2:de.logo2})}catch{}if((_n=i())==null||_n.setSymbol(Oe),Kl=null,go){const en=ig(o().symbol);go.setCurrentSymbol(en),console.log("🔄 DrawingManager updated to symbol:",en),go.renderCurrentSymbolDrawings()}try{const en=window.overlayCreationManager;en&&en.setCurrentSymbolKey(ig(o().symbol))}catch{}if(M())return;console.log("📊 Proceeding with symbol change - unsubscribing and loading new data");const Ue=P;P=o().symbol,Ue&&Ue.ticker!==o().symbol.ticker?w.unsubscribe(Ue):w.unsubscribe(),S={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1};try{x(ee,!1)}catch{}if(al){try{al()}catch{}al=null}i()&&(al=so(i()));const mt=Vd();Qr(mt)});const qr=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"],Ga=[...qr,"SMARTTREND"];function Ki(){var de;const B=(de=c())==null?void 0:de.data;return(B==null?void 0:B.isPremium)===!0||(B==null?void 0:B.isTrial)===!0}function Zl(B){var xo,Dn,ys,jn,Sn,Un,$n,ms,Wo,Yo,Po,Is,An;if(!i())return;const de=i(),Oe=B==null?void 0:B.name;if(!Oe)return;const Ue=(B==null?void 0:B.pane_id)||"";let mt=[];try{mt=((xo=de.getIndicators)==null?void 0:xo.call(de))??[]}catch{mt=[]}if(mt.some(Ro=>Ro.name===Oe&&(!Ue||Ro.paneId===Ue)))return;let en;if(Array.isArray(B.styles)&&B.styles.length>0){const Ro=vn=>vn==="dashed"||vn==="dotted"?{style:Ke.Dashed,dashedValue:vn==="dotted"?[2,2]:[4,4]}:{style:Ke.Solid,dashedValue:[2,2]};en={lines:B.styles.map(vn=>{const on=Ro(vn==null?void 0:vn.lineStyle);return{color:vn==null?void 0:vn.color,size:(vn==null?void 0:vn.thickness)??1,style:on.style,dashedValue:on.dashedValue}})}}let Vn;if(Oe==="SMARTTREND"){const Ro=B.superTrendGroup;if(Vn=Ro?{showLabels:!!Ro.showLabels,uptrendColor:((ys=(Dn=Ro.styles)==null?void 0:Dn.uptrend)==null?void 0:ys.color)??"#00FF00",downtrendColor:((Sn=(jn=Ro.styles)==null?void 0:jn.downtrend)==null?void 0:Sn.color)??"#FF0000",uptrendThickness:(($n=(Un=Ro.styles)==null?void 0:Un.uptrend)==null?void 0:$n.thickness)??1,downtrendThickness:((Wo=(ms=Ro.styles)==null?void 0:ms.downtrend)==null?void 0:Wo.thickness)??1,uptrendLineStyle:((Po=(Yo=Ro.styles)==null?void 0:Yo.uptrend)==null?void 0:Po.lineStyle)??"dashed",downtrendLineStyle:((An=(Is=Ro.styles)==null?void 0:Is.downtrend)==null?void 0:An.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},!en){const vn=Vn.uptrendLineStyle==="dotted"||Vn.uptrendLineStyle==="dashed";en={lines:[{color:Vn.uptrendColor,size:Vn.uptrendThickness,style:vn?Ke.Dashed:Ke.Solid,dashedValue:Vn.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}const Rn=Ue==="candle_pane";de.createIndicator({name:Oe,calcParams:B==null?void 0:B.params,styles:en,...Vn?{extendData:Vn}:{}},Rn,Ue?{id:Ue}:void 0)}function Tl(){var de;if(!i()||Ki())return;console.log("🔒 User does not have premium access. Removing AI indicators...");const B=i();try{const Oe=((de=B.getIndicators)==null?void 0:de.call(B))??[];for(const Ue of Oe)if(Ue.name&&qr.includes(Ue.name))try{B.removeIndicator({paneId:Ue.paneId||"candle_pane",name:Ue.name}),console.log(`✅ Removed AI indicator: ${Ue.name} from pane: ${Ue.paneId}`)}catch(mt){console.warn(`⚠️ Failed to remove indicator ${Ue.name}:`,mt)}}catch(Oe){console.error("❌ Error removing AI indicators:",Oe)}}function Ya(){var de;if(!i()||Ki())return;const B=i();try{const Oe=((de=B.getIndicators)==null?void 0:de.call(B))??[];for(const Ue of Oe)Ue.name==="SMARTTREND"&&(B.removeIndicator({paneId:Ue.paneId||"candle_pane",name:Ue.name}),console.log(`✅ Removed Smart Trend indicator from pane: ${Ue.paneId}`))}catch(Oe){console.error("❌ Error removing Smart Trend:",Oe)}}function ur(){if(!(!i()||!Ki()))try{const B=Object.entries(o().saveInds||{});for(const[,de]of B)!(de!=null&&de.name)||!Ga.includes(de.name)||Zl(de)}catch(B){console.error("❌ Error restoring premium indicators:",B)}}let rc=ae(null),zr=ae(!1);mr(()=>{var Ue;if(!i()||((Ue=c())==null?void 0:Ue.data)===void 0)return;const de=Ki();(!s(zr)||s(rc)===!0&&de===!1)&&de===!1&&setTimeout(()=>{Tl(),Ya()},1e3),s(rc)===!1&&de===!0&&setTimeout(()=>{ur()},800),x(rc,N(de)),x(zr,!0)});const rd=Lu(C(),B=>B.theme);let cc=o().theme;rd.subscribe(B=>{var en,Vn,Rn,xo,Dn,ys,jn,Sn,Un,$n,ms,Wo,Yo,Po,Is,An,Ro,vn,on,rn,fo,Bn,Io,Gn,ti,Ds,bi,yl,uc,kr,Ka,ni,Ca,wa,Pa,Jl,bd,Fo,Ql,Dc,Ee,ac,Ia,Pc,Xi,aa,Fp,ov,U;if(console.log("🎨 THEME SUBSCRIPTION TRIGGERED:",B,"Previous:",cc),B===cc){console.log("⏸️ Theme value unchanged, skipping subscription");return}if(console.log("🎨 THEME ACTUALLY CHANGED:",cc,"->",B),cc=B,Dl){console.log("⏸️ Skipping theme subscription - manual styles being applied");return}if(a().isApplyingManualStyles){console.log("⏸️ SKIPPING theme application - manual styles are being applied via context");return}B=="light"?(kl(C(),rs(o).colorLong="green",rs(o)),kl(C(),rs(o).colorShort="red",rs(o))):(kl(C(),rs(o).colorLong="green",rs(o)),kl(C(),rs(o).colorShort="rgb(255,135,8)",rs(o)));const de=wu(o().theme);console.log("🎨 Theme styles from getThemeStyles:",JSON.stringify(de,null,2)),console.log("💾 Current save.styles:",JSON.stringify(o().styles,null,2));const Oe=Cm(o().styles),Ue=(en=Oe==null?void 0:Oe.candle)==null?void 0:en.type;Ue&&console.log("🔒 Preserving chart type during theme change:",Ue);const mt=Mn.merge({},de,Oe);console.log("🎨 theme axis colors:",(xo=(Rn=(Vn=de==null?void 0:de.xAxis)==null?void 0:Vn.tickText)==null?void 0:Rn.style)==null?void 0:xo.color,(jn=(ys=(Dn=de==null?void 0:de.yAxis)==null?void 0:Dn.tickText)==null?void 0:ys.style)==null?void 0:jn.color),console.log("💾 saved axis colors:",Mn.get(Oe,"xAxis.tickText.style.color"),Mn.get(Oe,"yAxis.tickText.style.color")),Ue&&mt.candle&&(mt.candle.type=Ue);try{const te=($n=(Un=(Sn=de==null?void 0:de.candle)==null?void 0:Sn.tooltip)==null?void 0:Un.title)==null?void 0:$n.color;if(te&&((Wo=(ms=mt==null?void 0:mt.candle)==null?void 0:ms.tooltip)!=null&&Wo.title)){mt.candle.tooltip.title.color=te;try{C().update($e=>($e.styles||($e.styles={}),Mn.set($e.styles,"candle.tooltip.title.color",te),$e))}catch{}}}catch{}try{const te=(Is=(Po=(Yo=de==null?void 0:de.candle)==null?void 0:Yo.tooltip)==null?void 0:Po.legend)==null?void 0:Is.color,$e=(vn=(Ro=(An=de==null?void 0:de.indicator)==null?void 0:An.tooltip)==null?void 0:Ro.legend)==null?void 0:vn.color;if(te&&((rn=(on=mt==null?void 0:mt.candle)==null?void 0:on.tooltip)!=null&&rn.legend)){mt.candle.tooltip.legend.color=te;try{C().update(ut=>(ut.styles||(ut.styles={}),Mn.set(ut.styles,"candle.tooltip.legend.color",te),ut))}catch{}}if($e&&((Bn=(fo=mt==null?void 0:mt.indicator)==null?void 0:fo.tooltip)!=null&&Bn.legend)){mt.indicator.tooltip.legend.color=$e;try{C().update(ut=>(ut.styles||(ut.styles={}),Mn.set(ut.styles,"indicator.tooltip.legend.color",$e),ut))}catch{}}}catch{}try{const te=(ti=(Gn=(Io=de==null?void 0:de.xAxis)==null?void 0:Io.tickText)==null?void 0:Gn.style)==null?void 0:ti.color,$e=(yl=(bi=(Ds=de==null?void 0:de.yAxis)==null?void 0:Ds.tickText)==null?void 0:bi.style)==null?void 0:yl.color;te&&((kr=(uc=mt==null?void 0:mt.xAxis)==null?void 0:uc.tickText)!=null&&kr.style)&&(mt.xAxis.tickText.style.color=te,(Ka=mt==null?void 0:mt.xAxis)!=null&&Ka.tickText&&(delete mt.xAxis.tickText.color,delete mt.xAxis.tickText.opacity,mt.xAxis.tickText.color=te)),$e&&((Ca=(ni=mt==null?void 0:mt.yAxis)==null?void 0:ni.tickText)!=null&&Ca.style)&&(mt.yAxis.tickText.style.color=$e,(wa=mt==null?void 0:mt.yAxis)!=null&&wa.tickText&&(delete mt.yAxis.tickText.color,delete mt.yAxis.tickText.opacity,mt.yAxis.tickText.color=$e))}catch{}try{if((Jl=(Pa=mt==null?void 0:mt.candle)==null?void 0:Pa.tooltip)!=null&&Jl.legend){const te=mt.candle.tooltip.legend.color;mt.candle.tooltip.legend.template=({current:$e})=>{const ut="#32CD32",Kt="#FF0000",$t=(($e==null?void 0:$e.close)??0)>(($e==null?void 0:$e.open)??0),wn=(($e==null?void 0:$e.close)??0)<(($e==null?void 0:$e.open)??0),Zn=$t?ut:wn?Kt:te,yo=$s=>({text:$s,color:Zn});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:yo("{open}")},{title:"H",value:yo("{high}")},{title:"L",value:yo("{low}")},{title:"C",value:yo("{close}")},{title:"V",value:yo("{volume}")}]:[{title:"O",value:yo("{open}")},{title:"H",value:yo("{high}")},{title:"L",value:yo("{low}")},{title:"C",value:yo("{close}")},{title:"V",value:yo("{volume}")}]}}}catch{}console.log("🔄 Merged styles (theme + saved):",JSON.stringify(mt,null,2)),console.log("🔄 merged axis colors before process:",(Ql=(Fo=(bd=mt==null?void 0:mt.xAxis)==null?void 0:bd.tickText)==null?void 0:Fo.style)==null?void 0:Ql.color,(ac=(Ee=(Dc=mt==null?void 0:mt.yAxis)==null?void 0:Dc.tickText)==null?void 0:Ee.style)==null?void 0:ac.color);const _n=$d(mt);console.log("✨ Final processed styles:",JSON.stringify(_n,null,2)),console.log("✨ processed axis colors:",(Xi=(Pc=(Ia=_n==null?void 0:_n.xAxis)==null?void 0:Ia.tickText)==null?void 0:Pc.style)==null?void 0:Xi.color,(ov=(Fp=(aa=_n==null?void 0:_n.yAxis)==null?void 0:aa.tickText)==null?void 0:Fp.style)==null?void 0:ov.color),(U=i())==null||U.setStyles(_n),console.log("✅ Styles applied to chart via theme subscription"),console.log("🎨 APPLYING SAVED CANVAS COLORS AFTER THEME CHANGE"),setTimeout(()=>{qt(),console.log("✅ Canvas colors reapplied after theme change")},100),setTimeout(()=>{var $e,ut,Kt;console.log("🔍 CHART STATE CHECK after theme subscription:");const te=($e=i())==null?void 0:$e.getStyles();console.log("  - Current chart styles:",JSON.stringify(te,null,2)),console.log("  - Saved chart type in $save.styles:",(Kt=(ut=o().styles)==null?void 0:ut.candle)==null?void 0:Kt.type)},200)}),Lu(C(),B=>B.timezone).subscribe(B=>{var de;(de=i())==null||de.setTimezone(B),rb(B)});const Er=Lu(C(),B=>{var de,Oe;return(Oe=(de=B.styles)==null?void 0:de.candle)==null?void 0:Oe.type});let Sc=((Oc=(qd=o().styles)==null?void 0:qd.candle)==null?void 0:Oc.type)||null;Er.subscribe(B=>{if(a().loadingKLine||M())return;const de=i();if(!de)return;Kl=null;const Oe=Sc==="point_and_figure",Ue=B==="point_and_figure";if(Ue&&!Oe)try{de.createIndicator("PNF",!1,{id:"candle_pane"}),console.log("📊 Added PNF indicator for Point & Figure chart")}catch(mt){console.warn("Failed to add PNF indicator:",mt)}else if(!Ue&&Oe)try{de.removeIndicator({paneId:"candle_pane",name:"PNF"}),console.log("📊 Removed PNF indicator (switched from P&F)");const mt=wu(o().theme),_n=Mn.merge({},mt,Cm(o().styles)),en=$d(_n);de.setStyles(en),console.log("🎨 Refreshed styles after P&F exit - candle colors restored")}catch(mt){console.warn("Failed to cleanup after P&F:",mt)}Sc=B||null,(B==="heikin_ashi"||B==="renko_atr"||B==="point_and_figure"||B!=="heikin_ashi"&&B!=="renko_atr"&&B!=="point_and_figure"&&de.getDataList().length>0)&&yd.switchChartType({chart:de,newType:B||"candle_solid",reloadDataFn:async()=>{await Qr()}})}),Lu(C(),B=>{var Oe,Ue;const de=((Ue=(Oe=B.styles)==null?void 0:Oe.candle)==null?void 0:Ue.renko)||{};return JSON.stringify(de)}).subscribe(B=>{var Oe,Ue;if(a().loadingKLine||M()||((Ue=(Oe=o().styles)==null?void 0:Oe.candle)==null?void 0:Ue.type)!=="renko_atr")return;const de=i();de&&yd.switchChartType({chart:de,newType:"renko_atr",reloadDataFn:async()=>{await Qr()}})}),Lu(C(),B=>{var Oe,Ue;const de=((Ue=(Oe=B.styles)==null?void 0:Oe.candle)==null?void 0:Ue.pnf)||{};return JSON.stringify(de)}).subscribe(B=>{var Oe,Ue;if(a().loadingKLine||M()||((Ue=(Oe=o().styles)==null?void 0:Oe.candle)==null?void 0:Ue.type)!=="point_and_figure")return;const de=i();de&&yd.switchChartType({chart:de,newType:"point_and_figure",reloadDataFn:async()=>{await Qr()}})}),Lu(I(),B=>B.fireOhlcv).subscribe(async B=>{a().timeStart&&a().timeEnd?(await Os(o().symbol,o().period,a().timeStart,a().timeEnd),kl(I(),rs(a).timeStart=0,rs(a)),kl(I(),rs(a).timeEnd=0,rs(a))):await wr()});function cu(){return i()}function Id(B){Dl=B}let Zc=ae(0),ce=ae(0),st=ae(0),ge=ae(0),Le=ae(!1),dt=ae(0),At=ae(0),pt=ae(""),at,Ct=ae(!1),Re=ae(""),kn=0,ro=0,uo=null,hs=ae(N([])),Ei=ae(0),ei=ae(!1),Ys=null,Ht=ae(1);function qe(B){var de,Oe;if(i())try{const Ue=i(),mt=((de=Ue.getPaneOptions)==null?void 0:de.call(Ue,B))||null,_n=(mt==null?void 0:mt.state)||"normal",en=_n==="maximize"?"normal":"maximize";(Oe=Ue.setPaneOptions)==null||Oe.call(Ue,{id:B,state:en}),console.log("🖱️ Pane double-click toggle",{paneId:B,from:_n,to:en})}catch(Ue){console.warn("⚠️ Failed to toggle pane state",B,Ue)}}function fn(B){var en;if(!i()||!j)return;const de=i();try{if(!(((en=de.getIndicators)==null?void 0:en.call(de))??[]).some(xo=>xo.paneId&&xo.paneId!=="candle_pane"))return}catch{return}const Oe=de._drawPanes;if(!Array.isArray(Oe)||Oe.length===0){qe("candle_pane");return}const Ue=j.getBoundingClientRect(),mt=B.clientY-Ue.top;let _n=null;for(const Vn of Oe){if(!Vn||typeof Vn.getId!="function"||typeof Vn.getBounding!="function")continue;const Rn=Vn.getId();if(Rn==="x_axis_pane")continue;const xo=Vn.getBounding();if(!xo||typeof xo.height!="number")continue;const Dn=typeof xo.top=="number"?xo.top:0,ys=xo.height;if(mt>=Dn&&mt<=Dn+ys){_n=Rn;break}}_n||(_n="candle_pane"),qe(_n)}function Fn(B){const de=j==null?void 0:j.getBoundingClientRect();de&&(x(Zc,B.clientX-de.left),x(ce,B.clientY-de.top)),x(st,N(B.clientX)),x(ge,N(B.clientY)),Z.length&&gs()}function Vt(){x(Zc,-1),x(ce,-1),x(st,-1),x(ge,-1),Vi()}function mn(B){if(B.preventDefault(),Ks())return;const de=j==null?void 0:j.getBoundingClientRect();if(de){const Oe=B.clientX-de.left,Ue=B.clientY-de.top;x(dt,Oe),x(At,Ue),x(pt,N(as())),ta(Oe,Ue)}}function Kn(B){if(B.touches.length===1){const de=B.touches[0],Oe=j==null?void 0:j.getBoundingClientRect();Oe&&(x(Zc,de.clientX-Oe.left),x(ce,de.clientY-Oe.top)),x(st,N(de.clientX)),x(ge,N(de.clientY));const Ue=B.target;if(s(Le)&&Ue&&(Ue.closest(".modal-content")||Ue.closest(".action-btn")))return;const mt=Date.now(),_n=mt-kn;if(_n<300&&_n>0){if(ro+=1,ro===2){if(B.preventDefault(),Oe){const en=de.clientX-Oe.left,Vn=de.clientY-Oe.top;Pn(en,Vn)}ro=0;return}}else if(ro=1,s(Le)){B.preventDefault(),Hn(),ro=0;return}kn=mt,uo&&clearTimeout(uo),uo=setTimeout(()=>{ro=0},300)}}function Pn(B,de){x(dt,N(B)),x(At,N(de)),x(pt,N(as())),x(Le,!0)}function Hn(){x(Le,!1)}let No=ae(!1),Mo=ae(0),qs=ae(0);function ta(B,de){x(Mo,N(B)),x(qs,N(de)),x(No,!0)}function Nc(){x(No,!1)}function Tc(){var B;try{if(s(re))return;const de=i();if(!de)return;const Oe=de.getVisibleRange(),Ue=((B=de.getDataList)==null?void 0:B.call(de))??[];if(!Oe||!Array.isArray(Ue)||Ue.length===0)return;const mt=Oe.to-Oe.from+1;x(me,mt),x(K,Oe.to>=Ue.length-2),x(re,!0)}catch{}}function Sl(){var de,Oe,Ue;const B=i();if(B)try{Tc();const mt=j==null?void 0:j.getBoundingClientRect(),_n=mt?mt.width:((de=B.getSize())==null?void 0:de.width)??0,en=B.getDataList(),Vn=Math.min(180,Array.isArray(en)?en.length:180),Rn=Math.max(1,s(me)??Vn),xo=B.getChartStore(),Dn=_n>0?Math.floor(_n/Rn):xo.getBarSpace().bar,ys=Math.max(1,Math.min(50,Dn));xo.setBarSpace(ys);const jn=((Oe=xo.getInitialOffsetRightDistance)==null?void 0:Oe.call(xo))??xo.getOffsetRightDistance();xo.setOffsetRightDistance(jn,!0),B.scrollToRealTime(),(Ue=B._drawPanes)==null||Ue.forEach(Un=>{var ms,Wo,Yo;const $n=(ms=Un==null?void 0:Un.getAxisComponent)==null?void 0:ms.call(Un);(Wo=$n==null?void 0:$n.setAutoCalcTickFlag)==null||Wo.call($n,!0),(Yo=$n==null?void 0:$n.buildTicks)==null||Yo.call($n,!0)})}finally{Nc()}}function Ks(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0}async function ci(B){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(B),console.log("✅ Copied using modern clipboard API"),!0}catch(de){console.warn("Modern clipboard API failed:",de)}try{const de=document.createElement("textarea");de.value=B,de.style.position="fixed",de.style.left="-999999px",de.style.top="-999999px",de.style.opacity="0",de.style.pointerEvents="none",de.setAttribute("readonly",""),document.body.appendChild(de),de.focus(),de.select(),de.setSelectionRange(0,B.length);const Oe=document.execCommand("copy");if(document.body.removeChild(de),Oe)return console.log("✅ Copied using fallback method"),!0}catch(de){console.error("Fallback copy method failed:",de)}try{const de=window.getSelection();if(de){const Oe=document.createRange(),Ue=document.createElement("span");Ue.textContent=B,Ue.style.position="fixed",Ue.style.left="-999999px",Ue.style.opacity="0",document.body.appendChild(Ue),Oe.selectNode(Ue),de.removeAllRanges(),de.addRange(Oe);const mt=document.execCommand("copy");if(document.body.removeChild(Ue),de.removeAllRanges(),mt)return console.log("✅ Copied using selection API fallback"),!0}}catch(de){console.error("Selection API fallback failed:",de)}return console.error("❌ All copy methods failed"),!1}function Lo(){const B=i();if(!B)return console.error("Chart not initialized"),!1;try{const de=B.getDataList();if(de.length<10)return console.warn("⚠️ Need more historical data for prediction"),!1;const Oe=de[de.length-1],mt=Pv(o().period.timeframe)*1e3;if(!JW(Oe.timestamp,mt)&&s(Ei)===0){const Un=Date.now()-Oe.timestamp,$n=Math.floor(Un/6e4);console.info(`ℹ️ Market appears to be open (last candle ${$n}m ago). Prediction is most useful when market is closed.`)}const en=de,Vn=XW(en);if(!Vn)return console.error("❌ Failed to generate prediction"),!1;x(hs,N([...s(hs),Vn])),ck(Ei);const Rn=[...en,Vn],xo=B.getVisibleRange(),Dn=xo?xo.to>=en.length-2:!0;B.applyNewData(Rn,!1);try{(Rn??[]).length>0&&x(ee,!0)}catch{}Dn&&setTimeout(()=>{B.scrollToRealTime()},50);const ys=en[en.length-1].close,jn=(Vn.close-ys)/ys*100,Sn=jn>0?"📈":"📉";return console.log(`${Sn} Prediction #${s(Ei)}: ${jn>0?"+":""}${jn.toFixed(2)}% (Close: ${Vn.close.toFixed(2)})`),console.log("✅ Prediction added:",Vn),console.log("📊 Total predictions so far:",s(Ei)),!0}catch(de){return console.error("❌ Prediction error:",de),!1}}function ln(){return Math.round(2e3/s(Ht))}function or(){if(!s(ei))return;Ys&&(clearInterval(Ys),Ys=null);const B=ln();Ys=setInterval(()=>{s(ei)&&Lo()},B),console.log(`⚡ Speed changed: ${s(Ht)}x (${B}ms interval)`)}function tr(B){x(Ht,N(B)),or()}function Zi(){if(s(ei))return;x(ei,!0),console.log("▶️ Auto-play started"),Lo();const B=ln();Ys=setInterval(()=>{s(ei)&&Lo()},B)}function Yt(){x(ei,!1),Ys&&(clearInterval(Ys),Ys=null),console.log("⏸️ Auto-play stopped")}function Xo(){s(ei)?Yt():Zi()}function as(){const B=i();if(!B||s(Zc)===null||s(ce)===null)return"";try{const de=(Sn,Un)=>{if(!Number.isFinite(Sn)||Sn===0)return`${Sn}`;const $n=Sn<0?"-":"",ms=Math.abs(Sn),Wo=Math.floor(Math.log10(ms))+1;let Yo=ms/Math.pow(10,Wo),Po=Wo;const Is=Number(Yo.toFixed(Un));return Is>=1?(Yo=Is/10,Po=Wo+1):Yo=Is,`${$n}${Yo.toFixed(Un)}e${Po}`},Oe=Sn=>{var Wo,Yo;const Un=Number((Yo=(Wo=B==null?void 0:B.getSymbol)==null?void 0:Wo.call(B))==null?void 0:Yo.pricePrecision);let $n=Number.isFinite(Un)?Math.max(0,Math.min(12,Math.trunc(Un))):V0(o().symbol);const ms=z0(o().symbol);if(Number.isFinite(Sn)&&Math.abs(Sn)>=1e4)$n=2;else if(ms==="crypto"&&Number.isFinite(Sn)){const Po=Math.abs(Sn);Po>=1e3?$n=2:Po>=1?$n=Math.min(Math.max($n,2),4):Po>=.01?$n=Math.min(Math.max($n,4),8):$n=Math.min(Math.max($n,6),12)}return Math.max(0,Math.min(12,Math.trunc($n)))},Ue=Sn=>{try{const Un=z0(o().symbol);if((Un==="stock"||Un==="crypto")&&Number.isFinite(Sn)){const $n=Math.abs(Sn);if($n>0&&$n<1e-4)return de(Sn,5)}}catch{}return Sn.toFixed(Oe(Sn))},mt=j==null?void 0:j.getBoundingClientRect();if(!mt)return"";if(B&&typeof B.convertFromPixel=="function")try{const Sn=B.convertFromPixel([{x:s(Zc),y:s(ce)}],{paneId:"candle_pane"});if(Sn&&Array.isArray(Sn)&&Sn[0]&&typeof Sn[0].value=="number")return Ue(Sn[0].value)}catch{}const _n=B.getVisibleRange(),en=B.getDataList();if(!en||en.length===0||!_n)return"";const Vn=en.slice(_n.from,_n.to+1);if(Vn.length===0)return"";let Rn=1/0,xo=-1/0;Vn.forEach(Sn=>{Rn=Math.min(Rn,Sn.low),xo=Math.max(xo,Sn.high)});const Dn=xo-Rn;if(Dn<=0)return"";const ys=s(ce)/mt.height,jn=xo-ys*Dn;return Ue(jn)}catch{return""}}console.log("📊 Chart script execution completed");var Pi=tZ();Pi.__click=[ZK,a,I];var As=g(Pi);vs(As,5,d,B=>B.id,(B,de)=>{uk(B,{get type(){return s(de).type},get text(){return s(de).text}})}),f(As);var Xs=u(As,2);bV(Xs,{get customLoad(){return M()},get mainContainer(){return s(Me)},set mainContainer(B){x(Me,N(B))},get sidebarHost(){return s(Ze)},set sidebarHost(B){x(Ze,N(B))},onToggleScriptStudio:()=>{x(ct,!s(ct)),s(ct)||x(kt,!1),xt()}});var Hr=u(Xs,2),Xl=g(Hr),Nd=g(Xl),Ru=g(Nd),Xc=g(Ru);Xu($L(Xc,{}),B=>x(ye,N(B)),()=>s(ye)),f(Ru);var Vl=u(Ru,2);Te(Vl,()=>!s(ee),B=>{var de=XK();z(B,de)});var _l=u(Vl,2);_l.__keydown=[YK,ye],_l.__contextmenu=mn,_l.__mousemove=Fn,_l.__dblclick=fn,_l.__touchstart=Kn,_l.__click=[KK,Le,Hn,No,Nc];var Et=g(_l);Xu(Et,B=>D=B,()=>D);var Nn=u(Et,2);Xu(Nn,B=>R=B,()=>R),f(_l),Xu(_l,B=>j=B,()=>j);var pn=u(_l,2);iq(pn,{}),f(Nd);var os=u(Nd,2);const Ps=vt(()=>`height: ${s(ct)?`${Math.round(s(bt)*100)}%`:"0px"};`);var sr=g(os);sr.__mousedown=be,sr.__touchstart=be;var Cl=u(sr,2);Cl.__touchmove=[JK];var Lc=g(Cl);pk(Lc,()=>s(Je),B=>{var de=vt(()=>s(On)?m()[s(On)]:null),Oe=vt(()=>s(On)?h()[s(On)]||[]:[]);Xu(UY(B,{get code(){return s(Ve)},set code(Ue){x(Ve,N(Ue))},get codeVersion(){return s(Je)},get status(){return s(Ne)},get error(){return s(ue)},get backtest(){return s(de)},get signalEvents(){return s(Oe)},get isRunning(){return s(he)},get isOpen(){return s(ct)},get paneTarget(){return s(no)},get labelsEnabled(){return s(Zt)},$$events:{fullpage:Ue=>{var mt;x(kt,N(!!((mt=Ue==null?void 0:Ue.detail)!=null&&mt.enabled)))},run:Ue=>{var mt,_n,en;return Ft(Ue.detail.code,((mt=Ue==null?void 0:Ue.detail)==null?void 0:mt.params)||null,(_n=Ue==null?void 0:Ue.detail)==null?void 0:_n.lang,((en=Ue==null?void 0:Ue.detail)==null?void 0:en.backtest)||null)},reset:Be,saveStatus:Ue=>{var mt;return x(Ne,N(((mt=Ue==null?void 0:Ue.detail)==null?void 0:mt.status)||s(Ne)))},close:Yn,pane:Ue=>x(no,N(Ue.detail.target)),labels:Ue=>x(Zt,N(Ue.detail.enabled)),selectTrade:Ue=>{var _n;const mt=(_n=Ue==null?void 0:Ue.detail)==null?void 0:_n.trade;mt?Qo(mt):Es()},focusIndex:Ue=>{var Vn,Rn;const mt=(Vn=Ue==null?void 0:Ue.detail)==null?void 0:Vn.index,_n=(Rn=Ue==null?void 0:Ue.detail)==null?void 0:Rn.timestamp;let en=!1;typeof mt=="number"&&Number.isFinite(mt)&&(en=Ko(mt)),!en&&typeof _n=="number"&&Number.isFinite(_n)&&oo(_n)},guide:()=>x(ft,!0)}}),Ue=>x(St,N(Ue)),()=>s(St))}),f(Cl),f(os),f(Xl),Xu(Xl,B=>x(Fe,B),()=>s(Fe));var cp=u(Xl,2);Xu(L$(cp,{}),B=>x(Ze,N(B)),()=>s(Ze)),f(Hr);var qp=u(Hr,2);Te(qp,()=>s(ml),B=>{var de=QK();z(B,de)});var Wd=u(qp,2);_K(Wd,{get show(){return s(ft)},$$events:{close:()=>x(ft,!1),insert:B=>{x(Ve,N(B.detail.code)),x(Je,s(Je)+1),x(ft,!1),an(),setTimeout(()=>{var de,Oe;try{(Oe=(de=s(St))==null?void 0:de.setEditorCode)==null||Oe.call(de,s(Ve))}catch{}xt()},0)}}});var kp=u(Wd,2);wV(kp,{get isOpen(){return s(Le)},set isOpen(B){x(Le,N(B))},get x(){return s(dt)},get y(){return s(At)},get currentPrice(){return s(pt)},$$events:{copy:async B=>{B.detail.price&&(await ci(B.detail.price)?(x(Re,`Price ${B.detail.price} copied!`),at==null||at.showToast(),Hn()):(x(Re,"Failed to copy price"),at==null||at.showToast()))},reset:Sl,close:Hn}});var Ov=u(kp,2);Te(Ov,()=>s(No),B=>{var de=eZ(),Oe=g(de);Oe.__click=async()=>{await ci(s(pt))?x(Re,`Price ${s(pt)} copied!`):x(Re,"Failed to copy price"),at==null||at.showToast(),Nc()};var Ue=u(g(Oe),2),mt=g(Ue);f(Ue),f(Oe);var _n=u(Oe,2);_n.__click=Sl,f(de),Se(()=>{zt(de,"style",`left: ${s(Mo)??""}px; top: ${s(qs)??""}px;`),ze(mt,`Copy Price ${(s(pt)?`(${s(pt)})`:"")??""}`)}),z(B,de)});var Lv=u(Ov,2);Xu(Gw(Lv,{get visible(){return s(Ct)},set visible(B){x(Ct,N(B))},get message(){return s(Re)},duration:2e3}),B=>at=B,()=>at);var zv=u(Lv,2);VW(zv,{get show(){return s(Ec)},title:"Unsaved changes",message:"You made changes but did not save. Refresh will discard them.",$$events:{cancel:()=>{x(Ec,!1)},confirm:()=>{var B;x(Ec,!1);try{if(go&&s1()){go.clearPersistedStorage();try{const de=(((B=o())==null?void 0:B.key)||"chart")+"_overlays";localStorage.removeItem(de)}catch{}try{localStorage.removeItem("dataSpaceOverlays")}catch{}}}catch{}location.reload()}}});var Vv=u(zv,2);H$(Vv,{});var ud=u(Vv,2);return RW(ud,{}),f(Pi),Xu(Pi,B=>x(Me,B),()=>s(Me)),Se(()=>{zt(Pi,"data-theme",o().theme),Fi(Xl,"restoring",p()),Us(os,`${`script-dock ${s(ct)?"open":""} ${s(kt)?"fullpage":""}`??""} svelte-1non98y`),zt(os,"style",s(Ps)),zt(os,"aria-hidden",!s(ct)),zt(Cl,"style",`opacity:${s(ct)?1:0}; pointer-events:${s(ct)?"auto":"none"}; transform: ${s(ct)?"none":"translateY(6px)"};`)}),sc("mouseleave",_l,Vt),sc("wheel",Cl,B=>B.stopPropagation()),z(n,Pi),hd({getChart:cu,setManualStylesFlag:Id})}qu(["click","keydown","contextmenu","mousemove","dblclick","touchstart","mousedown","touchmove"]);function dZ(n,e){gd(e,!1);const t=wp(),o=()=>ya(A2,"$page",t),i=()=>ya(l,"$save",t);console.log("📄 +page.svelte loaded");const r=zp(new jx);let a;try{const S=sessionStorage.getItem("chart.tabId");S?a=S:(a=`${Date.now()}-${Math.random().toString(36).slice(2)}`,sessionStorage.setItem("chart.tabId",a))}catch{a=`${Date.now()}-${Math.random().toString(36).slice(2)}`}const l=ly(`chart:${a}`,new Q0);let c=Qd(!1),d="light";function p(S){d=S,document.documentElement.classList.toggle("dark",S==="dark"),document.documentElement.setAttribute("data-theme",S),window.dispatchEvent(new CustomEvent("themechange",{detail:{theme:S}})),console.log("🖌️ Applied theme to document:",S)}function m(){window.location.href="https://dutyai.app/chart"}let h=null;fv(()=>((async()=>{var D,R,W,J;let S=null;const P=o().url.searchParams.get("userId");if(P){console.log("👤 User ID parameter found in URL:",P);try{localStorage.setItem("userId",P),console.log("✅ User ID saved to localStorage:",P);const Z=new URL(window.location.href);Z.searchParams.delete("userId"),window.history.replaceState({},"",Z.toString()),console.log("🔗 User ID parameter removed from URL"),S=P}catch(Z){console.error("❌ Failed to save user ID to localStorage:",Z)}}else try{S=localStorage.getItem("userId"),S&&console.log("👤 User ID found in localStorage:",S)}catch(Z){console.error("❌ Failed to read userId from localStorage:",Z)}if(!S){console.warn("⚠️ No userId found in URL or localStorage. Redirecting..."),m();return}sT(!0);try{console.log("📡 Fetching user preferences for userId:",S);const Z=o().url.searchParams.get("isFree")==="true",G=await eT(S,Z);console.log("✅ User preferences fetched successfully:",G),oT(G)}catch(Z){console.error("❌ Failed to fetch user preferences:",Z);{iT(Z instanceof Error?Z.message:"Unknown error"),console.warn("⚠️ User preferences fetch failed. Redirecting..."),m();return}}const I=o().url.searchParams.get("theme"),C=(W=(R=(D=tv(Fm))==null?void 0:D.data)==null?void 0:R.theme)==null?void 0:W.toLowerCase(),M=(J=tv(l))==null?void 0:J.theme,F=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,V=I==="dark"||I==="light"?I:C==="dark"||C==="light"?C==="dark"?"dark":"light":M==="dark"||M==="light"?M:F?"dark":"light";l.update(Z=>(Z.theme=V,Z)),p(V),h=l.subscribe(Z=>{const G=Z.theme==="dark"||Z.theme==="light"?Z.theme:F?"dark":"light";G!==d&&p(G)});const j=o().url.searchParams.get("symbol");if(j){console.log("🔗 Symbol parameter found in URL:",j);let Z=0;const G=50,se=()=>{Z+=1;const Y=i();if(Y.allSymbols&&Y.allSymbols.length>0){const oe=Y.allSymbols.find(ee=>ee.ticker.toLowerCase()===j.toLowerCase());if(oe)console.log("✅ Found symbol from URL parameter:",oe),l.update(ee=>(ee.symbol=oe,ee));else{console.warn("⚠️ Symbol not found in available symbols:",j),console.log("📊 Available symbols:",Y.allSymbols.map(re=>re.ticker).join(", "));const ee=Y.allSymbols.slice(0,10).map(re=>re.ticker).join(", ");console.log(`💡 Try one of these symbols: ${ee}${Y.allSymbols.length>10?"...":""}`)}}else Z<G?(console.log(`⏳ Waiting for symbols to load... (attempt ${Z}/${G})`),setTimeout(se,100)):console.error("❌ Timeout waiting for symbols to load. Symbol parameter will be ignored.")};se()}x(c,!0)})(),()=>{h&&h()})),Bv();var _=Ln(),w=Dt(_);Te(w,()=>s(c),S=>{nZ(S,{ctx:r,save:l})}),z(n,_),hd()}export{dZ as component};
